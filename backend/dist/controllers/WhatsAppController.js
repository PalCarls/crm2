'use strict';function a42_0x342b(_0x3449d7,_0x4a6b29){const _0x855432=a42_0x8554();return a42_0x342b=function(_0x342b19,_0x2047ea){_0x342b19=_0x342b19-0xcc;let _0x3c1f2f=_0x855432[_0x342b19];return _0x3c1f2f;},a42_0x342b(_0x3449d7,_0x4a6b29);}const a42_0x61a724=a42_0x342b;(function(_0x39977b,_0x317a53){const _0x46b296=a42_0x342b,_0x15bba6=_0x39977b();while(!![]){try{const _0x4ec458=-parseInt(_0x46b296(0xea))/0x1*(-parseInt(_0x46b296(0xe5))/0x2)+-parseInt(_0x46b296(0x10a))/0x3+-parseInt(_0x46b296(0xce))/0x4*(parseInt(_0x46b296(0x104))/0x5)+parseInt(_0x46b296(0xf2))/0x6*(-parseInt(_0x46b296(0xd9))/0x7)+parseInt(_0x46b296(0xe7))/0x8*(-parseInt(_0x46b296(0x113))/0x9)+-parseInt(_0x46b296(0xef))/0xa*(-parseInt(_0x46b296(0xd3))/0xb)+parseInt(_0x46b296(0x107))/0xc;if(_0x4ec458===_0x317a53)break;else _0x15bba6['push'](_0x15bba6['shift']());}catch(_0x4f6e8f){_0x15bba6['push'](_0x15bba6['shift']());}}}(a42_0x8554,0x50d42));var __importDefault=this&&this[a42_0x61a724(0xcd)]||function(_0x17f16a){const _0x4e296e=a42_0x61a724;return _0x17f16a&&_0x17f16a[_0x4e296e(0xed)]?_0x17f16a:{'default':_0x17f16a};};Object[a42_0x61a724(0xf7)](exports,'__esModule',{'value':!![]}),exports['showAdmin']=exports['removeAdmin']=exports[a42_0x61a724(0x109)]=exports[a42_0x61a724(0xf5)]=exports['restart']=exports['remove']=exports[a42_0x61a724(0xf4)]=exports[a42_0x61a724(0xd7)]=exports[a42_0x61a724(0x115)]=exports[a42_0x61a724(0x111)]=exports['store']=exports[a42_0x61a724(0xd4)]=void 0x0;const socket_1=require(a42_0x61a724(0xde)),cache_1=__importDefault(require(a42_0x61a724(0x118))),wbot_1=require(a42_0x61a724(0x11e)),Whatsapp_1=__importDefault(require(a42_0x61a724(0x11c))),AppError_1=__importDefault(require(a42_0x61a724(0xe4))),DeleteBaileysService_1=__importDefault(require(a42_0x61a724(0x10d))),ShowCompanyService_1=__importDefault(require(a42_0x61a724(0xe1))),graphAPI_1=require(a42_0x61a724(0xf9)),ShowPlanService_1=__importDefault(require(a42_0x61a724(0xdc))),StartWhatsAppSession_1=require('../services/WbotServices/StartWhatsAppSession'),CreateWhatsAppService_1=__importDefault(require(a42_0x61a724(0xf8))),DeleteWhatsAppService_1=__importDefault(require(a42_0x61a724(0x112))),ListWhatsAppsService_1=__importDefault(require(a42_0x61a724(0x11b))),ShowWhatsAppService_1=__importDefault(require(a42_0x61a724(0xcc))),UpdateWhatsAppService_1=__importDefault(require(a42_0x61a724(0xd2))),ImportWhatsAppMessageService_1=require(a42_0x61a724(0xd0)),ShowWhatsAppServiceAdmin_1=__importDefault(require(a42_0x61a724(0xda))),UpdateWhatsAppServiceAdmin_1=__importDefault(require(a42_0x61a724(0x10c))),ListAllWhatsAppService_1=__importDefault(require(a42_0x61a724(0xf0))),index=async(_0x1661f2,_0xac7116)=>{const _0xed1638=a42_0x61a724,{companyId:_0x43c699}=_0x1661f2['user'],{session:_0x153518}=_0x1661f2['query'],_0x1e1a30=await(0x0,ListWhatsAppsService_1[_0xed1638(0xfb)])({'companyId':_0x43c699,'session':_0x153518});return _0xac7116[_0xed1638(0x10b)](0xc8)[_0xed1638(0xff)](_0x1e1a30);};exports['index']=index;const store=async(_0x54c1f7,_0x2fd110)=>{const _0xdba65d=a42_0x61a724,{name:_0x3eac17,status:_0x46015b,isDefault:_0x25c867,greetingMessage:_0x41d87e,complationMessage:_0x1b51e5,outOfHoursMessage:_0x4ea506,queueIds:_0x4e34d1,token:_0x2a7227,maxUseBotQueues:_0x4842fd,timeUseBotQueues:_0x50849d,expiresTicket:_0x295299,allowGroup:_0x2873e6,timeSendQueue:_0x46901d,sendIdQueue:_0x326f99,timeInactiveMessage:_0x547481,inactiveMessage:_0x58f553,ratingMessage:_0x29bfb7,maxUseBotQueuesNPS:_0x57b7ef,expiresTicketNPS:_0x2d2b22,whenExpiresTicket:_0x9735cb,expiresInactiveMessage:_0x1dfb0c,importOldMessages:_0x222603,importRecentMessages:_0x2fb9aa,closedTicketsPostImported:_0xb46dec,importOldMessagesGroups:_0x289137,groupAsTicket:_0x1deb16,timeCreateNewTicket:_0x1d1ac5,schedules:_0x57f5a2,promptId:_0x290cd5}=_0x54c1f7[_0xdba65d(0x102)],{companyId:_0x16719a}=_0x54c1f7[_0xdba65d(0xec)],_0x3891d0=await(0x0,ShowCompanyService_1['default'])(_0x16719a),_0x52d3e3=await(0x0,ShowPlanService_1['default'])(_0x3891d0[_0xdba65d(0x114)]);if(!_0x52d3e3[_0xdba65d(0x10e)])return _0x2fd110[_0xdba65d(0x10b)](0x190)[_0xdba65d(0xff)]({'error':_0xdba65d(0xdd)});const {whatsapp:_0x4a96b0,oldDefaultWhatsapp:_0x9c3c75}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x3eac17,'status':_0x46015b,'isDefault':_0x25c867,'greetingMessage':_0x41d87e,'complationMessage':_0x1b51e5,'outOfHoursMessage':_0x4ea506,'queueIds':_0x4e34d1,'companyId':_0x16719a,'token':_0x2a7227,'maxUseBotQueues':_0x4842fd,'timeUseBotQueues':_0x50849d,'expiresTicket':_0x295299,'allowGroup':_0x2873e6,'timeSendQueue':_0x46901d,'sendIdQueue':_0x326f99,'timeInactiveMessage':_0x547481,'inactiveMessage':_0x58f553,'ratingMessage':_0x29bfb7,'maxUseBotQueuesNPS':_0x57b7ef,'expiresTicketNPS':_0x2d2b22,'whenExpiresTicket':_0x9735cb,'expiresInactiveMessage':_0x1dfb0c,'importOldMessages':_0x222603,'importRecentMessages':_0x2fb9aa,'closedTicketsPostImported':_0xb46dec,'importOldMessagesGroups':_0x289137,'groupAsTicket':_0x1deb16,'timeCreateNewTicket':_0x1d1ac5,'schedules':_0x57f5a2,'promptId':_0x290cd5});(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x4a96b0,_0x16719a);const _0x2c8d00=(0x0,socket_1['getIO'])();return _0x2c8d00['emit'](_0xdba65d(0xfe)+_0x16719a+_0xdba65d(0xf1),{'action':_0xdba65d(0xd7),'whatsapp':_0x4a96b0}),_0x9c3c75&&_0x2c8d00[_0xdba65d(0xeb)]('company-'+_0x16719a+_0xdba65d(0xf1),{'action':_0xdba65d(0xd7),'whatsapp':_0x9c3c75}),_0x2fd110[_0xdba65d(0x10b)](0xc8)[_0xdba65d(0xff)](_0x4a96b0);};exports[a42_0x61a724(0xee)]=store;const storeFacebook=async(_0x42cde3,_0x1bc187)=>{const _0x49f3a6=a42_0x61a724;try{const {facebookUserId:_0x27f77b,facebookUserToken:_0x153139,addInstagram:_0x3050ee}=_0x42cde3['body'],{companyId:_0xd47b96}=_0x42cde3['user'],{data:_0x5d913c}=await(0x0,graphAPI_1[_0x49f3a6(0xfa)])(_0x27f77b,_0x153139);if(_0x5d913c[_0x49f3a6(0xcf)]===0x0)return _0x1bc187[_0x49f3a6(0x10b)](0x190)[_0x49f3a6(0xff)]({'error':'Facebook\x20page\x20not\x20found'});const _0x23af3e=(0x0,socket_1[_0x49f3a6(0xf3)])(),_0x5437ea=[];for await(const _0x24df8a of _0x5d913c){const {name:_0x232cd2,access_token:_0x1cb2a4,id:_0x426522,instagram_business_account:_0x2e7f1a}=_0x24df8a,_0x2ff1e2=await(0x0,graphAPI_1[_0x49f3a6(0x11a)])(_0x1cb2a4);if(_0x2e7f1a&&_0x3050ee){const {id:_0xc72c64,username:_0x43c013,name:_0x3025c5}=_0x2e7f1a;_0x5437ea[_0x49f3a6(0x100)]({'companyId':_0xd47b96,'name':_0x49f3a6(0x101)+(_0x43c013||_0x3025c5),'facebookUserId':_0x27f77b,'facebookPageUserId':_0xc72c64,'facebookUserToken':_0x2ff1e2,'tokenMeta':_0x153139,'isDefault':![],'channel':_0x49f3a6(0x11d),'status':'CONNECTED','greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x5437ea[_0x49f3a6(0x100)]({'companyId':_0xd47b96,'name':_0x232cd2,'facebookUserId':_0x27f77b,'facebookPageUserId':_0x426522,'facebookUserToken':_0x2ff1e2,'tokenMeta':_0x153139,'isDefault':![],'channel':_0x49f3a6(0xe3),'status':_0x49f3a6(0x110),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x49f3a6(0x108)])(_0x426522,_0x2ff1e2);}!_0x2e7f1a&&(_0x5437ea['push']({'companyId':_0xd47b96,'name':_0x232cd2,'facebookUserId':_0x27f77b,'facebookPageUserId':_0x426522,'facebookUserToken':_0x2ff1e2,'tokenMeta':_0x153139,'isDefault':![],'channel':_0x49f3a6(0xe3),'status':_0x49f3a6(0x110),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1['subscribeApp'])(_0x24df8a['id'],_0x2ff1e2));}for await(const _0x3d4834 of _0x5437ea){const _0x45b092=await Whatsapp_1[_0x49f3a6(0xfb)]['findOne']({'where':{'facebookPageUserId':_0x3d4834[_0x49f3a6(0xe9)]}});_0x45b092&&await _0x45b092[_0x49f3a6(0xd7)]({..._0x3d4834});if(!_0x45b092){const {whatsapp:_0x48ee74}=await(0x0,CreateWhatsAppService_1[_0x49f3a6(0xfb)])(_0x3d4834);_0x23af3e[_0x49f3a6(0xeb)](_0x49f3a6(0xfe)+_0xd47b96+_0x49f3a6(0xf1),{'action':_0x49f3a6(0xd7),'whatsapp':_0x48ee74});}}return _0x1bc187[_0x49f3a6(0x10b)](0xc8);}catch(_0x547c47){return console[_0x49f3a6(0xe6)](_0x547c47),_0x1bc187[_0x49f3a6(0x10b)](0x190)[_0x49f3a6(0xff)]({'error':_0x49f3a6(0xd8)});}};exports[a42_0x61a724(0x111)]=storeFacebook;const show=async(_0x325d2,_0x5852b1)=>{const _0x193b3b=a42_0x61a724,{whatsappId:_0x4e0e22}=_0x325d2['params'],{companyId:_0x159bd4}=_0x325d2['user'],{session:_0x11181c}=_0x325d2[_0x193b3b(0x106)],_0x44fa9b=await(0x0,ShowWhatsAppService_1[_0x193b3b(0xfb)])(_0x4e0e22,_0x159bd4,_0x11181c);return _0x5852b1['status'](0xc8)['json'](_0x44fa9b);};exports[a42_0x61a724(0x115)]=show;const update=async(_0x21cc66,_0x167bf7)=>{const _0x44f094=a42_0x61a724,{whatsappId:_0x563b25}=_0x21cc66[_0x44f094(0x117)],_0x4e7efe=_0x21cc66[_0x44f094(0x102)],{companyId:_0x5043d1}=_0x21cc66[_0x44f094(0xec)],{whatsapp:_0x3967f3,oldDefaultWhatsapp:_0x7c3f11}=await(0x0,UpdateWhatsAppService_1[_0x44f094(0xfb)])({'whatsappData':_0x4e7efe,'whatsappId':_0x563b25,'companyId':_0x5043d1}),_0x1c7ebf=(0x0,socket_1['getIO'])();return _0x1c7ebf[_0x44f094(0xeb)](_0x44f094(0xfe)+_0x5043d1+_0x44f094(0xf1),{'action':_0x44f094(0xd7),'whatsapp':_0x3967f3}),_0x7c3f11&&_0x1c7ebf[_0x44f094(0xeb)](_0x44f094(0xfe)+_0x5043d1+'-whatsapp',{'action':_0x44f094(0xd7),'whatsapp':_0x7c3f11}),_0x167bf7[_0x44f094(0x10b)](0xc8)[_0x44f094(0xff)](_0x3967f3);};exports['update']=update;const closedTickets=async(_0x361e90,_0x5a4fe7)=>{const _0x3a42a3=a42_0x61a724,{whatsappId:_0x1da92b}=_0x361e90['params'];return(0x0,ImportWhatsAppMessageService_1[_0x3a42a3(0xf6)])(_0x1da92b),_0x5a4fe7[_0x3a42a3(0x10b)](0xc8)[_0x3a42a3(0xff)]('whatsapp');};exports[a42_0x61a724(0xf4)]=closedTickets;const remove=async(_0x2cde64,_0x34cce5)=>{const _0x6fb7e6=a42_0x61a724,{whatsappId:_0x4bbcc1}=_0x2cde64[_0x6fb7e6(0x117)],{companyId:_0x5e9ccb,profile:_0x30a917}=_0x2cde64[_0x6fb7e6(0xec)],_0x2e77b4=(0x0,socket_1[_0x6fb7e6(0xf3)])();if(_0x30a917!==_0x6fb7e6(0xd1))throw new AppError_1[(_0x6fb7e6(0xfb))]('ERR_NO_PERMISSION',0x193);const _0x42b012=await(0x0,ShowWhatsAppService_1[_0x6fb7e6(0xfb)])(_0x4bbcc1,_0x5e9ccb);_0x42b012[_0x6fb7e6(0xe8)]===_0x6fb7e6(0xfc)&&(await(0x0,DeleteBaileysService_1[_0x6fb7e6(0xfb)])(_0x4bbcc1),await(0x0,DeleteWhatsAppService_1[_0x6fb7e6(0xfb)])(_0x4bbcc1),await cache_1['default'][_0x6fb7e6(0x10f)]('sessions:'+_0x4bbcc1+':*'),(0x0,wbot_1[_0x6fb7e6(0x119)])(+_0x4bbcc1),_0x2e77b4[_0x6fb7e6(0xeb)]('company-'+_0x5e9ccb+_0x6fb7e6(0xf1),{'action':_0x6fb7e6(0xfd),'whatsappId':+_0x4bbcc1}));if(_0x42b012[_0x6fb7e6(0xe8)]==='facebook'||_0x42b012[_0x6fb7e6(0xe8)]===_0x6fb7e6(0x11d)){const {facebookUserToken:_0x1e4e91}=_0x42b012,_0x4500cd=await Whatsapp_1[_0x6fb7e6(0xfb)]['findAll']({'where':{'facebookUserToken':_0x1e4e91}});await Whatsapp_1[_0x6fb7e6(0xfb)]['destroy']({'where':{'facebookUserToken':_0x1e4e91}});for await(const _0x5b0e70 of _0x4500cd){_0x2e77b4[_0x6fb7e6(0xeb)](_0x6fb7e6(0xfe)+_0x5e9ccb+_0x6fb7e6(0xf1),{'action':_0x6fb7e6(0xfd),'whatsappId':_0x5b0e70['id']});}}return _0x34cce5[_0x6fb7e6(0x10b)](0xc8)[_0x6fb7e6(0xff)]({'message':_0x6fb7e6(0xe2)});};exports[a42_0x61a724(0xdf)]=remove;const restart=async(_0x590b49,_0x135edc)=>{const _0x58ae07=a42_0x61a724,{companyId:_0x43b330,profile:_0xa9f2b6}=_0x590b49[_0x58ae07(0xec)];if(_0xa9f2b6!==_0x58ae07(0xd1))throw new AppError_1[(_0x58ae07(0xfb))](_0x58ae07(0xd5),0x193);return await(0x0,wbot_1[_0x58ae07(0x103)])(_0x43b330),_0x135edc['status'](0xc8)['json']({'message':'Whatsapp\x20restart.'});};exports[a42_0x61a724(0x116)]=restart;const listAll=async(_0x298af1,_0x2c6c87)=>{const _0x5192b1=a42_0x61a724,{companyId:_0x126f09}=_0x298af1['user'],{session:_0x2c4f84}=_0x298af1['query'],_0x5860f1=await(0x0,ListAllWhatsAppService_1[_0x5192b1(0xfb)])({'session':_0x2c4f84});return _0x2c6c87['status'](0xc8)[_0x5192b1(0xff)](_0x5860f1);};exports[a42_0x61a724(0xf5)]=listAll;const updateAdmin=async(_0x3ea9e8,_0x3e9d06)=>{const _0x1eca6f=a42_0x61a724,{whatsappId:_0x509689}=_0x3ea9e8['params'],_0x27b8c0=_0x3ea9e8[_0x1eca6f(0x102)],{companyId:_0x2fd0ac}=_0x3ea9e8[_0x1eca6f(0xec)],{whatsapp:_0x45c77d,oldDefaultWhatsapp:_0x458d4e}=await(0x0,UpdateWhatsAppServiceAdmin_1['default'])({'whatsappData':_0x27b8c0,'whatsappId':_0x509689,'companyId':_0x2fd0ac}),_0x58965c=(0x0,socket_1[_0x1eca6f(0xf3)])();return _0x58965c['emit']('admin-whatsapp',{'action':_0x1eca6f(0xd7),'whatsapp':_0x45c77d}),_0x458d4e&&_0x58965c[_0x1eca6f(0xeb)](_0x1eca6f(0x105),{'action':_0x1eca6f(0xd7),'whatsapp':_0x458d4e}),_0x3e9d06[_0x1eca6f(0x10b)](0xc8)[_0x1eca6f(0xff)](_0x45c77d);};function a42_0x8554(){const _0x4af8df=['index','ERR_NO_PERMISSION','sessions:','update','Facebook\x20page\x20not\x20found','7133TDVgsA','../services/WhatsappService/ShowWhatsAppServiceAdmin','findAll','../services/PlanService/ShowPlanService','Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!','../libs/socket','remove','showAdmin','../services/CompanyService/ShowCompanyService','Session\x20disconnected.','facebook','../errors/AppError','54TfxxFQ','log','40fsmTBA','channel','facebookPageUserId','2071DCHHeP','emit','user','__esModule','store','16610BUqlPc','../services/WhatsappService/ListAllWhatsAppService','-whatsapp','2466EFxdKX','getIO','closedTickets','listAll','closeTicketsImported','defineProperty','../services/WhatsappService/CreateWhatsAppService','../services/FacebookServices/graphAPI','getPageProfile','default','whatsapp','delete','company-','json','push','Insta\x20','body','restartWbot','5YekSFK','admin-whatsapp','query','24531780OOjyBM','subscribeApp','updateAdmin','720258bWbqQg','status','../services/WhatsappService/UpdateWhatsAppServiceAdmin','../services/BaileysServices/DeleteBaileysService','useWhatsapp','delFromPattern','CONNECTED','storeFacebook','../services/WhatsappService/DeleteWhatsAppService','1184094SGLprm','planId','show','restart','params','../libs/cache','removeWbot','getAccessTokenFromPage','../services/WhatsappService/ListWhatsAppsService','../models/Whatsapp','instagram','../libs/wbot','../services/WhatsappService/ShowWhatsAppService','__importDefault','1975832pOypHB','length','../services/WhatsappService/ImportWhatsAppMessageService','admin','../services/WhatsappService/UpdateWhatsAppService','275GzQRfp'];a42_0x8554=function(){return _0x4af8df;};return a42_0x8554();}exports[a42_0x61a724(0x109)]=updateAdmin;const removeAdmin=async(_0x14d9ee,_0x138290)=>{const _0x562f29=a42_0x61a724,{whatsappId:_0x26e01b}=_0x14d9ee[_0x562f29(0x117)],{companyId:_0x218281}=_0x14d9ee[_0x562f29(0xec)],_0xeea975=(0x0,socket_1[_0x562f29(0xf3)])(),_0x21fcb2=await(0x0,ShowWhatsAppService_1['default'])(_0x26e01b,_0x218281);_0x21fcb2[_0x562f29(0xe8)]===_0x562f29(0xfc)&&(await(0x0,DeleteBaileysService_1[_0x562f29(0xfb)])(_0x26e01b),await(0x0,DeleteWhatsAppService_1[_0x562f29(0xfb)])(_0x26e01b),await cache_1[_0x562f29(0xfb)][_0x562f29(0x10f)](_0x562f29(0xd6)+_0x26e01b+':*'),(0x0,wbot_1[_0x562f29(0x119)])(+_0x26e01b),_0xeea975[_0x562f29(0xeb)](_0x562f29(0x105),{'action':'delete','whatsappId':+_0x26e01b}));if(_0x21fcb2[_0x562f29(0xe8)]===_0x562f29(0xe3)||_0x21fcb2[_0x562f29(0xe8)]==='instagram'){const {facebookUserToken:_0x3e865f}=_0x21fcb2,_0x316664=await Whatsapp_1['default'][_0x562f29(0xdb)]({'where':{'facebookUserToken':_0x3e865f}});await Whatsapp_1[_0x562f29(0xfb)]['destroy']({'where':{'facebookUserToken':_0x3e865f}});for await(const _0x4abdfd of _0x316664){_0xeea975[_0x562f29(0xeb)](_0x562f29(0xfe)+_0x218281+_0x562f29(0xf1),{'action':'delete','whatsappId':_0x4abdfd['id']});}}return _0x138290[_0x562f29(0x10b)](0xc8)[_0x562f29(0xff)]({'message':'Session\x20disconnected.'});};exports['removeAdmin']=removeAdmin;const showAdmin=async(_0x7ce3f1,_0x53e9e0)=>{const _0x4b33e0=a42_0x61a724,{whatsappId:_0xd10103}=_0x7ce3f1['params'],{companyId:_0x2e809d}=_0x7ce3f1['user'],_0x4972f3=await(0x0,ShowWhatsAppServiceAdmin_1['default'])(_0xd10103);return _0x53e9e0[_0x4b33e0(0x10b)](0xc8)['json'](_0x4972f3);};exports[a42_0x61a724(0xe0)]=showAdmin;