<<<<<<< HEAD
'use strict';const a42_0x1da7ad=a42_0xd48e;(function(_0x4b369a,_0x43cc1a){const _0x234f87=a42_0xd48e,_0xf6d330=_0x4b369a();while(!![]){try{const _0x31ecdc=-parseInt(_0x234f87(0x21b))/0x1*(parseInt(_0x234f87(0x225))/0x2)+-parseInt(_0x234f87(0x214))/0x3+-parseInt(_0x234f87(0x20b))/0x4*(-parseInt(_0x234f87(0x1ff))/0x5)+parseInt(_0x234f87(0x20a))/0x6+parseInt(_0x234f87(0x223))/0x7+-parseInt(_0x234f87(0x204))/0x8+-parseInt(_0x234f87(0x21e))/0x9;if(_0x31ecdc===_0x43cc1a)break;else _0xf6d330['push'](_0xf6d330['shift']());}catch(_0x78d11e){_0xf6d330['push'](_0xf6d330['shift']());}}}(a42_0x19a4,0xed80e));function a42_0xd48e(_0x5d66d5,_0x51f7eb){const _0x19a45d=a42_0x19a4();return a42_0xd48e=function(_0xd48e4c,_0xa325b1){_0xd48e4c=_0xd48e4c-0x1e8;let _0x13b730=_0x19a45d[_0xd48e4c];return _0x13b730;},a42_0xd48e(_0x5d66d5,_0x51f7eb);}var __importDefault=this&&this[a42_0x1da7ad(0x206)]||function(_0x4764a2){const _0x1f8dd7=a42_0x1da7ad;return _0x4764a2&&_0x4764a2[_0x1f8dd7(0x215)]?_0x4764a2:{'default':_0x4764a2};};Object[a42_0x1da7ad(0x200)](exports,a42_0x1da7ad(0x215),{'value':!![]}),exports[a42_0x1da7ad(0x1f7)]=exports['remove']=exports[a42_0x1da7ad(0x221)]=exports['update']=exports[a42_0x1da7ad(0x20c)]=exports[a42_0x1da7ad(0x203)]=exports[a42_0x1da7ad(0x226)]=exports['index']=void 0x0;const socket_1=require('../libs/socket'),cache_1=__importDefault(require('../libs/cache')),wbot_1=require(a42_0x1da7ad(0x1f4)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),AppError_1=__importDefault(require('../errors/AppError')),DeleteBaileysService_1=__importDefault(require(a42_0x1da7ad(0x210))),ShowCompanyService_1=__importDefault(require(a42_0x1da7ad(0x222))),graphAPI_1=require('../services/FacebookServices/graphAPI'),ShowPlanService_1=__importDefault(require(a42_0x1da7ad(0x20d))),StartWhatsAppSession_1=require(a42_0x1da7ad(0x217)),CreateWhatsAppService_1=__importDefault(require(a42_0x1da7ad(0x21a))),DeleteWhatsAppService_1=__importDefault(require(a42_0x1da7ad(0x1f9))),ListWhatsAppsService_1=__importDefault(require(a42_0x1da7ad(0x1f2))),ShowWhatsAppService_1=__importDefault(require('../services/WhatsappService/ShowWhatsAppService')),UpdateWhatsAppService_1=__importDefault(require(a42_0x1da7ad(0x201))),ImportWhatsAppMessageService_1=require(a42_0x1da7ad(0x21c)),index=async(_0x4e65d5,_0x5dff93)=>{const _0x34a1d1=a42_0x1da7ad,{companyId:_0x1bb7cc}=_0x4e65d5[_0x34a1d1(0x1fe)],{session:_0x4ea009}=_0x4e65d5[_0x34a1d1(0x21d)],_0x15029b=await(0x0,ListWhatsAppsService_1['default'])({'companyId':_0x1bb7cc,'session':_0x4ea009});return _0x5dff93[_0x34a1d1(0x1f0)](0xc8)[_0x34a1d1(0x216)](_0x15029b);};exports[a42_0x1da7ad(0x228)]=index;const store=async(_0x58ade8,_0xd94682)=>{const _0x2be260=a42_0x1da7ad,{name:_0x433483,status:_0xb46582,isDefault:_0x595ff1,greetingMessage:_0x46d79d,complationMessage:_0x1edd8c,outOfHoursMessage:_0x272342,queueIds:_0x4594d3,token:_0x451e90,maxUseBotQueues:_0x49a445,timeUseBotQueues:_0x235ffd,expiresTicket:_0x431d04,allowGroup:_0x432de1,timeSendQueue:_0x31c717,sendIdQueue:_0x5b48ea,timeInactiveMessage:_0x1272bb,inactiveMessage:_0x2c415a,ratingMessage:_0x3a3d3c,maxUseBotQueuesNPS:_0xb475fb,expiresTicketNPS:_0x48c55f,whenExpiresTicket:_0x1f9f5a,expiresInactiveMessage:_0x27b393,importOldMessages:_0x8e9b97,importRecentMessages:_0x1fd046,closedTicketsPostImported:_0x373e79,importOldMessagesGroups:_0x56ca56,groupAsTicket:_0x4e7f60,timeCreateNewTicket:_0x1eb471,schedules:_0x1c4077,promptId:_0x1a626b}=_0x58ade8[_0x2be260(0x1fd)],{companyId:_0x2a901d}=_0x58ade8['user'],_0x56240=await(0x0,ShowCompanyService_1['default'])(_0x2a901d),_0x105d68=await(0x0,ShowPlanService_1[_0x2be260(0x1ee)])(_0x56240[_0x2be260(0x209)]);if(!_0x105d68['useWhatsapp'])return _0xd94682['status'](0x190)[_0x2be260(0x216)]({'error':_0x2be260(0x218)});const {whatsapp:_0x347ae,oldDefaultWhatsapp:_0x3c1f4c}=await(0x0,CreateWhatsAppService_1[_0x2be260(0x1ee)])({'name':_0x433483,'status':_0xb46582,'isDefault':_0x595ff1,'greetingMessage':_0x46d79d,'complationMessage':_0x1edd8c,'outOfHoursMessage':_0x272342,'queueIds':_0x4594d3,'companyId':_0x2a901d,'token':_0x451e90,'maxUseBotQueues':_0x49a445,'timeUseBotQueues':_0x235ffd,'expiresTicket':_0x431d04,'allowGroup':_0x432de1,'timeSendQueue':_0x31c717,'sendIdQueue':_0x5b48ea,'timeInactiveMessage':_0x1272bb,'inactiveMessage':_0x2c415a,'ratingMessage':_0x3a3d3c,'maxUseBotQueuesNPS':_0xb475fb,'expiresTicketNPS':_0x48c55f,'whenExpiresTicket':_0x1f9f5a,'expiresInactiveMessage':_0x27b393,'importOldMessages':_0x8e9b97,'importRecentMessages':_0x1fd046,'closedTicketsPostImported':_0x373e79,'importOldMessagesGroups':_0x56ca56,'groupAsTicket':_0x4e7f60,'timeCreateNewTicket':_0x1eb471,'schedules':_0x1c4077,'promptId':_0x1a626b});(0x0,StartWhatsAppSession_1[_0x2be260(0x20f)])(_0x347ae,_0x2a901d);const _0x584a7f=(0x0,socket_1[_0x2be260(0x1fc)])();return _0x584a7f[_0x2be260(0x21f)](_0x2be260(0x211)+_0x2a901d+_0x2be260(0x212),{'action':_0x2be260(0x1f3),'whatsapp':_0x347ae}),_0x3c1f4c&&_0x584a7f[_0x2be260(0x21f)](_0x2be260(0x211)+_0x2a901d+_0x2be260(0x212),{'action':'update','whatsapp':_0x3c1f4c}),_0xd94682[_0x2be260(0x1f0)](0xc8)[_0x2be260(0x216)](_0x347ae);};exports[a42_0x1da7ad(0x226)]=store;const storeFacebook=async(_0x39adda,_0x2fae51)=>{const _0x16301f=a42_0x1da7ad;try{const {facebookUserId:_0x25975b,facebookUserToken:_0x1ce53b,addInstagram:_0x1904b1}=_0x39adda['body'],{companyId:_0x111156}=_0x39adda[_0x16301f(0x1fe)],{data:_0x2dd6c7}=await(0x0,graphAPI_1['getPageProfile'])(_0x25975b,_0x1ce53b);if(_0x2dd6c7['length']===0x0)return _0x2fae51[_0x16301f(0x1f0)](0x190)[_0x16301f(0x216)]({'error':'Facebook\x20page\x20not\x20found'});const _0x524a5a=(0x0,socket_1[_0x16301f(0x1fc)])(),_0x25d6e9=[];for await(const _0xdec05b of _0x2dd6c7){const {name:_0xec997d,access_token:_0x9105e4,id:_0x2abc0c,instagram_business_account:_0x1299dc}=_0xdec05b,_0x312861=await(0x0,graphAPI_1[_0x16301f(0x220)])(_0x9105e4);if(_0x1299dc&&_0x1904b1){const {id:_0x4d23d7,username:_0x53b9d8,name:_0x4de2b8}=_0x1299dc;_0x25d6e9[_0x16301f(0x1fb)]({'companyId':_0x111156,'name':_0x16301f(0x219)+(_0x53b9d8||_0x4de2b8),'facebookUserId':_0x25975b,'facebookPageUserId':_0x4d23d7,'facebookUserToken':_0x312861,'tokenMeta':_0x1ce53b,'isDefault':![],'channel':_0x16301f(0x20e),'status':_0x16301f(0x205),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x25d6e9['push']({'companyId':_0x111156,'name':_0xec997d,'facebookUserId':_0x25975b,'facebookPageUserId':_0x2abc0c,'facebookUserToken':_0x312861,'tokenMeta':_0x1ce53b,'isDefault':![],'channel':_0x16301f(0x207),'status':'CONNECTED','greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1['subscribeApp'])(_0x2abc0c,_0x312861);}!_0x1299dc&&(_0x25d6e9[_0x16301f(0x1fb)]({'companyId':_0x111156,'name':_0xec997d,'facebookUserId':_0x25975b,'facebookPageUserId':_0x2abc0c,'facebookUserToken':_0x312861,'tokenMeta':_0x1ce53b,'isDefault':![],'channel':_0x16301f(0x207),'status':_0x16301f(0x205),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x16301f(0x1f8)])(_0xdec05b['id'],_0x312861));}for await(const _0x49bd60 of _0x25d6e9){const _0x311712=await Whatsapp_1['default']['findOne']({'where':{'facebookPageUserId':_0x49bd60['facebookPageUserId']}});_0x311712&&await _0x311712[_0x16301f(0x1f3)]({..._0x49bd60});if(!_0x311712){const {whatsapp:_0x54e1c3}=await(0x0,CreateWhatsAppService_1[_0x16301f(0x1ee)])(_0x49bd60);_0x524a5a['emit']('company-'+_0x111156+'-whatsapp',{'action':_0x16301f(0x1f3),'whatsapp':_0x54e1c3});}}return _0x2fae51['status'](0xc8);}catch(_0x49f196){return console[_0x16301f(0x213)](_0x49f196),_0x2fae51[_0x16301f(0x1f0)](0x190)[_0x16301f(0x216)]({'error':'Facebook\x20page\x20not\x20found'});}};exports[a42_0x1da7ad(0x203)]=storeFacebook;const show=async(_0x45b107,_0x4fca98)=>{const _0x2c702d=a42_0x1da7ad,{whatsappId:_0x339b2b}=_0x45b107[_0x2c702d(0x1e8)],{companyId:_0x36265c}=_0x45b107['user'],{session:_0x19ad38}=_0x45b107['query'],_0x5c6385=await(0x0,ShowWhatsAppService_1[_0x2c702d(0x1ee)])(_0x339b2b,_0x36265c,_0x19ad38);return _0x4fca98[_0x2c702d(0x1f0)](0xc8)[_0x2c702d(0x216)](_0x5c6385);};exports['show']=show;const update=async(_0x28c288,_0x2265e9)=>{const _0x1d7558=a42_0x1da7ad,{whatsappId:_0x261787}=_0x28c288[_0x1d7558(0x1e8)],_0x31f4c7=_0x28c288['body'],{companyId:_0x329569}=_0x28c288[_0x1d7558(0x1fe)],{whatsapp:_0xc3234a,oldDefaultWhatsapp:_0x324c1a}=await(0x0,UpdateWhatsAppService_1[_0x1d7558(0x1ee)])({'whatsappData':_0x31f4c7,'whatsappId':_0x261787,'companyId':_0x329569}),_0x15a1fe=(0x0,socket_1[_0x1d7558(0x1fc)])();return _0x15a1fe[_0x1d7558(0x21f)]('company-'+_0x329569+_0x1d7558(0x212),{'action':_0x1d7558(0x1f3),'whatsapp':_0xc3234a}),_0x324c1a&&_0x15a1fe[_0x1d7558(0x21f)]('company-'+_0x329569+_0x1d7558(0x212),{'action':'update','whatsapp':_0x324c1a}),_0x2265e9['status'](0xc8)[_0x1d7558(0x216)](_0xc3234a);};exports[a42_0x1da7ad(0x1f3)]=update;const closedTickets=async(_0x676d07,_0x403feb)=>{const _0x4a327d=a42_0x1da7ad,{whatsappId:_0xa5b923}=_0x676d07[_0x4a327d(0x1e8)];return(0x0,ImportWhatsAppMessageService_1[_0x4a327d(0x1ea)])(_0xa5b923),_0x403feb[_0x4a327d(0x1f0)](0xc8)[_0x4a327d(0x216)](_0x4a327d(0x224));};function a42_0x19a4(){const _0x18fc1a=['5976584pSnLMX','show','../services/PlanService/ShowPlanService','instagram','StartWhatsAppSession','../services/BaileysServices/DeleteBaileysService','company-','-whatsapp','log','3625641BrXgmd','__esModule','json','../services/WbotServices/StartWhatsAppSession','Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!','Insta\x20','../services/WhatsappService/CreateWhatsAppService','9TSUkRW','../services/WhatsappService/ImportWhatsAppMessageService','query','268299PkEDiE','emit','getAccessTokenFromPage','closedTickets','../services/CompanyService/ShowCompanyService','12233158npmhrf','whatsapp','177332tlxFSe','store','delete','index','params','admin','closeTicketsImported','remove','channel','sessions:','default','Whatsapp\x20restart.','status','delFromPattern','../services/WhatsappService/ListWhatsAppsService','update','../libs/wbot','destroy','removeWbot','restart','subscribeApp','../services/WhatsappService/DeleteWhatsAppService','restartWbot','push','getIO','body','user','5eRBwOX','defineProperty','../services/WhatsappService/UpdateWhatsAppService','ERR_NO_PERMISSION','storeFacebook','5142480dPBpdY','CONNECTED','__importDefault','facebook','Session\x20disconnected.','planId','2461416ECPAOL'];a42_0x19a4=function(){return _0x18fc1a;};return a42_0x19a4();}exports['closedTickets']=closedTickets;const remove=async(_0x3d583b,_0x1c2d41)=>{const _0x5c162a=a42_0x1da7ad,{whatsappId:_0x24da54}=_0x3d583b['params'],{companyId:_0x975da7,profile:_0x5b09ea}=_0x3d583b[_0x5c162a(0x1fe)],_0x466e0a=(0x0,socket_1[_0x5c162a(0x1fc)])();if(_0x5b09ea!=='admin')throw new AppError_1[(_0x5c162a(0x1ee))](_0x5c162a(0x202),0x193);const _0x153dad=await(0x0,ShowWhatsAppService_1['default'])(_0x24da54,_0x975da7);_0x153dad[_0x5c162a(0x1ec)]===_0x5c162a(0x224)&&(await(0x0,DeleteBaileysService_1[_0x5c162a(0x1ee)])(_0x24da54),await(0x0,DeleteWhatsAppService_1[_0x5c162a(0x1ee)])(_0x24da54),await cache_1[_0x5c162a(0x1ee)][_0x5c162a(0x1f1)](_0x5c162a(0x1ed)+_0x24da54+':*'),(0x0,wbot_1[_0x5c162a(0x1f6)])(+_0x24da54),_0x466e0a[_0x5c162a(0x21f)](_0x5c162a(0x211)+_0x975da7+_0x5c162a(0x212),{'action':_0x5c162a(0x227),'whatsappId':+_0x24da54}));if(_0x153dad[_0x5c162a(0x1ec)]===_0x5c162a(0x207)||_0x153dad[_0x5c162a(0x1ec)]==='instagram'){const {facebookUserToken:_0x50dc5d}=_0x153dad,_0x41fbfa=await Whatsapp_1[_0x5c162a(0x1ee)]['findAll']({'where':{'facebookUserToken':_0x50dc5d}});await Whatsapp_1[_0x5c162a(0x1ee)][_0x5c162a(0x1f5)]({'where':{'facebookUserToken':_0x50dc5d}});for await(const _0x467383 of _0x41fbfa){_0x466e0a[_0x5c162a(0x21f)](_0x5c162a(0x211)+_0x975da7+_0x5c162a(0x212),{'action':_0x5c162a(0x227),'whatsappId':_0x467383['id']});}}return _0x1c2d41['status'](0xc8)['json']({'message':_0x5c162a(0x208)});};exports[a42_0x1da7ad(0x1eb)]=remove;const restart=async(_0x4dd486,_0x597dbd)=>{const _0x5b2cd3=a42_0x1da7ad,{companyId:_0x573f1e,profile:_0x408280}=_0x4dd486[_0x5b2cd3(0x1fe)];if(_0x408280!==_0x5b2cd3(0x1e9))throw new AppError_1[(_0x5b2cd3(0x1ee))](_0x5b2cd3(0x202),0x193);return await(0x0,wbot_1[_0x5b2cd3(0x1fa)])(_0x573f1e),_0x597dbd['status'](0xc8)[_0x5b2cd3(0x216)]({'message':_0x5b2cd3(0x1ef)});};exports[a42_0x1da7ad(0x1f7)]=restart;
=======
'use strict';const a42_0x34d9ce=a42_0xfc07;(function(_0x31841e,_0x3f6149){const _0x2376c1=a42_0xfc07,_0x50e470=_0x31841e();while(!![]){try{const _0x437ab5=parseInt(_0x2376c1(0x8d))/0x1+parseInt(_0x2376c1(0x9a))/0x2+parseInt(_0x2376c1(0x85))/0x3*(parseInt(_0x2376c1(0x88))/0x4)+-parseInt(_0x2376c1(0x73))/0x5+parseInt(_0x2376c1(0x86))/0x6+parseInt(_0x2376c1(0x8a))/0x7+-parseInt(_0x2376c1(0x79))/0x8;if(_0x437ab5===_0x3f6149)break;else _0x50e470['push'](_0x50e470['shift']());}catch(_0x343ad1){_0x50e470['push'](_0x50e470['shift']());}}}(a42_0x57a6,0x69819));var __importDefault=this&&this['__importDefault']||function(_0x4a1f60){return _0x4a1f60&&_0x4a1f60['__esModule']?_0x4a1f60:{'default':_0x4a1f60};};function a42_0xfc07(_0x296e23,_0x6fd7d6){const _0x57a6e3=a42_0x57a6();return a42_0xfc07=function(_0xfc07d9,_0x20d930){_0xfc07d9=_0xfc07d9-0x67;let _0x31a65d=_0x57a6e3[_0xfc07d9];return _0x31a65d;},a42_0xfc07(_0x296e23,_0x6fd7d6);}Object[a42_0x34d9ce(0x7f)](exports,a42_0x34d9ce(0x6f),{'value':!![]}),exports[a42_0x34d9ce(0x80)]=exports['remove']=exports['closedTickets']=exports[a42_0x34d9ce(0x75)]=exports[a42_0x34d9ce(0x8f)]=exports[a42_0x34d9ce(0x8c)]=exports[a42_0x34d9ce(0x90)]=exports[a42_0x34d9ce(0x92)]=void 0x0;function a42_0x57a6(){const _0xb1f286=['14449784eDVcbZ','../services/FacebookServices/graphAPI','remove','user','json','subscribeApp','defineProperty','restart','log','default','CONNECTED','Whatsapp\x20restart.','117snKvGJ','2369442ZfyGxw','../libs/wbot','77612XtqKBC','planId','2796710TratmC','../services/WhatsappService/UpdateWhatsAppService','storeFacebook','339494aZhOQo','whatsapp','show','store','delFromPattern','index','removeWbot','-whatsapp','Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!','../services/CompanyService/ShowCompanyService','channel','useWhatsapp','admin','870800xYkZMa','../services/WhatsappService/DeleteWhatsAppService','emit','company-','destroy','Session\x20disconnected.','delete','length','getAccessTokenFromPage','ERR_NO_PERMISSION','../services/WbotServices/StartWhatsAppSession','../services/BaileysServices/DeleteBaileysService','body','../services/WhatsappService/ShowWhatsAppService','instagram','getIO','restartWbot','params','push','../errors/AppError','status','__esModule','closedTickets','../models/Whatsapp','sessions:','438360Euzsxj','findAll','update','closeTicketsImported','query','../services/WhatsappService/CreateWhatsAppService'];a42_0x57a6=function(){return _0xb1f286;};return a42_0x57a6();}const socket_1=require('../libs/socket'),cache_1=__importDefault(require('../libs/cache')),wbot_1=require(a42_0x34d9ce(0x87)),Whatsapp_1=__importDefault(require(a42_0x34d9ce(0x71))),AppError_1=__importDefault(require(a42_0x34d9ce(0x6d))),DeleteBaileysService_1=__importDefault(require(a42_0x34d9ce(0xa5))),ShowCompanyService_1=__importDefault(require(a42_0x34d9ce(0x96))),graphAPI_1=require(a42_0x34d9ce(0x7a)),ShowPlanService_1=__importDefault(require('../services/PlanService/ShowPlanService')),StartWhatsAppSession_1=require(a42_0x34d9ce(0xa4)),CreateWhatsAppService_1=__importDefault(require(a42_0x34d9ce(0x78))),DeleteWhatsAppService_1=__importDefault(require(a42_0x34d9ce(0x9b))),ListWhatsAppsService_1=__importDefault(require('../services/WhatsappService/ListWhatsAppsService')),ShowWhatsAppService_1=__importDefault(require(a42_0x34d9ce(0x67))),UpdateWhatsAppService_1=__importDefault(require(a42_0x34d9ce(0x8b))),ImportWhatsAppMessageService_1=require('../services/WhatsappService/ImportWhatsAppMessageService'),index=async(_0x5c2432,_0x36567b)=>{const _0x3d9855=a42_0x34d9ce,{companyId:_0x1d704f}=_0x5c2432[_0x3d9855(0x7c)],{session:_0x48eb57}=_0x5c2432[_0x3d9855(0x77)],_0x1ad4e8=await(0x0,ListWhatsAppsService_1[_0x3d9855(0x82)])({'companyId':_0x1d704f,'session':_0x48eb57});return _0x36567b[_0x3d9855(0x6e)](0xc8)['json'](_0x1ad4e8);};exports[a42_0x34d9ce(0x92)]=index;const store=async(_0x5478b5,_0x43cc83)=>{const _0x542561=a42_0x34d9ce,{name:_0x38a43c,status:_0x46f37e,isDefault:_0xef365b,greetingMessage:_0x57146a,complationMessage:_0x462447,outOfHoursMessage:_0x2bd2c7,queueIds:_0x386f43,token:_0xb2b997,maxUseBotQueues:_0x13c1a1,timeUseBotQueues:_0x5bc258,expiresTicket:_0x2b0dc4,allowGroup:_0x3ed26a,timeSendQueue:_0x321e25,sendIdQueue:_0x3ff341,timeInactiveMessage:_0x40e3a8,inactiveMessage:_0x4534e5,ratingMessage:_0x55f384,maxUseBotQueuesNPS:_0x30c01f,expiresTicketNPS:_0x4da2d2,whenExpiresTicket:_0x5261c0,expiresInactiveMessage:_0x10c2e2,importOldMessages:_0x3e0799,importRecentMessages:_0x264927,closedTicketsPostImported:_0x2ec906,importOldMessagesGroups:_0x42b8fc,groupAsTicket:_0x45ea41,timeCreateNewTicket:_0x11297e,schedules:_0x29afd6,promptId:_0x31a101}=_0x5478b5[_0x542561(0xa6)],{companyId:_0x3bf0d3}=_0x5478b5[_0x542561(0x7c)],_0x26ad4d=await(0x0,ShowCompanyService_1[_0x542561(0x82)])(_0x3bf0d3),_0x41592b=await(0x0,ShowPlanService_1['default'])(_0x26ad4d[_0x542561(0x89)]);if(!_0x41592b[_0x542561(0x98)])return _0x43cc83[_0x542561(0x6e)](0x190)[_0x542561(0x7d)]({'error':_0x542561(0x95)});const {whatsapp:_0xa6070d,oldDefaultWhatsapp:_0x4ddbaa}=await(0x0,CreateWhatsAppService_1[_0x542561(0x82)])({'name':_0x38a43c,'status':_0x46f37e,'isDefault':_0xef365b,'greetingMessage':_0x57146a,'complationMessage':_0x462447,'outOfHoursMessage':_0x2bd2c7,'queueIds':_0x386f43,'companyId':_0x3bf0d3,'token':_0xb2b997,'maxUseBotQueues':_0x13c1a1,'timeUseBotQueues':_0x5bc258,'expiresTicket':_0x2b0dc4,'allowGroup':_0x3ed26a,'timeSendQueue':_0x321e25,'sendIdQueue':_0x3ff341,'timeInactiveMessage':_0x40e3a8,'inactiveMessage':_0x4534e5,'ratingMessage':_0x55f384,'maxUseBotQueuesNPS':_0x30c01f,'expiresTicketNPS':_0x4da2d2,'whenExpiresTicket':_0x5261c0,'expiresInactiveMessage':_0x10c2e2,'importOldMessages':_0x3e0799,'importRecentMessages':_0x264927,'closedTicketsPostImported':_0x2ec906,'importOldMessagesGroups':_0x42b8fc,'groupAsTicket':_0x45ea41,'timeCreateNewTicket':_0x11297e,'schedules':_0x29afd6,'promptId':_0x31a101});(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0xa6070d,_0x3bf0d3);const _0x1c6933=(0x0,socket_1[_0x542561(0x69)])();return _0x1c6933['emit'](_0x542561(0x9d)+_0x3bf0d3+_0x542561(0x94),{'action':_0x542561(0x75),'whatsapp':_0xa6070d}),_0x4ddbaa&&_0x1c6933[_0x542561(0x9c)]('company-'+_0x3bf0d3+_0x542561(0x94),{'action':_0x542561(0x75),'whatsapp':_0x4ddbaa}),_0x43cc83[_0x542561(0x6e)](0xc8)[_0x542561(0x7d)](_0xa6070d);};exports[a42_0x34d9ce(0x90)]=store;const storeFacebook=async(_0x12a6f3,_0x272fcb)=>{const _0x3fd34e=a42_0x34d9ce;try{const {facebookUserId:_0xf11603,facebookUserToken:_0x4ba66a,addInstagram:_0x585410}=_0x12a6f3['body'],{companyId:_0x491ae5}=_0x12a6f3[_0x3fd34e(0x7c)],{data:_0x575543}=await(0x0,graphAPI_1['getPageProfile'])(_0xf11603,_0x4ba66a);if(_0x575543[_0x3fd34e(0xa1)]===0x0)return _0x272fcb[_0x3fd34e(0x6e)](0x190)[_0x3fd34e(0x7d)]({'error':'Facebook\x20page\x20not\x20found'});const _0x252444=(0x0,socket_1['getIO'])(),_0x25b2fb=[];for await(const _0x13f7b1 of _0x575543){const {name:_0x2ebfd9,access_token:_0x3143ab,id:_0x5321f9,instagram_business_account:_0x687bc4}=_0x13f7b1,_0x442ca3=await(0x0,graphAPI_1[_0x3fd34e(0xa2)])(_0x3143ab);if(_0x687bc4&&_0x585410){const {id:_0x169c4b,username:_0xf9bc68,name:_0x300711}=_0x687bc4;_0x25b2fb[_0x3fd34e(0x6c)]({'companyId':_0x491ae5,'name':'Insta\x20'+(_0xf9bc68||_0x300711),'facebookUserId':_0xf11603,'facebookPageUserId':_0x169c4b,'facebookUserToken':_0x442ca3,'tokenMeta':_0x4ba66a,'isDefault':![],'channel':_0x3fd34e(0x68),'status':'CONNECTED','greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x25b2fb[_0x3fd34e(0x6c)]({'companyId':_0x491ae5,'name':_0x2ebfd9,'facebookUserId':_0xf11603,'facebookPageUserId':_0x5321f9,'facebookUserToken':_0x442ca3,'tokenMeta':_0x4ba66a,'isDefault':![],'channel':'facebook','status':_0x3fd34e(0x83),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x3fd34e(0x7e)])(_0x5321f9,_0x442ca3);}!_0x687bc4&&(_0x25b2fb[_0x3fd34e(0x6c)]({'companyId':_0x491ae5,'name':_0x2ebfd9,'facebookUserId':_0xf11603,'facebookPageUserId':_0x5321f9,'facebookUserToken':_0x442ca3,'tokenMeta':_0x4ba66a,'isDefault':![],'channel':'facebook','status':_0x3fd34e(0x83),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x3fd34e(0x7e)])(_0x13f7b1['id'],_0x442ca3));}for await(const _0x2a005b of _0x25b2fb){const _0x129723=await Whatsapp_1[_0x3fd34e(0x82)]['findOne']({'where':{'facebookPageUserId':_0x2a005b['facebookPageUserId']}});_0x129723&&await _0x129723['update']({..._0x2a005b});if(!_0x129723){const {whatsapp:_0x1f2802}=await(0x0,CreateWhatsAppService_1['default'])(_0x2a005b);_0x252444[_0x3fd34e(0x9c)](_0x3fd34e(0x9d)+_0x491ae5+_0x3fd34e(0x94),{'action':_0x3fd34e(0x75),'whatsapp':_0x1f2802});}}return _0x272fcb[_0x3fd34e(0x6e)](0xc8);}catch(_0x378c14){return console[_0x3fd34e(0x81)](_0x378c14),_0x272fcb['status'](0x190)[_0x3fd34e(0x7d)]({'error':'Facebook\x20page\x20not\x20found'});}};exports[a42_0x34d9ce(0x8c)]=storeFacebook;const show=async(_0x3d7313,_0x3a3f92)=>{const _0x1a2a02=a42_0x34d9ce,{whatsappId:_0x342102}=_0x3d7313['params'],{companyId:_0x4cf9ff}=_0x3d7313['user'],{session:_0x438bab}=_0x3d7313[_0x1a2a02(0x77)],_0x197490=await(0x0,ShowWhatsAppService_1[_0x1a2a02(0x82)])(_0x342102,_0x4cf9ff,_0x438bab);return _0x3a3f92[_0x1a2a02(0x6e)](0xc8)[_0x1a2a02(0x7d)](_0x197490);};exports[a42_0x34d9ce(0x8f)]=show;const update=async(_0x12157b,_0x3f2a26)=>{const _0xc77baf=a42_0x34d9ce,{whatsappId:_0x18c300}=_0x12157b[_0xc77baf(0x6b)],_0xe79914=_0x12157b[_0xc77baf(0xa6)],{companyId:_0x2b0ad2}=_0x12157b['user'],{whatsapp:_0x5514a8,oldDefaultWhatsapp:_0x2eafe6}=await(0x0,UpdateWhatsAppService_1[_0xc77baf(0x82)])({'whatsappData':_0xe79914,'whatsappId':_0x18c300,'companyId':_0x2b0ad2}),_0x4420c4=(0x0,socket_1['getIO'])();return _0x4420c4[_0xc77baf(0x9c)](_0xc77baf(0x9d)+_0x2b0ad2+_0xc77baf(0x94),{'action':_0xc77baf(0x75),'whatsapp':_0x5514a8}),_0x2eafe6&&_0x4420c4[_0xc77baf(0x9c)](_0xc77baf(0x9d)+_0x2b0ad2+'-whatsapp',{'action':_0xc77baf(0x75),'whatsapp':_0x2eafe6}),_0x3f2a26[_0xc77baf(0x6e)](0xc8)[_0xc77baf(0x7d)](_0x5514a8);};exports[a42_0x34d9ce(0x75)]=update;const closedTickets=async(_0x396814,_0x40d4a7)=>{const _0x1dbb1b=a42_0x34d9ce,{whatsappId:_0x510315}=_0x396814['params'];return(0x0,ImportWhatsAppMessageService_1[_0x1dbb1b(0x76)])(_0x510315),_0x40d4a7[_0x1dbb1b(0x6e)](0xc8)['json']('whatsapp');};exports[a42_0x34d9ce(0x70)]=closedTickets;const remove=async(_0x54acf0,_0x358eae)=>{const _0x5bbe46=a42_0x34d9ce,{whatsappId:_0x130607}=_0x54acf0[_0x5bbe46(0x6b)],{companyId:_0x5258f2,profile:_0x4eaf74}=_0x54acf0['user'],_0x3a51b0=(0x0,socket_1[_0x5bbe46(0x69)])();if(_0x4eaf74!==_0x5bbe46(0x99))throw new AppError_1['default'](_0x5bbe46(0xa3),0x193);const _0x26d70d=await(0x0,ShowWhatsAppService_1['default'])(_0x130607,_0x5258f2);_0x26d70d[_0x5bbe46(0x97)]===_0x5bbe46(0x8e)&&(await(0x0,DeleteBaileysService_1['default'])(_0x130607),await(0x0,DeleteWhatsAppService_1[_0x5bbe46(0x82)])(_0x130607),await cache_1[_0x5bbe46(0x82)][_0x5bbe46(0x91)](_0x5bbe46(0x72)+_0x130607+':*'),(0x0,wbot_1[_0x5bbe46(0x93)])(+_0x130607),_0x3a51b0[_0x5bbe46(0x9c)](_0x5bbe46(0x9d)+_0x5258f2+_0x5bbe46(0x94),{'action':_0x5bbe46(0xa0),'whatsappId':+_0x130607}));if(_0x26d70d[_0x5bbe46(0x97)]==='facebook'||_0x26d70d[_0x5bbe46(0x97)]===_0x5bbe46(0x68)){const {facebookUserToken:_0xea502f}=_0x26d70d,_0xdcb521=await Whatsapp_1[_0x5bbe46(0x82)][_0x5bbe46(0x74)]({'where':{'facebookUserToken':_0xea502f}});await Whatsapp_1['default'][_0x5bbe46(0x9e)]({'where':{'facebookUserToken':_0xea502f}});for await(const _0x4607f0 of _0xdcb521){_0x3a51b0[_0x5bbe46(0x9c)](_0x5bbe46(0x9d)+_0x5258f2+_0x5bbe46(0x94),{'action':_0x5bbe46(0xa0),'whatsappId':_0x4607f0['id']});}}return _0x358eae[_0x5bbe46(0x6e)](0xc8)['json']({'message':_0x5bbe46(0x9f)});};exports[a42_0x34d9ce(0x7b)]=remove;const restart=async(_0x49d374,_0x380741)=>{const _0x5be299=a42_0x34d9ce,{companyId:_0x1ce393,profile:_0x546d07}=_0x49d374['user'];if(_0x546d07!=='admin')throw new AppError_1['default']('ERR_NO_PERMISSION',0x193);return await(0x0,wbot_1[_0x5be299(0x6a)])(_0x1ce393),_0x380741['status'](0xc8)[_0x5be299(0x7d)]({'message':_0x5be299(0x84)});};exports[a42_0x34d9ce(0x80)]=restart;
>>>>>>> ab722bfbcf394d74dd0b99a984c0dcf6ffbcff7f
