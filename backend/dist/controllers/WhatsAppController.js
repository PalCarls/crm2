'use strict';const a40_0x16f010=a40_0x2f52;function a40_0x2f52(_0x2ff15e,_0x4581b3){const _0x49dd69=a40_0x49dd();return a40_0x2f52=function(_0x2f5218,_0x1b4fcf){_0x2f5218=_0x2f5218-0xb5;let _0x2f2440=_0x49dd69[_0x2f5218];return _0x2f2440;},a40_0x2f52(_0x2ff15e,_0x4581b3);}(function(_0x3a7c2a,_0x554998){const _0x411476=a40_0x2f52,_0x858b88=_0x3a7c2a();while(!![]){try{const _0x12bfc2=-parseInt(_0x411476(0xb6))/0x1*(parseInt(_0x411476(0xd4))/0x2)+-parseInt(_0x411476(0xee))/0x3+parseInt(_0x411476(0xe2))/0x4+parseInt(_0x411476(0xf1))/0x5*(parseInt(_0x411476(0xcd))/0x6)+-parseInt(_0x411476(0xbf))/0x7+parseInt(_0x411476(0xe0))/0x8*(-parseInt(_0x411476(0xbc))/0x9)+parseInt(_0x411476(0xb7))/0xa;if(_0x12bfc2===_0x554998)break;else _0x858b88['push'](_0x858b88['shift']());}catch(_0x3efb64){_0x858b88['push'](_0x858b88['shift']());}}}(a40_0x49dd,0x885da));var __importDefault=this&&this[a40_0x16f010(0xf9)]||function(_0x32f8de){const _0x544807=a40_0x16f010;return _0x32f8de&&_0x32f8de[_0x544807(0xd5)]?_0x32f8de:{'default':_0x32f8de};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['restart']=exports['remove']=exports[a40_0x16f010(0xd2)]=exports[a40_0x16f010(0xf8)]=exports['show']=exports[a40_0x16f010(0xe1)]=exports[a40_0x16f010(0xc0)]=exports[a40_0x16f010(0xe7)]=void 0x0;function a40_0x49dd(){const _0x2d7913=['restart','remove','useWhatsapp','138008zKFfFi','storeFacebook','1548188vFSjhg','delFromPattern','status','CONNECTED','sessions:','index','../services/WhatsappService/ShowWhatsAppService','whatsapp','../services/WbotServices/StartWhatsAppSession','channel','ERR_NO_PERMISSION','../libs/socket','148239lpzFfl','../services/WhatsappService/ListWhatsAppsService','delete','13590WrXdDd','findAll','getPageProfile','getIO','StartWhatsAppSession','push','query','update','__importDefault','Insta\x20','910409UKAJzT','13344230ntiqwl','default','-whatsapp','facebookPageUserId','closeTicketsImported','261JvWvsZ','facebook','../services/CompanyService/ShowCompanyService','3151855HnhwBg','store','user','removeWbot','json','company-','emit','instagram','../errors/AppError','../services/BaileysServices/DeleteBaileysService','show','subscribeApp','../models/Whatsapp','../libs/cache','1650jhCZgR','Facebook\x20page\x20not\x20found','Whatsapp\x20restart.','params','destroy','closedTickets','getAccessTokenFromPage','2WgiSCv','__esModule','body','planId','../services/PlanService/ShowPlanService','findOne','../services/WhatsappService/DeleteWhatsAppService','log','admin'];a40_0x49dd=function(){return _0x2d7913;};return a40_0x49dd();}const socket_1=require(a40_0x16f010(0xed)),cache_1=__importDefault(require(a40_0x16f010(0xcc))),wbot_1=require('../libs/wbot'),Whatsapp_1=__importDefault(require(a40_0x16f010(0xcb))),AppError_1=__importDefault(require(a40_0x16f010(0xc7))),DeleteBaileysService_1=__importDefault(require(a40_0x16f010(0xc8))),ShowCompanyService_1=__importDefault(require(a40_0x16f010(0xbe))),graphAPI_1=require('../services/FacebookServices/graphAPI'),ShowPlanService_1=__importDefault(require(a40_0x16f010(0xd8))),StartWhatsAppSession_1=require(a40_0x16f010(0xea)),CreateWhatsAppService_1=__importDefault(require('../services/WhatsappService/CreateWhatsAppService')),DeleteWhatsAppService_1=__importDefault(require(a40_0x16f010(0xda))),ListWhatsAppsService_1=__importDefault(require(a40_0x16f010(0xef))),ShowWhatsAppService_1=__importDefault(require(a40_0x16f010(0xe8))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),ImportWhatsAppMessageService_1=require('../services/WhatsappService/ImportWhatsAppMessageService'),index=async(_0x40b5e6,_0x224828)=>{const _0x52a7ec=a40_0x16f010,{companyId:_0x149905}=_0x40b5e6[_0x52a7ec(0xc1)],{session:_0x4d68d9}=_0x40b5e6[_0x52a7ec(0xf7)],_0x452668=await(0x0,ListWhatsAppsService_1[_0x52a7ec(0xb8)])({'companyId':_0x149905,'session':_0x4d68d9});return _0x224828[_0x52a7ec(0xe4)](0xc8)[_0x52a7ec(0xc3)](_0x452668);};exports[a40_0x16f010(0xe7)]=index;const store=async(_0x96917e,_0x5731d7)=>{const _0x218336=a40_0x16f010,{name:_0x15077e,status:_0x3d8f40,isDefault:_0x8901e2,greetingMessage:_0xc492b7,complationMessage:_0xbe4bca,outOfHoursMessage:_0x4bac13,queueIds:_0x9eee49,token:_0x3bb477,maxUseBotQueues:_0x564ce6,timeUseBotQueues:_0x44af7a,expiresTicket:_0x236a5b,allowGroup:_0x1ad366,timeSendQueue:_0x2166b8,sendIdQueue:_0x1ff6a3,timeInactiveMessage:_0x346e13,inactiveMessage:_0x1094ae,ratingMessage:_0x2a75db,maxUseBotQueuesNPS:_0x41fbda,expiresTicketNPS:_0x15f58e,whenExpiresTicket:_0x1cc3ff,expiresInactiveMessage:_0x4b2caf,importOldMessages:_0x73112d,importRecentMessages:_0x403354,closedTicketsPostImported:_0x11e9a3,importOldMessagesGroups:_0x39107a,groupAsTicket:_0x3e76d7,timeCreateNewTicket:_0x5159ee,schedules:_0x37c2f1}=_0x96917e['body'],{companyId:_0x4de96e}=_0x96917e['user'],_0x1cbe13=await(0x0,ShowCompanyService_1[_0x218336(0xb8)])(_0x4de96e),_0x558779=await(0x0,ShowPlanService_1[_0x218336(0xb8)])(_0x1cbe13[_0x218336(0xd7)]);if(!_0x558779[_0x218336(0xdf)])return _0x5731d7[_0x218336(0xe4)](0x190)['json']({'error':'Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!'});const {whatsapp:_0x3f3ba3,oldDefaultWhatsapp:_0x271bf2}=await(0x0,CreateWhatsAppService_1[_0x218336(0xb8)])({'name':_0x15077e,'status':_0x3d8f40,'isDefault':_0x8901e2,'greetingMessage':_0xc492b7,'complationMessage':_0xbe4bca,'outOfHoursMessage':_0x4bac13,'queueIds':_0x9eee49,'companyId':_0x4de96e,'token':_0x3bb477,'maxUseBotQueues':_0x564ce6,'timeUseBotQueues':_0x44af7a,'expiresTicket':_0x236a5b,'allowGroup':_0x1ad366,'timeSendQueue':_0x2166b8,'sendIdQueue':_0x1ff6a3,'timeInactiveMessage':_0x346e13,'inactiveMessage':_0x1094ae,'ratingMessage':_0x2a75db,'maxUseBotQueuesNPS':_0x41fbda,'expiresTicketNPS':_0x15f58e,'whenExpiresTicket':_0x1cc3ff,'expiresInactiveMessage':_0x4b2caf,'importOldMessages':_0x73112d,'importRecentMessages':_0x403354,'closedTicketsPostImported':_0x11e9a3,'importOldMessagesGroups':_0x39107a,'groupAsTicket':_0x3e76d7,'timeCreateNewTicket':_0x5159ee,'schedules':_0x37c2f1});(0x0,StartWhatsAppSession_1[_0x218336(0xf5)])(_0x3f3ba3,_0x4de96e);const _0x337fb7=(0x0,socket_1[_0x218336(0xf4)])();return _0x337fb7['emit']('company-'+_0x4de96e+_0x218336(0xb9),{'action':'update','whatsapp':_0x3f3ba3}),_0x271bf2&&_0x337fb7[_0x218336(0xc5)](_0x218336(0xc4)+_0x4de96e+'-whatsapp',{'action':'update','whatsapp':_0x271bf2}),_0x5731d7[_0x218336(0xe4)](0xc8)['json'](_0x3f3ba3);};exports[a40_0x16f010(0xc0)]=store;const storeFacebook=async(_0x23783e,_0x3ba874)=>{const _0x2018e7=a40_0x16f010;try{const {facebookUserId:_0x438378,facebookUserToken:_0x3b6d85,addInstagram:_0x17f644}=_0x23783e[_0x2018e7(0xd6)],{companyId:_0x566991}=_0x23783e[_0x2018e7(0xc1)],{data:_0x259699}=await(0x0,graphAPI_1[_0x2018e7(0xf3)])(_0x438378,_0x3b6d85);if(_0x259699['length']===0x0)return _0x3ba874['status'](0x190)['json']({'error':_0x2018e7(0xce)});const _0x4c0dbc=(0x0,socket_1['getIO'])(),_0x4b03dc=[];for await(const _0x56b225 of _0x259699){const {name:_0x2fb28b,access_token:_0x48bfbc,id:_0x49f53d,instagram_business_account:_0x640895}=_0x56b225,_0x9d344=await(0x0,graphAPI_1[_0x2018e7(0xd3)])(_0x48bfbc);if(_0x640895&&_0x17f644){const {id:_0x530a73,username:_0x4a613a,name:_0x3ea064}=_0x640895;_0x4b03dc[_0x2018e7(0xf6)]({'companyId':_0x566991,'name':_0x2018e7(0xb5)+(_0x4a613a||_0x3ea064),'facebookUserId':_0x438378,'facebookPageUserId':_0x530a73,'facebookUserToken':_0x9d344,'tokenMeta':_0x3b6d85,'isDefault':![],'channel':'instagram','status':_0x2018e7(0xe5),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x4b03dc[_0x2018e7(0xf6)]({'companyId':_0x566991,'name':_0x2fb28b,'facebookUserId':_0x438378,'facebookPageUserId':_0x49f53d,'facebookUserToken':_0x9d344,'tokenMeta':_0x3b6d85,'isDefault':![],'channel':_0x2018e7(0xbd),'status':_0x2018e7(0xe5),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x2018e7(0xca)])(_0x49f53d,_0x9d344);}!_0x640895&&(_0x4b03dc['push']({'companyId':_0x566991,'name':_0x2fb28b,'facebookUserId':_0x438378,'facebookPageUserId':_0x49f53d,'facebookUserToken':_0x9d344,'tokenMeta':_0x3b6d85,'isDefault':![],'channel':_0x2018e7(0xbd),'status':_0x2018e7(0xe5),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1['subscribeApp'])(_0x56b225['id'],_0x9d344));}for await(const _0x439b0f of _0x4b03dc){const _0x5aeec4=await Whatsapp_1[_0x2018e7(0xb8)][_0x2018e7(0xd9)]({'where':{'facebookPageUserId':_0x439b0f[_0x2018e7(0xba)]}});_0x5aeec4&&await _0x5aeec4[_0x2018e7(0xf8)]({..._0x439b0f});if(!_0x5aeec4){const {whatsapp:_0xcd0387}=await(0x0,CreateWhatsAppService_1[_0x2018e7(0xb8)])(_0x439b0f);_0x4c0dbc[_0x2018e7(0xc5)]('company-'+_0x566991+_0x2018e7(0xb9),{'action':_0x2018e7(0xf8),'whatsapp':_0xcd0387});}}return _0x3ba874[_0x2018e7(0xe4)](0xc8);}catch(_0x3421ee){return console[_0x2018e7(0xdb)](_0x3421ee),_0x3ba874[_0x2018e7(0xe4)](0x190)[_0x2018e7(0xc3)]({'error':_0x2018e7(0xce)});}};exports[a40_0x16f010(0xe1)]=storeFacebook;const show=async(_0x59e4bb,_0x5e67e5)=>{const _0x4e05fd=a40_0x16f010,{whatsappId:_0x4c61d5}=_0x59e4bb[_0x4e05fd(0xd0)],{companyId:_0x461f84}=_0x59e4bb[_0x4e05fd(0xc1)],{session:_0x32663d}=_0x59e4bb[_0x4e05fd(0xf7)],_0x391dfd=await(0x0,ShowWhatsAppService_1['default'])(_0x4c61d5,_0x461f84,_0x32663d);return _0x5e67e5[_0x4e05fd(0xe4)](0xc8)['json'](_0x391dfd);};exports[a40_0x16f010(0xc9)]=show;const update=async(_0xa31902,_0x1d51ad)=>{const _0x4a213=a40_0x16f010,{whatsappId:_0x207d63}=_0xa31902[_0x4a213(0xd0)],_0x4d6fca=_0xa31902['body'],{companyId:_0x4624fe}=_0xa31902[_0x4a213(0xc1)],{whatsapp:_0x3fba5a,oldDefaultWhatsapp:_0x125914}=await(0x0,UpdateWhatsAppService_1[_0x4a213(0xb8)])({'whatsappData':_0x4d6fca,'whatsappId':_0x207d63,'companyId':_0x4624fe}),_0x3c1a14=(0x0,socket_1['getIO'])();return _0x3c1a14[_0x4a213(0xc5)](_0x4a213(0xc4)+_0x4624fe+_0x4a213(0xb9),{'action':'update','whatsapp':_0x3fba5a}),_0x125914&&_0x3c1a14[_0x4a213(0xc5)](_0x4a213(0xc4)+_0x4624fe+'-whatsapp',{'action':'update','whatsapp':_0x125914}),_0x1d51ad['status'](0xc8)[_0x4a213(0xc3)](_0x3fba5a);};exports[a40_0x16f010(0xf8)]=update;const closedTickets=async(_0x20fe37,_0x5d16f5)=>{const _0x577ae9=a40_0x16f010,{whatsappId:_0x431849}=_0x20fe37[_0x577ae9(0xd0)];return(0x0,ImportWhatsAppMessageService_1[_0x577ae9(0xbb)])(_0x431849),_0x5d16f5['status'](0xc8)[_0x577ae9(0xc3)](_0x577ae9(0xe9));};exports[a40_0x16f010(0xd2)]=closedTickets;const remove=async(_0x5e37ac,_0x2ad6bb)=>{const _0x1b79c0=a40_0x16f010,{whatsappId:_0x178522}=_0x5e37ac[_0x1b79c0(0xd0)],{companyId:_0x27aa13,profile:_0x1d828f}=_0x5e37ac[_0x1b79c0(0xc1)],_0x5653a0=(0x0,socket_1[_0x1b79c0(0xf4)])();if(_0x1d828f!==_0x1b79c0(0xdc))throw new AppError_1[(_0x1b79c0(0xb8))](_0x1b79c0(0xec),0x193);const _0x2d8d81=await(0x0,ShowWhatsAppService_1[_0x1b79c0(0xb8)])(_0x178522,_0x27aa13);_0x2d8d81['channel']==='whatsapp'&&(await(0x0,DeleteBaileysService_1[_0x1b79c0(0xb8)])(_0x178522),await(0x0,DeleteWhatsAppService_1[_0x1b79c0(0xb8)])(_0x178522),await cache_1[_0x1b79c0(0xb8)][_0x1b79c0(0xe3)](_0x1b79c0(0xe6)+_0x178522+':*'),(0x0,wbot_1[_0x1b79c0(0xc2)])(+_0x178522),_0x5653a0[_0x1b79c0(0xc5)](_0x1b79c0(0xc4)+_0x27aa13+_0x1b79c0(0xb9),{'action':_0x1b79c0(0xf0),'whatsappId':+_0x178522}));if(_0x2d8d81['channel']===_0x1b79c0(0xbd)||_0x2d8d81[_0x1b79c0(0xeb)]===_0x1b79c0(0xc6)){const {facebookUserToken:_0x4dbb4b}=_0x2d8d81,_0x6ff091=await Whatsapp_1[_0x1b79c0(0xb8)][_0x1b79c0(0xf2)]({'where':{'facebookUserToken':_0x4dbb4b}});await Whatsapp_1['default'][_0x1b79c0(0xd1)]({'where':{'facebookUserToken':_0x4dbb4b}});for await(const _0x148c7e of _0x6ff091){_0x5653a0['emit'](_0x1b79c0(0xc4)+_0x27aa13+_0x1b79c0(0xb9),{'action':'delete','whatsappId':_0x148c7e['id']});}}return _0x2ad6bb[_0x1b79c0(0xe4)](0xc8)[_0x1b79c0(0xc3)]({'message':'Session\x20disconnected.'});};exports[a40_0x16f010(0xde)]=remove;const restart=async(_0x5b5c4e,_0x52902f)=>{const _0x59cd57=a40_0x16f010,{companyId:_0x427a3,profile:_0x4cf95f}=_0x5b5c4e[_0x59cd57(0xc1)];if(_0x4cf95f!==_0x59cd57(0xdc))throw new AppError_1[(_0x59cd57(0xb8))](_0x59cd57(0xec),0x193);return await(0x0,wbot_1['restartWbot'])(_0x427a3),_0x52902f[_0x59cd57(0xe4)](0xc8)[_0x59cd57(0xc3)]({'message':_0x59cd57(0xcf)});};exports[a40_0x16f010(0xdd)]=restart;