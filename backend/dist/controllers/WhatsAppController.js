'use strict';const a39_0x4f75d6=a39_0x4299;(function(_0x11c43f,_0x16ce89){const _0x5e1b90=a39_0x4299,_0x5abd57=_0x11c43f();while(!![]){try{const _0x9ceb85=parseInt(_0x5e1b90(0xd6))/0x1*(-parseInt(_0x5e1b90(0xd0))/0x2)+-parseInt(_0x5e1b90(0xc4))/0x3*(parseInt(_0x5e1b90(0xbb))/0x4)+-parseInt(_0x5e1b90(0xc9))/0x5+-parseInt(_0x5e1b90(0xdc))/0x6+parseInt(_0x5e1b90(0xe0))/0x7+-parseInt(_0x5e1b90(0xe3))/0x8+parseInt(_0x5e1b90(0xdb))/0x9*(parseInt(_0x5e1b90(0xaf))/0xa);if(_0x9ceb85===_0x16ce89)break;else _0x5abd57['push'](_0x5abd57['shift']());}catch(_0x392e9a){_0x5abd57['push'](_0x5abd57['shift']());}}}(a39_0x2f6b,0x4837c));var __importDefault=this&&this[a39_0x4f75d6(0xed)]||function(_0x57ebfe){const _0x30323a=a39_0x4f75d6;return _0x57ebfe&&_0x57ebfe[_0x30323a(0xc6)]?_0x57ebfe:{'default':_0x57ebfe};};Object[a39_0x4f75d6(0xbe)](exports,'__esModule',{'value':!![]}),exports[a39_0x4f75d6(0xbd)]=exports[a39_0x4f75d6(0xb8)]=exports[a39_0x4f75d6(0xcf)]=exports[a39_0x4f75d6(0xbc)]=exports[a39_0x4f75d6(0xce)]=exports[a39_0x4f75d6(0xb2)]=exports['store']=exports[a39_0x4f75d6(0xc2)]=void 0x0;function a39_0x4299(_0x5a0ed5,_0x57e180){const _0x2f6bec=a39_0x2f6b();return a39_0x4299=function(_0x42991c,_0x273a8c){_0x42991c=_0x42991c-0xac;let _0x5e67a7=_0x2f6bec[_0x42991c];return _0x5e67a7;},a39_0x4299(_0x5a0ed5,_0x57e180);}const socket_1=require(a39_0x4f75d6(0xd7)),cache_1=__importDefault(require(a39_0x4f75d6(0xb5))),wbot_1=require(a39_0x4f75d6(0xc5)),Whatsapp_1=__importDefault(require(a39_0x4f75d6(0xd3))),AppError_1=__importDefault(require(a39_0x4f75d6(0xe1))),DeleteBaileysService_1=__importDefault(require(a39_0x4f75d6(0xec))),ShowCompanyService_1=__importDefault(require('../services/CompanyService/ShowCompanyService')),graphAPI_1=require(a39_0x4f75d6(0xb4)),ShowPlanService_1=__importDefault(require(a39_0x4f75d6(0xe9))),StartWhatsAppSession_1=require(a39_0x4f75d6(0xdf)),CreateWhatsAppService_1=__importDefault(require('../services/WhatsappService/CreateWhatsAppService')),DeleteWhatsAppService_1=__importDefault(require(a39_0x4f75d6(0xb1))),ListWhatsAppsService_1=__importDefault(require('../services/WhatsappService/ListWhatsAppsService')),ShowWhatsAppService_1=__importDefault(require(a39_0x4f75d6(0xae))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),ImportWhatsAppMessageService_1=require(a39_0x4f75d6(0xde)),index=async(_0x37ac39,_0x5b4938)=>{const _0x3ae7a2=a39_0x4f75d6,{companyId:_0x3d28e8}=_0x37ac39['user'],{session:_0x4922cd}=_0x37ac39[_0x3ae7a2(0xbf)],_0x3f47a3=await(0x0,ListWhatsAppsService_1['default'])({'companyId':_0x3d28e8,'session':_0x4922cd});return _0x5b4938[_0x3ae7a2(0xca)](0xc8)['json'](_0x3f47a3);};function a39_0x2f6b(){const _0x1a898e=['length','delFromPattern','params','show','closedTickets','216374aWbkBW','push','facebook','../models/Whatsapp','default','useWhatsapp','5QwKCPL','../libs/socket','emit','StartWhatsAppSession','company-','631206PIZbIi','2964714mdMuFs','getIO','../services/WhatsappService/ImportWhatsAppMessageService','../services/WbotServices/StartWhatsAppSession','101689QWyQQU','../errors/AppError','Facebook\x20page\x20not\x20found','1716768tVlzrf','sessions:','delete','json','findAll','instagram','../services/PlanService/ShowPlanService','CONNECTED','admin','../services/BaileysServices/DeleteBaileysService','__importDefault','whatsapp','-whatsapp','../services/WhatsappService/ShowWhatsAppService','320zjpEsC','log','../services/WhatsappService/DeleteWhatsAppService','storeFacebook','subscribeApp','../services/FacebookServices/graphAPI','../libs/cache','restartWbot','Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!','remove','getPageProfile','store','279536XVsMgJ','update','restart','defineProperty','query','body','Session\x20disconnected.','index','user','9lSSkjt','../libs/wbot','__esModule','channel','removeWbot','2518545bFjRrL','status'];a39_0x2f6b=function(){return _0x1a898e;};return a39_0x2f6b();}exports[a39_0x4f75d6(0xc2)]=index;const store=async(_0x3b9634,_0x21ce91)=>{const _0x6fdf8f=a39_0x4f75d6,{name:_0xc01bd4,status:_0x5efb97,isDefault:_0xdb39,greetingMessage:_0x3af8aa,complationMessage:_0xf0a9b1,outOfHoursMessage:_0x527e2a,queueIds:_0x148b92,token:_0x4b5760,maxUseBotQueues:_0x3598e1,timeUseBotQueues:_0x5e5427,expiresTicket:_0x29756e,allowGroup:_0x442001,timeSendQueue:_0x584f5a,sendIdQueue:_0x204bb1,timeInactiveMessage:_0x43c185,inactiveMessage:_0x5e921,ratingMessage:_0x16b7ab,maxUseBotQueuesNPS:_0xceaa62,expiresTicketNPS:_0x188f85,whenExpiresTicket:_0x6fd92e,expiresInactiveMessage:_0x4cb49b,importOldMessages:_0x97858c,importRecentMessages:_0x3bdb9e,closedTicketsPostImported:_0x3bc942,importOldMessagesGroups:_0x3c8821,groupAsTicket:_0x1a35c2,timeCreateNewTicket:_0x48aed9}=_0x3b9634[_0x6fdf8f(0xc0)],{companyId:_0xfa94d1}=_0x3b9634[_0x6fdf8f(0xc3)],_0x4f20bf=await(0x0,ShowCompanyService_1[_0x6fdf8f(0xd4)])(_0xfa94d1),_0x2e43a6=await(0x0,ShowPlanService_1['default'])(_0x4f20bf['planId']);if(!_0x2e43a6[_0x6fdf8f(0xd5)])return _0x21ce91[_0x6fdf8f(0xca)](0x190)['json']({'error':_0x6fdf8f(0xb7)});const {whatsapp:_0x472093,oldDefaultWhatsapp:_0x42632c}=await(0x0,CreateWhatsAppService_1[_0x6fdf8f(0xd4)])({'name':_0xc01bd4,'status':_0x5efb97,'isDefault':_0xdb39,'greetingMessage':_0x3af8aa,'complationMessage':_0xf0a9b1,'outOfHoursMessage':_0x527e2a,'queueIds':_0x148b92,'companyId':_0xfa94d1,'token':_0x4b5760,'maxUseBotQueues':_0x3598e1,'timeUseBotQueues':_0x5e5427,'expiresTicket':_0x29756e,'allowGroup':_0x442001,'timeSendQueue':_0x584f5a,'sendIdQueue':_0x204bb1,'timeInactiveMessage':_0x43c185,'inactiveMessage':_0x5e921,'ratingMessage':_0x16b7ab,'maxUseBotQueuesNPS':_0xceaa62,'expiresTicketNPS':_0x188f85,'whenExpiresTicket':_0x6fd92e,'expiresInactiveMessage':_0x4cb49b,'importOldMessages':_0x97858c,'importRecentMessages':_0x3bdb9e,'closedTicketsPostImported':_0x3bc942,'importOldMessagesGroups':_0x3c8821,'groupAsTicket':_0x1a35c2,'timeCreateNewTicket':_0x48aed9});(0x0,StartWhatsAppSession_1[_0x6fdf8f(0xd9)])(_0x472093,_0xfa94d1);const _0x4b5132=(0x0,socket_1[_0x6fdf8f(0xdd)])();return _0x4b5132[_0x6fdf8f(0xd8)](_0x6fdf8f(0xda)+_0xfa94d1+'-whatsapp',{'action':'update','whatsapp':_0x472093}),_0x42632c&&_0x4b5132[_0x6fdf8f(0xd8)](_0x6fdf8f(0xda)+_0xfa94d1+_0x6fdf8f(0xad),{'action':_0x6fdf8f(0xbc),'whatsapp':_0x42632c}),_0x21ce91[_0x6fdf8f(0xca)](0xc8)[_0x6fdf8f(0xe6)](_0x472093);};exports[a39_0x4f75d6(0xba)]=store;const storeFacebook=async(_0x185cba,_0x10fb93)=>{const _0x4861fe=a39_0x4f75d6;try{const {facebookUserId:_0x550861,facebookUserToken:_0x563eb6,addInstagram:_0x251875}=_0x185cba[_0x4861fe(0xc0)],{companyId:_0xd1a1d5}=_0x185cba['user'],{data:_0x5c99ac}=await(0x0,graphAPI_1[_0x4861fe(0xb9)])(_0x550861,_0x563eb6);if(_0x5c99ac[_0x4861fe(0xcb)]===0x0)return _0x10fb93[_0x4861fe(0xca)](0x190)[_0x4861fe(0xe6)]({'error':_0x4861fe(0xe2)});const _0x176a7e=(0x0,socket_1[_0x4861fe(0xdd)])(),_0xd9d082=[];for await(const _0x21d88f of _0x5c99ac){const {name:_0x446042,access_token:_0x251477,id:_0x4deadc,instagram_business_account:_0x18d861}=_0x21d88f,_0x31b2ed=await(0x0,graphAPI_1['getAccessTokenFromPage'])(_0x251477);if(_0x18d861&&_0x251875){const {id:_0x2d980b,username:_0x1442e5,name:_0x16277b}=_0x18d861;_0xd9d082[_0x4861fe(0xd1)]({'companyId':_0xd1a1d5,'name':'Insta\x20'+(_0x1442e5||_0x16277b),'facebookUserId':_0x550861,'facebookPageUserId':_0x2d980b,'facebookUserToken':_0x31b2ed,'tokenMeta':_0x563eb6,'isDefault':![],'channel':_0x4861fe(0xe8),'status':_0x4861fe(0xea),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0xd9d082[_0x4861fe(0xd1)]({'companyId':_0xd1a1d5,'name':_0x446042,'facebookUserId':_0x550861,'facebookPageUserId':_0x4deadc,'facebookUserToken':_0x31b2ed,'tokenMeta':_0x563eb6,'isDefault':![],'channel':'facebook','status':_0x4861fe(0xea),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1['subscribeApp'])(_0x4deadc,_0x31b2ed);}!_0x18d861&&(_0xd9d082[_0x4861fe(0xd1)]({'companyId':_0xd1a1d5,'name':_0x446042,'facebookUserId':_0x550861,'facebookPageUserId':_0x4deadc,'facebookUserToken':_0x31b2ed,'tokenMeta':_0x563eb6,'isDefault':![],'channel':_0x4861fe(0xd2),'status':_0x4861fe(0xea),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x4861fe(0xb3)])(_0x21d88f['id'],_0x31b2ed));}for await(const _0x5e7b97 of _0xd9d082){const _0x2652ff=await Whatsapp_1[_0x4861fe(0xd4)]['findOne']({'where':{'facebookPageUserId':_0x5e7b97['facebookPageUserId']}});_0x2652ff&&await _0x2652ff['update']({..._0x5e7b97});if(!_0x2652ff){const {whatsapp:_0x2965fc}=await(0x0,CreateWhatsAppService_1[_0x4861fe(0xd4)])(_0x5e7b97);_0x176a7e[_0x4861fe(0xd8)](_0x4861fe(0xda)+_0xd1a1d5+_0x4861fe(0xad),{'action':_0x4861fe(0xbc),'whatsapp':_0x2965fc});}}return _0x10fb93[_0x4861fe(0xca)](0xc8);}catch(_0x459be4){return console[_0x4861fe(0xb0)](_0x459be4),_0x10fb93[_0x4861fe(0xca)](0x190)[_0x4861fe(0xe6)]({'error':_0x4861fe(0xe2)});}};exports['storeFacebook']=storeFacebook;const show=async(_0x432f9b,_0x51849b)=>{const _0x5bd2e9=a39_0x4f75d6,{whatsappId:_0x490a1a}=_0x432f9b['params'],{companyId:_0x2c2d98}=_0x432f9b[_0x5bd2e9(0xc3)],{session:_0x449e27}=_0x432f9b[_0x5bd2e9(0xbf)],_0x31110e=await(0x0,ShowWhatsAppService_1[_0x5bd2e9(0xd4)])(_0x490a1a,_0x2c2d98,_0x449e27);return _0x51849b[_0x5bd2e9(0xca)](0xc8)[_0x5bd2e9(0xe6)](_0x31110e);};exports[a39_0x4f75d6(0xce)]=show;const update=async(_0x320c1c,_0x21d5e0)=>{const _0x4780c4=a39_0x4f75d6,{whatsappId:_0x243e66}=_0x320c1c[_0x4780c4(0xcd)],_0x5be112=_0x320c1c['body'],{companyId:_0x2bf82b}=_0x320c1c[_0x4780c4(0xc3)],{whatsapp:_0x2f0c8c,oldDefaultWhatsapp:_0x555232}=await(0x0,UpdateWhatsAppService_1['default'])({'whatsappData':_0x5be112,'whatsappId':_0x243e66,'companyId':_0x2bf82b}),_0x7bbc5b=(0x0,socket_1[_0x4780c4(0xdd)])();return _0x7bbc5b[_0x4780c4(0xd8)](_0x4780c4(0xda)+_0x2bf82b+'-whatsapp',{'action':_0x4780c4(0xbc),'whatsapp':_0x2f0c8c}),_0x555232&&_0x7bbc5b[_0x4780c4(0xd8)](_0x4780c4(0xda)+_0x2bf82b+_0x4780c4(0xad),{'action':_0x4780c4(0xbc),'whatsapp':_0x555232}),_0x21d5e0[_0x4780c4(0xca)](0xc8)[_0x4780c4(0xe6)](_0x2f0c8c);};exports[a39_0x4f75d6(0xbc)]=update;const closedTickets=async(_0x19f302,_0x4e8544)=>{const _0x44cb46=a39_0x4f75d6,{whatsappId:_0x548271}=_0x19f302[_0x44cb46(0xcd)];return(0x0,ImportWhatsAppMessageService_1['closeTicketsImported'])(_0x548271),_0x4e8544[_0x44cb46(0xca)](0xc8)[_0x44cb46(0xe6)](_0x44cb46(0xac));};exports['closedTickets']=closedTickets;const remove=async(_0x29eaf6,_0x4db388)=>{const _0xc55ed3=a39_0x4f75d6,{whatsappId:_0x1fdf87}=_0x29eaf6[_0xc55ed3(0xcd)],{companyId:_0x5bb1c9,profile:_0x51f470}=_0x29eaf6[_0xc55ed3(0xc3)],_0x2fd29a=(0x0,socket_1[_0xc55ed3(0xdd)])();if(_0x51f470!=='admin')throw new AppError_1[(_0xc55ed3(0xd4))]('ERR_NO_PERMISSION',0x193);const _0x588e33=await(0x0,ShowWhatsAppService_1[_0xc55ed3(0xd4)])(_0x1fdf87,_0x5bb1c9);_0x588e33[_0xc55ed3(0xc7)]===_0xc55ed3(0xac)&&(await(0x0,DeleteBaileysService_1[_0xc55ed3(0xd4)])(_0x1fdf87),await(0x0,DeleteWhatsAppService_1[_0xc55ed3(0xd4)])(_0x1fdf87),await cache_1[_0xc55ed3(0xd4)][_0xc55ed3(0xcc)](_0xc55ed3(0xe4)+_0x1fdf87+':*'),(0x0,wbot_1[_0xc55ed3(0xc8)])(+_0x1fdf87),_0x2fd29a[_0xc55ed3(0xd8)](_0xc55ed3(0xda)+_0x5bb1c9+_0xc55ed3(0xad),{'action':_0xc55ed3(0xe5),'whatsappId':+_0x1fdf87}));if(_0x588e33[_0xc55ed3(0xc7)]===_0xc55ed3(0xd2)||_0x588e33['channel']===_0xc55ed3(0xe8)){const {facebookUserToken:_0x2546d8}=_0x588e33,_0x51d043=await Whatsapp_1['default'][_0xc55ed3(0xe7)]({'where':{'facebookUserToken':_0x2546d8}});await Whatsapp_1[_0xc55ed3(0xd4)]['destroy']({'where':{'facebookUserToken':_0x2546d8}});for await(const _0x5991aa of _0x51d043){_0x2fd29a[_0xc55ed3(0xd8)](_0xc55ed3(0xda)+_0x5bb1c9+_0xc55ed3(0xad),{'action':_0xc55ed3(0xe5),'whatsappId':_0x5991aa['id']});}}return _0x4db388['status'](0xc8)[_0xc55ed3(0xe6)]({'message':_0xc55ed3(0xc1)});};exports[a39_0x4f75d6(0xb8)]=remove;const restart=async(_0x57dda9,_0x3102d6)=>{const _0xb51aff=a39_0x4f75d6,{companyId:_0x15bacc,profile:_0x1f191d}=_0x57dda9[_0xb51aff(0xc3)];if(_0x1f191d!==_0xb51aff(0xeb))throw new AppError_1[(_0xb51aff(0xd4))]('ERR_NO_PERMISSION',0x193);return await(0x0,wbot_1[_0xb51aff(0xb6)])(_0x15bacc),_0x3102d6[_0xb51aff(0xca)](0xc8)[_0xb51aff(0xe6)]({'message':'Whatsapp\x20restart.'});};exports['restart']=restart;