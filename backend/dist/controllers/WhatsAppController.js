'use strict';const a38_0x54dbe1=a38_0x53d2;(function(_0x42d3a6,_0x259072){const _0x1898af=a38_0x53d2,_0x323748=_0x42d3a6();while(!![]){try{const _0x1381c0=-parseInt(_0x1898af(0xbf))/0x1*(parseInt(_0x1898af(0xa9))/0x2)+parseInt(_0x1898af(0xc0))/0x3+-parseInt(_0x1898af(0xc4))/0x4*(parseInt(_0x1898af(0xc2))/0x5)+-parseInt(_0x1898af(0xd7))/0x6*(-parseInt(_0x1898af(0xaa))/0x7)+parseInt(_0x1898af(0x95))/0x8+-parseInt(_0x1898af(0x96))/0x9*(parseInt(_0x1898af(0xca))/0xa)+parseInt(_0x1898af(0xcf))/0xb;if(_0x1381c0===_0x259072)break;else _0x323748['push'](_0x323748['shift']());}catch(_0x16b050){_0x323748['push'](_0x323748['shift']());}}}(a38_0x3b4a,0x95424));function a38_0x3b4a(){const _0x59f51c=['1609389IuDZTD','index','2604745sSdIpF','user','8vxGVUV','-whatsapp','show','Insta\x20','getAccessTokenFromPage','body','30mBWJRD','planId','store','remove','admin','21456765mbOESy','json','storeFacebook','params','delFromPattern','delete','__esModule','length','3126QvkrLN','ERR_NO_PERMISSION','3677400tMEuId','2815191yWQYRP','company-','defineProperty','Whatsapp\x20restart.','query','StartWhatsAppSession','destroy','../models/Whatsapp','../services/BaileysServices/DeleteBaileysService','restart','Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!','subscribeApp','../services/WhatsappService/DeleteWhatsAppService','Facebook\x20page\x20not\x20found','../errors/AppError','../libs/wbot','findOne','CONNECTED','instagram','2CbyUWP','2345LioRAJ','cacheLayer','../services/PlanService/ShowPlanService','__importDefault','../libs/socket','push','restartWbot','../services/CompanyService/ShowCompanyService','getPageProfile','whatsapp','update','emit','status','../services/FacebookServices/graphAPI','facebookPageUserId','channel','getIO','../libs/cache','removeWbot','default','facebook','529629eAHaPZ'];a38_0x3b4a=function(){return _0x59f51c;};return a38_0x3b4a();}var __importDefault=this&&this[a38_0x54dbe1(0xad)]||function(_0x4adc8c){const _0x364384=a38_0x54dbe1;return _0x4adc8c&&_0x4adc8c[_0x364384(0xd5)]?_0x4adc8c:{'default':_0x4adc8c};};Object[a38_0x54dbe1(0x98)](exports,a38_0x54dbe1(0xd5),{'value':!![]}),exports[a38_0x54dbe1(0x9f)]=exports[a38_0x54dbe1(0xcd)]=exports[a38_0x54dbe1(0xb4)]=exports[a38_0x54dbe1(0xc6)]=exports[a38_0x54dbe1(0xd1)]=exports['store']=exports[a38_0x54dbe1(0xc1)]=void 0x0;const socket_1=require(a38_0x54dbe1(0xae)),cache_1=require(a38_0x54dbe1(0xbb)),wbot_1=require(a38_0x54dbe1(0xa5)),Whatsapp_1=__importDefault(require(a38_0x54dbe1(0x9d))),AppError_1=__importDefault(require(a38_0x54dbe1(0xa4))),DeleteBaileysService_1=__importDefault(require(a38_0x54dbe1(0x9e))),ShowCompanyService_1=__importDefault(require(a38_0x54dbe1(0xb1))),graphAPI_1=require(a38_0x54dbe1(0xb7)),ShowPlanService_1=__importDefault(require(a38_0x54dbe1(0xac))),StartWhatsAppSession_1=require('../services/WbotServices/StartWhatsAppSession'),CreateWhatsAppService_1=__importDefault(require('../services/WhatsappService/CreateWhatsAppService')),DeleteWhatsAppService_1=__importDefault(require(a38_0x54dbe1(0xa2))),ListWhatsAppsService_1=__importDefault(require('../services/WhatsappService/ListWhatsAppsService')),ShowWhatsAppService_1=__importDefault(require('../services/WhatsappService/ShowWhatsAppService')),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),index=async(_0x4abbfc,_0x127e6f)=>{const _0x5e01ba=a38_0x54dbe1,{companyId:_0x123681}=_0x4abbfc[_0x5e01ba(0xc3)],{session:_0x2443bb}=_0x4abbfc[_0x5e01ba(0x9a)],_0x393e2a=await(0x0,ListWhatsAppsService_1[_0x5e01ba(0xbd)])({'companyId':_0x123681,'session':_0x2443bb});return _0x127e6f[_0x5e01ba(0xb6)](0xc8)[_0x5e01ba(0xd0)](_0x393e2a);};function a38_0x53d2(_0xe6d09a,_0x3d8f59){const _0x3b4ac1=a38_0x3b4a();return a38_0x53d2=function(_0x53d253,_0x31b90c){_0x53d253=_0x53d253-0x94;let _0x29a053=_0x3b4ac1[_0x53d253];return _0x29a053;},a38_0x53d2(_0xe6d09a,_0x3d8f59);}exports[a38_0x54dbe1(0xc1)]=index;const store=async(_0x4facfa,_0x3e97b4)=>{const _0x52aac9=a38_0x54dbe1,{name:_0x5404b0,status:_0x201df9,isDefault:_0x1d0fd1,greetingMessage:_0x5a8f12,complationMessage:_0x342b95,outOfHoursMessage:_0x5c8c18,queueIds:_0x4a1322,token:_0x346e5f,maxUseBotQueues:_0x10e2f7,timeUseBotQueues:_0x1833c2,expiresTicket:_0x471682,allowGroup:_0x286b5c,timeSendQueue:_0x202969,sendIdQueue:_0x385bf1,timeInactiveMessage:_0x348865,inactiveMessage:_0x485bac,ratingMessage:_0x47d3f3,maxUseBotQueuesNPS:_0xa4bf5f,expiresTicketNPS:_0x37356c,whenExpiresTicket:_0x5b509b,expiresInactiveMessage:_0x2c4c8d,groupAsTicket:_0x5f444f}=_0x4facfa['body'],{companyId:_0x26730e}=_0x4facfa['user'],_0x5e5acb=await(0x0,ShowCompanyService_1[_0x52aac9(0xbd)])(_0x26730e),_0x2e6742=await(0x0,ShowPlanService_1[_0x52aac9(0xbd)])(_0x5e5acb[_0x52aac9(0xcb)]);if(!_0x2e6742['useWhatsapp'])return _0x3e97b4[_0x52aac9(0xb6)](0x190)[_0x52aac9(0xd0)]({'error':_0x52aac9(0xa0)});const {whatsapp:_0x25b6f6,oldDefaultWhatsapp:_0x1578af}=await(0x0,CreateWhatsAppService_1[_0x52aac9(0xbd)])({'name':_0x5404b0,'status':_0x201df9,'isDefault':_0x1d0fd1,'greetingMessage':_0x5a8f12,'complationMessage':_0x342b95,'outOfHoursMessage':_0x5c8c18,'queueIds':_0x4a1322,'companyId':_0x26730e,'token':_0x346e5f,'maxUseBotQueues':_0x10e2f7,'timeUseBotQueues':_0x1833c2,'expiresTicket':_0x471682,'allowGroup':_0x286b5c,'timeSendQueue':_0x202969,'sendIdQueue':_0x385bf1,'timeInactiveMessage':_0x348865,'inactiveMessage':_0x485bac,'ratingMessage':_0x47d3f3,'maxUseBotQueuesNPS':_0xa4bf5f,'expiresTicketNPS':_0x37356c,'whenExpiresTicket':_0x5b509b,'expiresInactiveMessage':_0x2c4c8d,'groupAsTicket':_0x5f444f});(0x0,StartWhatsAppSession_1[_0x52aac9(0x9b)])(_0x25b6f6,_0x26730e);const _0x43200f=(0x0,socket_1[_0x52aac9(0xba)])();return _0x43200f[_0x52aac9(0xb5)](_0x52aac9(0x97)+_0x26730e+_0x52aac9(0xc5),{'action':_0x52aac9(0xb4),'whatsapp':_0x25b6f6}),_0x1578af&&_0x43200f[_0x52aac9(0xb5)](_0x52aac9(0x97)+_0x26730e+_0x52aac9(0xc5),{'action':'update','whatsapp':_0x1578af}),_0x3e97b4['status'](0xc8)[_0x52aac9(0xd0)](_0x25b6f6);};exports[a38_0x54dbe1(0xcc)]=store;const storeFacebook=async(_0x146cfe,_0x1cc94d)=>{const _0x291e5c=a38_0x54dbe1;try{const {facebookUserId:_0x1ebfb3,facebookUserToken:_0x2c3d1e,addInstagram:_0x1ed764}=_0x146cfe[_0x291e5c(0xc9)],{companyId:_0x22439f}=_0x146cfe[_0x291e5c(0xc3)],{data:_0x2f6eae}=await(0x0,graphAPI_1[_0x291e5c(0xb2)])(_0x1ebfb3,_0x2c3d1e);if(_0x2f6eae[_0x291e5c(0xd6)]===0x0)return _0x1cc94d['status'](0x190)['json']({'error':_0x291e5c(0xa3)});const _0x3a5bae=(0x0,socket_1[_0x291e5c(0xba)])(),_0x156c17=[];for await(const _0xf7ba17 of _0x2f6eae){const {name:_0x3008e9,access_token:_0x2102f7,id:_0x326e27,instagram_business_account:_0xcfde65}=_0xf7ba17,_0x4be332=await(0x0,graphAPI_1[_0x291e5c(0xc8)])(_0x2102f7);if(_0xcfde65&&_0x1ed764){const {id:_0x2508a5,username:_0x34e66a,name:_0x1c7c53}=_0xcfde65;_0x156c17['push']({'companyId':_0x22439f,'name':_0x291e5c(0xc7)+(_0x34e66a||_0x1c7c53),'facebookUserId':_0x1ebfb3,'facebookPageUserId':_0x2508a5,'facebookUserToken':_0x4be332,'tokenMeta':_0x2c3d1e,'isDefault':![],'channel':_0x291e5c(0xa8),'status':_0x291e5c(0xa7),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x156c17[_0x291e5c(0xaf)]({'companyId':_0x22439f,'name':_0x3008e9,'facebookUserId':_0x1ebfb3,'facebookPageUserId':_0x326e27,'facebookUserToken':_0x4be332,'tokenMeta':_0x2c3d1e,'isDefault':![],'channel':'facebook','status':_0x291e5c(0xa7),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x291e5c(0xa1)])(_0x326e27,_0x4be332);}!_0xcfde65&&(_0x156c17['push']({'companyId':_0x22439f,'name':_0x3008e9,'facebookUserId':_0x1ebfb3,'facebookPageUserId':_0x326e27,'facebookUserToken':_0x4be332,'tokenMeta':_0x2c3d1e,'isDefault':![],'channel':_0x291e5c(0xbe),'status':'CONNECTED','greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x291e5c(0xa1)])(_0xf7ba17['id'],_0x4be332));}for await(const _0x1edfe1 of _0x156c17){const _0x2ad7f7=await Whatsapp_1['default'][_0x291e5c(0xa6)]({'where':{'facebookPageUserId':_0x1edfe1[_0x291e5c(0xb8)]}});_0x2ad7f7&&await _0x2ad7f7[_0x291e5c(0xb4)]({..._0x1edfe1});if(!_0x2ad7f7){const {whatsapp:_0x46d17c}=await(0x0,CreateWhatsAppService_1[_0x291e5c(0xbd)])(_0x1edfe1);_0x3a5bae[_0x291e5c(0xb5)](_0x291e5c(0x97)+_0x22439f+_0x291e5c(0xc5),{'action':'update','whatsapp':_0x46d17c});}}return _0x1cc94d[_0x291e5c(0xb6)](0xc8);}catch(_0x4ce077){return console['log'](_0x4ce077),_0x1cc94d[_0x291e5c(0xb6)](0x190)[_0x291e5c(0xd0)]({'error':'Facebook\x20page\x20not\x20found'});}};exports['storeFacebook']=storeFacebook;const show=async(_0x2a9946,_0x556942)=>{const _0x42a5f8=a38_0x54dbe1,{whatsappId:_0x52d79f}=_0x2a9946[_0x42a5f8(0xd2)],{companyId:_0x16c0ac}=_0x2a9946[_0x42a5f8(0xc3)],{session:_0x3f1317}=_0x2a9946[_0x42a5f8(0x9a)],_0x3d9d9=await(0x0,ShowWhatsAppService_1[_0x42a5f8(0xbd)])(_0x52d79f,_0x16c0ac,_0x3f1317);return _0x556942['status'](0xc8)['json'](_0x3d9d9);};exports[a38_0x54dbe1(0xc6)]=show;const update=async(_0xe1763a,_0x6edd97)=>{const _0x59fdbf=a38_0x54dbe1,{whatsappId:_0x10c733}=_0xe1763a['params'],_0x39ff9a=_0xe1763a[_0x59fdbf(0xc9)],{companyId:_0x258d7e}=_0xe1763a[_0x59fdbf(0xc3)],{whatsapp:_0x2dae49,oldDefaultWhatsapp:_0x590555}=await(0x0,UpdateWhatsAppService_1[_0x59fdbf(0xbd)])({'whatsappData':_0x39ff9a,'whatsappId':_0x10c733,'companyId':_0x258d7e}),_0x1366fd=(0x0,socket_1[_0x59fdbf(0xba)])();return _0x1366fd[_0x59fdbf(0xb5)](_0x59fdbf(0x97)+_0x258d7e+'-whatsapp',{'action':_0x59fdbf(0xb4),'whatsapp':_0x2dae49}),_0x590555&&_0x1366fd[_0x59fdbf(0xb5)](_0x59fdbf(0x97)+_0x258d7e+_0x59fdbf(0xc5),{'action':'update','whatsapp':_0x590555}),_0x6edd97[_0x59fdbf(0xb6)](0xc8)['json'](_0x2dae49);};exports[a38_0x54dbe1(0xb4)]=update;const remove=async(_0x570166,_0x1f209b)=>{const _0x59ccb1=a38_0x54dbe1,{whatsappId:_0x3b3dbc}=_0x570166[_0x59ccb1(0xd2)],{companyId:_0x41e4b9,profile:_0x253418}=_0x570166['user'],_0x2924e0=(0x0,socket_1[_0x59ccb1(0xba)])();if(_0x253418!==_0x59ccb1(0xce))throw new AppError_1[(_0x59ccb1(0xbd))](_0x59ccb1(0x94),0x193);const _0x2e7c7f=await(0x0,ShowWhatsAppService_1[_0x59ccb1(0xbd)])(_0x3b3dbc,_0x41e4b9);_0x2e7c7f[_0x59ccb1(0xb9)]===_0x59ccb1(0xb3)&&(await(0x0,DeleteBaileysService_1['default'])(_0x3b3dbc),await(0x0,DeleteWhatsAppService_1[_0x59ccb1(0xbd)])(_0x3b3dbc),await cache_1[_0x59ccb1(0xab)][_0x59ccb1(0xd3)]('sessions:'+_0x3b3dbc+':*'),(0x0,wbot_1[_0x59ccb1(0xbc)])(+_0x3b3dbc),_0x2924e0['emit'](_0x59ccb1(0x97)+_0x41e4b9+_0x59ccb1(0xc5),{'action':'delete','whatsappId':+_0x3b3dbc}));if(_0x2e7c7f[_0x59ccb1(0xb9)]===_0x59ccb1(0xbe)||_0x2e7c7f['channel']===_0x59ccb1(0xa8)){const {facebookUserToken:_0x50030b}=_0x2e7c7f,_0x5f43b1=await Whatsapp_1[_0x59ccb1(0xbd)]['findAll']({'where':{'facebookUserToken':_0x50030b}});await Whatsapp_1[_0x59ccb1(0xbd)][_0x59ccb1(0x9c)]({'where':{'facebookUserToken':_0x50030b}});for await(const _0x37960b of _0x5f43b1){_0x2924e0[_0x59ccb1(0xb5)](_0x59ccb1(0x97)+_0x41e4b9+'-whatsapp',{'action':_0x59ccb1(0xd4),'whatsappId':_0x37960b['id']});}}return _0x1f209b[_0x59ccb1(0xb6)](0xc8)['json']({'message':'Session\x20disconnected.'});};exports['remove']=remove;const restart=async(_0x3c20d9,_0x17f670)=>{const _0x254c27=a38_0x54dbe1,{companyId:_0x31532d,profile:_0x457735}=_0x3c20d9[_0x254c27(0xc3)];if(_0x457735!==_0x254c27(0xce))throw new AppError_1[(_0x254c27(0xbd))](_0x254c27(0x94),0x193);return await(0x0,wbot_1[_0x254c27(0xb0)])(_0x31532d),_0x17f670['status'](0xc8)['json']({'message':_0x254c27(0x99)});};exports[a38_0x54dbe1(0x9f)]=restart;