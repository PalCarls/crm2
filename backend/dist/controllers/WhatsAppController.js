'use strict';const a42_0xb6de39=a42_0x1970;(function(_0x473f8b,_0x279d4a){const _0x31d056=a42_0x1970,_0x5bc0da=_0x473f8b();while(!![]){try{const _0x3fbbea=parseInt(_0x31d056(0x1d4))/0x1*(parseInt(_0x31d056(0x1b8))/0x2)+-parseInt(_0x31d056(0x1f2))/0x3+-parseInt(_0x31d056(0x1ec))/0x4+parseInt(_0x31d056(0x1e3))/0x5*(parseInt(_0x31d056(0x1e9))/0x6)+parseInt(_0x31d056(0x1db))/0x7+parseInt(_0x31d056(0x1f0))/0x8+-parseInt(_0x31d056(0x1c9))/0x9;if(_0x3fbbea===_0x279d4a)break;else _0x5bc0da['push'](_0x5bc0da['shift']());}catch(_0x1f3004){_0x5bc0da['push'](_0x5bc0da['shift']());}}}(a42_0x21e6,0x4589c));var __importDefault=this&&this[a42_0xb6de39(0x1de)]||function(_0x32b57f){return _0x32b57f&&_0x32b57f['__esModule']?_0x32b57f:{'default':_0x32b57f};};Object[a42_0xb6de39(0x1bf)](exports,a42_0xb6de39(0x1dc),{'value':!![]}),exports[a42_0xb6de39(0x1cd)]=exports[a42_0xb6de39(0x1d9)]=exports[a42_0xb6de39(0x1d8)]=exports[a42_0xb6de39(0x1c6)]=exports[a42_0xb6de39(0x1d1)]=exports[a42_0xb6de39(0x1c3)]=exports[a42_0xb6de39(0x1fe)]=exports[a42_0xb6de39(0x1cc)]=exports[a42_0xb6de39(0x1c0)]=exports[a42_0xb6de39(0x1f7)]=exports[a42_0xb6de39(0x1ba)]=exports[a42_0xb6de39(0x1ff)]=void 0x0;const socket_1=require(a42_0xb6de39(0x1ca)),cache_1=__importDefault(require(a42_0xb6de39(0x1bc))),wbot_1=require(a42_0xb6de39(0x1fc)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),AppError_1=__importDefault(require('../errors/AppError')),DeleteBaileysService_1=__importDefault(require(a42_0xb6de39(0x1df))),ShowCompanyService_1=__importDefault(require(a42_0xb6de39(0x1c2))),graphAPI_1=require(a42_0xb6de39(0x1e1)),ShowPlanService_1=__importDefault(require(a42_0xb6de39(0x1dd))),StartWhatsAppSession_1=require(a42_0xb6de39(0x1c5)),CreateWhatsAppService_1=__importDefault(require(a42_0xb6de39(0x1e0))),DeleteWhatsAppService_1=__importDefault(require(a42_0xb6de39(0x1e6))),ListWhatsAppsService_1=__importDefault(require(a42_0xb6de39(0x1ea))),ShowWhatsAppService_1=__importDefault(require(a42_0xb6de39(0x1fd))),UpdateWhatsAppService_1=__importDefault(require(a42_0xb6de39(0x1b9))),ImportWhatsAppMessageService_1=require(a42_0xb6de39(0x1e2)),ShowWhatsAppServiceAdmin_1=__importDefault(require('../services/WhatsappService/ShowWhatsAppServiceAdmin')),UpdateWhatsAppServiceAdmin_1=__importDefault(require(a42_0xb6de39(0x1d5))),ListAllWhatsAppService_1=__importDefault(require(a42_0xb6de39(0x1ee))),index=async(_0x21f9ee,_0x538156)=>{const _0x357a2b=a42_0xb6de39,{companyId:_0x14f739}=_0x21f9ee[_0x357a2b(0x1f1)],{session:_0x101a1b}=_0x21f9ee['query'],_0x431ee0=await(0x0,ListWhatsAppsService_1['default'])({'companyId':_0x14f739,'session':_0x101a1b});return _0x538156[_0x357a2b(0x1cb)](0xc8)[_0x357a2b(0x1e7)](_0x431ee0);};function a42_0x21e6(){const _0x516907=['sessions:','body','Insta\x20','restart','facebook','subscribeApp','2brSQEy','../services/WhatsappService/UpdateWhatsAppServiceAdmin','log','query','updateAdmin','removeAdmin','admin-whatsapp','1541736LHgweA','__esModule','../services/PlanService/ShowPlanService','__importDefault','../services/BaileysServices/DeleteBaileysService','../services/WhatsappService/CreateWhatsAppService','../services/FacebookServices/graphAPI','../services/WhatsappService/ImportWhatsAppMessageService','10kRaAGS','Facebook\x20page\x20not\x20found','findOne','../services/WhatsappService/DeleteWhatsAppService','json','push','1437108THrizt','../services/WhatsappService/ListWhatsAppsService','params','491912LNrrlI','getIO','../services/WhatsappService/ListAllWhatsAppService','destroy','1259352CPJcta','user','840435ZrQzvp','channel','CONNECTED','instagram','useWhatsapp','storeFacebook','length','Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!','facebookPageUserId','Whatsapp\x20restart.','../libs/wbot','../services/WhatsappService/ShowWhatsAppService','closedTickets','index','-whatsapp','whatsapp','removeWbot','delete','getAccessTokenFromPage','closeTicketsImported','getPageProfile','emit','planId','195964PGXkBO','../services/WhatsappService/UpdateWhatsAppService','store','delFromPattern','../libs/cache','company-','admin','defineProperty','show','findAll','../services/CompanyService/ShowCompanyService','remove','Session\x20disconnected.','../services/WbotServices/StartWhatsAppSession','listAll','ERR_NO_PERMISSION','default','3282444dYgSYf','../libs/socket','status','update','showAdmin'];a42_0x21e6=function(){return _0x516907;};return a42_0x21e6();}exports['index']=index;const store=async(_0x3f31ee,_0x28cccb)=>{const _0x24bf15=a42_0xb6de39,{name:_0x3314e5,status:_0x47b0b9,isDefault:_0x49ddba,greetingMessage:_0x2e0408,complationMessage:_0x1255a2,outOfHoursMessage:_0x9990ae,queueIds:_0x5c357b,token:_0x58f4ac,maxUseBotQueues:_0xc4f582,timeUseBotQueues:_0x50f36c,expiresTicket:_0x1c59ba,allowGroup:_0x2ab6f6,timeSendQueue:_0x2cb4f9,sendIdQueue:_0x5c3f7b,timeInactiveMessage:_0x503d3c,inactiveMessage:_0x5abb5b,ratingMessage:_0x50bbf7,maxUseBotQueuesNPS:_0x426c2c,expiresTicketNPS:_0x2ecbc4,whenExpiresTicket:_0x11872e,expiresInactiveMessage:_0x3e0bbe,importOldMessages:_0x5063e9,importRecentMessages:_0x5e13bb,closedTicketsPostImported:_0x4c7af5,importOldMessagesGroups:_0x3f60cf,groupAsTicket:_0x9fdd96,timeCreateNewTicket:_0xdb51b3,schedules:_0x5c140b,promptId:_0x1066f1,collectiveVacationEnd:_0x3295f1,collectiveVacationMessage:_0x1ab2a8,collectiveVacationStart:_0x5659df}=_0x3f31ee[_0x24bf15(0x1cf)],{companyId:_0x3eb020}=_0x3f31ee[_0x24bf15(0x1f1)],_0x11d6f5=await(0x0,ShowCompanyService_1[_0x24bf15(0x1c8)])(_0x3eb020),_0x5b157b=await(0x0,ShowPlanService_1['default'])(_0x11d6f5[_0x24bf15(0x1b7)]);if(!_0x5b157b[_0x24bf15(0x1f6)])return _0x28cccb[_0x24bf15(0x1cb)](0x190)['json']({'error':_0x24bf15(0x1f9)});const {whatsapp:_0x763edd,oldDefaultWhatsapp:_0x1bda0c}=await(0x0,CreateWhatsAppService_1[_0x24bf15(0x1c8)])({'name':_0x3314e5,'status':_0x47b0b9,'isDefault':_0x49ddba,'greetingMessage':_0x2e0408,'complationMessage':_0x1255a2,'outOfHoursMessage':_0x9990ae,'queueIds':_0x5c357b,'companyId':_0x3eb020,'token':_0x58f4ac,'maxUseBotQueues':_0xc4f582,'timeUseBotQueues':_0x50f36c,'expiresTicket':_0x1c59ba,'allowGroup':_0x2ab6f6,'timeSendQueue':_0x2cb4f9,'sendIdQueue':_0x5c3f7b,'timeInactiveMessage':_0x503d3c,'inactiveMessage':_0x5abb5b,'ratingMessage':_0x50bbf7,'maxUseBotQueuesNPS':_0x426c2c,'expiresTicketNPS':_0x2ecbc4,'whenExpiresTicket':_0x11872e,'expiresInactiveMessage':_0x3e0bbe,'importOldMessages':_0x5063e9,'importRecentMessages':_0x5e13bb,'closedTicketsPostImported':_0x4c7af5,'importOldMessagesGroups':_0x3f60cf,'groupAsTicket':_0x9fdd96,'timeCreateNewTicket':_0xdb51b3,'schedules':_0x5c140b,'promptId':_0x1066f1,'collectiveVacationEnd':_0x3295f1,'collectiveVacationMessage':_0x1ab2a8,'collectiveVacationStart':_0x5659df});(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x763edd,_0x3eb020);const _0x23d034=(0x0,socket_1[_0x24bf15(0x1ed)])();return _0x23d034['emit'](_0x24bf15(0x1bd)+_0x3eb020+_0x24bf15(0x200),{'action':_0x24bf15(0x1cc),'whatsapp':_0x763edd}),_0x1bda0c&&_0x23d034['emit'](_0x24bf15(0x1bd)+_0x3eb020+_0x24bf15(0x200),{'action':_0x24bf15(0x1cc),'whatsapp':_0x1bda0c}),_0x28cccb[_0x24bf15(0x1cb)](0xc8)[_0x24bf15(0x1e7)](_0x763edd);};exports[a42_0xb6de39(0x1ba)]=store;const storeFacebook=async(_0x451d4f,_0x25c334)=>{const _0x68ac82=a42_0xb6de39;try{const {facebookUserId:_0x35297a,facebookUserToken:_0x417542,addInstagram:_0x1dee0a}=_0x451d4f[_0x68ac82(0x1cf)],{companyId:_0x2f1470}=_0x451d4f[_0x68ac82(0x1f1)],{data:_0x2872d0}=await(0x0,graphAPI_1[_0x68ac82(0x1b5)])(_0x35297a,_0x417542);if(_0x2872d0[_0x68ac82(0x1f8)]===0x0)return _0x25c334['status'](0x190)[_0x68ac82(0x1e7)]({'error':_0x68ac82(0x1e4)});const _0x2b7d92=(0x0,socket_1[_0x68ac82(0x1ed)])(),_0x176868=[];for await(const _0x78d633 of _0x2872d0){const {name:_0x4b4797,access_token:_0x5471a9,id:_0x3a526f,instagram_business_account:_0x137223}=_0x78d633,_0x2634d3=await(0x0,graphAPI_1[_0x68ac82(0x204)])(_0x5471a9);if(_0x137223&&_0x1dee0a){const {id:_0x58c5e2,username:_0x2b2a53,name:_0x8705f6}=_0x137223;_0x176868[_0x68ac82(0x1e8)]({'companyId':_0x2f1470,'name':_0x68ac82(0x1d0)+(_0x2b2a53||_0x8705f6),'facebookUserId':_0x35297a,'facebookPageUserId':_0x58c5e2,'facebookUserToken':_0x2634d3,'tokenMeta':_0x417542,'isDefault':![],'channel':_0x68ac82(0x1f5),'status':_0x68ac82(0x1f4),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x176868[_0x68ac82(0x1e8)]({'companyId':_0x2f1470,'name':_0x4b4797,'facebookUserId':_0x35297a,'facebookPageUserId':_0x3a526f,'facebookUserToken':_0x2634d3,'tokenMeta':_0x417542,'isDefault':![],'channel':'facebook','status':'CONNECTED','greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x68ac82(0x1d3)])(_0x3a526f,_0x2634d3);}!_0x137223&&(_0x176868[_0x68ac82(0x1e8)]({'companyId':_0x2f1470,'name':_0x4b4797,'facebookUserId':_0x35297a,'facebookPageUserId':_0x3a526f,'facebookUserToken':_0x2634d3,'tokenMeta':_0x417542,'isDefault':![],'channel':_0x68ac82(0x1d2),'status':_0x68ac82(0x1f4),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x68ac82(0x1d3)])(_0x78d633['id'],_0x2634d3));}for await(const _0x4f276f of _0x176868){const _0x28f535=await Whatsapp_1[_0x68ac82(0x1c8)][_0x68ac82(0x1e5)]({'where':{'facebookPageUserId':_0x4f276f[_0x68ac82(0x1fa)]}});_0x28f535&&await _0x28f535[_0x68ac82(0x1cc)]({..._0x4f276f});if(!_0x28f535){const {whatsapp:_0x23f158}=await(0x0,CreateWhatsAppService_1[_0x68ac82(0x1c8)])(_0x4f276f);_0x2b7d92[_0x68ac82(0x1b6)](_0x68ac82(0x1bd)+_0x2f1470+_0x68ac82(0x200),{'action':'update','whatsapp':_0x23f158});}}return _0x25c334[_0x68ac82(0x1cb)](0xc8);}catch(_0x465fb1){return console[_0x68ac82(0x1d6)](_0x465fb1),_0x25c334['status'](0x190)[_0x68ac82(0x1e7)]({'error':_0x68ac82(0x1e4)});}};exports[a42_0xb6de39(0x1f7)]=storeFacebook;const show=async(_0x9bbe5f,_0x3cb8fa)=>{const _0x261117=a42_0xb6de39,{whatsappId:_0x2c672f}=_0x9bbe5f['params'],{companyId:_0xc653c3}=_0x9bbe5f[_0x261117(0x1f1)],{session:_0xdc3d6}=_0x9bbe5f[_0x261117(0x1d7)],_0x4d9eaf=await(0x0,ShowWhatsAppService_1[_0x261117(0x1c8)])(_0x2c672f,_0xc653c3,_0xdc3d6);return _0x3cb8fa['status'](0xc8)[_0x261117(0x1e7)](_0x4d9eaf);};exports[a42_0xb6de39(0x1c0)]=show;const update=async(_0x436344,_0x232dfb)=>{const _0x4f3487=a42_0xb6de39,{whatsappId:_0x3191ae}=_0x436344['params'],_0xc01ff1=_0x436344['body'],{companyId:_0x38b444}=_0x436344[_0x4f3487(0x1f1)],{whatsapp:_0x4dea39,oldDefaultWhatsapp:_0x4520a7}=await(0x0,UpdateWhatsAppService_1[_0x4f3487(0x1c8)])({'whatsappData':_0xc01ff1,'whatsappId':_0x3191ae,'companyId':_0x38b444}),_0x41d520=(0x0,socket_1[_0x4f3487(0x1ed)])();return _0x41d520['emit'](_0x4f3487(0x1bd)+_0x38b444+_0x4f3487(0x200),{'action':_0x4f3487(0x1cc),'whatsapp':_0x4dea39}),_0x4520a7&&_0x41d520[_0x4f3487(0x1b6)](_0x4f3487(0x1bd)+_0x38b444+_0x4f3487(0x200),{'action':_0x4f3487(0x1cc),'whatsapp':_0x4520a7}),_0x232dfb['status'](0xc8)[_0x4f3487(0x1e7)](_0x4dea39);};exports[a42_0xb6de39(0x1cc)]=update;const closedTickets=async(_0x1a05f5,_0x1e866a)=>{const _0x4aa178=a42_0xb6de39,{whatsappId:_0x1e5fbb}=_0x1a05f5[_0x4aa178(0x1eb)];return(0x0,ImportWhatsAppMessageService_1[_0x4aa178(0x1b4)])(_0x1e5fbb),_0x1e866a[_0x4aa178(0x1cb)](0xc8)[_0x4aa178(0x1e7)](_0x4aa178(0x201));};exports[a42_0xb6de39(0x1fe)]=closedTickets;const remove=async(_0x35834b,_0x2961b0)=>{const _0x414f31=a42_0xb6de39,{whatsappId:_0x51e2f9}=_0x35834b[_0x414f31(0x1eb)],{companyId:_0x24615b,profile:_0x2310ed}=_0x35834b[_0x414f31(0x1f1)],_0x1927fd=(0x0,socket_1[_0x414f31(0x1ed)])();if(_0x2310ed!==_0x414f31(0x1be))throw new AppError_1[(_0x414f31(0x1c8))](_0x414f31(0x1c7),0x193);const _0x35f4ce=await(0x0,ShowWhatsAppService_1['default'])(_0x51e2f9,_0x24615b);_0x35f4ce[_0x414f31(0x1f3)]===_0x414f31(0x201)&&(await(0x0,DeleteBaileysService_1[_0x414f31(0x1c8)])(_0x51e2f9),await(0x0,DeleteWhatsAppService_1[_0x414f31(0x1c8)])(_0x51e2f9),await cache_1['default'][_0x414f31(0x1bb)](_0x414f31(0x1ce)+_0x51e2f9+':*'),(0x0,wbot_1[_0x414f31(0x202)])(+_0x51e2f9),_0x1927fd[_0x414f31(0x1b6)](_0x414f31(0x1bd)+_0x24615b+_0x414f31(0x200),{'action':_0x414f31(0x203),'whatsappId':+_0x51e2f9}));if(_0x35f4ce['channel']==='facebook'||_0x35f4ce['channel']===_0x414f31(0x1f5)){const {facebookUserToken:_0x37f0a2}=_0x35f4ce,_0x37fabb=await Whatsapp_1[_0x414f31(0x1c8)][_0x414f31(0x1c1)]({'where':{'facebookUserToken':_0x37f0a2}});await Whatsapp_1[_0x414f31(0x1c8)][_0x414f31(0x1ef)]({'where':{'facebookUserToken':_0x37f0a2}});for await(const _0x5ec11b of _0x37fabb){_0x1927fd[_0x414f31(0x1b6)](_0x414f31(0x1bd)+_0x24615b+_0x414f31(0x200),{'action':_0x414f31(0x203),'whatsappId':_0x5ec11b['id']});}}return _0x2961b0[_0x414f31(0x1cb)](0xc8)[_0x414f31(0x1e7)]({'message':'Session\x20disconnected.'});};exports[a42_0xb6de39(0x1c3)]=remove;const restart=async(_0x266121,_0x197994)=>{const _0x98d57b=a42_0xb6de39,{companyId:_0x48183e,profile:_0x22e693}=_0x266121[_0x98d57b(0x1f1)];if(_0x22e693!==_0x98d57b(0x1be))throw new AppError_1[(_0x98d57b(0x1c8))]('ERR_NO_PERMISSION',0x193);return await(0x0,wbot_1['restartWbot'])(_0x48183e),_0x197994[_0x98d57b(0x1cb)](0xc8)[_0x98d57b(0x1e7)]({'message':_0x98d57b(0x1fb)});};exports['restart']=restart;const listAll=async(_0x40af50,_0x3c29ec)=>{const _0x2a9062=a42_0xb6de39,{companyId:_0x4164df}=_0x40af50['user'],{session:_0x91b47e}=_0x40af50[_0x2a9062(0x1d7)],_0x3c2a99=await(0x0,ListAllWhatsAppService_1[_0x2a9062(0x1c8)])({'session':_0x91b47e});return _0x3c29ec[_0x2a9062(0x1cb)](0xc8)[_0x2a9062(0x1e7)](_0x3c2a99);};exports[a42_0xb6de39(0x1c6)]=listAll;const updateAdmin=async(_0x1b776f,_0x45e358)=>{const _0x202917=a42_0xb6de39,{whatsappId:_0x4b932d}=_0x1b776f[_0x202917(0x1eb)],_0x4e7142=_0x1b776f[_0x202917(0x1cf)],{companyId:_0xe392dd}=_0x1b776f['user'],{whatsapp:_0x1ecef0,oldDefaultWhatsapp:_0x21caa8}=await(0x0,UpdateWhatsAppServiceAdmin_1[_0x202917(0x1c8)])({'whatsappData':_0x4e7142,'whatsappId':_0x4b932d,'companyId':_0xe392dd}),_0x277c35=(0x0,socket_1[_0x202917(0x1ed)])();return _0x277c35[_0x202917(0x1b6)](_0x202917(0x1da),{'action':'update','whatsapp':_0x1ecef0}),_0x21caa8&&_0x277c35['emit'](_0x202917(0x1da),{'action':_0x202917(0x1cc),'whatsapp':_0x21caa8}),_0x45e358[_0x202917(0x1cb)](0xc8)[_0x202917(0x1e7)](_0x1ecef0);};exports[a42_0xb6de39(0x1d8)]=updateAdmin;function a42_0x1970(_0x10c055,_0x4600d5){const _0x21e6c4=a42_0x21e6();return a42_0x1970=function(_0x197027,_0x1ec942){_0x197027=_0x197027-0x1b4;let _0x184e85=_0x21e6c4[_0x197027];return _0x184e85;},a42_0x1970(_0x10c055,_0x4600d5);}const removeAdmin=async(_0x1d329a,_0x34dcfb)=>{const _0x59c2da=a42_0xb6de39,{whatsappId:_0x2bdbf0}=_0x1d329a[_0x59c2da(0x1eb)],{companyId:_0x4a15e6}=_0x1d329a[_0x59c2da(0x1f1)],_0x4e7adb=(0x0,socket_1['getIO'])(),_0x1b1752=await(0x0,ShowWhatsAppService_1[_0x59c2da(0x1c8)])(_0x2bdbf0,_0x4a15e6);_0x1b1752[_0x59c2da(0x1f3)]===_0x59c2da(0x201)&&(await(0x0,DeleteBaileysService_1[_0x59c2da(0x1c8)])(_0x2bdbf0),await(0x0,DeleteWhatsAppService_1[_0x59c2da(0x1c8)])(_0x2bdbf0),await cache_1[_0x59c2da(0x1c8)][_0x59c2da(0x1bb)](_0x59c2da(0x1ce)+_0x2bdbf0+':*'),(0x0,wbot_1['removeWbot'])(+_0x2bdbf0),_0x4e7adb[_0x59c2da(0x1b6)]('admin-whatsapp',{'action':'delete','whatsappId':+_0x2bdbf0}));if(_0x1b1752['channel']===_0x59c2da(0x1d2)||_0x1b1752[_0x59c2da(0x1f3)]==='instagram'){const {facebookUserToken:_0x214ec7}=_0x1b1752,_0x8d92c8=await Whatsapp_1[_0x59c2da(0x1c8)][_0x59c2da(0x1c1)]({'where':{'facebookUserToken':_0x214ec7}});await Whatsapp_1[_0x59c2da(0x1c8)][_0x59c2da(0x1ef)]({'where':{'facebookUserToken':_0x214ec7}});for await(const _0x22d84f of _0x8d92c8){_0x4e7adb[_0x59c2da(0x1b6)](_0x59c2da(0x1bd)+_0x4a15e6+'-whatsapp',{'action':_0x59c2da(0x203),'whatsappId':_0x22d84f['id']});}}return _0x34dcfb['status'](0xc8)[_0x59c2da(0x1e7)]({'message':_0x59c2da(0x1c4)});};exports[a42_0xb6de39(0x1d9)]=removeAdmin;const showAdmin=async(_0x279900,_0x5b320f)=>{const _0x3229f5=a42_0xb6de39,{whatsappId:_0x51b23f}=_0x279900['params'],{companyId:_0x52353e}=_0x279900['user'],_0x3ec6a5=await(0x0,ShowWhatsAppServiceAdmin_1[_0x3229f5(0x1c8)])(_0x51b23f);return _0x5b320f[_0x3229f5(0x1cb)](0xc8)[_0x3229f5(0x1e7)](_0x3ec6a5);};exports[a42_0xb6de39(0x1cd)]=showAdmin;