'use strict';const a40_0x2fa384=a40_0x5546;function a40_0x5546(_0x54ebe1,_0x24ba3f){const _0x254206=a40_0x2542();return a40_0x5546=function(_0x5546f1,_0x444494){_0x5546f1=_0x5546f1-0x9a;let _0x125f69=_0x254206[_0x5546f1];return _0x125f69;},a40_0x5546(_0x54ebe1,_0x24ba3f);}(function(_0x1553f9,_0x2cda2e){const _0x572016=a40_0x5546,_0x4edec2=_0x1553f9();while(!![]){try{const _0x36eb05=-parseInt(_0x572016(0xba))/0x1+-parseInt(_0x572016(0xa5))/0x2+parseInt(_0x572016(0xd1))/0x3*(parseInt(_0x572016(0xa6))/0x4)+-parseInt(_0x572016(0xdd))/0x5+parseInt(_0x572016(0xb9))/0x6*(-parseInt(_0x572016(0xc9))/0x7)+parseInt(_0x572016(0xd7))/0x8*(parseInt(_0x572016(0xad))/0x9)+parseInt(_0x572016(0xd0))/0xa;if(_0x36eb05===_0x2cda2e)break;else _0x4edec2['push'](_0x4edec2['shift']());}catch(_0x38320c){_0x4edec2['push'](_0x4edec2['shift']());}}}(a40_0x2542,0xa17b2));var __importDefault=this&&this[a40_0x2fa384(0xd4)]||function(_0x27f19a){const _0xf72c40=a40_0x2fa384;return _0x27f19a&&_0x27f19a[_0xf72c40(0xa7)]?_0x27f19a:{'default':_0x27f19a};};Object['defineProperty'](exports,a40_0x2fa384(0xa7),{'value':!![]}),exports[a40_0x2fa384(0xcb)]=exports[a40_0x2fa384(0xd9)]=exports[a40_0x2fa384(0xcc)]=exports[a40_0x2fa384(0x9e)]=exports['show']=exports[a40_0x2fa384(0xc3)]=exports[a40_0x2fa384(0xde)]=exports['index']=void 0x0;const socket_1=require(a40_0x2fa384(0xbc)),cache_1=__importDefault(require(a40_0x2fa384(0xb4))),wbot_1=require(a40_0x2fa384(0xa9)),Whatsapp_1=__importDefault(require(a40_0x2fa384(0xb5))),AppError_1=__importDefault(require(a40_0x2fa384(0xb6))),DeleteBaileysService_1=__importDefault(require(a40_0x2fa384(0xd8))),ShowCompanyService_1=__importDefault(require(a40_0x2fa384(0xaa))),graphAPI_1=require(a40_0x2fa384(0xd3)),ShowPlanService_1=__importDefault(require(a40_0x2fa384(0xdc))),StartWhatsAppSession_1=require(a40_0x2fa384(0xb8)),CreateWhatsAppService_1=__importDefault(require(a40_0x2fa384(0xbb))),DeleteWhatsAppService_1=__importDefault(require(a40_0x2fa384(0xab))),ListWhatsAppsService_1=__importDefault(require(a40_0x2fa384(0xc8))),ShowWhatsAppService_1=__importDefault(require(a40_0x2fa384(0xc1))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),ImportWhatsAppMessageService_1=require('../services/WhatsappService/ImportWhatsAppMessageService'),index=async(_0x3e87d5,_0x53c03b)=>{const _0x1ae1ee=a40_0x2fa384,{companyId:_0x6e8dcc}=_0x3e87d5['user'],{session:_0x634e9f}=_0x3e87d5[_0x1ae1ee(0xae)],_0x184c3c=await(0x0,ListWhatsAppsService_1['default'])({'companyId':_0x6e8dcc,'session':_0x634e9f});return _0x53c03b[_0x1ae1ee(0xc7)](0xc8)[_0x1ae1ee(0xce)](_0x184c3c);};exports[a40_0x2fa384(0xd2)]=index;const store=async(_0x2ee9dc,_0x5c5122)=>{const _0x6cd453=a40_0x2fa384,{name:_0x50ebce,status:_0x2707d6,isDefault:_0x3b67af,greetingMessage:_0xd0aaba,complationMessage:_0x57e405,outOfHoursMessage:_0x1fd92f,queueIds:_0x576aed,token:_0x1c4391,maxUseBotQueues:_0x4ebbf2,timeUseBotQueues:_0x457cc6,expiresTicket:_0x77c4ad,allowGroup:_0x512fba,timeSendQueue:_0x1e1ce3,sendIdQueue:_0x1024e9,timeInactiveMessage:_0x3cdd0f,inactiveMessage:_0x416d61,ratingMessage:_0x4ce444,maxUseBotQueuesNPS:_0x59cc3,expiresTicketNPS:_0x276d50,whenExpiresTicket:_0x400633,expiresInactiveMessage:_0xd27ab7,importOldMessages:_0x4a83d6,importRecentMessages:_0x521a64,closedTicketsPostImported:_0x1a768a,importOldMessagesGroups:_0x5616ad,groupAsTicket:_0x38abfd,timeCreateNewTicket:_0x37533a}=_0x2ee9dc[_0x6cd453(0xa4)],{companyId:_0x101074}=_0x2ee9dc[_0x6cd453(0xa3)],_0x1874e0=await(0x0,ShowCompanyService_1[_0x6cd453(0xdf)])(_0x101074),_0x3eb88e=await(0x0,ShowPlanService_1[_0x6cd453(0xdf)])(_0x1874e0[_0x6cd453(0xd5)]);if(!_0x3eb88e[_0x6cd453(0xc5)])return _0x5c5122[_0x6cd453(0xc7)](0x190)[_0x6cd453(0xce)]({'error':_0x6cd453(0xc6)});const {whatsapp:_0x176f9b,oldDefaultWhatsapp:_0x5b55fe}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x50ebce,'status':_0x2707d6,'isDefault':_0x3b67af,'greetingMessage':_0xd0aaba,'complationMessage':_0x57e405,'outOfHoursMessage':_0x1fd92f,'queueIds':_0x576aed,'companyId':_0x101074,'token':_0x1c4391,'maxUseBotQueues':_0x4ebbf2,'timeUseBotQueues':_0x457cc6,'expiresTicket':_0x77c4ad,'allowGroup':_0x512fba,'timeSendQueue':_0x1e1ce3,'sendIdQueue':_0x1024e9,'timeInactiveMessage':_0x3cdd0f,'inactiveMessage':_0x416d61,'ratingMessage':_0x4ce444,'maxUseBotQueuesNPS':_0x59cc3,'expiresTicketNPS':_0x276d50,'whenExpiresTicket':_0x400633,'expiresInactiveMessage':_0xd27ab7,'importOldMessages':_0x4a83d6,'importRecentMessages':_0x521a64,'closedTicketsPostImported':_0x1a768a,'importOldMessagesGroups':_0x5616ad,'groupAsTicket':_0x38abfd,'timeCreateNewTicket':_0x37533a});(0x0,StartWhatsAppSession_1[_0x6cd453(0xa1)])(_0x176f9b,_0x101074);const _0x47fed2=(0x0,socket_1[_0x6cd453(0xc0)])();return _0x47fed2['emit'](_0x6cd453(0xe1)+_0x101074+_0x6cd453(0x9f),{'action':_0x6cd453(0x9e),'whatsapp':_0x176f9b}),_0x5b55fe&&_0x47fed2['emit'](_0x6cd453(0xe1)+_0x101074+_0x6cd453(0x9f),{'action':_0x6cd453(0x9e),'whatsapp':_0x5b55fe}),_0x5c5122['status'](0xc8)[_0x6cd453(0xce)](_0x176f9b);};exports[a40_0x2fa384(0xde)]=store;const storeFacebook=async(_0x491c90,_0x1a864e)=>{const _0x3d1988=a40_0x2fa384;try{const {facebookUserId:_0x4a7a5f,facebookUserToken:_0x3a75dc,addInstagram:_0x308abe}=_0x491c90[_0x3d1988(0xa4)],{companyId:_0x1e8e39}=_0x491c90[_0x3d1988(0xa3)],{data:_0x34b9f1}=await(0x0,graphAPI_1['getPageProfile'])(_0x4a7a5f,_0x3a75dc);if(_0x34b9f1[_0x3d1988(0xb2)]===0x0)return _0x1a864e[_0x3d1988(0xc7)](0x190)[_0x3d1988(0xce)]({'error':_0x3d1988(0xdb)});const _0x300062=(0x0,socket_1[_0x3d1988(0xc0)])(),_0x1ad768=[];for await(const _0x21cf53 of _0x34b9f1){const {name:_0x3e242a,access_token:_0x2fcbdd,id:_0x4370fd,instagram_business_account:_0x3c4cd9}=_0x21cf53,_0x48695d=await(0x0,graphAPI_1[_0x3d1988(0xb1)])(_0x2fcbdd);if(_0x3c4cd9&&_0x308abe){const {id:_0x4063d7,username:_0x97d4fa,name:_0x46e051}=_0x3c4cd9;_0x1ad768[_0x3d1988(0xd6)]({'companyId':_0x1e8e39,'name':'Insta\x20'+(_0x97d4fa||_0x46e051),'facebookUserId':_0x4a7a5f,'facebookPageUserId':_0x4063d7,'facebookUserToken':_0x48695d,'tokenMeta':_0x3a75dc,'isDefault':![],'channel':_0x3d1988(0xc2),'status':_0x3d1988(0xaf),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x1ad768['push']({'companyId':_0x1e8e39,'name':_0x3e242a,'facebookUserId':_0x4a7a5f,'facebookPageUserId':_0x4370fd,'facebookUserToken':_0x48695d,'tokenMeta':_0x3a75dc,'isDefault':![],'channel':_0x3d1988(0xb7),'status':_0x3d1988(0xaf),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x3d1988(0x9c)])(_0x4370fd,_0x48695d);}!_0x3c4cd9&&(_0x1ad768[_0x3d1988(0xd6)]({'companyId':_0x1e8e39,'name':_0x3e242a,'facebookUserId':_0x4a7a5f,'facebookPageUserId':_0x4370fd,'facebookUserToken':_0x48695d,'tokenMeta':_0x3a75dc,'isDefault':![],'channel':'facebook','status':_0x3d1988(0xaf),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x3d1988(0x9c)])(_0x21cf53['id'],_0x48695d));}for await(const _0x3f068c of _0x1ad768){const _0x472cab=await Whatsapp_1['default'][_0x3d1988(0xc4)]({'where':{'facebookPageUserId':_0x3f068c[_0x3d1988(0xe0)]}});_0x472cab&&await _0x472cab['update']({..._0x3f068c});if(!_0x472cab){const {whatsapp:_0x504e82}=await(0x0,CreateWhatsAppService_1['default'])(_0x3f068c);_0x300062[_0x3d1988(0xbe)]('company-'+_0x1e8e39+_0x3d1988(0x9f),{'action':_0x3d1988(0x9e),'whatsapp':_0x504e82});}}return _0x1a864e[_0x3d1988(0xc7)](0xc8);}catch(_0x56a2f4){return console[_0x3d1988(0xb3)](_0x56a2f4),_0x1a864e[_0x3d1988(0xc7)](0x190)[_0x3d1988(0xce)]({'error':_0x3d1988(0xdb)});}};exports[a40_0x2fa384(0xc3)]=storeFacebook;function a40_0x2542(){const _0x11c679=['subscribeApp','delete','update','-whatsapp','params','StartWhatsAppSession','whatsapp','user','body','1079608voHMbJ','596GRZWtw','__esModule','channel','../libs/wbot','../services/CompanyService/ShowCompanyService','../services/WhatsappService/DeleteWhatsAppService','removeWbot','2218689lsbWxj','query','CONNECTED','destroy','getAccessTokenFromPage','length','log','../libs/cache','../models/Whatsapp','../errors/AppError','facebook','../services/WbotServices/StartWhatsAppSession','4805646oIigNl','318793LRPTEY','../services/WhatsappService/CreateWhatsAppService','../libs/socket','Session\x20disconnected.','emit','findAll','getIO','../services/WhatsappService/ShowWhatsAppService','instagram','storeFacebook','findOne','useWhatsapp','Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!','status','../services/WhatsappService/ListWhatsAppsService','7FmWwGK','Whatsapp\x20restart.','restart','closedTickets','closeTicketsImported','json','restartWbot','18625610NoeukX','9300HOlngV','index','../services/FacebookServices/graphAPI','__importDefault','planId','push','24ocrqpe','../services/BaileysServices/DeleteBaileysService','remove','ERR_NO_PERMISSION','Facebook\x20page\x20not\x20found','../services/PlanService/ShowPlanService','3715300wVnhEB','store','default','facebookPageUserId','company-','sessions:','admin'];a40_0x2542=function(){return _0x11c679;};return a40_0x2542();}const show=async(_0x26cb1a,_0x33eb2f)=>{const _0x47ee8f=a40_0x2fa384,{whatsappId:_0xdc0287}=_0x26cb1a[_0x47ee8f(0xa0)],{companyId:_0x400994}=_0x26cb1a[_0x47ee8f(0xa3)],{session:_0x4b38d1}=_0x26cb1a['query'],_0x4dd6b7=await(0x0,ShowWhatsAppService_1[_0x47ee8f(0xdf)])(_0xdc0287,_0x400994,_0x4b38d1);return _0x33eb2f['status'](0xc8)[_0x47ee8f(0xce)](_0x4dd6b7);};exports['show']=show;const update=async(_0x249e67,_0x5d8d54)=>{const _0x121a39=a40_0x2fa384,{whatsappId:_0x3ca6b2}=_0x249e67[_0x121a39(0xa0)],_0x236d83=_0x249e67[_0x121a39(0xa4)],{companyId:_0x1f13d8}=_0x249e67['user'],{whatsapp:_0x1e85fd,oldDefaultWhatsapp:_0x32f843}=await(0x0,UpdateWhatsAppService_1['default'])({'whatsappData':_0x236d83,'whatsappId':_0x3ca6b2,'companyId':_0x1f13d8}),_0x31e4f3=(0x0,socket_1[_0x121a39(0xc0)])();return _0x31e4f3[_0x121a39(0xbe)](_0x121a39(0xe1)+_0x1f13d8+'-whatsapp',{'action':_0x121a39(0x9e),'whatsapp':_0x1e85fd}),_0x32f843&&_0x31e4f3[_0x121a39(0xbe)]('company-'+_0x1f13d8+_0x121a39(0x9f),{'action':_0x121a39(0x9e),'whatsapp':_0x32f843}),_0x5d8d54['status'](0xc8)['json'](_0x1e85fd);};exports[a40_0x2fa384(0x9e)]=update;const closedTickets=async(_0x4c92c9,_0x574657)=>{const _0x248c58=a40_0x2fa384,{whatsappId:_0x192985}=_0x4c92c9[_0x248c58(0xa0)];return(0x0,ImportWhatsAppMessageService_1[_0x248c58(0xcd)])(_0x192985),_0x574657[_0x248c58(0xc7)](0xc8)[_0x248c58(0xce)](_0x248c58(0xa2));};exports[a40_0x2fa384(0xcc)]=closedTickets;const remove=async(_0x27541f,_0xb5795d)=>{const _0xc01ad1=a40_0x2fa384,{whatsappId:_0x1b5c78}=_0x27541f['params'],{companyId:_0x3e7ad4,profile:_0xa14512}=_0x27541f[_0xc01ad1(0xa3)],_0x56dff1=(0x0,socket_1[_0xc01ad1(0xc0)])();if(_0xa14512!==_0xc01ad1(0x9b))throw new AppError_1[(_0xc01ad1(0xdf))](_0xc01ad1(0xda),0x193);const _0x42d8bc=await(0x0,ShowWhatsAppService_1[_0xc01ad1(0xdf)])(_0x1b5c78,_0x3e7ad4);_0x42d8bc[_0xc01ad1(0xa8)]===_0xc01ad1(0xa2)&&(await(0x0,DeleteBaileysService_1[_0xc01ad1(0xdf)])(_0x1b5c78),await(0x0,DeleteWhatsAppService_1[_0xc01ad1(0xdf)])(_0x1b5c78),await cache_1[_0xc01ad1(0xdf)]['delFromPattern'](_0xc01ad1(0x9a)+_0x1b5c78+':*'),(0x0,wbot_1[_0xc01ad1(0xac)])(+_0x1b5c78),_0x56dff1['emit']('company-'+_0x3e7ad4+_0xc01ad1(0x9f),{'action':_0xc01ad1(0x9d),'whatsappId':+_0x1b5c78}));if(_0x42d8bc[_0xc01ad1(0xa8)]===_0xc01ad1(0xb7)||_0x42d8bc[_0xc01ad1(0xa8)]===_0xc01ad1(0xc2)){const {facebookUserToken:_0x26b88b}=_0x42d8bc,_0xafe499=await Whatsapp_1[_0xc01ad1(0xdf)][_0xc01ad1(0xbf)]({'where':{'facebookUserToken':_0x26b88b}});await Whatsapp_1[_0xc01ad1(0xdf)][_0xc01ad1(0xb0)]({'where':{'facebookUserToken':_0x26b88b}});for await(const _0x23bde5 of _0xafe499){_0x56dff1[_0xc01ad1(0xbe)](_0xc01ad1(0xe1)+_0x3e7ad4+_0xc01ad1(0x9f),{'action':_0xc01ad1(0x9d),'whatsappId':_0x23bde5['id']});}}return _0xb5795d['status'](0xc8)[_0xc01ad1(0xce)]({'message':_0xc01ad1(0xbd)});};exports[a40_0x2fa384(0xd9)]=remove;const restart=async(_0x54a5e5,_0x1e63e0)=>{const _0x3d5cc6=a40_0x2fa384,{companyId:_0x1b54d1,profile:_0x254739}=_0x54a5e5['user'];if(_0x254739!==_0x3d5cc6(0x9b))throw new AppError_1[(_0x3d5cc6(0xdf))](_0x3d5cc6(0xda),0x193);return await(0x0,wbot_1[_0x3d5cc6(0xcf)])(_0x1b54d1),_0x1e63e0[_0x3d5cc6(0xc7)](0xc8)[_0x3d5cc6(0xce)]({'message':_0x3d5cc6(0xca)});};exports[a40_0x2fa384(0xcb)]=restart;