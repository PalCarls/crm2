'use strict';const a42_0x18528a=a42_0x1dab;(function(_0x6ebd33,_0x1f3392){const _0x487511=a42_0x1dab,_0x304f8e=_0x6ebd33();while(!![]){try{const _0x56cdaf=parseInt(_0x487511(0x105))/0x1+-parseInt(_0x487511(0xfe))/0x2+parseInt(_0x487511(0xf2))/0x3+-parseInt(_0x487511(0xe2))/0x4*(-parseInt(_0x487511(0x10f))/0x5)+-parseInt(_0x487511(0xed))/0x6+-parseInt(_0x487511(0x100))/0x7+-parseInt(_0x487511(0xd5))/0x8*(-parseInt(_0x487511(0xe0))/0x9);if(_0x56cdaf===_0x1f3392)break;else _0x304f8e['push'](_0x304f8e['shift']());}catch(_0x4605b4){_0x304f8e['push'](_0x304f8e['shift']());}}}(a42_0x40f3,0xc62ec));function a42_0x1dab(_0x40f5dd,_0x268a57){const _0x40f3d6=a42_0x40f3();return a42_0x1dab=function(_0x1dab09,_0x4811a3){_0x1dab09=_0x1dab09-0xce;let _0x1f6c3e=_0x40f3d6[_0x1dab09];return _0x1f6c3e;},a42_0x1dab(_0x40f5dd,_0x268a57);}var __importDefault=this&&this[a42_0x18528a(0xda)]||function(_0x26a5e4){return _0x26a5e4&&_0x26a5e4['__esModule']?_0x26a5e4:{'default':_0x26a5e4};};Object[a42_0x18528a(0x10c)](exports,a42_0x18528a(0xd1),{'value':!![]}),exports['showAdmin']=exports[a42_0x18528a(0xfc)]=exports[a42_0x18528a(0x107)]=exports[a42_0x18528a(0x114)]=exports['restart']=exports[a42_0x18528a(0xe3)]=exports[a42_0x18528a(0xd7)]=exports[a42_0x18528a(0xfa)]=exports[a42_0x18528a(0xe6)]=exports[a42_0x18528a(0xf7)]=exports['store']=exports[a42_0x18528a(0xd9)]=void 0x0;const socket_1=require(a42_0x18528a(0x109)),cache_1=__importDefault(require(a42_0x18528a(0xdb))),wbot_1=require('../libs/wbot'),Whatsapp_1=__importDefault(require(a42_0x18528a(0xce))),AppError_1=__importDefault(require(a42_0x18528a(0xf8))),DeleteBaileysService_1=__importDefault(require(a42_0x18528a(0xdf))),ShowCompanyService_1=__importDefault(require(a42_0x18528a(0xf5))),graphAPI_1=require('../services/FacebookServices/graphAPI'),ShowPlanService_1=__importDefault(require('../services/PlanService/ShowPlanService')),StartWhatsAppSession_1=require(a42_0x18528a(0xd0)),CreateWhatsAppService_1=__importDefault(require(a42_0x18528a(0x10e))),DeleteWhatsAppService_1=__importDefault(require(a42_0x18528a(0xe7))),ListWhatsAppsService_1=__importDefault(require(a42_0x18528a(0xe5))),ShowWhatsAppService_1=__importDefault(require('../services/WhatsappService/ShowWhatsAppService')),UpdateWhatsAppService_1=__importDefault(require(a42_0x18528a(0xfb))),ImportWhatsAppMessageService_1=require(a42_0x18528a(0xff)),ShowWhatsAppServiceAdmin_1=__importDefault(require('../services/WhatsappService/ShowWhatsAppServiceAdmin')),UpdateWhatsAppServiceAdmin_1=__importDefault(require(a42_0x18528a(0x110))),ListAllWhatsAppService_1=__importDefault(require('../services/WhatsappService/ListAllWhatsAppService')),index=async(_0x5cc580,_0x2ef183)=>{const _0x114bdd=a42_0x18528a,{companyId:_0xe11cbd}=_0x5cc580[_0x114bdd(0xf3)],{session:_0x49597b}=_0x5cc580[_0x114bdd(0xef)],_0x105ebd=await(0x0,ListWhatsAppsService_1[_0x114bdd(0x111)])({'companyId':_0xe11cbd,'session':_0x49597b});return _0x2ef183[_0x114bdd(0xf6)](0xc8)[_0x114bdd(0x103)](_0x105ebd);};exports[a42_0x18528a(0xd9)]=index;function a42_0x40f3(){const _0x1e866f=['getIO','1910565mEsdEW','user','Session\x20disconnected.','../services/CompanyService/ShowCompanyService','status','storeFacebook','../errors/AppError','restart','update','../services/WhatsappService/UpdateWhatsAppService','removeAdmin','getPageProfile','1822508HxFxRs','../services/WhatsappService/ImportWhatsAppMessageService','9184301ppGHTv','log','delete','json','CONNECTED','186902LJGCAL','findOne','updateAdmin','-whatsapp','../libs/socket','delFromPattern','emit','defineProperty','getAccessTokenFromPage','../services/WhatsappService/CreateWhatsAppService','3830dEroco','../services/WhatsappService/UpdateWhatsAppServiceAdmin','default','planId','body','listAll','restartWbot','whatsapp','facebook','../models/Whatsapp','showAdmin','../services/WbotServices/StartWhatsAppSession','__esModule','channel','Insta\x20','Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!','704nrZGHp','sessions:','closedTickets','admin','index','__importDefault','../libs/cache','admin-whatsapp','destroy','removeWbot','../services/BaileysServices/DeleteBaileysService','228384JjlJfI','ERR_NO_PERMISSION','2692dppPNM','remove','facebookPageUserId','../services/WhatsappService/ListWhatsAppsService','show','../services/WhatsappService/DeleteWhatsAppService','company-','params','Whatsapp\x20restart.','length','subscribeApp','3223860sXfsVp','Facebook\x20page\x20not\x20found','query','push'];a42_0x40f3=function(){return _0x1e866f;};return a42_0x40f3();}const store=async(_0x51ba5b,_0x36d374)=>{const _0x240fbb=a42_0x18528a,{name:_0x1781e0,status:_0x2b4a8c,isDefault:_0xb5bf7,greetingMessage:_0x106d89,complationMessage:_0x267252,outOfHoursMessage:_0x3a17fb,queueIds:_0x311233,token:_0x17231f,maxUseBotQueues:_0x32a8ea,timeUseBotQueues:_0x23b88e,expiresTicket:_0x4688ff,allowGroup:_0x17ea3d,timeSendQueue:_0xeeefff,sendIdQueue:_0x452e9d,timeInactiveMessage:_0x52f2d5,inactiveMessage:_0x377c00,ratingMessage:_0x1f26d2,maxUseBotQueuesNPS:_0x5271c4,expiresTicketNPS:_0x7cb019,whenExpiresTicket:_0x52e021,expiresInactiveMessage:_0x879338,importOldMessages:_0x511ef4,importRecentMessages:_0x1899e2,closedTicketsPostImported:_0x201a6d,importOldMessagesGroups:_0x44407b,groupAsTicket:_0x5354fe,timeCreateNewTicket:_0xa26b5a,schedules:_0x188e0d,promptId:_0x2faca8}=_0x51ba5b[_0x240fbb(0x113)],{companyId:_0x1ab117}=_0x51ba5b[_0x240fbb(0xf3)],_0x5d9909=await(0x0,ShowCompanyService_1[_0x240fbb(0x111)])(_0x1ab117),_0x17ce80=await(0x0,ShowPlanService_1['default'])(_0x5d9909[_0x240fbb(0x112)]);if(!_0x17ce80['useWhatsapp'])return _0x36d374[_0x240fbb(0xf6)](0x190)[_0x240fbb(0x103)]({'error':_0x240fbb(0xd4)});const {whatsapp:_0x4efd0b,oldDefaultWhatsapp:_0x548f00}=await(0x0,CreateWhatsAppService_1[_0x240fbb(0x111)])({'name':_0x1781e0,'status':_0x2b4a8c,'isDefault':_0xb5bf7,'greetingMessage':_0x106d89,'complationMessage':_0x267252,'outOfHoursMessage':_0x3a17fb,'queueIds':_0x311233,'companyId':_0x1ab117,'token':_0x17231f,'maxUseBotQueues':_0x32a8ea,'timeUseBotQueues':_0x23b88e,'expiresTicket':_0x4688ff,'allowGroup':_0x17ea3d,'timeSendQueue':_0xeeefff,'sendIdQueue':_0x452e9d,'timeInactiveMessage':_0x52f2d5,'inactiveMessage':_0x377c00,'ratingMessage':_0x1f26d2,'maxUseBotQueuesNPS':_0x5271c4,'expiresTicketNPS':_0x7cb019,'whenExpiresTicket':_0x52e021,'expiresInactiveMessage':_0x879338,'importOldMessages':_0x511ef4,'importRecentMessages':_0x1899e2,'closedTicketsPostImported':_0x201a6d,'importOldMessagesGroups':_0x44407b,'groupAsTicket':_0x5354fe,'timeCreateNewTicket':_0xa26b5a,'schedules':_0x188e0d,'promptId':_0x2faca8});(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x4efd0b,_0x1ab117);const _0x3deff9=(0x0,socket_1[_0x240fbb(0xf1)])();return _0x3deff9['emit'](_0x240fbb(0xe8)+_0x1ab117+'-whatsapp',{'action':_0x240fbb(0xfa),'whatsapp':_0x4efd0b}),_0x548f00&&_0x3deff9[_0x240fbb(0x10b)]('company-'+_0x1ab117+_0x240fbb(0x108),{'action':_0x240fbb(0xfa),'whatsapp':_0x548f00}),_0x36d374[_0x240fbb(0xf6)](0xc8)['json'](_0x4efd0b);};exports['store']=store;const storeFacebook=async(_0x1fbd7e,_0x4b8506)=>{const _0x3b8dd1=a42_0x18528a;try{const {facebookUserId:_0x327726,facebookUserToken:_0x1ef372,addInstagram:_0x84ff55}=_0x1fbd7e[_0x3b8dd1(0x113)],{companyId:_0x529c1a}=_0x1fbd7e[_0x3b8dd1(0xf3)],{data:_0x24a41d}=await(0x0,graphAPI_1[_0x3b8dd1(0xfd)])(_0x327726,_0x1ef372);if(_0x24a41d[_0x3b8dd1(0xeb)]===0x0)return _0x4b8506[_0x3b8dd1(0xf6)](0x190)[_0x3b8dd1(0x103)]({'error':_0x3b8dd1(0xee)});const _0x20ac97=(0x0,socket_1['getIO'])(),_0x83e96f=[];for await(const _0x2dd573 of _0x24a41d){const {name:_0x4b27e1,access_token:_0x2c83c3,id:_0x3507fd,instagram_business_account:_0xf8fbf5}=_0x2dd573,_0x29505=await(0x0,graphAPI_1[_0x3b8dd1(0x10d)])(_0x2c83c3);if(_0xf8fbf5&&_0x84ff55){const {id:_0xb617e5,username:_0x25928c,name:_0x23f3a0}=_0xf8fbf5;_0x83e96f[_0x3b8dd1(0xf0)]({'companyId':_0x529c1a,'name':_0x3b8dd1(0xd3)+(_0x25928c||_0x23f3a0),'facebookUserId':_0x327726,'facebookPageUserId':_0xb617e5,'facebookUserToken':_0x29505,'tokenMeta':_0x1ef372,'isDefault':![],'channel':'instagram','status':_0x3b8dd1(0x104),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x83e96f['push']({'companyId':_0x529c1a,'name':_0x4b27e1,'facebookUserId':_0x327726,'facebookPageUserId':_0x3507fd,'facebookUserToken':_0x29505,'tokenMeta':_0x1ef372,'isDefault':![],'channel':_0x3b8dd1(0x117),'status':'CONNECTED','greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1['subscribeApp'])(_0x3507fd,_0x29505);}!_0xf8fbf5&&(_0x83e96f[_0x3b8dd1(0xf0)]({'companyId':_0x529c1a,'name':_0x4b27e1,'facebookUserId':_0x327726,'facebookPageUserId':_0x3507fd,'facebookUserToken':_0x29505,'tokenMeta':_0x1ef372,'isDefault':![],'channel':_0x3b8dd1(0x117),'status':_0x3b8dd1(0x104),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x3b8dd1(0xec)])(_0x2dd573['id'],_0x29505));}for await(const _0x18bdef of _0x83e96f){const _0x14f30a=await Whatsapp_1[_0x3b8dd1(0x111)][_0x3b8dd1(0x106)]({'where':{'facebookPageUserId':_0x18bdef[_0x3b8dd1(0xe4)]}});_0x14f30a&&await _0x14f30a[_0x3b8dd1(0xfa)]({..._0x18bdef});if(!_0x14f30a){const {whatsapp:_0x3e4173}=await(0x0,CreateWhatsAppService_1[_0x3b8dd1(0x111)])(_0x18bdef);_0x20ac97[_0x3b8dd1(0x10b)](_0x3b8dd1(0xe8)+_0x529c1a+'-whatsapp',{'action':_0x3b8dd1(0xfa),'whatsapp':_0x3e4173});}}return _0x4b8506[_0x3b8dd1(0xf6)](0xc8);}catch(_0x395f0a){return console[_0x3b8dd1(0x101)](_0x395f0a),_0x4b8506[_0x3b8dd1(0xf6)](0x190)[_0x3b8dd1(0x103)]({'error':_0x3b8dd1(0xee)});}};exports['storeFacebook']=storeFacebook;const show=async(_0x2bd533,_0x353565)=>{const _0x2038a3=a42_0x18528a,{whatsappId:_0x59e7a9}=_0x2bd533[_0x2038a3(0xe9)],{companyId:_0x55a3f6}=_0x2bd533[_0x2038a3(0xf3)],{session:_0x1349c8}=_0x2bd533[_0x2038a3(0xef)],_0x2223de=await(0x0,ShowWhatsAppService_1[_0x2038a3(0x111)])(_0x59e7a9,_0x55a3f6,_0x1349c8);return _0x353565[_0x2038a3(0xf6)](0xc8)[_0x2038a3(0x103)](_0x2223de);};exports[a42_0x18528a(0xe6)]=show;const update=async(_0x39bd60,_0x30ce67)=>{const _0x49ca8b=a42_0x18528a,{whatsappId:_0x3c0e9a}=_0x39bd60[_0x49ca8b(0xe9)],_0x392a12=_0x39bd60[_0x49ca8b(0x113)],{companyId:_0x9a241c}=_0x39bd60[_0x49ca8b(0xf3)],{whatsapp:_0x3807cc,oldDefaultWhatsapp:_0x178609}=await(0x0,UpdateWhatsAppService_1['default'])({'whatsappData':_0x392a12,'whatsappId':_0x3c0e9a,'companyId':_0x9a241c}),_0x1dbe30=(0x0,socket_1[_0x49ca8b(0xf1)])();return _0x1dbe30[_0x49ca8b(0x10b)](_0x49ca8b(0xe8)+_0x9a241c+_0x49ca8b(0x108),{'action':_0x49ca8b(0xfa),'whatsapp':_0x3807cc}),_0x178609&&_0x1dbe30[_0x49ca8b(0x10b)](_0x49ca8b(0xe8)+_0x9a241c+_0x49ca8b(0x108),{'action':'update','whatsapp':_0x178609}),_0x30ce67[_0x49ca8b(0xf6)](0xc8)['json'](_0x3807cc);};exports[a42_0x18528a(0xfa)]=update;const closedTickets=async(_0x4a3551,_0x54ab38)=>{const _0xcde6ad=a42_0x18528a,{whatsappId:_0x2333c9}=_0x4a3551['params'];return(0x0,ImportWhatsAppMessageService_1['closeTicketsImported'])(_0x2333c9),_0x54ab38[_0xcde6ad(0xf6)](0xc8)['json'](_0xcde6ad(0x116));};exports[a42_0x18528a(0xd7)]=closedTickets;const remove=async(_0x348440,_0x110ee3)=>{const _0x2d0040=a42_0x18528a,{whatsappId:_0x422604}=_0x348440[_0x2d0040(0xe9)],{companyId:_0x55af4a,profile:_0x2b0205}=_0x348440['user'],_0x7edb73=(0x0,socket_1[_0x2d0040(0xf1)])();if(_0x2b0205!==_0x2d0040(0xd8))throw new AppError_1['default'](_0x2d0040(0xe1),0x193);const _0x356b43=await(0x0,ShowWhatsAppService_1['default'])(_0x422604,_0x55af4a);_0x356b43[_0x2d0040(0xd2)]==='whatsapp'&&(await(0x0,DeleteBaileysService_1[_0x2d0040(0x111)])(_0x422604),await(0x0,DeleteWhatsAppService_1['default'])(_0x422604),await cache_1['default'][_0x2d0040(0x10a)]('sessions:'+_0x422604+':*'),(0x0,wbot_1[_0x2d0040(0xde)])(+_0x422604),_0x7edb73['emit'](_0x2d0040(0xe8)+_0x55af4a+_0x2d0040(0x108),{'action':'delete','whatsappId':+_0x422604}));if(_0x356b43[_0x2d0040(0xd2)]==='facebook'||_0x356b43[_0x2d0040(0xd2)]==='instagram'){const {facebookUserToken:_0x5edb70}=_0x356b43,_0x2f2aa1=await Whatsapp_1[_0x2d0040(0x111)]['findAll']({'where':{'facebookUserToken':_0x5edb70}});await Whatsapp_1[_0x2d0040(0x111)][_0x2d0040(0xdd)]({'where':{'facebookUserToken':_0x5edb70}});for await(const _0x4af61b of _0x2f2aa1){_0x7edb73[_0x2d0040(0x10b)](_0x2d0040(0xe8)+_0x55af4a+_0x2d0040(0x108),{'action':'delete','whatsappId':_0x4af61b['id']});}}return _0x110ee3[_0x2d0040(0xf6)](0xc8)[_0x2d0040(0x103)]({'message':_0x2d0040(0xf4)});};exports['remove']=remove;const restart=async(_0x5098cb,_0x37906b)=>{const _0x5a506c=a42_0x18528a,{companyId:_0x3fce63,profile:_0x110d41}=_0x5098cb['user'];if(_0x110d41!==_0x5a506c(0xd8))throw new AppError_1[(_0x5a506c(0x111))](_0x5a506c(0xe1),0x193);return await(0x0,wbot_1[_0x5a506c(0x115)])(_0x3fce63),_0x37906b[_0x5a506c(0xf6)](0xc8)[_0x5a506c(0x103)]({'message':_0x5a506c(0xea)});};exports[a42_0x18528a(0xf9)]=restart;const listAll=async(_0x19f649,_0x1f5a62)=>{const _0x4b8d42=a42_0x18528a,{companyId:_0x5df70f}=_0x19f649['user'],{session:_0x4093b8}=_0x19f649[_0x4b8d42(0xef)],_0x2fcd3f=await(0x0,ListAllWhatsAppService_1[_0x4b8d42(0x111)])({'session':_0x4093b8});return _0x1f5a62['status'](0xc8)[_0x4b8d42(0x103)](_0x2fcd3f);};exports['listAll']=listAll;const updateAdmin=async(_0x518e4c,_0x3c8b4e)=>{const _0x48a00a=a42_0x18528a,{whatsappId:_0x3f7ad2}=_0x518e4c[_0x48a00a(0xe9)],_0x11ef07=_0x518e4c[_0x48a00a(0x113)],{companyId:_0x32a019}=_0x518e4c['user'],{whatsapp:_0x42fcae,oldDefaultWhatsapp:_0x7f9367}=await(0x0,UpdateWhatsAppServiceAdmin_1[_0x48a00a(0x111)])({'whatsappData':_0x11ef07,'whatsappId':_0x3f7ad2,'companyId':_0x32a019}),_0x178c25=(0x0,socket_1[_0x48a00a(0xf1)])();return _0x178c25[_0x48a00a(0x10b)](_0x48a00a(0xdc),{'action':_0x48a00a(0xfa),'whatsapp':_0x42fcae}),_0x7f9367&&_0x178c25[_0x48a00a(0x10b)](_0x48a00a(0xdc),{'action':_0x48a00a(0xfa),'whatsapp':_0x7f9367}),_0x3c8b4e[_0x48a00a(0xf6)](0xc8)[_0x48a00a(0x103)](_0x42fcae);};exports[a42_0x18528a(0x107)]=updateAdmin;const removeAdmin=async(_0x2e0008,_0x37b732)=>{const _0x12b181=a42_0x18528a,{whatsappId:_0x1a3228}=_0x2e0008['params'],{companyId:_0x5344f3}=_0x2e0008['user'],_0x3dd7b1=(0x0,socket_1['getIO'])(),_0x2de90c=await(0x0,ShowWhatsAppService_1[_0x12b181(0x111)])(_0x1a3228,_0x5344f3);_0x2de90c[_0x12b181(0xd2)]==='whatsapp'&&(await(0x0,DeleteBaileysService_1[_0x12b181(0x111)])(_0x1a3228),await(0x0,DeleteWhatsAppService_1[_0x12b181(0x111)])(_0x1a3228),await cache_1[_0x12b181(0x111)][_0x12b181(0x10a)](_0x12b181(0xd6)+_0x1a3228+':*'),(0x0,wbot_1[_0x12b181(0xde)])(+_0x1a3228),_0x3dd7b1[_0x12b181(0x10b)]('admin-whatsapp',{'action':_0x12b181(0x102),'whatsappId':+_0x1a3228}));if(_0x2de90c[_0x12b181(0xd2)]===_0x12b181(0x117)||_0x2de90c[_0x12b181(0xd2)]==='instagram'){const {facebookUserToken:_0x8ae111}=_0x2de90c,_0x873317=await Whatsapp_1[_0x12b181(0x111)]['findAll']({'where':{'facebookUserToken':_0x8ae111}});await Whatsapp_1['default'][_0x12b181(0xdd)]({'where':{'facebookUserToken':_0x8ae111}});for await(const _0xb134e3 of _0x873317){_0x3dd7b1[_0x12b181(0x10b)](_0x12b181(0xe8)+_0x5344f3+_0x12b181(0x108),{'action':'delete','whatsappId':_0xb134e3['id']});}}return _0x37b732['status'](0xc8)['json']({'message':_0x12b181(0xf4)});};exports['removeAdmin']=removeAdmin;const showAdmin=async(_0x448470,_0x397cb3)=>{const _0x49cdc8=a42_0x18528a,{whatsappId:_0x1adce5}=_0x448470[_0x49cdc8(0xe9)],{companyId:_0x1806cb}=_0x448470['user'],_0x5b6525=await(0x0,ShowWhatsAppServiceAdmin_1['default'])(_0x1adce5);return _0x397cb3[_0x49cdc8(0xf6)](0xc8)[_0x49cdc8(0x103)](_0x5b6525);};exports[a42_0x18528a(0xcf)]=showAdmin;