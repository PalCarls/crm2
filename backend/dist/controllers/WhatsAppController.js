'use strict';const a42_0x2303c4=a42_0x2582;(function(_0x3d1166,_0x316339){const _0x3cf0c3=a42_0x2582,_0x1d9412=_0x3d1166();while(!![]){try{const _0x8671ed=-parseInt(_0x3cf0c3(0x15b))/0x1+-parseInt(_0x3cf0c3(0x154))/0x2*(-parseInt(_0x3cf0c3(0x12f))/0x3)+-parseInt(_0x3cf0c3(0x124))/0x4*(-parseInt(_0x3cf0c3(0x143))/0x5)+parseInt(_0x3cf0c3(0x134))/0x6+-parseInt(_0x3cf0c3(0x12b))/0x7*(parseInt(_0x3cf0c3(0x12d))/0x8)+-parseInt(_0x3cf0c3(0x139))/0x9*(parseInt(_0x3cf0c3(0x135))/0xa)+parseInt(_0x3cf0c3(0x14b))/0xb;if(_0x8671ed===_0x316339)break;else _0x1d9412['push'](_0x1d9412['shift']());}catch(_0x1a8cdf){_0x1d9412['push'](_0x1d9412['shift']());}}}(a42_0x5c12,0x5f4d2));var __importDefault=this&&this['__importDefault']||function(_0x400216){const _0x5470f9=a42_0x2582;return _0x400216&&_0x400216[_0x5470f9(0x11e)]?_0x400216:{'default':_0x400216};};Object[a42_0x2303c4(0x11a)](exports,a42_0x2303c4(0x11e),{'value':!![]}),exports[a42_0x2303c4(0x11f)]=exports['remove']=exports[a42_0x2303c4(0x129)]=exports[a42_0x2303c4(0x130)]=exports[a42_0x2303c4(0x15d)]=exports['storeFacebook']=exports[a42_0x2303c4(0x144)]=exports[a42_0x2303c4(0x133)]=void 0x0;const socket_1=require(a42_0x2303c4(0x136)),cache_1=__importDefault(require(a42_0x2303c4(0x155))),wbot_1=require('../libs/wbot'),Whatsapp_1=__importDefault(require('../models/Whatsapp')),AppError_1=__importDefault(require(a42_0x2303c4(0x11b))),DeleteBaileysService_1=__importDefault(require('../services/BaileysServices/DeleteBaileysService')),ShowCompanyService_1=__importDefault(require(a42_0x2303c4(0x120))),graphAPI_1=require('../services/FacebookServices/graphAPI'),ShowPlanService_1=__importDefault(require(a42_0x2303c4(0x121))),StartWhatsAppSession_1=require(a42_0x2303c4(0x132)),CreateWhatsAppService_1=__importDefault(require(a42_0x2303c4(0x122))),DeleteWhatsAppService_1=__importDefault(require(a42_0x2303c4(0x13a))),ListWhatsAppsService_1=__importDefault(require(a42_0x2303c4(0x14c))),ShowWhatsAppService_1=__importDefault(require('../services/WhatsappService/ShowWhatsAppService')),UpdateWhatsAppService_1=__importDefault(require(a42_0x2303c4(0x146))),ImportWhatsAppMessageService_1=require(a42_0x2303c4(0x125)),index=async(_0x2bf83a,_0x1078bb)=>{const _0x38eeea=a42_0x2303c4,{companyId:_0x3f6aba}=_0x2bf83a['user'],{session:_0xc01852}=_0x2bf83a['query'],_0x57591e=await(0x0,ListWhatsAppsService_1[_0x38eeea(0x156)])({'companyId':_0x3f6aba,'session':_0xc01852});return _0x1078bb[_0x38eeea(0x13c)](0xc8)[_0x38eeea(0x158)](_0x57591e);};exports[a42_0x2303c4(0x133)]=index;const store=async(_0x75b504,_0x4efb42)=>{const _0x186654=a42_0x2303c4,{name:_0x3f47da,status:_0x42814d,isDefault:_0x8d1f98,greetingMessage:_0x297f3e,complationMessage:_0x52451d,outOfHoursMessage:_0x4e205b,queueIds:_0xac6d62,token:_0x150dd0,maxUseBotQueues:_0x572f31,timeUseBotQueues:_0x2f6fde,expiresTicket:_0x5bc28d,allowGroup:_0x1602de,timeSendQueue:_0x2db607,sendIdQueue:_0x4a812f,timeInactiveMessage:_0x4c0de2,inactiveMessage:_0xbad273,ratingMessage:_0x35527c,maxUseBotQueuesNPS:_0x3479be,expiresTicketNPS:_0x22ede5,whenExpiresTicket:_0x21d7b8,expiresInactiveMessage:_0xadda0f,importOldMessages:_0x2876e1,importRecentMessages:_0x58b749,closedTicketsPostImported:_0x14650a,importOldMessagesGroups:_0x4e9e0b,groupAsTicket:_0x58e11e,timeCreateNewTicket:_0x47b03c,schedules:_0x1e9714,promptId:_0x5894c3}=_0x75b504[_0x186654(0x149)],{companyId:_0x3d696e}=_0x75b504[_0x186654(0x15a)],_0x4271d3=await(0x0,ShowCompanyService_1[_0x186654(0x156)])(_0x3d696e),_0x4705f9=await(0x0,ShowPlanService_1[_0x186654(0x156)])(_0x4271d3[_0x186654(0x141)]);if(!_0x4705f9['useWhatsapp'])return _0x4efb42[_0x186654(0x13c)](0x190)[_0x186654(0x158)]({'error':'Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!'});const {whatsapp:_0x3d12dd,oldDefaultWhatsapp:_0x1ade59}=await(0x0,CreateWhatsAppService_1[_0x186654(0x156)])({'name':_0x3f47da,'status':_0x42814d,'isDefault':_0x8d1f98,'greetingMessage':_0x297f3e,'complationMessage':_0x52451d,'outOfHoursMessage':_0x4e205b,'queueIds':_0xac6d62,'companyId':_0x3d696e,'token':_0x150dd0,'maxUseBotQueues':_0x572f31,'timeUseBotQueues':_0x2f6fde,'expiresTicket':_0x5bc28d,'allowGroup':_0x1602de,'timeSendQueue':_0x2db607,'sendIdQueue':_0x4a812f,'timeInactiveMessage':_0x4c0de2,'inactiveMessage':_0xbad273,'ratingMessage':_0x35527c,'maxUseBotQueuesNPS':_0x3479be,'expiresTicketNPS':_0x22ede5,'whenExpiresTicket':_0x21d7b8,'expiresInactiveMessage':_0xadda0f,'importOldMessages':_0x2876e1,'importRecentMessages':_0x58b749,'closedTicketsPostImported':_0x14650a,'importOldMessagesGroups':_0x4e9e0b,'groupAsTicket':_0x58e11e,'timeCreateNewTicket':_0x47b03c,'schedules':_0x1e9714,'promptId':_0x5894c3});(0x0,StartWhatsAppSession_1[_0x186654(0x138)])(_0x3d12dd,_0x3d696e);const _0x395881=(0x0,socket_1[_0x186654(0x15c)])();return _0x395881[_0x186654(0x157)](_0x186654(0x148)+_0x3d696e+_0x186654(0x159),{'action':'update','whatsapp':_0x3d12dd}),_0x1ade59&&_0x395881[_0x186654(0x157)](_0x186654(0x148)+_0x3d696e+_0x186654(0x159),{'action':'update','whatsapp':_0x1ade59}),_0x4efb42['status'](0xc8)[_0x186654(0x158)](_0x3d12dd);};exports['store']=store;const storeFacebook=async(_0x14884a,_0x5b06b3)=>{const _0x4de088=a42_0x2303c4;try{const {facebookUserId:_0x374e01,facebookUserToken:_0x115610,addInstagram:_0x4b127f}=_0x14884a[_0x4de088(0x149)],{companyId:_0xda59cd}=_0x14884a[_0x4de088(0x15a)],{data:_0x1bc5bf}=await(0x0,graphAPI_1[_0x4de088(0x126)])(_0x374e01,_0x115610);if(_0x1bc5bf['length']===0x0)return _0x5b06b3[_0x4de088(0x13c)](0x190)['json']({'error':_0x4de088(0x151)});const _0x4693f1=(0x0,socket_1['getIO'])(),_0x5777c8=[];for await(const _0x2e8017 of _0x1bc5bf){const {name:_0x1e9f7e,access_token:_0x2c4764,id:_0x4292c8,instagram_business_account:_0x43d08e}=_0x2e8017,_0x14e970=await(0x0,graphAPI_1['getAccessTokenFromPage'])(_0x2c4764);if(_0x43d08e&&_0x4b127f){const {id:_0x363337,username:_0x7e418,name:_0x548f86}=_0x43d08e;_0x5777c8[_0x4de088(0x13d)]({'companyId':_0xda59cd,'name':'Insta\x20'+(_0x7e418||_0x548f86),'facebookUserId':_0x374e01,'facebookPageUserId':_0x363337,'facebookUserToken':_0x14e970,'tokenMeta':_0x115610,'isDefault':![],'channel':_0x4de088(0x13b),'status':'CONNECTED','greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x5777c8[_0x4de088(0x13d)]({'companyId':_0xda59cd,'name':_0x1e9f7e,'facebookUserId':_0x374e01,'facebookPageUserId':_0x4292c8,'facebookUserToken':_0x14e970,'tokenMeta':_0x115610,'isDefault':![],'channel':_0x4de088(0x13e),'status':_0x4de088(0x147),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x4de088(0x11d)])(_0x4292c8,_0x14e970);}!_0x43d08e&&(_0x5777c8[_0x4de088(0x13d)]({'companyId':_0xda59cd,'name':_0x1e9f7e,'facebookUserId':_0x374e01,'facebookPageUserId':_0x4292c8,'facebookUserToken':_0x14e970,'tokenMeta':_0x115610,'isDefault':![],'channel':_0x4de088(0x13e),'status':'CONNECTED','greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1['subscribeApp'])(_0x2e8017['id'],_0x14e970));}for await(const _0x3ef89d of _0x5777c8){const _0x146225=await Whatsapp_1[_0x4de088(0x156)]['findOne']({'where':{'facebookPageUserId':_0x3ef89d[_0x4de088(0x152)]}});_0x146225&&await _0x146225['update']({..._0x3ef89d});if(!_0x146225){const {whatsapp:_0x1d575e}=await(0x0,CreateWhatsAppService_1['default'])(_0x3ef89d);_0x4693f1[_0x4de088(0x157)](_0x4de088(0x148)+_0xda59cd+_0x4de088(0x159),{'action':'update','whatsapp':_0x1d575e});}}return _0x5b06b3[_0x4de088(0x13c)](0xc8);}catch(_0x5092c2){return console[_0x4de088(0x14d)](_0x5092c2),_0x5b06b3[_0x4de088(0x13c)](0x190)['json']({'error':'Facebook\x20page\x20not\x20found'});}};exports[a42_0x2303c4(0x145)]=storeFacebook;const show=async(_0x1748b7,_0x3a476b)=>{const _0x13e4f0=a42_0x2303c4,{whatsappId:_0x2fed02}=_0x1748b7['params'],{companyId:_0x4c3775}=_0x1748b7[_0x13e4f0(0x15a)],{session:_0x372011}=_0x1748b7[_0x13e4f0(0x153)],_0x45a023=await(0x0,ShowWhatsAppService_1[_0x13e4f0(0x156)])(_0x2fed02,_0x4c3775,_0x372011);return _0x3a476b[_0x13e4f0(0x13c)](0xc8)[_0x13e4f0(0x158)](_0x45a023);};exports[a42_0x2303c4(0x15d)]=show;function a42_0x2582(_0x17d4f1,_0x2b4753){const _0x5c1260=a42_0x5c12();return a42_0x2582=function(_0x258224,_0x3cc561){_0x258224=_0x258224-0x11a;let _0x4a444f=_0x5c1260[_0x258224];return _0x4a444f;},a42_0x2582(_0x17d4f1,_0x2b4753);}const update=async(_0x10f4aa,_0x4ab73f)=>{const _0x4a65a2=a42_0x2303c4,{whatsappId:_0x3be438}=_0x10f4aa['params'],_0x51e2cb=_0x10f4aa[_0x4a65a2(0x149)],{companyId:_0x20ebf7}=_0x10f4aa[_0x4a65a2(0x15a)],{whatsapp:_0x303cba,oldDefaultWhatsapp:_0x3f02c7}=await(0x0,UpdateWhatsAppService_1[_0x4a65a2(0x156)])({'whatsappData':_0x51e2cb,'whatsappId':_0x3be438,'companyId':_0x20ebf7}),_0x461b7b=(0x0,socket_1[_0x4a65a2(0x15c)])();return _0x461b7b[_0x4a65a2(0x157)](_0x4a65a2(0x148)+_0x20ebf7+_0x4a65a2(0x159),{'action':_0x4a65a2(0x130),'whatsapp':_0x303cba}),_0x3f02c7&&_0x461b7b['emit'](_0x4a65a2(0x148)+_0x20ebf7+_0x4a65a2(0x159),{'action':_0x4a65a2(0x130),'whatsapp':_0x3f02c7}),_0x4ab73f['status'](0xc8)[_0x4a65a2(0x158)](_0x303cba);};exports['update']=update;const closedTickets=async(_0x57f008,_0x167152)=>{const _0x1375bd=a42_0x2303c4,{whatsappId:_0x21e833}=_0x57f008[_0x1375bd(0x150)];return(0x0,ImportWhatsAppMessageService_1[_0x1375bd(0x140)])(_0x21e833),_0x167152[_0x1375bd(0x13c)](0xc8)[_0x1375bd(0x158)](_0x1375bd(0x11c));};function a42_0x5c12(){const _0x130b7c=['planId','channel','205HXaRry','store','storeFacebook','../services/WhatsappService/UpdateWhatsAppService','CONNECTED','company-','body','Session\x20disconnected.','2519088PMBNKn','../services/WhatsappService/ListWhatsAppsService','log','sessions:','delFromPattern','params','Facebook\x20page\x20not\x20found','facebookPageUserId','query','6LkXoIV','../libs/cache','default','emit','json','-whatsapp','user','389370FjSwTi','getIO','show','defineProperty','../errors/AppError','whatsapp','subscribeApp','__esModule','restart','../services/CompanyService/ShowCompanyService','../services/PlanService/ShowPlanService','../services/WhatsappService/CreateWhatsAppService','findAll','22748ZVqtjx','../services/WhatsappService/ImportWhatsAppMessageService','getPageProfile','remove','admin','closedTickets','Whatsapp\x20restart.','3269QGShhk','delete','2848ALElko','destroy','668757OIMpPF','update','restartWbot','../services/WbotServices/StartWhatsAppSession','index','337086YpbsEk','10530YIELdy','../libs/socket','ERR_NO_PERMISSION','StartWhatsAppSession','2061bewQSO','../services/WhatsappService/DeleteWhatsAppService','instagram','status','push','facebook','removeWbot','closeTicketsImported'];a42_0x5c12=function(){return _0x130b7c;};return a42_0x5c12();}exports[a42_0x2303c4(0x129)]=closedTickets;const remove=async(_0x4b597b,_0x3d2c34)=>{const _0x11b754=a42_0x2303c4,{whatsappId:_0x4e1b4e}=_0x4b597b['params'],{companyId:_0x5548c7,profile:_0x26152c}=_0x4b597b[_0x11b754(0x15a)],_0x392ea1=(0x0,socket_1[_0x11b754(0x15c)])();if(_0x26152c!==_0x11b754(0x128))throw new AppError_1[(_0x11b754(0x156))](_0x11b754(0x137),0x193);const _0x578b43=await(0x0,ShowWhatsAppService_1[_0x11b754(0x156)])(_0x4e1b4e,_0x5548c7);_0x578b43[_0x11b754(0x142)]===_0x11b754(0x11c)&&(await(0x0,DeleteBaileysService_1['default'])(_0x4e1b4e),await(0x0,DeleteWhatsAppService_1[_0x11b754(0x156)])(_0x4e1b4e),await cache_1[_0x11b754(0x156)][_0x11b754(0x14f)](_0x11b754(0x14e)+_0x4e1b4e+':*'),(0x0,wbot_1[_0x11b754(0x13f)])(+_0x4e1b4e),_0x392ea1['emit'](_0x11b754(0x148)+_0x5548c7+'-whatsapp',{'action':_0x11b754(0x12c),'whatsappId':+_0x4e1b4e}));if(_0x578b43['channel']===_0x11b754(0x13e)||_0x578b43['channel']===_0x11b754(0x13b)){const {facebookUserToken:_0xe775c9}=_0x578b43,_0x588edf=await Whatsapp_1['default'][_0x11b754(0x123)]({'where':{'facebookUserToken':_0xe775c9}});await Whatsapp_1[_0x11b754(0x156)][_0x11b754(0x12e)]({'where':{'facebookUserToken':_0xe775c9}});for await(const _0x4c75c0 of _0x588edf){_0x392ea1[_0x11b754(0x157)](_0x11b754(0x148)+_0x5548c7+_0x11b754(0x159),{'action':_0x11b754(0x12c),'whatsappId':_0x4c75c0['id']});}}return _0x3d2c34[_0x11b754(0x13c)](0xc8)[_0x11b754(0x158)]({'message':_0x11b754(0x14a)});};exports[a42_0x2303c4(0x127)]=remove;const restart=async(_0x5e74dc,_0xfdda8e)=>{const _0x34f71d=a42_0x2303c4,{companyId:_0x5a4c85,profile:_0x2364b2}=_0x5e74dc[_0x34f71d(0x15a)];if(_0x2364b2!==_0x34f71d(0x128))throw new AppError_1[(_0x34f71d(0x156))](_0x34f71d(0x137),0x193);return await(0x0,wbot_1[_0x34f71d(0x131)])(_0x5a4c85),_0xfdda8e[_0x34f71d(0x13c)](0xc8)['json']({'message':_0x34f71d(0x12a)});};exports[a42_0x2303c4(0x11f)]=restart;