'use strict';function a39_0x4782(){const _0x5e9da9=['88CcVbkT','../models/Whatsapp','CONNECTED','restart','useWhatsapp','instagram','defineProperty','length','getPageProfile','status','1TbiYRR','../services/WhatsappService/ListWhatsAppsService','facebook','766004IurGCC','../services/FacebookServices/graphAPI','body','remove','__importDefault','default','1661210JIFIeM','query','../errors/AppError','restartWbot','destroy','../services/WhatsappService/ShowWhatsAppService','Whatsapp\x20restart.','Facebook\x20page\x20not\x20found','186eTjJRo','../services/BaileysServices/DeleteBaileysService','whatsapp','__esModule','-whatsapp','315420jDEXgZ','index','Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!','../services/WbotServices/StartWhatsAppSession','delete','store','StartWhatsAppSession','../libs/socket','ERR_NO_PERMISSION','3uvnWzL','update','31325wPHEKI','99845gnepfT','emit','closedTickets','log','json','../libs/cache','getAccessTokenFromPage','12IsFYaV','show','../services/PlanService/ShowPlanService','push','channel','Session\x20disconnected.','getIO','../services/WhatsappService/UpdateWhatsAppService','../services/WhatsappService/ImportWhatsAppMessageService','user','storeFacebook','admin','params','8796469myiaWG','4640670YFbRis','subscribeApp','company-'];a39_0x4782=function(){return _0x5e9da9;};return a39_0x4782();}const a39_0x356942=a39_0x345d;(function(_0x1facb9,_0x3c53ea){const _0x49b287=a39_0x345d,_0x477ca7=_0x1facb9();while(!![]){try{const _0x2f04ed=-parseInt(_0x49b287(0x130))/0x1*(parseInt(_0x49b287(0x133))/0x2)+parseInt(_0x49b287(0x14f))/0x3*(-parseInt(_0x49b287(0x146))/0x4)+-parseInt(_0x49b287(0x152))/0x5*(-parseInt(_0x49b287(0x141))/0x6)+parseInt(_0x49b287(0x151))/0x7*(parseInt(_0x49b287(0x126))/0x8)+-parseInt(_0x49b287(0x123))/0x9+-parseInt(_0x49b287(0x139))/0xa+-parseInt(_0x49b287(0x122))/0xb*(-parseInt(_0x49b287(0x159))/0xc);if(_0x2f04ed===_0x3c53ea)break;else _0x477ca7['push'](_0x477ca7['shift']());}catch(_0x4acbdf){_0x477ca7['push'](_0x477ca7['shift']());}}}(a39_0x4782,0x4f2ef));var __importDefault=this&&this[a39_0x356942(0x137)]||function(_0x57d919){const _0x4e7afb=a39_0x356942;return _0x57d919&&_0x57d919[_0x4e7afb(0x144)]?_0x57d919:{'default':_0x57d919};};Object[a39_0x356942(0x12c)](exports,'__esModule',{'value':!![]}),exports['restart']=exports[a39_0x356942(0x136)]=exports['closedTickets']=exports[a39_0x356942(0x150)]=exports[a39_0x356942(0x116)]=exports[a39_0x356942(0x11f)]=exports[a39_0x356942(0x14b)]=exports['index']=void 0x0;function a39_0x345d(_0xc04483,_0x382a23){const _0x4782a8=a39_0x4782();return a39_0x345d=function(_0x345d82,_0x1252e6){_0x345d82=_0x345d82-0x116;let _0x32aacc=_0x4782a8[_0x345d82];return _0x32aacc;},a39_0x345d(_0xc04483,_0x382a23);}const socket_1=require(a39_0x356942(0x14d)),cache_1=__importDefault(require(a39_0x356942(0x157))),wbot_1=require('../libs/wbot'),Whatsapp_1=__importDefault(require(a39_0x356942(0x127))),AppError_1=__importDefault(require(a39_0x356942(0x13b))),DeleteBaileysService_1=__importDefault(require(a39_0x356942(0x142))),ShowCompanyService_1=__importDefault(require('../services/CompanyService/ShowCompanyService')),graphAPI_1=require(a39_0x356942(0x134)),ShowPlanService_1=__importDefault(require(a39_0x356942(0x117))),StartWhatsAppSession_1=require(a39_0x356942(0x149)),CreateWhatsAppService_1=__importDefault(require('../services/WhatsappService/CreateWhatsAppService')),DeleteWhatsAppService_1=__importDefault(require('../services/WhatsappService/DeleteWhatsAppService')),ListWhatsAppsService_1=__importDefault(require(a39_0x356942(0x131))),ShowWhatsAppService_1=__importDefault(require(a39_0x356942(0x13e))),UpdateWhatsAppService_1=__importDefault(require(a39_0x356942(0x11c))),ImportWhatsAppMessageService_1=require(a39_0x356942(0x11d)),index=async(_0x32d9b2,_0xf47a54)=>{const _0x4f9e2f=a39_0x356942,{companyId:_0x16a254}=_0x32d9b2['user'],{session:_0x167021}=_0x32d9b2['query'],_0x6aa286=await(0x0,ListWhatsAppsService_1[_0x4f9e2f(0x138)])({'companyId':_0x16a254,'session':_0x167021});return _0xf47a54[_0x4f9e2f(0x12f)](0xc8)[_0x4f9e2f(0x156)](_0x6aa286);};exports[a39_0x356942(0x147)]=index;const store=async(_0x25e023,_0x31f9f5)=>{const _0x13d2fd=a39_0x356942,{name:_0x3e4878,status:_0x5e9140,isDefault:_0xcd8cc2,greetingMessage:_0x3ef0c4,complationMessage:_0x33f366,outOfHoursMessage:_0x11813f,queueIds:_0x4cc6ff,token:_0x52221d,maxUseBotQueues:_0x2d6e61,timeUseBotQueues:_0x1007f4,expiresTicket:_0x296e97,allowGroup:_0x31e339,timeSendQueue:_0x6e9feb,sendIdQueue:_0x3ff790,timeInactiveMessage:_0x451035,inactiveMessage:_0x2d00d7,ratingMessage:_0x5f6e4a,maxUseBotQueuesNPS:_0x15168f,expiresTicketNPS:_0x591fa4,whenExpiresTicket:_0x101885,expiresInactiveMessage:_0x44b498,importOldMessages:_0x324797,importRecentMessages:_0x3aa70f,closedTicketsPostImported:_0x22fb0e,importOldMessagesGroups:_0x34085f,groupAsTicket:_0x3ed7c2,timeCreateNewTicket:_0x49664a}=_0x25e023[_0x13d2fd(0x135)],{companyId:_0x395656}=_0x25e023[_0x13d2fd(0x11e)],_0x4b5e2e=await(0x0,ShowCompanyService_1[_0x13d2fd(0x138)])(_0x395656),_0x3623c0=await(0x0,ShowPlanService_1[_0x13d2fd(0x138)])(_0x4b5e2e['planId']);if(!_0x3623c0[_0x13d2fd(0x12a)])return _0x31f9f5['status'](0x190)['json']({'error':_0x13d2fd(0x148)});const {whatsapp:_0x154755,oldDefaultWhatsapp:_0x4e9692}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x3e4878,'status':_0x5e9140,'isDefault':_0xcd8cc2,'greetingMessage':_0x3ef0c4,'complationMessage':_0x33f366,'outOfHoursMessage':_0x11813f,'queueIds':_0x4cc6ff,'companyId':_0x395656,'token':_0x52221d,'maxUseBotQueues':_0x2d6e61,'timeUseBotQueues':_0x1007f4,'expiresTicket':_0x296e97,'allowGroup':_0x31e339,'timeSendQueue':_0x6e9feb,'sendIdQueue':_0x3ff790,'timeInactiveMessage':_0x451035,'inactiveMessage':_0x2d00d7,'ratingMessage':_0x5f6e4a,'maxUseBotQueuesNPS':_0x15168f,'expiresTicketNPS':_0x591fa4,'whenExpiresTicket':_0x101885,'expiresInactiveMessage':_0x44b498,'importOldMessages':_0x324797,'importRecentMessages':_0x3aa70f,'closedTicketsPostImported':_0x22fb0e,'importOldMessagesGroups':_0x34085f,'groupAsTicket':_0x3ed7c2,'timeCreateNewTicket':_0x49664a});(0x0,StartWhatsAppSession_1[_0x13d2fd(0x14c)])(_0x154755,_0x395656);const _0x524a75=(0x0,socket_1[_0x13d2fd(0x11b)])();return _0x524a75['emit'](_0x13d2fd(0x125)+_0x395656+_0x13d2fd(0x145),{'action':_0x13d2fd(0x150),'whatsapp':_0x154755}),_0x4e9692&&_0x524a75[_0x13d2fd(0x153)](_0x13d2fd(0x125)+_0x395656+_0x13d2fd(0x145),{'action':_0x13d2fd(0x150),'whatsapp':_0x4e9692}),_0x31f9f5[_0x13d2fd(0x12f)](0xc8)['json'](_0x154755);};exports[a39_0x356942(0x14b)]=store;const storeFacebook=async(_0xc1be1a,_0x3c41ec)=>{const _0x2320fd=a39_0x356942;try{const {facebookUserId:_0x1785db,facebookUserToken:_0x22d102,addInstagram:_0x5c3010}=_0xc1be1a['body'],{companyId:_0x2b6eac}=_0xc1be1a[_0x2320fd(0x11e)],{data:_0x4c7884}=await(0x0,graphAPI_1[_0x2320fd(0x12e)])(_0x1785db,_0x22d102);if(_0x4c7884[_0x2320fd(0x12d)]===0x0)return _0x3c41ec[_0x2320fd(0x12f)](0x190)[_0x2320fd(0x156)]({'error':_0x2320fd(0x140)});const _0x4a44b2=(0x0,socket_1[_0x2320fd(0x11b)])(),_0x460ad0=[];for await(const _0x14a8ce of _0x4c7884){const {name:_0x5e98ff,access_token:_0x54a8d4,id:_0x154f9f,instagram_business_account:_0x5c59ff}=_0x14a8ce,_0x31e0cc=await(0x0,graphAPI_1[_0x2320fd(0x158)])(_0x54a8d4);if(_0x5c59ff&&_0x5c3010){const {id:_0x201ed5,username:_0xe4953b,name:_0x40455e}=_0x5c59ff;_0x460ad0['push']({'companyId':_0x2b6eac,'name':'Insta\x20'+(_0xe4953b||_0x40455e),'facebookUserId':_0x1785db,'facebookPageUserId':_0x201ed5,'facebookUserToken':_0x31e0cc,'tokenMeta':_0x22d102,'isDefault':![],'channel':_0x2320fd(0x12b),'status':_0x2320fd(0x128),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x460ad0[_0x2320fd(0x118)]({'companyId':_0x2b6eac,'name':_0x5e98ff,'facebookUserId':_0x1785db,'facebookPageUserId':_0x154f9f,'facebookUserToken':_0x31e0cc,'tokenMeta':_0x22d102,'isDefault':![],'channel':'facebook','status':_0x2320fd(0x128),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x2320fd(0x124)])(_0x154f9f,_0x31e0cc);}!_0x5c59ff&&(_0x460ad0[_0x2320fd(0x118)]({'companyId':_0x2b6eac,'name':_0x5e98ff,'facebookUserId':_0x1785db,'facebookPageUserId':_0x154f9f,'facebookUserToken':_0x31e0cc,'tokenMeta':_0x22d102,'isDefault':![],'channel':'facebook','status':_0x2320fd(0x128),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1[_0x2320fd(0x124)])(_0x14a8ce['id'],_0x31e0cc));}for await(const _0x187890 of _0x460ad0){const _0x36db51=await Whatsapp_1[_0x2320fd(0x138)]['findOne']({'where':{'facebookPageUserId':_0x187890['facebookPageUserId']}});_0x36db51&&await _0x36db51[_0x2320fd(0x150)]({..._0x187890});if(!_0x36db51){const {whatsapp:_0x2c007b}=await(0x0,CreateWhatsAppService_1[_0x2320fd(0x138)])(_0x187890);_0x4a44b2[_0x2320fd(0x153)](_0x2320fd(0x125)+_0x2b6eac+_0x2320fd(0x145),{'action':_0x2320fd(0x150),'whatsapp':_0x2c007b});}}return _0x3c41ec[_0x2320fd(0x12f)](0xc8);}catch(_0x297c79){return console[_0x2320fd(0x155)](_0x297c79),_0x3c41ec[_0x2320fd(0x12f)](0x190)[_0x2320fd(0x156)]({'error':_0x2320fd(0x140)});}};exports[a39_0x356942(0x11f)]=storeFacebook;const show=async(_0x1c806b,_0x33df3f)=>{const _0x25b885=a39_0x356942,{whatsappId:_0x2f1460}=_0x1c806b['params'],{companyId:_0x583ea3}=_0x1c806b[_0x25b885(0x11e)],{session:_0x149c24}=_0x1c806b[_0x25b885(0x13a)],_0x52302c=await(0x0,ShowWhatsAppService_1[_0x25b885(0x138)])(_0x2f1460,_0x583ea3,_0x149c24);return _0x33df3f['status'](0xc8)[_0x25b885(0x156)](_0x52302c);};exports[a39_0x356942(0x116)]=show;const update=async(_0x8d6dd0,_0x30627b)=>{const _0x4d66f8=a39_0x356942,{whatsappId:_0x508d94}=_0x8d6dd0[_0x4d66f8(0x121)],_0x14cc8d=_0x8d6dd0[_0x4d66f8(0x135)],{companyId:_0x3abf9a}=_0x8d6dd0['user'],{whatsapp:_0x3b124b,oldDefaultWhatsapp:_0x1ec45d}=await(0x0,UpdateWhatsAppService_1[_0x4d66f8(0x138)])({'whatsappData':_0x14cc8d,'whatsappId':_0x508d94,'companyId':_0x3abf9a}),_0x4dd13b=(0x0,socket_1['getIO'])();return _0x4dd13b[_0x4d66f8(0x153)](_0x4d66f8(0x125)+_0x3abf9a+_0x4d66f8(0x145),{'action':_0x4d66f8(0x150),'whatsapp':_0x3b124b}),_0x1ec45d&&_0x4dd13b[_0x4d66f8(0x153)](_0x4d66f8(0x125)+_0x3abf9a+'-whatsapp',{'action':'update','whatsapp':_0x1ec45d}),_0x30627b[_0x4d66f8(0x12f)](0xc8)[_0x4d66f8(0x156)](_0x3b124b);};exports[a39_0x356942(0x150)]=update;const closedTickets=async(_0x374648,_0x533311)=>{const _0x4bcb57=a39_0x356942,{whatsappId:_0x2c9e91}=_0x374648[_0x4bcb57(0x121)];return(0x0,ImportWhatsAppMessageService_1['closeTicketsImported'])(_0x2c9e91),_0x533311['status'](0xc8)['json'](_0x4bcb57(0x143));};exports[a39_0x356942(0x154)]=closedTickets;const remove=async(_0x39ae31,_0x5ce737)=>{const _0x32db0f=a39_0x356942,{whatsappId:_0x1ccde9}=_0x39ae31['params'],{companyId:_0xf27674,profile:_0x305455}=_0x39ae31[_0x32db0f(0x11e)],_0x19839b=(0x0,socket_1[_0x32db0f(0x11b)])();if(_0x305455!==_0x32db0f(0x120))throw new AppError_1[(_0x32db0f(0x138))](_0x32db0f(0x14e),0x193);const _0x51e03d=await(0x0,ShowWhatsAppService_1[_0x32db0f(0x138)])(_0x1ccde9,_0xf27674);_0x51e03d[_0x32db0f(0x119)]===_0x32db0f(0x143)&&(await(0x0,DeleteBaileysService_1[_0x32db0f(0x138)])(_0x1ccde9),await(0x0,DeleteWhatsAppService_1[_0x32db0f(0x138)])(_0x1ccde9),await cache_1['default']['delFromPattern']('sessions:'+_0x1ccde9+':*'),(0x0,wbot_1['removeWbot'])(+_0x1ccde9),_0x19839b[_0x32db0f(0x153)](_0x32db0f(0x125)+_0xf27674+_0x32db0f(0x145),{'action':_0x32db0f(0x14a),'whatsappId':+_0x1ccde9}));if(_0x51e03d['channel']===_0x32db0f(0x132)||_0x51e03d[_0x32db0f(0x119)]===_0x32db0f(0x12b)){const {facebookUserToken:_0x2d51a5}=_0x51e03d,_0x2cfc06=await Whatsapp_1['default']['findAll']({'where':{'facebookUserToken':_0x2d51a5}});await Whatsapp_1[_0x32db0f(0x138)][_0x32db0f(0x13d)]({'where':{'facebookUserToken':_0x2d51a5}});for await(const _0x191965 of _0x2cfc06){_0x19839b[_0x32db0f(0x153)](_0x32db0f(0x125)+_0xf27674+_0x32db0f(0x145),{'action':_0x32db0f(0x14a),'whatsappId':_0x191965['id']});}}return _0x5ce737[_0x32db0f(0x12f)](0xc8)[_0x32db0f(0x156)]({'message':_0x32db0f(0x11a)});};exports[a39_0x356942(0x136)]=remove;const restart=async(_0x57c752,_0x4bed63)=>{const _0x1b0a32=a39_0x356942,{companyId:_0x381449,profile:_0x2052e6}=_0x57c752[_0x1b0a32(0x11e)];if(_0x2052e6!=='admin')throw new AppError_1[(_0x1b0a32(0x138))](_0x1b0a32(0x14e),0x193);return await(0x0,wbot_1[_0x1b0a32(0x13c)])(_0x381449),_0x4bed63['status'](0xc8)[_0x1b0a32(0x156)]({'message':_0x1b0a32(0x13f)});};exports[a39_0x356942(0x129)]=restart;