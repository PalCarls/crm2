'use strict';const a42_0x50012d=a42_0x5c0e;(function(_0x42beb6,_0x3fa28c){const _0x1f1092=a42_0x5c0e,_0x9be820=_0x42beb6();while(!![]){try{const _0x2968d3=parseInt(_0x1f1092(0xb4))/0x1+parseInt(_0x1f1092(0xe6))/0x2*(-parseInt(_0x1f1092(0xd8))/0x3)+parseInt(_0x1f1092(0xf3))/0x4*(parseInt(_0x1f1092(0xda))/0x5)+-parseInt(_0x1f1092(0xcd))/0x6+-parseInt(_0x1f1092(0xe0))/0x7+-parseInt(_0x1f1092(0xd5))/0x8+parseInt(_0x1f1092(0xee))/0x9;if(_0x2968d3===_0x3fa28c)break;else _0x9be820['push'](_0x9be820['shift']());}catch(_0x220c8d){_0x9be820['push'](_0x9be820['shift']());}}}(a42_0x17e7,0xe4e15));var __importDefault=this&&this['__importDefault']||function(_0x13dc03){return _0x13dc03&&_0x13dc03['__esModule']?_0x13dc03:{'default':_0x13dc03};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a42_0x50012d(0xb5)]=exports[a42_0x50012d(0xf5)]=exports[a42_0x50012d(0xc0)]=exports[a42_0x50012d(0xbb)]=exports[a42_0x50012d(0xb3)]=exports[a42_0x50012d(0xc6)]=exports['closedTickets']=exports[a42_0x50012d(0xf7)]=exports[a42_0x50012d(0xce)]=exports['storeFacebook']=exports['store']=exports[a42_0x50012d(0xb8)]=void 0x0;const socket_1=require(a42_0x50012d(0xeb)),cache_1=__importDefault(require('../libs/cache')),wbot_1=require('../libs/wbot'),Whatsapp_1=__importDefault(require('../models/Whatsapp')),AppError_1=__importDefault(require(a42_0x50012d(0xe9))),DeleteBaileysService_1=__importDefault(require(a42_0x50012d(0xe8))),ShowCompanyService_1=__importDefault(require(a42_0x50012d(0xcf))),graphAPI_1=require(a42_0x50012d(0xc1)),ShowPlanService_1=__importDefault(require(a42_0x50012d(0xf2))),StartWhatsAppSession_1=require('../services/WbotServices/StartWhatsAppSession'),CreateWhatsAppService_1=__importDefault(require(a42_0x50012d(0xd1))),DeleteWhatsAppService_1=__importDefault(require('../services/WhatsappService/DeleteWhatsAppService')),ListWhatsAppsService_1=__importDefault(require(a42_0x50012d(0xd6))),ShowWhatsAppService_1=__importDefault(require(a42_0x50012d(0xb9))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),ImportWhatsAppMessageService_1=require(a42_0x50012d(0xb6)),ShowWhatsAppServiceAdmin_1=__importDefault(require(a42_0x50012d(0xc5))),UpdateWhatsAppServiceAdmin_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppServiceAdmin')),ListAllWhatsAppService_1=__importDefault(require(a42_0x50012d(0xbe))),index=async(_0x3978d0,_0x4aac67)=>{const _0x4c03b8=a42_0x50012d,{companyId:_0x461c0b}=_0x3978d0['user'],{session:_0x1f0601}=_0x3978d0['query'],_0x45c3b4=await(0x0,ListWhatsAppsService_1[_0x4c03b8(0xea)])({'companyId':_0x461c0b,'session':_0x1f0601});return _0x4aac67['status'](0xc8)[_0x4c03b8(0xb2)](_0x45c3b4);};exports[a42_0x50012d(0xb8)]=index;const store=async(_0x1aed52,_0x88382)=>{const _0x283302=a42_0x50012d,{name:_0x4287d4,status:_0x2790f1,isDefault:_0x2f4dc9,greetingMessage:_0xaa7207,complationMessage:_0xba7cbe,outOfHoursMessage:_0x1d4731,queueIds:_0x363eda,token:_0x1c6c6f,maxUseBotQueues:_0x2aeb12,timeUseBotQueues:_0x42f1eb,expiresTicket:_0x3fa7b3,allowGroup:_0x20f915,timeSendQueue:_0xf0677c,sendIdQueue:_0x5678c9,timeInactiveMessage:_0xcbb74c,inactiveMessage:_0x362fb9,ratingMessage:_0x2ca25f,maxUseBotQueuesNPS:_0x4f7eeb,expiresTicketNPS:_0x17970c,whenExpiresTicket:_0x5795e8,expiresInactiveMessage:_0x1d047c,importOldMessages:_0x4225e1,importRecentMessages:_0x2415ff,closedTicketsPostImported:_0x11e286,importOldMessagesGroups:_0x11c943,groupAsTicket:_0x28a6fd,timeCreateNewTicket:_0x4b0d0a,schedules:_0x1764d9,promptId:_0x527f4a}=_0x1aed52[_0x283302(0xd9)],{companyId:_0x303ae8}=_0x1aed52[_0x283302(0xc9)],_0x51dab1=await(0x0,ShowCompanyService_1[_0x283302(0xea)])(_0x303ae8),_0x3230ba=await(0x0,ShowPlanService_1[_0x283302(0xea)])(_0x51dab1[_0x283302(0xde)]);if(!_0x3230ba[_0x283302(0xca)])return _0x88382[_0x283302(0xe1)](0x190)[_0x283302(0xb2)]({'error':_0x283302(0xd2)});const {whatsapp:_0x370245,oldDefaultWhatsapp:_0x3e606c}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x4287d4,'status':_0x2790f1,'isDefault':_0x2f4dc9,'greetingMessage':_0xaa7207,'complationMessage':_0xba7cbe,'outOfHoursMessage':_0x1d4731,'queueIds':_0x363eda,'companyId':_0x303ae8,'token':_0x1c6c6f,'maxUseBotQueues':_0x2aeb12,'timeUseBotQueues':_0x42f1eb,'expiresTicket':_0x3fa7b3,'allowGroup':_0x20f915,'timeSendQueue':_0xf0677c,'sendIdQueue':_0x5678c9,'timeInactiveMessage':_0xcbb74c,'inactiveMessage':_0x362fb9,'ratingMessage':_0x2ca25f,'maxUseBotQueuesNPS':_0x4f7eeb,'expiresTicketNPS':_0x17970c,'whenExpiresTicket':_0x5795e8,'expiresInactiveMessage':_0x1d047c,'importOldMessages':_0x4225e1,'importRecentMessages':_0x2415ff,'closedTicketsPostImported':_0x11e286,'importOldMessagesGroups':_0x11c943,'groupAsTicket':_0x28a6fd,'timeCreateNewTicket':_0x4b0d0a,'schedules':_0x1764d9,'promptId':_0x527f4a});(0x0,StartWhatsAppSession_1[_0x283302(0xba)])(_0x370245,_0x303ae8);const _0x474c75=(0x0,socket_1[_0x283302(0xe5)])();return _0x474c75[_0x283302(0xec)](_0x283302(0xbc)+_0x303ae8+_0x283302(0xef),{'action':_0x283302(0xf7),'whatsapp':_0x370245}),_0x3e606c&&_0x474c75['emit']('company-'+_0x303ae8+_0x283302(0xef),{'action':_0x283302(0xf7),'whatsapp':_0x3e606c}),_0x88382[_0x283302(0xe1)](0xc8)[_0x283302(0xb2)](_0x370245);};exports['store']=store;const storeFacebook=async(_0x4dbb3a,_0x2ad6ee)=>{const _0x33a979=a42_0x50012d;try{const {facebookUserId:_0x490a5a,facebookUserToken:_0x5f08bf,addInstagram:_0x362310}=_0x4dbb3a[_0x33a979(0xd9)],{companyId:_0x34c4f3}=_0x4dbb3a[_0x33a979(0xc9)],{data:_0x255d39}=await(0x0,graphAPI_1[_0x33a979(0xe4)])(_0x490a5a,_0x5f08bf);if(_0x255d39[_0x33a979(0xd4)]===0x0)return _0x2ad6ee['status'](0x190)[_0x33a979(0xb2)]({'error':'Facebook\x20page\x20not\x20found'});const _0x5de9c9=(0x0,socket_1['getIO'])(),_0x125475=[];for await(const _0x3a911b of _0x255d39){const {name:_0x25e498,access_token:_0x56ced2,id:_0x121688,instagram_business_account:_0x478d9b}=_0x3a911b,_0x2b07ce=await(0x0,graphAPI_1[_0x33a979(0xd7)])(_0x56ced2);if(_0x478d9b&&_0x362310){const {id:_0x49510,username:_0x3b3320,name:_0x11c264}=_0x478d9b;_0x125475[_0x33a979(0xbd)]({'companyId':_0x34c4f3,'name':_0x33a979(0xc8)+(_0x3b3320||_0x11c264),'facebookUserId':_0x490a5a,'facebookPageUserId':_0x49510,'facebookUserToken':_0x2b07ce,'tokenMeta':_0x5f08bf,'isDefault':![],'channel':_0x33a979(0xe2),'status':_0x33a979(0xc7),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),_0x125475['push']({'companyId':_0x34c4f3,'name':_0x25e498,'facebookUserId':_0x490a5a,'facebookPageUserId':_0x121688,'facebookUserToken':_0x2b07ce,'tokenMeta':_0x5f08bf,'isDefault':![],'channel':_0x33a979(0xf0),'status':'CONNECTED','greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1['subscribeApp'])(_0x121688,_0x2b07ce);}!_0x478d9b&&(_0x125475['push']({'companyId':_0x34c4f3,'name':_0x25e498,'facebookUserId':_0x490a5a,'facebookPageUserId':_0x121688,'facebookUserToken':_0x2b07ce,'tokenMeta':_0x5f08bf,'isDefault':![],'channel':'facebook','status':_0x33a979(0xc7),'greetingMessage':'','farewellMessage':'','queueIds':[],'isMultidevice':![]}),await(0x0,graphAPI_1['subscribeApp'])(_0x3a911b['id'],_0x2b07ce));}for await(const _0x9f5cb3 of _0x125475){const _0x21dfc7=await Whatsapp_1[_0x33a979(0xea)][_0x33a979(0xc3)]({'where':{'facebookPageUserId':_0x9f5cb3[_0x33a979(0xcc)]}});_0x21dfc7&&await _0x21dfc7[_0x33a979(0xf7)]({..._0x9f5cb3});if(!_0x21dfc7){const {whatsapp:_0xf32c5}=await(0x0,CreateWhatsAppService_1[_0x33a979(0xea)])(_0x9f5cb3);_0x5de9c9[_0x33a979(0xec)]('company-'+_0x34c4f3+_0x33a979(0xef),{'action':_0x33a979(0xf7),'whatsapp':_0xf32c5});}}return _0x2ad6ee['status'](0xc8);}catch(_0x44c100){return console[_0x33a979(0xd0)](_0x44c100),_0x2ad6ee[_0x33a979(0xe1)](0x190)[_0x33a979(0xb2)]({'error':'Facebook\x20page\x20not\x20found'});}};exports[a42_0x50012d(0xdf)]=storeFacebook;const show=async(_0x3952f3,_0x23dad3)=>{const _0x13e82c=a42_0x50012d,{whatsappId:_0x2a2d9b}=_0x3952f3[_0x13e82c(0xb7)],{companyId:_0x32cc62}=_0x3952f3['user'],{session:_0x1c138f}=_0x3952f3['query'],_0x56e1f8=await(0x0,ShowWhatsAppService_1[_0x13e82c(0xea)])(_0x2a2d9b,_0x32cc62,_0x1c138f);return _0x23dad3[_0x13e82c(0xe1)](0xc8)[_0x13e82c(0xb2)](_0x56e1f8);};exports[a42_0x50012d(0xce)]=show;const update=async(_0x10b2a7,_0xa7a11c)=>{const _0x28e707=a42_0x50012d,{whatsappId:_0x3718db}=_0x10b2a7[_0x28e707(0xb7)],_0x1b1d8a=_0x10b2a7[_0x28e707(0xd9)],{companyId:_0x3f8297}=_0x10b2a7[_0x28e707(0xc9)],{whatsapp:_0x471489,oldDefaultWhatsapp:_0x445f75}=await(0x0,UpdateWhatsAppService_1[_0x28e707(0xea)])({'whatsappData':_0x1b1d8a,'whatsappId':_0x3718db,'companyId':_0x3f8297}),_0xa2eb50=(0x0,socket_1[_0x28e707(0xe5)])();return _0xa2eb50[_0x28e707(0xec)]('company-'+_0x3f8297+_0x28e707(0xef),{'action':_0x28e707(0xf7),'whatsapp':_0x471489}),_0x445f75&&_0xa2eb50[_0x28e707(0xec)]('company-'+_0x3f8297+'-whatsapp',{'action':'update','whatsapp':_0x445f75}),_0xa7a11c[_0x28e707(0xe1)](0xc8)[_0x28e707(0xb2)](_0x471489);};exports['update']=update;const closedTickets=async(_0x4c99b4,_0x40d29a)=>{const _0x30afdd=a42_0x50012d,{whatsappId:_0x40f82f}=_0x4c99b4[_0x30afdd(0xb7)];return(0x0,ImportWhatsAppMessageService_1['closeTicketsImported'])(_0x40f82f),_0x40d29a[_0x30afdd(0xe1)](0xc8)[_0x30afdd(0xb2)](_0x30afdd(0xed));};exports[a42_0x50012d(0xc4)]=closedTickets;const remove=async(_0x4a632d,_0x2e11ff)=>{const _0x560de9=a42_0x50012d,{whatsappId:_0x226222}=_0x4a632d[_0x560de9(0xb7)],{companyId:_0x4735e6,profile:_0x396906}=_0x4a632d[_0x560de9(0xc9)],_0x1bf053=(0x0,socket_1[_0x560de9(0xe5)])();if(_0x396906!==_0x560de9(0xbf))throw new AppError_1[(_0x560de9(0xea))]('ERR_NO_PERMISSION',0x193);const _0x3809c6=await(0x0,ShowWhatsAppService_1[_0x560de9(0xea)])(_0x226222,_0x4735e6);_0x3809c6['channel']==='whatsapp'&&(await(0x0,DeleteBaileysService_1[_0x560de9(0xea)])(_0x226222),await(0x0,DeleteWhatsAppService_1[_0x560de9(0xea)])(_0x226222),await cache_1['default']['delFromPattern'](_0x560de9(0xd3)+_0x226222+':*'),(0x0,wbot_1[_0x560de9(0xf1)])(+_0x226222),_0x1bf053['emit'](_0x560de9(0xbc)+_0x4735e6+_0x560de9(0xef),{'action':_0x560de9(0xf6),'whatsappId':+_0x226222}));if(_0x3809c6[_0x560de9(0xdc)]==='facebook'||_0x3809c6[_0x560de9(0xdc)]===_0x560de9(0xe2)){const {facebookUserToken:_0xde4c74}=_0x3809c6,_0x245fd6=await Whatsapp_1[_0x560de9(0xea)][_0x560de9(0xdb)]({'where':{'facebookUserToken':_0xde4c74}});await Whatsapp_1[_0x560de9(0xea)][_0x560de9(0xe3)]({'where':{'facebookUserToken':_0xde4c74}});for await(const _0x3d861f of _0x245fd6){_0x1bf053['emit'](_0x560de9(0xbc)+_0x4735e6+_0x560de9(0xef),{'action':_0x560de9(0xf6),'whatsappId':_0x3d861f['id']});}}return _0x2e11ff['status'](0xc8)[_0x560de9(0xb2)]({'message':_0x560de9(0xe7)});};exports[a42_0x50012d(0xc6)]=remove;const restart=async(_0x5228bb,_0x5b4cad)=>{const _0x55efce=a42_0x50012d,{companyId:_0x36022a,profile:_0x5438f}=_0x5228bb[_0x55efce(0xc9)];if(_0x5438f!==_0x55efce(0xbf))throw new AppError_1['default'](_0x55efce(0xc2),0x193);return await(0x0,wbot_1[_0x55efce(0xf4)])(_0x36022a),_0x5b4cad[_0x55efce(0xe1)](0xc8)[_0x55efce(0xb2)]({'message':_0x55efce(0xcb)});};function a42_0x17e7(){const _0x172ba3=['9448600xlOsgw','status','instagram','destroy','getPageProfile','getIO','173482cGnniX','Session\x20disconnected.','../services/BaileysServices/DeleteBaileysService','../errors/AppError','default','../libs/socket','emit','whatsapp','37597032XobRcI','-whatsapp','facebook','removeWbot','../services/PlanService/ShowPlanService','2404BJjNrS','restartWbot','removeAdmin','delete','update','json','restart','1436336dxtsRi','showAdmin','../services/WhatsappService/ImportWhatsAppMessageService','params','index','../services/WhatsappService/ShowWhatsAppService','StartWhatsAppSession','listAll','company-','push','../services/WhatsappService/ListAllWhatsAppService','admin','updateAdmin','../services/FacebookServices/graphAPI','ERR_NO_PERMISSION','findOne','closedTickets','../services/WhatsappService/ShowWhatsAppServiceAdmin','remove','CONNECTED','Insta\x20','user','useWhatsapp','Whatsapp\x20restart.','facebookPageUserId','7229502fpXqKs','show','../services/CompanyService/ShowCompanyService','log','../services/WhatsappService/CreateWhatsAppService','Você\x20não\x20possui\x20permissão\x20para\x20acessar\x20este\x20recurso!','sessions:','length','10374840ksFalO','../services/WhatsappService/ListWhatsAppsService','getAccessTokenFromPage','48QWWUlm','body','4685PByEKf','findAll','channel','admin-whatsapp','planId','storeFacebook'];a42_0x17e7=function(){return _0x172ba3;};return a42_0x17e7();}exports[a42_0x50012d(0xb3)]=restart;const listAll=async(_0x4d1b15,_0x1b889e)=>{const _0x83ec09=a42_0x50012d,{companyId:_0x48a509}=_0x4d1b15[_0x83ec09(0xc9)],{session:_0x803da7}=_0x4d1b15['query'],_0x318d2d=await(0x0,ListAllWhatsAppService_1[_0x83ec09(0xea)])({'session':_0x803da7});return _0x1b889e['status'](0xc8)[_0x83ec09(0xb2)](_0x318d2d);};exports[a42_0x50012d(0xbb)]=listAll;const updateAdmin=async(_0x277bd6,_0x1cb609)=>{const _0x4137b1=a42_0x50012d,{whatsappId:_0x1b1407}=_0x277bd6[_0x4137b1(0xb7)],_0x1678de=_0x277bd6[_0x4137b1(0xd9)],{companyId:_0x1e05af}=_0x277bd6[_0x4137b1(0xc9)],{whatsapp:_0x2536ff,oldDefaultWhatsapp:_0x5826ce}=await(0x0,UpdateWhatsAppServiceAdmin_1[_0x4137b1(0xea)])({'whatsappData':_0x1678de,'whatsappId':_0x1b1407,'companyId':_0x1e05af}),_0x11bd91=(0x0,socket_1[_0x4137b1(0xe5)])();return _0x11bd91[_0x4137b1(0xec)](_0x4137b1(0xdd),{'action':_0x4137b1(0xf7),'whatsapp':_0x2536ff}),_0x5826ce&&_0x11bd91[_0x4137b1(0xec)](_0x4137b1(0xdd),{'action':_0x4137b1(0xf7),'whatsapp':_0x5826ce}),_0x1cb609[_0x4137b1(0xe1)](0xc8)[_0x4137b1(0xb2)](_0x2536ff);};exports[a42_0x50012d(0xc0)]=updateAdmin;const removeAdmin=async(_0x5eb4b8,_0x5d0e7a)=>{const _0x2e0956=a42_0x50012d,{whatsappId:_0x5a59b9}=_0x5eb4b8[_0x2e0956(0xb7)],{companyId:_0x2cdb4c}=_0x5eb4b8[_0x2e0956(0xc9)],_0x28b3d8=(0x0,socket_1[_0x2e0956(0xe5)])(),_0xb1073a=await(0x0,ShowWhatsAppService_1[_0x2e0956(0xea)])(_0x5a59b9,_0x2cdb4c);_0xb1073a['channel']==='whatsapp'&&(await(0x0,DeleteBaileysService_1[_0x2e0956(0xea)])(_0x5a59b9),await(0x0,DeleteWhatsAppService_1[_0x2e0956(0xea)])(_0x5a59b9),await cache_1[_0x2e0956(0xea)]['delFromPattern'](_0x2e0956(0xd3)+_0x5a59b9+':*'),(0x0,wbot_1[_0x2e0956(0xf1)])(+_0x5a59b9),_0x28b3d8[_0x2e0956(0xec)](_0x2e0956(0xdd),{'action':_0x2e0956(0xf6),'whatsappId':+_0x5a59b9}));if(_0xb1073a[_0x2e0956(0xdc)]==='facebook'||_0xb1073a[_0x2e0956(0xdc)]===_0x2e0956(0xe2)){const {facebookUserToken:_0xfc228f}=_0xb1073a,_0x5bd3d0=await Whatsapp_1[_0x2e0956(0xea)][_0x2e0956(0xdb)]({'where':{'facebookUserToken':_0xfc228f}});await Whatsapp_1[_0x2e0956(0xea)][_0x2e0956(0xe3)]({'where':{'facebookUserToken':_0xfc228f}});for await(const _0x1aa15c of _0x5bd3d0){_0x28b3d8['emit']('company-'+_0x2cdb4c+_0x2e0956(0xef),{'action':_0x2e0956(0xf6),'whatsappId':_0x1aa15c['id']});}}return _0x5d0e7a[_0x2e0956(0xe1)](0xc8)[_0x2e0956(0xb2)]({'message':'Session\x20disconnected.'});};function a42_0x5c0e(_0x46523e,_0x24fde6){const _0x17e755=a42_0x17e7();return a42_0x5c0e=function(_0x5c0ea1,_0x5ee341){_0x5c0ea1=_0x5c0ea1-0xb2;let _0x38bb49=_0x17e755[_0x5c0ea1];return _0x38bb49;},a42_0x5c0e(_0x46523e,_0x24fde6);}exports['removeAdmin']=removeAdmin;const showAdmin=async(_0x59be92,_0x4e182e)=>{const _0x3d8160=a42_0x50012d,{whatsappId:_0x111c6c}=_0x59be92[_0x3d8160(0xb7)],{companyId:_0x354949}=_0x59be92[_0x3d8160(0xc9)],_0x20eb5a=await(0x0,ShowWhatsAppServiceAdmin_1[_0x3d8160(0xea)])(_0x111c6c);return _0x4e182e[_0x3d8160(0xe1)](0xc8)['json'](_0x20eb5a);};exports['showAdmin']=showAdmin;