'use strict';function a23_0x596f(){const _0x955ae=['join','quotedMsgId','GetWhatsAppFromMessage','findByPk','../services/WbotServices/DeleteWhatsAppMessage','isPrivate','4964724svAUDe','originalname','index','get','Message\x20not\x20found','all','../services/TicketServices/ShowTicketService','allMe','Contact\x20not\x20found','../services/MessageServices/CreateMessageService','update','company','delete','messageQueue','480UiBAsT','__importDefault','facebook','dateStart','jsonwebtoken','4puanjm','-appMessage','log','../services/FacebookServices/sendFacebookMessageMedia','emit','replace','../services/TicketServices/FindOrCreateTicketService','getOwnPropertyDescriptor','../services/WbotServices/SendWhatsAppMessage','7bit','body','4639972LvhXkd','../models/Message','../services/MessageServices/ListMessagesService','instagram','medias','queueId','env','../services/ContactServices/ShowContactService','isGroup','toString','files','path','5ImnODP','length','add','__createBinding','../config/auth','Mensagem\x20enviada!','ticketId','backend','mediaUrl','remove','status','destroy','../errors/AppError','keys','../libs/socket','app','../services/WbotServices/SendWhatsAppMedia','extendedTextMessage','__importStar','SendMessage','map','isNil','json','lodash','*Mensagem\x20encaminhada\x20de\x20','query','test','create','configurable','__esModule','__setModuleDefault','Não\x20foi\x20possível\x20enviar\x20a\x20mensagem,\x20tente\x20novamente\x20em\x20alguns\x20instantes','store','channel','user','PORT','739437FoSgCv','findOne','Essa\x20empresa\x20não\x20tem\x20permissão\x20para\x20usar\x20a\x20API\x20Externa.\x20Entre\x20em\x20contato\x20com\x20o\x20Suporte\x20para\x20verificar\x20nossos\x20planos!','companyId','>>>>>>>>>>>>>>>>>forwardMessage\x20X<<<<<<<<<<<<<<<<<<<','group','send','authorization','params','O\x20número\x20é\x20obrigatório','public','../services/TicketServices/UpdateTicketService','count','getIO','name','6638272gRWgmw','637833uERgvC','pop','open','parse','default','../models/User','queues','*\x0a\x0a','forEach','number','whatsapp','forwardmessage','../services/MessageServices/ShowMessageService','verify','message','../services/FacebookServices/sendFacebookMessage','contact','4338138jqgfgs','../services/MessageServices/ListMessagesServiceAll','split','Não\x20foi\x20possível\x20realizar\x20a\x20operação','headers','forwardMessage','Whatsapp\x20from\x20message\x20not\x20found','company-','219663tOScAK'];a23_0x596f=function(){return _0x955ae;};return a23_0x596f();}const a23_0x227ca8=a23_0x427e;(function(_0x2ba33b,_0x389e0f){const _0x315a81=a23_0x427e,_0x4535be=_0x2ba33b();while(!![]){try{const _0x5afa73=-parseInt(_0x315a81(0x132))/0x1+-parseInt(_0x315a81(0x165))/0x2*(parseInt(_0x315a81(0x122))/0x3)+parseInt(_0x315a81(0x170))/0x4*(parseInt(_0x315a81(0x17c))/0x5)+-parseInt(_0x315a81(0x152))/0x6+-parseInt(_0x315a81(0x143))/0x7+parseInt(_0x315a81(0x131))/0x8+-parseInt(_0x315a81(0x14b))/0x9*(-parseInt(_0x315a81(0x160))/0xa);if(_0x5afa73===_0x389e0f)break;else _0x4535be['push'](_0x4535be['shift']());}catch(_0x5640c0){_0x4535be['push'](_0x4535be['shift']());}}}(a23_0x596f,0x8e6a6));function a23_0x427e(_0x4f2c4a,_0x2a1e53){const _0x596f0a=a23_0x596f();return a23_0x427e=function(_0x427e3a,_0x35c384){_0x427e3a=_0x427e3a-0x10e;let _0x203747=_0x596f0a[_0x427e3a];return _0x203747;},a23_0x427e(_0x4f2c4a,_0x2a1e53);}var __createBinding=this&&this[a23_0x227ca8(0x17f)]||(Object[a23_0x227ca8(0x119)]?function(_0x275921,_0x4d4a90,_0x29e31f,_0xbf4073){const _0xa0b673=a23_0x227ca8;if(_0xbf4073===undefined)_0xbf4073=_0x29e31f;var _0x215591=Object[_0xa0b673(0x16c)](_0x4d4a90,_0x29e31f);(!_0x215591||('get'in _0x215591?!_0x4d4a90[_0xa0b673(0x11b)]:_0x215591['writable']||_0x215591[_0xa0b673(0x11a)]))&&(_0x215591={'enumerable':!![],'get':function(){return _0x4d4a90[_0x29e31f];}}),Object['defineProperty'](_0x275921,_0xbf4073,_0x215591);}:function(_0x3e5e5a,_0x1652cf,_0x584d53,_0x12b887){if(_0x12b887===undefined)_0x12b887=_0x584d53;_0x3e5e5a[_0x12b887]=_0x1652cf[_0x584d53];}),__setModuleDefault=this&&this[a23_0x227ca8(0x11c)]||(Object[a23_0x227ca8(0x119)]?function(_0x3f3083,_0x42eb53){const _0x36e612=a23_0x227ca8;Object['defineProperty'](_0x3f3083,_0x36e612(0x136),{'enumerable':!![],'value':_0x42eb53});}:function(_0x391467,_0x1c134f){const _0x33faca=a23_0x227ca8;_0x391467[_0x33faca(0x136)]=_0x1c134f;}),__importStar=this&&this[a23_0x227ca8(0x110)]||function(_0x480f6b){if(_0x480f6b&&_0x480f6b['__esModule'])return _0x480f6b;var _0x58d527={};if(_0x480f6b!=null){for(var _0x5f4822 in _0x480f6b)if(_0x5f4822!=='default'&&Object['prototype']['hasOwnProperty']['call'](_0x480f6b,_0x5f4822))__createBinding(_0x58d527,_0x480f6b,_0x5f4822);}return __setModuleDefault(_0x58d527,_0x480f6b),_0x58d527;},__importDefault=this&&this[a23_0x227ca8(0x161)]||function(_0x1c8391){const _0x11d856=a23_0x227ca8;return _0x1c8391&&_0x1c8391[_0x11d856(0x11b)]?_0x1c8391:{'default':_0x1c8391};};Object['defineProperty'](exports,a23_0x227ca8(0x11b),{'value':!![]}),exports[a23_0x227ca8(0x128)]=exports['allMe']=exports['remove']=exports[a23_0x227ca8(0x148)]=exports[a23_0x227ca8(0x13d)]=exports[a23_0x227ca8(0x11e)]=exports[a23_0x227ca8(0x154)]=void 0x0;const AppError_1=__importDefault(require(a23_0x227ca8(0x188))),SetTicketMessagesAsRead_1=__importDefault(require('../helpers/SetTicketMessagesAsRead')),socket_1=require(a23_0x227ca8(0x18a)),Message_1=__importDefault(require(a23_0x227ca8(0x171))),Queue_1=__importDefault(require('../models/Queue')),User_1=__importDefault(require(a23_0x227ca8(0x137))),Whatsapp_1=__importDefault(require('../models/Whatsapp')),jsonwebtoken_1=require(a23_0x227ca8(0x164)),auth_1=__importDefault(require(a23_0x227ca8(0x180))),path_1=__importDefault(require('path')),lodash_1=require(a23_0x227ca8(0x115)),ListMessagesService_1=__importDefault(require(a23_0x227ca8(0x172))),ShowTicketService_1=__importDefault(require(a23_0x227ca8(0x158))),DeleteWhatsAppMessage_1=__importDefault(require(a23_0x227ca8(0x150))),SendWhatsAppMedia_1=__importDefault(require(a23_0x227ca8(0x10e))),SendWhatsAppMessage_1=__importDefault(require(a23_0x227ca8(0x16d))),CreateMessageService_1=__importDefault(require(a23_0x227ca8(0x15b))),sendFacebookMessageMedia_1=__importDefault(require(a23_0x227ca8(0x168))),sendFacebookMessage_1=__importDefault(require(a23_0x227ca8(0x141))),ShowPlanCompanyService_1=__importDefault(require('../services/CompanyService/ShowPlanCompanyService')),ListMessagesServiceAll_1=__importDefault(require(a23_0x227ca8(0x144))),ShowContactService_1=__importDefault(require(a23_0x227ca8(0x177))),FindOrCreateTicketService_1=__importDefault(require(a23_0x227ca8(0x16b))),UpdateTicketService_1=__importDefault(require(a23_0x227ca8(0x12d))),ShowMessageService_1=__importStar(require(a23_0x227ca8(0x13e))),CompaniesSettings_1=__importDefault(require('../models/CompaniesSettings')),index=async(_0x334ce2,_0x331e94)=>{const _0x5d2dc2=a23_0x227ca8,{ticketId:_0x38d17e}=_0x334ce2[_0x5d2dc2(0x12a)],{pageNumber:_0x4d3c78,selectedQueues:_0x47b537}=_0x334ce2[_0x5d2dc2(0x117)],{companyId:_0x3d48e2,profile:_0x366253}=_0x334ce2[_0x5d2dc2(0x120)];let _0x91dbdd=[];const _0x4dbcde=await User_1[_0x5d2dc2(0x136)]['findByPk'](_0x334ce2[_0x5d2dc2(0x120)]['id'],{'include':[{'model':Queue_1[_0x5d2dc2(0x136)],'as':_0x5d2dc2(0x138)}]});_0x47b537?_0x91dbdd=JSON[_0x5d2dc2(0x135)](_0x47b537):_0x4dbcde[_0x5d2dc2(0x138)][_0x5d2dc2(0x13a)](_0x5b937c=>{_0x91dbdd['push'](_0x5b937c['id']);});const {count:_0x3e6879,messages:_0x367e3e,ticket:_0x3053e6,hasMore:_0x370700}=await(0x0,ListMessagesService_1[_0x5d2dc2(0x136)])({'pageNumber':_0x4d3c78,'ticketId':_0x38d17e,'companyId':_0x3d48e2,'queues':_0x91dbdd,'user':_0x4dbcde});return _0x3053e6[_0x5d2dc2(0x11f)]===_0x5d2dc2(0x13c)&&(0x0,SetTicketMessagesAsRead_1[_0x5d2dc2(0x136)])(_0x3053e6),_0x331e94['json']({'count':_0x3e6879,'messages':_0x367e3e,'ticket':_0x3053e6,'hasMore':_0x370700});};exports[a23_0x227ca8(0x154)]=index;function obterNomeEExtensaoDoArquivo(_0x5bd473){const _0x4aa2c4=a23_0x227ca8;var _0xf51f2e=new URL(_0x5bd473),_0x242414=_0xf51f2e['pathname'],_0x29a627=_0x242414[_0x4aa2c4(0x145)]('/')[_0x4aa2c4(0x133)](),_0xd1a39a=_0x29a627[_0x4aa2c4(0x145)]('.'),_0x1c23b5=_0xd1a39a[0x0],_0x5cdcf8=_0xd1a39a[0x1];return _0x1c23b5+'.'+_0x5cdcf8;}const store=async(_0x24eb30,_0x4dee72)=>{const _0x2cae4c=a23_0x227ca8,{ticketId:_0x30f40d}=_0x24eb30[_0x2cae4c(0x12a)],{body:_0x2b2cd0,quotedMsg:_0x2afc09,isPrivate:_0x5e0268,vCard:_0x411c24}=_0x24eb30[_0x2cae4c(0x16f)],_0x27e90d=_0x24eb30[_0x2cae4c(0x17a)],{companyId:_0x27326b}=_0x24eb30[_0x2cae4c(0x120)],_0x6d3dab=await(0x0,ShowTicketService_1[_0x2cae4c(0x136)])(_0x30f40d,_0x27326b);_0x6d3dab[_0x2cae4c(0x11f)]===_0x2cae4c(0x13c)&&(0x0,SetTicketMessagesAsRead_1[_0x2cae4c(0x136)])(_0x6d3dab);try{if(_0x27e90d)await Promise[_0x2cae4c(0x157)](_0x27e90d[_0x2cae4c(0x112)](async _0x4aded9=>{const _0x4c5147=_0x2cae4c;_0x6d3dab[_0x4c5147(0x11f)]==='whatsapp'&&await(0x0,SendWhatsAppMedia_1[_0x4c5147(0x136)])({'media':_0x4aded9,'ticket':_0x6d3dab,'body':'','isPrivate':/\u200d/[_0x4c5147(0x118)](_0x2b2cd0),'isForwarded':![]});if(_0x6d3dab[_0x4c5147(0x11f)]===_0x4c5147(0x162)||_0x6d3dab[_0x4c5147(0x11f)]===_0x4c5147(0x173))try{await(0x0,sendFacebookMessageMedia_1[_0x4c5147(0x136)])({'media':_0x4aded9,'ticket':_0x6d3dab});}catch(_0x5d538c){console['log'](_0x5d538c);}}));else{_0x6d3dab[_0x2cae4c(0x11f)]===_0x2cae4c(0x13c)&&!_0x5e0268&&await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x2b2cd0,'ticket':_0x6d3dab,'quotedMsg':_0x2afc09,'isPrivate':_0x5e0268,'vCard':_0x411c24});if(_0x6d3dab[_0x2cae4c(0x11f)]===_0x2cae4c(0x13c)&&_0x5e0268){const _0x4418c6={'wid':'PVT'+_0x6d3dab['updatedAt'][_0x2cae4c(0x179)]()[_0x2cae4c(0x16a)]('\x20',''),'ticketId':_0x6d3dab['id'],'contactId':undefined,'body':_0x2b2cd0,'fromMe':!![],'mediaType':!(0x0,lodash_1['isNil'])(_0x411c24)?'contactMessage':_0x2cae4c(0x10f),'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':_0x6d3dab[_0x2cae4c(0x142)]?.['remoteJid'],'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x5e0268};await(0x0,CreateMessageService_1[_0x2cae4c(0x136)])({'messageData':_0x4418c6,'companyId':_0x6d3dab[_0x2cae4c(0x125)]});}(_0x6d3dab[_0x2cae4c(0x11f)]===_0x2cae4c(0x162)||_0x6d3dab['channel']==='instagram')&&await(0x0,sendFacebookMessage_1[_0x2cae4c(0x136)])({'body':_0x2b2cd0,'ticket':_0x6d3dab,'quotedMsg':_0x2afc09});}return _0x4dee72[_0x2cae4c(0x128)]();}catch(_0x160545){return console['log'](_0x160545),_0x4dee72['status'](0x190)[_0x2cae4c(0x114)]({'error':_0x160545[_0x2cae4c(0x140)]});}};exports[a23_0x227ca8(0x11e)]=store;const forwardmessage=async(_0x251e5b,_0x43c28e)=>{const _0x682918=a23_0x227ca8,_0x546842=_0x251e5b[_0x682918(0x147)][_0x682918(0x129)],[,_0x541d63]=_0x546842['split']('\x20'),_0x33fb48=(0x0,jsonwebtoken_1[_0x682918(0x13f)])(_0x541d63,auth_1[_0x682918(0x136)]['secret']),{id:_0x2132b6}=_0x251e5b[_0x682918(0x120)],_0x37e19c=await User_1[_0x682918(0x136)]['findByPk'](_0x2132b6),{currentContacts:_0x4475fc,message:_0x44bccd,signMessage:_0x30aa8e}=_0x251e5b[_0x682918(0x16f)],{companyId:_0xb5626}=_0x44bccd,_0x3d9d7a=await CompaniesSettings_1[_0x682918(0x136)][_0x682918(0x123)]({'where':{'companyId':_0xb5626}}),_0x275fed=_0x44bccd[_0x682918(0x14d)];let _0x1c8ad4;return _0x4475fc[_0x682918(0x112)](async _0x8a38a3=>{const _0x157582=_0x682918,_0x55615c=await(0x0,ShowContactService_1['default'])(_0x8a38a3['id'],_0x44bccd[_0x157582(0x125)]),_0x280749=await(0x0,ShowTicketService_1['default'])(_0x44bccd[_0x157582(0x182)],_0x44bccd[_0x157582(0x125)]),{ticket:_0x54acef,isCreated:_0x2c2182}=await(0x0,FindOrCreateTicketService_1[_0x157582(0x136)])(_0x55615c,_0x280749?.[_0x157582(0x13c)],0x0,_0x280749['companyId'],_0x280749[_0x157582(0x175)],_0x37e19c['id'],_0x55615c[_0x157582(0x178)]?_0x55615c:null,'whatsapp',null,!![],_0x3d9d7a),_0x4eab49={'status':_0x54acef[_0x157582(0x178)]?'group':_0x157582(0x134),'userId':_0x37e19c['id'],'queueId':_0x280749[_0x157582(0x175)]};await(0x0,UpdateTicketService_1[_0x157582(0x136)])({'ticketData':_0x4eab49,'ticketId':_0x54acef['id'],'companyId':_0x54acef[_0x157582(0x125)]});if(_0x280749[_0x157582(0x11f)]==='whatsapp'){if(_0x44bccd[_0x157582(0x184)]){_0x1c8ad4='_Encaminhada_';const _0x586d15=_0x44bccd[_0x157582(0x184)][_0x157582(0x16a)](':'+process[_0x157582(0x176)]['PORT'],''),_0x29a516=obterNomeEExtensaoDoArquivo(_0x586d15),_0x3c9b9e=path_1['default'][_0x157582(0x14c)](__dirname,'..','..','..',_0x157582(0x183),_0x157582(0x12c)),_0x3ba694=path_1[_0x157582(0x136)][_0x157582(0x14c)](_0x3c9b9e,_0x157582(0x15d)+_0x280749[_0x157582(0x125)],_0x29a516),_0x3913ab={'fieldname':_0x157582(0x174),'originalname':_0x29a516,'encoding':_0x157582(0x16e),'mimetype':_0x44bccd['mediaType'],'filename':_0x29a516,'path':_0x3ba694};await(0x0,SendWhatsAppMedia_1[_0x157582(0x136)])({'media':_0x3913ab,'ticket':_0x54acef,'body':_0x1c8ad4,'isForwarded':![]});}else _0x30aa8e?_0x1c8ad4=_0x157582(0x116)+_0x37e19c[_0x157582(0x130)]+_0x157582(0x139)+_0x44bccd['body']:_0x1c8ad4=''+_0x44bccd[_0x157582(0x16f)],await(0x0,SendWhatsAppMessage_1[_0x157582(0x136)])({'body':_0x1c8ad4,'ticket':_0x54acef,'quotedMsg':_0x275fed});}}),_0x43c28e[_0x682918(0x114)](_0x682918(0x12e));};exports[a23_0x227ca8(0x13d)]=forwardmessage;const forwardMessage=async(_0x4e7a25,_0x50f9f4)=>{const _0x1aac39=a23_0x227ca8;console[_0x1aac39(0x167)](_0x1aac39(0x126));const {quotedMsg:_0xda674a,signMessage:_0x2e0f74,messageId:_0x35b701,contactId:_0x5d1fd5}=_0x4e7a25[_0x1aac39(0x16f)],{id:_0x19234d,companyId:_0x33d0ec}=_0x4e7a25['user'],_0x2a53e4=await User_1[_0x1aac39(0x136)][_0x1aac39(0x14f)](_0x19234d);if(!_0x35b701||!_0x5d1fd5)return _0x50f9f4[_0x1aac39(0x186)](0xc8)[_0x1aac39(0x128)]('MessageId\x20or\x20ContactId\x20not\x20found');const _0xb76de5=await(0x0,ShowMessageService_1['default'])(_0x35b701),_0x603c11=await(0x0,ShowContactService_1['default'])(_0x5d1fd5,_0x33d0ec);if(!_0xb76de5)return _0x50f9f4[_0x1aac39(0x186)](0x194)[_0x1aac39(0x128)](_0x1aac39(0x156));if(!_0x603c11)return _0x50f9f4['status'](0x194)[_0x1aac39(0x128)](_0x1aac39(0x15a));const _0x1a36f8=await CompaniesSettings_1[_0x1aac39(0x136)]['findOne']({'where':{'companyId':_0x33d0ec}}),_0x281150=await(0x0,ShowMessageService_1[_0x1aac39(0x14e)])(_0xb76de5);if(!_0x281150)return _0x50f9f4[_0x1aac39(0x186)](0x194)[_0x1aac39(0x128)](_0x1aac39(0x149));const _0x311466=await(0x0,ShowTicketService_1[_0x1aac39(0x136)])(_0xb76de5[_0x1aac39(0x182)],_0xb76de5[_0x1aac39(0x125)]),{ticket:_0x33bc6a}=await(0x0,FindOrCreateTicketService_1[_0x1aac39(0x136)])(_0x603c11,_0x311466?.['whatsapp'],0x0,_0x311466[_0x1aac39(0x125)],_0x311466[_0x1aac39(0x175)],_0x2a53e4['id'],_0x603c11['isGroup']?_0x603c11:null,_0x1aac39(0x13c),null,!![],_0x1a36f8);let _0x265d4a;(0x0,lodash_1[_0x1aac39(0x113)])(_0x33bc6a?.[_0x1aac39(0x175)])?_0x265d4a={'status':_0x33bc6a[_0x1aac39(0x178)]?_0x1aac39(0x127):_0x1aac39(0x134),'userId':_0x2a53e4['id'],'queueId':_0x311466[_0x1aac39(0x175)]}:_0x265d4a={'status':_0x33bc6a['isGroup']?_0x1aac39(0x127):_0x1aac39(0x134),'userId':_0x2a53e4['id']};await(0x0,UpdateTicketService_1[_0x1aac39(0x136)])({'ticketData':_0x265d4a,'ticketId':_0x33bc6a['id'],'companyId':_0x33bc6a[_0x1aac39(0x125)]});let _0x6a99c0=_0xb76de5[_0x1aac39(0x16f)];if(_0xb76de5['mediaType']==='conversation'||_0xb76de5['mediaType']===_0x1aac39(0x10f))await(0x0,SendWhatsAppMessage_1[_0x1aac39(0x136)])({'body':_0x6a99c0,'ticket':_0x33bc6a,'quotedMsg':_0xda674a,'isForwarded':!![]});else{const _0x18d74e=_0xb76de5[_0x1aac39(0x184)][_0x1aac39(0x16a)](':'+process[_0x1aac39(0x176)][_0x1aac39(0x121)],''),_0x482755=obterNomeEExtensaoDoArquivo(_0x18d74e);_0x6a99c0===_0x482755&&(_0x6a99c0='');const _0x49c428=path_1[_0x1aac39(0x136)][_0x1aac39(0x14c)](__dirname,'..','..','..',_0x1aac39(0x183),_0x1aac39(0x12c)),_0x31de0f=path_1[_0x1aac39(0x136)][_0x1aac39(0x14c)](_0x49c428,'company'+_0x33bc6a[_0x1aac39(0x125)],_0x482755),_0x5e77b6={'fieldname':_0x1aac39(0x174),'originalname':_0x482755,'encoding':'7bit','mimetype':_0xb76de5['mediaType'],'filename':_0x482755,'path':_0x31de0f};await(0x0,SendWhatsAppMedia_1[_0x1aac39(0x136)])({'media':_0x5e77b6,'ticket':_0x33bc6a,'body':_0x6a99c0,'isForwarded':!![]});}return _0x50f9f4[_0x1aac39(0x128)]();};exports[a23_0x227ca8(0x148)]=forwardMessage;const remove=async(_0xa7f9cc,_0x44ce59)=>{const _0x33cb01=a23_0x227ca8,{messageId:_0x338762}=_0xa7f9cc[_0x33cb01(0x12a)],{companyId:_0x217add}=_0xa7f9cc[_0x33cb01(0x120)],_0x3de791=await(0x0,DeleteWhatsAppMessage_1['default'])(_0x338762),_0x138410=(0x0,socket_1[_0x33cb01(0x12f)])();return _0x3de791[_0x33cb01(0x151)]&&(await Message_1[_0x33cb01(0x136)][_0x33cb01(0x187)]({'where':{'id':_0x3de791['id']}}),_0x138410['to'](_0x3de791[_0x33cb01(0x182)][_0x33cb01(0x179)]())[_0x33cb01(0x169)](_0x33cb01(0x14a)+_0x217add+_0x33cb01(0x166),{'action':_0x33cb01(0x15e),'message':_0x3de791})),_0x138410['to'](_0x3de791[_0x33cb01(0x182)]['toString']())[_0x33cb01(0x169)](_0x33cb01(0x14a)+_0x217add+_0x33cb01(0x166),{'action':_0x33cb01(0x15c),'message':_0x3de791}),_0x44ce59[_0x33cb01(0x128)]();};exports[a23_0x227ca8(0x185)]=remove;const allMe=async(_0x3ef30f,_0x243c71)=>{const _0x4521e4=a23_0x227ca8,_0x3cede4=_0x3ef30f[_0x4521e4(0x117)][_0x4521e4(0x163)],_0x4872b3=_0x3ef30f[_0x4521e4(0x117)]['dateEnd'],_0x48b108=_0x3ef30f[_0x4521e4(0x117)]['fromMe'],{companyId:_0x1409b1}=_0x3ef30f[_0x4521e4(0x120)],{count:_0x55bea0}=await(0x0,ListMessagesServiceAll_1['default'])({'companyId':_0x1409b1,'fromMe':_0x48b108,'dateStart':_0x3cede4,'dateEnd':_0x4872b3});return _0x243c71['json']({'count':_0x55bea0});};exports[a23_0x227ca8(0x159)]=allMe;const send=async(_0x5b8277,_0x4a23de)=>{const _0x481a2b=a23_0x227ca8,_0x31c05f=_0x5b8277[_0x481a2b(0x16f)],_0x4d3e01=_0x5b8277[_0x481a2b(0x17a)];try{const _0x1a720e=_0x5b8277[_0x481a2b(0x147)][_0x481a2b(0x129)],[,_0x36e26a]=_0x1a720e[_0x481a2b(0x145)]('\x20'),_0x352ba2=await Whatsapp_1['default']['findOne']({'where':{'token':_0x36e26a}}),_0x392ef7=_0x352ba2[_0x481a2b(0x125)],_0x106e73=await(0x0,ShowPlanCompanyService_1[_0x481a2b(0x136)])(_0x392ef7),_0x1563f6=_0x106e73['plan']['useExternalApi'];if(_0x1563f6){if(!_0x352ba2)throw new Error(_0x481a2b(0x146));if(_0x31c05f['number']===undefined)throw new Error(_0x481a2b(0x12b));const _0x5d5a03=_0x31c05f[_0x481a2b(0x13b)],_0x5f1cb8=_0x31c05f['body'];return _0x4d3e01?await Promise[_0x481a2b(0x157)](_0x4d3e01[_0x481a2b(0x112)](async _0x576f59=>{const _0x10c89a=_0x481a2b;_0x5b8277[_0x10c89a(0x18b)][_0x10c89a(0x155)](_0x10c89a(0x138))[_0x10c89a(0x15f)][_0x10c89a(0x17e)](_0x10c89a(0x111),{'whatsappId':_0x352ba2['id'],'data':{'number':_0x5d5a03,'body':_0x576f59[_0x10c89a(0x153)]['replace']('/','-'),'mediaPath':_0x576f59[_0x10c89a(0x17b)]}},{'removeOnComplete':!![],'attempts':0x3});})):_0x5b8277['app'][_0x481a2b(0x155)](_0x481a2b(0x138))['messageQueue'][_0x481a2b(0x17e)]('SendMessage',{'whatsappId':_0x352ba2['id'],'data':{'number':_0x5d5a03,'body':_0x5f1cb8}},{'removeOnComplete':!![],'attempts':0x3}),_0x4a23de[_0x481a2b(0x128)]({'mensagem':_0x481a2b(0x181)});}return _0x4a23de['status'](0x190)[_0x481a2b(0x114)]({'error':_0x481a2b(0x124)});}catch(_0x1636e7){console[_0x481a2b(0x167)](_0x1636e7);if(Object[_0x481a2b(0x189)](_0x1636e7)[_0x481a2b(0x17d)]===0x0)throw new AppError_1[(_0x481a2b(0x136))](_0x481a2b(0x11d));else throw new AppError_1[(_0x481a2b(0x136))](_0x1636e7[_0x481a2b(0x140)]);}};exports[a23_0x227ca8(0x128)]=send;