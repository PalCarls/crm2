'use strict';const a22_0x37d1e3=a22_0x1c92;(function(_0x98291a,_0x1519b5){const _0x48d0b6=a22_0x1c92,_0x320773=_0x98291a();while(!![]){try{const _0x24bd7e=parseInt(_0x48d0b6(0xc4))/0x1*(-parseInt(_0x48d0b6(0xd6))/0x2)+parseInt(_0x48d0b6(0xfe))/0x3*(-parseInt(_0x48d0b6(0xfc))/0x4)+-parseInt(_0x48d0b6(0xd5))/0x5*(-parseInt(_0x48d0b6(0xc6))/0x6)+parseInt(_0x48d0b6(0xfb))/0x7+-parseInt(_0x48d0b6(0xe4))/0x8*(parseInt(_0x48d0b6(0xcc))/0x9)+parseInt(_0x48d0b6(0xb1))/0xa+parseInt(_0x48d0b6(0x121))/0xb;if(_0x24bd7e===_0x1519b5)break;else _0x320773['push'](_0x320773['shift']());}catch(_0x5bf063){_0x320773['push'](_0x320773['shift']());}}}(a22_0x3e6d,0xbf0f9));var __createBinding=this&&this['__createBinding']||(Object[a22_0x37d1e3(0xd0)]?function(_0x5ba67e,_0x15ebe0,_0x4f6444,_0x322158){const _0x287baa=a22_0x37d1e3;if(_0x322158===undefined)_0x322158=_0x4f6444;var _0x37de66=Object[_0x287baa(0x107)](_0x15ebe0,_0x4f6444);(!_0x37de66||(_0x287baa(0x128)in _0x37de66?!_0x15ebe0[_0x287baa(0xee)]:_0x37de66[_0x287baa(0xb4)]||_0x37de66[_0x287baa(0x126)]))&&(_0x37de66={'enumerable':!![],'get':function(){return _0x15ebe0[_0x4f6444];}}),Object[_0x287baa(0xea)](_0x5ba67e,_0x322158,_0x37de66);}:function(_0x15870f,_0xd7a39f,_0x31150c,_0x3738c7){if(_0x3738c7===undefined)_0x3738c7=_0x31150c;_0x15870f[_0x3738c7]=_0xd7a39f[_0x31150c];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x56ad51,_0x289baa){const _0x46e866=a22_0x37d1e3;Object[_0x46e866(0xea)](_0x56ad51,'default',{'enumerable':!![],'value':_0x289baa});}:function(_0x28412d,_0x4e5817){_0x28412d['default']=_0x4e5817;}),__importStar=this&&this[a22_0x37d1e3(0x101)]||function(_0x4ddcdb){const _0x26e848=a22_0x37d1e3;if(_0x4ddcdb&&_0x4ddcdb[_0x26e848(0xee)])return _0x4ddcdb;var _0x13ed47={};if(_0x4ddcdb!=null){for(var _0x48afcd in _0x4ddcdb)if(_0x48afcd!==_0x26e848(0xf0)&&Object[_0x26e848(0xb5)][_0x26e848(0xe7)][_0x26e848(0x119)](_0x4ddcdb,_0x48afcd))__createBinding(_0x13ed47,_0x4ddcdb,_0x48afcd);}return __setModuleDefault(_0x13ed47,_0x4ddcdb),_0x13ed47;},__importDefault=this&&this[a22_0x37d1e3(0x110)]||function(_0x3e2ec8){return _0x3e2ec8&&_0x3e2ec8['__esModule']?_0x3e2ec8:{'default':_0x3e2ec8};};Object[a22_0x37d1e3(0xea)](exports,'__esModule',{'value':!![]}),exports[a22_0x37d1e3(0xdb)]=exports[a22_0x37d1e3(0xfa)]=exports[a22_0x37d1e3(0xcb)]=exports[a22_0x37d1e3(0x102)]=exports['forwardmessage']=exports[a22_0x37d1e3(0x10d)]=exports[a22_0x37d1e3(0xf8)]=void 0x0;const AppError_1=__importDefault(require(a22_0x37d1e3(0xbc))),SetTicketMessagesAsRead_1=__importDefault(require('../helpers/SetTicketMessagesAsRead')),socket_1=require('../libs/socket'),Message_1=__importDefault(require(a22_0x37d1e3(0x112))),Queue_1=__importDefault(require(a22_0x37d1e3(0xc5))),User_1=__importDefault(require('../models/User')),Whatsapp_1=__importDefault(require(a22_0x37d1e3(0xf9))),jsonwebtoken_1=require('jsonwebtoken'),auth_1=__importDefault(require(a22_0x37d1e3(0xce))),path_1=__importDefault(require(a22_0x37d1e3(0x10f))),lodash_1=require(a22_0x37d1e3(0xf5)),ListMessagesService_1=__importDefault(require(a22_0x37d1e3(0x124))),ShowTicketService_1=__importDefault(require(a22_0x37d1e3(0x125))),DeleteWhatsAppMessage_1=__importDefault(require('../services/WbotServices/DeleteWhatsAppMessage')),SendWhatsAppMedia_1=__importDefault(require(a22_0x37d1e3(0x106))),SendWhatsAppMessage_1=__importDefault(require(a22_0x37d1e3(0x104))),CreateMessageService_1=__importDefault(require('../services/MessageServices/CreateMessageService')),sendFacebookMessageMedia_1=__importDefault(require(a22_0x37d1e3(0x111))),sendFacebookMessage_1=__importDefault(require('../services/FacebookServices/sendFacebookMessage')),ShowPlanCompanyService_1=__importDefault(require('../services/CompanyService/ShowPlanCompanyService')),ListMessagesServiceAll_1=__importDefault(require('../services/MessageServices/ListMessagesServiceAll')),ShowContactService_1=__importDefault(require('../services/ContactServices/ShowContactService')),FindOrCreateTicketService_1=__importDefault(require(a22_0x37d1e3(0x12b))),UpdateTicketService_1=__importDefault(require(a22_0x37d1e3(0xf6))),ListSettingsService_1=__importDefault(require(a22_0x37d1e3(0xff))),ShowMessageService_1=__importStar(require(a22_0x37d1e3(0x129))),index=async(_0x116fbf,_0x5a4180)=>{const _0xbc1aa6=a22_0x37d1e3,{ticketId:_0x50f034}=_0x116fbf[_0xbc1aa6(0x10a)],{pageNumber:_0x4cfd24,selectedQueues:_0x35e6f7}=_0x116fbf[_0xbc1aa6(0x12a)],{companyId:_0x433ec5,profile:_0x32e00c}=_0x116fbf[_0xbc1aa6(0xcf)];let _0x5d6e7e=[];const _0x48338f=await User_1[_0xbc1aa6(0xf0)][_0xbc1aa6(0xdc)](_0x116fbf[_0xbc1aa6(0xcf)]['id'],{'include':[{'model':Queue_1[_0xbc1aa6(0xf0)],'as':'queues'}]});_0x35e6f7?_0x5d6e7e=JSON['parse'](_0x35e6f7):_0x48338f[_0xbc1aa6(0x120)][_0xbc1aa6(0xf1)](_0x3a9446=>{_0x5d6e7e['push'](_0x3a9446['id']);});const {count:_0x5716c1,messages:_0x1cdd00,ticket:_0x519680,hasMore:_0x359184}=await(0x0,ListMessagesService_1['default'])({'pageNumber':_0x4cfd24,'ticketId':_0x50f034,'companyId':_0x433ec5,'queues':_0x5d6e7e,'user':_0x48338f});return _0x519680['channel']===_0xbc1aa6(0x103)&&(0x0,SetTicketMessagesAsRead_1[_0xbc1aa6(0xf0)])(_0x519680),_0x5a4180[_0xbc1aa6(0xe0)]({'count':_0x5716c1,'messages':_0x1cdd00,'ticket':_0x519680,'hasMore':_0x359184});};exports['index']=index;function a22_0x3e6d(){const _0x18f729=['delete','toString','-appMessage','queues','19912123zuuuQC','keys','extendedTextMessage','../services/MessageServices/ListMessagesService','../services/TicketServices/ShowTicketService','configurable','open','get','../services/MessageServices/ShowMessageService','query','../services/TicketServices/FindOrCreateTicketService','6909760TCWMjB','count','emit','writable','prototype','split','destroy','message','contact','public','add','../errors/AppError','messageQueue','replace','conversation','Message\x20not\x20found','group','log','useExternalApi','35557LyblUZ','../models/Queue','6kZrMVs','mediaUrl','company','SendMessage','originalname','remove','27yxPESz','env','../config/auth','user','create','PVT','ticketId','*Mensagem\x20encaminhada\x20de\x20','all','5380280sIszjt','44qCVxMo','status','facebook','*\x0a\x0a','getIO','send','findByPk','_Encaminhada_','remoteJid','secret','json','Mensagem\x20enviada!','mediaType','company-','1682664VdEbRF','pathname','updatedAt','hasOwnProperty','headers','files','defineProperty','plan','app','findOne','__esModule','name','default','forEach','Whatsapp\x20from\x20message\x20not\x20found','map','test','lodash','../services/TicketServices/UpdateTicketService','companyId','index','../models/Whatsapp','allMe','961401IzboaP','209480rqPihI','MessageId\x20or\x20ContactId\x20not\x20found','87sOqlDr','../services/SettingServices/ListSettingsService','verify','__importStar','forwardMessage','whatsapp','../services/WbotServices/SendWhatsAppMessage','O\x20número\x20é\x20obrigatório','../services/WbotServices/SendWhatsAppMedia','getOwnPropertyDescriptor','channel','queueId','params','>>>>>>>>>>>>>>>>>forwardMessage\x20X<<<<<<<<<<<<<<<<<<<','instagram','store','number','path','__importDefault','../services/FacebookServices/sendFacebookMessageMedia','../models/Message','join','isNil','isPrivate','backend','body','authorization','call','Essa\x20empresa\x20não\x20tem\x20permissão\x20para\x20usar\x20a\x20API\x20Externa.\x20Entre\x20em\x20contato\x20com\x20o\x20Suporte\x20para\x20verificar\x20nossos\x20planos!','isGroup','medias'];a22_0x3e6d=function(){return _0x18f729;};return a22_0x3e6d();}function obterNomeEExtensaoDoArquivo(_0x514c57){const _0x3322e6=a22_0x37d1e3;var _0x15e8e5=new URL(_0x514c57),_0x477019=_0x15e8e5[_0x3322e6(0xe5)],_0x4455e1=_0x477019['split']('/')['pop'](),_0x48d252=_0x4455e1['split']('.'),_0x23e147=_0x48d252[0x0],_0xbbe330=_0x48d252[0x1];return _0x23e147+'.'+_0xbbe330;}const store=async(_0x369dfe,_0x3b0478)=>{const _0x1547df=a22_0x37d1e3,{ticketId:_0x7aec56}=_0x369dfe[_0x1547df(0x10a)],{body:_0x5940ce,quotedMsg:_0xc9fe8d,isPrivate:_0x4f48d3,vCard:_0x4dfe93}=_0x369dfe[_0x1547df(0x117)],_0x82a0f8=_0x369dfe[_0x1547df(0xe9)],{companyId:_0x1021f0}=_0x369dfe[_0x1547df(0xcf)],_0x5aa1f0=await(0x0,ShowTicketService_1['default'])(_0x7aec56,_0x1021f0);_0x5aa1f0[_0x1547df(0x108)]==='whatsapp'&&(0x0,SetTicketMessagesAsRead_1[_0x1547df(0xf0)])(_0x5aa1f0);try{if(_0x82a0f8)await Promise[_0x1547df(0xd4)](_0x82a0f8[_0x1547df(0xf3)](async _0x5b5447=>{const _0x2882c7=_0x1547df;_0x5aa1f0[_0x2882c7(0x108)]===_0x2882c7(0x103)&&await(0x0,SendWhatsAppMedia_1[_0x2882c7(0xf0)])({'media':_0x5b5447,'ticket':_0x5aa1f0,'body':_0x5940ce,'isPrivate':/\u200d/[_0x2882c7(0xf4)](_0x5940ce)});if(_0x5aa1f0[_0x2882c7(0x108)]===_0x2882c7(0xd8)||_0x5aa1f0[_0x2882c7(0x108)]==='instagram')try{await(0x0,sendFacebookMessageMedia_1['default'])({'media':_0x5b5447,'ticket':_0x5aa1f0});}catch(_0x4e2861){console['log'](_0x4e2861);}}));else{_0x5aa1f0[_0x1547df(0x108)]===_0x1547df(0x103)&&!_0x4f48d3&&await(0x0,SendWhatsAppMessage_1[_0x1547df(0xf0)])({'body':_0x5940ce,'ticket':_0x5aa1f0,'quotedMsg':_0xc9fe8d,'isPrivate':_0x4f48d3,'vCard':_0x4dfe93});if(_0x5aa1f0['channel']===_0x1547df(0x103)&&_0x4f48d3){const _0x640e0c={'wid':_0x1547df(0xd1)+_0x5aa1f0[_0x1547df(0xe6)][_0x1547df(0x11e)]()[_0x1547df(0xbe)]('\x20',''),'ticketId':_0x5aa1f0['id'],'contactId':undefined,'body':_0x5940ce,'fromMe':!![],'mediaType':!(0x0,lodash_1[_0x1547df(0x114)])(_0x4dfe93)?'contactMessage':_0x1547df(0x123),'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':_0x5aa1f0[_0x1547df(0xb9)]?.[_0x1547df(0xde)],'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x4f48d3};await(0x0,CreateMessageService_1['default'])({'messageData':_0x640e0c,'companyId':_0x5aa1f0[_0x1547df(0xf7)]});}(_0x5aa1f0[_0x1547df(0x108)]===_0x1547df(0xd8)||_0x5aa1f0['channel']===_0x1547df(0x10c))&&await(0x0,sendFacebookMessage_1[_0x1547df(0xf0)])({'body':_0x5940ce,'ticket':_0x5aa1f0,'quotedMsg':_0xc9fe8d});}return _0x3b0478[_0x1547df(0xdb)]();}catch(_0x42dae3){return console[_0x1547df(0xc2)](_0x42dae3),_0x3b0478['status'](0x190)['json']({'error':_0x42dae3[_0x1547df(0xb8)]});}};exports['store']=store;const forwardmessage=async(_0x21dd14,_0x2a849c)=>{const _0x21adfa=a22_0x37d1e3,_0x59e000=_0x21dd14[_0x21adfa(0xe8)][_0x21adfa(0x118)],[,_0x4d0d19]=_0x59e000[_0x21adfa(0xb6)]('\x20'),_0x4a3945=(0x0,jsonwebtoken_1[_0x21adfa(0x100)])(_0x4d0d19,auth_1['default'][_0x21adfa(0xdf)]),{id:_0x9448c7}=_0x21dd14['user'],_0x21e2ac=await User_1[_0x21adfa(0xf0)]['findByPk'](_0x9448c7),{currentContacts:_0x516471,message:_0x41e782,signMessage:_0x2ac093}=_0x21dd14['body'],_0x3a1dab=await(0x0,ListSettingsService_1['default'])({'companyId':_0x41e782['companyId']}),_0x1718fd=_0x41e782['quotedMsgId'];let _0x408ff1;return _0x516471[_0x21adfa(0xf3)](async _0x2cd790=>{const _0x2bbecd=_0x21adfa,_0x2c9bc1=await(0x0,ShowContactService_1[_0x2bbecd(0xf0)])(_0x2cd790['id'],_0x41e782['companyId']),_0x584860=await(0x0,ShowTicketService_1[_0x2bbecd(0xf0)])(_0x41e782[_0x2bbecd(0xd2)],_0x41e782[_0x2bbecd(0xf7)]),{ticket:_0x43fe9b,isCreated:_0x217cdb}=await(0x0,FindOrCreateTicketService_1[_0x2bbecd(0xf0)])(_0x2c9bc1,_0x584860?.[_0x2bbecd(0x103)],0x0,_0x584860[_0x2bbecd(0xf7)],_0x584860[_0x2bbecd(0x109)],_0x21e2ac['id'],_0x2c9bc1['isGroup']?_0x2c9bc1:null,_0x2bbecd(0x103),null,!![],_0x3a1dab),_0x1d5015={'status':_0x43fe9b['isGroup']?'group':'open','userId':_0x21e2ac['id'],'queueId':_0x584860['queueId']};await(0x0,UpdateTicketService_1[_0x2bbecd(0xf0)])({'ticketData':_0x1d5015,'ticketId':_0x43fe9b['id'],'companyId':_0x43fe9b[_0x2bbecd(0xf7)]});if(_0x584860[_0x2bbecd(0x108)]===_0x2bbecd(0x103)){if(_0x41e782[_0x2bbecd(0xc7)]){_0x2ac093&&(_0x408ff1=_0x2bbecd(0xdd));const _0x3777bd=_0x41e782[_0x2bbecd(0xc7)][_0x2bbecd(0xbe)](':'+process[_0x2bbecd(0xcd)]['PORT'],''),_0x1d3e8a=obterNomeEExtensaoDoArquivo(_0x3777bd),_0x232772=path_1[_0x2bbecd(0xf0)][_0x2bbecd(0x113)](__dirname,'..','..','..',_0x2bbecd(0x116),_0x2bbecd(0xba)),_0x2dc912=path_1[_0x2bbecd(0xf0)][_0x2bbecd(0x113)](_0x232772,_0x2bbecd(0xc8)+_0x584860[_0x2bbecd(0xf7)],_0x1d3e8a),_0x55b3bc={'fieldname':'medias','originalname':_0x1d3e8a,'encoding':'7bit','mimetype':_0x41e782['mediaType'],'filename':_0x1d3e8a,'path':_0x2dc912};await(0x0,SendWhatsAppMedia_1[_0x2bbecd(0xf0)])({'media':_0x55b3bc,'ticket':_0x43fe9b,'body':_0x408ff1});}else _0x2ac093?_0x408ff1=_0x2bbecd(0xd3)+_0x21e2ac[_0x2bbecd(0xef)]+_0x2bbecd(0xd9)+_0x41e782[_0x2bbecd(0x117)]:_0x408ff1=''+_0x41e782['body'],await(0x0,SendWhatsAppMessage_1[_0x2bbecd(0xf0)])({'body':_0x408ff1,'ticket':_0x43fe9b,'quotedMsg':_0x1718fd});}}),_0x2a849c['json'](_0x21adfa(0xb2));};exports['forwardmessage']=forwardmessage;const forwardMessage=async(_0x159229,_0x3ab5f9)=>{const _0x2a707e=a22_0x37d1e3;console[_0x2a707e(0xc2)](_0x2a707e(0x10b));const {quotedMsg:_0x5200dc,signMessage:_0x4a8027,messageId:_0x16e637,contactId:_0x115ca8}=_0x159229[_0x2a707e(0x117)],{id:_0x3aeea4,companyId:_0x271e2a}=_0x159229[_0x2a707e(0xcf)],_0x20ddef=await User_1[_0x2a707e(0xf0)][_0x2a707e(0xdc)](_0x3aeea4);if(!_0x16e637||!_0x115ca8)return _0x3ab5f9[_0x2a707e(0xd7)](0xc8)[_0x2a707e(0xdb)](_0x2a707e(0xfd));const _0x1756cb=await(0x0,ShowMessageService_1[_0x2a707e(0xf0)])(_0x16e637),_0x3a5842=await(0x0,ShowContactService_1['default'])(_0x115ca8,_0x271e2a);if(!_0x1756cb)return _0x3ab5f9[_0x2a707e(0xd7)](0x194)[_0x2a707e(0xdb)](_0x2a707e(0xc0));if(!_0x3a5842)return _0x3ab5f9[_0x2a707e(0xd7)](0x194)['send']('Contact\x20not\x20found');const _0x19439a=await(0x0,ListSettingsService_1['default'])({'companyId':_0x1756cb['companyId']}),_0x642e59=await(0x0,ShowMessageService_1['GetWhatsAppFromMessage'])(_0x1756cb);if(!_0x642e59)return _0x3ab5f9[_0x2a707e(0xd7)](0x194)[_0x2a707e(0xdb)](_0x2a707e(0xf2));const _0x510d5d=await(0x0,ShowTicketService_1[_0x2a707e(0xf0)])(_0x1756cb[_0x2a707e(0xd2)],_0x1756cb[_0x2a707e(0xf7)]),{ticket:_0x24b349}=await(0x0,FindOrCreateTicketService_1[_0x2a707e(0xf0)])(_0x3a5842,_0x510d5d?.[_0x2a707e(0x103)],0x0,_0x510d5d[_0x2a707e(0xf7)],_0x510d5d[_0x2a707e(0x109)],_0x20ddef['id'],_0x3a5842['isGroup']?_0x3a5842:null,_0x2a707e(0x103),null,!![],_0x19439a),_0x272de2={'status':_0x24b349[_0x2a707e(0x11b)]?_0x2a707e(0xc1):_0x2a707e(0x127),'userId':_0x20ddef['id'],'queueId':_0x510d5d[_0x2a707e(0x109)]};await(0x0,UpdateTicketService_1[_0x2a707e(0xf0)])({'ticketData':_0x272de2,'ticketId':_0x24b349['id'],'companyId':_0x24b349['companyId']});let _0x3fb457='';_0x4a8027&&(_0x3fb457=_0x2a707e(0xdd));if(_0x1756cb[_0x2a707e(0xe2)]===_0x2a707e(0xbf)||_0x1756cb['mediaType']===_0x2a707e(0x123))await(0x0,SendWhatsAppMessage_1[_0x2a707e(0xf0)])({'body':_0x1756cb[_0x2a707e(0x117)],'ticket':_0x24b349,'quotedMsg':_0x5200dc});else{const _0x446257=_0x1756cb[_0x2a707e(0xc7)][_0x2a707e(0xbe)](':'+process['env']['PORT'],''),_0x27d107=obterNomeEExtensaoDoArquivo(_0x446257),_0x3a0680=path_1['default']['join'](__dirname,'..','..','..',_0x2a707e(0x116),_0x2a707e(0xba)),_0x5a9597=path_1[_0x2a707e(0xf0)][_0x2a707e(0x113)](_0x3a0680,_0x2a707e(0xc8)+_0x24b349[_0x2a707e(0xf7)],_0x27d107),_0x3cd4c8={'fieldname':_0x2a707e(0x11c),'originalname':_0x27d107,'encoding':'7bit','mimetype':_0x1756cb['mediaType'],'filename':_0x27d107,'path':_0x5a9597};await(0x0,SendWhatsAppMedia_1[_0x2a707e(0xf0)])({'media':_0x3cd4c8,'ticket':_0x24b349,'body':_0x3fb457});}return _0x3ab5f9['send']();};exports['forwardMessage']=forwardMessage;const remove=async(_0x5d1620,_0x22774f)=>{const _0x1d1e47=a22_0x37d1e3,{messageId:_0x22468b}=_0x5d1620['params'],{companyId:_0x328be5}=_0x5d1620[_0x1d1e47(0xcf)],_0x246a01=await(0x0,DeleteWhatsAppMessage_1[_0x1d1e47(0xf0)])(_0x22468b),_0x3cebc0=(0x0,socket_1[_0x1d1e47(0xda)])();return _0x246a01[_0x1d1e47(0x115)]&&(await Message_1['default'][_0x1d1e47(0xb7)]({'where':{'id':_0x246a01['id']}}),_0x3cebc0['to'](_0x246a01['ticketId'][_0x1d1e47(0x11e)]())[_0x1d1e47(0xb3)]('company-'+_0x328be5+_0x1d1e47(0x11f),{'action':_0x1d1e47(0x11d),'message':_0x246a01})),_0x3cebc0['to'](_0x246a01['ticketId'][_0x1d1e47(0x11e)]())[_0x1d1e47(0xb3)](_0x1d1e47(0xe3)+_0x328be5+_0x1d1e47(0x11f),{'action':'update','message':_0x246a01}),_0x22774f['send']();};exports[a22_0x37d1e3(0xcb)]=remove;function a22_0x1c92(_0x7967c2,_0x7ad4d2){const _0x3e6d73=a22_0x3e6d();return a22_0x1c92=function(_0x1c925e,_0x4a96d6){_0x1c925e=_0x1c925e-0xb1;let _0x5f5aa6=_0x3e6d73[_0x1c925e];return _0x5f5aa6;},a22_0x1c92(_0x7967c2,_0x7ad4d2);}const allMe=async(_0x3e344d,_0x323cab)=>{const _0x165ecf=a22_0x37d1e3,_0x55618f=_0x3e344d[_0x165ecf(0x12a)]['dateStart'],_0x570a1e=_0x3e344d['query']['dateEnd'],_0x17685b=_0x3e344d[_0x165ecf(0x12a)]['fromMe'],{companyId:_0x5be0f8}=_0x3e344d[_0x165ecf(0xcf)],{count:_0x485cf7}=await(0x0,ListMessagesServiceAll_1['default'])({'companyId':_0x5be0f8,'fromMe':_0x17685b,'dateStart':_0x55618f,'dateEnd':_0x570a1e});return _0x323cab[_0x165ecf(0xe0)]({'count':_0x485cf7});};exports[a22_0x37d1e3(0xfa)]=allMe;const send=async(_0x3be9a6,_0x48190e)=>{const _0xa17160=a22_0x37d1e3,_0x47fced=_0x3be9a6[_0xa17160(0x117)],_0xc9ce39=_0x3be9a6[_0xa17160(0xe9)];try{const _0x207aec=_0x3be9a6[_0xa17160(0xe8)][_0xa17160(0x118)],[,_0x198722]=_0x207aec['split']('\x20'),_0x14ec22=await Whatsapp_1[_0xa17160(0xf0)][_0xa17160(0xed)]({'where':{'token':_0x198722}}),_0x29b881=_0x14ec22['companyId'],_0x52382d=await(0x0,ShowPlanCompanyService_1['default'])(_0x29b881),_0x272272=_0x52382d[_0xa17160(0xeb)][_0xa17160(0xc3)];if(_0x272272){if(!_0x14ec22)throw new Error('Não\x20foi\x20possível\x20realizar\x20a\x20operação');if(_0x47fced[_0xa17160(0x10e)]===undefined)throw new Error(_0xa17160(0x105));const _0x2c9f76=_0x47fced[_0xa17160(0x10e)],_0x2f6c00=_0x47fced[_0xa17160(0x117)];return _0xc9ce39?await Promise[_0xa17160(0xd4)](_0xc9ce39[_0xa17160(0xf3)](async _0x5864d8=>{const _0x58411a=_0xa17160;_0x3be9a6[_0x58411a(0xec)][_0x58411a(0x128)](_0x58411a(0x120))[_0x58411a(0xbd)]['add'](_0x58411a(0xc9),{'whatsappId':_0x14ec22['id'],'data':{'number':_0x2c9f76,'body':_0x5864d8[_0x58411a(0xca)][_0x58411a(0xbe)]('/','-'),'mediaPath':_0x5864d8['path']}},{'removeOnComplete':!![],'attempts':0x3});})):_0x3be9a6[_0xa17160(0xec)][_0xa17160(0x128)](_0xa17160(0x120))[_0xa17160(0xbd)][_0xa17160(0xbb)]('SendMessage',{'whatsappId':_0x14ec22['id'],'data':{'number':_0x2c9f76,'body':_0x2f6c00}},{'removeOnComplete':!![],'attempts':0x3}),_0x48190e[_0xa17160(0xdb)]({'mensagem':_0xa17160(0xe1)});}return _0x48190e[_0xa17160(0xd7)](0x190)[_0xa17160(0xe0)]({'error':_0xa17160(0x11a)});}catch(_0x38ad0f){console[_0xa17160(0xc2)](_0x38ad0f);if(Object[_0xa17160(0x122)](_0x38ad0f)['length']===0x0)throw new AppError_1[(_0xa17160(0xf0))]('Não\x20foi\x20possível\x20enviar\x20a\x20mensagem,\x20tente\x20novamente\x20em\x20alguns\x20instantes');else throw new AppError_1[(_0xa17160(0xf0))](_0x38ad0f[_0xa17160(0xb8)]);}};exports[a22_0x37d1e3(0xdb)]=send;