'use strict';const a23_0x4676db=a23_0x20f7;(function(_0x5ac291,_0x4ee15c){const _0xd1cc69=a23_0x20f7,_0x421d0d=_0x5ac291();while(!![]){try{const _0x191277=parseInt(_0xd1cc69(0x1be))/0x1+-parseInt(_0xd1cc69(0x1ca))/0x2+-parseInt(_0xd1cc69(0x1fd))/0x3*(-parseInt(_0xd1cc69(0x1f1))/0x4)+-parseInt(_0xd1cc69(0x1b3))/0x5+parseInt(_0xd1cc69(0x1e1))/0x6*(parseInt(_0xd1cc69(0x198))/0x7)+parseInt(_0xd1cc69(0x1d8))/0x8*(parseInt(_0xd1cc69(0x1d2))/0x9)+parseInt(_0xd1cc69(0x1bc))/0xa*(-parseInt(_0xd1cc69(0x1c6))/0xb);if(_0x191277===_0x4ee15c)break;else _0x421d0d['push'](_0x421d0d['shift']());}catch(_0x1e7f24){_0x421d0d['push'](_0x421d0d['shift']());}}}(a23_0x2ab8,0xbb28b));var __createBinding=this&&this[a23_0x4676db(0x1a4)]||(Object[a23_0x4676db(0x1cb)]?function(_0x1f3929,_0x439bad,_0x3c1516,_0x4486bb){const _0x2c3ce9=a23_0x4676db;if(_0x4486bb===undefined)_0x4486bb=_0x3c1516;var _0x1dc434=Object['getOwnPropertyDescriptor'](_0x439bad,_0x3c1516);(!_0x1dc434||(_0x2c3ce9(0x1e6)in _0x1dc434?!_0x439bad[_0x2c3ce9(0x1df)]:_0x1dc434[_0x2c3ce9(0x1d5)]||_0x1dc434[_0x2c3ce9(0x1da)]))&&(_0x1dc434={'enumerable':!![],'get':function(){return _0x439bad[_0x3c1516];}}),Object['defineProperty'](_0x1f3929,_0x4486bb,_0x1dc434);}:function(_0x60fef8,_0x59df27,_0x353459,_0x313c9f){if(_0x313c9f===undefined)_0x313c9f=_0x353459;_0x60fef8[_0x313c9f]=_0x59df27[_0x353459];}),__setModuleDefault=this&&this[a23_0x4676db(0x184)]||(Object[a23_0x4676db(0x1cb)]?function(_0x256726,_0x2a3e77){Object['defineProperty'](_0x256726,'default',{'enumerable':!![],'value':_0x2a3e77});}:function(_0x504568,_0xf21f1d){const _0x1aeb0c=a23_0x4676db;_0x504568[_0x1aeb0c(0x1e0)]=_0xf21f1d;}),__importStar=this&&this[a23_0x4676db(0x1b1)]||function(_0x1ebb71){const _0x2c7a3f=a23_0x4676db;if(_0x1ebb71&&_0x1ebb71[_0x2c7a3f(0x1df)])return _0x1ebb71;var _0xabf192={};if(_0x1ebb71!=null){for(var _0x513bfe in _0x1ebb71)if(_0x513bfe!==_0x2c7a3f(0x1e0)&&Object['prototype'][_0x2c7a3f(0x1a5)][_0x2c7a3f(0x1bb)](_0x1ebb71,_0x513bfe))__createBinding(_0xabf192,_0x1ebb71,_0x513bfe);}return __setModuleDefault(_0xabf192,_0x1ebb71),_0xabf192;},__importDefault=this&&this['__importDefault']||function(_0x5ed894){const _0x5c2d31=a23_0x4676db;return _0x5ed894&&_0x5ed894[_0x5c2d31(0x1df)]?_0x5ed894:{'default':_0x5ed894};};Object[a23_0x4676db(0x1f8)](exports,a23_0x4676db(0x1df),{'value':!![]}),exports['send']=exports[a23_0x4676db(0x1d0)]=exports[a23_0x4676db(0x1eb)]=exports[a23_0x4676db(0x199)]=exports['forwardmessage']=exports[a23_0x4676db(0x1c8)]=exports[a23_0x4676db(0x1a6)]=void 0x0;const AppError_1=__importDefault(require('../errors/AppError')),SetTicketMessagesAsRead_1=__importDefault(require(a23_0x4676db(0x1fc))),socket_1=require(a23_0x4676db(0x1c7)),Message_1=__importDefault(require(a23_0x4676db(0x1e9))),Queue_1=__importDefault(require('../models/Queue')),User_1=__importDefault(require(a23_0x4676db(0x185))),Whatsapp_1=__importDefault(require(a23_0x4676db(0x1b6))),jsonwebtoken_1=require(a23_0x4676db(0x1b0)),auth_1=__importDefault(require(a23_0x4676db(0x1c9))),path_1=__importDefault(require('path')),lodash_1=require('lodash'),ListMessagesService_1=__importDefault(require('../services/MessageServices/ListMessagesService')),ShowTicketService_1=__importDefault(require(a23_0x4676db(0x1c3))),DeleteWhatsAppMessage_1=__importDefault(require(a23_0x4676db(0x1b4))),SendWhatsAppMedia_1=__importDefault(require(a23_0x4676db(0x1a3))),SendWhatsAppMessage_1=__importDefault(require(a23_0x4676db(0x1ed))),CreateMessageService_1=__importDefault(require('../services/MessageServices/CreateMessageService')),sendFacebookMessageMedia_1=__importDefault(require('../services/FacebookServices/sendFacebookMessageMedia')),sendFacebookMessage_1=__importDefault(require('../services/FacebookServices/sendFacebookMessage')),ShowPlanCompanyService_1=__importDefault(require(a23_0x4676db(0x1ce))),ListMessagesServiceAll_1=__importDefault(require(a23_0x4676db(0x1f7))),ShowContactService_1=__importDefault(require(a23_0x4676db(0x190))),FindOrCreateTicketService_1=__importDefault(require(a23_0x4676db(0x1d9))),UpdateTicketService_1=__importDefault(require(a23_0x4676db(0x1e2))),ShowMessageService_1=__importStar(require(a23_0x4676db(0x1a7))),CompaniesSettings_1=__importDefault(require('../models/CompaniesSettings')),index=async(_0x4c7328,_0x480de4)=>{const _0x2e504c=a23_0x4676db,{ticketId:_0x19b10f}=_0x4c7328[_0x2e504c(0x1a0)],{pageNumber:_0x7dbf8d,selectedQueues:_0x14e27a}=_0x4c7328['query'],{companyId:_0x46c1e3,profile:_0x3d7508}=_0x4c7328[_0x2e504c(0x1af)];let _0x39389b=[];const _0x1ccde6=await User_1['default'][_0x2e504c(0x1c1)](_0x4c7328['user']['id'],{'include':[{'model':Queue_1[_0x2e504c(0x1e0)],'as':_0x2e504c(0x1ae)}]});_0x14e27a?_0x39389b=JSON[_0x2e504c(0x1ea)](_0x14e27a):_0x1ccde6[_0x2e504c(0x1ae)][_0x2e504c(0x18e)](_0x2fb2f1=>{const _0x3f668e=_0x2e504c;_0x39389b[_0x3f668e(0x1fb)](_0x2fb2f1['id']);});const {count:_0x5a141f,messages:_0x5b9021,ticket:_0x4519cc,hasMore:_0x3558f9}=await(0x0,ListMessagesService_1[_0x2e504c(0x1e0)])({'pageNumber':_0x7dbf8d,'ticketId':_0x19b10f,'companyId':_0x46c1e3,'queues':_0x39389b,'user':_0x1ccde6});return _0x4519cc[_0x2e504c(0x1b2)]===_0x2e504c(0x19e)&&(0x0,SetTicketMessagesAsRead_1[_0x2e504c(0x1e0)])(_0x4519cc),_0x480de4[_0x2e504c(0x1db)]({'count':_0x5a141f,'messages':_0x5b9021,'ticket':_0x4519cc,'hasMore':_0x3558f9});};exports[a23_0x4676db(0x1a6)]=index;function obterNomeEExtensaoDoArquivo(_0x2652cd){const _0x14cff0=a23_0x4676db;var _0x1f7036=new URL(_0x2652cd),_0x5a3c19=_0x1f7036['pathname'],_0x4eeb23=_0x5a3c19[_0x14cff0(0x187)]('/')['pop'](),_0x3e7eb7=_0x4eeb23[_0x14cff0(0x187)]('.'),_0x187a75=_0x3e7eb7[0x0],_0x1f789b=_0x3e7eb7[0x1];return _0x187a75+'.'+_0x1f789b;}function a23_0x2ab8(){const _0x898522=['Não\x20foi\x20possível\x20realizar\x20a\x20operação','7bit','Essa\x20empresa\x20não\x20tem\x20permissão\x20para\x20usar\x20a\x20API\x20Externa.\x20Entre\x20em\x20contato\x20com\x20o\x20Suporte\x20para\x20verificar\x20nossos\x20planos!','count','join','forEach','map','../services/ContactServices/ShowContactService','Contact\x20not\x20found','messageQueue','replace','backend','path','body','originalname','1221017VDLhhc','forwardMessage','test','headers','dateEnd','medias','whatsapp','send','params','query','files','../services/WbotServices/SendWhatsAppMedia','__createBinding','hasOwnProperty','index','../services/MessageServices/ShowMessageService','facebook','Message\x20not\x20found','authorization','delete','status','Whatsapp\x20from\x20message\x20not\x20found','queues','user','jsonwebtoken','__importStar','channel','1102390LJikIr','../services/WbotServices/DeleteWhatsAppMessage','ticketId','../models/Whatsapp','keys','toString','GetWhatsAppFromMessage','secret','call','420jNAbVQ','mediaType','1474210focrBL','env','contact','findByPk','isGroup','../services/TicketServices/ShowTicketService','SendMessage','destroy','837177BibHxk','../libs/socket','store','../config/auth','1319114EuYXTY','create','fromMe','all','../services/CompanyService/ShowPlanCompanyService','-appMessage','allMe','useExternalApi','117AJcoEH','remoteJid','PORT','writable','emit','number','912232AkLmYt','../services/TicketServices/FindOrCreateTicketService','configurable','json','add','group','update','__esModule','default','18FauUar','../services/TicketServices/UpdateTicketService','company','mediaUrl','verify','get','findOne','company-','../models/Message','parse','remove','O\x20número\x20é\x20obrigatório','../services/WbotServices/SendWhatsAppMessage','Não\x20foi\x20possível\x20enviar\x20a\x20mensagem,\x20tente\x20novamente\x20em\x20alguns\x20instantes','extendedTextMessage','quotedMsgId','4BSTEMk','forwardmessage','companyId','dateStart','updatedAt','open','../services/MessageServices/ListMessagesServiceAll','defineProperty','PVT','MessageId\x20or\x20ContactId\x20not\x20found','push','../helpers/SetTicketMessagesAsRead','4089756ymvHJn','log','queueId','message','__setModuleDefault','../models/User','isNil','split','conversation'];a23_0x2ab8=function(){return _0x898522;};return a23_0x2ab8();}const store=async(_0x13684a,_0x3dd173)=>{const _0x56ea4f=a23_0x4676db,{ticketId:_0x5b96c3}=_0x13684a[_0x56ea4f(0x1a0)],{body:_0x2db3a5,quotedMsg:_0xdf3a7d,isPrivate:_0x46e70d,vCard:_0x3b68e3}=_0x13684a['body'],_0x1bfbea=_0x13684a[_0x56ea4f(0x1a2)],{companyId:_0x247126}=_0x13684a[_0x56ea4f(0x1af)],_0x22b453=await(0x0,ShowTicketService_1[_0x56ea4f(0x1e0)])(_0x5b96c3,_0x247126);_0x22b453[_0x56ea4f(0x1b2)]===_0x56ea4f(0x19e)&&(0x0,SetTicketMessagesAsRead_1[_0x56ea4f(0x1e0)])(_0x22b453);try{if(_0x1bfbea)await Promise['all'](_0x1bfbea['map'](async _0x4cbf0e=>{const _0x4734f6=_0x56ea4f;_0x22b453[_0x4734f6(0x1b2)]==='whatsapp'&&await(0x0,SendWhatsAppMedia_1[_0x4734f6(0x1e0)])({'media':_0x4cbf0e,'ticket':_0x22b453,'body':'','isPrivate':/\u200d/[_0x4734f6(0x19a)](_0x2db3a5),'isForwarded':![]});if(_0x22b453[_0x4734f6(0x1b2)]==='facebook'||_0x22b453['channel']==='instagram')try{await(0x0,sendFacebookMessageMedia_1[_0x4734f6(0x1e0)])({'media':_0x4cbf0e,'ticket':_0x22b453});}catch(_0x48b073){console[_0x4734f6(0x181)](_0x48b073);}}));else{_0x22b453[_0x56ea4f(0x1b2)]==='whatsapp'&&!_0x46e70d&&await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x2db3a5,'ticket':_0x22b453,'quotedMsg':_0xdf3a7d,'isPrivate':_0x46e70d,'vCard':_0x3b68e3});if(_0x22b453[_0x56ea4f(0x1b2)]===_0x56ea4f(0x19e)&&_0x46e70d){const _0x3cab5d={'wid':_0x56ea4f(0x1f9)+_0x22b453[_0x56ea4f(0x1f5)][_0x56ea4f(0x1b8)]()[_0x56ea4f(0x193)]('\x20',''),'ticketId':_0x22b453['id'],'contactId':undefined,'body':_0x2db3a5,'fromMe':!![],'mediaType':!(0x0,lodash_1['isNil'])(_0x3b68e3)?'contactMessage':_0x56ea4f(0x1ef),'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':_0x22b453[_0x56ea4f(0x1c0)]?.[_0x56ea4f(0x1d3)],'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x46e70d};await(0x0,CreateMessageService_1[_0x56ea4f(0x1e0)])({'messageData':_0x3cab5d,'companyId':_0x22b453[_0x56ea4f(0x1f3)]});}(_0x22b453[_0x56ea4f(0x1b2)]===_0x56ea4f(0x1a8)||_0x22b453[_0x56ea4f(0x1b2)]==='instagram')&&await(0x0,sendFacebookMessage_1[_0x56ea4f(0x1e0)])({'body':_0x2db3a5,'ticket':_0x22b453,'quotedMsg':_0xdf3a7d});}return _0x3dd173[_0x56ea4f(0x19f)]();}catch(_0x18df0f){return console[_0x56ea4f(0x181)](_0x18df0f),_0x3dd173[_0x56ea4f(0x1ac)](0x190)[_0x56ea4f(0x1db)]({'error':_0x18df0f[_0x56ea4f(0x183)]});}};exports['store']=store;function a23_0x20f7(_0x539c5f,_0x2e5ac2){const _0x2ab893=a23_0x2ab8();return a23_0x20f7=function(_0x20f765,_0x4c2009){_0x20f765=_0x20f765-0x181;let _0x3fd8fe=_0x2ab893[_0x20f765];return _0x3fd8fe;},a23_0x20f7(_0x539c5f,_0x2e5ac2);}const forwardmessage=async(_0x479a70,_0x482e1a)=>{const _0x49ecd5=a23_0x4676db,_0x571dc0=_0x479a70['headers'][_0x49ecd5(0x1aa)],[,_0x1bef7c]=_0x571dc0['split']('\x20'),_0xf37f3e=(0x0,jsonwebtoken_1[_0x49ecd5(0x1e5)])(_0x1bef7c,auth_1['default'][_0x49ecd5(0x1ba)]),{id:_0x4ca8fc}=_0x479a70[_0x49ecd5(0x1af)],_0xe95bd8=await User_1[_0x49ecd5(0x1e0)][_0x49ecd5(0x1c1)](_0x4ca8fc),{currentContacts:_0x13c7e5,message:_0x34053e,signMessage:_0x2402f2}=_0x479a70[_0x49ecd5(0x196)],{companyId:_0x2789e6}=_0x34053e,_0x4ce55a=await CompaniesSettings_1[_0x49ecd5(0x1e0)][_0x49ecd5(0x1e7)]({'where':{'companyId':_0x2789e6}}),_0x2a7a47=_0x34053e[_0x49ecd5(0x1f0)];let _0x3bef3d;return _0x13c7e5[_0x49ecd5(0x18f)](async _0x548ce1=>{const _0x292663=_0x49ecd5,_0x241d02=await(0x0,ShowContactService_1['default'])(_0x548ce1['id'],_0x34053e[_0x292663(0x1f3)]),_0x1b0a1f=await(0x0,ShowTicketService_1[_0x292663(0x1e0)])(_0x34053e[_0x292663(0x1b5)],_0x34053e[_0x292663(0x1f3)]),{ticket:_0x4e5b11,isCreated:_0x5a5965}=await(0x0,FindOrCreateTicketService_1['default'])(_0x241d02,_0x1b0a1f?.[_0x292663(0x19e)],0x0,_0x1b0a1f[_0x292663(0x1f3)],_0x1b0a1f[_0x292663(0x182)],_0xe95bd8['id'],_0x241d02['isGroup']?_0x241d02:null,_0x292663(0x19e),null,!![],_0x4ce55a),_0x288183={'status':_0x4e5b11[_0x292663(0x1c2)]?'group':'open','userId':_0xe95bd8['id'],'queueId':_0x1b0a1f[_0x292663(0x182)]};await(0x0,UpdateTicketService_1[_0x292663(0x1e0)])({'ticketData':_0x288183,'ticketId':_0x4e5b11['id'],'companyId':_0x4e5b11[_0x292663(0x1f3)]});if(_0x1b0a1f[_0x292663(0x1b2)]===_0x292663(0x19e)){if(_0x34053e[_0x292663(0x1e4)]){_0x3bef3d='_Encaminhada_';const _0x278272=_0x34053e[_0x292663(0x1e4)][_0x292663(0x193)](':'+process[_0x292663(0x1bf)][_0x292663(0x1d4)],''),_0x212637=obterNomeEExtensaoDoArquivo(_0x278272),_0x1d49e1=path_1[_0x292663(0x1e0)][_0x292663(0x18d)](__dirname,'..','..','..',_0x292663(0x194),'public'),_0x5c586f=path_1[_0x292663(0x1e0)]['join'](_0x1d49e1,_0x292663(0x1e3)+_0x1b0a1f['companyId'],_0x212637),_0xc33acc={'fieldname':_0x292663(0x19d),'originalname':_0x212637,'encoding':_0x292663(0x18a),'mimetype':_0x34053e[_0x292663(0x1bd)],'filename':_0x212637,'path':_0x5c586f};await(0x0,SendWhatsAppMedia_1[_0x292663(0x1e0)])({'media':_0xc33acc,'ticket':_0x4e5b11,'body':_0x3bef3d,'isForwarded':![]});}else _0x2402f2?_0x3bef3d='*Mensagem\x20encaminhada\x20de\x20'+_0xe95bd8['name']+'*\x0a\x0a'+_0x34053e['body']:_0x3bef3d=''+_0x34053e[_0x292663(0x196)],await(0x0,SendWhatsAppMessage_1[_0x292663(0x1e0)])({'body':_0x3bef3d,'ticket':_0x4e5b11,'quotedMsg':_0x2a7a47});}}),_0x482e1a['json'](_0x49ecd5(0x18c));};exports[a23_0x4676db(0x1f2)]=forwardmessage;const forwardMessage=async(_0x240af4,_0x5924c2)=>{const _0x519d0f=a23_0x4676db;console['log']('>>>>>>>>>>>>>>>>>forwardMessage\x20X<<<<<<<<<<<<<<<<<<<');const {quotedMsg:_0x1b5b2f,signMessage:_0x173402,messageId:_0x564008,contactId:_0x18afb7}=_0x240af4[_0x519d0f(0x196)],{id:_0x49dd12,companyId:_0x1be187}=_0x240af4[_0x519d0f(0x1af)],_0x5cd958=await User_1[_0x519d0f(0x1e0)][_0x519d0f(0x1c1)](_0x49dd12);if(!_0x564008||!_0x18afb7)return _0x5924c2[_0x519d0f(0x1ac)](0xc8)[_0x519d0f(0x19f)](_0x519d0f(0x1fa));const _0x362f31=await(0x0,ShowMessageService_1[_0x519d0f(0x1e0)])(_0x564008),_0x84d5ea=await(0x0,ShowContactService_1[_0x519d0f(0x1e0)])(_0x18afb7,_0x1be187);if(!_0x362f31)return _0x5924c2['status'](0x194)[_0x519d0f(0x19f)](_0x519d0f(0x1a9));if(!_0x84d5ea)return _0x5924c2[_0x519d0f(0x1ac)](0x194)['send'](_0x519d0f(0x191));const _0x15d224=await CompaniesSettings_1[_0x519d0f(0x1e0)][_0x519d0f(0x1e7)]({'where':{'companyId':_0x1be187}}),_0x360305=await(0x0,ShowMessageService_1[_0x519d0f(0x1b9)])(_0x362f31);if(!_0x360305)return _0x5924c2[_0x519d0f(0x1ac)](0x194)[_0x519d0f(0x19f)](_0x519d0f(0x1ad));const _0x210a31=await(0x0,ShowTicketService_1[_0x519d0f(0x1e0)])(_0x362f31[_0x519d0f(0x1b5)],_0x362f31[_0x519d0f(0x1f3)]),{ticket:_0x1e4b9b}=await(0x0,FindOrCreateTicketService_1[_0x519d0f(0x1e0)])(_0x84d5ea,_0x210a31?.['whatsapp'],0x0,_0x210a31[_0x519d0f(0x1f3)],_0x210a31['queueId'],_0x5cd958['id'],_0x84d5ea['isGroup']?_0x84d5ea:null,_0x519d0f(0x19e),null,!![],_0x15d224);let _0x32c7b6;(0x0,lodash_1[_0x519d0f(0x186)])(_0x1e4b9b?.['queueId'])?_0x32c7b6={'status':_0x1e4b9b[_0x519d0f(0x1c2)]?_0x519d0f(0x1dd):'open','userId':_0x5cd958['id'],'queueId':_0x210a31[_0x519d0f(0x182)]}:_0x32c7b6={'status':_0x1e4b9b['isGroup']?_0x519d0f(0x1dd):_0x519d0f(0x1f6),'userId':_0x5cd958['id']};await(0x0,UpdateTicketService_1[_0x519d0f(0x1e0)])({'ticketData':_0x32c7b6,'ticketId':_0x1e4b9b['id'],'companyId':_0x1e4b9b[_0x519d0f(0x1f3)]});let _0x533f86=_0x362f31[_0x519d0f(0x196)];if(_0x362f31[_0x519d0f(0x1bd)]===_0x519d0f(0x188)||_0x362f31[_0x519d0f(0x1bd)]==='extendedTextMessage')await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x533f86,'ticket':_0x1e4b9b,'quotedMsg':_0x1b5b2f,'isForwarded':!![]});else{const _0x21c5fb=_0x362f31['mediaUrl'][_0x519d0f(0x193)](':'+process['env'][_0x519d0f(0x1d4)],''),_0x27ad4f=obterNomeEExtensaoDoArquivo(_0x21c5fb);_0x533f86===_0x27ad4f&&(_0x533f86='');const _0x2b171f=path_1[_0x519d0f(0x1e0)][_0x519d0f(0x18d)](__dirname,'..','..','..','backend','public'),_0x323da6=path_1['default'][_0x519d0f(0x18d)](_0x2b171f,_0x519d0f(0x1e3)+_0x1e4b9b[_0x519d0f(0x1f3)],_0x27ad4f),_0x362bc7={'fieldname':_0x519d0f(0x19d),'originalname':_0x27ad4f,'encoding':_0x519d0f(0x18a),'mimetype':_0x362f31[_0x519d0f(0x1bd)],'filename':_0x27ad4f,'path':_0x323da6};await(0x0,SendWhatsAppMedia_1[_0x519d0f(0x1e0)])({'media':_0x362bc7,'ticket':_0x1e4b9b,'body':_0x533f86,'isForwarded':!![]});}return _0x5924c2['send']();};exports['forwardMessage']=forwardMessage;const remove=async(_0x39fd3f,_0x209258)=>{const _0x4f5d05=a23_0x4676db,{messageId:_0x189eb6}=_0x39fd3f[_0x4f5d05(0x1a0)],{companyId:_0x371205}=_0x39fd3f[_0x4f5d05(0x1af)],_0x39ad8a=await(0x0,DeleteWhatsAppMessage_1['default'])(_0x189eb6),_0x43ee4b=(0x0,socket_1['getIO'])();return _0x39ad8a['isPrivate']&&(await Message_1['default'][_0x4f5d05(0x1c5)]({'where':{'id':_0x39ad8a['id']}}),_0x43ee4b['to'](_0x39ad8a[_0x4f5d05(0x1b5)][_0x4f5d05(0x1b8)]())[_0x4f5d05(0x1d6)](_0x4f5d05(0x1e8)+_0x371205+_0x4f5d05(0x1cf),{'action':_0x4f5d05(0x1ab),'message':_0x39ad8a})),_0x43ee4b['to'](_0x39ad8a['ticketId']['toString']())['emit']('company-'+_0x371205+_0x4f5d05(0x1cf),{'action':_0x4f5d05(0x1de),'message':_0x39ad8a}),_0x209258[_0x4f5d05(0x19f)]();};exports['remove']=remove;const allMe=async(_0x2cd67c,_0x816f7a)=>{const _0x35feb2=a23_0x4676db,_0x12cbcb=_0x2cd67c[_0x35feb2(0x1a1)][_0x35feb2(0x1f4)],_0x3044d5=_0x2cd67c[_0x35feb2(0x1a1)][_0x35feb2(0x19c)],_0x4c3e18=_0x2cd67c[_0x35feb2(0x1a1)][_0x35feb2(0x1cc)],{companyId:_0x4642aa}=_0x2cd67c[_0x35feb2(0x1af)],{count:_0x285dba}=await(0x0,ListMessagesServiceAll_1[_0x35feb2(0x1e0)])({'companyId':_0x4642aa,'fromMe':_0x4c3e18,'dateStart':_0x12cbcb,'dateEnd':_0x3044d5});return _0x816f7a[_0x35feb2(0x1db)]({'count':_0x285dba});};exports[a23_0x4676db(0x1d0)]=allMe;const send=async(_0x100e05,_0xb092b4)=>{const _0x3810e6=a23_0x4676db,_0x3e580b=_0x100e05[_0x3810e6(0x196)],_0x451c00=_0x100e05[_0x3810e6(0x1a2)];try{const _0x4ff83d=_0x100e05[_0x3810e6(0x19b)][_0x3810e6(0x1aa)],[,_0x1936eb]=_0x4ff83d[_0x3810e6(0x187)]('\x20'),_0x34ac07=await Whatsapp_1['default']['findOne']({'where':{'token':_0x1936eb}}),_0x1ab0c6=_0x34ac07[_0x3810e6(0x1f3)],_0x262387=await(0x0,ShowPlanCompanyService_1[_0x3810e6(0x1e0)])(_0x1ab0c6),_0x531e6b=_0x262387['plan'][_0x3810e6(0x1d1)];if(_0x531e6b){if(!_0x34ac07)throw new Error(_0x3810e6(0x189));if(_0x3e580b[_0x3810e6(0x1d7)]===undefined)throw new Error(_0x3810e6(0x1ec));const _0x143d9a=_0x3e580b['number'],_0x577024=_0x3e580b[_0x3810e6(0x196)];return _0x451c00?await Promise[_0x3810e6(0x1cd)](_0x451c00[_0x3810e6(0x18f)](async _0x5c9879=>{const _0x1047ed=_0x3810e6;_0x100e05['app'][_0x1047ed(0x1e6)]('queues')[_0x1047ed(0x192)][_0x1047ed(0x1dc)]('SendMessage',{'whatsappId':_0x34ac07['id'],'data':{'number':_0x143d9a,'body':_0x5c9879[_0x1047ed(0x197)][_0x1047ed(0x193)]('/','-'),'mediaPath':_0x5c9879[_0x1047ed(0x195)]}},{'removeOnComplete':!![],'attempts':0x3});})):_0x100e05['app'][_0x3810e6(0x1e6)](_0x3810e6(0x1ae))[_0x3810e6(0x192)][_0x3810e6(0x1dc)](_0x3810e6(0x1c4),{'whatsappId':_0x34ac07['id'],'data':{'number':_0x143d9a,'body':_0x577024}},{'removeOnComplete':!![],'attempts':0x3}),_0xb092b4['send']({'mensagem':'Mensagem\x20enviada!'});}return _0xb092b4['status'](0x190)[_0x3810e6(0x1db)]({'error':_0x3810e6(0x18b)});}catch(_0x9ccdc1){console[_0x3810e6(0x181)](_0x9ccdc1);if(Object[_0x3810e6(0x1b7)](_0x9ccdc1)['length']===0x0)throw new AppError_1[(_0x3810e6(0x1e0))](_0x3810e6(0x1ee));else throw new AppError_1[(_0x3810e6(0x1e0))](_0x9ccdc1[_0x3810e6(0x183)]);}};exports[a23_0x4676db(0x19f)]=send;