'use strict';const a23_0x340648=a23_0x2b32;(function(_0x5102fd,_0x424dca){const _0x129125=a23_0x2b32,_0x24ea81=_0x5102fd();while(!![]){try{const _0x55f21f=-parseInt(_0x129125(0x132))/0x1*(-parseInt(_0x129125(0x15d))/0x2)+parseInt(_0x129125(0x13f))/0x3*(parseInt(_0x129125(0x121))/0x4)+parseInt(_0x129125(0xfb))/0x5*(parseInt(_0x129125(0x111))/0x6)+-parseInt(_0x129125(0x10b))/0x7+-parseInt(_0x129125(0x15c))/0x8*(parseInt(_0x129125(0xf5))/0x9)+parseInt(_0x129125(0x15f))/0xa+-parseInt(_0x129125(0x12e))/0xb;if(_0x55f21f===_0x424dca)break;else _0x24ea81['push'](_0x24ea81['shift']());}catch(_0x30c86c){_0x24ea81['push'](_0x24ea81['shift']());}}}(a23_0x44e9,0xd3775));var __createBinding=this&&this[a23_0x340648(0x16b)]||(Object['create']?function(_0xacbf3c,_0x3e9309,_0x5374d4,_0x205f2b){const _0x3fc2ec=a23_0x340648;if(_0x205f2b===undefined)_0x205f2b=_0x5374d4;var _0x1c10b2=Object[_0x3fc2ec(0x10c)](_0x3e9309,_0x5374d4);(!_0x1c10b2||(_0x3fc2ec(0xfe)in _0x1c10b2?!_0x3e9309[_0x3fc2ec(0x13c)]:_0x1c10b2['writable']||_0x1c10b2[_0x3fc2ec(0x160)]))&&(_0x1c10b2={'enumerable':!![],'get':function(){return _0x3e9309[_0x5374d4];}}),Object[_0x3fc2ec(0xf4)](_0xacbf3c,_0x205f2b,_0x1c10b2);}:function(_0x28fc09,_0x46980b,_0x55efe4,_0x5f4653){if(_0x5f4653===undefined)_0x5f4653=_0x55efe4;_0x28fc09[_0x5f4653]=_0x46980b[_0x55efe4];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a23_0x340648(0x151)]?function(_0xe9a8c1,_0x461723){const _0x1a4d2f=a23_0x340648;Object[_0x1a4d2f(0xf4)](_0xe9a8c1,_0x1a4d2f(0x118),{'enumerable':!![],'value':_0x461723});}:function(_0x6c85a4,_0x56d0d0){const _0x56bf6f=a23_0x340648;_0x6c85a4[_0x56bf6f(0x118)]=_0x56d0d0;}),__importStar=this&&this[a23_0x340648(0x16c)]||function(_0x3e4b22){const _0x320486=a23_0x340648;if(_0x3e4b22&&_0x3e4b22[_0x320486(0x13c)])return _0x3e4b22;var _0xcda09f={};if(_0x3e4b22!=null){for(var _0x5e2499 in _0x3e4b22)if(_0x5e2499!==_0x320486(0x118)&&Object[_0x320486(0x128)][_0x320486(0xf0)][_0x320486(0x13e)](_0x3e4b22,_0x5e2499))__createBinding(_0xcda09f,_0x3e4b22,_0x5e2499);}return __setModuleDefault(_0xcda09f,_0x3e4b22),_0xcda09f;},__importDefault=this&&this[a23_0x340648(0x143)]||function(_0xbf2f49){const _0xfbaa2c=a23_0x340648;return _0xbf2f49&&_0xbf2f49[_0xfbaa2c(0x13c)]?_0xbf2f49:{'default':_0xbf2f49};};Object[a23_0x340648(0xf4)](exports,a23_0x340648(0x13c),{'value':!![]}),exports[a23_0x340648(0x138)]=exports[a23_0x340648(0x141)]=exports[a23_0x340648(0x12c)]=exports['forwardMessage']=exports[a23_0x340648(0x140)]=exports['store']=exports[a23_0x340648(0x10a)]=void 0x0;function a23_0x2b32(_0x4e16bd,_0x5503a8){const _0x44e9fc=a23_0x44e9();return a23_0x2b32=function(_0x2b32bd,_0x572332){_0x2b32bd=_0x2b32bd-0xe8;let _0xb1a584=_0x44e9fc[_0x2b32bd];return _0xb1a584;},a23_0x2b32(_0x4e16bd,_0x5503a8);}const AppError_1=__importDefault(require(a23_0x340648(0x144))),SetTicketMessagesAsRead_1=__importDefault(require('../helpers/SetTicketMessagesAsRead')),socket_1=require('../libs/socket'),Message_1=__importDefault(require(a23_0x340648(0x157))),Queue_1=__importDefault(require(a23_0x340648(0x14d))),User_1=__importDefault(require(a23_0x340648(0x153))),Whatsapp_1=__importDefault(require(a23_0x340648(0x109))),jsonwebtoken_1=require(a23_0x340648(0x103)),auth_1=__importDefault(require(a23_0x340648(0x15a))),path_1=__importDefault(require(a23_0x340648(0x127))),lodash_1=require(a23_0x340648(0x130)),ListMessagesService_1=__importDefault(require(a23_0x340648(0x123))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),DeleteWhatsAppMessage_1=__importDefault(require(a23_0x340648(0xfa))),SendWhatsAppMedia_1=__importDefault(require(a23_0x340648(0xe8))),SendWhatsAppMessage_1=__importDefault(require(a23_0x340648(0x142))),CreateMessageService_1=__importDefault(require(a23_0x340648(0x139))),sendFacebookMessageMedia_1=require(a23_0x340648(0x106)),sendFacebookMessage_1=__importDefault(require(a23_0x340648(0x113))),ShowPlanCompanyService_1=__importDefault(require(a23_0x340648(0x13d))),ListMessagesServiceAll_1=__importDefault(require(a23_0x340648(0x102))),ShowContactService_1=__importDefault(require(a23_0x340648(0x11f))),FindOrCreateTicketService_1=__importDefault(require('../services/TicketServices/FindOrCreateTicketService')),UpdateTicketService_1=__importDefault(require(a23_0x340648(0x11d))),ShowMessageService_1=__importStar(require(a23_0x340648(0xf7))),CompaniesSettings_1=__importDefault(require('../models/CompaniesSettings')),index=async(_0x22777b,_0x487bce)=>{const _0x23f5b8=a23_0x340648,{ticketId:_0x275d08}=_0x22777b[_0x23f5b8(0x168)],{pageNumber:_0x24504e,selectedQueues:_0x15d99c}=_0x22777b[_0x23f5b8(0x104)],{companyId:_0x156808,profile:_0x5ee025}=_0x22777b[_0x23f5b8(0x11e)];let _0x4ab789=[];const _0x5c167f=await User_1[_0x23f5b8(0x118)][_0x23f5b8(0x105)](_0x22777b['user']['id'],{'include':[{'model':Queue_1['default'],'as':_0x23f5b8(0x125)}]});_0x15d99c?_0x4ab789=JSON[_0x23f5b8(0x152)](_0x15d99c):_0x5c167f[_0x23f5b8(0x125)][_0x23f5b8(0x149)](_0x24717c=>{const _0x3d1412=_0x23f5b8;_0x4ab789[_0x3d1412(0xe9)](_0x24717c['id']);});const {count:_0xdbbd33,messages:_0x356380,ticket:_0xcb6b41,hasMore:_0x429ef7}=await(0x0,ListMessagesService_1[_0x23f5b8(0x118)])({'pageNumber':_0x24504e,'ticketId':_0x275d08,'companyId':_0x156808,'queues':_0x4ab789,'user':_0x5c167f});return _0xcb6b41[_0x23f5b8(0x13b)]==='whatsapp'&&(0x0,SetTicketMessagesAsRead_1[_0x23f5b8(0x118)])(_0xcb6b41),_0x487bce[_0x23f5b8(0xec)]({'count':_0xdbbd33,'messages':_0x356380,'ticket':_0xcb6b41,'hasMore':_0x429ef7});};exports[a23_0x340648(0x10a)]=index;function obterNomeEExtensaoDoArquivo(_0x3e17a3){const _0x4fcdb4=a23_0x340648;var _0xdca5f=new URL(_0x3e17a3),_0x1739c5=_0xdca5f[_0x4fcdb4(0xef)],_0x321ebc=_0x1739c5['split']('/')['pop'](),_0x77c6b4=_0x321ebc[_0x4fcdb4(0xf2)]('.'),_0x10b23c=_0x77c6b4[0x0],_0x79167f=_0x77c6b4[0x1];return _0x10b23c+'.'+_0x79167f;}const store=async(_0x5cdd36,_0x1d3ae9)=>{const _0xc82c1a=a23_0x340648,{ticketId:_0x554389}=_0x5cdd36['params'],{body:_0x5569c7,quotedMsg:_0x46ca92,isPrivate:_0x54b2c2,vCard:_0xb883a2}=_0x5cdd36[_0xc82c1a(0x134)],_0x518e05=_0x5cdd36[_0xc82c1a(0x156)],{companyId:_0x22e7a9}=_0x5cdd36[_0xc82c1a(0x11e)],_0x410da7=await(0x0,ShowTicketService_1[_0xc82c1a(0x118)])(_0x554389,_0x22e7a9);_0x410da7[_0xc82c1a(0x13b)]==='whatsapp'&&(0x0,SetTicketMessagesAsRead_1[_0xc82c1a(0x118)])(_0x410da7);try{if(_0x518e05)await Promise[_0xc82c1a(0x155)](_0x518e05['map'](async(_0x312f60,_0x3caf2d)=>{const _0x5a1229=_0xc82c1a;_0x410da7[_0x5a1229(0x13b)]===_0x5a1229(0xf6)&&await(0x0,SendWhatsAppMedia_1[_0x5a1229(0x118)])({'media':_0x312f60,'ticket':_0x410da7,'body':Array[_0x5a1229(0x110)](_0x5569c7)?_0x5569c7[_0x3caf2d]:_0x5569c7,'isPrivate':/\u200d/[_0x5a1229(0x12f)](_0x5569c7),'isForwarded':![]});if(_0x410da7[_0x5a1229(0x13b)]===_0x5a1229(0x13a)||_0x410da7['channel']===_0x5a1229(0x10d))try{await(0x0,sendFacebookMessageMedia_1[_0x5a1229(0x14e)])({'media':_0x312f60,'ticket':_0x410da7});}catch(_0x8bb431){console[_0x5a1229(0x154)](_0x8bb431);}}));else{if(_0x410da7[_0xc82c1a(0x13b)]===_0xc82c1a(0xf6)&&!_0x54b2c2)await(0x0,SendWhatsAppMessage_1[_0xc82c1a(0x118)])({'body':_0x5569c7,'ticket':_0x410da7,'quotedMsg':_0x46ca92,'vCard':_0xb883a2});else{if(_0x410da7[_0xc82c1a(0x13b)]===_0xc82c1a(0xf6)&&_0x54b2c2){const _0x49d467={'wid':_0xc82c1a(0xeb)+_0x410da7[_0xc82c1a(0x12a)][_0xc82c1a(0x14f)]()[_0xc82c1a(0x107)]('\x20',''),'ticketId':_0x410da7['id'],'contactId':undefined,'body':_0x5569c7,'fromMe':!![],'mediaType':!(0x0,lodash_1[_0xc82c1a(0x116)])(_0xb883a2)?'contactMessage':'extendedTextMessage','read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':_0x410da7[_0xc82c1a(0xea)]?.[_0xc82c1a(0x10f)],'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x54b2c2};await(0x0,CreateMessageService_1[_0xc82c1a(0x118)])({'messageData':_0x49d467,'companyId':_0x410da7[_0xc82c1a(0x126)]});}else(_0x410da7[_0xc82c1a(0x13b)]==='facebook'||_0x410da7[_0xc82c1a(0x13b)]===_0xc82c1a(0x10d))&&await(0x0,sendFacebookMessage_1[_0xc82c1a(0x118)])({'body':_0x5569c7,'ticket':_0x410da7,'quotedMsg':_0x46ca92});}}return _0x1d3ae9[_0xc82c1a(0x138)]();}catch(_0x7d028c){return console[_0xc82c1a(0x154)](_0x7d028c),_0x1d3ae9[_0xc82c1a(0x148)](0x190)[_0xc82c1a(0xec)]({'error':_0x7d028c[_0xc82c1a(0x166)]});}};exports[a23_0x340648(0x108)]=store;const forwardmessage=async(_0x248f4d,_0xaf6395)=>{const _0x186c90=a23_0x340648,_0x174a8e=_0x248f4d['headers'][_0x186c90(0x11b)],[,_0xc94e53]=_0x174a8e['split']('\x20'),_0x36f8df=(0x0,jsonwebtoken_1[_0x186c90(0xfc)])(_0xc94e53,auth_1[_0x186c90(0x118)]['secret']),{id:_0x3e6c73}=_0x248f4d['user'],_0x309425=await User_1[_0x186c90(0x118)]['findByPk'](_0x3e6c73),{currentContacts:_0x742c2b,message:_0x4789d0,signMessage:_0x159eaf}=_0x248f4d[_0x186c90(0x134)],{companyId:_0x283396}=_0x4789d0,_0x3dfa5e=await CompaniesSettings_1[_0x186c90(0x118)][_0x186c90(0x10e)]({'where':{'companyId':_0x283396}}),_0x51eb73=_0x4789d0[_0x186c90(0x114)];let _0x387d23;return _0x742c2b[_0x186c90(0x16a)](async _0x137ad5=>{const _0x217c7b=_0x186c90,_0x1319ea=await(0x0,ShowContactService_1[_0x217c7b(0x118)])(_0x137ad5['id'],_0x4789d0[_0x217c7b(0x126)]),_0x133b2a=await(0x0,ShowTicketService_1['default'])(_0x4789d0[_0x217c7b(0xf9)],_0x4789d0[_0x217c7b(0x126)]),{ticket:_0x4b25ef,isCreated:_0x1fcc3b}=await(0x0,FindOrCreateTicketService_1[_0x217c7b(0x118)])(_0x1319ea,_0x133b2a?.['whatsapp'],0x0,_0x133b2a[_0x217c7b(0x126)],_0x133b2a['queueId'],_0x309425['id'],_0x1319ea[_0x217c7b(0x129)]?_0x1319ea:null,'whatsapp',null,!![],_0x3dfa5e),_0x5aa2a6={'status':_0x4b25ef[_0x217c7b(0x129)]?_0x217c7b(0x122):_0x217c7b(0x169),'userId':_0x309425['id'],'queueId':_0x133b2a[_0x217c7b(0x159)]};await(0x0,UpdateTicketService_1[_0x217c7b(0x118)])({'ticketData':_0x5aa2a6,'ticketId':_0x4b25ef['id'],'companyId':_0x4b25ef[_0x217c7b(0x126)]});if(_0x133b2a['channel']==='whatsapp'){if(_0x4789d0[_0x217c7b(0x150)]){_0x387d23='_Encaminhada_';const _0x1e8939=_0x4789d0[_0x217c7b(0x150)]['replace'](':'+process[_0x217c7b(0x12d)][_0x217c7b(0xf8)],''),_0x3cf4e6=obterNomeEExtensaoDoArquivo(_0x1e8939),_0x170777=path_1[_0x217c7b(0x118)][_0x217c7b(0x119)](__dirname,'..','..','..','backend',_0x217c7b(0x120)),_0xc7a91e=path_1['default'][_0x217c7b(0x119)](_0x170777,_0x217c7b(0x124)+_0x133b2a[_0x217c7b(0x126)],_0x3cf4e6),_0x75afd0={'fieldname':_0x217c7b(0x158),'originalname':_0x3cf4e6,'encoding':_0x217c7b(0x163),'mimetype':_0x4789d0[_0x217c7b(0x11a)],'filename':_0x3cf4e6,'path':_0xc7a91e};await(0x0,SendWhatsAppMedia_1[_0x217c7b(0x118)])({'media':_0x75afd0,'ticket':_0x4b25ef,'body':_0x387d23,'isForwarded':![]});}else _0x159eaf?_0x387d23=_0x217c7b(0x101)+_0x309425[_0x217c7b(0x117)]+'*\x0a\x0a'+_0x4789d0[_0x217c7b(0x134)]:_0x387d23=''+_0x4789d0[_0x217c7b(0x134)],await(0x0,SendWhatsAppMessage_1[_0x217c7b(0x118)])({'body':_0x387d23,'ticket':_0x4b25ef,'quotedMsg':_0x51eb73});}}),_0xaf6395['json'](_0x186c90(0x147));};exports['forwardmessage']=forwardmessage;const forwardMessage=async(_0x4bb6ba,_0x300343)=>{const _0x5cba8e=a23_0x340648,{quotedMsg:_0x1527c9,signMessage:_0xc391ff,messageId:_0x4beed9,contactId:_0x4b0ad1}=_0x4bb6ba['body'],{id:_0x58af1c,companyId:_0x1eeec0}=_0x4bb6ba[_0x5cba8e(0x11e)],_0x264a19=await User_1[_0x5cba8e(0x118)][_0x5cba8e(0x105)](_0x58af1c);if(!_0x4beed9||!_0x4b0ad1)return _0x300343['status'](0xc8)[_0x5cba8e(0x138)](_0x5cba8e(0xed));const _0x13b84b=await(0x0,ShowMessageService_1[_0x5cba8e(0x118)])(_0x4beed9),_0x1c050e=await(0x0,ShowContactService_1[_0x5cba8e(0x118)])(_0x4b0ad1,_0x1eeec0);if(!_0x13b84b)return _0x300343[_0x5cba8e(0x148)](0x194)[_0x5cba8e(0x138)](_0x5cba8e(0x100));if(!_0x1c050e)return _0x300343[_0x5cba8e(0x148)](0x194)[_0x5cba8e(0x138)](_0x5cba8e(0x135));const _0x3a08e6=await CompaniesSettings_1[_0x5cba8e(0x118)][_0x5cba8e(0x10e)]({'where':{'companyId':_0x1eeec0}}),_0x2b7a24=await(0x0,ShowMessageService_1[_0x5cba8e(0x162)])(_0x13b84b);if(!_0x2b7a24)return _0x300343['status'](0x194)[_0x5cba8e(0x138)](_0x5cba8e(0x12b));const _0x10f262=await(0x0,ShowTicketService_1[_0x5cba8e(0x118)])(_0x13b84b[_0x5cba8e(0xf9)],_0x13b84b[_0x5cba8e(0x126)]),{ticket:_0x2227ba}=await(0x0,FindOrCreateTicketService_1[_0x5cba8e(0x118)])(_0x1c050e,_0x10f262?.[_0x5cba8e(0xf6)],0x0,_0x10f262[_0x5cba8e(0x126)],_0x10f262['queueId'],_0x264a19['id'],_0x1c050e['isGroup']?_0x1c050e:null,_0x5cba8e(0xf6),null,!![],_0x3a08e6);let _0x451e05;(0x0,lodash_1['isNil'])(_0x2227ba?.[_0x5cba8e(0x159)])?_0x451e05={'status':_0x2227ba['isGroup']?_0x5cba8e(0x122):_0x5cba8e(0x169),'userId':_0x264a19['id'],'queueId':_0x10f262[_0x5cba8e(0x159)]}:_0x451e05={'status':_0x2227ba[_0x5cba8e(0x129)]?_0x5cba8e(0x122):_0x5cba8e(0x169),'userId':_0x264a19['id']};await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x451e05,'ticketId':_0x2227ba['id'],'companyId':_0x2227ba[_0x5cba8e(0x126)]});let _0x1706ca=_0x13b84b[_0x5cba8e(0x134)];if(_0x13b84b[_0x5cba8e(0x11a)]===_0x5cba8e(0x16d)||_0x13b84b[_0x5cba8e(0x11a)]===_0x5cba8e(0x14a))await(0x0,SendWhatsAppMessage_1[_0x5cba8e(0x118)])({'body':_0x1706ca,'ticket':_0x2227ba,'quotedMsg':_0x1527c9,'isForwarded':_0x13b84b['fromMe']?![]:!![]});else{const _0x3a7e11=_0x13b84b[_0x5cba8e(0x150)][_0x5cba8e(0x107)](':'+process['env'][_0x5cba8e(0xf8)],''),_0x488d8d=obterNomeEExtensaoDoArquivo(_0x3a7e11);_0x1706ca===_0x488d8d&&(_0x1706ca='');const _0x103382=path_1['default'][_0x5cba8e(0x119)](__dirname,'..','..','..',_0x5cba8e(0x115),'public'),_0x81e9b5=path_1[_0x5cba8e(0x118)]['join'](_0x103382,_0x5cba8e(0x124)+_0x2227ba[_0x5cba8e(0x126)],_0x488d8d),_0x2f4c45={'fieldname':'medias','originalname':_0x488d8d,'encoding':_0x5cba8e(0x163),'mimetype':_0x13b84b[_0x5cba8e(0x11a)],'filename':_0x488d8d,'path':_0x81e9b5};await(0x0,SendWhatsAppMedia_1[_0x5cba8e(0x118)])({'media':_0x2f4c45,'ticket':_0x2227ba,'body':_0x1706ca,'isForwarded':_0x13b84b[_0x5cba8e(0x164)]?![]:!![]});}return _0x300343[_0x5cba8e(0x138)]();};exports[a23_0x340648(0x167)]=forwardMessage;const remove=async(_0x20e3b2,_0x4cabe4)=>{const _0x261d38=a23_0x340648,{messageId:_0x199059}=_0x20e3b2['params'],{companyId:_0x364601}=_0x20e3b2[_0x261d38(0x11e)],_0x79fa93=await(0x0,DeleteWhatsAppMessage_1[_0x261d38(0x118)])(_0x199059),_0x2dd453=(0x0,socket_1['getIO'])();return _0x79fa93[_0x261d38(0x146)]&&(await Message_1[_0x261d38(0x118)][_0x261d38(0x137)]({'where':{'id':_0x79fa93['id']}}),_0x2dd453['to'](_0x79fa93['ticketId'][_0x261d38(0x14f)]())['emit'](_0x261d38(0xee)+_0x364601+'-appMessage',{'action':'delete','message':_0x79fa93})),_0x2dd453['to'](_0x79fa93[_0x261d38(0xf9)][_0x261d38(0x14f)]())[_0x261d38(0x161)](_0x261d38(0xee)+_0x364601+_0x261d38(0xf3),{'action':_0x261d38(0xfd),'message':_0x79fa93}),_0x4cabe4[_0x261d38(0x138)]();};exports[a23_0x340648(0x12c)]=remove;const allMe=async(_0xd34e4d,_0x23244e)=>{const _0x255a9a=a23_0x340648,_0x5947ac=_0xd34e4d['query'][_0x255a9a(0x165)],_0x5658bb=_0xd34e4d[_0x255a9a(0x104)][_0x255a9a(0xf1)],_0x1a3a7f=_0xd34e4d[_0x255a9a(0x104)][_0x255a9a(0x164)],{companyId:_0x44dc93}=_0xd34e4d[_0x255a9a(0x11e)],{count:_0x4f9320}=await(0x0,ListMessagesServiceAll_1[_0x255a9a(0x118)])({'companyId':_0x44dc93,'fromMe':_0x1a3a7f,'dateStart':_0x5947ac,'dateEnd':_0x5658bb});return _0x23244e[_0x255a9a(0xec)]({'count':_0x4f9320});};exports[a23_0x340648(0x141)]=allMe;function a23_0x44e9(){const _0x59720f=['21215PUDXeI','verify','update','get','Essa\x20empresa\x20não\x20tem\x20permissão\x20para\x20usar\x20a\x20API\x20Externa.\x20Entre\x20em\x20contato\x20com\x20o\x20Suporte\x20para\x20verificar\x20nossos\x20planos!','Message\x20not\x20found','*Mensagem\x20encaminhada\x20de\x20','../services/MessageServices/ListMessagesServiceAll','jsonwebtoken','query','findByPk','../services/FacebookServices/sendFacebookMessageMedia','replace','store','../models/Whatsapp','index','10796548Ygtkit','getOwnPropertyDescriptor','instagram','findOne','remoteJid','isArray','804SFbnVz','useExternalApi','../services/FacebookServices/sendFacebookMessage','quotedMsgId','backend','isNil','name','default','join','mediaType','authorization','O\x20número\x20é\x20obrigatório','../services/TicketServices/UpdateTicketService','user','../services/ContactServices/ShowContactService','public','9592UozWiV','group','../services/MessageServices/ListMessagesService','company','queues','companyId','path','prototype','isGroup','updatedAt','Whatsapp\x20from\x20message\x20not\x20found','remove','env','7208586Elubop','test','lodash','SendMessage','329QYwuXE','messageQueue','body','Contact\x20not\x20found','originalname','destroy','send','../services/MessageServices/CreateMessageService','facebook','channel','__esModule','../services/CompanyService/ShowPlanCompanyService','call','327RJhXlG','forwardmessage','allMe','../services/WbotServices/SendWhatsAppMessage','__importDefault','../errors/AppError','app','isPrivate','count','status','forEach','extendedTextMessage','length','add','../models/Queue','sendFacebookMessageMedia','toString','mediaUrl','create','parse','../models/User','log','all','files','../models/Message','medias','queueId','../config/auth','number','1360EHTnlb','9914GCSUNn','Mensagem\x20enviada!','10912980wLKScn','configurable','emit','GetWhatsAppFromMessage','7bit','fromMe','dateStart','message','forwardMessage','params','open','map','__createBinding','__importStar','conversation','../services/WbotServices/SendWhatsAppMedia','push','contact','PVT','json','MessageId\x20or\x20ContactId\x20not\x20found','company-','pathname','hasOwnProperty','dateEnd','split','-appMessage','defineProperty','25848hmcsIy','whatsapp','../services/MessageServices/ShowMessageService','PORT','ticketId','../services/WbotServices/DeleteWhatsAppMessage'];a23_0x44e9=function(){return _0x59720f;};return a23_0x44e9();}const send=async(_0x3b88cb,_0x4d5424)=>{const _0x70c575=a23_0x340648,_0xe49d9f=_0x3b88cb[_0x70c575(0x134)],_0x435749=_0x3b88cb[_0x70c575(0x156)];try{const _0x5a1823=_0x3b88cb['headers'][_0x70c575(0x11b)],[,_0x392c2c]=_0x5a1823[_0x70c575(0xf2)]('\x20'),_0xa5cf51=await Whatsapp_1[_0x70c575(0x118)][_0x70c575(0x10e)]({'where':{'token':_0x392c2c}}),_0x3f9f02=_0xa5cf51[_0x70c575(0x126)],_0x2cb909=await(0x0,ShowPlanCompanyService_1['default'])(_0x3f9f02),_0x282b9a=_0x2cb909['plan'][_0x70c575(0x112)];if(_0x282b9a){if(!_0xa5cf51)throw new Error('Não\x20foi\x20possível\x20realizar\x20a\x20operação');if(_0xe49d9f[_0x70c575(0x15b)]===undefined)throw new Error(_0x70c575(0x11c));const _0x50609e=_0xe49d9f['number'],_0x5cb9f3=_0xe49d9f[_0x70c575(0x134)];return _0x435749?await Promise[_0x70c575(0x155)](_0x435749[_0x70c575(0x16a)](async _0x19d124=>{const _0x27572d=_0x70c575;_0x3b88cb[_0x27572d(0x145)][_0x27572d(0xfe)](_0x27572d(0x125))[_0x27572d(0x133)][_0x27572d(0x14c)](_0x27572d(0x131),{'whatsappId':_0xa5cf51['id'],'data':{'number':_0x50609e,'body':_0x19d124[_0x27572d(0x136)]['replace']('/','-'),'mediaPath':_0x19d124[_0x27572d(0x127)]}},{'removeOnComplete':!![],'attempts':0x3});})):_0x3b88cb[_0x70c575(0x145)][_0x70c575(0xfe)](_0x70c575(0x125))[_0x70c575(0x133)][_0x70c575(0x14c)](_0x70c575(0x131),{'whatsappId':_0xa5cf51['id'],'data':{'number':_0x50609e,'body':_0x5cb9f3}},{'removeOnComplete':!![],'attempts':0x3}),_0x4d5424[_0x70c575(0x138)]({'mensagem':_0x70c575(0x15e)});}return _0x4d5424[_0x70c575(0x148)](0x190)[_0x70c575(0xec)]({'error':_0x70c575(0xff)});}catch(_0x50927e){console['log'](_0x50927e);if(Object['keys'](_0x50927e)[_0x70c575(0x14b)]===0x0)throw new AppError_1[(_0x70c575(0x118))]('Não\x20foi\x20possível\x20enviar\x20a\x20mensagem,\x20tente\x20novamente\x20em\x20alguns\x20instantes');else throw new AppError_1['default'](_0x50927e[_0x70c575(0x166)]);}};exports[a23_0x340648(0x138)]=send;