'use strict';const a22_0x31a248=a22_0x24a5;(function(_0x1333d9,_0xa2e45f){const _0x4e024d=a22_0x24a5,_0x521ac3=_0x1333d9();while(!![]){try{const _0x3c6e84=parseInt(_0x4e024d(0x1a8))/0x1+parseInt(_0x4e024d(0x1ab))/0x2+parseInt(_0x4e024d(0x17e))/0x3+parseInt(_0x4e024d(0x144))/0x4*(-parseInt(_0x4e024d(0x165))/0x5)+parseInt(_0x4e024d(0x150))/0x6+-parseInt(_0x4e024d(0x1ac))/0x7+-parseInt(_0x4e024d(0x188))/0x8;if(_0x3c6e84===_0xa2e45f)break;else _0x521ac3['push'](_0x521ac3['shift']());}catch(_0x1849f8){_0x521ac3['push'](_0x521ac3['shift']());}}}(a22_0x5dac,0xadfc5));var __createBinding=this&&this[a22_0x31a248(0x147)]||(Object['create']?function(_0x51e7b4,_0x370acb,_0x598b5b,_0x1ef64e){const _0x2c0e3c=a22_0x31a248;if(_0x1ef64e===undefined)_0x1ef64e=_0x598b5b;var _0x56ee9e=Object['getOwnPropertyDescriptor'](_0x370acb,_0x598b5b);(!_0x56ee9e||('get'in _0x56ee9e?!_0x370acb[_0x2c0e3c(0x16d)]:_0x56ee9e[_0x2c0e3c(0x184)]||_0x56ee9e['configurable']))&&(_0x56ee9e={'enumerable':!![],'get':function(){return _0x370acb[_0x598b5b];}}),Object[_0x2c0e3c(0x146)](_0x51e7b4,_0x1ef64e,_0x56ee9e);}:function(_0x46eb70,_0x15b9b5,_0x4596ca,_0x421d0b){if(_0x421d0b===undefined)_0x421d0b=_0x4596ca;_0x46eb70[_0x421d0b]=_0x15b9b5[_0x4596ca];}),__setModuleDefault=this&&this[a22_0x31a248(0x14a)]||(Object[a22_0x31a248(0x15d)]?function(_0x1b58ac,_0x3a7600){const _0x3ba228=a22_0x31a248;Object[_0x3ba228(0x146)](_0x1b58ac,'default',{'enumerable':!![],'value':_0x3a7600});}:function(_0x24fec3,_0x3c58a1){_0x24fec3['default']=_0x3c58a1;}),__importStar=this&&this[a22_0x31a248(0x19c)]||function(_0x1b9ecc){const _0x4ee407=a22_0x31a248;if(_0x1b9ecc&&_0x1b9ecc[_0x4ee407(0x16d)])return _0x1b9ecc;var _0x363d22={};if(_0x1b9ecc!=null){for(var _0x1d56e7 in _0x1b9ecc)if(_0x1d56e7!=='default'&&Object['prototype'][_0x4ee407(0x15f)][_0x4ee407(0x19d)](_0x1b9ecc,_0x1d56e7))__createBinding(_0x363d22,_0x1b9ecc,_0x1d56e7);}return __setModuleDefault(_0x363d22,_0x1b9ecc),_0x363d22;},__importDefault=this&&this['__importDefault']||function(_0x458a8f){const _0x10a2d5=a22_0x31a248;return _0x458a8f&&_0x458a8f[_0x10a2d5(0x16d)]?_0x458a8f:{'default':_0x458a8f};};Object[a22_0x31a248(0x146)](exports,a22_0x31a248(0x16d),{'value':!![]}),exports[a22_0x31a248(0x1a2)]=exports[a22_0x31a248(0x199)]=exports[a22_0x31a248(0x15c)]=exports[a22_0x31a248(0x1b3)]=exports[a22_0x31a248(0x195)]=exports[a22_0x31a248(0x183)]=exports['index']=void 0x0;const AppError_1=__importDefault(require('../errors/AppError')),SetTicketMessagesAsRead_1=__importDefault(require(a22_0x31a248(0x186))),socket_1=require(a22_0x31a248(0x175)),Message_1=__importDefault(require(a22_0x31a248(0x185))),Queue_1=__importDefault(require(a22_0x31a248(0x157))),User_1=__importDefault(require(a22_0x31a248(0x17d))),Whatsapp_1=__importDefault(require(a22_0x31a248(0x1b4))),jsonwebtoken_1=require(a22_0x31a248(0x18b)),auth_1=__importDefault(require(a22_0x31a248(0x154))),path_1=__importDefault(require('path')),lodash_1=require(a22_0x31a248(0x14b)),ListMessagesService_1=__importDefault(require('../services/MessageServices/ListMessagesService')),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),DeleteWhatsAppMessage_1=__importDefault(require(a22_0x31a248(0x1aa))),SendWhatsAppMedia_1=__importDefault(require(a22_0x31a248(0x1b8))),SendWhatsAppMessage_1=__importDefault(require(a22_0x31a248(0x16f))),CreateMessageService_1=__importDefault(require(a22_0x31a248(0x149))),sendFacebookMessageMedia_1=__importDefault(require('../services/FacebookServices/sendFacebookMessageMedia')),sendFacebookMessage_1=__importDefault(require('../services/FacebookServices/sendFacebookMessage')),ShowPlanCompanyService_1=__importDefault(require(a22_0x31a248(0x164))),ListMessagesServiceAll_1=__importDefault(require('../services/MessageServices/ListMessagesServiceAll')),ShowContactService_1=__importDefault(require('../services/ContactServices/ShowContactService')),FindOrCreateTicketService_1=__importDefault(require(a22_0x31a248(0x18a))),UpdateTicketService_1=__importDefault(require('../services/TicketServices/UpdateTicketService')),ListSettingsService_1=__importDefault(require(a22_0x31a248(0x177))),ShowMessageService_1=__importStar(require(a22_0x31a248(0x1b7))),index=async(_0x10db3f,_0xb4a2d2)=>{const _0x3d144e=a22_0x31a248,{ticketId:_0x5b6cc8}=_0x10db3f[_0x3d144e(0x194)],{pageNumber:_0xb06c53,selectedQueues:_0x38f92b}=_0x10db3f[_0x3d144e(0x142)],{companyId:_0x101463,profile:_0x5ce33a}=_0x10db3f[_0x3d144e(0x1a3)];let _0x420472=[];const _0x47733f=await User_1[_0x3d144e(0x19b)][_0x3d144e(0x167)](_0x10db3f[_0x3d144e(0x1a3)]['id'],{'include':[{'model':Queue_1[_0x3d144e(0x19b)],'as':_0x3d144e(0x15b)}]});_0x38f92b?_0x420472=JSON[_0x3d144e(0x14f)](_0x38f92b):_0x47733f[_0x3d144e(0x15b)][_0x3d144e(0x1b1)](_0x1300d6=>{_0x420472['push'](_0x1300d6['id']);});const {count:_0x27b99d,messages:_0x57a31f,ticket:_0x58c83f,hasMore:_0x23e770}=await(0x0,ListMessagesService_1[_0x3d144e(0x19b)])({'pageNumber':_0xb06c53,'ticketId':_0x5b6cc8,'companyId':_0x101463,'queues':_0x420472,'user':_0x47733f});return _0x58c83f[_0x3d144e(0x179)]===_0x3d144e(0x161)&&(0x0,SetTicketMessagesAsRead_1[_0x3d144e(0x19b)])(_0x58c83f),_0xb4a2d2[_0x3d144e(0x1a0)]({'count':_0x27b99d,'messages':_0x57a31f,'ticket':_0x58c83f,'hasMore':_0x23e770});};exports[a22_0x31a248(0x140)]=index;function obterNomeEExtensaoDoArquivo(_0x3f7531){const _0x53e9bc=a22_0x31a248;var _0x51c3be=new URL(_0x3f7531),_0x5514f7=_0x51c3be[_0x53e9bc(0x1a5)],_0x3ec918=_0x5514f7['split']('/')[_0x53e9bc(0x1b9)](),_0x1082ae=_0x3ec918['split']('.'),_0x413d7e=_0x1082ae[0x0],_0x3043f9=_0x1082ae[0x1];return _0x413d7e+'.'+_0x3043f9;}const store=async(_0x1fa315,_0x184ce6)=>{const _0x56315f=a22_0x31a248,{ticketId:_0x4f4e8c}=_0x1fa315['params'],{body:_0x11ee2b,quotedMsg:_0x500b30,isPrivate:_0x33a55f,vCard:_0x36bf8b}=_0x1fa315[_0x56315f(0x198)],_0x275203=_0x1fa315[_0x56315f(0x1a7)],{companyId:_0x1f77de}=_0x1fa315['user'],_0x5a84fa=await(0x0,ShowTicketService_1['default'])(_0x4f4e8c,_0x1f77de);_0x5a84fa[_0x56315f(0x179)]===_0x56315f(0x161)&&(0x0,SetTicketMessagesAsRead_1['default'])(_0x5a84fa);try{if(_0x275203)await Promise[_0x56315f(0x18c)](_0x275203[_0x56315f(0x196)](async _0x3e4e19=>{const _0x23422d=_0x56315f;_0x5a84fa[_0x23422d(0x179)]===_0x23422d(0x161)&&await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x3e4e19,'ticket':_0x5a84fa,'body':_0x11ee2b,'isPrivate':/\u200d/['test'](_0x11ee2b)});if(_0x5a84fa[_0x23422d(0x179)]==='facebook'||_0x5a84fa[_0x23422d(0x179)]===_0x23422d(0x1ad))try{await(0x0,sendFacebookMessageMedia_1[_0x23422d(0x19b)])({'media':_0x3e4e19,'ticket':_0x5a84fa});}catch(_0x22d4f4){console['log'](_0x22d4f4);}}));else{_0x5a84fa[_0x56315f(0x179)]==='whatsapp'&&!_0x33a55f&&await(0x0,SendWhatsAppMessage_1[_0x56315f(0x19b)])({'body':_0x11ee2b,'ticket':_0x5a84fa,'quotedMsg':_0x500b30,'isPrivate':_0x33a55f,'vCard':_0x36bf8b});if(_0x5a84fa[_0x56315f(0x179)]==='whatsapp'&&_0x33a55f){const _0x471ba0={'wid':'PVT'+_0x5a84fa['updatedAt']['toString']()[_0x56315f(0x160)]('\x20',''),'ticketId':_0x5a84fa['id'],'contactId':undefined,'body':_0x11ee2b,'fromMe':!![],'mediaType':!(0x0,lodash_1[_0x56315f(0x17b)])(_0x36bf8b)?'contactMessage':'extendedTextMessage','read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':_0x5a84fa['contact']?.['remoteJid'],'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x33a55f};await(0x0,CreateMessageService_1[_0x56315f(0x19b)])({'messageData':_0x471ba0,'companyId':_0x5a84fa[_0x56315f(0x180)]});}(_0x5a84fa['channel']===_0x56315f(0x173)||_0x5a84fa['channel']===_0x56315f(0x1ad))&&await(0x0,sendFacebookMessage_1[_0x56315f(0x19b)])({'body':_0x11ee2b,'ticket':_0x5a84fa,'quotedMsg':_0x500b30});}return _0x184ce6[_0x56315f(0x1a2)]();}catch(_0x478744){return console[_0x56315f(0x18d)](_0x478744),_0x184ce6[_0x56315f(0x18f)](0x190)[_0x56315f(0x1a0)]({'error':_0x478744[_0x56315f(0x1b6)]});}};exports[a22_0x31a248(0x183)]=store;const forwardmessage=async(_0x26df4b,_0x5ecb52)=>{const _0x37c84f=a22_0x31a248,_0x495077=_0x26df4b[_0x37c84f(0x16e)][_0x37c84f(0x166)],[,_0x5318b1]=_0x495077[_0x37c84f(0x182)]('\x20'),_0x123c43=(0x0,jsonwebtoken_1[_0x37c84f(0x1a9)])(_0x5318b1,auth_1[_0x37c84f(0x19b)][_0x37c84f(0x197)]),{id:_0x578af5}=_0x26df4b[_0x37c84f(0x1a3)],_0x54cb24=await User_1[_0x37c84f(0x19b)][_0x37c84f(0x167)](_0x578af5),{currentContacts:_0x31cb45,message:_0xbd3853,signMessage:_0x8a5142}=_0x26df4b[_0x37c84f(0x198)],_0x4bd35d=await(0x0,ListSettingsService_1[_0x37c84f(0x19b)])({'companyId':_0xbd3853[_0x37c84f(0x180)]}),_0x730aff=_0xbd3853[_0x37c84f(0x1b2)];let _0x120070;return _0x31cb45[_0x37c84f(0x196)](async _0x47fe90=>{const _0x1bf460=_0x37c84f,_0x4164a5=await(0x0,ShowContactService_1['default'])(_0x47fe90['id'],_0xbd3853['companyId']),_0x34c025=await(0x0,ShowTicketService_1['default'])(_0xbd3853['ticketId'],_0xbd3853[_0x1bf460(0x180)]),{ticket:_0x2ca326,isCreated:_0x5df648}=await(0x0,FindOrCreateTicketService_1[_0x1bf460(0x19b)])(_0x4164a5,_0x34c025?.[_0x1bf460(0x161)],0x0,_0x34c025[_0x1bf460(0x180)],_0x34c025[_0x1bf460(0x1a6)],_0x54cb24['id'],_0x4164a5[_0x1bf460(0x17c)]?_0x4164a5:null,_0x1bf460(0x161),null,!![],_0x4bd35d),_0x2a4e16={'status':_0x2ca326['isGroup']?_0x1bf460(0x15a):_0x1bf460(0x17f),'userId':_0x54cb24['id'],'queueId':_0x34c025['queueId']};await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x2a4e16,'ticketId':_0x2ca326['id'],'companyId':_0x2ca326[_0x1bf460(0x180)]});if(_0x34c025[_0x1bf460(0x179)]==='whatsapp'){if(_0xbd3853['mediaUrl']){_0x120070=_0x1bf460(0x169);const _0x25b21e=_0xbd3853[_0x1bf460(0x1b0)][_0x1bf460(0x160)](':'+process[_0x1bf460(0x18e)][_0x1bf460(0x14e)],''),_0x4c3b4e=obterNomeEExtensaoDoArquivo(_0x25b21e),_0x4bbfde=path_1[_0x1bf460(0x19b)][_0x1bf460(0x178)](__dirname,'..','..','..',_0x1bf460(0x151),_0x1bf460(0x19f)),_0x29ac6d=path_1[_0x1bf460(0x19b)][_0x1bf460(0x178)](_0x4bbfde,_0x1bf460(0x152)+_0x34c025[_0x1bf460(0x180)],_0x4c3b4e),_0xd74dc4={'fieldname':_0x1bf460(0x174),'originalname':_0x4c3b4e,'encoding':_0x1bf460(0x143),'mimetype':_0xbd3853['mediaType'],'filename':_0x4c3b4e,'path':_0x29ac6d};await(0x0,SendWhatsAppMedia_1[_0x1bf460(0x19b)])({'media':_0xd74dc4,'ticket':_0x2ca326,'body':_0x120070});}else _0x8a5142?_0x120070=_0x1bf460(0x1a1)+_0x54cb24['name']+_0x1bf460(0x192)+_0xbd3853[_0x1bf460(0x198)]:_0x120070=''+_0xbd3853[_0x1bf460(0x198)],await(0x0,SendWhatsAppMessage_1[_0x1bf460(0x19b)])({'body':_0x120070,'ticket':_0x2ca326,'quotedMsg':_0x730aff});}}),_0x5ecb52[_0x37c84f(0x1a0)]('count');};exports['forwardmessage']=forwardmessage;const forwardMessage=async(_0x198c3,_0x3519e4)=>{const _0x40e944=a22_0x31a248;console[_0x40e944(0x18d)](_0x40e944(0x15e));const {quotedMsg:_0x3dcac5,signMessage:_0xdc6d6b,messageId:_0x4be734,contactId:_0x52eddc}=_0x198c3[_0x40e944(0x198)],{id:_0x276468,companyId:_0x4ea9b3}=_0x198c3['user'],_0x3d64e1=await User_1[_0x40e944(0x19b)][_0x40e944(0x167)](_0x276468);if(!_0x4be734||!_0x52eddc)return _0x3519e4[_0x40e944(0x18f)](0xc8)['send'](_0x40e944(0x158));const _0x29d5b7=await(0x0,ShowMessageService_1[_0x40e944(0x19b)])(_0x4be734),_0x250cf4=await(0x0,ShowContactService_1[_0x40e944(0x19b)])(_0x52eddc,_0x4ea9b3);if(!_0x29d5b7)return _0x3519e4[_0x40e944(0x18f)](0x194)['send']('Message\x20not\x20found');if(!_0x250cf4)return _0x3519e4[_0x40e944(0x18f)](0x194)[_0x40e944(0x1a2)](_0x40e944(0x171));const _0x3534a8=await(0x0,ListSettingsService_1[_0x40e944(0x19b)])({'companyId':_0x29d5b7[_0x40e944(0x180)]}),_0x5855a5=await(0x0,ShowMessageService_1[_0x40e944(0x176)])(_0x29d5b7);if(!_0x5855a5)return _0x3519e4[_0x40e944(0x18f)](0x194)[_0x40e944(0x1a2)](_0x40e944(0x155));const _0x5eb118=await(0x0,ShowTicketService_1[_0x40e944(0x19b)])(_0x29d5b7[_0x40e944(0x187)],_0x29d5b7['companyId']),{ticket:_0x4499c0}=await(0x0,FindOrCreateTicketService_1['default'])(_0x250cf4,_0x5eb118?.[_0x40e944(0x161)],0x0,_0x5eb118['companyId'],_0x5eb118[_0x40e944(0x1a6)],_0x3d64e1['id'],_0x250cf4[_0x40e944(0x17c)]?_0x250cf4:null,_0x40e944(0x161),null,!![],_0x3534a8),_0x1a0400={'status':_0x4499c0[_0x40e944(0x17c)]?'group':_0x40e944(0x17f),'userId':_0x3d64e1['id'],'queueId':_0x5eb118[_0x40e944(0x1a6)]};await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x1a0400,'ticketId':_0x4499c0['id'],'companyId':_0x4499c0[_0x40e944(0x180)]});let _0x460849='';_0xdc6d6b?_0x460849='_Encaminhada_\x0a'+(''+_0x29d5b7[_0x40e944(0x198)]):_0x460849=_0x29d5b7[_0x40e944(0x198)];if(_0x29d5b7[_0x40e944(0x163)]===_0x40e944(0x181)||_0x29d5b7[_0x40e944(0x163)]===_0x40e944(0x145))await(0x0,SendWhatsAppMessage_1[_0x40e944(0x19b)])({'body':_0x460849,'ticket':_0x4499c0,'quotedMsg':_0x3dcac5});else{const _0x23c6ba=_0x29d5b7[_0x40e944(0x1b0)][_0x40e944(0x160)](':'+process[_0x40e944(0x18e)]['PORT'],''),_0x2cc5c7=obterNomeEExtensaoDoArquivo(_0x23c6ba),_0x5ee976=path_1[_0x40e944(0x19b)][_0x40e944(0x178)](__dirname,'..','..','..',_0x40e944(0x151),'public'),_0x5b32b8=path_1[_0x40e944(0x19b)]['join'](_0x5ee976,_0x40e944(0x152)+_0x4499c0[_0x40e944(0x180)],_0x2cc5c7),_0x1a078e={'fieldname':_0x40e944(0x174),'originalname':_0x2cc5c7,'encoding':'7bit','mimetype':_0x29d5b7[_0x40e944(0x163)],'filename':_0x2cc5c7,'path':_0x5b32b8};await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x1a078e,'ticket':_0x4499c0,'body':_0x460849});}return _0x3519e4[_0x40e944(0x1a2)]();};exports[a22_0x31a248(0x1b3)]=forwardMessage;const remove=async(_0x59f00b,_0x53d150)=>{const _0x57acb6=a22_0x31a248,{messageId:_0x322a9a}=_0x59f00b[_0x57acb6(0x194)],{companyId:_0x50323d}=_0x59f00b[_0x57acb6(0x1a3)],_0x4cec4d=await(0x0,DeleteWhatsAppMessage_1['default'])(_0x322a9a),_0x271a87=(0x0,socket_1[_0x57acb6(0x16b)])();return _0x4cec4d[_0x57acb6(0x14c)]&&(await Message_1['default']['destroy']({'where':{'id':_0x4cec4d['id']}}),_0x271a87['to'](_0x4cec4d['ticketId']['toString']())['emit']('company-'+_0x50323d+_0x57acb6(0x162),{'action':_0x57acb6(0x172),'message':_0x4cec4d})),_0x271a87['to'](_0x4cec4d[_0x57acb6(0x187)][_0x57acb6(0x193)]())[_0x57acb6(0x14d)](_0x57acb6(0x16c)+_0x50323d+'-appMessage',{'action':'update','message':_0x4cec4d}),_0x53d150['send']();};function a22_0x5dac(){const _0x479e77=['7596954svMKDw','backend','company','messageQueue','../config/auth','Whatsapp\x20from\x20message\x20not\x20found','Mensagem\x20enviada!','../models/Queue','MessageId\x20or\x20ContactId\x20not\x20found','Essa\x20empresa\x20não\x20tem\x20permissão\x20para\x20usar\x20a\x20API\x20Externa.\x20Entre\x20em\x20contato\x20com\x20o\x20Suporte\x20para\x20verificar\x20nossos\x20planos!','group','queues','remove','create','>>>>>>>>>>>>>>>>>forwardMessage\x20X<<<<<<<<<<<<<<<<<<<','hasOwnProperty','replace','whatsapp','-appMessage','mediaType','../services/CompanyService/ShowPlanCompanyService','100yTuCGe','authorization','findByPk','length','_Encaminhada_','fromMe','getIO','company-','__esModule','headers','../services/WbotServices/SendWhatsAppMessage','dateEnd','Contact\x20not\x20found','delete','facebook','medias','../libs/socket','GetWhatsAppFromMessage','../services/SettingServices/ListSettingsService','join','channel','Não\x20foi\x20possível\x20realizar\x20a\x20operação','isNil','isGroup','../models/User','856422GGBBtZ','open','companyId','conversation','split','store','writable','../models/Message','../helpers/SetTicketMessagesAsRead','ticketId','12411880KTzlAE','findOne','../services/TicketServices/FindOrCreateTicketService','jsonwebtoken','all','log','env','status','useExternalApi','path','*\x0a\x0a','toString','params','forwardmessage','map','secret','body','allMe','app','default','__importStar','call','plan','public','json','*Mensagem\x20encaminhada\x20de\x20','send','user','get','pathname','queueId','files','602196pJEklt','verify','../services/WbotServices/DeleteWhatsAppMessage','1634410xmbuuX','3253488yJHvIn','instagram','number','keys','mediaUrl','forEach','quotedMsgId','forwardMessage','../models/Whatsapp','dateStart','message','../services/MessageServices/ShowMessageService','../services/WbotServices/SendWhatsAppMedia','pop','index','SendMessage','query','7bit','48424vdDbMc','extendedTextMessage','defineProperty','__createBinding','add','../services/MessageServices/CreateMessageService','__setModuleDefault','lodash','isPrivate','emit','PORT','parse'];a22_0x5dac=function(){return _0x479e77;};return a22_0x5dac();}exports[a22_0x31a248(0x15c)]=remove;const allMe=async(_0x2d03fd,_0x2c1582)=>{const _0x1db973=a22_0x31a248,_0x3be9d2=_0x2d03fd['query'][_0x1db973(0x1b5)],_0xcc1495=_0x2d03fd[_0x1db973(0x142)][_0x1db973(0x170)],_0x46ef25=_0x2d03fd[_0x1db973(0x142)][_0x1db973(0x16a)],{companyId:_0x41e909}=_0x2d03fd[_0x1db973(0x1a3)],{count:_0x11bd12}=await(0x0,ListMessagesServiceAll_1['default'])({'companyId':_0x41e909,'fromMe':_0x46ef25,'dateStart':_0x3be9d2,'dateEnd':_0xcc1495});return _0x2c1582[_0x1db973(0x1a0)]({'count':_0x11bd12});};function a22_0x24a5(_0xc9bcd2,_0x11d8c2){const _0x5dac72=a22_0x5dac();return a22_0x24a5=function(_0x24a540,_0x26e24f){_0x24a540=_0x24a540-0x140;let _0x1b27ea=_0x5dac72[_0x24a540];return _0x1b27ea;},a22_0x24a5(_0xc9bcd2,_0x11d8c2);}exports[a22_0x31a248(0x199)]=allMe;const send=async(_0x5f9006,_0x182ebe)=>{const _0x804d94=a22_0x31a248,_0x335951=_0x5f9006['body'],_0xb9e293=_0x5f9006[_0x804d94(0x1a7)];try{const _0x150ddf=_0x5f9006[_0x804d94(0x16e)][_0x804d94(0x166)],[,_0x2cd774]=_0x150ddf['split']('\x20'),_0x3828e5=await Whatsapp_1[_0x804d94(0x19b)][_0x804d94(0x189)]({'where':{'token':_0x2cd774}}),_0x3bff45=_0x3828e5[_0x804d94(0x180)],_0x5a142c=await(0x0,ShowPlanCompanyService_1[_0x804d94(0x19b)])(_0x3bff45),_0x219a47=_0x5a142c[_0x804d94(0x19e)][_0x804d94(0x190)];if(_0x219a47){if(!_0x3828e5)throw new Error(_0x804d94(0x17a));if(_0x335951['number']===undefined)throw new Error('O\x20número\x20é\x20obrigatório');const _0x35a808=_0x335951[_0x804d94(0x1ae)],_0x389c69=_0x335951[_0x804d94(0x198)];return _0xb9e293?await Promise[_0x804d94(0x18c)](_0xb9e293[_0x804d94(0x196)](async _0x2a1b07=>{const _0x4eb6b7=_0x804d94;_0x5f9006[_0x4eb6b7(0x19a)][_0x4eb6b7(0x1a4)]('queues')[_0x4eb6b7(0x153)][_0x4eb6b7(0x148)]('SendMessage',{'whatsappId':_0x3828e5['id'],'data':{'number':_0x35a808,'body':_0x2a1b07['originalname'][_0x4eb6b7(0x160)]('/','-'),'mediaPath':_0x2a1b07[_0x4eb6b7(0x191)]}},{'removeOnComplete':!![],'attempts':0x3});})):_0x5f9006[_0x804d94(0x19a)]['get'](_0x804d94(0x15b))[_0x804d94(0x153)][_0x804d94(0x148)](_0x804d94(0x141),{'whatsappId':_0x3828e5['id'],'data':{'number':_0x35a808,'body':_0x389c69}},{'removeOnComplete':!![],'attempts':0x3}),_0x182ebe[_0x804d94(0x1a2)]({'mensagem':_0x804d94(0x156)});}return _0x182ebe[_0x804d94(0x18f)](0x190)['json']({'error':_0x804d94(0x159)});}catch(_0x2eb085){console[_0x804d94(0x18d)](_0x2eb085);if(Object[_0x804d94(0x1af)](_0x2eb085)[_0x804d94(0x168)]===0x0)throw new AppError_1[(_0x804d94(0x19b))]('Não\x20foi\x20possível\x20enviar\x20a\x20mensagem,\x20tente\x20novamente\x20em\x20alguns\x20instantes');else throw new AppError_1[(_0x804d94(0x19b))](_0x2eb085[_0x804d94(0x1b6)]);}};exports[a22_0x31a248(0x1a2)]=send;