'use strict';const a34_0x4533ee=a34_0x2097;(function(_0x29e931,_0x36a2c3){const _0x52df11=a34_0x2097,_0xbb7522=_0x29e931();while(!![]){try{const _0x51bb94=-parseInt(_0x52df11(0xbd))/0x1+-parseInt(_0x52df11(0xa3))/0x2*(-parseInt(_0x52df11(0xa2))/0x3)+-parseInt(_0x52df11(0xb8))/0x4+parseInt(_0x52df11(0xb1))/0x5*(-parseInt(_0x52df11(0xd3))/0x6)+-parseInt(_0x52df11(0xc6))/0x7+-parseInt(_0x52df11(0xdb))/0x8+parseInt(_0x52df11(0xa8))/0x9;if(_0x51bb94===_0x36a2c3)break;else _0xbb7522['push'](_0xbb7522['shift']());}catch(_0x2fdf34){_0xbb7522['push'](_0xbb7522['shift']());}}}(a34_0x53fd,0x99be1));var __createBinding=this&&this[a34_0x4533ee(0xae)]||(Object['create']?function(_0x4044a4,_0x559dbe,_0x3a53f5,_0x192f44){const _0x4294d7=a34_0x4533ee;if(_0x192f44===undefined)_0x192f44=_0x3a53f5;var _0x419b37=Object[_0x4294d7(0xd2)](_0x559dbe,_0x3a53f5);(!_0x419b37||(_0x4294d7(0xe3)in _0x419b37?!_0x559dbe[_0x4294d7(0xa7)]:_0x419b37[_0x4294d7(0xe8)]||_0x419b37[_0x4294d7(0xca)]))&&(_0x419b37={'enumerable':!![],'get':function(){return _0x559dbe[_0x3a53f5];}}),Object[_0x4294d7(0xb6)](_0x4044a4,_0x192f44,_0x419b37);}:function(_0x13185d,_0x2f45f7,_0x31e1ba,_0x26a860){if(_0x26a860===undefined)_0x26a860=_0x31e1ba;_0x13185d[_0x26a860]=_0x2f45f7[_0x31e1ba];}),__setModuleDefault=this&&this[a34_0x4533ee(0xba)]||(Object[a34_0x4533ee(0xde)]?function(_0x2f6cbd,_0x467ba6){const _0x484acd=a34_0x4533ee;Object[_0x484acd(0xb6)](_0x2f6cbd,_0x484acd(0xaf),{'enumerable':!![],'value':_0x467ba6});}:function(_0x15170a,_0x4dc971){_0x15170a['default']=_0x4dc971;}),__importStar=this&&this['__importStar']||function(_0x4eb366){const _0x370537=a34_0x4533ee;if(_0x4eb366&&_0x4eb366[_0x370537(0xa7)])return _0x4eb366;var _0x3a4b9b={};if(_0x4eb366!=null){for(var _0x36f8e3 in _0x4eb366)if(_0x36f8e3!=='default'&&Object[_0x370537(0xd9)][_0x370537(0xbe)][_0x370537(0xe0)](_0x4eb366,_0x36f8e3))__createBinding(_0x3a4b9b,_0x4eb366,_0x36f8e3);}return __setModuleDefault(_0x3a4b9b,_0x4eb366),_0x3a4b9b;},__importDefault=this&&this[a34_0x4533ee(0x99)]||function(_0x52a9f3){const _0x35608f=a34_0x4533ee;return _0x52a9f3&&_0x52a9f3[_0x35608f(0xa7)]?_0x52a9f3:{'default':_0x52a9f3};};function a34_0x53fd(){const _0x3c6636=['5jauGzE','required','../errors/AppError','document','../models/Plan','defineProperty','toISOString','4420772vgPoCZ','length','__setModuleDefault','paid','getSubscriptions','519990syJRJP','hasOwnProperty','cnpj','findOne','shape','deleteWebhook','../models/Invoices','planId','forEach','6320300mivMYw','name','Company\x20not\x20found','amount','configurable','NumberFormat','pixDeleteWebhook','format','status','pixGenerateQRCode','USD','en-US','getOwnPropertyDescriptor','5197866yvzIZY','index','pix','object','companyId','GERENCIANET_CHAVEPIX','prototype','emit','3271032bzNNrh','getIO','../config/Gn','create','pixCreateImmediateCharge','call','teste_webhook','cpf','get','../models/Company','createSubscription','isValid','split','writable','log','env','getDate','__importDefault','gn-api-sdk-typescript','reload','dueDate','Validation\x20fails','yup','json','pixDetailCharge','currency','2806593URRJTA','2gbxyuP','update','string','createWebhook','__esModule','31477239PHQxcs','user','body','error_subscription','findByPk','pixConfigWebhook','__createBinding','default','CONCLUIDA'];a34_0x53fd=function(){return _0x3c6636;};return a34_0x53fd();}Object[a34_0x4533ee(0xb6)](exports,a34_0x4533ee(0xa7),{'value':!![]}),exports['webhook']=exports['deleteWebhook']=exports[a34_0x4533ee(0xa6)]=exports[a34_0x4533ee(0xe5)]=exports['index']=void 0x0;const Yup=__importStar(require(a34_0x4533ee(0x9e))),gn_api_sdk_typescript_1=__importDefault(require(a34_0x4533ee(0x9a))),AppError_1=__importDefault(require(a34_0x4533ee(0xb3))),Gn_1=__importDefault(require(a34_0x4533ee(0xdd))),Company_1=__importDefault(require(a34_0x4533ee(0xe4))),Invoices_1=__importDefault(require(a34_0x4533ee(0xc3))),socket_1=require('../libs/socket'),Plan_1=__importDefault(require(a34_0x4533ee(0xb5))),index=async(_0x2dc465,_0xdac499)=>{const _0x257a14=a34_0x4533ee,_0x156ccf=new gn_api_sdk_typescript_1[(_0x257a14(0xaf))](Gn_1[_0x257a14(0xaf)]);return _0xdac499[_0x257a14(0x9f)](_0x156ccf[_0x257a14(0xbc)]());};exports[a34_0x4533ee(0xd4)]=index;const createSubscription=async(_0x4e3048,_0x549d3a)=>{const _0x55d5bc=a34_0x4533ee,_0x138c36=new gn_api_sdk_typescript_1[(_0x55d5bc(0xaf))](Gn_1[_0x55d5bc(0xaf)]),{companyId:_0x5111ac}=_0x4e3048[_0x55d5bc(0xa9)],_0x21f87e=Yup[_0x55d5bc(0xd6)]()[_0x55d5bc(0xc1)]({'price':Yup[_0x55d5bc(0xa5)]()[_0x55d5bc(0xb2)](),'users':Yup[_0x55d5bc(0xa5)]()[_0x55d5bc(0xb2)](),'plan':Yup[_0x55d5bc(0xa5)]()[_0x55d5bc(0xb2)]()});if(!await _0x21f87e[_0x55d5bc(0xe6)](_0x4e3048['body']))throw new AppError_1['default'](_0x55d5bc(0x9d),0x190);const _0x2c92dc=new Intl[(_0x55d5bc(0xcb))](_0x55d5bc(0xd1),{'style':_0x55d5bc(0xa1),'currency':_0x55d5bc(0xd0)}),_0x3da70d=await Company_1[_0x55d5bc(0xaf)][_0x55d5bc(0xc0)]({'where':{'id':_0x5111ac}}),_0x139500=await Plan_1['default'][_0x55d5bc(0xc0)]({'where':{'id':_0x3da70d[_0x55d5bc(0xc4)]}}),{invoiceId:_0x335907}=_0x4e3048['body'],_0x5ab359=_0x139500[_0x55d5bc(0xc9)],_0xd93a5c=_0x2c92dc[_0x55d5bc(0xcd)](_0x5ab359)['replace']('$',''),_0x405972={'nome':_0x3da70d[_0x55d5bc(0xc7)]},_0x1b8106=_0x3da70d[_0x55d5bc(0xb4)]['replace'](/\D/g,'');_0x1b8106[_0x55d5bc(0xb9)]===0xb?_0x405972[_0x55d5bc(0xe2)]=_0x1b8106:_0x405972[_0x55d5bc(0xbf)]=_0x1b8106;const _0x106032={'calendario':{'expiracao':0xe10},'devedor':{..._0x405972},'valor':{'original':_0xd93a5c},'chave':process[_0x55d5bc(0xea)][_0x55d5bc(0xd8)],'solicitacaoPagador':'#Fatura:'+_0x335907};try{const _0x242d4c=await _0x138c36[_0x55d5bc(0xdf)](null,_0x106032),_0x262135=await _0x138c36[_0x55d5bc(0xcf)]({'id':_0x242d4c['loc']['id']});if(!_0x3da70d)throw new AppError_1[(_0x55d5bc(0xaf))](_0x55d5bc(0xc8),0x194);return _0x549d3a[_0x55d5bc(0x9f)]({..._0x242d4c,'qrcode':_0x262135});}catch(_0x32fec6){console[_0x55d5bc(0xe9)](_0x55d5bc(0xab),_0x32fec6);throw new AppError_1[(_0x55d5bc(0xaf))](_0x55d5bc(0x9d),0x190);}};exports[a34_0x4533ee(0xe5)]=createSubscription;const createWebhook=async(_0x257a5a,_0x2050c5)=>{const _0x18ac65=a34_0x4533ee,_0x253d46=Yup['object']()['shape']({'chave':Yup['string']()[_0x18ac65(0xb2)](),'url':Yup['string']()['required']()});if(!await _0x253d46[_0x18ac65(0xe6)](_0x257a5a[_0x18ac65(0xaa)]))throw new AppError_1[(_0x18ac65(0xaf))](_0x18ac65(0x9d),0x190);const {chave:_0x3a986b,url:_0x463723}=_0x257a5a[_0x18ac65(0xaa)],_0x2dfdce={'webhookUrl':_0x463723},_0x4bb8ce={'chave':_0x3a986b};try{const _0x46e82f=new gn_api_sdk_typescript_1[(_0x18ac65(0xaf))](Gn_1['default']),_0x227c9a=await _0x46e82f[_0x18ac65(0xad)](_0x4bb8ce,_0x2dfdce);return _0x2050c5[_0x18ac65(0x9f)](_0x227c9a);}catch(_0x1207d5){console[_0x18ac65(0xe9)](_0x1207d5);}};exports[a34_0x4533ee(0xa6)]=createWebhook;function a34_0x2097(_0x3bfb5c,_0x2769b3){const _0x53fde8=a34_0x53fd();return a34_0x2097=function(_0x209787,_0x26a05d){_0x209787=_0x209787-0x98;let _0x579787=_0x53fde8[_0x209787];return _0x579787;},a34_0x2097(_0x3bfb5c,_0x2769b3);}const deleteWebhook=async(_0x54ab63,_0x3f3d37)=>{const _0x201716=a34_0x4533ee,_0x235539=Yup[_0x201716(0xd6)]()[_0x201716(0xc1)]({'chave':Yup[_0x201716(0xa5)]()[_0x201716(0xb2)]()});if(!await _0x235539[_0x201716(0xe6)](_0x54ab63[_0x201716(0xaa)]))throw new AppError_1[(_0x201716(0xaf))]('Validation\x20fails',0x190);const {chave:_0x398d34}=_0x54ab63[_0x201716(0xaa)],_0x4594a6={'chave':_0x398d34},_0x5a1c99=new gn_api_sdk_typescript_1['default'](Gn_1['default']),_0x50c19b=await _0x5a1c99[_0x201716(0xcc)](_0x4594a6);return _0x3f3d37[_0x201716(0x9f)](_0x50c19b);};exports[a34_0x4533ee(0xc2)]=deleteWebhook;const webhook=async(_0x85e30c,_0x4fe9a1)=>{const _0x54fbc7=a34_0x4533ee,{type:_0x53898c}=_0x85e30c['params'],{evento:_0x4ad75b}=_0x85e30c[_0x54fbc7(0xaa)];if(_0x4ad75b===_0x54fbc7(0xe1))return _0x4fe9a1[_0x54fbc7(0x9f)]({'ok':!![]});if(_0x85e30c[_0x54fbc7(0xaa)][_0x54fbc7(0xd5)]){const _0x2f0ff3=new gn_api_sdk_typescript_1[(_0x54fbc7(0xaf))](Gn_1[_0x54fbc7(0xaf)]);_0x85e30c[_0x54fbc7(0xaa)][_0x54fbc7(0xd5)][_0x54fbc7(0xc5)](async _0x3f71d1=>{const _0x216b67=_0x54fbc7,_0x3f9863=await _0x2f0ff3[_0x216b67(0xa0)]({'txid':_0x3f71d1['txid']});if(_0x3f9863[_0x216b67(0xce)]===_0x216b67(0xb0)){const {solicitacaoPagador:_0x1df6db}=_0x3f9863,_0x677767=_0x1df6db['replace']('#Fatura:',''),_0x1a346c=await Invoices_1[_0x216b67(0xaf)]['findByPk'](_0x677767),_0x26a875=_0x1a346c[_0x216b67(0xd7)],_0x4a6817=await Company_1[_0x216b67(0xaf)][_0x216b67(0xac)](_0x26a875),_0x4b152c=new Date(_0x4a6817[_0x216b67(0x9c)]);_0x4b152c['setDate'](_0x4b152c[_0x216b67(0x98)]()+0x1e);const _0x5c50ce=_0x4b152c[_0x216b67(0xb7)]()[_0x216b67(0xe7)]('T')[0x0];if(_0x4a6817){await _0x4a6817[_0x216b67(0xa4)]({'dueDate':_0x5c50ce});const _0x168167=await _0x1a346c['update']({'id':_0x677767,'status':_0x216b67(0xbb)});await _0x4a6817[_0x216b67(0x9b)]();const _0x5a00c6=(0x0,socket_1[_0x216b67(0xdc)])(),_0xfb5094=await Company_1['default'][_0x216b67(0xc0)]({'where':{'id':_0x26a875}});_0x5a00c6[_0x216b67(0xda)]('company-'+_0x26a875+'-payment',{'action':_0x3f9863[_0x216b67(0xce)],'company':_0xfb5094});}}});}return _0x4fe9a1['json']({'ok':!![]});};exports['webhook']=webhook;