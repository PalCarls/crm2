'use strict';const a34_0x38d167=a34_0x26fc;(function(_0x504bd3,_0x2e8426){const _0x3fee60=a34_0x26fc,_0x1d8e9b=_0x504bd3();while(!![]){try{const _0x62c3ff=-parseInt(_0x3fee60(0x18e))/0x1+-parseInt(_0x3fee60(0x1cb))/0x2+parseInt(_0x3fee60(0x1cc))/0x3+-parseInt(_0x3fee60(0x1ae))/0x4*(-parseInt(_0x3fee60(0x1d4))/0x5)+parseInt(_0x3fee60(0x1a8))/0x6+parseInt(_0x3fee60(0x1ac))/0x7*(parseInt(_0x3fee60(0x1d6))/0x8)+parseInt(_0x3fee60(0x1b5))/0x9*(-parseInt(_0x3fee60(0x187))/0xa);if(_0x62c3ff===_0x2e8426)break;else _0x1d8e9b['push'](_0x1d8e9b['shift']());}catch(_0xc72b7b){_0x1d8e9b['push'](_0x1d8e9b['shift']());}}}(a34_0xb5e2,0x4ec6b));var __createBinding=this&&this[a34_0x38d167(0x197)]||(Object[a34_0x38d167(0x1b8)]?function(_0x375592,_0x237490,_0x3887fc,_0x29f482){const _0x42b0be=a34_0x38d167;if(_0x29f482===undefined)_0x29f482=_0x3887fc;var _0x3c0a6c=Object['getOwnPropertyDescriptor'](_0x237490,_0x3887fc);(!_0x3c0a6c||(_0x42b0be(0x1a5)in _0x3c0a6c?!_0x237490[_0x42b0be(0x193)]:_0x3c0a6c[_0x42b0be(0x1c3)]||_0x3c0a6c[_0x42b0be(0x1a9)]))&&(_0x3c0a6c={'enumerable':!![],'get':function(){return _0x237490[_0x3887fc];}}),Object['defineProperty'](_0x375592,_0x29f482,_0x3c0a6c);}:function(_0x54536e,_0x412408,_0x80d270,_0x324f1d){if(_0x324f1d===undefined)_0x324f1d=_0x80d270;_0x54536e[_0x324f1d]=_0x412408[_0x80d270];}),__setModuleDefault=this&&this[a34_0x38d167(0x195)]||(Object['create']?function(_0x818903,_0xfc4e2e){const _0x598450=a34_0x38d167;Object[_0x598450(0x1b7)](_0x818903,_0x598450(0x1c1),{'enumerable':!![],'value':_0xfc4e2e});}:function(_0x3256b9,_0x3490c4){const _0x3d3253=a34_0x38d167;_0x3256b9[_0x3d3253(0x1c1)]=_0x3490c4;}),__importStar=this&&this[a34_0x38d167(0x1d8)]||function(_0x1c793e){const _0x461a8c=a34_0x38d167;if(_0x1c793e&&_0x1c793e[_0x461a8c(0x193)])return _0x1c793e;var _0x3ea97d={};if(_0x1c793e!=null){for(var _0xb8b448 in _0x1c793e)if(_0xb8b448!==_0x461a8c(0x1c1)&&Object[_0x461a8c(0x194)][_0x461a8c(0x198)][_0x461a8c(0x1b0)](_0x1c793e,_0xb8b448))__createBinding(_0x3ea97d,_0x1c793e,_0xb8b448);}return __setModuleDefault(_0x3ea97d,_0x1c793e),_0x3ea97d;},__importDefault=this&&this[a34_0x38d167(0x1bc)]||function(_0xf2f523){const _0x43303f=a34_0x38d167;return _0xf2f523&&_0xf2f523[_0x43303f(0x193)]?_0xf2f523:{'default':_0xf2f523};};Object['defineProperty'](exports,a34_0x38d167(0x193),{'value':!![]}),exports['webhook']=exports[a34_0x38d167(0x1c8)]=exports[a34_0x38d167(0x1c4)]=exports[a34_0x38d167(0x1cf)]=exports[a34_0x38d167(0x192)]=void 0x0;const Yup=__importStar(require('yup')),gn_api_sdk_typescript_1=__importDefault(require(a34_0x38d167(0x1cd))),AppError_1=__importDefault(require(a34_0x38d167(0x1ba))),Gn_1=__importDefault(require(a34_0x38d167(0x1c7))),Company_1=__importDefault(require(a34_0x38d167(0x196))),Invoices_1=__importDefault(require(a34_0x38d167(0x1d3))),socket_1=require(a34_0x38d167(0x1a4)),Plan_1=__importDefault(require(a34_0x38d167(0x1a1))),index=async(_0x7c4659,_0x4bf795)=>{const _0x2813d5=a34_0x38d167,_0x2fc684=new gn_api_sdk_typescript_1['default'](Gn_1[_0x2813d5(0x1c1)]);return _0x4bf795[_0x2813d5(0x1ca)](_0x2fc684['getSubscriptions']());};function a34_0x26fc(_0x541086,_0xc6f660){const _0xb5e2ca=a34_0xb5e2();return a34_0x26fc=function(_0x26fcc6,_0x2d6085){_0x26fcc6=_0x26fcc6-0x187;let _0x465da4=_0xb5e2ca[_0x26fcc6];return _0x465da4;},a34_0x26fc(_0x541086,_0xc6f660);}function a34_0xb5e2(){const _0x1e460e=['get','status','getIO','3320862ZBHuwF','configurable','required','CONCLUIDA','161XMfvTN','forEach','20jawjtZ','log','call','NumberFormat','update','split','user','8961831QvpQcl','body','defineProperty','create','reload','../errors/AppError','Company\x20not\x20found','__importDefault','webhook','emit','company-','Validation\x20fails','default','env','writable','createWebhook','findOne','currency','../config/Gn','deleteWebhook','getDate','json','268288xEqiOT','72525VpXEyT','gn-api-sdk-typescript','pixCreateImmediateCharge','createSubscription','en-US','pixGenerateQRCode','companyId','../models/Invoices','498860ECOwBC','string','199592rNovTt','teste_webhook','__importStar','-payment','10FrCoNr','GERENCIANET_CHAVEPIX','cnpj','object','pixDeleteWebhook','planId','txid','197769UcGTWa','shape','name','replace','index','__esModule','prototype','__setModuleDefault','../models/Company','__createBinding','hasOwnProperty','setDate','#Fatura:','error_subscription','pix','format','length','document','pixConfigWebhook','../models/Plan','findByPk','isValid','../libs/socket'];a34_0xb5e2=function(){return _0x1e460e;};return a34_0xb5e2();}exports[a34_0x38d167(0x192)]=index;const createSubscription=async(_0x4a8d79,_0x1f94a6)=>{const _0x288811=a34_0x38d167,_0x2fd00c=new gn_api_sdk_typescript_1['default'](Gn_1[_0x288811(0x1c1)]),{companyId:_0x369593}=_0x4a8d79[_0x288811(0x1b4)],_0x4a4f49=Yup[_0x288811(0x18a)]()['shape']({'price':Yup[_0x288811(0x1d5)]()[_0x288811(0x1aa)](),'users':Yup[_0x288811(0x1d5)]()[_0x288811(0x1aa)](),'plan':Yup[_0x288811(0x1d5)]()['required']()});if(!await _0x4a4f49[_0x288811(0x1a3)](_0x4a8d79[_0x288811(0x1b6)]))throw new AppError_1[(_0x288811(0x1c1))](_0x288811(0x1c0),0x190);const _0x2ea6c7=new Intl[(_0x288811(0x1b1))](_0x288811(0x1d0),{'style':_0x288811(0x1c6),'currency':'USD'}),_0x1cc538=await Company_1['default']['findOne']({'where':{'id':_0x369593}}),_0x313775=await Plan_1[_0x288811(0x1c1)][_0x288811(0x1c5)]({'where':{'id':_0x1cc538[_0x288811(0x18c)]}}),{invoiceId:_0x17adcf}=_0x4a8d79[_0x288811(0x1b6)],_0x5b6499=_0x313775['amount'],_0x279e64=_0x2ea6c7[_0x288811(0x19d)](_0x5b6499)[_0x288811(0x191)]('$',''),_0x152996={'nome':_0x1cc538[_0x288811(0x190)]},_0x5cca33=_0x1cc538[_0x288811(0x19f)][_0x288811(0x191)](/\D/g,'');_0x5cca33[_0x288811(0x19e)]===0xb?_0x152996['cpf']=_0x5cca33:_0x152996[_0x288811(0x189)]=_0x5cca33;const _0xfcba70={'calendario':{'expiracao':0xe10},'devedor':{..._0x152996},'valor':{'original':_0x279e64},'chave':process[_0x288811(0x1c2)][_0x288811(0x188)],'solicitacaoPagador':_0x288811(0x19a)+_0x17adcf};try{const _0x3fcd07=await _0x2fd00c[_0x288811(0x1ce)](null,_0xfcba70),_0x5c7d02=await _0x2fd00c[_0x288811(0x1d1)]({'id':_0x3fcd07['loc']['id']});if(!_0x1cc538)throw new AppError_1[(_0x288811(0x1c1))](_0x288811(0x1bb),0x194);return _0x1f94a6[_0x288811(0x1ca)]({..._0x3fcd07,'qrcode':_0x5c7d02});}catch(_0x1c70c4){console[_0x288811(0x1af)](_0x288811(0x19b),_0x1c70c4);throw new AppError_1[(_0x288811(0x1c1))]('Validation\x20fails',0x190);}};exports['createSubscription']=createSubscription;const createWebhook=async(_0x1f7819,_0x4ff6ce)=>{const _0x1c1516=a34_0x38d167,_0x55cadb=Yup[_0x1c1516(0x18a)]()[_0x1c1516(0x18f)]({'chave':Yup[_0x1c1516(0x1d5)]()[_0x1c1516(0x1aa)](),'url':Yup['string']()[_0x1c1516(0x1aa)]()});if(!await _0x55cadb[_0x1c1516(0x1a3)](_0x1f7819['body']))throw new AppError_1[(_0x1c1516(0x1c1))](_0x1c1516(0x1c0),0x190);const {chave:_0x5031c5,url:_0x700815}=_0x1f7819[_0x1c1516(0x1b6)],_0x10b1a5={'webhookUrl':_0x700815},_0xfc10ce={'chave':_0x5031c5};try{const _0x33a17a=new gn_api_sdk_typescript_1[(_0x1c1516(0x1c1))](Gn_1[_0x1c1516(0x1c1)]),_0x23f8b9=await _0x33a17a[_0x1c1516(0x1a0)](_0xfc10ce,_0x10b1a5);return _0x4ff6ce['json'](_0x23f8b9);}catch(_0x7fa9d9){console[_0x1c1516(0x1af)](_0x7fa9d9);}};exports[a34_0x38d167(0x1c4)]=createWebhook;const deleteWebhook=async(_0x1f597b,_0x57ead1)=>{const _0x25b5a9=a34_0x38d167,_0x232ec0=Yup[_0x25b5a9(0x18a)]()['shape']({'chave':Yup[_0x25b5a9(0x1d5)]()[_0x25b5a9(0x1aa)]()});if(!await _0x232ec0[_0x25b5a9(0x1a3)](_0x1f597b[_0x25b5a9(0x1b6)]))throw new AppError_1[(_0x25b5a9(0x1c1))](_0x25b5a9(0x1c0),0x190);const {chave:_0x59c42d}=_0x1f597b[_0x25b5a9(0x1b6)],_0x5d4617={'chave':_0x59c42d},_0xd5d706=new gn_api_sdk_typescript_1[(_0x25b5a9(0x1c1))](Gn_1[_0x25b5a9(0x1c1)]),_0x5acff2=await _0xd5d706[_0x25b5a9(0x18b)](_0x5d4617);return _0x57ead1['json'](_0x5acff2);};exports[a34_0x38d167(0x1c8)]=deleteWebhook;const webhook=async(_0x17b846,_0x1f1e82)=>{const _0x548d94=a34_0x38d167,{type:_0x29d1d3}=_0x17b846['params'],{evento:_0x37b8cd}=_0x17b846[_0x548d94(0x1b6)];if(_0x37b8cd===_0x548d94(0x1d7))return _0x1f1e82['json']({'ok':!![]});if(_0x17b846[_0x548d94(0x1b6)][_0x548d94(0x19c)]){const _0x4bd346=new gn_api_sdk_typescript_1[(_0x548d94(0x1c1))](Gn_1[_0x548d94(0x1c1)]);_0x17b846['body'][_0x548d94(0x19c)][_0x548d94(0x1ad)](async _0x3af376=>{const _0x18c1b1=_0x548d94,_0x20f14a=await _0x4bd346['pixDetailCharge']({'txid':_0x3af376[_0x18c1b1(0x18d)]});if(_0x20f14a[_0x18c1b1(0x1a6)]===_0x18c1b1(0x1ab)){const {solicitacaoPagador:_0x124d8a}=_0x20f14a,_0xec7d70=_0x124d8a[_0x18c1b1(0x191)](_0x18c1b1(0x19a),''),_0x4bfd15=await Invoices_1[_0x18c1b1(0x1c1)][_0x18c1b1(0x1a2)](_0xec7d70),_0x5a1ddc=_0x4bfd15[_0x18c1b1(0x1d2)],_0x512d73=await Company_1[_0x18c1b1(0x1c1)][_0x18c1b1(0x1a2)](_0x5a1ddc),_0x3ae7bc=new Date(_0x512d73['dueDate']);_0x3ae7bc[_0x18c1b1(0x199)](_0x3ae7bc[_0x18c1b1(0x1c9)]()+0x1e);const _0x54c66f=_0x3ae7bc['toISOString']()[_0x18c1b1(0x1b3)]('T')[0x0];if(_0x512d73){await _0x512d73[_0x18c1b1(0x1b2)]({'dueDate':_0x54c66f});const _0x5c1ade=await _0x4bfd15[_0x18c1b1(0x1b2)]({'id':_0xec7d70,'status':'paid'});await _0x512d73[_0x18c1b1(0x1b9)]();const _0x45a02b=(0x0,socket_1[_0x18c1b1(0x1a7)])(),_0x167907=await Company_1[_0x18c1b1(0x1c1)]['findOne']({'where':{'id':_0x5a1ddc}});_0x45a02b[_0x18c1b1(0x1be)](_0x18c1b1(0x1bf)+_0x5a1ddc+_0x18c1b1(0x1d9),{'action':_0x20f14a[_0x18c1b1(0x1a6)],'company':_0x167907});}}});}return _0x1f1e82[_0x548d94(0x1ca)]({'ok':!![]});};exports[a34_0x38d167(0x1bd)]=webhook;