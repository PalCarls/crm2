'use strict';const a31_0x1180bb=a31_0x3bbc;(function(_0x8bff59,_0x1997c9){const _0x41b092=a31_0x3bbc,_0x55f906=_0x8bff59();while(!![]){try{const _0x4e398a=parseInt(_0x41b092(0x1ba))/0x1+-parseInt(_0x41b092(0x18c))/0x2+parseInt(_0x41b092(0x187))/0x3*(parseInt(_0x41b092(0x192))/0x4)+-parseInt(_0x41b092(0x1b9))/0x5+parseInt(_0x41b092(0x1d3))/0x6+parseInt(_0x41b092(0x1b7))/0x7+parseInt(_0x41b092(0x19b))/0x8*(-parseInt(_0x41b092(0x1bb))/0x9);if(_0x4e398a===_0x1997c9)break;else _0x55f906['push'](_0x55f906['shift']());}catch(_0x345067){_0x55f906['push'](_0x55f906['shift']());}}}(a31_0xbda7,0xcafdb));var __createBinding=this&&this[a31_0x1180bb(0x1cb)]||(Object[a31_0x1180bb(0x1a7)]?function(_0x4157e9,_0x2a6e01,_0x45027d,_0x2d884a){const _0x4622ec=a31_0x1180bb;if(_0x2d884a===undefined)_0x2d884a=_0x45027d;var _0x2f8536=Object[_0x4622ec(0x1c9)](_0x2a6e01,_0x45027d);(!_0x2f8536||(_0x4622ec(0x194)in _0x2f8536?!_0x2a6e01[_0x4622ec(0x1a4)]:_0x2f8536['writable']||_0x2f8536[_0x4622ec(0x185)]))&&(_0x2f8536={'enumerable':!![],'get':function(){return _0x2a6e01[_0x45027d];}}),Object['defineProperty'](_0x4157e9,_0x2d884a,_0x2f8536);}:function(_0x53ac0b,_0x22ce94,_0x469f92,_0x33683e){if(_0x33683e===undefined)_0x33683e=_0x469f92;_0x53ac0b[_0x33683e]=_0x22ce94[_0x469f92];}),__setModuleDefault=this&&this[a31_0x1180bb(0x189)]||(Object['create']?function(_0x950693,_0x5c4ecc){const _0x25969f=a31_0x1180bb;Object['defineProperty'](_0x950693,_0x25969f(0x1b5),{'enumerable':!![],'value':_0x5c4ecc});}:function(_0x25c463,_0x22a5cb){const _0x1e142b=a31_0x1180bb;_0x25c463[_0x1e142b(0x1b5)]=_0x22a5cb;}),__importStar=this&&this[a31_0x1180bb(0x1cd)]||function(_0x58d3a7){const _0x9d1d1b=a31_0x1180bb;if(_0x58d3a7&&_0x58d3a7['__esModule'])return _0x58d3a7;var _0x50fa4f={};if(_0x58d3a7!=null){for(var _0x223701 in _0x58d3a7)if(_0x223701!==_0x9d1d1b(0x1b5)&&Object[_0x9d1d1b(0x19d)][_0x9d1d1b(0x18b)][_0x9d1d1b(0x1b6)](_0x58d3a7,_0x223701))__createBinding(_0x50fa4f,_0x58d3a7,_0x223701);}return __setModuleDefault(_0x50fa4f,_0x58d3a7),_0x50fa4f;},__importDefault=this&&this[a31_0x1180bb(0x1aa)]||function(_0x2782d1){const _0x4a1320=a31_0x1180bb;return _0x2782d1&&_0x2782d1[_0x4a1320(0x1a4)]?_0x2782d1:{'default':_0x2782d1};};function a31_0xbda7(){const _0x8bce87=['gn-api-sdk-typescript','pixCreateImmediateCharge','#Fatura:','../errors/AppError','default','call','7873124RBbwSK','update','1346710GCUCHt','346855gZPUfT','45Aaspzm','object','companyId','required','length','split','shape','../libs/socket','findOne','planId','json','company-','../models/Plan','-payment','getOwnPropertyDescriptor','paid','__createBinding','Company\x20not\x20found','__importStar','yup','pix','format','isValid','pixDetailCharge','464130KnYeHR','configurable','en-US','87PYYmyL','setDate','__setModuleDefault','log','hasOwnProperty','25864aaYBCH','cnpj','webhook','name','status','createSubscription','79988yzHjVC','getDate','get','amount','createWebhook','body','index','env','../config/Gn','1624208MgeSss','Validation\x20fails','prototype','NumberFormat','pixDeleteWebhook','forEach','dueDate','string','getIO','__esModule','loc','deleteWebhook','create','../models/Company','CONCLUIDA','__importDefault','cpf','findByPk','reload','toISOString','defineProperty','replace'];a31_0xbda7=function(){return _0x8bce87;};return a31_0xbda7();}Object[a31_0x1180bb(0x1af)](exports,a31_0x1180bb(0x1a4),{'value':!![]}),exports['webhook']=exports['deleteWebhook']=exports[a31_0x1180bb(0x196)]=exports[a31_0x1180bb(0x191)]=exports['index']=void 0x0;const Yup=__importStar(require(a31_0x1180bb(0x1ce))),gn_api_sdk_typescript_1=__importDefault(require(a31_0x1180bb(0x1b1))),AppError_1=__importDefault(require(a31_0x1180bb(0x1b4))),Gn_1=__importDefault(require(a31_0x1180bb(0x19a))),Company_1=__importDefault(require(a31_0x1180bb(0x1a8))),Invoices_1=__importDefault(require('../models/Invoices')),socket_1=require(a31_0x1180bb(0x1c2)),Plan_1=__importDefault(require(a31_0x1180bb(0x1c7))),index=async(_0x3454af,_0x27ed94)=>{const _0x51bf5e=a31_0x1180bb,_0x319080=new gn_api_sdk_typescript_1['default'](Gn_1['default']);return _0x27ed94[_0x51bf5e(0x1c5)](_0x319080['getSubscriptions']());};function a31_0x3bbc(_0x11bf95,_0x4ded4f){const _0xbda7a4=a31_0xbda7();return a31_0x3bbc=function(_0x3bbc75,_0x294657){_0x3bbc75=_0x3bbc75-0x185;let _0x5db3e3=_0xbda7a4[_0x3bbc75];return _0x5db3e3;},a31_0x3bbc(_0x11bf95,_0x4ded4f);}exports[a31_0x1180bb(0x198)]=index;const createSubscription=async(_0x5e4c8e,_0x2ee387)=>{const _0x53adf1=a31_0x1180bb,_0x4a1c33=new gn_api_sdk_typescript_1[(_0x53adf1(0x1b5))](Gn_1[_0x53adf1(0x1b5)]),{companyId:_0x194ec7}=_0x5e4c8e['user'],_0x49880f=Yup['object']()[_0x53adf1(0x1c1)]({'price':Yup[_0x53adf1(0x1a2)]()['required'](),'users':Yup['string']()[_0x53adf1(0x1be)](),'plan':Yup[_0x53adf1(0x1a2)]()[_0x53adf1(0x1be)]()});if(!await _0x49880f[_0x53adf1(0x1d1)](_0x5e4c8e['body']))throw new AppError_1[(_0x53adf1(0x1b5))](_0x53adf1(0x19c),0x190);const _0xeb29f4=new Intl[(_0x53adf1(0x19e))](_0x53adf1(0x186),{'style':'currency','currency':'USD'}),_0x2ceaec=await Company_1[_0x53adf1(0x1b5)][_0x53adf1(0x1c3)]({'where':{'id':_0x194ec7}}),_0x1134f8=await Plan_1['default']['findOne']({'where':{'id':_0x2ceaec[_0x53adf1(0x1c4)]}}),{invoiceId:_0x3accc9}=_0x5e4c8e['body'],_0x333aec=_0x1134f8[_0x53adf1(0x195)],_0x528f7c=_0xeb29f4[_0x53adf1(0x1d0)](_0x333aec)[_0x53adf1(0x1b0)]('$',''),_0xa80890={'nome':_0x2ceaec[_0x53adf1(0x18f)]},_0x35410e=_0x2ceaec['document'][_0x53adf1(0x1b0)](/\D/g,'');_0x35410e[_0x53adf1(0x1bf)]===0xb?_0xa80890[_0x53adf1(0x1ab)]=_0x35410e:_0xa80890[_0x53adf1(0x18d)]=_0x35410e;const _0x192396={'calendario':{'expiracao':0xe10},'devedor':{..._0xa80890},'valor':{'original':_0x528f7c},'chave':process[_0x53adf1(0x199)]['GERENCIANET_CHAVEPIX'],'solicitacaoPagador':_0x53adf1(0x1b3)+_0x3accc9};try{const _0x3b2ea9=await _0x4a1c33[_0x53adf1(0x1b2)](null,_0x192396),_0x1a4ab9=await _0x4a1c33['pixGenerateQRCode']({'id':_0x3b2ea9[_0x53adf1(0x1a5)]['id']});if(!_0x2ceaec)throw new AppError_1['default'](_0x53adf1(0x1cc),0x194);return _0x2ee387[_0x53adf1(0x1c5)]({..._0x3b2ea9,'qrcode':_0x1a4ab9});}catch(_0x128bc7){console['log']('error_subscription',_0x128bc7);throw new AppError_1[(_0x53adf1(0x1b5))]('Validation\x20fails',0x190);}};exports['createSubscription']=createSubscription;const createWebhook=async(_0x130a39,_0x1cbb2a)=>{const _0x4965d7=a31_0x1180bb,_0x4235bc=Yup[_0x4965d7(0x1bc)]()[_0x4965d7(0x1c1)]({'chave':Yup['string']()['required'](),'url':Yup[_0x4965d7(0x1a2)]()[_0x4965d7(0x1be)]()});if(!await _0x4235bc[_0x4965d7(0x1d1)](_0x130a39['body']))throw new AppError_1[(_0x4965d7(0x1b5))](_0x4965d7(0x19c),0x190);const {chave:_0x26760f,url:_0x330f30}=_0x130a39[_0x4965d7(0x197)],_0x4c51c9={'webhookUrl':_0x330f30},_0x2ab9eb={'chave':_0x26760f};try{const _0xeb694b=new gn_api_sdk_typescript_1[(_0x4965d7(0x1b5))](Gn_1[_0x4965d7(0x1b5)]),_0xa67cb2=await _0xeb694b['pixConfigWebhook'](_0x2ab9eb,_0x4c51c9);return _0x1cbb2a[_0x4965d7(0x1c5)](_0xa67cb2);}catch(_0x4194bc){console[_0x4965d7(0x18a)](_0x4194bc);}};exports[a31_0x1180bb(0x196)]=createWebhook;const deleteWebhook=async(_0x11f015,_0xd3a2ab)=>{const _0x1533c8=a31_0x1180bb,_0x33d00d=Yup['object']()[_0x1533c8(0x1c1)]({'chave':Yup[_0x1533c8(0x1a2)]()[_0x1533c8(0x1be)]()});if(!await _0x33d00d[_0x1533c8(0x1d1)](_0x11f015['body']))throw new AppError_1[(_0x1533c8(0x1b5))]('Validation\x20fails',0x190);const {chave:_0x5e4374}=_0x11f015[_0x1533c8(0x197)],_0x1873f0={'chave':_0x5e4374},_0x200b2e=new gn_api_sdk_typescript_1['default'](Gn_1[_0x1533c8(0x1b5)]),_0xe42c7=await _0x200b2e[_0x1533c8(0x19f)](_0x1873f0);return _0xd3a2ab[_0x1533c8(0x1c5)](_0xe42c7);};exports[a31_0x1180bb(0x1a6)]=deleteWebhook;const webhook=async(_0x5db9ff,_0x50382c)=>{const _0x55307b=a31_0x1180bb,{type:_0x5c0f45}=_0x5db9ff['params'],{evento:_0xc4d8c2}=_0x5db9ff[_0x55307b(0x197)];if(_0xc4d8c2==='teste_webhook')return _0x50382c[_0x55307b(0x1c5)]({'ok':!![]});if(_0x5db9ff[_0x55307b(0x197)][_0x55307b(0x1cf)]){const _0x42ffc9=new gn_api_sdk_typescript_1[(_0x55307b(0x1b5))](Gn_1[_0x55307b(0x1b5)]);_0x5db9ff[_0x55307b(0x197)][_0x55307b(0x1cf)][_0x55307b(0x1a0)](async _0x12de1f=>{const _0x4e590f=_0x55307b,_0x59692e=await _0x42ffc9[_0x4e590f(0x1d2)]({'txid':_0x12de1f['txid']});if(_0x59692e[_0x4e590f(0x190)]===_0x4e590f(0x1a9)){const {solicitacaoPagador:_0x20c692}=_0x59692e,_0x5efcd1=_0x20c692[_0x4e590f(0x1b0)](_0x4e590f(0x1b3),''),_0x18d5f8=await Invoices_1['default'][_0x4e590f(0x1ac)](_0x5efcd1),_0x1980ba=_0x18d5f8[_0x4e590f(0x1bd)],_0x29601e=await Company_1[_0x4e590f(0x1b5)]['findByPk'](_0x1980ba),_0x2e8e0b=new Date(_0x29601e[_0x4e590f(0x1a1)]);_0x2e8e0b[_0x4e590f(0x188)](_0x2e8e0b[_0x4e590f(0x193)]()+0x1e);const _0x3687f8=_0x2e8e0b[_0x4e590f(0x1ae)]()[_0x4e590f(0x1c0)]('T')[0x0];if(_0x29601e){await _0x29601e[_0x4e590f(0x1b8)]({'dueDate':_0x3687f8});const _0x1ff1a0=await _0x18d5f8['update']({'id':_0x5efcd1,'status':_0x4e590f(0x1ca)});await _0x29601e[_0x4e590f(0x1ad)]();const _0x175d36=(0x0,socket_1[_0x4e590f(0x1a3)])(),_0x29598f=await Company_1['default']['findOne']({'where':{'id':_0x1980ba}});_0x175d36['emit'](_0x4e590f(0x1c6)+_0x1980ba+_0x4e590f(0x1c8),{'action':_0x59692e[_0x4e590f(0x190)],'company':_0x29598f});}}});}return _0x50382c[_0x55307b(0x1c5)]({'ok':!![]});};exports[a31_0x1180bb(0x18e)]=webhook;