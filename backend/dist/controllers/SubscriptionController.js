'use strict';const a31_0xe332a6=a31_0x32f0;(function(_0x1f030,_0x430e31){const _0x3536ff=a31_0x32f0,_0x2f49a9=_0x1f030();while(!![]){try{const _0x2d3e72=parseInt(_0x3536ff(0x114))/0x1+-parseInt(_0x3536ff(0x131))/0x2+parseInt(_0x3536ff(0x120))/0x3+parseInt(_0x3536ff(0x133))/0x4*(parseInt(_0x3536ff(0x11b))/0x5)+-parseInt(_0x3536ff(0x125))/0x6+-parseInt(_0x3536ff(0xf6))/0x7*(parseInt(_0x3536ff(0x12c))/0x8)+parseInt(_0x3536ff(0xe8))/0x9;if(_0x2d3e72===_0x430e31)break;else _0x2f49a9['push'](_0x2f49a9['shift']());}catch(_0x380c9d){_0x2f49a9['push'](_0x2f49a9['shift']());}}}(a31_0x8802,0x92fa9));var __createBinding=this&&this[a31_0xe332a6(0x105)]||(Object['create']?function(_0x247e38,_0x21407b,_0xd4967e,_0xa23ef5){const _0x21fd28=a31_0xe332a6;if(_0xa23ef5===undefined)_0xa23ef5=_0xd4967e;var _0x4d8985=Object[_0x21fd28(0x109)](_0x21407b,_0xd4967e);(!_0x4d8985||(_0x21fd28(0x11c)in _0x4d8985?!_0x21407b[_0x21fd28(0x135)]:_0x4d8985['writable']||_0x4d8985[_0x21fd28(0x132)]))&&(_0x4d8985={'enumerable':!![],'get':function(){return _0x21407b[_0xd4967e];}}),Object['defineProperty'](_0x247e38,_0xa23ef5,_0x4d8985);}:function(_0x446707,_0x1d13ad,_0x29af45,_0x3d5e7b){if(_0x3d5e7b===undefined)_0x3d5e7b=_0x29af45;_0x446707[_0x3d5e7b]=_0x1d13ad[_0x29af45];}),__setModuleDefault=this&&this[a31_0xe332a6(0x11d)]||(Object[a31_0xe332a6(0x10b)]?function(_0x1b9913,_0xd3c78b){const _0x2396f6=a31_0xe332a6;Object[_0x2396f6(0x113)](_0x1b9913,_0x2396f6(0x119),{'enumerable':!![],'value':_0xd3c78b});}:function(_0x27d719,_0x528da9){const _0x508d38=a31_0xe332a6;_0x27d719[_0x508d38(0x119)]=_0x528da9;}),__importStar=this&&this[a31_0xe332a6(0xfd)]||function(_0x58e4fe){const _0x4d62c2=a31_0xe332a6;if(_0x58e4fe&&_0x58e4fe[_0x4d62c2(0x135)])return _0x58e4fe;var _0x5062fa={};if(_0x58e4fe!=null){for(var _0x5a7a7b in _0x58e4fe)if(_0x5a7a7b!==_0x4d62c2(0x119)&&Object['prototype'][_0x4d62c2(0x126)][_0x4d62c2(0x100)](_0x58e4fe,_0x5a7a7b))__createBinding(_0x5062fa,_0x58e4fe,_0x5a7a7b);}return __setModuleDefault(_0x5062fa,_0x58e4fe),_0x5062fa;},__importDefault=this&&this[a31_0xe332a6(0xea)]||function(_0x11777e){return _0x11777e&&_0x11777e['__esModule']?_0x11777e:{'default':_0x11777e};};function a31_0x8802(){const _0x447386=['deleteWebhook','update','createWebhook','pix','28UDEpsI','teste_webhook','replace','object','../errors/AppError','GERENCIANET_CHAVEPIX','currency','__importStar','emit','cnpj','call','pixConfigWebhook','string','amount','json','__createBinding','shape','index','txid','getOwnPropertyDescriptor','gn-api-sdk-typescript','create','CONCLUIDA','log','env','name','findByPk','#Fatura:','webhook','defineProperty','123929GOWNAk','toISOString','reload','pixCreateImmediateCharge','getIO','default','findOne','101520KxFCFN','get','__setModuleDefault','../config/Gn','required','2414997AIYlQS','document','Company\x20not\x20found','pixDetailCharge','../models/Invoices','5902152tSNApz','hasOwnProperty','params','body','createSubscription','yup','Validation\x20fails','324656IiPXuk','dueDate','format','cpf','forEach','1262140zIIhxO','configurable','200SRneSy','USD','__esModule','status','3914883acnXEy','loc','__importDefault','companyId','planId','user','error_subscription','getDate','isValid','../models/Plan'];a31_0x8802=function(){return _0x447386;};return a31_0x8802();}Object[a31_0xe332a6(0x113)](exports,a31_0xe332a6(0x135),{'value':!![]}),exports[a31_0xe332a6(0x112)]=exports[a31_0xe332a6(0xf2)]=exports[a31_0xe332a6(0xf4)]=exports[a31_0xe332a6(0x129)]=exports[a31_0xe332a6(0x107)]=void 0x0;const Yup=__importStar(require(a31_0xe332a6(0x12a))),gn_api_sdk_typescript_1=__importDefault(require(a31_0xe332a6(0x10a))),AppError_1=__importDefault(require(a31_0xe332a6(0xfa))),Gn_1=__importDefault(require(a31_0xe332a6(0x11e))),Company_1=__importDefault(require('../models/Company')),Invoices_1=__importDefault(require(a31_0xe332a6(0x124))),socket_1=require('../libs/socket'),Plan_1=__importDefault(require(a31_0xe332a6(0xf1))),index=async(_0x4b1a66,_0x53871a)=>{const _0x12615a=a31_0xe332a6,_0x53f561=new gn_api_sdk_typescript_1[(_0x12615a(0x119))](Gn_1[_0x12615a(0x119)]);return _0x53871a['json'](_0x53f561['getSubscriptions']());};exports[a31_0xe332a6(0x107)]=index;function a31_0x32f0(_0x5e4ea9,_0x166b82){const _0x880289=a31_0x8802();return a31_0x32f0=function(_0x32f0e2,_0x22727a){_0x32f0e2=_0x32f0e2-0xe8;let _0x19fa07=_0x880289[_0x32f0e2];return _0x19fa07;},a31_0x32f0(_0x5e4ea9,_0x166b82);}const createSubscription=async(_0x3092de,_0x5c7e21)=>{const _0xb036ae=a31_0xe332a6,_0x20ddb5=new gn_api_sdk_typescript_1[(_0xb036ae(0x119))](Gn_1[_0xb036ae(0x119)]),{companyId:_0x4aa50f}=_0x3092de[_0xb036ae(0xed)],_0x43f6f2=Yup[_0xb036ae(0xf9)]()[_0xb036ae(0x106)]({'price':Yup[_0xb036ae(0x102)]()[_0xb036ae(0x11f)](),'users':Yup[_0xb036ae(0x102)]()[_0xb036ae(0x11f)](),'plan':Yup[_0xb036ae(0x102)]()[_0xb036ae(0x11f)]()});if(!await _0x43f6f2[_0xb036ae(0xf0)](_0x3092de[_0xb036ae(0x128)]))throw new AppError_1[(_0xb036ae(0x119))](_0xb036ae(0x12b),0x190);const _0x235fef=new Intl['NumberFormat']('en-US',{'style':_0xb036ae(0xfc),'currency':_0xb036ae(0x134)}),_0x57a9a6=await Company_1['default'][_0xb036ae(0x11a)]({'where':{'id':_0x4aa50f}}),_0x37a86c=await Plan_1['default'][_0xb036ae(0x11a)]({'where':{'id':_0x57a9a6[_0xb036ae(0xec)]}}),{invoiceId:_0x76b61}=_0x3092de[_0xb036ae(0x128)],_0x4145d2=_0x37a86c[_0xb036ae(0x103)],_0x35957b=_0x235fef[_0xb036ae(0x12e)](_0x4145d2)['replace']('$',''),_0x5ea785={'nome':_0x57a9a6[_0xb036ae(0x10f)]},_0x45ec5e=_0x57a9a6[_0xb036ae(0x121)]['replace'](/\D/g,'');_0x45ec5e['length']===0xb?_0x5ea785[_0xb036ae(0x12f)]=_0x45ec5e:_0x5ea785[_0xb036ae(0xff)]=_0x45ec5e;const _0x5af1b2={'calendario':{'expiracao':0xe10},'devedor':{..._0x5ea785},'valor':{'original':_0x35957b},'chave':process[_0xb036ae(0x10e)][_0xb036ae(0xfb)],'solicitacaoPagador':_0xb036ae(0x111)+_0x76b61};try{const _0x4c727b=await _0x20ddb5[_0xb036ae(0x117)](null,_0x5af1b2),_0x22276a=await _0x20ddb5['pixGenerateQRCode']({'id':_0x4c727b[_0xb036ae(0xe9)]['id']});if(!_0x57a9a6)throw new AppError_1[(_0xb036ae(0x119))](_0xb036ae(0x122),0x194);return _0x5c7e21[_0xb036ae(0x104)]({..._0x4c727b,'qrcode':_0x22276a});}catch(_0x453a8b){console[_0xb036ae(0x10d)](_0xb036ae(0xee),_0x453a8b);throw new AppError_1[(_0xb036ae(0x119))](_0xb036ae(0x12b),0x190);}};exports[a31_0xe332a6(0x129)]=createSubscription;const createWebhook=async(_0x1b2d63,_0x353568)=>{const _0x564ce6=a31_0xe332a6,_0x9cbcaf=Yup[_0x564ce6(0xf9)]()['shape']({'chave':Yup[_0x564ce6(0x102)]()[_0x564ce6(0x11f)](),'url':Yup[_0x564ce6(0x102)]()[_0x564ce6(0x11f)]()});if(!await _0x9cbcaf[_0x564ce6(0xf0)](_0x1b2d63[_0x564ce6(0x128)]))throw new AppError_1['default'](_0x564ce6(0x12b),0x190);const {chave:_0x4abc1d,url:_0x52103e}=_0x1b2d63['body'],_0x5d78cd={'webhookUrl':_0x52103e},_0x6cec1={'chave':_0x4abc1d};try{const _0x5df65b=new gn_api_sdk_typescript_1['default'](Gn_1[_0x564ce6(0x119)]),_0x11e78b=await _0x5df65b[_0x564ce6(0x101)](_0x6cec1,_0x5d78cd);return _0x353568[_0x564ce6(0x104)](_0x11e78b);}catch(_0x182e74){console['log'](_0x182e74);}};exports[a31_0xe332a6(0xf4)]=createWebhook;const deleteWebhook=async(_0x17ac4f,_0x341f82)=>{const _0x161409=a31_0xe332a6,_0x455512=Yup[_0x161409(0xf9)]()[_0x161409(0x106)]({'chave':Yup[_0x161409(0x102)]()[_0x161409(0x11f)]()});if(!await _0x455512[_0x161409(0xf0)](_0x17ac4f[_0x161409(0x128)]))throw new AppError_1[(_0x161409(0x119))](_0x161409(0x12b),0x190);const {chave:_0x4ec731}=_0x17ac4f[_0x161409(0x128)],_0x5825ac={'chave':_0x4ec731},_0x2a8298=new gn_api_sdk_typescript_1['default'](Gn_1[_0x161409(0x119)]),_0x132ef3=await _0x2a8298['pixDeleteWebhook'](_0x5825ac);return _0x341f82[_0x161409(0x104)](_0x132ef3);};exports[a31_0xe332a6(0xf2)]=deleteWebhook;const webhook=async(_0x49cde6,_0x27e420)=>{const _0x280e9f=a31_0xe332a6,{type:_0x293bd8}=_0x49cde6[_0x280e9f(0x127)],{evento:_0xfc0b4c}=_0x49cde6[_0x280e9f(0x128)];if(_0xfc0b4c===_0x280e9f(0xf7))return _0x27e420['json']({'ok':!![]});if(_0x49cde6['body'][_0x280e9f(0xf5)]){const _0xc109b6=new gn_api_sdk_typescript_1['default'](Gn_1[_0x280e9f(0x119)]);_0x49cde6[_0x280e9f(0x128)]['pix'][_0x280e9f(0x130)](async _0x3dd59b=>{const _0x2c00e0=_0x280e9f,_0x206d47=await _0xc109b6[_0x2c00e0(0x123)]({'txid':_0x3dd59b[_0x2c00e0(0x108)]});if(_0x206d47[_0x2c00e0(0x136)]===_0x2c00e0(0x10c)){const {solicitacaoPagador:_0x1c2b4a}=_0x206d47,_0x4f6ce6=_0x1c2b4a[_0x2c00e0(0xf8)](_0x2c00e0(0x111),''),_0x5f0c2d=await Invoices_1[_0x2c00e0(0x119)][_0x2c00e0(0x110)](_0x4f6ce6),_0x12e09e=_0x5f0c2d[_0x2c00e0(0xeb)],_0x14b04a=await Company_1[_0x2c00e0(0x119)][_0x2c00e0(0x110)](_0x12e09e),_0x333b43=new Date(_0x14b04a[_0x2c00e0(0x12d)]);_0x333b43['setDate'](_0x333b43[_0x2c00e0(0xef)]()+0x1e);const _0x3753b3=_0x333b43[_0x2c00e0(0x115)]()['split']('T')[0x0];if(_0x14b04a){await _0x14b04a[_0x2c00e0(0xf3)]({'dueDate':_0x3753b3});const _0x15f672=await _0x5f0c2d[_0x2c00e0(0xf3)]({'id':_0x4f6ce6,'status':'paid'});await _0x14b04a[_0x2c00e0(0x116)]();const _0x2030f5=(0x0,socket_1[_0x2c00e0(0x118)])(),_0xd36d83=await Company_1[_0x2c00e0(0x119)][_0x2c00e0(0x11a)]({'where':{'id':_0x12e09e}});_0x2030f5[_0x2c00e0(0xfe)]('company-'+_0x12e09e+'-payment',{'action':_0x206d47['status'],'company':_0xd36d83});}}});}return _0x27e420[_0x280e9f(0x104)]({'ok':!![]});};exports[a31_0xe332a6(0x112)]=webhook;