'use strict';const a32_0x59c407=a32_0x17b7;(function(_0x394b09,_0x519ae5){const _0x54d9e5=a32_0x17b7,_0x35192c=_0x394b09();while(!![]){try{const _0x1c265d=-parseInt(_0x54d9e5(0x1ee))/0x1*(parseInt(_0x54d9e5(0x1f2))/0x2)+parseInt(_0x54d9e5(0x210))/0x3*(parseInt(_0x54d9e5(0x1ef))/0x4)+parseInt(_0x54d9e5(0x224))/0x5+-parseInt(_0x54d9e5(0x1ff))/0x6*(parseInt(_0x54d9e5(0x21c))/0x7)+-parseInt(_0x54d9e5(0x1fe))/0x8+parseInt(_0x54d9e5(0x1ec))/0x9*(parseInt(_0x54d9e5(0x1e9))/0xa)+parseInt(_0x54d9e5(0x1f9))/0xb;if(_0x1c265d===_0x519ae5)break;else _0x35192c['push'](_0x35192c['shift']());}catch(_0x4b9f1f){_0x35192c['push'](_0x35192c['shift']());}}}(a32_0x5b95,0x875eb));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x1875cd,_0x58290e,_0x393cd,_0x1aafb2){const _0x459155=a32_0x17b7;if(_0x1aafb2===undefined)_0x1aafb2=_0x393cd;var _0x4ed7c2=Object[_0x459155(0x1dd)](_0x58290e,_0x393cd);(!_0x4ed7c2||(_0x459155(0x1df)in _0x4ed7c2?!_0x58290e['__esModule']:_0x4ed7c2[_0x459155(0x204)]||_0x4ed7c2[_0x459155(0x1f0)]))&&(_0x4ed7c2={'enumerable':!![],'get':function(){return _0x58290e[_0x393cd];}}),Object[_0x459155(0x207)](_0x1875cd,_0x1aafb2,_0x4ed7c2);}:function(_0x45f8ac,_0x181e5f,_0x5ba75c,_0x5819c2){if(_0x5819c2===undefined)_0x5819c2=_0x5ba75c;_0x45f8ac[_0x5819c2]=_0x181e5f[_0x5ba75c];}),__setModuleDefault=this&&this[a32_0x59c407(0x21b)]||(Object[a32_0x59c407(0x1ea)]?function(_0x19f68e,_0x37558f){const _0x4a4f58=a32_0x59c407;Object[_0x4a4f58(0x207)](_0x19f68e,_0x4a4f58(0x206),{'enumerable':!![],'value':_0x37558f});}:function(_0x52f925,_0x14b0ac){const _0x5d5969=a32_0x59c407;_0x52f925[_0x5d5969(0x206)]=_0x14b0ac;}),__importStar=this&&this['__importStar']||function(_0x554c45){const _0x22ff6e=a32_0x59c407;if(_0x554c45&&_0x554c45['__esModule'])return _0x554c45;var _0x36df3c={};if(_0x554c45!=null){for(var _0xbf3e0e in _0x554c45)if(_0xbf3e0e!==_0x22ff6e(0x206)&&Object['prototype'][_0x22ff6e(0x201)][_0x22ff6e(0x216)](_0x554c45,_0xbf3e0e))__createBinding(_0x36df3c,_0x554c45,_0xbf3e0e);}return __setModuleDefault(_0x36df3c,_0x554c45),_0x36df3c;},__importDefault=this&&this[a32_0x59c407(0x1e3)]||function(_0x20c28c){const _0x387b48=a32_0x59c407;return _0x20c28c&&_0x20c28c[_0x387b48(0x20b)]?_0x20c28c:{'default':_0x20c28c};};function a32_0x17b7(_0x20ece2,_0x4d5d34){const _0x5b953e=a32_0x5b95();return a32_0x17b7=function(_0x17b702,_0x227b9e){_0x17b702=_0x17b702-0x1dc;let _0x10be34=_0x5b953e[_0x17b702];return _0x10be34;},a32_0x17b7(_0x20ece2,_0x4d5d34);}Object['defineProperty'](exports,a32_0x59c407(0x20b),{'value':!![]}),exports[a32_0x59c407(0x20d)]=exports[a32_0x59c407(0x1f4)]=exports['createWebhook']=exports[a32_0x59c407(0x219)]=exports[a32_0x59c407(0x1fb)]=void 0x0;const Yup=__importStar(require('yup')),gn_api_sdk_typescript_1=__importDefault(require('gn-api-sdk-typescript')),AppError_1=__importDefault(require(a32_0x59c407(0x1f8))),Gn_1=__importDefault(require('../config/Gn')),Company_1=__importDefault(require(a32_0x59c407(0x212))),Invoices_1=__importDefault(require('../models/Invoices')),socket_1=require(a32_0x59c407(0x223)),Plan_1=__importDefault(require(a32_0x59c407(0x226))),index=async(_0x494a49,_0x1c9567)=>{const _0x5b9b23=a32_0x59c407,_0x6ca916=new gn_api_sdk_typescript_1[(_0x5b9b23(0x206))](Gn_1[_0x5b9b23(0x206)]);return _0x1c9567[_0x5b9b23(0x1de)](_0x6ca916[_0x5b9b23(0x1e2)]());};exports['index']=index;const createSubscription=async(_0x5631d0,_0x313fad)=>{const _0x2464e4=a32_0x59c407,_0x56b25f=new gn_api_sdk_typescript_1[(_0x2464e4(0x206))](Gn_1[_0x2464e4(0x206)]),{companyId:_0xb2d04d}=_0x5631d0[_0x2464e4(0x1dc)],_0x3361e7=Yup['object']()[_0x2464e4(0x1e6)]({'price':Yup['string']()[_0x2464e4(0x21e)](),'users':Yup[_0x2464e4(0x1f5)]()[_0x2464e4(0x21e)](),'plan':Yup[_0x2464e4(0x1f5)]()[_0x2464e4(0x21e)]()});if(!await _0x3361e7['isValid'](_0x5631d0['body']))throw new AppError_1[(_0x2464e4(0x206))]('Validation\x20fails',0x190);const _0x4415ae=new Intl[(_0x2464e4(0x228))](_0x2464e4(0x220),{'style':'currency','currency':'USD'}),_0x4a397d=await Company_1[_0x2464e4(0x206)]['findOne']({'where':{'id':_0xb2d04d}}),_0x311463=await Plan_1[_0x2464e4(0x206)][_0x2464e4(0x1e0)]({'where':{'id':_0x4a397d['planId']}}),{invoiceId:_0x10c8ca}=_0x5631d0[_0x2464e4(0x1e1)],_0x109284=_0x311463['amount'],_0x5cf895=_0x4415ae[_0x2464e4(0x215)](_0x109284)[_0x2464e4(0x203)]('$',''),_0x28bf94={'nome':_0x4a397d[_0x2464e4(0x1e4)]},_0x41e8de=_0x4a397d['document'][_0x2464e4(0x203)](/\D/g,'');_0x41e8de['length']===0xb?_0x28bf94[_0x2464e4(0x211)]=_0x41e8de:_0x28bf94['cnpj']=_0x41e8de;const _0x43fb3c={'calendario':{'expiracao':0xe10},'devedor':{..._0x28bf94},'valor':{'original':_0x5cf895},'chave':process[_0x2464e4(0x1e8)][_0x2464e4(0x1f3)],'solicitacaoPagador':_0x2464e4(0x227)+_0x10c8ca};try{const _0x3301f4=await _0x56b25f[_0x2464e4(0x229)](null,_0x43fb3c),_0x4bfc03=await _0x56b25f['pixGenerateQRCode']({'id':_0x3301f4[_0x2464e4(0x21f)]['id']});if(!_0x4a397d)throw new AppError_1[(_0x2464e4(0x206))](_0x2464e4(0x213),0x194);return _0x313fad[_0x2464e4(0x1de)]({..._0x3301f4,'qrcode':_0x4bfc03});}catch(_0x649be2){console['log']('error_subscription',_0x649be2);throw new AppError_1['default'](_0x2464e4(0x1f1),0x190);}};exports['createSubscription']=createSubscription;const createWebhook=async(_0x192a82,_0x58c439)=>{const _0x327250=a32_0x59c407,_0x7eda1c=Yup[_0x327250(0x20e)]()['shape']({'chave':Yup[_0x327250(0x1f5)]()[_0x327250(0x21e)](),'url':Yup[_0x327250(0x1f5)]()[_0x327250(0x21e)]()});if(!await _0x7eda1c[_0x327250(0x205)](_0x192a82['body']))throw new AppError_1[(_0x327250(0x206))]('Validation\x20fails',0x190);const {chave:_0x504792,url:_0x3c4e8c}=_0x192a82[_0x327250(0x1e1)],_0x33b90f={'webhookUrl':_0x3c4e8c},_0x3d803e={'chave':_0x504792};try{const _0x2c95e4=new gn_api_sdk_typescript_1[(_0x327250(0x206))](Gn_1[_0x327250(0x206)]),_0x30db5c=await _0x2c95e4[_0x327250(0x221)](_0x3d803e,_0x33b90f);return _0x58c439[_0x327250(0x1de)](_0x30db5c);}catch(_0x530ec0){console[_0x327250(0x1e7)](_0x530ec0);}};function a32_0x5b95(){const _0x58e629=['create','toISOString','171GrimuE','companyId','3159GKhbBI','547368RzrovH','configurable','Validation\x20fails','666CpRvJx','GERENCIANET_CHAVEPIX','deleteWebhook','string','paid','getIO','../errors/AppError','16568816UhiDPL','status','index','update','reload','5343944yRYMSJ','132BfuQSL','teste_webhook','hasOwnProperty','-payment','replace','writable','isValid','default','defineProperty','findByPk','company-','emit','__esModule','createWebhook','webhook','object','pix','6QKAkSw','cpf','../models/Company','Company\x20not\x20found','split','format','call','getDate','pixDeleteWebhook','createSubscription','forEach','__setModuleDefault','59346xpLgIk','setDate','required','loc','en-US','pixConfigWebhook','pixDetailCharge','../libs/socket','661640ZueHKj','txid','../models/Plan','#Fatura:','NumberFormat','pixCreateImmediateCharge','params','user','getOwnPropertyDescriptor','json','get','findOne','body','getSubscriptions','__importDefault','name','dueDate','shape','log','env','288770iyeiFk'];a32_0x5b95=function(){return _0x58e629;};return a32_0x5b95();}exports[a32_0x59c407(0x20c)]=createWebhook;const deleteWebhook=async(_0x365a4c,_0x567961)=>{const _0x6ed81c=a32_0x59c407,_0x2b85cf=Yup['object']()['shape']({'chave':Yup[_0x6ed81c(0x1f5)]()['required']()});if(!await _0x2b85cf[_0x6ed81c(0x205)](_0x365a4c[_0x6ed81c(0x1e1)]))throw new AppError_1[(_0x6ed81c(0x206))](_0x6ed81c(0x1f1),0x190);const {chave:_0x282249}=_0x365a4c['body'],_0x52e299={'chave':_0x282249},_0x214ee8=new gn_api_sdk_typescript_1[(_0x6ed81c(0x206))](Gn_1[_0x6ed81c(0x206)]),_0x13b973=await _0x214ee8[_0x6ed81c(0x218)](_0x52e299);return _0x567961[_0x6ed81c(0x1de)](_0x13b973);};exports['deleteWebhook']=deleteWebhook;const webhook=async(_0x563f6f,_0xe70020)=>{const _0x28ee8e=a32_0x59c407,{type:_0x18bcdb}=_0x563f6f[_0x28ee8e(0x22a)],{evento:_0x3a18fc}=_0x563f6f[_0x28ee8e(0x1e1)];if(_0x3a18fc===_0x28ee8e(0x200))return _0xe70020[_0x28ee8e(0x1de)]({'ok':!![]});if(_0x563f6f[_0x28ee8e(0x1e1)]['pix']){const _0x339251=new gn_api_sdk_typescript_1['default'](Gn_1[_0x28ee8e(0x206)]);_0x563f6f[_0x28ee8e(0x1e1)][_0x28ee8e(0x20f)][_0x28ee8e(0x21a)](async _0x1f6c9d=>{const _0xf72172=_0x28ee8e,_0x1304c4=await _0x339251[_0xf72172(0x222)]({'txid':_0x1f6c9d[_0xf72172(0x225)]});if(_0x1304c4[_0xf72172(0x1fa)]==='CONCLUIDA'){const {solicitacaoPagador:_0x152f75}=_0x1304c4,_0xd4a52c=_0x152f75[_0xf72172(0x203)](_0xf72172(0x227),''),_0x2eacd9=await Invoices_1['default'][_0xf72172(0x208)](_0xd4a52c),_0x185ed7=_0x2eacd9[_0xf72172(0x1ed)],_0x11e44e=await Company_1[_0xf72172(0x206)][_0xf72172(0x208)](_0x185ed7),_0x4ce4da=new Date(_0x11e44e[_0xf72172(0x1e5)]);_0x4ce4da[_0xf72172(0x21d)](_0x4ce4da[_0xf72172(0x217)]()+0x1e);const _0x97ce7c=_0x4ce4da[_0xf72172(0x1eb)]()[_0xf72172(0x214)]('T')[0x0];if(_0x11e44e){await _0x11e44e[_0xf72172(0x1fc)]({'dueDate':_0x97ce7c});const _0x127a9a=await _0x2eacd9['update']({'id':_0xd4a52c,'status':_0xf72172(0x1f6)});await _0x11e44e[_0xf72172(0x1fd)]();const _0x557bfc=(0x0,socket_1[_0xf72172(0x1f7)])(),_0x59552a=await Company_1[_0xf72172(0x206)][_0xf72172(0x1e0)]({'where':{'id':_0x185ed7}});_0x557bfc[_0xf72172(0x20a)](_0xf72172(0x209)+_0x185ed7+_0xf72172(0x202),{'action':_0x1304c4[_0xf72172(0x1fa)],'company':_0x59552a});}}});}return _0xe70020[_0x28ee8e(0x1de)]({'ok':!![]});};exports[a32_0x59c407(0x20d)]=webhook;