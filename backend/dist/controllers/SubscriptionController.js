'use strict';function a32_0x57e9(){const _0x5a8407=['4mSyhEY','amount','cnpj','pixDeleteWebhook','../libs/socket','__setModuleDefault','CONCLUIDA','params','cpf','54vufVWT','call','setDate','split','3846100eczosO','-payment','__importDefault','required','user','findOne','findByPk','env','document','update','69785kjhOju','en-US','dueDate','teste_webhook','isValid','2nUDtBl','__importStar','__esModule','createWebhook','get','707kuWYKJ','pixDetailCharge','defineProperty','../models/Plan','yup','string','log','companyId','USD','txid','Validation\x20fails','../errors/AppError','#Fatura:','shape','1521609osBhJW','company-','length','emit','getOwnPropertyDescriptor','pixCreateImmediateCharge','createSubscription','replace','default','../config/Gn','2371455pGNqWu','index','json','44QQbHOi','loc','505211yhcclS','__createBinding','writable','format','2226396qsIyKO','currency','getDate','object','../models/Company','create','pixGenerateQRCode','35864fiWqNj','pixConfigWebhook','body','pix','name','GERENCIANET_CHAVEPIX'];a32_0x57e9=function(){return _0x5a8407;};return a32_0x57e9();}const a32_0x1cb9df=a32_0x2857;(function(_0x340a79,_0x4caa47){const _0xd07d4f=a32_0x2857,_0x17b36d=_0x340a79();while(!![]){try{const _0xb3ace7=parseInt(_0xd07d4f(0x17d))/0x1*(parseInt(_0xd07d4f(0x15b))/0x2)+-parseInt(_0xd07d4f(0x16e))/0x3*(parseInt(_0xd07d4f(0x13f))/0x4)+parseInt(_0xd07d4f(0x156))/0x5*(-parseInt(_0xd07d4f(0x148))/0x6)+-parseInt(_0xd07d4f(0x160))/0x7*(parseInt(_0xd07d4f(0x188))/0x8)+-parseInt(_0xd07d4f(0x178))/0x9+parseInt(_0xd07d4f(0x14c))/0xa+-parseInt(_0xd07d4f(0x17b))/0xb*(-parseInt(_0xd07d4f(0x181))/0xc);if(_0xb3ace7===_0x4caa47)break;else _0x17b36d['push'](_0x17b36d['shift']());}catch(_0x29164a){_0x17b36d['push'](_0x17b36d['shift']());}}}(a32_0x57e9,0x450eb));var __createBinding=this&&this[a32_0x1cb9df(0x17e)]||(Object[a32_0x1cb9df(0x186)]?function(_0x5d30f0,_0x1495e8,_0x5f13c2,_0x508788){const _0x10dcef=a32_0x1cb9df;if(_0x508788===undefined)_0x508788=_0x5f13c2;var _0x5b7261=Object[_0x10dcef(0x172)](_0x1495e8,_0x5f13c2);(!_0x5b7261||(_0x10dcef(0x15f)in _0x5b7261?!_0x1495e8[_0x10dcef(0x15d)]:_0x5b7261[_0x10dcef(0x17f)]||_0x5b7261['configurable']))&&(_0x5b7261={'enumerable':!![],'get':function(){return _0x1495e8[_0x5f13c2];}}),Object[_0x10dcef(0x162)](_0x5d30f0,_0x508788,_0x5b7261);}:function(_0xb31db3,_0x421387,_0x193a3a,_0x752817){if(_0x752817===undefined)_0x752817=_0x193a3a;_0xb31db3[_0x752817]=_0x421387[_0x193a3a];}),__setModuleDefault=this&&this[a32_0x1cb9df(0x144)]||(Object[a32_0x1cb9df(0x186)]?function(_0x994c0c,_0x3f2ac8){const _0x13c96e=a32_0x1cb9df;Object['defineProperty'](_0x994c0c,_0x13c96e(0x176),{'enumerable':!![],'value':_0x3f2ac8});}:function(_0x598a40,_0x182727){const _0x454181=a32_0x1cb9df;_0x598a40[_0x454181(0x176)]=_0x182727;}),__importStar=this&&this[a32_0x1cb9df(0x15c)]||function(_0x550008){const _0x679f5a=a32_0x1cb9df;if(_0x550008&&_0x550008[_0x679f5a(0x15d)])return _0x550008;var _0x3a515c={};if(_0x550008!=null){for(var _0x524bb0 in _0x550008)if(_0x524bb0!=='default'&&Object['prototype']['hasOwnProperty'][_0x679f5a(0x149)](_0x550008,_0x524bb0))__createBinding(_0x3a515c,_0x550008,_0x524bb0);}return __setModuleDefault(_0x3a515c,_0x550008),_0x3a515c;},__importDefault=this&&this[a32_0x1cb9df(0x14e)]||function(_0x4ddb5f){const _0x2a054c=a32_0x1cb9df;return _0x4ddb5f&&_0x4ddb5f[_0x2a054c(0x15d)]?_0x4ddb5f:{'default':_0x4ddb5f};};Object[a32_0x1cb9df(0x162)](exports,'__esModule',{'value':!![]}),exports['webhook']=exports['deleteWebhook']=exports['createWebhook']=exports[a32_0x1cb9df(0x174)]=exports[a32_0x1cb9df(0x179)]=void 0x0;const Yup=__importStar(require(a32_0x1cb9df(0x164))),gn_api_sdk_typescript_1=__importDefault(require('gn-api-sdk-typescript')),AppError_1=__importDefault(require(a32_0x1cb9df(0x16b))),Gn_1=__importDefault(require(a32_0x1cb9df(0x177))),Company_1=__importDefault(require(a32_0x1cb9df(0x185))),Invoices_1=__importDefault(require('../models/Invoices')),socket_1=require(a32_0x1cb9df(0x143)),Plan_1=__importDefault(require(a32_0x1cb9df(0x163))),index=async(_0x564018,_0x2dccf6)=>{const _0x3dbb1e=a32_0x1cb9df,_0x2401ce=new gn_api_sdk_typescript_1[(_0x3dbb1e(0x176))](Gn_1['default']);return _0x2dccf6[_0x3dbb1e(0x17a)](_0x2401ce['getSubscriptions']());};exports[a32_0x1cb9df(0x179)]=index;const createSubscription=async(_0xf4fc31,_0x18b96e)=>{const _0x19ccd0=a32_0x1cb9df,_0x5ed298=new gn_api_sdk_typescript_1[(_0x19ccd0(0x176))](Gn_1['default']),{companyId:_0x208ed0}=_0xf4fc31[_0x19ccd0(0x150)],_0x29964b=Yup[_0x19ccd0(0x184)]()[_0x19ccd0(0x16d)]({'price':Yup[_0x19ccd0(0x165)]()[_0x19ccd0(0x14f)](),'users':Yup[_0x19ccd0(0x165)]()[_0x19ccd0(0x14f)](),'plan':Yup[_0x19ccd0(0x165)]()[_0x19ccd0(0x14f)]()});if(!await _0x29964b['isValid'](_0xf4fc31[_0x19ccd0(0x18a)]))throw new AppError_1['default'](_0x19ccd0(0x16a),0x190);const _0x281707=new Intl['NumberFormat'](_0x19ccd0(0x157),{'style':_0x19ccd0(0x182),'currency':_0x19ccd0(0x168)}),_0x206951=await Company_1[_0x19ccd0(0x176)][_0x19ccd0(0x151)]({'where':{'id':_0x208ed0}}),_0x32f107=await Plan_1[_0x19ccd0(0x176)]['findOne']({'where':{'id':_0x206951['planId']}}),{invoiceId:_0x5cc899}=_0xf4fc31['body'],_0x564905=_0x32f107[_0x19ccd0(0x140)],_0x1d83d0=_0x281707[_0x19ccd0(0x180)](_0x564905)[_0x19ccd0(0x175)]('$',''),_0x5313ac={'nome':_0x206951[_0x19ccd0(0x18c)]},_0x3e3d65=_0x206951[_0x19ccd0(0x154)][_0x19ccd0(0x175)](/\D/g,'');_0x3e3d65[_0x19ccd0(0x170)]===0xb?_0x5313ac[_0x19ccd0(0x147)]=_0x3e3d65:_0x5313ac[_0x19ccd0(0x141)]=_0x3e3d65;const _0x3f18e5={'calendario':{'expiracao':0xe10},'devedor':{..._0x5313ac},'valor':{'original':_0x1d83d0},'chave':process[_0x19ccd0(0x153)][_0x19ccd0(0x13e)],'solicitacaoPagador':_0x19ccd0(0x16c)+_0x5cc899};try{const _0x20eca4=await _0x5ed298[_0x19ccd0(0x173)](null,_0x3f18e5),_0x301278=await _0x5ed298[_0x19ccd0(0x187)]({'id':_0x20eca4[_0x19ccd0(0x17c)]['id']});if(!_0x206951)throw new AppError_1['default']('Company\x20not\x20found',0x194);return _0x18b96e[_0x19ccd0(0x17a)]({..._0x20eca4,'qrcode':_0x301278});}catch(_0x28f981){console[_0x19ccd0(0x166)]('error_subscription',_0x28f981);throw new AppError_1[(_0x19ccd0(0x176))]('Validation\x20fails',0x190);}};exports[a32_0x1cb9df(0x174)]=createSubscription;const createWebhook=async(_0x181f0c,_0x54337d)=>{const _0x2b6b41=a32_0x1cb9df,_0x1ca028=Yup[_0x2b6b41(0x184)]()['shape']({'chave':Yup[_0x2b6b41(0x165)]()[_0x2b6b41(0x14f)](),'url':Yup[_0x2b6b41(0x165)]()[_0x2b6b41(0x14f)]()});if(!await _0x1ca028[_0x2b6b41(0x15a)](_0x181f0c[_0x2b6b41(0x18a)]))throw new AppError_1[(_0x2b6b41(0x176))](_0x2b6b41(0x16a),0x190);const {chave:_0x2cb266,url:_0x574fed}=_0x181f0c['body'],_0x5b07b3={'webhookUrl':_0x574fed},_0x2925b4={'chave':_0x2cb266};try{const _0x5dc8bc=new gn_api_sdk_typescript_1[(_0x2b6b41(0x176))](Gn_1[_0x2b6b41(0x176)]),_0xf7b997=await _0x5dc8bc[_0x2b6b41(0x189)](_0x2925b4,_0x5b07b3);return _0x54337d['json'](_0xf7b997);}catch(_0x4af996){console[_0x2b6b41(0x166)](_0x4af996);}};exports[a32_0x1cb9df(0x15e)]=createWebhook;const deleteWebhook=async(_0x2ad1d6,_0xb102fd)=>{const _0x23c047=a32_0x1cb9df,_0x5cb8b3=Yup[_0x23c047(0x184)]()['shape']({'chave':Yup[_0x23c047(0x165)]()[_0x23c047(0x14f)]()});if(!await _0x5cb8b3[_0x23c047(0x15a)](_0x2ad1d6[_0x23c047(0x18a)]))throw new AppError_1[(_0x23c047(0x176))]('Validation\x20fails',0x190);const {chave:_0x1141bd}=_0x2ad1d6[_0x23c047(0x18a)],_0x4fca5a={'chave':_0x1141bd},_0x4f4a24=new gn_api_sdk_typescript_1['default'](Gn_1[_0x23c047(0x176)]),_0x23625b=await _0x4f4a24[_0x23c047(0x142)](_0x4fca5a);return _0xb102fd[_0x23c047(0x17a)](_0x23625b);};exports['deleteWebhook']=deleteWebhook;const webhook=async(_0x2e8da6,_0x165baa)=>{const _0x3a6264=a32_0x1cb9df,{type:_0x3633c6}=_0x2e8da6[_0x3a6264(0x146)],{evento:_0x3ae277}=_0x2e8da6[_0x3a6264(0x18a)];if(_0x3ae277===_0x3a6264(0x159))return _0x165baa[_0x3a6264(0x17a)]({'ok':!![]});if(_0x2e8da6['body'][_0x3a6264(0x18b)]){const _0x31adb8=new gn_api_sdk_typescript_1[(_0x3a6264(0x176))](Gn_1[_0x3a6264(0x176)]);_0x2e8da6[_0x3a6264(0x18a)][_0x3a6264(0x18b)]['forEach'](async _0x135c9d=>{const _0x4c51d9=_0x3a6264,_0x5879fe=await _0x31adb8[_0x4c51d9(0x161)]({'txid':_0x135c9d[_0x4c51d9(0x169)]});if(_0x5879fe['status']===_0x4c51d9(0x145)){const {solicitacaoPagador:_0x551d9a}=_0x5879fe,_0x30ae8f=_0x551d9a[_0x4c51d9(0x175)](_0x4c51d9(0x16c),''),_0x4cf081=await Invoices_1['default'][_0x4c51d9(0x152)](_0x30ae8f),_0x4e77dc=_0x4cf081[_0x4c51d9(0x167)],_0x91176b=await Company_1['default'][_0x4c51d9(0x152)](_0x4e77dc),_0x395736=new Date(_0x91176b[_0x4c51d9(0x158)]);_0x395736[_0x4c51d9(0x14a)](_0x395736[_0x4c51d9(0x183)]()+0x1e);const _0x1ac0c4=_0x395736['toISOString']()[_0x4c51d9(0x14b)]('T')[0x0];if(_0x91176b){await _0x91176b['update']({'dueDate':_0x1ac0c4});const _0x276cc6=await _0x4cf081[_0x4c51d9(0x155)]({'id':_0x30ae8f,'status':'paid'});await _0x91176b['reload']();const _0x5f0f6b=(0x0,socket_1['getIO'])(),_0x3555a8=await Company_1[_0x4c51d9(0x176)][_0x4c51d9(0x151)]({'where':{'id':_0x4e77dc}});_0x5f0f6b[_0x4c51d9(0x171)](_0x4c51d9(0x16f)+_0x4e77dc+_0x4c51d9(0x14d),{'action':_0x5879fe['status'],'company':_0x3555a8});}}});}return _0x165baa['json']({'ok':!![]});};function a32_0x2857(_0x171737,_0x6bdc5a){const _0x57e94d=a32_0x57e9();return a32_0x2857=function(_0x285776,_0x25275c){_0x285776=_0x285776-0x13e;let _0x3c37f3=_0x57e94d[_0x285776];return _0x3c37f3;},a32_0x2857(_0x171737,_0x6bdc5a);}exports['webhook']=webhook;