'use strict';const a34_0x291bd3=a34_0x1678;(function(_0x3e980a,_0x182a67){const _0x3a391c=a34_0x1678,_0x1c1cc3=_0x3e980a();while(!![]){try{const _0x11f5a9=-parseInt(_0x3a391c(0xf0))/0x1*(-parseInt(_0x3a391c(0xe7))/0x2)+parseInt(_0x3a391c(0xd6))/0x3*(parseInt(_0x3a391c(0x11b))/0x4)+parseInt(_0x3a391c(0x101))/0x5*(parseInt(_0x3a391c(0xe4))/0x6)+-parseInt(_0x3a391c(0xd7))/0x7+-parseInt(_0x3a391c(0xf4))/0x8*(parseInt(_0x3a391c(0x107))/0x9)+-parseInt(_0x3a391c(0xde))/0xa+-parseInt(_0x3a391c(0x106))/0xb*(parseInt(_0x3a391c(0xf3))/0xc);if(_0x11f5a9===_0x182a67)break;else _0x1c1cc3['push'](_0x1c1cc3['shift']());}catch(_0x47644f){_0x1c1cc3['push'](_0x1c1cc3['shift']());}}}(a34_0x1d3d,0x6781c));var __createBinding=this&&this[a34_0x291bd3(0xeb)]||(Object[a34_0x291bd3(0x116)]?function(_0x5e1c9f,_0x14a59c,_0x1f1515,_0x4b9dc8){const _0xc00eab=a34_0x291bd3;if(_0x4b9dc8===undefined)_0x4b9dc8=_0x1f1515;var _0x4111dd=Object['getOwnPropertyDescriptor'](_0x14a59c,_0x1f1515);(!_0x4111dd||(_0xc00eab(0x11e)in _0x4111dd?!_0x14a59c[_0xc00eab(0x122)]:_0x4111dd[_0xc00eab(0x10e)]||_0x4111dd[_0xc00eab(0xe3)]))&&(_0x4111dd={'enumerable':!![],'get':function(){return _0x14a59c[_0x1f1515];}}),Object[_0xc00eab(0xfb)](_0x5e1c9f,_0x4b9dc8,_0x4111dd);}:function(_0x34db32,_0x5a74af,_0x509490,_0x1cf2db){if(_0x1cf2db===undefined)_0x1cf2db=_0x509490;_0x34db32[_0x1cf2db]=_0x5a74af[_0x509490];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0xb85cb,_0x19e079){const _0x1db46a=a34_0x291bd3;Object[_0x1db46a(0xfb)](_0xb85cb,_0x1db46a(0x119),{'enumerable':!![],'value':_0x19e079});}:function(_0x59c1c5,_0x69a93b){_0x59c1c5['default']=_0x69a93b;}),__importStar=this&&this['__importStar']||function(_0x1ee43a){const _0x2bd454=a34_0x291bd3;if(_0x1ee43a&&_0x1ee43a[_0x2bd454(0x122)])return _0x1ee43a;var _0x54c98a={};if(_0x1ee43a!=null){for(var _0x4bea80 in _0x1ee43a)if(_0x4bea80!==_0x2bd454(0x119)&&Object['prototype'][_0x2bd454(0xe9)][_0x2bd454(0xf6)](_0x1ee43a,_0x4bea80))__createBinding(_0x54c98a,_0x1ee43a,_0x4bea80);}return __setModuleDefault(_0x54c98a,_0x1ee43a),_0x54c98a;},__importDefault=this&&this[a34_0x291bd3(0xf8)]||function(_0x432f1f){const _0x29c783=a34_0x291bd3;return _0x432f1f&&_0x432f1f[_0x29c783(0x122)]?_0x432f1f:{'default':_0x432f1f};};Object['defineProperty'](exports,a34_0x291bd3(0x122),{'value':!![]}),exports['webhook']=exports[a34_0x291bd3(0xf7)]=exports[a34_0x291bd3(0xd9)]=exports[a34_0x291bd3(0x12a)]=exports[a34_0x291bd3(0xd8)]=void 0x0;function a34_0x1d3d(){const _0x37831d=['currency','NumberFormat','../models/Invoices','34370szgWPz','update','cnpj','pix','body','4135703RLtxfv','23985GbsjgR','findByPk','shape','en-US','teste_webhook','getIO','required','writable','../errors/AppError','pixDetailCharge','replace','json','webhook','../libs/socket','Validation\x20fails','create','USD','Company\x20not\x20found','default','reload','2907664xfQCpU','../models/Company','findOne','get','company-','pixCreateImmediateCharge','log','__esModule','CONCLUIDA','forEach','params','planId','dueDate','error_subscription','-payment','createSubscription','companyId','3KNULQb','139475dvReZP','index','createWebhook','toISOString','length','emit','user','3618290rmnYsS','name','#Fatura:','document','../models/Plan','configurable','516CBvdwt','GERENCIANET_CHAVEPIX','status','2VlgqYk','../config/Gn','hasOwnProperty','pixConfigWebhook','__createBinding','getDate','string','split','yup','50161FpQfyl','loc','paid','12ugtvcA','560uFxjbB','object','call','deleteWebhook','__importDefault','setDate','gn-api-sdk-typescript','defineProperty','isValid','txid'];a34_0x1d3d=function(){return _0x37831d;};return a34_0x1d3d();}const Yup=__importStar(require(a34_0x291bd3(0xef))),gn_api_sdk_typescript_1=__importDefault(require(a34_0x291bd3(0xfa))),AppError_1=__importDefault(require(a34_0x291bd3(0x10f))),Gn_1=__importDefault(require(a34_0x291bd3(0xe8))),Company_1=__importDefault(require(a34_0x291bd3(0x11c))),Invoices_1=__importDefault(require(a34_0x291bd3(0x100))),socket_1=require(a34_0x291bd3(0x114)),Plan_1=__importDefault(require(a34_0x291bd3(0xe2))),index=async(_0x4ee000,_0x281922)=>{const _0x1a3c10=a34_0x291bd3,_0x3dd3d2=new gn_api_sdk_typescript_1['default'](Gn_1[_0x1a3c10(0x119)]);return _0x281922[_0x1a3c10(0x112)](_0x3dd3d2['getSubscriptions']());};exports[a34_0x291bd3(0xd8)]=index;function a34_0x1678(_0x46ce48,_0x5cdb5c){const _0x1d3dc=a34_0x1d3d();return a34_0x1678=function(_0x1678f1,_0x29d890){_0x1678f1=_0x1678f1-0xd6;let _0x11841d=_0x1d3dc[_0x1678f1];return _0x11841d;},a34_0x1678(_0x46ce48,_0x5cdb5c);}const createSubscription=async(_0x47850f,_0x2bd3c7)=>{const _0x36afe1=a34_0x291bd3,_0x32ba67=new gn_api_sdk_typescript_1['default'](Gn_1[_0x36afe1(0x119)]),{companyId:_0x3ba521}=_0x47850f[_0x36afe1(0xdd)],_0x2c342a=Yup[_0x36afe1(0xf5)]()[_0x36afe1(0x109)]({'price':Yup[_0x36afe1(0xed)]()[_0x36afe1(0x10d)](),'users':Yup[_0x36afe1(0xed)]()[_0x36afe1(0x10d)](),'plan':Yup[_0x36afe1(0xed)]()[_0x36afe1(0x10d)]()});if(!await _0x2c342a[_0x36afe1(0xfc)](_0x47850f[_0x36afe1(0x105)]))throw new AppError_1[(_0x36afe1(0x119))]('Validation\x20fails',0x190);const _0x2a3a2b=new Intl[(_0x36afe1(0xff))](_0x36afe1(0x10a),{'style':_0x36afe1(0xfe),'currency':_0x36afe1(0x117)}),_0x30112b=await Company_1[_0x36afe1(0x119)][_0x36afe1(0x11d)]({'where':{'id':_0x3ba521}}),_0x43ffcd=await Plan_1['default']['findOne']({'where':{'id':_0x30112b[_0x36afe1(0x126)]}}),{invoiceId:_0x58ca6c}=_0x47850f[_0x36afe1(0x105)],_0x3d98aa=_0x43ffcd['amount'],_0x3ee3a9=_0x2a3a2b['format'](_0x3d98aa)[_0x36afe1(0x111)]('$',''),_0x63b836={'nome':_0x30112b[_0x36afe1(0xdf)]},_0x105b03=_0x30112b[_0x36afe1(0xe1)]['replace'](/\D/g,'');_0x105b03[_0x36afe1(0xdb)]===0xb?_0x63b836['cpf']=_0x105b03:_0x63b836[_0x36afe1(0x103)]=_0x105b03;const _0x381e08={'calendario':{'expiracao':0xe10},'devedor':{..._0x63b836},'valor':{'original':_0x3ee3a9},'chave':process['env'][_0x36afe1(0xe5)],'solicitacaoPagador':_0x36afe1(0xe0)+_0x58ca6c};try{const _0x4f444f=await _0x32ba67[_0x36afe1(0x120)](null,_0x381e08),_0x376878=await _0x32ba67['pixGenerateQRCode']({'id':_0x4f444f[_0x36afe1(0xf1)]['id']});if(!_0x30112b)throw new AppError_1[(_0x36afe1(0x119))](_0x36afe1(0x118),0x194);return _0x2bd3c7[_0x36afe1(0x112)]({..._0x4f444f,'qrcode':_0x376878});}catch(_0xad7d0b){console[_0x36afe1(0x121)](_0x36afe1(0x128),_0xad7d0b);throw new AppError_1[(_0x36afe1(0x119))](_0x36afe1(0x115),0x190);}};exports['createSubscription']=createSubscription;const createWebhook=async(_0x406845,_0x503825)=>{const _0x270c98=a34_0x291bd3,_0x4b3dbf=Yup[_0x270c98(0xf5)]()[_0x270c98(0x109)]({'chave':Yup[_0x270c98(0xed)]()[_0x270c98(0x10d)](),'url':Yup['string']()[_0x270c98(0x10d)]()});if(!await _0x4b3dbf[_0x270c98(0xfc)](_0x406845['body']))throw new AppError_1['default'](_0x270c98(0x115),0x190);const {chave:_0x26a782,url:_0x1b8381}=_0x406845[_0x270c98(0x105)],_0x365e04={'webhookUrl':_0x1b8381},_0x31076d={'chave':_0x26a782};try{const _0x160a51=new gn_api_sdk_typescript_1[(_0x270c98(0x119))](Gn_1[_0x270c98(0x119)]),_0x3bd64e=await _0x160a51[_0x270c98(0xea)](_0x31076d,_0x365e04);return _0x503825[_0x270c98(0x112)](_0x3bd64e);}catch(_0x19783b){console[_0x270c98(0x121)](_0x19783b);}};exports[a34_0x291bd3(0xd9)]=createWebhook;const deleteWebhook=async(_0x3e4d08,_0xb99f98)=>{const _0x397758=a34_0x291bd3,_0xb6c69=Yup[_0x397758(0xf5)]()[_0x397758(0x109)]({'chave':Yup[_0x397758(0xed)]()['required']()});if(!await _0xb6c69[_0x397758(0xfc)](_0x3e4d08[_0x397758(0x105)]))throw new AppError_1[(_0x397758(0x119))](_0x397758(0x115),0x190);const {chave:_0x35d8db}=_0x3e4d08[_0x397758(0x105)],_0x2e3ae0={'chave':_0x35d8db},_0x21210c=new gn_api_sdk_typescript_1['default'](Gn_1['default']),_0x51536e=await _0x21210c['pixDeleteWebhook'](_0x2e3ae0);return _0xb99f98[_0x397758(0x112)](_0x51536e);};exports[a34_0x291bd3(0xf7)]=deleteWebhook;const webhook=async(_0x65a750,_0x2ea8d4)=>{const _0x42f70b=a34_0x291bd3,{type:_0x425842}=_0x65a750[_0x42f70b(0x125)],{evento:_0x56a8ea}=_0x65a750[_0x42f70b(0x105)];if(_0x56a8ea===_0x42f70b(0x10b))return _0x2ea8d4['json']({'ok':!![]});if(_0x65a750['body'][_0x42f70b(0x104)]){const _0x45aeba=new gn_api_sdk_typescript_1[(_0x42f70b(0x119))](Gn_1[_0x42f70b(0x119)]);_0x65a750[_0x42f70b(0x105)]['pix'][_0x42f70b(0x124)](async _0x26cf77=>{const _0x49bcda=_0x42f70b,_0x43923b=await _0x45aeba[_0x49bcda(0x110)]({'txid':_0x26cf77[_0x49bcda(0xfd)]});if(_0x43923b[_0x49bcda(0xe6)]===_0x49bcda(0x123)){const {solicitacaoPagador:_0x3cf91b}=_0x43923b,_0x569191=_0x3cf91b[_0x49bcda(0x111)](_0x49bcda(0xe0),''),_0x3db500=await Invoices_1[_0x49bcda(0x119)][_0x49bcda(0x108)](_0x569191),_0x1153b2=_0x3db500[_0x49bcda(0x12b)],_0x4415d1=await Company_1[_0x49bcda(0x119)][_0x49bcda(0x108)](_0x1153b2),_0x399f0e=new Date(_0x4415d1[_0x49bcda(0x127)]);_0x399f0e[_0x49bcda(0xf9)](_0x399f0e[_0x49bcda(0xec)]()+0x1e);const _0x1c1078=_0x399f0e[_0x49bcda(0xda)]()[_0x49bcda(0xee)]('T')[0x0];if(_0x4415d1){await _0x4415d1[_0x49bcda(0x102)]({'dueDate':_0x1c1078});const _0x948363=await _0x3db500[_0x49bcda(0x102)]({'id':_0x569191,'status':_0x49bcda(0xf2)});await _0x4415d1[_0x49bcda(0x11a)]();const _0x1f3506=(0x0,socket_1[_0x49bcda(0x10c)])(),_0x271bdc=await Company_1[_0x49bcda(0x119)]['findOne']({'where':{'id':_0x1153b2}});_0x1f3506[_0x49bcda(0xdc)](_0x49bcda(0x11f)+_0x1153b2+_0x49bcda(0x129),{'action':_0x43923b[_0x49bcda(0xe6)],'company':_0x271bdc});}}});}return _0x2ea8d4[_0x42f70b(0x112)]({'ok':!![]});};exports[a34_0x291bd3(0x113)]=webhook;