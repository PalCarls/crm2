'use strict';const a31_0xfdb8b=a31_0x4d3f;(function(_0x31e8a2,_0x148042){const _0x3e53d9=a31_0x4d3f,_0x22808e=_0x31e8a2();while(!![]){try{const _0x48a752=parseInt(_0x3e53d9(0x1a7))/0x1*(parseInt(_0x3e53d9(0x192))/0x2)+-parseInt(_0x3e53d9(0x170))/0x3*(-parseInt(_0x3e53d9(0x18e))/0x4)+-parseInt(_0x3e53d9(0x17d))/0x5*(parseInt(_0x3e53d9(0x171))/0x6)+parseInt(_0x3e53d9(0x19f))/0x7*(parseInt(_0x3e53d9(0x198))/0x8)+-parseInt(_0x3e53d9(0x1ab))/0x9+parseInt(_0x3e53d9(0x160))/0xa*(parseInt(_0x3e53d9(0x17e))/0xb)+-parseInt(_0x3e53d9(0x193))/0xc;if(_0x48a752===_0x148042)break;else _0x22808e['push'](_0x22808e['shift']());}catch(_0x46ed82){_0x22808e['push'](_0x22808e['shift']());}}}(a31_0x2a24,0xe5744));var __createBinding=this&&this['__createBinding']||(Object[a31_0xfdb8b(0x19d)]?function(_0xe0af8,_0x2ce952,_0x3cc80a,_0x173a6f){const _0x5112f0=a31_0xfdb8b;if(_0x173a6f===undefined)_0x173a6f=_0x3cc80a;var _0x41dc45=Object['getOwnPropertyDescriptor'](_0x2ce952,_0x3cc80a);(!_0x41dc45||('get'in _0x41dc45?!_0x2ce952[_0x5112f0(0x18c)]:_0x41dc45['writable']||_0x41dc45[_0x5112f0(0x164)]))&&(_0x41dc45={'enumerable':!![],'get':function(){return _0x2ce952[_0x3cc80a];}}),Object[_0x5112f0(0x18f)](_0xe0af8,_0x173a6f,_0x41dc45);}:function(_0x290b10,_0x31e7a6,_0x33b1b1,_0x262795){if(_0x262795===undefined)_0x262795=_0x33b1b1;_0x290b10[_0x262795]=_0x31e7a6[_0x33b1b1];}),__setModuleDefault=this&&this[a31_0xfdb8b(0x15d)]||(Object[a31_0xfdb8b(0x19d)]?function(_0x3044d0,_0x18e5e2){const _0x271fb2=a31_0xfdb8b;Object['defineProperty'](_0x3044d0,_0x271fb2(0x19a),{'enumerable':!![],'value':_0x18e5e2});}:function(_0x3344ad,_0x5c79ea){const _0x12038f=a31_0xfdb8b;_0x3344ad[_0x12038f(0x19a)]=_0x5c79ea;}),__importStar=this&&this['__importStar']||function(_0x16b892){const _0x4cf026=a31_0xfdb8b;if(_0x16b892&&_0x16b892[_0x4cf026(0x18c)])return _0x16b892;var _0x684b5a={};if(_0x16b892!=null){for(var _0x430f0f in _0x16b892)if(_0x430f0f!==_0x4cf026(0x19a)&&Object[_0x4cf026(0x17c)][_0x4cf026(0x1a9)][_0x4cf026(0x1a3)](_0x16b892,_0x430f0f))__createBinding(_0x684b5a,_0x16b892,_0x430f0f);}return __setModuleDefault(_0x684b5a,_0x16b892),_0x684b5a;},__importDefault=this&&this[a31_0xfdb8b(0x16c)]||function(_0x4923b4){const _0x1659bf=a31_0xfdb8b;return _0x4923b4&&_0x4923b4[_0x1659bf(0x18c)]?_0x4923b4:{'default':_0x4923b4};};Object['defineProperty'](exports,a31_0xfdb8b(0x18c),{'value':!![]}),exports[a31_0xfdb8b(0x186)]=exports[a31_0xfdb8b(0x190)]=exports[a31_0xfdb8b(0x16b)]=exports[a31_0xfdb8b(0x172)]=exports[a31_0xfdb8b(0x163)]=void 0x0;function a31_0x2a24(){const _0x46c8e9=['amount','pixDeleteWebhook','pixDetailCharge','loc','GERENCIANET_CHAVEPIX','webhook','../models/Plan','log','body','string','dueDate','__esModule','json','80772aCpksx','defineProperty','deleteWebhook','pixConfigWebhook','2164oKRcRv','24808308amHKIn','CONCLUIDA','emit','Validation\x20fails','shape','13114952XWxNzG','companyId','default','findByPk','planId','create','getDate','7kGTKSe','pix','status','getIO','call','gn-api-sdk-typescript','cnpj','cpf','1143nzhghi','reload','hasOwnProperty','../libs/socket','787842OVjOSf','yup','__setModuleDefault','forEach','../config/Gn','2735090gTPQuW','txid','env','index','configurable','en-US','replace','company-','Company\x20not\x20found','isValid','findOne','createWebhook','__importDefault','object','teste_webhook','../models/Company','42WgfYrR','8589606kMZJjq','createSubscription','update','getSubscriptions','toISOString','length','currency','../errors/AppError','document','#Fatura:','USD','prototype','5tPQKli','55oCNAcL','name','required'];a31_0x2a24=function(){return _0x46c8e9;};return a31_0x2a24();}const Yup=__importStar(require(a31_0xfdb8b(0x15c))),gn_api_sdk_typescript_1=__importDefault(require(a31_0xfdb8b(0x1a4))),AppError_1=__importDefault(require(a31_0xfdb8b(0x178))),Gn_1=__importDefault(require(a31_0xfdb8b(0x15f))),Company_1=__importDefault(require(a31_0xfdb8b(0x16f))),Invoices_1=__importDefault(require('../models/Invoices')),socket_1=require(a31_0xfdb8b(0x1aa)),Plan_1=__importDefault(require(a31_0xfdb8b(0x187))),index=async(_0x538d8d,_0x2f6f1f)=>{const _0x59c220=a31_0xfdb8b,_0x1e7184=new gn_api_sdk_typescript_1[(_0x59c220(0x19a))](Gn_1[_0x59c220(0x19a)]);return _0x2f6f1f[_0x59c220(0x18d)](_0x1e7184[_0x59c220(0x174)]());};exports[a31_0xfdb8b(0x163)]=index;function a31_0x4d3f(_0x5c9dfa,_0x2246c8){const _0x2a2494=a31_0x2a24();return a31_0x4d3f=function(_0x4d3f14,_0x21777b){_0x4d3f14=_0x4d3f14-0x15c;let _0xb6083a=_0x2a2494[_0x4d3f14];return _0xb6083a;},a31_0x4d3f(_0x5c9dfa,_0x2246c8);}const createSubscription=async(_0x33a22a,_0x1d8474)=>{const _0x4a8870=a31_0xfdb8b,_0x30ce70=new gn_api_sdk_typescript_1[(_0x4a8870(0x19a))](Gn_1['default']),{companyId:_0x230f1e}=_0x33a22a['user'],_0x3c6e36=Yup[_0x4a8870(0x16d)]()[_0x4a8870(0x197)]({'price':Yup[_0x4a8870(0x18a)]()[_0x4a8870(0x180)](),'users':Yup[_0x4a8870(0x18a)]()[_0x4a8870(0x180)](),'plan':Yup[_0x4a8870(0x18a)]()[_0x4a8870(0x180)]()});if(!await _0x3c6e36[_0x4a8870(0x169)](_0x33a22a[_0x4a8870(0x189)]))throw new AppError_1[(_0x4a8870(0x19a))]('Validation\x20fails',0x190);const _0x332bbe=new Intl['NumberFormat'](_0x4a8870(0x165),{'style':_0x4a8870(0x177),'currency':_0x4a8870(0x17b)}),_0x4bedd5=await Company_1[_0x4a8870(0x19a)][_0x4a8870(0x16a)]({'where':{'id':_0x230f1e}}),_0x127523=await Plan_1['default'][_0x4a8870(0x16a)]({'where':{'id':_0x4bedd5[_0x4a8870(0x19c)]}}),{invoiceId:_0x548177}=_0x33a22a[_0x4a8870(0x189)],_0x3fb1d2=_0x127523[_0x4a8870(0x181)],_0x5025ee=_0x332bbe['format'](_0x3fb1d2)[_0x4a8870(0x166)]('$',''),_0x11237c={'nome':_0x4bedd5[_0x4a8870(0x17f)]},_0x3728a4=_0x4bedd5[_0x4a8870(0x179)][_0x4a8870(0x166)](/\D/g,'');_0x3728a4[_0x4a8870(0x176)]===0xb?_0x11237c[_0x4a8870(0x1a6)]=_0x3728a4:_0x11237c[_0x4a8870(0x1a5)]=_0x3728a4;const _0x8e0867={'calendario':{'expiracao':0xe10},'devedor':{..._0x11237c},'valor':{'original':_0x5025ee},'chave':process[_0x4a8870(0x162)][_0x4a8870(0x185)],'solicitacaoPagador':'#Fatura:'+_0x548177};try{const _0xd4c03a=await _0x30ce70['pixCreateImmediateCharge'](null,_0x8e0867),_0x112b89=await _0x30ce70['pixGenerateQRCode']({'id':_0xd4c03a[_0x4a8870(0x184)]['id']});if(!_0x4bedd5)throw new AppError_1[(_0x4a8870(0x19a))](_0x4a8870(0x168),0x194);return _0x1d8474[_0x4a8870(0x18d)]({..._0xd4c03a,'qrcode':_0x112b89});}catch(_0x34c192){console[_0x4a8870(0x188)]('error_subscription',_0x34c192);throw new AppError_1[(_0x4a8870(0x19a))](_0x4a8870(0x196),0x190);}};exports[a31_0xfdb8b(0x172)]=createSubscription;const createWebhook=async(_0x73fe91,_0x3547d2)=>{const _0x3d02c8=a31_0xfdb8b,_0xecb2e7=Yup[_0x3d02c8(0x16d)]()[_0x3d02c8(0x197)]({'chave':Yup[_0x3d02c8(0x18a)]()[_0x3d02c8(0x180)](),'url':Yup[_0x3d02c8(0x18a)]()[_0x3d02c8(0x180)]()});if(!await _0xecb2e7[_0x3d02c8(0x169)](_0x73fe91[_0x3d02c8(0x189)]))throw new AppError_1['default'](_0x3d02c8(0x196),0x190);const {chave:_0x22ae8e,url:_0x379648}=_0x73fe91['body'],_0x25e3f0={'webhookUrl':_0x379648},_0x1e55d2={'chave':_0x22ae8e};try{const _0x20cbdb=new gn_api_sdk_typescript_1['default'](Gn_1[_0x3d02c8(0x19a)]),_0x4f918f=await _0x20cbdb[_0x3d02c8(0x191)](_0x1e55d2,_0x25e3f0);return _0x3547d2[_0x3d02c8(0x18d)](_0x4f918f);}catch(_0x691e7){console[_0x3d02c8(0x188)](_0x691e7);}};exports[a31_0xfdb8b(0x16b)]=createWebhook;const deleteWebhook=async(_0x110b93,_0x16cdbb)=>{const _0x61ef2b=a31_0xfdb8b,_0x2b0028=Yup['object']()[_0x61ef2b(0x197)]({'chave':Yup[_0x61ef2b(0x18a)]()[_0x61ef2b(0x180)]()});if(!await _0x2b0028[_0x61ef2b(0x169)](_0x110b93[_0x61ef2b(0x189)]))throw new AppError_1[(_0x61ef2b(0x19a))](_0x61ef2b(0x196),0x190);const {chave:_0x1c1dd6}=_0x110b93['body'],_0x14c49b={'chave':_0x1c1dd6},_0x3829c5=new gn_api_sdk_typescript_1[(_0x61ef2b(0x19a))](Gn_1[_0x61ef2b(0x19a)]),_0x1596ea=await _0x3829c5[_0x61ef2b(0x182)](_0x14c49b);return _0x16cdbb['json'](_0x1596ea);};exports[a31_0xfdb8b(0x190)]=deleteWebhook;const webhook=async(_0x1addf6,_0x2b8142)=>{const _0x239e0a=a31_0xfdb8b,{type:_0x202535}=_0x1addf6['params'],{evento:_0x3c940e}=_0x1addf6[_0x239e0a(0x189)];if(_0x3c940e===_0x239e0a(0x16e))return _0x2b8142[_0x239e0a(0x18d)]({'ok':!![]});if(_0x1addf6[_0x239e0a(0x189)][_0x239e0a(0x1a0)]){const _0x1e3176=new gn_api_sdk_typescript_1['default'](Gn_1['default']);_0x1addf6[_0x239e0a(0x189)][_0x239e0a(0x1a0)][_0x239e0a(0x15e)](async _0x860d=>{const _0x434f69=_0x239e0a,_0x3c487c=await _0x1e3176[_0x434f69(0x183)]({'txid':_0x860d[_0x434f69(0x161)]});if(_0x3c487c[_0x434f69(0x1a1)]===_0x434f69(0x194)){const {solicitacaoPagador:_0xa7af29}=_0x3c487c,_0x45aab4=_0xa7af29[_0x434f69(0x166)](_0x434f69(0x17a),''),_0xb71d7c=await Invoices_1['default'][_0x434f69(0x19b)](_0x45aab4),_0x3e6749=_0xb71d7c[_0x434f69(0x199)],_0x3c125b=await Company_1[_0x434f69(0x19a)][_0x434f69(0x19b)](_0x3e6749),_0x4cab86=new Date(_0x3c125b[_0x434f69(0x18b)]);_0x4cab86['setDate'](_0x4cab86[_0x434f69(0x19e)]()+0x1e);const _0x341d71=_0x4cab86[_0x434f69(0x175)]()['split']('T')[0x0];if(_0x3c125b){await _0x3c125b[_0x434f69(0x173)]({'dueDate':_0x341d71});const _0x4d12d7=await _0xb71d7c[_0x434f69(0x173)]({'id':_0x45aab4,'status':'paid'});await _0x3c125b[_0x434f69(0x1a8)]();const _0x39d60f=(0x0,socket_1[_0x434f69(0x1a2)])(),_0x18228d=await Company_1[_0x434f69(0x19a)][_0x434f69(0x16a)]({'where':{'id':_0x3e6749}});_0x39d60f[_0x434f69(0x195)](_0x434f69(0x167)+_0x3e6749+'-payment',{'action':_0x3c487c[_0x434f69(0x1a1)],'company':_0x18228d});}}});}return _0x2b8142[_0x239e0a(0x18d)]({'ok':!![]});};exports[a31_0xfdb8b(0x186)]=webhook;