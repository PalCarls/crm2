'use strict';const a34_0xc7c66e=a34_0x3d75;(function(_0x5a40f0,_0x402a37){const _0x3bcb2f=a34_0x3d75,_0x5aa65a=_0x5a40f0();while(!![]){try{const _0x1a5e74=parseInt(_0x3bcb2f(0xb4))/0x1*(parseInt(_0x3bcb2f(0xcb))/0x2)+parseInt(_0x3bcb2f(0xb5))/0x3*(parseInt(_0x3bcb2f(0xa7))/0x4)+-parseInt(_0x3bcb2f(0xf0))/0x5+-parseInt(_0x3bcb2f(0xed))/0x6*(parseInt(_0x3bcb2f(0xc3))/0x7)+parseInt(_0x3bcb2f(0xe5))/0x8*(parseInt(_0x3bcb2f(0xee))/0x9)+parseInt(_0x3bcb2f(0xbd))/0xa+parseInt(_0x3bcb2f(0xd2))/0xb*(-parseInt(_0x3bcb2f(0xda))/0xc);if(_0x1a5e74===_0x402a37)break;else _0x5aa65a['push'](_0x5aa65a['shift']());}catch(_0x1c0b26){_0x5aa65a['push'](_0x5aa65a['shift']());}}}(a34_0x491f,0x86082));var __createBinding=this&&this[a34_0xc7c66e(0xe7)]||(Object['create']?function(_0x139092,_0x14d2cd,_0x4ce6b4,_0x31d505){const _0x2e19b9=a34_0xc7c66e;if(_0x31d505===undefined)_0x31d505=_0x4ce6b4;var _0x31b976=Object[_0x2e19b9(0xc4)](_0x14d2cd,_0x4ce6b4);(!_0x31b976||(_0x2e19b9(0xd6)in _0x31b976?!_0x14d2cd['__esModule']:_0x31b976[_0x2e19b9(0xa8)]||_0x31b976[_0x2e19b9(0xea)]))&&(_0x31b976={'enumerable':!![],'get':function(){return _0x14d2cd[_0x4ce6b4];}}),Object[_0x2e19b9(0xdb)](_0x139092,_0x31d505,_0x31b976);}:function(_0x1dc551,_0x249b64,_0x465771,_0x226c6){if(_0x226c6===undefined)_0x226c6=_0x465771;_0x1dc551[_0x226c6]=_0x249b64[_0x465771];}),__setModuleDefault=this&&this[a34_0xc7c66e(0xaa)]||(Object[a34_0xc7c66e(0xb0)]?function(_0x13b3fd,_0x24a739){const _0x143e6a=a34_0xc7c66e;Object[_0x143e6a(0xdb)](_0x13b3fd,_0x143e6a(0xe9),{'enumerable':!![],'value':_0x24a739});}:function(_0x3e7925,_0x510e09){const _0x294c6b=a34_0xc7c66e;_0x3e7925[_0x294c6b(0xe9)]=_0x510e09;}),__importStar=this&&this[a34_0xc7c66e(0xd8)]||function(_0x3d0443){const _0x5bde17=a34_0xc7c66e;if(_0x3d0443&&_0x3d0443[_0x5bde17(0xd3)])return _0x3d0443;var _0xffcb75={};if(_0x3d0443!=null){for(var _0xe72fd in _0x3d0443)if(_0xe72fd!=='default'&&Object[_0x5bde17(0xdf)]['hasOwnProperty'][_0x5bde17(0xc1)](_0x3d0443,_0xe72fd))__createBinding(_0xffcb75,_0x3d0443,_0xe72fd);}return __setModuleDefault(_0xffcb75,_0x3d0443),_0xffcb75;},__importDefault=this&&this[a34_0xc7c66e(0xe3)]||function(_0x28b426){return _0x28b426&&_0x28b426['__esModule']?_0x28b426:{'default':_0x28b426};};Object[a34_0xc7c66e(0xdb)](exports,'__esModule',{'value':!![]}),exports[a34_0xc7c66e(0xe8)]=exports[a34_0xc7c66e(0xb8)]=exports['createWebhook']=exports[a34_0xc7c66e(0xae)]=exports[a34_0xc7c66e(0xad)]=void 0x0;const Yup=__importStar(require(a34_0xc7c66e(0xc6))),gn_api_sdk_typescript_1=__importDefault(require('gn-api-sdk-typescript')),AppError_1=__importDefault(require(a34_0xc7c66e(0xeb))),Gn_1=__importDefault(require('../config/Gn')),Company_1=__importDefault(require(a34_0xc7c66e(0xd4))),Invoices_1=__importDefault(require(a34_0xc7c66e(0xec))),socket_1=require(a34_0xc7c66e(0xbf)),Plan_1=__importDefault(require('../models/Plan')),index=async(_0xbd80f,_0x3bb074)=>{const _0x512a13=a34_0xc7c66e,_0x490060=new gn_api_sdk_typescript_1[(_0x512a13(0xe9))](Gn_1[_0x512a13(0xe9)]);return _0x3bb074[_0x512a13(0xa4)](_0x490060[_0x512a13(0xa5)]());};exports[a34_0xc7c66e(0xad)]=index;const createSubscription=async(_0x306d54,_0x506a3f)=>{const _0x295786=a34_0xc7c66e,_0x39fff0=new gn_api_sdk_typescript_1[(_0x295786(0xe9))](Gn_1[_0x295786(0xe9)]),{companyId:_0x545c2b}=_0x306d54[_0x295786(0xe2)],_0x231b18=Yup[_0x295786(0xdc)]()[_0x295786(0xc7)]({'price':Yup[_0x295786(0xde)]()[_0x295786(0xc2)](),'users':Yup[_0x295786(0xde)]()[_0x295786(0xc2)](),'plan':Yup['string']()[_0x295786(0xc2)]()});if(!await _0x231b18['isValid'](_0x306d54[_0x295786(0xef)]))throw new AppError_1['default'](_0x295786(0xd7),0x190);const _0x5ebf04=new Intl['NumberFormat']('en-US',{'style':_0x295786(0xac),'currency':_0x295786(0xca)}),_0x5f3431=await Company_1[_0x295786(0xe9)][_0x295786(0xcf)]({'where':{'id':_0x545c2b}}),_0x2d4c9a=await Plan_1[_0x295786(0xe9)][_0x295786(0xcf)]({'where':{'id':_0x5f3431['planId']}}),{invoiceId:_0x567718}=_0x306d54['body'],_0x34f6e7=_0x2d4c9a[_0x295786(0xd1)],_0x4b7c57=_0x5ebf04[_0x295786(0xd0)](_0x34f6e7)[_0x295786(0xd9)]('$',''),_0x22db6e={'nome':_0x5f3431[_0x295786(0xaf)]},_0x2a00b7=_0x5f3431[_0x295786(0xb6)]['replace'](/\D/g,'');_0x2a00b7[_0x295786(0xab)]===0xb?_0x22db6e[_0x295786(0xc9)]=_0x2a00b7:_0x22db6e[_0x295786(0xbc)]=_0x2a00b7;const _0x2b73fe={'calendario':{'expiracao':0xe10},'devedor':{..._0x22db6e},'valor':{'original':_0x4b7c57},'chave':process[_0x295786(0xb7)]['GERENCIANET_CHAVEPIX'],'solicitacaoPagador':_0x295786(0xa1)+_0x567718};try{const _0x209bd0=await _0x39fff0[_0x295786(0xc0)](null,_0x2b73fe),_0x305ebd=await _0x39fff0[_0x295786(0xdd)]({'id':_0x209bd0['loc']['id']});if(!_0x5f3431)throw new AppError_1[(_0x295786(0xe9))](_0x295786(0xcc),0x194);return _0x506a3f[_0x295786(0xa4)]({..._0x209bd0,'qrcode':_0x305ebd});}catch(_0x4b3c04){console[_0x295786(0xb9)]('error_subscription',_0x4b3c04);throw new AppError_1['default']('Validation\x20fails',0x190);}};exports[a34_0xc7c66e(0xae)]=createSubscription;const createWebhook=async(_0x1cb54e,_0x485ff4)=>{const _0xd0ca46=a34_0xc7c66e,_0x5b20f4=Yup[_0xd0ca46(0xdc)]()[_0xd0ca46(0xc7)]({'chave':Yup[_0xd0ca46(0xde)]()[_0xd0ca46(0xc2)](),'url':Yup[_0xd0ca46(0xde)]()[_0xd0ca46(0xc2)]()});if(!await _0x5b20f4[_0xd0ca46(0xb3)](_0x1cb54e[_0xd0ca46(0xef)]))throw new AppError_1[(_0xd0ca46(0xe9))](_0xd0ca46(0xd7),0x190);const {chave:_0x3fbacf,url:_0xa6f75c}=_0x1cb54e[_0xd0ca46(0xef)],_0x49afbc={'webhookUrl':_0xa6f75c},_0x2a47fa={'chave':_0x3fbacf};try{const _0x48c51f=new gn_api_sdk_typescript_1[(_0xd0ca46(0xe9))](Gn_1[_0xd0ca46(0xe9)]),_0x4c8d8b=await _0x48c51f['pixConfigWebhook'](_0x2a47fa,_0x49afbc);return _0x485ff4[_0xd0ca46(0xa4)](_0x4c8d8b);}catch(_0x9a0507){console[_0xd0ca46(0xb9)](_0x9a0507);}};function a34_0x3d75(_0x448f88,_0x2b5a45){const _0x491fe7=a34_0x491f();return a34_0x3d75=function(_0x3d75cf,_0x5a0dac){_0x3d75cf=_0x3d75cf-0xa1;let _0x57a875=_0x491fe7[_0x3d75cf];return _0x57a875;},a34_0x3d75(_0x448f88,_0x2b5a45);}exports[a34_0xc7c66e(0xf1)]=createWebhook;const deleteWebhook=async(_0xaae8b0,_0x5ea616)=>{const _0x5bd98b=a34_0xc7c66e,_0x546955=Yup[_0x5bd98b(0xdc)]()[_0x5bd98b(0xc7)]({'chave':Yup['string']()[_0x5bd98b(0xc2)]()});if(!await _0x546955[_0x5bd98b(0xb3)](_0xaae8b0['body']))throw new AppError_1[(_0x5bd98b(0xe9))](_0x5bd98b(0xd7),0x190);const {chave:_0x42254c}=_0xaae8b0[_0x5bd98b(0xef)],_0x34e2d1={'chave':_0x42254c},_0x5f15f7=new gn_api_sdk_typescript_1[(_0x5bd98b(0xe9))](Gn_1['default']),_0x343a96=await _0x5f15f7[_0x5bd98b(0xce)](_0x34e2d1);return _0x5ea616[_0x5bd98b(0xa4)](_0x343a96);};exports[a34_0xc7c66e(0xb8)]=deleteWebhook;const webhook=async(_0x2d5383,_0x1d8bdf)=>{const _0x3cedf6=a34_0xc7c66e,{type:_0x50f623}=_0x2d5383['params'],{evento:_0x2c1fe7}=_0x2d5383[_0x3cedf6(0xef)];if(_0x2c1fe7===_0x3cedf6(0xba))return _0x1d8bdf[_0x3cedf6(0xa4)]({'ok':!![]});if(_0x2d5383[_0x3cedf6(0xef)][_0x3cedf6(0xc8)]){const _0x5488de=new gn_api_sdk_typescript_1[(_0x3cedf6(0xe9))](Gn_1[_0x3cedf6(0xe9)]);_0x2d5383['body'][_0x3cedf6(0xc8)][_0x3cedf6(0xd5)](async _0x19bcbb=>{const _0x181466=_0x3cedf6,_0xfcd11b=await _0x5488de[_0x181466(0xa9)]({'txid':_0x19bcbb[_0x181466(0xe6)]});if(_0xfcd11b[_0x181466(0xb2)]===_0x181466(0xa2)){const {solicitacaoPagador:_0x5ad321}=_0xfcd11b,_0x3afc6a=_0x5ad321['replace'](_0x181466(0xa1),''),_0x38388e=await Invoices_1['default'][_0x181466(0xf2)](_0x3afc6a),_0x523498=_0x38388e[_0x181466(0xa3)],_0xd6fd5c=await Company_1[_0x181466(0xe9)][_0x181466(0xf2)](_0x523498),_0x2a2e3d=new Date(_0xd6fd5c[_0x181466(0xc5)]);_0x2a2e3d[_0x181466(0xbe)](_0x2a2e3d['getDate']()+0x1e);const _0x325fec=_0x2a2e3d['toISOString']()[_0x181466(0xbb)]('T')[0x0];if(_0xd6fd5c){await _0xd6fd5c[_0x181466(0xb1)]({'dueDate':_0x325fec});const _0x2b06e6=await _0x38388e[_0x181466(0xb1)]({'id':_0x3afc6a,'status':_0x181466(0xe1)});await _0xd6fd5c['reload']();const _0x5b08ba=(0x0,socket_1[_0x181466(0xe0)])(),_0x52b698=await Company_1[_0x181466(0xe9)][_0x181466(0xcf)]({'where':{'id':_0x523498}});_0x5b08ba[_0x181466(0xe4)](_0x181466(0xa6)+_0x523498+_0x181466(0xcd),{'action':_0xfcd11b['status'],'company':_0x52b698});}}});}return _0x1d8bdf[_0x3cedf6(0xa4)]({'ok':!![]});};function a34_0x491f(){const _0x19a3c3=['configurable','../errors/AppError','../models/Invoices','72qZKspI','333LlfYHS','body','2559725LeoLQn','createWebhook','findByPk','#Fatura:','CONCLUIDA','companyId','json','getSubscriptions','company-','236toMdVb','writable','pixDetailCharge','__setModuleDefault','length','currency','index','createSubscription','name','create','update','status','isValid','1968jcnpDe','39921kTmwhf','document','env','deleteWebhook','log','teste_webhook','split','cnpj','6748160mbjcvH','setDate','../libs/socket','pixCreateImmediateCharge','call','required','577717xbOxrS','getOwnPropertyDescriptor','dueDate','yup','shape','pix','cpf','USD','954txvoKC','Company\x20not\x20found','-payment','pixDeleteWebhook','findOne','format','amount','1163833yNUWAy','__esModule','../models/Company','forEach','get','Validation\x20fails','__importStar','replace','132jniDgK','defineProperty','object','pixGenerateQRCode','string','prototype','getIO','paid','user','__importDefault','emit','176536DiMLML','txid','__createBinding','webhook','default'];a34_0x491f=function(){return _0x19a3c3;};return a34_0x491f();}exports[a34_0xc7c66e(0xe8)]=webhook;