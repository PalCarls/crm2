'use strict';const a32_0x1248da=a32_0x283e;(function(_0x3b85a6,_0x189ec){const _0x32b51d=a32_0x283e,_0x4edbd8=_0x3b85a6();while(!![]){try{const _0x156d01=parseInt(_0x32b51d(0x1c5))/0x1*(-parseInt(_0x32b51d(0x1d3))/0x2)+-parseInt(_0x32b51d(0x1af))/0x3*(-parseInt(_0x32b51d(0x1e2))/0x4)+-parseInt(_0x32b51d(0x1ee))/0x5*(-parseInt(_0x32b51d(0x1a2))/0x6)+parseInt(_0x32b51d(0x1e1))/0x7+parseInt(_0x32b51d(0x1bd))/0x8*(-parseInt(_0x32b51d(0x1ef))/0x9)+parseInt(_0x32b51d(0x1c6))/0xa+parseInt(_0x32b51d(0x1b3))/0xb*(-parseInt(_0x32b51d(0x1c8))/0xc);if(_0x156d01===_0x189ec)break;else _0x4edbd8['push'](_0x4edbd8['shift']());}catch(_0x22b573){_0x4edbd8['push'](_0x4edbd8['shift']());}}}(a32_0x30e8,0x2aaa2));function a32_0x30e8(){const _0x487ef7=['../libs/socket','replace','index','setDate','create','pixDetailCharge','forEach','update','json','8fWRrYb','log','USD','status','hasOwnProperty','required','../models/Company','deleteWebhook','1aHFhlo','1913850cpizlh','Validation\x20fails','24924SnWnOG','__importDefault','-payment','gn-api-sdk-typescript','getSubscriptions','__createBinding','format','companyId','object','toISOString','webhook','516478wRSufY','__esModule','GERENCIANET_CHAVEPIX','user','string','writable','length','prototype','Company\x20not\x20found','dueDate','params','emit','error_subscription','amount','2104410CGFSAW','244PYzJOk','get','getDate','NumberFormat','findByPk','getIO','name','env','../config/Gn','body','getOwnPropertyDescriptor','shape','5mMmZwQ','1058733hcJWDi','createWebhook','configurable','CONCLUIDA','findOne','351438crnWFP','../models/Plan','__importStar','defineProperty','pix','pixConfigWebhook','createSubscription','../models/Invoices','txid','yup','#Fatura:','split','isValid','4803hqlqdI','cnpj','default','call','517eklVkx'];a32_0x30e8=function(){return _0x487ef7;};return a32_0x30e8();}var __createBinding=this&&this[a32_0x1248da(0x1cd)]||(Object[a32_0x1248da(0x1b8)]?function(_0x5d6a2a,_0x52d4bf,_0x54e20e,_0x37546c){const _0x3b18f0=a32_0x1248da;if(_0x37546c===undefined)_0x37546c=_0x54e20e;var _0x352f55=Object[_0x3b18f0(0x1ec)](_0x52d4bf,_0x54e20e);(!_0x352f55||(_0x3b18f0(0x1e3)in _0x352f55?!_0x52d4bf['__esModule']:_0x352f55[_0x3b18f0(0x1d8)]||_0x352f55[_0x3b18f0(0x19f)]))&&(_0x352f55={'enumerable':!![],'get':function(){return _0x52d4bf[_0x54e20e];}}),Object[_0x3b18f0(0x1a5)](_0x5d6a2a,_0x37546c,_0x352f55);}:function(_0x34a680,_0x3f9375,_0x509e6f,_0x3de4eb){if(_0x3de4eb===undefined)_0x3de4eb=_0x509e6f;_0x34a680[_0x3de4eb]=_0x3f9375[_0x509e6f];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a32_0x1248da(0x1b8)]?function(_0x2e342f,_0x4ab872){const _0x3be8d1=a32_0x1248da;Object[_0x3be8d1(0x1a5)](_0x2e342f,_0x3be8d1(0x1b1),{'enumerable':!![],'value':_0x4ab872});}:function(_0x1dd3d6,_0x526360){_0x1dd3d6['default']=_0x526360;}),__importStar=this&&this[a32_0x1248da(0x1a4)]||function(_0xd7ec38){const _0x19daa3=a32_0x1248da;if(_0xd7ec38&&_0xd7ec38[_0x19daa3(0x1d4)])return _0xd7ec38;var _0x362d1f={};if(_0xd7ec38!=null){for(var _0x3d4f57 in _0xd7ec38)if(_0x3d4f57!==_0x19daa3(0x1b1)&&Object[_0x19daa3(0x1da)][_0x19daa3(0x1c1)][_0x19daa3(0x1b2)](_0xd7ec38,_0x3d4f57))__createBinding(_0x362d1f,_0xd7ec38,_0x3d4f57);}return __setModuleDefault(_0x362d1f,_0xd7ec38),_0x362d1f;},__importDefault=this&&this[a32_0x1248da(0x1c9)]||function(_0x3be01a){return _0x3be01a&&_0x3be01a['__esModule']?_0x3be01a:{'default':_0x3be01a};};Object['defineProperty'](exports,a32_0x1248da(0x1d4),{'value':!![]}),exports['webhook']=exports['deleteWebhook']=exports['createWebhook']=exports['createSubscription']=exports[a32_0x1248da(0x1b6)]=void 0x0;const Yup=__importStar(require(a32_0x1248da(0x1ab))),gn_api_sdk_typescript_1=__importDefault(require(a32_0x1248da(0x1cb))),AppError_1=__importDefault(require('../errors/AppError')),Gn_1=__importDefault(require(a32_0x1248da(0x1ea))),Company_1=__importDefault(require(a32_0x1248da(0x1c3))),Invoices_1=__importDefault(require(a32_0x1248da(0x1a9))),socket_1=require(a32_0x1248da(0x1b4)),Plan_1=__importDefault(require(a32_0x1248da(0x1a3))),index=async(_0x3475ba,_0x158274)=>{const _0x5e6341=a32_0x1248da,_0x1ae5c9=new gn_api_sdk_typescript_1[(_0x5e6341(0x1b1))](Gn_1['default']);return _0x158274[_0x5e6341(0x1bc)](_0x1ae5c9[_0x5e6341(0x1cc)]());};exports[a32_0x1248da(0x1b6)]=index;const createSubscription=async(_0x10eb1c,_0xd67c7a)=>{const _0x2cce57=a32_0x1248da,_0x4591c3=new gn_api_sdk_typescript_1['default'](Gn_1[_0x2cce57(0x1b1)]),{companyId:_0x572d80}=_0x10eb1c[_0x2cce57(0x1d6)],_0x1e4166=Yup[_0x2cce57(0x1d0)]()[_0x2cce57(0x1ed)]({'price':Yup[_0x2cce57(0x1d7)]()[_0x2cce57(0x1c2)](),'users':Yup[_0x2cce57(0x1d7)]()[_0x2cce57(0x1c2)](),'plan':Yup['string']()[_0x2cce57(0x1c2)]()});if(!await _0x1e4166[_0x2cce57(0x1ae)](_0x10eb1c[_0x2cce57(0x1eb)]))throw new AppError_1[(_0x2cce57(0x1b1))]('Validation\x20fails',0x190);const _0x38f536=new Intl[(_0x2cce57(0x1e5))]('en-US',{'style':'currency','currency':_0x2cce57(0x1bf)}),_0x3da45e=await Company_1[_0x2cce57(0x1b1)]['findOne']({'where':{'id':_0x572d80}}),_0x442e4e=await Plan_1[_0x2cce57(0x1b1)][_0x2cce57(0x1a1)]({'where':{'id':_0x3da45e['planId']}}),{invoiceId:_0x3a6474}=_0x10eb1c['body'],_0x38a93e=_0x442e4e[_0x2cce57(0x1e0)],_0xee1207=_0x38f536[_0x2cce57(0x1ce)](_0x38a93e)[_0x2cce57(0x1b5)]('$',''),_0x5a34f8={'nome':_0x3da45e[_0x2cce57(0x1e8)]},_0x3e4b22=_0x3da45e['document'][_0x2cce57(0x1b5)](/\D/g,'');_0x3e4b22[_0x2cce57(0x1d9)]===0xb?_0x5a34f8['cpf']=_0x3e4b22:_0x5a34f8[_0x2cce57(0x1b0)]=_0x3e4b22;const _0x51a0a8={'calendario':{'expiracao':0xe10},'devedor':{..._0x5a34f8},'valor':{'original':_0xee1207},'chave':process[_0x2cce57(0x1e9)][_0x2cce57(0x1d5)],'solicitacaoPagador':_0x2cce57(0x1ac)+_0x3a6474};try{const _0x1d0f39=await _0x4591c3['pixCreateImmediateCharge'](null,_0x51a0a8),_0x4a1e21=await _0x4591c3['pixGenerateQRCode']({'id':_0x1d0f39['loc']['id']});if(!_0x3da45e)throw new AppError_1['default'](_0x2cce57(0x1db),0x194);return _0xd67c7a[_0x2cce57(0x1bc)]({..._0x1d0f39,'qrcode':_0x4a1e21});}catch(_0x417d01){console[_0x2cce57(0x1be)](_0x2cce57(0x1df),_0x417d01);throw new AppError_1[(_0x2cce57(0x1b1))](_0x2cce57(0x1c7),0x190);}};exports[a32_0x1248da(0x1a8)]=createSubscription;function a32_0x283e(_0x514f5a,_0x4bc67b){const _0x30e8b9=a32_0x30e8();return a32_0x283e=function(_0x283ea8,_0x9f0d0){_0x283ea8=_0x283ea8-0x19f;let _0x2d9e96=_0x30e8b9[_0x283ea8];return _0x2d9e96;},a32_0x283e(_0x514f5a,_0x4bc67b);}const createWebhook=async(_0x464aca,_0x4a9527)=>{const _0x1ddb47=a32_0x1248da,_0x2f9af0=Yup[_0x1ddb47(0x1d0)]()[_0x1ddb47(0x1ed)]({'chave':Yup[_0x1ddb47(0x1d7)]()[_0x1ddb47(0x1c2)](),'url':Yup['string']()[_0x1ddb47(0x1c2)]()});if(!await _0x2f9af0[_0x1ddb47(0x1ae)](_0x464aca['body']))throw new AppError_1[(_0x1ddb47(0x1b1))](_0x1ddb47(0x1c7),0x190);const {chave:_0x3000ac,url:_0x32cce2}=_0x464aca['body'],_0x5a2217={'webhookUrl':_0x32cce2},_0x2a60a3={'chave':_0x3000ac};try{const _0x1ae121=new gn_api_sdk_typescript_1[(_0x1ddb47(0x1b1))](Gn_1[_0x1ddb47(0x1b1)]),_0x466e3d=await _0x1ae121[_0x1ddb47(0x1a7)](_0x2a60a3,_0x5a2217);return _0x4a9527[_0x1ddb47(0x1bc)](_0x466e3d);}catch(_0x26ed37){console['log'](_0x26ed37);}};exports[a32_0x1248da(0x1f0)]=createWebhook;const deleteWebhook=async(_0x4b96f4,_0x4efdf7)=>{const _0x2b56f4=a32_0x1248da,_0x1e4322=Yup[_0x2b56f4(0x1d0)]()[_0x2b56f4(0x1ed)]({'chave':Yup[_0x2b56f4(0x1d7)]()[_0x2b56f4(0x1c2)]()});if(!await _0x1e4322[_0x2b56f4(0x1ae)](_0x4b96f4[_0x2b56f4(0x1eb)]))throw new AppError_1['default'](_0x2b56f4(0x1c7),0x190);const {chave:_0x422ce4}=_0x4b96f4[_0x2b56f4(0x1eb)],_0x4aae20={'chave':_0x422ce4},_0x5323f8=new gn_api_sdk_typescript_1[(_0x2b56f4(0x1b1))](Gn_1[_0x2b56f4(0x1b1)]),_0x1860c3=await _0x5323f8['pixDeleteWebhook'](_0x4aae20);return _0x4efdf7[_0x2b56f4(0x1bc)](_0x1860c3);};exports[a32_0x1248da(0x1c4)]=deleteWebhook;const webhook=async(_0x147fb6,_0x3bedd1)=>{const _0x195d58=a32_0x1248da,{type:_0xd7cea}=_0x147fb6[_0x195d58(0x1dd)],{evento:_0x3cb42f}=_0x147fb6[_0x195d58(0x1eb)];if(_0x3cb42f==='teste_webhook')return _0x3bedd1['json']({'ok':!![]});if(_0x147fb6[_0x195d58(0x1eb)][_0x195d58(0x1a6)]){const _0x13ff0b=new gn_api_sdk_typescript_1['default'](Gn_1['default']);_0x147fb6[_0x195d58(0x1eb)][_0x195d58(0x1a6)][_0x195d58(0x1ba)](async _0x4bdfac=>{const _0x1bacfb=_0x195d58,_0x5a498b=await _0x13ff0b[_0x1bacfb(0x1b9)]({'txid':_0x4bdfac[_0x1bacfb(0x1aa)]});if(_0x5a498b[_0x1bacfb(0x1c0)]===_0x1bacfb(0x1a0)){const {solicitacaoPagador:_0x431c6f}=_0x5a498b,_0x2a509f=_0x431c6f[_0x1bacfb(0x1b5)](_0x1bacfb(0x1ac),''),_0x18d60d=await Invoices_1[_0x1bacfb(0x1b1)][_0x1bacfb(0x1e6)](_0x2a509f),_0x9f9396=_0x18d60d[_0x1bacfb(0x1cf)],_0x28f45c=await Company_1[_0x1bacfb(0x1b1)][_0x1bacfb(0x1e6)](_0x9f9396),_0x40b1f5=new Date(_0x28f45c[_0x1bacfb(0x1dc)]);_0x40b1f5[_0x1bacfb(0x1b7)](_0x40b1f5[_0x1bacfb(0x1e4)]()+0x1e);const _0x4aa01e=_0x40b1f5[_0x1bacfb(0x1d1)]()[_0x1bacfb(0x1ad)]('T')[0x0];if(_0x28f45c){await _0x28f45c[_0x1bacfb(0x1bb)]({'dueDate':_0x4aa01e});const _0x160606=await _0x18d60d[_0x1bacfb(0x1bb)]({'id':_0x2a509f,'status':'paid'});await _0x28f45c['reload']();const _0x23cccb=(0x0,socket_1[_0x1bacfb(0x1e7)])(),_0x2ba22d=await Company_1['default'][_0x1bacfb(0x1a1)]({'where':{'id':_0x9f9396}});_0x23cccb[_0x1bacfb(0x1de)]('company-'+_0x9f9396+_0x1bacfb(0x1ca),{'action':_0x5a498b[_0x1bacfb(0x1c0)],'company':_0x2ba22d});}}});}return _0x3bedd1['json']({'ok':!![]});};exports[a32_0x1248da(0x1d2)]=webhook;