'use strict';const a8_0x36975c=a8_0x23d0;(function(_0x378ca1,_0x208614){const _0x5ab531=a8_0x23d0,_0x316efd=_0x378ca1();while(!![]){try{const _0x5eeb78=parseInt(_0x5ab531(0xb3))/0x1+parseInt(_0x5ab531(0xe2))/0x2+-parseInt(_0x5ab531(0x95))/0x3*(parseInt(_0x5ab531(0xe9))/0x4)+parseInt(_0x5ab531(0xb4))/0x5*(parseInt(_0x5ab531(0xcc))/0x6)+parseInt(_0x5ab531(0xd2))/0x7*(parseInt(_0x5ab531(0xab))/0x8)+parseInt(_0x5ab531(0xe4))/0x9+-parseInt(_0x5ab531(0xe3))/0xa*(parseInt(_0x5ab531(0xa2))/0xb);if(_0x5eeb78===_0x208614)break;else _0x316efd['push'](_0x316efd['shift']());}catch(_0x1b6be0){_0x316efd['push'](_0x316efd['shift']());}}}(a8_0x389e,0xaa07c));var __createBinding=this&&this[a8_0x36975c(0xe8)]||(Object['create']?function(_0x385e2a,_0x46f43e,_0x28cdbb,_0x29f89f){const _0x210b92=a8_0x36975c;if(_0x29f89f===undefined)_0x29f89f=_0x28cdbb;var _0x588917=Object[_0x210b92(0xbd)](_0x46f43e,_0x28cdbb);(!_0x588917||(_0x210b92(0xf2)in _0x588917?!_0x46f43e[_0x210b92(0xa4)]:_0x588917['writable']||_0x588917['configurable']))&&(_0x588917={'enumerable':!![],'get':function(){return _0x46f43e[_0x28cdbb];}}),Object[_0x210b92(0xbc)](_0x385e2a,_0x29f89f,_0x588917);}:function(_0x152006,_0x319326,_0x3dd01d,_0x42463f){if(_0x42463f===undefined)_0x42463f=_0x3dd01d;_0x152006[_0x42463f]=_0x319326[_0x3dd01d];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0xa92bc9,_0x196c8c){const _0xde510=a8_0x36975c;Object[_0xde510(0xbc)](_0xa92bc9,_0xde510(0xe0),{'enumerable':!![],'value':_0x196c8c});}:function(_0x44d500,_0x289fec){const _0x3868b8=a8_0x36975c;_0x44d500[_0x3868b8(0xe0)]=_0x289fec;}),__importStar=this&&this[a8_0x36975c(0x9a)]||function(_0x60b78a){const _0x29d179=a8_0x36975c;if(_0x60b78a&&_0x60b78a[_0x29d179(0xa4)])return _0x60b78a;var _0x1a79e5={};if(_0x60b78a!=null){for(var _0x1598db in _0x60b78a)if(_0x1598db!==_0x29d179(0xe0)&&Object[_0x29d179(0xcb)][_0x29d179(0xd9)][_0x29d179(0xbe)](_0x60b78a,_0x1598db))__createBinding(_0x1a79e5,_0x60b78a,_0x1598db);}return __setModuleDefault(_0x1a79e5,_0x60b78a),_0x1a79e5;},__importDefault=this&&this[a8_0x36975c(0x92)]||function(_0x5641d6){const _0x3c6527=a8_0x36975c;return _0x5641d6&&_0x5641d6[_0x3c6527(0xa4)]?_0x5641d6:{'default':_0x5641d6};};Object[a8_0x36975c(0xbc)](exports,'__esModule',{'value':!![]}),exports[a8_0x36975c(0xaa)]=exports[a8_0x36975c(0xef)]=exports['indexImage']=exports[a8_0x36975c(0xdb)]=exports['indexLink']=exports['OnWhatsAppDto']=void 0x0;const Yup=__importStar(require(a8_0x36975c(0xde))),AppError_1=__importDefault(require(a8_0x36975c(0x94))),GetDefaultWhatsApp_1=__importDefault(require(a8_0x36975c(0xe7))),SetTicketMessagesAsRead_1=__importDefault(require(a8_0x36975c(0xb8))),Whatsapp_1=__importDefault(require(a8_0x36975c(0xf6))),CreateOrUpdateContactService_1=__importDefault(require(a8_0x36975c(0xdc))),FindOrCreateTicketService_1=__importDefault(require(a8_0x36975c(0xd7))),ShowTicketService_1=__importDefault(require(a8_0x36975c(0xed))),CheckIsValidContact_1=__importDefault(require('../services/WbotServices/CheckIsValidContact')),CheckNumber_1=__importDefault(require(a8_0x36975c(0xa6))),SendWhatsAppMedia_1=__importDefault(require(a8_0x36975c(0x9c))),UpdateTicketService_1=__importDefault(require(a8_0x36975c(0xc7))),wbot_1=require('../libs/wbot'),SendWhatsAppMessageLink_1=__importDefault(require(a8_0x36975c(0xb0))),SendWhatsAppMessageAPI_1=__importDefault(require('../services/WbotServices/SendWhatsAppMessageAPI')),SendWhatsappMediaImage_1=__importDefault(require(a8_0x36975c(0x98))),ApiUsages_1=__importDefault(require(a8_0x36975c(0xa7))),useDate_1=require('../utils/useDate'),moment_1=__importDefault(require(a8_0x36975c(0xdf))),CompaniesSettings_1=__importDefault(require(a8_0x36975c(0xeb))),ShowUserService_1=__importDefault(require('../services/UserServices/ShowUserService')),lodash_1=require(a8_0x36975c(0xdd)),wbotMessageListener_1=require('../services/WbotServices/wbotMessageListener'),ShowQueueService_1=__importDefault(require('../services/QueueService/ShowQueueService'));function a8_0x389e(){const _0x34fd74=['verifyMediaMessage','test','json','prototype','66642ZrUDmX','required','closed','exec','headers','\x20not\x20found','21szsSPs','findOne','dataValues','video','contact','../services/TicketServices/FindOrCreateTicketService','indexImage','hasOwnProperty','companyId','index','../services/ContactServices/CreateOrUpdateContactService','lodash','yup','moment','default','number','63954OkDxPY','190erzOOv','5828400tWKtng','map','files','../helpers/GetDefaultWhatsApp','__createBinding','1809256QXmeTA','indexLink','../models/CompaniesSettings','format','../services/TicketServices/ShowTicketService','caption','checkNumber','usedVideo','useDate','get','message','FRONTEND_URL','object','../models/Whatsapp','env','update','@s.whatsapp.net','string','matches','Cliente\x20em\x20outro\x20atendimento','__importDefault','includes','../errors/AppError','6qImKWK','verifyMessage','body','../services/WbotServices/SendWhatsappMediaImage','isNil','__importStar','jid','../services/WbotServices/SendWhatsAppMedia','send','usedCheckNumber','toString','pdf','usedPDF','926002ILlZDn','whatsapp','__esModule','replace','../services/WbotServices/CheckNumber','../models/ApiUsages','isInteger','usedOther','indexWhatsappsId','3121288xJmXVS','true','Not\x20exists\x20on\x20Whatsapp','all','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','../services/WbotServices/SendWhatsAppMessageLink','whatsapp\x20#','mimetype','361947pFQYuI','445yWXuon','@g.us','split','trim','../helpers/SetTicketMessagesAsRead','UsedOnDay','API','shape','defineProperty','getOwnPropertyDescriptor','call','usedImage','status','parseInt','log','image','create',':*\x0a','onWhatsApp','../services/TicketServices/UpdateTicketService'];a8_0x389e=function(){return _0x34fd74;};return a8_0x389e();}class OnWhatsAppDto{constructor(_0x160d44,_0x2e8a52){const _0x5af99b=a8_0x36975c;this[_0x5af99b(0x9b)]=_0x160d44,this['exists']=_0x2e8a52;}}exports['OnWhatsAppDto']=OnWhatsAppDto;const createContact=async(_0x2b6c1c,_0x4203c8,_0x946898,_0x21c17d,_0x3bcb48)=>{const _0xd8ef93=a8_0x36975c;await(0x0,CheckIsValidContact_1[_0xd8ef93(0xe0)])(_0x946898,_0x4203c8);const _0x16d07e=await(0x0,CheckNumber_1[_0xd8ef93(0xe0)])(_0x946898,_0x4203c8),_0x46a1f8=process[_0xd8ef93(0xf7)][_0xd8ef93(0xf4)]+'/nopicture.png',_0x42a2ef=_0x16d07e,_0x19d21e={'name':''+_0x42a2ef,'number':_0x42a2ef,'profilePicUrl':_0x46a1f8,'isGroup':![],'companyId':_0x4203c8},_0x12ff84=await(0x0,CreateOrUpdateContactService_1[_0xd8ef93(0xe0)])(_0x19d21e),_0x587428=await CompaniesSettings_1[_0xd8ef93(0xe0)][_0xd8ef93(0xd3)]({'where':{'companyId':_0x4203c8}});let _0x2413d4;if(_0x2b6c1c===undefined)_0x2413d4=await(0x0,GetDefaultWhatsApp_1[_0xd8ef93(0xe0)])(_0x4203c8);else{_0x2413d4=await Whatsapp_1['default']['findByPk'](_0x2b6c1c);if(_0x2413d4===null)throw new AppError_1['default'](_0xd8ef93(0xb1)+_0x2b6c1c+_0xd8ef93(0xd1));}const {ticket:_0x3b0471,isCreated:_0x124f28}=await(0x0,FindOrCreateTicketService_1['default'])(_0x12ff84,_0x2413d4,0x0,_0x4203c8,_0x3bcb48,_0x21c17d,null,_0xd8ef93(0xa3),null,![],_0x587428);let _0x13a4c7;return _0x3b0471&&(_0x13a4c7=await(0x0,ShowTicketService_1['default'])(_0x3b0471['id'],_0x4203c8),(0x0,SetTicketMessagesAsRead_1[_0xd8ef93(0xe0)])(_0x13a4c7)),_0x13a4c7;};function formatBRNumber(_0x52aa2c){const _0x5b1ec0=a8_0x36975c,_0x3c9fdf=new RegExp(/^(\d{2})(\d{2})\d{1}(\d{8})$/);if(_0x3c9fdf[_0x5b1ec0(0xc9)](_0x52aa2c)){const _0x5e1ec4=_0x3c9fdf[_0x5b1ec0(0xcf)](_0x52aa2c);if(_0x5e1ec4&&_0x5e1ec4[0x1]==='55'&&Number[_0x5b1ec0(0xa8)](Number[_0x5b1ec0(0xc1)](_0x5e1ec4[0x2]))){const _0x4620b2=Number[_0x5b1ec0(0xc1)](_0x5e1ec4[0x2]);if(_0x4620b2<0x1f)return _0x5e1ec4[0x0];else{if(_0x4620b2>=0x1f)return _0x5e1ec4[0x1]+_0x5e1ec4[0x2]+_0x5e1ec4[0x3];}}}else return _0x52aa2c;}function createJid(_0x376e0a){const _0x1bb1b7=a8_0x36975c;if(_0x376e0a[_0x1bb1b7(0x93)](_0x1bb1b7(0xb5))||_0x376e0a[_0x1bb1b7(0x93)]('@s.whatsapp.net'))return formatBRNumber(_0x376e0a);return _0x376e0a[_0x1bb1b7(0x93)]('-')?_0x376e0a+'@g.us':formatBRNumber(_0x376e0a)+_0x1bb1b7(0xf9);}const indexLink=async(_0x5493c9,_0x3a88f4)=>{const _0x2251ca=a8_0x36975c,_0x2a0ff1=_0x5493c9[_0x2251ca(0x97)],{whatsappId:_0xa55f29}=_0x5493c9[_0x2251ca(0x97)],{msdelay:_0x134a30}=_0x5493c9[_0x2251ca(0x97)],_0x4d4e61=_0x5493c9[_0x2251ca(0x97)]['url'],_0xfd11a9=_0x5493c9[_0x2251ca(0x97)][_0x2251ca(0xee)],_0x3b26e6=_0x5493c9[_0x2251ca(0xd0)]['authorization'],[,_0x16885b]=_0x3b26e6[_0x2251ca(0xb6)]('\x20'),_0x133b17=await Whatsapp_1[_0x2251ca(0xe0)][_0x2251ca(0xd3)]({'where':{'token':_0x16885b}}),_0x3d5fdf=_0x133b17[_0x2251ca(0xda)];_0x2a0ff1[_0x2251ca(0xe1)]=_0x2a0ff1[_0x2251ca(0xe1)]['replace']('-','')[_0x2251ca(0xa5)]('\x20','');const _0x41eeed=Yup[_0x2251ca(0xf5)]()[_0x2251ca(0xbb)]({'number':Yup[_0x2251ca(0xfa)]()[_0x2251ca(0xcd)]()[_0x2251ca(0x90)](/^\d+$/,_0x2251ca(0xaf))});try{await _0x41eeed['validate'](_0x2a0ff1);}catch(_0x5d650f){throw new AppError_1[(_0x2251ca(0xe0))](_0x5d650f[_0x2251ca(0xf3)]);}const _0x2a7435=await createContact(_0xa55f29,_0x3d5fdf,_0x2a0ff1[_0x2251ca(0xe1)]);if(!_0x2a7435)throw new AppError_1[(_0x2251ca(0xe0))](_0x2251ca(0x91));return await(0x0,SendWhatsAppMessageLink_1[_0x2251ca(0xe0)])({'whatsappId':_0xa55f29,'contact':_0x2a7435['contact'],'url':_0x4d4e61,'caption':_0xfd11a9,'msdelay':_0x134a30}),setTimeout(async()=>{const _0x47cb07=_0x2251ca,{dateToClient:_0x854d60}=(0x0,useDate_1[_0x47cb07(0xf1)])(),_0x40faff=_0x854d60(new Date()),_0x174795=(0x0,moment_1[_0x47cb07(0xe0)])()[_0x47cb07(0xec)](),_0x4b14e0=await ApiUsages_1['default'][_0x47cb07(0xd3)]({'where':{'dateUsed':_0x40faff,'companyId':_0x3d5fdf}});if(_0x4b14e0)await _0x4b14e0['update']({'usedPDF':_0x4b14e0[_0x47cb07(0xd4)][_0x47cb07(0xa1)]+0x1,'UsedOnDay':_0x4b14e0['dataValues'][_0x47cb07(0xb9)]+0x1,'updatedAt':_0x174795});else{const _0x1479a8=await ApiUsages_1[_0x47cb07(0xe0)][_0x47cb07(0xc4)]({'companyId':_0x3d5fdf,'dateUsed':_0x40faff});await _0x1479a8[_0x47cb07(0xf8)]({'usedPDF':_0x1479a8[_0x47cb07(0xd4)]['usedPDF']+0x1,'UsedOnDay':_0x1479a8['dataValues'][_0x47cb07(0xb9)]+0x1,'updatedAt':_0x174795});}},0x64),_0x3a88f4['send']({'status':'SUCCESS'});};exports[a8_0x36975c(0xea)]=indexLink;const index=async(_0x3e4567,_0x4dd55c)=>{const _0x4f0225=a8_0x36975c,_0x1ea35e=_0x3e4567[_0x4f0225(0x97)],{whatsappId:_0x4a6d80}=_0x3e4567[_0x4f0225(0x97)],{msdelay:_0x4bccf3}=_0x3e4567[_0x4f0225(0x97)],{body:_0x309c19,quotedMsg:_0x451fe9,userId:_0x2d5867,queueId:_0x4a9ece,sendSignature:_0x1b793f,closeTicket:_0x773e52}=_0x3e4567[_0x4f0225(0x97)],_0x1de61e=_0x3e4567[_0x4f0225(0xe6)],_0x2639d2=_0x3e4567[_0x4f0225(0xd0)]['authorization'],[,_0x230c86]=_0x2639d2['split']('\x20'),_0x4e4e97=await Whatsapp_1['default']['findOne']({'where':{'token':_0x230c86}}),_0x3b5196=_0x4e4e97[_0x4f0225(0xda)];_0x1ea35e[_0x4f0225(0xe1)]=_0x1ea35e[_0x4f0225(0xe1)][_0x4f0225(0xa5)]('-','')['replace']('\x20','');const _0x2592d1=Yup[_0x4f0225(0xf5)]()[_0x4f0225(0xbb)]({'number':Yup[_0x4f0225(0xfa)]()[_0x4f0225(0xcd)]()[_0x4f0225(0x90)](/^\d+$/,_0x4f0225(0xaf))});try{await _0x2592d1['validate'](_0x1ea35e);}catch(_0x2f3adc){throw new AppError_1['default'](_0x2f3adc[_0x4f0225(0xf3)]);}console[_0x4f0225(0xc2)](_0x4f0225(0xba),_0x2d5867,_0x4a9ece);let _0x3c62fa;_0x2d5867?.['toString']()!==''&&!isNaN(_0x2d5867)&&(_0x3c62fa=await(0x0,ShowUserService_1[_0x4f0225(0xe0)])(_0x2d5867,_0x3b5196));let _0x460251;_0x4a9ece?.[_0x4f0225(0x9f)]()!==''&&!isNaN(_0x4a9ece)&&(_0x460251=await(0x0,ShowQueueService_1[_0x4f0225(0xe0)])(_0x4a9ece,_0x3b5196));const _0x1a7bf6=await createContact(_0x4e4e97['id'],_0x3b5196,_0x1ea35e[_0x4f0225(0xe1)],_0x2d5867,_0x4a9ece);let _0x19b0c4;_0x1b793f&&!(0x0,lodash_1[_0x4f0225(0x99)])(_0x3c62fa)?_0x19b0c4='*'+_0x3c62fa['name']+_0x4f0225(0xc5)+_0x309c19[_0x4f0225(0xb7)]():_0x19b0c4=_0x309c19[_0x4f0225(0xb7)]();let _0x5eaa06;return _0x1de61e?(await Promise[_0x4f0225(0xae)](_0x1de61e[_0x4f0225(0xe5)](async _0x372bce=>{const _0x2844cb=_0x4f0225;_0x5eaa06=await(0x0,SendWhatsAppMedia_1[_0x2844cb(0xe0)])({'body':'â€Ž\x20'+_0x19b0c4,'media':_0x372bce,'ticket':_0x1a7bf6,'isForwarded':![]});})),await(0x0,wbotMessageListener_1[_0x4f0225(0xc8)])(_0x5eaa06,_0x1a7bf6,_0x1a7bf6[_0x4f0225(0xd6)])):(_0x5eaa06=await(0x0,SendWhatsAppMessageAPI_1['default'])({'body':_0x19b0c4,'whatsappId':_0x4e4e97['id'],'contact':_0x1a7bf6[_0x4f0225(0xd6)],'quotedMsg':_0x451fe9,'msdelay':_0x4bccf3}),await(0x0,wbotMessageListener_1[_0x4f0225(0x96)])(_0x5eaa06,_0x1a7bf6,_0x1a7bf6[_0x4f0225(0xd6)])),_0x773e52&&_0x773e52===_0x4f0225(0xac)&&setTimeout(async()=>{const _0x3f695e=_0x4f0225;await(0x0,UpdateTicketService_1[_0x3f695e(0xe0)])({'ticketId':_0x1a7bf6['id'],'ticketData':{'status':_0x3f695e(0xce),'sendFarewellMessage':![],'amountUsedBotQueues':0x0,'lastMessage':_0x309c19},'companyId':_0x3b5196});},0x64),setTimeout(async()=>{const _0x448323=_0x4f0225,{dateToClient:_0x14126c}=(0x0,useDate_1[_0x448323(0xf1)])(),_0x51d33b=_0x14126c(new Date()),_0xcf9266=(0x0,moment_1['default'])()[_0x448323(0xec)]();let _0x10fa5f=await ApiUsages_1[_0x448323(0xe0)][_0x448323(0xd3)]({'where':{'dateUsed':_0x51d33b,'companyId':_0x3b5196}});_0x10fa5f?_0x1de61e?await Promise[_0x448323(0xae)](_0x1de61e[_0x448323(0xe5)](async _0x5c663d=>{const _0x155181=_0x448323;if(_0x5c663d[_0x155181(0xb2)][_0x155181(0x93)](_0x155181(0xa0)))await _0x10fa5f[_0x155181(0xf8)]({'usedPDF':_0x10fa5f[_0x155181(0xd4)][_0x155181(0xa1)]+0x1,'UsedOnDay':_0x10fa5f['dataValues'][_0x155181(0xb9)]+0x1,'updatedAt':_0xcf9266});else{if(_0x5c663d['mimetype'][_0x155181(0x93)](_0x155181(0xc3)))await _0x10fa5f['update']({'usedImage':_0x10fa5f[_0x155181(0xd4)][_0x155181(0xbf)]+0x1,'UsedOnDay':_0x10fa5f[_0x155181(0xd4)][_0x155181(0xb9)]+0x1,'updatedAt':_0xcf9266});else _0x5c663d[_0x155181(0xb2)]['includes'](_0x155181(0xd5))?await _0x10fa5f[_0x155181(0xf8)]({'usedVideo':_0x10fa5f[_0x155181(0xd4)]['usedVideo']+0x1,'UsedOnDay':_0x10fa5f[_0x155181(0xd4)][_0x155181(0xb9)]+0x1,'updatedAt':_0xcf9266}):await _0x10fa5f['update']({'usedOther':_0x10fa5f['dataValues']['usedOther']+0x1,'UsedOnDay':_0x10fa5f[_0x155181(0xd4)][_0x155181(0xb9)]+0x1,'updatedAt':_0xcf9266});}})):await _0x10fa5f['update']({'usedText':_0x10fa5f[_0x448323(0xd4)]['usedText']+0x1,'UsedOnDay':_0x10fa5f['dataValues'][_0x448323(0xb9)]+0x1,'updatedAt':_0xcf9266}):(_0x10fa5f=await ApiUsages_1[_0x448323(0xe0)][_0x448323(0xc4)]({'companyId':_0x3b5196,'dateUsed':_0x51d33b}),_0x1de61e?await Promise[_0x448323(0xae)](_0x1de61e['map'](async _0x4342e7=>{const _0x1751bf=_0x448323;if(_0x4342e7[_0x1751bf(0xb2)][_0x1751bf(0x93)](_0x1751bf(0xa0)))await _0x10fa5f[_0x1751bf(0xf8)]({'usedPDF':_0x10fa5f[_0x1751bf(0xd4)][_0x1751bf(0xa1)]+0x1,'UsedOnDay':_0x10fa5f[_0x1751bf(0xd4)]['UsedOnDay']+0x1,'updatedAt':_0xcf9266});else{if(_0x4342e7[_0x1751bf(0xb2)][_0x1751bf(0x93)](_0x1751bf(0xc3)))await _0x10fa5f['update']({'usedImage':_0x10fa5f['dataValues'][_0x1751bf(0xbf)]+0x1,'UsedOnDay':_0x10fa5f[_0x1751bf(0xd4)][_0x1751bf(0xb9)]+0x1,'updatedAt':_0xcf9266});else _0x4342e7['mimetype'][_0x1751bf(0x93)](_0x1751bf(0xd5))?await _0x10fa5f[_0x1751bf(0xf8)]({'usedVideo':_0x10fa5f[_0x1751bf(0xd4)][_0x1751bf(0xf0)]+0x1,'UsedOnDay':_0x10fa5f['dataValues'][_0x1751bf(0xb9)]+0x1,'updatedAt':_0xcf9266}):await _0x10fa5f[_0x1751bf(0xf8)]({'usedOther':_0x10fa5f[_0x1751bf(0xd4)][_0x1751bf(0xa9)]+0x1,'UsedOnDay':_0x10fa5f['dataValues'][_0x1751bf(0xb9)]+0x1,'updatedAt':_0xcf9266});}})):await _0x10fa5f[_0x448323(0xf8)]({'usedText':_0x10fa5f[_0x448323(0xd4)]['usedText']+0x1,'UsedOnDay':_0x10fa5f[_0x448323(0xd4)][_0x448323(0xb9)]+0x1,'updatedAt':_0xcf9266}));},0x64),_0x4dd55c['send']({'status':'SUCCESS'});};exports[a8_0x36975c(0xdb)]=index;const indexImage=async(_0x464bec,_0x504a60)=>{const _0x78ab06=a8_0x36975c,_0xddece8=_0x464bec[_0x78ab06(0x97)],{whatsappId:_0x4452d6}=_0x464bec['body'],{msdelay:_0x3705c7}=_0x464bec[_0x78ab06(0x97)],_0xaf471d=_0x464bec[_0x78ab06(0x97)]['url'],_0x34ff8a=_0x464bec[_0x78ab06(0x97)][_0x78ab06(0xee)],_0x3680e0=_0x464bec[_0x78ab06(0xd0)]['authorization'],[,_0x498616]=_0x3680e0[_0x78ab06(0xb6)]('\x20'),_0x3217cd=await Whatsapp_1[_0x78ab06(0xe0)][_0x78ab06(0xd3)]({'where':{'token':_0x498616}}),_0x5388cb=_0x3217cd[_0x78ab06(0xda)];_0xddece8[_0x78ab06(0xe1)]=_0xddece8['number']['replace']('-','')[_0x78ab06(0xa5)]('\x20','');const _0x440fbc=Yup['object']()[_0x78ab06(0xbb)]({'number':Yup[_0x78ab06(0xfa)]()[_0x78ab06(0xcd)]()[_0x78ab06(0x90)](/^\d+$/,_0x78ab06(0xaf))});try{await _0x440fbc['validate'](_0xddece8);}catch(_0x3b966d){throw new AppError_1['default'](_0x3b966d[_0x78ab06(0xf3)]);}const _0x104564=await createContact(_0x4452d6,_0x5388cb,_0xddece8[_0x78ab06(0xe1)]);return _0xaf471d&&await(0x0,SendWhatsappMediaImage_1[_0x78ab06(0xe0)])({'ticket':_0x104564,'url':_0xaf471d,'caption':_0x34ff8a,'msdelay':_0x3705c7}),setTimeout(async()=>{const _0x3aed6b=_0x78ab06;await(0x0,UpdateTicketService_1[_0x3aed6b(0xe0)])({'ticketId':_0x104564['id'],'ticketData':{'status':_0x3aed6b(0xce),'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x5388cb});},0x64),setTimeout(async()=>{const _0x2694d1=_0x78ab06,{dateToClient:_0x4d3a3b}=(0x0,useDate_1[_0x2694d1(0xf1)])(),_0x5d8d52=_0x4d3a3b(new Date()),_0x571af5=(0x0,moment_1[_0x2694d1(0xe0)])()[_0x2694d1(0xec)](),_0x1988f3=await ApiUsages_1[_0x2694d1(0xe0)][_0x2694d1(0xd3)]({'where':{'dateUsed':_0x5d8d52,'companyId':_0x5388cb}});if(_0x1988f3)await _0x1988f3[_0x2694d1(0xf8)]({'usedImage':_0x1988f3[_0x2694d1(0xd4)][_0x2694d1(0xbf)]+0x1,'UsedOnDay':_0x1988f3['dataValues'][_0x2694d1(0xb9)]+0x1,'updatedAt':_0x571af5});else{const _0x5bae26=await ApiUsages_1[_0x2694d1(0xe0)]['create']({'companyId':_0x5388cb,'dateUsed':_0x5d8d52});await _0x5bae26[_0x2694d1(0xf8)]({'usedImage':_0x5bae26['dataValues'][_0x2694d1(0xbf)]+0x1,'UsedOnDay':_0x5bae26['dataValues']['UsedOnDay']+0x1,'updatedAt':_0x571af5});}},0x64),_0x504a60[_0x78ab06(0x9d)]({'status':'SUCCESS'});};exports[a8_0x36975c(0xd8)]=indexImage;const checkNumber=async(_0x5a47f5,_0xf12326)=>{const _0x191064=a8_0x36975c,_0x1ae8eb=_0x5a47f5[_0x191064(0x97)],_0x4b73bd=_0x5a47f5[_0x191064(0xd0)]['authorization'],[,_0x5b27f0]=_0x4b73bd[_0x191064(0xb6)]('\x20'),_0x4573a9=await Whatsapp_1[_0x191064(0xe0)][_0x191064(0xd3)]({'where':{'token':_0x5b27f0}}),_0x1d06f6=_0x4573a9[_0x191064(0xda)],_0x30663c=_0x1ae8eb['number'][_0x191064(0xa5)]('-','')[_0x191064(0xa5)]('\x20',''),_0xf862ff=await(0x0,GetDefaultWhatsApp_1[_0x191064(0xe0)])(_0x1d06f6),_0x15b660=(0x0,wbot_1['getWbot'])(_0xf862ff['id']),_0x29f16a=createJid(_0x30663c);try{const [_0x2b61f0]=await _0x15b660[_0x191064(0xc6)](_0x29f16a);if(_0x2b61f0['exists'])return setTimeout(async()=>{const _0x14fe61=_0x191064,{dateToClient:_0x38791e}=(0x0,useDate_1[_0x14fe61(0xf1)])(),_0x46f0b0=_0x38791e(new Date()),_0x547733=(0x0,moment_1[_0x14fe61(0xe0)])()[_0x14fe61(0xec)](),_0x295e75=await ApiUsages_1[_0x14fe61(0xe0)][_0x14fe61(0xd3)]({'where':{'dateUsed':_0x46f0b0,'companyId':_0x1d06f6}});if(_0x295e75)await _0x295e75['update']({'usedCheckNumber':_0x295e75[_0x14fe61(0xd4)][_0x14fe61(0x9e)]+0x1,'UsedOnDay':_0x295e75[_0x14fe61(0xd4)][_0x14fe61(0xb9)]+0x1,'updatedAt':_0x547733});else{const _0x55abd6=await ApiUsages_1[_0x14fe61(0xe0)][_0x14fe61(0xc4)]({'companyId':_0x1d06f6,'dateUsed':_0x46f0b0});await _0x55abd6['update']({'usedCheckNumber':_0x55abd6[_0x14fe61(0xd4)]['usedCheckNumber']+0x1,'UsedOnDay':_0x55abd6[_0x14fe61(0xd4)][_0x14fe61(0xb9)]+0x1,'updatedAt':_0x547733});}},0x64),_0xf12326['status'](0xc8)['json']({'existsInWhatsapp':!![],'number':_0x30663c,'numberFormatted':_0x2b61f0['jid']});}catch(_0x90c52c){return _0xf12326['status'](0x190)['json']({'existsInWhatsapp':![],'number':_0x29f16a,'error':_0x191064(0xad)});}};function a8_0x23d0(_0x335ebc,_0x1e5601){const _0x389ef0=a8_0x389e();return a8_0x23d0=function(_0x23d09a,_0x71d5de){_0x23d09a=_0x23d09a-0x90;let _0x25de6c=_0x389ef0[_0x23d09a];return _0x25de6c;},a8_0x23d0(_0x335ebc,_0x1e5601);}exports[a8_0x36975c(0xef)]=checkNumber;const indexWhatsappsId=async(_0x53c495,_0x35cd47)=>{const _0x185c28=a8_0x36975c;return _0x35cd47[_0x185c28(0xc0)](0xc8)[_0x185c28(0xca)]('oi');};exports[a8_0x36975c(0xaa)]=indexWhatsappsId;