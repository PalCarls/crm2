'use strict';function a8_0x452c(_0x51c537,_0x1ffe3c){const _0x367e73=a8_0x367e();return a8_0x452c=function(_0x452c5b,_0x2301f9){_0x452c5b=_0x452c5b-0xa1;let _0x16462e=_0x367e73[_0x452c5b];return _0x16462e;},a8_0x452c(_0x51c537,_0x1ffe3c);}const a8_0x4bd3ad=a8_0x452c;(function(_0x19affa,_0x283d3b){const _0x2259b2=a8_0x452c,_0x331dfa=_0x19affa();while(!![]){try{const _0x5c228a=-parseInt(_0x2259b2(0xc8))/0x1*(parseInt(_0x2259b2(0xe2))/0x2)+parseInt(_0x2259b2(0xc7))/0x3*(parseInt(_0x2259b2(0xbd))/0x4)+-parseInt(_0x2259b2(0x109))/0x5+parseInt(_0x2259b2(0xac))/0x6+-parseInt(_0x2259b2(0xcd))/0x7*(parseInt(_0x2259b2(0xfd))/0x8)+parseInt(_0x2259b2(0xfa))/0x9+parseInt(_0x2259b2(0xd2))/0xa;if(_0x5c228a===_0x283d3b)break;else _0x331dfa['push'](_0x331dfa['shift']());}catch(_0x4fc9c5){_0x331dfa['push'](_0x331dfa['shift']());}}}(a8_0x367e,0x57b42));var __createBinding=this&&this['__createBinding']||(Object[a8_0x4bd3ad(0xe1)]?function(_0x53c22d,_0x342877,_0x4a6dba,_0x3c05e8){const _0x5651ba=a8_0x4bd3ad;if(_0x3c05e8===undefined)_0x3c05e8=_0x4a6dba;var _0x3ab49a=Object['getOwnPropertyDescriptor'](_0x342877,_0x4a6dba);(!_0x3ab49a||('get'in _0x3ab49a?!_0x342877['__esModule']:_0x3ab49a['writable']||_0x3ab49a[_0x5651ba(0xff)]))&&(_0x3ab49a={'enumerable':!![],'get':function(){return _0x342877[_0x4a6dba];}}),Object[_0x5651ba(0xe0)](_0x53c22d,_0x3c05e8,_0x3ab49a);}:function(_0x450c6c,_0xa12974,_0x3e931e,_0x25ce87){if(_0x25ce87===undefined)_0x25ce87=_0x3e931e;_0x450c6c[_0x25ce87]=_0xa12974[_0x3e931e];}),__setModuleDefault=this&&this[a8_0x4bd3ad(0xc9)]||(Object[a8_0x4bd3ad(0xe1)]?function(_0x30c7ae,_0x2e8f90){const _0x4ce307=a8_0x4bd3ad;Object[_0x4ce307(0xe0)](_0x30c7ae,_0x4ce307(0xc4),{'enumerable':!![],'value':_0x2e8f90});}:function(_0x22c1b3,_0x466d2b){const _0x321a78=a8_0x4bd3ad;_0x22c1b3[_0x321a78(0xc4)]=_0x466d2b;}),__importStar=this&&this[a8_0x4bd3ad(0xe3)]||function(_0x416115){const _0x5333b0=a8_0x4bd3ad;if(_0x416115&&_0x416115[_0x5333b0(0xad)])return _0x416115;var _0x4fe4aa={};if(_0x416115!=null){for(var _0x4990c6 in _0x416115)if(_0x4990c6!=='default'&&Object['prototype'][_0x5333b0(0xf0)][_0x5333b0(0xc3)](_0x416115,_0x4990c6))__createBinding(_0x4fe4aa,_0x416115,_0x4990c6);}return __setModuleDefault(_0x4fe4aa,_0x416115),_0x4fe4aa;},__importDefault=this&&this[a8_0x4bd3ad(0xc1)]||function(_0x2998d3){const _0x1cd28f=a8_0x4bd3ad;return _0x2998d3&&_0x2998d3[_0x1cd28f(0xad)]?_0x2998d3:{'default':_0x2998d3};};Object[a8_0x4bd3ad(0xe0)](exports,a8_0x4bd3ad(0xad),{'value':!![]}),exports[a8_0x4bd3ad(0xb9)]=exports[a8_0x4bd3ad(0xf4)]=exports[a8_0x4bd3ad(0xdf)]=exports[a8_0x4bd3ad(0x102)]=exports[a8_0x4bd3ad(0xef)]=exports[a8_0x4bd3ad(0xf7)]=void 0x0;const Yup=__importStar(require(a8_0x4bd3ad(0xa9))),AppError_1=__importDefault(require('../errors/AppError')),GetDefaultWhatsApp_1=__importDefault(require(a8_0x4bd3ad(0xda))),SetTicketMessagesAsRead_1=__importDefault(require(a8_0x4bd3ad(0xf1))),Whatsapp_1=__importDefault(require(a8_0x4bd3ad(0xb0))),CreateOrUpdateContactService_1=__importDefault(require(a8_0x4bd3ad(0xc0))),FindOrCreateTicketService_1=__importDefault(require(a8_0x4bd3ad(0xb1))),CheckIsValidContact_1=__importDefault(require(a8_0x4bd3ad(0xd1))),CheckNumber_1=__importDefault(require(a8_0x4bd3ad(0xce))),SendWhatsAppMedia_1=__importDefault(require('../services/WbotServices/SendWhatsAppMedia')),UpdateTicketService_1=__importDefault(require(a8_0x4bd3ad(0xf9))),wbot_1=require(a8_0x4bd3ad(0xdd)),SendWhatsAppMessageLink_1=__importDefault(require('../services/WbotServices/SendWhatsAppMessageLink')),SendWhatsAppMessageAPI_1=__importDefault(require(a8_0x4bd3ad(0xa2))),SendWhatsappMediaImage_1=__importDefault(require('../services/WbotServices/SendWhatsappMediaImage')),ApiUsages_1=__importDefault(require(a8_0x4bd3ad(0xa5))),useDate_1=require(a8_0x4bd3ad(0xf3)),moment_1=__importDefault(require(a8_0x4bd3ad(0xb3))),CompaniesSettings_1=__importDefault(require(a8_0x4bd3ad(0x108))),ShowUserService_1=__importDefault(require(a8_0x4bd3ad(0xcb))),lodash_1=require(a8_0x4bd3ad(0xc6)),wbotMessageListener_1=require('../services/WbotServices/wbotMessageListener'),ShowQueueService_1=__importDefault(require(a8_0x4bd3ad(0xe9)));class OnWhatsAppDto{constructor(_0xb5059e,_0x453dc1){const _0x36e29c=a8_0x4bd3ad;this[_0x36e29c(0xae)]=_0xb5059e,this[_0x36e29c(0xaa)]=_0x453dc1;}}exports[a8_0x4bd3ad(0xf7)]=OnWhatsAppDto;const createContact=async(_0x53a8a2,_0x137bd7,_0x210e0d,_0x2f379f,_0x3b59f1)=>{const _0x58aaca=a8_0x4bd3ad;await(0x0,CheckIsValidContact_1[_0x58aaca(0xc4)])(_0x210e0d,_0x137bd7);const _0x288b61=await(0x0,CheckNumber_1['default'])(_0x210e0d,_0x137bd7),_0x435e90=_0x288b61,_0x53a576={'name':''+_0x435e90,'number':_0x435e90,'profilePicUrl':'','isGroup':![],'companyId':_0x137bd7},_0x120a9a=await(0x0,CreateOrUpdateContactService_1[_0x58aaca(0xc4)])(_0x53a576),_0x4e5893=await CompaniesSettings_1[_0x58aaca(0xc4)][_0x58aaca(0xca)]({'where':{'companyId':_0x137bd7}});let _0x16eda7;if(_0x53a8a2===undefined)_0x16eda7=await(0x0,GetDefaultWhatsApp_1[_0x58aaca(0xc4)])(_0x137bd7);else{_0x16eda7=await Whatsapp_1[_0x58aaca(0xc4)][_0x58aaca(0xdc)](_0x53a8a2);if(_0x16eda7===null)throw new AppError_1['default'](_0x58aaca(0x107)+_0x53a8a2+_0x58aaca(0xd7));}const {ticket:_0xf32c2,isCreated:_0x474942}=await(0x0,FindOrCreateTicketService_1[_0x58aaca(0xc4)])(_0x120a9a,_0x16eda7,0x0,_0x137bd7,_0x3b59f1,_0x2f379f,null,_0x58aaca(0xbb),null,![],_0x4e5893);return _0xf32c2&&(0x0,SetTicketMessagesAsRead_1[_0x58aaca(0xc4)])(_0xf32c2),_0xf32c2;};function formatBRNumber(_0x4c621e){const _0x32e43a=a8_0x4bd3ad,_0x5b258d=new RegExp(/^(\d{2})(\d{2})\d{1}(\d{8})$/);if(_0x5b258d['test'](_0x4c621e)){const _0x315ace=_0x5b258d[_0x32e43a(0xd0)](_0x4c621e);if(_0x315ace&&_0x315ace[0x1]==='55'&&Number[_0x32e43a(0xd4)](Number[_0x32e43a(0x10b)](_0x315ace[0x2]))){const _0x21b1da=Number[_0x32e43a(0x10b)](_0x315ace[0x2]);if(_0x21b1da<0x1f)return _0x315ace[0x0];else{if(_0x21b1da>=0x1f)return _0x315ace[0x1]+_0x315ace[0x2]+_0x315ace[0x3];}}}else return _0x4c621e;}function createJid(_0x38d73a){const _0xf1d1bf=a8_0x4bd3ad;if(_0x38d73a['includes'](_0xf1d1bf(0xb2))||_0x38d73a[_0xf1d1bf(0x101)](_0xf1d1bf(0xa6)))return formatBRNumber(_0x38d73a);return _0x38d73a['includes']('-')?_0x38d73a+_0xf1d1bf(0xb2):formatBRNumber(_0x38d73a)+_0xf1d1bf(0xa6);}const indexLink=async(_0x1bfeb5,_0x53fc10)=>{const _0xe3a659=a8_0x4bd3ad,_0x1d2676=_0x1bfeb5[_0xe3a659(0xe8)],{whatsappId:_0x468f72}=_0x1bfeb5[_0xe3a659(0xe8)],{msdelay:_0x4a8c08}=_0x1bfeb5['body'],_0x1ee89f=_0x1bfeb5[_0xe3a659(0xe8)]['url'],_0x43b50e=_0x1bfeb5[_0xe3a659(0xe8)][_0xe3a659(0xc5)],_0x146973=_0x1bfeb5['headers'][_0xe3a659(0xee)],[,_0x2ea153]=_0x146973[_0xe3a659(0xfe)]('\x20'),_0x198492=await Whatsapp_1[_0xe3a659(0xc4)]['findOne']({'where':{'token':_0x2ea153}}),_0x300f1e=_0x198492[_0xe3a659(0xb6)];_0x1d2676[_0xe3a659(0xbf)]=_0x1d2676['number']['replace']('-','')[_0xe3a659(0xd9)]('\x20','');const _0x4cbc54=Yup[_0xe3a659(0xab)]()[_0xe3a659(0xd3)]({'number':Yup[_0xe3a659(0xd5)]()[_0xe3a659(0x106)]()[_0xe3a659(0xf2)](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0x4cbc54['validate'](_0x1d2676);}catch(_0x30c330){throw new AppError_1[(_0xe3a659(0xc4))](_0x30c330[_0xe3a659(0xe5)]);}const _0x43b02e=await createContact(_0x468f72,_0x300f1e,_0x1d2676['number']);if(!_0x43b02e)throw new AppError_1[(_0xe3a659(0xc4))](_0xe3a659(0xba));return await(0x0,SendWhatsAppMessageLink_1[_0xe3a659(0xc4)])({'whatsappId':_0x468f72,'contact':_0x43b02e['contact'],'url':_0x1ee89f,'caption':_0x43b50e,'msdelay':_0x4a8c08}),setTimeout(async()=>{const _0x400fce=_0xe3a659,{dateToClient:_0x4fc1e6}=(0x0,useDate_1['useDate'])(),_0x3e7e6d=_0x4fc1e6(new Date()),_0x3ffd4a=(0x0,moment_1[_0x400fce(0xc4)])()[_0x400fce(0x105)](),_0x34981b=await ApiUsages_1['default'][_0x400fce(0xca)]({'where':{'dateUsed':_0x3e7e6d,'companyId':_0x300f1e}});if(_0x34981b)await _0x34981b[_0x400fce(0xb7)]({'usedPDF':_0x34981b[_0x400fce(0x100)]['usedPDF']+0x1,'UsedOnDay':_0x34981b[_0x400fce(0x100)][_0x400fce(0xb4)]+0x1,'updatedAt':_0x3ffd4a});else{const _0x3a9f21=await ApiUsages_1[_0x400fce(0xc4)][_0x400fce(0xe1)]({'companyId':_0x300f1e,'dateUsed':_0x3e7e6d});await _0x3a9f21[_0x400fce(0xb7)]({'usedPDF':_0x3a9f21[_0x400fce(0x100)]['usedPDF']+0x1,'UsedOnDay':_0x3a9f21[_0x400fce(0x100)]['UsedOnDay']+0x1,'updatedAt':_0x3ffd4a});}},0x64),_0x53fc10[_0xe3a659(0xec)]({'status':'SUCCESS'});};exports[a8_0x4bd3ad(0xef)]=indexLink;const index=async(_0x4f9178,_0x4f890a)=>{const _0x81c3bd=a8_0x4bd3ad,_0x34540c=_0x4f9178[_0x81c3bd(0xe8)],{whatsappId:_0x45a41c}=_0x4f9178[_0x81c3bd(0xe8)],{msdelay:_0x24034d}=_0x4f9178[_0x81c3bd(0xe8)],{body:_0x446586,quotedMsg:_0xa0e1df,userId:_0x3f3b88,queueId:_0x4196f9,sendSignature:sendSignature=![],closeTicket:closeTicket=![]}=_0x4f9178['body'],_0x532756=_0x4f9178[_0x81c3bd(0xdb)],_0x15e814=_0x4f9178[_0x81c3bd(0xe7)][_0x81c3bd(0xee)],[,_0xf402e1]=_0x15e814[_0x81c3bd(0xfe)]('\x20'),_0x12505f=await Whatsapp_1[_0x81c3bd(0xc4)][_0x81c3bd(0xca)]({'where':{'token':_0xf402e1}}),_0xa59ade=_0x12505f[_0x81c3bd(0xb6)];_0x34540c[_0x81c3bd(0xbf)]=_0x34540c[_0x81c3bd(0xbf)][_0x81c3bd(0xd9)]('-','')[_0x81c3bd(0xd9)]('\x20','');const _0x52cda6=Yup[_0x81c3bd(0xab)]()['shape']({'number':Yup['string']()[_0x81c3bd(0x106)]()[_0x81c3bd(0xf2)](/^\d+$/,_0x81c3bd(0xed))});try{await _0x52cda6['validate'](_0x34540c);}catch(_0x2e4fb9){throw new AppError_1[(_0x81c3bd(0xc4))](_0x2e4fb9[_0x81c3bd(0xe5)]);}let _0x506cee;_0x3f3b88?.[_0x81c3bd(0x103)]()!==''&&!isNaN(_0x3f3b88)&&(_0x506cee=await(0x0,ShowUserService_1[_0x81c3bd(0xc4)])(_0x3f3b88,_0xa59ade));let _0xba65e5;_0x4196f9?.['toString']()!==''&&!isNaN(_0x4196f9)&&(_0xba65e5=await(0x0,ShowQueueService_1[_0x81c3bd(0xc4)])(_0x4196f9,_0xa59ade));const _0x287939=await createContact(_0x12505f['id'],_0xa59ade,_0x34540c['number'],_0x3f3b88,_0x4196f9);let _0x5596d1;sendSignature&&!(0x0,lodash_1['isNil'])(_0x506cee)?_0x5596d1='*'+_0x506cee[_0x81c3bd(0xd6)]+_0x81c3bd(0xbe)+_0x446586[_0x81c3bd(0xea)]():_0x5596d1=_0x446586['trim']();let _0x3c3b2c;_0x532756?(await Promise['all'](_0x532756[_0x81c3bd(0xde)](async _0xc63c29=>{const _0x51499e=_0x81c3bd;_0x3c3b2c=await(0x0,SendWhatsAppMedia_1[_0x51499e(0xc4)])({'body':'‎\x20'+_0x5596d1,'media':_0xc63c29,'ticket':_0x287939,'isForwarded':![]});})),await(0x0,wbotMessageListener_1[_0x81c3bd(0xc2)])(_0x3c3b2c,_0x287939,_0x287939[_0x81c3bd(0x10a)])):(_0x3c3b2c=await(0x0,SendWhatsAppMessageAPI_1[_0x81c3bd(0xc4)])({'body':'‎\x20'+_0x5596d1,'whatsappId':_0x12505f['id'],'contact':_0x287939[_0x81c3bd(0x10a)],'quotedMsg':_0xa0e1df,'msdelay':_0x24034d}),await(0x0,wbotMessageListener_1[_0x81c3bd(0xa3)])(_0x3c3b2c,_0x287939,_0x287939[_0x81c3bd(0x10a)]));if(closeTicket)setTimeout(async()=>{const _0x40cacf=_0x81c3bd;await(0x0,UpdateTicketService_1[_0x40cacf(0xc4)])({'ticketId':_0x287939['id'],'ticketData':{'status':_0x40cacf(0xe6),'sendFarewellMessage':![],'amountUsedBotQueues':0x0,'lastMessage':_0x446586},'companyId':_0xa59ade});},0x64);else _0x3f3b88?.[_0x81c3bd(0x103)]()!==''&&!isNaN(_0x3f3b88)&&setTimeout(async()=>{const _0x4e883e=_0x81c3bd;await(0x0,UpdateTicketService_1[_0x4e883e(0xc4)])({'ticketId':_0x287939['id'],'ticketData':{'status':'open','amountUsedBotQueues':0x0,'lastMessage':_0x446586,'userId':_0x3f3b88,'queueId':_0x4196f9},'companyId':_0xa59ade});},0x64);return setTimeout(async()=>{const _0x104b60=_0x81c3bd,{dateToClient:_0xb2a55b}=(0x0,useDate_1[_0x104b60(0xeb)])(),_0x47cc93=_0xb2a55b(new Date()),_0x484c43=(0x0,moment_1[_0x104b60(0xc4)])()['format']();let _0x440b3a=await ApiUsages_1[_0x104b60(0xc4)][_0x104b60(0xca)]({'where':{'dateUsed':_0x47cc93,'companyId':_0xa59ade}});_0x440b3a?_0x532756?await Promise[_0x104b60(0xd8)](_0x532756[_0x104b60(0xde)](async _0x28fe72=>{const _0x17323f=_0x104b60;if(_0x28fe72[_0x17323f(0xb8)][_0x17323f(0x101)](_0x17323f(0xf8)))await _0x440b3a[_0x17323f(0xb7)]({'usedPDF':_0x440b3a[_0x17323f(0x100)]['usedPDF']+0x1,'UsedOnDay':_0x440b3a[_0x17323f(0x100)][_0x17323f(0xb4)]+0x1,'updatedAt':_0x484c43});else{if(_0x28fe72[_0x17323f(0xb8)][_0x17323f(0x101)](_0x17323f(0xe4)))await _0x440b3a[_0x17323f(0xb7)]({'usedImage':_0x440b3a[_0x17323f(0x100)][_0x17323f(0x104)]+0x1,'UsedOnDay':_0x440b3a[_0x17323f(0x100)][_0x17323f(0xb4)]+0x1,'updatedAt':_0x484c43});else _0x28fe72[_0x17323f(0xb8)][_0x17323f(0x101)](_0x17323f(0xfc))?await _0x440b3a[_0x17323f(0xb7)]({'usedVideo':_0x440b3a['dataValues']['usedVideo']+0x1,'UsedOnDay':_0x440b3a['dataValues'][_0x17323f(0xb4)]+0x1,'updatedAt':_0x484c43}):await _0x440b3a[_0x17323f(0xb7)]({'usedOther':_0x440b3a[_0x17323f(0x100)]['usedOther']+0x1,'UsedOnDay':_0x440b3a['dataValues'][_0x17323f(0xb4)]+0x1,'updatedAt':_0x484c43});}})):await _0x440b3a['update']({'usedText':_0x440b3a['dataValues'][_0x104b60(0xfb)]+0x1,'UsedOnDay':_0x440b3a[_0x104b60(0x100)]['UsedOnDay']+0x1,'updatedAt':_0x484c43}):(_0x440b3a=await ApiUsages_1[_0x104b60(0xc4)]['create']({'companyId':_0xa59ade,'dateUsed':_0x47cc93}),_0x532756?await Promise[_0x104b60(0xd8)](_0x532756[_0x104b60(0xde)](async _0x28f2b6=>{const _0x447b2c=_0x104b60;if(_0x28f2b6[_0x447b2c(0xb8)][_0x447b2c(0x101)](_0x447b2c(0xf8)))await _0x440b3a[_0x447b2c(0xb7)]({'usedPDF':_0x440b3a['dataValues'][_0x447b2c(0xcc)]+0x1,'UsedOnDay':_0x440b3a[_0x447b2c(0x100)]['UsedOnDay']+0x1,'updatedAt':_0x484c43});else{if(_0x28f2b6[_0x447b2c(0xb8)][_0x447b2c(0x101)]('image'))await _0x440b3a[_0x447b2c(0xb7)]({'usedImage':_0x440b3a[_0x447b2c(0x100)][_0x447b2c(0x104)]+0x1,'UsedOnDay':_0x440b3a['dataValues'][_0x447b2c(0xb4)]+0x1,'updatedAt':_0x484c43});else _0x28f2b6[_0x447b2c(0xb8)]['includes']('video')?await _0x440b3a[_0x447b2c(0xb7)]({'usedVideo':_0x440b3a['dataValues'][_0x447b2c(0xa4)]+0x1,'UsedOnDay':_0x440b3a['dataValues'][_0x447b2c(0xb4)]+0x1,'updatedAt':_0x484c43}):await _0x440b3a[_0x447b2c(0xb7)]({'usedOther':_0x440b3a[_0x447b2c(0x100)][_0x447b2c(0xf5)]+0x1,'UsedOnDay':_0x440b3a[_0x447b2c(0x100)][_0x447b2c(0xb4)]+0x1,'updatedAt':_0x484c43});}})):await _0x440b3a[_0x104b60(0xb7)]({'usedText':_0x440b3a[_0x104b60(0x100)][_0x104b60(0xfb)]+0x1,'UsedOnDay':_0x440b3a[_0x104b60(0x100)]['UsedOnDay']+0x1,'updatedAt':_0x484c43}));},0x64),_0x4f890a['send']({'status':_0x81c3bd(0xa7)});};exports[a8_0x4bd3ad(0x102)]=index;const indexImage=async(_0x44c24b,_0x1bdf1b)=>{const _0x4362fa=a8_0x4bd3ad,_0x4d1d8d=_0x44c24b[_0x4362fa(0xe8)],{whatsappId:_0x37a038}=_0x44c24b['body'],{msdelay:_0x594157}=_0x44c24b[_0x4362fa(0xe8)],_0x4ab632=_0x44c24b[_0x4362fa(0xe8)][_0x4362fa(0xcf)],_0x1a90dd=_0x44c24b[_0x4362fa(0xe8)]['caption'],_0x453928=_0x44c24b[_0x4362fa(0xe7)][_0x4362fa(0xee)],[,_0x3d0e9f]=_0x453928['split']('\x20'),_0x5a1d2a=await Whatsapp_1[_0x4362fa(0xc4)][_0x4362fa(0xca)]({'where':{'token':_0x3d0e9f}}),_0x8d72aa=_0x5a1d2a[_0x4362fa(0xb6)];_0x4d1d8d[_0x4362fa(0xbf)]=_0x4d1d8d['number'][_0x4362fa(0xd9)]('-','')[_0x4362fa(0xd9)]('\x20','');const _0x7d532f=Yup['object']()['shape']({'number':Yup[_0x4362fa(0xd5)]()[_0x4362fa(0x106)]()['matches'](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0x7d532f['validate'](_0x4d1d8d);}catch(_0x58624e){throw new AppError_1[(_0x4362fa(0xc4))](_0x58624e[_0x4362fa(0xe5)]);}const _0x2ac6e0=await createContact(_0x37a038,_0x8d72aa,_0x4d1d8d['number']);return _0x4ab632&&await(0x0,SendWhatsappMediaImage_1[_0x4362fa(0xc4)])({'ticket':_0x2ac6e0,'url':_0x4ab632,'caption':_0x1a90dd,'msdelay':_0x594157}),setTimeout(async()=>{const _0x3d7448=_0x4362fa;await(0x0,UpdateTicketService_1['default'])({'ticketId':_0x2ac6e0['id'],'ticketData':{'status':_0x3d7448(0xe6),'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x8d72aa});},0x64),setTimeout(async()=>{const _0x498bc3=_0x4362fa,{dateToClient:_0x57e190}=(0x0,useDate_1[_0x498bc3(0xeb)])(),_0x47a665=_0x57e190(new Date()),_0x32b449=(0x0,moment_1[_0x498bc3(0xc4)])()[_0x498bc3(0x105)](),_0x30fe96=await ApiUsages_1['default']['findOne']({'where':{'dateUsed':_0x47a665,'companyId':_0x8d72aa}});if(_0x30fe96)await _0x30fe96[_0x498bc3(0xb7)]({'usedImage':_0x30fe96['dataValues'][_0x498bc3(0x104)]+0x1,'UsedOnDay':_0x30fe96[_0x498bc3(0x100)][_0x498bc3(0xb4)]+0x1,'updatedAt':_0x32b449});else{const _0x475f61=await ApiUsages_1[_0x498bc3(0xc4)][_0x498bc3(0xe1)]({'companyId':_0x8d72aa,'dateUsed':_0x47a665});await _0x475f61[_0x498bc3(0xb7)]({'usedImage':_0x475f61['dataValues'][_0x498bc3(0x104)]+0x1,'UsedOnDay':_0x475f61[_0x498bc3(0x100)]['UsedOnDay']+0x1,'updatedAt':_0x32b449});}},0x64),_0x1bdf1b['send']({'status':'SUCCESS'});};exports[a8_0x4bd3ad(0xdf)]=indexImage;const checkNumber=async(_0x591c3b,_0xdeff7)=>{const _0x11df70=a8_0x4bd3ad,_0x4da3cf=_0x591c3b['body'],_0xe8d1a6=_0x591c3b[_0x11df70(0xe7)][_0x11df70(0xee)],[,_0x1005ef]=_0xe8d1a6[_0x11df70(0xfe)]('\x20'),_0x3608cc=await Whatsapp_1[_0x11df70(0xc4)]['findOne']({'where':{'token':_0x1005ef}}),_0x77f52=_0x3608cc[_0x11df70(0xb6)],_0x44475d=_0x4da3cf['number'][_0x11df70(0xd9)]('-','')['replace']('\x20',''),_0xba1066=await(0x0,GetDefaultWhatsApp_1[_0x11df70(0xc4)])(_0x77f52),_0x562534=(0x0,wbot_1[_0x11df70(0xaf)])(_0xba1066['id']),_0xe18f7d=createJid(_0x44475d);try{const [_0x5406e7]=await _0x562534[_0x11df70(0xbc)](_0xe18f7d);if(_0x5406e7[_0x11df70(0xaa)])return setTimeout(async()=>{const _0x52b7ec=_0x11df70,{dateToClient:_0xff2df1}=(0x0,useDate_1['useDate'])(),_0x90b262=_0xff2df1(new Date()),_0x17cf88=(0x0,moment_1[_0x52b7ec(0xc4)])()[_0x52b7ec(0x105)](),_0x57b767=await ApiUsages_1[_0x52b7ec(0xc4)]['findOne']({'where':{'dateUsed':_0x90b262,'companyId':_0x77f52}});if(_0x57b767)await _0x57b767[_0x52b7ec(0xb7)]({'usedCheckNumber':_0x57b767[_0x52b7ec(0x100)][_0x52b7ec(0xf6)]+0x1,'UsedOnDay':_0x57b767[_0x52b7ec(0x100)][_0x52b7ec(0xb4)]+0x1,'updatedAt':_0x17cf88});else{const _0xa0146d=await ApiUsages_1[_0x52b7ec(0xc4)][_0x52b7ec(0xe1)]({'companyId':_0x77f52,'dateUsed':_0x90b262});await _0xa0146d['update']({'usedCheckNumber':_0xa0146d[_0x52b7ec(0x100)][_0x52b7ec(0xf6)]+0x1,'UsedOnDay':_0xa0146d[_0x52b7ec(0x100)][_0x52b7ec(0xb4)]+0x1,'updatedAt':_0x17cf88});}},0x64),_0xdeff7['status'](0xc8)[_0x11df70(0xa1)]({'existsInWhatsapp':!![],'number':_0x44475d,'numberFormatted':_0x5406e7[_0x11df70(0xae)]});}catch(_0x4c2f37){return _0xdeff7[_0x11df70(0xb5)](0x190)[_0x11df70(0xa1)]({'existsInWhatsapp':![],'number':_0xe18f7d,'error':_0x11df70(0xa8)});}};exports[a8_0x4bd3ad(0xf4)]=checkNumber;function a8_0x367e(){const _0x58a1f2=['video','88fudMCD','split','configurable','dataValues','includes','index','toString','usedImage','format','required','whatsapp\x20#','../models/CompaniesSettings','3473530FZtRyn','contact','parseInt','json','../services/WbotServices/SendWhatsAppMessageAPI','verifyMessage','usedVideo','../models/ApiUsages','@s.whatsapp.net','SUCCESS','Not\x20exists\x20on\x20Whatsapp','yup','exists','object','311796imwTlU','__esModule','jid','getWbot','../models/Whatsapp','../services/TicketServices/FindOrCreateTicketService','@g.us','moment','UsedOnDay','status','companyId','update','mimetype','indexWhatsappsId','Cliente\x20em\x20outro\x20atendimento','whatsapp','onWhatsApp','27364CpDEJW',':*\x0a','number','../services/ContactServices/CreateOrUpdateContactService','__importDefault','verifyMediaMessage','call','default','caption','lodash','12JZkEOS','1766GuBdgM','__setModuleDefault','findOne','../services/UserServices/ShowUserService','usedPDF','186361WxoJqj','../services/WbotServices/CheckNumber','url','exec','../services/WbotServices/CheckIsValidContact','14703020PbwtQF','shape','isInteger','string','name','\x20not\x20found','all','replace','../helpers/GetDefaultWhatsApp','files','findByPk','../libs/wbot','map','indexImage','defineProperty','create','676aQfdKz','__importStar','image','message','closed','headers','body','../services/QueueService/ShowQueueService','trim','useDate','send','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','authorization','indexLink','hasOwnProperty','../helpers/SetTicketMessagesAsRead','matches','../utils/useDate','checkNumber','usedOther','usedCheckNumber','OnWhatsAppDto','pdf','../services/TicketServices/UpdateTicketService','3546621GyqiCk','usedText'];a8_0x367e=function(){return _0x58a1f2;};return a8_0x367e();}const indexWhatsappsId=async(_0x35aeeb,_0x14b60c)=>{const _0x49f9c6=a8_0x4bd3ad;return _0x14b60c[_0x49f9c6(0xb5)](0xc8)[_0x49f9c6(0xa1)]('oi');};exports[a8_0x4bd3ad(0xb9)]=indexWhatsappsId;