'use strict';const a8_0x3352f4=a8_0x1011;(function(_0x22f9b3,_0x5c5571){const _0x579e1d=a8_0x1011,_0x320f30=_0x22f9b3();while(!![]){try{const _0x4f1566=parseInt(_0x579e1d(0xca))/0x1+parseInt(_0x579e1d(0xcb))/0x2+-parseInt(_0x579e1d(0xfd))/0x3+parseInt(_0x579e1d(0xc4))/0x4+parseInt(_0x579e1d(0x10d))/0x5+parseInt(_0x579e1d(0xf9))/0x6+parseInt(_0x579e1d(0x10f))/0x7*(-parseInt(_0x579e1d(0xf7))/0x8);if(_0x4f1566===_0x5c5571)break;else _0x320f30['push'](_0x320f30['shift']());}catch(_0x4b220e){_0x320f30['push'](_0x320f30['shift']());}}}(a8_0x5ccb,0xb2d0f));function a8_0x1011(_0x393b62,_0x41ce01){const _0x5ccbbe=a8_0x5ccb();return a8_0x1011=function(_0x1011e0,_0x46d72d){_0x1011e0=_0x1011e0-0xa6;let _0x4619dc=_0x5ccbbe[_0x1011e0];return _0x4619dc;},a8_0x1011(_0x393b62,_0x41ce01);}var __createBinding=this&&this[a8_0x3352f4(0x103)]||(Object['create']?function(_0x2d2da2,_0x1c506f,_0x5ea2b8,_0x2133d8){const _0x2e66b9=a8_0x3352f4;if(_0x2133d8===undefined)_0x2133d8=_0x5ea2b8;var _0x376d9e=Object[_0x2e66b9(0xe2)](_0x1c506f,_0x5ea2b8);(!_0x376d9e||(_0x2e66b9(0xc5)in _0x376d9e?!_0x1c506f[_0x2e66b9(0xb1)]:_0x376d9e[_0x2e66b9(0xb7)]||_0x376d9e['configurable']))&&(_0x376d9e={'enumerable':!![],'get':function(){return _0x1c506f[_0x5ea2b8];}}),Object[_0x2e66b9(0x104)](_0x2d2da2,_0x2133d8,_0x376d9e);}:function(_0x14c9c6,_0x53e15b,_0x2dfaea,_0x2c6149){if(_0x2c6149===undefined)_0x2c6149=_0x2dfaea;_0x14c9c6[_0x2c6149]=_0x53e15b[_0x2dfaea];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a8_0x3352f4(0xbc)]?function(_0xb3461a,_0x3a68c4){const _0x57df69=a8_0x3352f4;Object[_0x57df69(0x104)](_0xb3461a,'default',{'enumerable':!![],'value':_0x3a68c4});}:function(_0x302fdb,_0xa884d4){const _0x28dc5e=a8_0x3352f4;_0x302fdb[_0x28dc5e(0xe7)]=_0xa884d4;}),__importStar=this&&this['__importStar']||function(_0xdf53c){const _0x17be52=a8_0x3352f4;if(_0xdf53c&&_0xdf53c[_0x17be52(0xb1)])return _0xdf53c;var _0x300bc4={};if(_0xdf53c!=null){for(var _0x18c748 in _0xdf53c)if(_0x18c748!==_0x17be52(0xe7)&&Object[_0x17be52(0xcd)][_0x17be52(0x111)][_0x17be52(0xfe)](_0xdf53c,_0x18c748))__createBinding(_0x300bc4,_0xdf53c,_0x18c748);}return __setModuleDefault(_0x300bc4,_0xdf53c),_0x300bc4;},__importDefault=this&&this[a8_0x3352f4(0xb9)]||function(_0x3d3b49){const _0x1f9e0e=a8_0x3352f4;return _0x3d3b49&&_0x3d3b49[_0x1f9e0e(0xb1)]?_0x3d3b49:{'default':_0x3d3b49};};Object[a8_0x3352f4(0x104)](exports,'__esModule',{'value':!![]}),exports[a8_0x3352f4(0xd5)]=exports[a8_0x3352f4(0xb6)]=exports[a8_0x3352f4(0xdb)]=exports[a8_0x3352f4(0xcf)]=exports[a8_0x3352f4(0xa7)]=exports[a8_0x3352f4(0xd6)]=void 0x0;const Yup=__importStar(require(a8_0x3352f4(0xba))),AppError_1=__importDefault(require(a8_0x3352f4(0x106))),GetDefaultWhatsApp_1=__importDefault(require('../helpers/GetDefaultWhatsApp')),SetTicketMessagesAsRead_1=__importDefault(require('../helpers/SetTicketMessagesAsRead')),Whatsapp_1=__importDefault(require(a8_0x3352f4(0xfb))),CreateOrUpdateContactService_1=__importDefault(require(a8_0x3352f4(0xb3))),FindOrCreateTicketService_1=__importDefault(require(a8_0x3352f4(0xac))),ShowTicketService_1=__importDefault(require(a8_0x3352f4(0xdf))),CheckIsValidContact_1=__importDefault(require(a8_0x3352f4(0xf3))),CheckNumber_1=__importDefault(require(a8_0x3352f4(0xeb))),SendWhatsAppMedia_1=__importDefault(require(a8_0x3352f4(0xf2))),UpdateTicketService_1=__importDefault(require(a8_0x3352f4(0xc9))),wbot_1=require('../libs/wbot'),SendWhatsAppMessageLink_1=__importDefault(require(a8_0x3352f4(0xe5))),SendWhatsAppMessageAPI_1=__importDefault(require('../services/WbotServices/SendWhatsAppMessageAPI')),SendWhatsappMediaImage_1=__importDefault(require(a8_0x3352f4(0xb4))),ApiUsages_1=__importDefault(require(a8_0x3352f4(0xbd))),useDate_1=require(a8_0x3352f4(0xbb)),moment_1=__importDefault(require('moment')),CompaniesSettings_1=__importDefault(require(a8_0x3352f4(0xc8))),ShowUserService_1=__importDefault(require(a8_0x3352f4(0x109))),lodash_1=require('lodash'),wbotMessageListener_1=require(a8_0x3352f4(0xe4)),ShowQueueService_1=__importDefault(require(a8_0x3352f4(0x100)));class OnWhatsAppDto{constructor(_0x321ba4,_0x246ba2){const _0x285815=a8_0x3352f4;this[_0x285815(0x105)]=_0x321ba4,this[_0x285815(0xc2)]=_0x246ba2;}}exports[a8_0x3352f4(0xd6)]=OnWhatsAppDto;const createContact=async(_0x4aecf8,_0x21e9fd,_0x467d1,_0x2bc852,_0x20c4b2)=>{const _0x24a2be=a8_0x3352f4;await(0x0,CheckIsValidContact_1[_0x24a2be(0xe7)])(_0x467d1,_0x21e9fd);const _0x452995=await(0x0,CheckNumber_1['default'])(_0x467d1,_0x21e9fd),_0x1494b3=process['env']['FRONTEND_URL']+_0x24a2be(0xde),_0x217019=_0x452995,_0x1bb9e8={'name':''+_0x217019,'number':_0x217019,'profilePicUrl':_0x1494b3,'isGroup':![],'companyId':_0x21e9fd},_0x2b89fa=await(0x0,CreateOrUpdateContactService_1[_0x24a2be(0xe7)])(_0x1bb9e8),_0xdacf9=await CompaniesSettings_1[_0x24a2be(0xe7)][_0x24a2be(0xaa)]({'where':{'companyId':_0x21e9fd}});let _0x20dca3;if(_0x4aecf8===undefined)_0x20dca3=await(0x0,GetDefaultWhatsApp_1[_0x24a2be(0xe7)])(_0x21e9fd);else{_0x20dca3=await Whatsapp_1[_0x24a2be(0xe7)][_0x24a2be(0xe8)](_0x4aecf8);if(_0x20dca3===null)throw new AppError_1['default'](_0x24a2be(0xda)+_0x4aecf8+'\x20not\x20found');}const {ticket:_0x51058d,isCreated:_0x3670dc}=await(0x0,FindOrCreateTicketService_1['default'])(_0x2b89fa,_0x20dca3,0x0,_0x21e9fd,_0x20c4b2,_0x2bc852,null,_0x24a2be(0xe6),null,![],_0xdacf9);let _0x13bae3;return _0x51058d&&(_0x13bae3=await(0x0,ShowTicketService_1[_0x24a2be(0xe7)])(_0x51058d['id'],_0x21e9fd),(0x0,SetTicketMessagesAsRead_1[_0x24a2be(0xe7)])(_0x13bae3)),_0x13bae3;};function a8_0x5ccb(){const _0x29fb98=[':*\x0a','findOne','usedImage','../services/TicketServices/FindOrCreateTicketService','isInteger','json','shape','update','__esModule','object','../services/ContactServices/CreateOrUpdateContactService','../services/WbotServices/SendWhatsappMediaImage','matches','checkNumber','writable','usedCheckNumber','__importDefault','yup','../utils/useDate','create','../models/ApiUsages','headers','pdf','log','mimetype','exists','parseInt','5621904VmLJPD','get','SUCCESS','video','../models/CompaniesSettings','../services/TicketServices/UpdateTicketService','1193699opmrEe','1229962BjvHjn','usedText','prototype','all','index','body','isNil','companyId','status','onWhatsApp','indexWhatsappsId','OnWhatsAppDto','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','@s.whatsapp.net','getWbot','whatsapp\x20#','indexImage','usedOther','name','/nopicture.png','../services/TicketServices/ShowTicketService','verifyMediaMessage','replace','getOwnPropertyDescriptor','@g.us','../services/WbotServices/wbotMessageListener','../services/WbotServices/SendWhatsAppMessageLink','whatsapp','default','findByPk','string','verifyMessage','../services/WbotServices/CheckNumber','API','authorization','exec','send','UsedOnDay','map','../services/WbotServices/SendWhatsAppMedia','../services/WbotServices/CheckIsValidContact','format','includes','caption','32JpBVAQ','image','8571012jRwyHd','dataValues','../models/Whatsapp','Cliente\x20em\x20outro\x20atendimento','2498289bgyPAp','call','contact','../services/QueueService/ShowQueueService','validate','usedPDF','__createBinding','defineProperty','jid','../errors/AppError','required','trim','../services/UserServices/ShowUserService','usedVideo','closed','split','5893660yZuAqI','useDate','7448343gdklLh','url','hasOwnProperty','message','indexLink','number'];a8_0x5ccb=function(){return _0x29fb98;};return a8_0x5ccb();}function formatBRNumber(_0x1a2b41){const _0x4b0dfc=a8_0x3352f4,_0x2bc631=new RegExp(/^(\d{2})(\d{2})\d{1}(\d{8})$/);if(_0x2bc631['test'](_0x1a2b41)){const _0x2db15f=_0x2bc631[_0x4b0dfc(0xee)](_0x1a2b41);if(_0x2db15f&&_0x2db15f[0x1]==='55'&&Number[_0x4b0dfc(0xad)](Number[_0x4b0dfc(0xc3)](_0x2db15f[0x2]))){const _0x4ffe80=Number[_0x4b0dfc(0xc3)](_0x2db15f[0x2]);if(_0x4ffe80<0x1f)return _0x2db15f[0x0];else{if(_0x4ffe80>=0x1f)return _0x2db15f[0x1]+_0x2db15f[0x2]+_0x2db15f[0x3];}}}else return _0x1a2b41;}function createJid(_0x3a6471){const _0x2e4d07=a8_0x3352f4;if(_0x3a6471['includes'](_0x2e4d07(0xe3))||_0x3a6471[_0x2e4d07(0xf5)](_0x2e4d07(0xd8)))return formatBRNumber(_0x3a6471);return _0x3a6471[_0x2e4d07(0xf5)]('-')?_0x3a6471+'@g.us':formatBRNumber(_0x3a6471)+'@s.whatsapp.net';}const indexLink=async(_0x1ce4b5,_0x376e57)=>{const _0x392717=a8_0x3352f4,_0x8e7d1d=_0x1ce4b5[_0x392717(0xd0)],{whatsappId:_0x4aa0bd}=_0x1ce4b5[_0x392717(0xd0)],{msdelay:_0x49f070}=_0x1ce4b5[_0x392717(0xd0)],_0x3cbebe=_0x1ce4b5[_0x392717(0xd0)][_0x392717(0x110)],_0x45f898=_0x1ce4b5[_0x392717(0xd0)]['caption'],_0x22344a=_0x1ce4b5[_0x392717(0xbe)][_0x392717(0xed)],[,_0x249f6a]=_0x22344a[_0x392717(0x10c)]('\x20'),_0x2c7f8d=await Whatsapp_1[_0x392717(0xe7)][_0x392717(0xaa)]({'where':{'token':_0x249f6a}}),_0x91f4ee=_0x2c7f8d[_0x392717(0xd2)];_0x8e7d1d[_0x392717(0xa8)]=_0x8e7d1d[_0x392717(0xa8)][_0x392717(0xe1)]('-','')[_0x392717(0xe1)]('\x20','');const _0x135fef=Yup['object']()[_0x392717(0xaf)]({'number':Yup['string']()['required']()[_0x392717(0xb5)](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0x135fef[_0x392717(0x101)](_0x8e7d1d);}catch(_0x2473a2){throw new AppError_1[(_0x392717(0xe7))](_0x2473a2['message']);}const _0x2e9284=await createContact(_0x4aa0bd,_0x91f4ee,_0x8e7d1d[_0x392717(0xa8)]);if(!_0x2e9284)throw new AppError_1[(_0x392717(0xe7))](_0x392717(0xfc));return await(0x0,SendWhatsAppMessageLink_1[_0x392717(0xe7)])({'whatsappId':_0x4aa0bd,'contact':_0x2e9284[_0x392717(0xff)],'url':_0x3cbebe,'caption':_0x45f898,'msdelay':_0x49f070}),setTimeout(async()=>{const _0x44ee98=_0x392717,{dateToClient:_0x16b889}=(0x0,useDate_1[_0x44ee98(0x10e)])(),_0x460baa=_0x16b889(new Date()),_0x324664=(0x0,moment_1[_0x44ee98(0xe7)])()[_0x44ee98(0xf4)](),_0x18de4d=await ApiUsages_1[_0x44ee98(0xe7)][_0x44ee98(0xaa)]({'where':{'dateUsed':_0x460baa,'companyId':_0x91f4ee}});if(_0x18de4d)await _0x18de4d[_0x44ee98(0xb0)]({'usedPDF':_0x18de4d[_0x44ee98(0xfa)][_0x44ee98(0x102)]+0x1,'UsedOnDay':_0x18de4d[_0x44ee98(0xfa)]['UsedOnDay']+0x1,'updatedAt':_0x324664});else{const _0x1ea2d4=await ApiUsages_1[_0x44ee98(0xe7)][_0x44ee98(0xbc)]({'companyId':_0x91f4ee,'dateUsed':_0x460baa});await _0x1ea2d4[_0x44ee98(0xb0)]({'usedPDF':_0x1ea2d4[_0x44ee98(0xfa)][_0x44ee98(0x102)]+0x1,'UsedOnDay':_0x1ea2d4[_0x44ee98(0xfa)][_0x44ee98(0xf0)]+0x1,'updatedAt':_0x324664});}},0x64),_0x376e57[_0x392717(0xef)]({'status':_0x392717(0xc6)});};exports[a8_0x3352f4(0xa7)]=indexLink;const index=async(_0x4d8d2f,_0x30a1f0)=>{const _0xe51769=a8_0x3352f4,_0x432b45=_0x4d8d2f[_0xe51769(0xd0)],{whatsappId:_0x1beff1}=_0x4d8d2f[_0xe51769(0xd0)],{msdelay:_0x1e688b}=_0x4d8d2f[_0xe51769(0xd0)],{body:_0x236a31,quotedMsg:_0x34dc36,userId:_0x2d38b0,queueId:_0x2e81e1,sendSignature:_0x61e62f,closeTicket:_0x1f90cb}=_0x4d8d2f[_0xe51769(0xd0)],_0x1cd0d7=_0x4d8d2f['files'],_0x4bb8fc=_0x4d8d2f['headers'][_0xe51769(0xed)],[,_0x62516e]=_0x4bb8fc[_0xe51769(0x10c)]('\x20'),_0x58e69b=await Whatsapp_1[_0xe51769(0xe7)][_0xe51769(0xaa)]({'where':{'token':_0x62516e}}),_0x45d8ae=_0x58e69b['companyId'];_0x432b45[_0xe51769(0xa8)]=_0x432b45[_0xe51769(0xa8)][_0xe51769(0xe1)]('-','')['replace']('\x20','');const _0x355220=Yup['object']()[_0xe51769(0xaf)]({'number':Yup[_0xe51769(0xe9)]()[_0xe51769(0x107)]()['matches'](/^\d+$/,_0xe51769(0xd7))});try{await _0x355220[_0xe51769(0x101)](_0x432b45);}catch(_0x52e4f7){throw new AppError_1[(_0xe51769(0xe7))](_0x52e4f7['message']);}console[_0xe51769(0xc0)](_0xe51769(0xec),_0x2d38b0,_0x2e81e1);let _0x31d18c;_0x2d38b0?.['toString']()!==''&&!isNaN(_0x2d38b0)&&(_0x31d18c=await(0x0,ShowUserService_1[_0xe51769(0xe7)])(_0x2d38b0,_0x45d8ae));let _0xc37891;_0x2e81e1?.['toString']()!==''&&!isNaN(_0x2e81e1)&&(_0xc37891=await(0x0,ShowQueueService_1[_0xe51769(0xe7)])(_0x2e81e1,_0x45d8ae));const _0x2c4645=await createContact(_0x58e69b['id'],_0x45d8ae,_0x432b45[_0xe51769(0xa8)],_0x2d38b0,_0x2e81e1);let _0x3bee82;_0x61e62f&&!(0x0,lodash_1[_0xe51769(0xd1)])(_0x31d18c)?_0x3bee82='*'+_0x31d18c[_0xe51769(0xdd)]+_0xe51769(0xa9)+_0x236a31[_0xe51769(0x108)]():_0x3bee82=_0x236a31[_0xe51769(0x108)]();let _0x3864f7;return _0x1cd0d7?(await Promise[_0xe51769(0xce)](_0x1cd0d7[_0xe51769(0xf1)](async _0xd69ab8=>{_0x3864f7=await(0x0,SendWhatsAppMedia_1['default'])({'body':'â€Ž\x20'+_0x3bee82,'media':_0xd69ab8,'ticket':_0x2c4645,'isForwarded':![]});})),await(0x0,wbotMessageListener_1[_0xe51769(0xe0)])(_0x3864f7,_0x2c4645,_0x2c4645[_0xe51769(0xff)])):(_0x3864f7=await(0x0,SendWhatsAppMessageAPI_1[_0xe51769(0xe7)])({'body':_0x3bee82,'whatsappId':_0x58e69b['id'],'contact':_0x2c4645[_0xe51769(0xff)],'quotedMsg':_0x34dc36,'msdelay':_0x1e688b}),await(0x0,wbotMessageListener_1[_0xe51769(0xea)])(_0x3864f7,_0x2c4645,_0x2c4645['contact'])),_0x1f90cb&&_0x1f90cb==='true'&&setTimeout(async()=>{await(0x0,UpdateTicketService_1['default'])({'ticketId':_0x2c4645['id'],'ticketData':{'status':'closed','sendFarewellMessage':![],'amountUsedBotQueues':0x0,'lastMessage':_0x236a31},'companyId':_0x45d8ae});},0x64),setTimeout(async()=>{const _0x413963=_0xe51769,{dateToClient:_0x4950f0}=(0x0,useDate_1[_0x413963(0x10e)])(),_0x5c026c=_0x4950f0(new Date()),_0x4742d6=(0x0,moment_1['default'])()['format']();let _0x100ab0=await ApiUsages_1[_0x413963(0xe7)][_0x413963(0xaa)]({'where':{'dateUsed':_0x5c026c,'companyId':_0x45d8ae}});_0x100ab0?_0x1cd0d7?await Promise['all'](_0x1cd0d7[_0x413963(0xf1)](async _0x46c49f=>{const _0x29e461=_0x413963;if(_0x46c49f[_0x29e461(0xc1)][_0x29e461(0xf5)](_0x29e461(0xbf)))await _0x100ab0[_0x29e461(0xb0)]({'usedPDF':_0x100ab0[_0x29e461(0xfa)][_0x29e461(0x102)]+0x1,'UsedOnDay':_0x100ab0[_0x29e461(0xfa)]['UsedOnDay']+0x1,'updatedAt':_0x4742d6});else{if(_0x46c49f['mimetype'][_0x29e461(0xf5)](_0x29e461(0xf8)))await _0x100ab0[_0x29e461(0xb0)]({'usedImage':_0x100ab0[_0x29e461(0xfa)][_0x29e461(0xab)]+0x1,'UsedOnDay':_0x100ab0[_0x29e461(0xfa)][_0x29e461(0xf0)]+0x1,'updatedAt':_0x4742d6});else _0x46c49f[_0x29e461(0xc1)][_0x29e461(0xf5)]('video')?await _0x100ab0[_0x29e461(0xb0)]({'usedVideo':_0x100ab0[_0x29e461(0xfa)][_0x29e461(0x10a)]+0x1,'UsedOnDay':_0x100ab0['dataValues'][_0x29e461(0xf0)]+0x1,'updatedAt':_0x4742d6}):await _0x100ab0[_0x29e461(0xb0)]({'usedOther':_0x100ab0[_0x29e461(0xfa)]['usedOther']+0x1,'UsedOnDay':_0x100ab0[_0x29e461(0xfa)][_0x29e461(0xf0)]+0x1,'updatedAt':_0x4742d6});}})):await _0x100ab0[_0x413963(0xb0)]({'usedText':_0x100ab0['dataValues'][_0x413963(0xcc)]+0x1,'UsedOnDay':_0x100ab0[_0x413963(0xfa)][_0x413963(0xf0)]+0x1,'updatedAt':_0x4742d6}):(_0x100ab0=await ApiUsages_1[_0x413963(0xe7)][_0x413963(0xbc)]({'companyId':_0x45d8ae,'dateUsed':_0x5c026c}),_0x1cd0d7?await Promise[_0x413963(0xce)](_0x1cd0d7[_0x413963(0xf1)](async _0x33946c=>{const _0x1d9afe=_0x413963;if(_0x33946c[_0x1d9afe(0xc1)][_0x1d9afe(0xf5)](_0x1d9afe(0xbf)))await _0x100ab0[_0x1d9afe(0xb0)]({'usedPDF':_0x100ab0[_0x1d9afe(0xfa)][_0x1d9afe(0x102)]+0x1,'UsedOnDay':_0x100ab0[_0x1d9afe(0xfa)][_0x1d9afe(0xf0)]+0x1,'updatedAt':_0x4742d6});else{if(_0x33946c[_0x1d9afe(0xc1)][_0x1d9afe(0xf5)](_0x1d9afe(0xf8)))await _0x100ab0[_0x1d9afe(0xb0)]({'usedImage':_0x100ab0['dataValues'][_0x1d9afe(0xab)]+0x1,'UsedOnDay':_0x100ab0[_0x1d9afe(0xfa)][_0x1d9afe(0xf0)]+0x1,'updatedAt':_0x4742d6});else _0x33946c['mimetype'][_0x1d9afe(0xf5)](_0x1d9afe(0xc7))?await _0x100ab0[_0x1d9afe(0xb0)]({'usedVideo':_0x100ab0[_0x1d9afe(0xfa)][_0x1d9afe(0x10a)]+0x1,'UsedOnDay':_0x100ab0[_0x1d9afe(0xfa)][_0x1d9afe(0xf0)]+0x1,'updatedAt':_0x4742d6}):await _0x100ab0[_0x1d9afe(0xb0)]({'usedOther':_0x100ab0[_0x1d9afe(0xfa)][_0x1d9afe(0xdc)]+0x1,'UsedOnDay':_0x100ab0['dataValues'][_0x1d9afe(0xf0)]+0x1,'updatedAt':_0x4742d6});}})):await _0x100ab0[_0x413963(0xb0)]({'usedText':_0x100ab0['dataValues'][_0x413963(0xcc)]+0x1,'UsedOnDay':_0x100ab0['dataValues']['UsedOnDay']+0x1,'updatedAt':_0x4742d6}));},0x64),_0x30a1f0[_0xe51769(0xef)]({'status':_0xe51769(0xc6)});};exports[a8_0x3352f4(0xcf)]=index;const indexImage=async(_0x201085,_0x4ef267)=>{const _0x4b778e=a8_0x3352f4,_0x1e6250=_0x201085[_0x4b778e(0xd0)],{whatsappId:_0x1b7b61}=_0x201085[_0x4b778e(0xd0)],{msdelay:_0x12148f}=_0x201085[_0x4b778e(0xd0)],_0x10f72b=_0x201085['body'][_0x4b778e(0x110)],_0x1cafc2=_0x201085[_0x4b778e(0xd0)][_0x4b778e(0xf6)],_0x134251=_0x201085['headers'][_0x4b778e(0xed)],[,_0x3758a5]=_0x134251['split']('\x20'),_0x489946=await Whatsapp_1[_0x4b778e(0xe7)]['findOne']({'where':{'token':_0x3758a5}}),_0x49ab5b=_0x489946[_0x4b778e(0xd2)];_0x1e6250[_0x4b778e(0xa8)]=_0x1e6250['number']['replace']('-','')[_0x4b778e(0xe1)]('\x20','');const _0x324103=Yup[_0x4b778e(0xb2)]()[_0x4b778e(0xaf)]({'number':Yup[_0x4b778e(0xe9)]()[_0x4b778e(0x107)]()[_0x4b778e(0xb5)](/^\d+$/,_0x4b778e(0xd7))});try{await _0x324103[_0x4b778e(0x101)](_0x1e6250);}catch(_0x5b785d){throw new AppError_1['default'](_0x5b785d[_0x4b778e(0xa6)]);}const _0xa7376f=await createContact(_0x1b7b61,_0x49ab5b,_0x1e6250[_0x4b778e(0xa8)]);return _0x10f72b&&await(0x0,SendWhatsappMediaImage_1['default'])({'ticket':_0xa7376f,'url':_0x10f72b,'caption':_0x1cafc2,'msdelay':_0x12148f}),setTimeout(async()=>{const _0x41ee84=_0x4b778e;await(0x0,UpdateTicketService_1[_0x41ee84(0xe7)])({'ticketId':_0xa7376f['id'],'ticketData':{'status':_0x41ee84(0x10b),'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x49ab5b});},0x64),setTimeout(async()=>{const _0x3202eb=_0x4b778e,{dateToClient:_0x498319}=(0x0,useDate_1['useDate'])(),_0x20eb86=_0x498319(new Date()),_0x57fd67=(0x0,moment_1[_0x3202eb(0xe7)])()[_0x3202eb(0xf4)](),_0x18efe5=await ApiUsages_1['default']['findOne']({'where':{'dateUsed':_0x20eb86,'companyId':_0x49ab5b}});if(_0x18efe5)await _0x18efe5['update']({'usedImage':_0x18efe5[_0x3202eb(0xfa)]['usedImage']+0x1,'UsedOnDay':_0x18efe5[_0x3202eb(0xfa)][_0x3202eb(0xf0)]+0x1,'updatedAt':_0x57fd67});else{const _0x59d99d=await ApiUsages_1['default'][_0x3202eb(0xbc)]({'companyId':_0x49ab5b,'dateUsed':_0x20eb86});await _0x59d99d[_0x3202eb(0xb0)]({'usedImage':_0x59d99d[_0x3202eb(0xfa)][_0x3202eb(0xab)]+0x1,'UsedOnDay':_0x59d99d[_0x3202eb(0xfa)]['UsedOnDay']+0x1,'updatedAt':_0x57fd67});}},0x64),_0x4ef267[_0x4b778e(0xef)]({'status':_0x4b778e(0xc6)});};exports[a8_0x3352f4(0xdb)]=indexImage;const checkNumber=async(_0x3a9a20,_0x53a8dc)=>{const _0x49928d=a8_0x3352f4,_0x5cb51d=_0x3a9a20[_0x49928d(0xd0)],_0x1cc564=_0x3a9a20['headers']['authorization'],[,_0x428207]=_0x1cc564[_0x49928d(0x10c)]('\x20'),_0x2901cf=await Whatsapp_1[_0x49928d(0xe7)][_0x49928d(0xaa)]({'where':{'token':_0x428207}}),_0x5bb8e9=_0x2901cf['companyId'],_0x106e6a=_0x5cb51d[_0x49928d(0xa8)][_0x49928d(0xe1)]('-','')[_0x49928d(0xe1)]('\x20',''),_0x494bf2=await(0x0,GetDefaultWhatsApp_1[_0x49928d(0xe7)])(_0x5bb8e9),_0x42f5f4=(0x0,wbot_1[_0x49928d(0xd9)])(_0x494bf2['id']),_0x110e6c=createJid(_0x106e6a);try{const [_0x13a776]=await _0x42f5f4[_0x49928d(0xd4)](_0x110e6c);if(_0x13a776[_0x49928d(0xc2)])return setTimeout(async()=>{const _0x331495=_0x49928d,{dateToClient:_0x40b286}=(0x0,useDate_1[_0x331495(0x10e)])(),_0x38d8a5=_0x40b286(new Date()),_0x1a5739=(0x0,moment_1[_0x331495(0xe7)])()[_0x331495(0xf4)](),_0x596ea5=await ApiUsages_1[_0x331495(0xe7)][_0x331495(0xaa)]({'where':{'dateUsed':_0x38d8a5,'companyId':_0x5bb8e9}});if(_0x596ea5)await _0x596ea5['update']({'usedCheckNumber':_0x596ea5[_0x331495(0xfa)]['usedCheckNumber']+0x1,'UsedOnDay':_0x596ea5[_0x331495(0xfa)][_0x331495(0xf0)]+0x1,'updatedAt':_0x1a5739});else{const _0x9f2eeb=await ApiUsages_1[_0x331495(0xe7)]['create']({'companyId':_0x5bb8e9,'dateUsed':_0x38d8a5});await _0x9f2eeb[_0x331495(0xb0)]({'usedCheckNumber':_0x9f2eeb[_0x331495(0xfa)][_0x331495(0xb8)]+0x1,'UsedOnDay':_0x9f2eeb[_0x331495(0xfa)][_0x331495(0xf0)]+0x1,'updatedAt':_0x1a5739});}},0x64),_0x53a8dc[_0x49928d(0xd3)](0xc8)['json']({'existsInWhatsapp':!![],'number':_0x106e6a,'numberFormatted':_0x13a776[_0x49928d(0x105)]});}catch(_0x257d2b){return _0x53a8dc[_0x49928d(0xd3)](0x190)[_0x49928d(0xae)]({'existsInWhatsapp':![],'number':_0x110e6c,'error':'Not\x20exists\x20on\x20Whatsapp'});}};exports[a8_0x3352f4(0xb6)]=checkNumber;const indexWhatsappsId=async(_0x1d44f7,_0x57158d)=>{const _0x51409b=a8_0x3352f4;return _0x57158d[_0x51409b(0xd3)](0xc8)['json']('oi');};exports[a8_0x3352f4(0xd5)]=indexWhatsappsId;