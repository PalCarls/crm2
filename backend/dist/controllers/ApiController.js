'use strict';const a8_0x2d3d9c=a8_0x751f;(function(_0x50adf8,_0x18a3b2){const _0xdb128e=a8_0x751f,_0x532d95=_0x50adf8();while(!![]){try{const _0x46e6c2=-parseInt(_0xdb128e(0x1e0))/0x1+parseInt(_0xdb128e(0x1b3))/0x2+parseInt(_0xdb128e(0x1d6))/0x3+-parseInt(_0xdb128e(0x1dc))/0x4+-parseInt(_0xdb128e(0x1d0))/0x5+parseInt(_0xdb128e(0x18a))/0x6*(-parseInt(_0xdb128e(0x1c6))/0x7)+parseInt(_0xdb128e(0x1cc))/0x8*(parseInt(_0xdb128e(0x1a9))/0x9);if(_0x46e6c2===_0x18a3b2)break;else _0x532d95['push'](_0x532d95['shift']());}catch(_0x4b8342){_0x532d95['push'](_0x532d95['shift']());}}}(a8_0x57c1,0x991b5));var __createBinding=this&&this[a8_0x2d3d9c(0x193)]||(Object['create']?function(_0x1ed80d,_0x36f1dc,_0x3d8aae,_0x3bc48d){const _0x1ee351=a8_0x2d3d9c;if(_0x3bc48d===undefined)_0x3bc48d=_0x3d8aae;var _0x4db217=Object[_0x1ee351(0x18c)](_0x36f1dc,_0x3d8aae);(!_0x4db217||(_0x1ee351(0x1ab)in _0x4db217?!_0x36f1dc[_0x1ee351(0x1b6)]:_0x4db217['writable']||_0x4db217['configurable']))&&(_0x4db217={'enumerable':!![],'get':function(){return _0x36f1dc[_0x3d8aae];}}),Object[_0x1ee351(0x1a5)](_0x1ed80d,_0x3bc48d,_0x4db217);}:function(_0x1145ef,_0xcbb2a0,_0x3b8e9b,_0x2c47fd){if(_0x2c47fd===undefined)_0x2c47fd=_0x3b8e9b;_0x1145ef[_0x2c47fd]=_0xcbb2a0[_0x3b8e9b];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x90284,_0x20f338){const _0x2127c3=a8_0x2d3d9c;Object[_0x2127c3(0x1a5)](_0x90284,_0x2127c3(0x1cd),{'enumerable':!![],'value':_0x20f338});}:function(_0x55da0f,_0x22ed05){const _0x5a407e=a8_0x2d3d9c;_0x55da0f[_0x5a407e(0x1cd)]=_0x22ed05;}),__importStar=this&&this[a8_0x2d3d9c(0x182)]||function(_0x146e46){const _0x14130f=a8_0x2d3d9c;if(_0x146e46&&_0x146e46['__esModule'])return _0x146e46;var _0x2bcc77={};if(_0x146e46!=null){for(var _0x4a120c in _0x146e46)if(_0x4a120c!==_0x14130f(0x1cd)&&Object[_0x14130f(0x1b7)][_0x14130f(0x19e)]['call'](_0x146e46,_0x4a120c))__createBinding(_0x2bcc77,_0x146e46,_0x4a120c);}return __setModuleDefault(_0x2bcc77,_0x146e46),_0x2bcc77;},__importDefault=this&&this['__importDefault']||function(_0x33c4f9){const _0x1795a9=a8_0x2d3d9c;return _0x33c4f9&&_0x33c4f9[_0x1795a9(0x1b6)]?_0x33c4f9:{'default':_0x33c4f9};};Object[a8_0x2d3d9c(0x1a5)](exports,a8_0x2d3d9c(0x1b6),{'value':!![]}),exports[a8_0x2d3d9c(0x1b1)]=exports[a8_0x2d3d9c(0x190)]=exports['indexImage']=exports[a8_0x2d3d9c(0x1a0)]=exports[a8_0x2d3d9c(0x188)]=exports[a8_0x2d3d9c(0x1da)]=void 0x0;const Yup=__importStar(require('yup')),AppError_1=__importDefault(require('../errors/AppError')),GetDefaultWhatsApp_1=__importDefault(require('../helpers/GetDefaultWhatsApp')),SetTicketMessagesAsRead_1=__importDefault(require(a8_0x2d3d9c(0x1b5))),Whatsapp_1=__importDefault(require('../models/Whatsapp')),CreateOrUpdateContactService_1=__importDefault(require(a8_0x2d3d9c(0x1db))),FindOrCreateTicketService_1=__importDefault(require(a8_0x2d3d9c(0x191))),CheckIsValidContact_1=__importDefault(require(a8_0x2d3d9c(0x1df))),CheckNumber_1=__importDefault(require(a8_0x2d3d9c(0x1ae))),SendWhatsAppMedia_1=__importDefault(require(a8_0x2d3d9c(0x1af))),UpdateTicketService_1=__importDefault(require(a8_0x2d3d9c(0x1c1))),wbot_1=require(a8_0x2d3d9c(0x184)),SendWhatsAppMessageLink_1=__importDefault(require(a8_0x2d3d9c(0x19d))),SendWhatsAppMessageAPI_1=__importDefault(require(a8_0x2d3d9c(0x1bc))),SendWhatsappMediaImage_1=__importDefault(require(a8_0x2d3d9c(0x189))),ApiUsages_1=__importDefault(require('../models/ApiUsages')),useDate_1=require(a8_0x2d3d9c(0x1b2)),moment_1=__importDefault(require(a8_0x2d3d9c(0x192))),CompaniesSettings_1=__importDefault(require(a8_0x2d3d9c(0x1a4))),ShowUserService_1=__importDefault(require(a8_0x2d3d9c(0x1c8))),lodash_1=require(a8_0x2d3d9c(0x18b)),wbotMessageListener_1=require('../services/WbotServices/wbotMessageListener'),ShowQueueService_1=__importDefault(require('../services/QueueService/ShowQueueService'));class OnWhatsAppDto{constructor(_0x59a77a,_0x3b54ce){const _0x20551e=a8_0x2d3d9c;this[_0x20551e(0x1ac)]=_0x59a77a,this[_0x20551e(0x1ce)]=_0x3b54ce;}}exports[a8_0x2d3d9c(0x1da)]=OnWhatsAppDto;const createContact=async(_0x4cbeda,_0x72b4e5,_0x4200ac,_0x4032e1,_0x56c563)=>{const _0x29d850=a8_0x2d3d9c;await(0x0,CheckIsValidContact_1[_0x29d850(0x1cd)])(_0x4200ac,_0x72b4e5);const _0x47e5ff=await(0x0,CheckNumber_1['default'])(_0x4200ac,_0x72b4e5),_0x2ed46a=_0x47e5ff,_0x27704c={'name':''+_0x2ed46a,'number':_0x2ed46a,'profilePicUrl':null,'isGroup':![],'companyId':_0x72b4e5},_0x2b1113=await(0x0,CreateOrUpdateContactService_1[_0x29d850(0x1cd)])(_0x27704c),_0x41a4cd=await CompaniesSettings_1[_0x29d850(0x1cd)]['findOne']({'where':{'companyId':_0x72b4e5}});let _0x164d1f;if(_0x4cbeda===undefined)_0x164d1f=await(0x0,GetDefaultWhatsApp_1[_0x29d850(0x1cd)])(_0x72b4e5);else{_0x164d1f=await Whatsapp_1[_0x29d850(0x1cd)]['findByPk'](_0x4cbeda);if(_0x164d1f===null)throw new AppError_1['default'](_0x29d850(0x19a)+_0x4cbeda+'\x20not\x20found');}const {ticket:_0x2e127e,isCreated:_0xf63df8}=await(0x0,FindOrCreateTicketService_1[_0x29d850(0x1cd)])(_0x2b1113,_0x164d1f,0x0,_0x72b4e5,_0x56c563,_0x4032e1,null,_0x29d850(0x1d7),null,![],_0x41a4cd);return _0x2e127e&&(0x0,SetTicketMessagesAsRead_1[_0x29d850(0x1cd)])(_0x2e127e),_0x2e127e;};function a8_0x57c1(){const _0x5cf64f=['../services/ContactServices/CreateOrUpdateContactService','120996oQosbw','usedCheckNumber','onWhatsApp','../services/WbotServices/CheckIsValidContact','162555SguJyr','contact','parseInt','json','replace','all','__importStar','usedPDF','../libs/wbot','body','@s.whatsapp.net','companyId','indexLink','../services/WbotServices/SendWhatsappMediaImage','6yNiXlT','lodash','getOwnPropertyDescriptor','required','map','usedVideo','checkNumber','../services/TicketServices/FindOrCreateTicketService','moment','__createBinding','status','headers','mimetype','message','matches','includes','whatsapp\x20#','number','url','../services/WbotServices/SendWhatsAppMessageLink','hasOwnProperty','split','index','useDate','usedText','toString','../models/CompaniesSettings','defineProperty','image','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','video','3219228VwVnoF','closed','get','jid','shape','../services/WbotServices/CheckNumber','../services/WbotServices/SendWhatsAppMedia','pdf','indexWhatsappsId','../utils/useDate','120400DbRAxz','verifyMessage','../helpers/SetTicketMessagesAsRead','__esModule','prototype','findOne','usedOther','Cliente\x20em\x20outro\x20atendimento','send','../services/WbotServices/SendWhatsAppMessageAPI','test','SUCCESS','Not\x20exists\x20on\x20Whatsapp','open','../services/TicketServices/UpdateTicketService','exec','trim','isInteger','caption','3874654yXoLsv','dataValues','../services/UserServices/ShowUserService','name','string','isNil','8xXSuZC','default','exists','indexImage','1192695ZRZBeA','format','object','create','usedImage','authorization','3582294XRuhXC','whatsapp','update','UsedOnDay','OnWhatsAppDto'];a8_0x57c1=function(){return _0x5cf64f;};return a8_0x57c1();}function formatBRNumber(_0x111e70){const _0x4c2c70=a8_0x2d3d9c,_0x3ac6ea=new RegExp(/^(\d{2})(\d{2})\d{1}(\d{8})$/);if(_0x3ac6ea[_0x4c2c70(0x1bd)](_0x111e70)){const _0x3cf63e=_0x3ac6ea[_0x4c2c70(0x1c2)](_0x111e70);if(_0x3cf63e&&_0x3cf63e[0x1]==='55'&&Number[_0x4c2c70(0x1c4)](Number[_0x4c2c70(0x17e)](_0x3cf63e[0x2]))){const _0x17d0ca=Number['parseInt'](_0x3cf63e[0x2]);if(_0x17d0ca<0x1f)return _0x3cf63e[0x0];else{if(_0x17d0ca>=0x1f)return _0x3cf63e[0x1]+_0x3cf63e[0x2]+_0x3cf63e[0x3];}}}else return _0x111e70;}function createJid(_0x497c33){const _0x5cfc0c=a8_0x2d3d9c;if(_0x497c33[_0x5cfc0c(0x199)]('@g.us')||_0x497c33[_0x5cfc0c(0x199)](_0x5cfc0c(0x186)))return formatBRNumber(_0x497c33);return _0x497c33[_0x5cfc0c(0x199)]('-')?_0x497c33+'@g.us':formatBRNumber(_0x497c33)+_0x5cfc0c(0x186);}const indexLink=async(_0x4854bd,_0x56c4ac)=>{const _0x3d7c1c=a8_0x2d3d9c,_0x21d6b1=_0x4854bd[_0x3d7c1c(0x185)],{whatsappId:_0x175afe}=_0x4854bd['body'],{msdelay:_0x362995}=_0x4854bd['body'],_0x518714=_0x4854bd['body'][_0x3d7c1c(0x19c)],_0x191ec6=_0x4854bd[_0x3d7c1c(0x185)][_0x3d7c1c(0x1c5)],_0x556299=_0x4854bd['headers'][_0x3d7c1c(0x1d5)],[,_0x5432b9]=_0x556299[_0x3d7c1c(0x19f)]('\x20'),_0x254649=await Whatsapp_1[_0x3d7c1c(0x1cd)][_0x3d7c1c(0x1b8)]({'where':{'token':_0x5432b9}}),_0x48d338=_0x254649['companyId'];_0x21d6b1[_0x3d7c1c(0x19b)]=_0x21d6b1[_0x3d7c1c(0x19b)][_0x3d7c1c(0x180)]('-','')[_0x3d7c1c(0x180)]('\x20','');const _0x239488=Yup['object']()['shape']({'number':Yup[_0x3d7c1c(0x1ca)]()[_0x3d7c1c(0x18d)]()['matches'](/^\d+$/,_0x3d7c1c(0x1a7))});try{await _0x239488['validate'](_0x21d6b1);}catch(_0x3cdaf7){throw new AppError_1[(_0x3d7c1c(0x1cd))](_0x3cdaf7[_0x3d7c1c(0x197)]);}const _0x554e69=await createContact(_0x175afe,_0x48d338,_0x21d6b1[_0x3d7c1c(0x19b)]);if(!_0x554e69)throw new AppError_1[(_0x3d7c1c(0x1cd))](_0x3d7c1c(0x1ba));return await(0x0,SendWhatsAppMessageLink_1['default'])({'whatsappId':_0x175afe,'contact':_0x554e69[_0x3d7c1c(0x17d)],'url':_0x518714,'caption':_0x191ec6,'msdelay':_0x362995}),setTimeout(async()=>{const _0x2886db=_0x3d7c1c,{dateToClient:_0x4caece}=(0x0,useDate_1[_0x2886db(0x1a1)])(),_0x4cec66=_0x4caece(new Date()),_0x5a66f1=(0x0,moment_1['default'])()[_0x2886db(0x1d1)](),_0x101640=await ApiUsages_1['default']['findOne']({'where':{'dateUsed':_0x4cec66,'companyId':_0x48d338}});if(_0x101640)await _0x101640[_0x2886db(0x1d8)]({'usedPDF':_0x101640[_0x2886db(0x1c7)][_0x2886db(0x183)]+0x1,'UsedOnDay':_0x101640[_0x2886db(0x1c7)][_0x2886db(0x1d9)]+0x1,'updatedAt':_0x5a66f1});else{const _0x3fee4f=await ApiUsages_1[_0x2886db(0x1cd)][_0x2886db(0x1d3)]({'companyId':_0x48d338,'dateUsed':_0x4cec66});await _0x3fee4f['update']({'usedPDF':_0x3fee4f[_0x2886db(0x1c7)][_0x2886db(0x183)]+0x1,'UsedOnDay':_0x3fee4f[_0x2886db(0x1c7)][_0x2886db(0x1d9)]+0x1,'updatedAt':_0x5a66f1});}},0x64),_0x56c4ac[_0x3d7c1c(0x1bb)]({'status':_0x3d7c1c(0x1be)});};function a8_0x751f(_0x786532,_0x322dfe){const _0x57c17c=a8_0x57c1();return a8_0x751f=function(_0x751f9,_0x126ee0){_0x751f9=_0x751f9-0x17d;let _0xfcf861=_0x57c17c[_0x751f9];return _0xfcf861;},a8_0x751f(_0x786532,_0x322dfe);}exports[a8_0x2d3d9c(0x188)]=indexLink;const index=async(_0x4bad51,_0x4b92d3)=>{const _0x1b7c80=a8_0x2d3d9c,_0x1c3312=_0x4bad51[_0x1b7c80(0x185)],{whatsappId:_0xd16f86}=_0x4bad51[_0x1b7c80(0x185)],{msdelay:_0x303f3a}=_0x4bad51['body'],{body:_0x406c0c,quotedMsg:_0x2ad030,userId:_0x17506b,queueId:_0x343007,sendSignature:sendSignature=![],closeTicket:closeTicket=![]}=_0x4bad51[_0x1b7c80(0x185)],_0x167c9d=_0x4bad51['files'],_0x20afda=_0x4bad51[_0x1b7c80(0x195)][_0x1b7c80(0x1d5)],[,_0x5ec1d3]=_0x20afda[_0x1b7c80(0x19f)]('\x20'),_0x102cf5=await Whatsapp_1['default']['findOne']({'where':{'token':_0x5ec1d3}}),_0x348db6=_0x102cf5[_0x1b7c80(0x187)];_0x1c3312['number']=_0x1c3312[_0x1b7c80(0x19b)][_0x1b7c80(0x180)]('-','')[_0x1b7c80(0x180)]('\x20','');const _0x260771=Yup[_0x1b7c80(0x1d2)]()[_0x1b7c80(0x1ad)]({'number':Yup[_0x1b7c80(0x1ca)]()[_0x1b7c80(0x18d)]()[_0x1b7c80(0x198)](/^\d+$/,_0x1b7c80(0x1a7))});try{await _0x260771['validate'](_0x1c3312);}catch(_0x57ec73){throw new AppError_1['default'](_0x57ec73[_0x1b7c80(0x197)]);}let _0xb874c7;_0x17506b?.[_0x1b7c80(0x1a3)]()!==''&&!isNaN(_0x17506b)&&(_0xb874c7=await(0x0,ShowUserService_1['default'])(_0x17506b,_0x348db6));let _0x2e8ab6;_0x343007?.['toString']()!==''&&!isNaN(_0x343007)&&(_0x2e8ab6=await(0x0,ShowQueueService_1[_0x1b7c80(0x1cd)])(_0x343007,_0x348db6));const _0x50b22a=await createContact(_0x102cf5['id'],_0x348db6,_0x1c3312['number'],_0x17506b,_0x343007);let _0x2a349b;sendSignature&&!(0x0,lodash_1[_0x1b7c80(0x1cb)])(_0xb874c7)?_0x2a349b='*'+_0xb874c7[_0x1b7c80(0x1c9)]+':*\x0a'+_0x406c0c[_0x1b7c80(0x1c3)]():_0x2a349b=_0x406c0c[_0x1b7c80(0x1c3)]();let _0x2fb047;_0x167c9d?(await Promise[_0x1b7c80(0x181)](_0x167c9d[_0x1b7c80(0x18e)](async _0x4e48c3=>{_0x2fb047=await(0x0,SendWhatsAppMedia_1['default'])({'body':'‎\x20'+_0x2a349b,'media':_0x4e48c3,'ticket':_0x50b22a,'isForwarded':![]});})),await(0x0,wbotMessageListener_1['verifyMediaMessage'])(_0x2fb047,_0x50b22a,_0x50b22a[_0x1b7c80(0x17d)])):(_0x2fb047=await(0x0,SendWhatsAppMessageAPI_1[_0x1b7c80(0x1cd)])({'body':'‎\x20'+_0x2a349b,'whatsappId':_0x102cf5['id'],'contact':_0x50b22a[_0x1b7c80(0x17d)],'quotedMsg':_0x2ad030,'msdelay':_0x303f3a}),await(0x0,wbotMessageListener_1[_0x1b7c80(0x1b4)])(_0x2fb047,_0x50b22a,_0x50b22a['contact']));if(closeTicket)setTimeout(async()=>{const _0x577526=_0x1b7c80;await(0x0,UpdateTicketService_1[_0x577526(0x1cd)])({'ticketId':_0x50b22a['id'],'ticketData':{'status':_0x577526(0x1aa),'sendFarewellMessage':![],'amountUsedBotQueues':0x0,'lastMessage':_0x406c0c},'companyId':_0x348db6});},0x64);else _0x17506b?.[_0x1b7c80(0x1a3)]()!==''&&!isNaN(_0x17506b)&&setTimeout(async()=>{const _0x5d4d1c=_0x1b7c80;await(0x0,UpdateTicketService_1[_0x5d4d1c(0x1cd)])({'ticketId':_0x50b22a['id'],'ticketData':{'status':_0x5d4d1c(0x1c0),'amountUsedBotQueues':0x0,'lastMessage':_0x406c0c,'userId':_0x17506b,'queueId':_0x343007},'companyId':_0x348db6});},0x64);return setTimeout(async()=>{const _0x2ed82a=_0x1b7c80,{dateToClient:_0x43feee}=(0x0,useDate_1[_0x2ed82a(0x1a1)])(),_0x5115a4=_0x43feee(new Date()),_0x446cbb=(0x0,moment_1[_0x2ed82a(0x1cd)])()[_0x2ed82a(0x1d1)]();let _0x1898f0=await ApiUsages_1[_0x2ed82a(0x1cd)]['findOne']({'where':{'dateUsed':_0x5115a4,'companyId':_0x348db6}});_0x1898f0?_0x167c9d?await Promise[_0x2ed82a(0x181)](_0x167c9d[_0x2ed82a(0x18e)](async _0x5dc9eb=>{const _0x153d9f=_0x2ed82a;if(_0x5dc9eb['mimetype'][_0x153d9f(0x199)](_0x153d9f(0x1b0)))await _0x1898f0['update']({'usedPDF':_0x1898f0['dataValues'][_0x153d9f(0x183)]+0x1,'UsedOnDay':_0x1898f0[_0x153d9f(0x1c7)]['UsedOnDay']+0x1,'updatedAt':_0x446cbb});else{if(_0x5dc9eb[_0x153d9f(0x196)]['includes'](_0x153d9f(0x1a6)))await _0x1898f0['update']({'usedImage':_0x1898f0[_0x153d9f(0x1c7)]['usedImage']+0x1,'UsedOnDay':_0x1898f0['dataValues']['UsedOnDay']+0x1,'updatedAt':_0x446cbb});else _0x5dc9eb[_0x153d9f(0x196)][_0x153d9f(0x199)](_0x153d9f(0x1a8))?await _0x1898f0['update']({'usedVideo':_0x1898f0[_0x153d9f(0x1c7)][_0x153d9f(0x18f)]+0x1,'UsedOnDay':_0x1898f0['dataValues'][_0x153d9f(0x1d9)]+0x1,'updatedAt':_0x446cbb}):await _0x1898f0[_0x153d9f(0x1d8)]({'usedOther':_0x1898f0[_0x153d9f(0x1c7)][_0x153d9f(0x1b9)]+0x1,'UsedOnDay':_0x1898f0['dataValues'][_0x153d9f(0x1d9)]+0x1,'updatedAt':_0x446cbb});}})):await _0x1898f0[_0x2ed82a(0x1d8)]({'usedText':_0x1898f0[_0x2ed82a(0x1c7)][_0x2ed82a(0x1a2)]+0x1,'UsedOnDay':_0x1898f0[_0x2ed82a(0x1c7)][_0x2ed82a(0x1d9)]+0x1,'updatedAt':_0x446cbb}):(_0x1898f0=await ApiUsages_1[_0x2ed82a(0x1cd)][_0x2ed82a(0x1d3)]({'companyId':_0x348db6,'dateUsed':_0x5115a4}),_0x167c9d?await Promise[_0x2ed82a(0x181)](_0x167c9d['map'](async _0x133be8=>{const _0x265ece=_0x2ed82a;if(_0x133be8[_0x265ece(0x196)][_0x265ece(0x199)](_0x265ece(0x1b0)))await _0x1898f0[_0x265ece(0x1d8)]({'usedPDF':_0x1898f0[_0x265ece(0x1c7)][_0x265ece(0x183)]+0x1,'UsedOnDay':_0x1898f0[_0x265ece(0x1c7)][_0x265ece(0x1d9)]+0x1,'updatedAt':_0x446cbb});else{if(_0x133be8['mimetype'][_0x265ece(0x199)]('image'))await _0x1898f0['update']({'usedImage':_0x1898f0[_0x265ece(0x1c7)][_0x265ece(0x1d4)]+0x1,'UsedOnDay':_0x1898f0[_0x265ece(0x1c7)][_0x265ece(0x1d9)]+0x1,'updatedAt':_0x446cbb});else _0x133be8['mimetype'][_0x265ece(0x199)](_0x265ece(0x1a8))?await _0x1898f0[_0x265ece(0x1d8)]({'usedVideo':_0x1898f0[_0x265ece(0x1c7)][_0x265ece(0x18f)]+0x1,'UsedOnDay':_0x1898f0[_0x265ece(0x1c7)][_0x265ece(0x1d9)]+0x1,'updatedAt':_0x446cbb}):await _0x1898f0[_0x265ece(0x1d8)]({'usedOther':_0x1898f0[_0x265ece(0x1c7)][_0x265ece(0x1b9)]+0x1,'UsedOnDay':_0x1898f0[_0x265ece(0x1c7)][_0x265ece(0x1d9)]+0x1,'updatedAt':_0x446cbb});}})):await _0x1898f0[_0x2ed82a(0x1d8)]({'usedText':_0x1898f0[_0x2ed82a(0x1c7)][_0x2ed82a(0x1a2)]+0x1,'UsedOnDay':_0x1898f0['dataValues']['UsedOnDay']+0x1,'updatedAt':_0x446cbb}));},0x64),_0x4b92d3['send']({'status':'SUCCESS'});};exports[a8_0x2d3d9c(0x1a0)]=index;const indexImage=async(_0xb1b267,_0x3d864f)=>{const _0x56bb4e=a8_0x2d3d9c,_0x5d6e27=_0xb1b267[_0x56bb4e(0x185)],{whatsappId:_0x3810dd}=_0xb1b267[_0x56bb4e(0x185)],{msdelay:_0x44652c}=_0xb1b267[_0x56bb4e(0x185)],_0x552332=_0xb1b267['body']['url'],_0x180893=_0xb1b267[_0x56bb4e(0x185)]['caption'],_0xc4ed2b=_0xb1b267[_0x56bb4e(0x195)][_0x56bb4e(0x1d5)],[,_0x30140e]=_0xc4ed2b[_0x56bb4e(0x19f)]('\x20'),_0x1e6a9c=await Whatsapp_1[_0x56bb4e(0x1cd)][_0x56bb4e(0x1b8)]({'where':{'token':_0x30140e}}),_0x36b39=_0x1e6a9c[_0x56bb4e(0x187)];_0x5d6e27[_0x56bb4e(0x19b)]=_0x5d6e27['number'][_0x56bb4e(0x180)]('-','')[_0x56bb4e(0x180)]('\x20','');const _0x4594a7=Yup[_0x56bb4e(0x1d2)]()[_0x56bb4e(0x1ad)]({'number':Yup[_0x56bb4e(0x1ca)]()[_0x56bb4e(0x18d)]()[_0x56bb4e(0x198)](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0x4594a7['validate'](_0x5d6e27);}catch(_0x3540a9){throw new AppError_1[(_0x56bb4e(0x1cd))](_0x3540a9[_0x56bb4e(0x197)]);}const _0x556e9f=await createContact(_0x3810dd,_0x36b39,_0x5d6e27[_0x56bb4e(0x19b)]);return _0x552332&&await(0x0,SendWhatsappMediaImage_1['default'])({'ticket':_0x556e9f,'url':_0x552332,'caption':_0x180893,'msdelay':_0x44652c}),setTimeout(async()=>{const _0x3a8df7=_0x56bb4e;await(0x0,UpdateTicketService_1['default'])({'ticketId':_0x556e9f['id'],'ticketData':{'status':_0x3a8df7(0x1aa),'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x36b39});},0x64),setTimeout(async()=>{const _0x2ed78e=_0x56bb4e,{dateToClient:_0x297fe1}=(0x0,useDate_1[_0x2ed78e(0x1a1)])(),_0x3dbe34=_0x297fe1(new Date()),_0x15bea7=(0x0,moment_1[_0x2ed78e(0x1cd)])()[_0x2ed78e(0x1d1)](),_0x52bb89=await ApiUsages_1['default'][_0x2ed78e(0x1b8)]({'where':{'dateUsed':_0x3dbe34,'companyId':_0x36b39}});if(_0x52bb89)await _0x52bb89[_0x2ed78e(0x1d8)]({'usedImage':_0x52bb89[_0x2ed78e(0x1c7)][_0x2ed78e(0x1d4)]+0x1,'UsedOnDay':_0x52bb89[_0x2ed78e(0x1c7)]['UsedOnDay']+0x1,'updatedAt':_0x15bea7});else{const _0x291b33=await ApiUsages_1['default'][_0x2ed78e(0x1d3)]({'companyId':_0x36b39,'dateUsed':_0x3dbe34});await _0x291b33[_0x2ed78e(0x1d8)]({'usedImage':_0x291b33[_0x2ed78e(0x1c7)]['usedImage']+0x1,'UsedOnDay':_0x291b33[_0x2ed78e(0x1c7)][_0x2ed78e(0x1d9)]+0x1,'updatedAt':_0x15bea7});}},0x64),_0x3d864f[_0x56bb4e(0x1bb)]({'status':_0x56bb4e(0x1be)});};exports[a8_0x2d3d9c(0x1cf)]=indexImage;const checkNumber=async(_0x48cf70,_0x2204ba)=>{const _0x26d48d=a8_0x2d3d9c,_0xd3f02f=_0x48cf70['body'],_0x4f814a=_0x48cf70[_0x26d48d(0x195)]['authorization'],[,_0x5496d8]=_0x4f814a[_0x26d48d(0x19f)]('\x20'),_0x56319d=await Whatsapp_1[_0x26d48d(0x1cd)][_0x26d48d(0x1b8)]({'where':{'token':_0x5496d8}}),_0x7e438c=_0x56319d['companyId'],_0x5dc893=_0xd3f02f[_0x26d48d(0x19b)][_0x26d48d(0x180)]('-','')[_0x26d48d(0x180)]('\x20',''),_0x4ce0ed=await(0x0,GetDefaultWhatsApp_1[_0x26d48d(0x1cd)])(_0x7e438c),_0x5c2395=(0x0,wbot_1['getWbot'])(_0x4ce0ed['id']),_0x29d812=createJid(_0x5dc893);try{const [_0x29c0a0]=await _0x5c2395[_0x26d48d(0x1de)](_0x29d812);if(_0x29c0a0['exists'])return setTimeout(async()=>{const _0x560a8d=_0x26d48d,{dateToClient:_0x15f028}=(0x0,useDate_1['useDate'])(),_0x4e1088=_0x15f028(new Date()),_0x41be7c=(0x0,moment_1[_0x560a8d(0x1cd)])()[_0x560a8d(0x1d1)](),_0x3a83c4=await ApiUsages_1[_0x560a8d(0x1cd)][_0x560a8d(0x1b8)]({'where':{'dateUsed':_0x4e1088,'companyId':_0x7e438c}});if(_0x3a83c4)await _0x3a83c4['update']({'usedCheckNumber':_0x3a83c4[_0x560a8d(0x1c7)][_0x560a8d(0x1dd)]+0x1,'UsedOnDay':_0x3a83c4['dataValues'][_0x560a8d(0x1d9)]+0x1,'updatedAt':_0x41be7c});else{const _0x5a9eef=await ApiUsages_1[_0x560a8d(0x1cd)]['create']({'companyId':_0x7e438c,'dateUsed':_0x4e1088});await _0x5a9eef[_0x560a8d(0x1d8)]({'usedCheckNumber':_0x5a9eef[_0x560a8d(0x1c7)][_0x560a8d(0x1dd)]+0x1,'UsedOnDay':_0x5a9eef[_0x560a8d(0x1c7)][_0x560a8d(0x1d9)]+0x1,'updatedAt':_0x41be7c});}},0x64),_0x2204ba[_0x26d48d(0x194)](0xc8)[_0x26d48d(0x17f)]({'existsInWhatsapp':!![],'number':_0x5dc893,'numberFormatted':_0x29c0a0[_0x26d48d(0x1ac)]});}catch(_0x22e13b){return _0x2204ba[_0x26d48d(0x194)](0x190)['json']({'existsInWhatsapp':![],'number':_0x29d812,'error':_0x26d48d(0x1bf)});}};exports['checkNumber']=checkNumber;const indexWhatsappsId=async(_0x5f011c,_0x12541d)=>{const _0x25011c=a8_0x2d3d9c;return _0x12541d[_0x25011c(0x194)](0xc8)[_0x25011c(0x17f)]('oi');};exports[a8_0x2d3d9c(0x1b1)]=indexWhatsappsId;