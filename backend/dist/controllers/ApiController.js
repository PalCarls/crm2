'use strict';function a8_0x5517(_0x4c0ec8,_0x191729){const _0x57abb1=a8_0x57ab();return a8_0x5517=function(_0x55174e,_0xa24716){_0x55174e=_0x55174e-0xf8;let _0x47aea8=_0x57abb1[_0x55174e];return _0x47aea8;},a8_0x5517(_0x4c0ec8,_0x191729);}const a8_0xb1a671=a8_0x5517;(function(_0x5d0420,_0x20d1f5){const _0x4d7a6f=a8_0x5517,_0x3247ae=_0x5d0420();while(!![]){try{const _0xc36649=-parseInt(_0x4d7a6f(0x149))/0x1+-parseInt(_0x4d7a6f(0x10c))/0x2+parseInt(_0x4d7a6f(0x14e))/0x3*(-parseInt(_0x4d7a6f(0x132))/0x4)+parseInt(_0x4d7a6f(0x106))/0x5+parseInt(_0x4d7a6f(0x100))/0x6*(parseInt(_0x4d7a6f(0x159))/0x7)+parseInt(_0x4d7a6f(0x10a))/0x8+parseInt(_0x4d7a6f(0x13e))/0x9*(-parseInt(_0x4d7a6f(0x144))/0xa);if(_0xc36649===_0x20d1f5)break;else _0x3247ae['push'](_0x3247ae['shift']());}catch(_0x11f620){_0x3247ae['push'](_0x3247ae['shift']());}}}(a8_0x57ab,0x7cc97));var __createBinding=this&&this['__createBinding']||(Object[a8_0xb1a671(0x12c)]?function(_0x5725df,_0x3e9ab3,_0x1d1036,_0x31eb32){const _0x411695=a8_0xb1a671;if(_0x31eb32===undefined)_0x31eb32=_0x1d1036;var _0x27e80d=Object[_0x411695(0x105)](_0x3e9ab3,_0x1d1036);(!_0x27e80d||(_0x411695(0x104)in _0x27e80d?!_0x3e9ab3[_0x411695(0x13f)]:_0x27e80d[_0x411695(0x122)]||_0x27e80d[_0x411695(0x11c)]))&&(_0x27e80d={'enumerable':!![],'get':function(){return _0x3e9ab3[_0x1d1036];}}),Object[_0x411695(0x12f)](_0x5725df,_0x31eb32,_0x27e80d);}:function(_0x59e29b,_0x1c9b7e,_0x5e8236,_0x279015){if(_0x279015===undefined)_0x279015=_0x5e8236;_0x59e29b[_0x279015]=_0x1c9b7e[_0x5e8236];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x5a5684,_0x118b80){const _0x458128=a8_0xb1a671;Object[_0x458128(0x12f)](_0x5a5684,_0x458128(0x140),{'enumerable':!![],'value':_0x118b80});}:function(_0x208b3b,_0x367e5e){_0x208b3b['default']=_0x367e5e;}),__importStar=this&&this[a8_0xb1a671(0x15c)]||function(_0x2579c9){const _0x2dfbc7=a8_0xb1a671;if(_0x2579c9&&_0x2579c9['__esModule'])return _0x2579c9;var _0x429d27={};if(_0x2579c9!=null){for(var _0x35d1e6 in _0x2579c9)if(_0x35d1e6!==_0x2dfbc7(0x140)&&Object[_0x2dfbc7(0x142)][_0x2dfbc7(0x114)][_0x2dfbc7(0x11a)](_0x2579c9,_0x35d1e6))__createBinding(_0x429d27,_0x2579c9,_0x35d1e6);}return __setModuleDefault(_0x429d27,_0x2579c9),_0x429d27;},__importDefault=this&&this[a8_0xb1a671(0x150)]||function(_0x11843d){const _0x3a5f6c=a8_0xb1a671;return _0x11843d&&_0x11843d[_0x3a5f6c(0x13f)]?_0x11843d:{'default':_0x11843d};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['indexWhatsappsId']=exports[a8_0xb1a671(0x15f)]=exports['indexImage']=exports[a8_0xb1a671(0x115)]=exports[a8_0xb1a671(0x15d)]=exports[a8_0xb1a671(0x113)]=void 0x0;const Yup=__importStar(require(a8_0xb1a671(0x111))),AppError_1=__importDefault(require(a8_0xb1a671(0x14a))),GetDefaultWhatsApp_1=__importDefault(require('../helpers/GetDefaultWhatsApp')),SetTicketMessagesAsRead_1=__importDefault(require(a8_0xb1a671(0x152))),Whatsapp_1=__importDefault(require('../models/Whatsapp')),CreateOrUpdateContactService_1=__importDefault(require(a8_0xb1a671(0x15e))),FindOrCreateTicketService_1=__importDefault(require(a8_0xb1a671(0x136))),CheckIsValidContact_1=__importDefault(require('../services/WbotServices/CheckIsValidContact')),CheckNumber_1=__importDefault(require(a8_0xb1a671(0x102))),SendWhatsAppMedia_1=__importDefault(require(a8_0xb1a671(0x157))),UpdateTicketService_1=__importDefault(require(a8_0xb1a671(0x145))),wbot_1=require('../libs/wbot'),SendWhatsAppMessageLink_1=__importDefault(require('../services/WbotServices/SendWhatsAppMessageLink')),SendWhatsAppMessageAPI_1=__importDefault(require('../services/WbotServices/SendWhatsAppMessageAPI')),SendWhatsappMediaImage_1=__importDefault(require(a8_0xb1a671(0x121))),ApiUsages_1=__importDefault(require(a8_0xb1a671(0x131))),useDate_1=require(a8_0xb1a671(0x126)),moment_1=__importDefault(require(a8_0xb1a671(0x120))),CompaniesSettings_1=__importDefault(require(a8_0xb1a671(0x127))),ShowUserService_1=__importDefault(require(a8_0xb1a671(0x14f))),lodash_1=require(a8_0xb1a671(0x13c)),wbotMessageListener_1=require(a8_0xb1a671(0xfc)),ShowQueueService_1=__importDefault(require('../services/QueueService/ShowQueueService'));function a8_0x57ab(){const _0x4e66da=['url','parseInt','companyId','moment','../services/WbotServices/SendWhatsappMediaImage','writable','map','replace','message','../utils/useDate','../models/CompaniesSettings','closed','usedPDF','files','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','create','update','exists','defineProperty','findOne','../models/ApiUsages','1294828bQfluW','video','open','exec','../services/TicketServices/FindOrCreateTicketService','usedVideo','verifyMessage','jid','all','isInteger','lodash','toString','3546dujUrD','__esModule','default','validate','prototype','authorization','470gJqREQ','../services/TicketServices/UpdateTicketService','matches','send','mimetype','130293oyCIcS','../errors/AppError','caption','whatsapp\x20#','\x20not\x20found','3iXTAGw','../services/UserServices/ShowUserService','__importDefault','format','../helpers/SetTicketMessagesAsRead','isNil','object','SUCCESS','contact','../services/WbotServices/SendWhatsAppMedia','shape','1260uVgYqO','getWbot','usedImage','__importStar','indexLink','../services/ContactServices/CreateOrUpdateContactService','checkNumber','required','Not\x20exists\x20on\x20Whatsapp','trim','headers','findByPk','../services/WbotServices/wbotMessageListener','image','dataValues','usedOther','13482farQsA','string','../services/WbotServices/CheckNumber','usedText','get','getOwnPropertyDescriptor','3914835krPTqA','number','body','json','3504448VUgKQz','@s.whatsapp.net','1283676rqfvAr','test','UsedOnDay','includes','usedCheckNumber','yup','pdf','OnWhatsAppDto','hasOwnProperty','index','useDate','split','@g.us','status','call','indexImage','configurable'];a8_0x57ab=function(){return _0x4e66da;};return a8_0x57ab();}class OnWhatsAppDto{constructor(_0xf744b0,_0x329699){const _0x5392aa=a8_0xb1a671;this[_0x5392aa(0x139)]=_0xf744b0,this[_0x5392aa(0x12e)]=_0x329699;}}exports[a8_0xb1a671(0x113)]=OnWhatsAppDto;const createContact=async(_0x23ce80,_0x4c54e1,_0x2a9a55,_0x555299,_0x23dfff)=>{const _0x424bfd=a8_0xb1a671;await(0x0,CheckIsValidContact_1['default'])(_0x2a9a55,_0x4c54e1);const _0x20ecef=await(0x0,CheckNumber_1[_0x424bfd(0x140)])(_0x2a9a55,_0x4c54e1),_0x437e41=_0x20ecef,_0x15dd8c={'name':''+_0x437e41,'number':_0x437e41,'profilePicUrl':'','isGroup':![],'companyId':_0x4c54e1},_0x539d53=await(0x0,CreateOrUpdateContactService_1[_0x424bfd(0x140)])(_0x15dd8c),_0x5dfece=await CompaniesSettings_1['default'][_0x424bfd(0x130)]({'where':{'companyId':_0x4c54e1}});let _0x212913;if(_0x23ce80===undefined)_0x212913=await(0x0,GetDefaultWhatsApp_1['default'])(_0x4c54e1);else{_0x212913=await Whatsapp_1['default'][_0x424bfd(0xfb)](_0x23ce80);if(_0x212913===null)throw new AppError_1[(_0x424bfd(0x140))](_0x424bfd(0x14c)+_0x23ce80+_0x424bfd(0x14d));}const {ticket:_0x5f3b24,isCreated:_0x1d8978}=await(0x0,FindOrCreateTicketService_1[_0x424bfd(0x140)])(_0x539d53,_0x212913,0x0,_0x4c54e1,_0x23dfff,_0x555299,null,'whatsapp',null,![],_0x5dfece);return _0x5f3b24&&(0x0,SetTicketMessagesAsRead_1['default'])(_0x5f3b24),_0x5f3b24;};function formatBRNumber(_0x40f3fd){const _0x1593de=a8_0xb1a671,_0x46a052=new RegExp(/^(\d{2})(\d{2})\d{1}(\d{8})$/);if(_0x46a052[_0x1593de(0x10d)](_0x40f3fd)){const _0x2281aa=_0x46a052[_0x1593de(0x135)](_0x40f3fd);if(_0x2281aa&&_0x2281aa[0x1]==='55'&&Number[_0x1593de(0x13b)](Number[_0x1593de(0x11e)](_0x2281aa[0x2]))){const _0x52fc35=Number[_0x1593de(0x11e)](_0x2281aa[0x2]);if(_0x52fc35<0x1f)return _0x2281aa[0x0];else{if(_0x52fc35>=0x1f)return _0x2281aa[0x1]+_0x2281aa[0x2]+_0x2281aa[0x3];}}}else return _0x40f3fd;}function createJid(_0x46d2b6){const _0x862144=a8_0xb1a671;if(_0x46d2b6[_0x862144(0x10f)](_0x862144(0x118))||_0x46d2b6[_0x862144(0x10f)]('@s.whatsapp.net'))return formatBRNumber(_0x46d2b6);return _0x46d2b6[_0x862144(0x10f)]('-')?_0x46d2b6+_0x862144(0x118):formatBRNumber(_0x46d2b6)+_0x862144(0x10b);}const indexLink=async(_0x1a783a,_0x402653)=>{const _0x1f4fe0=a8_0xb1a671,_0x26d386=_0x1a783a[_0x1f4fe0(0x108)],{whatsappId:_0x1e9228}=_0x1a783a[_0x1f4fe0(0x108)],{msdelay:_0x5b5296}=_0x1a783a[_0x1f4fe0(0x108)],_0x548787=_0x1a783a[_0x1f4fe0(0x108)][_0x1f4fe0(0x11d)],_0x2d179c=_0x1a783a[_0x1f4fe0(0x108)][_0x1f4fe0(0x14b)],_0x164244=_0x1a783a['headers'][_0x1f4fe0(0x143)],[,_0x2ea531]=_0x164244[_0x1f4fe0(0x117)]('\x20'),_0x5e019b=await Whatsapp_1[_0x1f4fe0(0x140)][_0x1f4fe0(0x130)]({'where':{'token':_0x2ea531}}),_0x2589b4=_0x5e019b[_0x1f4fe0(0x11f)];_0x26d386[_0x1f4fe0(0x107)]=_0x26d386['number'][_0x1f4fe0(0x124)]('-','')[_0x1f4fe0(0x124)]('\x20','');const _0x3041e1=Yup[_0x1f4fe0(0x154)]()['shape']({'number':Yup['string']()[_0x1f4fe0(0x160)]()[_0x1f4fe0(0x146)](/^\d+$/,_0x1f4fe0(0x12b))});try{await _0x3041e1[_0x1f4fe0(0x141)](_0x26d386);}catch(_0x459ebd){throw new AppError_1['default'](_0x459ebd['message']);}const _0x1f95fa=await createContact(_0x1e9228,_0x2589b4,_0x26d386[_0x1f4fe0(0x107)]);if(!_0x1f95fa)throw new AppError_1[(_0x1f4fe0(0x140))]('Cliente\x20em\x20outro\x20atendimento');return await(0x0,SendWhatsAppMessageLink_1[_0x1f4fe0(0x140)])({'whatsappId':_0x1e9228,'contact':_0x1f95fa['contact'],'url':_0x548787,'caption':_0x2d179c,'msdelay':_0x5b5296}),setTimeout(async()=>{const _0x2f2d95=_0x1f4fe0,{dateToClient:_0x137353}=(0x0,useDate_1[_0x2f2d95(0x116)])(),_0x8c89f3=_0x137353(new Date()),_0x7b9d1=(0x0,moment_1[_0x2f2d95(0x140)])()[_0x2f2d95(0x151)](),_0x5691da=await ApiUsages_1[_0x2f2d95(0x140)][_0x2f2d95(0x130)]({'where':{'dateUsed':_0x8c89f3,'companyId':_0x2589b4}});if(_0x5691da)await _0x5691da['update']({'usedPDF':_0x5691da[_0x2f2d95(0xfe)][_0x2f2d95(0x129)]+0x1,'UsedOnDay':_0x5691da[_0x2f2d95(0xfe)][_0x2f2d95(0x10e)]+0x1,'updatedAt':_0x7b9d1});else{const _0x3d5883=await ApiUsages_1['default'][_0x2f2d95(0x12c)]({'companyId':_0x2589b4,'dateUsed':_0x8c89f3});await _0x3d5883[_0x2f2d95(0x12d)]({'usedPDF':_0x3d5883[_0x2f2d95(0xfe)]['usedPDF']+0x1,'UsedOnDay':_0x3d5883[_0x2f2d95(0xfe)][_0x2f2d95(0x10e)]+0x1,'updatedAt':_0x7b9d1});}},0x64),_0x402653[_0x1f4fe0(0x147)]({'status':'SUCCESS'});};exports[a8_0xb1a671(0x15d)]=indexLink;const index=async(_0x2b3533,_0x18cf43)=>{const _0xefd518=a8_0xb1a671,_0x4cceec=_0x2b3533[_0xefd518(0x108)],{whatsappId:_0x3873e2}=_0x2b3533[_0xefd518(0x108)],{msdelay:_0xd51a4e}=_0x2b3533[_0xefd518(0x108)],{body:_0x162f22,quotedMsg:_0xc6a6c5,userId:_0x15118b,queueId:_0xec768c,sendSignature:sendSignature=![],closeTicket:closeTicket=![]}=_0x2b3533[_0xefd518(0x108)],_0x259c8a=_0x2b3533[_0xefd518(0x12a)],_0x59bb55=_0x2b3533[_0xefd518(0xfa)][_0xefd518(0x143)],[,_0x1974b5]=_0x59bb55['split']('\x20'),_0x419701=await Whatsapp_1[_0xefd518(0x140)][_0xefd518(0x130)]({'where':{'token':_0x1974b5}}),_0x451a69=_0x419701[_0xefd518(0x11f)];_0x4cceec[_0xefd518(0x107)]=_0x4cceec['number'][_0xefd518(0x124)]('-','')[_0xefd518(0x124)]('\x20','');const _0x259b0f=Yup[_0xefd518(0x154)]()[_0xefd518(0x158)]({'number':Yup['string']()[_0xefd518(0x160)]()['matches'](/^\d+$/,_0xefd518(0x12b))});try{await _0x259b0f[_0xefd518(0x141)](_0x4cceec);}catch(_0x283ef2){throw new AppError_1[(_0xefd518(0x140))](_0x283ef2[_0xefd518(0x125)]);}let _0x593ed1;_0x15118b?.[_0xefd518(0x13d)]()!==''&&!isNaN(_0x15118b)&&(_0x593ed1=await(0x0,ShowUserService_1['default'])(_0x15118b,_0x451a69));let _0x2130de;_0xec768c?.[_0xefd518(0x13d)]()!==''&&!isNaN(_0xec768c)&&(_0x2130de=await(0x0,ShowQueueService_1[_0xefd518(0x140)])(_0xec768c,_0x451a69));const _0xf64d17=await createContact(_0x419701['id'],_0x451a69,_0x4cceec[_0xefd518(0x107)],_0x15118b,_0xec768c);let _0x11d687;sendSignature&&!(0x0,lodash_1[_0xefd518(0x153)])(_0x593ed1)?_0x11d687='*'+_0x593ed1['name']+':*\x0a'+_0x162f22[_0xefd518(0xf9)]():_0x11d687=_0x162f22['trim']();let _0x497e37;_0x259c8a?(await Promise[_0xefd518(0x13a)](_0x259c8a['map'](async _0x5861e5=>{const _0x38fe81=_0xefd518;_0x497e37=await(0x0,SendWhatsAppMedia_1[_0x38fe81(0x140)])({'body':'‎\x20'+_0x11d687,'media':_0x5861e5,'ticket':_0xf64d17,'isForwarded':![]});})),await(0x0,wbotMessageListener_1['verifyMediaMessage'])(_0x497e37,_0xf64d17,_0xf64d17[_0xefd518(0x156)])):(_0x497e37=await(0x0,SendWhatsAppMessageAPI_1[_0xefd518(0x140)])({'body':'‎\x20'+_0x11d687,'whatsappId':_0x419701['id'],'contact':_0xf64d17[_0xefd518(0x156)],'quotedMsg':_0xc6a6c5,'msdelay':_0xd51a4e}),await(0x0,wbotMessageListener_1[_0xefd518(0x138)])(_0x497e37,_0xf64d17,_0xf64d17[_0xefd518(0x156)]));if(closeTicket)setTimeout(async()=>{await(0x0,UpdateTicketService_1['default'])({'ticketId':_0xf64d17['id'],'ticketData':{'status':'closed','sendFarewellMessage':![],'amountUsedBotQueues':0x0,'lastMessage':_0x162f22},'companyId':_0x451a69});},0x64);else _0x15118b?.[_0xefd518(0x13d)]()!==''&&!isNaN(_0x15118b)&&setTimeout(async()=>{const _0x18aa5c=_0xefd518;await(0x0,UpdateTicketService_1[_0x18aa5c(0x140)])({'ticketId':_0xf64d17['id'],'ticketData':{'status':_0x18aa5c(0x134),'amountUsedBotQueues':0x0,'lastMessage':_0x162f22,'userId':_0x15118b,'queueId':_0xec768c},'companyId':_0x451a69});},0x64);return setTimeout(async()=>{const _0x359802=_0xefd518,{dateToClient:_0x4e0d4b}=(0x0,useDate_1[_0x359802(0x116)])(),_0x21f86b=_0x4e0d4b(new Date()),_0x321a71=(0x0,moment_1['default'])()[_0x359802(0x151)]();let _0x344e86=await ApiUsages_1[_0x359802(0x140)][_0x359802(0x130)]({'where':{'dateUsed':_0x21f86b,'companyId':_0x451a69}});_0x344e86?_0x259c8a?await Promise[_0x359802(0x13a)](_0x259c8a[_0x359802(0x123)](async _0x35b19a=>{const _0x3a124d=_0x359802;if(_0x35b19a[_0x3a124d(0x148)][_0x3a124d(0x10f)](_0x3a124d(0x112)))await _0x344e86['update']({'usedPDF':_0x344e86[_0x3a124d(0xfe)][_0x3a124d(0x129)]+0x1,'UsedOnDay':_0x344e86[_0x3a124d(0xfe)][_0x3a124d(0x10e)]+0x1,'updatedAt':_0x321a71});else{if(_0x35b19a[_0x3a124d(0x148)]['includes'](_0x3a124d(0xfd)))await _0x344e86['update']({'usedImage':_0x344e86[_0x3a124d(0xfe)][_0x3a124d(0x15b)]+0x1,'UsedOnDay':_0x344e86[_0x3a124d(0xfe)][_0x3a124d(0x10e)]+0x1,'updatedAt':_0x321a71});else _0x35b19a[_0x3a124d(0x148)][_0x3a124d(0x10f)](_0x3a124d(0x133))?await _0x344e86[_0x3a124d(0x12d)]({'usedVideo':_0x344e86[_0x3a124d(0xfe)][_0x3a124d(0x137)]+0x1,'UsedOnDay':_0x344e86[_0x3a124d(0xfe)][_0x3a124d(0x10e)]+0x1,'updatedAt':_0x321a71}):await _0x344e86[_0x3a124d(0x12d)]({'usedOther':_0x344e86[_0x3a124d(0xfe)][_0x3a124d(0xff)]+0x1,'UsedOnDay':_0x344e86[_0x3a124d(0xfe)][_0x3a124d(0x10e)]+0x1,'updatedAt':_0x321a71});}})):await _0x344e86[_0x359802(0x12d)]({'usedText':_0x344e86[_0x359802(0xfe)][_0x359802(0x103)]+0x1,'UsedOnDay':_0x344e86[_0x359802(0xfe)]['UsedOnDay']+0x1,'updatedAt':_0x321a71}):(_0x344e86=await ApiUsages_1[_0x359802(0x140)][_0x359802(0x12c)]({'companyId':_0x451a69,'dateUsed':_0x21f86b}),_0x259c8a?await Promise[_0x359802(0x13a)](_0x259c8a[_0x359802(0x123)](async _0x3ef799=>{const _0x57649f=_0x359802;if(_0x3ef799[_0x57649f(0x148)]['includes'](_0x57649f(0x112)))await _0x344e86['update']({'usedPDF':_0x344e86[_0x57649f(0xfe)][_0x57649f(0x129)]+0x1,'UsedOnDay':_0x344e86[_0x57649f(0xfe)]['UsedOnDay']+0x1,'updatedAt':_0x321a71});else{if(_0x3ef799['mimetype'][_0x57649f(0x10f)](_0x57649f(0xfd)))await _0x344e86['update']({'usedImage':_0x344e86[_0x57649f(0xfe)]['usedImage']+0x1,'UsedOnDay':_0x344e86[_0x57649f(0xfe)][_0x57649f(0x10e)]+0x1,'updatedAt':_0x321a71});else _0x3ef799[_0x57649f(0x148)][_0x57649f(0x10f)](_0x57649f(0x133))?await _0x344e86[_0x57649f(0x12d)]({'usedVideo':_0x344e86[_0x57649f(0xfe)][_0x57649f(0x137)]+0x1,'UsedOnDay':_0x344e86[_0x57649f(0xfe)]['UsedOnDay']+0x1,'updatedAt':_0x321a71}):await _0x344e86[_0x57649f(0x12d)]({'usedOther':_0x344e86[_0x57649f(0xfe)][_0x57649f(0xff)]+0x1,'UsedOnDay':_0x344e86[_0x57649f(0xfe)][_0x57649f(0x10e)]+0x1,'updatedAt':_0x321a71});}})):await _0x344e86[_0x359802(0x12d)]({'usedText':_0x344e86[_0x359802(0xfe)][_0x359802(0x103)]+0x1,'UsedOnDay':_0x344e86[_0x359802(0xfe)][_0x359802(0x10e)]+0x1,'updatedAt':_0x321a71}));},0x64),_0x18cf43[_0xefd518(0x147)]({'status':_0xefd518(0x155)});};exports[a8_0xb1a671(0x115)]=index;const indexImage=async(_0x1f2d71,_0x325cfb)=>{const _0x2f5849=a8_0xb1a671,_0x573453=_0x1f2d71['body'],{whatsappId:_0x4a4bb7}=_0x1f2d71['body'],{msdelay:_0x555e62}=_0x1f2d71['body'],_0x2f4cb2=_0x1f2d71[_0x2f5849(0x108)][_0x2f5849(0x11d)],_0x202dce=_0x1f2d71['body'][_0x2f5849(0x14b)],_0x1be9d8=_0x1f2d71[_0x2f5849(0xfa)][_0x2f5849(0x143)],[,_0x363254]=_0x1be9d8[_0x2f5849(0x117)]('\x20'),_0x463b48=await Whatsapp_1[_0x2f5849(0x140)]['findOne']({'where':{'token':_0x363254}}),_0x1a15bf=_0x463b48[_0x2f5849(0x11f)];_0x573453[_0x2f5849(0x107)]=_0x573453['number'][_0x2f5849(0x124)]('-','')[_0x2f5849(0x124)]('\x20','');const _0x20ddcc=Yup[_0x2f5849(0x154)]()['shape']({'number':Yup[_0x2f5849(0x101)]()[_0x2f5849(0x160)]()[_0x2f5849(0x146)](/^\d+$/,_0x2f5849(0x12b))});try{await _0x20ddcc[_0x2f5849(0x141)](_0x573453);}catch(_0x4faa1b){throw new AppError_1[(_0x2f5849(0x140))](_0x4faa1b['message']);}const _0x25050c=await createContact(_0x4a4bb7,_0x1a15bf,_0x573453[_0x2f5849(0x107)]);return _0x2f4cb2&&await(0x0,SendWhatsappMediaImage_1['default'])({'ticket':_0x25050c,'url':_0x2f4cb2,'caption':_0x202dce,'msdelay':_0x555e62}),setTimeout(async()=>{const _0xa9d3f1=_0x2f5849;await(0x0,UpdateTicketService_1[_0xa9d3f1(0x140)])({'ticketId':_0x25050c['id'],'ticketData':{'status':_0xa9d3f1(0x128),'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x1a15bf});},0x64),setTimeout(async()=>{const _0x180d4b=_0x2f5849,{dateToClient:_0x32a95a}=(0x0,useDate_1[_0x180d4b(0x116)])(),_0x178a4a=_0x32a95a(new Date()),_0x335bb6=(0x0,moment_1[_0x180d4b(0x140)])()['format'](),_0x278967=await ApiUsages_1[_0x180d4b(0x140)][_0x180d4b(0x130)]({'where':{'dateUsed':_0x178a4a,'companyId':_0x1a15bf}});if(_0x278967)await _0x278967[_0x180d4b(0x12d)]({'usedImage':_0x278967[_0x180d4b(0xfe)][_0x180d4b(0x15b)]+0x1,'UsedOnDay':_0x278967[_0x180d4b(0xfe)][_0x180d4b(0x10e)]+0x1,'updatedAt':_0x335bb6});else{const _0x36c4bb=await ApiUsages_1[_0x180d4b(0x140)][_0x180d4b(0x12c)]({'companyId':_0x1a15bf,'dateUsed':_0x178a4a});await _0x36c4bb[_0x180d4b(0x12d)]({'usedImage':_0x36c4bb[_0x180d4b(0xfe)][_0x180d4b(0x15b)]+0x1,'UsedOnDay':_0x36c4bb[_0x180d4b(0xfe)][_0x180d4b(0x10e)]+0x1,'updatedAt':_0x335bb6});}},0x64),_0x325cfb['send']({'status':_0x2f5849(0x155)});};exports[a8_0xb1a671(0x11b)]=indexImage;const checkNumber=async(_0xb502d,_0xb894b4)=>{const _0x36f0b3=a8_0xb1a671,_0x59371a=_0xb502d['body'],_0x3dad71=_0xb502d[_0x36f0b3(0xfa)][_0x36f0b3(0x143)],[,_0x2b23cc]=_0x3dad71[_0x36f0b3(0x117)]('\x20'),_0x5454f3=await Whatsapp_1['default']['findOne']({'where':{'token':_0x2b23cc}}),_0x43cdad=_0x5454f3['companyId'],_0x4e1a95=_0x59371a[_0x36f0b3(0x107)][_0x36f0b3(0x124)]('-','')[_0x36f0b3(0x124)]('\x20',''),_0x35277b=await(0x0,GetDefaultWhatsApp_1['default'])(_0x43cdad),_0x474aba=(0x0,wbot_1[_0x36f0b3(0x15a)])(_0x35277b['id']),_0x1e88e4=createJid(_0x4e1a95);try{const [_0x5b8d76]=await _0x474aba['onWhatsApp'](_0x1e88e4);if(_0x5b8d76['exists'])return setTimeout(async()=>{const _0x182453=_0x36f0b3,{dateToClient:_0x17f410}=(0x0,useDate_1[_0x182453(0x116)])(),_0x2730fa=_0x17f410(new Date()),_0x1937b6=(0x0,moment_1[_0x182453(0x140)])()[_0x182453(0x151)](),_0x21d589=await ApiUsages_1[_0x182453(0x140)][_0x182453(0x130)]({'where':{'dateUsed':_0x2730fa,'companyId':_0x43cdad}});if(_0x21d589)await _0x21d589['update']({'usedCheckNumber':_0x21d589[_0x182453(0xfe)][_0x182453(0x110)]+0x1,'UsedOnDay':_0x21d589[_0x182453(0xfe)][_0x182453(0x10e)]+0x1,'updatedAt':_0x1937b6});else{const _0x449c43=await ApiUsages_1[_0x182453(0x140)][_0x182453(0x12c)]({'companyId':_0x43cdad,'dateUsed':_0x2730fa});await _0x449c43['update']({'usedCheckNumber':_0x449c43[_0x182453(0xfe)][_0x182453(0x110)]+0x1,'UsedOnDay':_0x449c43[_0x182453(0xfe)][_0x182453(0x10e)]+0x1,'updatedAt':_0x1937b6});}},0x64),_0xb894b4[_0x36f0b3(0x119)](0xc8)['json']({'existsInWhatsapp':!![],'number':_0x4e1a95,'numberFormatted':_0x5b8d76[_0x36f0b3(0x139)]});}catch(_0x9d55af){return _0xb894b4['status'](0x190)[_0x36f0b3(0x109)]({'existsInWhatsapp':![],'number':_0x1e88e4,'error':_0x36f0b3(0xf8)});}};exports[a8_0xb1a671(0x15f)]=checkNumber;const indexWhatsappsId=async(_0x33deb9,_0x1557b4)=>{const _0x2d1d99=a8_0xb1a671;return _0x1557b4[_0x2d1d99(0x119)](0xc8)[_0x2d1d99(0x109)]('oi');};exports['indexWhatsappsId']=indexWhatsappsId;