'use strict';const a8_0x3c16a7=a8_0x28b6;(function(_0x2036d5,_0x3a5e3f){const _0x34df4f=a8_0x28b6,_0x15cf03=_0x2036d5();while(!![]){try{const _0x133794=-parseInt(_0x34df4f(0x122))/0x1*(-parseInt(_0x34df4f(0x17c))/0x2)+parseInt(_0x34df4f(0x13b))/0x3+-parseInt(_0x34df4f(0x139))/0x4*(parseInt(_0x34df4f(0x16b))/0x5)+parseInt(_0x34df4f(0x160))/0x6*(parseInt(_0x34df4f(0x156))/0x7)+-parseInt(_0x34df4f(0x151))/0x8*(-parseInt(_0x34df4f(0x16e))/0x9)+parseInt(_0x34df4f(0x183))/0xa*(-parseInt(_0x34df4f(0x17f))/0xb)+parseInt(_0x34df4f(0x145))/0xc*(-parseInt(_0x34df4f(0x137))/0xd);if(_0x133794===_0x3a5e3f)break;else _0x15cf03['push'](_0x15cf03['shift']());}catch(_0x2f8023){_0x15cf03['push'](_0x15cf03['shift']());}}}(a8_0x2532,0xaa858));var __createBinding=this&&this[a8_0x3c16a7(0x174)]||(Object['create']?function(_0x421633,_0x77ba41,_0x1a3f59,_0x5f3060){const _0x1df513=a8_0x3c16a7;if(_0x5f3060===undefined)_0x5f3060=_0x1a3f59;var _0xc72d96=Object[_0x1df513(0x124)](_0x77ba41,_0x1a3f59);(!_0xc72d96||('get'in _0xc72d96?!_0x77ba41[_0x1df513(0x181)]:_0xc72d96[_0x1df513(0x184)]||_0xc72d96[_0x1df513(0x175)]))&&(_0xc72d96={'enumerable':!![],'get':function(){return _0x77ba41[_0x1a3f59];}}),Object[_0x1df513(0x150)](_0x421633,_0x5f3060,_0xc72d96);}:function(_0x196d0b,_0x5c98e1,_0x12a659,_0x7716a8){if(_0x7716a8===undefined)_0x7716a8=_0x12a659;_0x196d0b[_0x7716a8]=_0x5c98e1[_0x12a659];}),__setModuleDefault=this&&this[a8_0x3c16a7(0x157)]||(Object[a8_0x3c16a7(0x14b)]?function(_0xe6c1a,_0x516979){const _0x42d699=a8_0x3c16a7;Object[_0x42d699(0x150)](_0xe6c1a,_0x42d699(0x15f),{'enumerable':!![],'value':_0x516979});}:function(_0x254d09,_0x23872c){const _0x5777f6=a8_0x3c16a7;_0x254d09[_0x5777f6(0x15f)]=_0x23872c;}),__importStar=this&&this[a8_0x3c16a7(0x12a)]||function(_0x4fe4e4){const _0x17de13=a8_0x3c16a7;if(_0x4fe4e4&&_0x4fe4e4[_0x17de13(0x181)])return _0x4fe4e4;var _0x3143c2={};if(_0x4fe4e4!=null){for(var _0x26f65a in _0x4fe4e4)if(_0x26f65a!==_0x17de13(0x15f)&&Object['prototype'][_0x17de13(0x140)]['call'](_0x4fe4e4,_0x26f65a))__createBinding(_0x3143c2,_0x4fe4e4,_0x26f65a);}return __setModuleDefault(_0x3143c2,_0x4fe4e4),_0x3143c2;},__importDefault=this&&this[a8_0x3c16a7(0x12b)]||function(_0x3f3a9e){const _0x5b06a8=a8_0x3c16a7;return _0x3f3a9e&&_0x3f3a9e[_0x5b06a8(0x181)]?_0x3f3a9e:{'default':_0x3f3a9e};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a8_0x3c16a7(0x187)]=exports['checkNumber']=exports[a8_0x3c16a7(0x144)]=exports['index']=exports[a8_0x3c16a7(0x14c)]=exports['OnWhatsAppDto']=void 0x0;const Yup=__importStar(require('yup')),AppError_1=__importDefault(require(a8_0x3c16a7(0x164))),GetDefaultWhatsApp_1=__importDefault(require(a8_0x3c16a7(0x127))),SetTicketMessagesAsRead_1=__importDefault(require(a8_0x3c16a7(0x132))),Whatsapp_1=__importDefault(require('../models/Whatsapp')),CreateOrUpdateContactService_1=__importDefault(require(a8_0x3c16a7(0x166))),FindOrCreateTicketService_1=__importDefault(require('../services/TicketServices/FindOrCreateTicketService')),ShowTicketService_1=__importDefault(require(a8_0x3c16a7(0x15a))),CheckIsValidContact_1=__importDefault(require('../services/WbotServices/CheckIsValidContact')),CheckNumber_1=__importDefault(require(a8_0x3c16a7(0x177))),SendWhatsAppMedia_1=__importDefault(require('../services/WbotServices/SendWhatsAppMedia')),UpdateTicketService_1=__importDefault(require(a8_0x3c16a7(0x186))),wbot_1=require(a8_0x3c16a7(0x178)),SendWhatsAppMessageLink_1=__importDefault(require(a8_0x3c16a7(0x15b))),SendWhatsAppMessageAPI_1=__importDefault(require(a8_0x3c16a7(0x180))),SendWhatsappMediaImage_1=__importDefault(require('../services/WbotServices/SendWhatsappMediaImage')),ApiUsages_1=__importDefault(require('../models/ApiUsages')),useDate_1=require('../utils/useDate'),moment_1=__importDefault(require('moment')),CompaniesSettings_1=__importDefault(require(a8_0x3c16a7(0x15c))),ShowUserService_1=__importDefault(require('../services/UserServices/ShowUserService')),lodash_1=require('lodash'),wbotMessageListener_1=require(a8_0x3c16a7(0x146));class OnWhatsAppDto{constructor(_0x41ceec,_0x28adf3){const _0x31f9a6=a8_0x3c16a7;this[_0x31f9a6(0x168)]=_0x41ceec,this[_0x31f9a6(0x128)]=_0x28adf3;}}function a8_0x28b6(_0x1010f0,_0x1ff67c){const _0x2532ee=a8_0x2532();return a8_0x28b6=function(_0x28b6c3,_0x2c96df){_0x28b6c3=_0x28b6c3-0x122;let _0x1e9217=_0x2532ee[_0x28b6c3];return _0x1e9217;},a8_0x28b6(_0x1010f0,_0x1ff67c);}exports['OnWhatsAppDto']=OnWhatsAppDto;const createContact=async(_0x2a6ec8,_0x17f3db,_0x17938f,_0x1de2aa,_0x3db6f9)=>{const _0x2cea3e=a8_0x3c16a7;await(0x0,CheckIsValidContact_1[_0x2cea3e(0x15f)])(_0x17938f,_0x17f3db);const _0x344d4c=await(0x0,CheckNumber_1['default'])(_0x17938f,_0x17f3db),_0x50ab08='',_0x6b10e5=_0x344d4c,_0x1e4945={'name':''+_0x6b10e5,'number':_0x6b10e5,'profilePicUrl':_0x50ab08,'isGroup':![],'companyId':_0x17f3db},_0xf81126=await(0x0,CreateOrUpdateContactService_1['default'])(_0x1e4945),_0x55531c=await CompaniesSettings_1[_0x2cea3e(0x15f)][_0x2cea3e(0x179)]({'where':{'companyId':_0x17f3db}});let _0x52adef;if(_0x2a6ec8===undefined)_0x52adef=await(0x0,GetDefaultWhatsApp_1['default'])(_0x17f3db);else{_0x52adef=await Whatsapp_1['default']['findByPk'](_0x2a6ec8);if(_0x52adef===null)throw new AppError_1[(_0x2cea3e(0x15f))]('whatsapp\x20#'+_0x2a6ec8+_0x2cea3e(0x169));}const {ticket:_0x4b34bf,isCreated:_0x113063}=await(0x0,FindOrCreateTicketService_1['default'])(_0xf81126,_0x52adef,0x0,_0x17f3db,_0x3db6f9,_0x1de2aa,null,_0x2cea3e(0x130),null,![],_0x55531c);let _0x41e22d;return _0x4b34bf&&(_0x41e22d=await(0x0,ShowTicketService_1['default'])(_0x4b34bf['id'],_0x17f3db),(0x0,SetTicketMessagesAsRead_1[_0x2cea3e(0x15f)])(_0x41e22d)),_0x41e22d;};function formatBRNumber(_0x266780){const _0x47237e=a8_0x3c16a7,_0x436834=new RegExp(/^(\d{2})(\d{2})\d{1}(\d{8})$/);if(_0x436834[_0x47237e(0x176)](_0x266780)){const _0xd35e7d=_0x436834[_0x47237e(0x12d)](_0x266780);if(_0xd35e7d&&_0xd35e7d[0x1]==='55'&&Number[_0x47237e(0x12c)](Number['parseInt'](_0xd35e7d[0x2]))){const _0x50744c=Number['parseInt'](_0xd35e7d[0x2]);if(_0x50744c<0x1f)return _0xd35e7d[0x0];else{if(_0x50744c>=0x1f)return _0xd35e7d[0x1]+_0xd35e7d[0x2]+_0xd35e7d[0x3];}}}else return _0x266780;}function a8_0x2532(){const _0x165c1c=['1900198SjxIOG','SUCCESS','validate','154TPJJZF','../services/WbotServices/SendWhatsAppMessageAPI','__esModule','headers','170540rHMEFA','writable','format','../services/TicketServices/UpdateTicketService','indexWhatsappsId','onWhatsApp','1lygCyK','index','getOwnPropertyDescriptor','message','includes','../helpers/GetDefaultWhatsApp','exists','toString','__importStar','__importDefault','isInteger','exec','usedPDF','usedText','whatsapp','number','../helpers/SetTicketMessagesAsRead','true','string','map','Not\x20exists\x20on\x20Whatsapp','11684192POOgIZ','dataValues','36tJvBrb','contact','1405653siAhKR','mimetype','shape','video','update','hasOwnProperty','caption','verifyMediaMessage','all','indexImage','24FpLeXR','../services/WbotServices/wbotMessageListener','send',':*\x0a','@s.whatsapp.net','status','create','indexLink','usedImage','usedCheckNumber','log','defineProperty','3144kHHtkI','useDate','image','pdf','replace','342615nIDSnb','__setModuleDefault','authorization','required','../services/TicketServices/ShowTicketService','../services/WbotServices/SendWhatsAppMessageLink','../models/CompaniesSettings','url','checkNumber','default','162tFGEPG','UsedOnDay','companyId','usedOther','../errors/AppError','json','../services/ContactServices/CreateOrUpdateContactService','object','jid','\x20not\x20found','entrou\x20aqui','284860EuuGvE','user','trim','11619FWhyVO','@g.us','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','split','usedVideo','matches','__createBinding','configurable','test','../services/WbotServices/CheckNumber','../libs/wbot','findOne','body','getWbot'];a8_0x2532=function(){return _0x165c1c;};return a8_0x2532();}function createJid(_0x52dfb9){const _0x4a94d8=a8_0x3c16a7;if(_0x52dfb9['includes'](_0x4a94d8(0x16f))||_0x52dfb9[_0x4a94d8(0x126)](_0x4a94d8(0x149)))return formatBRNumber(_0x52dfb9);return _0x52dfb9[_0x4a94d8(0x126)]('-')?_0x52dfb9+_0x4a94d8(0x16f):formatBRNumber(_0x52dfb9)+_0x4a94d8(0x149);}const indexLink=async(_0x47b2e7,_0x124eda)=>{const _0x1becb3=a8_0x3c16a7,_0x51bb7c=_0x47b2e7['body'],{whatsappId:_0x34cebb}=_0x47b2e7[_0x1becb3(0x17a)],{msdelay:_0x9ff8dc}=_0x47b2e7[_0x1becb3(0x17a)],_0x507f0b=_0x47b2e7[_0x1becb3(0x17a)][_0x1becb3(0x15d)],_0x22f73f=_0x47b2e7[_0x1becb3(0x17a)][_0x1becb3(0x141)],_0x363629=_0x47b2e7['headers'][_0x1becb3(0x158)],[,_0x47daf5]=_0x363629[_0x1becb3(0x171)]('\x20'),_0xb4ce0b=await Whatsapp_1['default']['findOne']({'where':{'token':_0x47daf5}}),_0x433519=_0xb4ce0b[_0x1becb3(0x162)];_0x51bb7c['number']=_0x51bb7c['number'][_0x1becb3(0x155)]('-','')[_0x1becb3(0x155)]('\x20','');const _0x41a5de=Yup[_0x1becb3(0x167)]()[_0x1becb3(0x13d)]({'number':Yup[_0x1becb3(0x134)]()['required']()[_0x1becb3(0x173)](/^\d+$/,_0x1becb3(0x170))});try{await _0x41a5de[_0x1becb3(0x17e)](_0x51bb7c);}catch(_0x3345d1){throw new AppError_1['default'](_0x3345d1['message']);}const _0x299dbf=await createContact(_0x34cebb,_0x433519,_0x51bb7c['number']);if(!_0x299dbf)throw new AppError_1[(_0x1becb3(0x15f))]('Cliente\x20em\x20outro\x20atendimento');return await(0x0,SendWhatsAppMessageLink_1[_0x1becb3(0x15f)])({'whatsappId':_0x34cebb,'contact':_0x299dbf[_0x1becb3(0x13a)],'url':_0x507f0b,'caption':_0x22f73f,'msdelay':_0x9ff8dc}),setTimeout(async()=>{const _0x34f450=_0x1becb3,{dateToClient:_0x1fa5c3}=(0x0,useDate_1[_0x34f450(0x152)])(),_0x3e6803=_0x1fa5c3(new Date()),_0x3c1ec6=(0x0,moment_1['default'])()[_0x34f450(0x185)](),_0xef8fc1=await ApiUsages_1[_0x34f450(0x15f)][_0x34f450(0x179)]({'where':{'dateUsed':_0x3e6803,'companyId':_0x433519}});if(_0xef8fc1)await _0xef8fc1[_0x34f450(0x13f)]({'usedPDF':_0xef8fc1[_0x34f450(0x138)][_0x34f450(0x12e)]+0x1,'UsedOnDay':_0xef8fc1[_0x34f450(0x138)][_0x34f450(0x161)]+0x1,'updatedAt':_0x3c1ec6});else{const _0x3c15a8=await ApiUsages_1['default'][_0x34f450(0x14b)]({'companyId':_0x433519,'dateUsed':_0x3e6803});await _0x3c15a8['update']({'usedPDF':_0x3c15a8['dataValues'][_0x34f450(0x12e)]+0x1,'UsedOnDay':_0x3c15a8['dataValues'][_0x34f450(0x161)]+0x1,'updatedAt':_0x3c1ec6});}},0x64),_0x124eda[_0x1becb3(0x147)]({'status':_0x1becb3(0x17d)});};exports['indexLink']=indexLink;const index=async(_0x4a6d8f,_0x282330)=>{const _0x15bcdc=a8_0x3c16a7,_0x3c01f5=_0x4a6d8f[_0x15bcdc(0x17a)],{whatsappId:_0x3bdab3}=_0x4a6d8f['body'],{msdelay:_0x5c220f}=_0x4a6d8f[_0x15bcdc(0x17a)],{body:_0xff0f59,quotedMsg:_0x3c7568,userId:_0x4edb59,queueId:_0x1eabcb,sendSignature:_0x3e4f10,closeTicket:_0xcfbe8d}=_0x4a6d8f['body'],_0x1fc483=_0x4a6d8f['files'],_0x5ab814=_0x4a6d8f[_0x15bcdc(0x182)][_0x15bcdc(0x158)],[,_0x545364]=_0x5ab814['split']('\x20'),_0x2656da=await Whatsapp_1[_0x15bcdc(0x15f)][_0x15bcdc(0x179)]({'where':{'token':_0x545364}}),_0x52b9ac=_0x2656da['companyId'];console['log']('entrou\x20aqui\x20api',_0x4edb59,_0x1eabcb,_0x3e4f10,_0xcfbe8d),_0x3c01f5['number']=_0x3c01f5[_0x15bcdc(0x131)]['replace']('-','')['replace']('\x20','');const _0x546ae2=Yup[_0x15bcdc(0x167)]()[_0x15bcdc(0x13d)]({'number':Yup[_0x15bcdc(0x134)]()['required']()[_0x15bcdc(0x173)](/^\d+$/,_0x15bcdc(0x170))});try{await _0x546ae2['validate'](_0x3c01f5);}catch(_0x556b43){throw new AppError_1['default'](_0x556b43[_0x15bcdc(0x125)]);}let _0x532334;_0x4edb59[_0x15bcdc(0x129)]()!==''&&!isNaN(_0x4edb59)&&(console[_0x15bcdc(0x14f)]('entrou\x20aqui\x20no\x20showuser'),_0x532334=await(0x0,ShowUserService_1[_0x15bcdc(0x15f)])(_0x4edb59));const _0x30a82c=await createContact(_0x2656da['id'],_0x52b9ac,_0x3c01f5[_0x15bcdc(0x131)],_0x4edb59,_0x1eabcb);let _0x549679;_0x3e4f10&&!(0x0,lodash_1['isNil'])(_0x532334)?_0x549679='*'+_0x532334['name']+_0x15bcdc(0x148)+_0xff0f59[_0x15bcdc(0x16d)]():_0x549679=_0xff0f59[_0x15bcdc(0x16d)]();let _0xba4093;return _0x1fc483?(await Promise['all'](_0x1fc483[_0x15bcdc(0x135)](async _0x4492a2=>{const _0x41a4a2=_0x15bcdc;_0xba4093=await(0x0,SendWhatsAppMedia_1[_0x41a4a2(0x15f)])({'body':'‎'+_0x549679,'media':_0x4492a2,'ticket':_0x30a82c,'isForwarded':![]});})),await(0x0,wbotMessageListener_1[_0x15bcdc(0x142)])(_0xba4093,_0x30a82c,_0x30a82c[_0x15bcdc(0x13a)])):(_0xba4093=await(0x0,SendWhatsAppMessageAPI_1[_0x15bcdc(0x15f)])({'body':_0x549679,'whatsappId':_0x2656da['id'],'contact':_0x30a82c[_0x15bcdc(0x13a)],'quotedMsg':_0x3c7568,'msdelay':_0x5c220f}),await(0x0,wbotMessageListener_1['verifyMessage'])(_0xba4093,_0x30a82c,_0x30a82c[_0x15bcdc(0x13a)])),console[_0x15bcdc(0x14f)](_0xcfbe8d),(_0xcfbe8d||_0xcfbe8d===_0x15bcdc(0x133))&&(console['log'](_0x15bcdc(0x16a)),setTimeout(async()=>{const _0x1517c4=_0x15bcdc;await(0x0,UpdateTicketService_1[_0x1517c4(0x15f)])({'ticketId':_0x30a82c['id'],'ticketData':{'status':'closed','sendFarewellMessage':![],'amountUsedBotQueues':0x0,'lastMessage':_0xff0f59},'companyId':_0x52b9ac});},0x64)),setTimeout(async()=>{const _0x365d07=_0x15bcdc,{dateToClient:_0x1fbacf}=(0x0,useDate_1['useDate'])(),_0x5db869=_0x1fbacf(new Date()),_0x3ebbb9=(0x0,moment_1['default'])()['format']();let _0x371ccf=await ApiUsages_1[_0x365d07(0x15f)][_0x365d07(0x179)]({'where':{'dateUsed':_0x5db869,'companyId':_0x52b9ac}});_0x371ccf?_0x1fc483?await Promise['all'](_0x1fc483[_0x365d07(0x135)](async _0x565b87=>{const _0x4f6d69=_0x365d07;if(_0x565b87[_0x4f6d69(0x13c)][_0x4f6d69(0x126)]('pdf'))await _0x371ccf[_0x4f6d69(0x13f)]({'usedPDF':_0x371ccf[_0x4f6d69(0x138)][_0x4f6d69(0x12e)]+0x1,'UsedOnDay':_0x371ccf[_0x4f6d69(0x138)]['UsedOnDay']+0x1,'updatedAt':_0x3ebbb9});else{if(_0x565b87['mimetype'][_0x4f6d69(0x126)](_0x4f6d69(0x153)))await _0x371ccf[_0x4f6d69(0x13f)]({'usedImage':_0x371ccf[_0x4f6d69(0x138)]['usedImage']+0x1,'UsedOnDay':_0x371ccf[_0x4f6d69(0x138)][_0x4f6d69(0x161)]+0x1,'updatedAt':_0x3ebbb9});else _0x565b87[_0x4f6d69(0x13c)][_0x4f6d69(0x126)](_0x4f6d69(0x13e))?await _0x371ccf[_0x4f6d69(0x13f)]({'usedVideo':_0x371ccf[_0x4f6d69(0x138)][_0x4f6d69(0x172)]+0x1,'UsedOnDay':_0x371ccf[_0x4f6d69(0x138)][_0x4f6d69(0x161)]+0x1,'updatedAt':_0x3ebbb9}):await _0x371ccf['update']({'usedOther':_0x371ccf['dataValues'][_0x4f6d69(0x163)]+0x1,'UsedOnDay':_0x371ccf['dataValues'][_0x4f6d69(0x161)]+0x1,'updatedAt':_0x3ebbb9});}})):await _0x371ccf[_0x365d07(0x13f)]({'usedText':_0x371ccf['dataValues'][_0x365d07(0x12f)]+0x1,'UsedOnDay':_0x371ccf['dataValues']['UsedOnDay']+0x1,'updatedAt':_0x3ebbb9}):(_0x371ccf=await ApiUsages_1[_0x365d07(0x15f)][_0x365d07(0x14b)]({'companyId':_0x52b9ac,'dateUsed':_0x5db869}),_0x1fc483?await Promise[_0x365d07(0x143)](_0x1fc483[_0x365d07(0x135)](async _0x749535=>{const _0x441659=_0x365d07;if(_0x749535[_0x441659(0x13c)][_0x441659(0x126)](_0x441659(0x154)))await _0x371ccf['update']({'usedPDF':_0x371ccf[_0x441659(0x138)][_0x441659(0x12e)]+0x1,'UsedOnDay':_0x371ccf[_0x441659(0x138)][_0x441659(0x161)]+0x1,'updatedAt':_0x3ebbb9});else{if(_0x749535[_0x441659(0x13c)][_0x441659(0x126)](_0x441659(0x153)))await _0x371ccf[_0x441659(0x13f)]({'usedImage':_0x371ccf[_0x441659(0x138)][_0x441659(0x14d)]+0x1,'UsedOnDay':_0x371ccf[_0x441659(0x138)][_0x441659(0x161)]+0x1,'updatedAt':_0x3ebbb9});else _0x749535['mimetype']['includes']('video')?await _0x371ccf[_0x441659(0x13f)]({'usedVideo':_0x371ccf['dataValues']['usedVideo']+0x1,'UsedOnDay':_0x371ccf[_0x441659(0x138)][_0x441659(0x161)]+0x1,'updatedAt':_0x3ebbb9}):await _0x371ccf['update']({'usedOther':_0x371ccf[_0x441659(0x138)][_0x441659(0x163)]+0x1,'UsedOnDay':_0x371ccf[_0x441659(0x138)][_0x441659(0x161)]+0x1,'updatedAt':_0x3ebbb9});}})):await _0x371ccf['update']({'usedText':_0x371ccf[_0x365d07(0x138)][_0x365d07(0x12f)]+0x1,'UsedOnDay':_0x371ccf[_0x365d07(0x138)]['UsedOnDay']+0x1,'updatedAt':_0x3ebbb9}));},0x64),_0x282330[_0x15bcdc(0x147)]({'status':_0x15bcdc(0x17d)});};exports[a8_0x3c16a7(0x123)]=index;const indexImage=async(_0x5d4ce5,_0x422aeb)=>{const _0x5a9c1d=a8_0x3c16a7,_0x58b5ee=_0x5d4ce5[_0x5a9c1d(0x17a)],{whatsappId:_0x25a279}=_0x5d4ce5[_0x5a9c1d(0x17a)],{msdelay:_0x32887b}=_0x5d4ce5[_0x5a9c1d(0x17a)],_0x3d7258=_0x5d4ce5[_0x5a9c1d(0x17a)][_0x5a9c1d(0x15d)],_0x2ebc21=_0x5d4ce5[_0x5a9c1d(0x17a)]['caption'],_0x2e6fe7=_0x5d4ce5[_0x5a9c1d(0x182)]['authorization'],[,_0x24a9dc]=_0x2e6fe7[_0x5a9c1d(0x171)]('\x20'),_0x580dab=await Whatsapp_1[_0x5a9c1d(0x15f)]['findOne']({'where':{'token':_0x24a9dc}}),_0x306252=_0x580dab[_0x5a9c1d(0x162)];_0x58b5ee['number']=_0x58b5ee[_0x5a9c1d(0x131)][_0x5a9c1d(0x155)]('-','')[_0x5a9c1d(0x155)]('\x20','');const _0xff049e=Yup['object']()[_0x5a9c1d(0x13d)]({'number':Yup[_0x5a9c1d(0x134)]()[_0x5a9c1d(0x159)]()['matches'](/^\d+$/,_0x5a9c1d(0x170))});try{await _0xff049e[_0x5a9c1d(0x17e)](_0x58b5ee);}catch(_0x37349a){throw new AppError_1[(_0x5a9c1d(0x15f))](_0x37349a[_0x5a9c1d(0x125)]);}const _0x22f90a=await createContact(_0x25a279,_0x306252,_0x58b5ee[_0x5a9c1d(0x131)]);return _0x3d7258&&await(0x0,SendWhatsappMediaImage_1['default'])({'ticket':_0x22f90a,'url':_0x3d7258,'caption':_0x2ebc21,'msdelay':_0x32887b}),setTimeout(async()=>{const _0x53bd43=_0x5a9c1d;await(0x0,UpdateTicketService_1[_0x53bd43(0x15f)])({'ticketId':_0x22f90a['id'],'ticketData':{'status':'closed','sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x306252});},0x64),setTimeout(async()=>{const _0x5245ae=_0x5a9c1d,{dateToClient:_0x507d8d}=(0x0,useDate_1[_0x5245ae(0x152)])(),_0x4a760b=_0x507d8d(new Date()),_0xd185cf=(0x0,moment_1['default'])()[_0x5245ae(0x185)](),_0x5993f1=await ApiUsages_1[_0x5245ae(0x15f)]['findOne']({'where':{'dateUsed':_0x4a760b,'companyId':_0x306252}});if(_0x5993f1)await _0x5993f1[_0x5245ae(0x13f)]({'usedImage':_0x5993f1['dataValues'][_0x5245ae(0x14d)]+0x1,'UsedOnDay':_0x5993f1[_0x5245ae(0x138)][_0x5245ae(0x161)]+0x1,'updatedAt':_0xd185cf});else{const _0x452890=await ApiUsages_1[_0x5245ae(0x15f)][_0x5245ae(0x14b)]({'companyId':_0x306252,'dateUsed':_0x4a760b});await _0x452890[_0x5245ae(0x13f)]({'usedImage':_0x452890[_0x5245ae(0x138)][_0x5245ae(0x14d)]+0x1,'UsedOnDay':_0x452890[_0x5245ae(0x138)]['UsedOnDay']+0x1,'updatedAt':_0xd185cf});}},0x64),_0x422aeb[_0x5a9c1d(0x147)]({'status':_0x5a9c1d(0x17d)});};exports[a8_0x3c16a7(0x144)]=indexImage;const checkNumber=async(_0x48fa76,_0x4e319e)=>{const _0x3fa22a=a8_0x3c16a7,_0x54f93=_0x48fa76['body'],_0x553dd8=_0x48fa76[_0x3fa22a(0x182)][_0x3fa22a(0x158)],[,_0x54e593]=_0x553dd8['split']('\x20'),_0x2e94f0=await Whatsapp_1[_0x3fa22a(0x15f)][_0x3fa22a(0x179)]({'where':{'token':_0x54e593}}),_0x2505ed=_0x2e94f0[_0x3fa22a(0x162)],_0x1418ce=_0x54f93[_0x3fa22a(0x131)][_0x3fa22a(0x155)]('-','')[_0x3fa22a(0x155)]('\x20',''),_0x314935=await(0x0,GetDefaultWhatsApp_1['default'])(_0x2505ed),_0x3aea92=(0x0,wbot_1[_0x3fa22a(0x17b)])(_0x314935['id']),_0x46779f=createJid(_0x1418ce);try{const [_0xe87af5]=await _0x3aea92[_0x3fa22a(0x188)](_0x46779f);if(_0xe87af5[_0x3fa22a(0x128)])return setTimeout(async()=>{const _0x11292d=_0x3fa22a,{dateToClient:_0x565e98}=(0x0,useDate_1[_0x11292d(0x152)])(),_0x1fe935=_0x565e98(new Date()),_0x3512c7=(0x0,moment_1['default'])()[_0x11292d(0x185)](),_0x5e92a0=await ApiUsages_1[_0x11292d(0x15f)][_0x11292d(0x179)]({'where':{'dateUsed':_0x1fe935,'companyId':_0x2505ed}});if(_0x5e92a0)await _0x5e92a0['update']({'usedCheckNumber':_0x5e92a0[_0x11292d(0x138)][_0x11292d(0x14e)]+0x1,'UsedOnDay':_0x5e92a0[_0x11292d(0x138)][_0x11292d(0x161)]+0x1,'updatedAt':_0x3512c7});else{const _0x11b1cc=await ApiUsages_1[_0x11292d(0x15f)][_0x11292d(0x14b)]({'companyId':_0x2505ed,'dateUsed':_0x1fe935});await _0x11b1cc[_0x11292d(0x13f)]({'usedCheckNumber':_0x11b1cc[_0x11292d(0x138)][_0x11292d(0x14e)]+0x1,'UsedOnDay':_0x11b1cc[_0x11292d(0x138)][_0x11292d(0x161)]+0x1,'updatedAt':_0x3512c7});}},0x64),_0x4e319e[_0x3fa22a(0x14a)](0xc8)[_0x3fa22a(0x165)]({'existsInWhatsapp':!![],'number':_0x1418ce,'numberFormatted':_0xe87af5[_0x3fa22a(0x168)]});}catch(_0xd08926){return _0x4e319e['status'](0x190)[_0x3fa22a(0x165)]({'existsInWhatsapp':![],'number':_0x46779f,'error':_0x3fa22a(0x136)});}};exports[a8_0x3c16a7(0x15e)]=checkNumber;const indexWhatsappsId=async(_0x1223ef,_0x5239e8)=>{const _0x377e13=a8_0x3c16a7;return console[_0x377e13(0x14f)]('req',_0x1223ef),console[_0x377e13(0x14f)]('req',_0x1223ef[_0x377e13(0x16c)]),_0x5239e8[_0x377e13(0x14a)](0xc8)[_0x377e13(0x165)]('oi');};exports[a8_0x3c16a7(0x187)]=indexWhatsappsId;