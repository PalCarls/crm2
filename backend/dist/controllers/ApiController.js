'use strict';const a8_0x70c6f9=a8_0x209a;(function(_0x516f93,_0x24fa15){const _0x2f1b4a=a8_0x209a,_0xe2d78f=_0x516f93();while(!![]){try{const _0x1f3b71=-parseInt(_0x2f1b4a(0x1a8))/0x1+parseInt(_0x2f1b4a(0x157))/0x2+parseInt(_0x2f1b4a(0x156))/0x3*(parseInt(_0x2f1b4a(0x188))/0x4)+parseInt(_0x2f1b4a(0x179))/0x5*(-parseInt(_0x2f1b4a(0x1ad))/0x6)+-parseInt(_0x2f1b4a(0x169))/0x7+-parseInt(_0x2f1b4a(0x1aa))/0x8*(parseInt(_0x2f1b4a(0x14d))/0x9)+parseInt(_0x2f1b4a(0x176))/0xa*(parseInt(_0x2f1b4a(0x191))/0xb);if(_0x1f3b71===_0x24fa15)break;else _0xe2d78f['push'](_0xe2d78f['shift']());}catch(_0x1d3914){_0xe2d78f['push'](_0xe2d78f['shift']());}}}(a8_0x2eb6,0xf0320));function a8_0x2eb6(){const _0xbcab58=['Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','../utils/useDate','__esModule','default','resolve','whatsapp\x20#','../services/WbotServices/SendWhatsAppMedia','existsSync','verifyMediaMessage','../models/Contact','all','393308bXvDiD','files','../errors/AppError','parseInt','../models/Whatsapp','../models/CompaniesSettings','whatsapp','trim','prototype','12802669VNvQXs','object','__setModuleDefault','../helpers/GetDefaultWhatsApp','headers','companyId','index',':*\x0a','url','__createBinding','s.whatsapp.net','indexWhatsappsId','writable','unlinkSync','indexLink','shape','toString','indexImage','OnWhatsAppDto','validate','format','../services/WbotServices/wbotMessageListener','includes','288183BaAegn','send','16KtGPZT','getWbot','usedVideo','6iwUnNF','filename','company','dataValues','jid','../services/WbotServices/SendWhatsAppMessageAPI','split','@s.whatsapp.net','map','caption','replace','name','checkNumber','status','findOne','number','update','../services/WbotServices/CheckNumber','moment','sendMessage','__importStar','usedCheckNumber','Not\x20exists\x20on\x20Whatsapp','3877461ndTKdR','open','hasOwnProperty','../services/UserServices/ShowUserService','string','../services/WbotServices/CheckIsValidContact','usedPDF','usedImage','defineProperty','21OsNpHt','1863772lHvRBY','../helpers/SetTicketMessagesAsRead','../services/WbotServices/SendWhatsAppMessageLink','../models/ApiUsages','closed','isGroup','join','findByPk','required','usedText','video','useDate','getOwnPropertyDescriptor','lodash','usedOther','contact','json','public','12323451NERndV','pdf','body','../services/ContactServices/CreateOrUpdateContactService','mimetype','image','SUCCESS','message','authorization','g.us','UsedOnDay','matches','create','20TxAxkN','exists','@g.us','268795enEBUl','isNil','../libs/wbot','Cliente\x20em\x20outro\x20atendimento'];a8_0x2eb6=function(){return _0xbcab58;};return a8_0x2eb6();}var __createBinding=this&&this[a8_0x70c6f9(0x19a)]||(Object['create']?function(_0x324d10,_0x483f7b,_0x51a123,_0x29575a){const _0x47569d=a8_0x70c6f9;if(_0x29575a===undefined)_0x29575a=_0x51a123;var _0x265bfd=Object[_0x47569d(0x163)](_0x483f7b,_0x51a123);(!_0x265bfd||('get'in _0x265bfd?!_0x483f7b[_0x47569d(0x17f)]:_0x265bfd[_0x47569d(0x19d)]||_0x265bfd['configurable']))&&(_0x265bfd={'enumerable':!![],'get':function(){return _0x483f7b[_0x51a123];}}),Object[_0x47569d(0x155)](_0x324d10,_0x29575a,_0x265bfd);}:function(_0x366caf,_0x3d7674,_0x1609f0,_0x263d95){if(_0x263d95===undefined)_0x263d95=_0x1609f0;_0x366caf[_0x263d95]=_0x3d7674[_0x1609f0];}),__setModuleDefault=this&&this[a8_0x70c6f9(0x193)]||(Object[a8_0x70c6f9(0x175)]?function(_0xd0cbe7,_0xd422ee){const _0x3beeb1=a8_0x70c6f9;Object[_0x3beeb1(0x155)](_0xd0cbe7,'default',{'enumerable':!![],'value':_0xd422ee});}:function(_0xa0f5c0,_0x3fc632){const _0x43acc6=a8_0x70c6f9;_0xa0f5c0[_0x43acc6(0x180)]=_0x3fc632;}),__importStar=this&&this[a8_0x70c6f9(0x14a)]||function(_0x1a57c6){const _0x25e9e4=a8_0x70c6f9;if(_0x1a57c6&&_0x1a57c6[_0x25e9e4(0x17f)])return _0x1a57c6;var _0x4d4fc0={};if(_0x1a57c6!=null){for(var _0xac099b in _0x1a57c6)if(_0xac099b!==_0x25e9e4(0x180)&&Object[_0x25e9e4(0x190)][_0x25e9e4(0x14f)]['call'](_0x1a57c6,_0xac099b))__createBinding(_0x4d4fc0,_0x1a57c6,_0xac099b);}return __setModuleDefault(_0x4d4fc0,_0x1a57c6),_0x4d4fc0;},__importDefault=this&&this['__importDefault']||function(_0x3aa0e7){const _0x1d64a6=a8_0x70c6f9;return _0x3aa0e7&&_0x3aa0e7[_0x1d64a6(0x17f)]?_0x3aa0e7:{'default':_0x3aa0e7};};Object[a8_0x70c6f9(0x155)](exports,'__esModule',{'value':!![]}),exports[a8_0x70c6f9(0x19c)]=exports['checkNumber']=exports[a8_0x70c6f9(0x1a2)]=exports[a8_0x70c6f9(0x197)]=exports[a8_0x70c6f9(0x19f)]=exports[a8_0x70c6f9(0x1a3)]=void 0x0;const Yup=__importStar(require('yup')),fs_1=__importDefault(require('fs')),AppError_1=__importDefault(require(a8_0x70c6f9(0x18a))),GetDefaultWhatsApp_1=__importDefault(require(a8_0x70c6f9(0x194))),SetTicketMessagesAsRead_1=__importDefault(require(a8_0x70c6f9(0x158))),Whatsapp_1=__importDefault(require(a8_0x70c6f9(0x18c))),CreateOrUpdateContactService_1=__importDefault(require(a8_0x70c6f9(0x16c))),FindOrCreateTicketService_1=__importDefault(require('../services/TicketServices/FindOrCreateTicketService')),CheckIsValidContact_1=__importDefault(require(a8_0x70c6f9(0x152))),CheckNumber_1=__importDefault(require(a8_0x70c6f9(0x147))),SendWhatsAppMedia_1=__importStar(require(a8_0x70c6f9(0x183))),UpdateTicketService_1=__importDefault(require('../services/TicketServices/UpdateTicketService')),wbot_1=require(a8_0x70c6f9(0x17b)),SendWhatsAppMessageLink_1=__importDefault(require(a8_0x70c6f9(0x159))),SendWhatsAppMessageAPI_1=__importDefault(require(a8_0x70c6f9(0x1b2))),SendWhatsappMediaImage_1=__importDefault(require('../services/WbotServices/SendWhatsappMediaImage')),ApiUsages_1=__importDefault(require(a8_0x70c6f9(0x15a))),useDate_1=require(a8_0x70c6f9(0x17e)),moment_1=__importDefault(require(a8_0x70c6f9(0x148))),CompaniesSettings_1=__importDefault(require(a8_0x70c6f9(0x18d))),ShowUserService_1=__importDefault(require(a8_0x70c6f9(0x150))),lodash_1=require(a8_0x70c6f9(0x164)),wbotMessageListener_1=require(a8_0x70c6f9(0x1a6)),ShowQueueService_1=__importDefault(require('../services/QueueService/ShowQueueService')),path_1=__importDefault(require('path')),Contact_1=__importDefault(require(a8_0x70c6f9(0x186)));class OnWhatsAppDto{constructor(_0x4b021a,_0x170e99){const _0xd08d32=a8_0x70c6f9;this[_0xd08d32(0x1b1)]=_0x4b021a,this[_0xd08d32(0x177)]=_0x170e99;}}exports['OnWhatsAppDto']=OnWhatsAppDto;function a8_0x209a(_0x1a27b3,_0x4d1127){const _0x2eb615=a8_0x2eb6();return a8_0x209a=function(_0x209a3d,_0x9d4feb){_0x209a3d=_0x209a3d-0x140;let _0x54d58a=_0x2eb615[_0x209a3d];return _0x54d58a;},a8_0x209a(_0x1a27b3,_0x4d1127);}const createContact=async(_0xa3098a,_0x3579bf,_0x910db6,_0x28adff,_0x3763a3)=>{const _0x402525=a8_0x70c6f9;await(0x0,CheckIsValidContact_1[_0x402525(0x180)])(_0x910db6,_0x3579bf);const _0x5a1779=await(0x0,CheckNumber_1['default'])(_0x910db6,_0x3579bf),_0x490d25=_0x5a1779,_0x17ed40={'name':''+_0x490d25,'number':_0x490d25,'profilePicUrl':'','isGroup':![],'companyId':_0x3579bf},_0x1d3255=await(0x0,CreateOrUpdateContactService_1[_0x402525(0x180)])(_0x17ed40),_0xf8abea=await CompaniesSettings_1[_0x402525(0x180)][_0x402525(0x144)]({'where':{'companyId':_0x3579bf}});let _0x53cdd7;if(_0xa3098a===undefined)_0x53cdd7=await(0x0,GetDefaultWhatsApp_1[_0x402525(0x180)])(_0x3579bf);else{_0x53cdd7=await Whatsapp_1[_0x402525(0x180)][_0x402525(0x15e)](_0xa3098a);if(_0x53cdd7===null)throw new AppError_1['default'](_0x402525(0x182)+_0xa3098a+'\x20not\x20found');}const {ticket:_0x21aba2,isCreated:_0x3c9a73}=await(0x0,FindOrCreateTicketService_1[_0x402525(0x180)])(_0x1d3255,_0x53cdd7,0x0,_0x3579bf,_0x3763a3,_0x28adff,null,_0x402525(0x18e),null,![],_0xf8abea);return _0x21aba2&&(0x0,SetTicketMessagesAsRead_1[_0x402525(0x180)])(_0x21aba2),_0x21aba2;};function formatBRNumber(_0x3d7754){const _0x55b067=a8_0x70c6f9,_0x41a489=new RegExp(/^(\d{2})(\d{2})\d{1}(\d{8})$/);if(_0x41a489['test'](_0x3d7754)){const _0x21a075=_0x41a489['exec'](_0x3d7754);if(_0x21a075&&_0x21a075[0x1]==='55'&&Number['isInteger'](Number[_0x55b067(0x18b)](_0x21a075[0x2]))){const _0x1457c7=Number[_0x55b067(0x18b)](_0x21a075[0x2]);if(_0x1457c7<0x1f)return _0x21a075[0x0];else{if(_0x1457c7>=0x1f)return _0x21a075[0x1]+_0x21a075[0x2]+_0x21a075[0x3];}}}else return _0x3d7754;}function createJid(_0x4c2dd0){const _0x2c54a3=a8_0x70c6f9;if(_0x4c2dd0[_0x2c54a3(0x1a7)](_0x2c54a3(0x178))||_0x4c2dd0[_0x2c54a3(0x1a7)]('@s.whatsapp.net'))return formatBRNumber(_0x4c2dd0);return _0x4c2dd0[_0x2c54a3(0x1a7)]('-')?_0x4c2dd0+'@g.us':formatBRNumber(_0x4c2dd0)+_0x2c54a3(0x1b4);}const indexLink=async(_0x5c8a9f,_0xd7e08d)=>{const _0x3cf833=a8_0x70c6f9,_0x2d4b54=_0x5c8a9f[_0x3cf833(0x16b)],{whatsappId:_0x58192e}=_0x5c8a9f[_0x3cf833(0x16b)],{msdelay:_0x768a20}=_0x5c8a9f['body'],_0x1b5e8b=_0x5c8a9f[_0x3cf833(0x16b)]['url'],_0xdb739e=_0x5c8a9f[_0x3cf833(0x16b)][_0x3cf833(0x1b6)],_0x2a5f60=_0x5c8a9f['headers'][_0x3cf833(0x171)],[,_0x2b386b]=_0x2a5f60[_0x3cf833(0x1b3)]('\x20'),_0x9b0387=await Whatsapp_1[_0x3cf833(0x180)]['findOne']({'where':{'token':_0x2b386b}}),_0x2e3090=_0x9b0387[_0x3cf833(0x196)];_0x2d4b54['number']=_0x2d4b54[_0x3cf833(0x145)]['replace']('-','')['replace']('\x20','');const _0xf201e6=Yup[_0x3cf833(0x192)]()[_0x3cf833(0x1a0)]({'number':Yup[_0x3cf833(0x151)]()['required']()['matches'](/^\d+$/,_0x3cf833(0x17d))});try{await _0xf201e6['validate'](_0x2d4b54);}catch(_0x5e528b){throw new AppError_1[(_0x3cf833(0x180))](_0x5e528b[_0x3cf833(0x170)]);}const _0x30bd36=await createContact(_0x58192e,_0x2e3090,_0x2d4b54[_0x3cf833(0x145)]);if(!_0x30bd36)throw new AppError_1[(_0x3cf833(0x180))](_0x3cf833(0x17c));return await(0x0,SendWhatsAppMessageLink_1[_0x3cf833(0x180)])({'whatsappId':_0x58192e,'contact':_0x30bd36[_0x3cf833(0x166)],'url':_0x1b5e8b,'caption':_0xdb739e,'msdelay':_0x768a20}),setTimeout(async()=>{const _0x3254c4=_0x3cf833,{dateToClient:_0xd55f48}=(0x0,useDate_1[_0x3254c4(0x162)])(),_0x19ca55=_0xd55f48(new Date()),_0x50c605=(0x0,moment_1[_0x3254c4(0x180)])()['format'](),_0xd2d013=await ApiUsages_1['default'][_0x3254c4(0x144)]({'where':{'dateUsed':_0x19ca55,'companyId':_0x2e3090}});if(_0xd2d013)await _0xd2d013[_0x3254c4(0x146)]({'usedPDF':_0xd2d013[_0x3254c4(0x1b0)][_0x3254c4(0x153)]+0x1,'UsedOnDay':_0xd2d013['dataValues'][_0x3254c4(0x173)]+0x1,'updatedAt':_0x50c605});else{const _0x3f1a60=await ApiUsages_1[_0x3254c4(0x180)][_0x3254c4(0x175)]({'companyId':_0x2e3090,'dateUsed':_0x19ca55});await _0x3f1a60['update']({'usedPDF':_0x3f1a60[_0x3254c4(0x1b0)]['usedPDF']+0x1,'UsedOnDay':_0x3f1a60[_0x3254c4(0x1b0)][_0x3254c4(0x173)]+0x1,'updatedAt':_0x50c605});}},0x64),_0xd7e08d[_0x3cf833(0x1a9)]({'status':_0x3cf833(0x16f)});};exports[a8_0x70c6f9(0x19f)]=indexLink;const index=async(_0x134676,_0xefd0ba)=>{const _0x19f0ac=a8_0x70c6f9,_0x36a34f=_0x134676['body'],{whatsappId:_0x2cf8ef}=_0x134676[_0x19f0ac(0x16b)],{msdelay:_0x153e27}=_0x134676[_0x19f0ac(0x16b)],{number:_0x3f4bb5,body:_0x3d7901,quotedMsg:_0x5a1101,userId:_0x4359a7,queueId:_0x287d79,sendSignature:sendSignature=![],closeTicket:closeTicket=![],noRegister:noRegister=![]}=_0x134676['body'],_0x1b1ffe=_0x134676[_0x19f0ac(0x189)],_0x1d2815=_0x134676[_0x19f0ac(0x195)][_0x19f0ac(0x171)],[,_0x10d447]=_0x1d2815[_0x19f0ac(0x1b3)]('\x20'),_0x38685f=await Whatsapp_1[_0x19f0ac(0x180)][_0x19f0ac(0x144)]({'where':{'token':_0x10d447}}),_0x343037=_0x38685f[_0x19f0ac(0x196)];_0x36a34f[_0x19f0ac(0x145)]=_0x36a34f['number'][_0x19f0ac(0x140)]('-','')[_0x19f0ac(0x140)]('\x20','');const _0x362432=Yup['object']()['shape']({'number':Yup['string']()[_0x19f0ac(0x15f)]()[_0x19f0ac(0x174)](/^\d+$/,_0x19f0ac(0x17d))});try{await _0x362432[_0x19f0ac(0x1a4)](_0x36a34f);}catch(_0x28c5df){throw new AppError_1['default'](_0x28c5df[_0x19f0ac(0x170)]);}const _0x2f418d=await(0x0,wbot_1['getWbot'])(_0x38685f['id']);let _0x1c6171;_0x4359a7?.[_0x19f0ac(0x1a1)]()!==''&&!isNaN(_0x4359a7)&&(_0x1c6171=await(0x0,ShowUserService_1[_0x19f0ac(0x180)])(_0x4359a7,_0x343037));let _0x777e5;_0x287d79?.[_0x19f0ac(0x1a1)]()!==''&&!isNaN(_0x287d79)&&(_0x777e5=await(0x0,ShowQueueService_1[_0x19f0ac(0x180)])(_0x287d79,_0x343037));let _0x508fca;sendSignature&&!(0x0,lodash_1[_0x19f0ac(0x17a)])(_0x1c6171)?_0x508fca='*'+_0x1c6171[_0x19f0ac(0x141)]+_0x19f0ac(0x198)+_0x3d7901['trim']():_0x508fca=_0x3d7901[_0x19f0ac(0x18f)]();let _0x563a37=await Contact_1[_0x19f0ac(0x180)][_0x19f0ac(0x144)]({'where':{'number':_0x36a34f[_0x19f0ac(0x145)],'companyId':_0x343037}});if(!_0x563a37){const _0x543b49={'name':''+_0x3f4bb5,'number':_0x3f4bb5,'profilePicUrl':'','isGroup':![],'companyId':_0x343037};_0x563a37=await(0x0,CreateOrUpdateContactService_1[_0x19f0ac(0x180)])(_0x543b49);}if(noRegister)_0x1b1ffe?await Promise[_0x19f0ac(0x187)](_0x1b1ffe[_0x19f0ac(0x1b5)](async _0x50becd=>{const _0xbb23c8=_0x19f0ac,_0x2f16a3=path_1[_0xbb23c8(0x180)][_0xbb23c8(0x181)](__dirname,'..',_0xbb23c8(0x168)),_0x2939df=path_1[_0xbb23c8(0x180)]['join'](_0x2f16a3,_0xbb23c8(0x1af)+_0x343037,_0x50becd[_0xbb23c8(0x1ae)]),_0x478afd=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x50becd[_0xbb23c8(0x1ae)],_0x2939df,_0x343037[_0xbb23c8(0x1a1)](),_0x508fca);await _0x2f418d[_0xbb23c8(0x149)](_0x563a37[_0xbb23c8(0x145)]+'@'+(_0x563a37['isGroup']?_0xbb23c8(0x172):_0xbb23c8(0x19b)),_0x478afd);const _0x20d6f4=fs_1[_0xbb23c8(0x180)]['existsSync'](_0x2939df);_0x20d6f4&&fs_1[_0xbb23c8(0x180)][_0xbb23c8(0x19e)](_0x2939df);})):await _0x2f418d[_0x19f0ac(0x149)](_0x563a37[_0x19f0ac(0x145)]+'@'+(_0x563a37[_0x19f0ac(0x15c)]?_0x19f0ac(0x172):_0x19f0ac(0x19b)),{'text':_0x508fca});else{const _0x2d1c9d=await createContact(_0x38685f['id'],_0x343037,_0x36a34f[_0x19f0ac(0x145)],_0x4359a7,_0x287d79);let _0x2254f8;_0x1b1ffe?(await Promise[_0x19f0ac(0x187)](_0x1b1ffe[_0x19f0ac(0x1b5)](async _0x567d6d=>{const _0x16dfea=_0x19f0ac;_0x2254f8=await(0x0,SendWhatsAppMedia_1[_0x16dfea(0x180)])({'body':'‎\x20'+_0x508fca,'media':_0x567d6d,'ticket':_0x2d1c9d,'isForwarded':![]});const _0x2c5e8b=path_1['default'][_0x16dfea(0x181)](__dirname,'..','..',_0x16dfea(0x168)),_0x21a3f3=path_1[_0x16dfea(0x180)][_0x16dfea(0x15d)](_0x2c5e8b,_0x16dfea(0x1af)+_0x343037,_0x567d6d[_0x16dfea(0x1ae)]),_0x16a460=fs_1['default'][_0x16dfea(0x184)](_0x21a3f3);_0x16a460&&fs_1['default'][_0x16dfea(0x19e)](_0x21a3f3);})),await(0x0,wbotMessageListener_1[_0x19f0ac(0x185)])(_0x2254f8,_0x2d1c9d,_0x2d1c9d[_0x19f0ac(0x166)])):(_0x2254f8=await(0x0,SendWhatsAppMessageAPI_1['default'])({'body':'‎\x20'+_0x508fca,'whatsappId':_0x38685f['id'],'contact':_0x2d1c9d['contact'],'quotedMsg':_0x5a1101,'msdelay':_0x153e27}),await(0x0,wbotMessageListener_1['verifyMessage'])(_0x2254f8,_0x2d1c9d,_0x2d1c9d[_0x19f0ac(0x166)]));if(closeTicket)setTimeout(async()=>{const _0x12416=_0x19f0ac;await(0x0,UpdateTicketService_1[_0x12416(0x180)])({'ticketId':_0x2d1c9d['id'],'ticketData':{'status':_0x12416(0x15b),'sendFarewellMessage':![],'amountUsedBotQueues':0x0,'lastMessage':_0x3d7901},'companyId':_0x343037});},0x64);else _0x4359a7?.['toString']()!==''&&!isNaN(_0x4359a7)&&setTimeout(async()=>{const _0x1b002c=_0x19f0ac;await(0x0,UpdateTicketService_1[_0x1b002c(0x180)])({'ticketId':_0x2d1c9d['id'],'ticketData':{'status':_0x1b002c(0x14e),'amountUsedBotQueues':0x0,'lastMessage':_0x3d7901,'userId':_0x4359a7,'queueId':_0x287d79},'companyId':_0x343037});},0x64);}return setTimeout(async()=>{const _0x5bf2ab=_0x19f0ac,{dateToClient:_0x2e62d4}=(0x0,useDate_1[_0x5bf2ab(0x162)])(),_0x26b350=_0x2e62d4(new Date()),_0xa0815b=(0x0,moment_1['default'])()[_0x5bf2ab(0x1a5)]();let _0x52095d=await ApiUsages_1[_0x5bf2ab(0x180)][_0x5bf2ab(0x144)]({'where':{'dateUsed':_0x26b350,'companyId':_0x343037}});_0x52095d?_0x1b1ffe?await Promise[_0x5bf2ab(0x187)](_0x1b1ffe[_0x5bf2ab(0x1b5)](async _0xca2cdc=>{const _0x5ce000=_0x5bf2ab;if(_0xca2cdc['mimetype'][_0x5ce000(0x1a7)]('pdf'))await _0x52095d[_0x5ce000(0x146)]({'usedPDF':_0x52095d[_0x5ce000(0x1b0)][_0x5ce000(0x153)]+0x1,'UsedOnDay':_0x52095d['dataValues'][_0x5ce000(0x173)]+0x1,'updatedAt':_0xa0815b});else{if(_0xca2cdc[_0x5ce000(0x16d)]['includes'](_0x5ce000(0x16e)))await _0x52095d[_0x5ce000(0x146)]({'usedImage':_0x52095d['dataValues']['usedImage']+0x1,'UsedOnDay':_0x52095d[_0x5ce000(0x1b0)][_0x5ce000(0x173)]+0x1,'updatedAt':_0xa0815b});else _0xca2cdc[_0x5ce000(0x16d)]['includes'](_0x5ce000(0x161))?await _0x52095d[_0x5ce000(0x146)]({'usedVideo':_0x52095d[_0x5ce000(0x1b0)][_0x5ce000(0x1ac)]+0x1,'UsedOnDay':_0x52095d[_0x5ce000(0x1b0)][_0x5ce000(0x173)]+0x1,'updatedAt':_0xa0815b}):await _0x52095d[_0x5ce000(0x146)]({'usedOther':_0x52095d[_0x5ce000(0x1b0)][_0x5ce000(0x165)]+0x1,'UsedOnDay':_0x52095d[_0x5ce000(0x1b0)][_0x5ce000(0x173)]+0x1,'updatedAt':_0xa0815b});}})):await _0x52095d[_0x5bf2ab(0x146)]({'usedText':_0x52095d[_0x5bf2ab(0x1b0)][_0x5bf2ab(0x160)]+0x1,'UsedOnDay':_0x52095d[_0x5bf2ab(0x1b0)]['UsedOnDay']+0x1,'updatedAt':_0xa0815b}):(_0x52095d=await ApiUsages_1[_0x5bf2ab(0x180)][_0x5bf2ab(0x175)]({'companyId':_0x343037,'dateUsed':_0x26b350}),_0x1b1ffe?await Promise[_0x5bf2ab(0x187)](_0x1b1ffe['map'](async _0x390723=>{const _0x45a48e=_0x5bf2ab;if(_0x390723[_0x45a48e(0x16d)][_0x45a48e(0x1a7)](_0x45a48e(0x16a)))await _0x52095d[_0x45a48e(0x146)]({'usedPDF':_0x52095d[_0x45a48e(0x1b0)]['usedPDF']+0x1,'UsedOnDay':_0x52095d['dataValues'][_0x45a48e(0x173)]+0x1,'updatedAt':_0xa0815b});else{if(_0x390723[_0x45a48e(0x16d)][_0x45a48e(0x1a7)](_0x45a48e(0x16e)))await _0x52095d['update']({'usedImage':_0x52095d['dataValues']['usedImage']+0x1,'UsedOnDay':_0x52095d[_0x45a48e(0x1b0)][_0x45a48e(0x173)]+0x1,'updatedAt':_0xa0815b});else _0x390723['mimetype']['includes'](_0x45a48e(0x161))?await _0x52095d[_0x45a48e(0x146)]({'usedVideo':_0x52095d[_0x45a48e(0x1b0)][_0x45a48e(0x1ac)]+0x1,'UsedOnDay':_0x52095d[_0x45a48e(0x1b0)][_0x45a48e(0x173)]+0x1,'updatedAt':_0xa0815b}):await _0x52095d[_0x45a48e(0x146)]({'usedOther':_0x52095d[_0x45a48e(0x1b0)][_0x45a48e(0x165)]+0x1,'UsedOnDay':_0x52095d[_0x45a48e(0x1b0)]['UsedOnDay']+0x1,'updatedAt':_0xa0815b});}})):await _0x52095d[_0x5bf2ab(0x146)]({'usedText':_0x52095d[_0x5bf2ab(0x1b0)][_0x5bf2ab(0x160)]+0x1,'UsedOnDay':_0x52095d[_0x5bf2ab(0x1b0)][_0x5bf2ab(0x173)]+0x1,'updatedAt':_0xa0815b}));},0x64),_0xefd0ba['send']({'status':_0x19f0ac(0x16f)});};exports[a8_0x70c6f9(0x197)]=index;const indexImage=async(_0x3378e8,_0x3d78f7)=>{const _0x15fa03=a8_0x70c6f9,_0x42e364=_0x3378e8['body'],{whatsappId:_0xbad481}=_0x3378e8['body'],{msdelay:_0x4fc988}=_0x3378e8[_0x15fa03(0x16b)],_0x2dcd85=_0x3378e8[_0x15fa03(0x16b)][_0x15fa03(0x199)],_0x28e13f=_0x3378e8[_0x15fa03(0x16b)][_0x15fa03(0x1b6)],_0x3fb09d=_0x3378e8[_0x15fa03(0x195)][_0x15fa03(0x171)],[,_0x5a286a]=_0x3fb09d[_0x15fa03(0x1b3)]('\x20'),_0x47cd7a=await Whatsapp_1[_0x15fa03(0x180)][_0x15fa03(0x144)]({'where':{'token':_0x5a286a}}),_0x31ba44=_0x47cd7a[_0x15fa03(0x196)];_0x42e364[_0x15fa03(0x145)]=_0x42e364[_0x15fa03(0x145)]['replace']('-','')[_0x15fa03(0x140)]('\x20','');const _0x1a483b=Yup[_0x15fa03(0x192)]()[_0x15fa03(0x1a0)]({'number':Yup[_0x15fa03(0x151)]()[_0x15fa03(0x15f)]()['matches'](/^\d+$/,_0x15fa03(0x17d))});try{await _0x1a483b[_0x15fa03(0x1a4)](_0x42e364);}catch(_0x6ecbef){throw new AppError_1['default'](_0x6ecbef[_0x15fa03(0x170)]);}const _0x110791=await createContact(_0xbad481,_0x31ba44,_0x42e364[_0x15fa03(0x145)]);return _0x2dcd85&&await(0x0,SendWhatsappMediaImage_1['default'])({'ticket':_0x110791,'url':_0x2dcd85,'caption':_0x28e13f,'msdelay':_0x4fc988}),setTimeout(async()=>{const _0x503c3d=_0x15fa03;await(0x0,UpdateTicketService_1[_0x503c3d(0x180)])({'ticketId':_0x110791['id'],'ticketData':{'status':'closed','sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x31ba44});},0x64),setTimeout(async()=>{const _0x4f2470=_0x15fa03,{dateToClient:_0xc9563a}=(0x0,useDate_1['useDate'])(),_0x552c15=_0xc9563a(new Date()),_0x45757b=(0x0,moment_1[_0x4f2470(0x180)])()[_0x4f2470(0x1a5)](),_0x1df848=await ApiUsages_1[_0x4f2470(0x180)]['findOne']({'where':{'dateUsed':_0x552c15,'companyId':_0x31ba44}});if(_0x1df848)await _0x1df848[_0x4f2470(0x146)]({'usedImage':_0x1df848[_0x4f2470(0x1b0)][_0x4f2470(0x154)]+0x1,'UsedOnDay':_0x1df848[_0x4f2470(0x1b0)][_0x4f2470(0x173)]+0x1,'updatedAt':_0x45757b});else{const _0x2d23fd=await ApiUsages_1['default'][_0x4f2470(0x175)]({'companyId':_0x31ba44,'dateUsed':_0x552c15});await _0x2d23fd[_0x4f2470(0x146)]({'usedImage':_0x2d23fd['dataValues']['usedImage']+0x1,'UsedOnDay':_0x2d23fd[_0x4f2470(0x1b0)][_0x4f2470(0x173)]+0x1,'updatedAt':_0x45757b});}},0x64),_0x3d78f7['send']({'status':_0x15fa03(0x16f)});};exports[a8_0x70c6f9(0x1a2)]=indexImage;const checkNumber=async(_0x2e6cce,_0x5e1677)=>{const _0xb0cd50=a8_0x70c6f9,_0xf276b=_0x2e6cce[_0xb0cd50(0x16b)],_0x533f66=_0x2e6cce['headers'][_0xb0cd50(0x171)],[,_0x2f52eb]=_0x533f66['split']('\x20'),_0xc45536=await Whatsapp_1['default'][_0xb0cd50(0x144)]({'where':{'token':_0x2f52eb}}),_0x3208d8=_0xc45536[_0xb0cd50(0x196)],_0x65d331=_0xf276b['number'][_0xb0cd50(0x140)]('-','')['replace']('\x20',''),_0x2f4b24=await(0x0,GetDefaultWhatsApp_1['default'])(_0x3208d8),_0x1daa5f=(0x0,wbot_1[_0xb0cd50(0x1ab)])(_0x2f4b24['id']),_0x2bb07e=createJid(_0x65d331);try{const [_0x1fd3d8]=await _0x1daa5f['onWhatsApp'](_0x2bb07e);if(_0x1fd3d8[_0xb0cd50(0x177)])return setTimeout(async()=>{const _0x1ddc7f=_0xb0cd50,{dateToClient:_0x313c7f}=(0x0,useDate_1['useDate'])(),_0x47520a=_0x313c7f(new Date()),_0x1ea9c0=(0x0,moment_1[_0x1ddc7f(0x180)])()['format'](),_0x29b65f=await ApiUsages_1[_0x1ddc7f(0x180)][_0x1ddc7f(0x144)]({'where':{'dateUsed':_0x47520a,'companyId':_0x3208d8}});if(_0x29b65f)await _0x29b65f[_0x1ddc7f(0x146)]({'usedCheckNumber':_0x29b65f[_0x1ddc7f(0x1b0)][_0x1ddc7f(0x14b)]+0x1,'UsedOnDay':_0x29b65f[_0x1ddc7f(0x1b0)]['UsedOnDay']+0x1,'updatedAt':_0x1ea9c0});else{const _0x4509f0=await ApiUsages_1[_0x1ddc7f(0x180)][_0x1ddc7f(0x175)]({'companyId':_0x3208d8,'dateUsed':_0x47520a});await _0x4509f0[_0x1ddc7f(0x146)]({'usedCheckNumber':_0x4509f0[_0x1ddc7f(0x1b0)]['usedCheckNumber']+0x1,'UsedOnDay':_0x4509f0[_0x1ddc7f(0x1b0)][_0x1ddc7f(0x173)]+0x1,'updatedAt':_0x1ea9c0});}},0x64),_0x5e1677['status'](0xc8)[_0xb0cd50(0x167)]({'existsInWhatsapp':!![],'number':_0x65d331,'numberFormatted':_0x1fd3d8[_0xb0cd50(0x1b1)]});}catch(_0x48d7cd){return _0x5e1677[_0xb0cd50(0x143)](0x190)[_0xb0cd50(0x167)]({'existsInWhatsapp':![],'number':_0x2bb07e,'error':_0xb0cd50(0x14c)});}};exports[a8_0x70c6f9(0x142)]=checkNumber;const indexWhatsappsId=async(_0x4a5956,_0x48c46a)=>{const _0x25c5fd=a8_0x70c6f9;return _0x48c46a[_0x25c5fd(0x143)](0xc8)['json']('oi');};exports[a8_0x70c6f9(0x19c)]=indexWhatsappsId;