'use strict';const a36_0x50b3f6=a36_0x581a;function a36_0x581a(_0x569493,_0x383720){const _0x227bea=a36_0x227b();return a36_0x581a=function(_0x581a49,_0xd24361){_0x581a49=_0x581a49-0x13a;let _0x16193b=_0x227bea[_0x581a49];return _0x16193b;},a36_0x581a(_0x569493,_0x383720);}(function(_0x53990e,_0x4da6b6){const _0x7799d8=a36_0x581a,_0x2c0c34=_0x53990e();while(!![]){try{const _0x14abfe=parseInt(_0x7799d8(0x166))/0x1*(-parseInt(_0x7799d8(0x14e))/0x2)+parseInt(_0x7799d8(0x161))/0x3+parseInt(_0x7799d8(0x140))/0x4+-parseInt(_0x7799d8(0x142))/0x5+-parseInt(_0x7799d8(0x14a))/0x6+parseInt(_0x7799d8(0x146))/0x7*(parseInt(_0x7799d8(0x143))/0x8)+parseInt(_0x7799d8(0x154))/0x9;if(_0x14abfe===_0x4da6b6)break;else _0x2c0c34['push'](_0x2c0c34['shift']());}catch(_0x43c207){_0x2c0c34['push'](_0x2c0c34['shift']());}}}(a36_0x227b,0xc0136));var __importDefault=this&&this[a36_0x50b3f6(0x148)]||function(_0x334a67){return _0x334a67&&_0x334a67['__esModule']?_0x334a67:{'default':_0x334a67};};Object[a36_0x50b3f6(0x153)](exports,a36_0x50b3f6(0x168),{'value':!![]}),exports[a36_0x50b3f6(0x145)]=exports[a36_0x50b3f6(0x156)]=exports[a36_0x50b3f6(0x157)]=exports['showFromUUID']=exports[a36_0x50b3f6(0x15d)]=exports[a36_0x50b3f6(0x160)]=exports[a36_0x50b3f6(0x15c)]=exports[a36_0x50b3f6(0x167)]=exports[a36_0x50b3f6(0x149)]=void 0x0;const socket_1=require(a36_0x50b3f6(0x15a)),Ticket_1=__importDefault(require(a36_0x50b3f6(0x151))),CreateTicketService_1=__importDefault(require(a36_0x50b3f6(0x13b))),DeleteTicketService_1=__importDefault(require('../services/TicketServices/DeleteTicketService')),ListTicketsService_1=__importDefault(require(a36_0x50b3f6(0x163))),ShowTicketFromUUIDService_1=__importDefault(require(a36_0x50b3f6(0x162))),ShowTicketService_1=__importDefault(require(a36_0x50b3f6(0x165))),UpdateTicketService_1=__importDefault(require(a36_0x50b3f6(0x14f))),ListTicketsServiceKanban_1=__importDefault(require(a36_0x50b3f6(0x141))),CreateLogTicketService_1=__importDefault(require('../services/TicketServices/CreateLogTicketService')),ShowLogTicketService_1=__importDefault(require(a36_0x50b3f6(0x164))),index=async(_0x54f521,_0x4928cb)=>{const _0x1e0c95=a36_0x50b3f6,{pageNumber:_0x5d4f6e,status:_0x1f572e,date:_0x5b8cd5,dateStart:_0x439077,dateEnd:_0x2faf7a,updatedAt:_0x483efc,searchParam:_0x294ad4,showAll:_0x367074,queueIds:_0x93cf97,tags:_0x32d561,users:_0x3b99b8,withUnreadMessages:_0x1d0f99,whatsapps:_0x26ede4,statusFilter:_0x4f504c}=_0x54f521[_0x1e0c95(0x14b)],_0x500117=Number(_0x54f521[_0x1e0c95(0x13a)]['id']),{companyId:_0x48e83e}=_0x54f521['user'];let _0x57a2de=[],_0x37c74c=[],_0x1c0246=[],_0x21900d=[],_0x5ae09c=[];_0x93cf97&&(_0x57a2de=JSON[_0x1e0c95(0x159)](_0x93cf97));_0x32d561&&(_0x37c74c=JSON[_0x1e0c95(0x159)](_0x32d561));_0x3b99b8&&(_0x1c0246=JSON[_0x1e0c95(0x159)](_0x3b99b8));_0x26ede4&&(_0x21900d=JSON[_0x1e0c95(0x159)](_0x26ede4));_0x4f504c&&(_0x5ae09c=JSON[_0x1e0c95(0x159)](_0x4f504c));const {tickets:_0x41a71f,count:_0x1ca27f,hasMore:_0x5281ab}=await(0x0,ListTicketsService_1['default'])({'searchParam':_0x294ad4,'tags':_0x37c74c,'users':_0x1c0246,'pageNumber':_0x5d4f6e,'status':_0x1f572e,'date':_0x5b8cd5,'dateStart':_0x439077,'dateEnd':_0x2faf7a,'updatedAt':_0x483efc,'showAll':_0x367074,'userId':_0x500117,'queueIds':_0x57a2de,'withUnreadMessages':_0x1d0f99,'whatsappIds':_0x21900d,'statusFilters':_0x5ae09c,'companyId':_0x48e83e});return _0x4928cb[_0x1e0c95(0x13d)](0xc8)[_0x1e0c95(0x15f)]({'tickets':_0x41a71f,'count':_0x1ca27f,'hasMore':_0x5281ab});};exports[a36_0x50b3f6(0x149)]=index;const kanban=async(_0x17a7f4,_0x1d82bf)=>{const _0x1a9ed7=a36_0x50b3f6,{pageNumber:_0x44a871,status:_0xced60f,date:_0x1c6be8,updatedAt:_0x81b5f4,searchParam:_0x14334b,showAll:_0x354c23,queueIds:_0x28d7af,tags:_0x50a90a,users:_0x33ad7e,withUnreadMessages:_0x134888}=_0x17a7f4['query'],_0x476628=_0x17a7f4[_0x1a9ed7(0x13a)]['id'],{companyId:_0x278ecb}=_0x17a7f4['user'];let _0x8e943e=[],_0x4e312a=[],_0xe52981=[];_0x28d7af&&(_0x8e943e=JSON[_0x1a9ed7(0x159)](_0x28d7af));_0x50a90a&&(_0x4e312a=JSON['parse'](_0x50a90a));_0x33ad7e&&(_0xe52981=JSON[_0x1a9ed7(0x159)](_0x33ad7e));const {tickets:_0x37ece3,count:_0x5b3c21,hasMore:_0x5b6d11}=await(0x0,ListTicketsServiceKanban_1['default'])({'searchParam':_0x14334b,'tags':_0x4e312a,'users':_0xe52981,'pageNumber':_0x44a871,'status':_0xced60f,'date':_0x1c6be8,'updatedAt':_0x81b5f4,'showAll':_0x354c23,'userId':_0x476628,'queueIds':_0x8e943e,'withUnreadMessages':_0x134888,'companyId':_0x278ecb});return _0x1d82bf[_0x1a9ed7(0x13d)](0xc8)[_0x1a9ed7(0x15f)]({'tickets':_0x37ece3,'count':_0x5b3c21,'hasMore':_0x5b6d11});};exports['kanban']=kanban;const store=async(_0x24cceb,_0x204d7b)=>{const _0x1843d6=a36_0x50b3f6,{contactId:_0x28556b,status:_0x3b3b6a,userId:_0x4e17d3,queueId:_0x4bf7ca,whatsappId:_0x12e06a}=_0x24cceb[_0x1843d6(0x144)],{companyId:_0x3c2f04}=_0x24cceb[_0x1843d6(0x13a)],_0x5c12b3=await(0x0,CreateTicketService_1['default'])({'contactId':_0x28556b,'status':_0x3b3b6a,'userId':_0x4e17d3,'companyId':_0x3c2f04,'queueId':_0x4bf7ca,'whatsappId':_0x12e06a}),_0x5131e9=(0x0,socket_1[_0x1843d6(0x14d)])();return _0x5131e9['to'](_0x5c12b3[_0x1843d6(0x13d)])[_0x1843d6(0x147)]('company-'+_0x3c2f04+'-ticket',{'action':_0x1843d6(0x157),'ticket':_0x5c12b3}),_0x204d7b[_0x1843d6(0x13d)](0xc8)[_0x1843d6(0x15f)](_0x5c12b3);};exports[a36_0x50b3f6(0x15c)]=store;const show=async(_0xb44c97,_0x549b84)=>{const _0x24f136=a36_0x50b3f6,{ticketId:_0x494aa6}=_0xb44c97['params'],{id:_0xffcbe7,companyId:_0x4b8d43}=_0xb44c97[_0x24f136(0x13a)],_0x1991e8=await(0x0,ShowTicketService_1[_0x24f136(0x13c)])(_0x494aa6,_0x4b8d43);return await(0x0,CreateLogTicketService_1[_0x24f136(0x13c)])({'userId':_0xffcbe7,'ticketId':_0x494aa6,'type':'access'}),_0x549b84[_0x24f136(0x13d)](0xc8)['json'](_0x1991e8);};function a36_0x227b(){const _0x54d52a=['default','status','DESC','ticket\x20deleted','2564288itQXjw','../services/TicketServices/ListTicketsServiceKanban','1195405WAfnVY','151184bPbSec','body','closeAll','126fWYKET','emit','__importDefault','index','2165406EmlIaz','query','closed','getIO','2218KEdEdl','../services/TicketServices/UpdateTicketService','queueId','../models/Ticket','params','defineProperty','13272426loEMGa','company-','remove','update','access','parse','../libs/socket','updatedAt','store','showLog','findAndCountAll','json','show','1450122OblpSA','../services/TicketServices/ShowTicketFromUUIDService','../services/TicketServices/ListTicketsService','../services/TicketServices/ShowLogTicketService','../services/TicketServices/ShowTicketService','1400bJpUva','kanban','__esModule','delete','user','../services/TicketServices/CreateTicketService'];a36_0x227b=function(){return _0x54d52a;};return a36_0x227b();}exports[a36_0x50b3f6(0x160)]=show;const showLog=async(_0x2e16fa,_0x2c754b)=>{const _0x7a5555=a36_0x50b3f6,{ticketId:_0x3d683b}=_0x2e16fa[_0x7a5555(0x152)],{id:_0x312423,companyId:_0x166e65}=_0x2e16fa[_0x7a5555(0x13a)],_0x50b362=await(0x0,ShowLogTicketService_1[_0x7a5555(0x13c)])({'ticketId':_0x3d683b,'companyId':_0x166e65});return _0x2c754b[_0x7a5555(0x13d)](0xc8)[_0x7a5555(0x15f)](_0x50b362);};exports[a36_0x50b3f6(0x15d)]=showLog;const showFromUUID=async(_0x4b027c,_0x3d5fbe)=>{const _0x491432=a36_0x50b3f6,{uuid:_0x105db6}=_0x4b027c['params'],{id:_0x3635fb,companyId:_0x5ca993}=_0x4b027c['user'],_0x1ff6f5=await(0x0,ShowTicketFromUUIDService_1['default'])(_0x105db6,_0x5ca993);return await(0x0,CreateLogTicketService_1['default'])({'userId':_0x3635fb,'ticketId':_0x1ff6f5['id'],'type':_0x491432(0x158)}),_0x3d5fbe['status'](0xc8)[_0x491432(0x15f)](_0x1ff6f5);};exports['showFromUUID']=showFromUUID;const update=async(_0x1c5c6c,_0x4831ec)=>{const _0x36b20e=a36_0x50b3f6,{ticketId:_0x52b3e9}=_0x1c5c6c[_0x36b20e(0x152)],_0x4725c9=_0x1c5c6c['body'],{companyId:_0x18a5ac}=_0x1c5c6c[_0x36b20e(0x13a)],{ticket:_0x2e9824}=await(0x0,UpdateTicketService_1[_0x36b20e(0x13c)])({'ticketData':_0x4725c9,'ticketId':_0x52b3e9,'companyId':_0x18a5ac});return _0x4831ec[_0x36b20e(0x13d)](0xc8)[_0x36b20e(0x15f)](_0x2e9824);};exports[a36_0x50b3f6(0x157)]=update;const remove=async(_0x1f7a3f,_0x52c832)=>{const _0x22c5c6=a36_0x50b3f6,{ticketId:_0x55912c}=_0x1f7a3f[_0x22c5c6(0x152)],{id:_0x43330b,companyId:_0x6c7aff}=_0x1f7a3f[_0x22c5c6(0x13a)];await(0x0,ShowTicketService_1[_0x22c5c6(0x13c)])(_0x55912c,_0x6c7aff);const _0x5ded5f=await(0x0,DeleteTicketService_1[_0x22c5c6(0x13c)])(_0x55912c,_0x43330b,_0x6c7aff),_0xdd0b1e=(0x0,socket_1[_0x22c5c6(0x14d)])();return _0xdd0b1e['to'](_0x5ded5f[_0x22c5c6(0x13d)])['to'](_0x55912c)['to']('notification')[_0x22c5c6(0x147)](_0x22c5c6(0x155)+_0x6c7aff+'-ticket',{'action':_0x22c5c6(0x169),'ticketId':+_0x55912c}),_0x52c832['status'](0xc8)[_0x22c5c6(0x15f)]({'message':_0x22c5c6(0x13f)});};exports['remove']=remove;const closeAll=async(_0x464e39,_0x4f5d62)=>{const _0x4cec77=a36_0x50b3f6,{companyId:_0xd5785}=_0x464e39[_0x4cec77(0x13a)],{status:_0x53306d}=_0x464e39[_0x4cec77(0x144)],_0x5a6119=(0x0,socket_1[_0x4cec77(0x14d)])(),{rows:_0x590ddf}=await Ticket_1[_0x4cec77(0x13c)][_0x4cec77(0x15e)]({'where':{'companyId':_0xd5785,'status':_0x53306d},'order':[[_0x4cec77(0x15b),_0x4cec77(0x13e)]]});return _0x590ddf['forEach'](async _0x48f4cb=>{const _0xec56f9=_0x4cec77,_0x3f8454={'status':_0xec56f9(0x14c),'userId':_0x48f4cb['userId']||null,'queueId':_0x48f4cb[_0xec56f9(0x150)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1[_0xec56f9(0x13c)])({'ticketData':_0x3f8454,'ticketId':_0x48f4cb['id'],'companyId':_0xd5785});}),_0x4f5d62[_0x4cec77(0x13d)](0xc8)[_0x4cec77(0x15f)]();};exports[a36_0x50b3f6(0x145)]=closeAll;