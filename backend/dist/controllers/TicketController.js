'use strict';const a36_0x235380=a36_0x4004;(function(_0x1e37fb,_0x525ca6){const _0x5d3fc8=a36_0x4004,_0x58ee8f=_0x1e37fb();while(!![]){try{const _0x2e3827=parseInt(_0x5d3fc8(0x12d))/0x1*(-parseInt(_0x5d3fc8(0x108))/0x2)+parseInt(_0x5d3fc8(0x110))/0x3+-parseInt(_0x5d3fc8(0x124))/0x4*(parseInt(_0x5d3fc8(0x123))/0x5)+parseInt(_0x5d3fc8(0x10a))/0x6+parseInt(_0x5d3fc8(0x10c))/0x7+parseInt(_0x5d3fc8(0x12e))/0x8+parseInt(_0x5d3fc8(0x115))/0x9*(parseInt(_0x5d3fc8(0x104))/0xa);if(_0x2e3827===_0x525ca6)break;else _0x58ee8f['push'](_0x58ee8f['shift']());}catch(_0x433322){_0x58ee8f['push'](_0x58ee8f['shift']());}}}(a36_0xb10e,0x7b427));var __importDefault=this&&this[a36_0x235380(0x106)]||function(_0x493f40){const _0x673b92=a36_0x235380;return _0x493f40&&_0x493f40[_0x673b92(0x119)]?_0x493f40:{'default':_0x493f40};};Object[a36_0x235380(0x112)](exports,a36_0x235380(0x119),{'value':!![]}),exports['closeAll']=exports[a36_0x235380(0x122)]=exports[a36_0x235380(0x132)]=exports['showFromUUID']=exports[a36_0x235380(0x11a)]=exports[a36_0x235380(0x103)]=exports[a36_0x235380(0x12f)]=exports[a36_0x235380(0x133)]=exports[a36_0x235380(0x12c)]=void 0x0;const socket_1=require('../libs/socket'),Ticket_1=__importDefault(require(a36_0x235380(0x125))),CreateTicketService_1=__importDefault(require(a36_0x235380(0x130))),DeleteTicketService_1=__importDefault(require(a36_0x235380(0x120))),ListTicketsService_1=__importDefault(require('../services/TicketServices/ListTicketsService')),ShowTicketFromUUIDService_1=__importDefault(require(a36_0x235380(0x126))),ShowTicketService_1=__importDefault(require(a36_0x235380(0x134))),UpdateTicketService_1=__importDefault(require(a36_0x235380(0x11f))),ListTicketsServiceKanban_1=__importDefault(require(a36_0x235380(0x12a))),CreateLogTicketService_1=__importDefault(require(a36_0x235380(0x129))),ShowLogTicketService_1=__importDefault(require('../services/TicketServices/ShowLogTicketService')),index=async(_0x215981,_0x2f112b)=>{const _0x4694ef=a36_0x235380,{pageNumber:_0x1a2c4d,status:_0x232eff,date:_0x1d90d0,dateStart:_0x2f65f6,dateEnd:_0x58d0a9,updatedAt:_0x100b3f,searchParam:_0x4d970f,showAll:_0x2281d2,queueIds:_0x527641,tags:_0x57f27c,users:_0xcef565,withUnreadMessages:_0x505ca3,whatsapps:_0x22cae7,statusFilter:_0x372c4d}=_0x215981['query'],_0x3f4023=Number(_0x215981[_0x4694ef(0x107)]['id']),{companyId:_0x1a9b3c}=_0x215981['user'];let _0x5aa132=[],_0x4c7c5a=[],_0x44cf98=[],_0x562cc4=[],_0x387508=[];_0x527641&&(_0x5aa132=JSON[_0x4694ef(0x10f)](_0x527641));_0x57f27c&&(_0x4c7c5a=JSON[_0x4694ef(0x10f)](_0x57f27c));_0xcef565&&(_0x44cf98=JSON[_0x4694ef(0x10f)](_0xcef565));_0x22cae7&&(_0x562cc4=JSON[_0x4694ef(0x10f)](_0x22cae7));_0x372c4d&&(_0x387508=JSON['parse'](_0x372c4d));const {tickets:_0x37cce0,count:_0x4982e1,hasMore:_0x42411a}=await(0x0,ListTicketsService_1[_0x4694ef(0x105)])({'searchParam':_0x4d970f,'tags':_0x4c7c5a,'users':_0x44cf98,'pageNumber':_0x1a2c4d,'status':_0x232eff,'date':_0x1d90d0,'dateStart':_0x2f65f6,'dateEnd':_0x58d0a9,'updatedAt':_0x100b3f,'showAll':_0x2281d2,'userId':_0x3f4023,'queueIds':_0x5aa132,'withUnreadMessages':_0x505ca3,'whatsappIds':_0x562cc4,'statusFilters':_0x387508,'companyId':_0x1a9b3c});return _0x2f112b[_0x4694ef(0x131)](0xc8)[_0x4694ef(0x121)]({'tickets':_0x37cce0,'count':_0x4982e1,'hasMore':_0x42411a});};exports[a36_0x235380(0x12c)]=index;const kanban=async(_0x351e10,_0x4e058e)=>{const _0xd1a296=a36_0x235380,{pageNumber:_0x4c4089,status:_0x9ca68f,date:_0x2148b8,updatedAt:_0x3f5aeb,searchParam:_0x3002bc,showAll:_0x5d7e30,queueIds:_0xf9239a,tags:_0x18a0d7,users:_0x4c14a8,withUnreadMessages:_0x6229a9}=_0x351e10[_0xd1a296(0x11c)],_0x3c7337=_0x351e10[_0xd1a296(0x107)]['id'],{companyId:_0x2e16e2}=_0x351e10[_0xd1a296(0x107)];let _0x7b5546=[],_0x4e8d47=[],_0x2f909d=[];_0xf9239a&&(_0x7b5546=JSON[_0xd1a296(0x10f)](_0xf9239a));_0x18a0d7&&(_0x4e8d47=JSON[_0xd1a296(0x10f)](_0x18a0d7));_0x4c14a8&&(_0x2f909d=JSON['parse'](_0x4c14a8));const {tickets:_0xa52647,count:_0x5123fb,hasMore:_0x4c8030}=await(0x0,ListTicketsServiceKanban_1[_0xd1a296(0x105)])({'searchParam':_0x3002bc,'tags':_0x4e8d47,'users':_0x2f909d,'pageNumber':_0x4c4089,'status':_0x9ca68f,'date':_0x2148b8,'updatedAt':_0x3f5aeb,'showAll':_0x5d7e30,'userId':_0x3c7337,'queueIds':_0x7b5546,'withUnreadMessages':_0x6229a9,'companyId':_0x2e16e2});return _0x4e058e[_0xd1a296(0x131)](0xc8)[_0xd1a296(0x121)]({'tickets':_0xa52647,'count':_0x5123fb,'hasMore':_0x4c8030});};exports['kanban']=kanban;const store=async(_0x395fdc,_0x214643)=>{const _0x468024=a36_0x235380,{contactId:_0xc7874a,status:_0x52f054,userId:_0x28b5f1,queueId:_0x2611bc,whatsappId:_0x240513}=_0x395fdc[_0x468024(0x10b)],{companyId:_0x10fd7b}=_0x395fdc[_0x468024(0x107)],_0x3c5bc2=await(0x0,CreateTicketService_1[_0x468024(0x105)])({'contactId':_0xc7874a,'status':_0x52f054,'userId':_0x28b5f1,'companyId':_0x10fd7b,'queueId':_0x2611bc,'whatsappId':_0x240513}),_0x1d708b=(0x0,socket_1[_0x468024(0x11d)])();return _0x1d708b['to'](_0x3c5bc2['status'])['emit'](_0x468024(0x11b)+_0x10fd7b+'-ticket',{'action':_0x468024(0x132),'ticket':_0x3c5bc2}),_0x214643[_0x468024(0x131)](0xc8)[_0x468024(0x121)](_0x3c5bc2);};exports[a36_0x235380(0x12f)]=store;const show=async(_0x20565c,_0x228919)=>{const _0x1cb8f8=a36_0x235380,{ticketId:_0x42dbeb}=_0x20565c['params'],{id:_0x310c09,companyId:_0x18a493}=_0x20565c[_0x1cb8f8(0x107)],_0x5df0d4=await(0x0,ShowTicketService_1[_0x1cb8f8(0x105)])(_0x42dbeb,_0x18a493);return await(0x0,CreateLogTicketService_1[_0x1cb8f8(0x105)])({'userId':_0x310c09,'ticketId':_0x42dbeb,'type':_0x1cb8f8(0x114)}),_0x228919[_0x1cb8f8(0x131)](0xc8)['json'](_0x5df0d4);};function a36_0x4004(_0x239b3a,_0x21b0b2){const _0xb10e29=a36_0xb10e();return a36_0x4004=function(_0x4004a9,_0x12d1b0){_0x4004a9=_0x4004a9-0x102;let _0x4358be=_0xb10e29[_0x4004a9];return _0x4358be;},a36_0x4004(_0x239b3a,_0x21b0b2);}exports[a36_0x235380(0x103)]=show;const showLog=async(_0x41d32e,_0x17bc99)=>{const _0x296b5d=a36_0x235380,{ticketId:_0x133054}=_0x41d32e[_0x296b5d(0x128)],{id:_0x258109,companyId:_0x191c48}=_0x41d32e[_0x296b5d(0x107)],_0x6a509e=await(0x0,ShowLogTicketService_1[_0x296b5d(0x105)])({'ticketId':_0x133054,'companyId':_0x191c48});return _0x17bc99[_0x296b5d(0x131)](0xc8)[_0x296b5d(0x121)](_0x6a509e);};exports['showLog']=showLog;const showFromUUID=async(_0x2f8516,_0x318881)=>{const _0x2479d9=a36_0x235380,{uuid:_0x4eb662}=_0x2f8516[_0x2479d9(0x128)],{id:_0x3f24b4,companyId:_0x436d82}=_0x2f8516[_0x2479d9(0x107)],_0xd02c1b=await(0x0,ShowTicketFromUUIDService_1['default'])(_0x4eb662,_0x436d82);return await(0x0,CreateLogTicketService_1[_0x2479d9(0x105)])({'userId':_0x3f24b4,'ticketId':_0xd02c1b['id'],'type':'access'}),_0x318881[_0x2479d9(0x131)](0xc8)[_0x2479d9(0x121)](_0xd02c1b);};exports[a36_0x235380(0x116)]=showFromUUID;const update=async(_0x4b91ea,_0x1007e3)=>{const _0x547a30=a36_0x235380,{ticketId:_0x5ce55d}=_0x4b91ea[_0x547a30(0x128)],_0x181d88=_0x4b91ea['body'],{companyId:_0x28516d}=_0x4b91ea[_0x547a30(0x107)],{ticket:_0x295f7f}=await(0x0,UpdateTicketService_1[_0x547a30(0x105)])({'ticketData':_0x181d88,'ticketId':_0x5ce55d,'companyId':_0x28516d});return _0x1007e3[_0x547a30(0x131)](0xc8)[_0x547a30(0x121)](_0x295f7f);};exports['update']=update;const remove=async(_0x256d6c,_0x310484)=>{const _0x4c3903=a36_0x235380,{ticketId:_0x278dbb}=_0x256d6c[_0x4c3903(0x128)],{id:_0x318b14,companyId:_0xbd462}=_0x256d6c[_0x4c3903(0x107)];await(0x0,ShowTicketService_1[_0x4c3903(0x105)])(_0x278dbb,_0xbd462);const _0x1a5824=await(0x0,DeleteTicketService_1['default'])(_0x278dbb,_0x318b14,_0xbd462),_0x46fe29=(0x0,socket_1['getIO'])();return _0x46fe29['to'](_0x1a5824[_0x4c3903(0x131)])['to'](_0x278dbb)['to'](_0x4c3903(0x10d))[_0x4c3903(0x12b)](_0x4c3903(0x11b)+_0xbd462+_0x4c3903(0x127),{'action':_0x4c3903(0x109),'ticketId':+_0x278dbb}),_0x310484[_0x4c3903(0x131)](0xc8)['json']({'message':_0x4c3903(0x111)});};exports[a36_0x235380(0x122)]=remove;const closeAll=async(_0x14228a,_0x58c75e)=>{const _0x2615fc=a36_0x235380,{companyId:_0x51c5c6}=_0x14228a[_0x2615fc(0x107)],{status:_0x511034}=_0x14228a['body'],_0x30289b=(0x0,socket_1[_0x2615fc(0x11d)])(),{rows:_0x32c3ee}=await Ticket_1['default'][_0x2615fc(0x118)]({'where':{'companyId':_0x51c5c6,'status':_0x511034},'order':[[_0x2615fc(0x113),_0x2615fc(0x10e)]]});return _0x32c3ee[_0x2615fc(0x102)](async _0x24586e=>{const _0x59fde4=_0x2615fc,_0x55fe65={'status':'closed','userId':_0x24586e[_0x59fde4(0x11e)]||null,'queueId':_0x24586e[_0x59fde4(0x117)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x55fe65,'ticketId':_0x24586e['id'],'companyId':_0x51c5c6});}),_0x58c75e[_0x2615fc(0x131)](0xc8)[_0x2615fc(0x121)]();};function a36_0xb10e(){const _0x3fb9d2=['json','remove','345HTCnAr','50512XvRdEf','../models/Ticket','../services/TicketServices/ShowTicketFromUUIDService','-ticket','params','../services/TicketServices/CreateLogTicketService','../services/TicketServices/ListTicketsServiceKanban','emit','index','652261CJkVzH','833680mnUtwI','store','../services/TicketServices/CreateTicketService','status','update','kanban','../services/TicketServices/ShowTicketService','forEach','show','4450sGTPOa','default','__importDefault','user','2URziMa','delete','4836882fOuisj','body','1598709VbZSqw','notification','DESC','parse','2355435qTsxSj','ticket\x20deleted','defineProperty','updatedAt','access','2115XiIaCC','showFromUUID','queueId','findAndCountAll','__esModule','showLog','company-','query','getIO','userId','../services/TicketServices/UpdateTicketService','../services/TicketServices/DeleteTicketService'];a36_0xb10e=function(){return _0x3fb9d2;};return a36_0xb10e();}exports['closeAll']=closeAll;