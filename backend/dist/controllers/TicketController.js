'use strict';const a36_0x1412ed=a36_0x3c46;(function(_0x152f69,_0x49ed91){const _0x247910=a36_0x3c46,_0x5cb235=_0x152f69();while(!![]){try{const _0x153e65=-parseInt(_0x247910(0x175))/0x1+parseInt(_0x247910(0x186))/0x2+-parseInt(_0x247910(0x185))/0x3*(-parseInt(_0x247910(0x199))/0x4)+parseInt(_0x247910(0x173))/0x5+parseInt(_0x247910(0x16f))/0x6*(-parseInt(_0x247910(0x195))/0x7)+-parseInt(_0x247910(0x17d))/0x8*(parseInt(_0x247910(0x193))/0x9)+parseInt(_0x247910(0x16d))/0xa*(-parseInt(_0x247910(0x18a))/0xb);if(_0x153e65===_0x49ed91)break;else _0x5cb235['push'](_0x5cb235['shift']());}catch(_0x569922){_0x5cb235['push'](_0x5cb235['shift']());}}}(a36_0x5005,0xf2994));var __importDefault=this&&this[a36_0x1412ed(0x181)]||function(_0x44f6ac){return _0x44f6ac&&_0x44f6ac['__esModule']?_0x44f6ac:{'default':_0x44f6ac};};Object[a36_0x1412ed(0x178)](exports,a36_0x1412ed(0x191),{'value':!![]}),exports[a36_0x1412ed(0x172)]=exports['remove']=exports[a36_0x1412ed(0x18d)]=exports[a36_0x1412ed(0x17f)]=exports[a36_0x1412ed(0x17c)]=exports[a36_0x1412ed(0x16c)]=exports[a36_0x1412ed(0x194)]=exports[a36_0x1412ed(0x182)]=exports['index']=void 0x0;const socket_1=require('../libs/socket'),Ticket_1=__importDefault(require(a36_0x1412ed(0x171))),CreateTicketService_1=__importDefault(require('../services/TicketServices/CreateTicketService')),DeleteTicketService_1=__importDefault(require(a36_0x1412ed(0x18e))),ListTicketsService_1=__importDefault(require(a36_0x1412ed(0x192))),ShowTicketFromUUIDService_1=__importDefault(require(a36_0x1412ed(0x17e))),ShowTicketService_1=__importDefault(require(a36_0x1412ed(0x17b))),UpdateTicketService_1=__importDefault(require(a36_0x1412ed(0x16a))),ListTicketsServiceKanban_1=__importDefault(require('../services/TicketServices/ListTicketsServiceKanban')),CreateLogTicketService_1=__importDefault(require(a36_0x1412ed(0x196))),ShowLogTicketService_1=__importDefault(require(a36_0x1412ed(0x16b))),index=async(_0x5670e7,_0x14093e)=>{const _0x2c5ee7=a36_0x1412ed,{pageNumber:_0x1a1f9d,status:_0x3ac6ca,date:_0x2107ac,dateStart:_0x59da50,dateEnd:_0x563198,updatedAt:_0x454548,searchParam:_0x4af554,showAll:_0x333694,queueIds:_0x1ab075,tags:_0x2e92d6,users:_0x508543,withUnreadMessages:_0x547a1a,whatsapps:_0x395e48,statusFilter:_0x156da4}=_0x5670e7[_0x2c5ee7(0x190)],_0x3bc84e=Number(_0x5670e7[_0x2c5ee7(0x176)]['id']),{companyId:_0x510f6f}=_0x5670e7[_0x2c5ee7(0x176)];let _0x2eb98f=[],_0x5d3e88=[],_0x5123d0=[],_0x2d6334=[],_0x4ac984=[];_0x1ab075&&(_0x2eb98f=JSON[_0x2c5ee7(0x16e)](_0x1ab075));_0x2e92d6&&(_0x5d3e88=JSON[_0x2c5ee7(0x16e)](_0x2e92d6));_0x508543&&(_0x5123d0=JSON['parse'](_0x508543));_0x395e48&&(_0x2d6334=JSON[_0x2c5ee7(0x16e)](_0x395e48));_0x156da4&&(_0x4ac984=JSON['parse'](_0x156da4));const {tickets:_0x3682a7,count:_0x5b9fc5,hasMore:_0xd743f1}=await(0x0,ListTicketsService_1['default'])({'searchParam':_0x4af554,'tags':_0x5d3e88,'users':_0x5123d0,'pageNumber':_0x1a1f9d,'status':_0x3ac6ca,'date':_0x2107ac,'dateStart':_0x59da50,'dateEnd':_0x563198,'updatedAt':_0x454548,'showAll':_0x333694,'userId':_0x3bc84e,'queueIds':_0x2eb98f,'withUnreadMessages':_0x547a1a,'whatsappIds':_0x2d6334,'statusFilters':_0x4ac984,'companyId':_0x510f6f});return _0x14093e['status'](0xc8)[_0x2c5ee7(0x179)]({'tickets':_0x3682a7,'count':_0x5b9fc5,'hasMore':_0xd743f1});};function a36_0x3c46(_0x50784e,_0x23f406){const _0x5005f0=a36_0x5005();return a36_0x3c46=function(_0x3c469e,_0x26b736){_0x3c469e=_0x3c469e-0x16a;let _0x4fed49=_0x5005f0[_0x3c469e];return _0x4fed49;},a36_0x3c46(_0x50784e,_0x23f406);}exports[a36_0x1412ed(0x184)]=index;const kanban=async(_0x21bf74,_0x3ec903)=>{const _0x538092=a36_0x1412ed,{pageNumber:_0x1f3757,status:_0x1640e6,date:_0x281e77,updatedAt:_0x37b5b7,searchParam:_0x8ceb4,showAll:_0x5249bd,queueIds:_0x628de9,tags:_0x4839c5,users:_0x39d139,withUnreadMessages:_0xf53ae}=_0x21bf74['query'],_0xefd50d=_0x21bf74[_0x538092(0x176)]['id'],{companyId:_0x2c2fee}=_0x21bf74[_0x538092(0x176)];let _0xa07f15=[],_0x5e79e3=[],_0x2f4898=[];_0x628de9&&(_0xa07f15=JSON['parse'](_0x628de9));_0x4839c5&&(_0x5e79e3=JSON[_0x538092(0x16e)](_0x4839c5));_0x39d139&&(_0x2f4898=JSON[_0x538092(0x16e)](_0x39d139));const {tickets:_0x520016,count:_0xcd7a63,hasMore:_0x351066}=await(0x0,ListTicketsServiceKanban_1[_0x538092(0x17a)])({'searchParam':_0x8ceb4,'tags':_0x5e79e3,'users':_0x2f4898,'pageNumber':_0x1f3757,'status':_0x1640e6,'date':_0x281e77,'updatedAt':_0x37b5b7,'showAll':_0x5249bd,'userId':_0xefd50d,'queueIds':_0xa07f15,'withUnreadMessages':_0xf53ae,'companyId':_0x2c2fee});return _0x3ec903[_0x538092(0x180)](0xc8)[_0x538092(0x179)]({'tickets':_0x520016,'count':_0xcd7a63,'hasMore':_0x351066});};exports[a36_0x1412ed(0x182)]=kanban;const store=async(_0x2b8ab4,_0x24f947)=>{const _0xc1d2fd=a36_0x1412ed,{contactId:_0x57efc3,status:_0x4fca09,userId:_0x1b940a,queueId:_0x4dd9d8,whatsappId:_0x4230ef}=_0x2b8ab4[_0xc1d2fd(0x197)],{companyId:_0x514dde}=_0x2b8ab4['user'],_0xc9a689=await(0x0,CreateTicketService_1[_0xc1d2fd(0x17a)])({'contactId':_0x57efc3,'status':_0x4fca09,'userId':_0x1b940a,'companyId':_0x514dde,'queueId':_0x4dd9d8,'whatsappId':_0x4230ef}),_0x120a94=(0x0,socket_1['getIO'])();return _0x120a94['to'](_0xc9a689[_0xc1d2fd(0x180)])['emit'](_0xc1d2fd(0x170)+_0x514dde+'-ticket',{'action':_0xc1d2fd(0x18d),'ticket':_0xc9a689}),_0x24f947[_0xc1d2fd(0x180)](0xc8)['json'](_0xc9a689);};exports[a36_0x1412ed(0x194)]=store;const show=async(_0xd69c32,_0x4ef709)=>{const _0x3f3e7d=a36_0x1412ed,{ticketId:_0x1c6f52}=_0xd69c32[_0x3f3e7d(0x18f)],{id:_0x124704,companyId:_0x531c02}=_0xd69c32[_0x3f3e7d(0x176)],_0x6b2d2=await(0x0,ShowTicketService_1[_0x3f3e7d(0x17a)])(_0x1c6f52,_0x531c02);return await(0x0,CreateLogTicketService_1[_0x3f3e7d(0x17a)])({'userId':_0x124704,'ticketId':_0x1c6f52,'type':_0x3f3e7d(0x187)}),_0x4ef709['status'](0xc8)[_0x3f3e7d(0x179)](_0x6b2d2);};exports[a36_0x1412ed(0x16c)]=show;const showLog=async(_0x18a79f,_0x4f7ca7)=>{const _0x39aaaa=a36_0x1412ed,{ticketId:_0xe69ead}=_0x18a79f['params'],{id:_0x5b2a6a,companyId:_0x1d3183}=_0x18a79f['user'],_0x52d4ed=await(0x0,ShowLogTicketService_1[_0x39aaaa(0x17a)])({'ticketId':_0xe69ead,'companyId':_0x1d3183});return _0x4f7ca7[_0x39aaaa(0x180)](0xc8)['json'](_0x52d4ed);};exports['showLog']=showLog;const showFromUUID=async(_0x58ad11,_0x4b7d4c)=>{const _0x13e21d=a36_0x1412ed,{uuid:_0x429930}=_0x58ad11[_0x13e21d(0x18f)],{id:_0xb28c23,companyId:_0x2baa2a}=_0x58ad11['user'],_0x29219e=await(0x0,ShowTicketFromUUIDService_1[_0x13e21d(0x17a)])(_0x429930,_0x2baa2a);return await(0x0,CreateLogTicketService_1[_0x13e21d(0x17a)])({'userId':_0xb28c23,'ticketId':_0x29219e['id'],'type':_0x13e21d(0x187)}),_0x4b7d4c[_0x13e21d(0x180)](0xc8)[_0x13e21d(0x179)](_0x29219e);};exports[a36_0x1412ed(0x17f)]=showFromUUID;const update=async(_0x5b7ba5,_0x4c5319)=>{const _0x585be0=a36_0x1412ed,{ticketId:_0x48639a}=_0x5b7ba5['params'],_0xd2480=_0x5b7ba5[_0x585be0(0x197)],{companyId:_0x3ca1a0}=_0x5b7ba5[_0x585be0(0x176)],{ticket:_0x1d73a7}=await(0x0,UpdateTicketService_1['default'])({'ticketData':_0xd2480,'ticketId':_0x48639a,'companyId':_0x3ca1a0});return _0x4c5319[_0x585be0(0x180)](0xc8)[_0x585be0(0x179)](_0x1d73a7);};exports[a36_0x1412ed(0x18d)]=update;const remove=async(_0x205448,_0x1f2556)=>{const _0x2e5b92=a36_0x1412ed,{ticketId:_0x377e7b}=_0x205448['params'],{id:_0x3cba31,companyId:_0x46b781}=_0x205448[_0x2e5b92(0x176)];await(0x0,ShowTicketService_1[_0x2e5b92(0x17a)])(_0x377e7b,_0x46b781);const _0x24d44c=await(0x0,DeleteTicketService_1[_0x2e5b92(0x17a)])(_0x377e7b,_0x3cba31,_0x46b781),_0x26e552=(0x0,socket_1[_0x2e5b92(0x188)])();return _0x26e552['to'](_0x24d44c['status'])['to'](_0x377e7b)['to'](_0x2e5b92(0x189))[_0x2e5b92(0x183)](_0x2e5b92(0x170)+_0x46b781+'-ticket',{'action':'delete','ticketId':+_0x377e7b}),_0x1f2556[_0x2e5b92(0x180)](0xc8)['json']({'message':'ticket\x20deleted'});};exports['remove']=remove;function a36_0x5005(){const _0x1ab355=['access','getIO','notification','176EDQKmX','queueId','userId','update','../services/TicketServices/DeleteTicketService','params','query','__esModule','../services/TicketServices/ListTicketsService','387uPgbMy','store','4585ELqwxN','../services/TicketServices/CreateLogTicketService','body','updatedAt','4yQdQfC','../services/TicketServices/UpdateTicketService','../services/TicketServices/ShowLogTicketService','show','362290BuyrEJ','parse','3684PiHymz','company-','../models/Ticket','closeAll','2925285oYAfIH','closed','1085431eRKcQl','user','DESC','defineProperty','json','default','../services/TicketServices/ShowTicketService','showLog','100256LjjGUl','../services/TicketServices/ShowTicketFromUUIDService','showFromUUID','status','__importDefault','kanban','emit','index','4678137iEyuUy','2910778hGttaT'];a36_0x5005=function(){return _0x1ab355;};return a36_0x5005();}const closeAll=async(_0x4d3534,_0x244999)=>{const _0x1a51e3=a36_0x1412ed,{companyId:_0x267579}=_0x4d3534[_0x1a51e3(0x176)],{status:_0x256efd}=_0x4d3534[_0x1a51e3(0x197)],_0x26ee7e=(0x0,socket_1[_0x1a51e3(0x188)])(),{rows:_0x5bbef4}=await Ticket_1[_0x1a51e3(0x17a)]['findAndCountAll']({'where':{'companyId':_0x267579,'status':_0x256efd},'order':[[_0x1a51e3(0x198),_0x1a51e3(0x177)]]});return _0x5bbef4['forEach'](async _0x3a77a4=>{const _0x4337be=_0x1a51e3,_0x4c9224={'status':_0x4337be(0x174),'userId':_0x3a77a4[_0x4337be(0x18c)]||null,'queueId':_0x3a77a4[_0x4337be(0x18b)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1[_0x4337be(0x17a)])({'ticketData':_0x4c9224,'ticketId':_0x3a77a4['id'],'companyId':_0x267579});}),_0x244999['status'](0xc8)[_0x1a51e3(0x179)]();};exports[a36_0x1412ed(0x172)]=closeAll;