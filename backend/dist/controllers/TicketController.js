'use strict';const a33_0xafbacc=a33_0x1309;(function(_0x5786b7,_0x510cba){const _0x46b40e=a33_0x1309,_0x522d6c=_0x5786b7();while(!![]){try{const _0x3e2cf9=parseInt(_0x46b40e(0xcf))/0x1*(parseInt(_0x46b40e(0xd0))/0x2)+parseInt(_0x46b40e(0xb7))/0x3*(parseInt(_0x46b40e(0xd7))/0x4)+parseInt(_0x46b40e(0xbd))/0x5+-parseInt(_0x46b40e(0xd5))/0x6*(-parseInt(_0x46b40e(0xb6))/0x7)+parseInt(_0x46b40e(0xcc))/0x8*(-parseInt(_0x46b40e(0xb3))/0x9)+parseInt(_0x46b40e(0xb9))/0xa*(-parseInt(_0x46b40e(0xc9))/0xb)+-parseInt(_0x46b40e(0xac))/0xc;if(_0x3e2cf9===_0x510cba)break;else _0x522d6c['push'](_0x522d6c['shift']());}catch(_0x1c341c){_0x522d6c['push'](_0x522d6c['shift']());}}}(a33_0x5cdb,0x9ba0d));var __importDefault=this&&this[a33_0xafbacc(0xc8)]||function(_0x47f913){return _0x47f913&&_0x47f913['__esModule']?_0x47f913:{'default':_0x47f913};};Object[a33_0xafbacc(0xb4)](exports,a33_0xafbacc(0xaa),{'value':!![]}),exports[a33_0xafbacc(0xaf)]=exports[a33_0xafbacc(0xc7)]=exports[a33_0xafbacc(0xbe)]=exports[a33_0xafbacc(0xc1)]=exports[a33_0xafbacc(0xa8)]=exports[a33_0xafbacc(0xc2)]=exports[a33_0xafbacc(0xd8)]=exports[a33_0xafbacc(0xca)]=void 0x0;const socket_1=require('../libs/socket'),Ticket_1=__importDefault(require(a33_0xafbacc(0xcb))),CreateTicketService_1=__importDefault(require('../services/TicketServices/CreateTicketService')),DeleteTicketService_1=__importDefault(require('../services/TicketServices/DeleteTicketService')),ListTicketsService_1=__importDefault(require('../services/TicketServices/ListTicketsService')),ShowTicketFromUUIDService_1=__importDefault(require(a33_0xafbacc(0xc0))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require(a33_0xafbacc(0xb2))),ListTicketsServiceKanban_1=__importDefault(require('../services/TicketServices/ListTicketsServiceKanban')),index=async(_0x448b94,_0x55b1e2)=>{const _0x5cecca=a33_0xafbacc,{pageNumber:_0x45c3f4,status:_0x256194,date:_0x397018,dateStart:_0x47b3ff,dateEnd:_0x170eff,updatedAt:_0x4888f6,searchParam:_0x1404bd,showAll:_0xc5096,queueIds:_0xcf8128,tags:_0x18cc2a,users:_0x1c4ccf,withUnreadMessages:_0x28c3d1,whatsapps:_0x4f76f4,statusFilter:_0x3d58e9}=_0x448b94[_0x5cecca(0xae)],_0x32f609=_0x448b94[_0x5cecca(0xb8)]['id'],{companyId:_0x3dcabc}=_0x448b94[_0x5cecca(0xb8)];let _0x296b39=[],_0x160892=[],_0x5dba5b=[],_0x162443=[],_0x3235a6=[];_0xcf8128&&(_0x296b39=JSON['parse'](_0xcf8128));_0x18cc2a&&(_0x160892=JSON['parse'](_0x18cc2a));_0x1c4ccf&&(_0x5dba5b=JSON[_0x5cecca(0xd2)](_0x1c4ccf));_0x4f76f4&&(_0x162443=JSON[_0x5cecca(0xd2)](_0x4f76f4));_0x3d58e9&&(_0x3235a6=JSON[_0x5cecca(0xd2)](_0x3d58e9));const {tickets:_0x384b3c,count:_0x2745d2,hasMore:_0x8dc036}=await(0x0,ListTicketsService_1['default'])({'searchParam':_0x1404bd,'tags':_0x160892,'users':_0x5dba5b,'pageNumber':_0x45c3f4,'status':_0x256194,'date':_0x397018,'dateStart':_0x47b3ff,'dateEnd':_0x170eff,'updatedAt':_0x4888f6,'showAll':_0xc5096,'userId':_0x32f609,'queueIds':_0x296b39,'withUnreadMessages':_0x28c3d1,'whatsappIds':_0x162443,'statusFilters':_0x3235a6,'companyId':_0x3dcabc});return _0x55b1e2[_0x5cecca(0xb0)](0xc8)[_0x5cecca(0xad)]({'tickets':_0x384b3c,'count':_0x2745d2,'hasMore':_0x8dc036});};exports[a33_0xafbacc(0xca)]=index;const kanban=async(_0x46ce86,_0x3ffec9)=>{const _0x487a3b=a33_0xafbacc,{pageNumber:_0x480365,status:_0x4d7b91,date:_0x1eddf1,updatedAt:_0xbb7fa8,searchParam:_0x374fb3,showAll:_0x18777c,queueIds:_0x4f90a0,tags:_0x5707d4,users:_0x524258,withUnreadMessages:_0x327f9f}=_0x46ce86[_0x487a3b(0xae)],_0x1da33b=_0x46ce86[_0x487a3b(0xb8)]['id'],{companyId:_0x5b3632}=_0x46ce86[_0x487a3b(0xb8)];let _0x16ebc6=[],_0x192562=[],_0x113d29=[];_0x4f90a0&&(_0x16ebc6=JSON['parse'](_0x4f90a0));_0x5707d4&&(_0x192562=JSON[_0x487a3b(0xd2)](_0x5707d4));_0x524258&&(_0x113d29=JSON['parse'](_0x524258));const {tickets:_0x270b4b,count:_0x2c4e3b,hasMore:_0x110d73}=await(0x0,ListTicketsServiceKanban_1[_0x487a3b(0xa9)])({'searchParam':_0x374fb3,'tags':_0x192562,'users':_0x113d29,'pageNumber':_0x480365,'status':_0x4d7b91,'date':_0x1eddf1,'updatedAt':_0xbb7fa8,'showAll':_0x18777c,'userId':_0x1da33b,'queueIds':_0x16ebc6,'withUnreadMessages':_0x327f9f,'companyId':_0x5b3632});return _0x3ffec9[_0x487a3b(0xb0)](0xc8)[_0x487a3b(0xad)]({'tickets':_0x270b4b,'count':_0x2c4e3b,'hasMore':_0x110d73});};exports[a33_0xafbacc(0xd8)]=kanban;const store=async(_0x56081f,_0x3c9021)=>{const _0x27e061=a33_0xafbacc,{contactId:_0x2a0915,status:_0x4fd720,userId:_0x3fe5cb,queueId:_0x21854c,whatsappId:_0x58338c}=_0x56081f['body'],{companyId:_0x28ef38}=_0x56081f[_0x27e061(0xb8)],_0x4c85cd=await(0x0,CreateTicketService_1['default'])({'contactId':_0x2a0915,'status':_0x4fd720,'userId':_0x3fe5cb,'companyId':_0x28ef38,'queueId':_0x21854c,'whatsappId':_0x58338c}),_0x1446cc=(0x0,socket_1[_0x27e061(0xc6)])();return _0x1446cc['to'](_0x4c85cd[_0x27e061(0xb0)])[_0x27e061(0xc4)](_0x27e061(0xce)+_0x28ef38+_0x27e061(0xbb),{'action':_0x27e061(0xbe),'ticket':_0x4c85cd}),_0x3c9021[_0x27e061(0xb0)](0xc8)[_0x27e061(0xad)](_0x4c85cd);};exports['store']=store;const show=async(_0x457302,_0x3b6503)=>{const _0x56f657=a33_0xafbacc,{ticketId:_0x581902}=_0x457302['params'],{companyId:_0x17bb2d}=_0x457302[_0x56f657(0xb8)],_0x935069=await(0x0,ShowTicketService_1[_0x56f657(0xa9)])(_0x581902,_0x17bb2d);return _0x3b6503[_0x56f657(0xb0)](0xc8)[_0x56f657(0xad)](_0x935069);};exports[a33_0xafbacc(0xa8)]=show;const showFromUUID=async(_0x2ecdf3,_0xec7ce8)=>{const _0x54414e=a33_0xafbacc,{uuid:_0x8b6ef0}=_0x2ecdf3[_0x54414e(0xd3)],_0x48ddae=await(0x0,ShowTicketFromUUIDService_1[_0x54414e(0xa9)])(_0x8b6ef0);return _0xec7ce8[_0x54414e(0xb0)](0xc8)[_0x54414e(0xad)](_0x48ddae);};exports[a33_0xafbacc(0xc1)]=showFromUUID;const update=async(_0x431df6,_0x510245)=>{const _0x55fd95=a33_0xafbacc,{ticketId:_0x428ee9}=_0x431df6[_0x55fd95(0xd3)],_0x2fcd37=_0x431df6[_0x55fd95(0xab)],{companyId:_0x5447c1}=_0x431df6[_0x55fd95(0xb8)],{ticket:_0x57ba10}=await(0x0,UpdateTicketService_1[_0x55fd95(0xa9)])({'ticketData':_0x2fcd37,'ticketId':_0x428ee9,'companyId':_0x5447c1});return _0x510245['status'](0xc8)[_0x55fd95(0xad)](_0x57ba10);};function a33_0x5cdb(){const _0x312375=['remove','__importDefault','84579RmSRGl','index','../models/Ticket','16ySkcTU','findAndCountAll','company-','7344qcWOaz','262gQvphM','forEach','parse','params','userId','6924MgpRdy','queueId','1467304FVGrwV','kanban','show','default','__esModule','body','12381624MfjCuv','json','query','closeAll','status','DESC','../services/TicketServices/UpdateTicketService','3715047wWLydq','defineProperty','updatedAt','1169SOoQjE','9gkABOb','user','550iooLmZ','closed','-ticket','toString','3312280IKUzCW','update','ticket\x20deleted','../services/TicketServices/ShowTicketFromUUIDService','showFromUUID','store','notification','emit','delete','getIO'];a33_0x5cdb=function(){return _0x312375;};return a33_0x5cdb();}exports[a33_0xafbacc(0xbe)]=update;const remove=async(_0x4d7137,_0x329683)=>{const _0x181b37=a33_0xafbacc,{ticketId:_0x518664}=_0x4d7137[_0x181b37(0xd3)],{companyId:_0x39647d}=_0x4d7137[_0x181b37(0xb8)];await(0x0,ShowTicketService_1[_0x181b37(0xa9)])(_0x518664,_0x39647d);const _0x327ffc=await(0x0,DeleteTicketService_1[_0x181b37(0xa9)])(_0x518664),_0x555635=(0x0,socket_1[_0x181b37(0xc6)])();return _0x555635['to'](_0x327ffc[_0x181b37(0xb0)])['to'](_0x518664)['to'](_0x181b37(0xc3))['emit'](_0x181b37(0xce)+_0x39647d+_0x181b37(0xbb),{'action':_0x181b37(0xc5),'ticketId':+_0x518664}),_0x329683['status'](0xc8)[_0x181b37(0xad)]({'message':_0x181b37(0xbf)});};function a33_0x1309(_0x50a424,_0x4653ba){const _0x5cdb72=a33_0x5cdb();return a33_0x1309=function(_0x130920,_0x2ffb67){_0x130920=_0x130920-0xa8;let _0x5f5183=_0x5cdb72[_0x130920];return _0x5f5183;},a33_0x1309(_0x50a424,_0x4653ba);}exports['remove']=remove;const closeAll=async(_0x1cad98,_0x21edd6)=>{const _0x2a658e=a33_0xafbacc,{companyId:_0x49cdf0}=_0x1cad98[_0x2a658e(0xb8)],{status:_0x517404}=_0x1cad98[_0x2a658e(0xab)],_0x16283b=(0x0,socket_1[_0x2a658e(0xc6)])(),{rows:_0x1b0c4a}=await Ticket_1['default'][_0x2a658e(0xcd)]({'where':{'companyId':_0x49cdf0,'status':_0x517404,'isGroup':![]},'order':[[_0x2a658e(0xb5),_0x2a658e(0xb1)]]});return _0x1b0c4a[_0x2a658e(0xd1)](async _0x59ee1a=>{const _0x40e6df=_0x2a658e;await _0x59ee1a['update']({'status':_0x40e6df(0xba),'userId':_0x59ee1a[_0x40e6df(0xd4)]||0x1,'queueId':_0x59ee1a[_0x40e6df(0xd6)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0}),_0x16283b['to'](_0x517404)['to'](_0x59ee1a['id'][_0x40e6df(0xbc)]())['emit'](_0x40e6df(0xce)+_0x59ee1a['companyId']+_0x40e6df(0xbb),{'action':'delete','ticketId':_0x59ee1a['id']});}),_0x21edd6[_0x2a658e(0xb0)](0xc8)['json']();};exports[a33_0xafbacc(0xaf)]=closeAll;