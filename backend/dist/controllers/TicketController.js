'use strict';function a36_0xaf39(){const _0x122a60=['2475nBBkGG','params','store','650308Kfdwen','../services/TicketServices/ListTicketsService','defineProperty','../services/TicketServices/ShowTicketService','index','../services/TicketServices/ShowLogTicketService','__importDefault','../services/TicketServices/CreateLogTicketService','body','8760PQZdUa','../services/TicketServices/CreateTicketService','-ticket','20103HiGFmH','showFromUUID','updatedAt','kanban','json','__esModule','getIO','ticket\x20deleted','emit','delete','108IOgHkh','534975XzFEjO','229302YsmAGy','default','DESC','user','remove','parse','show','notification','update','company-','status','1346616fLmLrS','97525GEjylN','findAndCountAll','access','../services/TicketServices/DeleteTicketService','userId','closed'];a36_0xaf39=function(){return _0x122a60;};return a36_0xaf39();}const a36_0x45d238=a36_0x1e71;(function(_0x3db2d3,_0x261eee){const _0x4a0b30=a36_0x1e71,_0x42907b=_0x3db2d3();while(!![]){try{const _0x1cb6a7=parseInt(_0x4a0b30(0x106))/0x1+parseInt(_0x4a0b30(0x11b))/0x2+-parseInt(_0x4a0b30(0x127))/0x3*(parseInt(_0x4a0b30(0x104))/0x4)+-parseInt(_0x4a0b30(0x112))/0x5+parseInt(_0x4a0b30(0x111))/0x6+-parseInt(_0x4a0b30(0x105))/0x7+parseInt(_0x4a0b30(0x124))/0x8*(-parseInt(_0x4a0b30(0x118))/0x9);if(_0x1cb6a7===_0x261eee)break;else _0x42907b['push'](_0x42907b['shift']());}catch(_0x15c696){_0x42907b['push'](_0x42907b['shift']());}}}(a36_0xaf39,0x310ce));var __importDefault=this&&this[a36_0x45d238(0x121)]||function(_0x4e360a){return _0x4e360a&&_0x4e360a['__esModule']?_0x4e360a:{'default':_0x4e360a};};Object[a36_0x45d238(0x11d)](exports,a36_0x45d238(0xff),{'value':!![]}),exports['closeAll']=exports['remove']=exports['update']=exports[a36_0x45d238(0x128)]=exports['showLog']=exports[a36_0x45d238(0x10c)]=exports[a36_0x45d238(0x11a)]=exports[a36_0x45d238(0x12a)]=exports[a36_0x45d238(0x11f)]=void 0x0;const socket_1=require('../libs/socket'),Ticket_1=__importDefault(require('../models/Ticket')),CreateTicketService_1=__importDefault(require(a36_0x45d238(0x125))),DeleteTicketService_1=__importDefault(require(a36_0x45d238(0x115))),ListTicketsService_1=__importDefault(require(a36_0x45d238(0x11c))),ShowTicketFromUUIDService_1=__importDefault(require('../services/TicketServices/ShowTicketFromUUIDService')),ShowTicketService_1=__importDefault(require(a36_0x45d238(0x11e))),UpdateTicketService_1=__importDefault(require('../services/TicketServices/UpdateTicketService')),ListTicketsServiceKanban_1=__importDefault(require('../services/TicketServices/ListTicketsServiceKanban')),CreateLogTicketService_1=__importDefault(require(a36_0x45d238(0x122))),ShowLogTicketService_1=__importDefault(require(a36_0x45d238(0x120))),index=async(_0x5ca24e,_0x2dc2d2)=>{const _0x8b6e7=a36_0x45d238,{pageNumber:_0x53aa76,status:_0x30a276,date:_0x40f2d1,dateStart:_0x119a2e,dateEnd:_0x36e5d6,updatedAt:_0x355187,searchParam:_0x2990ad,showAll:_0x4ec6a8,queueIds:_0x17f652,tags:_0x223477,users:_0x344f30,withUnreadMessages:_0x42ae3b,whatsapps:_0x16d5c2,statusFilter:_0x3d131f}=_0x5ca24e['query'],_0x4555b5=Number(_0x5ca24e[_0x8b6e7(0x109)]['id']),{companyId:_0x58554f}=_0x5ca24e['user'];let _0x231d08=[],_0x19fa98=[],_0x5ba544=[],_0x9be9ae=[],_0x461fe2=[];_0x17f652&&(_0x231d08=JSON['parse'](_0x17f652));_0x223477&&(_0x19fa98=JSON['parse'](_0x223477));_0x344f30&&(_0x5ba544=JSON[_0x8b6e7(0x10b)](_0x344f30));_0x16d5c2&&(_0x9be9ae=JSON[_0x8b6e7(0x10b)](_0x16d5c2));_0x3d131f&&(_0x461fe2=JSON[_0x8b6e7(0x10b)](_0x3d131f));const {tickets:_0x401324,count:_0x113792,hasMore:_0x2c0d9b}=await(0x0,ListTicketsService_1[_0x8b6e7(0x107)])({'searchParam':_0x2990ad,'tags':_0x19fa98,'users':_0x5ba544,'pageNumber':_0x53aa76,'status':_0x30a276,'date':_0x40f2d1,'dateStart':_0x119a2e,'dateEnd':_0x36e5d6,'updatedAt':_0x355187,'showAll':_0x4ec6a8,'userId':_0x4555b5,'queueIds':_0x231d08,'withUnreadMessages':_0x42ae3b,'whatsappIds':_0x9be9ae,'statusFilters':_0x461fe2,'companyId':_0x58554f});return _0x2dc2d2[_0x8b6e7(0x110)](0xc8)[_0x8b6e7(0xfe)]({'tickets':_0x401324,'count':_0x113792,'hasMore':_0x2c0d9b});};exports['index']=index;const kanban=async(_0x16001e,_0x32582b)=>{const _0x5c57ed=a36_0x45d238,{pageNumber:_0x3f4b45,status:_0x41e70c,date:_0x758c90,updatedAt:_0x1aded0,searchParam:_0x2268b9,showAll:_0x1746fa,queueIds:_0x47b0f7,tags:_0x13d437,users:_0x465a48,withUnreadMessages:_0x203856}=_0x16001e['query'],_0x38cca0=_0x16001e['user']['id'],{companyId:_0x194eb7}=_0x16001e['user'];let _0xd9ee08=[],_0x34283a=[],_0x5b242a=[];_0x47b0f7&&(_0xd9ee08=JSON['parse'](_0x47b0f7));_0x13d437&&(_0x34283a=JSON[_0x5c57ed(0x10b)](_0x13d437));_0x465a48&&(_0x5b242a=JSON[_0x5c57ed(0x10b)](_0x465a48));const {tickets:_0x3da5bd,count:_0x1aa36f,hasMore:_0x5cd9e7}=await(0x0,ListTicketsServiceKanban_1[_0x5c57ed(0x107)])({'searchParam':_0x2268b9,'tags':_0x34283a,'users':_0x5b242a,'pageNumber':_0x3f4b45,'status':_0x41e70c,'date':_0x758c90,'updatedAt':_0x1aded0,'showAll':_0x1746fa,'userId':_0x38cca0,'queueIds':_0xd9ee08,'withUnreadMessages':_0x203856,'companyId':_0x194eb7});return _0x32582b['status'](0xc8)[_0x5c57ed(0xfe)]({'tickets':_0x3da5bd,'count':_0x1aa36f,'hasMore':_0x5cd9e7});};exports[a36_0x45d238(0x12a)]=kanban;const store=async(_0x424433,_0xf37a49)=>{const _0x490e1a=a36_0x45d238,{contactId:_0x10fd40,status:_0x7570f,userId:_0x39625b,queueId:_0x4b5f40,whatsappId:_0x8424ec}=_0x424433[_0x490e1a(0x123)],{companyId:_0x4ed18a}=_0x424433[_0x490e1a(0x109)],_0x585744=await(0x0,CreateTicketService_1[_0x490e1a(0x107)])({'contactId':_0x10fd40,'status':_0x7570f,'userId':_0x39625b,'companyId':_0x4ed18a,'queueId':_0x4b5f40,'whatsappId':_0x8424ec}),_0x2ec6cb=(0x0,socket_1['getIO'])();return _0x2ec6cb['to'](_0x585744[_0x490e1a(0x110)])[_0x490e1a(0x102)](_0x490e1a(0x10f)+_0x4ed18a+'-ticket',{'action':_0x490e1a(0x10e),'ticket':_0x585744}),_0xf37a49[_0x490e1a(0x110)](0xc8)[_0x490e1a(0xfe)](_0x585744);};exports['store']=store;const show=async(_0x3f0294,_0x2989d2)=>{const _0x5cecea=a36_0x45d238,{ticketId:_0x1cbafb}=_0x3f0294[_0x5cecea(0x119)],{id:_0xbfbaec,companyId:_0x4b4618}=_0x3f0294[_0x5cecea(0x109)],_0x59c8f6=await(0x0,ShowTicketService_1[_0x5cecea(0x107)])(_0x1cbafb,_0x4b4618);return await(0x0,CreateLogTicketService_1[_0x5cecea(0x107)])({'userId':_0xbfbaec,'ticketId':_0x1cbafb,'type':_0x5cecea(0x114)}),_0x2989d2['status'](0xc8)[_0x5cecea(0xfe)](_0x59c8f6);};exports[a36_0x45d238(0x10c)]=show;const showLog=async(_0x2765c5,_0x3a3184)=>{const _0xe2a367=a36_0x45d238,{ticketId:_0x5600aa}=_0x2765c5['params'],{id:_0xc9f1fe,companyId:_0x170ca0}=_0x2765c5[_0xe2a367(0x109)],_0x4b9f0f=await(0x0,ShowLogTicketService_1[_0xe2a367(0x107)])({'ticketId':_0x5600aa,'companyId':_0x170ca0});return _0x3a3184[_0xe2a367(0x110)](0xc8)[_0xe2a367(0xfe)](_0x4b9f0f);};function a36_0x1e71(_0x4dbff3,_0x1bb2de){const _0xaf395f=a36_0xaf39();return a36_0x1e71=function(_0x1e714d,_0x32edc4){_0x1e714d=_0x1e714d-0xfe;let _0x20714f=_0xaf395f[_0x1e714d];return _0x20714f;},a36_0x1e71(_0x4dbff3,_0x1bb2de);}exports['showLog']=showLog;const showFromUUID=async(_0x3b567c,_0x53f740)=>{const _0xfc10ce=a36_0x45d238,{uuid:_0xdf8864}=_0x3b567c['params'],{id:_0xbb85b0,companyId:_0x282dea}=_0x3b567c[_0xfc10ce(0x109)],_0x57419b=await(0x0,ShowTicketFromUUIDService_1['default'])(_0xdf8864,_0x282dea);return await(0x0,CreateLogTicketService_1[_0xfc10ce(0x107)])({'userId':_0xbb85b0,'ticketId':_0x57419b['id'],'type':_0xfc10ce(0x114)}),_0x53f740[_0xfc10ce(0x110)](0xc8)[_0xfc10ce(0xfe)](_0x57419b);};exports['showFromUUID']=showFromUUID;const update=async(_0x4883d6,_0x3e25bb)=>{const _0x5ecf75=a36_0x45d238,{ticketId:_0x2c53f2}=_0x4883d6['params'],_0x235e01=_0x4883d6[_0x5ecf75(0x123)],{companyId:_0x5abd52}=_0x4883d6[_0x5ecf75(0x109)],{ticket:_0xcc3493}=await(0x0,UpdateTicketService_1[_0x5ecf75(0x107)])({'ticketData':_0x235e01,'ticketId':_0x2c53f2,'companyId':_0x5abd52});return _0x3e25bb[_0x5ecf75(0x110)](0xc8)['json'](_0xcc3493);};exports[a36_0x45d238(0x10e)]=update;const remove=async(_0x2205c7,_0x5e6d8b)=>{const _0x4d3619=a36_0x45d238,{ticketId:_0x1a9bd0}=_0x2205c7[_0x4d3619(0x119)],{id:_0x1b8f0c,companyId:_0x2e3bc1}=_0x2205c7[_0x4d3619(0x109)];await(0x0,ShowTicketService_1[_0x4d3619(0x107)])(_0x1a9bd0,_0x2e3bc1);const _0x4d6dfb=await(0x0,DeleteTicketService_1[_0x4d3619(0x107)])(_0x1a9bd0,_0x1b8f0c,_0x2e3bc1),_0x5b4240=(0x0,socket_1[_0x4d3619(0x100)])();return _0x5b4240['to'](_0x4d6dfb['status'])['to'](_0x1a9bd0)['to'](_0x4d3619(0x10d))['emit'](_0x4d3619(0x10f)+_0x2e3bc1+_0x4d3619(0x126),{'action':_0x4d3619(0x103),'ticketId':+_0x1a9bd0}),_0x5e6d8b[_0x4d3619(0x110)](0xc8)[_0x4d3619(0xfe)]({'message':_0x4d3619(0x101)});};exports[a36_0x45d238(0x10a)]=remove;const closeAll=async(_0x560374,_0xdff372)=>{const _0x32b226=a36_0x45d238,{companyId:_0x41398f}=_0x560374[_0x32b226(0x109)],{status:_0x1779f5}=_0x560374['body'],_0x11273c=(0x0,socket_1[_0x32b226(0x100)])(),{rows:_0x9a443b}=await Ticket_1[_0x32b226(0x107)][_0x32b226(0x113)]({'where':{'companyId':_0x41398f,'status':_0x1779f5},'order':[[_0x32b226(0x129),_0x32b226(0x108)]]});return _0x9a443b['forEach'](async _0x3013c1=>{const _0x177689=_0x32b226,_0x22fc72={'status':_0x177689(0x117),'userId':_0x3013c1[_0x177689(0x116)]||null,'queueId':_0x3013c1['queueId']||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1[_0x177689(0x107)])({'ticketData':_0x22fc72,'ticketId':_0x3013c1['id'],'companyId':_0x41398f});}),_0xdff372[_0x32b226(0x110)](0xc8)[_0x32b226(0xfe)]();};exports['closeAll']=closeAll;