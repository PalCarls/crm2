'use strict';const a36_0x2d392b=a36_0x3865;(function(_0x408ba9,_0x1c0050){const _0x507c08=a36_0x3865,_0x1db478=_0x408ba9();while(!![]){try{const _0x16783b=parseInt(_0x507c08(0x146))/0x1*(parseInt(_0x507c08(0x130))/0x2)+-parseInt(_0x507c08(0x129))/0x3+parseInt(_0x507c08(0x13e))/0x4+parseInt(_0x507c08(0x147))/0x5*(parseInt(_0x507c08(0x12c))/0x6)+-parseInt(_0x507c08(0x139))/0x7*(-parseInt(_0x507c08(0x14e))/0x8)+-parseInt(_0x507c08(0x138))/0x9*(-parseInt(_0x507c08(0x155))/0xa)+-parseInt(_0x507c08(0x143))/0xb*(parseInt(_0x507c08(0x13c))/0xc);if(_0x16783b===_0x1c0050)break;else _0x1db478['push'](_0x1db478['shift']());}catch(_0x1062d5){_0x1db478['push'](_0x1db478['shift']());}}}(a36_0x3c58,0x4844e));var __importDefault=this&&this[a36_0x2d392b(0x12d)]||function(_0x4cd1ab){const _0x5709a1=a36_0x2d392b;return _0x4cd1ab&&_0x4cd1ab[_0x5709a1(0x132)]?_0x4cd1ab:{'default':_0x4cd1ab};};Object[a36_0x2d392b(0x126)](exports,a36_0x2d392b(0x132),{'value':!![]}),exports[a36_0x2d392b(0x13f)]=exports['remove']=exports[a36_0x2d392b(0x144)]=exports[a36_0x2d392b(0x12a)]=exports[a36_0x2d392b(0x157)]=exports['show']=exports[a36_0x2d392b(0x14d)]=exports['kanban']=exports[a36_0x2d392b(0x148)]=void 0x0;const socket_1=require(a36_0x2d392b(0x13a)),Ticket_1=__importDefault(require(a36_0x2d392b(0x140))),CreateTicketService_1=__importDefault(require(a36_0x2d392b(0x134))),DeleteTicketService_1=__importDefault(require(a36_0x2d392b(0x13b))),ListTicketsService_1=__importDefault(require(a36_0x2d392b(0x142))),ShowTicketFromUUIDService_1=__importDefault(require(a36_0x2d392b(0x12e))),ShowTicketService_1=__importDefault(require(a36_0x2d392b(0x151))),UpdateTicketService_1=__importDefault(require(a36_0x2d392b(0x156))),ListTicketsServiceKanban_1=__importDefault(require(a36_0x2d392b(0x152))),CreateLogTicketService_1=__importDefault(require(a36_0x2d392b(0x153))),ShowLogTicketService_1=__importDefault(require('../services/TicketServices/ShowLogTicketService')),index=async(_0x2b5c88,_0x3fe0ae)=>{const _0x44d550=a36_0x2d392b,{pageNumber:_0x75c0b0,status:_0x5b98a6,date:_0x2c6531,dateStart:_0x229f16,dateEnd:_0xfe0b98,updatedAt:_0x4a9d3b,searchParam:_0x220bd0,showAll:_0x2af3fa,queueIds:_0x477fab,tags:_0x50240c,users:_0x5d75da,withUnreadMessages:_0x32bb2d,whatsapps:_0x5ec3a2,statusFilter:_0x19801f}=_0x2b5c88[_0x44d550(0x145)],_0x5632ab=Number(_0x2b5c88[_0x44d550(0x12b)]['id']),{companyId:_0xc2268c}=_0x2b5c88[_0x44d550(0x12b)];let _0x522a1a=[],_0x368aa1=[],_0x315f60=[],_0xc94314=[],_0x432c77=[];_0x477fab&&(_0x522a1a=JSON['parse'](_0x477fab));_0x50240c&&(_0x368aa1=JSON[_0x44d550(0x14c)](_0x50240c));_0x5d75da&&(_0x315f60=JSON[_0x44d550(0x14c)](_0x5d75da));_0x5ec3a2&&(_0xc94314=JSON[_0x44d550(0x14c)](_0x5ec3a2));_0x19801f&&(_0x432c77=JSON['parse'](_0x19801f));const {tickets:_0x136a3f,count:_0x5182ed,hasMore:_0x887e88}=await(0x0,ListTicketsService_1[_0x44d550(0x127)])({'searchParam':_0x220bd0,'tags':_0x368aa1,'users':_0x315f60,'pageNumber':_0x75c0b0,'status':_0x5b98a6,'date':_0x2c6531,'dateStart':_0x229f16,'dateEnd':_0xfe0b98,'updatedAt':_0x4a9d3b,'showAll':_0x2af3fa,'userId':_0x5632ab,'queueIds':_0x522a1a,'withUnreadMessages':_0x32bb2d,'whatsappIds':_0xc94314,'statusFilters':_0x432c77,'companyId':_0xc2268c});return _0x3fe0ae[_0x44d550(0x133)](0xc8)[_0x44d550(0x131)]({'tickets':_0x136a3f,'count':_0x5182ed,'hasMore':_0x887e88});};exports[a36_0x2d392b(0x148)]=index;const kanban=async(_0x558cee,_0x203f24)=>{const _0x16fc45=a36_0x2d392b,{pageNumber:_0x686ccf,status:_0x2ad639,date:_0x2385c3,updatedAt:_0x29c4a2,searchParam:_0x27aa7f,showAll:_0x157dfa,queueIds:_0x2e816b,tags:_0x26b41a,users:_0x11f158,withUnreadMessages:_0x4551db}=_0x558cee[_0x16fc45(0x145)],_0x5ff7b2=_0x558cee[_0x16fc45(0x12b)]['id'],{companyId:_0x3d47b9}=_0x558cee[_0x16fc45(0x12b)];let _0x34d7ea=[],_0x5dd731=[],_0x369bc0=[];_0x2e816b&&(_0x34d7ea=JSON[_0x16fc45(0x14c)](_0x2e816b));_0x26b41a&&(_0x5dd731=JSON[_0x16fc45(0x14c)](_0x26b41a));_0x11f158&&(_0x369bc0=JSON[_0x16fc45(0x14c)](_0x11f158));const {tickets:_0x5663b1,count:_0x1d8f90,hasMore:_0x459638}=await(0x0,ListTicketsServiceKanban_1[_0x16fc45(0x127)])({'searchParam':_0x27aa7f,'tags':_0x5dd731,'users':_0x369bc0,'pageNumber':_0x686ccf,'status':_0x2ad639,'date':_0x2385c3,'updatedAt':_0x29c4a2,'showAll':_0x157dfa,'userId':_0x5ff7b2,'queueIds':_0x34d7ea,'withUnreadMessages':_0x4551db,'companyId':_0x3d47b9});return _0x203f24['status'](0xc8)[_0x16fc45(0x131)]({'tickets':_0x5663b1,'count':_0x1d8f90,'hasMore':_0x459638});};exports[a36_0x2d392b(0x13d)]=kanban;const store=async(_0x442222,_0x176cb2)=>{const _0x1646cb=a36_0x2d392b,{contactId:_0x34af72,status:_0x27c43e,userId:_0x47fd9d,queueId:_0x16ddd7,whatsappId:_0x3eb978}=_0x442222[_0x1646cb(0x12f)],{companyId:_0xaff412}=_0x442222['user'],_0x575532=await(0x0,CreateTicketService_1[_0x1646cb(0x127)])({'contactId':_0x34af72,'status':_0x27c43e,'userId':_0x47fd9d,'companyId':_0xaff412,'queueId':_0x16ddd7,'whatsappId':_0x3eb978}),_0x4d751d=(0x0,socket_1[_0x1646cb(0x128)])();return _0x4d751d['to'](_0x575532[_0x1646cb(0x133)])[_0x1646cb(0x137)](_0x1646cb(0x14f)+_0xaff412+_0x1646cb(0x14b),{'action':_0x1646cb(0x144),'ticket':_0x575532}),_0x176cb2[_0x1646cb(0x133)](0xc8)['json'](_0x575532);};exports[a36_0x2d392b(0x14d)]=store;const show=async(_0x56f66a,_0x21c0de)=>{const _0x566cc8=a36_0x2d392b,{ticketId:_0x17500d}=_0x56f66a[_0x566cc8(0x135)],{id:_0x45524d,companyId:_0x5b057a}=_0x56f66a[_0x566cc8(0x12b)],_0x3205ef=await(0x0,ShowTicketService_1[_0x566cc8(0x127)])(_0x17500d,_0x5b057a);return await(0x0,CreateLogTicketService_1['default'])({'userId':_0x45524d,'ticketId':_0x17500d,'type':_0x566cc8(0x150)}),_0x21c0de[_0x566cc8(0x133)](0xc8)[_0x566cc8(0x131)](_0x3205ef);};exports[a36_0x2d392b(0x141)]=show;const showLog=async(_0x34c147,_0x5ec203)=>{const _0x4ff9c1=a36_0x2d392b,{ticketId:_0x3bba99}=_0x34c147['params'],{id:_0x3059a4,companyId:_0x142634}=_0x34c147[_0x4ff9c1(0x12b)],_0x225b00=await(0x0,ShowLogTicketService_1[_0x4ff9c1(0x127)])({'ticketId':_0x3bba99,'companyId':_0x142634});return _0x5ec203[_0x4ff9c1(0x133)](0xc8)[_0x4ff9c1(0x131)](_0x225b00);};exports[a36_0x2d392b(0x157)]=showLog;const showFromUUID=async(_0x2fc9fd,_0x2197d6)=>{const _0x322181=a36_0x2d392b,{uuid:_0x54562b}=_0x2fc9fd[_0x322181(0x135)],{id:_0x3e0c22,companyId:_0x387415}=_0x2fc9fd[_0x322181(0x12b)],_0x38cba4=await(0x0,ShowTicketFromUUIDService_1[_0x322181(0x127)])(_0x54562b,_0x387415);return await(0x0,CreateLogTicketService_1['default'])({'userId':_0x3e0c22,'ticketId':_0x38cba4['id'],'type':_0x322181(0x150)}),_0x2197d6['status'](0xc8)[_0x322181(0x131)](_0x38cba4);};exports['showFromUUID']=showFromUUID;const update=async(_0x2ef8bf,_0xc33b5a)=>{const _0x16f77d=a36_0x2d392b,{ticketId:_0x3b4139}=_0x2ef8bf[_0x16f77d(0x135)],_0x4f5373=_0x2ef8bf[_0x16f77d(0x12f)],{companyId:_0x2b0cb0}=_0x2ef8bf['user'],{ticket:_0x4a87c7}=await(0x0,UpdateTicketService_1[_0x16f77d(0x127)])({'ticketData':_0x4f5373,'ticketId':_0x3b4139,'companyId':_0x2b0cb0});return _0xc33b5a[_0x16f77d(0x133)](0xc8)[_0x16f77d(0x131)](_0x4a87c7);};exports[a36_0x2d392b(0x144)]=update;const remove=async(_0x5a400a,_0x8d828b)=>{const _0x27e75f=a36_0x2d392b,{ticketId:_0x32b2fd}=_0x5a400a[_0x27e75f(0x135)],{id:_0x8341,companyId:_0x38b791}=_0x5a400a[_0x27e75f(0x12b)];await(0x0,ShowTicketService_1[_0x27e75f(0x127)])(_0x32b2fd,_0x38b791);const _0x52c4c8=await(0x0,DeleteTicketService_1[_0x27e75f(0x127)])(_0x32b2fd,_0x8341,_0x38b791),_0x493fdd=(0x0,socket_1[_0x27e75f(0x128)])();return _0x493fdd['to'](_0x52c4c8[_0x27e75f(0x133)])['to'](_0x32b2fd)['to'](_0x27e75f(0x149))[_0x27e75f(0x137)](_0x27e75f(0x14f)+_0x38b791+_0x27e75f(0x14b),{'action':'delete','ticketId':+_0x32b2fd}),_0x8d828b[_0x27e75f(0x133)](0xc8)['json']({'message':'ticket\x20deleted'});};function a36_0x3865(_0x109605,_0x50228a){const _0x3c5820=a36_0x3c58();return a36_0x3865=function(_0x386508,_0x1be1b9){_0x386508=_0x386508-0x126;let _0x32b072=_0x3c5820[_0x386508];return _0x32b072;},a36_0x3865(_0x109605,_0x50228a);}exports[a36_0x2d392b(0x154)]=remove;const closeAll=async(_0x598829,_0x172900)=>{const _0xd2e159=a36_0x2d392b,{companyId:_0x59e810}=_0x598829[_0xd2e159(0x12b)],{status:_0x5b77c9}=_0x598829[_0xd2e159(0x12f)],_0x35b51f=(0x0,socket_1[_0xd2e159(0x128)])(),{rows:_0x43ee3c}=await Ticket_1[_0xd2e159(0x127)]['findAndCountAll']({'where':{'companyId':_0x59e810,'status':_0x5b77c9},'order':[[_0xd2e159(0x14a),'DESC']]});return _0x43ee3c[_0xd2e159(0x136)](async _0x286359=>{const _0x33f433=_0xd2e159,_0x301378={'status':'closed','userId':_0x286359['userId']||null,'queueId':_0x286359['queueId']||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1[_0x33f433(0x127)])({'ticketData':_0x301378,'ticketId':_0x286359['id'],'companyId':_0x59e810});}),_0x172900[_0xd2e159(0x133)](0xc8)[_0xd2e159(0x131)]();};exports['closeAll']=closeAll;function a36_0x3c58(){const _0x420662=['898512EYaYWp','closeAll','../models/Ticket','show','../services/TicketServices/ListTicketsService','2172819vjbDWZ','update','query','444601SSiLxf','6875RUHLIH','index','notification','updatedAt','-ticket','parse','store','16fBDGhS','company-','access','../services/TicketServices/ShowTicketService','../services/TicketServices/ListTicketsServiceKanban','../services/TicketServices/CreateLogTicketService','remove','35260XeTreM','../services/TicketServices/UpdateTicketService','showLog','defineProperty','default','getIO','1309617IjZppO','showFromUUID','user','240ditgcB','__importDefault','../services/TicketServices/ShowTicketFromUUIDService','body','2MSDhuu','json','__esModule','status','../services/TicketServices/CreateTicketService','params','forEach','emit','981PJJNZm','66668VOPOHI','../libs/socket','../services/TicketServices/DeleteTicketService','24AItZtz','kanban'];a36_0x3c58=function(){return _0x420662;};return a36_0x3c58();}