'use strict';const a34_0x41b5bd=a34_0x3175;(function(_0x13ba1d,_0x16873c){const _0x319552=a34_0x3175,_0x316e8e=_0x13ba1d();while(!![]){try{const _0x2bf0a7=parseInt(_0x319552(0x1e2))/0x1*(parseInt(_0x319552(0x1e9))/0x2)+parseInt(_0x319552(0x1d1))/0x3*(parseInt(_0x319552(0x1fa))/0x4)+parseInt(_0x319552(0x1e1))/0x5+parseInt(_0x319552(0x1cb))/0x6+-parseInt(_0x319552(0x1dc))/0x7+-parseInt(_0x319552(0x1da))/0x8+-parseInt(_0x319552(0x1ca))/0x9*(parseInt(_0x319552(0x1ea))/0xa);if(_0x2bf0a7===_0x16873c)break;else _0x316e8e['push'](_0x316e8e['shift']());}catch(_0x2bea91){_0x316e8e['push'](_0x316e8e['shift']());}}}(a34_0x5a40,0x5b7ef));var __importDefault=this&&this['__importDefault']||function(_0x34154b){const _0x5d21a5=a34_0x3175;return _0x34154b&&_0x34154b[_0x5d21a5(0x1cf)]?_0x34154b:{'default':_0x34154b};};Object['defineProperty'](exports,a34_0x41b5bd(0x1cf),{'value':!![]}),exports[a34_0x41b5bd(0x1e5)]=exports[a34_0x41b5bd(0x1f4)]=exports['update']=exports[a34_0x41b5bd(0x1e8)]=exports[a34_0x41b5bd(0x1ef)]=exports[a34_0x41b5bd(0x1e4)]=exports['store']=exports[a34_0x41b5bd(0x1d3)]=exports[a34_0x41b5bd(0x1df)]=void 0x0;const socket_1=require(a34_0x41b5bd(0x1f6)),Ticket_1=__importDefault(require(a34_0x41b5bd(0x1d2))),CreateTicketService_1=__importDefault(require(a34_0x41b5bd(0x1d0))),DeleteTicketService_1=__importDefault(require(a34_0x41b5bd(0x1f7))),ListTicketsService_1=__importDefault(require(a34_0x41b5bd(0x1cc))),ShowTicketFromUUIDService_1=__importDefault(require(a34_0x41b5bd(0x1eb))),ShowTicketService_1=__importDefault(require(a34_0x41b5bd(0x1ce))),UpdateTicketService_1=__importDefault(require('../services/TicketServices/UpdateTicketService')),ListTicketsServiceKanban_1=__importDefault(require(a34_0x41b5bd(0x1d6))),CreateLogTicketService_1=__importDefault(require(a34_0x41b5bd(0x1cd))),ShowLogTicketService_1=__importDefault(require(a34_0x41b5bd(0x1f3))),index=async(_0x1cdbfe,_0x11843d)=>{const _0x3b4183=a34_0x41b5bd,{pageNumber:_0x2706c7,status:_0x23e7b6,date:_0x242e0b,dateStart:_0x251c64,dateEnd:_0x2fd154,updatedAt:_0x2b7fd7,searchParam:_0x1c9b5c,showAll:_0x29ae36,queueIds:_0x21282a,tags:_0x19b884,users:_0x47749b,withUnreadMessages:_0x2dcb31,whatsapps:_0x437c06,statusFilter:_0x21546a}=_0x1cdbfe[_0x3b4183(0x1e3)],_0x16a39f=_0x1cdbfe[_0x3b4183(0x1e0)]['id'],{companyId:_0x3f93ec}=_0x1cdbfe['user'];let _0x102965=[],_0x39c535=[],_0x41f80c=[],_0x1d6142=[],_0x4d8bff=[];console['log'](_0x2dcb31);_0x21282a&&(_0x102965=JSON['parse'](_0x21282a));_0x19b884&&(_0x39c535=JSON['parse'](_0x19b884));_0x47749b&&(_0x41f80c=JSON[_0x3b4183(0x1f9)](_0x47749b));_0x437c06&&(_0x1d6142=JSON[_0x3b4183(0x1f9)](_0x437c06));_0x21546a&&(_0x4d8bff=JSON[_0x3b4183(0x1f9)](_0x21546a));const {tickets:_0x47ba26,count:_0x1945ec,hasMore:_0x4b5cee}=await(0x0,ListTicketsService_1[_0x3b4183(0x1ee)])({'searchParam':_0x1c9b5c,'tags':_0x39c535,'users':_0x41f80c,'pageNumber':_0x2706c7,'status':_0x23e7b6,'date':_0x242e0b,'dateStart':_0x251c64,'dateEnd':_0x2fd154,'updatedAt':_0x2b7fd7,'showAll':_0x29ae36,'userId':_0x16a39f,'queueIds':_0x102965,'withUnreadMessages':_0x2dcb31,'whatsappIds':_0x1d6142,'statusFilters':_0x4d8bff,'companyId':_0x3f93ec});return _0x11843d[_0x3b4183(0x1d4)](0xc8)[_0x3b4183(0x1ed)]({'tickets':_0x47ba26,'count':_0x1945ec,'hasMore':_0x4b5cee});};exports['index']=index;const kanban=async(_0xf65999,_0x479737)=>{const _0x359d78=a34_0x41b5bd,{pageNumber:_0x1f154f,status:_0x2745e1,date:_0x3b0ad9,updatedAt:_0x34798e,searchParam:_0x4d9818,showAll:_0x206e4d,queueIds:_0x7b8835,tags:_0x1ea252,users:_0x16b165,withUnreadMessages:_0x24ac64}=_0xf65999[_0x359d78(0x1e3)],_0x3f48d3=_0xf65999['user']['id'],{companyId:_0x3410a2}=_0xf65999[_0x359d78(0x1e0)];let _0x448c91=[],_0x1b1044=[],_0x434747=[];_0x7b8835&&(_0x448c91=JSON[_0x359d78(0x1f9)](_0x7b8835));_0x1ea252&&(_0x1b1044=JSON[_0x359d78(0x1f9)](_0x1ea252));_0x16b165&&(_0x434747=JSON['parse'](_0x16b165));console['log']('withUnreadMessages'),console[_0x359d78(0x1f2)](_0x24ac64);const {tickets:_0x1fbe7e,count:_0xad2a05,hasMore:_0x572305}=await(0x0,ListTicketsServiceKanban_1['default'])({'searchParam':_0x4d9818,'tags':_0x1b1044,'users':_0x434747,'pageNumber':_0x1f154f,'status':_0x2745e1,'date':_0x3b0ad9,'updatedAt':_0x34798e,'showAll':_0x206e4d,'userId':_0x3f48d3,'queueIds':_0x448c91,'withUnreadMessages':_0x24ac64,'companyId':_0x3410a2});return _0x479737[_0x359d78(0x1d4)](0xc8)['json']({'tickets':_0x1fbe7e,'count':_0xad2a05,'hasMore':_0x572305});};exports[a34_0x41b5bd(0x1d3)]=kanban;const store=async(_0x1a50be,_0x9d7c0a)=>{const _0x47ab7c=a34_0x41b5bd,{contactId:_0x38fb91,status:_0x3046ff,userId:_0x4a4303,queueId:_0x25e7e9,whatsappId:_0x3cc1f3}=_0x1a50be[_0x47ab7c(0x1f5)],{companyId:_0x2ff182}=_0x1a50be[_0x47ab7c(0x1e0)],_0x176321=await(0x0,CreateTicketService_1['default'])({'contactId':_0x38fb91,'status':_0x3046ff,'userId':_0x4a4303,'companyId':_0x2ff182,'queueId':_0x25e7e9,'whatsappId':_0x3cc1f3}),_0x1e13da=(0x0,socket_1['getIO'])();return _0x1e13da['to'](_0x176321[_0x47ab7c(0x1d4)])[_0x47ab7c(0x1dd)](_0x47ab7c(0x1d7)+_0x2ff182+_0x47ab7c(0x1d8),{'action':'update','ticket':_0x176321}),_0x9d7c0a[_0x47ab7c(0x1d4)](0xc8)[_0x47ab7c(0x1ed)](_0x176321);};function a34_0x3175(_0x5624d4,_0x1008bf){const _0x5a4008=a34_0x5a40();return a34_0x3175=function(_0x317527,_0xc6d145){_0x317527=_0x317527-0x1c9;let _0x140346=_0x5a4008[_0x317527];return _0x140346;},a34_0x3175(_0x5624d4,_0x1008bf);}exports[a34_0x41b5bd(0x1fb)]=store;const show=async(_0x423cf6,_0x4b292b)=>{const _0x58ea4d=a34_0x41b5bd,{ticketId:_0x5ed7ec}=_0x423cf6['params'],{id:_0x3e7808,companyId:_0x1d76c2}=_0x423cf6[_0x58ea4d(0x1e0)],_0x55b905=await(0x0,ShowTicketService_1[_0x58ea4d(0x1ee)])(_0x5ed7ec,_0x1d76c2);return await(0x0,CreateLogTicketService_1['default'])({'userId':_0x3e7808,'ticketId':_0x5ed7ec,'type':_0x58ea4d(0x1d5)}),_0x4b292b[_0x58ea4d(0x1d4)](0xc8)[_0x58ea4d(0x1ed)](_0x55b905);};exports[a34_0x41b5bd(0x1e4)]=show;const showLog=async(_0x165831,_0x484d9e)=>{const _0x5e2a02=a34_0x41b5bd,{ticketId:_0x1de112}=_0x165831[_0x5e2a02(0x1e7)],{id:_0x270393,companyId:_0x127fa8}=_0x165831[_0x5e2a02(0x1e0)],_0x49c50b=await(0x0,ShowLogTicketService_1[_0x5e2a02(0x1ee)])({'ticketId':_0x1de112,'companyId':_0x127fa8});return _0x484d9e[_0x5e2a02(0x1d4)](0xc8)[_0x5e2a02(0x1ed)](_0x49c50b);};exports[a34_0x41b5bd(0x1ef)]=showLog;const showFromUUID=async(_0x4df53e,_0x5a9488)=>{const _0x16aea1=a34_0x41b5bd,{uuid:_0x5b77d2}=_0x4df53e[_0x16aea1(0x1e7)],{id:_0x5f0415,companyId:_0x25dec}=_0x4df53e[_0x16aea1(0x1e0)],_0xd41cc9=await(0x0,ShowTicketFromUUIDService_1['default'])(_0x5b77d2,_0x25dec);return await(0x0,CreateLogTicketService_1[_0x16aea1(0x1ee)])({'userId':_0x5f0415,'ticketId':_0xd41cc9['id'],'type':_0x16aea1(0x1d5)}),_0x5a9488[_0x16aea1(0x1d4)](0xc8)[_0x16aea1(0x1ed)](_0xd41cc9);};exports['showFromUUID']=showFromUUID;function a34_0x5a40(){const _0x8ab12b=['3287622VVgUTz','../services/TicketServices/ListTicketsService','../services/TicketServices/CreateLogTicketService','../services/TicketServices/ShowTicketService','__esModule','../services/TicketServices/CreateTicketService','249534IjHdLs','../models/Ticket','kanban','status','access','../services/TicketServices/ListTicketsServiceKanban','company-','-ticket','delete','3282384KXHrAR','closed','5030578xmORaF','emit','update','index','user','2101555NkBcZr','547FykUzB','query','show','closeAll','userId','params','showFromUUID','2462JAHmOD','30Scffcg','../services/TicketServices/ShowTicketFromUUIDService','updatedAt','json','default','showLog','ticket\x20deleted','notification','log','../services/TicketServices/ShowLogTicketService','remove','body','../libs/socket','../services/TicketServices/DeleteTicketService','getIO','parse','4PTHdzJ','store','queueId','663192YTqtuy'];a34_0x5a40=function(){return _0x8ab12b;};return a34_0x5a40();}const update=async(_0xf020e0,_0xe08127)=>{const _0x281a94=a34_0x41b5bd,{ticketId:_0x12e1cd}=_0xf020e0[_0x281a94(0x1e7)],_0x52ad1b=_0xf020e0[_0x281a94(0x1f5)],{companyId:_0x49632a}=_0xf020e0[_0x281a94(0x1e0)],{ticket:_0x1b2045}=await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x52ad1b,'ticketId':_0x12e1cd,'companyId':_0x49632a});return _0xe08127[_0x281a94(0x1d4)](0xc8)['json'](_0x1b2045);};exports['update']=update;const remove=async(_0x449841,_0x186fc5)=>{const _0x54e282=a34_0x41b5bd,{ticketId:_0x10c364}=_0x449841['params'],{id:_0x5e3d03,companyId:_0x4964aa}=_0x449841['user'];await(0x0,ShowTicketService_1[_0x54e282(0x1ee)])(_0x10c364,_0x4964aa);const _0x383f3a=await(0x0,DeleteTicketService_1['default'])(_0x10c364,_0x5e3d03,_0x4964aa),_0x562fc3=(0x0,socket_1['getIO'])();return _0x562fc3['to'](_0x383f3a['status'])['to'](_0x10c364)['to'](_0x54e282(0x1f1))[_0x54e282(0x1dd)](_0x54e282(0x1d7)+_0x4964aa+_0x54e282(0x1d8),{'action':_0x54e282(0x1d9),'ticketId':+_0x10c364}),_0x186fc5[_0x54e282(0x1d4)](0xc8)[_0x54e282(0x1ed)]({'message':_0x54e282(0x1f0)});};exports[a34_0x41b5bd(0x1f4)]=remove;const closeAll=async(_0x1bf509,_0x53c09b)=>{const _0x5ba688=a34_0x41b5bd,{companyId:_0x5566b2}=_0x1bf509[_0x5ba688(0x1e0)],{status:_0x8951e}=_0x1bf509[_0x5ba688(0x1f5)],_0x3e40b0=(0x0,socket_1[_0x5ba688(0x1f8)])(),{rows:_0x3e0f79}=await Ticket_1[_0x5ba688(0x1ee)]['findAndCountAll']({'where':{'companyId':_0x5566b2,'status':_0x8951e},'order':[[_0x5ba688(0x1ec),'DESC']]});return _0x3e0f79['forEach'](async _0x52d5ff=>{const _0x1d5388=_0x5ba688;await _0x52d5ff[_0x1d5388(0x1de)]({'status':_0x1d5388(0x1db),'userId':_0x52d5ff[_0x1d5388(0x1e6)],'queueId':_0x52d5ff[_0x1d5388(0x1c9)],'unreadMessages':0x0,'amountUsedBotQueues':0x0}),await(0x0,CreateLogTicketService_1[_0x1d5388(0x1ee)])({'userId':_0x52d5ff['userId'],'queueId':_0x52d5ff[_0x1d5388(0x1c9)],'ticketId':_0x52d5ff['id'],'type':_0x1d5388(0x1db)}),_0x3e40b0['to'](_0x8951e)['to'](_0x52d5ff['id']['toString']())['emit'](_0x1d5388(0x1d7)+_0x52d5ff['companyId']+_0x1d5388(0x1d8),{'action':_0x1d5388(0x1d9),'ticketId':_0x52d5ff['id']});}),_0x53c09b['status'](0xc8)[_0x5ba688(0x1ed)]();};exports[a34_0x41b5bd(0x1e5)]=closeAll;