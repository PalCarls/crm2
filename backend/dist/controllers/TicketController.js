'use strict';const a36_0x1f7d46=a36_0x23bd;(function(_0x597620,_0x4bf9ed){const _0x46e1cb=a36_0x23bd,_0x3683a6=_0x597620();while(!![]){try{const _0x4ba98b=-parseInt(_0x46e1cb(0x1bc))/0x1*(parseInt(_0x46e1cb(0x1c3))/0x2)+-parseInt(_0x46e1cb(0x1ca))/0x3+-parseInt(_0x46e1cb(0x1dc))/0x4+parseInt(_0x46e1cb(0x1be))/0x5+parseInt(_0x46e1cb(0x1c1))/0x6*(-parseInt(_0x46e1cb(0x1ce))/0x7)+parseInt(_0x46e1cb(0x1d3))/0x8+parseInt(_0x46e1cb(0x1d1))/0x9;if(_0x4ba98b===_0x4bf9ed)break;else _0x3683a6['push'](_0x3683a6['shift']());}catch(_0x2fbf95){_0x3683a6['push'](_0x3683a6['shift']());}}}(a36_0x37f3,0x9b1d6));var __importDefault=this&&this[a36_0x1f7d46(0x1bd)]||function(_0x2ba41d){const _0x33c901=a36_0x1f7d46;return _0x2ba41d&&_0x2ba41d[_0x33c901(0x1af)]?_0x2ba41d:{'default':_0x2ba41d};};function a36_0x37f3(){const _0x1c9889=['kanban','12uxZDyQ','query','26fgjFJJ','company-','store','showLog','../services/TicketServices/CreateLogTicketService','../services/TicketServices/ShowLogTicketService','parse','429291osytwk','forEach','update','userId','1603294NqgCVS','access','json','11128086cFnXKe','body','8797992RdnCTn','findAndCountAll','closeAll','notification','DESC','params','delete','showFromUUID','closed','2857956eHxUJY','defineProperty','remove','__esModule','../services/TicketServices/ListTicketsServiceKanban','-ticket','emit','queueId','user','index','../services/TicketServices/ShowTicketFromUUIDService','ticket\x20deleted','default','show','status','getIO','45462xJTRss','__importDefault','1029115wiPLqw','../services/TicketServices/ShowTicketService'];a36_0x37f3=function(){return _0x1c9889;};return a36_0x37f3();}Object[a36_0x1f7d46(0x1dd)](exports,a36_0x1f7d46(0x1af),{'value':!![]}),exports[a36_0x1f7d46(0x1d5)]=exports[a36_0x1f7d46(0x1de)]=exports['update']=exports[a36_0x1f7d46(0x1da)]=exports[a36_0x1f7d46(0x1c6)]=exports[a36_0x1f7d46(0x1b9)]=exports[a36_0x1f7d46(0x1c5)]=exports[a36_0x1f7d46(0x1c0)]=exports['index']=void 0x0;const socket_1=require('../libs/socket'),Ticket_1=__importDefault(require('../models/Ticket')),CreateTicketService_1=__importDefault(require('../services/TicketServices/CreateTicketService')),DeleteTicketService_1=__importDefault(require('../services/TicketServices/DeleteTicketService')),ListTicketsService_1=__importDefault(require('../services/TicketServices/ListTicketsService')),ShowTicketFromUUIDService_1=__importDefault(require(a36_0x1f7d46(0x1b6))),ShowTicketService_1=__importDefault(require(a36_0x1f7d46(0x1bf))),UpdateTicketService_1=__importDefault(require('../services/TicketServices/UpdateTicketService')),ListTicketsServiceKanban_1=__importDefault(require(a36_0x1f7d46(0x1b0))),CreateLogTicketService_1=__importDefault(require(a36_0x1f7d46(0x1c7))),ShowLogTicketService_1=__importDefault(require(a36_0x1f7d46(0x1c8))),index=async(_0x2f1cef,_0x335ec9)=>{const _0xe649e6=a36_0x1f7d46,{pageNumber:_0xef6eee,status:_0x54af50,date:_0x13f427,dateStart:_0x4360e2,dateEnd:_0x4ca36e,updatedAt:_0x2a2c25,searchParam:_0x2f37e0,showAll:_0x18db71,queueIds:_0x63797c,tags:_0x2e6914,users:_0x521eee,withUnreadMessages:_0x29d489,whatsapps:_0x2b098b,statusFilter:_0x1c4fd6}=_0x2f1cef[_0xe649e6(0x1c2)],_0xb76319=Number(_0x2f1cef[_0xe649e6(0x1b4)]['id']),{companyId:_0x515766}=_0x2f1cef[_0xe649e6(0x1b4)];let _0x5eea4e=[],_0x259964=[],_0x57f792=[],_0x17e510=[],_0x52c5cd=[];_0x63797c&&(_0x5eea4e=JSON[_0xe649e6(0x1c9)](_0x63797c));_0x2e6914&&(_0x259964=JSON[_0xe649e6(0x1c9)](_0x2e6914));_0x521eee&&(_0x57f792=JSON[_0xe649e6(0x1c9)](_0x521eee));_0x2b098b&&(_0x17e510=JSON[_0xe649e6(0x1c9)](_0x2b098b));_0x1c4fd6&&(_0x52c5cd=JSON[_0xe649e6(0x1c9)](_0x1c4fd6));const {tickets:_0x23b3ce,count:_0x479dee,hasMore:_0x422b47}=await(0x0,ListTicketsService_1['default'])({'searchParam':_0x2f37e0,'tags':_0x259964,'users':_0x57f792,'pageNumber':_0xef6eee,'status':_0x54af50,'date':_0x13f427,'dateStart':_0x4360e2,'dateEnd':_0x4ca36e,'updatedAt':_0x2a2c25,'showAll':_0x18db71,'userId':_0xb76319,'queueIds':_0x5eea4e,'withUnreadMessages':_0x29d489,'whatsappIds':_0x17e510,'statusFilters':_0x52c5cd,'companyId':_0x515766});return _0x335ec9[_0xe649e6(0x1ba)](0xc8)[_0xe649e6(0x1d0)]({'tickets':_0x23b3ce,'count':_0x479dee,'hasMore':_0x422b47});};exports[a36_0x1f7d46(0x1b5)]=index;function a36_0x23bd(_0x152271,_0x4ac09f){const _0x37f3c1=a36_0x37f3();return a36_0x23bd=function(_0x23bd34,_0x25b9bb){_0x23bd34=_0x23bd34-0x1af;let _0x1bcca6=_0x37f3c1[_0x23bd34];return _0x1bcca6;},a36_0x23bd(_0x152271,_0x4ac09f);}const kanban=async(_0x15f7dd,_0x295c27)=>{const _0x321d2d=a36_0x1f7d46,{pageNumber:_0x59aa14,status:_0x10f677,date:_0x547f8b,updatedAt:_0x4e0fa6,searchParam:_0x391e98,showAll:_0x33e0a7,queueIds:_0x19a8b7,tags:_0x22cf86,users:_0x28848a,withUnreadMessages:_0x3a0e13}=_0x15f7dd[_0x321d2d(0x1c2)],_0x5d4fa3=_0x15f7dd[_0x321d2d(0x1b4)]['id'],{companyId:_0x4e600f}=_0x15f7dd[_0x321d2d(0x1b4)];let _0x4903f2=[],_0x12fff0=[],_0x125204=[];_0x19a8b7&&(_0x4903f2=JSON[_0x321d2d(0x1c9)](_0x19a8b7));_0x22cf86&&(_0x12fff0=JSON['parse'](_0x22cf86));_0x28848a&&(_0x125204=JSON['parse'](_0x28848a));const {tickets:_0x3087da,count:_0x3d1824,hasMore:_0x159ace}=await(0x0,ListTicketsServiceKanban_1[_0x321d2d(0x1b8)])({'searchParam':_0x391e98,'tags':_0x12fff0,'users':_0x125204,'pageNumber':_0x59aa14,'status':_0x10f677,'date':_0x547f8b,'updatedAt':_0x4e0fa6,'showAll':_0x33e0a7,'userId':_0x5d4fa3,'queueIds':_0x4903f2,'withUnreadMessages':_0x3a0e13,'companyId':_0x4e600f});return _0x295c27[_0x321d2d(0x1ba)](0xc8)[_0x321d2d(0x1d0)]({'tickets':_0x3087da,'count':_0x3d1824,'hasMore':_0x159ace});};exports['kanban']=kanban;const store=async(_0x20e410,_0x51d9a1)=>{const _0x56c012=a36_0x1f7d46,{contactId:_0x270fcf,status:_0xe584a5,userId:_0x5cb3b6,queueId:_0x5dea99,whatsappId:_0x44b11b}=_0x20e410[_0x56c012(0x1d2)],{companyId:_0x4b6162}=_0x20e410['user'],_0xf05367=await(0x0,CreateTicketService_1[_0x56c012(0x1b8)])({'contactId':_0x270fcf,'status':_0xe584a5,'userId':_0x5cb3b6,'companyId':_0x4b6162,'queueId':_0x5dea99,'whatsappId':_0x44b11b}),_0xb41257=(0x0,socket_1[_0x56c012(0x1bb)])();return _0xb41257['to'](_0xf05367[_0x56c012(0x1ba)])['emit'](_0x56c012(0x1c4)+_0x4b6162+_0x56c012(0x1b1),{'action':_0x56c012(0x1cc),'ticket':_0xf05367}),_0x51d9a1['status'](0xc8)['json'](_0xf05367);};exports[a36_0x1f7d46(0x1c5)]=store;const show=async(_0x175cf0,_0x14be3a)=>{const _0x3971be=a36_0x1f7d46,{ticketId:_0xe89ef8}=_0x175cf0['params'],{id:_0x1ab9b5,companyId:_0x1ffaba}=_0x175cf0[_0x3971be(0x1b4)],_0x1e134a=await(0x0,ShowTicketService_1[_0x3971be(0x1b8)])(_0xe89ef8,_0x1ffaba);return await(0x0,CreateLogTicketService_1['default'])({'userId':_0x1ab9b5,'ticketId':_0xe89ef8,'type':_0x3971be(0x1cf)}),_0x14be3a[_0x3971be(0x1ba)](0xc8)[_0x3971be(0x1d0)](_0x1e134a);};exports[a36_0x1f7d46(0x1b9)]=show;const showLog=async(_0x2e65ac,_0x116fbd)=>{const _0x63de15=a36_0x1f7d46,{ticketId:_0x2ca7d4}=_0x2e65ac[_0x63de15(0x1d8)],{id:_0x5ae87e,companyId:_0x481580}=_0x2e65ac[_0x63de15(0x1b4)],_0x155a35=await(0x0,ShowLogTicketService_1[_0x63de15(0x1b8)])({'ticketId':_0x2ca7d4,'companyId':_0x481580});return _0x116fbd[_0x63de15(0x1ba)](0xc8)[_0x63de15(0x1d0)](_0x155a35);};exports[a36_0x1f7d46(0x1c6)]=showLog;const showFromUUID=async(_0x562aaa,_0x5cda27)=>{const _0x1315a6=a36_0x1f7d46,{uuid:_0x1ec4cd}=_0x562aaa[_0x1315a6(0x1d8)],{id:_0x25d0bb,companyId:_0x1b6337}=_0x562aaa[_0x1315a6(0x1b4)],_0x1a70f3=await(0x0,ShowTicketFromUUIDService_1[_0x1315a6(0x1b8)])(_0x1ec4cd,_0x1b6337);return await(0x0,CreateLogTicketService_1[_0x1315a6(0x1b8)])({'userId':_0x25d0bb,'ticketId':_0x1a70f3['id'],'type':_0x1315a6(0x1cf)}),_0x5cda27['status'](0xc8)[_0x1315a6(0x1d0)](_0x1a70f3);};exports[a36_0x1f7d46(0x1da)]=showFromUUID;const update=async(_0x1844e4,_0x3eb749)=>{const _0x15d1d6=a36_0x1f7d46,{ticketId:_0x5e3d46}=_0x1844e4['params'],_0x15dec9=_0x1844e4['body'],{companyId:_0x10d671}=_0x1844e4[_0x15d1d6(0x1b4)],{ticket:_0x2e3bfb}=await(0x0,UpdateTicketService_1[_0x15d1d6(0x1b8)])({'ticketData':_0x15dec9,'ticketId':_0x5e3d46,'companyId':_0x10d671});return _0x3eb749[_0x15d1d6(0x1ba)](0xc8)[_0x15d1d6(0x1d0)](_0x2e3bfb);};exports[a36_0x1f7d46(0x1cc)]=update;const remove=async(_0x4c46dd,_0x10b0b4)=>{const _0x351d90=a36_0x1f7d46,{ticketId:_0x17b498}=_0x4c46dd[_0x351d90(0x1d8)],{id:_0x5b126a,companyId:_0x585e94}=_0x4c46dd['user'];await(0x0,ShowTicketService_1[_0x351d90(0x1b8)])(_0x17b498,_0x585e94);const _0x1273ba=await(0x0,DeleteTicketService_1[_0x351d90(0x1b8)])(_0x17b498,_0x5b126a,_0x585e94),_0x38c2d4=(0x0,socket_1[_0x351d90(0x1bb)])();return _0x38c2d4['to'](_0x1273ba[_0x351d90(0x1ba)])['to'](_0x17b498)['to'](_0x351d90(0x1d6))[_0x351d90(0x1b2)](_0x351d90(0x1c4)+_0x585e94+'-ticket',{'action':_0x351d90(0x1d9),'ticketId':+_0x17b498}),_0x10b0b4[_0x351d90(0x1ba)](0xc8)[_0x351d90(0x1d0)]({'message':_0x351d90(0x1b7)});};exports[a36_0x1f7d46(0x1de)]=remove;const closeAll=async(_0x2ac348,_0x522b8f)=>{const _0x15eb39=a36_0x1f7d46,{companyId:_0x245aa4}=_0x2ac348[_0x15eb39(0x1b4)],{status:_0x40f0b8}=_0x2ac348[_0x15eb39(0x1d2)],_0x59ac23=(0x0,socket_1[_0x15eb39(0x1bb)])(),{rows:_0x2b3fae}=await Ticket_1[_0x15eb39(0x1b8)][_0x15eb39(0x1d4)]({'where':{'companyId':_0x245aa4,'status':_0x40f0b8},'order':[['updatedAt',_0x15eb39(0x1d7)]]});return _0x2b3fae[_0x15eb39(0x1cb)](async _0x3a06e5=>{const _0x2d78a2=_0x15eb39,_0x3a480c={'status':_0x2d78a2(0x1db),'userId':_0x3a06e5[_0x2d78a2(0x1cd)]||null,'queueId':_0x3a06e5[_0x2d78a2(0x1b3)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1[_0x2d78a2(0x1b8)])({'ticketData':_0x3a480c,'ticketId':_0x3a06e5['id'],'companyId':_0x245aa4});}),_0x522b8f[_0x15eb39(0x1ba)](0xc8)[_0x15eb39(0x1d0)]();};exports[a36_0x1f7d46(0x1d5)]=closeAll;