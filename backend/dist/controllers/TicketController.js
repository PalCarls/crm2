'use strict';function a34_0x4dd0(_0x31bee5,_0x4f4199){const _0x25dfee=a34_0x25df();return a34_0x4dd0=function(_0x4dd061,_0x428652){_0x4dd061=_0x4dd061-0xba;let _0x253d8a=_0x25dfee[_0x4dd061];return _0x253d8a;},a34_0x4dd0(_0x31bee5,_0x4f4199);}const a34_0x522edc=a34_0x4dd0;(function(_0x36cf76,_0x1dfc2b){const _0x41c81a=a34_0x4dd0,_0x5e7c76=_0x36cf76();while(!![]){try{const _0x527b89=-parseInt(_0x41c81a(0xcc))/0x1*(-parseInt(_0x41c81a(0xcd))/0x2)+parseInt(_0x41c81a(0xcf))/0x3*(parseInt(_0x41c81a(0xbf))/0x4)+parseInt(_0x41c81a(0xe9))/0x5*(parseInt(_0x41c81a(0xba))/0x6)+-parseInt(_0x41c81a(0xd7))/0x7+parseInt(_0x41c81a(0xc6))/0x8*(parseInt(_0x41c81a(0xee))/0x9)+parseInt(_0x41c81a(0xed))/0xa*(-parseInt(_0x41c81a(0xe4))/0xb)+-parseInt(_0x41c81a(0xbd))/0xc;if(_0x527b89===_0x1dfc2b)break;else _0x5e7c76['push'](_0x5e7c76['shift']());}catch(_0x2d3880){_0x5e7c76['push'](_0x5e7c76['shift']());}}}(a34_0x25df,0x81bcb));var __importDefault=this&&this[a34_0x522edc(0xc2)]||function(_0x229898){const _0x336af4=a34_0x522edc;return _0x229898&&_0x229898[_0x336af4(0xf0)]?_0x229898:{'default':_0x229898};};Object[a34_0x522edc(0xd6)](exports,a34_0x522edc(0xf0),{'value':!![]}),exports['closeAll']=exports[a34_0x522edc(0xc7)]=exports[a34_0x522edc(0xe7)]=exports['showFromUUID']=exports[a34_0x522edc(0xd5)]=exports['store']=exports['kanban']=exports[a34_0x522edc(0xca)]=void 0x0;function a34_0x25df(){const _0x49da82=['1044MWjdzI','queueId','showFromUUID','__importDefault','../services/TicketServices/CreateTicketService','../services/TicketServices/CreateLogTicketService','ticket\x20deleted','80WZadXN','remove','closed','../services/TicketServices/DeleteTicketService','index','body','32HkUvnI','10040hizTZp','../services/TicketServices/ShowTicketFromUUIDService','7011GYhOhB','companyId','default','params','delete','status','show','defineProperty','7347487SSbbWI','kanban','findAndCountAll','../services/TicketServices/ListTicketsServiceKanban','forEach','access','DESC','closeAll','json','company-','../services/TicketServices/UpdateTicketService','store','../models/Ticket','110mxYhrR','userId','parse','update','user','70EZywBg','../services/TicketServices/ListTicketsService','query','updatedAt','345010maiHyq','651069jYfYjb','emit','__esModule','293298YOHGXz','getIO','../libs/socket','3027780voUFHV','-ticket'];a34_0x25df=function(){return _0x49da82;};return a34_0x25df();}const socket_1=require(a34_0x522edc(0xbc)),Ticket_1=__importDefault(require(a34_0x522edc(0xe3))),CreateTicketService_1=__importDefault(require(a34_0x522edc(0xc3))),DeleteTicketService_1=__importDefault(require(a34_0x522edc(0xc9))),ListTicketsService_1=__importDefault(require(a34_0x522edc(0xea))),ShowTicketFromUUIDService_1=__importDefault(require(a34_0x522edc(0xce))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require(a34_0x522edc(0xe1))),ListTicketsServiceKanban_1=__importDefault(require(a34_0x522edc(0xda))),CreateLogTicketService_1=__importDefault(require(a34_0x522edc(0xc4))),index=async(_0xc8b570,_0x541c03)=>{const _0x508500=a34_0x522edc,{pageNumber:_0x453ec7,status:_0x4aa250,date:_0x32cf5b,dateStart:_0x2e4cfe,dateEnd:_0x57f89d,updatedAt:_0x13d1a9,searchParam:_0x28d187,showAll:_0x159d59,queueIds:_0x2874ff,tags:_0x1fdda4,users:_0x39ab90,withUnreadMessages:_0x5190f5,whatsapps:_0x578ffd,statusFilter:_0x51df61}=_0xc8b570[_0x508500(0xeb)],_0x363e23=_0xc8b570[_0x508500(0xe8)]['id'],{companyId:_0x2f2bcc}=_0xc8b570[_0x508500(0xe8)];let _0x411885=[],_0x373b3f=[],_0x1bac6f=[],_0x155f83=[],_0x12329f=[];_0x2874ff&&(_0x411885=JSON[_0x508500(0xe6)](_0x2874ff));_0x1fdda4&&(_0x373b3f=JSON['parse'](_0x1fdda4));_0x39ab90&&(_0x1bac6f=JSON[_0x508500(0xe6)](_0x39ab90));_0x578ffd&&(_0x155f83=JSON[_0x508500(0xe6)](_0x578ffd));_0x51df61&&(_0x12329f=JSON[_0x508500(0xe6)](_0x51df61));const {tickets:_0x5c0faf,count:_0x39c548,hasMore:_0x59d53a}=await(0x0,ListTicketsService_1[_0x508500(0xd1)])({'searchParam':_0x28d187,'tags':_0x373b3f,'users':_0x1bac6f,'pageNumber':_0x453ec7,'status':_0x4aa250,'date':_0x32cf5b,'dateStart':_0x2e4cfe,'dateEnd':_0x57f89d,'updatedAt':_0x13d1a9,'showAll':_0x159d59,'userId':_0x363e23,'queueIds':_0x411885,'withUnreadMessages':_0x5190f5,'whatsappIds':_0x155f83,'statusFilters':_0x12329f,'companyId':_0x2f2bcc});return _0x541c03['status'](0xc8)[_0x508500(0xdf)]({'tickets':_0x5c0faf,'count':_0x39c548,'hasMore':_0x59d53a});};exports[a34_0x522edc(0xca)]=index;const kanban=async(_0x36fc0f,_0x2418ff)=>{const _0xa4ff95=a34_0x522edc,{pageNumber:_0x5e8598,status:_0xca71e3,date:_0x42d39a,updatedAt:_0x2b029d,searchParam:_0x3630a0,showAll:_0xdab347,queueIds:_0x5a394a,tags:_0x1e2a4a,users:_0x1098dd,withUnreadMessages:_0x320cb2}=_0x36fc0f[_0xa4ff95(0xeb)],_0x3d2873=_0x36fc0f['user']['id'],{companyId:_0x1fd5ed}=_0x36fc0f['user'];let _0xdcd6ff=[],_0x34b603=[],_0x5f003c=[];_0x5a394a&&(_0xdcd6ff=JSON[_0xa4ff95(0xe6)](_0x5a394a));_0x1e2a4a&&(_0x34b603=JSON[_0xa4ff95(0xe6)](_0x1e2a4a));_0x1098dd&&(_0x5f003c=JSON['parse'](_0x1098dd));const {tickets:_0x401a0f,count:_0x246b5f,hasMore:_0x4624de}=await(0x0,ListTicketsServiceKanban_1[_0xa4ff95(0xd1)])({'searchParam':_0x3630a0,'tags':_0x34b603,'users':_0x5f003c,'pageNumber':_0x5e8598,'status':_0xca71e3,'date':_0x42d39a,'updatedAt':_0x2b029d,'showAll':_0xdab347,'userId':_0x3d2873,'queueIds':_0xdcd6ff,'withUnreadMessages':_0x320cb2,'companyId':_0x1fd5ed});return _0x2418ff[_0xa4ff95(0xd4)](0xc8)[_0xa4ff95(0xdf)]({'tickets':_0x401a0f,'count':_0x246b5f,'hasMore':_0x4624de});};exports[a34_0x522edc(0xd8)]=kanban;const store=async(_0x1c5d9c,_0x300e8b)=>{const _0x38a5cd=a34_0x522edc,{contactId:_0xf4996d,status:_0x45d751,userId:_0x5046d0,queueId:_0x212269,whatsappId:_0x4caab4}=_0x1c5d9c[_0x38a5cd(0xcb)],{companyId:_0x2037dd}=_0x1c5d9c[_0x38a5cd(0xe8)],_0x20f54e=await(0x0,CreateTicketService_1[_0x38a5cd(0xd1)])({'contactId':_0xf4996d,'status':_0x45d751,'userId':_0x5046d0,'companyId':_0x2037dd,'queueId':_0x212269,'whatsappId':_0x4caab4}),_0x8f273e=(0x0,socket_1['getIO'])();return _0x8f273e['to'](_0x20f54e['status'])[_0x38a5cd(0xef)](_0x38a5cd(0xe0)+_0x2037dd+'-ticket',{'action':'update','ticket':_0x20f54e}),_0x300e8b[_0x38a5cd(0xd4)](0xc8)[_0x38a5cd(0xdf)](_0x20f54e);};exports[a34_0x522edc(0xe2)]=store;const show=async(_0x55bd04,_0x53b1ee)=>{const _0x1133be=a34_0x522edc,{ticketId:_0x3dca8b}=_0x55bd04[_0x1133be(0xd2)],{id:_0x1c331e,companyId:_0x22b3a1}=_0x55bd04[_0x1133be(0xe8)],_0x45a44f=await(0x0,ShowTicketService_1[_0x1133be(0xd1)])(_0x3dca8b,_0x22b3a1);return await(0x0,CreateLogTicketService_1[_0x1133be(0xd1)])({'userId':_0x1c331e,'ticketId':_0x3dca8b,'type':'access'}),_0x53b1ee[_0x1133be(0xd4)](0xc8)[_0x1133be(0xdf)](_0x45a44f);};exports[a34_0x522edc(0xd5)]=show;const showFromUUID=async(_0xe4d20b,_0x19d680)=>{const _0x43bf29=a34_0x522edc,{uuid:_0x286d4a}=_0xe4d20b[_0x43bf29(0xd2)],{id:_0x25fa0f,companyId:_0xff5e2a}=_0xe4d20b[_0x43bf29(0xe8)],_0xc55c1b=await(0x0,ShowTicketFromUUIDService_1[_0x43bf29(0xd1)])(_0x286d4a,_0xff5e2a);return await(0x0,CreateLogTicketService_1[_0x43bf29(0xd1)])({'userId':_0x25fa0f,'ticketId':_0xc55c1b['id'],'type':_0x43bf29(0xdc)}),_0x19d680[_0x43bf29(0xd4)](0xc8)[_0x43bf29(0xdf)](_0xc55c1b);};exports[a34_0x522edc(0xc1)]=showFromUUID;const update=async(_0x18b266,_0x12aaed)=>{const _0x1b5fe1=a34_0x522edc,{ticketId:_0x32c53b}=_0x18b266[_0x1b5fe1(0xd2)],_0x365a22=_0x18b266[_0x1b5fe1(0xcb)],{companyId:_0x359604}=_0x18b266[_0x1b5fe1(0xe8)],{ticket:_0x39e896}=await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x365a22,'ticketId':_0x32c53b,'companyId':_0x359604});return _0x12aaed[_0x1b5fe1(0xd4)](0xc8)[_0x1b5fe1(0xdf)](_0x39e896);};exports[a34_0x522edc(0xe7)]=update;const remove=async(_0x7daec0,_0x3fb45e)=>{const _0x17f49a=a34_0x522edc,{ticketId:_0x36cf4a}=_0x7daec0[_0x17f49a(0xd2)],{id:_0x11ee83,companyId:_0x4d5822}=_0x7daec0['user'];await(0x0,ShowTicketService_1[_0x17f49a(0xd1)])(_0x36cf4a,_0x4d5822);const _0x41d440=await(0x0,DeleteTicketService_1[_0x17f49a(0xd1)])(_0x36cf4a,_0x11ee83,_0x4d5822),_0x22be1b=(0x0,socket_1[_0x17f49a(0xbb)])();return _0x22be1b['to'](_0x41d440['status'])['to'](_0x36cf4a)['to']('notification')[_0x17f49a(0xef)](_0x17f49a(0xe0)+_0x4d5822+_0x17f49a(0xbe),{'action':_0x17f49a(0xd3),'ticketId':+_0x36cf4a}),_0x3fb45e[_0x17f49a(0xd4)](0xc8)['json']({'message':_0x17f49a(0xc5)});};exports[a34_0x522edc(0xc7)]=remove;const closeAll=async(_0x3b0d8d,_0x24902f)=>{const _0x20f1bb=a34_0x522edc,{companyId:_0x37eb15}=_0x3b0d8d[_0x20f1bb(0xe8)],{status:_0xf05f8e}=_0x3b0d8d['body'],_0xd754ed=(0x0,socket_1[_0x20f1bb(0xbb)])(),{rows:_0x3d4faa}=await Ticket_1[_0x20f1bb(0xd1)][_0x20f1bb(0xd9)]({'where':{'companyId':_0x37eb15,'status':_0xf05f8e,'isGroup':![]},'order':[[_0x20f1bb(0xec),_0x20f1bb(0xdd)]]});return _0x3d4faa[_0x20f1bb(0xdb)](async _0x54c881=>{const _0x27dcd6=_0x20f1bb;await _0x54c881[_0x27dcd6(0xe7)]({'status':'closed','userId':_0x54c881[_0x27dcd6(0xe5)]||0x1,'queueId':_0x54c881[_0x27dcd6(0xc0)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0}),await(0x0,CreateLogTicketService_1[_0x27dcd6(0xd1)])({'userId':_0x54c881[_0x27dcd6(0xe5)],'queueId':_0x54c881[_0x27dcd6(0xc0)],'ticketId':_0x54c881['id'],'type':_0x27dcd6(0xc8)}),_0xd754ed['to'](_0xf05f8e)['to'](_0x54c881['id']['toString']())['emit'](_0x27dcd6(0xe0)+_0x54c881[_0x27dcd6(0xd0)]+_0x27dcd6(0xbe),{'action':_0x27dcd6(0xd3),'ticketId':_0x54c881['id']});}),_0x24902f[_0x20f1bb(0xd4)](0xc8)['json']();};exports[a34_0x522edc(0xde)]=closeAll;