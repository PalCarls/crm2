'use strict';const a34_0x42def7=a34_0xd037;(function(_0x5b152d,_0x3ddbf1){const _0x70026a=a34_0xd037,_0x188070=_0x5b152d();while(!![]){try{const _0x4ada7a=parseInt(_0x70026a(0xe9))/0x1*(parseInt(_0x70026a(0xde))/0x2)+-parseInt(_0x70026a(0xc1))/0x3+-parseInt(_0x70026a(0xc9))/0x4+parseInt(_0x70026a(0xd6))/0x5*(-parseInt(_0x70026a(0xc3))/0x6)+parseInt(_0x70026a(0xca))/0x7+parseInt(_0x70026a(0xe8))/0x8*(-parseInt(_0x70026a(0xcd))/0x9)+parseInt(_0x70026a(0xf1))/0xa*(parseInt(_0x70026a(0xe5))/0xb);if(_0x4ada7a===_0x3ddbf1)break;else _0x188070['push'](_0x188070['shift']());}catch(_0x4bf333){_0x188070['push'](_0x188070['shift']());}}}(a34_0x25d6,0xeb76c));var __importDefault=this&&this[a34_0x42def7(0xea)]||function(_0x57ffc9){const _0x47f562=a34_0x42def7;return _0x57ffc9&&_0x57ffc9[_0x47f562(0xbf)]?_0x57ffc9:{'default':_0x57ffc9};};Object[a34_0x42def7(0xe2)](exports,a34_0x42def7(0xbf),{'value':!![]}),exports[a34_0x42def7(0xee)]=exports[a34_0x42def7(0xda)]=exports[a34_0x42def7(0xe6)]=exports[a34_0x42def7(0xed)]=exports[a34_0x42def7(0xd4)]=exports[a34_0x42def7(0xcc)]=exports[a34_0x42def7(0xf0)]=exports[a34_0x42def7(0xe0)]=void 0x0;const socket_1=require(a34_0x42def7(0xef)),Ticket_1=__importDefault(require('../models/Ticket')),CreateTicketService_1=__importDefault(require(a34_0x42def7(0xe7))),DeleteTicketService_1=__importDefault(require(a34_0x42def7(0xf2))),ListTicketsService_1=__importDefault(require('../services/TicketServices/ListTicketsService')),ShowTicketFromUUIDService_1=__importDefault(require(a34_0x42def7(0xeb))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require('../services/TicketServices/UpdateTicketService')),ListTicketsServiceKanban_1=__importDefault(require(a34_0x42def7(0xc7))),CreateLogTicketService_1=__importDefault(require(a34_0x42def7(0xd2))),index=async(_0x284f4e,_0x5d6ef3)=>{const _0x35c46f=a34_0x42def7,{pageNumber:_0x3b9922,status:_0x2b4b15,date:_0x1216bf,dateStart:_0x2f3d64,dateEnd:_0x1395c2,updatedAt:_0x20e539,searchParam:_0x587913,showAll:_0xd2628b,queueIds:_0xfccdd2,tags:_0x451fc3,users:_0x24dd22,withUnreadMessages:_0x6fcdd4,whatsapps:_0x9ff8d8,statusFilter:_0x54e61f}=_0x284f4e['query'],_0x3b8a98=_0x284f4e['user']['id'],{companyId:_0x5acacb}=_0x284f4e[_0x35c46f(0xc5)];let _0x1e571f=[],_0x1678ab=[],_0x7aa167=[],_0x502db0=[],_0x423a65=[];_0xfccdd2&&(_0x1e571f=JSON[_0x35c46f(0xc6)](_0xfccdd2));_0x451fc3&&(_0x1678ab=JSON[_0x35c46f(0xc6)](_0x451fc3));_0x24dd22&&(_0x7aa167=JSON[_0x35c46f(0xc6)](_0x24dd22));_0x9ff8d8&&(_0x502db0=JSON[_0x35c46f(0xc6)](_0x9ff8d8));_0x54e61f&&(_0x423a65=JSON[_0x35c46f(0xc6)](_0x54e61f));const {tickets:_0x37f774,count:_0x17e565,hasMore:_0x4c00a3}=await(0x0,ListTicketsService_1[_0x35c46f(0xc2)])({'searchParam':_0x587913,'tags':_0x1678ab,'users':_0x7aa167,'pageNumber':_0x3b9922,'status':_0x2b4b15,'date':_0x1216bf,'dateStart':_0x2f3d64,'dateEnd':_0x1395c2,'updatedAt':_0x20e539,'showAll':_0xd2628b,'userId':_0x3b8a98,'queueIds':_0x1e571f,'withUnreadMessages':_0x6fcdd4,'whatsappIds':_0x502db0,'statusFilters':_0x423a65,'companyId':_0x5acacb});return _0x5d6ef3[_0x35c46f(0xdb)](0xc8)[_0x35c46f(0xbe)]({'tickets':_0x37f774,'count':_0x17e565,'hasMore':_0x4c00a3});};exports[a34_0x42def7(0xe0)]=index;const kanban=async(_0x45d6be,_0x2df72d)=>{const _0x47a0ae=a34_0x42def7,{pageNumber:_0x324cba,status:_0x204ed8,date:_0x46b31d,updatedAt:_0x327446,searchParam:_0x5c76c6,showAll:_0x51d2f1,queueIds:_0x3e3a03,tags:_0x2bb90e,users:_0x337ec2,withUnreadMessages:_0x505f3e}=_0x45d6be[_0x47a0ae(0xc0)],_0x2913a7=_0x45d6be[_0x47a0ae(0xc5)]['id'],{companyId:_0x1c13d1}=_0x45d6be[_0x47a0ae(0xc5)];let _0x23153d=[],_0x24a3e5=[],_0x442add=[];_0x3e3a03&&(_0x23153d=JSON[_0x47a0ae(0xc6)](_0x3e3a03));_0x2bb90e&&(_0x24a3e5=JSON[_0x47a0ae(0xc6)](_0x2bb90e));_0x337ec2&&(_0x442add=JSON['parse'](_0x337ec2));const {tickets:_0x171d4c,count:_0xe19195,hasMore:_0x843e6b}=await(0x0,ListTicketsServiceKanban_1[_0x47a0ae(0xc2)])({'searchParam':_0x5c76c6,'tags':_0x24a3e5,'users':_0x442add,'pageNumber':_0x324cba,'status':_0x204ed8,'date':_0x46b31d,'updatedAt':_0x327446,'showAll':_0x51d2f1,'userId':_0x2913a7,'queueIds':_0x23153d,'withUnreadMessages':_0x505f3e,'companyId':_0x1c13d1});return _0x2df72d['status'](0xc8)['json']({'tickets':_0x171d4c,'count':_0xe19195,'hasMore':_0x843e6b});};exports[a34_0x42def7(0xf0)]=kanban;const store=async(_0x48c624,_0x518283)=>{const _0x5205bc=a34_0x42def7,{contactId:_0x50a8ef,status:_0x11e93e,userId:_0x8a2cd,queueId:_0x2fcb97,whatsappId:_0xade5dd}=_0x48c624[_0x5205bc(0xc4)],{companyId:_0x2a6659}=_0x48c624[_0x5205bc(0xc5)],_0x3807e1=await(0x0,CreateTicketService_1[_0x5205bc(0xc2)])({'contactId':_0x50a8ef,'status':_0x11e93e,'userId':_0x8a2cd,'companyId':_0x2a6659,'queueId':_0x2fcb97,'whatsappId':_0xade5dd}),_0x5988c3=(0x0,socket_1['getIO'])();return _0x5988c3['to'](_0x3807e1['status'])['emit'](_0x5205bc(0xd0)+_0x2a6659+_0x5205bc(0xec),{'action':_0x5205bc(0xe6),'ticket':_0x3807e1}),_0x518283['status'](0xc8)[_0x5205bc(0xbe)](_0x3807e1);};exports[a34_0x42def7(0xcc)]=store;const show=async(_0x33d188,_0x3822ee)=>{const _0x2d10bb=a34_0x42def7,{ticketId:_0x95f8f5}=_0x33d188[_0x2d10bb(0xc8)],{id:_0x52a1d6,companyId:_0x394fe2}=_0x33d188[_0x2d10bb(0xc5)],_0x58c85b=await(0x0,ShowTicketService_1[_0x2d10bb(0xc2)])(_0x95f8f5,_0x394fe2);return await(0x0,CreateLogTicketService_1[_0x2d10bb(0xc2)])({'userId':_0x52a1d6,'ticketId':_0x95f8f5,'type':'access'}),_0x3822ee[_0x2d10bb(0xdb)](0xc8)[_0x2d10bb(0xbe)](_0x58c85b);};exports[a34_0x42def7(0xd4)]=show;const showFromUUID=async(_0x3c2be8,_0x331fa5)=>{const _0x496746=a34_0x42def7,{uuid:_0x2c263e}=_0x3c2be8[_0x496746(0xc8)],{id:_0x469956,companyId:_0x326569}=_0x3c2be8['user'],_0x218056=await(0x0,ShowTicketFromUUIDService_1['default'])(_0x2c263e,_0x326569);return await(0x0,CreateLogTicketService_1['default'])({'userId':_0x469956,'ticketId':_0x218056['id'],'type':_0x496746(0xd3)}),_0x331fa5['status'](0xc8)['json'](_0x218056);};exports[a34_0x42def7(0xed)]=showFromUUID;function a34_0x25d6(){const _0x24cb01=['remove','status','closed','notification','6TlYQQx','getIO','index','companyId','defineProperty','ticket\x20deleted','findAndCountAll','2198614DXIwpz','update','../services/TicketServices/CreateTicketService','422408mkFaSg','55241NdCjZr','__importDefault','../services/TicketServices/ShowTicketFromUUIDService','-ticket','showFromUUID','closeAll','../libs/socket','kanban','270pumqPY','../services/TicketServices/DeleteTicketService','json','__esModule','query','3605175HLneqs','default','5954682stUfjr','body','user','parse','../services/TicketServices/ListTicketsServiceKanban','params','6929844qPYYHE','6020007XXbudC','emit','store','261qYegSP','userId','toString','company-','forEach','../services/TicketServices/CreateLogTicketService','access','show','queueId','5XKpXiw','delete','DESC','updatedAt'];a34_0x25d6=function(){return _0x24cb01;};return a34_0x25d6();}const update=async(_0x1719cb,_0x399e51)=>{const _0x1e2ca5=a34_0x42def7,{ticketId:_0x2ebbe2}=_0x1719cb['params'],_0x590a99=_0x1719cb['body'],{companyId:_0x20371d}=_0x1719cb[_0x1e2ca5(0xc5)],{ticket:_0x297de3}=await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x590a99,'ticketId':_0x2ebbe2,'companyId':_0x20371d});return _0x399e51[_0x1e2ca5(0xdb)](0xc8)['json'](_0x297de3);};exports[a34_0x42def7(0xe6)]=update;const remove=async(_0x7cdade,_0x8550dc)=>{const _0x36f3c4=a34_0x42def7,{ticketId:_0x1a8930}=_0x7cdade['params'],{id:_0x3ff12f,companyId:_0x2edd05}=_0x7cdade[_0x36f3c4(0xc5)];await(0x0,ShowTicketService_1[_0x36f3c4(0xc2)])(_0x1a8930,_0x2edd05);const _0x7d7ef=await(0x0,DeleteTicketService_1[_0x36f3c4(0xc2)])(_0x1a8930,_0x3ff12f,_0x2edd05),_0x437455=(0x0,socket_1[_0x36f3c4(0xdf)])();return _0x437455['to'](_0x7d7ef['status'])['to'](_0x1a8930)['to'](_0x36f3c4(0xdd))[_0x36f3c4(0xcb)]('company-'+_0x2edd05+'-ticket',{'action':_0x36f3c4(0xd7),'ticketId':+_0x1a8930}),_0x8550dc[_0x36f3c4(0xdb)](0xc8)[_0x36f3c4(0xbe)]({'message':_0x36f3c4(0xe3)});};function a34_0xd037(_0xd7acf2,_0x4747ed){const _0x25d6da=a34_0x25d6();return a34_0xd037=function(_0xd03717,_0x52b19c){_0xd03717=_0xd03717-0xbe;let _0x25ea03=_0x25d6da[_0xd03717];return _0x25ea03;},a34_0xd037(_0xd7acf2,_0x4747ed);}exports[a34_0x42def7(0xda)]=remove;const closeAll=async(_0x10927b,_0x21f618)=>{const _0x2cd1c1=a34_0x42def7,{companyId:_0xb7ef10}=_0x10927b[_0x2cd1c1(0xc5)],{status:_0x1c7e4f}=_0x10927b[_0x2cd1c1(0xc4)],_0x3b1121=(0x0,socket_1[_0x2cd1c1(0xdf)])(),{rows:_0x34ea68}=await Ticket_1[_0x2cd1c1(0xc2)][_0x2cd1c1(0xe4)]({'where':{'companyId':_0xb7ef10,'status':_0x1c7e4f,'isGroup':![]},'order':[[_0x2cd1c1(0xd9),_0x2cd1c1(0xd8)]]});return _0x34ea68[_0x2cd1c1(0xd1)](async _0x293d90=>{const _0x27856b=_0x2cd1c1;await _0x293d90[_0x27856b(0xe6)]({'status':_0x27856b(0xdc),'userId':_0x293d90[_0x27856b(0xce)]||0x1,'queueId':_0x293d90[_0x27856b(0xd5)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0}),await(0x0,CreateLogTicketService_1['default'])({'userId':_0x293d90['userId'],'queueId':_0x293d90[_0x27856b(0xd5)],'ticketId':_0x293d90['id'],'type':_0x27856b(0xdc)}),_0x3b1121['to'](_0x1c7e4f)['to'](_0x293d90['id'][_0x27856b(0xcf)]())['emit'](_0x27856b(0xd0)+_0x293d90[_0x27856b(0xe1)]+_0x27856b(0xec),{'action':_0x27856b(0xd7),'ticketId':_0x293d90['id']});}),_0x21f618[_0x2cd1c1(0xdb)](0xc8)['json']();};exports[a34_0x42def7(0xee)]=closeAll;