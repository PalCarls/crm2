'use strict';const a11_0x33b35b=a11_0x1b37;(function(_0xfca900,_0x11aff2){const _0x4df6e=a11_0x1b37,_0x18642a=_0xfca900();while(!![]){try{const _0x2961e3=parseInt(_0x4df6e(0xf7))/0x1*(parseInt(_0x4df6e(0xe2))/0x2)+-parseInt(_0x4df6e(0x109))/0x3*(parseInt(_0x4df6e(0xdf))/0x4)+parseInt(_0x4df6e(0xe3))/0x5+parseInt(_0x4df6e(0x105))/0x6+-parseInt(_0x4df6e(0xe1))/0x7*(-parseInt(_0x4df6e(0x103))/0x8)+-parseInt(_0x4df6e(0x10d))/0x9+parseInt(_0x4df6e(0x102))/0xa*(-parseInt(_0x4df6e(0xeb))/0xb);if(_0x2961e3===_0x11aff2)break;else _0x18642a['push'](_0x18642a['shift']());}catch(_0x5298bd){_0x18642a['push'](_0x18642a['shift']());}}}(a11_0x4882,0x210d7));var __importDefault=this&&this[a11_0x33b35b(0xee)]||function(_0x5ecc90){const _0x39b5f3=a11_0x33b35b;return _0x5ecc90&&_0x5ecc90[_0x39b5f3(0x108)]?_0x5ecc90:{'default':_0x5ecc90};};Object[a11_0x33b35b(0xf3)](exports,a11_0x33b35b(0x108),{'value':!![]}),exports[a11_0x33b35b(0xe4)]=exports[a11_0x33b35b(0xf2)]=exports['saveMessage']=exports[a11_0x33b35b(0xf0)]=exports[a11_0x33b35b(0xed)]=exports['update']=exports[a11_0x33b35b(0xec)]=exports[a11_0x33b35b(0xe9)]=void 0x0;const socket_1=require(a11_0x33b35b(0x104)),CreateService_1=__importDefault(require(a11_0x33b35b(0x10a))),ListService_1=__importDefault(require(a11_0x33b35b(0xfb))),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require('../services/ChatService/FindMessages')),UpdateService_1=__importDefault(require(a11_0x33b35b(0xf6))),Chat_1=__importDefault(require(a11_0x33b35b(0x101))),CreateMessageService_1=__importDefault(require(a11_0x33b35b(0x107))),User_1=__importDefault(require('../models/User')),ChatUser_1=__importDefault(require('../models/ChatUser')),index=async(_0x3640df,_0x289692)=>{const _0x1d578f=a11_0x33b35b,{pageNumber:_0x4d59fc}=_0x3640df[_0x1d578f(0x100)],_0x36527a=+_0x3640df[_0x1d578f(0xfc)]['id'],{records:_0x269765,count:_0x2441a6,hasMore:_0x187af4}=await(0x0,ListService_1[_0x1d578f(0xef)])({'ownerId':_0x36527a,'pageNumber':_0x4d59fc});return _0x289692[_0x1d578f(0xf9)]({'records':_0x269765,'count':_0x2441a6,'hasMore':_0x187af4});};exports[a11_0x33b35b(0xe9)]=index;const store=async(_0x450f17,_0x1c9e40)=>{const _0x317b7f=a11_0x33b35b,{companyId:_0x1217ce}=_0x450f17['user'],_0x6a4161=+_0x450f17[_0x317b7f(0xfc)]['id'],_0xb7bd9d=_0x450f17[_0x317b7f(0xfe)],_0x3b2eb0=await(0x0,CreateService_1['default'])({..._0xb7bd9d,'ownerId':_0x6a4161,'companyId':_0x1217ce}),_0x53e399=(0x0,socket_1[_0x317b7f(0xe6)])();return _0x3b2eb0[_0x317b7f(0xea)][_0x317b7f(0xe7)](_0xdddf3=>{const _0x17d01d=_0x317b7f;_0x53e399[_0x17d01d(0xfd)](_0x17d01d(0xe0)+_0x1217ce+_0x17d01d(0xf5)+_0xdddf3[_0x17d01d(0x106)],{'action':_0x17d01d(0xde),'record':_0x3b2eb0});}),_0x1c9e40[_0x317b7f(0xf4)](0xc8)[_0x317b7f(0xf9)](_0x3b2eb0);};exports[a11_0x33b35b(0xec)]=store;function a11_0x4882(){const _0x45475d=['update','2135493uNRAlr','owner','create','48wTUgTj','company-','7fQWkzr','11344sHmtdk','539015ymHrQD','messages','Chat\x20deleted','getIO','forEach','findByPk','index','users','1616483JPhvCM','store','show','__importDefault','default','remove','findOne','checkAsRead','defineProperty','status','-chat-user-','../services/ChatService/UpdateService','36MXCvEs','-chat-','json','new-message','../services/ChatService/ListService','user','emit','body','-chat','query','../models/Chat','10jqZRYE','832064emjsXj','../libs/socket','1402500YgZddf','userId','../services/ChatService/CreateMessageService','__esModule','32535YguhmR','../services/ChatService/CreateService','params'];a11_0x4882=function(){return _0x45475d;};return a11_0x4882();}const update=async(_0x4114b0,_0x339508)=>{const _0x22ef83=a11_0x33b35b,{companyId:_0x1063c7}=_0x4114b0[_0x22ef83(0xfc)],_0x45b5ce=_0x4114b0[_0x22ef83(0xfe)],{id:_0x3fb105}=_0x4114b0[_0x22ef83(0x10b)],_0x21f5bb=await(0x0,UpdateService_1[_0x22ef83(0xef)])({..._0x45b5ce,'id':+_0x3fb105}),_0x36744e=(0x0,socket_1[_0x22ef83(0xe6)])();return _0x21f5bb[_0x22ef83(0xea)]['forEach'](_0xf71cdd=>{const _0x19c528=_0x22ef83;_0x36744e['emit'](_0x19c528(0xe0)+_0x1063c7+_0x19c528(0xf5)+_0xf71cdd['userId'],{'action':'update','record':_0x21f5bb});}),_0x339508['status'](0xc8)['json'](_0x21f5bb);};exports[a11_0x33b35b(0x10c)]=update;const show=async(_0x3b07d5,_0x442afb)=>{const _0x20acd5=a11_0x33b35b,{id:_0x183f9f}=_0x3b07d5[_0x20acd5(0x10b)],_0x283232=await(0x0,ShowFromUuidService_1[_0x20acd5(0xef)])(_0x183f9f);return _0x442afb[_0x20acd5(0xf4)](0xc8)[_0x20acd5(0xf9)](_0x283232);};exports['show']=show;const remove=async(_0x18cb29,_0x36983b)=>{const _0x207aec=a11_0x33b35b,{id:_0x3bbc22}=_0x18cb29[_0x207aec(0x10b)],{companyId:_0xf32ce9}=_0x18cb29['user'];await(0x0,DeleteService_1[_0x207aec(0xef)])(_0x3bbc22);const _0xcda73c=(0x0,socket_1[_0x207aec(0xe6)])();return _0xcda73c[_0x207aec(0xfd)](_0x207aec(0xe0)+_0xf32ce9+'-chat',{'action':'delete','id':_0x3bbc22}),_0x36983b[_0x207aec(0xf4)](0xc8)[_0x207aec(0xf9)]({'message':_0x207aec(0xe5)});};exports['remove']=remove;const saveMessage=async(_0x49edb6,_0x53d4f0)=>{const _0x3a197c=a11_0x33b35b,{companyId:_0x2f7781}=_0x49edb6['user'],{message:_0x4fce0c}=_0x49edb6[_0x3a197c(0xfe)],{id:_0xc01a83}=_0x49edb6[_0x3a197c(0x10b)],_0x93b371=+_0x49edb6[_0x3a197c(0xfc)]['id'],_0x2d5452=+_0xc01a83,_0x236e24=await(0x0,CreateMessageService_1['default'])({'chatId':_0x2d5452,'senderId':_0x93b371,'message':_0x4fce0c}),_0x2dd3d6=await Chat_1[_0x3a197c(0xef)][_0x3a197c(0xe8)](_0x2d5452,{'include':[{'model':User_1[_0x3a197c(0xef)],'as':'owner'},{'model':ChatUser_1[_0x3a197c(0xef)],'as':_0x3a197c(0xea)}]}),_0x4bb56c=(0x0,socket_1[_0x3a197c(0xe6)])();return _0x4bb56c['emit'](_0x3a197c(0xe0)+_0x2f7781+_0x3a197c(0xf8)+_0x2d5452,{'action':_0x3a197c(0xfa),'newMessage':_0x236e24,'chat':_0x2dd3d6}),_0x4bb56c[_0x3a197c(0xfd)](_0x3a197c(0xe0)+_0x2f7781+_0x3a197c(0xff),{'action':_0x3a197c(0xfa),'newMessage':_0x236e24,'chat':_0x2dd3d6}),_0x53d4f0['json'](_0x236e24);};exports['saveMessage']=saveMessage;const checkAsRead=async(_0x246727,_0x1fc89f)=>{const _0x5dafc0=a11_0x33b35b,{companyId:_0x4356ef}=_0x246727['user'],{userId:_0x299608}=_0x246727['body'],{id:_0x29a265}=_0x246727[_0x5dafc0(0x10b)],_0x4967d2=await ChatUser_1[_0x5dafc0(0xef)][_0x5dafc0(0xf1)]({'where':{'chatId':_0x29a265,'userId':_0x299608}});await _0x4967d2[_0x5dafc0(0x10c)]({'unreads':0x0});const _0x4a2137=await Chat_1[_0x5dafc0(0xef)][_0x5dafc0(0xe8)](_0x29a265,{'include':[{'model':User_1[_0x5dafc0(0xef)],'as':_0x5dafc0(0xdd)},{'model':ChatUser_1[_0x5dafc0(0xef)],'as':_0x5dafc0(0xea)}]}),_0x1aa87b=(0x0,socket_1[_0x5dafc0(0xe6)])();return _0x1aa87b[_0x5dafc0(0xfd)](_0x5dafc0(0xe0)+_0x4356ef+_0x5dafc0(0xf8)+_0x29a265,{'action':_0x5dafc0(0x10c),'chat':_0x4a2137}),_0x1aa87b[_0x5dafc0(0xfd)](_0x5dafc0(0xe0)+_0x4356ef+_0x5dafc0(0xff),{'action':_0x5dafc0(0x10c),'chat':_0x4a2137}),_0x1fc89f[_0x5dafc0(0xf9)](_0x4a2137);};function a11_0x1b37(_0x3fb2c9,_0x5445dd){const _0x4882ec=a11_0x4882();return a11_0x1b37=function(_0x1b373e,_0xc22aa1){_0x1b373e=_0x1b373e-0xdd;let _0x249dd6=_0x4882ec[_0x1b373e];return _0x249dd6;},a11_0x1b37(_0x3fb2c9,_0x5445dd);}exports[a11_0x33b35b(0xf2)]=checkAsRead;const messages=async(_0x1175e9,_0x44fe6c)=>{const _0x56bc5b=a11_0x33b35b,{pageNumber:_0x642b0a}=_0x1175e9['query'],{id:_0x385beb}=_0x1175e9['params'],_0x1de838=+_0x1175e9[_0x56bc5b(0xfc)]['id'],{records:_0x489c0f,count:_0x44647d,hasMore:_0x51e56f}=await(0x0,FindMessages_1['default'])({'chatId':_0x385beb,'ownerId':_0x1de838,'pageNumber':_0x642b0a});return _0x44fe6c[_0x56bc5b(0xf9)]({'records':_0x489c0f,'count':_0x44647d,'hasMore':_0x51e56f});};exports[a11_0x33b35b(0xe4)]=messages;