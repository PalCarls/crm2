'use strict';const a11_0x23e550=a11_0x139a;(function(_0x3a7fb2,_0x346fff){const _0xcd3d8a=a11_0x139a,_0x26a782=_0x3a7fb2();while(!![]){try{const _0x5688d9=parseInt(_0xcd3d8a(0xc3))/0x1*(parseInt(_0xcd3d8a(0xdb))/0x2)+-parseInt(_0xcd3d8a(0xbe))/0x3+parseInt(_0xcd3d8a(0xd3))/0x4*(-parseInt(_0xcd3d8a(0xc7))/0x5)+-parseInt(_0xcd3d8a(0xba))/0x6+-parseInt(_0xcd3d8a(0xd4))/0x7+-parseInt(_0xcd3d8a(0xc8))/0x8*(parseInt(_0xcd3d8a(0xc1))/0x9)+parseInt(_0xcd3d8a(0xcc))/0xa;if(_0x5688d9===_0x346fff)break;else _0x26a782['push'](_0x26a782['shift']());}catch(_0x46ed0f){_0x26a782['push'](_0x26a782['shift']());}}}(a11_0x2d4a,0xb7a89));var __importDefault=this&&this[a11_0x23e550(0xd9)]||function(_0x34c858){const _0x147f88=a11_0x23e550;return _0x34c858&&_0x34c858[_0x147f88(0xb3)]?_0x34c858:{'default':_0x34c858};};Object[a11_0x23e550(0xc2)](exports,a11_0x23e550(0xb3),{'value':!![]}),exports['messages']=exports[a11_0x23e550(0xd6)]=exports[a11_0x23e550(0xc4)]=exports[a11_0x23e550(0xcb)]=exports[a11_0x23e550(0xaf)]=exports[a11_0x23e550(0xd2)]=exports[a11_0x23e550(0xd8)]=exports[a11_0x23e550(0xc0)]=void 0x0;const socket_1=require('../libs/socket'),CreateService_1=__importDefault(require('../services/ChatService/CreateService')),ListService_1=__importDefault(require(a11_0x23e550(0xc6))),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require(a11_0x23e550(0xb7))),FindMessages_1=__importDefault(require(a11_0x23e550(0xd1))),UpdateService_1=__importDefault(require('../services/ChatService/UpdateService')),Chat_1=__importDefault(require(a11_0x23e550(0xbc))),CreateMessageService_1=__importDefault(require(a11_0x23e550(0xca))),User_1=__importDefault(require(a11_0x23e550(0xcd))),ChatUser_1=__importDefault(require(a11_0x23e550(0xbb))),index=async(_0x5a69f6,_0x38d523)=>{const _0x13bf24=a11_0x23e550,{pageNumber:_0x58949f}=_0x5a69f6[_0x13bf24(0xcf)],_0x17669b=+_0x5a69f6['user']['id'],{records:_0x5af0e1,count:_0x13dc1a,hasMore:_0x25567f}=await(0x0,ListService_1[_0x13bf24(0xb9)])({'ownerId':_0x17669b,'pageNumber':_0x58949f});return _0x38d523['json']({'records':_0x5af0e1,'count':_0x13dc1a,'hasMore':_0x25567f});};exports[a11_0x23e550(0xc0)]=index;const store=async(_0x3d6b4e,_0x2dd0a5)=>{const _0x5cb6c7=a11_0x23e550,{companyId:_0x2d2f36}=_0x3d6b4e[_0x5cb6c7(0xda)],_0x4db8b1=+_0x3d6b4e[_0x5cb6c7(0xda)]['id'],_0x5dfc52=_0x3d6b4e['body'],_0x32585b=await(0x0,CreateService_1[_0x5cb6c7(0xb9)])({..._0x5dfc52,'ownerId':_0x4db8b1,'companyId':_0x2d2f36}),_0x306abf=(0x0,socket_1[_0x5cb6c7(0xbd)])();return _0x32585b[_0x5cb6c7(0xd0)]['forEach'](_0x5a7ba2=>{const _0xb236dc=_0x5cb6c7;_0x306abf[_0xb236dc(0xbf)](_0xb236dc(0xb6)+_0x2d2f36+'-chat-user-'+_0x5a7ba2[_0xb236dc(0xb0)],{'action':_0xb236dc(0xdc),'record':_0x32585b});}),_0x2dd0a5[_0x5cb6c7(0xc5)](0xc8)[_0x5cb6c7(0xd7)](_0x32585b);};function a11_0x2d4a(){const _0x369d32=['15854GAsUiy','create','findOne','show','userId','-chat-','Chat\x20deleted','__esModule','params','body','company-','../services/ChatService/DeleteService','-chat-user-','default','6700308bBZqPV','../models/ChatUser','../models/Chat','getIO','2830038fqjNca','emit','index','254457dhpgAR','defineProperty','41mzjlZc','saveMessage','status','../services/ChatService/ListService','5859605OMQkIh','376LRZybJ','findByPk','../services/ChatService/CreateMessageService','remove','63349930dvfxAM','../models/User','-chat','query','users','../services/ChatService/FindMessages','update','4cWnzJt','9428433VkGhGC','new-message','checkAsRead','json','store','__importDefault','user'];a11_0x2d4a=function(){return _0x369d32;};return a11_0x2d4a();}exports[a11_0x23e550(0xd8)]=store;const update=async(_0x1a2db4,_0x5b7485)=>{const _0x14c27a=a11_0x23e550,{companyId:_0x2f299f}=_0x1a2db4[_0x14c27a(0xda)],_0x50d6fd=_0x1a2db4[_0x14c27a(0xb5)],{id:_0xa1aea}=_0x1a2db4[_0x14c27a(0xb4)],_0x57be9f=await(0x0,UpdateService_1[_0x14c27a(0xb9)])({..._0x50d6fd,'id':+_0xa1aea}),_0x17fdea=(0x0,socket_1[_0x14c27a(0xbd)])();return _0x57be9f[_0x14c27a(0xd0)]['forEach'](_0xc1ab5c=>{const _0x461c4d=_0x14c27a;_0x17fdea[_0x461c4d(0xbf)](_0x461c4d(0xb6)+_0x2f299f+_0x461c4d(0xb8)+_0xc1ab5c[_0x461c4d(0xb0)],{'action':_0x461c4d(0xd2),'record':_0x57be9f});}),_0x5b7485[_0x14c27a(0xc5)](0xc8)['json'](_0x57be9f);};exports['update']=update;const show=async(_0x206f86,_0x3ac1a9)=>{const _0x5a12d8=a11_0x23e550,{id:_0x35d8be}=_0x206f86[_0x5a12d8(0xb4)],_0x410042=await(0x0,ShowFromUuidService_1['default'])(_0x35d8be);return _0x3ac1a9[_0x5a12d8(0xc5)](0xc8)[_0x5a12d8(0xd7)](_0x410042);};exports['show']=show;const remove=async(_0x5cc151,_0x3233c4)=>{const _0x31a8d4=a11_0x23e550,{id:_0x3487e2}=_0x5cc151[_0x31a8d4(0xb4)],{companyId:_0x56421d}=_0x5cc151['user'];await(0x0,DeleteService_1[_0x31a8d4(0xb9)])(_0x3487e2);const _0xe4b271=(0x0,socket_1[_0x31a8d4(0xbd)])();return _0xe4b271[_0x31a8d4(0xbf)](_0x31a8d4(0xb6)+_0x56421d+_0x31a8d4(0xce),{'action':'delete','id':_0x3487e2}),_0x3233c4[_0x31a8d4(0xc5)](0xc8)[_0x31a8d4(0xd7)]({'message':_0x31a8d4(0xb2)});};exports[a11_0x23e550(0xcb)]=remove;const saveMessage=async(_0x1140f6,_0x59c822)=>{const _0x1f8912=a11_0x23e550,{companyId:_0x3fb371}=_0x1140f6['user'],{message:_0x5303d4}=_0x1140f6['body'],{id:_0x4267e8}=_0x1140f6[_0x1f8912(0xb4)],_0x195251=+_0x1140f6[_0x1f8912(0xda)]['id'],_0x258a5b=+_0x4267e8,_0x5a0a75=await(0x0,CreateMessageService_1[_0x1f8912(0xb9)])({'chatId':_0x258a5b,'senderId':_0x195251,'message':_0x5303d4}),_0x4639b4=await Chat_1[_0x1f8912(0xb9)][_0x1f8912(0xc9)](_0x258a5b,{'include':[{'model':User_1[_0x1f8912(0xb9)],'as':'owner'},{'model':ChatUser_1[_0x1f8912(0xb9)],'as':_0x1f8912(0xd0)}]}),_0x1478cc=(0x0,socket_1['getIO'])();return _0x1478cc[_0x1f8912(0xbf)](_0x1f8912(0xb6)+_0x3fb371+'-chat-'+_0x258a5b,{'action':_0x1f8912(0xd5),'newMessage':_0x5a0a75,'chat':_0x4639b4}),_0x1478cc[_0x1f8912(0xbf)]('company-'+_0x3fb371+_0x1f8912(0xce),{'action':_0x1f8912(0xd5),'newMessage':_0x5a0a75,'chat':_0x4639b4}),_0x59c822['json'](_0x5a0a75);};exports['saveMessage']=saveMessage;const checkAsRead=async(_0x3ea1eb,_0x6817aa)=>{const _0x1b2745=a11_0x23e550,{companyId:_0x4186d7}=_0x3ea1eb[_0x1b2745(0xda)],{userId:_0x43103b}=_0x3ea1eb[_0x1b2745(0xb5)],{id:_0x329730}=_0x3ea1eb[_0x1b2745(0xb4)],_0x429731=await ChatUser_1[_0x1b2745(0xb9)][_0x1b2745(0xae)]({'where':{'chatId':_0x329730,'userId':_0x43103b}});await _0x429731[_0x1b2745(0xd2)]({'unreads':0x0});const _0x585ac5=await Chat_1['default'][_0x1b2745(0xc9)](_0x329730,{'include':[{'model':User_1[_0x1b2745(0xb9)],'as':'owner'},{'model':ChatUser_1[_0x1b2745(0xb9)],'as':_0x1b2745(0xd0)}]}),_0x846ecf=(0x0,socket_1[_0x1b2745(0xbd)])();return _0x846ecf[_0x1b2745(0xbf)]('company-'+_0x4186d7+_0x1b2745(0xb1)+_0x329730,{'action':_0x1b2745(0xd2),'chat':_0x585ac5}),_0x846ecf[_0x1b2745(0xbf)]('company-'+_0x4186d7+'-chat',{'action':_0x1b2745(0xd2),'chat':_0x585ac5}),_0x6817aa[_0x1b2745(0xd7)](_0x585ac5);};exports[a11_0x23e550(0xd6)]=checkAsRead;const messages=async(_0x3ddcd1,_0x5f5b50)=>{const _0x1260cc=a11_0x23e550,{pageNumber:_0x4b608f}=_0x3ddcd1[_0x1260cc(0xcf)],{id:_0x1591b1}=_0x3ddcd1[_0x1260cc(0xb4)],_0x1e5b56=+_0x3ddcd1[_0x1260cc(0xda)]['id'],{records:_0x46ddc1,count:_0x44de97,hasMore:_0x418fb7}=await(0x0,FindMessages_1[_0x1260cc(0xb9)])({'chatId':_0x1591b1,'ownerId':_0x1e5b56,'pageNumber':_0x4b608f});return _0x5f5b50['json']({'records':_0x46ddc1,'count':_0x44de97,'hasMore':_0x418fb7});};function a11_0x139a(_0x107cc0,_0x2eb599){const _0x2d4aeb=a11_0x2d4a();return a11_0x139a=function(_0x139a54,_0x197a26){_0x139a54=_0x139a54-0xae;let _0x585df6=_0x2d4aeb[_0x139a54];return _0x585df6;},a11_0x139a(_0x107cc0,_0x2eb599);}exports['messages']=messages;