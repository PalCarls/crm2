'use strict';const a11_0x4dad35=a11_0x276c;(function(_0x58069c,_0x31f5bf){const _0x22cd7d=a11_0x276c,_0x56a4d0=_0x58069c();while(!![]){try{const _0x1c5c1e=-parseInt(_0x22cd7d(0xf3))/0x1+-parseInt(_0x22cd7d(0x113))/0x2+parseInt(_0x22cd7d(0x103))/0x3*(-parseInt(_0x22cd7d(0x125))/0x4)+-parseInt(_0x22cd7d(0x10e))/0x5*(-parseInt(_0x22cd7d(0x10d))/0x6)+-parseInt(_0x22cd7d(0x11d))/0x7+parseInt(_0x22cd7d(0x11f))/0x8+-parseInt(_0x22cd7d(0x117))/0x9*(-parseInt(_0x22cd7d(0x10a))/0xa);if(_0x1c5c1e===_0x31f5bf)break;else _0x56a4d0['push'](_0x56a4d0['shift']());}catch(_0x187557){_0x56a4d0['push'](_0x56a4d0['shift']());}}}(a11_0x3307,0xa5f9b));var __importDefault=this&&this[a11_0x4dad35(0x101)]||function(_0x3f9da7){const _0xf1760a=a11_0x4dad35;return _0x3f9da7&&_0x3f9da7[_0xf1760a(0xff)]?_0x3f9da7:{'default':_0x3f9da7};};Object[a11_0x4dad35(0x122)](exports,a11_0x4dad35(0xff),{'value':!![]}),exports[a11_0x4dad35(0x11a)]=exports[a11_0x4dad35(0x119)]=exports[a11_0x4dad35(0x111)]=exports['remove']=exports[a11_0x4dad35(0xf2)]=exports['update']=exports[a11_0x4dad35(0x124)]=exports['index']=void 0x0;function a11_0x276c(_0xb0b70a,_0xf99d84){const _0x3307b8=a11_0x3307();return a11_0x276c=function(_0x276cfb,_0x1c2a0d){_0x276cfb=_0x276cfb-0xf2;let _0xf30420=_0x3307b8[_0x276cfb];return _0xf30420;},a11_0x276c(_0xb0b70a,_0xf99d84);}const socket_1=require(a11_0x4dad35(0xf6)),CreateService_1=__importDefault(require(a11_0x4dad35(0x105))),ListService_1=__importDefault(require(a11_0x4dad35(0x102))),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require(a11_0x4dad35(0x100))),FindMessages_1=__importDefault(require(a11_0x4dad35(0x11c))),UpdateService_1=__importDefault(require(a11_0x4dad35(0x10f))),Chat_1=__importDefault(require(a11_0x4dad35(0x118))),CreateMessageService_1=__importDefault(require(a11_0x4dad35(0x116))),User_1=__importDefault(require(a11_0x4dad35(0x10c))),ChatUser_1=__importDefault(require(a11_0x4dad35(0x11e))),index=async(_0x35b0f4,_0x55497a)=>{const _0x11efbb=a11_0x4dad35,{pageNumber:_0x231d13}=_0x35b0f4['query'],_0x4089f8=+_0x35b0f4['user']['id'],{records:_0x4c7d6f,count:_0xbf6fb2,hasMore:_0x3a4a42}=await(0x0,ListService_1[_0x11efbb(0xfa)])({'ownerId':_0x4089f8,'pageNumber':_0x231d13});return _0x55497a[_0x11efbb(0xf9)]({'records':_0x4c7d6f,'count':_0xbf6fb2,'hasMore':_0x3a4a42});};exports[a11_0x4dad35(0xf4)]=index;function a11_0x3307(){const _0x5f227e=['Chat\x20deleted','create','__esModule','../services/ChatService/DeleteService','__importDefault','../services/ChatService/ListService','4713UCMeID','owner','../services/ChatService/CreateService','company-','emit','-chat','body','10kVbEcM','userId','../models/User','1342356MXstyM','25ILWKMA','../services/ChatService/UpdateService','user','saveMessage','-chat-user-','869154aYiayF','-chat-','status','../services/ChatService/CreateMessageService','5682249YwQTgM','../models/Chat','checkAsRead','messages','query','../services/ChatService/FindMessages','5697979tnqBuk','../models/ChatUser','10153528prtTAc','update','users','defineProperty','params','store','688WvumBG','remove','show','820561hlWcvS','index','findByPk','../libs/socket','getIO','forEach','json','default','findOne','delete'];a11_0x3307=function(){return _0x5f227e;};return a11_0x3307();}const store=async(_0x2a81bc,_0x1c2b98)=>{const _0xed31bb=a11_0x4dad35,{companyId:_0x545f8e}=_0x2a81bc[_0xed31bb(0x110)],_0xe6f957=+_0x2a81bc[_0xed31bb(0x110)]['id'],_0x2bc6fa=_0x2a81bc[_0xed31bb(0x109)],_0x32b995=await(0x0,CreateService_1[_0xed31bb(0xfa)])({..._0x2bc6fa,'ownerId':_0xe6f957,'companyId':_0x545f8e}),_0x4bd197=(0x0,socket_1[_0xed31bb(0xf7)])();return _0x32b995[_0xed31bb(0x121)][_0xed31bb(0xf8)](_0x7aa349=>{const _0x37f4f6=_0xed31bb;_0x4bd197['emit'](_0x37f4f6(0x106)+_0x545f8e+_0x37f4f6(0x112)+_0x7aa349[_0x37f4f6(0x10b)],{'action':_0x37f4f6(0xfe),'record':_0x32b995});}),_0x1c2b98[_0xed31bb(0x115)](0xc8)[_0xed31bb(0xf9)](_0x32b995);};exports['store']=store;const update=async(_0x16304b,_0x499771)=>{const _0x5a20f4=a11_0x4dad35,{companyId:_0x4366cd}=_0x16304b[_0x5a20f4(0x110)],_0x428f06=_0x16304b[_0x5a20f4(0x109)],{id:_0x3352f}=_0x16304b[_0x5a20f4(0x123)],_0x342655=await(0x0,UpdateService_1[_0x5a20f4(0xfa)])({..._0x428f06,'id':+_0x3352f}),_0x4f702d=(0x0,socket_1[_0x5a20f4(0xf7)])();return _0x342655['users']['forEach'](_0x4378a9=>{const _0x551a41=_0x5a20f4;_0x4f702d[_0x551a41(0x107)]('company-'+_0x4366cd+_0x551a41(0x112)+_0x4378a9[_0x551a41(0x10b)],{'action':_0x551a41(0x120),'record':_0x342655});}),_0x499771[_0x5a20f4(0x115)](0xc8)[_0x5a20f4(0xf9)](_0x342655);};exports[a11_0x4dad35(0x120)]=update;const show=async(_0x2752e6,_0x14ae00)=>{const _0x215817=a11_0x4dad35,{id:_0x2839eb}=_0x2752e6[_0x215817(0x123)],_0x2ab4a7=await(0x0,ShowFromUuidService_1[_0x215817(0xfa)])(_0x2839eb);return _0x14ae00[_0x215817(0x115)](0xc8)[_0x215817(0xf9)](_0x2ab4a7);};exports[a11_0x4dad35(0xf2)]=show;const remove=async(_0xc3df3b,_0x2ed971)=>{const _0x4be188=a11_0x4dad35,{id:_0x467a40}=_0xc3df3b[_0x4be188(0x123)],{companyId:_0x274db3}=_0xc3df3b[_0x4be188(0x110)];await(0x0,DeleteService_1[_0x4be188(0xfa)])(_0x467a40);const _0x51dff5=(0x0,socket_1['getIO'])();return _0x51dff5[_0x4be188(0x107)](_0x4be188(0x106)+_0x274db3+_0x4be188(0x108),{'action':_0x4be188(0xfc),'id':_0x467a40}),_0x2ed971['status'](0xc8)[_0x4be188(0xf9)]({'message':_0x4be188(0xfd)});};exports[a11_0x4dad35(0x126)]=remove;const saveMessage=async(_0x36c98c,_0x472931)=>{const _0x136673=a11_0x4dad35,{companyId:_0x32316e}=_0x36c98c[_0x136673(0x110)],{message:_0x3647d2}=_0x36c98c[_0x136673(0x109)],{id:_0x23ea18}=_0x36c98c['params'],_0x4914bb=+_0x36c98c['user']['id'],_0x3740dd=+_0x23ea18,_0x557285=await(0x0,CreateMessageService_1['default'])({'chatId':_0x3740dd,'senderId':_0x4914bb,'message':_0x3647d2}),_0x466b3c=await Chat_1[_0x136673(0xfa)]['findByPk'](_0x3740dd,{'include':[{'model':User_1[_0x136673(0xfa)],'as':_0x136673(0x104)},{'model':ChatUser_1[_0x136673(0xfa)],'as':_0x136673(0x121)}]}),_0x523865=(0x0,socket_1[_0x136673(0xf7)])();return _0x523865[_0x136673(0x107)]('company-'+_0x32316e+_0x136673(0x114)+_0x3740dd,{'action':'new-message','newMessage':_0x557285,'chat':_0x466b3c}),_0x523865[_0x136673(0x107)](_0x136673(0x106)+_0x32316e+_0x136673(0x108),{'action':'new-message','newMessage':_0x557285,'chat':_0x466b3c}),_0x472931[_0x136673(0xf9)](_0x557285);};exports[a11_0x4dad35(0x111)]=saveMessage;const checkAsRead=async(_0x3a2c79,_0xf820ab)=>{const _0x2fa930=a11_0x4dad35,{companyId:_0x4ab900}=_0x3a2c79[_0x2fa930(0x110)],{userId:_0xba127}=_0x3a2c79[_0x2fa930(0x109)],{id:_0x48b36b}=_0x3a2c79['params'],_0x24cc9d=await ChatUser_1[_0x2fa930(0xfa)][_0x2fa930(0xfb)]({'where':{'chatId':_0x48b36b,'userId':_0xba127}});await _0x24cc9d[_0x2fa930(0x120)]({'unreads':0x0});const _0x2af88d=await Chat_1[_0x2fa930(0xfa)][_0x2fa930(0xf5)](_0x48b36b,{'include':[{'model':User_1[_0x2fa930(0xfa)],'as':_0x2fa930(0x104)},{'model':ChatUser_1['default'],'as':_0x2fa930(0x121)}]}),_0x104510=(0x0,socket_1['getIO'])();return _0x104510[_0x2fa930(0x107)]('company-'+_0x4ab900+_0x2fa930(0x114)+_0x48b36b,{'action':'update','chat':_0x2af88d}),_0x104510['emit'](_0x2fa930(0x106)+_0x4ab900+_0x2fa930(0x108),{'action':_0x2fa930(0x120),'chat':_0x2af88d}),_0xf820ab['json'](_0x2af88d);};exports[a11_0x4dad35(0x119)]=checkAsRead;const messages=async(_0x5868af,_0x53dcce)=>{const _0x22473a=a11_0x4dad35,{pageNumber:_0x5f0d3c}=_0x5868af[_0x22473a(0x11b)],{id:_0x46fdd0}=_0x5868af[_0x22473a(0x123)],_0x2987ee=+_0x5868af['user']['id'],{records:_0x46fb99,count:_0x3f952c,hasMore:_0x43c60e}=await(0x0,FindMessages_1[_0x22473a(0xfa)])({'chatId':_0x46fdd0,'ownerId':_0x2987ee,'pageNumber':_0x5f0d3c});return _0x53dcce[_0x22473a(0xf9)]({'records':_0x46fb99,'count':_0x3f952c,'hasMore':_0x43c60e});};exports[a11_0x4dad35(0x11a)]=messages;