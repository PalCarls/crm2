'use strict';const a11_0x4c123d=a11_0x2623;(function(_0x260806,_0x578e8f){const _0x3657a0=a11_0x2623,_0x238602=_0x260806();while(!![]){try{const _0x11dd62=parseInt(_0x3657a0(0x92))/0x1*(parseInt(_0x3657a0(0x8f))/0x2)+parseInt(_0x3657a0(0x96))/0x3+parseInt(_0x3657a0(0xa3))/0x4+parseInt(_0x3657a0(0x8b))/0x5*(parseInt(_0x3657a0(0x94))/0x6)+parseInt(_0x3657a0(0x7c))/0x7*(-parseInt(_0x3657a0(0x74))/0x8)+-parseInt(_0x3657a0(0x7d))/0x9+-parseInt(_0x3657a0(0x91))/0xa*(parseInt(_0x3657a0(0x71))/0xb);if(_0x11dd62===_0x578e8f)break;else _0x238602['push'](_0x238602['shift']());}catch(_0x527550){_0x238602['push'](_0x238602['shift']());}}}(a11_0x475e,0x5b168));var __importDefault=this&&this[a11_0x4c123d(0x73)]||function(_0x2345fa){const _0x4b66bf=a11_0x4c123d;return _0x2345fa&&_0x2345fa[_0x4b66bf(0x8d)]?_0x2345fa:{'default':_0x2345fa};};Object['defineProperty'](exports,a11_0x4c123d(0x8d),{'value':!![]}),exports[a11_0x4c123d(0x85)]=exports[a11_0x4c123d(0x89)]=exports[a11_0x4c123d(0x9c)]=exports[a11_0x4c123d(0x97)]=exports[a11_0x4c123d(0x76)]=exports[a11_0x4c123d(0x9b)]=exports[a11_0x4c123d(0x88)]=exports[a11_0x4c123d(0x7a)]=void 0x0;const socket_1=require(a11_0x4c123d(0x87)),CreateService_1=__importDefault(require(a11_0x4c123d(0x99))),ListService_1=__importDefault(require(a11_0x4c123d(0x8e))),ShowFromUuidService_1=__importDefault(require(a11_0x4c123d(0x82))),DeleteService_1=__importDefault(require(a11_0x4c123d(0x77))),FindMessages_1=__importDefault(require(a11_0x4c123d(0x7b))),UpdateService_1=__importDefault(require(a11_0x4c123d(0x9d))),Chat_1=__importDefault(require(a11_0x4c123d(0x9e))),CreateMessageService_1=__importDefault(require('../services/ChatService/CreateMessageService')),User_1=__importDefault(require(a11_0x4c123d(0x95))),ChatUser_1=__importDefault(require(a11_0x4c123d(0xa5))),index=async(_0x52f85c,_0x24be38)=>{const _0x593987=a11_0x4c123d,{pageNumber:_0x55faef}=_0x52f85c[_0x593987(0xa0)],_0x1d976f=+_0x52f85c['user']['id'],{records:_0x55beeb,count:_0x3c08ae,hasMore:_0x49deba}=await(0x0,ListService_1[_0x593987(0x84)])({'ownerId':_0x1d976f,'pageNumber':_0x55faef});return _0x24be38[_0x593987(0xa2)]({'records':_0x55beeb,'count':_0x3c08ae,'hasMore':_0x49deba});};exports[a11_0x4c123d(0x7a)]=index;function a11_0x475e(){const _0x41f1ec=['messages','delete','../libs/socket','store','checkAsRead','Chat\x20deleted','53205YxUCHw','findByPk','__esModule','../services/ChatService/ListService','7442paQAsJ','users','70LuNYdG','32IPRant','create','378qHkZnn','../models/User','2070687hgubcu','remove','company-','../services/ChatService/CreateService','findOne','update','saveMessage','../services/ChatService/UpdateService','../models/Chat','status','query','userId','json','1743140wBbekD','forEach','../models/ChatUser','emit','1072654TIAQzE','user','__importDefault','465144icRvYX','params','show','../services/ChatService/DeleteService','-chat','body','index','../services/ChatService/FindMessages','21ggjYPz','6168114AGYbtG','owner','new-message','getIO','-chat-','../services/ChatService/ShowFromUuidService','-chat-user-','default'];a11_0x475e=function(){return _0x41f1ec;};return a11_0x475e();}const store=async(_0x1618eb,_0x14e615)=>{const _0x3fbdf7=a11_0x4c123d,{companyId:_0x21ef05}=_0x1618eb[_0x3fbdf7(0x72)],_0x3847c2=+_0x1618eb[_0x3fbdf7(0x72)]['id'],_0x108e5e=_0x1618eb['body'],_0x13e385=await(0x0,CreateService_1[_0x3fbdf7(0x84)])({..._0x108e5e,'ownerId':_0x3847c2,'companyId':_0x21ef05}),_0x2315ca=(0x0,socket_1[_0x3fbdf7(0x80)])();return _0x13e385[_0x3fbdf7(0x90)]['forEach'](_0x44fd3e=>{const _0x13176d=_0x3fbdf7;_0x2315ca[_0x13176d(0x70)](_0x13176d(0x98)+_0x21ef05+'-chat-user-'+_0x44fd3e[_0x13176d(0xa1)],{'action':_0x13176d(0x93),'record':_0x13e385});}),_0x14e615[_0x3fbdf7(0x9f)](0xc8)['json'](_0x13e385);};exports[a11_0x4c123d(0x88)]=store;const update=async(_0x1bf611,_0x4504c4)=>{const _0x2cf314=a11_0x4c123d,{companyId:_0x57d202}=_0x1bf611[_0x2cf314(0x72)],_0x1b7aa1=_0x1bf611[_0x2cf314(0x79)],{id:_0x555038}=_0x1bf611[_0x2cf314(0x75)],_0x54c327=await(0x0,UpdateService_1[_0x2cf314(0x84)])({..._0x1b7aa1,'id':+_0x555038}),_0x32be40=(0x0,socket_1[_0x2cf314(0x80)])();return _0x54c327[_0x2cf314(0x90)][_0x2cf314(0xa4)](_0xf93c41=>{const _0x5d294d=_0x2cf314;_0x32be40[_0x5d294d(0x70)](_0x5d294d(0x98)+_0x57d202+_0x5d294d(0x83)+_0xf93c41[_0x5d294d(0xa1)],{'action':_0x5d294d(0x9b),'record':_0x54c327});}),_0x4504c4[_0x2cf314(0x9f)](0xc8)[_0x2cf314(0xa2)](_0x54c327);};exports[a11_0x4c123d(0x9b)]=update;const show=async(_0x29ea64,_0x261d68)=>{const _0x3801d3=a11_0x4c123d,{id:_0x5a4330}=_0x29ea64['params'],_0x4ce1e6=await(0x0,ShowFromUuidService_1[_0x3801d3(0x84)])(_0x5a4330);return _0x261d68['status'](0xc8)[_0x3801d3(0xa2)](_0x4ce1e6);};exports[a11_0x4c123d(0x76)]=show;const remove=async(_0x1be9c2,_0x3dd626)=>{const _0x1b5b6b=a11_0x4c123d,{id:_0x3d4b55}=_0x1be9c2[_0x1b5b6b(0x75)],{companyId:_0x403caa}=_0x1be9c2['user'];await(0x0,DeleteService_1['default'])(_0x3d4b55);const _0x3e244a=(0x0,socket_1[_0x1b5b6b(0x80)])();return _0x3e244a[_0x1b5b6b(0x70)](_0x1b5b6b(0x98)+_0x403caa+_0x1b5b6b(0x78),{'action':_0x1b5b6b(0x86),'id':_0x3d4b55}),_0x3dd626[_0x1b5b6b(0x9f)](0xc8)[_0x1b5b6b(0xa2)]({'message':_0x1b5b6b(0x8a)});};exports[a11_0x4c123d(0x97)]=remove;const saveMessage=async(_0x341fb3,_0x26e9b6)=>{const _0x43b4f3=a11_0x4c123d,{companyId:_0x1c9caf}=_0x341fb3['user'],{message:_0x69f013}=_0x341fb3[_0x43b4f3(0x79)],{id:_0x112aa7}=_0x341fb3[_0x43b4f3(0x75)],_0x265733=+_0x341fb3[_0x43b4f3(0x72)]['id'],_0x58456d=+_0x112aa7,_0x59fddb=await(0x0,CreateMessageService_1[_0x43b4f3(0x84)])({'chatId':_0x58456d,'senderId':_0x265733,'message':_0x69f013}),_0x4e983b=await Chat_1['default']['findByPk'](_0x58456d,{'include':[{'model':User_1[_0x43b4f3(0x84)],'as':'owner'},{'model':ChatUser_1[_0x43b4f3(0x84)],'as':'users'}]}),_0x5e0eb0=(0x0,socket_1[_0x43b4f3(0x80)])();return _0x5e0eb0[_0x43b4f3(0x70)]('company-'+_0x1c9caf+_0x43b4f3(0x81)+_0x58456d,{'action':_0x43b4f3(0x7f),'newMessage':_0x59fddb,'chat':_0x4e983b}),_0x5e0eb0['emit'](_0x43b4f3(0x98)+_0x1c9caf+'-chat',{'action':'new-message','newMessage':_0x59fddb,'chat':_0x4e983b}),_0x26e9b6[_0x43b4f3(0xa2)](_0x59fddb);};exports[a11_0x4c123d(0x9c)]=saveMessage;const checkAsRead=async(_0x5cf4ca,_0x4a1598)=>{const _0x41c2e8=a11_0x4c123d,{companyId:_0x1fb390}=_0x5cf4ca[_0x41c2e8(0x72)],{userId:_0x2d150d}=_0x5cf4ca[_0x41c2e8(0x79)],{id:_0x1a9f99}=_0x5cf4ca['params'],_0x208516=await ChatUser_1[_0x41c2e8(0x84)][_0x41c2e8(0x9a)]({'where':{'chatId':_0x1a9f99,'userId':_0x2d150d}});await _0x208516['update']({'unreads':0x0});const _0xf08ab2=await Chat_1['default'][_0x41c2e8(0x8c)](_0x1a9f99,{'include':[{'model':User_1[_0x41c2e8(0x84)],'as':_0x41c2e8(0x7e)},{'model':ChatUser_1[_0x41c2e8(0x84)],'as':_0x41c2e8(0x90)}]}),_0x213ef5=(0x0,socket_1['getIO'])();return _0x213ef5[_0x41c2e8(0x70)](_0x41c2e8(0x98)+_0x1fb390+_0x41c2e8(0x81)+_0x1a9f99,{'action':'update','chat':_0xf08ab2}),_0x213ef5[_0x41c2e8(0x70)](_0x41c2e8(0x98)+_0x1fb390+'-chat',{'action':_0x41c2e8(0x9b),'chat':_0xf08ab2}),_0x4a1598[_0x41c2e8(0xa2)](_0xf08ab2);};exports['checkAsRead']=checkAsRead;function a11_0x2623(_0x14a426,_0x366457){const _0x475ece=a11_0x475e();return a11_0x2623=function(_0x2623f8,_0x47e9d6){_0x2623f8=_0x2623f8-0x70;let _0x143267=_0x475ece[_0x2623f8];return _0x143267;},a11_0x2623(_0x14a426,_0x366457);}const messages=async(_0x9a3433,_0x3eafba)=>{const _0xd812e4=a11_0x4c123d,{pageNumber:_0x3c3c6c}=_0x9a3433[_0xd812e4(0xa0)],{id:_0x32fee9}=_0x9a3433[_0xd812e4(0x75)],_0x4cf115=+_0x9a3433[_0xd812e4(0x72)]['id'],{records:_0x3795e6,count:_0x3748c7,hasMore:_0x4a2966}=await(0x0,FindMessages_1[_0xd812e4(0x84)])({'chatId':_0x32fee9,'ownerId':_0x4cf115,'pageNumber':_0x3c3c6c});return _0x3eafba['json']({'records':_0x3795e6,'count':_0x3748c7,'hasMore':_0x4a2966});};exports[a11_0x4c123d(0x85)]=messages;