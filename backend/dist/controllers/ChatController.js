'use strict';const a11_0x763474=a11_0x5690;(function(_0x348349,_0x5ea41b){const _0x25d973=a11_0x5690,_0x221ff0=_0x348349();while(!![]){try{const _0x13e74a=-parseInt(_0x25d973(0x98))/0x1+parseInt(_0x25d973(0x83))/0x2*(parseInt(_0x25d973(0x8e))/0x3)+-parseInt(_0x25d973(0x99))/0x4*(parseInt(_0x25d973(0x97))/0x5)+parseInt(_0x25d973(0xa9))/0x6+parseInt(_0x25d973(0x9c))/0x7*(-parseInt(_0x25d973(0xab))/0x8)+-parseInt(_0x25d973(0xa0))/0x9+parseInt(_0x25d973(0x94))/0xa*(parseInt(_0x25d973(0x8a))/0xb);if(_0x13e74a===_0x5ea41b)break;else _0x221ff0['push'](_0x221ff0['shift']());}catch(_0x4fa990){_0x221ff0['push'](_0x221ff0['shift']());}}}(a11_0x246a,0x3a857));var __importDefault=this&&this['__importDefault']||function(_0x3dacd2){return _0x3dacd2&&_0x3dacd2['__esModule']?_0x3dacd2:{'default':_0x3dacd2};};Object[a11_0x763474(0x7d)](exports,a11_0x763474(0x89),{'value':!![]}),exports[a11_0x763474(0x87)]=exports[a11_0x763474(0x8d)]=exports[a11_0x763474(0x9f)]=exports[a11_0x763474(0xa4)]=exports[a11_0x763474(0x8c)]=exports[a11_0x763474(0xa2)]=exports[a11_0x763474(0xa3)]=exports['index']=void 0x0;const socket_1=require(a11_0x763474(0x85)),CreateService_1=__importDefault(require(a11_0x763474(0x8b))),ListService_1=__importDefault(require(a11_0x763474(0x84))),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require(a11_0x763474(0xa5))),UpdateService_1=__importDefault(require('../services/ChatService/UpdateService')),Chat_1=__importDefault(require(a11_0x763474(0xa1))),CreateMessageService_1=__importDefault(require(a11_0x763474(0xac))),User_1=__importDefault(require(a11_0x763474(0xa8))),ChatUser_1=__importDefault(require('../models/ChatUser')),index=async(_0x4fd0e7,_0xe2175f)=>{const _0x3d63d2=a11_0x763474,{pageNumber:_0x3bee19}=_0x4fd0e7['query'],_0x577e45=+_0x4fd0e7[_0x3d63d2(0x96)]['id'],{records:_0x26c077,count:_0xe1b02,hasMore:_0x26f967}=await(0x0,ListService_1[_0x3d63d2(0x86)])({'ownerId':_0x577e45,'pageNumber':_0x3bee19});return _0xe2175f['json']({'records':_0x26c077,'count':_0xe1b02,'hasMore':_0x26f967});};exports[a11_0x763474(0x80)]=index;const store=async(_0x2198e7,_0x37a601)=>{const _0xb6c1b5=a11_0x763474,{companyId:_0x590f70}=_0x2198e7[_0xb6c1b5(0x96)],_0x3fc844=+_0x2198e7[_0xb6c1b5(0x96)]['id'],_0x47872f=_0x2198e7[_0xb6c1b5(0x9a)],_0x267fa3=await(0x0,CreateService_1[_0xb6c1b5(0x86)])({..._0x47872f,'ownerId':_0x3fc844,'companyId':_0x590f70}),_0x3c282b=(0x0,socket_1['getIO'])();return _0x267fa3[_0xb6c1b5(0x81)]['forEach'](_0x352c24=>{const _0x46984a=_0xb6c1b5;_0x3c282b['emit']('company-'+_0x590f70+_0x46984a(0xa7)+_0x352c24[_0x46984a(0x7b)],{'action':_0x46984a(0x93),'record':_0x267fa3});}),_0x37a601[_0xb6c1b5(0x82)](0xc8)[_0xb6c1b5(0xa6)](_0x267fa3);};exports[a11_0x763474(0xa3)]=store;function a11_0x5690(_0x583b55,_0x128ac7){const _0x246a50=a11_0x246a();return a11_0x5690=function(_0x5690aa,_0x1ce4e0){_0x5690aa=_0x5690aa-0x7b;let _0x8ffdab=_0x246a50[_0x5690aa];return _0x8ffdab;},a11_0x5690(_0x583b55,_0x128ac7);}function a11_0x246a(){const _0x5561a9=['../libs/socket','default','messages','delete','__esModule','5460895AdJOGB','../services/ChatService/CreateService','show','checkAsRead','874599mCXniV','emit','Chat\x20deleted','findOne','company-','create','20kllqXF','-chat','user','6765OcMfHW','468166lXYNRt','1244kIYpvz','body','params','21dYYJjV','owner','forEach','saveMessage','1663911uaNfUP','../models/Chat','update','store','remove','../services/ChatService/FindMessages','json','-chat-user-','../models/User','909282nrZrqM','findByPk','326504vCdARo','../services/ChatService/CreateMessageService','userId','-chat-','defineProperty','new-message','getIO','index','users','status','2OWxMYw','../services/ChatService/ListService'];a11_0x246a=function(){return _0x5561a9;};return a11_0x246a();}const update=async(_0x11fdfe,_0x44812b)=>{const _0x1e3a1f=a11_0x763474,{companyId:_0x5072a0}=_0x11fdfe[_0x1e3a1f(0x96)],_0x5a72c6=_0x11fdfe[_0x1e3a1f(0x9a)],{id:_0x4fbf77}=_0x11fdfe[_0x1e3a1f(0x9b)],_0x425d8c=await(0x0,UpdateService_1['default'])({..._0x5a72c6,'id':+_0x4fbf77}),_0x1252cb=(0x0,socket_1['getIO'])();return _0x425d8c[_0x1e3a1f(0x81)][_0x1e3a1f(0x9e)](_0x530d76=>{const _0x4a20bf=_0x1e3a1f;_0x1252cb[_0x4a20bf(0x8f)](_0x4a20bf(0x92)+_0x5072a0+_0x4a20bf(0xa7)+_0x530d76[_0x4a20bf(0x7b)],{'action':_0x4a20bf(0xa2),'record':_0x425d8c});}),_0x44812b[_0x1e3a1f(0x82)](0xc8)['json'](_0x425d8c);};exports[a11_0x763474(0xa2)]=update;const show=async(_0x1d7175,_0x39ca0b)=>{const _0x9e5d0f=a11_0x763474,{id:_0x17e80e}=_0x1d7175['params'],_0x506574=await(0x0,ShowFromUuidService_1[_0x9e5d0f(0x86)])(_0x17e80e);return _0x39ca0b['status'](0xc8)[_0x9e5d0f(0xa6)](_0x506574);};exports[a11_0x763474(0x8c)]=show;const remove=async(_0x1dbde1,_0x49e1ee)=>{const _0x3df4f2=a11_0x763474,{id:_0x5983ee}=_0x1dbde1[_0x3df4f2(0x9b)],{companyId:_0x4ab3b6}=_0x1dbde1[_0x3df4f2(0x96)];await(0x0,DeleteService_1['default'])(_0x5983ee);const _0x48d1fe=(0x0,socket_1[_0x3df4f2(0x7f)])();return _0x48d1fe[_0x3df4f2(0x8f)]('company-'+_0x4ab3b6+_0x3df4f2(0x95),{'action':_0x3df4f2(0x88),'id':_0x5983ee}),_0x49e1ee[_0x3df4f2(0x82)](0xc8)['json']({'message':_0x3df4f2(0x90)});};exports[a11_0x763474(0xa4)]=remove;const saveMessage=async(_0x310b6e,_0x5863f4)=>{const _0x4424ac=a11_0x763474,{companyId:_0x14bf40}=_0x310b6e[_0x4424ac(0x96)],{message:_0x1dfee4}=_0x310b6e[_0x4424ac(0x9a)],{id:_0x3a465b}=_0x310b6e[_0x4424ac(0x9b)],_0x5ef763=+_0x310b6e[_0x4424ac(0x96)]['id'],_0x19471d=+_0x3a465b,_0x22a980=await(0x0,CreateMessageService_1[_0x4424ac(0x86)])({'chatId':_0x19471d,'senderId':_0x5ef763,'message':_0x1dfee4}),_0x220d28=await Chat_1[_0x4424ac(0x86)][_0x4424ac(0xaa)](_0x19471d,{'include':[{'model':User_1[_0x4424ac(0x86)],'as':_0x4424ac(0x9d)},{'model':ChatUser_1[_0x4424ac(0x86)],'as':_0x4424ac(0x81)}]}),_0x160380=(0x0,socket_1[_0x4424ac(0x7f)])();return _0x160380[_0x4424ac(0x8f)](_0x4424ac(0x92)+_0x14bf40+_0x4424ac(0x7c)+_0x19471d,{'action':_0x4424ac(0x7e),'newMessage':_0x22a980,'chat':_0x220d28}),_0x160380[_0x4424ac(0x8f)](_0x4424ac(0x92)+_0x14bf40+_0x4424ac(0x95),{'action':_0x4424ac(0x7e),'newMessage':_0x22a980,'chat':_0x220d28}),_0x5863f4[_0x4424ac(0xa6)](_0x22a980);};exports[a11_0x763474(0x9f)]=saveMessage;const checkAsRead=async(_0x330a2f,_0x53375c)=>{const _0x44546e=a11_0x763474,{companyId:_0x3685b2}=_0x330a2f[_0x44546e(0x96)],{userId:_0x36fc60}=_0x330a2f['body'],{id:_0x29798c}=_0x330a2f[_0x44546e(0x9b)],_0x32f166=await ChatUser_1['default'][_0x44546e(0x91)]({'where':{'chatId':_0x29798c,'userId':_0x36fc60}});await _0x32f166[_0x44546e(0xa2)]({'unreads':0x0});const _0x324f5=await Chat_1['default'][_0x44546e(0xaa)](_0x29798c,{'include':[{'model':User_1['default'],'as':'owner'},{'model':ChatUser_1[_0x44546e(0x86)],'as':'users'}]}),_0x197ef9=(0x0,socket_1[_0x44546e(0x7f)])();return _0x197ef9[_0x44546e(0x8f)](_0x44546e(0x92)+_0x3685b2+'-chat-'+_0x29798c,{'action':'update','chat':_0x324f5}),_0x197ef9['emit'](_0x44546e(0x92)+_0x3685b2+_0x44546e(0x95),{'action':_0x44546e(0xa2),'chat':_0x324f5}),_0x53375c[_0x44546e(0xa6)](_0x324f5);};exports['checkAsRead']=checkAsRead;const messages=async(_0x1c3487,_0x1b127c)=>{const _0x3aa5fb=a11_0x763474,{pageNumber:_0x151b1f}=_0x1c3487['query'],{id:_0x25272c}=_0x1c3487['params'],_0x498550=+_0x1c3487[_0x3aa5fb(0x96)]['id'],{records:_0x2b76d4,count:_0x54cda1,hasMore:_0x21ec06}=await(0x0,FindMessages_1[_0x3aa5fb(0x86)])({'chatId':_0x25272c,'ownerId':_0x498550,'pageNumber':_0x151b1f});return _0x1b127c[_0x3aa5fb(0xa6)]({'records':_0x2b76d4,'count':_0x54cda1,'hasMore':_0x21ec06});};exports[a11_0x763474(0x87)]=messages;