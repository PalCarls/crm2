'use strict';const a11_0x21c4f5=a11_0x1213;(function(_0x4aad09,_0x1237dd){const _0x10e419=a11_0x1213,_0x4273d0=_0x4aad09();while(!![]){try{const _0x636649=-parseInt(_0x10e419(0x153))/0x1+parseInt(_0x10e419(0x178))/0x2+parseInt(_0x10e419(0x165))/0x3*(parseInt(_0x10e419(0x17d))/0x4)+-parseInt(_0x10e419(0x177))/0x5*(parseInt(_0x10e419(0x14e))/0x6)+parseInt(_0x10e419(0x16c))/0x7*(parseInt(_0x10e419(0x160))/0x8)+-parseInt(_0x10e419(0x17e))/0x9*(-parseInt(_0x10e419(0x15d))/0xa)+parseInt(_0x10e419(0x17b))/0xb;if(_0x636649===_0x1237dd)break;else _0x4273d0['push'](_0x4273d0['shift']());}catch(_0xff064a){_0x4273d0['push'](_0x4273d0['shift']());}}}(a11_0x208e,0x968b8));var __importDefault=this&&this['__importDefault']||function(_0x1eed64){return _0x1eed64&&_0x1eed64['__esModule']?_0x1eed64:{'default':_0x1eed64};};Object['defineProperty'](exports,a11_0x21c4f5(0x15c),{'value':!![]}),exports['messages']=exports[a11_0x21c4f5(0x163)]=exports[a11_0x21c4f5(0x156)]=exports[a11_0x21c4f5(0x16d)]=exports[a11_0x21c4f5(0x161)]=exports[a11_0x21c4f5(0x159)]=exports[a11_0x21c4f5(0x179)]=exports[a11_0x21c4f5(0x173)]=void 0x0;const socket_1=require(a11_0x21c4f5(0x152)),CreateService_1=__importDefault(require('../services/ChatService/CreateService')),ListService_1=__importDefault(require(a11_0x21c4f5(0x16a))),ShowFromUuidService_1=__importDefault(require(a11_0x21c4f5(0x169))),DeleteService_1=__importDefault(require(a11_0x21c4f5(0x172))),FindMessages_1=__importDefault(require(a11_0x21c4f5(0x168))),UpdateService_1=__importDefault(require(a11_0x21c4f5(0x166))),Chat_1=__importDefault(require('../models/Chat')),CreateMessageService_1=__importDefault(require(a11_0x21c4f5(0x17c))),User_1=__importDefault(require(a11_0x21c4f5(0x17a))),ChatUser_1=__importDefault(require('../models/ChatUser')),index=async(_0x336a6d,_0xfa485)=>{const _0x41097e=a11_0x21c4f5,{pageNumber:_0x4d5449}=_0x336a6d[_0x41097e(0x150)],_0x51333f=+_0x336a6d[_0x41097e(0x176)]['id'],{records:_0x2bf775,count:_0x17a08f,hasMore:_0x1c90f1}=await(0x0,ListService_1[_0x41097e(0x158)])({'ownerId':_0x51333f,'pageNumber':_0x4d5449});return _0xfa485[_0x41097e(0x171)]({'records':_0x2bf775,'count':_0x17a08f,'hasMore':_0x1c90f1});};exports[a11_0x21c4f5(0x173)]=index;const store=async(_0x56cf8d,_0x365b43)=>{const _0x54df5b=a11_0x21c4f5,{companyId:_0x1149d1}=_0x56cf8d[_0x54df5b(0x176)],_0x572034=+_0x56cf8d[_0x54df5b(0x176)]['id'],_0x2cdab1=_0x56cf8d[_0x54df5b(0x15a)],_0x486b57=await(0x0,CreateService_1[_0x54df5b(0x158)])({..._0x2cdab1,'ownerId':_0x572034,'companyId':_0x1149d1}),_0xb0ab1f=(0x0,socket_1[_0x54df5b(0x151)])();return _0x486b57[_0x54df5b(0x15f)][_0x54df5b(0x170)](_0x582612=>{const _0x40142c=_0x54df5b;_0xb0ab1f[_0x40142c(0x15b)](_0x40142c(0x167)+_0x1149d1+_0x40142c(0x15e)+_0x582612['userId'],{'action':_0x40142c(0x16e),'record':_0x486b57});}),_0x365b43[_0x54df5b(0x174)](0xc8)[_0x54df5b(0x171)](_0x486b57);};exports['store']=store;const update=async(_0x5a826c,_0x876788)=>{const _0x277d1b=a11_0x21c4f5,{companyId:_0x529268}=_0x5a826c[_0x277d1b(0x176)],_0x45e96e=_0x5a826c[_0x277d1b(0x15a)],{id:_0x18010b}=_0x5a826c[_0x277d1b(0x16f)],_0x11ca4f=await(0x0,UpdateService_1[_0x277d1b(0x158)])({..._0x45e96e,'id':+_0x18010b}),_0x1db354=(0x0,socket_1[_0x277d1b(0x151)])();return _0x11ca4f[_0x277d1b(0x15f)][_0x277d1b(0x170)](_0x52bfe9=>{const _0x11e6f2=_0x277d1b;_0x1db354[_0x11e6f2(0x15b)](_0x11e6f2(0x167)+_0x529268+'-chat-user-'+_0x52bfe9[_0x11e6f2(0x154)],{'action':_0x11e6f2(0x159),'record':_0x11ca4f});}),_0x876788['status'](0xc8)['json'](_0x11ca4f);};exports[a11_0x21c4f5(0x159)]=update;const show=async(_0xdf82cc,_0x3b1ac5)=>{const _0x552aaf=a11_0x21c4f5,{id:_0x41e3be}=_0xdf82cc['params'],_0x42f3d1=await(0x0,ShowFromUuidService_1[_0x552aaf(0x158)])(_0x41e3be);return _0x3b1ac5[_0x552aaf(0x174)](0xc8)[_0x552aaf(0x171)](_0x42f3d1);};exports[a11_0x21c4f5(0x161)]=show;const remove=async(_0x3a6e6f,_0x46b64b)=>{const _0xa378a1=a11_0x21c4f5,{id:_0x38950a}=_0x3a6e6f['params'],{companyId:_0x116f35}=_0x3a6e6f[_0xa378a1(0x176)];await(0x0,DeleteService_1[_0xa378a1(0x158)])(_0x38950a);const _0x274e65=(0x0,socket_1['getIO'])();return _0x274e65[_0xa378a1(0x15b)]('company-'+_0x116f35+_0xa378a1(0x162),{'action':_0xa378a1(0x155),'id':_0x38950a}),_0x46b64b[_0xa378a1(0x174)](0xc8)['json']({'message':_0xa378a1(0x164)});};exports['remove']=remove;function a11_0x208e(){const _0x455fe1=['__esModule','10xSybQe','-chat-user-','users','417128xDYKMt','show','-chat','checkAsRead','Chat\x20deleted','940197HKQVyZ','../services/ChatService/UpdateService','company-','../services/ChatService/FindMessages','../services/ChatService/ShowFromUuidService','../services/ChatService/ListService','messages','21vbaaAV','remove','create','params','forEach','json','../services/ChatService/DeleteService','index','status','new-message','user','22585LLwVSb','1008562CPVWFM','store','../models/User','5643000YkkahN','../services/ChatService/CreateMessageService','8sdqkvv','1942965eUjVYX','1290RXQqGV','owner','query','getIO','../libs/socket','428600hNgRou','userId','delete','saveMessage','findByPk','default','update','body','emit'];a11_0x208e=function(){return _0x455fe1;};return a11_0x208e();}const saveMessage=async(_0x3576a6,_0x1d7a69)=>{const _0x157af1=a11_0x21c4f5,{companyId:_0x1a92fe}=_0x3576a6['user'],{message:_0x396eec}=_0x3576a6[_0x157af1(0x15a)],{id:_0x146e9f}=_0x3576a6[_0x157af1(0x16f)],_0xb140f5=+_0x3576a6[_0x157af1(0x176)]['id'],_0x3155b5=+_0x146e9f,_0x358295=await(0x0,CreateMessageService_1['default'])({'chatId':_0x3155b5,'senderId':_0xb140f5,'message':_0x396eec}),_0x5851d2=await Chat_1[_0x157af1(0x158)][_0x157af1(0x157)](_0x3155b5,{'include':[{'model':User_1[_0x157af1(0x158)],'as':_0x157af1(0x14f)},{'model':ChatUser_1[_0x157af1(0x158)],'as':'users'}]}),_0x287448=(0x0,socket_1['getIO'])();return _0x287448[_0x157af1(0x15b)]('company-'+_0x1a92fe+'-chat-'+_0x3155b5,{'action':_0x157af1(0x175),'newMessage':_0x358295,'chat':_0x5851d2}),_0x287448[_0x157af1(0x15b)](_0x157af1(0x167)+_0x1a92fe+_0x157af1(0x162),{'action':'new-message','newMessage':_0x358295,'chat':_0x5851d2}),_0x1d7a69[_0x157af1(0x171)](_0x358295);};exports[a11_0x21c4f5(0x156)]=saveMessage;const checkAsRead=async(_0x178328,_0x49b6c9)=>{const _0x5e65b5=a11_0x21c4f5,{companyId:_0x3854d5}=_0x178328[_0x5e65b5(0x176)],{userId:_0x1283da}=_0x178328[_0x5e65b5(0x15a)],{id:_0x7ca1db}=_0x178328[_0x5e65b5(0x16f)],_0x4afc2a=await ChatUser_1['default']['findOne']({'where':{'chatId':_0x7ca1db,'userId':_0x1283da}});await _0x4afc2a[_0x5e65b5(0x159)]({'unreads':0x0});const _0x39e69d=await Chat_1[_0x5e65b5(0x158)][_0x5e65b5(0x157)](_0x7ca1db,{'include':[{'model':User_1[_0x5e65b5(0x158)],'as':_0x5e65b5(0x14f)},{'model':ChatUser_1[_0x5e65b5(0x158)],'as':_0x5e65b5(0x15f)}]}),_0x2fccdf=(0x0,socket_1[_0x5e65b5(0x151)])();return _0x2fccdf[_0x5e65b5(0x15b)](_0x5e65b5(0x167)+_0x3854d5+'-chat-'+_0x7ca1db,{'action':_0x5e65b5(0x159),'chat':_0x39e69d}),_0x2fccdf[_0x5e65b5(0x15b)](_0x5e65b5(0x167)+_0x3854d5+_0x5e65b5(0x162),{'action':'update','chat':_0x39e69d}),_0x49b6c9[_0x5e65b5(0x171)](_0x39e69d);};exports['checkAsRead']=checkAsRead;function a11_0x1213(_0x464c96,_0x51cb9a){const _0x208eb2=a11_0x208e();return a11_0x1213=function(_0x1213ae,_0x427965){_0x1213ae=_0x1213ae-0x14e;let _0x33826b=_0x208eb2[_0x1213ae];return _0x33826b;},a11_0x1213(_0x464c96,_0x51cb9a);}const messages=async(_0x104c26,_0xf93c32)=>{const _0x4811af=a11_0x21c4f5,{pageNumber:_0x3ece4e}=_0x104c26['query'],{id:_0x48ee60}=_0x104c26[_0x4811af(0x16f)],_0x5220da=+_0x104c26[_0x4811af(0x176)]['id'],{records:_0x50a518,count:_0x29dbb6,hasMore:_0x562b58}=await(0x0,FindMessages_1[_0x4811af(0x158)])({'chatId':_0x48ee60,'ownerId':_0x5220da,'pageNumber':_0x3ece4e});return _0xf93c32[_0x4811af(0x171)]({'records':_0x50a518,'count':_0x29dbb6,'hasMore':_0x562b58});};exports[a11_0x21c4f5(0x16b)]=messages;