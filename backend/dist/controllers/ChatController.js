'use strict';const a11_0x11faff=a11_0x4e9d;(function(_0x563850,_0x35e6b9){const _0x58bcf0=a11_0x4e9d,_0x437a8f=_0x563850();while(!![]){try{const _0x5108a5=parseInt(_0x58bcf0(0x1ac))/0x1+-parseInt(_0x58bcf0(0x19e))/0x2+-parseInt(_0x58bcf0(0x1b9))/0x3*(-parseInt(_0x58bcf0(0x1a4))/0x4)+parseInt(_0x58bcf0(0x1a0))/0x5+-parseInt(_0x58bcf0(0x1ae))/0x6+-parseInt(_0x58bcf0(0x1c1))/0x7+parseInt(_0x58bcf0(0x1b1))/0x8;if(_0x5108a5===_0x35e6b9)break;else _0x437a8f['push'](_0x437a8f['shift']());}catch(_0x370ec4){_0x437a8f['push'](_0x437a8f['shift']());}}}(a11_0x4266,0xadc51));var __importDefault=this&&this[a11_0x11faff(0x197)]||function(_0x3cb65c){const _0x1868af=a11_0x11faff;return _0x3cb65c&&_0x3cb65c[_0x1868af(0x1b4)]?_0x3cb65c:{'default':_0x3cb65c};};Object[a11_0x11faff(0x195)](exports,a11_0x11faff(0x1b4),{'value':!![]}),exports['messages']=exports[a11_0x11faff(0x1aa)]=exports['saveMessage']=exports[a11_0x11faff(0x199)]=exports[a11_0x11faff(0x198)]=exports['update']=exports[a11_0x11faff(0x1bd)]=exports['index']=void 0x0;const socket_1=require(a11_0x11faff(0x19c)),CreateService_1=__importDefault(require('../services/ChatService/CreateService')),ListService_1=__importDefault(require(a11_0x11faff(0x1bf))),ShowFromUuidService_1=__importDefault(require(a11_0x11faff(0x1ad))),DeleteService_1=__importDefault(require(a11_0x11faff(0x1b2))),FindMessages_1=__importDefault(require(a11_0x11faff(0x1a6))),UpdateService_1=__importDefault(require(a11_0x11faff(0x1a7))),Chat_1=__importDefault(require(a11_0x11faff(0x19b))),CreateMessageService_1=__importDefault(require('../services/ChatService/CreateMessageService')),User_1=__importDefault(require(a11_0x11faff(0x19f))),ChatUser_1=__importDefault(require('../models/ChatUser')),index=async(_0x8f8748,_0x453d65)=>{const _0x5024df=a11_0x11faff,{pageNumber:_0x3e3244}=_0x8f8748[_0x5024df(0x1c2)],_0x57f6d1=+_0x8f8748[_0x5024df(0x1b8)]['id'],{records:_0x1738fb,count:_0x3cbf99,hasMore:_0x51e485}=await(0x0,ListService_1[_0x5024df(0x1af)])({'ownerId':_0x57f6d1,'pageNumber':_0x3e3244});return _0x453d65[_0x5024df(0x1b3)]({'records':_0x1738fb,'count':_0x3cbf99,'hasMore':_0x51e485});};exports[a11_0x11faff(0x1c0)]=index;const store=async(_0x4fb733,_0x2963da)=>{const _0x20d2f5=a11_0x11faff,{companyId:_0xf78873}=_0x4fb733[_0x20d2f5(0x1b8)],_0x16f54e=+_0x4fb733[_0x20d2f5(0x1b8)]['id'],_0x16dde1=_0x4fb733['body'],_0x2ec434=await(0x0,CreateService_1[_0x20d2f5(0x1af)])({..._0x16dde1,'ownerId':_0x16f54e,'companyId':_0xf78873}),_0x52f861=(0x0,socket_1[_0x20d2f5(0x1b7)])();return _0x2ec434['users'][_0x20d2f5(0x19a)](_0x1db881=>{const _0xf2d4f5=_0x20d2f5;_0x52f861[_0xf2d4f5(0x1ba)]('company-'+_0xf78873+_0xf2d4f5(0x1a8)+_0x1db881['userId'],{'action':'create','record':_0x2ec434});}),_0x2963da[_0x20d2f5(0x196)](0xc8)[_0x20d2f5(0x1b3)](_0x2ec434);};exports[a11_0x11faff(0x1bd)]=store;const update=async(_0x1c4288,_0x306b0f)=>{const _0x5d5e9e=a11_0x11faff,{companyId:_0x67ce3f}=_0x1c4288[_0x5d5e9e(0x1b8)],_0x1a85df=_0x1c4288[_0x5d5e9e(0x1a9)],{id:_0x56a314}=_0x1c4288[_0x5d5e9e(0x1b5)],_0x24973e=await(0x0,UpdateService_1['default'])({..._0x1a85df,'id':+_0x56a314}),_0x412cab=(0x0,socket_1[_0x5d5e9e(0x1b7)])();return _0x24973e[_0x5d5e9e(0x1a2)][_0x5d5e9e(0x19a)](_0x4c5c48=>{const _0x57a0fe=_0x5d5e9e;_0x412cab['emit']('company-'+_0x67ce3f+_0x57a0fe(0x1a8)+_0x4c5c48[_0x57a0fe(0x1b6)],{'action':_0x57a0fe(0x1a5),'record':_0x24973e});}),_0x306b0f[_0x5d5e9e(0x196)](0xc8)[_0x5d5e9e(0x1b3)](_0x24973e);};function a11_0x4266(){const _0x1a8c3b=['-chat-','1044428yYrVAX','update','../services/ChatService/FindMessages','../services/ChatService/UpdateService','-chat-user-','body','checkAsRead','Chat\x20deleted','1375463JdluYJ','../services/ChatService/ShowFromUuidService','8251854lcggQo','default','-chat','13232736NrdvXQ','../services/ChatService/DeleteService','json','__esModule','params','userId','getIO','user','6tnhYAg','emit','new-message','findByPk','store','saveMessage','../services/ChatService/ListService','index','5611900qJtvCX','query','defineProperty','status','__importDefault','show','remove','forEach','../models/Chat','../libs/socket','company-','1843936fGjOdQ','../models/User','1294845VbdMrB','owner','users'];a11_0x4266=function(){return _0x1a8c3b;};return a11_0x4266();}exports[a11_0x11faff(0x1a5)]=update;const show=async(_0x20fd32,_0xd55512)=>{const _0x2a1587=a11_0x11faff,{id:_0x4034ee}=_0x20fd32[_0x2a1587(0x1b5)],_0x220846=await(0x0,ShowFromUuidService_1[_0x2a1587(0x1af)])(_0x4034ee);return _0xd55512[_0x2a1587(0x196)](0xc8)[_0x2a1587(0x1b3)](_0x220846);};exports['show']=show;const remove=async(_0x315b5d,_0x16e790)=>{const _0x3259cb=a11_0x11faff,{id:_0x2fcda2}=_0x315b5d[_0x3259cb(0x1b5)],{companyId:_0x2aa146}=_0x315b5d[_0x3259cb(0x1b8)];await(0x0,DeleteService_1[_0x3259cb(0x1af)])(_0x2fcda2);const _0x4d7cf7=(0x0,socket_1[_0x3259cb(0x1b7)])();return _0x4d7cf7[_0x3259cb(0x1ba)](_0x3259cb(0x19d)+_0x2aa146+_0x3259cb(0x1b0),{'action':'delete','id':_0x2fcda2}),_0x16e790[_0x3259cb(0x196)](0xc8)['json']({'message':_0x3259cb(0x1ab)});};exports[a11_0x11faff(0x199)]=remove;const saveMessage=async(_0x5a3147,_0x5217d7)=>{const _0x3474af=a11_0x11faff,{companyId:_0x479070}=_0x5a3147[_0x3474af(0x1b8)],{message:_0x1ed5d4}=_0x5a3147['body'],{id:_0x523a6c}=_0x5a3147[_0x3474af(0x1b5)],_0x630f9f=+_0x5a3147[_0x3474af(0x1b8)]['id'],_0x205d71=+_0x523a6c,_0xa2c4fd=await(0x0,CreateMessageService_1[_0x3474af(0x1af)])({'chatId':_0x205d71,'senderId':_0x630f9f,'message':_0x1ed5d4}),_0x1130af=await Chat_1[_0x3474af(0x1af)][_0x3474af(0x1bc)](_0x205d71,{'include':[{'model':User_1[_0x3474af(0x1af)],'as':_0x3474af(0x1a1)},{'model':ChatUser_1[_0x3474af(0x1af)],'as':'users'}]}),_0x1cbe6c=(0x0,socket_1[_0x3474af(0x1b7)])();return _0x1cbe6c[_0x3474af(0x1ba)]('company-'+_0x479070+'-chat-'+_0x205d71,{'action':_0x3474af(0x1bb),'newMessage':_0xa2c4fd,'chat':_0x1130af}),_0x1cbe6c[_0x3474af(0x1ba)](_0x3474af(0x19d)+_0x479070+'-chat',{'action':_0x3474af(0x1bb),'newMessage':_0xa2c4fd,'chat':_0x1130af}),_0x5217d7['json'](_0xa2c4fd);};exports[a11_0x11faff(0x1be)]=saveMessage;const checkAsRead=async(_0x24cbe9,_0x5db9d4)=>{const _0x1a607a=a11_0x11faff,{companyId:_0x19955b}=_0x24cbe9[_0x1a607a(0x1b8)],{userId:_0x4b9e58}=_0x24cbe9[_0x1a607a(0x1a9)],{id:_0x45b355}=_0x24cbe9['params'],_0x550fc3=await ChatUser_1[_0x1a607a(0x1af)]['findOne']({'where':{'chatId':_0x45b355,'userId':_0x4b9e58}});await _0x550fc3[_0x1a607a(0x1a5)]({'unreads':0x0});const _0x1ab994=await Chat_1[_0x1a607a(0x1af)][_0x1a607a(0x1bc)](_0x45b355,{'include':[{'model':User_1[_0x1a607a(0x1af)],'as':_0x1a607a(0x1a1)},{'model':ChatUser_1[_0x1a607a(0x1af)],'as':_0x1a607a(0x1a2)}]}),_0x291adf=(0x0,socket_1[_0x1a607a(0x1b7)])();return _0x291adf[_0x1a607a(0x1ba)]('company-'+_0x19955b+_0x1a607a(0x1a3)+_0x45b355,{'action':_0x1a607a(0x1a5),'chat':_0x1ab994}),_0x291adf['emit'](_0x1a607a(0x19d)+_0x19955b+'-chat',{'action':_0x1a607a(0x1a5),'chat':_0x1ab994}),_0x5db9d4[_0x1a607a(0x1b3)](_0x1ab994);};exports[a11_0x11faff(0x1aa)]=checkAsRead;function a11_0x4e9d(_0x2e87f3,_0x372acc){const _0x426671=a11_0x4266();return a11_0x4e9d=function(_0x4e9d7a,_0x58e23b){_0x4e9d7a=_0x4e9d7a-0x195;let _0x510187=_0x426671[_0x4e9d7a];return _0x510187;},a11_0x4e9d(_0x2e87f3,_0x372acc);}const messages=async(_0x19ccd6,_0x254c21)=>{const _0x2be8e2=a11_0x11faff,{pageNumber:_0x5d9847}=_0x19ccd6[_0x2be8e2(0x1c2)],{id:_0x2acec6}=_0x19ccd6[_0x2be8e2(0x1b5)],_0x50b0d2=+_0x19ccd6[_0x2be8e2(0x1b8)]['id'],{records:_0x4d7351,count:_0x3ac25b,hasMore:_0x49121a}=await(0x0,FindMessages_1[_0x2be8e2(0x1af)])({'chatId':_0x2acec6,'ownerId':_0x50b0d2,'pageNumber':_0x5d9847});return _0x254c21[_0x2be8e2(0x1b3)]({'records':_0x4d7351,'count':_0x3ac25b,'hasMore':_0x49121a});};exports['messages']=messages;