'use strict';const a11_0x1fb4f3=a11_0x45d1;(function(_0x203578,_0xaadc56){const _0x2ad910=a11_0x45d1,_0x1e8001=_0x203578();while(!![]){try{const _0x767240=parseInt(_0x2ad910(0x1bf))/0x1*(-parseInt(_0x2ad910(0x19d))/0x2)+parseInt(_0x2ad910(0x1c4))/0x3+parseInt(_0x2ad910(0x1ba))/0x4*(-parseInt(_0x2ad910(0x1a7))/0x5)+parseInt(_0x2ad910(0x195))/0x6*(parseInt(_0x2ad910(0x1bc))/0x7)+parseInt(_0x2ad910(0x1b1))/0x8+parseInt(_0x2ad910(0x1a9))/0x9*(parseInt(_0x2ad910(0x1b8))/0xa)+-parseInt(_0x2ad910(0x1a8))/0xb;if(_0x767240===_0xaadc56)break;else _0x1e8001['push'](_0x1e8001['shift']());}catch(_0x129429){_0x1e8001['push'](_0x1e8001['shift']());}}}(a11_0x5ec8,0xe50cf));var __importDefault=this&&this[a11_0x1fb4f3(0x1c1)]||function(_0x52a2c0){return _0x52a2c0&&_0x52a2c0['__esModule']?_0x52a2c0:{'default':_0x52a2c0};};function a11_0x45d1(_0x45a332,_0x1a6f9c){const _0x5ec8a4=a11_0x5ec8();return a11_0x45d1=function(_0x45d140,_0x1754ae){_0x45d140=_0x45d140-0x193;let _0x1d67e5=_0x5ec8a4[_0x45d140];return _0x1d67e5;},a11_0x45d1(_0x45a332,_0x1a6f9c);}Object[a11_0x1fb4f3(0x197)](exports,a11_0x1fb4f3(0x199),{'value':!![]}),exports['messages']=exports[a11_0x1fb4f3(0x1ad)]=exports[a11_0x1fb4f3(0x1b4)]=exports[a11_0x1fb4f3(0x1af)]=exports[a11_0x1fb4f3(0x1b5)]=exports[a11_0x1fb4f3(0x1c0)]=exports[a11_0x1fb4f3(0x1b2)]=exports[a11_0x1fb4f3(0x1c3)]=void 0x0;const socket_1=require('../libs/socket'),CreateService_1=__importDefault(require(a11_0x1fb4f3(0x1ae))),ListService_1=__importDefault(require(a11_0x1fb4f3(0x1aa))),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require('../services/ChatService/FindMessages')),UpdateService_1=__importDefault(require(a11_0x1fb4f3(0x1ab))),Chat_1=__importDefault(require(a11_0x1fb4f3(0x1bd))),CreateMessageService_1=__importDefault(require(a11_0x1fb4f3(0x19b))),User_1=__importDefault(require(a11_0x1fb4f3(0x193))),ChatUser_1=__importDefault(require(a11_0x1fb4f3(0x194))),index=async(_0x2a7e74,_0x21f246)=>{const _0x4b255d=a11_0x1fb4f3,{pageNumber:_0xd03a47}=_0x2a7e74[_0x4b255d(0x1b7)],_0x207359=+_0x2a7e74['user']['id'],{records:_0x11d479,count:_0x3e509b,hasMore:_0x11c917}=await(0x0,ListService_1[_0x4b255d(0x1a3)])({'ownerId':_0x207359,'pageNumber':_0xd03a47});return _0x21f246[_0x4b255d(0x19a)]({'records':_0x11d479,'count':_0x3e509b,'hasMore':_0x11c917});};exports[a11_0x1fb4f3(0x1c3)]=index;const store=async(_0xd8b1f7,_0x33b26b)=>{const _0x25dc83=a11_0x1fb4f3,{companyId:_0x196fb6}=_0xd8b1f7[_0x25dc83(0x1bb)],_0x4bdefc=+_0xd8b1f7[_0x25dc83(0x1bb)]['id'],_0x35f8ff=_0xd8b1f7[_0x25dc83(0x1ac)],_0x2fe274=await(0x0,CreateService_1['default'])({..._0x35f8ff,'ownerId':_0x4bdefc,'companyId':_0x196fb6}),_0x3bdccf=(0x0,socket_1[_0x25dc83(0x19c)])();return _0x2fe274[_0x25dc83(0x1b0)][_0x25dc83(0x1a2)](_0x26f15f=>{const _0x20a900=_0x25dc83;_0x3bdccf[_0x20a900(0x1a6)](_0x20a900(0x19e)+_0x196fb6+_0x20a900(0x1a5)+_0x26f15f[_0x20a900(0x196)],{'action':_0x20a900(0x1c2),'record':_0x2fe274});}),_0x33b26b[_0x25dc83(0x1a1)](0xc8)[_0x25dc83(0x19a)](_0x2fe274);};exports['store']=store;const update=async(_0x3a4b29,_0x52d68c)=>{const _0x2e5fab=a11_0x1fb4f3,{companyId:_0x200b57}=_0x3a4b29['user'],_0x187780=_0x3a4b29['body'],{id:_0x440997}=_0x3a4b29[_0x2e5fab(0x1b9)],_0x2b5b86=await(0x0,UpdateService_1[_0x2e5fab(0x1a3)])({..._0x187780,'id':+_0x440997}),_0x406d4a=(0x0,socket_1[_0x2e5fab(0x19c)])();return _0x2b5b86[_0x2e5fab(0x1b0)][_0x2e5fab(0x1a2)](_0x156fc6=>{const _0x188d78=_0x2e5fab;_0x406d4a[_0x188d78(0x1a6)](_0x188d78(0x19e)+_0x200b57+_0x188d78(0x1a5)+_0x156fc6['userId'],{'action':_0x188d78(0x1c0),'record':_0x2b5b86});}),_0x52d68c[_0x2e5fab(0x1a1)](0xc8)[_0x2e5fab(0x19a)](_0x2b5b86);};exports['update']=update;const show=async(_0x27d112,_0x2035ef)=>{const _0x14457e=a11_0x1fb4f3,{id:_0x5aada2}=_0x27d112[_0x14457e(0x1b9)],_0x22552b=await(0x0,ShowFromUuidService_1[_0x14457e(0x1a3)])(_0x5aada2);return _0x2035ef[_0x14457e(0x1a1)](0xc8)[_0x14457e(0x19a)](_0x22552b);};exports['show']=show;const remove=async(_0x373bd2,_0x36af36)=>{const _0xefbf0c=a11_0x1fb4f3,{id:_0x38e3b6}=_0x373bd2[_0xefbf0c(0x1b9)],{companyId:_0x21f839}=_0x373bd2[_0xefbf0c(0x1bb)];await(0x0,DeleteService_1[_0xefbf0c(0x1a3)])(_0x38e3b6);const _0x36404a=(0x0,socket_1[_0xefbf0c(0x19c)])();return _0x36404a[_0xefbf0c(0x1a6)](_0xefbf0c(0x19e)+_0x21f839+'-chat',{'action':'delete','id':_0x38e3b6}),_0x36af36[_0xefbf0c(0x1a1)](0xc8)[_0xefbf0c(0x19a)]({'message':_0xefbf0c(0x198)});};exports[a11_0x1fb4f3(0x1af)]=remove;const saveMessage=async(_0x4f4498,_0x50892c)=>{const _0x4a8bf0=a11_0x1fb4f3,{companyId:_0x55f261}=_0x4f4498[_0x4a8bf0(0x1bb)],{message:_0x2f1fab}=_0x4f4498[_0x4a8bf0(0x1ac)],{id:_0x530918}=_0x4f4498[_0x4a8bf0(0x1b9)],_0x2b410a=+_0x4f4498['user']['id'],_0x4f8793=+_0x530918,_0x2c08b6=await(0x0,CreateMessageService_1[_0x4a8bf0(0x1a3)])({'chatId':_0x4f8793,'senderId':_0x2b410a,'message':_0x2f1fab}),_0x12c7e4=await Chat_1[_0x4a8bf0(0x1a3)][_0x4a8bf0(0x1a0)](_0x4f8793,{'include':[{'model':User_1[_0x4a8bf0(0x1a3)],'as':_0x4a8bf0(0x1b6)},{'model':ChatUser_1['default'],'as':_0x4a8bf0(0x1b0)}]}),_0x32a456=(0x0,socket_1[_0x4a8bf0(0x19c)])();return _0x32a456[_0x4a8bf0(0x1a6)](_0x4a8bf0(0x19e)+_0x55f261+'-chat-'+_0x4f8793,{'action':_0x4a8bf0(0x1a4),'newMessage':_0x2c08b6,'chat':_0x12c7e4}),_0x32a456[_0x4a8bf0(0x1a6)](_0x4a8bf0(0x19e)+_0x55f261+_0x4a8bf0(0x1b3),{'action':'new-message','newMessage':_0x2c08b6,'chat':_0x12c7e4}),_0x50892c[_0x4a8bf0(0x19a)](_0x2c08b6);};exports[a11_0x1fb4f3(0x1b4)]=saveMessage;const checkAsRead=async(_0x4e9b4f,_0x39b5c5)=>{const _0x5310cc=a11_0x1fb4f3,{companyId:_0x21b365}=_0x4e9b4f['user'],{userId:_0x2523d9}=_0x4e9b4f['body'],{id:_0x1b1aba}=_0x4e9b4f[_0x5310cc(0x1b9)],_0x110c3e=await ChatUser_1[_0x5310cc(0x1a3)]['findOne']({'where':{'chatId':_0x1b1aba,'userId':_0x2523d9}});await _0x110c3e[_0x5310cc(0x1c0)]({'unreads':0x0});const _0x2de881=await Chat_1[_0x5310cc(0x1a3)][_0x5310cc(0x1a0)](_0x1b1aba,{'include':[{'model':User_1[_0x5310cc(0x1a3)],'as':_0x5310cc(0x1b6)},{'model':ChatUser_1[_0x5310cc(0x1a3)],'as':'users'}]}),_0x355732=(0x0,socket_1['getIO'])();return _0x355732[_0x5310cc(0x1a6)](_0x5310cc(0x19e)+_0x21b365+_0x5310cc(0x19f)+_0x1b1aba,{'action':_0x5310cc(0x1c0),'chat':_0x2de881}),_0x355732[_0x5310cc(0x1a6)]('company-'+_0x21b365+_0x5310cc(0x1b3),{'action':_0x5310cc(0x1c0),'chat':_0x2de881}),_0x39b5c5[_0x5310cc(0x19a)](_0x2de881);};function a11_0x5ec8(){const _0x5b0a5=['56148WYIrYP','user','7xHIrJa','../models/Chat','messages','1YrRWVe','update','__importDefault','create','index','2491344TKtham','../models/User','../models/ChatUser','2336556MWleMb','userId','defineProperty','Chat\x20deleted','__esModule','json','../services/ChatService/CreateMessageService','getIO','20938Txnlzn','company-','-chat-','findByPk','status','forEach','default','new-message','-chat-user-','emit','290hXZXpj','8167995RFobpL','577503QwhpqO','../services/ChatService/ListService','../services/ChatService/UpdateService','body','checkAsRead','../services/ChatService/CreateService','remove','users','1557104XQLboQ','store','-chat','saveMessage','show','owner','query','170gNjszk','params'];a11_0x5ec8=function(){return _0x5b0a5;};return a11_0x5ec8();}exports[a11_0x1fb4f3(0x1ad)]=checkAsRead;const messages=async(_0x5d9378,_0x49856e)=>{const _0x37d48f=a11_0x1fb4f3,{pageNumber:_0x4b415d}=_0x5d9378[_0x37d48f(0x1b7)],{id:_0x446406}=_0x5d9378[_0x37d48f(0x1b9)],_0x1a4fcf=+_0x5d9378[_0x37d48f(0x1bb)]['id'],{records:_0x449985,count:_0x4a4629,hasMore:_0x42e487}=await(0x0,FindMessages_1['default'])({'chatId':_0x446406,'ownerId':_0x1a4fcf,'pageNumber':_0x4b415d});return _0x49856e[_0x37d48f(0x19a)]({'records':_0x449985,'count':_0x4a4629,'hasMore':_0x42e487});};exports[a11_0x1fb4f3(0x1be)]=messages;