'use strict';const a11_0x14689b=a11_0x37c6;(function(_0x1121fe,_0x486267){const _0x2ef3b4=a11_0x37c6,_0x7a43a1=_0x1121fe();while(!![]){try{const _0x2299f8=parseInt(_0x2ef3b4(0xde))/0x1*(parseInt(_0x2ef3b4(0xf3))/0x2)+-parseInt(_0x2ef3b4(0xdb))/0x3*(-parseInt(_0x2ef3b4(0xfc))/0x4)+parseInt(_0x2ef3b4(0xf2))/0x5+-parseInt(_0x2ef3b4(0xf0))/0x6+-parseInt(_0x2ef3b4(0xf5))/0x7*(parseInt(_0x2ef3b4(0xe5))/0x8)+parseInt(_0x2ef3b4(0xec))/0x9*(-parseInt(_0x2ef3b4(0xdc))/0xa)+parseInt(_0x2ef3b4(0xe8))/0xb*(parseInt(_0x2ef3b4(0xf1))/0xc);if(_0x2299f8===_0x486267)break;else _0x7a43a1['push'](_0x7a43a1['shift']());}catch(_0x28c995){_0x7a43a1['push'](_0x7a43a1['shift']());}}}(a11_0x1b6a,0x7d1f8));var __importDefault=this&&this[a11_0x14689b(0xe4)]||function(_0x24b188){const _0xb1f941=a11_0x14689b;return _0x24b188&&_0x24b188[_0xb1f941(0xf6)]?_0x24b188:{'default':_0x24b188};};Object[a11_0x14689b(0xf8)](exports,a11_0x14689b(0xf6),{'value':!![]}),exports[a11_0x14689b(0xd9)]=exports['checkAsRead']=exports['saveMessage']=exports[a11_0x14689b(0xe9)]=exports['show']=exports['update']=exports[a11_0x14689b(0xfe)]=exports[a11_0x14689b(0xce)]=void 0x0;const socket_1=require(a11_0x14689b(0xda)),CreateService_1=__importDefault(require(a11_0x14689b(0x100))),ListService_1=__importDefault(require(a11_0x14689b(0xe2))),ShowFromUuidService_1=__importDefault(require(a11_0x14689b(0xea))),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require(a11_0x14689b(0xe6))),UpdateService_1=__importDefault(require(a11_0x14689b(0xfb))),Chat_1=__importDefault(require(a11_0x14689b(0xf9))),CreateMessageService_1=__importDefault(require('../services/ChatService/CreateMessageService')),User_1=__importDefault(require(a11_0x14689b(0xfd))),ChatUser_1=__importDefault(require(a11_0x14689b(0xd1))),index=async(_0x1f6ae7,_0x1e97d6)=>{const _0x247f34=a11_0x14689b,{pageNumber:_0x19053e}=_0x1f6ae7[_0x247f34(0xe3)],_0x112fe1=+_0x1f6ae7[_0x247f34(0xff)]['id'],{records:_0x44906a,count:_0x8e394a,hasMore:_0x384b94}=await(0x0,ListService_1['default'])({'ownerId':_0x112fe1,'pageNumber':_0x19053e});return _0x1e97d6[_0x247f34(0xd6)]({'records':_0x44906a,'count':_0x8e394a,'hasMore':_0x384b94});};exports[a11_0x14689b(0xce)]=index;const store=async(_0x4e209b,_0x3937c7)=>{const _0x5484e9=a11_0x14689b,{companyId:_0x1713de}=_0x4e209b['user'],_0x154843=+_0x4e209b[_0x5484e9(0xff)]['id'],_0x45614d=_0x4e209b[_0x5484e9(0xd5)],_0x294e26=await(0x0,CreateService_1[_0x5484e9(0xd7)])({..._0x45614d,'ownerId':_0x154843,'companyId':_0x1713de}),_0x322bf2=(0x0,socket_1['getIO'])();return _0x294e26[_0x5484e9(0xed)][_0x5484e9(0xeb)](_0x17a061=>{const _0x3b2b5a=_0x5484e9;_0x322bf2[_0x3b2b5a(0xe0)](_0x3b2b5a(0xf4)+_0x1713de+_0x3b2b5a(0xef)+_0x17a061[_0x3b2b5a(0xe7)],{'action':'create','record':_0x294e26});}),_0x3937c7[_0x5484e9(0xdf)](0xc8)[_0x5484e9(0xd6)](_0x294e26);};exports[a11_0x14689b(0xfe)]=store;const update=async(_0x5bc586,_0x1e9e7d)=>{const _0x186b9e=a11_0x14689b,{companyId:_0x552bc8}=_0x5bc586[_0x186b9e(0xff)],_0x40d8bb=_0x5bc586['body'],{id:_0x206e7e}=_0x5bc586[_0x186b9e(0xcf)],_0x18c303=await(0x0,UpdateService_1[_0x186b9e(0xd7)])({..._0x40d8bb,'id':+_0x206e7e}),_0x50025d=(0x0,socket_1[_0x186b9e(0xd3)])();return _0x18c303[_0x186b9e(0xed)][_0x186b9e(0xeb)](_0x6f607b=>{const _0x189edf=_0x186b9e;_0x50025d['emit'](_0x189edf(0xf4)+_0x552bc8+_0x189edf(0xef)+_0x6f607b[_0x189edf(0xe7)],{'action':'update','record':_0x18c303});}),_0x1e9e7d[_0x186b9e(0xdf)](0xc8)[_0x186b9e(0xd6)](_0x18c303);};exports[a11_0x14689b(0xd2)]=update;const show=async(_0x47ec9f,_0x1f3b82)=>{const _0x2e82cf=a11_0x14689b,{id:_0x1b5293}=_0x47ec9f['params'],_0x501acb=await(0x0,ShowFromUuidService_1[_0x2e82cf(0xd7)])(_0x1b5293);return _0x1f3b82[_0x2e82cf(0xdf)](0xc8)['json'](_0x501acb);};exports[a11_0x14689b(0xcd)]=show;const remove=async(_0x548a57,_0x32e9f0)=>{const _0x44668f=a11_0x14689b,{id:_0x493744}=_0x548a57[_0x44668f(0xcf)],{companyId:_0x19c039}=_0x548a57['user'];await(0x0,DeleteService_1[_0x44668f(0xd7)])(_0x493744);const _0x5ceb8f=(0x0,socket_1[_0x44668f(0xd3)])();return _0x5ceb8f[_0x44668f(0xe0)](_0x44668f(0xf4)+_0x19c039+_0x44668f(0xd4),{'action':_0x44668f(0xfa),'id':_0x493744}),_0x32e9f0[_0x44668f(0xdf)](0xc8)['json']({'message':_0x44668f(0xdd)});};exports[a11_0x14689b(0xe9)]=remove;function a11_0x37c6(_0x5d38af,_0x4194e2){const _0x1b6abb=a11_0x1b6a();return a11_0x37c6=function(_0x37c666,_0x37e806){_0x37c666=_0x37c666-0xcc;let _0x481598=_0x1b6abb[_0x37c666];return _0x481598;},a11_0x37c6(_0x5d38af,_0x4194e2);}const saveMessage=async(_0x227092,_0x1f8935)=>{const _0x31b077=a11_0x14689b,{companyId:_0x2396fd}=_0x227092['user'],{message:_0x463192}=_0x227092[_0x31b077(0xd5)],{id:_0x300de4}=_0x227092[_0x31b077(0xcf)],_0x16f3aa=+_0x227092['user']['id'],_0x49238f=+_0x300de4,_0x296953=await(0x0,CreateMessageService_1[_0x31b077(0xd7)])({'chatId':_0x49238f,'senderId':_0x16f3aa,'message':_0x463192}),_0x228275=await Chat_1[_0x31b077(0xd7)]['findByPk'](_0x49238f,{'include':[{'model':User_1[_0x31b077(0xd7)],'as':_0x31b077(0xcc)},{'model':ChatUser_1['default'],'as':_0x31b077(0xed)}]}),_0x103232=(0x0,socket_1[_0x31b077(0xd3)])();return _0x103232[_0x31b077(0xe0)](_0x31b077(0xf4)+_0x2396fd+'-chat-'+_0x49238f,{'action':_0x31b077(0xee),'newMessage':_0x296953,'chat':_0x228275}),_0x103232['emit'](_0x31b077(0xf4)+_0x2396fd+'-chat',{'action':_0x31b077(0xee),'newMessage':_0x296953,'chat':_0x228275}),_0x1f8935[_0x31b077(0xd6)](_0x296953);};exports[a11_0x14689b(0xd0)]=saveMessage;const checkAsRead=async(_0x53b143,_0x57af1f)=>{const _0x1f6dcb=a11_0x14689b,{companyId:_0x29d8c9}=_0x53b143[_0x1f6dcb(0xff)],{userId:_0x1c8253}=_0x53b143[_0x1f6dcb(0xd5)],{id:_0x4da770}=_0x53b143[_0x1f6dcb(0xcf)],_0x2ef466=await ChatUser_1[_0x1f6dcb(0xd7)]['findOne']({'where':{'chatId':_0x4da770,'userId':_0x1c8253}});await _0x2ef466['update']({'unreads':0x0});const _0x24e898=await Chat_1[_0x1f6dcb(0xd7)][_0x1f6dcb(0xe1)](_0x4da770,{'include':[{'model':User_1['default'],'as':'owner'},{'model':ChatUser_1[_0x1f6dcb(0xd7)],'as':_0x1f6dcb(0xed)}]}),_0x157355=(0x0,socket_1[_0x1f6dcb(0xd3)])();return _0x157355[_0x1f6dcb(0xe0)](_0x1f6dcb(0xf4)+_0x29d8c9+_0x1f6dcb(0xd8)+_0x4da770,{'action':_0x1f6dcb(0xd2),'chat':_0x24e898}),_0x157355['emit'](_0x1f6dcb(0xf4)+_0x29d8c9+_0x1f6dcb(0xd4),{'action':_0x1f6dcb(0xd2),'chat':_0x24e898}),_0x57af1f[_0x1f6dcb(0xd6)](_0x24e898);};function a11_0x1b6a(){const _0x2f7524=['checkAsRead','defineProperty','../models/Chat','delete','../services/ChatService/UpdateService','464cCpUIa','../models/User','store','user','../services/ChatService/CreateService','owner','show','index','params','saveMessage','../models/ChatUser','update','getIO','-chat','body','json','default','-chat-','messages','../libs/socket','6081vSGmgY','50qdDSrT','Chat\x20deleted','1xSRmwy','status','emit','findByPk','../services/ChatService/ListService','query','__importDefault','356248TIlBNx','../services/ChatService/FindMessages','userId','44wKMRSQ','remove','../services/ChatService/ShowFromUuidService','forEach','247257tZFGxm','users','new-message','-chat-user-','5194482JmHDza','1479012nXOUUP','5086360UPEqaX','520098UjGAKA','company-','77aZlZWE','__esModule'];a11_0x1b6a=function(){return _0x2f7524;};return a11_0x1b6a();}exports[a11_0x14689b(0xf7)]=checkAsRead;const messages=async(_0x168aca,_0x5a19c7)=>{const _0x53d79b=a11_0x14689b,{pageNumber:_0x17affd}=_0x168aca['query'],{id:_0x34eec0}=_0x168aca[_0x53d79b(0xcf)],_0x592193=+_0x168aca[_0x53d79b(0xff)]['id'],{records:_0x56fe32,count:_0x2fa678,hasMore:_0x21181c}=await(0x0,FindMessages_1[_0x53d79b(0xd7)])({'chatId':_0x34eec0,'ownerId':_0x592193,'pageNumber':_0x17affd});return _0x5a19c7[_0x53d79b(0xd6)]({'records':_0x56fe32,'count':_0x2fa678,'hasMore':_0x21181c});};exports[a11_0x14689b(0xd9)]=messages;