'use strict';const a11_0x2189f0=a11_0x49fe;(function(_0x1b7bd1,_0xd96d3){const _0x34b3d6=a11_0x49fe,_0x11f342=_0x1b7bd1();while(!![]){try{const _0x575aeb=-parseInt(_0x34b3d6(0x1a0))/0x1*(-parseInt(_0x34b3d6(0x19d))/0x2)+-parseInt(_0x34b3d6(0x196))/0x3+parseInt(_0x34b3d6(0x19c))/0x4*(-parseInt(_0x34b3d6(0x1ad))/0x5)+-parseInt(_0x34b3d6(0x19b))/0x6*(-parseInt(_0x34b3d6(0x193))/0x7)+-parseInt(_0x34b3d6(0x181))/0x8*(-parseInt(_0x34b3d6(0x198))/0x9)+parseInt(_0x34b3d6(0x191))/0xa*(-parseInt(_0x34b3d6(0x1a9))/0xb)+parseInt(_0x34b3d6(0x18a))/0xc*(parseInt(_0x34b3d6(0x18e))/0xd);if(_0x575aeb===_0xd96d3)break;else _0x11f342['push'](_0x11f342['shift']());}catch(_0x4963bc){_0x11f342['push'](_0x11f342['shift']());}}}(a11_0x30d9,0x9c54b));var __importDefault=this&&this[a11_0x2189f0(0x185)]||function(_0x80dbfe){return _0x80dbfe&&_0x80dbfe['__esModule']?_0x80dbfe:{'default':_0x80dbfe};};Object[a11_0x2189f0(0x18c)](exports,'__esModule',{'value':!![]}),exports[a11_0x2189f0(0x1a2)]=exports['checkAsRead']=exports[a11_0x2189f0(0x1b1)]=exports[a11_0x2189f0(0x184)]=exports[a11_0x2189f0(0x186)]=exports[a11_0x2189f0(0x1a4)]=exports[a11_0x2189f0(0x1af)]=exports['index']=void 0x0;const socket_1=require(a11_0x2189f0(0x1a1)),CreateService_1=__importDefault(require(a11_0x2189f0(0x19f))),ListService_1=__importDefault(require('../services/ChatService/ListService')),ShowFromUuidService_1=__importDefault(require(a11_0x2189f0(0x182))),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require(a11_0x2189f0(0x1ac))),UpdateService_1=__importDefault(require(a11_0x2189f0(0x19a))),Chat_1=__importDefault(require(a11_0x2189f0(0x183))),CreateMessageService_1=__importDefault(require(a11_0x2189f0(0x1aa))),User_1=__importDefault(require(a11_0x2189f0(0x1a8))),ChatUser_1=__importDefault(require(a11_0x2189f0(0x194))),index=async(_0x5ddf32,_0x4e328a)=>{const _0x147802=a11_0x2189f0,{pageNumber:_0x30d8a2}=_0x5ddf32['query'],_0x48cbc1=+_0x5ddf32['user']['id'],{records:_0x5091e6,count:_0x161b50,hasMore:_0x34797a}=await(0x0,ListService_1[_0x147802(0x1a3)])({'ownerId':_0x48cbc1,'pageNumber':_0x30d8a2});return _0x4e328a[_0x147802(0x1b3)]({'records':_0x5091e6,'count':_0x161b50,'hasMore':_0x34797a});};exports[a11_0x2189f0(0x19e)]=index;const store=async(_0x23389f,_0x1ad8cc)=>{const _0x2c9846=a11_0x2189f0,{companyId:_0x59887d}=_0x23389f[_0x2c9846(0x189)],_0x15be4d=+_0x23389f[_0x2c9846(0x189)]['id'],_0x431ee0=_0x23389f['body'],_0x2230fc=await(0x0,CreateService_1['default'])({..._0x431ee0,'ownerId':_0x15be4d,'companyId':_0x59887d}),_0x459402=(0x0,socket_1[_0x2c9846(0x199)])();return _0x2230fc[_0x2c9846(0x18f)][_0x2c9846(0x187)](_0x3a2517=>{const _0x104702=_0x2c9846;_0x459402['emit']('company-'+_0x59887d+'-chat-user-'+_0x3a2517[_0x104702(0x192)],{'action':_0x104702(0x1ae),'record':_0x2230fc});}),_0x1ad8cc[_0x2c9846(0x1a6)](0xc8)[_0x2c9846(0x1b3)](_0x2230fc);};exports[a11_0x2189f0(0x1af)]=store;const update=async(_0x39fd76,_0x34c622)=>{const _0xc8ed77=a11_0x2189f0,{companyId:_0x2bc2c8}=_0x39fd76[_0xc8ed77(0x189)],_0x4a3a83=_0x39fd76[_0xc8ed77(0x190)],{id:_0x50ccde}=_0x39fd76[_0xc8ed77(0x197)],_0x216b0a=await(0x0,UpdateService_1[_0xc8ed77(0x1a3)])({..._0x4a3a83,'id':+_0x50ccde}),_0x3c7a9a=(0x0,socket_1[_0xc8ed77(0x199)])();return _0x216b0a[_0xc8ed77(0x18f)][_0xc8ed77(0x187)](_0x59157a=>{const _0x2a364f=_0xc8ed77;_0x3c7a9a['emit'](_0x2a364f(0x1b2)+_0x2bc2c8+_0x2a364f(0x1a5)+_0x59157a['userId'],{'action':'update','record':_0x216b0a});}),_0x34c622[_0xc8ed77(0x1a6)](0xc8)['json'](_0x216b0a);};exports[a11_0x2189f0(0x1a4)]=update;const show=async(_0x3284fc,_0x2d32dc)=>{const _0x790f14=a11_0x2189f0,{id:_0x480404}=_0x3284fc[_0x790f14(0x197)],_0x38c8ac=await(0x0,ShowFromUuidService_1['default'])(_0x480404);return _0x2d32dc['status'](0xc8)[_0x790f14(0x1b3)](_0x38c8ac);};function a11_0x30d9(){const _0x17e048=['../models/User','1499080EOJRJA','../services/ChatService/CreateMessageService','owner','../services/ChatService/FindMessages','2650660sgqynM','create','store','query','saveMessage','company-','json','8MyEcfm','../services/ChatService/ShowFromUuidService','../models/Chat','remove','__importDefault','show','forEach','-chat-','user','1948812gYSUAn','-chat','defineProperty','findByPk','39KkJjgl','users','body','40ZTjROh','userId','182FEoHOV','../models/ChatUser','checkAsRead','376659DHdVCu','params','9025416ZBefFv','getIO','../services/ChatService/UpdateService','1398WMrMFS','4SLgeTK','6IWLpyY','index','../services/ChatService/CreateService','115017jzGVfV','../libs/socket','messages','default','update','-chat-user-','status','emit'];a11_0x30d9=function(){return _0x17e048;};return a11_0x30d9();}exports[a11_0x2189f0(0x186)]=show;const remove=async(_0x50e537,_0x5ce265)=>{const _0x44d49e=a11_0x2189f0,{id:_0x1735bf}=_0x50e537['params'],{companyId:_0x1afb8f}=_0x50e537[_0x44d49e(0x189)];await(0x0,DeleteService_1[_0x44d49e(0x1a3)])(_0x1735bf);const _0x2dc036=(0x0,socket_1['getIO'])();return _0x2dc036['emit'](_0x44d49e(0x1b2)+_0x1afb8f+_0x44d49e(0x18b),{'action':'delete','id':_0x1735bf}),_0x5ce265[_0x44d49e(0x1a6)](0xc8)['json']({'message':'Chat\x20deleted'});};exports['remove']=remove;function a11_0x49fe(_0x3bafe8,_0xe9841f){const _0x30d9d7=a11_0x30d9();return a11_0x49fe=function(_0x49fe12,_0x30cde1){_0x49fe12=_0x49fe12-0x181;let _0xb9749f=_0x30d9d7[_0x49fe12];return _0xb9749f;},a11_0x49fe(_0x3bafe8,_0xe9841f);}const saveMessage=async(_0x509ddc,_0x504531)=>{const _0x3bca08=a11_0x2189f0,{companyId:_0x21db7f}=_0x509ddc['user'],{message:_0x1ad64f}=_0x509ddc[_0x3bca08(0x190)],{id:_0x48e22f}=_0x509ddc[_0x3bca08(0x197)],_0x3a08b3=+_0x509ddc['user']['id'],_0x1df52a=+_0x48e22f,_0x5ed089=await(0x0,CreateMessageService_1[_0x3bca08(0x1a3)])({'chatId':_0x1df52a,'senderId':_0x3a08b3,'message':_0x1ad64f}),_0x1f797f=await Chat_1['default'][_0x3bca08(0x18d)](_0x1df52a,{'include':[{'model':User_1[_0x3bca08(0x1a3)],'as':_0x3bca08(0x1ab)},{'model':ChatUser_1[_0x3bca08(0x1a3)],'as':_0x3bca08(0x18f)}]}),_0x2b3f58=(0x0,socket_1[_0x3bca08(0x199)])();return _0x2b3f58[_0x3bca08(0x1a7)](_0x3bca08(0x1b2)+_0x21db7f+_0x3bca08(0x188)+_0x1df52a,{'action':'new-message','newMessage':_0x5ed089,'chat':_0x1f797f}),_0x2b3f58['emit']('company-'+_0x21db7f+_0x3bca08(0x18b),{'action':'new-message','newMessage':_0x5ed089,'chat':_0x1f797f}),_0x504531[_0x3bca08(0x1b3)](_0x5ed089);};exports[a11_0x2189f0(0x1b1)]=saveMessage;const checkAsRead=async(_0x1019e9,_0x70e927)=>{const _0x18c0e4=a11_0x2189f0,{companyId:_0x43170c}=_0x1019e9[_0x18c0e4(0x189)],{userId:_0x163c80}=_0x1019e9[_0x18c0e4(0x190)],{id:_0x26e819}=_0x1019e9[_0x18c0e4(0x197)],_0x2bb710=await ChatUser_1[_0x18c0e4(0x1a3)]['findOne']({'where':{'chatId':_0x26e819,'userId':_0x163c80}});await _0x2bb710[_0x18c0e4(0x1a4)]({'unreads':0x0});const _0x4a8692=await Chat_1[_0x18c0e4(0x1a3)][_0x18c0e4(0x18d)](_0x26e819,{'include':[{'model':User_1['default'],'as':_0x18c0e4(0x1ab)},{'model':ChatUser_1[_0x18c0e4(0x1a3)],'as':_0x18c0e4(0x18f)}]}),_0x1e9f4c=(0x0,socket_1[_0x18c0e4(0x199)])();return _0x1e9f4c['emit'](_0x18c0e4(0x1b2)+_0x43170c+_0x18c0e4(0x188)+_0x26e819,{'action':_0x18c0e4(0x1a4),'chat':_0x4a8692}),_0x1e9f4c['emit']('company-'+_0x43170c+_0x18c0e4(0x18b),{'action':_0x18c0e4(0x1a4),'chat':_0x4a8692}),_0x70e927[_0x18c0e4(0x1b3)](_0x4a8692);};exports[a11_0x2189f0(0x195)]=checkAsRead;const messages=async(_0x2375b5,_0x2b5ee4)=>{const _0x5c52ca=a11_0x2189f0,{pageNumber:_0x4128b4}=_0x2375b5[_0x5c52ca(0x1b0)],{id:_0x19ee97}=_0x2375b5[_0x5c52ca(0x197)],_0x137e8a=+_0x2375b5['user']['id'],{records:_0x32824a,count:_0x17f61a,hasMore:_0x39b3e6}=await(0x0,FindMessages_1[_0x5c52ca(0x1a3)])({'chatId':_0x19ee97,'ownerId':_0x137e8a,'pageNumber':_0x4128b4});return _0x2b5ee4[_0x5c52ca(0x1b3)]({'records':_0x32824a,'count':_0x17f61a,'hasMore':_0x39b3e6});};exports[a11_0x2189f0(0x1a2)]=messages;