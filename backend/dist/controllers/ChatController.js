'use strict';const a11_0x5c9f53=a11_0x52d7;(function(_0x1dda93,_0x1a53be){const _0x2cdb8e=a11_0x52d7,_0xc939b0=_0x1dda93();while(!![]){try{const _0x3aae3c=-parseInt(_0x2cdb8e(0x91))/0x1*(-parseInt(_0x2cdb8e(0xa5))/0x2)+-parseInt(_0x2cdb8e(0x96))/0x3*(parseInt(_0x2cdb8e(0x7e))/0x4)+parseInt(_0x2cdb8e(0x8b))/0x5*(-parseInt(_0x2cdb8e(0x90))/0x6)+parseInt(_0x2cdb8e(0x87))/0x7+parseInt(_0x2cdb8e(0xa7))/0x8+parseInt(_0x2cdb8e(0x8a))/0x9+-parseInt(_0x2cdb8e(0x93))/0xa*(parseInt(_0x2cdb8e(0x7d))/0xb);if(_0x3aae3c===_0x1a53be)break;else _0xc939b0['push'](_0xc939b0['shift']());}catch(_0x2637c7){_0xc939b0['push'](_0xc939b0['shift']());}}}(a11_0x34c9,0x5eefb));var __importDefault=this&&this[a11_0x5c9f53(0x83)]||function(_0x59eaea){return _0x59eaea&&_0x59eaea['__esModule']?_0x59eaea:{'default':_0x59eaea};};Object['defineProperty'](exports,a11_0x5c9f53(0x86),{'value':!![]}),exports[a11_0x5c9f53(0xa8)]=exports[a11_0x5c9f53(0xa6)]=exports[a11_0x5c9f53(0x9f)]=exports['remove']=exports['show']=exports['update']=exports[a11_0x5c9f53(0x84)]=exports['index']=void 0x0;const socket_1=require(a11_0x5c9f53(0x9b)),CreateService_1=__importDefault(require(a11_0x5c9f53(0x99))),ListService_1=__importDefault(require(a11_0x5c9f53(0xa0))),ShowFromUuidService_1=__importDefault(require(a11_0x5c9f53(0x76))),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require(a11_0x5c9f53(0x79))),UpdateService_1=__importDefault(require(a11_0x5c9f53(0x8c))),Chat_1=__importDefault(require(a11_0x5c9f53(0x97))),CreateMessageService_1=__importDefault(require(a11_0x5c9f53(0x92))),User_1=__importDefault(require(a11_0x5c9f53(0x98))),ChatUser_1=__importDefault(require(a11_0x5c9f53(0x7a))),index=async(_0x1124db,_0x27998e)=>{const _0x365d83=a11_0x5c9f53,{pageNumber:_0x51d58b}=_0x1124db[_0x365d83(0x85)],_0x158f8d=+_0x1124db[_0x365d83(0x9e)]['id'],{records:_0x41c2b9,count:_0x288cd3,hasMore:_0x43bf98}=await(0x0,ListService_1[_0x365d83(0x9d)])({'ownerId':_0x158f8d,'pageNumber':_0x51d58b});return _0x27998e['json']({'records':_0x41c2b9,'count':_0x288cd3,'hasMore':_0x43bf98});};exports[a11_0x5c9f53(0x8e)]=index;const store=async(_0x45aa43,_0x26e07e)=>{const _0x1cf425=a11_0x5c9f53,{companyId:_0x2d2272}=_0x45aa43[_0x1cf425(0x9e)],_0x2f70f9=+_0x45aa43[_0x1cf425(0x9e)]['id'],_0x3fd174=_0x45aa43[_0x1cf425(0x77)],_0x5c5742=await(0x0,CreateService_1[_0x1cf425(0x9d)])({..._0x3fd174,'ownerId':_0x2f70f9,'companyId':_0x2d2272}),_0xf904ec=(0x0,socket_1[_0x1cf425(0xa1)])();return _0x5c5742['users'][_0x1cf425(0xa2)](_0x1cdc56=>{const _0x161f9e=_0x1cf425;_0xf904ec[_0x161f9e(0x95)]('company-'+_0x2d2272+'-chat-user-'+_0x1cdc56['userId'],{'action':'create','record':_0x5c5742});}),_0x26e07e[_0x1cf425(0x7b)](0xc8)[_0x1cf425(0xa3)](_0x5c5742);};exports[a11_0x5c9f53(0x84)]=store;const update=async(_0x492a04,_0x29aa3a)=>{const _0x3aa6a5=a11_0x5c9f53,{companyId:_0x41d837}=_0x492a04[_0x3aa6a5(0x9e)],_0x2fbe71=_0x492a04[_0x3aa6a5(0x77)],{id:_0x449906}=_0x492a04['params'],_0x1c6956=await(0x0,UpdateService_1['default'])({..._0x2fbe71,'id':+_0x449906}),_0x454c59=(0x0,socket_1[_0x3aa6a5(0xa1)])();return _0x1c6956[_0x3aa6a5(0x88)][_0x3aa6a5(0xa2)](_0x3afbce=>{const _0x13ac08=_0x3aa6a5;_0x454c59[_0x13ac08(0x95)](_0x13ac08(0x82)+_0x41d837+_0x13ac08(0x8d)+_0x3afbce[_0x13ac08(0x78)],{'action':_0x13ac08(0x81),'record':_0x1c6956});}),_0x29aa3a[_0x3aa6a5(0x7b)](0xc8)[_0x3aa6a5(0xa3)](_0x1c6956);};exports[a11_0x5c9f53(0x81)]=update;const show=async(_0x860558,_0x1c07ff)=>{const _0x54ee51=a11_0x5c9f53,{id:_0x3c81e6}=_0x860558[_0x54ee51(0x94)],_0x2d508b=await(0x0,ShowFromUuidService_1[_0x54ee51(0x9d)])(_0x3c81e6);return _0x1c07ff[_0x54ee51(0x7b)](0xc8)[_0x54ee51(0xa3)](_0x2d508b);};exports[a11_0x5c9f53(0x7f)]=show;function a11_0x34c9(){const _0x380893=['userId','../services/ChatService/FindMessages','../models/ChatUser','status','-chat','11CxCkTN','36bFgLey','show','new-message','update','company-','__importDefault','store','query','__esModule','76552jKDVMa','users','-chat-','3203991qJdars','1595lpUhvf','../services/ChatService/UpdateService','-chat-user-','index','Chat\x20deleted','7122NmErHr','1zRGDMC','../services/ChatService/CreateMessageService','2556740yVGVJO','params','emit','209091aTpfSl','../models/Chat','../models/User','../services/ChatService/CreateService','delete','../libs/socket','owner','default','user','saveMessage','../services/ChatService/ListService','getIO','forEach','json','findByPk','1461946njmITc','checkAsRead','4420408XvcQxq','messages','../services/ChatService/ShowFromUuidService','body'];a11_0x34c9=function(){return _0x380893;};return a11_0x34c9();}const remove=async(_0x457c66,_0x2f58d6)=>{const _0x3cb198=a11_0x5c9f53,{id:_0x1fcfc3}=_0x457c66[_0x3cb198(0x94)],{companyId:_0x1248cd}=_0x457c66[_0x3cb198(0x9e)];await(0x0,DeleteService_1[_0x3cb198(0x9d)])(_0x1fcfc3);const _0x34f4f5=(0x0,socket_1[_0x3cb198(0xa1)])();return _0x34f4f5['emit'](_0x3cb198(0x82)+_0x1248cd+'-chat',{'action':_0x3cb198(0x9a),'id':_0x1fcfc3}),_0x2f58d6['status'](0xc8)[_0x3cb198(0xa3)]({'message':_0x3cb198(0x8f)});};exports['remove']=remove;const saveMessage=async(_0xb04919,_0x2e2f24)=>{const _0x16268d=a11_0x5c9f53,{companyId:_0x331226}=_0xb04919[_0x16268d(0x9e)],{message:_0x4518a8}=_0xb04919[_0x16268d(0x77)],{id:_0x7c70a1}=_0xb04919['params'],_0x37c372=+_0xb04919[_0x16268d(0x9e)]['id'],_0x4621a5=+_0x7c70a1,_0x59d50c=await(0x0,CreateMessageService_1[_0x16268d(0x9d)])({'chatId':_0x4621a5,'senderId':_0x37c372,'message':_0x4518a8}),_0x202050=await Chat_1[_0x16268d(0x9d)][_0x16268d(0xa4)](_0x4621a5,{'include':[{'model':User_1[_0x16268d(0x9d)],'as':_0x16268d(0x9c)},{'model':ChatUser_1[_0x16268d(0x9d)],'as':'users'}]}),_0x180a38=(0x0,socket_1[_0x16268d(0xa1)])();return _0x180a38[_0x16268d(0x95)](_0x16268d(0x82)+_0x331226+'-chat-'+_0x4621a5,{'action':_0x16268d(0x80),'newMessage':_0x59d50c,'chat':_0x202050}),_0x180a38[_0x16268d(0x95)](_0x16268d(0x82)+_0x331226+_0x16268d(0x7c),{'action':'new-message','newMessage':_0x59d50c,'chat':_0x202050}),_0x2e2f24[_0x16268d(0xa3)](_0x59d50c);};function a11_0x52d7(_0x3ee031,_0x2d45c8){const _0x34c971=a11_0x34c9();return a11_0x52d7=function(_0x52d728,_0x51c732){_0x52d728=_0x52d728-0x76;let _0x323eb1=_0x34c971[_0x52d728];return _0x323eb1;},a11_0x52d7(_0x3ee031,_0x2d45c8);}exports[a11_0x5c9f53(0x9f)]=saveMessage;const checkAsRead=async(_0x409d93,_0x1c8950)=>{const _0x15958c=a11_0x5c9f53,{companyId:_0x46c62f}=_0x409d93[_0x15958c(0x9e)],{userId:_0xede70b}=_0x409d93[_0x15958c(0x77)],{id:_0xd37f45}=_0x409d93[_0x15958c(0x94)],_0x9f7ef0=await ChatUser_1[_0x15958c(0x9d)]['findOne']({'where':{'chatId':_0xd37f45,'userId':_0xede70b}});await _0x9f7ef0[_0x15958c(0x81)]({'unreads':0x0});const _0x4763de=await Chat_1[_0x15958c(0x9d)]['findByPk'](_0xd37f45,{'include':[{'model':User_1['default'],'as':'owner'},{'model':ChatUser_1[_0x15958c(0x9d)],'as':_0x15958c(0x88)}]}),_0x420707=(0x0,socket_1[_0x15958c(0xa1)])();return _0x420707[_0x15958c(0x95)](_0x15958c(0x82)+_0x46c62f+_0x15958c(0x89)+_0xd37f45,{'action':'update','chat':_0x4763de}),_0x420707[_0x15958c(0x95)](_0x15958c(0x82)+_0x46c62f+_0x15958c(0x7c),{'action':_0x15958c(0x81),'chat':_0x4763de}),_0x1c8950[_0x15958c(0xa3)](_0x4763de);};exports['checkAsRead']=checkAsRead;const messages=async(_0x4a7317,_0x11dbb9)=>{const _0x7eec54=a11_0x5c9f53,{pageNumber:_0x488f8a}=_0x4a7317['query'],{id:_0x1364ce}=_0x4a7317[_0x7eec54(0x94)],_0xd7961b=+_0x4a7317[_0x7eec54(0x9e)]['id'],{records:_0x43b7a2,count:_0x452e83,hasMore:_0xb96df5}=await(0x0,FindMessages_1['default'])({'chatId':_0x1364ce,'ownerId':_0xd7961b,'pageNumber':_0x488f8a});return _0x11dbb9['json']({'records':_0x43b7a2,'count':_0x452e83,'hasMore':_0xb96df5});};exports[a11_0x5c9f53(0xa8)]=messages;