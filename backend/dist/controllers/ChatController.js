'use strict';const a11_0x421db4=a11_0x327f;(function(_0x3a008d,_0x528be){const _0x2c9174=a11_0x327f,_0x3ec6b8=_0x3a008d();while(!![]){try{const _0x28dcc3=-parseInt(_0x2c9174(0x86))/0x1*(parseInt(_0x2c9174(0x8a))/0x2)+parseInt(_0x2c9174(0x6f))/0x3+-parseInt(_0x2c9174(0x71))/0x4*(-parseInt(_0x2c9174(0x90))/0x5)+parseInt(_0x2c9174(0x98))/0x6*(parseInt(_0x2c9174(0x9e))/0x7)+-parseInt(_0x2c9174(0x7a))/0x8*(-parseInt(_0x2c9174(0x74))/0x9)+parseInt(_0x2c9174(0x9c))/0xa+parseInt(_0x2c9174(0x77))/0xb*(-parseInt(_0x2c9174(0x78))/0xc);if(_0x28dcc3===_0x528be)break;else _0x3ec6b8['push'](_0x3ec6b8['shift']());}catch(_0x566901){_0x3ec6b8['push'](_0x3ec6b8['shift']());}}}(a11_0x3e6e,0xe458c));var __importDefault=this&&this['__importDefault']||function(_0x100167){const _0x2b35a3=a11_0x327f;return _0x100167&&_0x100167[_0x2b35a3(0x89)]?_0x100167:{'default':_0x100167};};Object[a11_0x421db4(0x8d)](exports,a11_0x421db4(0x89),{'value':!![]}),exports[a11_0x421db4(0x7f)]=exports[a11_0x421db4(0x8f)]=exports[a11_0x421db4(0x91)]=exports[a11_0x421db4(0x88)]=exports['show']=exports[a11_0x421db4(0x7c)]=exports['store']=exports[a11_0x421db4(0x72)]=void 0x0;const socket_1=require('../libs/socket'),CreateService_1=__importDefault(require(a11_0x421db4(0x95))),ListService_1=__importDefault(require(a11_0x421db4(0x7d))),ShowFromUuidService_1=__importDefault(require(a11_0x421db4(0x9d))),DeleteService_1=__importDefault(require(a11_0x421db4(0x9a))),FindMessages_1=__importDefault(require(a11_0x421db4(0x75))),UpdateService_1=__importDefault(require(a11_0x421db4(0x6d))),Chat_1=__importDefault(require(a11_0x421db4(0x81))),CreateMessageService_1=__importDefault(require(a11_0x421db4(0x76))),User_1=__importDefault(require('../models/User')),ChatUser_1=__importDefault(require(a11_0x421db4(0x8b))),index=async(_0x5b2536,_0x5dc248)=>{const _0x17b5c4=a11_0x421db4,{pageNumber:_0x12c21f}=_0x5b2536[_0x17b5c4(0x9f)],_0x10e464=+_0x5b2536[_0x17b5c4(0x79)]['id'],{records:_0x1f6886,count:_0x41a51b,hasMore:_0x2a7cce}=await(0x0,ListService_1[_0x17b5c4(0x7e)])({'ownerId':_0x10e464,'pageNumber':_0x12c21f});return _0x5dc248[_0x17b5c4(0x83)]({'records':_0x1f6886,'count':_0x41a51b,'hasMore':_0x2a7cce});};exports[a11_0x421db4(0x72)]=index;const store=async(_0x3c9675,_0x2263a8)=>{const _0xb4d23c=a11_0x421db4,{companyId:_0x5bd831}=_0x3c9675[_0xb4d23c(0x79)],_0xbed3b5=+_0x3c9675[_0xb4d23c(0x79)]['id'],_0x2adf1a=_0x3c9675[_0xb4d23c(0x94)],_0x8c231e=await(0x0,CreateService_1[_0xb4d23c(0x7e)])({..._0x2adf1a,'ownerId':_0xbed3b5,'companyId':_0x5bd831}),_0x140646=(0x0,socket_1[_0xb4d23c(0x9b)])();return _0x8c231e['users'][_0xb4d23c(0x8c)](_0xfd03b6=>{const _0x3713eb=_0xb4d23c;_0x140646[_0x3713eb(0x92)](_0x3713eb(0x85)+_0x5bd831+'-chat-user-'+_0xfd03b6[_0x3713eb(0x70)],{'action':_0x3713eb(0x7b),'record':_0x8c231e});}),_0x2263a8['status'](0xc8)[_0xb4d23c(0x83)](_0x8c231e);};exports[a11_0x421db4(0x97)]=store;const update=async(_0x239014,_0x3c34f3)=>{const _0x3467cf=a11_0x421db4,{companyId:_0x229ef1}=_0x239014[_0x3467cf(0x79)],_0x1ff2a2=_0x239014[_0x3467cf(0x94)],{id:_0x382667}=_0x239014[_0x3467cf(0x99)],_0x458618=await(0x0,UpdateService_1[_0x3467cf(0x7e)])({..._0x1ff2a2,'id':+_0x382667}),_0x22cf64=(0x0,socket_1['getIO'])();return _0x458618[_0x3467cf(0x93)]['forEach'](_0x8ef34d=>{const _0x76ca9e=_0x3467cf;_0x22cf64['emit'](_0x76ca9e(0x85)+_0x229ef1+'-chat-user-'+_0x8ef34d[_0x76ca9e(0x70)],{'action':'update','record':_0x458618});}),_0x3c34f3[_0x3467cf(0x82)](0xc8)['json'](_0x458618);};exports[a11_0x421db4(0x7c)]=update;const show=async(_0x3f1987,_0x389bc7)=>{const _0x157b42=a11_0x421db4,{id:_0x2a9f24}=_0x3f1987[_0x157b42(0x99)],_0x244029=await(0x0,ShowFromUuidService_1['default'])(_0x2a9f24);return _0x389bc7[_0x157b42(0x82)](0xc8)[_0x157b42(0x83)](_0x244029);};function a11_0x327f(_0x20c30e,_0x2a62b0){const _0x3e6ed2=a11_0x3e6e();return a11_0x327f=function(_0x327f7d,_0x147ec2){_0x327f7d=_0x327f7d-0x6d;let _0x403241=_0x3e6ed2[_0x327f7d];return _0x403241;},a11_0x327f(_0x20c30e,_0x2a62b0);}exports[a11_0x421db4(0x96)]=show;const remove=async(_0x233341,_0x4a4b88)=>{const _0x45df28=a11_0x421db4,{id:_0x416832}=_0x233341['params'],{companyId:_0x4a8ca9}=_0x233341['user'];await(0x0,DeleteService_1[_0x45df28(0x7e)])(_0x416832);const _0x418624=(0x0,socket_1[_0x45df28(0x9b)])();return _0x418624['emit']('company-'+_0x4a8ca9+_0x45df28(0x73),{'action':'delete','id':_0x416832}),_0x4a4b88[_0x45df28(0x82)](0xc8)[_0x45df28(0x83)]({'message':_0x45df28(0x8e)});};exports[a11_0x421db4(0x88)]=remove;const saveMessage=async(_0x55d8cc,_0x3522b8)=>{const _0x10ba01=a11_0x421db4,{companyId:_0x43fced}=_0x55d8cc[_0x10ba01(0x79)],{message:_0x2b0397}=_0x55d8cc[_0x10ba01(0x94)],{id:_0x1e0f55}=_0x55d8cc[_0x10ba01(0x99)],_0x3f5c5a=+_0x55d8cc[_0x10ba01(0x79)]['id'],_0x2b88ae=+_0x1e0f55,_0xfb86a3=await(0x0,CreateMessageService_1['default'])({'chatId':_0x2b88ae,'senderId':_0x3f5c5a,'message':_0x2b0397}),_0x4bcfa1=await Chat_1[_0x10ba01(0x7e)][_0x10ba01(0x80)](_0x2b88ae,{'include':[{'model':User_1[_0x10ba01(0x7e)],'as':_0x10ba01(0x6e)},{'model':ChatUser_1[_0x10ba01(0x7e)],'as':'users'}]}),_0x25702c=(0x0,socket_1[_0x10ba01(0x9b)])();return _0x25702c['emit'](_0x10ba01(0x85)+_0x43fced+'-chat-'+_0x2b88ae,{'action':'new-message','newMessage':_0xfb86a3,'chat':_0x4bcfa1}),_0x25702c[_0x10ba01(0x92)](_0x10ba01(0x85)+_0x43fced+_0x10ba01(0x73),{'action':_0x10ba01(0x84),'newMessage':_0xfb86a3,'chat':_0x4bcfa1}),_0x3522b8[_0x10ba01(0x83)](_0xfb86a3);};exports[a11_0x421db4(0x91)]=saveMessage;const checkAsRead=async(_0x22610b,_0xcae75b)=>{const _0x4dd1b4=a11_0x421db4,{companyId:_0x3f3ea5}=_0x22610b[_0x4dd1b4(0x79)],{userId:_0x4904fc}=_0x22610b[_0x4dd1b4(0x94)],{id:_0x398272}=_0x22610b[_0x4dd1b4(0x99)],_0x5984b5=await ChatUser_1[_0x4dd1b4(0x7e)]['findOne']({'where':{'chatId':_0x398272,'userId':_0x4904fc}});await _0x5984b5['update']({'unreads':0x0});const _0x8618a3=await Chat_1[_0x4dd1b4(0x7e)][_0x4dd1b4(0x80)](_0x398272,{'include':[{'model':User_1[_0x4dd1b4(0x7e)],'as':_0x4dd1b4(0x6e)},{'model':ChatUser_1[_0x4dd1b4(0x7e)],'as':_0x4dd1b4(0x93)}]}),_0x585369=(0x0,socket_1[_0x4dd1b4(0x9b)])();return _0x585369['emit'](_0x4dd1b4(0x85)+_0x3f3ea5+_0x4dd1b4(0x87)+_0x398272,{'action':_0x4dd1b4(0x7c),'chat':_0x8618a3}),_0x585369[_0x4dd1b4(0x92)](_0x4dd1b4(0x85)+_0x3f3ea5+'-chat',{'action':_0x4dd1b4(0x7c),'chat':_0x8618a3}),_0xcae75b[_0x4dd1b4(0x83)](_0x8618a3);};exports[a11_0x421db4(0x8f)]=checkAsRead;const messages=async(_0x1aca10,_0x156620)=>{const _0x3da37f=a11_0x421db4,{pageNumber:_0x3d255a}=_0x1aca10[_0x3da37f(0x9f)],{id:_0x36f646}=_0x1aca10[_0x3da37f(0x99)],_0x532dc7=+_0x1aca10[_0x3da37f(0x79)]['id'],{records:_0x2d86f1,count:_0x4784c9,hasMore:_0x25ad75}=await(0x0,FindMessages_1[_0x3da37f(0x7e)])({'chatId':_0x36f646,'ownerId':_0x532dc7,'pageNumber':_0x3d255a});return _0x156620['json']({'records':_0x2d86f1,'count':_0x4784c9,'hasMore':_0x25ad75});};exports[a11_0x421db4(0x7f)]=messages;function a11_0x3e6e(){const _0x977da1=['forEach','defineProperty','Chat\x20deleted','checkAsRead','11965iUAqRU','saveMessage','emit','users','body','../services/ChatService/CreateService','show','store','4482jZkcBJ','params','../services/ChatService/DeleteService','getIO','4847020nrNxoP','../services/ChatService/ShowFromUuidService','8750ZThoPa','query','../services/ChatService/UpdateService','owner','2025900OJKuDX','userId','324eMerjp','index','-chat','9xWChKu','../services/ChatService/FindMessages','../services/ChatService/CreateMessageService','374hFPBHr','671448xiHsAs','user','14009656CQvEgL','create','update','../services/ChatService/ListService','default','messages','findByPk','../models/Chat','status','json','new-message','company-','2YnujdE','-chat-','remove','__esModule','1201048xTsBGs','../models/ChatUser'];a11_0x3e6e=function(){return _0x977da1;};return a11_0x3e6e();}