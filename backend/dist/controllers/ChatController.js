'use strict';const a11_0x4fb865=a11_0x3aa8;(function(_0xd387d4,_0x3ae2db){const _0x5eaf46=a11_0x3aa8,_0x2deffd=_0xd387d4();while(!![]){try{const _0x33a7f8=parseInt(_0x5eaf46(0x11b))/0x1+parseInt(_0x5eaf46(0x13e))/0x2+-parseInt(_0x5eaf46(0x118))/0x3*(-parseInt(_0x5eaf46(0x114))/0x4)+-parseInt(_0x5eaf46(0x133))/0x5+-parseInt(_0x5eaf46(0x11c))/0x6*(parseInt(_0x5eaf46(0x12b))/0x7)+-parseInt(_0x5eaf46(0x139))/0x8*(-parseInt(_0x5eaf46(0x117))/0x9)+-parseInt(_0x5eaf46(0x129))/0xa*(parseInt(_0x5eaf46(0x127))/0xb);if(_0x33a7f8===_0x3ae2db)break;else _0x2deffd['push'](_0x2deffd['shift']());}catch(_0x355fc1){_0x2deffd['push'](_0x2deffd['shift']());}}}(a11_0x1c8f,0xbc072));var __importDefault=this&&this['__importDefault']||function(_0x4802dd){return _0x4802dd&&_0x4802dd['__esModule']?_0x4802dd:{'default':_0x4802dd};};Object[a11_0x4fb865(0x10e)](exports,a11_0x4fb865(0x120),{'value':!![]}),exports['messages']=exports['checkAsRead']=exports[a11_0x4fb865(0x113)]=exports[a11_0x4fb865(0x112)]=exports[a11_0x4fb865(0x12d)]=exports[a11_0x4fb865(0x13d)]=exports[a11_0x4fb865(0x11f)]=exports[a11_0x4fb865(0x12c)]=void 0x0;const socket_1=require('../libs/socket'),CreateService_1=__importDefault(require(a11_0x4fb865(0x122))),ListService_1=__importDefault(require(a11_0x4fb865(0x13c))),ShowFromUuidService_1=__importDefault(require(a11_0x4fb865(0x138))),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require('../services/ChatService/FindMessages')),UpdateService_1=__importDefault(require(a11_0x4fb865(0x125))),Chat_1=__importDefault(require('../models/Chat')),CreateMessageService_1=__importDefault(require('../services/ChatService/CreateMessageService')),User_1=__importDefault(require(a11_0x4fb865(0x13a))),ChatUser_1=__importDefault(require(a11_0x4fb865(0x12a))),index=async(_0x484380,_0x172510)=>{const _0x187151=a11_0x4fb865,{pageNumber:_0x1a1325}=_0x484380[_0x187151(0x111)],_0x58820a=+_0x484380[_0x187151(0x12e)]['id'],{records:_0x8eea16,count:_0x3e2b3a,hasMore:_0x352fd3}=await(0x0,ListService_1[_0x187151(0x126)])({'ownerId':_0x58820a,'pageNumber':_0x1a1325});return _0x172510[_0x187151(0x136)]({'records':_0x8eea16,'count':_0x3e2b3a,'hasMore':_0x352fd3});};exports['index']=index;const store=async(_0x12cdc8,_0x9d3e9a)=>{const _0x31e21c=a11_0x4fb865,{companyId:_0x379351}=_0x12cdc8[_0x31e21c(0x12e)],_0x53eec8=+_0x12cdc8['user']['id'],_0x5f1dd7=_0x12cdc8[_0x31e21c(0x11a)],_0x52ab9e=await(0x0,CreateService_1[_0x31e21c(0x126)])({..._0x5f1dd7,'ownerId':_0x53eec8,'companyId':_0x379351}),_0x5c0452=(0x0,socket_1['getIO'])();return _0x52ab9e['users'][_0x31e21c(0x128)](_0x506e1e=>{const _0x29b7dd=_0x31e21c;_0x5c0452['emit'](_0x29b7dd(0x11e)+_0x379351+_0x29b7dd(0x12f)+_0x506e1e['userId'],{'action':_0x29b7dd(0x130),'record':_0x52ab9e});}),_0x9d3e9a[_0x31e21c(0x121)](0xc8)[_0x31e21c(0x136)](_0x52ab9e);};function a11_0x1c8f(){const _0x346e1c=['owner','../services/ChatService/ListService','update','691086QtZQEv','defineProperty','messages','users','query','remove','saveMessage','113600hbmNsR','findOne','params','1230111BSabWI','138ZoZrPS','findByPk','body','809964fqUdeB','26814jnfJoX','checkAsRead','company-','store','__esModule','status','../services/ChatService/CreateService','-chat','delete','../services/ChatService/UpdateService','default','931568fsRDOL','forEach','30QbWkmX','../models/ChatUser','1988RPzmLm','index','show','user','-chat-user-','create','getIO','-chat-','5626190eVwxWa','emit','new-message','json','userId','../services/ChatService/ShowFromUuidService','56TYVnRa','../models/User'];a11_0x1c8f=function(){return _0x346e1c;};return a11_0x1c8f();}exports[a11_0x4fb865(0x11f)]=store;const update=async(_0x36da82,_0x4d490c)=>{const _0x1bd13b=a11_0x4fb865,{companyId:_0x57daf1}=_0x36da82['user'],_0x3b1a82=_0x36da82[_0x1bd13b(0x11a)],{id:_0x11008b}=_0x36da82[_0x1bd13b(0x116)],_0x1ac44c=await(0x0,UpdateService_1[_0x1bd13b(0x126)])({..._0x3b1a82,'id':+_0x11008b}),_0x2eba65=(0x0,socket_1[_0x1bd13b(0x131)])();return _0x1ac44c['users'][_0x1bd13b(0x128)](_0x26c950=>{const _0x4ca728=_0x1bd13b;_0x2eba65[_0x4ca728(0x134)](_0x4ca728(0x11e)+_0x57daf1+_0x4ca728(0x12f)+_0x26c950[_0x4ca728(0x137)],{'action':_0x4ca728(0x13d),'record':_0x1ac44c});}),_0x4d490c[_0x1bd13b(0x121)](0xc8)[_0x1bd13b(0x136)](_0x1ac44c);};exports['update']=update;const show=async(_0x166cc1,_0x57a9d6)=>{const _0x16f866=a11_0x4fb865,{id:_0x588853}=_0x166cc1[_0x16f866(0x116)],_0x38e358=await(0x0,ShowFromUuidService_1['default'])(_0x588853);return _0x57a9d6[_0x16f866(0x121)](0xc8)['json'](_0x38e358);};exports[a11_0x4fb865(0x12d)]=show;const remove=async(_0x3f1c30,_0x408c9c)=>{const _0xf4b6a=a11_0x4fb865,{id:_0x44ce9e}=_0x3f1c30['params'],{companyId:_0x1119fe}=_0x3f1c30[_0xf4b6a(0x12e)];await(0x0,DeleteService_1['default'])(_0x44ce9e);const _0x69181e=(0x0,socket_1[_0xf4b6a(0x131)])();return _0x69181e[_0xf4b6a(0x134)]('company-'+_0x1119fe+_0xf4b6a(0x123),{'action':_0xf4b6a(0x124),'id':_0x44ce9e}),_0x408c9c[_0xf4b6a(0x121)](0xc8)[_0xf4b6a(0x136)]({'message':'Chat\x20deleted'});};function a11_0x3aa8(_0x2cbb04,_0x5e36c1){const _0x1c8fd9=a11_0x1c8f();return a11_0x3aa8=function(_0x3aa876,_0x3f9672){_0x3aa876=_0x3aa876-0x10e;let _0xb46293=_0x1c8fd9[_0x3aa876];return _0xb46293;},a11_0x3aa8(_0x2cbb04,_0x5e36c1);}exports[a11_0x4fb865(0x112)]=remove;const saveMessage=async(_0x3e04e2,_0x61b145)=>{const _0x1079a3=a11_0x4fb865,{companyId:_0x24f734}=_0x3e04e2[_0x1079a3(0x12e)],{message:_0x12260b}=_0x3e04e2['body'],{id:_0x12f202}=_0x3e04e2[_0x1079a3(0x116)],_0x44d2b5=+_0x3e04e2[_0x1079a3(0x12e)]['id'],_0x499bd1=+_0x12f202,_0x4ac671=await(0x0,CreateMessageService_1['default'])({'chatId':_0x499bd1,'senderId':_0x44d2b5,'message':_0x12260b}),_0x45479b=await Chat_1[_0x1079a3(0x126)][_0x1079a3(0x119)](_0x499bd1,{'include':[{'model':User_1[_0x1079a3(0x126)],'as':_0x1079a3(0x13b)},{'model':ChatUser_1['default'],'as':_0x1079a3(0x110)}]}),_0x36f524=(0x0,socket_1[_0x1079a3(0x131)])();return _0x36f524[_0x1079a3(0x134)](_0x1079a3(0x11e)+_0x24f734+_0x1079a3(0x132)+_0x499bd1,{'action':_0x1079a3(0x135),'newMessage':_0x4ac671,'chat':_0x45479b}),_0x36f524['emit'](_0x1079a3(0x11e)+_0x24f734+'-chat',{'action':_0x1079a3(0x135),'newMessage':_0x4ac671,'chat':_0x45479b}),_0x61b145[_0x1079a3(0x136)](_0x4ac671);};exports[a11_0x4fb865(0x113)]=saveMessage;const checkAsRead=async(_0x5ee058,_0x213991)=>{const _0x45f96a=a11_0x4fb865,{companyId:_0x3e3d33}=_0x5ee058[_0x45f96a(0x12e)],{userId:_0x3a3fe7}=_0x5ee058[_0x45f96a(0x11a)],{id:_0xe0f890}=_0x5ee058[_0x45f96a(0x116)],_0x10fd33=await ChatUser_1[_0x45f96a(0x126)][_0x45f96a(0x115)]({'where':{'chatId':_0xe0f890,'userId':_0x3a3fe7}});await _0x10fd33['update']({'unreads':0x0});const _0x1d8716=await Chat_1[_0x45f96a(0x126)][_0x45f96a(0x119)](_0xe0f890,{'include':[{'model':User_1[_0x45f96a(0x126)],'as':_0x45f96a(0x13b)},{'model':ChatUser_1[_0x45f96a(0x126)],'as':_0x45f96a(0x110)}]}),_0x5c7502=(0x0,socket_1[_0x45f96a(0x131)])();return _0x5c7502[_0x45f96a(0x134)]('company-'+_0x3e3d33+_0x45f96a(0x132)+_0xe0f890,{'action':'update','chat':_0x1d8716}),_0x5c7502[_0x45f96a(0x134)]('company-'+_0x3e3d33+_0x45f96a(0x123),{'action':_0x45f96a(0x13d),'chat':_0x1d8716}),_0x213991[_0x45f96a(0x136)](_0x1d8716);};exports[a11_0x4fb865(0x11d)]=checkAsRead;const messages=async(_0x318da8,_0x36e735)=>{const _0x286a93=a11_0x4fb865,{pageNumber:_0x4b9988}=_0x318da8[_0x286a93(0x111)],{id:_0x573194}=_0x318da8[_0x286a93(0x116)],_0x2529ad=+_0x318da8[_0x286a93(0x12e)]['id'],{records:_0x2ea9d3,count:_0x58da37,hasMore:_0x14b94d}=await(0x0,FindMessages_1[_0x286a93(0x126)])({'chatId':_0x573194,'ownerId':_0x2529ad,'pageNumber':_0x4b9988});return _0x36e735['json']({'records':_0x2ea9d3,'count':_0x58da37,'hasMore':_0x14b94d});};exports[a11_0x4fb865(0x10f)]=messages;