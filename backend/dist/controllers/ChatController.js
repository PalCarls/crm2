'use strict';const a11_0x4cf75b=a11_0x20ac;(function(_0x2b0ced,_0x46557d){const _0x56f06d=a11_0x20ac,_0x8fbc5b=_0x2b0ced();while(!![]){try{const _0x2cbe52=parseInt(_0x56f06d(0x1ee))/0x1+-parseInt(_0x56f06d(0x1d9))/0x2+parseInt(_0x56f06d(0x1d2))/0x3*(-parseInt(_0x56f06d(0x1d4))/0x4)+parseInt(_0x56f06d(0x1d7))/0x5*(parseInt(_0x56f06d(0x1e1))/0x6)+parseInt(_0x56f06d(0x1f1))/0x7+-parseInt(_0x56f06d(0x1ea))/0x8+-parseInt(_0x56f06d(0x1ce))/0x9*(parseInt(_0x56f06d(0x1eb))/0xa);if(_0x2cbe52===_0x46557d)break;else _0x8fbc5b['push'](_0x8fbc5b['shift']());}catch(_0x1a45de){_0x8fbc5b['push'](_0x8fbc5b['shift']());}}}(a11_0x2ae2,0x7427b));var __importDefault=this&&this[a11_0x4cf75b(0x1dd)]||function(_0x371532){const _0x41b4a8=a11_0x4cf75b;return _0x371532&&_0x371532[_0x41b4a8(0x1f7)]?_0x371532:{'default':_0x371532};};Object['defineProperty'](exports,a11_0x4cf75b(0x1f7),{'value':!![]}),exports[a11_0x4cf75b(0x1da)]=exports[a11_0x4cf75b(0x1f6)]=exports['saveMessage']=exports[a11_0x4cf75b(0x1e4)]=exports['show']=exports[a11_0x4cf75b(0x1dc)]=exports[a11_0x4cf75b(0x1f0)]=exports[a11_0x4cf75b(0x1d3)]=void 0x0;const socket_1=require('../libs/socket'),CreateService_1=__importDefault(require(a11_0x4cf75b(0x1e6))),ListService_1=__importDefault(require(a11_0x4cf75b(0x1d1))),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require(a11_0x4cf75b(0x1f2))),FindMessages_1=__importDefault(require('../services/ChatService/FindMessages')),UpdateService_1=__importDefault(require(a11_0x4cf75b(0x1cf))),Chat_1=__importDefault(require(a11_0x4cf75b(0x1df))),CreateMessageService_1=__importDefault(require(a11_0x4cf75b(0x1ed))),User_1=__importDefault(require(a11_0x4cf75b(0x1e3))),ChatUser_1=__importDefault(require(a11_0x4cf75b(0x1e7))),index=async(_0x267eb3,_0x23ce41)=>{const _0x1c7d8d=a11_0x4cf75b,{pageNumber:_0xbf0065}=_0x267eb3[_0x1c7d8d(0x1f9)],_0x2d3479=+_0x267eb3[_0x1c7d8d(0x1d6)]['id'],{records:_0x48c12f,count:_0x54dd41,hasMore:_0x4ccf0d}=await(0x0,ListService_1[_0x1c7d8d(0x1e0)])({'ownerId':_0x2d3479,'pageNumber':_0xbf0065});return _0x23ce41[_0x1c7d8d(0x1f3)]({'records':_0x48c12f,'count':_0x54dd41,'hasMore':_0x4ccf0d});};exports[a11_0x4cf75b(0x1d3)]=index;const store=async(_0x18d21e,_0xadfac)=>{const _0x5a1c21=a11_0x4cf75b,{companyId:_0x474d73}=_0x18d21e[_0x5a1c21(0x1d6)],_0x56f391=+_0x18d21e['user']['id'],_0x2a0ead=_0x18d21e[_0x5a1c21(0x1db)],_0x2860ec=await(0x0,CreateService_1[_0x5a1c21(0x1e0)])({..._0x2a0ead,'ownerId':_0x56f391,'companyId':_0x474d73}),_0x4e97c4=(0x0,socket_1[_0x5a1c21(0x1e9)])();return _0x2860ec[_0x5a1c21(0x1d0)][_0x5a1c21(0x1f5)](_0x1c5878=>{const _0x33b488=_0x5a1c21;_0x4e97c4[_0x33b488(0x1ef)]('company-'+_0x474d73+_0x33b488(0x1e5)+_0x1c5878['userId'],{'action':'create','record':_0x2860ec});}),_0xadfac[_0x5a1c21(0x1d8)](0xc8)['json'](_0x2860ec);};exports[a11_0x4cf75b(0x1f0)]=store;const update=async(_0x510810,_0x3cc52d)=>{const _0x2ceb8f=a11_0x4cf75b,{companyId:_0x1d39bf}=_0x510810[_0x2ceb8f(0x1d6)],_0x82b4b7=_0x510810[_0x2ceb8f(0x1db)],{id:_0x380e83}=_0x510810[_0x2ceb8f(0x1d5)],_0x19a214=await(0x0,UpdateService_1['default'])({..._0x82b4b7,'id':+_0x380e83}),_0x3cd807=(0x0,socket_1['getIO'])();return _0x19a214[_0x2ceb8f(0x1d0)]['forEach'](_0x2be906=>{const _0x1999da=_0x2ceb8f;_0x3cd807[_0x1999da(0x1ef)](_0x1999da(0x1de)+_0x1d39bf+'-chat-user-'+_0x2be906[_0x1999da(0x1cd)],{'action':_0x1999da(0x1dc),'record':_0x19a214});}),_0x3cc52d['status'](0xc8)[_0x2ceb8f(0x1f3)](_0x19a214);};exports[a11_0x4cf75b(0x1dc)]=update;const show=async(_0x49c2e2,_0x44f7da)=>{const _0x55b130=a11_0x4cf75b,{id:_0x4eeb1f}=_0x49c2e2['params'],_0x210efc=await(0x0,ShowFromUuidService_1[_0x55b130(0x1e0)])(_0x4eeb1f);return _0x44f7da[_0x55b130(0x1d8)](0xc8)[_0x55b130(0x1f3)](_0x210efc);};exports[a11_0x4cf75b(0x1e8)]=show;const remove=async(_0x2c5ed7,_0x2a8f1b)=>{const _0x4ab8ae=a11_0x4cf75b,{id:_0x25927e}=_0x2c5ed7[_0x4ab8ae(0x1d5)],{companyId:_0x267bda}=_0x2c5ed7[_0x4ab8ae(0x1d6)];await(0x0,DeleteService_1[_0x4ab8ae(0x1e0)])(_0x25927e);const _0x2d645b=(0x0,socket_1['getIO'])();return _0x2d645b[_0x4ab8ae(0x1ef)](_0x4ab8ae(0x1de)+_0x267bda+_0x4ab8ae(0x1f8),{'action':'delete','id':_0x25927e}),_0x2a8f1b[_0x4ab8ae(0x1d8)](0xc8)[_0x4ab8ae(0x1f3)]({'message':'Chat\x20deleted'});};exports[a11_0x4cf75b(0x1e4)]=remove;const saveMessage=async(_0x348b02,_0x373a23)=>{const _0x2350e7=a11_0x4cf75b,{companyId:_0x555dde}=_0x348b02[_0x2350e7(0x1d6)],{message:_0x48f843}=_0x348b02[_0x2350e7(0x1db)],{id:_0x6724fa}=_0x348b02[_0x2350e7(0x1d5)],_0x5135f4=+_0x348b02['user']['id'],_0x24772b=+_0x6724fa,_0x10814f=await(0x0,CreateMessageService_1['default'])({'chatId':_0x24772b,'senderId':_0x5135f4,'message':_0x48f843}),_0x1f1cb5=await Chat_1[_0x2350e7(0x1e0)][_0x2350e7(0x1e2)](_0x24772b,{'include':[{'model':User_1[_0x2350e7(0x1e0)],'as':_0x2350e7(0x1fa)},{'model':ChatUser_1[_0x2350e7(0x1e0)],'as':'users'}]}),_0x5dae75=(0x0,socket_1[_0x2350e7(0x1e9)])();return _0x5dae75[_0x2350e7(0x1ef)](_0x2350e7(0x1de)+_0x555dde+_0x2350e7(0x1ec)+_0x24772b,{'action':'new-message','newMessage':_0x10814f,'chat':_0x1f1cb5}),_0x5dae75['emit'](_0x2350e7(0x1de)+_0x555dde+'-chat',{'action':'new-message','newMessage':_0x10814f,'chat':_0x1f1cb5}),_0x373a23[_0x2350e7(0x1f3)](_0x10814f);};function a11_0x2ae2(){const _0x1ab602=['486MzSqBb','../services/ChatService/UpdateService','users','../services/ChatService/ListService','207171Utkhec','index','4NTCoLj','params','user','190NiHLRo','status','852052NYlXfh','messages','body','update','__importDefault','company-','../models/Chat','default','118914NDRrEp','findByPk','../models/User','remove','-chat-user-','../services/ChatService/CreateService','../models/ChatUser','show','getIO','106616QxngMl','193640tZdOfP','-chat-','../services/ChatService/CreateMessageService','917742FWUeUO','emit','store','2512811nBdaxF','../services/ChatService/DeleteService','json','findOne','forEach','checkAsRead','__esModule','-chat','query','owner','userId'];a11_0x2ae2=function(){return _0x1ab602;};return a11_0x2ae2();}exports['saveMessage']=saveMessage;const checkAsRead=async(_0x84d6a4,_0x241751)=>{const _0x2ee866=a11_0x4cf75b,{companyId:_0x5d85ae}=_0x84d6a4[_0x2ee866(0x1d6)],{userId:_0x284412}=_0x84d6a4[_0x2ee866(0x1db)],{id:_0x158098}=_0x84d6a4[_0x2ee866(0x1d5)],_0x3cde48=await ChatUser_1['default'][_0x2ee866(0x1f4)]({'where':{'chatId':_0x158098,'userId':_0x284412}});await _0x3cde48['update']({'unreads':0x0});const _0x54ea64=await Chat_1[_0x2ee866(0x1e0)][_0x2ee866(0x1e2)](_0x158098,{'include':[{'model':User_1[_0x2ee866(0x1e0)],'as':'owner'},{'model':ChatUser_1[_0x2ee866(0x1e0)],'as':_0x2ee866(0x1d0)}]}),_0x2a3467=(0x0,socket_1[_0x2ee866(0x1e9)])();return _0x2a3467['emit'](_0x2ee866(0x1de)+_0x5d85ae+'-chat-'+_0x158098,{'action':'update','chat':_0x54ea64}),_0x2a3467[_0x2ee866(0x1ef)](_0x2ee866(0x1de)+_0x5d85ae+'-chat',{'action':'update','chat':_0x54ea64}),_0x241751[_0x2ee866(0x1f3)](_0x54ea64);};function a11_0x20ac(_0x3b3f87,_0x43f2a1){const _0x2ae242=a11_0x2ae2();return a11_0x20ac=function(_0x20acca,_0x135ac5){_0x20acca=_0x20acca-0x1cd;let _0x3814a9=_0x2ae242[_0x20acca];return _0x3814a9;},a11_0x20ac(_0x3b3f87,_0x43f2a1);}exports['checkAsRead']=checkAsRead;const messages=async(_0x249289,_0x144c20)=>{const _0x158fcc=a11_0x4cf75b,{pageNumber:_0x1033cc}=_0x249289['query'],{id:_0x2aef62}=_0x249289['params'],_0x266f11=+_0x249289[_0x158fcc(0x1d6)]['id'],{records:_0x2d6d4f,count:_0x21c082,hasMore:_0x44b5d7}=await(0x0,FindMessages_1[_0x158fcc(0x1e0)])({'chatId':_0x2aef62,'ownerId':_0x266f11,'pageNumber':_0x1033cc});return _0x144c20[_0x158fcc(0x1f3)]({'records':_0x2d6d4f,'count':_0x21c082,'hasMore':_0x44b5d7});};exports['messages']=messages;