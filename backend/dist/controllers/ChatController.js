'use strict';const a11_0xe49912=a11_0x542b;(function(_0x34f28e,_0x310849){const _0x33240d=a11_0x542b,_0x245f19=_0x34f28e();while(!![]){try{const _0x2772d8=-parseInt(_0x33240d(0x161))/0x1*(parseInt(_0x33240d(0x168))/0x2)+-parseInt(_0x33240d(0x15c))/0x3+-parseInt(_0x33240d(0x16e))/0x4*(parseInt(_0x33240d(0x165))/0x5)+-parseInt(_0x33240d(0x153))/0x6*(parseInt(_0x33240d(0x179))/0x7)+-parseInt(_0x33240d(0x151))/0x8*(parseInt(_0x33240d(0x154))/0x9)+-parseInt(_0x33240d(0x152))/0xa+parseInt(_0x33240d(0x17f))/0xb;if(_0x2772d8===_0x310849)break;else _0x245f19['push'](_0x245f19['shift']());}catch(_0x375b25){_0x245f19['push'](_0x245f19['shift']());}}}(a11_0x4960,0xc902d));var __importDefault=this&&this[a11_0xe49912(0x158)]||function(_0x1509a5){const _0x245159=a11_0xe49912;return _0x1509a5&&_0x1509a5[_0x245159(0x15f)]?_0x1509a5:{'default':_0x1509a5};};Object[a11_0xe49912(0x14e)](exports,a11_0xe49912(0x15f),{'value':!![]}),exports[a11_0xe49912(0x159)]=exports['checkAsRead']=exports['saveMessage']=exports[a11_0xe49912(0x174)]=exports[a11_0xe49912(0x155)]=exports[a11_0xe49912(0x156)]=exports['store']=exports[a11_0xe49912(0x176)]=void 0x0;const socket_1=require(a11_0xe49912(0x171)),CreateService_1=__importDefault(require(a11_0xe49912(0x175))),ListService_1=__importDefault(require(a11_0xe49912(0x15a))),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require(a11_0xe49912(0x167))),FindMessages_1=__importDefault(require(a11_0xe49912(0x169))),UpdateService_1=__importDefault(require('../services/ChatService/UpdateService')),Chat_1=__importDefault(require(a11_0xe49912(0x150))),CreateMessageService_1=__importDefault(require('../services/ChatService/CreateMessageService')),User_1=__importDefault(require(a11_0xe49912(0x16f))),ChatUser_1=__importDefault(require(a11_0xe49912(0x162))),index=async(_0x1f52de,_0x43f846)=>{const _0x215116=a11_0xe49912,{pageNumber:_0x43f2c3}=_0x1f52de[_0x215116(0x16b)],_0x5b5f9c=+_0x1f52de[_0x215116(0x15b)]['id'],{records:_0x60bd1f,count:_0x185474,hasMore:_0x40e218}=await(0x0,ListService_1['default'])({'ownerId':_0x5b5f9c,'pageNumber':_0x43f2c3});return _0x43f846['json']({'records':_0x60bd1f,'count':_0x185474,'hasMore':_0x40e218});};function a11_0x542b(_0x50e5ec,_0xb0983e){const _0x49601d=a11_0x4960();return a11_0x542b=function(_0x542bf3,_0x4d9ae6){_0x542bf3=_0x542bf3-0x14e;let _0xed5a8d=_0x49601d[_0x542bf3];return _0xed5a8d;},a11_0x542b(_0x50e5ec,_0xb0983e);}exports[a11_0xe49912(0x176)]=index;const store=async(_0x6f6bf3,_0x258b56)=>{const _0x1fadf7=a11_0xe49912,{companyId:_0x1b7bcd}=_0x6f6bf3[_0x1fadf7(0x15b)],_0x154803=+_0x6f6bf3[_0x1fadf7(0x15b)]['id'],_0x5aaf85=_0x6f6bf3[_0x1fadf7(0x14f)],_0x2c87a8=await(0x0,CreateService_1['default'])({..._0x5aaf85,'ownerId':_0x154803,'companyId':_0x1b7bcd}),_0x37d14a=(0x0,socket_1[_0x1fadf7(0x166)])();return _0x2c87a8['users'][_0x1fadf7(0x17d)](_0x30da7c=>{const _0x5e28e4=_0x1fadf7;_0x37d14a['emit'](_0x5e28e4(0x172)+_0x1b7bcd+_0x5e28e4(0x164)+_0x30da7c['userId'],{'action':_0x5e28e4(0x17c),'record':_0x2c87a8});}),_0x258b56[_0x1fadf7(0x15d)](0xc8)['json'](_0x2c87a8);};exports[a11_0xe49912(0x16c)]=store;const update=async(_0x13995a,_0x152e50)=>{const _0x49da7a=a11_0xe49912,{companyId:_0x1fc5af}=_0x13995a['user'],_0xe7bc1c=_0x13995a[_0x49da7a(0x14f)],{id:_0x4d01cc}=_0x13995a[_0x49da7a(0x177)],_0x2efb51=await(0x0,UpdateService_1[_0x49da7a(0x163)])({..._0xe7bc1c,'id':+_0x4d01cc}),_0x50a2d3=(0x0,socket_1[_0x49da7a(0x166)])();return _0x2efb51[_0x49da7a(0x173)][_0x49da7a(0x17d)](_0x5ef16d=>{const _0x56d335=_0x49da7a;_0x50a2d3[_0x56d335(0x16a)](_0x56d335(0x172)+_0x1fc5af+_0x56d335(0x164)+_0x5ef16d['userId'],{'action':_0x56d335(0x156),'record':_0x2efb51});}),_0x152e50[_0x49da7a(0x15d)](0xc8)['json'](_0x2efb51);};exports[a11_0xe49912(0x156)]=update;const show=async(_0x5c76b7,_0x5314ec)=>{const _0x4d0780=a11_0xe49912,{id:_0x31a7a7}=_0x5c76b7['params'],_0x596ac2=await(0x0,ShowFromUuidService_1['default'])(_0x31a7a7);return _0x5314ec[_0x4d0780(0x15d)](0xc8)[_0x4d0780(0x17e)](_0x596ac2);};exports[a11_0xe49912(0x155)]=show;const remove=async(_0x1b920c,_0xd8568)=>{const _0x3a5d97=a11_0xe49912,{id:_0x1776a5}=_0x1b920c[_0x3a5d97(0x177)],{companyId:_0x221adf}=_0x1b920c[_0x3a5d97(0x15b)];await(0x0,DeleteService_1[_0x3a5d97(0x163)])(_0x1776a5);const _0x4449a6=(0x0,socket_1[_0x3a5d97(0x166)])();return _0x4449a6[_0x3a5d97(0x16a)](_0x3a5d97(0x172)+_0x221adf+_0x3a5d97(0x157),{'action':_0x3a5d97(0x178),'id':_0x1776a5}),_0xd8568[_0x3a5d97(0x15d)](0xc8)[_0x3a5d97(0x17e)]({'message':_0x3a5d97(0x17a)});};exports[a11_0xe49912(0x174)]=remove;const saveMessage=async(_0x4ff83f,_0x17c766)=>{const _0x144d9a=a11_0xe49912,{companyId:_0xe6308e}=_0x4ff83f[_0x144d9a(0x15b)],{message:_0x1ef8fa}=_0x4ff83f[_0x144d9a(0x14f)],{id:_0x3b51d4}=_0x4ff83f[_0x144d9a(0x177)],_0x55424b=+_0x4ff83f['user']['id'],_0x7d142=+_0x3b51d4,_0x1f2e76=await(0x0,CreateMessageService_1[_0x144d9a(0x163)])({'chatId':_0x7d142,'senderId':_0x55424b,'message':_0x1ef8fa}),_0x3422e5=await Chat_1[_0x144d9a(0x163)][_0x144d9a(0x160)](_0x7d142,{'include':[{'model':User_1[_0x144d9a(0x163)],'as':'owner'},{'model':ChatUser_1['default'],'as':_0x144d9a(0x173)}]}),_0x59be81=(0x0,socket_1[_0x144d9a(0x166)])();return _0x59be81[_0x144d9a(0x16a)]('company-'+_0xe6308e+_0x144d9a(0x15e)+_0x7d142,{'action':_0x144d9a(0x17b),'newMessage':_0x1f2e76,'chat':_0x3422e5}),_0x59be81['emit'](_0x144d9a(0x172)+_0xe6308e+_0x144d9a(0x157),{'action':'new-message','newMessage':_0x1f2e76,'chat':_0x3422e5}),_0x17c766['json'](_0x1f2e76);};exports['saveMessage']=saveMessage;const checkAsRead=async(_0x2f9f2b,_0x13ebe2)=>{const _0x5bc833=a11_0xe49912,{companyId:_0x5ded70}=_0x2f9f2b[_0x5bc833(0x15b)],{userId:_0x208357}=_0x2f9f2b[_0x5bc833(0x14f)],{id:_0x2713ba}=_0x2f9f2b[_0x5bc833(0x177)],_0x1bddf6=await ChatUser_1['default'][_0x5bc833(0x170)]({'where':{'chatId':_0x2713ba,'userId':_0x208357}});await _0x1bddf6['update']({'unreads':0x0});const _0x25779f=await Chat_1[_0x5bc833(0x163)]['findByPk'](_0x2713ba,{'include':[{'model':User_1['default'],'as':'owner'},{'model':ChatUser_1['default'],'as':'users'}]}),_0x52886b=(0x0,socket_1['getIO'])();return _0x52886b[_0x5bc833(0x16a)]('company-'+_0x5ded70+_0x5bc833(0x15e)+_0x2713ba,{'action':_0x5bc833(0x156),'chat':_0x25779f}),_0x52886b['emit'](_0x5bc833(0x172)+_0x5ded70+_0x5bc833(0x157),{'action':_0x5bc833(0x156),'chat':_0x25779f}),_0x13ebe2[_0x5bc833(0x17e)](_0x25779f);};function a11_0x4960(){const _0x27e9a9=['checkAsRead','4AVEPyf','../models/User','findOne','../libs/socket','company-','users','remove','../services/ChatService/CreateService','index','params','delete','17801KBeync','Chat\x20deleted','new-message','create','forEach','json','68192476jpvWPR','defineProperty','body','../models/Chat','24aTncHH','13938730bkxZYM','3612lEfBIK','3814227VHHHOF','show','update','-chat','__importDefault','messages','../services/ChatService/ListService','user','126489nyUjhT','status','-chat-','__esModule','findByPk','3nSSoNX','../models/ChatUser','default','-chat-user-','1163815FZwdZQ','getIO','../services/ChatService/DeleteService','603254gKdEBc','../services/ChatService/FindMessages','emit','query','store'];a11_0x4960=function(){return _0x27e9a9;};return a11_0x4960();}exports[a11_0xe49912(0x16d)]=checkAsRead;const messages=async(_0x23becb,_0x4ce65a)=>{const _0x217b09=a11_0xe49912,{pageNumber:_0x275ba9}=_0x23becb[_0x217b09(0x16b)],{id:_0x4c6c0f}=_0x23becb[_0x217b09(0x177)],_0x4de66d=+_0x23becb[_0x217b09(0x15b)]['id'],{records:_0xde0f9e,count:_0x4f13d8,hasMore:_0x2bfe53}=await(0x0,FindMessages_1[_0x217b09(0x163)])({'chatId':_0x4c6c0f,'ownerId':_0x4de66d,'pageNumber':_0x275ba9});return _0x4ce65a['json']({'records':_0xde0f9e,'count':_0x4f13d8,'hasMore':_0x2bfe53});};exports[a11_0xe49912(0x159)]=messages;