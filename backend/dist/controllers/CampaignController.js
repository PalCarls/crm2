'use strict';const a9_0xfaad39=a9_0x5760;(function(_0x3183b8,_0x234712){const _0x18f48e=a9_0x5760,_0x4e50b7=_0x3183b8();while(!![]){try{const _0x2479c4=parseInt(_0x18f48e(0x118))/0x1+-parseInt(_0x18f48e(0x103))/0x2*(parseInt(_0x18f48e(0x115))/0x3)+parseInt(_0x18f48e(0xed))/0x4*(-parseInt(_0x18f48e(0x147))/0x5)+-parseInt(_0x18f48e(0xef))/0x6+parseInt(_0x18f48e(0x11a))/0x7+parseInt(_0x18f48e(0x142))/0x8+parseInt(_0x18f48e(0xf1))/0x9*(parseInt(_0x18f48e(0x13a))/0xa);if(_0x2479c4===_0x234712)break;else _0x4e50b7['push'](_0x4e50b7['shift']());}catch(_0xc934e1){_0x4e50b7['push'](_0x4e50b7['shift']());}}}(a9_0x3ae6,0x939c5));function a9_0x3ae6(){const _0x36fd2a=['../models/Contact','validate','9276ftDoqE','map','Error\x20creating\x20contact\x20list:','900028XWomMX','../services/CampaignService/UpdateService','1877274YAOUrM','../services/CampaignService/CreateService','../models/Campaign','writable','show','Campaign\x20deleted','path','user','mediaName','\x20|\x20TAG:\x20','name','isGroup','defineProperty','cancel','save','json','emit','findAll','bulkCreate','\x20-\x20','update','toISOString','lodash','findList','mediaUpload','message','create','originalname','__esModule','__createBinding','../models/ContactList','unlinkSync','60tEkjbC','Error\x20creating\x20contact\x20list','body','deleteMedia','store','files','../models/ContactTag','shape','714272TPkfMj','params','Arquivo\x20excluído','call','then','1469495OrCGAX','company-','query','number','default','8bAGyjH','index','4955058nWWYnn','Error:','2096568umJxlV','../services/CampaignService/RestartService','get','__importStar','filename','string','hasOwnProperty','../models/ContactListItem','../services/CampaignService/FindService','Mensagem\x20enviada','configurable','status','findByPk','delete','__importDefault','catch','../libs/socket','../services/CampaignService/CancelService','412IGgItv','head','object','../services/CampaignService/ShowService','getIO','tagListId','send','existsSync','remove','resolve','log','error','Reinício\x20dos\x20disparos','restart','-campaign','../errors/AppError'];a9_0x3ae6=function(){return _0x36fd2a;};return a9_0x3ae6();}var __createBinding=this&&this[a9_0xfaad39(0x137)]||(Object['create']?function(_0x3f57e4,_0x19c9ec,_0x34bc07,_0x398117){const _0x4dad1e=a9_0xfaad39;if(_0x398117===undefined)_0x398117=_0x34bc07;var _0x3d1263=Object['getOwnPropertyDescriptor'](_0x19c9ec,_0x34bc07);(!_0x3d1263||(_0x4dad1e(0xf3)in _0x3d1263?!_0x19c9ec[_0x4dad1e(0x136)]:_0x3d1263[_0x4dad1e(0x11d)]||_0x3d1263[_0x4dad1e(0xfb)]))&&(_0x3d1263={'enumerable':!![],'get':function(){return _0x19c9ec[_0x34bc07];}}),Object[_0x4dad1e(0x126)](_0x3f57e4,_0x398117,_0x3d1263);}:function(_0x24bd01,_0x28cb2c,_0x4fdc91,_0x5d7d05){if(_0x5d7d05===undefined)_0x5d7d05=_0x4fdc91;_0x24bd01[_0x5d7d05]=_0x28cb2c[_0x4fdc91];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x552df6,_0x4127db){const _0x2af52f=a9_0xfaad39;Object[_0x2af52f(0x126)](_0x552df6,_0x2af52f(0xec),{'enumerable':!![],'value':_0x4127db});}:function(_0x1481a9,_0x534167){const _0x23a9e2=a9_0xfaad39;_0x1481a9[_0x23a9e2(0xec)]=_0x534167;}),__importStar=this&&this[a9_0xfaad39(0xf4)]||function(_0x3d76b5){const _0x160204=a9_0xfaad39;if(_0x3d76b5&&_0x3d76b5['__esModule'])return _0x3d76b5;var _0x37d9ca={};if(_0x3d76b5!=null){for(var _0x4593a4 in _0x3d76b5)if(_0x4593a4!==_0x160204(0xec)&&Object['prototype'][_0x160204(0xf7)][_0x160204(0x145)](_0x3d76b5,_0x4593a4))__createBinding(_0x37d9ca,_0x3d76b5,_0x4593a4);}return __setModuleDefault(_0x37d9ca,_0x3d76b5),_0x37d9ca;},__importDefault=this&&this[a9_0xfaad39(0xff)]||function(_0xae5118){const _0x4e9ec3=a9_0xfaad39;return _0xae5118&&_0xae5118[_0x4e9ec3(0x136)]?_0xae5118:{'default':_0xae5118};};Object[a9_0xfaad39(0x126)](exports,a9_0xfaad39(0x136),{'value':!![]}),exports[a9_0xfaad39(0x13d)]=exports[a9_0xfaad39(0x132)]=exports['findList']=exports[a9_0xfaad39(0x10b)]=exports[a9_0xfaad39(0x110)]=exports['cancel']=exports[a9_0xfaad39(0x12e)]=exports[a9_0xfaad39(0x11e)]=exports[a9_0xfaad39(0x13e)]=exports[a9_0xfaad39(0xee)]=void 0x0;const Yup=__importStar(require('yup')),socket_1=require(a9_0xfaad39(0x101)),lodash_1=require(a9_0xfaad39(0x130)),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a9_0xfaad39(0x120))),ListService_1=__importDefault(require('../services/CampaignService/ListService')),CreateService_1=__importDefault(require(a9_0xfaad39(0x11b))),ShowService_1=__importDefault(require(a9_0xfaad39(0x106))),UpdateService_1=__importDefault(require(a9_0xfaad39(0x119))),DeleteService_1=__importDefault(require('../services/CampaignService/DeleteService')),FindService_1=__importDefault(require(a9_0xfaad39(0xf9))),Campaign_1=__importDefault(require(a9_0xfaad39(0x11c))),ContactTag_1=__importDefault(require(a9_0xfaad39(0x140))),Contact_1=__importDefault(require(a9_0xfaad39(0x113))),ContactList_1=__importDefault(require(a9_0xfaad39(0x138))),ContactListItem_1=__importDefault(require(a9_0xfaad39(0xf8))),AppError_1=__importDefault(require(a9_0xfaad39(0x112))),CancelService_1=require(a9_0xfaad39(0x102)),RestartService_1=require(a9_0xfaad39(0xf2)),index=async(_0x97c5ee,_0x971535)=>{const _0x484323=a9_0xfaad39,{searchParam:_0x1467e6,pageNumber:_0x428b39}=_0x97c5ee['query'],{companyId:_0x49e056}=_0x97c5ee[_0x484323(0x121)],{records:_0x35cada,count:_0x356f1c,hasMore:_0x31ca14}=await(0x0,ListService_1[_0x484323(0xec)])({'searchParam':_0x1467e6,'pageNumber':_0x428b39,'companyId':_0x49e056});return _0x971535['json']({'records':_0x35cada,'count':_0x356f1c,'hasMore':_0x31ca14});};exports[a9_0xfaad39(0xee)]=index;function a9_0x5760(_0x5d977e,_0x2b3234){const _0x3ae6a4=a9_0x3ae6();return a9_0x5760=function(_0x576076,_0x5a3398){_0x576076=_0x576076-0xea;let _0x4c0a36=_0x3ae6a4[_0x576076];return _0x4c0a36;},a9_0x5760(_0x5d977e,_0x2b3234);}const store=async(_0x1e586c,_0x424120)=>{const _0x19fc99=a9_0xfaad39,{companyId:_0x303a89}=_0x1e586c[_0x19fc99(0x121)],_0x3e3309=_0x1e586c['body'],_0x2f0a6e=Yup[_0x19fc99(0x105)]()[_0x19fc99(0x141)]({'name':Yup[_0x19fc99(0xf6)]()['required']()});try{await _0x2f0a6e[_0x19fc99(0x114)](_0x3e3309);}catch(_0x12b38d){throw new AppError_1[(_0x19fc99(0xec))](_0x12b38d[_0x19fc99(0x133)]);}if(typeof _0x3e3309[_0x19fc99(0x108)]===_0x19fc99(0xeb)){const _0x3e20bd=_0x3e3309[_0x19fc99(0x108)],_0x187746=_0x3e3309[_0x19fc99(0x124)];async function _0x3c17fd(_0x9f082a){const _0x36802a=_0x19fc99,_0x56d78c=new Date(),_0x158ee6=_0x56d78c[_0x36802a(0x12f)]();try{const _0x5c53e2=await ContactTag_1['default'][_0x36802a(0x12b)]({'where':{'tagId':_0x9f082a}}),_0x50a5e5=_0x5c53e2[_0x36802a(0x116)](_0xb4e1d8=>_0xb4e1d8['contactId']),_0x339bc6=await Contact_1[_0x36802a(0xec)][_0x36802a(0x12b)]({'where':{'id':_0x50a5e5}}),_0x50ad5f=_0x187746+_0x36802a(0x123)+_0x9f082a+_0x36802a(0x12d)+_0x158ee6,_0x18d4be=await ContactList_1[_0x36802a(0xec)][_0x36802a(0x134)]({'name':_0x50ad5f,'companyId':_0x303a89}),{id:_0x483a14}=_0x18d4be,_0x390be9=_0x339bc6[_0x36802a(0x116)](_0x28fe64=>({'name':_0x28fe64[_0x36802a(0x124)],'number':_0x28fe64['number'],'email':_0x28fe64['email'],'contactListId':_0x483a14,'companyId':_0x303a89,'isWhatsappValid':!![],'isGroup':_0x28fe64[_0x36802a(0x125)]}));return await ContactListItem_1[_0x36802a(0xec)][_0x36802a(0x12c)](_0x390be9),_0x483a14;}catch(_0x30ea99){console[_0x36802a(0x10e)](_0x36802a(0x117),_0x30ea99);throw _0x30ea99;}}_0x3c17fd(_0x3e20bd)[_0x19fc99(0x146)](async _0x68e7d=>{const _0x2b8962=_0x19fc99,_0x79d6=await(0x0,CreateService_1['default'])({..._0x3e3309,'companyId':_0x303a89,'contactListId':_0x68e7d}),_0x505f7e=(0x0,socket_1['getIO'])();return _0x505f7e[_0x2b8962(0x12a)](_0x2b8962(0x148)+_0x303a89+_0x2b8962(0x111),{'action':_0x2b8962(0x134),'record':_0x79d6}),_0x424120[_0x2b8962(0xfc)](0xc8)[_0x2b8962(0x129)](_0x79d6);})[_0x19fc99(0x100)](_0x811eab=>{const _0x39c857=_0x19fc99;return console[_0x39c857(0x10e)](_0x39c857(0xf0),_0x811eab),_0x424120['status'](0x1f4)[_0x39c857(0x129)]({'error':_0x39c857(0x13b)});});}else{const _0x442b9d=await(0x0,CreateService_1[_0x19fc99(0xec)])({..._0x3e3309,'companyId':_0x303a89}),_0x114633=(0x0,socket_1[_0x19fc99(0x107)])();return _0x114633['emit'](_0x19fc99(0x148)+_0x303a89+_0x19fc99(0x111),{'action':'create','record':_0x442b9d}),_0x424120['status'](0xc8)[_0x19fc99(0x129)](_0x442b9d);}};exports['store']=store;const show=async(_0x1a8943,_0xeba32e)=>{const _0xf0c027=a9_0xfaad39,{id:_0x80d19b}=_0x1a8943['params'],_0x12fb5a=await(0x0,ShowService_1[_0xf0c027(0xec)])(_0x80d19b);return _0xeba32e[_0xf0c027(0xfc)](0xc8)[_0xf0c027(0x129)](_0x12fb5a);};exports[a9_0xfaad39(0x11e)]=show;const update=async(_0x1001fd,_0x59303c)=>{const _0x68b199=a9_0xfaad39,_0x48c425=_0x1001fd[_0x68b199(0x13c)];console[_0x68b199(0x10d)](_0x48c425);const {companyId:_0x3de459}=_0x1001fd[_0x68b199(0x121)],_0x29c4e3=Yup['object']()['shape']({'name':Yup[_0x68b199(0xf6)]()['required']()});try{await _0x29c4e3['validate'](_0x48c425);}catch(_0x105c3e){throw new AppError_1['default'](_0x105c3e['message']);}const {id:_0xcd7c22}=_0x1001fd['params'],_0x3bfa87=await(0x0,UpdateService_1[_0x68b199(0xec)])({..._0x48c425,'id':_0xcd7c22}),_0x324f40=(0x0,socket_1['getIO'])();return _0x324f40[_0x68b199(0x12a)](_0x68b199(0x148)+_0x3de459+_0x68b199(0x111),{'action':_0x68b199(0x12e),'record':_0x3bfa87}),_0x59303c[_0x68b199(0xfc)](0xc8)[_0x68b199(0x129)](_0x3bfa87);};exports[a9_0xfaad39(0x12e)]=update;const cancel=async(_0x38e20f,_0x4fedb5)=>{const _0x1b6fa0=a9_0xfaad39,{id:_0x2b07ca}=_0x38e20f[_0x1b6fa0(0x143)];return await(0x0,CancelService_1['CancelService'])(+_0x2b07ca),_0x4fedb5[_0x1b6fa0(0xfc)](0xcc)[_0x1b6fa0(0x129)]({'message':'Cancelamento\x20realizado'});};exports[a9_0xfaad39(0x127)]=cancel;const restart=async(_0x116acc,_0x1a34d2)=>{const _0x734efe=a9_0xfaad39,{id:_0x29f69f}=_0x116acc[_0x734efe(0x143)];return await(0x0,RestartService_1['RestartService'])(+_0x29f69f),_0x1a34d2['status'](0xcc)[_0x734efe(0x129)]({'message':_0x734efe(0x10f)});};exports[a9_0xfaad39(0x110)]=restart;const remove=async(_0x4b5301,_0x3fe8fc)=>{const _0x236532=a9_0xfaad39,{id:_0x180614}=_0x4b5301[_0x236532(0x143)],{companyId:_0x46e96d}=_0x4b5301[_0x236532(0x121)];await(0x0,DeleteService_1[_0x236532(0xec)])(_0x180614);const _0x5358de=(0x0,socket_1[_0x236532(0x107)])();return _0x5358de[_0x236532(0x12a)](_0x236532(0x148)+_0x46e96d+_0x236532(0x111),{'action':_0x236532(0xfe),'id':_0x180614}),_0x3fe8fc[_0x236532(0xfc)](0xc8)[_0x236532(0x129)]({'message':_0x236532(0x11f)});};exports[a9_0xfaad39(0x10b)]=remove;const findList=async(_0xa5b588,_0x348cd2)=>{const _0x5d4242=a9_0xfaad39,_0x20ff2e=_0xa5b588[_0x5d4242(0xea)],_0x2041e7=await(0x0,FindService_1[_0x5d4242(0xec)])(_0x20ff2e);return _0x348cd2[_0x5d4242(0xfc)](0xc8)[_0x5d4242(0x129)](_0x2041e7);};exports[a9_0xfaad39(0x131)]=findList;const mediaUpload=async(_0x382866,_0x45b195)=>{const _0x367598=a9_0xfaad39,{id:_0x78b0ce}=_0x382866[_0x367598(0x143)],_0x4bc632=_0x382866[_0x367598(0x13f)],_0x22bc1a=(0x0,lodash_1[_0x367598(0x104)])(_0x4bc632);try{const _0x4cc1ee=await Campaign_1[_0x367598(0xec)]['findByPk'](_0x78b0ce);return _0x4cc1ee['mediaPath']=_0x22bc1a[_0x367598(0xf5)],_0x4cc1ee[_0x367598(0x122)]=_0x22bc1a[_0x367598(0x135)],await _0x4cc1ee[_0x367598(0x128)](),_0x45b195[_0x367598(0x109)]({'mensagem':_0x367598(0xfa)});}catch(_0x575241){throw new AppError_1[(_0x367598(0xec))](_0x575241['message']);}};exports['mediaUpload']=mediaUpload;const deleteMedia=async(_0x5828e8,_0x33e332)=>{const _0x51ed04=a9_0xfaad39,{id:_0x5a32b6}=_0x5828e8['params'];try{const _0xbba438=await Campaign_1[_0x51ed04(0xec)][_0x51ed04(0xfd)](_0x5a32b6),_0x33d475=path_1['default'][_0x51ed04(0x10c)]('public',_0xbba438['mediaPath']),_0x3bdc16=fs_1['default'][_0x51ed04(0x10a)](_0x33d475);return _0x3bdc16&&fs_1['default'][_0x51ed04(0x139)](_0x33d475),_0xbba438['mediaPath']=null,_0xbba438[_0x51ed04(0x122)]=null,await _0xbba438[_0x51ed04(0x128)](),_0x33e332[_0x51ed04(0x109)]({'mensagem':_0x51ed04(0x144)});}catch(_0x1a2a00){throw new AppError_1[(_0x51ed04(0xec))](_0x1a2a00[_0x51ed04(0x133)]);}};exports[a9_0xfaad39(0x13d)]=deleteMedia;