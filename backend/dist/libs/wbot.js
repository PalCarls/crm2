'use strict';function a231_0x5b12(_0x30f0ea,_0x340c86){const _0x2b4cc5=a231_0x2b4c();return a231_0x5b12=function(_0x5b120b,_0x135c21){_0x5b120b=_0x5b120b-0x183;let _0x52c6ee=_0x2b4cc5[_0x5b120b];return _0x52c6ee;},a231_0x5b12(_0x30f0ea,_0x340c86);}const a231_0x26c3e4=a231_0x5b12;(function(_0x2d23f9,_0x59fff0){const _0x3923e4=a231_0x5b12,_0x41c34a=_0x2d23f9();while(!![]){try{const _0x5b82cf=-parseInt(_0x3923e4(0x192))/0x1*(parseInt(_0x3923e4(0x1d3))/0x2)+-parseInt(_0x3923e4(0x1de))/0x3*(-parseInt(_0x3923e4(0x193))/0x4)+parseInt(_0x3923e4(0x1d0))/0x5*(parseInt(_0x3923e4(0x1dd))/0x6)+-parseInt(_0x3923e4(0x1c3))/0x7*(-parseInt(_0x3923e4(0x1ca))/0x8)+-parseInt(_0x3923e4(0x1d5))/0x9*(-parseInt(_0x3923e4(0x1bd))/0xa)+-parseInt(_0x3923e4(0x183))/0xb+-parseInt(_0x3923e4(0x1a4))/0xc*(parseInt(_0x3923e4(0x1cd))/0xd);if(_0x5b82cf===_0x59fff0)break;else _0x41c34a['push'](_0x41c34a['shift']());}catch(_0x446828){_0x41c34a['push'](_0x41c34a['shift']());}}}(a231_0x2b4c,0x7a90b));var __createBinding=this&&this[a231_0x26c3e4(0x1c5)]||(Object[a231_0x26c3e4(0x1ac)]?function(_0x535da2,_0x9bbbff,_0x139688,_0x52e1f2){const _0xecb1=a231_0x26c3e4;if(_0x52e1f2===undefined)_0x52e1f2=_0x139688;var _0x3bf71f=Object[_0xecb1(0x1aa)](_0x9bbbff,_0x139688);(!_0x3bf71f||(_0xecb1(0x1b7)in _0x3bf71f?!_0x9bbbff[_0xecb1(0x1b3)]:_0x3bf71f[_0xecb1(0x1bc)]||_0x3bf71f[_0xecb1(0x1e3)]))&&(_0x3bf71f={'enumerable':!![],'get':function(){return _0x9bbbff[_0x139688];}}),Object[_0xecb1(0x18a)](_0x535da2,_0x52e1f2,_0x3bf71f);}:function(_0x38ddc0,_0x332204,_0x4ed89f,_0x56eb71){if(_0x56eb71===undefined)_0x56eb71=_0x4ed89f;_0x38ddc0[_0x56eb71]=_0x332204[_0x4ed89f];}),__setModuleDefault=this&&this[a231_0x26c3e4(0x19b)]||(Object[a231_0x26c3e4(0x1ac)]?function(_0x470e7f,_0xd03cad){const _0x3fe104=a231_0x26c3e4;Object[_0x3fe104(0x18a)](_0x470e7f,_0x3fe104(0x1db),{'enumerable':!![],'value':_0xd03cad});}:function(_0xe5fbe4,_0x136c97){_0xe5fbe4['default']=_0x136c97;}),__importStar=this&&this[a231_0x26c3e4(0x194)]||function(_0x2243c0){const _0x2233c1=a231_0x26c3e4;if(_0x2243c0&&_0x2243c0[_0x2233c1(0x1b3)])return _0x2243c0;var _0x495746={};if(_0x2243c0!=null){for(var _0xb15a9 in _0x2243c0)if(_0xb15a9!=='default'&&Object[_0x2233c1(0x1c8)][_0x2233c1(0x1e0)][_0x2233c1(0x1d4)](_0x2243c0,_0xb15a9))__createBinding(_0x495746,_0x2243c0,_0xb15a9);}return __setModuleDefault(_0x495746,_0x2243c0),_0x495746;},__importDefault=this&&this['__importDefault']||function(_0xe866e2){const _0x19d3dd=a231_0x26c3e4;return _0xe866e2&&_0xe866e2[_0x19d3dd(0x1b3)]?_0xe866e2:{'default':_0xe866e2};};function a231_0x2b4c(){const _0x260556=['close','isJidBroadcast','set','119aKNZVb','../errors/AppError','__createBinding','PENDING','statusCode','prototype','findAll','414824HTiPxR','log','update','19780397xkkQZN','buttonsMessage','splice','5YuClFq','level','Starting\x20session\x20','483034NaioXV','call','165609mBYjHE','CONNECTED','emit','@whiskeysockets/baileys','open','logout','default','removeAllListeners','5919534VwecYj','6ZZumwQ','DisconnectReason','hasOwnProperty','split','qrcode','configurable','3978040tjGORc','companyId','-whatsappSession','getWbot','\x20Connection\x20Update\x20','push','findIndex','defineProperty','creds','../services/WbotServices/StartWhatsAppSession','useMultiFileAuthState','delete','fetchLatestBaileysVersion','BROWSER_VERSION','Chrome','1FMwVfm','229256hiZhmi','__importStar','removeWbot','error','using\x20WA\x20v','child','BROWSER_CLIENT','findOne','__setModuleDefault','connection.update','info','StartWhatsAppSession','jidNormalizedUser','output','./cache','@whiskeysockets/baileys/lib/Utils/logger','templateMessage','12HOCtHd','listMessage','../utils/logger','user','company-','../services/BaileysServices/DeleteBaileysService','getOwnPropertyDescriptor','logger','create','initWASocket','TOGI\x20Talk','Session\x20QRCode\x20Generate\x20','10.0','cacheLayer','delFromPattern','__esModule','creds.update',',\x20isLatest:\x20','restartWbot','get','makeCacheableSignalKeyStore','BROWSER_NAME','getIO','env','writable','350GqgslI','DISCONNECTED','sessions:'];a231_0x2b4c=function(){return _0x260556;};return a231_0x2b4c();}Object[a231_0x26c3e4(0x18a)](exports,'__esModule',{'value':!![]}),exports[a231_0x26c3e4(0x1ad)]=exports[a231_0x26c3e4(0x195)]=exports[a231_0x26c3e4(0x1b6)]=exports[a231_0x26c3e4(0x186)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),baileys_1=__importStar(require(a231_0x26c3e4(0x1d8))),Whatsapp_1=__importDefault(require('../models/Whatsapp')),logger_1=require(a231_0x26c3e4(0x1a6)),logger_2=__importDefault(require(a231_0x26c3e4(0x1a2))),useMultiFileAuthState_1=require('../helpers/useMultiFileAuthState'),AppError_1=__importDefault(require(a231_0x26c3e4(0x1c4))),socket_1=require('./socket'),StartWhatsAppSession_1=require(a231_0x26c3e4(0x18c)),DeleteBaileysService_1=__importDefault(require(a231_0x26c3e4(0x1a9))),cache_1=require(a231_0x26c3e4(0x1a1)),loggerBaileys=logger_2['default'][a231_0x26c3e4(0x198)]({});loggerBaileys[a231_0x26c3e4(0x1d1)]=a231_0x26c3e4(0x196);const sessions=[],retriesQrCodeMap=new Map(),getWbot=_0x38447d=>{const _0x4c6d08=a231_0x26c3e4,_0x48c83f=sessions[_0x4c6d08(0x189)](_0x2d3213=>_0x2d3213['id']===_0x38447d);if(_0x48c83f===-0x1)throw new AppError_1[(_0x4c6d08(0x1db))]('ERR_WAPP_NOT_INITIALIZED');return sessions[_0x48c83f];};exports[a231_0x26c3e4(0x186)]=getWbot;const restartWbot=async(_0x8c9d46,_0x16e394)=>{const _0x9d3ecf=a231_0x26c3e4;try{const _0x4f3bca={'where':{'companyId':_0x8c9d46},'attributes':['id']},_0x16384b=await Whatsapp_1['default'][_0x9d3ecf(0x1c9)](_0x4f3bca);_0x16384b['map'](async _0x43286b=>{const _0x28574e=_0x9d3ecf,_0x37d479=sessions[_0x28574e(0x189)](_0x5519e7=>_0x5519e7['id']===_0x43286b['id']);_0x37d479!==-0x1&&sessions[_0x37d479]['ws'][_0x28574e(0x1c0)]();});}catch(_0x2db42f){logger_1['logger'][_0x9d3ecf(0x196)](_0x2db42f);}};exports[a231_0x26c3e4(0x1b6)]=restartWbot;const removeWbot=async(_0x27db36,_0x1abee2=!![])=>{const _0x3d7306=a231_0x26c3e4;try{const _0x38d743=sessions['findIndex'](_0x18f04c=>_0x18f04c['id']===_0x27db36);_0x38d743!==-0x1&&(_0x1abee2&&(sessions[_0x38d743][_0x3d7306(0x1da)](),sessions[_0x38d743]['ws']['close']()),sessions[_0x3d7306(0x1cf)](_0x38d743,0x1));}catch(_0x3f2ae4){logger_1['logger'][_0x3d7306(0x196)](_0x3f2ae4);}};exports[a231_0x26c3e4(0x195)]=removeWbot;const initWASocket=async _0x503851=>{return new Promise(async(_0x2df0c8,_0x376a79)=>{const _0x1eb70a=a231_0x5b12;try{((async()=>{const _0xaaee3e=a231_0x5b12,_0x38e1bf=(0x0,socket_1[_0xaaee3e(0x1ba)])(),_0x4e2cbb=await Whatsapp_1[_0xaaee3e(0x1db)][_0xaaee3e(0x19a)]({'where':{'id':_0x503851['id']}});if(!_0x4e2cbb)return;const {id:_0x172a1e,name:_0x3d7fe9,provider:_0x46b8ae}=_0x4e2cbb,{version:_0x14cb46,isLatest:_0x27c29d}=await(0x0,baileys_1[_0xaaee3e(0x18f)])();logger_1[_0xaaee3e(0x1ab)][_0xaaee3e(0x19d)](_0xaaee3e(0x197)+_0x14cb46['join']('.')+_0xaaee3e(0x1b5)+_0x27c29d),logger_1[_0xaaee3e(0x1ab)][_0xaaee3e(0x19d)](_0xaaee3e(0x1d2)+_0x3d7fe9);let _0x3ee06b=0x0,_0x58e75e=null;const {state:_0x4726f1,saveCreds:_0xd290d0}=await(0x0,useMultiFileAuthState_1[_0xaaee3e(0x18d)])(_0x503851);_0x58e75e=(0x0,baileys_1[_0xaaee3e(0x1db)])({'logger':loggerBaileys,'printQRInTerminal':![],'browser':[process[_0xaaee3e(0x1bb)][_0xaaee3e(0x199)]||_0xaaee3e(0x1ae),process[_0xaaee3e(0x1bb)][_0xaaee3e(0x1b9)]||_0xaaee3e(0x191),process[_0xaaee3e(0x1bb)][_0xaaee3e(0x190)]||_0xaaee3e(0x1b0)],'auth':{'creds':_0x4726f1[_0xaaee3e(0x18b)],'keys':(0x0,baileys_1[_0xaaee3e(0x1b8)])(_0x4726f1['keys'],logger_1[_0xaaee3e(0x1ab)])},'version':_0x14cb46,'shouldIgnoreJid':_0x4244e3=>(0x0,baileys_1[_0xaaee3e(0x1c1)])(_0x4244e3),'patchMessageBeforeSending':_0x3a9b35=>{const _0x1d69ed=_0xaaee3e,_0x266d0c=!!(_0x3a9b35[_0x1d69ed(0x1ce)]||_0x3a9b35[_0x1d69ed(0x1a3)]||_0x3a9b35[_0x1d69ed(0x1a5)]);return _0x266d0c&&(_0x3a9b35={'viewOnceMessageV2':{'message':{'messageContextInfo':{'deviceListMetadataVersion':0x2,'deviceListMetadata':{}},..._0x3a9b35}}}),_0x3a9b35;}}),_0x58e75e['ev']['on'](_0xaaee3e(0x19c),async({connection:_0x4d3010,lastDisconnect:_0x40965a,qr:_0x5170cf})=>{const _0x33b6d7=_0xaaee3e;logger_1[_0x33b6d7(0x1ab)]['info']('Socket\x20\x20'+_0x3d7fe9+_0x33b6d7(0x187)+(_0x4d3010||'')+'\x20'+(_0x40965a||''));_0x4d3010===_0x33b6d7(0x1c0)&&(_0x40965a?.[_0x33b6d7(0x196)]?.[_0x33b6d7(0x1a0)]?.['statusCode']===0x193&&(await _0x503851['update']({'status':_0x33b6d7(0x1c6),'session':''}),await(0x0,DeleteBaileysService_1[_0x33b6d7(0x1db)])(_0x503851['id']),await cache_1[_0x33b6d7(0x1b1)][_0x33b6d7(0x1b2)](_0x33b6d7(0x1bf)+_0x503851['id']+':*'),_0x38e1bf[_0x33b6d7(0x1d7)]('company-'+_0x503851[_0x33b6d7(0x184)]+_0x33b6d7(0x185),{'action':_0x33b6d7(0x1cc),'session':_0x503851}),(0x0,exports[_0x33b6d7(0x195)])(_0x172a1e,![])),_0x40965a?.[_0x33b6d7(0x196)]?.['output']?.[_0x33b6d7(0x1c7)]!==baileys_1[_0x33b6d7(0x1df)]['loggedOut']?((0x0,exports[_0x33b6d7(0x195)])(_0x172a1e,![]),setTimeout(()=>(0x0,StartWhatsAppSession_1[_0x33b6d7(0x19e)])(_0x503851,_0x503851['companyId']),0x7d0)):(await _0x503851['update']({'status':_0x33b6d7(0x1c6),'session':''}),await(0x0,DeleteBaileysService_1[_0x33b6d7(0x1db)])(_0x503851['id']),await cache_1[_0x33b6d7(0x1b1)][_0x33b6d7(0x1b2)](_0x33b6d7(0x1bf)+_0x503851['id']+':*'),_0x38e1bf['emit'](_0x33b6d7(0x1a8)+_0x503851[_0x33b6d7(0x184)]+_0x33b6d7(0x185),{'action':_0x33b6d7(0x1cc),'session':_0x503851}),(0x0,exports['removeWbot'])(_0x172a1e,![]),setTimeout(()=>(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x503851,_0x503851[_0x33b6d7(0x184)]),0x7d0)));if(_0x4d3010===_0x33b6d7(0x1d9)){await _0x503851[_0x33b6d7(0x1cc)]({'status':_0x33b6d7(0x1d6),'qrcode':'','retries':0x0,'number':_0x58e75e['type']==='md'?(0x0,baileys_1[_0x33b6d7(0x19f)])(_0x58e75e[_0x33b6d7(0x1a7)]['id'])[_0x33b6d7(0x1e1)]('@')[0x0]:'-'}),_0x38e1bf['emit']('company-'+_0x503851['companyId']+_0x33b6d7(0x185),{'action':_0x33b6d7(0x1cc),'session':_0x503851});const _0x529581=sessions['findIndex'](_0x4aae04=>_0x4aae04['id']===_0x503851['id']);_0x529581===-0x1&&(_0x58e75e['id']=_0x503851['id'],sessions[_0x33b6d7(0x188)](_0x58e75e)),_0x2df0c8(_0x58e75e);}if(_0x5170cf!==undefined){if(retriesQrCodeMap[_0x33b6d7(0x1b7)](_0x172a1e)&&retriesQrCodeMap['get'](_0x172a1e)>=0x3)await _0x4e2cbb[_0x33b6d7(0x1cc)]({'status':_0x33b6d7(0x1be),'qrcode':''}),await(0x0,DeleteBaileysService_1[_0x33b6d7(0x1db)])(_0x4e2cbb['id']),await cache_1[_0x33b6d7(0x1b1)][_0x33b6d7(0x1b2)](_0x33b6d7(0x1bf)+_0x503851['id']+':*'),_0x38e1bf['emit'](_0x33b6d7(0x1a8)+_0x503851[_0x33b6d7(0x184)]+'-whatsappSession',{'action':_0x33b6d7(0x1cc),'session':_0x4e2cbb}),_0x58e75e['ev'][_0x33b6d7(0x1dc)]('connection.update'),_0x58e75e['ws'][_0x33b6d7(0x1c0)](),_0x58e75e=null,retriesQrCodeMap[_0x33b6d7(0x18e)](_0x172a1e);else{logger_1[_0x33b6d7(0x1ab)][_0x33b6d7(0x19d)](_0x33b6d7(0x1af)+_0x3d7fe9),retriesQrCodeMap[_0x33b6d7(0x1c2)](_0x172a1e,_0x3ee06b+=0x1),await _0x503851['update']({'qrcode':_0x5170cf,'status':_0x33b6d7(0x1e2),'retries':0x0,'number':''});const _0xb38ac2=sessions[_0x33b6d7(0x189)](_0x2d889c=>_0x2d889c['id']===_0x503851['id']);_0xb38ac2===-0x1&&(_0x58e75e['id']=_0x503851['id'],sessions[_0x33b6d7(0x188)](_0x58e75e)),_0x38e1bf[_0x33b6d7(0x1d7)](_0x33b6d7(0x1a8)+_0x503851['companyId']+_0x33b6d7(0x185),{'action':_0x33b6d7(0x1cc),'session':_0x503851});}}}),_0x58e75e['ev']['on'](_0xaaee3e(0x1b4),_0xd290d0);})());}catch(_0x3c9ab5){Sentry['captureException'](_0x3c9ab5),console[_0x1eb70a(0x1cb)](_0x3c9ab5),_0x376a79(_0x3c9ab5);}});};exports[a231_0x26c3e4(0x1ad)]=initWASocket;