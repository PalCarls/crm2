'use strict';const a322_0x16b7c1=a322_0x3f4d;(function(_0x49c79a,_0x259d3b){const _0x1df202=a322_0x3f4d,_0x96b094=_0x49c79a();while(!![]){try{const _0x59917e=-parseInt(_0x1df202(0x1b3))/0x1+parseInt(_0x1df202(0x1a4))/0x2*(-parseInt(_0x1df202(0x12c))/0x3)+-parseInt(_0x1df202(0x14d))/0x4+parseInt(_0x1df202(0xee))/0x5*(-parseInt(_0x1df202(0x168))/0x6)+parseInt(_0x1df202(0x11d))/0x7+parseInt(_0x1df202(0x102))/0x8*(-parseInt(_0x1df202(0x15c))/0x9)+-parseInt(_0x1df202(0x1bf))/0xa*(-parseInt(_0x1df202(0xf0))/0xb);if(_0x59917e===_0x259d3b)break;else _0x96b094['push'](_0x96b094['shift']());}catch(_0x1009bd){_0x96b094['push'](_0x96b094['shift']());}}}(a322_0x1487,0x3c0c2));var __createBinding=this&&this[a322_0x16b7c1(0xcc)]||(Object['create']?function(_0x285c25,_0xf12e8a,_0x172f50,_0xcbdcf3){const _0x4e5d5d=a322_0x16b7c1;if(_0xcbdcf3===undefined)_0xcbdcf3=_0x172f50;var _0x55abad=Object[_0x4e5d5d(0x111)](_0xf12e8a,_0x172f50);(!_0x55abad||(_0x4e5d5d(0x145)in _0x55abad?!_0xf12e8a[_0x4e5d5d(0x1c1)]:_0x55abad[_0x4e5d5d(0x125)]||_0x55abad[_0x4e5d5d(0xfe)]))&&(_0x55abad={'enumerable':!![],'get':function(){return _0xf12e8a[_0x172f50];}}),Object['defineProperty'](_0x285c25,_0xcbdcf3,_0x55abad);}:function(_0x4b7518,_0x2d871a,_0x38e501,_0x1f7569){if(_0x1f7569===undefined)_0x1f7569=_0x38e501;_0x4b7518[_0x1f7569]=_0x2d871a[_0x38e501];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a322_0x16b7c1(0x140)]?function(_0x41cad2,_0x4806c6){const _0x126071=a322_0x16b7c1;Object['defineProperty'](_0x41cad2,_0x126071(0x146),{'enumerable':!![],'value':_0x4806c6});}:function(_0x2cda6d,_0x2c08bd){const _0x5d002d=a322_0x16b7c1;_0x2cda6d[_0x5d002d(0x146)]=_0x2c08bd;}),__importStar=this&&this['__importStar']||function(_0x44b864){const _0x49749f=a322_0x16b7c1;if(_0x44b864&&_0x44b864['__esModule'])return _0x44b864;var _0x3cb1ba={};if(_0x44b864!=null){for(var _0x3a8f19 in _0x44b864)if(_0x3a8f19!==_0x49749f(0x146)&&Object['prototype'][_0x49749f(0x15a)][_0x49749f(0x175)](_0x44b864,_0x3a8f19))__createBinding(_0x3cb1ba,_0x44b864,_0x3a8f19);}return __setModuleDefault(_0x3cb1ba,_0x44b864),_0x3cb1ba;},__importDefault=this&&this['__importDefault']||function(_0x17369c){return _0x17369c&&_0x17369c['__esModule']?_0x17369c:{'default':_0x17369c};};Object[a322_0x16b7c1(0x100)](exports,a322_0x16b7c1(0x1c1),{'value':!![]}),exports[a322_0x16b7c1(0x127)]=exports['randomValue']=exports[a322_0x16b7c1(0x1ad)]=exports[a322_0x16b7c1(0x13c)]=exports[a322_0x16b7c1(0x16d)]=exports[a322_0x16b7c1(0x1ac)]=exports[a322_0x16b7c1(0xc8)]=exports['scheduleMonitor']=exports[a322_0x16b7c1(0x17f)]=void 0x0;const Sentry=__importStar(require(a322_0x16b7c1(0xd0))),bull_1=__importDefault(require(a322_0x16b7c1(0x163))),SendMessage_1=require(a322_0x16b7c1(0x1a5)),Whatsapp_1=__importDefault(require(a322_0x16b7c1(0x16a))),logger_1=require(a322_0x16b7c1(0xce)),moment_1=__importDefault(require(a322_0x16b7c1(0x1a3))),Schedule_1=__importDefault(require('./models/Schedule')),sequelize_1=require('sequelize'),GetDefaultWhatsApp_1=__importDefault(require('./helpers/GetDefaultWhatsApp')),Campaign_1=__importDefault(require(a322_0x16b7c1(0x196))),Queue_1=__importDefault(require(a322_0x16b7c1(0xe6))),ContactList_1=__importDefault(require(a322_0x16b7c1(0x171))),ContactListItem_1=__importDefault(require(a322_0x16b7c1(0x104))),lodash_1=require(a322_0x16b7c1(0x164)),CampaignSetting_1=__importDefault(require(a322_0x16b7c1(0x137))),CampaignShipping_1=__importDefault(require(a322_0x16b7c1(0xc5))),GetWhatsappWbot_1=__importDefault(require('./helpers/GetWhatsappWbot')),database_1=__importDefault(require(a322_0x16b7c1(0x132))),SendWhatsAppMedia_1=require(a322_0x16b7c1(0x130)),socket_1=require(a322_0x16b7c1(0x148)),path_1=__importDefault(require(a322_0x16b7c1(0x12e))),User_1=__importDefault(require('./models/User')),Company_1=__importDefault(require(a322_0x16b7c1(0x1b0))),Contact_1=__importDefault(require(a322_0x16b7c1(0xe4))),Queue_2=__importDefault(require(a322_0x16b7c1(0xe6))),wbotClosedTickets_1=require(a322_0x16b7c1(0x115)),Ticket_1=__importDefault(require(a322_0x16b7c1(0x177))),ShowContactService_1=__importDefault(require('./services/ContactServices/ShowContactService')),GetProfilePicUrl_1=__importDefault(require(a322_0x16b7c1(0x10b))),CreateOrUpdateContactService_1=__importDefault(require(a322_0x16b7c1(0x12b))),UserQueue_1=__importDefault(require(a322_0x16b7c1(0x10c))),ShowTicketService_1=__importDefault(require(a322_0x16b7c1(0x1ae))),SendWhatsAppMessage_1=__importDefault(require(a322_0x16b7c1(0xef))),UpdateTicketService_1=__importDefault(require(a322_0x16b7c1(0x1be))),date_fns_1=require('date-fns'),GetWhatsapp_1=require(a322_0x16b7c1(0xcd)),nodemailer=require(a322_0x16b7c1(0x119)),CronJob=require(a322_0x16b7c1(0x112))[a322_0x16b7c1(0x13d)],axios_1=__importDefault(require(a322_0x16b7c1(0xf4))),connection=process[a322_0x16b7c1(0x1bd)][a322_0x16b7c1(0xfd)]||'',limiterMax=process[a322_0x16b7c1(0x1bd)][a322_0x16b7c1(0xd7)]||0x1,limiterDuration=process[a322_0x16b7c1(0x1bd)]['REDIS_OPT_LIMITER_DURATION']||0xbb8;exports['userMonitor']=new bull_1[(a322_0x16b7c1(0x146))](a322_0x16b7c1(0x129),connection),exports[a322_0x16b7c1(0x180)]=new bull_1['default'](a322_0x16b7c1(0x133),connection),exports[a322_0x16b7c1(0xc8)]=new bull_1[(a322_0x16b7c1(0x146))](a322_0x16b7c1(0x124),connection),exports[a322_0x16b7c1(0x1ac)]=new bull_1['default'](a322_0x16b7c1(0x11e),connection),exports[a322_0x16b7c1(0x16d)]=new bull_1[(a322_0x16b7c1(0x146))](a322_0x16b7c1(0xd9),connection),exports['messageQueue']=new bull_1[(a322_0x16b7c1(0x146))](a322_0x16b7c1(0xe8),connection,{'limiter':{'max':limiterMax,'duration':limiterDuration}});async function handleSendMessage(_0xf0e291){const _0x1abcdb=a322_0x16b7c1;try{const {data:_0xac9f87}=_0xf0e291,_0x18ccf0=await Whatsapp_1[_0x1abcdb(0x146)][_0x1abcdb(0x16f)](_0xac9f87[_0x1abcdb(0x159)]);if(_0x18ccf0===null)throw Error(_0x1abcdb(0x138));const _0x58d1ed=_0xac9f87[_0x1abcdb(0x1c0)];await(0x0,SendMessage_1[_0x1abcdb(0x16b)])(_0x18ccf0,_0x58d1ed);}catch(_0x2ec429){Sentry[_0x1abcdb(0x183)](_0x2ec429),logger_1[_0x1abcdb(0x15d)][_0x1abcdb(0xe2)](_0x1abcdb(0x193),_0x2ec429[_0x1abcdb(0x15f)]);throw _0x2ec429;}}async function handleVerifySchedules(_0x26e28e){const _0x4b91ff=a322_0x16b7c1;try{const {count:_0x1faa52,rows:_0xfddcb5}=await Schedule_1[_0x4b91ff(0x146)][_0x4b91ff(0x113)]({'where':{'status':_0x4b91ff(0xd3),'sentAt':null,'sendAt':{[sequelize_1['Op'][_0x4b91ff(0x117)]]:(0x0,moment_1[_0x4b91ff(0x146)])()[_0x4b91ff(0x19e)](_0x4b91ff(0x16c)),[sequelize_1['Op'][_0x4b91ff(0x143)]]:(0x0,moment_1[_0x4b91ff(0x146)])()[_0x4b91ff(0x144)]('30',_0x4b91ff(0xd5))[_0x4b91ff(0x19e)](_0x4b91ff(0x16c))}},'include':[{'model':Contact_1['default'],'as':_0x4b91ff(0xf8)}]});_0x1faa52>0x0&&_0xfddcb5[_0x4b91ff(0x108)](async _0x49c071=>{const _0x16495c=_0x4b91ff;await _0x49c071[_0x16495c(0x1a8)]({'status':_0x16495c(0x16e)}),exports[_0x16495c(0xc8)][_0x16495c(0x144)](_0x16495c(0x16b),{'schedule':_0x49c071},{'delay':0x9c40}),logger_1[_0x16495c(0x15d)][_0x16495c(0x107)](_0x16495c(0x1ab)+_0x49c071[_0x16495c(0xf8)]['name']);});}catch(_0x541d7a){Sentry[_0x4b91ff(0x183)](_0x541d7a),logger_1[_0x4b91ff(0x15d)]['error'](_0x4b91ff(0x131),_0x541d7a[_0x4b91ff(0x15f)]);throw _0x541d7a;}}async function handleSendScheduledMessage(_0x585163){const _0x30fdfc=a322_0x16b7c1,{data:{schedule:_0x32d2bf}}=_0x585163;let _0x42e184=null;try{_0x42e184=await Schedule_1[_0x30fdfc(0x146)][_0x30fdfc(0x16f)](_0x32d2bf['id']);}catch(_0x5b61af){Sentry['captureException'](_0x5b61af),logger_1[_0x30fdfc(0x15d)][_0x30fdfc(0x107)](_0x30fdfc(0xe1)+_0x32d2bf['id']);}try{const _0xf7d8d8=await(0x0,GetDefaultWhatsApp_1[_0x30fdfc(0x146)])(_0x32d2bf[_0x30fdfc(0xe5)]);await(0x0,SendMessage_1[_0x30fdfc(0x16b)])(_0xf7d8d8,{'number':_0x32d2bf[_0x30fdfc(0xf8)][_0x30fdfc(0x1bc)],'body':_0x32d2bf[_0x30fdfc(0x185)]}),await _0x42e184?.[_0x30fdfc(0x1a8)]({'sentAt':(0x0,moment_1[_0x30fdfc(0x146)])()[_0x30fdfc(0x19e)](_0x30fdfc(0x135)),'status':_0x30fdfc(0xdf)}),logger_1[_0x30fdfc(0x15d)][_0x30fdfc(0x107)]('Mensagem\x20agendada\x20enviada\x20para:\x20'+_0x32d2bf[_0x30fdfc(0xf8)][_0x30fdfc(0x121)]),exports[_0x30fdfc(0xc8)][_0x30fdfc(0x15e)](0x3a98,_0x30fdfc(0xfc));}catch(_0xdd0b26){Sentry['captureException'](_0xdd0b26),await _0x42e184?.[_0x30fdfc(0x1a8)]({'status':'ERRO'}),logger_1[_0x30fdfc(0x15d)][_0x30fdfc(0xe2)](_0x30fdfc(0x1b5),_0xdd0b26[_0x30fdfc(0x15f)]);throw _0xdd0b26;}}async function handleVerifyCampaigns(_0x44ca3a){const _0x30f856=a322_0x16b7c1,_0x3454dc=await database_1[_0x30f856(0x146)][_0x30f856(0x150)](_0x30f856(0x12f),{'type':sequelize_1['QueryTypes'][_0x30f856(0xec)]});logger_1[_0x30f856(0x15d)][_0x30f856(0x107)]('Campanhas\x20encontradas:\x20'+_0x3454dc[_0x30f856(0x13f)]);for(let _0x16f338 of _0x3454dc){try{const _0x1d6dbe=(0x0,moment_1[_0x30f856(0x146)])(),_0x1ffedd=(0x0,moment_1[_0x30f856(0x146)])(_0x16f338[_0x30f856(0x19b)]),_0x41bbd6=_0x1ffedd[_0x30f856(0x1a6)](_0x1d6dbe,'milliseconds');logger_1[_0x30f856(0x15d)][_0x30f856(0x107)](_0x30f856(0x19a)+_0x16f338['id']+_0x30f856(0xc4)+_0x41bbd6),exports[_0x30f856(0x1ac)][_0x30f856(0x144)]('ProcessCampaign',{'id':_0x16f338['id'],'delay':_0x41bbd6},{'priority':0x3,'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}});}catch(_0x33c35a){Sentry['captureException'](_0x33c35a);}}}async function getCampaign(_0x98009d){const _0x3ca0b8=a322_0x16b7c1;return await Campaign_1[_0x3ca0b8(0x146)]['findOne']({'where':{'id':_0x98009d},'include':[{'model':ContactList_1[_0x3ca0b8(0x146)],'as':'contactList','attributes':['id',_0x3ca0b8(0x121)],'include':[{'model':ContactListItem_1[_0x3ca0b8(0x146)],'as':'contacts','attributes':['id',_0x3ca0b8(0x121),_0x3ca0b8(0x1bc),_0x3ca0b8(0xc2),_0x3ca0b8(0x1b9)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1[_0x3ca0b8(0x146)],'as':_0x3ca0b8(0x105),'attributes':['id',_0x3ca0b8(0x121)]}]});}async function getContact(_0x34a7fb){const _0x32bb44=a322_0x16b7c1;return await ContactListItem_1[_0x32bb44(0x146)]['findByPk'](_0x34a7fb,{'attributes':['id',_0x32bb44(0x121),_0x32bb44(0x1bc),_0x32bb44(0xc2)]});}async function getSettings(_0x1dd475){const _0x48c5f2=a322_0x16b7c1;try{const _0x52091d=await CampaignSetting_1['default'][_0x48c5f2(0x1bb)]({'where':{'companyId':_0x1dd475[_0x48c5f2(0xe5)]},'attributes':[_0x48c5f2(0xd4),_0x48c5f2(0x11c)]}),_0x5eb73d=_0x52091d['reduce']((_0x10752a,_0x47ccee)=>{const _0xbc496a=_0x48c5f2;return _0x10752a[_0x47ccee[_0xbc496a(0xd4)]]=JSON[_0xbc496a(0x170)](_0x47ccee[_0xbc496a(0x11c)]),_0x10752a;},{}),{messageInterval:messageInterval=0x14,longerIntervalAfter:longerIntervalAfter=0x14,greaterInterval:greaterInterval=0x3c,variables:variables=[]}=_0x5eb73d;return{'messageInterval':messageInterval,'longerIntervalAfter':longerIntervalAfter,'greaterInterval':greaterInterval,'variables':variables};}catch(_0x1033b4){console[_0x48c5f2(0xea)](_0x1033b4);throw _0x1033b4;}}function parseToMilliseconds(_0x5f4627){return _0x5f4627*0x3e8;}exports['parseToMilliseconds']=parseToMilliseconds;async function sleep(_0xada87f){const _0x1134b1=a322_0x16b7c1;return logger_1['logger']['info'](_0x1134b1(0x152)+_0xada87f+_0x1134b1(0x181)+(0x0,moment_1['default'])()[_0x1134b1(0x19e)]('HH:mm:ss')),new Promise(_0x29382a=>{setTimeout(()=>{const _0x14e949=a322_0x3f4d;logger_1['logger'][_0x14e949(0x107)](_0x14e949(0x152)+_0xada87f+_0x14e949(0x195)+(0x0,moment_1[_0x14e949(0x146)])()[_0x14e949(0x19e)]('HH:mm:ss')),_0x29382a(!![]);},parseToMilliseconds(_0xada87f));});}function getCampaignValidMessages(_0x38f2aa){const _0x5344c8=a322_0x16b7c1,_0x1e0a83=[];return!(0x0,lodash_1['isEmpty'])(_0x38f2aa['message1'])&&!(0x0,lodash_1['isNil'])(_0x38f2aa[_0x5344c8(0x139)])&&_0x1e0a83['push'](_0x38f2aa[_0x5344c8(0x139)]),!(0x0,lodash_1[_0x5344c8(0x12d)])(_0x38f2aa['message2'])&&!(0x0,lodash_1[_0x5344c8(0x128)])(_0x38f2aa[_0x5344c8(0xf3)])&&_0x1e0a83[_0x5344c8(0xf6)](_0x38f2aa[_0x5344c8(0xf3)]),!(0x0,lodash_1[_0x5344c8(0x12d)])(_0x38f2aa[_0x5344c8(0x10e)])&&!(0x0,lodash_1['isNil'])(_0x38f2aa['message3'])&&_0x1e0a83['push'](_0x38f2aa[_0x5344c8(0x10e)]),!(0x0,lodash_1[_0x5344c8(0x12d)])(_0x38f2aa[_0x5344c8(0xed)])&&!(0x0,lodash_1[_0x5344c8(0x128)])(_0x38f2aa[_0x5344c8(0xed)])&&_0x1e0a83['push'](_0x38f2aa[_0x5344c8(0xed)]),!(0x0,lodash_1[_0x5344c8(0x12d)])(_0x38f2aa[_0x5344c8(0xeb)])&&!(0x0,lodash_1[_0x5344c8(0x128)])(_0x38f2aa[_0x5344c8(0xeb)])&&_0x1e0a83[_0x5344c8(0xf6)](_0x38f2aa[_0x5344c8(0xeb)]),_0x1e0a83;}function getCampaignValidConfirmationMessages(_0xf52f4c){const _0x12a363=a322_0x16b7c1,_0x8ece69=[];return!(0x0,lodash_1[_0x12a363(0x12d)])(_0xf52f4c[_0x12a363(0x197)])&&!(0x0,lodash_1[_0x12a363(0x128)])(_0xf52f4c['confirmationMessage1'])&&_0x8ece69['push'](_0xf52f4c[_0x12a363(0x197)]),!(0x0,lodash_1[_0x12a363(0x12d)])(_0xf52f4c[_0x12a363(0x169)])&&!(0x0,lodash_1[_0x12a363(0x128)])(_0xf52f4c['confirmationMessage2'])&&_0x8ece69[_0x12a363(0xf6)](_0xf52f4c[_0x12a363(0x169)]),!(0x0,lodash_1[_0x12a363(0x12d)])(_0xf52f4c[_0x12a363(0x14e)])&&!(0x0,lodash_1[_0x12a363(0x128)])(_0xf52f4c['confirmationMessage3'])&&_0x8ece69[_0x12a363(0xf6)](_0xf52f4c[_0x12a363(0x14e)]),!(0x0,lodash_1[_0x12a363(0x12d)])(_0xf52f4c['confirmationMessage4'])&&!(0x0,lodash_1['isNil'])(_0xf52f4c['confirmationMessage4'])&&_0x8ece69[_0x12a363(0xf6)](_0xf52f4c[_0x12a363(0x188)]),!(0x0,lodash_1[_0x12a363(0x12d)])(_0xf52f4c[_0x12a363(0xf2)])&&!(0x0,lodash_1['isNil'])(_0xf52f4c[_0x12a363(0xf2)])&&_0x8ece69[_0x12a363(0xf6)](_0xf52f4c[_0x12a363(0xf2)]),_0x8ece69;}function getProcessedMessage(_0x402a64,_0x306f37,_0x2e9a51){const _0x1a6e5b=a322_0x16b7c1;let _0x23a07a=_0x402a64;return _0x23a07a[_0x1a6e5b(0x155)](_0x1a6e5b(0x14c))&&(_0x23a07a=_0x23a07a[_0x1a6e5b(0xcb)](/{nome}/g,_0x2e9a51[_0x1a6e5b(0x121)])),_0x23a07a[_0x1a6e5b(0x155)](_0x1a6e5b(0x18b))&&(_0x23a07a=_0x23a07a['replace'](/{email}/g,_0x2e9a51['email'])),_0x23a07a[_0x1a6e5b(0x155)](_0x1a6e5b(0x10a))&&(_0x23a07a=_0x23a07a[_0x1a6e5b(0xcb)](/{numero}/g,_0x2e9a51[_0x1a6e5b(0x1bc)])),_0x306f37['forEach'](_0x1c4e1d=>{const _0x252b92=_0x1a6e5b;if(_0x23a07a[_0x252b92(0x155)]('{'+_0x1c4e1d[_0x252b92(0xd4)]+'}')){const _0x3ff96f=new RegExp('{'+_0x1c4e1d[_0x252b92(0xd4)]+'}','g');_0x23a07a=_0x23a07a[_0x252b92(0xcb)](_0x3ff96f,_0x1c4e1d['value']);}}),_0x23a07a;}function randomValue(_0x519c01,_0x28a1f8){const _0x511762=a322_0x16b7c1;return Math[_0x511762(0x114)](Math['random']()*_0x28a1f8)+_0x519c01;}exports[a322_0x16b7c1(0x178)]=randomValue;async function verifyAndFinalizeCampaign(_0x11e4f2){const _0x5eaa76=a322_0x16b7c1,{contacts:_0x13ae4}=_0x11e4f2['contactList'],_0x55927e=_0x13ae4[_0x5eaa76(0x13f)],_0x35aed2=await CampaignShipping_1[_0x5eaa76(0x146)][_0x5eaa76(0x109)]({'where':{'campaignId':_0x11e4f2['id'],'deliveredAt':{[sequelize_1['Op'][_0x5eaa76(0x116)]]:null}}});_0x55927e===_0x35aed2&&await _0x11e4f2['update']({'status':_0x5eaa76(0x126),'completedAt':(0x0,moment_1[_0x5eaa76(0x146)])()});const _0x2f0b9f=(0x0,socket_1[_0x5eaa76(0x14b)])();_0x2f0b9f['emit'](_0x5eaa76(0xf7)+_0x11e4f2[_0x5eaa76(0xe5)]+'-campaign',{'action':'update','record':_0x11e4f2});}async function handleProcessCampaign(_0x15d3ea){const _0xdcff35=a322_0x16b7c1;try{const {id:_0x5a6f68}=_0x15d3ea[_0xdcff35(0x1c0)],_0x43d3a5=await getCampaign(_0x5a6f68),_0x3a7e30=await getSettings(_0x43d3a5);if(_0x43d3a5){const {contacts:_0x5a10f0}=_0x43d3a5[_0xdcff35(0x17c)];if((0x0,lodash_1[_0xdcff35(0x19c)])(_0x5a10f0)){const _0xb6b7ff=_0x5a10f0[_0xdcff35(0x108)](_0x528fe6=>({'contactId':_0x528fe6['id'],'campaignId':_0x43d3a5['id'],'variables':_0x3a7e30['variables']})),_0x4efd19=parseToMilliseconds(_0x3a7e30['longerIntervalAfter']),_0x244cc5=parseToMilliseconds(_0x3a7e30[_0xdcff35(0xfa)]),_0x22b190=_0x3a7e30[_0xdcff35(0x13b)];let _0x1e8f28=_0x43d3a5[_0xdcff35(0x19b)];const _0x57f877=[];for(let _0x29c93e=0x0;_0x29c93e<_0xb6b7ff[_0xdcff35(0x13f)];_0x29c93e++){_0x1e8f28=(0x0,date_fns_1[_0xdcff35(0x1b4)])(_0x1e8f28,_0x29c93e>_0x4efd19?_0x244cc5:_0x22b190);const {contactId:_0xae4c21,campaignId:_0x2e449a,variables:_0x27a71b}=_0xb6b7ff[_0x29c93e],_0x5bff6f=calculateDelay(_0x29c93e,_0x1e8f28,_0x4efd19,_0x244cc5,_0x22b190),_0x4abeb6=exports[_0xdcff35(0x1ac)][_0xdcff35(0x144)](_0xdcff35(0xdc),{'contactId':_0xae4c21,'campaignId':_0x2e449a,'variables':_0x27a71b,'delay':_0x5bff6f},{'removeOnComplete':!![]});_0x57f877['push'](_0x4abeb6),logger_1[_0xdcff35(0x15d)][_0xdcff35(0x107)](_0xdcff35(0x13e)+_0x43d3a5['id']+_0xdcff35(0x156)+_0x5a10f0[_0x29c93e][_0xdcff35(0x121)]+_0xdcff35(0x13a)+_0x5bff6f);}await Promise['all'](_0x57f877),await _0x43d3a5['update']({'status':'EM_ANDAMENTO'});}}}catch(_0x3213e8){Sentry[_0xdcff35(0x183)](_0x3213e8);}}function calculateDelay(_0x36c513,_0x447f77,_0x49a3d8,_0x17836c,_0x1f62fa){const _0x492467=(0x0,date_fns_1['differenceInSeconds'])(_0x447f77,new Date());return _0x36c513>_0x49a3d8?_0x492467*0x3e8+_0x17836c:_0x492467*0x3e8+_0x1f62fa;}async function handlePrepareContact(_0x3eee3a){const _0x27ea2a=a322_0x16b7c1;try{const {contactId:_0x2431e9,campaignId:_0x128ec4,delay:_0x5a3f96,variables:_0x5f11a6}=_0x3eee3a[_0x27ea2a(0x1c0)],_0x5ec224=await getCampaign(_0x128ec4),_0x5e980d=await getContact(_0x2431e9),_0xc017a8={};_0xc017a8[_0x27ea2a(0x1bc)]=_0x5e980d[_0x27ea2a(0x1bc)],_0xc017a8[_0x27ea2a(0x101)]=_0x2431e9,_0xc017a8[_0x27ea2a(0x1a1)]=_0x128ec4;const _0x15bbff=getCampaignValidMessages(_0x5ec224);if(_0x15bbff['length']){const _0x31a1cf=randomValue(0x0,_0x15bbff[_0x27ea2a(0x13f)]),_0x1984f4=getProcessedMessage(_0x15bbff[_0x31a1cf],_0x5f11a6,_0x5e980d);_0xc017a8[_0x27ea2a(0x15f)]='‌'+_0x1984f4;}if(_0x5ec224[_0x27ea2a(0x160)]){const _0x235043=getCampaignValidConfirmationMessages(_0x5ec224);if(_0x235043[_0x27ea2a(0x13f)]){const _0x36fbe7=randomValue(0x0,_0x235043[_0x27ea2a(0x13f)]),_0x2fb0cd=getProcessedMessage(_0x235043[_0x36fbe7],_0x5f11a6,_0x5e980d);_0xc017a8[_0x27ea2a(0xc7)]='‌'+_0x2fb0cd;}}const [_0x38199f,_0x11c4fa]=await CampaignShipping_1[_0x27ea2a(0x146)][_0x27ea2a(0x182)]({'where':{'campaignId':_0xc017a8[_0x27ea2a(0x1a1)],'contactId':_0xc017a8[_0x27ea2a(0x101)]},'defaults':_0xc017a8});!_0x11c4fa&&_0x38199f['deliveredAt']===null&&_0x38199f[_0x27ea2a(0x18f)]===null&&(_0x38199f[_0x27ea2a(0x179)](_0xc017a8),await _0x38199f[_0x27ea2a(0x1a9)]());if(_0x38199f[_0x27ea2a(0x15b)]===null&&_0x38199f[_0x27ea2a(0x18f)]===null){const _0x39fe55=await exports[_0x27ea2a(0x1ac)][_0x27ea2a(0x144)](_0x27ea2a(0xe3),{'campaignId':_0x5ec224['id'],'campaignShippingId':_0x38199f['id'],'contactListItemId':_0x2431e9},{'delay':_0x5a3f96});await _0x38199f[_0x27ea2a(0x1a8)]({'jobId':_0x39fe55['id']});}await verifyAndFinalizeCampaign(_0x5ec224);}catch(_0x2aa98a){Sentry[_0x27ea2a(0x183)](_0x2aa98a),logger_1[_0x27ea2a(0x15d)][_0x27ea2a(0xe2)](_0x27ea2a(0x176)+_0x2aa98a[_0x27ea2a(0x15f)]);}}async function handleDispatchCampaign(_0x435922){const _0x29f661=a322_0x16b7c1;try{const {data:_0x3a2661}=_0x435922,{campaignShippingId:_0x572d22,campaignId:_0x3b368f}=_0x3a2661,_0x43b863=await getCampaign(_0x3b368f),_0x5298ea=await(0x0,GetWhatsappWbot_1[_0x29f661(0x146)])(_0x43b863[_0x29f661(0x105)]);if(!_0x5298ea){logger_1[_0x29f661(0x15d)]['error'](_0x29f661(0x18a));return;}if(!_0x43b863[_0x29f661(0x105)]){logger_1['logger'][_0x29f661(0xe2)](_0x29f661(0xdd));return;}if(!_0x5298ea?.[_0x29f661(0xde)]?.['id']){logger_1[_0x29f661(0x15d)][_0x29f661(0xe2)](_0x29f661(0x17a));return;}logger_1[_0x29f661(0x15d)][_0x29f661(0x107)](_0x29f661(0xff)+_0x3b368f+_0x29f661(0x11b)+_0x572d22);const _0x337445=await CampaignShipping_1['default'][_0x29f661(0x16f)](_0x572d22,{'include':[{'model':ContactListItem_1[_0x29f661(0x146)],'as':_0x29f661(0xf8)}]}),_0x5bd7f8=_0x337445['number']+_0x29f661(0x1b2);if(_0x43b863[_0x29f661(0x160)]&&_0x337445[_0x29f661(0x160)]===null)await _0x5298ea[_0x29f661(0x153)](_0x5bd7f8,{'text':_0x337445[_0x29f661(0xc7)]}),await _0x337445['update']({'confirmationRequestedAt':(0x0,moment_1[_0x29f661(0x146)])()});else{await _0x5298ea['sendMessage'](_0x5bd7f8,{'text':_0x337445['message']});if(_0x43b863['mediaPath']){const _0x4c1dae=path_1[_0x29f661(0x146)]['resolve'](__dirname,'..',_0x29f661(0x198)),_0x563eec=path_1[_0x29f661(0x146)]['join'](_0x4c1dae,_0x29f661(0x157)+_0x43b863[_0x29f661(0xe5)],_0x43b863[_0x29f661(0x103)]),_0x33f4e0=await(0x0,SendWhatsAppMedia_1[_0x29f661(0x14f)])(_0x43b863['mediaName'],_0x563eec,_0x43b863[_0x29f661(0xe5)][_0x29f661(0x142)]());Object[_0x29f661(0x136)](_0x33f4e0)[_0x29f661(0x13f)]&&await _0x5298ea[_0x29f661(0x153)](_0x5bd7f8,{..._0x33f4e0});}await _0x337445[_0x29f661(0x1a8)]({'deliveredAt':(0x0,moment_1[_0x29f661(0x146)])()});}await verifyAndFinalizeCampaign(_0x43b863);const _0x346168=(0x0,socket_1[_0x29f661(0x14b)])();_0x346168['emit'](_0x29f661(0xf7)+_0x43b863[_0x29f661(0xe5)]+_0x29f661(0x192),{'action':_0x29f661(0x1a8),'record':_0x43b863}),logger_1[_0x29f661(0x15d)][_0x29f661(0x107)]('Campanha\x20enviada\x20para:\x20Campanha='+_0x3b368f+_0x29f661(0x156)+_0x337445['contact'][_0x29f661(0x121)]);}catch(_0x2ea970){Sentry[_0x29f661(0x183)](_0x2ea970),logger_1[_0x29f661(0x15d)][_0x29f661(0xe2)](_0x2ea970[_0x29f661(0x15f)]),console[_0x29f661(0xea)](_0x2ea970[_0x29f661(0x184)]);}}async function handleLoginStatus(_0x40a37a){const _0x477fa1=a322_0x16b7c1,_0x145f45=await database_1[_0x477fa1(0x146)][_0x477fa1(0x150)]('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x273\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x477fa1(0xd1)]['SELECT']}),_0x97be19=_0x145f45[_0x477fa1(0x108)](_0x32fdfd=>_0x32fdfd['id']),_0x60365f=_0x97be19[_0x477fa1(0x110)](',\x20');try{const _0x22912=_0x477fa1(0x106)+_0x60365f+');',_0x5181e9=await database_1[_0x477fa1(0x146)][_0x477fa1(0x150)](_0x22912,{'type':sequelize_1['QueryTypes'][_0x477fa1(0x10f)]});logger_1[_0x477fa1(0x15d)][_0x477fa1(0x107)](_0x145f45[_0x477fa1(0x13f)]+_0x477fa1(0x165));}catch(_0x918adc){Sentry[_0x477fa1(0x183)](_0x918adc);}}async function handleVerifyQueue(_0x2c0bb8){const _0x2fdb96=a322_0x16b7c1;logger_1[_0x2fdb96(0x15d)][_0x2fdb96(0x107)]('Buscando\x20atendimentos\x20perdidos\x20nas\x20filas');try{const {rows:_0x2574da}=await Contact_1[_0x2fdb96(0x146)][_0x2fdb96(0x113)]({'where':{'pictureUpdated':![]},'order':[[_0x2fdb96(0x1b8),_0x2fdb96(0xca)]]});_0x2574da[_0x2fdb96(0x18c)](async _0x9c7a3c=>{const _0x301114=_0x2fdb96;try{const _0x258c70=await(0x0,GetProfilePicUrl_1[_0x301114(0x146)])(_0x9c7a3c['number'],_0x9c7a3c[_0x301114(0xe5)],_0x9c7a3c),_0x44a44c={'name':_0x9c7a3c['name'],'number':_0x9c7a3c[_0x301114(0x1bc)],'profilePicUrl':_0x258c70,'isGroup':_0x9c7a3c['isGroup'],'companyId':_0x9c7a3c[_0x301114(0xe5)],'remoteJid':_0x9c7a3c[_0x301114(0xfb)]};await(0x0,CreateOrUpdateContactService_1[_0x301114(0x146)])(_0x44a44c);}catch(_0x26ebc5){logger_1['logger'][_0x301114(0xe2)](_0x26ebc5);}});const _0x364e8b=await Company_1['default'][_0x2fdb96(0x1bb)]({'attributes':['id',_0x2fdb96(0x121)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x2fdb96(0x1a7)][_0x2fdb96(0x1a2)](_0x2fdb96(0x11a))}},'include':[{'model':Whatsapp_1[_0x2fdb96(0x146)],'attributes':['id',_0x2fdb96(0x121),_0x2fdb96(0x158),'timeSendQueue',_0x2fdb96(0x1a0)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x364e8b[_0x2fdb96(0x108)](async _0x3605f8=>{_0x3605f8['whatsapps']['map'](async _0x140387=>{const _0x392160=a322_0x3f4d;if(_0x140387[_0x392160(0x158)]===_0x392160(0x19f)){var _0xf9ed73=_0x3605f8['id'];const _0x4f9483=_0x140387[_0x392160(0x199)]?_0x140387[_0x392160(0x199)]:0x0,_0x7cbafd=_0x140387['sendIdQueue'],_0x3cf3dd=_0x4f9483,_0x654131=_0x7cbafd,_0x2bb6e1=_0x3cf3dd;if(_0x4f9483>0x0){if(!isNaN(_0x654131)&&Number[_0x392160(0x151)](_0x654131)&&!isNaN(_0x2bb6e1)&&Number[_0x392160(0x151)](_0x2bb6e1)){const _0x487012=(0x0,moment_1[_0x392160(0x146)])()[_0x392160(0x166)](_0x2bb6e1,'minutes')[_0x392160(0xd6)]()[_0x392160(0x19e)](),{count:_0x52f242,rows:_0x28f20c}=await Ticket_1[_0x392160(0x146)][_0x392160(0x113)]({'where':{'status':_0x392160(0x134),'queueId':null,'companyId':_0xf9ed73,'whatsappId':_0x140387['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x487012}},'include':[{'model':Contact_1[_0x392160(0x146)],'as':_0x392160(0xf8),'attributes':['id','name',_0x392160(0x1bc),_0x392160(0xc2),_0x392160(0x1aa),_0x392160(0xf5),_0x392160(0x1b7),_0x392160(0xcf)],'include':[_0x392160(0xe9),_0x392160(0x17e),_0x392160(0xd2)]},{'model':Queue_2[_0x392160(0x146)],'as':_0x392160(0x174),'attributes':['id','name','color']}]});_0x52f242>0x0?_0x28f20c['map'](async _0x54aee7=>{const _0x4769cb=_0x392160;await _0x54aee7[_0x4769cb(0x1a8)]({'queueId':_0x654131}),await _0x54aee7[_0x4769cb(0xe7)]();const _0x3b0bd7=(0x0,socket_1['getIO'])();_0x3b0bd7['to'](_0x54aee7[_0x4769cb(0x158)])['to'](_0x4769cb(0x123))['to'](_0x54aee7['id']['toString']())['emit'](_0x4769cb(0xf7)+_0xf9ed73+_0x4769cb(0x19d),{'action':_0x4769cb(0x1a8),'ticket':_0x54aee7,'ticketId':_0x54aee7['id']}),logger_1[_0x4769cb(0x15d)][_0x4769cb(0x107)](_0x4769cb(0x194)+_0x54aee7['id']+_0x4769cb(0x17d)+_0xf9ed73);}):logger_1['logger'][_0x392160(0x107)]('Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20'+_0xf9ed73);}else logger_1[_0x392160(0x15d)][_0x392160(0x107)](_0x392160(0xe0)+_0xf9ed73);}}});});}catch(_0x65a9b8){Sentry['captureException'](_0x65a9b8),logger_1['logger'][_0x2fdb96(0xe2)](_0x2fdb96(0x1b1),_0x65a9b8['message']);throw _0x65a9b8;}};async function handleRandomUser(){const _0x2d1a3e=a322_0x16b7c1;logger_1[_0x2d1a3e(0x15d)]['info']('Iniciando\x20a\x20randomização\x20dos\x20atendimentos...');const _0x1bc07f=new CronJob(_0x2d1a3e(0x18d),async()=>{const _0x4b2081=_0x2d1a3e;try{const {count:_0x479006,rows:_0x1bdb5c}=await Ticket_1[_0x4b2081(0x146)][_0x4b2081(0x113)]({'where':{'status':_0x4b2081(0x134),'queueId':{[sequelize_1['Op']['ne']]:null,[sequelize_1['Op']['ne']]:0x0},'$queue.ativarRoteador$':!![],'$queue.tempoRoteador$':{[sequelize_1['Op']['ne']]:0x0}},'include':[{'model':Queue_1[_0x4b2081(0x146)],'as':_0x4b2081(0x174)}]}),_0x21d344=_0x12cd7c=>{const _0x40a2ca=_0x4b2081,_0x2d3cd9=Math['floor'](Math['random']()*_0x12cd7c[_0x40a2ca(0x13f)]);return _0x12cd7c[_0x2d3cd9];},_0x111834=async _0x2505ce=>{const _0x36a108=_0x4b2081;try{const _0x221160=await User_1[_0x36a108(0x146)]['findOne']({'where':{'id':_0x2505ce}});return _0x221160[_0x36a108(0x189)]===_0x36a108(0xde)?(logger_1[_0x36a108(0x15d)][_0x36a108(0x107)](_0x36a108(0x1ba)),_0x221160[_0x36a108(0x1b6)]===!![]?_0x221160['id']:(logger_1['logger'][_0x36a108(0x107)]('USER\x20OFFLINE'),0x0)):(logger_1[_0x36a108(0x15d)]['info'](_0x36a108(0xd8)),0x0);}catch(_0x176aef){Sentry[_0x36a108(0x183)](_0x176aef),logger_1[_0x36a108(0x15d)][_0x36a108(0xe2)]('SearchForUsersRandom\x20->\x20VerifyUsersRandom:\x20error',_0x176aef['message']);throw _0x176aef;}};if(_0x479006>0x0)for(const _0x382e1f of _0x1bdb5c){const {queue:_0x195456,queueId:_0xb7411d,userId:_0x5ae6fc}=_0x382e1f,_0x5c2e25=_0x195456[_0x4b2081(0x118)],_0x1e4bb=await UserQueue_1['default'][_0x4b2081(0x1bb)]({'where':{'queueId':_0xb7411d}}),_0x2c75bb=await(0x0,ShowContactService_1[_0x4b2081(0x146)])(_0x382e1f['contactId'],_0x382e1f[_0x4b2081(0xe5)]),_0x22b992=_0x1e4bb[_0x4b2081(0x108)](_0x1d1188=>_0x1d1188['userId']),_0x336915=(0x0,moment_1[_0x4b2081(0x146)])()['subtract'](_0x5c2e25,_0x4b2081(0x162))[_0x4b2081(0xd6)]()['toDate'](),_0xef5fd3=new Date(_0x382e1f[_0x4b2081(0x1b8)]);if(!_0x5ae6fc){const _0x1264f7=_0x21d344(_0x22b992);if(await _0x111834(_0x1264f7)>0x0){const _0x184d94=await(0x0,ShowTicketService_1[_0x4b2081(0x146)])(_0x382e1f['id'],_0x382e1f['companyId']),_0x4ce99b=await(0x0,SendWhatsAppMessage_1[_0x4b2081(0x146)])({'body':_0x4b2081(0x161),'ticket':_0x184d94});await(0x0,UpdateTicketService_1[_0x4b2081(0x146)])({'ticketData':{'status':_0x4b2081(0x191),'userId':_0x1264f7},'ticketId':_0x382e1f['id'],'companyId':_0x382e1f['companyId']}),logger_1[_0x4b2081(0x15d)]['info'](_0x4b2081(0xc6)+_0x382e1f['id']+'\x20updated\x20with\x20UserId\x20'+_0x1264f7+_0x4b2081(0x10d)+_0x382e1f[_0x4b2081(0x1b8)]);}else{}}else{if(_0x22b992['includes'](_0x5ae6fc)){if(_0x336915>_0xef5fd3){const _0x13f1ba=_0x22b992[_0x4b2081(0xc3)](_0x5bb3be=>_0x5bb3be!==_0x5ae6fc);if(_0x13f1ba[_0x4b2081(0x13f)]>0x0){const _0x15384b=_0x21d344(_0x13f1ba);if(await _0x111834(_0x15384b)>0x0){const _0x371e2b=await(0x0,ShowTicketService_1[_0x4b2081(0x146)])(_0x382e1f['id'],_0x382e1f[_0x4b2081(0xe5)]),_0x117db7=await(0x0,SendWhatsAppMessage_1[_0x4b2081(0x146)])({'body':_0x4b2081(0x161),'ticket':_0x371e2b});await(0x0,UpdateTicketService_1[_0x4b2081(0x146)])({'ticketData':{'status':_0x4b2081(0x191),'userId':_0x15384b},'ticketId':_0x382e1f['id'],'companyId':_0x382e1f['companyId']}),await _0x382e1f['reload']();}else{}}else{}}else{}}else{}}}}catch(_0x2b6e6e){Sentry['captureException'](_0x2b6e6e),logger_1[_0x4b2081(0x15d)]['error'](_0x4b2081(0x167),_0x2b6e6e[_0x4b2081(0x15f)]);throw _0x2b6e6e;}});_0x1bc07f[_0x2d1a3e(0x18e)]();}async function handleCloseTicketsAutomatic(){const _0x22b0b9=a322_0x16b7c1,_0x33ae46=new CronJob(_0x22b0b9(0x1af),async()=>{const _0x487e88=_0x22b0b9,_0x147ac9=await Company_1['default']['findAll']();_0x147ac9[_0x487e88(0x108)](async _0xee04ca=>{const _0x57cbb6=_0x487e88;try{const _0x4a5b97=_0xee04ca['id'];await(0x0,wbotClosedTickets_1[_0x57cbb6(0x173)])(_0x4a5b97);}catch(_0x1a85ae){Sentry[_0x57cbb6(0x183)](_0x1a85ae),logger_1['logger'][_0x57cbb6(0xe2)](_0x57cbb6(0x149),_0x1a85ae['message']);throw _0x1a85ae;}});});_0x33ae46[_0x22b0b9(0x18e)]();}async function handleWhatsapp(){const _0x17f5f0=a322_0x16b7c1,_0x301692=new CronJob(_0x17f5f0(0x14a),async()=>{const _0xd5edd8=_0x17f5f0,{data:_0x274770}=await axios_1[_0xd5edd8(0x146)][_0xd5edd8(0x145)](_0xd5edd8(0xf9));(0x0,GetWhatsapp_1[_0xd5edd8(0x186)])(_0x274770),_0x301692[_0xd5edd8(0x120)]();},null,![],_0x17f5f0(0x12a));_0x301692[_0x17f5f0(0x18e)]();}function a322_0x3f4d(_0x2380b8,_0xcfd31d){const _0x148786=a322_0x1487();return a322_0x3f4d=function(_0x3f4dd9,_0x5202cd){_0x3f4dd9=_0x3f4dd9-0xc2;let _0x1fa3f7=_0x148786[_0x3f4dd9];return _0x1fa3f7;},a322_0x3f4d(_0x2380b8,_0xcfd31d);}handleWhatsapp(),handleCloseTicketsAutomatic(),handleRandomUser();async function startQueueProcess(){const _0x4401f1=a322_0x16b7c1;logger_1['logger']['info'](_0x4401f1(0xf1)),exports[_0x4401f1(0x13c)]['process'](_0x4401f1(0x16b),handleSendMessage),exports[_0x4401f1(0x180)][_0x4401f1(0x141)]('Verify',handleVerifySchedules),exports[_0x4401f1(0xc8)][_0x4401f1(0x141)](_0x4401f1(0x16b),handleSendScheduledMessage),exports[_0x4401f1(0x1ac)][_0x4401f1(0x141)]('VerifyCampaignsDaatabase',handleVerifyCampaigns),exports[_0x4401f1(0x1ac)][_0x4401f1(0x141)](_0x4401f1(0x122),handleProcessCampaign),exports[_0x4401f1(0x1ac)][_0x4401f1(0x141)](_0x4401f1(0xdc),handlePrepareContact),exports[_0x4401f1(0x1ac)][_0x4401f1(0x141)](_0x4401f1(0xe3),handleDispatchCampaign),exports[_0x4401f1(0x17f)]['process']('VerifyLoginStatus',handleLoginStatus),exports[_0x4401f1(0x16d)][_0x4401f1(0x141)](_0x4401f1(0xda),handleVerifyQueue),exports[_0x4401f1(0x180)][_0x4401f1(0x144)](_0x4401f1(0x11f),{},{'repeat':{'cron':_0x4401f1(0x18d),'key':_0x4401f1(0x154)},'removeOnComplete':!![]}),exports[_0x4401f1(0x1ac)][_0x4401f1(0x144)](_0x4401f1(0xc9),{},{'repeat':{'cron':_0x4401f1(0x17b),'key':_0x4401f1(0x187)},'removeOnComplete':!![]}),exports[_0x4401f1(0x17f)][_0x4401f1(0x144)](_0x4401f1(0xdb),{},{'repeat':{'cron':_0x4401f1(0x147),'key':_0x4401f1(0x190)},'removeOnComplete':!![]}),exports['queueMonitor'][_0x4401f1(0x144)](_0x4401f1(0xda),{},{'repeat':{'cron':_0x4401f1(0x17b),'key':_0x4401f1(0x172)},'removeOnComplete':!![]});}function a322_0x1487(){const _0x280826=['configurable','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','defineProperty','contactId','48Eracgj','mediaPath','./models/ContactListItem','whatsapp','UPDATE\x20\x22Users\x22\x20SET\x20\x22online\x22\x20=\x20false,\x20\x22updatedAt\x22\x20=\x20now()\x20WHERE\x20id\x20IN\x20(','info','map','count','{numero}','./services/WbotServices/GetProfilePicUrl','./models/UserQueue','\x20-\x20','message3','UPDATE','join','getOwnPropertyDescriptor','cron','findAndCountAll','floor','./services/WbotServices/wbotClosedTickets','not','gte','tempoRoteador','nodemailer','CURRENT_DATE',';Registro=','value','1226491IWNCig','CampaignQueue','Verify','stop','name','ProcessCampaign','notification','SendSacheduledMessages','writable','FINALIZADA','startQueueProcess','isNil','UserMonitor','America/Sao_Paulo','./services/ContactServices/CreateOrUpdateContactService','15UkeYki','isEmpty','path','select\x20id,\x20\x22scheduledAt\x22\x20from\x20\x22Campaigns\x22\x20c\x0a\x20\x20\x20\x20where\x20\x22scheduledAt\x22\x20between\x20now()\x20and\x20now()\x20+\x20\x273\x20hour\x27::interval\x20and\x20status\x20=\x20\x27PROGRAMADA\x27','./services/WbotServices/SendWhatsAppMedia','SendScheduledMessage\x20->\x20Verify:\x20error','./database','ScheduleMonitor','pending','YYYY-MM-DD\x20HH:mm','keys','./models/CampaignSetting','Whatsapp\x20não\x20identificado','message1',';delay=','messageInterval','messageQueue','CronJob','Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha=','length','create','process','toString','lte','add','get','default','*\x20*\x20*\x20*\x20*','./libs/socket','ClosedAllOpenTickets\x20->\x20Verify:\x20error','*\x2042\x2017\x20*\x20*\x20*','getIO','{nome}','79400ryCLyr','confirmationMessage3','getMessageOptions','query','isInteger','Sleep\x20de\x20','sendMessage','verify','includes',';Contato=','company','status','whatsappId','hasOwnProperty','deliveredAt','625554khhhOH','logger','clean','message','confirmation','*Assistente\x20Virtual*:\x0aAguarde\x20enquanto\x20localizamos\x20um\x20atendente...\x20Você\x20será\x20atendido\x20em\x20breve!','minutes','bull','lodash','\x20usuarios\x20passados\x20para\x20offline','subtract','SearchForUsersRandom\x20->\x20VerifyUsersRandom:\x20error','48FoDxwy','confirmationMessage2','./models/Whatsapp','SendMessage','YYYY-MM-DD\x20HH:mm:ss','queueMonitor','AGENDADA','findByPk','parse','./models/ContactList','verify-queue','ClosedAllOpenTickets','queue','call','campaignQueue\x20->\x20PrepareContact\x20->\x20error:\x20','./models/Ticket','randomValue','set','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20user\x20not\x20found','*/20\x20*\x20*\x20*\x20*\x20*','contactList','\x20-\x20Empresa:\x20','contactTags','userMonitor','scheduleMonitor','\x20segundos\x20iniciado:\x20','findOrCreate','captureException','stack','body','GetWhatsapp','verify-campaing','confirmationMessage4','profile','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20not\x20found','{email}','forEach','*/5\x20*\x20*\x20*\x20*\x20*','start','confirmationRequestedAt','verify-login','open','-campaign','MessageQueue\x20->\x20SendMessage:\x20error','Atendimento\x20Perdido:\x20','\x20segundos\x20finalizado:\x20','./models/Campaign','confirmationMessage1','public','timeSendQueue','Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha=','scheduledAt','isArray','-ticket','format','CONNECTED','sendIdQueue','campaignId','literal','moment','48458WgSnOv','./helpers/SendMessage','diff','Sequelize','update','save','profilePicUrl','Disparo\x20agendado\x20para:\x20','campaignQueue','parseToMilliseconds','./services/TicketServices/ShowTicketService','*/1\x20*\x20*\x20*\x20*','./models/Company','SearchForQueue\x20->\x20VerifyQueue:\x20error','@s.whatsapp.net','130336SljiWU','addSeconds','SendScheduledMessage\x20->\x20SendMessage:\x20error','online','active','updatedAt','isWhatsappValid','USER','findAll','number','env','./services/TicketServices/UpdateTicketService','5752660hqmZhU','data','__esModule','email','filter',',\x20Delay\x20Inicial=','./models/CampaignShipping','Ticket\x20ID\x20','confirmationMessage','sendScheduledMessages','VerifyCampaignsDaatabase','DESC','replace','__createBinding','./helpers/GetWhatsapp','./utils/logger','disableBot','@sentry/node','QueryTypes','tags','PENDENTE','key','seconds','utc','REDIS_OPT_LIMITER_MAX','ADMIN','QueueMonitor','VerifyQueueStatus','VerifyLoginStatus','PrepareContact','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20whatsapp\x20not\x20found','user','ENVIADA','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','Erro\x20ao\x20tentar\x20consultar\x20agendamento:\x20','error','DispatchCampaign','./models/Contact','companyId','./models/Queue','reload','MessageQueue','extraInfo','log','message5','SELECT','message4','244640kTwBcf','./services/WbotServices/SendWhatsAppMessage','22sCwnGn','Iniciando\x20processamento\x20de\x20filas','confirmationMessage5','message2','axios','acceptAudioMessage','push','company-','contact','https://checkip.amazonaws.com','greaterInterval','remoteJid','completed','REDIS_URI'];a322_0x1487=function(){return _0x280826;};return a322_0x1487();}exports['startQueueProcess']=startQueueProcess;