'use strict';const a305_0x5a83a3=a305_0x26dd;(function(_0x3cb983,_0x14a73a){const _0x4b4a40=a305_0x26dd,_0x333ae3=_0x3cb983();while(!![]){try{const _0x3758c1=parseInt(_0x4b4a40(0x206))/0x1*(-parseInt(_0x4b4a40(0x20a))/0x2)+parseInt(_0x4b4a40(0x12a))/0x3+-parseInt(_0x4b4a40(0x17e))/0x4*(parseInt(_0x4b4a40(0x20c))/0x5)+parseInt(_0x4b4a40(0x133))/0x6+-parseInt(_0x4b4a40(0x139))/0x7*(parseInt(_0x4b4a40(0x145))/0x8)+parseInt(_0x4b4a40(0x119))/0x9+-parseInt(_0x4b4a40(0x16c))/0xa;if(_0x3758c1===_0x14a73a)break;else _0x333ae3['push'](_0x333ae3['shift']());}catch(_0x1405d0){_0x333ae3['push'](_0x333ae3['shift']());}}}(a305_0x25ea,0x53e79));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0xd96453,_0x1261d2,_0x2ab299,_0x5f34fa){const _0x41d692=a305_0x26dd;if(_0x5f34fa===undefined)_0x5f34fa=_0x2ab299;var _0x264758=Object['getOwnPropertyDescriptor'](_0x1261d2,_0x2ab299);(!_0x264758||(_0x41d692(0x1b8)in _0x264758?!_0x1261d2['__esModule']:_0x264758[_0x41d692(0x177)]||_0x264758[_0x41d692(0x1bd)]))&&(_0x264758={'enumerable':!![],'get':function(){return _0x1261d2[_0x2ab299];}}),Object[_0x41d692(0x127)](_0xd96453,_0x5f34fa,_0x264758);}:function(_0x3cbc9a,_0x8d9450,_0x7232e,_0x4713ea){if(_0x4713ea===undefined)_0x4713ea=_0x7232e;_0x3cbc9a[_0x4713ea]=_0x8d9450[_0x7232e];}),__setModuleDefault=this&&this[a305_0x5a83a3(0x1e0)]||(Object[a305_0x5a83a3(0x118)]?function(_0x410078,_0x1be8ab){const _0x2dde9b=a305_0x5a83a3;Object['defineProperty'](_0x410078,_0x2dde9b(0x1af),{'enumerable':!![],'value':_0x1be8ab});}:function(_0x26d632,_0x3883d4){_0x26d632['default']=_0x3883d4;}),__importStar=this&&this['__importStar']||function(_0x5888bc){const _0x47fd3c=a305_0x5a83a3;if(_0x5888bc&&_0x5888bc[_0x47fd3c(0x1e4)])return _0x5888bc;var _0x3a18c4={};if(_0x5888bc!=null){for(var _0x4f9b88 in _0x5888bc)if(_0x4f9b88!=='default'&&Object['prototype'][_0x47fd3c(0x11e)]['call'](_0x5888bc,_0x4f9b88))__createBinding(_0x3a18c4,_0x5888bc,_0x4f9b88);}return __setModuleDefault(_0x3a18c4,_0x5888bc),_0x3a18c4;},__importDefault=this&&this[a305_0x5a83a3(0x208)]||function(_0x1812e1){const _0x4e365a=a305_0x5a83a3;return _0x1812e1&&_0x1812e1[_0x4e365a(0x1e4)]?_0x1812e1:{'default':_0x1812e1};};Object['defineProperty'](exports,a305_0x5a83a3(0x1e4),{'value':!![]}),exports['startQueueProcess']=exports[a305_0x5a83a3(0x20d)]=exports[a305_0x5a83a3(0x19f)]=exports[a305_0x5a83a3(0x1f9)]=exports[a305_0x5a83a3(0x16f)]=exports['campaignQueue']=exports[a305_0x5a83a3(0x1f4)]=exports['scheduleMonitor']=exports[a305_0x5a83a3(0x1ac)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),bull_1=__importDefault(require(a305_0x5a83a3(0x121))),SendMessage_1=require(a305_0x5a83a3(0x14f)),Whatsapp_1=__importDefault(require(a305_0x5a83a3(0x157))),logger_1=require(a305_0x5a83a3(0x187)),moment_1=__importDefault(require(a305_0x5a83a3(0x15e))),Schedule_1=__importDefault(require(a305_0x5a83a3(0x15d))),sequelize_1=require(a305_0x5a83a3(0x1d1)),GetDefaultWhatsApp_1=__importDefault(require(a305_0x5a83a3(0x1e2))),Campaign_1=__importDefault(require(a305_0x5a83a3(0x163))),Queue_1=__importDefault(require(a305_0x5a83a3(0x178))),ContactList_1=__importDefault(require('./models/ContactList')),ContactListItem_1=__importDefault(require(a305_0x5a83a3(0x1ef))),lodash_1=require(a305_0x5a83a3(0x1d2)),CampaignSetting_1=__importDefault(require(a305_0x5a83a3(0x1ce))),CampaignShipping_1=__importDefault(require(a305_0x5a83a3(0x1d8))),GetWhatsappWbot_1=__importDefault(require(a305_0x5a83a3(0x1ca))),database_1=__importDefault(require(a305_0x5a83a3(0x1dd))),SendWhatsAppMedia_1=require(a305_0x5a83a3(0x11b)),socket_1=require(a305_0x5a83a3(0x1d9)),path_1=__importDefault(require(a305_0x5a83a3(0x1b9))),User_1=__importDefault(require(a305_0x5a83a3(0x166))),Company_1=__importDefault(require(a305_0x5a83a3(0x19c))),Contact_1=__importDefault(require(a305_0x5a83a3(0x1d0))),Queue_2=__importDefault(require('./models/Queue')),wbotClosedTickets_1=require(a305_0x5a83a3(0x15b)),Ticket_1=__importDefault(require(a305_0x5a83a3(0x14e))),ShowContactService_1=__importDefault(require(a305_0x5a83a3(0x132))),UserQueue_1=__importDefault(require(a305_0x5a83a3(0x13a))),ShowTicketService_1=__importDefault(require(a305_0x5a83a3(0x1ab))),SendWhatsAppMessage_1=__importDefault(require('./services/WbotServices/SendWhatsAppMessage')),UpdateTicketService_1=__importDefault(require(a305_0x5a83a3(0x1cb))),date_fns_1=require(a305_0x5a83a3(0x17c)),nodemailer=require(a305_0x5a83a3(0x1cf)),CronJob=require(a305_0x5a83a3(0x1a9))[a305_0x5a83a3(0x183)],connection=process['env'][a305_0x5a83a3(0x18a)]||'',limiterMax=process[a305_0x5a83a3(0x120)][a305_0x5a83a3(0x13c)]||0x1,limiterDuration=process[a305_0x5a83a3(0x120)][a305_0x5a83a3(0x1a0)]||0xbb8;exports[a305_0x5a83a3(0x1ac)]=new bull_1[(a305_0x5a83a3(0x1af))](a305_0x5a83a3(0x1ed),connection),exports['scheduleMonitor']=new bull_1[(a305_0x5a83a3(0x1af))](a305_0x5a83a3(0x123),connection),exports['sendScheduledMessages']=new bull_1['default']('SendSacheduledMessages',connection),exports['campaignQueue']=new bull_1[(a305_0x5a83a3(0x1af))](a305_0x5a83a3(0x17f),connection),exports['queueMonitor']=new bull_1[(a305_0x5a83a3(0x1af))](a305_0x5a83a3(0x1a6),connection),exports['messageQueue']=new bull_1[(a305_0x5a83a3(0x1af))]('MessageQueue',connection,{'limiter':{'max':limiterMax,'duration':limiterDuration}});async function handleSendMessage(_0x7bafd6){const _0x265d94=a305_0x5a83a3;try{const {data:_0x1dff9a}=_0x7bafd6,_0x254677=await Whatsapp_1['default'][_0x265d94(0x15f)](_0x1dff9a['whatsappId']);if(_0x254677===null)throw Error(_0x265d94(0x1dc));const _0x1f49ac=_0x1dff9a[_0x265d94(0x1ad)];await(0x0,SendMessage_1[_0x265d94(0x14a)])(_0x254677,_0x1f49ac);}catch(_0x1d9325){Sentry[_0x265d94(0x1b4)](_0x1d9325),logger_1[_0x265d94(0x16b)][_0x265d94(0x20b)](_0x265d94(0x1ae),_0x1d9325[_0x265d94(0x14d)]);throw _0x1d9325;}}async function handleVerifySchedules(_0x377438){const _0x1490d6=a305_0x5a83a3;try{const {count:_0x29e6f2,rows:_0xf1f220}=await Schedule_1['default']['findAndCountAll']({'where':{'status':'PENDENTE','sentAt':null,'sendAt':{[sequelize_1['Op'][_0x1490d6(0x1df)]]:(0x0,moment_1[_0x1490d6(0x1af)])()[_0x1490d6(0x11d)]('YYYY-MM-DD\x20HH:mm:ss'),[sequelize_1['Op']['lte']]:(0x0,moment_1[_0x1490d6(0x1af)])()[_0x1490d6(0x1d7)]('30',_0x1490d6(0x196))[_0x1490d6(0x11d)](_0x1490d6(0x13d))}},'include':[{'model':Contact_1[_0x1490d6(0x1af)],'as':_0x1490d6(0x202)}]});_0x29e6f2>0x0&&_0xf1f220[_0x1490d6(0x1c9)](async _0x566320=>{const _0x4c373f=_0x1490d6;await _0x566320[_0x4c373f(0x1a2)]({'status':_0x4c373f(0x1c6)}),exports[_0x4c373f(0x1f4)][_0x4c373f(0x1d7)](_0x4c373f(0x14a),{'schedule':_0x566320},{'delay':0x9c40}),logger_1[_0x4c373f(0x16b)][_0x4c373f(0x13b)](_0x4c373f(0x1c7)+_0x566320[_0x4c373f(0x202)][_0x4c373f(0x18c)]);});}catch(_0x1521ef){Sentry['captureException'](_0x1521ef),logger_1['logger'][_0x1490d6(0x20b)]('SendScheduledMessage\x20->\x20Verify:\x20error',_0x1521ef['message']);throw _0x1521ef;}}async function handleSendScheduledMessage(_0x20f889){const _0x3a18d8=a305_0x5a83a3,{data:{schedule:_0x40f047}}=_0x20f889;let _0x37de53=null;try{_0x37de53=await Schedule_1[_0x3a18d8(0x1af)][_0x3a18d8(0x15f)](_0x40f047['id']);}catch(_0x31ba7e){Sentry['captureException'](_0x31ba7e),logger_1[_0x3a18d8(0x16b)][_0x3a18d8(0x13b)](_0x3a18d8(0x201)+_0x40f047['id']);}try{const _0x3bc1ef=await(0x0,GetDefaultWhatsApp_1[_0x3a18d8(0x1af)])(_0x40f047[_0x3a18d8(0x1d4)]);await(0x0,SendMessage_1[_0x3a18d8(0x14a)])(_0x3bc1ef,{'number':_0x40f047[_0x3a18d8(0x202)][_0x3a18d8(0x162)],'body':_0x40f047[_0x3a18d8(0x1c0)]}),await _0x37de53?.[_0x3a18d8(0x1a2)]({'sentAt':(0x0,moment_1[_0x3a18d8(0x1af)])()[_0x3a18d8(0x11d)](_0x3a18d8(0x184)),'status':'ENVIADA'}),logger_1[_0x3a18d8(0x16b)][_0x3a18d8(0x13b)](_0x3a18d8(0x207)+_0x40f047[_0x3a18d8(0x202)][_0x3a18d8(0x18c)]),exports[_0x3a18d8(0x1f4)][_0x3a18d8(0x12c)](0x3a98,_0x3a18d8(0x15a));}catch(_0x204b78){Sentry[_0x3a18d8(0x1b4)](_0x204b78),await _0x37de53?.[_0x3a18d8(0x1a2)]({'status':_0x3a18d8(0x192)}),logger_1['logger'][_0x3a18d8(0x20b)](_0x3a18d8(0x1d6),_0x204b78['message']);throw _0x204b78;}}async function handleVerifyCampaigns(_0x569652){const _0x530077=a305_0x5a83a3,_0xa5a010=await database_1[_0x530077(0x1af)]['query'](_0x530077(0x17d),{'type':sequelize_1['QueryTypes'][_0x530077(0x154)]});logger_1[_0x530077(0x16b)][_0x530077(0x13b)](_0x530077(0x1d5)+_0xa5a010[_0x530077(0x176)]);for(let _0x1efff2 of _0xa5a010){try{const _0x5a679d=(0x0,moment_1[_0x530077(0x1af)])(),_0x58065f=(0x0,moment_1[_0x530077(0x1af)])(_0x1efff2[_0x530077(0x136)]),_0x1ebdc5=_0x58065f[_0x530077(0x1da)](_0x5a679d,_0x530077(0x13f));logger_1['logger']['info'](_0x530077(0x194)+_0x1efff2['id']+',\x20Delay\x20Inicial='+_0x1ebdc5),exports['campaignQueue']['add']('ProcessCampaign',{'id':_0x1efff2['id'],'delay':_0x1ebdc5},{'priority':0x3,'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}});}catch(_0x5af52a){Sentry[_0x530077(0x1b4)](_0x5af52a);}}}async function getCampaign(_0x4c654c){const _0x23434c=a305_0x5a83a3;return await Campaign_1[_0x23434c(0x1af)][_0x23434c(0x200)]({'where':{'id':_0x4c654c},'include':[{'model':ContactList_1[_0x23434c(0x1af)],'as':_0x23434c(0x134),'attributes':['id',_0x23434c(0x18c)],'include':[{'model':ContactListItem_1['default'],'as':'contacts','attributes':['id',_0x23434c(0x18c),'number',_0x23434c(0x173),_0x23434c(0x12e)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1[_0x23434c(0x1af)],'as':_0x23434c(0x165),'attributes':['id',_0x23434c(0x18c)]}]});}async function getContact(_0x306d57){const _0x5bad4a=a305_0x5a83a3;return await ContactListItem_1[_0x5bad4a(0x1af)][_0x5bad4a(0x15f)](_0x306d57,{'attributes':['id',_0x5bad4a(0x18c),_0x5bad4a(0x162),_0x5bad4a(0x173)]});}async function getSettings(_0x3f5cd7){const _0x16531b=a305_0x5a83a3;try{const _0x1e22d3=await CampaignSetting_1[_0x16531b(0x1af)][_0x16531b(0x153)]({'where':{'companyId':_0x3f5cd7[_0x16531b(0x1d4)]},'attributes':[_0x16531b(0x170),_0x16531b(0x13e)]}),_0x140c7f=_0x1e22d3['reduce']((_0x37fe92,_0x3ccaa5)=>{const _0x44434f=_0x16531b;return _0x37fe92[_0x3ccaa5['key']]=JSON[_0x44434f(0x1c8)](_0x3ccaa5[_0x44434f(0x13e)]),_0x37fe92;},{}),{messageInterval:messageInterval=0x14,longerIntervalAfter:longerIntervalAfter=0x14,greaterInterval:greaterInterval=0x3c,variables:variables=[]}=_0x140c7f;return{'messageInterval':messageInterval,'longerIntervalAfter':longerIntervalAfter,'greaterInterval':greaterInterval,'variables':variables};}catch(_0x4ed5cc){console[_0x16531b(0x1eb)](_0x4ed5cc);throw _0x4ed5cc;}}function parseToMilliseconds(_0x211c7d){return _0x211c7d*0x3e8;}exports['parseToMilliseconds']=parseToMilliseconds;async function sleep(_0x1e2d2a){const _0x53ffac=a305_0x5a83a3;return logger_1['logger']['info'](_0x53ffac(0x156)+_0x1e2d2a+_0x53ffac(0x18b)+(0x0,moment_1[_0x53ffac(0x1af)])()[_0x53ffac(0x11d)](_0x53ffac(0x169))),new Promise(_0x5586a6=>{setTimeout(()=>{const _0x41d253=a305_0x26dd;logger_1[_0x41d253(0x16b)][_0x41d253(0x13b)]('Sleep\x20de\x20'+_0x1e2d2a+_0x41d253(0x1f3)+(0x0,moment_1[_0x41d253(0x1af)])()['format'](_0x41d253(0x169))),_0x5586a6(!![]);},parseToMilliseconds(_0x1e2d2a));});}function getCampaignValidMessages(_0xe5a4e){const _0x3c9a84=a305_0x5a83a3,_0x3c0311=[];return!(0x0,lodash_1['isEmpty'])(_0xe5a4e[_0x3c9a84(0x152)])&&!(0x0,lodash_1['isNil'])(_0xe5a4e[_0x3c9a84(0x152)])&&_0x3c0311[_0x3c9a84(0x197)](_0xe5a4e[_0x3c9a84(0x152)]),!(0x0,lodash_1[_0x3c9a84(0x1bf)])(_0xe5a4e[_0x3c9a84(0x126)])&&!(0x0,lodash_1['isNil'])(_0xe5a4e['message2'])&&_0x3c0311[_0x3c9a84(0x197)](_0xe5a4e[_0x3c9a84(0x126)]),!(0x0,lodash_1[_0x3c9a84(0x1bf)])(_0xe5a4e['message3'])&&!(0x0,lodash_1[_0x3c9a84(0x1b7)])(_0xe5a4e[_0x3c9a84(0x1ea)])&&_0x3c0311[_0x3c9a84(0x197)](_0xe5a4e['message3']),!(0x0,lodash_1['isEmpty'])(_0xe5a4e[_0x3c9a84(0x18f)])&&!(0x0,lodash_1[_0x3c9a84(0x1b7)])(_0xe5a4e[_0x3c9a84(0x18f)])&&_0x3c0311['push'](_0xe5a4e[_0x3c9a84(0x18f)]),!(0x0,lodash_1[_0x3c9a84(0x1bf)])(_0xe5a4e[_0x3c9a84(0x160)])&&!(0x0,lodash_1[_0x3c9a84(0x1b7)])(_0xe5a4e[_0x3c9a84(0x160)])&&_0x3c0311['push'](_0xe5a4e[_0x3c9a84(0x160)]),_0x3c0311;}function getCampaignValidConfirmationMessages(_0x2a39ff){const _0x1486ce=a305_0x5a83a3,_0x5cbda9=[];return!(0x0,lodash_1[_0x1486ce(0x1bf)])(_0x2a39ff[_0x1486ce(0x16e)])&&!(0x0,lodash_1['isNil'])(_0x2a39ff[_0x1486ce(0x16e)])&&_0x5cbda9[_0x1486ce(0x197)](_0x2a39ff['confirmationMessage1']),!(0x0,lodash_1[_0x1486ce(0x1bf)])(_0x2a39ff[_0x1486ce(0x128)])&&!(0x0,lodash_1[_0x1486ce(0x1b7)])(_0x2a39ff['confirmationMessage2'])&&_0x5cbda9['push'](_0x2a39ff[_0x1486ce(0x128)]),!(0x0,lodash_1[_0x1486ce(0x1bf)])(_0x2a39ff[_0x1486ce(0x1db)])&&!(0x0,lodash_1[_0x1486ce(0x1b7)])(_0x2a39ff['confirmationMessage3'])&&_0x5cbda9[_0x1486ce(0x197)](_0x2a39ff[_0x1486ce(0x1db)]),!(0x0,lodash_1[_0x1486ce(0x1bf)])(_0x2a39ff[_0x1486ce(0x1e7)])&&!(0x0,lodash_1[_0x1486ce(0x1b7)])(_0x2a39ff[_0x1486ce(0x1e7)])&&_0x5cbda9[_0x1486ce(0x197)](_0x2a39ff[_0x1486ce(0x1e7)]),!(0x0,lodash_1[_0x1486ce(0x1bf)])(_0x2a39ff[_0x1486ce(0x17a)])&&!(0x0,lodash_1[_0x1486ce(0x1b7)])(_0x2a39ff[_0x1486ce(0x17a)])&&_0x5cbda9[_0x1486ce(0x197)](_0x2a39ff['confirmationMessage5']),_0x5cbda9;}function getProcessedMessage(_0x2a93bf,_0x3056ff,_0x30c6f0){const _0x50a432=a305_0x5a83a3;let _0x219746=_0x2a93bf;return _0x219746['includes'](_0x50a432(0x203))&&(_0x219746=_0x219746['replace'](/{nome}/g,_0x30c6f0['name'])),_0x219746[_0x50a432(0x161)](_0x50a432(0x14b))&&(_0x219746=_0x219746['replace'](/{email}/g,_0x30c6f0[_0x50a432(0x173)])),_0x219746[_0x50a432(0x161)](_0x50a432(0x20f))&&(_0x219746=_0x219746[_0x50a432(0x20e)](/{numero}/g,_0x30c6f0[_0x50a432(0x162)])),_0x3056ff[_0x50a432(0x144)](_0x406f77=>{const _0x7f4995=_0x50a432;if(_0x219746[_0x7f4995(0x161)]('{'+_0x406f77[_0x7f4995(0x170)]+'}')){const _0x5cfcbd=new RegExp('{'+_0x406f77[_0x7f4995(0x170)]+'}','g');_0x219746=_0x219746[_0x7f4995(0x20e)](_0x5cfcbd,_0x406f77[_0x7f4995(0x13e)]);}}),_0x219746;}function randomValue(_0x436d71,_0x995c13){const _0x269cdc=a305_0x5a83a3;return Math[_0x269cdc(0x1a4)](Math['random']()*_0x995c13)+_0x436d71;}exports['randomValue']=randomValue;async function verifyAndFinalizeCampaign(_0x27d538){const _0x430d55=a305_0x5a83a3,{contacts:_0x39d6eb}=_0x27d538['contactList'],_0x38238f=_0x39d6eb[_0x430d55(0x176)],_0x2064ae=await CampaignShipping_1[_0x430d55(0x1af)][_0x430d55(0x1c3)]({'where':{'campaignId':_0x27d538['id'],'deliveredAt':{[sequelize_1['Op']['not']]:null}}});_0x38238f===_0x2064ae&&await _0x27d538[_0x430d55(0x1a2)]({'status':_0x430d55(0x11a),'completedAt':(0x0,moment_1['default'])()});const _0x38cbc5=(0x0,socket_1['getIO'])();_0x38cbc5['emit'](_0x430d55(0x168)+_0x27d538[_0x430d55(0x1d4)]+'-campaign',{'action':_0x430d55(0x1a2),'record':_0x27d538});}async function handleProcessCampaign(_0x49468e){const _0x4dcfc7=a305_0x5a83a3;try{const {id:_0x52234e}=_0x49468e[_0x4dcfc7(0x1ad)],_0x5a5518=await getCampaign(_0x52234e),_0x50fd80=await getSettings(_0x5a5518);if(_0x5a5518){const {contacts:_0x2fe0fd}=_0x5a5518[_0x4dcfc7(0x134)];if((0x0,lodash_1['isArray'])(_0x2fe0fd)){const _0x1e2357=_0x2fe0fd[_0x4dcfc7(0x1c9)](_0x39773a=>({'contactId':_0x39773a['id'],'campaignId':_0x5a5518['id'],'variables':_0x50fd80['variables']})),_0x11cb0a=parseToMilliseconds(_0x50fd80[_0x4dcfc7(0x1f5)]),_0x1d3ede=parseToMilliseconds(_0x50fd80[_0x4dcfc7(0x1e9)]),_0x21bef5=_0x50fd80[_0x4dcfc7(0x1c2)];let _0x1db13c=_0x5a5518[_0x4dcfc7(0x136)];const _0x18287c=[];for(let _0x117c28=0x0;_0x117c28<_0x1e2357[_0x4dcfc7(0x176)];_0x117c28++){_0x1db13c=(0x0,date_fns_1[_0x4dcfc7(0x1aa)])(_0x1db13c,_0x117c28>_0x11cb0a?_0x1d3ede:_0x21bef5);const {contactId:_0x1dee7f,campaignId:_0x533252,variables:_0x1a9b2}=_0x1e2357[_0x117c28],_0x274bfb=calculateDelay(_0x117c28,_0x1db13c,_0x11cb0a,_0x1d3ede,_0x21bef5),_0x29da2d=exports[_0x4dcfc7(0x124)][_0x4dcfc7(0x1d7)](_0x4dcfc7(0x158),{'contactId':_0x1dee7f,'campaignId':_0x533252,'variables':_0x1a9b2,'delay':_0x274bfb},{'removeOnComplete':!![]});_0x18287c[_0x4dcfc7(0x197)](_0x29da2d),logger_1['logger']['info'](_0x4dcfc7(0x159)+_0x5a5518['id']+_0x4dcfc7(0x195)+_0x2fe0fd[_0x117c28][_0x4dcfc7(0x18c)]+_0x4dcfc7(0x210)+_0x274bfb);}await Promise[_0x4dcfc7(0x1ec)](_0x18287c),await _0x5a5518[_0x4dcfc7(0x1a2)]({'status':'EM_ANDAMENTO'});}}}catch(_0x5c550c){Sentry[_0x4dcfc7(0x1b4)](_0x5c550c);}}function calculateDelay(_0xd96564,_0x4dbb8f,_0x2d1eac,_0x160428,_0x1b61b5){const _0x4077db=a305_0x5a83a3,_0x252930=(0x0,date_fns_1[_0x4077db(0x1bc)])(_0x4dbb8f,new Date());return _0xd96564>_0x2d1eac?_0x252930*0x3e8+_0x160428:_0x252930*0x3e8+_0x1b61b5;}async function handlePrepareContact(_0x415896){const _0x47c318=a305_0x5a83a3;try{const {contactId:_0x1cac95,campaignId:_0x3f9857,delay:_0x2e5840,variables:_0x168d3b}=_0x415896[_0x47c318(0x1ad)],_0x13352a=await getCampaign(_0x3f9857),_0xc70e25=await getContact(_0x1cac95),_0x19c2a2={};_0x19c2a2[_0x47c318(0x162)]=_0xc70e25[_0x47c318(0x162)],_0x19c2a2[_0x47c318(0x19d)]=_0x1cac95,_0x19c2a2[_0x47c318(0x122)]=_0x3f9857;const _0x57ba86=getCampaignValidMessages(_0x13352a);if(_0x57ba86['length']){const _0xb04673=randomValue(0x0,_0x57ba86[_0x47c318(0x176)]),_0x4a82e9=getProcessedMessage(_0x57ba86[_0xb04673],_0x168d3b,_0xc70e25);_0x19c2a2[_0x47c318(0x14d)]='‌'+_0x4a82e9;}if(_0x13352a['confirmation']){const _0x2bd796=getCampaignValidConfirmationMessages(_0x13352a);if(_0x2bd796[_0x47c318(0x176)]){const _0x5ad7c3=randomValue(0x0,_0x2bd796[_0x47c318(0x176)]),_0x7fbcfa=getProcessedMessage(_0x2bd796[_0x5ad7c3],_0x168d3b,_0xc70e25);_0x19c2a2[_0x47c318(0x19e)]='‌'+_0x7fbcfa;}}const [_0x235e93,_0x436c52]=await CampaignShipping_1['default']['findOrCreate']({'where':{'campaignId':_0x19c2a2[_0x47c318(0x122)],'contactId':_0x19c2a2['contactId']},'defaults':_0x19c2a2});!_0x436c52&&_0x235e93[_0x47c318(0x18d)]===null&&_0x235e93[_0x47c318(0x172)]===null&&(_0x235e93[_0x47c318(0x1de)](_0x19c2a2),await _0x235e93['save']());if(_0x235e93[_0x47c318(0x18d)]===null&&_0x235e93[_0x47c318(0x172)]===null){const _0xd11d4f=await exports[_0x47c318(0x124)][_0x47c318(0x1d7)](_0x47c318(0x1fa),{'campaignId':_0x13352a['id'],'campaignShippingId':_0x235e93['id'],'contactListItemId':_0x1cac95},{'delay':_0x2e5840});await _0x235e93[_0x47c318(0x1a2)]({'jobId':_0xd11d4f['id']});}await verifyAndFinalizeCampaign(_0x13352a);}catch(_0x2370c0){Sentry['captureException'](_0x2370c0),logger_1[_0x47c318(0x16b)][_0x47c318(0x20b)](_0x47c318(0x1e1)+_0x2370c0['message']);}}async function handleDispatchCampaign(_0x4f9640){const _0x1b97b6=a305_0x5a83a3;try{const {data:_0x6dd99f}=_0x4f9640,{campaignShippingId:_0x5c695f,campaignId:_0x339258}=_0x6dd99f,_0x2039e5=await getCampaign(_0x339258),_0x5a72e0=await(0x0,GetWhatsappWbot_1[_0x1b97b6(0x1af)])(_0x2039e5[_0x1b97b6(0x165)]);if(!_0x5a72e0){logger_1[_0x1b97b6(0x16b)]['error'](_0x1b97b6(0x1f6));return;}if(!_0x2039e5[_0x1b97b6(0x165)]){logger_1[_0x1b97b6(0x16b)][_0x1b97b6(0x20b)](_0x1b97b6(0x188));return;}if(!_0x5a72e0?.[_0x1b97b6(0x12b)]?.['id']){logger_1[_0x1b97b6(0x16b)][_0x1b97b6(0x20b)](_0x1b97b6(0x1cc));return;}logger_1[_0x1b97b6(0x16b)][_0x1b97b6(0x13b)](_0x1b97b6(0x1b6)+_0x339258+_0x1b97b6(0x129)+_0x5c695f);const _0x1899d2=await CampaignShipping_1[_0x1b97b6(0x1af)][_0x1b97b6(0x15f)](_0x5c695f,{'include':[{'model':ContactListItem_1[_0x1b97b6(0x1af)],'as':'contact'}]}),_0x41848f=_0x1899d2[_0x1b97b6(0x162)]+_0x1b97b6(0x180);if(_0x2039e5['confirmation']&&_0x1899d2[_0x1b97b6(0x1c5)]===null)await _0x5a72e0['sendMessage'](_0x41848f,{'text':_0x1899d2[_0x1b97b6(0x19e)]}),await _0x1899d2[_0x1b97b6(0x1a2)]({'confirmationRequestedAt':(0x0,moment_1[_0x1b97b6(0x1af)])()});else{await _0x5a72e0['sendMessage'](_0x41848f,{'text':_0x1899d2[_0x1b97b6(0x14d)]});if(_0x2039e5['mediaPath']){const _0x41ed08=path_1['default'][_0x1b97b6(0x1a7)](__dirname,'..',_0x1b97b6(0x1f0)),_0x3b791a=path_1['default']['join'](_0x41ed08,_0x1b97b6(0x1ba)+_0x2039e5['companyId'],_0x2039e5[_0x1b97b6(0x19b)]),_0x1158bb=await(0x0,SendWhatsAppMedia_1[_0x1b97b6(0x143)])(_0x2039e5[_0x1b97b6(0x1b0)],_0x3b791a,_0x2039e5[_0x1b97b6(0x1d4)][_0x1b97b6(0x17b)]());Object[_0x1b97b6(0x1fe)](_0x1158bb)[_0x1b97b6(0x176)]&&await _0x5a72e0[_0x1b97b6(0x1e8)](_0x41848f,{..._0x1158bb});}await _0x1899d2[_0x1b97b6(0x1a2)]({'deliveredAt':(0x0,moment_1[_0x1b97b6(0x1af)])()});}await verifyAndFinalizeCampaign(_0x2039e5);const _0x55717d=(0x0,socket_1['getIO'])();_0x55717d[_0x1b97b6(0x14c)](_0x1b97b6(0x168)+_0x2039e5[_0x1b97b6(0x1d4)]+_0x1b97b6(0x155),{'action':'update','record':_0x2039e5}),logger_1[_0x1b97b6(0x16b)][_0x1b97b6(0x13b)](_0x1b97b6(0x199)+_0x339258+_0x1b97b6(0x195)+_0x1899d2['contact']['name']);}catch(_0x2f7931){Sentry[_0x1b97b6(0x1b4)](_0x2f7931),logger_1[_0x1b97b6(0x16b)][_0x1b97b6(0x20b)](_0x2f7931[_0x1b97b6(0x14d)]),console[_0x1b97b6(0x1eb)](_0x2f7931[_0x1b97b6(0x1e5)]);}}async function handleLoginStatus(_0x100f5b){const _0xcb05ab=a305_0x5a83a3,_0x4fde7e=await database_1[_0xcb05ab(0x1af)][_0xcb05ab(0x148)](_0xcb05ab(0x146),{'type':sequelize_1['QueryTypes']['SELECT']}),_0x1e5ad8=_0x4fde7e['map'](_0x3c5cd6=>_0x3c5cd6['id']),_0x437532=_0x1e5ad8[_0xcb05ab(0x1cd)](',\x20');try{const _0x21b92a=_0xcb05ab(0x1b5)+_0x437532+');',_0x34d44e=await database_1[_0xcb05ab(0x1af)]['query'](_0x21b92a,{'type':sequelize_1[_0xcb05ab(0x1a5)][_0xcb05ab(0x125)]});logger_1[_0xcb05ab(0x16b)]['info'](_0x4fde7e[_0xcb05ab(0x176)]+_0xcb05ab(0x189));}catch(_0x4e7236){Sentry[_0xcb05ab(0x1b4)](_0x4e7236);}}async function handleVerifyQueue(_0x30b905){const _0x3cf9be=a305_0x5a83a3;logger_1[_0x3cf9be(0x16b)]['info'](_0x3cf9be(0x164));try{const _0x31f52f=await Company_1[_0x3cf9be(0x1af)][_0x3cf9be(0x153)]({'attributes':['id',_0x3cf9be(0x18c)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x3cf9be(0x191)][_0x3cf9be(0x181)]('CURRENT_DATE')}},'include':[{'model':Whatsapp_1['default'],'attributes':['id',_0x3cf9be(0x18c),_0x3cf9be(0x204),_0x3cf9be(0x1f2),_0x3cf9be(0x1fd)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x31f52f[_0x3cf9be(0x1c9)](async _0x452adb=>{const _0x3a6b09=_0x3cf9be;_0x452adb[_0x3a6b09(0x117)][_0x3a6b09(0x1c9)](async _0x1f0015=>{const _0x712650=_0x3a6b09;if(_0x1f0015[_0x712650(0x204)]==='CONNECTED'){var _0x45992b=_0x452adb['id'];const _0x22c610=_0x1f0015[_0x712650(0x1f2)]?_0x1f0015[_0x712650(0x1f2)]:0x0,_0x3eba3e=_0x1f0015[_0x712650(0x1fd)],_0x3087e4=_0x22c610,_0x11b834=_0x3eba3e,_0x4cef95=_0x3087e4;if(_0x22c610>0x0){if(!isNaN(_0x11b834)&&Number[_0x712650(0x167)](_0x11b834)&&!isNaN(_0x4cef95)&&Number[_0x712650(0x167)](_0x4cef95)){const _0x4cbaa2=(0x0,moment_1['default'])()[_0x712650(0x171)](_0x4cef95,_0x712650(0x179))[_0x712650(0x142)]()['format'](),{count:_0x2b64aa,rows:_0x38784c}=await Ticket_1[_0x712650(0x1af)][_0x712650(0x150)]({'where':{'status':'pending','queueId':null,'companyId':_0x45992b,'whatsappId':_0x1f0015['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x4cbaa2}},'include':[{'model':Contact_1[_0x712650(0x1af)],'as':'contact','attributes':['id',_0x712650(0x18c),_0x712650(0x162),_0x712650(0x173),_0x712650(0x16a),_0x712650(0x18e),_0x712650(0x141),_0x712650(0x135)],'include':[_0x712650(0x1e3),_0x712650(0x198),_0x712650(0x1a3)]},{'model':Queue_2['default'],'as':_0x712650(0x131),'attributes':['id',_0x712650(0x18c),'color']}]});_0x2b64aa>0x0?_0x38784c[_0x712650(0x1c9)](async _0x2b21fb=>{const _0x171b08=_0x712650;await _0x2b21fb[_0x171b08(0x1a2)]({'queueId':_0x11b834}),await _0x2b21fb[_0x171b08(0x193)]();const _0x407300=(0x0,socket_1[_0x171b08(0x1c1)])();_0x407300['to'](_0x2b21fb['status'])['to'](_0x171b08(0x205))['to'](_0x2b21fb['id'][_0x171b08(0x17b)]())[_0x171b08(0x14c)](_0x171b08(0x168)+_0x45992b+_0x171b08(0x175),{'action':'update','ticket':_0x2b21fb,'ticketId':_0x2b21fb['id']}),logger_1['logger']['info'](_0x171b08(0x1ee)+_0x2b21fb['id']+_0x171b08(0x1d3)+_0x45992b);}):logger_1[_0x712650(0x16b)][_0x712650(0x13b)](_0x712650(0x174)+_0x45992b);}else logger_1[_0x712650(0x16b)][_0x712650(0x13b)](_0x712650(0x1fb)+_0x45992b);}}});});}catch(_0x54f1bf){Sentry[_0x3cf9be(0x1b4)](_0x54f1bf),logger_1[_0x3cf9be(0x16b)]['error'](_0x3cf9be(0x149),_0x54f1bf[_0x3cf9be(0x14d)]);throw _0x54f1bf;}}function a305_0x26dd(_0x161c91,_0xa3bc4a){const _0x25ea51=a305_0x25ea();return a305_0x26dd=function(_0x26ddd0,_0x52ef51){_0x26ddd0=_0x26ddd0-0x117;let _0x5eac05=_0x25ea51[_0x26ddd0];return _0x5eac05;},a305_0x26dd(_0x161c91,_0xa3bc4a);};function a305_0x25ea(){const _0x126525=['campaignId','ScheduleMonitor','campaignQueue','UPDATE','message2','defineProperty','confirmationMessage2',';Registro=','901116ZGLViz','user','clean','SearchForUsersRandom\x20->\x20VerifyUsersRandom:\x20error','isWhatsappValid','Verify','*/1\x20*\x20*\x20*\x20*','queue','./services/ContactServices/ShowContactService','3543120izVJKG','contactList','disableBot','scheduledAt','USER\x20OFFLINE','VerifyQueueStatus','245XcLDSy','./models/UserQueue','info','REDIS_OPT_LIMITER_MAX','YYYY-MM-DD\x20HH:mm:ss','value','milliseconds','*Assistente\x20Virtual*:\x0aAguarde\x20enquanto\x20localizamos\x20um\x20atendente...\x20Você\x20será\x20atendido\x20em\x20breve!','active','utc','getMessageOptions','forEach','82248pKFocd','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x273\x20minutes\x27::interval\x20and\x20online\x20=\x20true','VerifyCampaignsDaatabase','query','SearchForQueue\x20->\x20VerifyQueue:\x20error','SendMessage','{email}','emit','message','./models/Ticket','./helpers/SendMessage','findAndCountAll','pending','message1','findAll','SELECT','-campaign','Sleep\x20de\x20','./models/Whatsapp','PrepareContact','Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha=','completed','./services/WbotServices/wbotClosedTickets','Ticket\x20ID\x20','./models/Schedule','moment','findByPk','message5','includes','number','./models/Campaign','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','whatsapp','./models/User','isInteger','company-','HH:mm:ss','profilePicUrl','logger','2401150QgllGZ','startQueueProcess','confirmationMessage1','queueMonitor','key','subtract','confirmationRequestedAt','email','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','-ticket','length','writable','./models/Queue','minutes','confirmationMessage5','toString','date-fns','select\x20id,\x20\x22scheduledAt\x22\x20from\x20\x22Campaigns\x22\x20c\x0a\x20\x20\x20\x20where\x20\x22scheduledAt\x22\x20between\x20now()\x20and\x20now()\x20+\x20\x273\x20hour\x27::interval\x20and\x20status\x20=\x20\x27PROGRAMADA\x27','10504whUCIb','CampaignQueue','@s.whatsapp.net','literal','*/20\x20*\x20*\x20*\x20*\x20*','CronJob','YYYY-MM-DD\x20HH:mm','userId','online','./utils/logger','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20whatsapp\x20not\x20found','\x20usuarios\x20passados\x20para\x20offline','REDIS_URI','\x20segundos\x20iniciado:\x20','name','deliveredAt','acceptAudioMessage','message4','VerifyLoginStatus','Sequelize','ERRO','reload','Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha=',';Contato=','seconds','push','contactTags','Campanha\x20enviada\x20para:\x20Campanha=','toDate','mediaPath','./models/Company','contactId','confirmationMessage','parseToMilliseconds','REDIS_OPT_LIMITER_DURATION','process','update','tags','floor','QueryTypes','QueueMonitor','resolve','start','cron','addSeconds','./services/TicketServices/ShowTicketService','userMonitor','data','MessageQueue\x20->\x20SendMessage:\x20error','default','mediaName','verify','filter','tempoRoteador','captureException','UPDATE\x20\x22Users\x22\x20SET\x20\x22online\x22\x20=\x20false,\x20\x22updatedAt\x22\x20=\x20now()\x20WHERE\x20id\x20IN\x20(','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','isNil','get','path','company','ProcessCampaign','differenceInSeconds','configurable','ADMIN','isEmpty','body','getIO','messageInterval','count','USER','confirmation','AGENDADA','Disparo\x20agendado\x20para:\x20','parse','map','./helpers/GetWhatsappWbot','./services/TicketServices/UpdateTicketService','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20user\x20not\x20found','join','./models/CampaignSetting','nodemailer','./models/Contact','sequelize','lodash','\x20-\x20Empresa:\x20','companyId','Campanhas\x20encontradas:\x20','SendScheduledMessage\x20->\x20SendMessage:\x20error','add','./models/CampaignShipping','./libs/socket','diff','confirmationMessage3','Whatsapp\x20não\x20identificado','./database','set','gte','__setModuleDefault','campaignQueue\x20->\x20PrepareContact\x20->\x20error:\x20','./helpers/GetDefaultWhatsApp','extraInfo','__esModule','stack','Iniciando\x20processamento\x20de\x20filas','confirmationMessage4','sendMessage','greaterInterval','message3','log','all','UserMonitor','Atendimento\x20Perdido:\x20','./models/ContactListItem','public','*/5\x20*\x20*\x20*\x20*\x20*','timeSendQueue','\x20segundos\x20finalizado:\x20','sendScheduledMessages','longerIntervalAfter','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20not\x20found','open','Iniciando\x20a\x20randomização\x20dos\x20atendimentos...','messageQueue','DispatchCampaign','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','scheduleMonitor','sendIdQueue','keys','verify-campaing','findOne','Erro\x20ao\x20tentar\x20consultar\x20agendamento:\x20','contact','{nome}','status','notification','1dJudKA','Mensagem\x20agendada\x20enviada\x20para:\x20','__importDefault','*\x20*\x20*\x20*\x20*','113728DZlKVN','error','180Vypnbh','randomValue','replace','{numero}',';delay=','whatsapps','create','1837179PxAAvU','FINALIZADA','./services/WbotServices/SendWhatsAppMedia','ClosedAllOpenTickets','format','hasOwnProperty','updatedAt','env','bull'];a305_0x25ea=function(){return _0x126525;};return a305_0x25ea();}async function handleRandomUser(){const _0x2c8f18=a305_0x5a83a3;logger_1[_0x2c8f18(0x16b)][_0x2c8f18(0x13b)](_0x2c8f18(0x1f8));const _0x4b07ca=new CronJob(_0x2c8f18(0x1f1),async()=>{const _0x3f0552=_0x2c8f18;try{const {count:_0x59116f,rows:_0x5a3c53}=await Ticket_1[_0x3f0552(0x1af)]['findAndCountAll']({'where':{'status':_0x3f0552(0x151),'queueId':{[sequelize_1['Op']['ne']]:null,[sequelize_1['Op']['ne']]:0x0},'$queue.ativarRoteador$':!![],'$queue.tempoRoteador$':{[sequelize_1['Op']['ne']]:0x0}},'include':[{'model':Queue_1[_0x3f0552(0x1af)],'as':_0x3f0552(0x131)}]}),_0x3be543=_0x25837e=>{const _0x5ad05e=_0x3f0552,_0x2cdab5=Math[_0x5ad05e(0x1a4)](Math['random']()*_0x25837e[_0x5ad05e(0x176)]);return _0x25837e[_0x2cdab5];},_0x8635c0=async _0x1838f5=>{const _0x4f1f9e=_0x3f0552;try{const _0x138089=await User_1['default'][_0x4f1f9e(0x200)]({'where':{'id':_0x1838f5}});return _0x138089['profile']==='user'?(logger_1[_0x4f1f9e(0x16b)][_0x4f1f9e(0x13b)](_0x4f1f9e(0x1c4)),_0x138089[_0x4f1f9e(0x186)]===!![]?_0x138089['id']:(logger_1[_0x4f1f9e(0x16b)][_0x4f1f9e(0x13b)](_0x4f1f9e(0x137)),0x0)):(logger_1['logger'][_0x4f1f9e(0x13b)](_0x4f1f9e(0x1be)),0x0);}catch(_0x36245b){Sentry['captureException'](_0x36245b),logger_1[_0x4f1f9e(0x16b)][_0x4f1f9e(0x20b)](_0x4f1f9e(0x12d),_0x36245b[_0x4f1f9e(0x14d)]);throw _0x36245b;}};if(_0x59116f>0x0)for(const _0x12b198 of _0x5a3c53){const {queue:_0x4b69bc,queueId:_0x49e287,userId:_0x811bc1}=_0x12b198,_0x48e423=_0x4b69bc[_0x3f0552(0x1b3)],_0x4ff6d0=await UserQueue_1['default'][_0x3f0552(0x153)]({'where':{'queueId':_0x49e287}}),_0x5359d6=await(0x0,ShowContactService_1[_0x3f0552(0x1af)])(_0x12b198[_0x3f0552(0x19d)],_0x12b198[_0x3f0552(0x1d4)]),_0x2bcc32=_0x4ff6d0[_0x3f0552(0x1c9)](_0x1bad54=>_0x1bad54[_0x3f0552(0x185)]),_0x491701=(0x0,moment_1[_0x3f0552(0x1af)])()[_0x3f0552(0x171)](_0x48e423,_0x3f0552(0x179))['utc']()[_0x3f0552(0x19a)](),_0x4c69df=new Date(_0x12b198[_0x3f0552(0x11f)]);if(!_0x811bc1){const _0x28538c=_0x3be543(_0x2bcc32);if(await _0x8635c0(_0x28538c)>0x0){const _0x2cd825=await(0x0,ShowTicketService_1['default'])(_0x12b198['id'],_0x12b198[_0x3f0552(0x1d4)]),_0x1e9ca1=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x3f0552(0x140),'ticket':_0x2cd825});await(0x0,UpdateTicketService_1[_0x3f0552(0x1af)])({'ticketData':{'status':'open','userId':_0x28538c},'ticketId':_0x12b198['id'],'companyId':_0x12b198[_0x3f0552(0x1d4)]}),logger_1[_0x3f0552(0x16b)]['info'](_0x3f0552(0x15c)+_0x12b198['id']+'\x20updated\x20with\x20UserId\x20'+_0x28538c+'\x20-\x20'+_0x12b198['updatedAt']);}else{}}else{if(_0x2bcc32[_0x3f0552(0x161)](_0x811bc1)){if(_0x491701>_0x4c69df){const _0x2e0b80=_0x2bcc32[_0x3f0552(0x1b2)](_0x3c1188=>_0x3c1188!==_0x811bc1);if(_0x2e0b80['length']>0x0){const _0xb530fb=_0x3be543(_0x2e0b80);if(await _0x8635c0(_0xb530fb)>0x0){const _0x42db77=await(0x0,ShowTicketService_1[_0x3f0552(0x1af)])(_0x12b198['id'],_0x12b198[_0x3f0552(0x1d4)]),_0x204251=await(0x0,SendWhatsAppMessage_1[_0x3f0552(0x1af)])({'body':'*Assistente\x20Virtual*:\x0aAguarde\x20enquanto\x20localizamos\x20um\x20atendente...\x20Você\x20será\x20atendido\x20em\x20breve!','ticket':_0x42db77});await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x3f0552(0x1f7),'userId':_0xb530fb},'ticketId':_0x12b198['id'],'companyId':_0x12b198[_0x3f0552(0x1d4)]}),await _0x12b198[_0x3f0552(0x193)]();}else{}}else{}}else{}}else{}}}}catch(_0x15e15d){Sentry[_0x3f0552(0x1b4)](_0x15e15d),logger_1[_0x3f0552(0x16b)][_0x3f0552(0x20b)](_0x3f0552(0x12d),_0x15e15d[_0x3f0552(0x14d)]);throw _0x15e15d;}});_0x4b07ca[_0x2c8f18(0x1a8)]();}async function handleCloseTicketsAutomatic(){const _0x2898b8=a305_0x5a83a3,_0xfcf340=new CronJob(_0x2898b8(0x130),async()=>{const _0x4f54bc=_0x2898b8,_0x13636f=await Company_1['default'][_0x4f54bc(0x153)]();_0x13636f['map'](async _0x25780f=>{const _0x2cc574=_0x4f54bc;try{const _0x4ef6cb=_0x25780f['id'];await(0x0,wbotClosedTickets_1[_0x2cc574(0x11c)])(_0x4ef6cb);}catch(_0x2d29ed){Sentry['captureException'](_0x2d29ed),logger_1[_0x2cc574(0x16b)][_0x2cc574(0x20b)]('ClosedAllOpenTickets\x20->\x20Verify:\x20error',_0x2d29ed['message']);throw _0x2d29ed;}});});_0xfcf340[_0x2898b8(0x1a8)]();}handleCloseTicketsAutomatic(),handleRandomUser();async function startQueueProcess(){const _0x4c545c=a305_0x5a83a3;logger_1[_0x4c545c(0x16b)]['info'](_0x4c545c(0x1e6)),exports[_0x4c545c(0x1f9)]['process']('SendMessage',handleSendMessage),exports['scheduleMonitor']['process'](_0x4c545c(0x12f),handleVerifySchedules),exports[_0x4c545c(0x1f4)][_0x4c545c(0x1a1)]('SendMessage',handleSendScheduledMessage),exports['campaignQueue'][_0x4c545c(0x1a1)](_0x4c545c(0x147),handleVerifyCampaigns),exports[_0x4c545c(0x124)][_0x4c545c(0x1a1)](_0x4c545c(0x1bb),handleProcessCampaign),exports['campaignQueue']['process']('PrepareContact',handlePrepareContact),exports['campaignQueue'][_0x4c545c(0x1a1)](_0x4c545c(0x1fa),handleDispatchCampaign),exports['userMonitor'][_0x4c545c(0x1a1)](_0x4c545c(0x190),handleLoginStatus),exports[_0x4c545c(0x16f)][_0x4c545c(0x1a1)]('VerifyQueueStatus',handleVerifyQueue),exports[_0x4c545c(0x1fc)][_0x4c545c(0x1d7)](_0x4c545c(0x12f),{},{'repeat':{'cron':'*/5\x20*\x20*\x20*\x20*\x20*','key':_0x4c545c(0x1b1)},'removeOnComplete':!![]}),exports[_0x4c545c(0x124)][_0x4c545c(0x1d7)](_0x4c545c(0x147),{},{'repeat':{'cron':_0x4c545c(0x182),'key':_0x4c545c(0x1ff)},'removeOnComplete':!![]}),exports['userMonitor']['add']('VerifyLoginStatus',{},{'repeat':{'cron':_0x4c545c(0x209),'key':'verify-login'},'removeOnComplete':!![]}),exports['queueMonitor']['add'](_0x4c545c(0x138),{},{'repeat':{'cron':_0x4c545c(0x182),'key':'verify-queue'},'removeOnComplete':!![]});}exports[a305_0x5a83a3(0x16d)]=startQueueProcess;