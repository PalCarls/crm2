'use strict';const a317_0x50bd52=a317_0x4fcd;(function(_0x4886c8,_0x558c56){const _0x4ed371=a317_0x4fcd,_0x4efc7f=_0x4886c8();while(!![]){try{const _0x2fa7e2=parseInt(_0x4ed371(0x186))/0x1*(-parseInt(_0x4ed371(0x1a0))/0x2)+-parseInt(_0x4ed371(0x1e2))/0x3*(parseInt(_0x4ed371(0x1d3))/0x4)+-parseInt(_0x4ed371(0x1a5))/0x5+-parseInt(_0x4ed371(0x210))/0x6+-parseInt(_0x4ed371(0x213))/0x7*(parseInt(_0x4ed371(0x1e1))/0x8)+parseInt(_0x4ed371(0x204))/0x9*(-parseInt(_0x4ed371(0x220))/0xa)+parseInt(_0x4ed371(0x215))/0xb*(parseInt(_0x4ed371(0x163))/0xc);if(_0x2fa7e2===_0x558c56)break;else _0x4efc7f['push'](_0x4efc7f['shift']());}catch(_0x2942f4){_0x4efc7f['push'](_0x4efc7f['shift']());}}}(a317_0x3901,0xcf2fe));var __createBinding=this&&this['__createBinding']||(Object[a317_0x50bd52(0x166)]?function(_0x4975a0,_0x13db2d,_0x4e6f2a,_0x12e1e9){const _0x55fce6=a317_0x50bd52;if(_0x12e1e9===undefined)_0x12e1e9=_0x4e6f2a;var _0x777e72=Object[_0x55fce6(0x19d)](_0x13db2d,_0x4e6f2a);(!_0x777e72||(_0x55fce6(0x1fc)in _0x777e72?!_0x13db2d[_0x55fce6(0x142)]:_0x777e72['writable']||_0x777e72[_0x55fce6(0x159)]))&&(_0x777e72={'enumerable':!![],'get':function(){return _0x13db2d[_0x4e6f2a];}}),Object[_0x55fce6(0x150)](_0x4975a0,_0x12e1e9,_0x777e72);}:function(_0x9f2324,_0x46f106,_0x101b43,_0x41efa7){if(_0x41efa7===undefined)_0x41efa7=_0x101b43;_0x9f2324[_0x41efa7]=_0x46f106[_0x101b43];}),__setModuleDefault=this&&this[a317_0x50bd52(0x14f)]||(Object[a317_0x50bd52(0x166)]?function(_0x162360,_0x3c4546){const _0x2e6b68=a317_0x50bd52;Object[_0x2e6b68(0x150)](_0x162360,_0x2e6b68(0x203),{'enumerable':!![],'value':_0x3c4546});}:function(_0x56b5c0,_0x1d87d9){const _0x1ed82c=a317_0x50bd52;_0x56b5c0[_0x1ed82c(0x203)]=_0x1d87d9;}),__importStar=this&&this[a317_0x50bd52(0x1ad)]||function(_0xa3462f){const _0x47815e=a317_0x50bd52;if(_0xa3462f&&_0xa3462f[_0x47815e(0x142)])return _0xa3462f;var _0xd32538={};if(_0xa3462f!=null){for(var _0x50ac8c in _0xa3462f)if(_0x50ac8c!==_0x47815e(0x203)&&Object['prototype'][_0x47815e(0x1f5)][_0x47815e(0x195)](_0xa3462f,_0x50ac8c))__createBinding(_0xd32538,_0xa3462f,_0x50ac8c);}return __setModuleDefault(_0xd32538,_0xa3462f),_0xd32538;},__importDefault=this&&this['__importDefault']||function(_0x3364a2){const _0x1f242f=a317_0x50bd52;return _0x3364a2&&_0x3364a2[_0x1f242f(0x142)]?_0x3364a2:{'default':_0x3364a2};};Object[a317_0x50bd52(0x150)](exports,'__esModule',{'value':!![]}),exports[a317_0x50bd52(0x194)]=exports[a317_0x50bd52(0x1ca)]=exports[a317_0x50bd52(0x18b)]=exports['messageQueue']=exports[a317_0x50bd52(0x207)]=exports[a317_0x50bd52(0x17f)]=exports[a317_0x50bd52(0x201)]=exports['scheduleMonitor']=exports[a317_0x50bd52(0x172)]=void 0x0;const Sentry=__importStar(require(a317_0x50bd52(0x1d8))),bull_1=__importDefault(require(a317_0x50bd52(0x1d7))),SendMessage_1=require(a317_0x50bd52(0x22b)),Whatsapp_1=__importDefault(require('./models/Whatsapp')),logger_1=require(a317_0x50bd52(0x180)),moment_1=__importDefault(require('moment')),Schedule_1=__importDefault(require('./models/Schedule')),sequelize_1=require(a317_0x50bd52(0x196)),GetDefaultWhatsApp_1=__importDefault(require(a317_0x50bd52(0x1f0))),Campaign_1=__importDefault(require(a317_0x50bd52(0x1dd))),Queue_1=__importDefault(require(a317_0x50bd52(0x141))),ContactList_1=__importDefault(require(a317_0x50bd52(0x1e0))),ContactListItem_1=__importDefault(require('./models/ContactListItem')),lodash_1=require('lodash'),CampaignSetting_1=__importDefault(require('./models/CampaignSetting')),CampaignShipping_1=__importDefault(require(a317_0x50bd52(0x214))),GetWhatsappWbot_1=__importDefault(require(a317_0x50bd52(0x22c))),database_1=__importDefault(require('./database')),SendWhatsAppMedia_1=require('./services/WbotServices/SendWhatsAppMedia'),socket_1=require(a317_0x50bd52(0x171)),path_1=__importDefault(require(a317_0x50bd52(0x21c))),User_1=__importDefault(require(a317_0x50bd52(0x15c))),Company_1=__importDefault(require(a317_0x50bd52(0x20a))),Contact_1=__importDefault(require(a317_0x50bd52(0x1fd))),Queue_2=__importDefault(require('./models/Queue')),wbotClosedTickets_1=require(a317_0x50bd52(0x20e)),Ticket_1=__importDefault(require(a317_0x50bd52(0x1b0))),ShowContactService_1=__importDefault(require(a317_0x50bd52(0x175))),GetProfilePicUrl_1=__importDefault(require('./services/WbotServices/GetProfilePicUrl')),CreateOrUpdateContactService_1=__importDefault(require(a317_0x50bd52(0x1e5))),UserQueue_1=__importDefault(require(a317_0x50bd52(0x153))),ShowTicketService_1=__importDefault(require('./services/TicketServices/ShowTicketService')),SendWhatsAppMessage_1=__importDefault(require(a317_0x50bd52(0x18c))),UpdateTicketService_1=__importDefault(require(a317_0x50bd52(0x18f))),date_fns_1=require(a317_0x50bd52(0x22e)),GetWhatsapp_1=require(a317_0x50bd52(0x188)),nodemailer=require(a317_0x50bd52(0x219)),CronJob=require(a317_0x50bd52(0x148))[a317_0x50bd52(0x161)],axios_1=__importDefault(require(a317_0x50bd52(0x14a))),connection=process[a317_0x50bd52(0x233)]['REDIS_URI']||'',limiterMax=process[a317_0x50bd52(0x233)][a317_0x50bd52(0x16d)]||0x1,limiterDuration=process[a317_0x50bd52(0x233)][a317_0x50bd52(0x16c)]||0xbb8;exports[a317_0x50bd52(0x172)]=new bull_1['default'](a317_0x50bd52(0x225),connection),exports['scheduleMonitor']=new bull_1[(a317_0x50bd52(0x203))]('ScheduleMonitor',connection),exports['sendScheduledMessages']=new bull_1[(a317_0x50bd52(0x203))](a317_0x50bd52(0x160),connection),exports[a317_0x50bd52(0x17f)]=new bull_1[(a317_0x50bd52(0x203))](a317_0x50bd52(0x1ea),connection),exports[a317_0x50bd52(0x207)]=new bull_1[(a317_0x50bd52(0x203))](a317_0x50bd52(0x229),connection),exports[a317_0x50bd52(0x1c1)]=new bull_1[(a317_0x50bd52(0x203))](a317_0x50bd52(0x192),connection,{'limiter':{'max':limiterMax,'duration':limiterDuration}});async function handleSendMessage(_0x95903a){const _0x390e8d=a317_0x50bd52;try{const {data:_0x351738}=_0x95903a,_0x849c12=await Whatsapp_1[_0x390e8d(0x203)][_0x390e8d(0x1c9)](_0x351738[_0x390e8d(0x1b2)]);if(_0x849c12===null)throw Error(_0x390e8d(0x1be));const _0x3079bd=_0x351738['data'];await(0x0,SendMessage_1[_0x390e8d(0x152)])(_0x849c12,_0x3079bd);}catch(_0x42faa5){Sentry[_0x390e8d(0x20d)](_0x42faa5),logger_1['logger'][_0x390e8d(0x22a)](_0x390e8d(0x184),_0x42faa5[_0x390e8d(0x1c2)]);throw _0x42faa5;}}async function handleVerifySchedules(_0x2fd7a8){const _0xb7b345=a317_0x50bd52;try{const {count:_0x113da1,rows:_0x4171ae}=await Schedule_1[_0xb7b345(0x203)][_0xb7b345(0x1ff)]({'where':{'status':_0xb7b345(0x22f),'sentAt':null,'sendAt':{[sequelize_1['Op'][_0xb7b345(0x20c)]]:(0x0,moment_1[_0xb7b345(0x203)])()[_0xb7b345(0x205)](_0xb7b345(0x1b3)),[sequelize_1['Op'][_0xb7b345(0x162)]]:(0x0,moment_1['default'])()[_0xb7b345(0x1b8)]('30','seconds')[_0xb7b345(0x205)](_0xb7b345(0x1b3))}},'include':[{'model':Contact_1[_0xb7b345(0x203)],'as':_0xb7b345(0x19f)}]});_0x113da1>0x0&&_0x4171ae[_0xb7b345(0x1bb)](async _0x111615=>{const _0x585310=_0xb7b345;await _0x111615[_0x585310(0x158)]({'status':_0x585310(0x1a6)}),exports[_0x585310(0x201)][_0x585310(0x1b8)](_0x585310(0x152),{'schedule':_0x111615},{'delay':0x9c40}),logger_1[_0x585310(0x1de)][_0x585310(0x231)](_0x585310(0x1c6)+_0x111615[_0x585310(0x19f)][_0x585310(0x1b1)]);});}catch(_0x385265){Sentry[_0xb7b345(0x20d)](_0x385265),logger_1[_0xb7b345(0x1de)][_0xb7b345(0x22a)]('SendScheduledMessage\x20->\x20Verify:\x20error',_0x385265[_0xb7b345(0x1c2)]);throw _0x385265;}}async function handleSendScheduledMessage(_0x1d1c43){const _0x2da1bc=a317_0x50bd52,{data:{schedule:_0x53bed6}}=_0x1d1c43;let _0x12ae1f=null;try{_0x12ae1f=await Schedule_1['default'][_0x2da1bc(0x1c9)](_0x53bed6['id']);}catch(_0x4ad46d){Sentry['captureException'](_0x4ad46d),logger_1[_0x2da1bc(0x1de)][_0x2da1bc(0x231)](_0x2da1bc(0x146)+_0x53bed6['id']);}try{const _0x29f438=await(0x0,GetDefaultWhatsApp_1[_0x2da1bc(0x203)])(_0x53bed6[_0x2da1bc(0x1b5)]);await(0x0,SendMessage_1['SendMessage'])(_0x29f438,{'number':_0x53bed6[_0x2da1bc(0x19f)][_0x2da1bc(0x157)],'body':_0x53bed6[_0x2da1bc(0x1d6)]}),await _0x12ae1f?.[_0x2da1bc(0x158)]({'sentAt':(0x0,moment_1[_0x2da1bc(0x203)])()['format']('YYYY-MM-DD\x20HH:mm'),'status':_0x2da1bc(0x1bd)}),logger_1[_0x2da1bc(0x1de)][_0x2da1bc(0x231)](_0x2da1bc(0x17a)+_0x53bed6[_0x2da1bc(0x19f)][_0x2da1bc(0x1b1)]),exports[_0x2da1bc(0x201)][_0x2da1bc(0x19e)](0x3a98,'completed');}catch(_0x1cee8f){Sentry[_0x2da1bc(0x20d)](_0x1cee8f),await _0x12ae1f?.[_0x2da1bc(0x158)]({'status':'ERRO'}),logger_1[_0x2da1bc(0x1de)][_0x2da1bc(0x22a)](_0x2da1bc(0x1a8),_0x1cee8f[_0x2da1bc(0x1c2)]);throw _0x1cee8f;}}async function handleVerifyCampaigns(_0x3d7e06){const _0xa56c9c=a317_0x50bd52,_0x7e1f67=await database_1[_0xa56c9c(0x203)]['query']('select\x20id,\x20\x22scheduledAt\x22\x20from\x20\x22Campaigns\x22\x20c\x0a\x20\x20\x20\x20where\x20\x22scheduledAt\x22\x20between\x20now()\x20and\x20now()\x20+\x20\x273\x20hour\x27::interval\x20and\x20status\x20=\x20\x27PROGRAMADA\x27',{'type':sequelize_1['QueryTypes'][_0xa56c9c(0x173)]});logger_1[_0xa56c9c(0x1de)][_0xa56c9c(0x231)](_0xa56c9c(0x15b)+_0x7e1f67['length']);for(let _0xb5463b of _0x7e1f67){try{const _0x5425da=(0x0,moment_1[_0xa56c9c(0x203)])(),_0x393af7=(0x0,moment_1[_0xa56c9c(0x203)])(_0xb5463b[_0xa56c9c(0x1f3)]),_0x419f94=_0x393af7[_0xa56c9c(0x1d9)](_0x5425da,_0xa56c9c(0x1c5));logger_1[_0xa56c9c(0x1de)]['info'](_0xa56c9c(0x1c8)+_0xb5463b['id']+_0xa56c9c(0x1e4)+_0x419f94),exports[_0xa56c9c(0x17f)]['add'](_0xa56c9c(0x1e8),{'id':_0xb5463b['id'],'delay':_0x419f94},{'priority':0x3,'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}});}catch(_0x41f5b9){Sentry['captureException'](_0x41f5b9);}}}async function getCampaign(_0xf45e0e){const _0x4627c4=a317_0x50bd52;return await Campaign_1[_0x4627c4(0x203)]['findOne']({'where':{'id':_0xf45e0e},'include':[{'model':ContactList_1[_0x4627c4(0x203)],'as':'contactList','attributes':['id',_0x4627c4(0x1b1)],'include':[{'model':ContactListItem_1[_0x4627c4(0x203)],'as':'contacts','attributes':['id',_0x4627c4(0x1b1),_0x4627c4(0x157),_0x4627c4(0x234),_0x4627c4(0x212)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1[_0x4627c4(0x203)],'as':'whatsapp','attributes':['id',_0x4627c4(0x1b1)]}]});}async function getContact(_0x4d1a08){const _0x123eb4=a317_0x50bd52;return await ContactListItem_1[_0x123eb4(0x203)][_0x123eb4(0x1c9)](_0x4d1a08,{'attributes':['id','name','number','email']});}async function getSettings(_0x5f2d37){const _0x6fe1ef=a317_0x50bd52;try{const _0x35a966=await CampaignSetting_1[_0x6fe1ef(0x203)][_0x6fe1ef(0x14e)]({'where':{'companyId':_0x5f2d37[_0x6fe1ef(0x1b5)]},'attributes':[_0x6fe1ef(0x1e7),'value']}),_0x29f428=_0x35a966[_0x6fe1ef(0x227)]((_0x33176a,_0x44e6a2)=>{const _0x2e5e5f=_0x6fe1ef;return _0x33176a[_0x44e6a2[_0x2e5e5f(0x1e7)]]=JSON[_0x2e5e5f(0x190)](_0x44e6a2[_0x2e5e5f(0x193)]),_0x33176a;},{}),{messageInterval:messageInterval=0x14,longerIntervalAfter:longerIntervalAfter=0x14,greaterInterval:greaterInterval=0x3c,variables:variables=[]}=_0x29f428;return{'messageInterval':messageInterval,'longerIntervalAfter':longerIntervalAfter,'greaterInterval':greaterInterval,'variables':variables};}catch(_0x49171d){console['log'](_0x49171d);throw _0x49171d;}}function parseToMilliseconds(_0x1e7894){return _0x1e7894*0x3e8;}exports['parseToMilliseconds']=parseToMilliseconds;async function sleep(_0x33ee56){const _0x468889=a317_0x50bd52;return logger_1[_0x468889(0x1de)]['info'](_0x468889(0x198)+_0x33ee56+'\x20segundos\x20iniciado:\x20'+(0x0,moment_1['default'])()[_0x468889(0x205)](_0x468889(0x1cb))),new Promise(_0x55d074=>{setTimeout(()=>{const _0x15b30f=a317_0x4fcd;logger_1[_0x15b30f(0x1de)][_0x15b30f(0x231)](_0x15b30f(0x198)+_0x33ee56+_0x15b30f(0x17d)+(0x0,moment_1['default'])()[_0x15b30f(0x205)](_0x15b30f(0x1cb))),_0x55d074(!![]);},parseToMilliseconds(_0x33ee56));});}function getCampaignValidMessages(_0x54335d){const _0x40820e=a317_0x50bd52,_0x5da1a3=[];return!(0x0,lodash_1[_0x40820e(0x1bf)])(_0x54335d['message1'])&&!(0x0,lodash_1[_0x40820e(0x18a)])(_0x54335d[_0x40820e(0x1f1)])&&_0x5da1a3['push'](_0x54335d[_0x40820e(0x1f1)]),!(0x0,lodash_1[_0x40820e(0x1bf)])(_0x54335d[_0x40820e(0x1ba)])&&!(0x0,lodash_1[_0x40820e(0x18a)])(_0x54335d[_0x40820e(0x1ba)])&&_0x5da1a3[_0x40820e(0x216)](_0x54335d[_0x40820e(0x1ba)]),!(0x0,lodash_1[_0x40820e(0x1bf)])(_0x54335d['message3'])&&!(0x0,lodash_1[_0x40820e(0x18a)])(_0x54335d['message3'])&&_0x5da1a3[_0x40820e(0x216)](_0x54335d['message3']),!(0x0,lodash_1[_0x40820e(0x1bf)])(_0x54335d[_0x40820e(0x1d2)])&&!(0x0,lodash_1[_0x40820e(0x18a)])(_0x54335d[_0x40820e(0x1d2)])&&_0x5da1a3[_0x40820e(0x216)](_0x54335d[_0x40820e(0x1d2)]),!(0x0,lodash_1['isEmpty'])(_0x54335d[_0x40820e(0x168)])&&!(0x0,lodash_1[_0x40820e(0x18a)])(_0x54335d[_0x40820e(0x168)])&&_0x5da1a3[_0x40820e(0x216)](_0x54335d['message5']),_0x5da1a3;}function getCampaignValidConfirmationMessages(_0x2ad5b8){const _0x1c26ce=a317_0x50bd52,_0x39c8e4=[];return!(0x0,lodash_1[_0x1c26ce(0x1bf)])(_0x2ad5b8[_0x1c26ce(0x182)])&&!(0x0,lodash_1[_0x1c26ce(0x18a)])(_0x2ad5b8[_0x1c26ce(0x182)])&&_0x39c8e4[_0x1c26ce(0x216)](_0x2ad5b8[_0x1c26ce(0x182)]),!(0x0,lodash_1[_0x1c26ce(0x1bf)])(_0x2ad5b8[_0x1c26ce(0x1ce)])&&!(0x0,lodash_1['isNil'])(_0x2ad5b8[_0x1c26ce(0x1ce)])&&_0x39c8e4[_0x1c26ce(0x216)](_0x2ad5b8[_0x1c26ce(0x1ce)]),!(0x0,lodash_1['isEmpty'])(_0x2ad5b8['confirmationMessage3'])&&!(0x0,lodash_1[_0x1c26ce(0x18a)])(_0x2ad5b8[_0x1c26ce(0x1fe)])&&_0x39c8e4[_0x1c26ce(0x216)](_0x2ad5b8[_0x1c26ce(0x1fe)]),!(0x0,lodash_1['isEmpty'])(_0x2ad5b8[_0x1c26ce(0x179)])&&!(0x0,lodash_1[_0x1c26ce(0x18a)])(_0x2ad5b8[_0x1c26ce(0x179)])&&_0x39c8e4['push'](_0x2ad5b8['confirmationMessage4']),!(0x0,lodash_1[_0x1c26ce(0x1bf)])(_0x2ad5b8['confirmationMessage5'])&&!(0x0,lodash_1[_0x1c26ce(0x18a)])(_0x2ad5b8[_0x1c26ce(0x1ee)])&&_0x39c8e4[_0x1c26ce(0x216)](_0x2ad5b8['confirmationMessage5']),_0x39c8e4;}function getProcessedMessage(_0x46ee3f,_0x2314c6,_0x24205d){const _0x5c17ea=a317_0x50bd52;let _0x155b3c=_0x46ee3f;return _0x155b3c[_0x5c17ea(0x1ec)](_0x5c17ea(0x1fb))&&(_0x155b3c=_0x155b3c['replace'](/{nome}/g,_0x24205d[_0x5c17ea(0x1b1)])),_0x155b3c[_0x5c17ea(0x1ec)](_0x5c17ea(0x183))&&(_0x155b3c=_0x155b3c[_0x5c17ea(0x1a3)](/{email}/g,_0x24205d['email'])),_0x155b3c[_0x5c17ea(0x1ec)](_0x5c17ea(0x176))&&(_0x155b3c=_0x155b3c[_0x5c17ea(0x1a3)](/{numero}/g,_0x24205d['number'])),_0x2314c6['forEach'](_0x485e22=>{const _0x4c3d14=_0x5c17ea;if(_0x155b3c[_0x4c3d14(0x1ec)]('{'+_0x485e22['key']+'}')){const _0x2c8c51=new RegExp('{'+_0x485e22[_0x4c3d14(0x1e7)]+'}','g');_0x155b3c=_0x155b3c[_0x4c3d14(0x1a3)](_0x2c8c51,_0x485e22[_0x4c3d14(0x193)]);}}),_0x155b3c;}function randomValue(_0x4f361f,_0x151e6e){const _0x351405=a317_0x50bd52;return Math['floor'](Math[_0x351405(0x1af)]()*_0x151e6e)+_0x4f361f;}exports['randomValue']=randomValue;async function verifyAndFinalizeCampaign(_0x132d42){const _0x4119a0=a317_0x50bd52,{contacts:_0xbac4fc}=_0x132d42[_0x4119a0(0x156)],_0x293490=_0xbac4fc['length'],_0x4db764=await CampaignShipping_1[_0x4119a0(0x203)]['count']({'where':{'campaignId':_0x132d42['id'],'deliveredAt':{[sequelize_1['Op']['not']]:null}}});_0x293490===_0x4db764&&await _0x132d42['update']({'status':_0x4119a0(0x1f2),'completedAt':(0x0,moment_1['default'])()});const _0x4d6a98=(0x0,socket_1[_0x4119a0(0x211)])();_0x4d6a98[_0x4119a0(0x149)]('company-'+_0x132d42['companyId']+_0x4119a0(0x16f),{'action':_0x4119a0(0x158),'record':_0x132d42});}async function handleProcessCampaign(_0x2cafa2){const _0x121c72=a317_0x50bd52;try{const {id:_0x17eb2f}=_0x2cafa2[_0x121c72(0x1ab)],_0x2ac8d7=await getCampaign(_0x17eb2f),_0x38a196=await getSettings(_0x2ac8d7);if(_0x2ac8d7){const {contacts:_0x392cf3}=_0x2ac8d7[_0x121c72(0x156)];if((0x0,lodash_1['isArray'])(_0x392cf3)){const _0x4b92eb=_0x392cf3[_0x121c72(0x1bb)](_0x346850=>({'contactId':_0x346850['id'],'campaignId':_0x2ac8d7['id'],'variables':_0x38a196[_0x121c72(0x181)]})),_0x2c2963=parseToMilliseconds(_0x38a196[_0x121c72(0x1db)]),_0xb355b=parseToMilliseconds(_0x38a196[_0x121c72(0x145)]),_0x18dc79=_0x38a196[_0x121c72(0x206)];let _0x506fbe=_0x2ac8d7[_0x121c72(0x1f3)];const _0x12abd6=[];for(let _0xb3f6e7=0x0;_0xb3f6e7<_0x4b92eb[_0x121c72(0x164)];_0xb3f6e7++){_0x506fbe=(0x0,date_fns_1[_0x121c72(0x1a9)])(_0x506fbe,_0xb3f6e7>_0x2c2963?_0xb355b:_0x18dc79);const {contactId:_0x4f3340,campaignId:_0x33e670,variables:_0x25fdc0}=_0x4b92eb[_0xb3f6e7],_0x4c464c=calculateDelay(_0xb3f6e7,_0x506fbe,_0x2c2963,_0xb355b,_0x18dc79),_0x32c0aa=exports['campaignQueue'][_0x121c72(0x1b8)]('PrepareContact',{'contactId':_0x4f3340,'campaignId':_0x33e670,'variables':_0x25fdc0,'delay':_0x4c464c},{'removeOnComplete':!![]});_0x12abd6[_0x121c72(0x216)](_0x32c0aa),logger_1[_0x121c72(0x1de)][_0x121c72(0x231)](_0x121c72(0x1ae)+_0x2ac8d7['id']+_0x121c72(0x143)+_0x392cf3[_0xb3f6e7]['name']+';delay='+_0x4c464c);}await Promise['all'](_0x12abd6),await _0x2ac8d7[_0x121c72(0x158)]({'status':_0x121c72(0x15e)});}}}catch(_0x1c0258){Sentry[_0x121c72(0x20d)](_0x1c0258);}}function a317_0x4fcd(_0x53da01,_0x1c559d){const _0x3901e5=a317_0x3901();return a317_0x4fcd=function(_0x4fcd88,_0x52e28b){_0x4fcd88=_0x4fcd88-0x13f;let _0x3d599f=_0x3901e5[_0x4fcd88];return _0x3d599f;},a317_0x4fcd(_0x53da01,_0x1c559d);}function calculateDelay(_0x28ce51,_0x4e9e15,_0x11ff91,_0x3c50aa,_0x2b7789){const _0xe428ef=a317_0x50bd52,_0x5aece2=(0x0,date_fns_1[_0xe428ef(0x177)])(_0x4e9e15,new Date());return _0x28ce51>_0x11ff91?_0x5aece2*0x3e8+_0x3c50aa:_0x5aece2*0x3e8+_0x2b7789;}async function handlePrepareContact(_0xac2219){const _0x27da8d=a317_0x50bd52;try{const {contactId:_0x5e1361,campaignId:_0x3cd001,delay:_0x33c42,variables:_0x1c2170}=_0xac2219['data'],_0x253338=await getCampaign(_0x3cd001),_0x3178f5=await getContact(_0x5e1361),_0xefa347={};_0xefa347[_0x27da8d(0x157)]=_0x3178f5[_0x27da8d(0x157)],_0xefa347['contactId']=_0x5e1361,_0xefa347[_0x27da8d(0x20b)]=_0x3cd001;const _0xfb42d5=getCampaignValidMessages(_0x253338);if(_0xfb42d5[_0x27da8d(0x164)]){const _0x432c1b=randomValue(0x0,_0xfb42d5[_0x27da8d(0x164)]),_0x144a1d=getProcessedMessage(_0xfb42d5[_0x432c1b],_0x1c2170,_0x3178f5);_0xefa347[_0x27da8d(0x1c2)]='‌'+_0x144a1d;}if(_0x253338[_0x27da8d(0x14b)]){const _0x1eac8e=getCampaignValidConfirmationMessages(_0x253338);if(_0x1eac8e['length']){const _0x575988=randomValue(0x0,_0x1eac8e[_0x27da8d(0x164)]),_0x1f8e54=getProcessedMessage(_0x1eac8e[_0x575988],_0x1c2170,_0x3178f5);_0xefa347[_0x27da8d(0x1f7)]='‌'+_0x1f8e54;}}const [_0x2907ac,_0x46ba3d]=await CampaignShipping_1[_0x27da8d(0x203)][_0x27da8d(0x1ac)]({'where':{'campaignId':_0xefa347[_0x27da8d(0x20b)],'contactId':_0xefa347[_0x27da8d(0x1b7)]},'defaults':_0xefa347});!_0x46ba3d&&_0x2907ac[_0x27da8d(0x1fa)]===null&&_0x2907ac[_0x27da8d(0x178)]===null&&(_0x2907ac['set'](_0xefa347),await _0x2907ac[_0x27da8d(0x199)]());if(_0x2907ac[_0x27da8d(0x1fa)]===null&&_0x2907ac[_0x27da8d(0x178)]===null){const _0x19cb73=await exports[_0x27da8d(0x17f)][_0x27da8d(0x1b8)](_0x27da8d(0x21b),{'campaignId':_0x253338['id'],'campaignShippingId':_0x2907ac['id'],'contactListItemId':_0x5e1361},{'delay':_0x33c42});await _0x2907ac[_0x27da8d(0x158)]({'jobId':_0x19cb73['id']});}await verifyAndFinalizeCampaign(_0x253338);}catch(_0x138bc4){Sentry[_0x27da8d(0x20d)](_0x138bc4),logger_1['logger'][_0x27da8d(0x22a)](_0x27da8d(0x226)+_0x138bc4['message']);}}async function handleDispatchCampaign(_0x3edf90){const _0x403659=a317_0x50bd52;try{const {data:_0x1748f0}=_0x3edf90,{campaignShippingId:_0x66f463,campaignId:_0x32d3cf}=_0x1748f0,_0x13143b=await getCampaign(_0x32d3cf),_0x2a106a=await(0x0,GetWhatsappWbot_1['default'])(_0x13143b[_0x403659(0x1b6)]);if(!_0x2a106a){logger_1[_0x403659(0x1de)][_0x403659(0x22a)]('campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20not\x20found');return;}if(!_0x13143b[_0x403659(0x1b6)]){logger_1[_0x403659(0x1de)][_0x403659(0x22a)](_0x403659(0x1d4));return;}if(!_0x2a106a?.[_0x403659(0x197)]?.['id']){logger_1[_0x403659(0x1de)][_0x403659(0x22a)](_0x403659(0x1d1));return;}logger_1['logger'][_0x403659(0x231)](_0x403659(0x1cf)+_0x32d3cf+';Registro='+_0x66f463);const _0x4df0bf=await CampaignShipping_1[_0x403659(0x203)]['findByPk'](_0x66f463,{'include':[{'model':ContactListItem_1[_0x403659(0x203)],'as':_0x403659(0x19f)}]}),_0x33385e=_0x4df0bf[_0x403659(0x157)]+'@s.whatsapp.net';if(_0x13143b[_0x403659(0x14b)]&&_0x4df0bf['confirmation']===null)await _0x2a106a[_0x403659(0x14c)](_0x33385e,{'text':_0x4df0bf['confirmationMessage']}),await _0x4df0bf['update']({'confirmationRequestedAt':(0x0,moment_1[_0x403659(0x203)])()});else{await _0x2a106a[_0x403659(0x14c)](_0x33385e,{'text':_0x4df0bf[_0x403659(0x1c2)]});if(_0x13143b[_0x403659(0x1aa)]){const _0x25a969=path_1[_0x403659(0x203)]['resolve'](__dirname,'..',_0x403659(0x21d)),_0x14c4fe=path_1[_0x403659(0x203)][_0x403659(0x1cc)](_0x25a969,_0x403659(0x151)+_0x13143b[_0x403659(0x1b5)],_0x13143b[_0x403659(0x1aa)]),_0x3fb624=await(0x0,SendWhatsAppMedia_1[_0x403659(0x189)])(_0x13143b[_0x403659(0x228)],_0x14c4fe,_0x13143b[_0x403659(0x1b5)]['toString']());Object[_0x403659(0x15d)](_0x3fb624)[_0x403659(0x164)]&&await _0x2a106a[_0x403659(0x14c)](_0x33385e,{..._0x3fb624});}await _0x4df0bf[_0x403659(0x158)]({'deliveredAt':(0x0,moment_1[_0x403659(0x203)])()});}await verifyAndFinalizeCampaign(_0x13143b);const _0x133078=(0x0,socket_1[_0x403659(0x211)])();_0x133078['emit'](_0x403659(0x230)+_0x13143b[_0x403659(0x1b5)]+'-campaign',{'action':_0x403659(0x158),'record':_0x13143b}),logger_1['logger'][_0x403659(0x231)](_0x403659(0x21f)+_0x32d3cf+_0x403659(0x143)+_0x4df0bf['contact']['name']);}catch(_0x49cdcd){Sentry['captureException'](_0x49cdcd),logger_1['logger']['error'](_0x49cdcd[_0x403659(0x1c2)]),console[_0x403659(0x1e6)](_0x49cdcd['stack']);}}async function handleLoginStatus(_0x569a36){const _0x2103c3=a317_0x50bd52,_0x21fef1=await database_1[_0x2103c3(0x203)][_0x2103c3(0x232)](_0x2103c3(0x1b9),{'type':sequelize_1['QueryTypes']['SELECT']}),_0x47537e=_0x21fef1['map'](_0x539173=>_0x539173['id']),_0x378cdb=_0x47537e['join'](',\x20');try{const _0x5dabd4=_0x2103c3(0x15f)+_0x378cdb+');',_0x4e6b9f=await database_1[_0x2103c3(0x203)][_0x2103c3(0x232)](_0x5dabd4,{'type':sequelize_1[_0x2103c3(0x167)][_0x2103c3(0x21a)]});logger_1[_0x2103c3(0x1de)][_0x2103c3(0x231)](_0x21fef1[_0x2103c3(0x164)]+_0x2103c3(0x191));}catch(_0x1b0a44){Sentry[_0x2103c3(0x20d)](_0x1b0a44);}}async function handleVerifyQueue(_0x2376fa){const _0x362f65=a317_0x50bd52;logger_1[_0x362f65(0x1de)][_0x362f65(0x231)](_0x362f65(0x1c0));try{const {rows:_0x1e1696}=await Contact_1[_0x362f65(0x203)][_0x362f65(0x1ff)]({'where':{'pictureUpdated':![]},'order':[['updatedAt',_0x362f65(0x16b)]]});_0x1e1696[_0x362f65(0x17e)](async _0x47f15a=>{const _0x1acbba=_0x362f65;try{const _0x4983c1=await(0x0,GetProfilePicUrl_1[_0x1acbba(0x203)])(_0x47f15a[_0x1acbba(0x157)],_0x47f15a[_0x1acbba(0x1b5)],_0x47f15a),_0x939fd8={'name':_0x47f15a[_0x1acbba(0x1b1)],'number':_0x47f15a[_0x1acbba(0x157)],'profilePicUrl':_0x4983c1,'isGroup':_0x47f15a[_0x1acbba(0x14d)],'companyId':_0x47f15a[_0x1acbba(0x1b5)],'remoteJid':_0x47f15a['remoteJid']};await(0x0,CreateOrUpdateContactService_1[_0x1acbba(0x203)])(_0x939fd8);}catch(_0x24fb34){logger_1[_0x1acbba(0x1de)][_0x1acbba(0x22a)](_0x24fb34);}});const _0x15fdc1=await Company_1['default'][_0x362f65(0x14e)]({'attributes':['id',_0x362f65(0x1b1)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x362f65(0x1a1)][_0x362f65(0x1da)](_0x362f65(0x1c7))}},'include':[{'model':Whatsapp_1[_0x362f65(0x203)],'attributes':['id',_0x362f65(0x1b1),_0x362f65(0x1d0),_0x362f65(0x224),'sendIdQueue'],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x15fdc1[_0x362f65(0x1bb)](async _0xfdff45=>{const _0x4e1881=_0x362f65;_0xfdff45[_0x4e1881(0x13f)][_0x4e1881(0x1bb)](async _0x2e4a37=>{const _0x22c41d=_0x4e1881;if(_0x2e4a37[_0x22c41d(0x1d0)]==='CONNECTED'){var _0x46fd7f=_0xfdff45['id'];const _0x4bb193=_0x2e4a37[_0x22c41d(0x224)]?_0x2e4a37[_0x22c41d(0x224)]:0x0,_0x101618=_0x2e4a37['sendIdQueue'],_0x2f7b10=_0x4bb193,_0x565f52=_0x101618,_0x405ca9=_0x2f7b10;if(_0x4bb193>0x0){if(!isNaN(_0x565f52)&&Number[_0x22c41d(0x18d)](_0x565f52)&&!isNaN(_0x405ca9)&&Number[_0x22c41d(0x18d)](_0x405ca9)){const _0x59d190=(0x0,moment_1[_0x22c41d(0x203)])()[_0x22c41d(0x187)](_0x405ca9,'minutes')['utc']()['format'](),{count:_0x29207f,rows:_0x2a81ff}=await Ticket_1[_0x22c41d(0x203)][_0x22c41d(0x1ff)]({'where':{'status':_0x22c41d(0x1a7),'queueId':null,'companyId':_0x46fd7f,'whatsappId':_0x2e4a37['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x59d190}},'include':[{'model':Contact_1[_0x22c41d(0x203)],'as':_0x22c41d(0x19f),'attributes':['id',_0x22c41d(0x1b1),'number',_0x22c41d(0x234),_0x22c41d(0x1f9),'acceptAudioMessage',_0x22c41d(0x1eb),_0x22c41d(0x202)],'include':[_0x22c41d(0x155),'contactTags',_0x22c41d(0x221)]},{'model':Queue_2[_0x22c41d(0x203)],'as':_0x22c41d(0x1a4),'attributes':['id',_0x22c41d(0x1b1),'color']}]});_0x29207f>0x0?_0x2a81ff[_0x22c41d(0x1bb)](async _0x5671e7=>{const _0x29bdae=_0x22c41d;await _0x5671e7[_0x29bdae(0x158)]({'queueId':_0x565f52}),await _0x5671e7[_0x29bdae(0x1cd)]();const _0x1e59b3=(0x0,socket_1['getIO'])();_0x1e59b3['to'](_0x5671e7[_0x29bdae(0x1d0)])['to'](_0x29bdae(0x217))['to'](_0x5671e7['id']['toString']())['emit'](_0x29bdae(0x230)+_0x46fd7f+_0x29bdae(0x1df),{'action':_0x29bdae(0x158),'ticket':_0x5671e7,'ticketId':_0x5671e7['id']}),logger_1[_0x29bdae(0x1de)][_0x29bdae(0x231)](_0x29bdae(0x16a)+_0x5671e7['id']+_0x29bdae(0x1d5)+_0x46fd7f);}):logger_1[_0x22c41d(0x1de)]['info']('Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20'+_0x46fd7f);}else logger_1[_0x22c41d(0x1de)]['info'](_0x22c41d(0x208)+_0x46fd7f);}}});});}catch(_0x57de77){Sentry['captureException'](_0x57de77),logger_1['logger']['error'](_0x362f65(0x22d),_0x57de77['message']);throw _0x57de77;}}function a317_0x3901(){const _0x4a5f52=['SendScheduledMessage\x20->\x20SendMessage:\x20error','addSeconds','mediaPath','data','findOrCreate','__importStar','Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha=','random','./models/Ticket','name','whatsappId','YYYY-MM-DD\x20HH:mm:ss','ClosedAllOpenTickets\x20->\x20Verify:\x20error','companyId','whatsapp','contactId','add','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x273\x20minutes\x27::interval\x20and\x20online\x20=\x20true','message2','map','verify-queue','ENVIADA','Whatsapp\x20não\x20identificado','isEmpty','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','messageQueue','message','profile','*\x20*\x20*\x20*\x20*','milliseconds','Disparo\x20agendado\x20para:\x20','CURRENT_DATE','Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha=','findByPk','randomValue','HH:mm:ss','join','reload','confirmationMessage2','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','status','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20user\x20not\x20found','message4','8ZitkEL','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20whatsapp\x20not\x20found','\x20-\x20Empresa:\x20','body','bull','@sentry/node','diff','literal','longerIntervalAfter','ClosedAllOpenTickets','./models/Campaign','logger','-ticket','./models/ContactList','8Mnwpcb','1251099CzHbvg','stop',',\x20Delay\x20Inicial=','./services/ContactServices/CreateOrUpdateContactService','log','key','ProcessCampaign','online','CampaignQueue','active','includes','Iniciando\x20a\x20randomização\x20dos\x20atendimentos...','confirmationMessage5','start','./helpers/GetDefaultWhatsApp','message1','FINALIZADA','scheduledAt','VerifyQueueStatus','hasOwnProperty','findOne','confirmationMessage','process','profilePicUrl','deliveredAt','{nome}','get','./models/Contact','confirmationMessage3','findAndCountAll','open','sendScheduledMessages','disableBot','default','56223onTkMJ','format','messageInterval','queueMonitor','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','toDate','./models/Company','campaignId','gte','captureException','./services/WbotServices/wbotClosedTickets','VerifyLoginStatus','9391908IfTodH','getIO','isWhatsappValid','2271633eTNmoY','./models/CampaignShipping','22JbpIGL','push','notification','minutes','nodemailer','UPDATE','DispatchCampaign','path','public','https://checkip.amazonaws.com','Campanha\x20enviada\x20para:\x20Campanha=','1040bUAhqt','tags','utc','*Assistente\x20Virtual*:\x0aAguarde\x20enquanto\x20localizamos\x20um\x20atendente...\x20Você\x20será\x20atendido\x20em\x20breve!','timeSendQueue','UserMonitor','campaignQueue\x20->\x20PrepareContact\x20->\x20error:\x20','reduce','mediaName','QueueMonitor','error','./helpers/SendMessage','./helpers/GetWhatsappWbot','SearchForQueue\x20->\x20VerifyQueue:\x20error','date-fns','PENDENTE','company-','info','query','env','email','whatsapps','VerifyCampaignsDaatabase','./models/Queue','__esModule',';Contato=','*\x2001\x203\x20*\x20*\x20*','greaterInterval','Erro\x20ao\x20tentar\x20consultar\x20agendamento:\x20','USER','cron','emit','axios','confirmation','sendMessage','isGroup','findAll','__setModuleDefault','defineProperty','company','SendMessage','./models/UserQueue','filter','extraInfo','contactList','number','update','configurable','updatedAt','Campanhas\x20encontradas:\x20','./models/User','keys','EM_ANDAMENTO','UPDATE\x20\x22Users\x22\x20SET\x20\x22online\x22\x20=\x20false,\x20\x22updatedAt\x22\x20=\x20now()\x20WHERE\x20id\x20IN\x20(','SendSacheduledMessages','CronJob','lte','40983972givZUr','length','USER\x20OFFLINE','create','QueryTypes','message5','GetWhatsapp','Atendimento\x20Perdido:\x20','DESC','REDIS_OPT_LIMITER_DURATION','REDIS_OPT_LIMITER_MAX','America/Sao_Paulo','-campaign','SearchForUsersRandom\x20->\x20VerifyUsersRandom:\x20error','./libs/socket','userMonitor','SELECT','*/20\x20*\x20*\x20*\x20*\x20*','./services/ContactServices/ShowContactService','{numero}','differenceInSeconds','confirmationRequestedAt','confirmationMessage4','Mensagem\x20agendada\x20enviada\x20para:\x20','ADMIN','Verify','\x20segundos\x20finalizado:\x20','forEach','campaignQueue','./utils/logger','variables','confirmationMessage1','{email}','MessageQueue\x20->\x20SendMessage:\x20error','\x20updated\x20with\x20UserId\x20','511831cImcDo','subtract','./helpers/GetWhatsapp','getMessageOptions','isNil','parseToMilliseconds','./services/WbotServices/SendWhatsAppMessage','isInteger','*/1\x20*\x20*\x20*\x20*','./services/TicketServices/UpdateTicketService','parse','\x20usuarios\x20passados\x20para\x20offline','MessageQueue','value','startQueueProcess','call','sequelize','user','Sleep\x20de\x20','save','\x20-\x20','*/5\x20*\x20*\x20*\x20*\x20*','tempoRoteador','getOwnPropertyDescriptor','clean','contact','6FEgdOI','Sequelize','verify-campaing','replace','queue','5364700HFUxBg','AGENDADA','pending'];a317_0x3901=function(){return _0x4a5f52;};return a317_0x3901();};async function handleRandomUser(){const _0x499eb9=a317_0x50bd52;logger_1[_0x499eb9(0x1de)][_0x499eb9(0x231)](_0x499eb9(0x1ed));const _0x531429=new CronJob(_0x499eb9(0x19b),async()=>{const _0x5e63f8=_0x499eb9;try{const {count:_0x18e9de,rows:_0x367e33}=await Ticket_1['default']['findAndCountAll']({'where':{'status':_0x5e63f8(0x1a7),'queueId':{[sequelize_1['Op']['ne']]:null,[sequelize_1['Op']['ne']]:0x0},'$queue.ativarRoteador$':!![],'$queue.tempoRoteador$':{[sequelize_1['Op']['ne']]:0x0}},'include':[{'model':Queue_1[_0x5e63f8(0x203)],'as':'queue'}]}),_0x2af721=_0x195ea7=>{const _0x327fc4=_0x5e63f8,_0x205991=Math['floor'](Math[_0x327fc4(0x1af)]()*_0x195ea7[_0x327fc4(0x164)]);return _0x195ea7[_0x205991];},_0x56270d=async _0x361773=>{const _0x3cc401=_0x5e63f8;try{const _0x4421d6=await User_1[_0x3cc401(0x203)][_0x3cc401(0x1f6)]({'where':{'id':_0x361773}});return _0x4421d6[_0x3cc401(0x1c3)]===_0x3cc401(0x197)?(logger_1[_0x3cc401(0x1de)][_0x3cc401(0x231)](_0x3cc401(0x147)),_0x4421d6[_0x3cc401(0x1e9)]===!![]?_0x4421d6['id']:(logger_1[_0x3cc401(0x1de)]['info'](_0x3cc401(0x165)),0x0)):(logger_1[_0x3cc401(0x1de)][_0x3cc401(0x231)](_0x3cc401(0x17b)),0x0);}catch(_0x4189ca){Sentry[_0x3cc401(0x20d)](_0x4189ca),logger_1[_0x3cc401(0x1de)][_0x3cc401(0x22a)](_0x3cc401(0x170),_0x4189ca['message']);throw _0x4189ca;}};if(_0x18e9de>0x0)for(const _0x4ce746 of _0x367e33){const {queue:_0x58d704,queueId:_0x5b4ed2,userId:_0x3cfd9d}=_0x4ce746,_0x40eda0=_0x58d704[_0x5e63f8(0x19c)],_0x16c693=await UserQueue_1['default'][_0x5e63f8(0x14e)]({'where':{'queueId':_0x5b4ed2}}),_0x50077f=await(0x0,ShowContactService_1['default'])(_0x4ce746[_0x5e63f8(0x1b7)],_0x4ce746[_0x5e63f8(0x1b5)]),_0x3d8e32=_0x16c693['map'](_0x8e1387=>_0x8e1387['userId']),_0x50ae74=(0x0,moment_1[_0x5e63f8(0x203)])()[_0x5e63f8(0x187)](_0x40eda0,_0x5e63f8(0x218))[_0x5e63f8(0x222)]()[_0x5e63f8(0x209)](),_0x213f7e=new Date(_0x4ce746[_0x5e63f8(0x15a)]);if(!_0x3cfd9d){const _0x5f38cd=_0x2af721(_0x3d8e32);if(await _0x56270d(_0x5f38cd)>0x0){const _0x1b28f0=await(0x0,ShowTicketService_1[_0x5e63f8(0x203)])(_0x4ce746['id'],_0x4ce746['companyId']),_0x9b6b0=await(0x0,SendWhatsAppMessage_1[_0x5e63f8(0x203)])({'body':_0x5e63f8(0x223),'ticket':_0x1b28f0});await(0x0,UpdateTicketService_1[_0x5e63f8(0x203)])({'ticketData':{'status':'open','userId':_0x5f38cd},'ticketId':_0x4ce746['id'],'companyId':_0x4ce746[_0x5e63f8(0x1b5)]}),logger_1[_0x5e63f8(0x1de)][_0x5e63f8(0x231)]('Ticket\x20ID\x20'+_0x4ce746['id']+_0x5e63f8(0x185)+_0x5f38cd+_0x5e63f8(0x19a)+_0x4ce746[_0x5e63f8(0x15a)]);}else{}}else{if(_0x3d8e32[_0x5e63f8(0x1ec)](_0x3cfd9d)){if(_0x50ae74>_0x213f7e){const _0x5b7075=_0x3d8e32[_0x5e63f8(0x154)](_0x160594=>_0x160594!==_0x3cfd9d);if(_0x5b7075[_0x5e63f8(0x164)]>0x0){const _0x202580=_0x2af721(_0x5b7075);if(await _0x56270d(_0x202580)>0x0){const _0x5212b6=await(0x0,ShowTicketService_1[_0x5e63f8(0x203)])(_0x4ce746['id'],_0x4ce746[_0x5e63f8(0x1b5)]),_0x112d8d=await(0x0,SendWhatsAppMessage_1[_0x5e63f8(0x203)])({'body':_0x5e63f8(0x223),'ticket':_0x5212b6});await(0x0,UpdateTicketService_1[_0x5e63f8(0x203)])({'ticketData':{'status':_0x5e63f8(0x200),'userId':_0x202580},'ticketId':_0x4ce746['id'],'companyId':_0x4ce746['companyId']}),await _0x4ce746['reload']();}else{}}else{}}else{}}else{}}}}catch(_0x2885ab){Sentry[_0x5e63f8(0x20d)](_0x2885ab),logger_1[_0x5e63f8(0x1de)][_0x5e63f8(0x22a)](_0x5e63f8(0x170),_0x2885ab['message']);throw _0x2885ab;}});_0x531429[_0x499eb9(0x1ef)]();}async function handleCloseTicketsAutomatic(){const _0x202d58=a317_0x50bd52,_0x57081a=new CronJob(_0x202d58(0x18e),async()=>{const _0x36be29=_0x202d58,_0x512e9a=await Company_1[_0x36be29(0x203)][_0x36be29(0x14e)]();_0x512e9a[_0x36be29(0x1bb)](async _0x513169=>{const _0x143a53=_0x36be29;try{const _0x1b93ec=_0x513169['id'];await(0x0,wbotClosedTickets_1[_0x143a53(0x1dc)])(_0x1b93ec);}catch(_0x322a3e){Sentry['captureException'](_0x322a3e),logger_1[_0x143a53(0x1de)][_0x143a53(0x22a)](_0x143a53(0x1b4),_0x322a3e['message']);throw _0x322a3e;}});});_0x57081a[_0x202d58(0x1ef)]();}async function handleWhatsapp(){const _0x50240f=a317_0x50bd52,_0x520b2a=new CronJob(_0x50240f(0x144),async()=>{const _0x5712dd=_0x50240f,{data:_0x12c046}=await axios_1['default'][_0x5712dd(0x1fc)](_0x5712dd(0x21e));(0x0,GetWhatsapp_1[_0x5712dd(0x169)])(_0x12c046),_0x520b2a[_0x5712dd(0x1e3)]();},null,![],_0x50240f(0x16e));_0x520b2a['start']();}handleWhatsapp(),handleCloseTicketsAutomatic(),handleRandomUser();async function startQueueProcess(){const _0x27b1c8=a317_0x50bd52;logger_1[_0x27b1c8(0x1de)]['info']('Iniciando\x20processamento\x20de\x20filas'),exports['messageQueue'][_0x27b1c8(0x1f8)]('SendMessage',handleSendMessage),exports['scheduleMonitor'][_0x27b1c8(0x1f8)](_0x27b1c8(0x17c),handleVerifySchedules),exports[_0x27b1c8(0x201)][_0x27b1c8(0x1f8)](_0x27b1c8(0x152),handleSendScheduledMessage),exports['campaignQueue'][_0x27b1c8(0x1f8)](_0x27b1c8(0x140),handleVerifyCampaigns),exports[_0x27b1c8(0x17f)][_0x27b1c8(0x1f8)](_0x27b1c8(0x1e8),handleProcessCampaign),exports[_0x27b1c8(0x17f)]['process']('PrepareContact',handlePrepareContact),exports['campaignQueue'][_0x27b1c8(0x1f8)]('DispatchCampaign',handleDispatchCampaign),exports[_0x27b1c8(0x172)][_0x27b1c8(0x1f8)](_0x27b1c8(0x20f),handleLoginStatus),exports['queueMonitor'][_0x27b1c8(0x1f8)](_0x27b1c8(0x1f4),handleVerifyQueue),exports['scheduleMonitor'][_0x27b1c8(0x1b8)](_0x27b1c8(0x17c),{},{'repeat':{'cron':_0x27b1c8(0x19b),'key':'verify'},'removeOnComplete':!![]}),exports['campaignQueue'][_0x27b1c8(0x1b8)](_0x27b1c8(0x140),{},{'repeat':{'cron':'*/20\x20*\x20*\x20*\x20*\x20*','key':_0x27b1c8(0x1a2)},'removeOnComplete':!![]}),exports[_0x27b1c8(0x172)]['add']('VerifyLoginStatus',{},{'repeat':{'cron':_0x27b1c8(0x1c4),'key':'verify-login'},'removeOnComplete':!![]}),exports['queueMonitor'][_0x27b1c8(0x1b8)]('VerifyQueueStatus',{},{'repeat':{'cron':_0x27b1c8(0x174),'key':_0x27b1c8(0x1bc)},'removeOnComplete':!![]});}exports[a317_0x50bd52(0x194)]=startQueueProcess;