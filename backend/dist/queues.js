'use strict';const a306_0x16ce4f=a306_0x28aa;(function(_0x53b6fc,_0x2a6fab){const _0x186dbe=a306_0x28aa,_0x58cc5f=_0x53b6fc();while(!![]){try{const _0x636b25=-parseInt(_0x186dbe(0x23d))/0x1*(parseInt(_0x186dbe(0x1d3))/0x2)+-parseInt(_0x186dbe(0x243))/0x3+parseInt(_0x186dbe(0x1a3))/0x4+parseInt(_0x186dbe(0x24f))/0x5*(-parseInt(_0x186dbe(0x21b))/0x6)+-parseInt(_0x186dbe(0x214))/0x7+-parseInt(_0x186dbe(0x1ea))/0x8+parseInt(_0x186dbe(0x1b5))/0x9;if(_0x636b25===_0x2a6fab)break;else _0x58cc5f['push'](_0x58cc5f['shift']());}catch(_0xe8ca2d){_0x58cc5f['push'](_0x58cc5f['shift']());}}}(a306_0x2e0b,0x540c3));var __createBinding=this&&this[a306_0x16ce4f(0x1a7)]||(Object['create']?function(_0x7804d7,_0x8e00db,_0x423adf,_0x3c0a74){const _0x3cab33=a306_0x16ce4f;if(_0x3c0a74===undefined)_0x3c0a74=_0x423adf;var _0x108116=Object[_0x3cab33(0x241)](_0x8e00db,_0x423adf);(!_0x108116||(_0x3cab33(0x1e4)in _0x108116?!_0x8e00db[_0x3cab33(0x190)]:_0x108116[_0x3cab33(0x1ee)]||_0x108116[_0x3cab33(0x24a)]))&&(_0x108116={'enumerable':!![],'get':function(){return _0x8e00db[_0x423adf];}}),Object[_0x3cab33(0x172)](_0x7804d7,_0x3c0a74,_0x108116);}:function(_0x34c613,_0x1ab8b1,_0x29bf55,_0x38d701){if(_0x38d701===undefined)_0x38d701=_0x29bf55;_0x34c613[_0x38d701]=_0x1ab8b1[_0x29bf55];}),__setModuleDefault=this&&this[a306_0x16ce4f(0x25c)]||(Object['create']?function(_0x2873a3,_0x298853){const _0x125270=a306_0x16ce4f;Object[_0x125270(0x172)](_0x2873a3,_0x125270(0x1e7),{'enumerable':!![],'value':_0x298853});}:function(_0x22f195,_0x40677c){const _0x42a5f7=a306_0x16ce4f;_0x22f195[_0x42a5f7(0x1e7)]=_0x40677c;}),__importStar=this&&this['__importStar']||function(_0xa2d0aa){const _0x1f4c9c=a306_0x16ce4f;if(_0xa2d0aa&&_0xa2d0aa['__esModule'])return _0xa2d0aa;var _0x186c0d={};if(_0xa2d0aa!=null){for(var _0x347c15 in _0xa2d0aa)if(_0x347c15!=='default'&&Object[_0x1f4c9c(0x20b)][_0x1f4c9c(0x175)][_0x1f4c9c(0x1c2)](_0xa2d0aa,_0x347c15))__createBinding(_0x186c0d,_0xa2d0aa,_0x347c15);}return __setModuleDefault(_0x186c0d,_0xa2d0aa),_0x186c0d;},__importDefault=this&&this[a306_0x16ce4f(0x1e9)]||function(_0x29fdbf){return _0x29fdbf&&_0x29fdbf['__esModule']?_0x29fdbf:{'default':_0x29fdbf};};Object[a306_0x16ce4f(0x172)](exports,a306_0x16ce4f(0x190),{'value':!![]}),exports[a306_0x16ce4f(0x179)]=exports[a306_0x16ce4f(0x18a)]=exports[a306_0x16ce4f(0x223)]=exports[a306_0x16ce4f(0x177)]=exports[a306_0x16ce4f(0x209)]=exports['campaignQueue']=exports['sendScheduledMessages']=exports[a306_0x16ce4f(0x1a8)]=exports[a306_0x16ce4f(0x1aa)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),bull_1=__importDefault(require('bull')),SendMessage_1=require(a306_0x16ce4f(0x1e0)),Whatsapp_1=__importDefault(require(a306_0x16ce4f(0x259))),logger_1=require('./utils/logger'),moment_1=__importDefault(require(a306_0x16ce4f(0x1e1))),Schedule_1=__importDefault(require(a306_0x16ce4f(0x200))),sequelize_1=require(a306_0x16ce4f(0x1e6)),GetDefaultWhatsApp_1=__importDefault(require(a306_0x16ce4f(0x201))),Campaign_1=__importDefault(require(a306_0x16ce4f(0x1e8))),Queue_1=__importDefault(require(a306_0x16ce4f(0x219))),ContactList_1=__importDefault(require(a306_0x16ce4f(0x213))),ContactListItem_1=__importDefault(require(a306_0x16ce4f(0x17f))),lodash_1=require(a306_0x16ce4f(0x19a)),CampaignSetting_1=__importDefault(require(a306_0x16ce4f(0x1a6))),CampaignShipping_1=__importDefault(require(a306_0x16ce4f(0x233))),GetWhatsappWbot_1=__importDefault(require('./helpers/GetWhatsappWbot')),database_1=__importDefault(require(a306_0x16ce4f(0x1df))),SendWhatsAppMedia_1=require(a306_0x16ce4f(0x1b8)),socket_1=require(a306_0x16ce4f(0x1cc)),path_1=__importDefault(require(a306_0x16ce4f(0x1c3))),User_1=__importDefault(require(a306_0x16ce4f(0x224))),Company_1=__importDefault(require(a306_0x16ce4f(0x202))),Contact_1=__importDefault(require('./models/Contact')),Queue_2=__importDefault(require(a306_0x16ce4f(0x219))),wbotClosedTickets_1=require('./services/WbotServices/wbotClosedTickets'),Ticket_1=__importDefault(require(a306_0x16ce4f(0x210))),ShowContactService_1=__importDefault(require(a306_0x16ce4f(0x1ce))),GetProfilePicUrl_1=__importDefault(require(a306_0x16ce4f(0x211))),CreateOrUpdateContactService_1=__importDefault(require('./services/ContactServices/CreateOrUpdateContactService')),UserQueue_1=__importDefault(require(a306_0x16ce4f(0x1c5))),ShowTicketService_1=__importDefault(require(a306_0x16ce4f(0x18d))),SendWhatsAppMessage_1=__importDefault(require(a306_0x16ce4f(0x23f))),UpdateTicketService_1=__importDefault(require('./services/TicketServices/UpdateTicketService')),date_fns_1=require(a306_0x16ce4f(0x1fe)),nodemailer=require(a306_0x16ce4f(0x174)),CronJob=require(a306_0x16ce4f(0x252))[a306_0x16ce4f(0x208)],connection=process[a306_0x16ce4f(0x1b1)]['REDIS_URI']||'',limiterMax=process[a306_0x16ce4f(0x1b1)][a306_0x16ce4f(0x1bc)]||0x1,limiterDuration=process[a306_0x16ce4f(0x1b1)]['REDIS_OPT_LIMITER_DURATION']||0xbb8;exports[a306_0x16ce4f(0x1aa)]=new bull_1['default'](a306_0x16ce4f(0x23b),connection),exports['scheduleMonitor']=new bull_1['default'](a306_0x16ce4f(0x1f6),connection),exports['sendScheduledMessages']=new bull_1['default'](a306_0x16ce4f(0x1b4),connection),exports[a306_0x16ce4f(0x1c6)]=new bull_1[(a306_0x16ce4f(0x1e7))](a306_0x16ce4f(0x1b6),connection),exports[a306_0x16ce4f(0x209)]=new bull_1['default'](a306_0x16ce4f(0x22d),connection),exports[a306_0x16ce4f(0x177)]=new bull_1[(a306_0x16ce4f(0x1e7))]('MessageQueue',connection,{'limiter':{'max':limiterMax,'duration':limiterDuration}});async function handleSendMessage(_0x1390e0){const _0x2f6225=a306_0x16ce4f;try{const {data:_0x48a3e4}=_0x1390e0,_0x54452b=await Whatsapp_1[_0x2f6225(0x1e7)][_0x2f6225(0x236)](_0x48a3e4['whatsappId']);if(_0x54452b===null)throw Error(_0x2f6225(0x1b3));const _0x4d2d30=_0x48a3e4[_0x2f6225(0x22e)];await(0x0,SendMessage_1[_0x2f6225(0x1af)])(_0x54452b,_0x4d2d30);}catch(_0x75e3a0){Sentry['captureException'](_0x75e3a0),logger_1[_0x2f6225(0x20e)]['error']('MessageQueue\x20->\x20SendMessage:\x20error',_0x75e3a0[_0x2f6225(0x1a9)]);throw _0x75e3a0;}}async function handleVerifySchedules(_0x144d3b){const _0x3a4064=a306_0x16ce4f;try{const {count:_0x26db70,rows:_0x98d873}=await Schedule_1[_0x3a4064(0x1e7)]['findAndCountAll']({'where':{'status':_0x3a4064(0x203),'sentAt':null,'sendAt':{[sequelize_1['Op'][_0x3a4064(0x1e5)]]:(0x0,moment_1[_0x3a4064(0x1e7)])()['format'](_0x3a4064(0x257)),[sequelize_1['Op']['lte']]:(0x0,moment_1[_0x3a4064(0x1e7)])()[_0x3a4064(0x17d)]('30','seconds')[_0x3a4064(0x1ab)](_0x3a4064(0x257))}},'include':[{'model':Contact_1[_0x3a4064(0x1e7)],'as':_0x3a4064(0x1f1)}]});_0x26db70>0x0&&_0x98d873[_0x3a4064(0x1ba)](async _0x4af7af=>{const _0x48695c=_0x3a4064;await _0x4af7af[_0x48695c(0x192)]({'status':_0x48695c(0x183)}),exports['sendScheduledMessages']['add'](_0x48695c(0x1af),{'schedule':_0x4af7af},{'delay':0x9c40}),logger_1[_0x48695c(0x20e)][_0x48695c(0x20f)](_0x48695c(0x1e2)+_0x4af7af['contact'][_0x48695c(0x23a)]);});}catch(_0x46ac49){Sentry[_0x3a4064(0x21d)](_0x46ac49),logger_1['logger'][_0x3a4064(0x25d)](_0x3a4064(0x1a4),_0x46ac49[_0x3a4064(0x1a9)]);throw _0x46ac49;}}async function handleSendScheduledMessage(_0x497e34){const _0x2639b6=a306_0x16ce4f,{data:{schedule:_0x5640f1}}=_0x497e34;let _0x59dc2f=null;try{_0x59dc2f=await Schedule_1[_0x2639b6(0x1e7)][_0x2639b6(0x236)](_0x5640f1['id']);}catch(_0x24c19c){Sentry['captureException'](_0x24c19c),logger_1[_0x2639b6(0x20e)][_0x2639b6(0x20f)]('Erro\x20ao\x20tentar\x20consultar\x20agendamento:\x20'+_0x5640f1['id']);}try{const _0x5af196=await(0x0,GetDefaultWhatsApp_1['default'])(_0x5640f1[_0x2639b6(0x1a2)]);await(0x0,SendMessage_1['SendMessage'])(_0x5af196,{'number':_0x5640f1[_0x2639b6(0x1f1)]['number'],'body':_0x5640f1['body']}),await _0x59dc2f?.['update']({'sentAt':(0x0,moment_1[_0x2639b6(0x1e7)])()[_0x2639b6(0x1ab)](_0x2639b6(0x225)),'status':'ENVIADA'}),logger_1[_0x2639b6(0x20e)][_0x2639b6(0x20f)]('Mensagem\x20agendada\x20enviada\x20para:\x20'+_0x5640f1[_0x2639b6(0x1f1)]['name']),exports['sendScheduledMessages']['clean'](0x3a98,_0x2639b6(0x258));}catch(_0x60e7ae){Sentry['captureException'](_0x60e7ae),await _0x59dc2f?.[_0x2639b6(0x192)]({'status':'ERRO'}),logger_1[_0x2639b6(0x20e)][_0x2639b6(0x25d)](_0x2639b6(0x1db),_0x60e7ae[_0x2639b6(0x1a9)]);throw _0x60e7ae;}}function a306_0x2e0b(){const _0x54e627=['PENDENTE','greaterInterval','confirmationMessage','includes','tags','CronJob','queueMonitor','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20not\x20found','prototype','scheduledAt','getMessageOptions','logger','info','./models/Ticket','./services/WbotServices/GetProfilePicUrl','open','./models/ContactList','4732742iJTlwk','findAndCountAll','confirmationMessage5','ClosedAllOpenTickets\x20->\x20Verify:\x20error','Sleep\x20de\x20','./models/Queue','key','6xuJhet','Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha=','captureException','company','milliseconds',';Registro=','confirmationMessage4','\x20segundos\x20finalizado:\x20','parseToMilliseconds','./models/User','YYYY-MM-DD\x20HH:mm','company-','HH:mm:ss','count','not','start','parse','length','QueueMonitor','data','utc','{nome}','timeSendQueue','UPDATE\x20\x22Users\x22\x20SET\x20\x22online\x22\x20=\x20false,\x20\x22updatedAt\x22\x20=\x20now()\x20WHERE\x20id\x20IN\x20(','./models/CampaignShipping','tempoRoteador','verify','findByPk','*/5\x20*\x20*\x20*\x20*\x20*',';delay=','queue','name','UserMonitor','EM_ANDAMENTO','1QCtYxy','*Assistente\x20Virtual*:\x0aAguarde\x20enquanto\x20localizamos\x20um\x20atendente...\x20Você\x20será\x20atendido\x20em\x20breve!','./services/WbotServices/SendWhatsAppMessage','user','getOwnPropertyDescriptor','campaignQueue\x20->\x20PrepareContact\x20->\x20error:\x20','1521381VVzRPn','public','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','isInteger','process','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x273\x20minutes\x27::interval\x20and\x20online\x20=\x20true','email','configurable',';Contato=','PrepareContact','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','message1','3162410jVAPjA','\x20usuarios\x20passados\x20para\x20offline','whatsapps','cron','DESC','online','sendIdQueue','profile','YYYY-MM-DD\x20HH:mm:ss','completed','./models/Whatsapp','VerifyQueueStatus','CURRENT_DATE','__setModuleDefault','error','defineProperty','Campanha\x20enviada\x20para:\x20Campanha=','nodemailer','hasOwnProperty','disableBot','messageQueue','UPDATE','startQueueProcess','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20user\x20not\x20found','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20whatsapp\x20not\x20found','Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha=','add','verify-campaing','./models/ContactListItem','updatedAt','save','color','AGENDADA','minutes','reload','profilePicUrl','isEmpty','push','message3','randomValue','VerifyLoginStatus','stack','./services/TicketServices/ShowTicketService','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','@s.whatsapp.net','__esModule','Sequelize','update','value','deliveredAt','confirmationRequestedAt','ADMIN','findOne','isArray','longerIntervalAfter','lodash','verify-queue','active',',\x20Delay\x20Inicial=','acceptAudioMessage','message2','\x20updated\x20with\x20UserId\x20','SearchForUsersRandom\x20->\x20VerifyUsersRandom:\x20error','companyId','764856RWpsNM','SendScheduledMessage\x20->\x20Verify:\x20error','USER\x20OFFLINE','./models/CampaignSetting','__createBinding','scheduleMonitor','message','userMonitor','format','isNil','messageInterval','toDate','SendMessage','*/20\x20*\x20*\x20*\x20*\x20*','env','FINALIZADA','Whatsapp\x20não\x20identificado','SendSacheduledMessages','23052168sTyxsH','CampaignQueue','confirmationMessage3','./services/WbotServices/SendWhatsAppMedia','query','map','QueryTypes','REDIS_OPT_LIMITER_MAX','Verify','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','forEach','contactList','userId','call','path','campaignId','./models/UserQueue','campaignQueue','Iniciando\x20a\x20randomização\x20dos\x20atendimentos...','pending','Campanhas\x20encontradas:\x20','contacts','message5','./libs/socket','message4','./services/ContactServices/ShowContactService','random','findAll','remoteJid','confirmationMessage2','649810hyHsev','number','-campaign','ClosedAllOpenTickets','-ticket','whatsapp','keys','getIO','SendScheduledMessage\x20->\x20SendMessage:\x20error','emit','filter','notification','./database','./helpers/SendMessage','moment','Disparo\x20agendado\x20para:\x20','*\x20*\x20*\x20*\x20*','get','gte','sequelize','default','./models/Campaign','__importDefault','2141496kHteLY','reduce','contactId','diff','writable','sendMessage','mediaPath','contact','ProcessCampaign','variables','VerifyCampaignsDaatabase','confirmation','ScheduleMonitor','\x20-\x20Empresa:\x20','status','confirmationMessage1','log','join','isWhatsappValid','replace','date-fns','floor','./models/Schedule','./helpers/GetDefaultWhatsApp','./models/Company'];a306_0x2e0b=function(){return _0x54e627;};return a306_0x2e0b();}async function handleVerifyCampaigns(_0x3c4f7d){const _0x1f2972=a306_0x16ce4f,_0xe39549=await database_1['default']['query']('select\x20id,\x20\x22scheduledAt\x22\x20from\x20\x22Campaigns\x22\x20c\x0a\x20\x20\x20\x20where\x20\x22scheduledAt\x22\x20between\x20now()\x20and\x20now()\x20+\x20\x273\x20hour\x27::interval\x20and\x20status\x20=\x20\x27PROGRAMADA\x27',{'type':sequelize_1['QueryTypes']['SELECT']});logger_1[_0x1f2972(0x20e)][_0x1f2972(0x20f)](_0x1f2972(0x1c9)+_0xe39549['length']);for(let _0x3e349f of _0xe39549){try{const _0x4b5a57=(0x0,moment_1[_0x1f2972(0x1e7)])(),_0x3ff853=(0x0,moment_1[_0x1f2972(0x1e7)])(_0x3e349f[_0x1f2972(0x20c)]),_0x12a982=_0x3ff853[_0x1f2972(0x1ed)](_0x4b5a57,_0x1f2972(0x21f));logger_1[_0x1f2972(0x20e)][_0x1f2972(0x20f)](_0x1f2972(0x17c)+_0x3e349f['id']+_0x1f2972(0x19d)+_0x12a982),exports['campaignQueue']['add'](_0x1f2972(0x1f2),{'id':_0x3e349f['id'],'delay':_0x12a982},{'priority':0x3,'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}});}catch(_0xf0a610){Sentry[_0x1f2972(0x21d)](_0xf0a610);}}}async function getCampaign(_0x476265){const _0x57f28c=a306_0x16ce4f;return await Campaign_1[_0x57f28c(0x1e7)][_0x57f28c(0x197)]({'where':{'id':_0x476265},'include':[{'model':ContactList_1[_0x57f28c(0x1e7)],'as':_0x57f28c(0x1c0),'attributes':['id',_0x57f28c(0x23a)],'include':[{'model':ContactListItem_1[_0x57f28c(0x1e7)],'as':_0x57f28c(0x1ca),'attributes':['id','name',_0x57f28c(0x1d4),_0x57f28c(0x249),_0x57f28c(0x1fc)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1['default'],'as':'whatsapp','attributes':['id','name']}]});}function a306_0x28aa(_0x3e6b1d,_0x31d79c){const _0x2e0b71=a306_0x2e0b();return a306_0x28aa=function(_0x28aa62,_0x169aa6){_0x28aa62=_0x28aa62-0x172;let _0x1ba5f1=_0x2e0b71[_0x28aa62];return _0x1ba5f1;},a306_0x28aa(_0x3e6b1d,_0x31d79c);}async function getContact(_0x3c9e17){const _0x3c0794=a306_0x16ce4f;return await ContactListItem_1[_0x3c0794(0x1e7)][_0x3c0794(0x236)](_0x3c9e17,{'attributes':['id','name',_0x3c0794(0x1d4),_0x3c0794(0x249)]});}async function getSettings(_0x484895){const _0x5b7f76=a306_0x16ce4f;try{const _0x20aba5=await CampaignSetting_1[_0x5b7f76(0x1e7)][_0x5b7f76(0x1d0)]({'where':{'companyId':_0x484895[_0x5b7f76(0x1a2)]},'attributes':[_0x5b7f76(0x21a),_0x5b7f76(0x193)]}),_0x78ebb0=_0x20aba5[_0x5b7f76(0x1eb)]((_0x15d74b,_0x1c7372)=>{const _0x36fb03=_0x5b7f76;return _0x15d74b[_0x1c7372[_0x36fb03(0x21a)]]=JSON[_0x36fb03(0x22b)](_0x1c7372['value']),_0x15d74b;},{}),{messageInterval:messageInterval=0x14,longerIntervalAfter:longerIntervalAfter=0x14,greaterInterval:greaterInterval=0x3c,variables:variables=[]}=_0x78ebb0;return{'messageInterval':messageInterval,'longerIntervalAfter':longerIntervalAfter,'greaterInterval':greaterInterval,'variables':variables};}catch(_0x19f694){console[_0x5b7f76(0x1fa)](_0x19f694);throw _0x19f694;}}function parseToMilliseconds(_0x2f9021){return _0x2f9021*0x3e8;}exports[a306_0x16ce4f(0x223)]=parseToMilliseconds;async function sleep(_0x5bd62d){const _0x14caa1=a306_0x16ce4f;return logger_1[_0x14caa1(0x20e)][_0x14caa1(0x20f)](_0x14caa1(0x218)+_0x5bd62d+'\x20segundos\x20iniciado:\x20'+(0x0,moment_1[_0x14caa1(0x1e7)])()[_0x14caa1(0x1ab)](_0x14caa1(0x227))),new Promise(_0x5a9fbf=>{setTimeout(()=>{const _0x4489c8=a306_0x28aa;logger_1[_0x4489c8(0x20e)][_0x4489c8(0x20f)](_0x4489c8(0x218)+_0x5bd62d+_0x4489c8(0x222)+(0x0,moment_1[_0x4489c8(0x1e7)])()[_0x4489c8(0x1ab)](_0x4489c8(0x227))),_0x5a9fbf(!![]);},parseToMilliseconds(_0x5bd62d));});}function getCampaignValidMessages(_0x518bcf){const _0x5ae7b2=a306_0x16ce4f,_0x33ba18=[];return!(0x0,lodash_1[_0x5ae7b2(0x187)])(_0x518bcf[_0x5ae7b2(0x24e)])&&!(0x0,lodash_1[_0x5ae7b2(0x1ac)])(_0x518bcf['message1'])&&_0x33ba18[_0x5ae7b2(0x188)](_0x518bcf['message1']),!(0x0,lodash_1[_0x5ae7b2(0x187)])(_0x518bcf[_0x5ae7b2(0x19f)])&&!(0x0,lodash_1['isNil'])(_0x518bcf['message2'])&&_0x33ba18['push'](_0x518bcf[_0x5ae7b2(0x19f)]),!(0x0,lodash_1[_0x5ae7b2(0x187)])(_0x518bcf[_0x5ae7b2(0x189)])&&!(0x0,lodash_1['isNil'])(_0x518bcf[_0x5ae7b2(0x189)])&&_0x33ba18[_0x5ae7b2(0x188)](_0x518bcf[_0x5ae7b2(0x189)]),!(0x0,lodash_1['isEmpty'])(_0x518bcf[_0x5ae7b2(0x1cd)])&&!(0x0,lodash_1[_0x5ae7b2(0x1ac)])(_0x518bcf[_0x5ae7b2(0x1cd)])&&_0x33ba18[_0x5ae7b2(0x188)](_0x518bcf['message4']),!(0x0,lodash_1[_0x5ae7b2(0x187)])(_0x518bcf[_0x5ae7b2(0x1cb)])&&!(0x0,lodash_1[_0x5ae7b2(0x1ac)])(_0x518bcf['message5'])&&_0x33ba18[_0x5ae7b2(0x188)](_0x518bcf[_0x5ae7b2(0x1cb)]),_0x33ba18;}function getCampaignValidConfirmationMessages(_0xea3ec1){const _0x5c276a=a306_0x16ce4f,_0x2782b8=[];return!(0x0,lodash_1[_0x5c276a(0x187)])(_0xea3ec1[_0x5c276a(0x1f9)])&&!(0x0,lodash_1[_0x5c276a(0x1ac)])(_0xea3ec1['confirmationMessage1'])&&_0x2782b8[_0x5c276a(0x188)](_0xea3ec1['confirmationMessage1']),!(0x0,lodash_1[_0x5c276a(0x187)])(_0xea3ec1[_0x5c276a(0x1d2)])&&!(0x0,lodash_1[_0x5c276a(0x1ac)])(_0xea3ec1[_0x5c276a(0x1d2)])&&_0x2782b8['push'](_0xea3ec1[_0x5c276a(0x1d2)]),!(0x0,lodash_1[_0x5c276a(0x187)])(_0xea3ec1[_0x5c276a(0x1b7)])&&!(0x0,lodash_1[_0x5c276a(0x1ac)])(_0xea3ec1[_0x5c276a(0x1b7)])&&_0x2782b8[_0x5c276a(0x188)](_0xea3ec1[_0x5c276a(0x1b7)]),!(0x0,lodash_1[_0x5c276a(0x187)])(_0xea3ec1[_0x5c276a(0x221)])&&!(0x0,lodash_1[_0x5c276a(0x1ac)])(_0xea3ec1[_0x5c276a(0x221)])&&_0x2782b8['push'](_0xea3ec1[_0x5c276a(0x221)]),!(0x0,lodash_1[_0x5c276a(0x187)])(_0xea3ec1[_0x5c276a(0x216)])&&!(0x0,lodash_1[_0x5c276a(0x1ac)])(_0xea3ec1[_0x5c276a(0x216)])&&_0x2782b8[_0x5c276a(0x188)](_0xea3ec1[_0x5c276a(0x216)]),_0x2782b8;}function getProcessedMessage(_0x254336,_0x2ae94c,_0x58279a){const _0x27e4de=a306_0x16ce4f;let _0x5370fc=_0x254336;return _0x5370fc[_0x27e4de(0x206)](_0x27e4de(0x230))&&(_0x5370fc=_0x5370fc['replace'](/{nome}/g,_0x58279a['name'])),_0x5370fc[_0x27e4de(0x206)]('{email}')&&(_0x5370fc=_0x5370fc[_0x27e4de(0x1fd)](/{email}/g,_0x58279a[_0x27e4de(0x249)])),_0x5370fc[_0x27e4de(0x206)]('{numero}')&&(_0x5370fc=_0x5370fc[_0x27e4de(0x1fd)](/{numero}/g,_0x58279a[_0x27e4de(0x1d4)])),_0x2ae94c[_0x27e4de(0x1bf)](_0x94fdde=>{const _0x3b0d2f=_0x27e4de;if(_0x5370fc[_0x3b0d2f(0x206)]('{'+_0x94fdde['key']+'}')){const _0x30d5d1=new RegExp('{'+_0x94fdde[_0x3b0d2f(0x21a)]+'}','g');_0x5370fc=_0x5370fc[_0x3b0d2f(0x1fd)](_0x30d5d1,_0x94fdde['value']);}}),_0x5370fc;}function randomValue(_0x2f2035,_0xdc7ec9){return Math['floor'](Math['random']()*_0xdc7ec9)+_0x2f2035;}exports[a306_0x16ce4f(0x18a)]=randomValue;async function verifyAndFinalizeCampaign(_0x214e9c){const _0x24f442=a306_0x16ce4f,{contacts:_0x2a1674}=_0x214e9c['contactList'],_0x1cac9d=_0x2a1674[_0x24f442(0x22c)],_0x4f8a75=await CampaignShipping_1['default'][_0x24f442(0x228)]({'where':{'campaignId':_0x214e9c['id'],'deliveredAt':{[sequelize_1['Op'][_0x24f442(0x229)]]:null}}});_0x1cac9d===_0x4f8a75&&await _0x214e9c['update']({'status':_0x24f442(0x1b2),'completedAt':(0x0,moment_1[_0x24f442(0x1e7)])()});const _0x4e553e=(0x0,socket_1[_0x24f442(0x1da)])();_0x4e553e[_0x24f442(0x1dc)](_0x24f442(0x226)+_0x214e9c[_0x24f442(0x1a2)]+_0x24f442(0x1d5),{'action':'update','record':_0x214e9c});}async function handleProcessCampaign(_0x4174b2){const _0x1ad4b3=a306_0x16ce4f;try{const {id:_0x83ca9b}=_0x4174b2['data'],_0x41ec9f=await getCampaign(_0x83ca9b),_0x1b2576=await getSettings(_0x41ec9f);if(_0x41ec9f){const {contacts:_0x423995}=_0x41ec9f[_0x1ad4b3(0x1c0)];if((0x0,lodash_1[_0x1ad4b3(0x198)])(_0x423995)){const _0x2e1560=_0x423995[_0x1ad4b3(0x1ba)](_0x5f0c84=>({'contactId':_0x5f0c84['id'],'campaignId':_0x41ec9f['id'],'variables':_0x1b2576[_0x1ad4b3(0x1f3)]})),_0x1d0cf5=parseToMilliseconds(_0x1b2576[_0x1ad4b3(0x199)]),_0x4e2ebc=parseToMilliseconds(_0x1b2576[_0x1ad4b3(0x204)]),_0xc54d50=_0x1b2576[_0x1ad4b3(0x1ad)];let _0x534e2b=_0x41ec9f[_0x1ad4b3(0x20c)];const _0x1a3aaa=[];for(let _0x2703ea=0x0;_0x2703ea<_0x2e1560[_0x1ad4b3(0x22c)];_0x2703ea++){_0x534e2b=(0x0,date_fns_1['addSeconds'])(_0x534e2b,_0x2703ea>_0x1d0cf5?_0x4e2ebc:_0xc54d50);const {contactId:_0x4f76a7,campaignId:_0x1b5ddb,variables:_0x55196d}=_0x2e1560[_0x2703ea],_0xf6fd10=calculateDelay(_0x2703ea,_0x534e2b,_0x1d0cf5,_0x4e2ebc,_0xc54d50),_0x32ee50=exports[_0x1ad4b3(0x1c6)]['add'](_0x1ad4b3(0x24c),{'contactId':_0x4f76a7,'campaignId':_0x1b5ddb,'variables':_0x55196d,'delay':_0xf6fd10},{'removeOnComplete':!![]});_0x1a3aaa[_0x1ad4b3(0x188)](_0x32ee50),logger_1[_0x1ad4b3(0x20e)][_0x1ad4b3(0x20f)](_0x1ad4b3(0x21c)+_0x41ec9f['id']+_0x1ad4b3(0x24b)+_0x423995[_0x2703ea][_0x1ad4b3(0x23a)]+_0x1ad4b3(0x238)+_0xf6fd10);}await Promise['all'](_0x1a3aaa),await _0x41ec9f['update']({'status':_0x1ad4b3(0x23c)});}}}catch(_0x36b04b){Sentry[_0x1ad4b3(0x21d)](_0x36b04b);}}function calculateDelay(_0x1a793b,_0x298c9d,_0x56d452,_0x16764d,_0x4d396b){const _0xa8b78b=(0x0,date_fns_1['differenceInSeconds'])(_0x298c9d,new Date());return _0x1a793b>_0x56d452?_0xa8b78b*0x3e8+_0x16764d:_0xa8b78b*0x3e8+_0x4d396b;}async function handlePrepareContact(_0x226859){const _0x2a6dde=a306_0x16ce4f;try{const {contactId:_0x2727b3,campaignId:_0x2097ac,delay:_0x539bed,variables:_0x304541}=_0x226859[_0x2a6dde(0x22e)],_0x5bb66b=await getCampaign(_0x2097ac),_0x28dcf1=await getContact(_0x2727b3),_0x30ad23={};_0x30ad23[_0x2a6dde(0x1d4)]=_0x28dcf1[_0x2a6dde(0x1d4)],_0x30ad23[_0x2a6dde(0x1ec)]=_0x2727b3,_0x30ad23[_0x2a6dde(0x1c4)]=_0x2097ac;const _0x37788a=getCampaignValidMessages(_0x5bb66b);if(_0x37788a['length']){const _0x3ad0ae=randomValue(0x0,_0x37788a[_0x2a6dde(0x22c)]),_0x1149ac=getProcessedMessage(_0x37788a[_0x3ad0ae],_0x304541,_0x28dcf1);_0x30ad23[_0x2a6dde(0x1a9)]='‌'+_0x1149ac;}if(_0x5bb66b['confirmation']){const _0x1034af=getCampaignValidConfirmationMessages(_0x5bb66b);if(_0x1034af[_0x2a6dde(0x22c)]){const _0x536a80=randomValue(0x0,_0x1034af['length']),_0x9d85d5=getProcessedMessage(_0x1034af[_0x536a80],_0x304541,_0x28dcf1);_0x30ad23[_0x2a6dde(0x205)]='‌'+_0x9d85d5;}}const [_0x4cafa3,_0x1ec1aa]=await CampaignShipping_1[_0x2a6dde(0x1e7)]['findOrCreate']({'where':{'campaignId':_0x30ad23[_0x2a6dde(0x1c4)],'contactId':_0x30ad23[_0x2a6dde(0x1ec)]},'defaults':_0x30ad23});!_0x1ec1aa&&_0x4cafa3[_0x2a6dde(0x194)]===null&&_0x4cafa3['confirmationRequestedAt']===null&&(_0x4cafa3['set'](_0x30ad23),await _0x4cafa3[_0x2a6dde(0x181)]());if(_0x4cafa3['deliveredAt']===null&&_0x4cafa3[_0x2a6dde(0x195)]===null){const _0x6d4da2=await exports[_0x2a6dde(0x1c6)][_0x2a6dde(0x17d)]('DispatchCampaign',{'campaignId':_0x5bb66b['id'],'campaignShippingId':_0x4cafa3['id'],'contactListItemId':_0x2727b3},{'delay':_0x539bed});await _0x4cafa3[_0x2a6dde(0x192)]({'jobId':_0x6d4da2['id']});}await verifyAndFinalizeCampaign(_0x5bb66b);}catch(_0x4e9e7c){Sentry['captureException'](_0x4e9e7c),logger_1[_0x2a6dde(0x20e)]['error'](_0x2a6dde(0x242)+_0x4e9e7c[_0x2a6dde(0x1a9)]);}}async function handleDispatchCampaign(_0x22a90b){const _0x3927e8=a306_0x16ce4f;try{const {data:_0x43d8c8}=_0x22a90b,{campaignShippingId:_0x476bff,campaignId:_0xb46ba2}=_0x43d8c8,_0x5c4c9b=await getCampaign(_0xb46ba2),_0x4a4b67=await(0x0,GetWhatsappWbot_1[_0x3927e8(0x1e7)])(_0x5c4c9b[_0x3927e8(0x1d8)]);if(!_0x4a4b67){logger_1[_0x3927e8(0x20e)][_0x3927e8(0x25d)](_0x3927e8(0x20a));return;}if(!_0x5c4c9b[_0x3927e8(0x1d8)]){logger_1[_0x3927e8(0x20e)][_0x3927e8(0x25d)](_0x3927e8(0x17b));return;}if(!_0x4a4b67?.[_0x3927e8(0x240)]?.['id']){logger_1['logger'][_0x3927e8(0x25d)](_0x3927e8(0x17a));return;}logger_1[_0x3927e8(0x20e)][_0x3927e8(0x20f)](_0x3927e8(0x24d)+_0xb46ba2+_0x3927e8(0x220)+_0x476bff);const _0x1bbba2=await CampaignShipping_1[_0x3927e8(0x1e7)][_0x3927e8(0x236)](_0x476bff,{'include':[{'model':ContactListItem_1[_0x3927e8(0x1e7)],'as':_0x3927e8(0x1f1)}]}),_0x32d24f=_0x1bbba2[_0x3927e8(0x1d4)]+_0x3927e8(0x18f);if(_0x5c4c9b[_0x3927e8(0x1f5)]&&_0x1bbba2[_0x3927e8(0x1f5)]===null)await _0x4a4b67[_0x3927e8(0x1ef)](_0x32d24f,{'text':_0x1bbba2[_0x3927e8(0x205)]}),await _0x1bbba2[_0x3927e8(0x192)]({'confirmationRequestedAt':(0x0,moment_1[_0x3927e8(0x1e7)])()});else{await _0x4a4b67[_0x3927e8(0x1ef)](_0x32d24f,{'text':_0x1bbba2[_0x3927e8(0x1a9)]});if(_0x5c4c9b[_0x3927e8(0x1f0)]){const _0x1e37e7=path_1[_0x3927e8(0x1e7)]['resolve'](__dirname,'..',_0x3927e8(0x244)),_0x25d488=path_1[_0x3927e8(0x1e7)][_0x3927e8(0x1fb)](_0x1e37e7,_0x3927e8(0x21e)+_0x5c4c9b[_0x3927e8(0x1a2)],_0x5c4c9b[_0x3927e8(0x1f0)]),_0x129479=await(0x0,SendWhatsAppMedia_1[_0x3927e8(0x20d)])(_0x5c4c9b['mediaName'],_0x25d488,_0x5c4c9b[_0x3927e8(0x1a2)]['toString']());Object[_0x3927e8(0x1d9)](_0x129479)[_0x3927e8(0x22c)]&&await _0x4a4b67[_0x3927e8(0x1ef)](_0x32d24f,{..._0x129479});}await _0x1bbba2[_0x3927e8(0x192)]({'deliveredAt':(0x0,moment_1['default'])()});}await verifyAndFinalizeCampaign(_0x5c4c9b);const _0x241c4d=(0x0,socket_1[_0x3927e8(0x1da)])();_0x241c4d[_0x3927e8(0x1dc)](_0x3927e8(0x226)+_0x5c4c9b[_0x3927e8(0x1a2)]+'-campaign',{'action':_0x3927e8(0x192),'record':_0x5c4c9b}),logger_1['logger']['info'](_0x3927e8(0x173)+_0xb46ba2+_0x3927e8(0x24b)+_0x1bbba2[_0x3927e8(0x1f1)][_0x3927e8(0x23a)]);}catch(_0x2ab205){Sentry[_0x3927e8(0x21d)](_0x2ab205),logger_1[_0x3927e8(0x20e)]['error'](_0x2ab205[_0x3927e8(0x1a9)]),console[_0x3927e8(0x1fa)](_0x2ab205[_0x3927e8(0x18c)]);}}async function handleLoginStatus(_0xdfe38c){const _0x44ef85=a306_0x16ce4f,_0x4bee58=await database_1[_0x44ef85(0x1e7)][_0x44ef85(0x1b9)](_0x44ef85(0x248),{'type':sequelize_1[_0x44ef85(0x1bb)]['SELECT']}),_0x56017f=_0x4bee58[_0x44ef85(0x1ba)](_0x49306a=>_0x49306a['id']),_0x56f625=_0x56017f['join'](',\x20');try{const _0x3c1bf1=_0x44ef85(0x232)+_0x56f625+');',_0x92124b=await database_1['default']['query'](_0x3c1bf1,{'type':sequelize_1[_0x44ef85(0x1bb)][_0x44ef85(0x178)]});logger_1[_0x44ef85(0x20e)][_0x44ef85(0x20f)](_0x4bee58['length']+_0x44ef85(0x250));}catch(_0x4c4c59){Sentry[_0x44ef85(0x21d)](_0x4c4c59);}}async function handleVerifyQueue(_0x3373ef){const _0x128f19=a306_0x16ce4f;logger_1['logger'][_0x128f19(0x20f)](_0x128f19(0x245));try{const {rows:_0x58a72c}=await Contact_1[_0x128f19(0x1e7)][_0x128f19(0x215)]({'where':{'pictureUpdated':![]},'order':[[_0x128f19(0x180),_0x128f19(0x253)]]});_0x58a72c[_0x128f19(0x1bf)](async _0x32be9f=>{const _0x19f2b9=_0x128f19;try{const _0x2c2d76=await(0x0,GetProfilePicUrl_1[_0x19f2b9(0x1e7)])(_0x32be9f[_0x19f2b9(0x1d4)],_0x32be9f['companyId'],_0x32be9f),_0x37883f={'name':_0x32be9f[_0x19f2b9(0x23a)],'number':_0x32be9f[_0x19f2b9(0x1d4)],'profilePicUrl':_0x2c2d76,'isGroup':_0x32be9f['isGroup'],'companyId':_0x32be9f['companyId'],'remoteJid':_0x32be9f[_0x19f2b9(0x1d1)]};await(0x0,CreateOrUpdateContactService_1[_0x19f2b9(0x1e7)])(_0x37883f);}catch(_0x3eb105){logger_1[_0x19f2b9(0x20e)][_0x19f2b9(0x25d)](_0x3eb105);}});const _0x4f139e=await Company_1[_0x128f19(0x1e7)][_0x128f19(0x1d0)]({'attributes':['id',_0x128f19(0x23a)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x128f19(0x191)]['literal'](_0x128f19(0x25b))}},'include':[{'model':Whatsapp_1[_0x128f19(0x1e7)],'attributes':['id','name',_0x128f19(0x1f8),_0x128f19(0x231),_0x128f19(0x255)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x4f139e[_0x128f19(0x1ba)](async _0x20f44c=>{const _0x36d94a=_0x128f19;_0x20f44c[_0x36d94a(0x251)]['map'](async _0x57f7f0=>{const _0x5a3e13=_0x36d94a;if(_0x57f7f0[_0x5a3e13(0x1f8)]==='CONNECTED'){var _0x133e2c=_0x20f44c['id'];const _0x21753f=_0x57f7f0['timeSendQueue']?_0x57f7f0[_0x5a3e13(0x231)]:0x0,_0x5f5a49=_0x57f7f0[_0x5a3e13(0x255)],_0x191215=_0x21753f,_0x445010=_0x5f5a49,_0x5d1df1=_0x191215;if(_0x21753f>0x0){if(!isNaN(_0x445010)&&Number[_0x5a3e13(0x246)](_0x445010)&&!isNaN(_0x5d1df1)&&Number[_0x5a3e13(0x246)](_0x5d1df1)){const _0x44b4a9=(0x0,moment_1['default'])()['subtract'](_0x5d1df1,'minutes')[_0x5a3e13(0x22f)]()['format'](),{count:_0x334136,rows:_0x6a010d}=await Ticket_1[_0x5a3e13(0x1e7)][_0x5a3e13(0x215)]({'where':{'status':_0x5a3e13(0x1c8),'queueId':null,'companyId':_0x133e2c,'whatsappId':_0x57f7f0['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x44b4a9}},'include':[{'model':Contact_1[_0x5a3e13(0x1e7)],'as':_0x5a3e13(0x1f1),'attributes':['id',_0x5a3e13(0x23a),'number','email',_0x5a3e13(0x186),_0x5a3e13(0x19e),_0x5a3e13(0x19c),_0x5a3e13(0x176)],'include':['extraInfo','contactTags',_0x5a3e13(0x207)]},{'model':Queue_2[_0x5a3e13(0x1e7)],'as':_0x5a3e13(0x239),'attributes':['id',_0x5a3e13(0x23a),_0x5a3e13(0x182)]}]});_0x334136>0x0?_0x6a010d[_0x5a3e13(0x1ba)](async _0x4f4c84=>{const _0x1051f8=_0x5a3e13;await _0x4f4c84[_0x1051f8(0x192)]({'queueId':_0x445010}),await _0x4f4c84[_0x1051f8(0x185)]();const _0x5c9077=(0x0,socket_1[_0x1051f8(0x1da)])();_0x5c9077['to'](_0x4f4c84['status'])['to'](_0x1051f8(0x1de))['to'](_0x4f4c84['id']['toString']())[_0x1051f8(0x1dc)](_0x1051f8(0x226)+_0x133e2c+_0x1051f8(0x1d7),{'action':'update','ticket':_0x4f4c84,'ticketId':_0x4f4c84['id']}),logger_1['logger'][_0x1051f8(0x20f)]('Atendimento\x20Perdido:\x20'+_0x4f4c84['id']+_0x1051f8(0x1f7)+_0x133e2c);}):logger_1[_0x5a3e13(0x20e)][_0x5a3e13(0x20f)](_0x5a3e13(0x18e)+_0x133e2c);}else logger_1[_0x5a3e13(0x20e)][_0x5a3e13(0x20f)](_0x5a3e13(0x1be)+_0x133e2c);}}});});}catch(_0x32ccfd){Sentry['captureException'](_0x32ccfd),logger_1[_0x128f19(0x20e)][_0x128f19(0x25d)]('SearchForQueue\x20->\x20VerifyQueue:\x20error',_0x32ccfd['message']);throw _0x32ccfd;}};async function handleRandomUser(){const _0x23f80d=a306_0x16ce4f;logger_1[_0x23f80d(0x20e)]['info'](_0x23f80d(0x1c7));const _0x273ca6=new CronJob(_0x23f80d(0x237),async()=>{const _0x4ffdf9=_0x23f80d;try{const {count:_0x16d1b4,rows:_0x227c75}=await Ticket_1[_0x4ffdf9(0x1e7)][_0x4ffdf9(0x215)]({'where':{'status':'pending','queueId':{[sequelize_1['Op']['ne']]:null,[sequelize_1['Op']['ne']]:0x0},'$queue.ativarRoteador$':!![],'$queue.tempoRoteador$':{[sequelize_1['Op']['ne']]:0x0}},'include':[{'model':Queue_1['default'],'as':_0x4ffdf9(0x239)}]}),_0xd6537a=_0x2b5102=>{const _0x24ecd7=_0x4ffdf9,_0x482c8e=Math[_0x24ecd7(0x1ff)](Math[_0x24ecd7(0x1cf)]()*_0x2b5102[_0x24ecd7(0x22c)]);return _0x2b5102[_0x482c8e];},_0x5a54d7=async _0x58638c=>{const _0x4072a4=_0x4ffdf9;try{const _0x12381b=await User_1[_0x4072a4(0x1e7)][_0x4072a4(0x197)]({'where':{'id':_0x58638c}});return _0x12381b[_0x4072a4(0x256)]===_0x4072a4(0x240)?(logger_1[_0x4072a4(0x20e)][_0x4072a4(0x20f)]('USER'),_0x12381b[_0x4072a4(0x254)]===!![]?_0x12381b['id']:(logger_1['logger']['info'](_0x4072a4(0x1a5)),0x0)):(logger_1[_0x4072a4(0x20e)][_0x4072a4(0x20f)](_0x4072a4(0x196)),0x0);}catch(_0x1edb54){Sentry[_0x4072a4(0x21d)](_0x1edb54),logger_1[_0x4072a4(0x20e)][_0x4072a4(0x25d)](_0x4072a4(0x1a1),_0x1edb54[_0x4072a4(0x1a9)]);throw _0x1edb54;}};if(_0x16d1b4>0x0)for(const _0x4c5a18 of _0x227c75){const {queue:_0x2e9fdc,queueId:_0x1ca93c,userId:_0x4351e2}=_0x4c5a18,_0x454f27=_0x2e9fdc[_0x4ffdf9(0x234)],_0x57dfeb=await UserQueue_1[_0x4ffdf9(0x1e7)]['findAll']({'where':{'queueId':_0x1ca93c}}),_0x1b1a98=await(0x0,ShowContactService_1[_0x4ffdf9(0x1e7)])(_0x4c5a18[_0x4ffdf9(0x1ec)],_0x4c5a18[_0x4ffdf9(0x1a2)]),_0x54523c=_0x57dfeb[_0x4ffdf9(0x1ba)](_0x479634=>_0x479634[_0x4ffdf9(0x1c1)]),_0x198cd0=(0x0,moment_1[_0x4ffdf9(0x1e7)])()['subtract'](_0x454f27,_0x4ffdf9(0x184))[_0x4ffdf9(0x22f)]()[_0x4ffdf9(0x1ae)](),_0x2ff518=new Date(_0x4c5a18[_0x4ffdf9(0x180)]);if(!_0x4351e2){const _0x35714a=_0xd6537a(_0x54523c);if(await _0x5a54d7(_0x35714a)>0x0){const _0x219350=await(0x0,ShowTicketService_1[_0x4ffdf9(0x1e7)])(_0x4c5a18['id'],_0x4c5a18[_0x4ffdf9(0x1a2)]),_0x9e589d=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x4ffdf9(0x23e),'ticket':_0x219350});await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x4ffdf9(0x212),'userId':_0x35714a},'ticketId':_0x4c5a18['id'],'companyId':_0x4c5a18['companyId']}),logger_1[_0x4ffdf9(0x20e)][_0x4ffdf9(0x20f)]('Ticket\x20ID\x20'+_0x4c5a18['id']+_0x4ffdf9(0x1a0)+_0x35714a+'\x20-\x20'+_0x4c5a18['updatedAt']);}else{}}else{if(_0x54523c[_0x4ffdf9(0x206)](_0x4351e2)){if(_0x198cd0>_0x2ff518){const _0x46bde4=_0x54523c[_0x4ffdf9(0x1dd)](_0x3cd18c=>_0x3cd18c!==_0x4351e2);if(_0x46bde4[_0x4ffdf9(0x22c)]>0x0){const _0x1c3ec6=_0xd6537a(_0x46bde4);if(await _0x5a54d7(_0x1c3ec6)>0x0){const _0x3600e3=await(0x0,ShowTicketService_1[_0x4ffdf9(0x1e7)])(_0x4c5a18['id'],_0x4c5a18['companyId']),_0x14997=await(0x0,SendWhatsAppMessage_1[_0x4ffdf9(0x1e7)])({'body':_0x4ffdf9(0x23e),'ticket':_0x3600e3});await(0x0,UpdateTicketService_1[_0x4ffdf9(0x1e7)])({'ticketData':{'status':_0x4ffdf9(0x212),'userId':_0x1c3ec6},'ticketId':_0x4c5a18['id'],'companyId':_0x4c5a18[_0x4ffdf9(0x1a2)]}),await _0x4c5a18['reload']();}else{}}else{}}else{}}else{}}}}catch(_0x10a5e4){Sentry[_0x4ffdf9(0x21d)](_0x10a5e4),logger_1[_0x4ffdf9(0x20e)][_0x4ffdf9(0x25d)](_0x4ffdf9(0x1a1),_0x10a5e4['message']);throw _0x10a5e4;}});_0x273ca6[_0x23f80d(0x22a)]();}async function handleCloseTicketsAutomatic(){const _0x3e63e8=a306_0x16ce4f,_0x5a14e8=new CronJob('*/1\x20*\x20*\x20*\x20*',async()=>{const _0x5544fe=a306_0x28aa,_0xa90570=await Company_1[_0x5544fe(0x1e7)][_0x5544fe(0x1d0)]();_0xa90570[_0x5544fe(0x1ba)](async _0x444c54=>{const _0x533df1=_0x5544fe;try{const _0x18ba9c=_0x444c54['id'];await(0x0,wbotClosedTickets_1[_0x533df1(0x1d6)])(_0x18ba9c);}catch(_0x4adfbf){Sentry[_0x533df1(0x21d)](_0x4adfbf),logger_1[_0x533df1(0x20e)]['error'](_0x533df1(0x217),_0x4adfbf[_0x533df1(0x1a9)]);throw _0x4adfbf;}});});_0x5a14e8[_0x3e63e8(0x22a)]();}handleCloseTicketsAutomatic(),handleRandomUser();async function startQueueProcess(){const _0x249fd4=a306_0x16ce4f;logger_1[_0x249fd4(0x20e)][_0x249fd4(0x20f)]('Iniciando\x20processamento\x20de\x20filas'),exports[_0x249fd4(0x177)][_0x249fd4(0x247)](_0x249fd4(0x1af),handleSendMessage),exports[_0x249fd4(0x1a8)][_0x249fd4(0x247)](_0x249fd4(0x1bd),handleVerifySchedules),exports['sendScheduledMessages']['process']('SendMessage',handleSendScheduledMessage),exports[_0x249fd4(0x1c6)]['process'](_0x249fd4(0x1f4),handleVerifyCampaigns),exports['campaignQueue'][_0x249fd4(0x247)](_0x249fd4(0x1f2),handleProcessCampaign),exports[_0x249fd4(0x1c6)][_0x249fd4(0x247)](_0x249fd4(0x24c),handlePrepareContact),exports['campaignQueue'][_0x249fd4(0x247)]('DispatchCampaign',handleDispatchCampaign),exports[_0x249fd4(0x1aa)]['process'](_0x249fd4(0x18b),handleLoginStatus),exports['queueMonitor'][_0x249fd4(0x247)](_0x249fd4(0x25a),handleVerifyQueue),exports[_0x249fd4(0x1a8)][_0x249fd4(0x17d)](_0x249fd4(0x1bd),{},{'repeat':{'cron':_0x249fd4(0x237),'key':_0x249fd4(0x235)},'removeOnComplete':!![]}),exports['campaignQueue']['add']('VerifyCampaignsDaatabase',{},{'repeat':{'cron':_0x249fd4(0x1b0),'key':_0x249fd4(0x17e)},'removeOnComplete':!![]}),exports[_0x249fd4(0x1aa)][_0x249fd4(0x17d)](_0x249fd4(0x18b),{},{'repeat':{'cron':_0x249fd4(0x1e3),'key':'verify-login'},'removeOnComplete':!![]}),exports[_0x249fd4(0x209)]['add'](_0x249fd4(0x25a),{},{'repeat':{'cron':_0x249fd4(0x1b0),'key':_0x249fd4(0x19b)},'removeOnComplete':!![]});}exports[a306_0x16ce4f(0x179)]=startQueueProcess;