'use strict';const a305_0x94414e=a305_0x2c27;(function(_0x1739b5,_0x2075a5){const _0x41de17=a305_0x2c27,_0x9cadab=_0x1739b5();while(!![]){try{const _0x2365cd=-parseInt(_0x41de17(0x20b))/0x1*(-parseInt(_0x41de17(0x267))/0x2)+parseInt(_0x41de17(0x260))/0x3*(parseInt(_0x41de17(0x25f))/0x4)+-parseInt(_0x41de17(0x1c7))/0x5*(parseInt(_0x41de17(0x1fc))/0x6)+-parseInt(_0x41de17(0x24b))/0x7+parseInt(_0x41de17(0x293))/0x8*(-parseInt(_0x41de17(0x1e0))/0x9)+parseInt(_0x41de17(0x1c9))/0xa+-parseInt(_0x41de17(0x29e))/0xb*(-parseInt(_0x41de17(0x269))/0xc);if(_0x2365cd===_0x2075a5)break;else _0x9cadab['push'](_0x9cadab['shift']());}catch(_0x3aefb7){_0x9cadab['push'](_0x9cadab['shift']());}}}(a305_0x2927,0x3be61));var __createBinding=this&&this['__createBinding']||(Object[a305_0x94414e(0x2ae)]?function(_0x20f46e,_0x4b33b5,_0x17025b,_0xba1364){const _0xdf4a5d=a305_0x94414e;if(_0xba1364===undefined)_0xba1364=_0x17025b;var _0x49c9db=Object[_0xdf4a5d(0x27d)](_0x4b33b5,_0x17025b);(!_0x49c9db||(_0xdf4a5d(0x1fe)in _0x49c9db?!_0x4b33b5['__esModule']:_0x49c9db[_0xdf4a5d(0x239)]||_0x49c9db['configurable']))&&(_0x49c9db={'enumerable':!![],'get':function(){return _0x4b33b5[_0x17025b];}}),Object[_0xdf4a5d(0x1e4)](_0x20f46e,_0xba1364,_0x49c9db);}:function(_0x3054c2,_0x4f1858,_0x1bf462,_0x32ded5){if(_0x32ded5===undefined)_0x32ded5=_0x1bf462;_0x3054c2[_0x32ded5]=_0x4f1858[_0x1bf462];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a305_0x94414e(0x2ae)]?function(_0x22b444,_0x5b9a1d){const _0x1ffeeb=a305_0x94414e;Object[_0x1ffeeb(0x1e4)](_0x22b444,_0x1ffeeb(0x1e9),{'enumerable':!![],'value':_0x5b9a1d});}:function(_0x29e1a2,_0x1b86a5){const _0x2e0860=a305_0x94414e;_0x29e1a2[_0x2e0860(0x1e9)]=_0x1b86a5;}),__importStar=this&&this[a305_0x94414e(0x1c5)]||function(_0x43a4b0){const _0x569c33=a305_0x94414e;if(_0x43a4b0&&_0x43a4b0[_0x569c33(0x284)])return _0x43a4b0;var _0x3b25c4={};if(_0x43a4b0!=null){for(var _0x598902 in _0x43a4b0)if(_0x598902!=='default'&&Object[_0x569c33(0x226)][_0x569c33(0x205)][_0x569c33(0x228)](_0x43a4b0,_0x598902))__createBinding(_0x3b25c4,_0x43a4b0,_0x598902);}return __setModuleDefault(_0x3b25c4,_0x43a4b0),_0x3b25c4;},__importDefault=this&&this['__importDefault']||function(_0x4d8168){const _0x5d7f5b=a305_0x94414e;return _0x4d8168&&_0x4d8168[_0x5d7f5b(0x284)]?_0x4d8168:{'default':_0x4d8168};};Object[a305_0x94414e(0x1e4)](exports,a305_0x94414e(0x284),{'value':!![]}),exports[a305_0x94414e(0x209)]=exports[a305_0x94414e(0x281)]=exports[a305_0x94414e(0x227)]=exports[a305_0x94414e(0x25c)]=exports[a305_0x94414e(0x1ec)]=exports[a305_0x94414e(0x23a)]=exports[a305_0x94414e(0x25e)]=exports[a305_0x94414e(0x268)]=exports[a305_0x94414e(0x212)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),bull_1=__importDefault(require(a305_0x94414e(0x1c4))),SendMessage_1=require(a305_0x94414e(0x1ea)),Whatsapp_1=__importDefault(require(a305_0x94414e(0x22f))),logger_1=require('./utils/logger'),moment_1=__importDefault(require(a305_0x94414e(0x285))),Schedule_1=__importDefault(require(a305_0x94414e(0x286))),sequelize_1=require('sequelize'),GetDefaultWhatsApp_1=__importDefault(require('./helpers/GetDefaultWhatsApp')),Campaign_1=__importDefault(require(a305_0x94414e(0x2ad))),Queue_1=__importDefault(require('./models/Queue')),ContactList_1=__importDefault(require(a305_0x94414e(0x278))),ContactListItem_1=__importDefault(require(a305_0x94414e(0x1dd))),lodash_1=require(a305_0x94414e(0x1db)),CampaignSetting_1=__importDefault(require(a305_0x94414e(0x1d3))),CampaignShipping_1=__importDefault(require(a305_0x94414e(0x1de))),GetWhatsappWbot_1=__importDefault(require('./helpers/GetWhatsappWbot')),database_1=__importDefault(require(a305_0x94414e(0x258))),SendWhatsAppMedia_1=require(a305_0x94414e(0x1fb)),socket_1=require('./libs/socket'),path_1=__importDefault(require('path')),User_1=__importDefault(require(a305_0x94414e(0x26d))),Company_1=__importDefault(require(a305_0x94414e(0x27b))),Contact_1=__importDefault(require(a305_0x94414e(0x20c))),Queue_2=__importDefault(require(a305_0x94414e(0x1fd))),wbotClosedTickets_1=require(a305_0x94414e(0x2a2)),Ticket_1=__importDefault(require(a305_0x94414e(0x245))),ShowContactService_1=__importDefault(require(a305_0x94414e(0x1da))),UserQueue_1=__importDefault(require('./models/UserQueue')),ShowTicketService_1=__importDefault(require('./services/TicketServices/ShowTicketService')),SendWhatsAppMessage_1=__importDefault(require(a305_0x94414e(0x295))),UpdateTicketService_1=__importDefault(require(a305_0x94414e(0x234))),date_fns_1=require(a305_0x94414e(0x216)),nodemailer=require(a305_0x94414e(0x1e3)),CronJob=require(a305_0x94414e(0x275))[a305_0x94414e(0x27e)],connection=process[a305_0x94414e(0x256)][a305_0x94414e(0x28f)]||'',limiterMax=process[a305_0x94414e(0x256)]['REDIS_OPT_LIMITER_MAX']||0x1,limiterDuration=process[a305_0x94414e(0x256)][a305_0x94414e(0x2a8)]||0xbb8;exports['userMonitor']=new bull_1[(a305_0x94414e(0x1e9))](a305_0x94414e(0x20f),connection),exports[a305_0x94414e(0x268)]=new bull_1[(a305_0x94414e(0x1e9))](a305_0x94414e(0x1e1),connection),exports[a305_0x94414e(0x25e)]=new bull_1['default'](a305_0x94414e(0x29b),connection),exports[a305_0x94414e(0x23a)]=new bull_1['default'](a305_0x94414e(0x1f6),connection),exports[a305_0x94414e(0x1ec)]=new bull_1['default']('QueueMonitor',connection),exports[a305_0x94414e(0x25c)]=new bull_1[(a305_0x94414e(0x1e9))]('MessageQueue',connection,{'limiter':{'max':limiterMax,'duration':limiterDuration}});async function handleSendMessage(_0x593412){const _0x11fb8b=a305_0x94414e;try{const {data:_0x4f7af0}=_0x593412,_0x56acd1=await Whatsapp_1[_0x11fb8b(0x1e9)][_0x11fb8b(0x24d)](_0x4f7af0[_0x11fb8b(0x1d8)]);if(_0x56acd1===null)throw Error(_0x11fb8b(0x25d));const _0x9e2cd4=_0x4f7af0['data'];await(0x0,SendMessage_1[_0x11fb8b(0x287)])(_0x56acd1,_0x9e2cd4);}catch(_0x51e737){Sentry[_0x11fb8b(0x230)](_0x51e737),logger_1[_0x11fb8b(0x242)][_0x11fb8b(0x1d9)](_0x11fb8b(0x23b),_0x51e737[_0x11fb8b(0x236)]);throw _0x51e737;}}function a305_0x2c27(_0xd4bffb,_0x407787){const _0x29275f=a305_0x2927();return a305_0x2c27=function(_0x2c278a,_0xe7e31){_0x2c278a=_0x2c278a-0x1c1;let _0x3183cb=_0x29275f[_0x2c278a];return _0x3183cb;},a305_0x2c27(_0xd4bffb,_0x407787);}async function handleVerifySchedules(_0x332db3){const _0x20abd0=a305_0x94414e;try{const {count:_0x20a049,rows:_0x2992d0}=await Schedule_1[_0x20abd0(0x1e9)][_0x20abd0(0x299)]({'where':{'status':_0x20abd0(0x24c),'sentAt':null,'sendAt':{[sequelize_1['Op'][_0x20abd0(0x240)]]:(0x0,moment_1[_0x20abd0(0x1e9)])()[_0x20abd0(0x1c6)](_0x20abd0(0x24f)),[sequelize_1['Op'][_0x20abd0(0x27a)]]:(0x0,moment_1['default'])()[_0x20abd0(0x283)]('30',_0x20abd0(0x210))[_0x20abd0(0x1c6)](_0x20abd0(0x24f))}},'include':[{'model':Contact_1[_0x20abd0(0x1e9)],'as':'contact'}]});_0x20a049>0x0&&_0x2992d0['map'](async _0x30d48b=>{const _0x452409=_0x20abd0;await _0x30d48b[_0x452409(0x21f)]({'status':_0x452409(0x201)}),exports[_0x452409(0x25e)]['add'](_0x452409(0x287),{'schedule':_0x30d48b},{'delay':0x9c40}),logger_1[_0x452409(0x242)][_0x452409(0x237)](_0x452409(0x1e8)+_0x30d48b[_0x452409(0x238)][_0x452409(0x1cc)]);});}catch(_0x1854c4){Sentry[_0x20abd0(0x230)](_0x1854c4),logger_1[_0x20abd0(0x242)]['error']('SendScheduledMessage\x20->\x20Verify:\x20error',_0x1854c4['message']);throw _0x1854c4;}}async function handleSendScheduledMessage(_0x403c13){const _0x117557=a305_0x94414e,{data:{schedule:_0x420d61}}=_0x403c13;let _0x291e47=null;try{_0x291e47=await Schedule_1[_0x117557(0x1e9)][_0x117557(0x24d)](_0x420d61['id']);}catch(_0x56f690){Sentry[_0x117557(0x230)](_0x56f690),logger_1[_0x117557(0x242)]['info']('Erro\x20ao\x20tentar\x20consultar\x20agendamento:\x20'+_0x420d61['id']);}try{const _0x4b0ef0=await(0x0,GetDefaultWhatsApp_1[_0x117557(0x1e9)])(_0x420d61[_0x117557(0x1f2)]);await(0x0,SendMessage_1[_0x117557(0x287)])(_0x4b0ef0,{'number':_0x420d61[_0x117557(0x238)][_0x117557(0x2ab)],'body':_0x420d61[_0x117557(0x24a)]}),await _0x291e47?.[_0x117557(0x21f)]({'sentAt':(0x0,moment_1['default'])()[_0x117557(0x1c6)](_0x117557(0x1f4)),'status':_0x117557(0x270)}),logger_1[_0x117557(0x242)][_0x117557(0x237)](_0x117557(0x1e5)+_0x420d61[_0x117557(0x238)][_0x117557(0x1cc)]),exports[_0x117557(0x25e)][_0x117557(0x20e)](0x3a98,_0x117557(0x1e6));}catch(_0x1e444d){Sentry[_0x117557(0x230)](_0x1e444d),await _0x291e47?.[_0x117557(0x21f)]({'status':_0x117557(0x297)}),logger_1[_0x117557(0x242)][_0x117557(0x1d9)](_0x117557(0x23d),_0x1e444d[_0x117557(0x236)]);throw _0x1e444d;}}async function handleVerifyCampaigns(_0x4cb371){const _0x28364e=a305_0x94414e,_0x3ff3c2=await database_1[_0x28364e(0x1e9)][_0x28364e(0x1cd)]('select\x20id,\x20\x22scheduledAt\x22\x20from\x20\x22Campaigns\x22\x20c\x0a\x20\x20\x20\x20where\x20\x22scheduledAt\x22\x20between\x20now()\x20and\x20now()\x20+\x20\x273\x20hour\x27::interval\x20and\x20status\x20=\x20\x27PROGRAMADA\x27',{'type':sequelize_1['QueryTypes'][_0x28364e(0x265)]});logger_1[_0x28364e(0x242)][_0x28364e(0x237)]('Campanhas\x20encontradas:\x20'+_0x3ff3c2[_0x28364e(0x1d4)]);for(let _0x414ebe of _0x3ff3c2){try{const _0x205a0f=(0x0,moment_1[_0x28364e(0x1e9)])(),_0x1d8e78=(0x0,moment_1[_0x28364e(0x1e9)])(_0x414ebe[_0x28364e(0x231)]),_0x1b0977=_0x1d8e78[_0x28364e(0x248)](_0x205a0f,_0x28364e(0x274));logger_1[_0x28364e(0x242)]['info'](_0x28364e(0x251)+_0x414ebe['id']+_0x28364e(0x1d2)+_0x1b0977),exports[_0x28364e(0x23a)][_0x28364e(0x283)]('ProcessCampaign',{'id':_0x414ebe['id'],'delay':_0x1b0977},{'priority':0x3,'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}});}catch(_0x4886ce){Sentry['captureException'](_0x4886ce);}}}async function getCampaign(_0x288d6d){const _0x3adc99=a305_0x94414e;return await Campaign_1['default'][_0x3adc99(0x23f)]({'where':{'id':_0x288d6d},'include':[{'model':ContactList_1['default'],'as':'contactList','attributes':['id','name'],'include':[{'model':ContactListItem_1[_0x3adc99(0x1e9)],'as':_0x3adc99(0x24e),'attributes':['id',_0x3adc99(0x1cc),_0x3adc99(0x2ab),_0x3adc99(0x25b),_0x3adc99(0x255)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1[_0x3adc99(0x1e9)],'as':_0x3adc99(0x26b),'attributes':['id',_0x3adc99(0x1cc)]}]});}async function getContact(_0x273af8){const _0x185000=a305_0x94414e;return await ContactListItem_1[_0x185000(0x1e9)][_0x185000(0x24d)](_0x273af8,{'attributes':['id','name',_0x185000(0x2ab),'email']});}async function getSettings(_0x2bd8c6){const _0x3c6eb4=a305_0x94414e;try{const _0x116356=await CampaignSetting_1[_0x3c6eb4(0x1e9)]['findAll']({'where':{'companyId':_0x2bd8c6['companyId']},'attributes':['key','value']}),_0xa3615e=_0x116356[_0x3c6eb4(0x271)]((_0x3148d4,_0x4cb80a)=>{const _0x3ca7b4=_0x3c6eb4;return _0x3148d4[_0x4cb80a[_0x3ca7b4(0x2b0)]]=JSON[_0x3ca7b4(0x29f)](_0x4cb80a['value']),_0x3148d4;},{}),{messageInterval:messageInterval=0x14,longerIntervalAfter:longerIntervalAfter=0x14,greaterInterval:greaterInterval=0x3c,variables:variables=[]}=_0xa3615e;return{'messageInterval':messageInterval,'longerIntervalAfter':longerIntervalAfter,'greaterInterval':greaterInterval,'variables':variables};}catch(_0x5f5937){console['log'](_0x5f5937);throw _0x5f5937;}}function parseToMilliseconds(_0x3240b8){return _0x3240b8*0x3e8;}exports[a305_0x94414e(0x227)]=parseToMilliseconds;async function sleep(_0x5990b7){const _0x1d8e65=a305_0x94414e;return logger_1['logger'][_0x1d8e65(0x237)](_0x1d8e65(0x249)+_0x5990b7+_0x1d8e65(0x22e)+(0x0,moment_1[_0x1d8e65(0x1e9)])()[_0x1d8e65(0x1c6)](_0x1d8e65(0x2b5))),new Promise(_0x352aa8=>{setTimeout(()=>{const _0x1bddca=a305_0x2c27;logger_1[_0x1bddca(0x242)][_0x1bddca(0x237)]('Sleep\x20de\x20'+_0x5990b7+_0x1bddca(0x233)+(0x0,moment_1[_0x1bddca(0x1e9)])()[_0x1bddca(0x1c6)]('HH:mm:ss')),_0x352aa8(!![]);},parseToMilliseconds(_0x5990b7));});}function getCampaignValidMessages(_0x5d27ed){const _0x2861e2=a305_0x94414e,_0x501dd6=[];return!(0x0,lodash_1['isEmpty'])(_0x5d27ed[_0x2861e2(0x1d7)])&&!(0x0,lodash_1[_0x2861e2(0x2b1)])(_0x5d27ed[_0x2861e2(0x1d7)])&&_0x501dd6['push'](_0x5d27ed[_0x2861e2(0x1d7)]),!(0x0,lodash_1[_0x2861e2(0x1ca)])(_0x5d27ed[_0x2861e2(0x28c)])&&!(0x0,lodash_1[_0x2861e2(0x2b1)])(_0x5d27ed[_0x2861e2(0x28c)])&&_0x501dd6[_0x2861e2(0x214)](_0x5d27ed[_0x2861e2(0x28c)]),!(0x0,lodash_1[_0x2861e2(0x1ca)])(_0x5d27ed['message3'])&&!(0x0,lodash_1[_0x2861e2(0x2b1)])(_0x5d27ed['message3'])&&_0x501dd6['push'](_0x5d27ed['message3']),!(0x0,lodash_1['isEmpty'])(_0x5d27ed[_0x2861e2(0x213)])&&!(0x0,lodash_1['isNil'])(_0x5d27ed[_0x2861e2(0x213)])&&_0x501dd6['push'](_0x5d27ed[_0x2861e2(0x213)]),!(0x0,lodash_1[_0x2861e2(0x1ca)])(_0x5d27ed['message5'])&&!(0x0,lodash_1['isNil'])(_0x5d27ed[_0x2861e2(0x225)])&&_0x501dd6[_0x2861e2(0x214)](_0x5d27ed[_0x2861e2(0x225)]),_0x501dd6;}function getCampaignValidConfirmationMessages(_0x77a857){const _0x1bc665=a305_0x94414e,_0x4cd46e=[];return!(0x0,lodash_1['isEmpty'])(_0x77a857[_0x1bc665(0x2a7)])&&!(0x0,lodash_1[_0x1bc665(0x2b1)])(_0x77a857[_0x1bc665(0x2a7)])&&_0x4cd46e['push'](_0x77a857['confirmationMessage1']),!(0x0,lodash_1['isEmpty'])(_0x77a857['confirmationMessage2'])&&!(0x0,lodash_1[_0x1bc665(0x2b1)])(_0x77a857[_0x1bc665(0x23e)])&&_0x4cd46e[_0x1bc665(0x214)](_0x77a857['confirmationMessage2']),!(0x0,lodash_1[_0x1bc665(0x1ca)])(_0x77a857['confirmationMessage3'])&&!(0x0,lodash_1[_0x1bc665(0x2b1)])(_0x77a857[_0x1bc665(0x1c8)])&&_0x4cd46e['push'](_0x77a857[_0x1bc665(0x1c8)]),!(0x0,lodash_1['isEmpty'])(_0x77a857[_0x1bc665(0x2a3)])&&!(0x0,lodash_1[_0x1bc665(0x2b1)])(_0x77a857['confirmationMessage4'])&&_0x4cd46e[_0x1bc665(0x214)](_0x77a857[_0x1bc665(0x2a3)]),!(0x0,lodash_1[_0x1bc665(0x1ca)])(_0x77a857[_0x1bc665(0x2a1)])&&!(0x0,lodash_1[_0x1bc665(0x2b1)])(_0x77a857[_0x1bc665(0x2a1)])&&_0x4cd46e['push'](_0x77a857[_0x1bc665(0x2a1)]),_0x4cd46e;}function getProcessedMessage(_0xe46d48,_0xa011a8,_0xb5751f){const _0x3c5f6b=a305_0x94414e;let _0x5376bf=_0xe46d48;return _0x5376bf['includes'](_0x3c5f6b(0x294))&&(_0x5376bf=_0x5376bf[_0x3c5f6b(0x2b3)](/{nome}/g,_0xb5751f[_0x3c5f6b(0x1cc)])),_0x5376bf[_0x3c5f6b(0x27f)](_0x3c5f6b(0x204))&&(_0x5376bf=_0x5376bf[_0x3c5f6b(0x2b3)](/{email}/g,_0xb5751f[_0x3c5f6b(0x25b)])),_0x5376bf[_0x3c5f6b(0x27f)](_0x3c5f6b(0x232))&&(_0x5376bf=_0x5376bf[_0x3c5f6b(0x2b3)](/{numero}/g,_0xb5751f[_0x3c5f6b(0x2ab)])),_0xa011a8[_0x3c5f6b(0x252)](_0x3ceb35=>{const _0x30a2bf=_0x3c5f6b;if(_0x5376bf[_0x30a2bf(0x27f)]('{'+_0x3ceb35[_0x30a2bf(0x2b0)]+'}')){const _0x2d5480=new RegExp('{'+_0x3ceb35['key']+'}','g');_0x5376bf=_0x5376bf[_0x30a2bf(0x2b3)](_0x2d5480,_0x3ceb35['value']);}}),_0x5376bf;}function randomValue(_0xcc4159,_0x3c1ef2){const _0x1d0d81=a305_0x94414e;return Math[_0x1d0d81(0x2af)](Math[_0x1d0d81(0x291)]()*_0x3c1ef2)+_0xcc4159;}exports[a305_0x94414e(0x281)]=randomValue;async function verifyAndFinalizeCampaign(_0x4b71c2){const _0x50b88b=a305_0x94414e,{contacts:_0x10bf85}=_0x4b71c2[_0x50b88b(0x1f1)],_0x52505b=_0x10bf85['length'],_0x2dae49=await CampaignShipping_1['default'][_0x50b88b(0x25a)]({'where':{'campaignId':_0x4b71c2['id'],'deliveredAt':{[sequelize_1['Op'][_0x50b88b(0x29c)]]:null}}});_0x52505b===_0x2dae49&&await _0x4b71c2[_0x50b88b(0x21f)]({'status':_0x50b88b(0x241),'completedAt':(0x0,moment_1[_0x50b88b(0x1e9)])()});const _0x2eac87=(0x0,socket_1['getIO'])();_0x2eac87[_0x50b88b(0x298)](_0x50b88b(0x277)+_0x4b71c2[_0x50b88b(0x1f2)]+_0x50b88b(0x224),{'action':'update','record':_0x4b71c2});}async function handleProcessCampaign(_0xba9129){const _0x4fc7e0=a305_0x94414e;try{const {id:_0x3a91f8}=_0xba9129[_0x4fc7e0(0x264)],_0x4ac072=await getCampaign(_0x3a91f8),_0x5a075d=await getSettings(_0x4ac072);if(_0x4ac072){const {contacts:_0x150ccd}=_0x4ac072[_0x4fc7e0(0x1f1)];if((0x0,lodash_1[_0x4fc7e0(0x2a5)])(_0x150ccd)){const _0x71319f=_0x150ccd['map'](_0x544bcd=>({'contactId':_0x544bcd['id'],'campaignId':_0x4ac072['id'],'variables':_0x5a075d[_0x4fc7e0(0x1f3)]})),_0x2de0e9=parseToMilliseconds(_0x5a075d[_0x4fc7e0(0x1c1)]),_0x277fcb=parseToMilliseconds(_0x5a075d[_0x4fc7e0(0x22d)]),_0x33cbeb=_0x5a075d[_0x4fc7e0(0x1cf)];let _0xcc041e=_0x4ac072[_0x4fc7e0(0x231)];const _0x26b96e=[];for(let _0x1367a9=0x0;_0x1367a9<_0x71319f['length'];_0x1367a9++){_0xcc041e=(0x0,date_fns_1[_0x4fc7e0(0x22a)])(_0xcc041e,_0x1367a9>_0x2de0e9?_0x277fcb:_0x33cbeb);const {contactId:_0x3a3ee6,campaignId:_0x1b1fca,variables:_0x27e7a1}=_0x71319f[_0x1367a9],_0x5906f5=calculateDelay(_0x1367a9,_0xcc041e,_0x2de0e9,_0x277fcb,_0x33cbeb),_0x4e47c9=exports[_0x4fc7e0(0x23a)][_0x4fc7e0(0x283)](_0x4fc7e0(0x211),{'contactId':_0x3a3ee6,'campaignId':_0x1b1fca,'variables':_0x27e7a1,'delay':_0x5906f5},{'removeOnComplete':!![]});_0x26b96e[_0x4fc7e0(0x214)](_0x4e47c9),logger_1[_0x4fc7e0(0x242)][_0x4fc7e0(0x237)]('Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha='+_0x4ac072['id']+_0x4fc7e0(0x208)+_0x150ccd[_0x1367a9][_0x4fc7e0(0x1cc)]+_0x4fc7e0(0x1d0)+_0x5906f5);}await Promise[_0x4fc7e0(0x1c3)](_0x26b96e),await _0x4ac072[_0x4fc7e0(0x21f)]({'status':_0x4fc7e0(0x1ee)});}}}catch(_0x3c792d){Sentry[_0x4fc7e0(0x230)](_0x3c792d);}}function a305_0x2927(){const _0x136c32=['floor','key','isNil','campaignQueue\x20->\x20PrepareContact\x20->\x20error:\x20','replace','USER','HH:mm:ss','longerIntervalAfter','whatsapps','all','bull','__importStar','format','675460thDbIj','confirmationMessage3','1854900itEJZs','isEmpty','*/1\x20*\x20*\x20*\x20*','name','query','user','messageInterval',';delay=','QueryTypes',',\x20Delay\x20Inicial=','./models/CampaignSetting','length','Ticket\x20ID\x20','SearchForUsersRandom\x20->\x20VerifyUsersRandom:\x20error','message1','whatsappId','error','./services/ContactServices/ShowContactService','lodash','findOrCreate','./models/ContactListItem','./models/CampaignShipping','sendMessage','9ielMiK','ScheduleMonitor','isInteger','nodemailer','defineProperty','Mensagem\x20agendada\x20enviada\x20para:\x20','completed','USER\x20OFFLINE','Disparo\x20agendado\x20para:\x20','default','./helpers/SendMessage','findAll','queueMonitor','reload','EM_ANDAMENTO','tempoRoteador','pending','contactList','companyId','variables','YYYY-MM-DD\x20HH:mm','contactTags','CampaignQueue','verify-campaing','filter','SearchForQueue\x20->\x20VerifyQueue:\x20error','extraInfo','./services/WbotServices/SendWhatsAppMedia','18xPRdAO','./models/Queue','get','*/5\x20*\x20*\x20*\x20*\x20*','\x20-\x20Empresa:\x20','AGENDADA','verify-login','*/20\x20*\x20*\x20*\x20*\x20*','{email}','hasOwnProperty','status','disableBot',';Contato=','startQueueProcess','ADMIN','737ezGTie','./models/Contact','Sequelize','clean','UserMonitor','seconds','PrepareContact','userMonitor','message4','push','color','date-fns','active','tags','Campanha\x20enviada\x20para:\x20Campanha=','VerifyCampaignsDaatabase','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','differenceInSeconds','start','CURRENT_DATE','update','VerifyQueueStatus','ClosedAllOpenTickets','toDate','mediaPath','-campaign','message5','prototype','parseToMilliseconds','call','verify','addSeconds','subtract','acceptAudioMessage','greaterInterval','\x20segundos\x20iniciado:\x20','./models/Whatsapp','captureException','scheduledAt','{numero}','\x20segundos\x20finalizado:\x20','./services/TicketServices/UpdateTicketService','*Assistente\x20Virtual*:\x0aAguarde\x20enquanto\x20localizamos\x20um\x20atendente...\x20Você\x20será\x20atendido\x20em\x20breve!','message','info','contact','writable','campaignQueue','MessageQueue\x20->\x20SendMessage:\x20error',';Registro=','SendScheduledMessage\x20->\x20SendMessage:\x20error','confirmationMessage2','findOne','gte','FINALIZADA','logger','open','join','./models/Ticket','Verify','process','diff','Sleep\x20de\x20','body','2738533TqyYLo','PENDENTE','findByPk','contacts','YYYY-MM-DD\x20HH:mm:ss','UPDATE','Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha=','forEach','online','\x20updated\x20with\x20UserId\x20','isWhatsappValid','env','VerifyLoginStatus','./database','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','count','email','messageQueue','Whatsapp\x20não\x20identificado','sendScheduledMessages','8484cRbZVU','678rTHonT','company','DispatchCampaign','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20not\x20found','data','SELECT','confirmationMessage','662lkpfxk','scheduleMonitor','43572iuQmkn','mediaName','whatsapp','confirmationRequestedAt','./models/User','Atendimento\x20Perdido:\x20','map','ENVIADA','reduce','queue','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','milliseconds','cron','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20whatsapp\x20not\x20found','company-','./models/ContactList','@s.whatsapp.net','lte','./models/Company','ProcessCampaign','getOwnPropertyDescriptor','CronJob','includes','literal','randomValue','minutes','add','__esModule','moment','./models/Schedule','SendMessage','save','verify-queue','CONNECTED','updatedAt','message2','getIO','sendIdQueue','REDIS_URI','timeSendQueue','random','-ticket','1288432ljXkgo','{nome}','./services/WbotServices/SendWhatsAppMessage','public','ERRO','emit','findAndCountAll','confirmation','SendSacheduledMessages','not','contactId','891KxzSXe','parse','utc','confirmationMessage5','./services/WbotServices/wbotClosedTickets','confirmationMessage4','campaignId','isArray','userId','confirmationMessage1','REDIS_OPT_LIMITER_DURATION','resolve','Iniciando\x20a\x20randomização\x20dos\x20atendimentos...','number','*\x20*\x20*\x20*\x20*','./models/Campaign','create'];a305_0x2927=function(){return _0x136c32;};return a305_0x2927();}function calculateDelay(_0x4f4f88,_0x446470,_0x1fbd93,_0x429827,_0xcb0871){const _0xed6ab1=a305_0x94414e,_0x1b7610=(0x0,date_fns_1[_0xed6ab1(0x21c)])(_0x446470,new Date());return _0x4f4f88>_0x1fbd93?_0x1b7610*0x3e8+_0x429827:_0x1b7610*0x3e8+_0xcb0871;}async function handlePrepareContact(_0xbad706){const _0x48cc74=a305_0x94414e;try{const {contactId:_0x12f657,campaignId:_0x4a31bb,delay:_0x49a9ec,variables:_0x482049}=_0xbad706[_0x48cc74(0x264)],_0x1c5030=await getCampaign(_0x4a31bb),_0x15dcdb=await getContact(_0x12f657),_0x1f505c={};_0x1f505c[_0x48cc74(0x2ab)]=_0x15dcdb[_0x48cc74(0x2ab)],_0x1f505c[_0x48cc74(0x29d)]=_0x12f657,_0x1f505c[_0x48cc74(0x2a4)]=_0x4a31bb;const _0x138e53=getCampaignValidMessages(_0x1c5030);if(_0x138e53[_0x48cc74(0x1d4)]){const _0x48aeaa=randomValue(0x0,_0x138e53[_0x48cc74(0x1d4)]),_0x4f923b=getProcessedMessage(_0x138e53[_0x48aeaa],_0x482049,_0x15dcdb);_0x1f505c[_0x48cc74(0x236)]='‌'+_0x4f923b;}if(_0x1c5030[_0x48cc74(0x29a)]){const _0x1561dc=getCampaignValidConfirmationMessages(_0x1c5030);if(_0x1561dc[_0x48cc74(0x1d4)]){const _0x45b086=randomValue(0x0,_0x1561dc[_0x48cc74(0x1d4)]),_0x51f174=getProcessedMessage(_0x1561dc[_0x45b086],_0x482049,_0x15dcdb);_0x1f505c[_0x48cc74(0x266)]='‌'+_0x51f174;}}const [_0x5d3046,_0x2b78c8]=await CampaignShipping_1['default'][_0x48cc74(0x1dc)]({'where':{'campaignId':_0x1f505c[_0x48cc74(0x2a4)],'contactId':_0x1f505c[_0x48cc74(0x29d)]},'defaults':_0x1f505c});!_0x2b78c8&&_0x5d3046['deliveredAt']===null&&_0x5d3046['confirmationRequestedAt']===null&&(_0x5d3046['set'](_0x1f505c),await _0x5d3046[_0x48cc74(0x288)]());if(_0x5d3046['deliveredAt']===null&&_0x5d3046[_0x48cc74(0x26c)]===null){const _0x33b29e=await exports['campaignQueue'][_0x48cc74(0x283)](_0x48cc74(0x262),{'campaignId':_0x1c5030['id'],'campaignShippingId':_0x5d3046['id'],'contactListItemId':_0x12f657},{'delay':_0x49a9ec});await _0x5d3046[_0x48cc74(0x21f)]({'jobId':_0x33b29e['id']});}await verifyAndFinalizeCampaign(_0x1c5030);}catch(_0x36154f){Sentry[_0x48cc74(0x230)](_0x36154f),logger_1[_0x48cc74(0x242)]['error'](_0x48cc74(0x2b2)+_0x36154f[_0x48cc74(0x236)]);}}async function handleDispatchCampaign(_0x32db1e){const _0x3c33de=a305_0x94414e;try{const {data:_0x3fac84}=_0x32db1e,{campaignShippingId:_0x3b5f89,campaignId:_0x53f3c6}=_0x3fac84,_0x28d52d=await getCampaign(_0x53f3c6),_0x116ac6=await(0x0,GetWhatsappWbot_1[_0x3c33de(0x1e9)])(_0x28d52d[_0x3c33de(0x26b)]);if(!_0x116ac6){logger_1['logger'][_0x3c33de(0x1d9)](_0x3c33de(0x263));return;}if(!_0x28d52d[_0x3c33de(0x26b)]){logger_1[_0x3c33de(0x242)][_0x3c33de(0x1d9)](_0x3c33de(0x276));return;}if(!_0x116ac6?.[_0x3c33de(0x1ce)]?.['id']){logger_1['logger'][_0x3c33de(0x1d9)]('campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20user\x20not\x20found');return;}logger_1['logger'][_0x3c33de(0x237)]('Disparo\x20de\x20campanha\x20solicitado:\x20Campanha='+_0x53f3c6+_0x3c33de(0x23c)+_0x3b5f89);const _0x329b14=await CampaignShipping_1['default']['findByPk'](_0x3b5f89,{'include':[{'model':ContactListItem_1[_0x3c33de(0x1e9)],'as':_0x3c33de(0x238)}]}),_0x46093b=_0x329b14['number']+_0x3c33de(0x279);if(_0x28d52d[_0x3c33de(0x29a)]&&_0x329b14[_0x3c33de(0x29a)]===null)await _0x116ac6[_0x3c33de(0x1df)](_0x46093b,{'text':_0x329b14[_0x3c33de(0x266)]}),await _0x329b14['update']({'confirmationRequestedAt':(0x0,moment_1['default'])()});else{await _0x116ac6[_0x3c33de(0x1df)](_0x46093b,{'text':_0x329b14[_0x3c33de(0x236)]});if(_0x28d52d[_0x3c33de(0x223)]){const _0x1a1281=path_1['default'][_0x3c33de(0x2a9)](__dirname,'..',_0x3c33de(0x296)),_0x34648f=path_1[_0x3c33de(0x1e9)][_0x3c33de(0x244)](_0x1a1281,_0x3c33de(0x261)+_0x28d52d[_0x3c33de(0x1f2)],_0x28d52d[_0x3c33de(0x223)]),_0x2daf74=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x28d52d[_0x3c33de(0x26a)],_0x34648f,_0x28d52d[_0x3c33de(0x1f2)]['toString']());Object['keys'](_0x2daf74)['length']&&await _0x116ac6[_0x3c33de(0x1df)](_0x46093b,{..._0x2daf74});}await _0x329b14[_0x3c33de(0x21f)]({'deliveredAt':(0x0,moment_1[_0x3c33de(0x1e9)])()});}await verifyAndFinalizeCampaign(_0x28d52d);const _0x18c7b1=(0x0,socket_1[_0x3c33de(0x28d)])();_0x18c7b1[_0x3c33de(0x298)](_0x3c33de(0x277)+_0x28d52d['companyId']+_0x3c33de(0x224),{'action':_0x3c33de(0x21f),'record':_0x28d52d}),logger_1[_0x3c33de(0x242)]['info'](_0x3c33de(0x219)+_0x53f3c6+';Contato='+_0x329b14[_0x3c33de(0x238)][_0x3c33de(0x1cc)]);}catch(_0x3b6784){Sentry[_0x3c33de(0x230)](_0x3b6784),logger_1[_0x3c33de(0x242)]['error'](_0x3b6784['message']),console['log'](_0x3b6784['stack']);}}async function handleLoginStatus(_0x132b57){const _0x178306=a305_0x94414e,_0x244313=await database_1[_0x178306(0x1e9)][_0x178306(0x1cd)]('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x273\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x178306(0x1d1)][_0x178306(0x265)]}),_0xddbd62=_0x244313[_0x178306(0x26f)](_0x4e8903=>_0x4e8903['id']),_0x1bc29e=_0xddbd62['join'](',\x20');try{const _0x39f751='UPDATE\x20\x22Users\x22\x20SET\x20\x22online\x22\x20=\x20false,\x20\x22updatedAt\x22\x20=\x20now()\x20WHERE\x20id\x20IN\x20('+_0x1bc29e+');',_0x1aedcf=await database_1[_0x178306(0x1e9)][_0x178306(0x1cd)](_0x39f751,{'type':sequelize_1[_0x178306(0x1d1)][_0x178306(0x250)]});logger_1['logger']['info'](_0x244313[_0x178306(0x1d4)]+'\x20usuarios\x20passados\x20para\x20offline');}catch(_0xe6eb40){Sentry[_0x178306(0x230)](_0xe6eb40);}}async function handleVerifyQueue(_0x5a6ee0){const _0x1002b7=a305_0x94414e;logger_1[_0x1002b7(0x242)][_0x1002b7(0x237)](_0x1002b7(0x259));try{const _0x1c70b2=await Company_1['default'][_0x1002b7(0x1eb)]({'attributes':['id',_0x1002b7(0x1cc)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x1002b7(0x20d)][_0x1002b7(0x280)](_0x1002b7(0x21e))}},'include':[{'model':Whatsapp_1[_0x1002b7(0x1e9)],'attributes':['id',_0x1002b7(0x1cc),_0x1002b7(0x206),_0x1002b7(0x290),'sendIdQueue'],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x1c70b2[_0x1002b7(0x26f)](async _0x224cca=>{const _0x241844=_0x1002b7;_0x224cca[_0x241844(0x1c2)][_0x241844(0x26f)](async _0x221ccb=>{const _0x4c0071=_0x241844;if(_0x221ccb[_0x4c0071(0x206)]===_0x4c0071(0x28a)){var _0x23fff5=_0x224cca['id'];const _0x425b18=_0x221ccb[_0x4c0071(0x290)]?_0x221ccb[_0x4c0071(0x290)]:0x0,_0x36db5e=_0x221ccb[_0x4c0071(0x28e)],_0x228d04=_0x425b18,_0x1f4cef=_0x36db5e,_0x26d1d=_0x228d04;if(_0x425b18>0x0){if(!isNaN(_0x1f4cef)&&Number[_0x4c0071(0x1e2)](_0x1f4cef)&&!isNaN(_0x26d1d)&&Number[_0x4c0071(0x1e2)](_0x26d1d)){const _0x4e5075=(0x0,moment_1[_0x4c0071(0x1e9)])()['subtract'](_0x26d1d,_0x4c0071(0x282))[_0x4c0071(0x2a0)]()[_0x4c0071(0x1c6)](),{count:_0x4829b8,rows:_0x1abad3}=await Ticket_1[_0x4c0071(0x1e9)][_0x4c0071(0x299)]({'where':{'status':_0x4c0071(0x1f0),'queueId':null,'companyId':_0x23fff5,'whatsappId':_0x221ccb['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x4e5075}},'include':[{'model':Contact_1['default'],'as':_0x4c0071(0x238),'attributes':['id',_0x4c0071(0x1cc),'number',_0x4c0071(0x25b),'profilePicUrl',_0x4c0071(0x22c),_0x4c0071(0x217),_0x4c0071(0x207)],'include':[_0x4c0071(0x1fa),_0x4c0071(0x1f5),_0x4c0071(0x218)]},{'model':Queue_2[_0x4c0071(0x1e9)],'as':_0x4c0071(0x272),'attributes':['id',_0x4c0071(0x1cc),_0x4c0071(0x215)]}]});_0x4829b8>0x0?_0x1abad3[_0x4c0071(0x26f)](async _0x1f263b=>{const _0x2b5e44=_0x4c0071;await _0x1f263b[_0x2b5e44(0x21f)]({'queueId':_0x1f4cef}),await _0x1f263b[_0x2b5e44(0x1ed)]();const _0x50e000=(0x0,socket_1['getIO'])();_0x50e000['to'](_0x1f263b[_0x2b5e44(0x206)])['to']('notification')['to'](_0x1f263b['id']['toString']())[_0x2b5e44(0x298)](_0x2b5e44(0x277)+_0x23fff5+_0x2b5e44(0x292),{'action':'update','ticket':_0x1f263b,'ticketId':_0x1f263b['id']}),logger_1[_0x2b5e44(0x242)]['info'](_0x2b5e44(0x26e)+_0x1f263b['id']+_0x2b5e44(0x200)+_0x23fff5);}):logger_1[_0x4c0071(0x242)][_0x4c0071(0x237)](_0x4c0071(0x273)+_0x23fff5);}else logger_1[_0x4c0071(0x242)][_0x4c0071(0x237)](_0x4c0071(0x21b)+_0x23fff5);}}});});}catch(_0xc5a145){Sentry['captureException'](_0xc5a145),logger_1[_0x1002b7(0x242)]['error'](_0x1002b7(0x1f9),_0xc5a145['message']);throw _0xc5a145;}};async function handleRandomUser(){const _0x510105=a305_0x94414e;logger_1[_0x510105(0x242)][_0x510105(0x237)](_0x510105(0x2aa));const _0x546747=new CronJob('*/5\x20*\x20*\x20*\x20*\x20*',async()=>{const _0x15b06d=_0x510105;try{const {count:_0x57ecc0,rows:_0x52e2c3}=await Ticket_1['default']['findAndCountAll']({'where':{'status':_0x15b06d(0x1f0),'queueId':{[sequelize_1['Op']['ne']]:null,[sequelize_1['Op']['ne']]:0x0},'$queue.ativarRoteador$':!![],'$queue.tempoRoteador$':{[sequelize_1['Op']['ne']]:0x0}},'include':[{'model':Queue_1[_0x15b06d(0x1e9)],'as':_0x15b06d(0x272)}]}),_0x1e60f0=_0x104857=>{const _0xe3d2c0=_0x15b06d,_0x1af878=Math['floor'](Math[_0xe3d2c0(0x291)]()*_0x104857[_0xe3d2c0(0x1d4)]);return _0x104857[_0x1af878];},_0x4ceba3=async _0x5e1fc1=>{const _0x57793e=_0x15b06d;try{const _0x32b6ad=await User_1['default']['findOne']({'where':{'id':_0x5e1fc1}});return _0x32b6ad['profile']==='user'?(logger_1[_0x57793e(0x242)]['info'](_0x57793e(0x2b4)),_0x32b6ad[_0x57793e(0x253)]===!![]?_0x32b6ad['id']:(logger_1['logger'][_0x57793e(0x237)](_0x57793e(0x1e7)),0x0)):(logger_1[_0x57793e(0x242)][_0x57793e(0x237)](_0x57793e(0x20a)),0x0);}catch(_0x149bf7){Sentry[_0x57793e(0x230)](_0x149bf7),logger_1[_0x57793e(0x242)]['error']('SearchForUsersRandom\x20->\x20VerifyUsersRandom:\x20error',_0x149bf7[_0x57793e(0x236)]);throw _0x149bf7;}};if(_0x57ecc0>0x0)for(const _0x1be39e of _0x52e2c3){const {queue:_0x54d891,queueId:_0x440e37,userId:_0x1fc564}=_0x1be39e,_0x17b174=_0x54d891[_0x15b06d(0x1ef)],_0x1b9db5=await UserQueue_1[_0x15b06d(0x1e9)]['findAll']({'where':{'queueId':_0x440e37}}),_0x33f5d5=await(0x0,ShowContactService_1['default'])(_0x1be39e['contactId'],_0x1be39e[_0x15b06d(0x1f2)]),_0x3a6d6d=_0x1b9db5['map'](_0x2801db=>_0x2801db[_0x15b06d(0x2a6)]),_0x1b6a72=(0x0,moment_1[_0x15b06d(0x1e9)])()[_0x15b06d(0x22b)](_0x17b174,_0x15b06d(0x282))[_0x15b06d(0x2a0)]()[_0x15b06d(0x222)](),_0x2cd6f4=new Date(_0x1be39e[_0x15b06d(0x28b)]);if(!_0x1fc564){const _0x290d71=_0x1e60f0(_0x3a6d6d);if(await _0x4ceba3(_0x290d71)>0x0){const _0x1a378f=await(0x0,ShowTicketService_1[_0x15b06d(0x1e9)])(_0x1be39e['id'],_0x1be39e[_0x15b06d(0x1f2)]),_0x13012a=await(0x0,SendWhatsAppMessage_1[_0x15b06d(0x1e9)])({'body':_0x15b06d(0x235),'ticket':_0x1a378f});await(0x0,UpdateTicketService_1[_0x15b06d(0x1e9)])({'ticketData':{'status':_0x15b06d(0x243),'userId':_0x290d71},'ticketId':_0x1be39e['id'],'companyId':_0x1be39e[_0x15b06d(0x1f2)]}),logger_1[_0x15b06d(0x242)][_0x15b06d(0x237)](_0x15b06d(0x1d5)+_0x1be39e['id']+_0x15b06d(0x254)+_0x290d71+'\x20-\x20'+_0x1be39e[_0x15b06d(0x28b)]);}else{}}else{if(_0x3a6d6d[_0x15b06d(0x27f)](_0x1fc564)){if(_0x1b6a72>_0x2cd6f4){const _0x2a357d=_0x3a6d6d[_0x15b06d(0x1f8)](_0x2a58da=>_0x2a58da!==_0x1fc564);if(_0x2a357d['length']>0x0){const _0x41c315=_0x1e60f0(_0x2a357d);if(await _0x4ceba3(_0x41c315)>0x0){const _0x27d81e=await(0x0,ShowTicketService_1[_0x15b06d(0x1e9)])(_0x1be39e['id'],_0x1be39e[_0x15b06d(0x1f2)]),_0x1d8d32=await(0x0,SendWhatsAppMessage_1[_0x15b06d(0x1e9)])({'body':_0x15b06d(0x235),'ticket':_0x27d81e});await(0x0,UpdateTicketService_1[_0x15b06d(0x1e9)])({'ticketData':{'status':_0x15b06d(0x243),'userId':_0x41c315},'ticketId':_0x1be39e['id'],'companyId':_0x1be39e[_0x15b06d(0x1f2)]}),await _0x1be39e[_0x15b06d(0x1ed)]();}else{}}else{}}else{}}else{}}}}catch(_0xcd79a9){Sentry[_0x15b06d(0x230)](_0xcd79a9),logger_1[_0x15b06d(0x242)][_0x15b06d(0x1d9)](_0x15b06d(0x1d6),_0xcd79a9[_0x15b06d(0x236)]);throw _0xcd79a9;}});_0x546747[_0x510105(0x21d)]();}async function handleCloseTicketsAutomatic(){const _0x90d9d4=a305_0x94414e,_0x39c2c8=new CronJob(_0x90d9d4(0x1cb),async()=>{const _0x3c26cf=_0x90d9d4,_0x8d5d95=await Company_1[_0x3c26cf(0x1e9)][_0x3c26cf(0x1eb)]();_0x8d5d95[_0x3c26cf(0x26f)](async _0x1d6f6b=>{const _0x26373a=_0x3c26cf;try{const _0x344d52=_0x1d6f6b['id'];await(0x0,wbotClosedTickets_1[_0x26373a(0x221)])(_0x344d52);}catch(_0x36cca6){Sentry[_0x26373a(0x230)](_0x36cca6),logger_1['logger'][_0x26373a(0x1d9)]('ClosedAllOpenTickets\x20->\x20Verify:\x20error',_0x36cca6[_0x26373a(0x236)]);throw _0x36cca6;}});});_0x39c2c8[_0x90d9d4(0x21d)]();}handleCloseTicketsAutomatic(),handleRandomUser();async function startQueueProcess(){const _0x3bed5e=a305_0x94414e;logger_1[_0x3bed5e(0x242)]['info']('Iniciando\x20processamento\x20de\x20filas'),exports[_0x3bed5e(0x25c)]['process'](_0x3bed5e(0x287),handleSendMessage),exports[_0x3bed5e(0x268)][_0x3bed5e(0x247)](_0x3bed5e(0x246),handleVerifySchedules),exports[_0x3bed5e(0x25e)][_0x3bed5e(0x247)](_0x3bed5e(0x287),handleSendScheduledMessage),exports['campaignQueue'][_0x3bed5e(0x247)]('VerifyCampaignsDaatabase',handleVerifyCampaigns),exports['campaignQueue'][_0x3bed5e(0x247)](_0x3bed5e(0x27c),handleProcessCampaign),exports[_0x3bed5e(0x23a)]['process'](_0x3bed5e(0x211),handlePrepareContact),exports['campaignQueue'][_0x3bed5e(0x247)](_0x3bed5e(0x262),handleDispatchCampaign),exports[_0x3bed5e(0x212)][_0x3bed5e(0x247)](_0x3bed5e(0x257),handleLoginStatus),exports[_0x3bed5e(0x1ec)][_0x3bed5e(0x247)](_0x3bed5e(0x220),handleVerifyQueue),exports[_0x3bed5e(0x268)][_0x3bed5e(0x283)]('Verify',{},{'repeat':{'cron':_0x3bed5e(0x1ff),'key':_0x3bed5e(0x229)},'removeOnComplete':!![]}),exports[_0x3bed5e(0x23a)][_0x3bed5e(0x283)](_0x3bed5e(0x21a),{},{'repeat':{'cron':_0x3bed5e(0x203),'key':_0x3bed5e(0x1f7)},'removeOnComplete':!![]}),exports[_0x3bed5e(0x212)]['add'](_0x3bed5e(0x257),{},{'repeat':{'cron':_0x3bed5e(0x2ac),'key':_0x3bed5e(0x202)},'removeOnComplete':!![]}),exports[_0x3bed5e(0x1ec)]['add'](_0x3bed5e(0x220),{},{'repeat':{'cron':_0x3bed5e(0x203),'key':_0x3bed5e(0x289)},'removeOnComplete':!![]});}exports[a305_0x94414e(0x209)]=startQueueProcess;