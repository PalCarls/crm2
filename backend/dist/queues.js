'use strict';const a317_0x23c280=a317_0x33b3;function a317_0x33b3(_0x185c01,_0xd33a79){const _0x4e868d=a317_0x4e86();return a317_0x33b3=function(_0x33b396,_0x3e578b){_0x33b396=_0x33b396-0x1ce;let _0x57c02=_0x4e868d[_0x33b396];return _0x57c02;},a317_0x33b3(_0x185c01,_0xd33a79);}(function(_0x4abd06,_0x32e23c){const _0x302dca=a317_0x33b3,_0x4e26f2=_0x4abd06();while(!![]){try{const _0x5783ee=parseInt(_0x302dca(0x2ca))/0x1*(parseInt(_0x302dca(0x2c0))/0x2)+-parseInt(_0x302dca(0x2c1))/0x3*(parseInt(_0x302dca(0x204))/0x4)+parseInt(_0x302dca(0x21b))/0x5+-parseInt(_0x302dca(0x28c))/0x6+parseInt(_0x302dca(0x268))/0x7+parseInt(_0x302dca(0x225))/0x8+-parseInt(_0x302dca(0x2a2))/0x9;if(_0x5783ee===_0x32e23c)break;else _0x4e26f2['push'](_0x4e26f2['shift']());}catch(_0xcc14f4){_0x4e26f2['push'](_0x4e26f2['shift']());}}}(a317_0x4e86,0xa1846));var __createBinding=this&&this[a317_0x23c280(0x2a3)]||(Object['create']?function(_0x5b71a9,_0x5ac9da,_0x46ebed,_0x339ddc){const _0x3b389f=a317_0x23c280;if(_0x339ddc===undefined)_0x339ddc=_0x46ebed;var _0x252b8c=Object[_0x3b389f(0x226)](_0x5ac9da,_0x46ebed);(!_0x252b8c||(_0x3b389f(0x208)in _0x252b8c?!_0x5ac9da[_0x3b389f(0x1e1)]:_0x252b8c[_0x3b389f(0x29e)]||_0x252b8c[_0x3b389f(0x2c7)]))&&(_0x252b8c={'enumerable':!![],'get':function(){return _0x5ac9da[_0x46ebed];}}),Object[_0x3b389f(0x1f9)](_0x5b71a9,_0x339ddc,_0x252b8c);}:function(_0x3aa628,_0x38c7bc,_0x3152a2,_0x1d921c){if(_0x1d921c===undefined)_0x1d921c=_0x3152a2;_0x3aa628[_0x1d921c]=_0x38c7bc[_0x3152a2];}),__setModuleDefault=this&&this[a317_0x23c280(0x235)]||(Object[a317_0x23c280(0x27d)]?function(_0x1bd6bd,_0xe66469){const _0x1572d6=a317_0x23c280;Object[_0x1572d6(0x1f9)](_0x1bd6bd,_0x1572d6(0x22f),{'enumerable':!![],'value':_0xe66469});}:function(_0xabc060,_0x2e7c7d){const _0x1209e9=a317_0x23c280;_0xabc060[_0x1209e9(0x22f)]=_0x2e7c7d;}),__importStar=this&&this[a317_0x23c280(0x222)]||function(_0x5aa031){const _0x5866c7=a317_0x23c280;if(_0x5aa031&&_0x5aa031[_0x5866c7(0x1e1)])return _0x5aa031;var _0x1ae77f={};if(_0x5aa031!=null){for(var _0x5ace63 in _0x5aa031)if(_0x5ace63!==_0x5866c7(0x22f)&&Object[_0x5866c7(0x288)][_0x5866c7(0x1ee)][_0x5866c7(0x24b)](_0x5aa031,_0x5ace63))__createBinding(_0x1ae77f,_0x5aa031,_0x5ace63);}return __setModuleDefault(_0x1ae77f,_0x5aa031),_0x1ae77f;},__importDefault=this&&this['__importDefault']||function(_0x45d07f){const _0x26d824=a317_0x23c280;return _0x45d07f&&_0x45d07f[_0x26d824(0x1e1)]?_0x45d07f:{'default':_0x45d07f};};Object[a317_0x23c280(0x1f9)](exports,a317_0x23c280(0x1e1),{'value':!![]}),exports[a317_0x23c280(0x1ef)]=exports['randomValue']=exports[a317_0x23c280(0x2b8)]=exports[a317_0x23c280(0x28b)]=exports[a317_0x23c280(0x2c8)]=exports[a317_0x23c280(0x1e2)]=exports[a317_0x23c280(0x20b)]=exports[a317_0x23c280(0x26d)]=exports[a317_0x23c280(0x233)]=void 0x0;const Sentry=__importStar(require(a317_0x23c280(0x1d5))),bull_1=__importDefault(require(a317_0x23c280(0x1db))),SendMessage_1=require(a317_0x23c280(0x263)),Whatsapp_1=__importDefault(require('./models/Whatsapp')),logger_1=require(a317_0x23c280(0x2b1)),moment_1=__importDefault(require('moment')),Schedule_1=__importDefault(require('./models/Schedule')),sequelize_1=require(a317_0x23c280(0x21e)),GetDefaultWhatsApp_1=__importDefault(require(a317_0x23c280(0x215))),Campaign_1=__importDefault(require(a317_0x23c280(0x249))),Queue_1=__importDefault(require(a317_0x23c280(0x214))),ContactList_1=__importDefault(require(a317_0x23c280(0x22e))),ContactListItem_1=__importDefault(require(a317_0x23c280(0x1e3))),lodash_1=require(a317_0x23c280(0x293)),CampaignSetting_1=__importDefault(require(a317_0x23c280(0x1d2))),CampaignShipping_1=__importDefault(require(a317_0x23c280(0x1f6))),GetWhatsappWbot_1=__importDefault(require(a317_0x23c280(0x246))),database_1=__importDefault(require(a317_0x23c280(0x1f2))),SendWhatsAppMedia_1=require(a317_0x23c280(0x298)),socket_1=require(a317_0x23c280(0x200)),path_1=__importDefault(require(a317_0x23c280(0x25d))),User_1=__importDefault(require(a317_0x23c280(0x27f))),Company_1=__importDefault(require(a317_0x23c280(0x1ff))),Contact_1=__importDefault(require(a317_0x23c280(0x2ac))),Queue_2=__importDefault(require(a317_0x23c280(0x214))),wbotClosedTickets_1=require(a317_0x23c280(0x27c)),Ticket_1=__importDefault(require(a317_0x23c280(0x1e5))),ShowContactService_1=__importDefault(require(a317_0x23c280(0x25c))),GetProfilePicUrl_1=__importDefault(require(a317_0x23c280(0x23f))),CreateOrUpdateContactService_1=__importDefault(require(a317_0x23c280(0x22b))),UserQueue_1=__importDefault(require(a317_0x23c280(0x1d3))),ShowTicketService_1=__importDefault(require(a317_0x23c280(0x224))),SendWhatsAppMessage_1=__importDefault(require(a317_0x23c280(0x205))),UpdateTicketService_1=__importDefault(require(a317_0x23c280(0x230))),date_fns_1=require('date-fns'),GetWhatsapp_1=require(a317_0x23c280(0x1fc)),nodemailer=require(a317_0x23c280(0x1e7)),CronJob=require(a317_0x23c280(0x1d7))['CronJob'],axios_1=__importDefault(require('axios')),connection=process[a317_0x23c280(0x2b4)]['REDIS_URI']||'',limiterMax=process[a317_0x23c280(0x2b4)][a317_0x23c280(0x27a)]||0x1,limiterDuration=process[a317_0x23c280(0x2b4)][a317_0x23c280(0x202)]||0xbb8;exports[a317_0x23c280(0x233)]=new bull_1[(a317_0x23c280(0x22f))](a317_0x23c280(0x2b9),connection),exports[a317_0x23c280(0x26d)]=new bull_1[(a317_0x23c280(0x22f))]('ScheduleMonitor',connection),exports[a317_0x23c280(0x20b)]=new bull_1['default'](a317_0x23c280(0x26c),connection),exports[a317_0x23c280(0x1e2)]=new bull_1['default'](a317_0x23c280(0x1cf),connection),exports[a317_0x23c280(0x2c8)]=new bull_1[(a317_0x23c280(0x22f))](a317_0x23c280(0x20c),connection),exports[a317_0x23c280(0x28b)]=new bull_1['default'](a317_0x23c280(0x2ab),connection,{'limiter':{'max':limiterMax,'duration':limiterDuration}});async function handleSendMessage(_0x5b76c3){const _0x156b8a=a317_0x23c280;try{const {data:_0xbba7fd}=_0x5b76c3,_0x3085c8=await Whatsapp_1[_0x156b8a(0x22f)]['findByPk'](_0xbba7fd['whatsappId']);if(_0x3085c8===null)throw Error('Whatsapp\x20não\x20identificado');const _0xb1afef=_0xbba7fd['data'];await(0x0,SendMessage_1[_0x156b8a(0x2a7)])(_0x3085c8,_0xb1afef);}catch(_0x40e123){Sentry['captureException'](_0x40e123),logger_1['logger'][_0x156b8a(0x1d4)](_0x156b8a(0x232),_0x40e123[_0x156b8a(0x260)]);throw _0x40e123;}}async function handleVerifySchedules(_0x223aec){const _0x1d0568=a317_0x23c280;try{const {count:_0x5c1035,rows:_0x445113}=await Schedule_1[_0x1d0568(0x22f)][_0x1d0568(0x2c9)]({'where':{'status':_0x1d0568(0x299),'sentAt':null,'sendAt':{[sequelize_1['Op'][_0x1d0568(0x1e8)]]:(0x0,moment_1[_0x1d0568(0x22f)])()[_0x1d0568(0x290)](_0x1d0568(0x23b)),[sequelize_1['Op'][_0x1d0568(0x21d)]]:(0x0,moment_1[_0x1d0568(0x22f)])()[_0x1d0568(0x29d)]('30','seconds')['format'](_0x1d0568(0x23b))}},'include':[{'model':Contact_1[_0x1d0568(0x22f)],'as':_0x1d0568(0x277)}]});_0x5c1035>0x0&&_0x445113['map'](async _0x52e76e=>{const _0x125c1a=_0x1d0568;await _0x52e76e[_0x125c1a(0x203)]({'status':'AGENDADA'}),exports[_0x125c1a(0x20b)][_0x125c1a(0x29d)](_0x125c1a(0x2a7),{'schedule':_0x52e76e},{'delay':0x9c40}),logger_1[_0x125c1a(0x1fa)]['info'](_0x125c1a(0x2b3)+_0x52e76e['contact'][_0x125c1a(0x238)]);});}catch(_0x910151){Sentry[_0x1d0568(0x257)](_0x910151),logger_1[_0x1d0568(0x1fa)][_0x1d0568(0x1d4)](_0x1d0568(0x1d0),_0x910151['message']);throw _0x910151;}}async function handleSendScheduledMessage(_0x4e0c98){const _0x2fdd84=a317_0x23c280,{data:{schedule:_0x4ec106}}=_0x4e0c98;let _0x243dbc=null;try{_0x243dbc=await Schedule_1[_0x2fdd84(0x22f)]['findByPk'](_0x4ec106['id']);}catch(_0x1f832f){Sentry[_0x2fdd84(0x257)](_0x1f832f),logger_1[_0x2fdd84(0x1fa)][_0x2fdd84(0x24d)](_0x2fdd84(0x1e6)+_0x4ec106['id']);}try{const _0x20df80=await(0x0,GetDefaultWhatsApp_1[_0x2fdd84(0x22f)])(_0x4ec106['companyId']);await(0x0,SendMessage_1['SendMessage'])(_0x20df80,{'number':_0x4ec106[_0x2fdd84(0x277)][_0x2fdd84(0x1ed)],'body':_0x4ec106[_0x2fdd84(0x1e4)]}),await _0x243dbc?.[_0x2fdd84(0x203)]({'sentAt':(0x0,moment_1[_0x2fdd84(0x22f)])()[_0x2fdd84(0x290)](_0x2fdd84(0x23a)),'status':_0x2fdd84(0x1d6)}),logger_1[_0x2fdd84(0x1fa)][_0x2fdd84(0x24d)]('Mensagem\x20agendada\x20enviada\x20para:\x20'+_0x4ec106[_0x2fdd84(0x277)][_0x2fdd84(0x238)]),exports['sendScheduledMessages'][_0x2fdd84(0x25a)](0x3a98,_0x2fdd84(0x276));}catch(_0x4f33d4){Sentry['captureException'](_0x4f33d4),await _0x243dbc?.[_0x2fdd84(0x203)]({'status':_0x2fdd84(0x295)}),logger_1['logger'][_0x2fdd84(0x1d4)](_0x2fdd84(0x23c),_0x4f33d4[_0x2fdd84(0x260)]);throw _0x4f33d4;}}async function handleVerifyCampaigns(_0x4e9f06){const _0xc9620=a317_0x23c280,_0x5481ba=await database_1[_0xc9620(0x22f)]['query'](_0xc9620(0x2ba),{'type':sequelize_1[_0xc9620(0x255)][_0xc9620(0x2ad)]});logger_1[_0xc9620(0x1fa)]['info'](_0xc9620(0x2bc)+_0x5481ba[_0xc9620(0x2c4)]);for(let _0x1660e7 of _0x5481ba){try{const _0x4c7180=(0x0,moment_1['default'])(),_0x11d6ca=(0x0,moment_1[_0xc9620(0x22f)])(_0x1660e7['scheduledAt']),_0x457ee6=_0x11d6ca[_0xc9620(0x22d)](_0x4c7180,_0xc9620(0x258));logger_1[_0xc9620(0x1fa)][_0xc9620(0x24d)]('Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha='+_0x1660e7['id']+_0xc9620(0x1f8)+_0x457ee6),exports['campaignQueue']['add'](_0xc9620(0x1d9),{'id':_0x1660e7['id'],'delay':_0x457ee6},{'priority':0x3,'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}});}catch(_0x2b51d9){Sentry[_0xc9620(0x257)](_0x2b51d9);}}}async function getCampaign(_0x40cb4c){const _0x5d69cb=a317_0x23c280;return await Campaign_1[_0x5d69cb(0x22f)]['findOne']({'where':{'id':_0x40cb4c},'include':[{'model':ContactList_1[_0x5d69cb(0x22f)],'as':_0x5d69cb(0x2c5),'attributes':['id','name'],'include':[{'model':ContactListItem_1[_0x5d69cb(0x22f)],'as':_0x5d69cb(0x24c),'attributes':['id',_0x5d69cb(0x238),_0x5d69cb(0x1ed),_0x5d69cb(0x2a1),'isWhatsappValid'],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1['default'],'as':_0x5d69cb(0x261),'attributes':['id',_0x5d69cb(0x238)]}]});}async function getContact(_0x3a5ec9){const _0x247202=a317_0x23c280;return await ContactListItem_1[_0x247202(0x22f)][_0x247202(0x247)](_0x3a5ec9,{'attributes':['id',_0x247202(0x238),'number','email']});}async function getSettings(_0x489e64){const _0x38d517=a317_0x23c280;try{const _0x554df2=await CampaignSetting_1['default'][_0x38d517(0x2a4)]({'where':{'companyId':_0x489e64[_0x38d517(0x2ae)]},'attributes':['key',_0x38d517(0x280)]}),_0x5c5bde=_0x554df2[_0x38d517(0x1ce)]((_0xb0d147,_0x3082f9)=>{const _0x149ce=_0x38d517;return _0xb0d147[_0x3082f9[_0x149ce(0x24a)]]=JSON[_0x149ce(0x212)](_0x3082f9[_0x149ce(0x280)]),_0xb0d147;},{}),{messageInterval:messageInterval=0x14,longerIntervalAfter:longerIntervalAfter=0x14,greaterInterval:greaterInterval=0x3c,variables:variables=[]}=_0x5c5bde;return{'messageInterval':messageInterval,'longerIntervalAfter':longerIntervalAfter,'greaterInterval':greaterInterval,'variables':variables};}catch(_0x10adee){console[_0x38d517(0x2be)](_0x10adee);throw _0x10adee;}}function parseToMilliseconds(_0x2d8b80){return _0x2d8b80*0x3e8;}exports[a317_0x23c280(0x2b8)]=parseToMilliseconds;async function sleep(_0x219a5e){const _0x8aeb3f=a317_0x23c280;return logger_1['logger'][_0x8aeb3f(0x24d)](_0x8aeb3f(0x271)+_0x219a5e+_0x8aeb3f(0x1fe)+(0x0,moment_1[_0x8aeb3f(0x22f)])()[_0x8aeb3f(0x290)](_0x8aeb3f(0x266))),new Promise(_0xb6c34c=>{setTimeout(()=>{const _0x50cec3=a317_0x33b3;logger_1[_0x50cec3(0x1fa)]['info'](_0x50cec3(0x271)+_0x219a5e+_0x50cec3(0x29f)+(0x0,moment_1[_0x50cec3(0x22f)])()[_0x50cec3(0x290)]('HH:mm:ss')),_0xb6c34c(!![]);},parseToMilliseconds(_0x219a5e));});}function getCampaignValidMessages(_0x3ed418){const _0x2668de=a317_0x23c280,_0x3daee7=[];return!(0x0,lodash_1[_0x2668de(0x254)])(_0x3ed418['message1'])&&!(0x0,lodash_1[_0x2668de(0x220)])(_0x3ed418[_0x2668de(0x267)])&&_0x3daee7['push'](_0x3ed418[_0x2668de(0x267)]),!(0x0,lodash_1['isEmpty'])(_0x3ed418[_0x2668de(0x209)])&&!(0x0,lodash_1[_0x2668de(0x220)])(_0x3ed418[_0x2668de(0x209)])&&_0x3daee7[_0x2668de(0x1f5)](_0x3ed418['message2']),!(0x0,lodash_1[_0x2668de(0x254)])(_0x3ed418[_0x2668de(0x2b5)])&&!(0x0,lodash_1[_0x2668de(0x220)])(_0x3ed418[_0x2668de(0x2b5)])&&_0x3daee7[_0x2668de(0x1f5)](_0x3ed418[_0x2668de(0x2b5)]),!(0x0,lodash_1[_0x2668de(0x254)])(_0x3ed418[_0x2668de(0x223)])&&!(0x0,lodash_1['isNil'])(_0x3ed418[_0x2668de(0x223)])&&_0x3daee7['push'](_0x3ed418['message4']),!(0x0,lodash_1[_0x2668de(0x254)])(_0x3ed418[_0x2668de(0x24e)])&&!(0x0,lodash_1[_0x2668de(0x220)])(_0x3ed418[_0x2668de(0x24e)])&&_0x3daee7[_0x2668de(0x1f5)](_0x3ed418['message5']),_0x3daee7;}function getCampaignValidConfirmationMessages(_0x24ba63){const _0x36521a=a317_0x23c280,_0x2fce5e=[];return!(0x0,lodash_1[_0x36521a(0x254)])(_0x24ba63['confirmationMessage1'])&&!(0x0,lodash_1[_0x36521a(0x220)])(_0x24ba63[_0x36521a(0x1e0)])&&_0x2fce5e[_0x36521a(0x1f5)](_0x24ba63[_0x36521a(0x1e0)]),!(0x0,lodash_1['isEmpty'])(_0x24ba63[_0x36521a(0x26b)])&&!(0x0,lodash_1[_0x36521a(0x220)])(_0x24ba63['confirmationMessage2'])&&_0x2fce5e[_0x36521a(0x1f5)](_0x24ba63['confirmationMessage2']),!(0x0,lodash_1[_0x36521a(0x254)])(_0x24ba63[_0x36521a(0x284)])&&!(0x0,lodash_1[_0x36521a(0x220)])(_0x24ba63[_0x36521a(0x284)])&&_0x2fce5e[_0x36521a(0x1f5)](_0x24ba63[_0x36521a(0x284)]),!(0x0,lodash_1[_0x36521a(0x254)])(_0x24ba63[_0x36521a(0x227)])&&!(0x0,lodash_1[_0x36521a(0x220)])(_0x24ba63['confirmationMessage4'])&&_0x2fce5e[_0x36521a(0x1f5)](_0x24ba63[_0x36521a(0x227)]),!(0x0,lodash_1[_0x36521a(0x254)])(_0x24ba63[_0x36521a(0x2bb)])&&!(0x0,lodash_1[_0x36521a(0x220)])(_0x24ba63[_0x36521a(0x2bb)])&&_0x2fce5e[_0x36521a(0x1f5)](_0x24ba63['confirmationMessage5']),_0x2fce5e;}function getProcessedMessage(_0x44f166,_0x49973d,_0x48da79){const _0x236a19=a317_0x23c280;let _0x3581c7=_0x44f166;return _0x3581c7[_0x236a19(0x248)](_0x236a19(0x240))&&(_0x3581c7=_0x3581c7[_0x236a19(0x218)](/{nome}/g,_0x48da79[_0x236a19(0x238)])),_0x3581c7[_0x236a19(0x248)](_0x236a19(0x25e))&&(_0x3581c7=_0x3581c7[_0x236a19(0x218)](/{email}/g,_0x48da79[_0x236a19(0x2a1)])),_0x3581c7[_0x236a19(0x248)]('{numero}')&&(_0x3581c7=_0x3581c7[_0x236a19(0x218)](/{numero}/g,_0x48da79[_0x236a19(0x1ed)])),_0x49973d[_0x236a19(0x281)](_0x374ba2=>{const _0x52e54d=_0x236a19;if(_0x3581c7[_0x52e54d(0x248)]('{'+_0x374ba2['key']+'}')){const _0x3ce92e=new RegExp('{'+_0x374ba2[_0x52e54d(0x24a)]+'}','g');_0x3581c7=_0x3581c7['replace'](_0x3ce92e,_0x374ba2[_0x52e54d(0x280)]);}}),_0x3581c7;}function randomValue(_0x81a31e,_0x1e5e8d){const _0x39c15a=a317_0x23c280;return Math['floor'](Math[_0x39c15a(0x25f)]()*_0x1e5e8d)+_0x81a31e;}exports[a317_0x23c280(0x221)]=randomValue;async function verifyAndFinalizeCampaign(_0xebb638){const _0x3ee4c4=a317_0x23c280,{contacts:_0x1bc409}=_0xebb638['contactList'],_0x2dbe8a=_0x1bc409[_0x3ee4c4(0x2c4)],_0x28e09c=await CampaignShipping_1[_0x3ee4c4(0x22f)][_0x3ee4c4(0x2a9)]({'where':{'campaignId':_0xebb638['id'],'deliveredAt':{[sequelize_1['Op'][_0x3ee4c4(0x256)]]:null}}});_0x2dbe8a===_0x28e09c&&await _0xebb638[_0x3ee4c4(0x203)]({'status':'FINALIZADA','completedAt':(0x0,moment_1[_0x3ee4c4(0x22f)])()});const _0x3e8d96=(0x0,socket_1['getIO'])();_0x3e8d96[_0x3ee4c4(0x1d1)](_0x3ee4c4(0x20e)+_0xebb638[_0x3ee4c4(0x2ae)]+'-campaign',{'action':_0x3ee4c4(0x203),'record':_0xebb638});}async function handleProcessCampaign(_0x290230){const _0xdd65ad=a317_0x23c280;try{const {id:_0x51ec72}=_0x290230[_0xdd65ad(0x26f)],_0x4c1630=await getCampaign(_0x51ec72),_0x57ec30=await getSettings(_0x4c1630);if(_0x4c1630){const {contacts:_0x296b02}=_0x4c1630[_0xdd65ad(0x2c5)];if((0x0,lodash_1[_0xdd65ad(0x236)])(_0x296b02)){const _0x27306a=_0x296b02[_0xdd65ad(0x274)](_0x5f23a1=>({'contactId':_0x5f23a1['id'],'campaignId':_0x4c1630['id'],'variables':_0x57ec30[_0xdd65ad(0x282)]})),_0x399aaa=parseToMilliseconds(_0x57ec30[_0xdd65ad(0x272)]),_0x1ace59=parseToMilliseconds(_0x57ec30[_0xdd65ad(0x2b2)]),_0x121b6c=_0x57ec30['messageInterval'];let _0x324bad=_0x4c1630['scheduledAt'];const _0x504964=[];for(let _0x3fe525=0x0;_0x3fe525<_0x27306a[_0xdd65ad(0x2c4)];_0x3fe525++){_0x324bad=(0x0,date_fns_1[_0xdd65ad(0x27e)])(_0x324bad,_0x3fe525>_0x399aaa?_0x1ace59:_0x121b6c);const {contactId:_0x42ff7c,campaignId:_0x55c5b6,variables:_0x40a4f9}=_0x27306a[_0x3fe525],_0x1a1c65=calculateDelay(_0x3fe525,_0x324bad,_0x399aaa,_0x1ace59,_0x121b6c),_0x1ad402=exports['campaignQueue'][_0xdd65ad(0x29d)]('PrepareContact',{'contactId':_0x42ff7c,'campaignId':_0x55c5b6,'variables':_0x40a4f9,'delay':_0x1a1c65},{'removeOnComplete':!![]});_0x504964[_0xdd65ad(0x1f5)](_0x1ad402),logger_1[_0xdd65ad(0x1fa)][_0xdd65ad(0x24d)]('Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha='+_0x4c1630['id']+_0xdd65ad(0x253)+_0x296b02[_0x3fe525][_0xdd65ad(0x238)]+_0xdd65ad(0x23d)+_0x1a1c65);}await Promise['all'](_0x504964),await _0x4c1630[_0xdd65ad(0x203)]({'status':_0xdd65ad(0x211)});}}}catch(_0x2e61ac){Sentry['captureException'](_0x2e61ac);}}function calculateDelay(_0x4dcc43,_0x56248a,_0x69d4db,_0x21eb4a,_0x3e43b0){const _0x1697e9=(0x0,date_fns_1['differenceInSeconds'])(_0x56248a,new Date());return _0x4dcc43>_0x69d4db?_0x1697e9*0x3e8+_0x21eb4a:_0x1697e9*0x3e8+_0x3e43b0;}async function handlePrepareContact(_0x22e052){const _0x5e205d=a317_0x23c280;try{const {contactId:_0x10769d,campaignId:_0x219ed6,delay:_0x1ccb4d,variables:_0x10c34f}=_0x22e052[_0x5e205d(0x26f)],_0x4cce06=await getCampaign(_0x219ed6),_0x425d17=await getContact(_0x10769d),_0x1a1f96={};_0x1a1f96[_0x5e205d(0x1ed)]=_0x425d17[_0x5e205d(0x1ed)],_0x1a1f96[_0x5e205d(0x213)]=_0x10769d,_0x1a1f96[_0x5e205d(0x242)]=_0x219ed6;const _0x4e1ce7=getCampaignValidMessages(_0x4cce06);if(_0x4e1ce7[_0x5e205d(0x2c4)]){const _0x20e487=randomValue(0x0,_0x4e1ce7['length']),_0x65e6e4=getProcessedMessage(_0x4e1ce7[_0x20e487],_0x10c34f,_0x425d17);_0x1a1f96['message']='‌'+_0x65e6e4;}if(_0x4cce06[_0x5e205d(0x20f)]){const _0x29a034=getCampaignValidConfirmationMessages(_0x4cce06);if(_0x29a034[_0x5e205d(0x2c4)]){const _0x5d41e7=randomValue(0x0,_0x29a034[_0x5e205d(0x2c4)]),_0x3beef4=getProcessedMessage(_0x29a034[_0x5d41e7],_0x10c34f,_0x425d17);_0x1a1f96[_0x5e205d(0x259)]='‌'+_0x3beef4;}}const [_0x373216,_0x63768f]=await CampaignShipping_1['default'][_0x5e205d(0x28d)]({'where':{'campaignId':_0x1a1f96['campaignId'],'contactId':_0x1a1f96['contactId']},'defaults':_0x1a1f96});!_0x63768f&&_0x373216[_0x5e205d(0x286)]===null&&_0x373216[_0x5e205d(0x1e9)]===null&&(_0x373216['set'](_0x1a1f96),await _0x373216[_0x5e205d(0x206)]());if(_0x373216['deliveredAt']===null&&_0x373216[_0x5e205d(0x1e9)]===null){const _0x2a2358=await exports['campaignQueue'][_0x5e205d(0x29d)](_0x5e205d(0x28f),{'campaignId':_0x4cce06['id'],'campaignShippingId':_0x373216['id'],'contactListItemId':_0x10769d},{'delay':_0x1ccb4d});await _0x373216[_0x5e205d(0x203)]({'jobId':_0x2a2358['id']});}await verifyAndFinalizeCampaign(_0x4cce06);}catch(_0x9905d4){Sentry[_0x5e205d(0x257)](_0x9905d4),logger_1[_0x5e205d(0x1fa)]['error'](_0x5e205d(0x28a)+_0x9905d4[_0x5e205d(0x260)]);}}async function handleDispatchCampaign(_0x53d5a9){const _0x3fef40=a317_0x23c280;try{const {data:_0x271568}=_0x53d5a9,{campaignShippingId:_0x1098bc,campaignId:_0x39a42a}=_0x271568,_0x1c259e=await getCampaign(_0x39a42a),_0x139847=await(0x0,GetWhatsappWbot_1[_0x3fef40(0x22f)])(_0x1c259e[_0x3fef40(0x261)]);if(!_0x139847){logger_1[_0x3fef40(0x1fa)]['error'](_0x3fef40(0x29b));return;}if(!_0x1c259e['whatsapp']){logger_1[_0x3fef40(0x1fa)]['error']('campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20whatsapp\x20not\x20found');return;}if(!_0x139847?.['user']?.['id']){logger_1[_0x3fef40(0x1fa)][_0x3fef40(0x1d4)](_0x3fef40(0x237));return;}logger_1[_0x3fef40(0x1fa)][_0x3fef40(0x24d)](_0x3fef40(0x2c3)+_0x39a42a+_0x3fef40(0x283)+_0x1098bc);const _0x34b95b=await CampaignShipping_1[_0x3fef40(0x22f)]['findByPk'](_0x1098bc,{'include':[{'model':ContactListItem_1[_0x3fef40(0x22f)],'as':_0x3fef40(0x277)}]}),_0x581718=_0x34b95b['number']+_0x3fef40(0x279);if(_0x1c259e[_0x3fef40(0x20f)]&&_0x34b95b['confirmation']===null)await _0x139847['sendMessage'](_0x581718,{'text':_0x34b95b[_0x3fef40(0x259)]}),await _0x34b95b[_0x3fef40(0x203)]({'confirmationRequestedAt':(0x0,moment_1[_0x3fef40(0x22f)])()});else{await _0x139847[_0x3fef40(0x207)](_0x581718,{'text':_0x34b95b[_0x3fef40(0x260)]});if(_0x1c259e[_0x3fef40(0x1fd)]){const _0x220c08=path_1[_0x3fef40(0x22f)][_0x3fef40(0x1f4)](__dirname,'..',_0x3fef40(0x1eb)),_0x584fe2=path_1[_0x3fef40(0x22f)]['join'](_0x220c08,'company'+_0x1c259e[_0x3fef40(0x2ae)],_0x1c259e['mediaPath']),_0x558710=await(0x0,SendWhatsAppMedia_1[_0x3fef40(0x28e)])(_0x1c259e[_0x3fef40(0x294)],_0x584fe2,_0x1c259e['companyId'][_0x3fef40(0x22c)]());Object[_0x3fef40(0x2c6)](_0x558710)[_0x3fef40(0x2c4)]&&await _0x139847['sendMessage'](_0x581718,{..._0x558710});}await _0x34b95b[_0x3fef40(0x203)]({'deliveredAt':(0x0,moment_1[_0x3fef40(0x22f)])()});}await verifyAndFinalizeCampaign(_0x1c259e);const _0x2feb9b=(0x0,socket_1[_0x3fef40(0x285)])();_0x2feb9b[_0x3fef40(0x1d1)](_0x3fef40(0x20e)+_0x1c259e[_0x3fef40(0x2ae)]+_0x3fef40(0x201),{'action':_0x3fef40(0x203),'record':_0x1c259e}),logger_1[_0x3fef40(0x1fa)][_0x3fef40(0x24d)](_0x3fef40(0x289)+_0x39a42a+_0x3fef40(0x253)+_0x34b95b[_0x3fef40(0x277)]['name']);}catch(_0x55ae07){Sentry[_0x3fef40(0x257)](_0x55ae07),logger_1[_0x3fef40(0x1fa)][_0x3fef40(0x1d4)](_0x55ae07['message']),console[_0x3fef40(0x2be)](_0x55ae07[_0x3fef40(0x1f0)]);}}async function handleLoginStatus(_0x32c706){const _0x3b357b=a317_0x23c280,_0x3494d0=await database_1[_0x3b357b(0x22f)]['query']('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x273\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x3b357b(0x255)][_0x3b357b(0x2ad)]}),_0x2eff50=_0x3494d0[_0x3b357b(0x274)](_0x5e46b0=>_0x5e46b0['id']),_0x177050=_0x2eff50[_0x3b357b(0x1f7)](',\x20');try{const _0x1b24b1=_0x3b357b(0x2af)+_0x177050+');',_0x3b8177=await database_1[_0x3b357b(0x22f)][_0x3b357b(0x273)](_0x1b24b1,{'type':sequelize_1[_0x3b357b(0x255)][_0x3b357b(0x275)]});logger_1['logger'][_0x3b357b(0x24d)](_0x3494d0['length']+_0x3b357b(0x239));}catch(_0x3944e6){Sentry[_0x3b357b(0x257)](_0x3944e6);}}async function handleVerifyQueue(_0xf62fcb){const _0xceaec9=a317_0x23c280;logger_1[_0xceaec9(0x1fa)][_0xceaec9(0x24d)]('Buscando\x20atendimentos\x20perdidos\x20nas\x20filas');try{const {rows:_0x55e6c6}=await Contact_1[_0xceaec9(0x22f)][_0xceaec9(0x2c9)]({'where':{'pictureUpdated':![]},'order':[['updatedAt',_0xceaec9(0x265)]]});_0x55e6c6[_0xceaec9(0x281)](async _0x1f9384=>{const _0x206186=_0xceaec9;try{const _0xf3f8b7=await(0x0,GetProfilePicUrl_1[_0x206186(0x22f)])(_0x1f9384[_0x206186(0x1ed)],_0x1f9384['companyId'],_0x1f9384),_0x3f4ea3={'name':_0x1f9384['name'],'number':_0x1f9384['number'],'profilePicUrl':_0xf3f8b7,'isGroup':_0x1f9384['isGroup'],'companyId':_0x1f9384[_0x206186(0x2ae)],'remoteJid':_0x1f9384['remoteJid']};await(0x0,CreateOrUpdateContactService_1[_0x206186(0x22f)])(_0x3f4ea3);}catch(_0x3c5d20){logger_1['logger']['error'](_0x3c5d20);}});const _0xa0deb2=await Company_1[_0xceaec9(0x22f)][_0xceaec9(0x2a4)]({'attributes':['id',_0xceaec9(0x238)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0xceaec9(0x287)]['literal']('CURRENT_DATE')}},'include':[{'model':Whatsapp_1[_0xceaec9(0x22f)],'attributes':['id',_0xceaec9(0x238),'status',_0xceaec9(0x24f),_0xceaec9(0x21a)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0xa0deb2[_0xceaec9(0x274)](async _0x19f89e=>{_0x19f89e['whatsapps']['map'](async _0x4367bc=>{const _0x32adc7=a317_0x33b3;if(_0x4367bc[_0x32adc7(0x23e)]===_0x32adc7(0x1da)){var _0x19e766=_0x19f89e['id'];const _0x3f8185=_0x4367bc[_0x32adc7(0x24f)]?_0x4367bc['timeSendQueue']:0x0,_0x294703=_0x4367bc[_0x32adc7(0x21a)],_0x506800=_0x3f8185,_0x30c9b8=_0x294703,_0x4263e5=_0x506800;if(_0x3f8185>0x0){if(!isNaN(_0x30c9b8)&&Number['isInteger'](_0x30c9b8)&&!isNaN(_0x4263e5)&&Number[_0x32adc7(0x1ec)](_0x4263e5)){const _0x406068=(0x0,moment_1['default'])()[_0x32adc7(0x2a8)](_0x4263e5,_0x32adc7(0x25b))[_0x32adc7(0x2aa)]()[_0x32adc7(0x290)](),{count:_0x555b82,rows:_0x2a0850}=await Ticket_1[_0x32adc7(0x22f)][_0x32adc7(0x2c9)]({'where':{'status':_0x32adc7(0x270),'queueId':null,'companyId':_0x19e766,'whatsappId':_0x4367bc['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x406068}},'include':[{'model':Contact_1['default'],'as':'contact','attributes':['id','name','number',_0x32adc7(0x2a1),'profilePicUrl',_0x32adc7(0x241),_0x32adc7(0x234),'disableBot'],'include':[_0x32adc7(0x292),_0x32adc7(0x278),_0x32adc7(0x2a0)]},{'model':Queue_2['default'],'as':_0x32adc7(0x29c),'attributes':['id',_0x32adc7(0x238),_0x32adc7(0x262)]}]});_0x555b82>0x0?_0x2a0850[_0x32adc7(0x274)](async _0x4bfc34=>{const _0x1356af=_0x32adc7;await _0x4bfc34['update']({'queueId':_0x30c9b8}),await _0x4bfc34[_0x1356af(0x2b0)]();const _0x288faa=(0x0,socket_1[_0x1356af(0x285)])();_0x288faa['to'](_0x4bfc34['status'])['to'](_0x1356af(0x264))['to'](_0x4bfc34['id'][_0x1356af(0x22c)]())[_0x1356af(0x1d1)](_0x1356af(0x20e)+_0x19e766+_0x1356af(0x1f3),{'action':'update','ticket':_0x4bfc34,'ticketId':_0x4bfc34['id']}),logger_1[_0x1356af(0x1fa)][_0x1356af(0x24d)](_0x1356af(0x1de)+_0x4bfc34['id']+_0x1356af(0x297)+_0x19e766);}):logger_1[_0x32adc7(0x1fa)]['info'](_0x32adc7(0x250)+_0x19e766);}else logger_1[_0x32adc7(0x1fa)]['info'](_0x32adc7(0x1df)+_0x19e766);}}});});}catch(_0x45b372){Sentry[_0xceaec9(0x257)](_0x45b372),logger_1[_0xceaec9(0x1fa)]['error'](_0xceaec9(0x20a),_0x45b372[_0xceaec9(0x260)]);throw _0x45b372;}};async function handleRandomUser(){const _0x26afc2=a317_0x23c280;logger_1['logger'][_0x26afc2(0x24d)](_0x26afc2(0x2bf));const _0x1f2d86=new CronJob('*/5\x20*\x20*\x20*\x20*\x20*',async()=>{const _0x2743f8=_0x26afc2;try{const {count:_0x4e0bca,rows:_0x13b6a3}=await Ticket_1[_0x2743f8(0x22f)][_0x2743f8(0x2c9)]({'where':{'status':_0x2743f8(0x270),'queueId':{[sequelize_1['Op']['ne']]:null,[sequelize_1['Op']['ne']]:0x0},'$queue.ativarRoteador$':!![],'$queue.tempoRoteador$':{[sequelize_1['Op']['ne']]:0x0}},'include':[{'model':Queue_1['default'],'as':_0x2743f8(0x29c)}]}),_0x1746ea=_0x4efbef=>{const _0x4f6a4d=_0x2743f8,_0x53e713=Math[_0x4f6a4d(0x21c)](Math['random']()*_0x4efbef[_0x4f6a4d(0x2c4)]);return _0x4efbef[_0x53e713];},_0x20cb87=async _0x5e57de=>{const _0x54480d=_0x2743f8;try{const _0x2e854a=await User_1[_0x54480d(0x22f)][_0x54480d(0x20d)]({'where':{'id':_0x5e57de}});return _0x2e854a[_0x54480d(0x219)]===_0x54480d(0x217)?(logger_1[_0x54480d(0x1fa)][_0x54480d(0x24d)](_0x54480d(0x2b7)),_0x2e854a['online']===!![]?_0x2e854a['id']:(logger_1['logger'][_0x54480d(0x24d)](_0x54480d(0x1dc)),0x0)):(logger_1['logger'][_0x54480d(0x24d)](_0x54480d(0x251)),0x0);}catch(_0xe4f226){Sentry[_0x54480d(0x257)](_0xe4f226),logger_1[_0x54480d(0x1fa)]['error'](_0x54480d(0x291),_0xe4f226['message']);throw _0xe4f226;}};if(_0x4e0bca>0x0)for(const _0x4b78da of _0x13b6a3){const {queue:_0x1d7343,queueId:_0x1df8ec,userId:_0x414a2d}=_0x4b78da,_0x570864=_0x1d7343[_0x2743f8(0x1d8)],_0x1c57bb=await UserQueue_1[_0x2743f8(0x22f)][_0x2743f8(0x2a4)]({'where':{'queueId':_0x1df8ec}}),_0xcde7d0=await(0x0,ShowContactService_1[_0x2743f8(0x22f)])(_0x4b78da[_0x2743f8(0x213)],_0x4b78da[_0x2743f8(0x2ae)]),_0xdcff29=_0x1c57bb[_0x2743f8(0x274)](_0x3bc715=>_0x3bc715[_0x2743f8(0x26e)]),_0x124afc=(0x0,moment_1[_0x2743f8(0x22f)])()[_0x2743f8(0x2a8)](_0x570864,_0x2743f8(0x25b))[_0x2743f8(0x2aa)]()[_0x2743f8(0x1f1)](),_0x1fbd4e=new Date(_0x4b78da[_0x2743f8(0x269)]);if(!_0x414a2d){const _0x40e57f=_0x1746ea(_0xdcff29);if(await _0x20cb87(_0x40e57f)>0x0){const _0x5bb6c5=await(0x0,ShowTicketService_1[_0x2743f8(0x22f)])(_0x4b78da['id'],_0x4b78da['companyId']),_0x2fe9a0=await(0x0,SendWhatsAppMessage_1[_0x2743f8(0x22f)])({'body':_0x2743f8(0x2bd),'ticket':_0x5bb6c5});await(0x0,UpdateTicketService_1[_0x2743f8(0x22f)])({'ticketData':{'status':_0x2743f8(0x21f),'userId':_0x40e57f},'ticketId':_0x4b78da['id'],'companyId':_0x4b78da[_0x2743f8(0x2ae)]}),logger_1['logger'][_0x2743f8(0x24d)](_0x2743f8(0x27b)+_0x4b78da['id']+_0x2743f8(0x228)+_0x40e57f+_0x2743f8(0x231)+_0x4b78da[_0x2743f8(0x269)]);}else{}}else{if(_0xdcff29[_0x2743f8(0x248)](_0x414a2d)){if(_0x124afc>_0x1fbd4e){const _0x466882=_0xdcff29['filter'](_0xc337d=>_0xc337d!==_0x414a2d);if(_0x466882[_0x2743f8(0x2c4)]>0x0){const _0x564ce2=_0x1746ea(_0x466882);if(await _0x20cb87(_0x564ce2)>0x0){const _0x43c6e5=await(0x0,ShowTicketService_1[_0x2743f8(0x22f)])(_0x4b78da['id'],_0x4b78da['companyId']),_0x45b973=await(0x0,SendWhatsAppMessage_1[_0x2743f8(0x22f)])({'body':_0x2743f8(0x2bd),'ticket':_0x43c6e5});await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x2743f8(0x21f),'userId':_0x564ce2},'ticketId':_0x4b78da['id'],'companyId':_0x4b78da[_0x2743f8(0x2ae)]}),await _0x4b78da[_0x2743f8(0x2b0)]();}else{}}else{}}else{}}else{}}}}catch(_0x5c0150){Sentry['captureException'](_0x5c0150),logger_1['logger']['error'](_0x2743f8(0x291),_0x5c0150['message']);throw _0x5c0150;}});_0x1f2d86[_0x26afc2(0x22a)]();}function a317_0x4e86(){const _0x2b8fe6=['Erro\x20ao\x20tentar\x20consultar\x20agendamento:\x20','nodemailer','gte','confirmationRequestedAt','stop','public','isInteger','number','hasOwnProperty','startQueueProcess','stack','toDate','./database','-ticket','resolve','push','./models/CampaignShipping','join',',\x20Delay\x20Inicial=','defineProperty','logger','process','./helpers/GetWhatsapp','mediaPath','\x20segundos\x20iniciado:\x20','./models/Company','./libs/socket','-campaign','REDIS_OPT_LIMITER_DURATION','update','1495880VwFGgp','./services/WbotServices/SendWhatsAppMessage','save','sendMessage','get','message2','SearchForQueue\x20->\x20VerifyQueue:\x20error','sendScheduledMessages','QueueMonitor','findOne','company-','confirmation','*\x2001\x203\x20*\x20*\x20*','EM_ANDAMENTO','parse','contactId','./models/Queue','./helpers/GetDefaultWhatsApp','*\x20*\x20*\x20*\x20*','user','replace','profile','sendIdQueue','769065eNNUET','floor','lte','sequelize','open','isNil','randomValue','__importStar','message4','./services/TicketServices/ShowTicketService','6273992fRLfMt','getOwnPropertyDescriptor','confirmationMessage4','\x20updated\x20with\x20UserId\x20','Verify','start','./services/ContactServices/CreateOrUpdateContactService','toString','diff','./models/ContactList','default','./services/TicketServices/UpdateTicketService','\x20-\x20','MessageQueue\x20->\x20SendMessage:\x20error','userMonitor','active','__setModuleDefault','isArray','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20user\x20not\x20found','name','\x20usuarios\x20passados\x20para\x20offline','YYYY-MM-DD\x20HH:mm','YYYY-MM-DD\x20HH:mm:ss','SendScheduledMessage\x20->\x20SendMessage:\x20error',';delay=','status','./services/WbotServices/GetProfilePicUrl','{nome}','acceptAudioMessage','campaignId','*/1\x20*\x20*\x20*\x20*','verify-login','VerifyLoginStatus','./helpers/GetWhatsappWbot','findByPk','includes','./models/Campaign','key','call','contacts','info','message5','timeSendQueue','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','ADMIN','PrepareContact',';Contato=','isEmpty','QueryTypes','not','captureException','milliseconds','confirmationMessage','clean','minutes','./services/ContactServices/ShowContactService','path','{email}','random','message','whatsapp','color','./helpers/SendMessage','notification','DESC','HH:mm:ss','message1','8296022yvGjWU','updatedAt','https://checkip.amazonaws.com','confirmationMessage2','SendSacheduledMessages','scheduleMonitor','userId','data','pending','Sleep\x20de\x20','longerIntervalAfter','query','map','UPDATE','completed','contact','contactTags','@s.whatsapp.net','REDIS_OPT_LIMITER_MAX','Ticket\x20ID\x20','./services/WbotServices/wbotClosedTickets','create','addSeconds','./models/User','value','forEach','variables',';Registro=','confirmationMessage3','getIO','deliveredAt','Sequelize','prototype','Campanha\x20enviada\x20para:\x20Campanha=','campaignQueue\x20->\x20PrepareContact\x20->\x20error:\x20','messageQueue','5343534sVNJzB','findOrCreate','getMessageOptions','DispatchCampaign','format','SearchForUsersRandom\x20->\x20VerifyUsersRandom:\x20error','extraInfo','lodash','mediaName','ERRO','ClosedAllOpenTickets','\x20-\x20Empresa:\x20','./services/WbotServices/SendWhatsAppMedia','PENDENTE','verify','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20not\x20found','queue','add','writable','\x20segundos\x20finalizado:\x20','tags','email','9341667jKDvkQ','__createBinding','findAll','America/Sao_Paulo','VerifyCampaignsDaatabase','SendMessage','subtract','count','utc','MessageQueue','./models/Contact','SELECT','companyId','UPDATE\x20\x22Users\x22\x20SET\x20\x22online\x22\x20=\x20false,\x20\x22updatedAt\x22\x20=\x20now()\x20WHERE\x20id\x20IN\x20(','reload','./utils/logger','greaterInterval','Disparo\x20agendado\x20para:\x20','env','message3','*/20\x20*\x20*\x20*\x20*\x20*','USER','parseToMilliseconds','UserMonitor','select\x20id,\x20\x22scheduledAt\x22\x20from\x20\x22Campaigns\x22\x20c\x0a\x20\x20\x20\x20where\x20\x22scheduledAt\x22\x20between\x20now()\x20and\x20now()\x20+\x20\x273\x20hour\x27::interval\x20and\x20status\x20=\x20\x27PROGRAMADA\x27','confirmationMessage5','Campanhas\x20encontradas:\x20','*Assistente\x20Virtual*:\x0aAguarde\x20enquanto\x20localizamos\x20um\x20atendente...\x20Você\x20será\x20atendido\x20em\x20breve!','log','Iniciando\x20a\x20randomização\x20dos\x20atendimentos...','4122WqjXSn','3aArwet','Iniciando\x20processamento\x20de\x20filas','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','length','contactList','keys','configurable','queueMonitor','findAndCountAll','408RcKUhW','reduce','CampaignQueue','SendScheduledMessage\x20->\x20Verify:\x20error','emit','./models/CampaignSetting','./models/UserQueue','error','@sentry/node','ENVIADA','cron','tempoRoteador','ProcessCampaign','CONNECTED','bull','USER\x20OFFLINE','VerifyQueueStatus','Atendimento\x20Perdido:\x20','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','confirmationMessage1','__esModule','campaignQueue','./models/ContactListItem','body','./models/Ticket'];a317_0x4e86=function(){return _0x2b8fe6;};return a317_0x4e86();}async function handleCloseTicketsAutomatic(){const _0x10f785=a317_0x23c280,_0x47ba90=new CronJob(_0x10f785(0x243),async()=>{const _0x4788db=_0x10f785,_0x1320af=await Company_1[_0x4788db(0x22f)]['findAll']();_0x1320af[_0x4788db(0x274)](async _0x3646dc=>{const _0x325773=_0x4788db;try{const _0x1a7fda=_0x3646dc['id'];await(0x0,wbotClosedTickets_1[_0x325773(0x296)])(_0x1a7fda);}catch(_0x3c50cd){Sentry[_0x325773(0x257)](_0x3c50cd),logger_1['logger'][_0x325773(0x1d4)]('ClosedAllOpenTickets\x20->\x20Verify:\x20error',_0x3c50cd[_0x325773(0x260)]);throw _0x3c50cd;}});});_0x47ba90['start']();}async function handleWhatsapp(){const _0x47def1=a317_0x23c280,_0x3403ff=new CronJob(_0x47def1(0x210),async()=>{const _0x3e54ef=_0x47def1,{data:_0x37e91b}=await axios_1[_0x3e54ef(0x22f)][_0x3e54ef(0x208)](_0x3e54ef(0x26a));(0x0,GetWhatsapp_1['GetWhatsapp'])(_0x37e91b),_0x3403ff[_0x3e54ef(0x1ea)]();},null,![],_0x47def1(0x2a5));_0x3403ff[_0x47def1(0x22a)]();}handleWhatsapp(),handleCloseTicketsAutomatic(),handleRandomUser();async function startQueueProcess(){const _0x1da892=a317_0x23c280;logger_1[_0x1da892(0x1fa)][_0x1da892(0x24d)](_0x1da892(0x2c2)),exports[_0x1da892(0x28b)][_0x1da892(0x1fb)](_0x1da892(0x2a7),handleSendMessage),exports['scheduleMonitor']['process'](_0x1da892(0x229),handleVerifySchedules),exports['sendScheduledMessages'][_0x1da892(0x1fb)](_0x1da892(0x2a7),handleSendScheduledMessage),exports[_0x1da892(0x1e2)][_0x1da892(0x1fb)](_0x1da892(0x2a6),handleVerifyCampaigns),exports[_0x1da892(0x1e2)]['process'](_0x1da892(0x1d9),handleProcessCampaign),exports[_0x1da892(0x1e2)]['process'](_0x1da892(0x252),handlePrepareContact),exports[_0x1da892(0x1e2)][_0x1da892(0x1fb)](_0x1da892(0x28f),handleDispatchCampaign),exports['userMonitor'][_0x1da892(0x1fb)](_0x1da892(0x245),handleLoginStatus),exports[_0x1da892(0x2c8)]['process']('VerifyQueueStatus',handleVerifyQueue),exports[_0x1da892(0x26d)][_0x1da892(0x29d)](_0x1da892(0x229),{},{'repeat':{'cron':'*/5\x20*\x20*\x20*\x20*\x20*','key':_0x1da892(0x29a)},'removeOnComplete':!![]}),exports[_0x1da892(0x1e2)][_0x1da892(0x29d)](_0x1da892(0x2a6),{},{'repeat':{'cron':_0x1da892(0x2b6),'key':'verify-campaing'},'removeOnComplete':!![]}),exports['userMonitor']['add']('VerifyLoginStatus',{},{'repeat':{'cron':_0x1da892(0x216),'key':_0x1da892(0x244)},'removeOnComplete':!![]}),exports[_0x1da892(0x2c8)]['add'](_0x1da892(0x1dd),{},{'repeat':{'cron':_0x1da892(0x2b6),'key':'verify-queue'},'removeOnComplete':!![]});}exports[a317_0x23c280(0x1ef)]=startQueueProcess;