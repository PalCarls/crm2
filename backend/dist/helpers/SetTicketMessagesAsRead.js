'use strict';const a286_0x1ffd85=a286_0x3b4d;(function(_0x258c78,_0x294660){const _0xe2074=a286_0x3b4d,_0x357c7c=_0x258c78();while(!![]){try{const _0x111fe5=parseInt(_0xe2074(0x188))/0x1+-parseInt(_0xe2074(0x180))/0x2+parseInt(_0xe2074(0x171))/0x3*(-parseInt(_0xe2074(0x17c))/0x4)+parseInt(_0xe2074(0x163))/0x5+-parseInt(_0xe2074(0x17d))/0x6*(-parseInt(_0xe2074(0x172))/0x7)+-parseInt(_0xe2074(0x187))/0x8*(parseInt(_0xe2074(0x160))/0x9)+parseInt(_0xe2074(0x162))/0xa*(parseInt(_0xe2074(0x176))/0xb);if(_0x111fe5===_0x294660)break;else _0x357c7c['push'](_0x357c7c['shift']());}catch(_0x1ffe49){_0x357c7c['push'](_0x357c7c['shift']());}}}(a286_0xd15d,0x4f3d9));var __importDefault=this&&this[a286_0x1ffd85(0x184)]||function(_0x27d802){const _0x2aa86f=a286_0x1ffd85;return _0x27d802&&_0x27d802[_0x2aa86f(0x167)]?_0x27d802:{'default':_0x27d802};};Object[a286_0x1ffd85(0x16d)](exports,'__esModule',{'value':!![]});function a286_0xd15d(){const _0x105887=['readMessages','dataJson','217080UDyQPx','company-','emit','parse','__importDefault','status','isGroup','89480zjpajL','605012VMLUMx','../libs/socket','userId','isBot','getIO','171QYPJxh','default','264170qxFnho','95900zplDEP','./GetTicketWbot','notification','contactId','__esModule','key','set','channel','findAll','companyId','defineProperty','forEach','fromMe','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','521259QVEKhb','322eOinuC','-ticket','contacts:','updateUnread','132IpnqNA',':unreads','whatsapp','../utils/logger','logger','length','8xOTwsB','6774eZYRND'];a286_0xd15d=function(){return _0x105887;};return a286_0xd15d();}function a286_0x3b4d(_0x1dd83a,_0x57d013){const _0xd15dd8=a286_0xd15d();return a286_0x3b4d=function(_0x3b4dbd,_0x9363b7){_0x3b4dbd=_0x3b4dbd-0x15e;let _0x1cd3a1=_0xd15dd8[_0x3b4dbd];return _0x1cd3a1;},a286_0x3b4d(_0x1dd83a,_0x57d013);}const cache_1=__importDefault(require('../libs/cache')),socket_1=require(a286_0x1ffd85(0x189)),Message_1=__importDefault(require('../models/Message')),logger_1=require(a286_0x1ffd85(0x179)),GetTicketWbot_1=__importDefault(require(a286_0x1ffd85(0x164))),SetTicketMessagesAsRead=async _0x4ab614=>{const _0x3c23a2=a286_0x1ffd85;!_0x4ab614['isBot']&&(_0x4ab614[_0x3c23a2(0x18a)]||_0x4ab614[_0x3c23a2(0x186)])&&(await _0x4ab614['update']({'unreadMessages':0x0}),await cache_1[_0x3c23a2(0x161)][_0x3c23a2(0x169)](_0x3c23a2(0x174)+_0x4ab614[_0x3c23a2(0x166)]+_0x3c23a2(0x177),'0'));if(_0x4ab614[_0x3c23a2(0x16a)]===_0x3c23a2(0x178))try{const _0x3ab6f7=await(0x0,GetTicketWbot_1[_0x3c23a2(0x161)])(_0x4ab614),_0x14f0cb=await Message_1[_0x3c23a2(0x161)][_0x3c23a2(0x16b)]({'where':{'ticketId':_0x4ab614['id'],'fromMe':![],'read':![]},'order':[['createdAt','DESC']]});_0x14f0cb[_0x3c23a2(0x17b)]>0x0&&_0x14f0cb[_0x3c23a2(0x16e)](async _0x3badeb=>{const _0x36ec41=_0x3c23a2,_0x13c3f3=JSON[_0x36ec41(0x183)](_0x3badeb[_0x36ec41(0x17f)]);_0x13c3f3[_0x36ec41(0x168)]&&_0x13c3f3['key'][_0x36ec41(0x16f)]===![]&&!_0x4ab614[_0x36ec41(0x15e)]&&(_0x4ab614[_0x36ec41(0x18a)]||_0x4ab614[_0x36ec41(0x186)])&&await _0x3ab6f7[_0x36ec41(0x17e)]([_0x13c3f3[_0x36ec41(0x168)]]);}),!_0x4ab614[_0x3c23a2(0x15e)]&&(_0x4ab614['userId']||_0x4ab614[_0x3c23a2(0x186)])&&await Message_1[_0x3c23a2(0x161)]['update']({'read':!![]},{'where':{'ticketId':_0x4ab614['id'],'read':![]}});}catch(_0x16b980){console['log'](_0x16b980),logger_1[_0x3c23a2(0x17a)]['warn'](_0x3c23a2(0x170)+_0x16b980);}const _0x1121f0=(0x0,socket_1[_0x3c23a2(0x15f)])();_0x1121f0['to'](_0x4ab614[_0x3c23a2(0x185)])['to'](_0x3c23a2(0x165))[_0x3c23a2(0x182)](_0x3c23a2(0x181)+_0x4ab614[_0x3c23a2(0x16c)]+_0x3c23a2(0x173),{'action':_0x3c23a2(0x175),'ticketId':_0x4ab614['id']});};exports['default']=SetTicketMessagesAsRead;