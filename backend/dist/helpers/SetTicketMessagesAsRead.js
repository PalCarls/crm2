'use strict';const a250_0x121b7b=a250_0x2e0e;(function(_0x382a63,_0x4a01b0){const _0x36cf45=a250_0x2e0e,_0x5826ea=_0x382a63();while(!![]){try{const _0x258c3e=-parseInt(_0x36cf45(0x12c))/0x1+-parseInt(_0x36cf45(0x146))/0x2+parseInt(_0x36cf45(0x151))/0x3+-parseInt(_0x36cf45(0x148))/0x4*(-parseInt(_0x36cf45(0x139))/0x5)+parseInt(_0x36cf45(0x13c))/0x6+parseInt(_0x36cf45(0x13b))/0x7*(-parseInt(_0x36cf45(0x12f))/0x8)+-parseInt(_0x36cf45(0x141))/0x9;if(_0x258c3e===_0x4a01b0)break;else _0x5826ea['push'](_0x5826ea['shift']());}catch(_0x4e9d21){_0x5826ea['push'](_0x5826ea['shift']());}}}(a250_0x85ab,0x87114));function a250_0x85ab(){const _0x35f403=['log','length','120376ntgzks','updateUnread','userId','fromMe','key','emit','isBot','findAll','channel','set','6530OKezpD','contactId','77AcWWDy','6520038wsGGYK','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','DESC','-ticket','logger','8975844GapaRI','default','../libs/socket','parse','dataJson','1372048HMbiPy','notification','2812CwcqhD','defineProperty','__importDefault','__esModule','../libs/cache','../utils/logger','./GetTicketWbot','company-','createdAt','3163326PiRqLX',':unreads','657140TBSMnB'];a250_0x85ab=function(){return _0x35f403;};return a250_0x85ab();}var __importDefault=this&&this[a250_0x121b7b(0x14a)]||function(_0x56300d){const _0x3a020b=a250_0x121b7b;return _0x56300d&&_0x56300d[_0x3a020b(0x14b)]?_0x56300d:{'default':_0x56300d};};function a250_0x2e0e(_0x3cc064,_0x443d54){const _0x85abc8=a250_0x85ab();return a250_0x2e0e=function(_0x2e0e32,_0x239cf2){_0x2e0e32=_0x2e0e32-0x12c;let _0x46315d=_0x85abc8[_0x2e0e32];return _0x46315d;},a250_0x2e0e(_0x3cc064,_0x443d54);}Object[a250_0x121b7b(0x149)](exports,'__esModule',{'value':!![]});const cache_1=__importDefault(require(a250_0x121b7b(0x14c))),socket_1=require(a250_0x121b7b(0x143)),Message_1=__importDefault(require('../models/Message')),logger_1=require(a250_0x121b7b(0x14d)),GetTicketWbot_1=__importDefault(require(a250_0x121b7b(0x14e))),SetTicketMessagesAsRead=async _0x23d05b=>{const _0x8228a4=a250_0x121b7b;!_0x23d05b[_0x8228a4(0x135)]&&_0x23d05b[_0x8228a4(0x131)]&&(await _0x23d05b['update']({'unreadMessages':0x0}),await cache_1['default'][_0x8228a4(0x138)]('contacts:'+_0x23d05b[_0x8228a4(0x13a)]+_0x8228a4(0x152),'0'));if(_0x23d05b[_0x8228a4(0x137)]==='whatsapp')try{const _0xcb89f1=await(0x0,GetTicketWbot_1[_0x8228a4(0x142)])(_0x23d05b),_0x376ac9=await Message_1[_0x8228a4(0x142)][_0x8228a4(0x136)]({'where':{'ticketId':_0x23d05b['id'],'fromMe':![],'read':![]},'order':[[_0x8228a4(0x150),_0x8228a4(0x13e)]]});_0x376ac9[_0x8228a4(0x12e)]>0x0&&_0x376ac9['forEach'](async _0xa74cdc=>{const _0xe1b3d=_0x8228a4,_0x32761d=JSON[_0xe1b3d(0x144)](_0xa74cdc[_0xe1b3d(0x145)]);_0x32761d['key']&&_0x32761d[_0xe1b3d(0x133)][_0xe1b3d(0x132)]===![]&&!_0x23d05b[_0xe1b3d(0x135)]&&_0x23d05b[_0xe1b3d(0x131)]&&await _0xcb89f1['readMessages']([_0x32761d[_0xe1b3d(0x133)]]);}),!_0x23d05b[_0x8228a4(0x135)]&&_0x23d05b[_0x8228a4(0x131)]&&await Message_1[_0x8228a4(0x142)]['update']({'read':!![]},{'where':{'ticketId':_0x23d05b['id'],'read':![]}});}catch(_0x1be8eb){console[_0x8228a4(0x12d)](_0x1be8eb),logger_1[_0x8228a4(0x140)]['warn'](_0x8228a4(0x13d)+_0x1be8eb);}const _0x762248=(0x0,socket_1['getIO'])();_0x762248['to'](_0x23d05b['status'])['to'](_0x8228a4(0x147))[_0x8228a4(0x134)](_0x8228a4(0x14f)+_0x23d05b['companyId']+_0x8228a4(0x13f),{'action':_0x8228a4(0x130),'ticketId':_0x23d05b['id']});};exports['default']=SetTicketMessagesAsRead;