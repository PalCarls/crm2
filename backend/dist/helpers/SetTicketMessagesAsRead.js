'use strict';const a265_0xe4bffe=a265_0x1871;(function(_0x3aa721,_0xbe6bf2){const _0x499cd0=a265_0x1871,_0x4830ab=_0x3aa721();while(!![]){try{const _0x109706=parseInt(_0x499cd0(0xba))/0x1+parseInt(_0x499cd0(0xb5))/0x2+-parseInt(_0x499cd0(0xb1))/0x3*(parseInt(_0x499cd0(0xb3))/0x4)+parseInt(_0x499cd0(0x9d))/0x5+parseInt(_0x499cd0(0xb9))/0x6+parseInt(_0x499cd0(0x9e))/0x7*(-parseInt(_0x499cd0(0xbc))/0x8)+-parseInt(_0x499cd0(0xbd))/0x9*(parseInt(_0x499cd0(0xa4))/0xa);if(_0x109706===_0xbe6bf2)break;else _0x4830ab['push'](_0x4830ab['shift']());}catch(_0x4e6ca3){_0x4830ab['push'](_0x4830ab['shift']());}}}(a265_0x272a,0x9c422));var __importDefault=this&&this[a265_0xe4bffe(0xa6)]||function(_0xfa07a2){return _0xfa07a2&&_0xfa07a2['__esModule']?_0xfa07a2:{'default':_0xfa07a2};};function a265_0x1871(_0x4eeeb4,_0x59b9fb){const _0x272a8b=a265_0x272a();return a265_0x1871=function(_0x1871a3,_0x54da22){_0x1871a3=_0x1871a3-0x9a;let _0xe7ab67=_0x272a8b[_0x1871a3];return _0xe7ab67;},a265_0x1871(_0x4eeeb4,_0x59b9fb);}Object[a265_0xe4bffe(0xad)](exports,a265_0xe4bffe(0xc3),{'value':!![]});function a265_0x272a(){const _0x4daaa0=['forEach','update','../utils/logger','11798060DDpjGU','key','__importDefault','contactId','DESC','channel','fromMe','status','readMessages','defineProperty','../libs/cache','emit','notification','656061RIQvJt','set','16XtxzxT','log','1812330JchOyx','isGroup','-ticket','userId','4805652nAVVKO','604209huhYEv',':unreads','53576gdbHjc','9nONVrx','findAll','logger','isBot','createdAt','default','__esModule','company-','./GetTicketWbot','dataJson','5030465FNtNVC','651anSfWj','contacts:','getIO'];a265_0x272a=function(){return _0x4daaa0;};return a265_0x272a();}const cache_1=__importDefault(require(a265_0xe4bffe(0xae))),socket_1=require('../libs/socket'),Message_1=__importDefault(require('../models/Message')),logger_1=require(a265_0xe4bffe(0xa3)),GetTicketWbot_1=__importDefault(require(a265_0xe4bffe(0x9b))),SetTicketMessagesAsRead=async _0x1818b7=>{const _0x11ad44=a265_0xe4bffe;!_0x1818b7[_0x11ad44(0xc0)]&&(_0x1818b7[_0x11ad44(0xb8)]||_0x1818b7[_0x11ad44(0xb6)])&&(await _0x1818b7[_0x11ad44(0xa2)]({'unreadMessages':0x0}),await cache_1[_0x11ad44(0xc2)][_0x11ad44(0xb2)](_0x11ad44(0x9f)+_0x1818b7[_0x11ad44(0xa7)]+_0x11ad44(0xbb),'0'));if(_0x1818b7[_0x11ad44(0xa9)]==='whatsapp')try{const _0x2d6045=await(0x0,GetTicketWbot_1['default'])(_0x1818b7),_0x5d92fe=await Message_1[_0x11ad44(0xc2)][_0x11ad44(0xbe)]({'where':{'ticketId':_0x1818b7['id'],'fromMe':![],'read':![]},'order':[[_0x11ad44(0xc1),_0x11ad44(0xa8)]]});_0x5d92fe['length']>0x0&&_0x5d92fe[_0x11ad44(0xa1)](async _0x117095=>{const _0x5819ad=_0x11ad44,_0x1e637d=JSON['parse'](_0x117095[_0x5819ad(0x9c)]);_0x1e637d[_0x5819ad(0xa5)]&&_0x1e637d['key'][_0x5819ad(0xaa)]===![]&&!_0x1818b7[_0x5819ad(0xc0)]&&(_0x1818b7[_0x5819ad(0xb8)]||_0x1818b7[_0x5819ad(0xb6)])&&await _0x2d6045[_0x5819ad(0xac)]([_0x1e637d[_0x5819ad(0xa5)]]);}),!_0x1818b7[_0x11ad44(0xc0)]&&(_0x1818b7[_0x11ad44(0xb8)]||_0x1818b7[_0x11ad44(0xb6)])&&await Message_1[_0x11ad44(0xc2)][_0x11ad44(0xa2)]({'read':!![]},{'where':{'ticketId':_0x1818b7['id'],'read':![]}});}catch(_0x1c448b){console[_0x11ad44(0xb4)](_0x1c448b),logger_1[_0x11ad44(0xbf)]['warn']('Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20'+_0x1c448b);}const _0xa09886=(0x0,socket_1[_0x11ad44(0xa0)])();_0xa09886['to'](_0x1818b7[_0x11ad44(0xab)])['to'](_0x11ad44(0xb0))[_0x11ad44(0xaf)](_0x11ad44(0x9a)+_0x1818b7['companyId']+_0x11ad44(0xb7),{'action':'updateUnread','ticketId':_0x1818b7['id']});};exports['default']=SetTicketMessagesAsRead;