'use strict';const a260_0x3feb51=a260_0x3df9;function a260_0x3df9(_0x4f30d5,_0x43a5ba){const _0x487b9d=a260_0x487b();return a260_0x3df9=function(_0x3df9da,_0x9bf83f){_0x3df9da=_0x3df9da-0x11c;let _0x38215c=_0x487b9d[_0x3df9da];return _0x38215c;},a260_0x3df9(_0x4f30d5,_0x43a5ba);}(function(_0x311316,_0x26d6f1){const _0x538086=a260_0x3df9,_0x4d5192=_0x311316();while(!![]){try{const _0x178591=parseInt(_0x538086(0x12e))/0x1+parseInt(_0x538086(0x121))/0x2+parseInt(_0x538086(0x129))/0x3+-parseInt(_0x538086(0x141))/0x4*(parseInt(_0x538086(0x130))/0x5)+-parseInt(_0x538086(0x137))/0x6+-parseInt(_0x538086(0x127))/0x7+parseInt(_0x538086(0x12d))/0x8*(parseInt(_0x538086(0x125))/0x9);if(_0x178591===_0x26d6f1)break;else _0x4d5192['push'](_0x4d5192['shift']());}catch(_0x11bd14){_0x4d5192['push'](_0x4d5192['shift']());}}}(a260_0x487b,0xa4f26));var __importDefault=this&&this[a260_0x3feb51(0x13f)]||function(_0x2eb086){return _0x2eb086&&_0x2eb086['__esModule']?_0x2eb086:{'default':_0x2eb086};};function a260_0x487b(){const _0x2894d4=['updateUnread','2502426BMaJcq','forEach','emit','./GetTicketWbot','369ABQPLd','logger','6165243VMlRUO','company-','1339080CUBibv','DESC','isBot','-ticket','366624BsEXKT','218397IJCQSm','__esModule','310240kXIwUo','defineProperty','userId','createdAt','update','log','whatsapp','5613234RRKFqN','parse','warn','readMessages','default','findAll','fromMe','contactId','__importDefault','length','84udchHr','../libs/cache','contacts:','../models/Message','key'];a260_0x487b=function(){return _0x2894d4;};return a260_0x487b();}Object[a260_0x3feb51(0x131)](exports,a260_0x3feb51(0x12f),{'value':!![]});const cache_1=__importDefault(require(a260_0x3feb51(0x11c))),socket_1=require('../libs/socket'),Message_1=__importDefault(require(a260_0x3feb51(0x11e))),logger_1=require('../utils/logger'),GetTicketWbot_1=__importDefault(require(a260_0x3feb51(0x124))),SetTicketMessagesAsRead=async _0x3b54f9=>{const _0x27104d=a260_0x3feb51;!_0x3b54f9[_0x27104d(0x12b)]&&_0x3b54f9[_0x27104d(0x132)]&&(await _0x3b54f9[_0x27104d(0x134)]({'unreadMessages':0x0}),await cache_1[_0x27104d(0x13b)]['set'](_0x27104d(0x11d)+_0x3b54f9[_0x27104d(0x13e)]+':unreads','0'));if(_0x3b54f9['channel']===_0x27104d(0x136))try{const _0x295508=await(0x0,GetTicketWbot_1[_0x27104d(0x13b)])(_0x3b54f9),_0x3e8e04=await Message_1[_0x27104d(0x13b)][_0x27104d(0x13c)]({'where':{'ticketId':_0x3b54f9['id'],'fromMe':![],'read':![]},'order':[[_0x27104d(0x133),_0x27104d(0x12a)]]});_0x3e8e04[_0x27104d(0x140)]>0x0&&_0x3e8e04[_0x27104d(0x122)](async _0x5b13d8=>{const _0x7871ca=_0x27104d,_0x42dbd3=JSON[_0x7871ca(0x138)](_0x5b13d8['dataJson']);_0x42dbd3[_0x7871ca(0x11f)]&&_0x42dbd3[_0x7871ca(0x11f)][_0x7871ca(0x13d)]===![]&&!_0x3b54f9['isBot']&&_0x3b54f9[_0x7871ca(0x132)]&&await _0x295508[_0x7871ca(0x13a)]([_0x42dbd3[_0x7871ca(0x11f)]]);}),!_0x3b54f9[_0x27104d(0x12b)]&&_0x3b54f9[_0x27104d(0x132)]&&await Message_1[_0x27104d(0x13b)][_0x27104d(0x134)]({'read':!![]},{'where':{'ticketId':_0x3b54f9['id'],'read':![]}});}catch(_0x211d8f){console[_0x27104d(0x135)](_0x211d8f),logger_1[_0x27104d(0x126)][_0x27104d(0x139)]('Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20'+_0x211d8f);}const _0x1a78c5=(0x0,socket_1['getIO'])();_0x1a78c5['to'](_0x3b54f9['status'])['to']('notification')[_0x27104d(0x123)](_0x27104d(0x128)+_0x3b54f9['companyId']+_0x27104d(0x12c),{'action':_0x27104d(0x120),'ticketId':_0x3b54f9['id']});};exports[a260_0x3feb51(0x13b)]=SetTicketMessagesAsRead;