'use strict';const a278_0x2db777=a278_0x2200;function a278_0x2200(_0x54b0ba,_0x2aad6b){const _0x4d4560=a278_0x4d45();return a278_0x2200=function(_0x2200ab,_0x33dae4){_0x2200ab=_0x2200ab-0x19f;let _0x55a524=_0x4d4560[_0x2200ab];return _0x55a524;},a278_0x2200(_0x54b0ba,_0x2aad6b);}(function(_0x171f31,_0x4b603c){const _0xdf8e23=a278_0x2200,_0x327df1=_0x171f31();while(!![]){try{const _0x204042=parseInt(_0xdf8e23(0x1aa))/0x1*(-parseInt(_0xdf8e23(0x1b4))/0x2)+parseInt(_0xdf8e23(0x1b3))/0x3+parseInt(_0xdf8e23(0x1c1))/0x4*(-parseInt(_0xdf8e23(0x1af))/0x5)+parseInt(_0xdf8e23(0x1ba))/0x6+parseInt(_0xdf8e23(0x1c0))/0x7*(-parseInt(_0xdf8e23(0x1b7))/0x8)+-parseInt(_0xdf8e23(0x1b0))/0x9+parseInt(_0xdf8e23(0x1b5))/0xa;if(_0x204042===_0x4b603c)break;else _0x327df1['push'](_0x327df1['shift']());}catch(_0x9ea07b){_0x327df1['push'](_0x327df1['shift']());}}}(a278_0x4d45,0xd87c4));function a278_0x4d45(){const _0x55cfed=['emit','companyId','1525331SuwSfa','__esModule','findAll','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','notification','264070RfjXPv','8339688pLBrbh','defineProperty','logger','4537710nOGlBU','2QSkZdp','30195260QwOOym','readMessages','16PrmFvN','../utils/logger','whatsapp','3423534wQgxTr','../libs/socket','-ticket','default','fromMe','update','3955805dsKyek','48XNNocx','parse',':unreads','key','log','dataJson','length','isGroup','userId','forEach','../libs/cache','channel','createdAt','contactId','isBot','company-'];a278_0x4d45=function(){return _0x55cfed;};return a278_0x4d45();}var __importDefault=this&&this['__importDefault']||function(_0x36d9f6){const _0x5dcbf0=a278_0x2200;return _0x36d9f6&&_0x36d9f6[_0x5dcbf0(0x1ab)]?_0x36d9f6:{'default':_0x36d9f6};};Object[a278_0x2db777(0x1b1)](exports,'__esModule',{'value':!![]});const cache_1=__importDefault(require(a278_0x2db777(0x1a2))),socket_1=require(a278_0x2db777(0x1bb)),Message_1=__importDefault(require('../models/Message')),logger_1=require(a278_0x2db777(0x1b8)),GetTicketWbot_1=__importDefault(require('./GetTicketWbot')),SetTicketMessagesAsRead=async _0x3bfb37=>{const _0x21d508=a278_0x2db777;!_0x3bfb37[_0x21d508(0x1a6)]&&(_0x3bfb37[_0x21d508(0x1a0)]||_0x3bfb37[_0x21d508(0x19f)])&&(await _0x3bfb37[_0x21d508(0x1bf)]({'unreadMessages':0x0}),await cache_1[_0x21d508(0x1bd)]['set']('contacts:'+_0x3bfb37[_0x21d508(0x1a5)]+_0x21d508(0x1c3),'0'));if(_0x3bfb37[_0x21d508(0x1a3)]===_0x21d508(0x1b9))try{const _0x3b3b5b=await(0x0,GetTicketWbot_1[_0x21d508(0x1bd)])(_0x3bfb37),_0x3b28ee=await Message_1[_0x21d508(0x1bd)][_0x21d508(0x1ac)]({'where':{'ticketId':_0x3bfb37['id'],'fromMe':![],'read':![]},'order':[[_0x21d508(0x1a4),'DESC']]});_0x3b28ee[_0x21d508(0x1c7)]>0x0&&_0x3b28ee[_0x21d508(0x1a1)](async _0x12473d=>{const _0x4cdec6=_0x21d508,_0x49668e=JSON[_0x4cdec6(0x1c2)](_0x12473d[_0x4cdec6(0x1c6)]);_0x49668e[_0x4cdec6(0x1c4)]&&_0x49668e[_0x4cdec6(0x1c4)][_0x4cdec6(0x1be)]===![]&&!_0x3bfb37[_0x4cdec6(0x1a6)]&&(_0x3bfb37[_0x4cdec6(0x1a0)]||_0x3bfb37[_0x4cdec6(0x19f)])&&await _0x3b3b5b[_0x4cdec6(0x1b6)]([_0x49668e[_0x4cdec6(0x1c4)]]);}),!_0x3bfb37[_0x21d508(0x1a6)]&&(_0x3bfb37[_0x21d508(0x1a0)]||_0x3bfb37['isGroup'])&&await Message_1['default'][_0x21d508(0x1bf)]({'read':!![]},{'where':{'ticketId':_0x3bfb37['id'],'read':![]}});}catch(_0x4e3505){console[_0x21d508(0x1c5)](_0x4e3505),logger_1[_0x21d508(0x1b2)]['warn'](_0x21d508(0x1ad)+_0x4e3505);}const _0x4a8dc3=(0x0,socket_1['getIO'])();_0x4a8dc3['to'](_0x3bfb37['status'])['to'](_0x21d508(0x1ae))[_0x21d508(0x1a8)](_0x21d508(0x1a7)+_0x3bfb37[_0x21d508(0x1a9)]+_0x21d508(0x1bc),{'action':'updateUnread','ticketId':_0x3bfb37['id']});};exports['default']=SetTicketMessagesAsRead;