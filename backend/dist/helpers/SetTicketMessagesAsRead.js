'use strict';const a293_0x412a0c=a293_0x2778;(function(_0x467527,_0x5ae6ec){const _0x48bbf7=a293_0x2778,_0x40bb16=_0x467527();while(!![]){try{const _0x1c3766=parseInt(_0x48bbf7(0x103))/0x1*(parseInt(_0x48bbf7(0x120))/0x2)+-parseInt(_0x48bbf7(0x10d))/0x3*(parseInt(_0x48bbf7(0x11e))/0x4)+parseInt(_0x48bbf7(0x104))/0x5*(-parseInt(_0x48bbf7(0x111))/0x6)+parseInt(_0x48bbf7(0x122))/0x7+parseInt(_0x48bbf7(0x106))/0x8+-parseInt(_0x48bbf7(0x118))/0x9*(parseInt(_0x48bbf7(0x102))/0xa)+parseInt(_0x48bbf7(0xff))/0xb*(-parseInt(_0x48bbf7(0x11c))/0xc);if(_0x1c3766===_0x5ae6ec)break;else _0x40bb16['push'](_0x40bb16['shift']());}catch(_0x6ec6a5){_0x40bb16['push'](_0x40bb16['shift']());}}}(a293_0x5bac,0xb00b5));function a293_0x5bac(){const _0x311a2f=['248289PibaLg','update','-ticket','set','1164aQJvqr','userId','isGroup','../libs/cache','forEach','key','default','9WfJfxl','length','dataJson','findAll','12FuCWmr','contactId','4BDsssX','./GetTicketWbot','846664JWatOj','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','3398031TvepxG','DESC','__esModule','isBot','defineProperty','channel','5942123muCOHZ','readMessages','contacts:','3150260sDpJTd','2XmcMrF','15935kDkvdz','../libs/socket','7561920VCpZII','whatsapp','../models/Message','log','company-',':unreads','companyId'];a293_0x5bac=function(){return _0x311a2f;};return a293_0x5bac();}var __importDefault=this&&this['__importDefault']||function(_0x29c7e7){const _0x2d6ba7=a293_0x2778;return _0x29c7e7&&_0x29c7e7[_0x2d6ba7(0x124)]?_0x29c7e7:{'default':_0x29c7e7};};Object[a293_0x412a0c(0x126)](exports,a293_0x412a0c(0x124),{'value':!![]});const cache_1=__importDefault(require(a293_0x412a0c(0x114))),socket_1=require(a293_0x412a0c(0x105)),Message_1=__importDefault(require(a293_0x412a0c(0x108))),logger_1=require('../utils/logger'),GetTicketWbot_1=__importDefault(require(a293_0x412a0c(0x11f))),SetTicketMessagesAsRead=async _0xddfbe4=>{const _0x5184d3=a293_0x412a0c;!_0xddfbe4[_0x5184d3(0x125)]&&(_0xddfbe4[_0x5184d3(0x112)]||_0xddfbe4[_0x5184d3(0x113)])&&(await _0xddfbe4['update']({'unreadMessages':0x0}),await cache_1[_0x5184d3(0x117)][_0x5184d3(0x110)](_0x5184d3(0x101)+_0xddfbe4[_0x5184d3(0x11d)]+_0x5184d3(0x10b),'0'));if(_0xddfbe4[_0x5184d3(0x127)]===_0x5184d3(0x107))try{const _0x2783eb=await(0x0,GetTicketWbot_1[_0x5184d3(0x117)])(_0xddfbe4),_0x39f1b8=await Message_1[_0x5184d3(0x117)][_0x5184d3(0x11b)]({'where':{'ticketId':_0xddfbe4['id'],'fromMe':![],'read':![]},'order':[['createdAt',_0x5184d3(0x123)]]});_0x39f1b8[_0x5184d3(0x119)]>0x0&&_0x39f1b8[_0x5184d3(0x115)](async _0x165d33=>{const _0x153599=_0x5184d3,_0x5d9e99=JSON['parse'](_0x165d33[_0x153599(0x11a)]);_0x5d9e99[_0x153599(0x116)]&&_0x5d9e99[_0x153599(0x116)]['fromMe']===![]&&!_0xddfbe4[_0x153599(0x125)]&&(_0xddfbe4[_0x153599(0x112)]||_0xddfbe4[_0x153599(0x113)])&&await _0x2783eb[_0x153599(0x100)]([_0x5d9e99[_0x153599(0x116)]]);}),!_0xddfbe4['isBot']&&(_0xddfbe4[_0x5184d3(0x112)]||_0xddfbe4[_0x5184d3(0x113)])&&await Message_1[_0x5184d3(0x117)][_0x5184d3(0x10e)]({'read':!![]},{'where':{'ticketId':_0xddfbe4['id'],'read':![]}});}catch(_0x4d4033){console[_0x5184d3(0x109)](_0x4d4033),logger_1['logger']['warn'](_0x5184d3(0x121)+_0x4d4033);}const _0x9808bd=(0x0,socket_1['getIO'])();_0x9808bd['to'](_0xddfbe4['status'])['to']('notification')['emit'](_0x5184d3(0x10a)+_0xddfbe4[_0x5184d3(0x10c)]+_0x5184d3(0x10f),{'action':'updateUnread','ticketId':_0xddfbe4['id']});};function a293_0x2778(_0x2a9263,_0x33fd54){const _0x5baceb=a293_0x5bac();return a293_0x2778=function(_0x277863,_0x1eb29e){_0x277863=_0x277863-0xff;let _0x139672=_0x5baceb[_0x277863];return _0x139672;},a293_0x2778(_0x2a9263,_0x33fd54);}exports[a293_0x412a0c(0x117)]=SetTicketMessagesAsRead;