'use strict';function a251_0x5ec0(_0x15ccd1,_0x489ee4){const _0xa3f012=a251_0xa3f0();return a251_0x5ec0=function(_0x5ec016,_0x4e5eeb){_0x5ec016=_0x5ec016-0xd7;let _0x4b2b4f=_0xa3f012[_0x5ec016];return _0x4b2b4f;},a251_0x5ec0(_0x15ccd1,_0x489ee4);}const a251_0x57a14b=a251_0x5ec0;(function(_0x84979a,_0x304f20){const _0x1006af=a251_0x5ec0,_0xa545c8=_0x84979a();while(!![]){try{const _0x1c3b1d=-parseInt(_0x1006af(0xf8))/0x1+parseInt(_0x1006af(0xeb))/0x2*(-parseInt(_0x1006af(0xec))/0x3)+-parseInt(_0x1006af(0xe0))/0x4*(-parseInt(_0x1006af(0xf7))/0x5)+parseInt(_0x1006af(0xed))/0x6*(parseInt(_0x1006af(0xd8))/0x7)+-parseInt(_0x1006af(0xf1))/0x8+-parseInt(_0x1006af(0xe2))/0x9+parseInt(_0x1006af(0xe6))/0xa*(parseInt(_0x1006af(0xd9))/0xb);if(_0x1c3b1d===_0x304f20)break;else _0xa545c8['push'](_0xa545c8['shift']());}catch(_0x2ad6b1){_0xa545c8['push'](_0xa545c8['shift']());}}}(a251_0xa3f0,0x37997));function a251_0xa3f0(){const _0x4d02b8=['contactId','channel','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','logger','log','defineProperty','__esModule','2096143EzIbyt','7639258jtAfbx','notification','contacts:','../libs/socket','set','./GetTicketWbot','userId','203408DVubOI','dataJson','2093661xIloZj',':unreads','getIO','update','10jirmem','status','warn','isBot','DESC','886ecvpnb','3075jrLzen','6tkvwgk','whatsapp','company-','key','1770408HPCPVr','fromMe','__importDefault','../utils/logger','length','default','25GNHJui','112447FrJhTC'];a251_0xa3f0=function(){return _0x4d02b8;};return a251_0xa3f0();}var __importDefault=this&&this[a251_0x57a14b(0xf3)]||function(_0x208c97){const _0x791797=a251_0x57a14b;return _0x208c97&&_0x208c97[_0x791797(0xd7)]?_0x208c97:{'default':_0x208c97};};Object[a251_0x57a14b(0xfe)](exports,a251_0x57a14b(0xd7),{'value':!![]});const cache_1=__importDefault(require('../libs/cache')),socket_1=require(a251_0x57a14b(0xdc)),Message_1=__importDefault(require('../models/Message')),logger_1=require(a251_0x57a14b(0xf4)),GetTicketWbot_1=__importDefault(require(a251_0x57a14b(0xde))),SetTicketMessagesAsRead=async _0x417cb5=>{const _0x4e1a8e=a251_0x57a14b;!_0x417cb5['isBot']&&_0x417cb5[_0x4e1a8e(0xdf)]&&(await _0x417cb5[_0x4e1a8e(0xe5)]({'unreadMessages':0x0}),await cache_1[_0x4e1a8e(0xf6)][_0x4e1a8e(0xdd)](_0x4e1a8e(0xdb)+_0x417cb5[_0x4e1a8e(0xf9)]+_0x4e1a8e(0xe3),'0'));if(_0x417cb5[_0x4e1a8e(0xfa)]===_0x4e1a8e(0xee))try{const _0x3344f0=await(0x0,GetTicketWbot_1['default'])(_0x417cb5),_0x2083b2=await Message_1[_0x4e1a8e(0xf6)]['findAll']({'where':{'ticketId':_0x417cb5['id'],'fromMe':![],'read':![]},'order':[['createdAt',_0x4e1a8e(0xea)]]});_0x2083b2[_0x4e1a8e(0xf5)]>0x0&&_0x2083b2['forEach'](async _0x455482=>{const _0x36585e=_0x4e1a8e,_0x5c0199=JSON['parse'](_0x455482[_0x36585e(0xe1)]);_0x5c0199[_0x36585e(0xf0)]&&_0x5c0199['key'][_0x36585e(0xf2)]===![]&&!_0x417cb5['isBot']&&_0x417cb5[_0x36585e(0xdf)]&&await _0x3344f0['readMessages']([_0x5c0199[_0x36585e(0xf0)]]);}),!_0x417cb5[_0x4e1a8e(0xe9)]&&_0x417cb5[_0x4e1a8e(0xdf)]&&await Message_1[_0x4e1a8e(0xf6)]['update']({'read':!![]},{'where':{'ticketId':_0x417cb5['id'],'read':![]}});}catch(_0x4ef597){console[_0x4e1a8e(0xfd)](_0x4ef597),logger_1[_0x4e1a8e(0xfc)][_0x4e1a8e(0xe8)](_0x4e1a8e(0xfb)+_0x4ef597);}const _0x1fc47a=(0x0,socket_1[_0x4e1a8e(0xe4)])();_0x1fc47a['to'](_0x417cb5[_0x4e1a8e(0xe7)])['to'](_0x4e1a8e(0xda))['emit'](_0x4e1a8e(0xef)+_0x417cb5['companyId']+'-ticket',{'action':'updateUnread','ticketId':_0x417cb5['id']});};exports[a251_0x57a14b(0xf6)]=SetTicketMessagesAsRead;