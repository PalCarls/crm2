'use strict';const a286_0x199c99=a286_0x1c4f;function a286_0x4366(){const _0x2bd94d=['8oqdvQr','channel','4jASbXY','createdAt','notification','4020255DbwXGH','1894347NmESOD','update','forEach','8159556wMAqLr','4898877wTPlNm','-ticket','isBot','DESC','defineProperty','contacts:','warn','676729efzrHr','set','contactId','key','915831MWBUBx','7440970HFQjvU','4NvFEES','__esModule','status','dataJson','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','fromMe','./GetTicketWbot','isGroup','length','readMessages','../libs/socket','getIO','whatsapp','logger','log','userId','updateUnread','../libs/cache',':unreads','default','../utils/logger','55uwpsWb'];a286_0x4366=function(){return _0x2bd94d;};return a286_0x4366();}(function(_0xcb36f,_0x29495b){const _0xf33ace=a286_0x1c4f,_0x15ed26=_0xcb36f();while(!![]){try{const _0x117ccf=parseInt(_0xf33ace(0xd9))/0x1*(-parseInt(_0xf33ace(0xca))/0x2)+parseInt(_0xf33ace(0xd2))/0x3*(-parseInt(_0xf33ace(0xdf))/0x4)+-parseInt(_0xf33ace(0xcd))/0x5+parseInt(_0xf33ace(0xd1))/0x6+-parseInt(_0xf33ace(0xce))/0x7+-parseInt(_0xf33ace(0xf5))/0x8*(parseInt(_0xf33ace(0xdd))/0x9)+parseInt(_0xf33ace(0xde))/0xa*(parseInt(_0xf33ace(0xf4))/0xb);if(_0x117ccf===_0x29495b)break;else _0x15ed26['push'](_0x15ed26['shift']());}catch(_0x19f919){_0x15ed26['push'](_0x15ed26['shift']());}}}(a286_0x4366,0xe003b));var __importDefault=this&&this['__importDefault']||function(_0x39d8cd){const _0x13d9df=a286_0x1c4f;return _0x39d8cd&&_0x39d8cd[_0x13d9df(0xe0)]?_0x39d8cd:{'default':_0x39d8cd};};Object[a286_0x199c99(0xd6)](exports,'__esModule',{'value':!![]});const cache_1=__importDefault(require(a286_0x199c99(0xf0))),socket_1=require(a286_0x199c99(0xe9)),Message_1=__importDefault(require('../models/Message')),logger_1=require(a286_0x199c99(0xf3)),GetTicketWbot_1=__importDefault(require(a286_0x199c99(0xe5))),SetTicketMessagesAsRead=async _0x2dbe7a=>{const _0x36ced4=a286_0x199c99;!_0x2dbe7a['isBot']&&(_0x2dbe7a[_0x36ced4(0xee)]||_0x2dbe7a[_0x36ced4(0xe6)])&&(await _0x2dbe7a[_0x36ced4(0xcf)]({'unreadMessages':0x0}),await cache_1[_0x36ced4(0xf2)][_0x36ced4(0xda)](_0x36ced4(0xd7)+_0x2dbe7a[_0x36ced4(0xdb)]+_0x36ced4(0xf1),'0'));if(_0x2dbe7a[_0x36ced4(0xc9)]===_0x36ced4(0xeb))try{const _0x5534b8=await(0x0,GetTicketWbot_1[_0x36ced4(0xf2)])(_0x2dbe7a),_0x205c72=await Message_1[_0x36ced4(0xf2)]['findAll']({'where':{'ticketId':_0x2dbe7a['id'],'fromMe':![],'read':![]},'order':[[_0x36ced4(0xcb),_0x36ced4(0xd5)]]});_0x205c72[_0x36ced4(0xe7)]>0x0&&_0x205c72[_0x36ced4(0xd0)](async _0x9443bd=>{const _0x5e9bcd=_0x36ced4,_0xca42f5=JSON['parse'](_0x9443bd[_0x5e9bcd(0xe2)]);_0xca42f5['key']&&_0xca42f5[_0x5e9bcd(0xdc)][_0x5e9bcd(0xe4)]===![]&&!_0x2dbe7a[_0x5e9bcd(0xd4)]&&(_0x2dbe7a[_0x5e9bcd(0xee)]||_0x2dbe7a[_0x5e9bcd(0xe6)])&&await _0x5534b8[_0x5e9bcd(0xe8)]([_0xca42f5[_0x5e9bcd(0xdc)]]);}),!_0x2dbe7a[_0x36ced4(0xd4)]&&(_0x2dbe7a[_0x36ced4(0xee)]||_0x2dbe7a[_0x36ced4(0xe6)])&&await Message_1[_0x36ced4(0xf2)][_0x36ced4(0xcf)]({'read':!![]},{'where':{'ticketId':_0x2dbe7a['id'],'read':![]}});}catch(_0x2e5774){console[_0x36ced4(0xed)](_0x2e5774),logger_1[_0x36ced4(0xec)][_0x36ced4(0xd8)](_0x36ced4(0xe3)+_0x2e5774);}const _0x34538c=(0x0,socket_1[_0x36ced4(0xea)])();_0x34538c['to'](_0x2dbe7a[_0x36ced4(0xe1)])['to'](_0x36ced4(0xcc))['emit']('company-'+_0x2dbe7a['companyId']+_0x36ced4(0xd3),{'action':_0x36ced4(0xef),'ticketId':_0x2dbe7a['id']});};function a286_0x1c4f(_0x5a1b53,_0x1a7d11){const _0x4366d4=a286_0x4366();return a286_0x1c4f=function(_0x1c4f65,_0x254f60){_0x1c4f65=_0x1c4f65-0xc9;let _0x114aaf=_0x4366d4[_0x1c4f65];return _0x114aaf;},a286_0x1c4f(_0x5a1b53,_0x1a7d11);}exports[a286_0x199c99(0xf2)]=SetTicketMessagesAsRead;