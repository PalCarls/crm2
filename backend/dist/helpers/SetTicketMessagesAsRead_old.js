'use strict';const a236_0x4982c1=a236_0x3b0f;(function(_0x19b850,_0x106542){const _0x1ca5af=a236_0x3b0f,_0x5f35c6=_0x19b850();while(!![]){try{const _0x515bd1=-parseInt(_0x1ca5af(0x1b3))/0x1+-parseInt(_0x1ca5af(0x195))/0x2+-parseInt(_0x1ca5af(0x1b4))/0x3*(parseInt(_0x1ca5af(0x1a5))/0x4)+parseInt(_0x1ca5af(0x19f))/0x5+parseInt(_0x1ca5af(0x1a2))/0x6+-parseInt(_0x1ca5af(0x198))/0x7+parseInt(_0x1ca5af(0x1ab))/0x8;if(_0x515bd1===_0x106542)break;else _0x5f35c6['push'](_0x5f35c6['shift']());}catch(_0x19a05e){_0x5f35c6['push'](_0x5f35c6['shift']());}}}(a236_0x3405,0x4e909));function a236_0x3405(){const _0x2860c4=['305266vGvsvt','fromMe','channel','1247939woEMig','company-','contacts:','notification','readMessages','whatsapp','default','2526850btPwJJ','key','logger','1672806rNliOP','update','set','16YxyWWm','getIO','../utils/logger','../libs/cache','../libs/socket','contactId','5630744iQfiND','parse','cacheLayer','emit','forEach',':unreads','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','../models/Message','482075TaErsL','264921BURbvx','status','companyId','./GetTicketWbot','warn','__esModule'];a236_0x3405=function(){return _0x2860c4;};return a236_0x3405();}function a236_0x3b0f(_0xf05fac,_0x4f43c8){const _0x3405ec=a236_0x3405();return a236_0x3b0f=function(_0x3b0fea,_0x366c35){_0x3b0fea=_0x3b0fea-0x195;let _0x3d40ea=_0x3405ec[_0x3b0fea];return _0x3d40ea;},a236_0x3b0f(_0xf05fac,_0x4f43c8);}var __importDefault=this&&this['__importDefault']||function(_0x50e32e){const _0x5ee39f=a236_0x3b0f;return _0x50e32e&&_0x50e32e[_0x5ee39f(0x1b9)]?_0x50e32e:{'default':_0x50e32e};};Object['defineProperty'](exports,a236_0x4982c1(0x1b9),{'value':!![]});const cache_1=require(a236_0x4982c1(0x1a8)),socket_1=require(a236_0x4982c1(0x1a9)),Message_1=__importDefault(require(a236_0x4982c1(0x1b2))),logger_1=require(a236_0x4982c1(0x1a7)),GetTicketWbot_1=__importDefault(require(a236_0x4982c1(0x1b7))),SetTicketMessagesAsRead=async _0x471bde=>{const _0x2e70d0=a236_0x4982c1;await _0x471bde[_0x2e70d0(0x1a3)]({'unreadMessages':0x0}),await cache_1[_0x2e70d0(0x1ad)][_0x2e70d0(0x1a4)](_0x2e70d0(0x19a)+_0x471bde[_0x2e70d0(0x1aa)]+_0x2e70d0(0x1b0),'0');if(_0x471bde[_0x2e70d0(0x197)]===_0x2e70d0(0x19d))try{const _0x9923c2=await(0x0,GetTicketWbot_1[_0x2e70d0(0x19e)])(_0x471bde),_0x9b5479=await Message_1[_0x2e70d0(0x19e)]['findAll']({'where':{'ticketId':_0x471bde['id'],'fromMe':![],'read':![]},'order':[['createdAt','DESC']]});_0x9b5479['length']>0x0&&_0x9b5479[_0x2e70d0(0x1af)](async _0x23d0eb=>{const _0x1b8f7b=_0x2e70d0,_0x81ccd7=JSON[_0x1b8f7b(0x1ac)](_0x23d0eb['dataJson']);_0x81ccd7[_0x1b8f7b(0x1a0)]&&_0x81ccd7[_0x1b8f7b(0x1a0)][_0x1b8f7b(0x196)]===![]&&await _0x9923c2[_0x1b8f7b(0x19c)]([_0x81ccd7[_0x1b8f7b(0x1a0)]]);}),await Message_1[_0x2e70d0(0x19e)][_0x2e70d0(0x1a3)]({'read':!![]},{'where':{'ticketId':_0x471bde['id'],'read':![]}});}catch(_0x7614b1){console['log'](_0x7614b1),logger_1[_0x2e70d0(0x1a1)][_0x2e70d0(0x1b8)](_0x2e70d0(0x1b1)+_0x7614b1);}const _0x39086f=(0x0,socket_1[_0x2e70d0(0x1a6)])();_0x39086f['to'](_0x471bde[_0x2e70d0(0x1b5)])['to'](_0x2e70d0(0x19b))[_0x2e70d0(0x1ae)](_0x2e70d0(0x199)+_0x471bde[_0x2e70d0(0x1b6)]+'-ticket',{'action':'updateUnread','ticketId':_0x471bde['id']});};exports['default']=SetTicketMessagesAsRead;