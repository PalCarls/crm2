'use strict';const a280_0x2d53be=a280_0x1bf8;(function(_0x15877d,_0x29b6d0){const _0x5b71c1=a280_0x1bf8,_0x400611=_0x15877d();while(!![]){try{const _0x2672a1=parseInt(_0x5b71c1(0xb7))/0x1*(-parseInt(_0x5b71c1(0xa4))/0x2)+-parseInt(_0x5b71c1(0xbb))/0x3*(parseInt(_0x5b71c1(0xb1))/0x4)+parseInt(_0x5b71c1(0xc2))/0x5*(parseInt(_0x5b71c1(0xc7))/0x6)+-parseInt(_0x5b71c1(0xac))/0x7*(parseInt(_0x5b71c1(0x9e))/0x8)+-parseInt(_0x5b71c1(0xba))/0x9+-parseInt(_0x5b71c1(0xae))/0xa*(parseInt(_0x5b71c1(0xb4))/0xb)+parseInt(_0x5b71c1(0xa9))/0xc;if(_0x2672a1===_0x29b6d0)break;else _0x400611['push'](_0x400611['shift']());}catch(_0x27279a){_0x400611['push'](_0x400611['shift']());}}}(a280_0x324c,0x67268));var __importDefault=this&&this['__importDefault']||function(_0x520e0c){const _0x753761=a280_0x1bf8;return _0x520e0c&&_0x520e0c[_0x753761(0xb3)]?_0x520e0c:{'default':_0x520e0c};};function a280_0x324c(){const _0x5c953c=['user','2jcUNLK','update','name','number','-ticket','29958444PNvcEN','whatsapp','toString','7QFtoAZ','../models/Ticket','3067300zpBkgM','status','createdAt','4wTrkNM','color','__esModule','11BoHPlG','../models/Tag','urlPicture','196030xzkWNZ','tags','companyId','6159744gfsxnG','1604919ezJDDq','queue','../models/Message','defineProperty','getIO','emit','updateTicketByRemoteJid','857045NFzwUL','ticketId','findOne','like','../models/Contact','6TjllXy','../models/Queue','4186344Xajbks','default','profilePicUrl','../models/Whatsapp','../libs/socket'];a280_0x324c=function(){return _0x5c953c;};return a280_0x324c();}Object[a280_0x2d53be(0xbe)](exports,a280_0x2d53be(0xb3),{'value':!![]}),exports[a280_0x2d53be(0xc1)]=void 0x0;function a280_0x1bf8(_0x4a48ad,_0x3b368a){const _0x324cba=a280_0x324c();return a280_0x1bf8=function(_0x1bf8ef,_0x583e68){_0x1bf8ef=_0x1bf8ef-0x9e;let _0x3c02dc=_0x324cba[_0x1bf8ef];return _0x3c02dc;},a280_0x1bf8(_0x4a48ad,_0x3b368a);}const Message_1=__importDefault(require(a280_0x2d53be(0xbd))),Ticket_1=__importDefault(require(a280_0x2d53be(0xad))),sequelize_1=require('sequelize'),socket_1=require(a280_0x2d53be(0xa2)),Contact_1=__importDefault(require(a280_0x2d53be(0xc6))),User_1=__importDefault(require('../models/User')),Queue_1=__importDefault(require(a280_0x2d53be(0xc8))),Whatsapp_1=__importDefault(require(a280_0x2d53be(0xa1))),Tag_1=__importDefault(require(a280_0x2d53be(0xb5))),updateTicketByRemoteJid=async(_0x572dd2,_0x3e991c,_0x210ee1,_0x450625,_0x1c85d3)=>{const _0x1d3897=a280_0x2d53be,{rows:_0x45c37c}=await Message_1[_0x1d3897(0x9f)]['findAndCountAll']({'limit':0x1,'order':[[_0x1d3897(0xb0),'DESC']],'where':{'remoteJid':{[sequelize_1['Op'][_0x1d3897(0xc5)]]:'%'+_0x572dd2+'%'}}});_0x45c37c['forEach'](async _0x4ddb7b=>{const _0x14fd31=_0x1d3897;let _0x128a9f=_0x4ddb7b[_0x14fd31(0xc3)],_0x6634f9=await Ticket_1[_0x14fd31(0x9f)][_0x14fd31(0xc4)]({'where':{'id':_0x128a9f},'include':[{'model':Contact_1[_0x14fd31(0x9f)],'as':'contact','attributes':['id','name',_0x14fd31(0xa7),_0x14fd31(0xa0),_0x14fd31(0xb9),_0x14fd31(0xb6)],'include':['extraInfo','contactTags','tags']},{'model':User_1[_0x14fd31(0x9f)],'as':_0x14fd31(0xa3),'attributes':['id',_0x14fd31(0xa6)]},{'model':Queue_1[_0x14fd31(0x9f)],'as':_0x14fd31(0xbc),'attributes':['id',_0x14fd31(0xa6),_0x14fd31(0xb2)]},{'model':Whatsapp_1[_0x14fd31(0x9f)],'as':_0x14fd31(0xaa),'attributes':[_0x14fd31(0xa6)]},{'model':Tag_1['default'],'as':_0x14fd31(0xb8),'attributes':['id','name','color']}]});const _0x228dca=_0x6634f9[_0x14fd31(0xaf)],_0xbd96f8=_0x6634f9['user']?.['id'];await _0x6634f9[_0x14fd31(0xa5)]({'status':_0x450625,'queueId':_0x3e991c,'userId':_0x210ee1,'unreadMessages':_0x1c85d3});const _0x186154=(0x0,socket_1[_0x14fd31(0xbf)])();_0x186154['to'](_0x6634f9['id'][_0x14fd31(0xab)]())[_0x14fd31(0xc0)]('company-'+_0x6634f9[_0x14fd31(0xb9)]+_0x14fd31(0xa8),{'action':_0x14fd31(0xa5),'ticket':_0x6634f9});});return;};exports[a280_0x2d53be(0xc1)]=updateTicketByRemoteJid;