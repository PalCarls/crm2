'use strict';const a262_0x2f707e=a262_0x2471;(function(_0x3db468,_0x483288){const _0x9aad59=a262_0x2471,_0x38bdd6=_0x3db468();while(!![]){try{const _0x406ca5=-parseInt(_0x9aad59(0xa5))/0x1*(parseInt(_0x9aad59(0x9a))/0x2)+-parseInt(_0x9aad59(0xb9))/0x3+-parseInt(_0x9aad59(0xb0))/0x4*(-parseInt(_0x9aad59(0x95))/0x5)+parseInt(_0x9aad59(0x96))/0x6*(-parseInt(_0x9aad59(0xbb))/0x7)+-parseInt(_0x9aad59(0x93))/0x8*(-parseInt(_0x9aad59(0xb1))/0x9)+parseInt(_0x9aad59(0x91))/0xa*(-parseInt(_0x9aad59(0x92))/0xb)+parseInt(_0x9aad59(0xb4))/0xc;if(_0x406ca5===_0x483288)break;else _0x38bdd6['push'](_0x38bdd6['shift']());}catch(_0x143a3e){_0x38bdd6['push'](_0x38bdd6['shift']());}}}(a262_0x1e88,0x5a3aa));var __importDefault=this&&this[a262_0x2f707e(0x9b)]||function(_0x1b1fe3){const _0x3e5a4b=a262_0x2f707e;return _0x1b1fe3&&_0x1b1fe3[_0x3e5a4b(0x9e)]?_0x1b1fe3:{'default':_0x1b1fe3};};Object[a262_0x2f707e(0xb2)](exports,a262_0x2f707e(0x9e),{'value':!![]}),exports['updateTicketByRemoteJid']=void 0x0;function a262_0x1e88(){const _0x54f92a=['default','forEach','queue','216780kLTTin','findOne','21ZsiGQM','companyId','../models/Contact','name','40XdlJmg','799238FHKYqB','396920QnXCjw','../models/Queue','390aLtbEz','463074vMFTCB','extraInfo','toString','sequelize','165526FggQzL','__importDefault','like','contact','__esModule','getIO','../libs/socket','../models/Tag','emit','createdAt','user','5BXWpqv','../models/Whatsapp','-ticket','profilePicUrl','color','log','../models/Ticket','update','../models/Message','findAndCountAll','ticketId','28916vGuoaa','63VxzYdF','defineProperty','whatsapp','5599860lFDaXy','tags'];a262_0x1e88=function(){return _0x54f92a;};return a262_0x1e88();}const Message_1=__importDefault(require(a262_0x2f707e(0xad))),Ticket_1=__importDefault(require(a262_0x2f707e(0xab))),sequelize_1=require(a262_0x2f707e(0x99)),socket_1=require(a262_0x2f707e(0xa0)),Contact_1=__importDefault(require(a262_0x2f707e(0x8f))),User_1=__importDefault(require('../models/User')),Queue_1=__importDefault(require(a262_0x2f707e(0x94))),Whatsapp_1=__importDefault(require(a262_0x2f707e(0xa6))),Tag_1=__importDefault(require(a262_0x2f707e(0xa1))),updateTicketByRemoteJid=async(_0x9d11db,_0x779f7f,_0x48a0fb,_0x421941,_0x2b3086)=>{const _0x1af21b=a262_0x2f707e,{rows:_0x52db9d}=await Message_1[_0x1af21b(0xb6)][_0x1af21b(0xae)]({'limit':0x1,'order':[[_0x1af21b(0xa3),'DESC']],'where':{'remoteJid':{[sequelize_1['Op'][_0x1af21b(0x9c)]]:'%'+_0x9d11db+'%'}}});console[_0x1af21b(0xaa)](_0x52db9d),_0x52db9d[_0x1af21b(0xb7)](async _0x94c56a=>{const _0x44d7d3=_0x1af21b;let _0x5a1f39=_0x94c56a[_0x44d7d3(0xaf)],_0x564e04=await Ticket_1[_0x44d7d3(0xb6)][_0x44d7d3(0xba)]({'where':{'id':_0x5a1f39},'include':[{'model':Contact_1[_0x44d7d3(0xb6)],'as':_0x44d7d3(0x9d),'attributes':['id','name','number',_0x44d7d3(0xa8)],'include':[_0x44d7d3(0x97)]},{'model':User_1[_0x44d7d3(0xb6)],'as':_0x44d7d3(0xa4),'attributes':['id',_0x44d7d3(0x90)]},{'model':Queue_1['default'],'as':_0x44d7d3(0xb8),'attributes':['id',_0x44d7d3(0x90),_0x44d7d3(0xa9)]},{'model':Whatsapp_1['default'],'as':_0x44d7d3(0xb3),'attributes':[_0x44d7d3(0x90)]},{'model':Tag_1[_0x44d7d3(0xb6)],'as':_0x44d7d3(0xb5),'attributes':['id',_0x44d7d3(0x90),_0x44d7d3(0xa9)]}]});const _0x1e221f=_0x564e04['status'],_0x95b318=_0x564e04['user']?.['id'];await _0x564e04['update']({'status':_0x421941,'queueId':_0x779f7f,'userId':_0x48a0fb,'unreadMessages':_0x2b3086});const _0x3c92cb=(0x0,socket_1[_0x44d7d3(0x9f)])();_0x3c92cb['to'](_0x564e04['id'][_0x44d7d3(0x98)]())[_0x44d7d3(0xa2)]('company-'+_0x564e04[_0x44d7d3(0x8e)]+_0x44d7d3(0xa7),{'action':_0x44d7d3(0xac),'ticket':_0x564e04});});return;};function a262_0x2471(_0x2f6a69,_0x5cf352){const _0x1e881b=a262_0x1e88();return a262_0x2471=function(_0x247137,_0x40f253){_0x247137=_0x247137-0x8e;let _0xa698e3=_0x1e881b[_0x247137];return _0xa698e3;},a262_0x2471(_0x2f6a69,_0x5cf352);}exports['updateTicketByRemoteJid']=updateTicketByRemoteJid;