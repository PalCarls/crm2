'use strict';const a321_0x4d6912=a321_0x197a;(function(_0x242462,_0x230182){const _0x2fe5c3=a321_0x197a,_0x29026e=_0x242462();while(!![]){try{const _0x7c3ff2=parseInt(_0x2fe5c3(0x92))/0x1+-parseInt(_0x2fe5c3(0x98))/0x2+-parseInt(_0x2fe5c3(0x71))/0x3*(parseInt(_0x2fe5c3(0x94))/0x4)+-parseInt(_0x2fe5c3(0x72))/0x5*(parseInt(_0x2fe5c3(0xa0))/0x6)+parseInt(_0x2fe5c3(0x8b))/0x7*(parseInt(_0x2fe5c3(0x8f))/0x8)+-parseInt(_0x2fe5c3(0xa1))/0x9+-parseInt(_0x2fe5c3(0x97))/0xa*(-parseInt(_0x2fe5c3(0x88))/0xb);if(_0x7c3ff2===_0x230182)break;else _0x29026e['push'](_0x29026e['shift']());}catch(_0x310ebe){_0x29026e['push'](_0x29026e['shift']());}}}(a321_0x9705,0xaf2dc));var __createBinding=this&&this[a321_0x4d6912(0x9e)]||(Object[a321_0x4d6912(0x9b)]?function(_0x21e4e7,_0x50eba6,_0x48ee9e,_0x41d5ad){const _0x84e050=a321_0x4d6912;if(_0x41d5ad===undefined)_0x41d5ad=_0x48ee9e;var _0x5521ff=Object[_0x84e050(0x7e)](_0x50eba6,_0x48ee9e);(!_0x5521ff||('get'in _0x5521ff?!_0x50eba6[_0x84e050(0x85)]:_0x5521ff['writable']||_0x5521ff[_0x84e050(0x79)]))&&(_0x5521ff={'enumerable':!![],'get':function(){return _0x50eba6[_0x48ee9e];}}),Object['defineProperty'](_0x21e4e7,_0x41d5ad,_0x5521ff);}:function(_0x5e757a,_0x5b4c44,_0x58c61f,_0x35f8be){if(_0x35f8be===undefined)_0x35f8be=_0x58c61f;_0x5e757a[_0x35f8be]=_0x5b4c44[_0x58c61f];}),__setModuleDefault=this&&this[a321_0x4d6912(0x7d)]||(Object[a321_0x4d6912(0x9b)]?function(_0x1d4636,_0x253fd4){const _0x20ef26=a321_0x4d6912;Object[_0x20ef26(0x91)](_0x1d4636,'default',{'enumerable':!![],'value':_0x253fd4});}:function(_0x19a952,_0xa39256){const _0x289328=a321_0x4d6912;_0x19a952[_0x289328(0x76)]=_0xa39256;}),__importStar=this&&this[a321_0x4d6912(0xa2)]||function(_0x108757){const _0x485bea=a321_0x4d6912;if(_0x108757&&_0x108757[_0x485bea(0x85)])return _0x108757;var _0x44aa69={};if(_0x108757!=null){for(var _0x4d2748 in _0x108757)if(_0x4d2748!=='default'&&Object[_0x485bea(0x8e)]['hasOwnProperty']['call'](_0x108757,_0x4d2748))__createBinding(_0x44aa69,_0x108757,_0x4d2748);}return __setModuleDefault(_0x44aa69,_0x108757),_0x44aa69;},__importDefault=this&&this[a321_0x4d6912(0x86)]||function(_0x3eb4f9){return _0x3eb4f9&&_0x3eb4f9['__esModule']?_0x3eb4f9:{'default':_0x3eb4f9};};Object[a321_0x4d6912(0x91)](exports,a321_0x4d6912(0x85),{'value':!![]}),exports[a321_0x4d6912(0x74)]=exports[a321_0x4d6912(0x84)]=void 0x0;const bull_1=__importDefault(require('bull')),Sentry=__importStar(require(a321_0x4d6912(0x73))),sequelize_1=require('sequelize'),lodash_1=require(a321_0x4d6912(0x90)),logger_1=require(a321_0x4d6912(0x9a)),database_1=__importDefault(require(a321_0x4d6912(0x95))),User_1=__importDefault(require(a321_0x4d6912(0x81))),connection=process['env'][a321_0x4d6912(0x93)]||'';function a321_0x9705(){const _0x48b608=['userMonitor','__esModule','__importDefault','add','22jtJYlc','QueryTypes','getRepeatableJobs','7BUjaHH','UserMonitor','removeRepeatableByKey','prototype','6499816nFZmVk','lodash','defineProperty','1148952vGVBau','REDIS_URI','4ACcbrV','../database','UserConnection','13897090uWtLgJ','2643054YOpECr','info','../utils/logger','create','key','captureException','__createBinding','findByPk','222QHXrxc','6568974AhWegY','__importStar','3315531uNonhE','117125JPZyiA','@sentry/node','initUserMonitorQueues','query','default','isNil','SELECT','configurable','data','logger','VerifyLoginStatus','__setModuleDefault','getOwnPropertyDescriptor','*\x20*\x20*\x20*\x20*','online','../models/User','process','verify-loginstatus'];a321_0x9705=function(){return _0x48b608;};return a321_0x9705();}exports[a321_0x4d6912(0x84)]=new bull_1[(a321_0x4d6912(0x76))](a321_0x4d6912(0x8c),connection);async function handleLoginStatus(_0x52aac){const _0x29ee0a=a321_0x4d6912,_0x2ad1b5=await database_1['default'][_0x29ee0a(0x75)]('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x29ee0a(0x89)][_0x29ee0a(0x78)]});for(let _0x4b4c40 of _0x2ad1b5){try{const _0x204738=await User_1[_0x29ee0a(0x76)][_0x29ee0a(0x9f)](_0x4b4c40['id']);await _0x204738['update']({'online':![]}),logger_1[_0x29ee0a(0x7b)][_0x29ee0a(0x99)]('Usuario\x20passado\x20para\x20offline:\x20'+_0x4b4c40['id']);}catch(_0xf32cb8){Sentry[_0x29ee0a(0x9d)](_0xf32cb8);}}}function a321_0x197a(_0x1fc5aa,_0x1eacee){const _0x970548=a321_0x9705();return a321_0x197a=function(_0x197a71,_0x135ac2){_0x197a71=_0x197a71-0x71;let _0x2d2ca2=_0x970548[_0x197a71];return _0x2d2ca2;},a321_0x197a(_0x1fc5aa,_0x1eacee);}async function handleUserConnection(_0x22595a){const _0x34b999=a321_0x4d6912;try{const {id:_0x12be2f}=_0x22595a[_0x34b999(0x7a)];if(!(0x0,lodash_1[_0x34b999(0x77)])(_0x12be2f)&&_0x12be2f!=='null'){const _0x5a4613=await User_1[_0x34b999(0x76)][_0x34b999(0x9f)](_0x12be2f);_0x5a4613&&(_0x5a4613[_0x34b999(0x80)]=!![],await _0x5a4613['save']());}}catch(_0x675bdf){Sentry[_0x34b999(0x9d)](_0x675bdf);}}exports[a321_0x4d6912(0x84)][a321_0x4d6912(0x82)](a321_0x4d6912(0x96),handleUserConnection),exports[a321_0x4d6912(0x84)][a321_0x4d6912(0x82)](a321_0x4d6912(0x7c),handleLoginStatus);async function initUserMonitorQueues(){const _0x36a002=a321_0x4d6912,_0x3ca7d2=await exports[_0x36a002(0x84)][_0x36a002(0x8a)]();for(let _0x109740 of _0x3ca7d2){await exports[_0x36a002(0x84)][_0x36a002(0x8d)](_0x109740[_0x36a002(0x9c)]);}exports[_0x36a002(0x84)][_0x36a002(0x87)](_0x36a002(0x7c),{},{'repeat':{'cron':_0x36a002(0x7f),'key':_0x36a002(0x83)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1['logger'][_0x36a002(0x99)]('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuÃ¡rio\x20inicializado');}exports[a321_0x4d6912(0x74)]=initUserMonitorQueues;