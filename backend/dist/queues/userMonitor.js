'use strict';function a304_0x1671(_0x103af6,_0x522da2){const _0x2fd273=a304_0x2fd2();return a304_0x1671=function(_0x167109,_0x10c30e){_0x167109=_0x167109-0x1d4;let _0x5654bb=_0x2fd273[_0x167109];return _0x5654bb;},a304_0x1671(_0x103af6,_0x522da2);}const a304_0x7ee887=a304_0x1671;(function(_0x333d8c,_0x2711af){const _0xa8fbd6=a304_0x1671,_0x38258d=_0x333d8c();while(!![]){try{const _0x654b2f=-parseInt(_0xa8fbd6(0x1d7))/0x1+parseInt(_0xa8fbd6(0x1ed))/0x2*(parseInt(_0xa8fbd6(0x203))/0x3)+parseInt(_0xa8fbd6(0x1de))/0x4*(parseInt(_0xa8fbd6(0x1e0))/0x5)+-parseInt(_0xa8fbd6(0x1e9))/0x6+-parseInt(_0xa8fbd6(0x1e7))/0x7+parseInt(_0xa8fbd6(0x1fe))/0x8+parseInt(_0xa8fbd6(0x1f8))/0x9*(parseInt(_0xa8fbd6(0x1dc))/0xa);if(_0x654b2f===_0x2711af)break;else _0x38258d['push'](_0x38258d['shift']());}catch(_0x290be0){_0x38258d['push'](_0x38258d['shift']());}}}(a304_0x2fd2,0xdd16a));var __createBinding=this&&this[a304_0x7ee887(0x1ef)]||(Object['create']?function(_0xa5c7c4,_0x3d4135,_0x1f2557,_0x40414c){const _0x20f426=a304_0x7ee887;if(_0x40414c===undefined)_0x40414c=_0x1f2557;var _0xce4fe2=Object[_0x20f426(0x201)](_0x3d4135,_0x1f2557);(!_0xce4fe2||('get'in _0xce4fe2?!_0x3d4135['__esModule']:_0xce4fe2[_0x20f426(0x1e3)]||_0xce4fe2[_0x20f426(0x200)]))&&(_0xce4fe2={'enumerable':!![],'get':function(){return _0x3d4135[_0x1f2557];}}),Object[_0x20f426(0x1f7)](_0xa5c7c4,_0x40414c,_0xce4fe2);}:function(_0x46f2bf,_0x52bc0a,_0x5cb1af,_0x48085a){if(_0x48085a===undefined)_0x48085a=_0x5cb1af;_0x46f2bf[_0x48085a]=_0x52bc0a[_0x5cb1af];}),__setModuleDefault=this&&this[a304_0x7ee887(0x1db)]||(Object[a304_0x7ee887(0x1f2)]?function(_0xed0951,_0xcebfbb){Object['defineProperty'](_0xed0951,'default',{'enumerable':!![],'value':_0xcebfbb});}:function(_0x4dffea,_0x460b64){const _0xbf42fc=a304_0x7ee887;_0x4dffea[_0xbf42fc(0x1d8)]=_0x460b64;}),__importStar=this&&this['__importStar']||function(_0x2ebe62){const _0x2c0c9f=a304_0x7ee887;if(_0x2ebe62&&_0x2ebe62['__esModule'])return _0x2ebe62;var _0x22ccc5={};if(_0x2ebe62!=null){for(var _0x2bc953 in _0x2ebe62)if(_0x2bc953!==_0x2c0c9f(0x1d8)&&Object[_0x2c0c9f(0x1e8)][_0x2c0c9f(0x1ea)][_0x2c0c9f(0x1ff)](_0x2ebe62,_0x2bc953))__createBinding(_0x22ccc5,_0x2ebe62,_0x2bc953);}return __setModuleDefault(_0x22ccc5,_0x2ebe62),_0x22ccc5;},__importDefault=this&&this[a304_0x7ee887(0x1da)]||function(_0x2f76cc){const _0x18b215=a304_0x7ee887;return _0x2f76cc&&_0x2f76cc[_0x18b215(0x1ee)]?_0x2f76cc:{'default':_0x2f76cc};};function a304_0x2fd2(){const _0x57b776=['hasOwnProperty','process','initUserMonitorQueues','154YYWnOC','__esModule','__createBinding','UserConnection','lodash','create','@sentry/node','save','UserMonitor','removeRepeatableByKey','defineProperty','38763qVGSIh','verify-loginstatus','QueryTypes','update','query','userMonitor','9733056ndAbaG','call','configurable','getOwnPropertyDescriptor','key','63981bymqYy','../models/User','add','info','1324351looRuQ','default','REDIS_URI','__importDefault','__setModuleDefault','3080wiFOgG','bull','209700AogTms','VerifyLoginStatus','65pYXlQY','logger','null','writable','Queue:\x20monitoramento\x20de\x20status\x20de\x20usu√°rio\x20inicializado','*\x20*\x20*\x20*\x20*','captureException','8116591DiXZcj','prototype','8864700UtsRAe'];a304_0x2fd2=function(){return _0x57b776;};return a304_0x2fd2();}Object['defineProperty'](exports,a304_0x7ee887(0x1ee),{'value':!![]}),exports[a304_0x7ee887(0x1ec)]=exports['userMonitor']=void 0x0;const bull_1=__importDefault(require(a304_0x7ee887(0x1dd))),Sentry=__importStar(require(a304_0x7ee887(0x1f3))),sequelize_1=require('sequelize'),lodash_1=require(a304_0x7ee887(0x1f1)),logger_1=require('../utils/logger'),database_1=__importDefault(require('../database')),User_1=__importDefault(require(a304_0x7ee887(0x1d4))),connection=process['env'][a304_0x7ee887(0x1d9)]||'';exports[a304_0x7ee887(0x1fd)]=new bull_1[(a304_0x7ee887(0x1d8))](a304_0x7ee887(0x1f5),connection);async function handleLoginStatus(_0x571e01){const _0x2bbdac=a304_0x7ee887,_0x55a0c8=await database_1[_0x2bbdac(0x1d8)][_0x2bbdac(0x1fc)]('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x2bbdac(0x1fa)]['SELECT']});for(let _0x1b5e84 of _0x55a0c8){try{const _0x5dc014=await User_1['default']['findByPk'](_0x1b5e84['id']);await _0x5dc014[_0x2bbdac(0x1fb)]({'online':![]}),logger_1[_0x2bbdac(0x1e1)][_0x2bbdac(0x1d6)]('Usuario\x20passado\x20para\x20offline:\x20'+_0x1b5e84['id']);}catch(_0x2b54a8){Sentry[_0x2bbdac(0x1e6)](_0x2b54a8);}}}async function handleUserConnection(_0x24f101){const _0xfa9f10=a304_0x7ee887;try{const {id:_0x155eb6}=_0x24f101['data'];if(!(0x0,lodash_1['isNil'])(_0x155eb6)&&_0x155eb6!==_0xfa9f10(0x1e2)){const _0x24227e=await User_1[_0xfa9f10(0x1d8)]['findByPk'](_0x155eb6);_0x24227e&&(_0x24227e['online']=!![],await _0x24227e[_0xfa9f10(0x1f4)]());}}catch(_0xe7f83e){Sentry[_0xfa9f10(0x1e6)](_0xe7f83e);}}exports['userMonitor'][a304_0x7ee887(0x1eb)](a304_0x7ee887(0x1f0),handleUserConnection),exports[a304_0x7ee887(0x1fd)][a304_0x7ee887(0x1eb)](a304_0x7ee887(0x1df),handleLoginStatus);async function initUserMonitorQueues(){const _0x4264ab=a304_0x7ee887,_0x17aaea=await exports['userMonitor']['getRepeatableJobs']();for(let _0x260b3a of _0x17aaea){await exports[_0x4264ab(0x1fd)][_0x4264ab(0x1f6)](_0x260b3a[_0x4264ab(0x202)]);}exports['userMonitor'][_0x4264ab(0x1d5)](_0x4264ab(0x1df),{},{'repeat':{'cron':_0x4264ab(0x1e5),'key':_0x4264ab(0x1f9)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x4264ab(0x1e1)][_0x4264ab(0x1d6)](_0x4264ab(0x1e4));}exports[a304_0x7ee887(0x1ec)]=initUserMonitorQueues;