'use strict';const a316_0x255d4c=a316_0x3ef6;(function(_0x4e4b29,_0x35d7d7){const _0x25a6d2=a316_0x3ef6,_0x16b97d=_0x4e4b29();while(!![]){try{const _0xedc44c=-parseInt(_0x25a6d2(0x1ba))/0x1*(parseInt(_0x25a6d2(0x1dd))/0x2)+parseInt(_0x25a6d2(0x1d3))/0x3+-parseInt(_0x25a6d2(0x1c3))/0x4+parseInt(_0x25a6d2(0x1c8))/0x5*(-parseInt(_0x25a6d2(0x1be))/0x6)+-parseInt(_0x25a6d2(0x1d2))/0x7+-parseInt(_0x25a6d2(0x1dc))/0x8+parseInt(_0x25a6d2(0x1ca))/0x9;if(_0xedc44c===_0x35d7d7)break;else _0x16b97d['push'](_0x16b97d['shift']());}catch(_0x5ba8cd){_0x16b97d['push'](_0x16b97d['shift']());}}}(a316_0x4156,0xb39eb));var __createBinding=this&&this[a316_0x255d4c(0x1d6)]||(Object['create']?function(_0x187d78,_0x561adf,_0x8ae3af,_0x4e92f2){const _0x81dafa=a316_0x255d4c;if(_0x4e92f2===undefined)_0x4e92f2=_0x8ae3af;var _0x3eb3c7=Object[_0x81dafa(0x1b8)](_0x561adf,_0x8ae3af);(!_0x3eb3c7||(_0x81dafa(0x1d8)in _0x3eb3c7?!_0x561adf[_0x81dafa(0x1bc)]:_0x3eb3c7[_0x81dafa(0x1cd)]||_0x3eb3c7[_0x81dafa(0x1cb)]))&&(_0x3eb3c7={'enumerable':!![],'get':function(){return _0x561adf[_0x8ae3af];}}),Object['defineProperty'](_0x187d78,_0x4e92f2,_0x3eb3c7);}:function(_0x1bdfa9,_0x467c4a,_0x2f844c,_0x34dcde){if(_0x34dcde===undefined)_0x34dcde=_0x2f844c;_0x1bdfa9[_0x34dcde]=_0x467c4a[_0x2f844c];}),__setModuleDefault=this&&this[a316_0x255d4c(0x1d1)]||(Object[a316_0x255d4c(0x1b6)]?function(_0x558baf,_0x10a310){const _0x354836=a316_0x255d4c;Object['defineProperty'](_0x558baf,_0x354836(0x1b3),{'enumerable':!![],'value':_0x10a310});}:function(_0x5929dd,_0x4b121c){const _0x55ff25=a316_0x255d4c;_0x5929dd[_0x55ff25(0x1b3)]=_0x4b121c;}),__importStar=this&&this[a316_0x255d4c(0x1b5)]||function(_0x58a60f){const _0x5b71c1=a316_0x255d4c;if(_0x58a60f&&_0x58a60f[_0x5b71c1(0x1bc)])return _0x58a60f;var _0x50bb39={};if(_0x58a60f!=null){for(var _0x20c670 in _0x58a60f)if(_0x20c670!=='default'&&Object['prototype'][_0x5b71c1(0x1cf)][_0x5b71c1(0x1c1)](_0x58a60f,_0x20c670))__createBinding(_0x50bb39,_0x58a60f,_0x20c670);}return __setModuleDefault(_0x50bb39,_0x58a60f),_0x50bb39;},__importDefault=this&&this[a316_0x255d4c(0x1c5)]||function(_0x18e938){const _0x1b86bb=a316_0x255d4c;return _0x18e938&&_0x18e938[_0x1b86bb(0x1bc)]?_0x18e938:{'default':_0x18e938};};Object['defineProperty'](exports,a316_0x255d4c(0x1bc),{'value':!![]}),exports[a316_0x255d4c(0x1de)]=exports[a316_0x255d4c(0x1bb)]=void 0x0;function a316_0x3ef6(_0x2af464,_0x2b5413){const _0x41568f=a316_0x4156();return a316_0x3ef6=function(_0x3ef683,_0xcc1d4f){_0x3ef683=_0x3ef683-0x1b2;let _0x6473e4=_0x41568f[_0x3ef683];return _0x6473e4;},a316_0x3ef6(_0x2af464,_0x2b5413);}const bull_1=__importDefault(require('bull')),Sentry=__importStar(require(a316_0x255d4c(0x1c0))),sequelize_1=require(a316_0x255d4c(0x1d9)),lodash_1=require(a316_0x255d4c(0x1da)),logger_1=require(a316_0x255d4c(0x1b4)),database_1=__importDefault(require('../database')),User_1=__importDefault(require('../models/User')),connection=process[a316_0x255d4c(0x1c2)][a316_0x255d4c(0x1c9)]||'';function a316_0x4156(){const _0x1d2341=['784752eZOcqn','info','@sentry/node','call','env','3242020bXoUHE','UserConnection','__importDefault','*\x20*\x20*\x20*\x20*','process','5HqKiuo','REDIS_URI','28337805wCdhKK','configurable','key','writable','VerifyLoginStatus','hasOwnProperty','online','__setModuleDefault','6825224zXBIdj','3785208LEebiF','verify-loginstatus','findByPk','__createBinding','removeRepeatableByKey','get','sequelize','lodash','logger','10013080mwAJEB','6PGGTsM','initUserMonitorQueues','Usuario\x20passado\x20para\x20offline:\x20','QueryTypes','update','captureException','default','../utils/logger','__importStar','create','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','getOwnPropertyDescriptor','getRepeatableJobs','168898pguHnR','userMonitor','__esModule','query'];a316_0x4156=function(){return _0x1d2341;};return a316_0x4156();}exports[a316_0x255d4c(0x1bb)]=new bull_1[(a316_0x255d4c(0x1b3))]('UserMonitor',connection);async function handleLoginStatus(_0x58658a){const _0x5b7ea1=a316_0x255d4c,_0x517eba=await database_1[_0x5b7ea1(0x1b3)][_0x5b7ea1(0x1bd)](_0x5b7ea1(0x1b7),{'type':sequelize_1[_0x5b7ea1(0x1e0)]['SELECT']});for(let _0x2d9f61 of _0x517eba){try{const _0x47cdf7=await User_1[_0x5b7ea1(0x1b3)]['findByPk'](_0x2d9f61['id']);await _0x47cdf7[_0x5b7ea1(0x1e1)]({'online':![]}),logger_1[_0x5b7ea1(0x1db)][_0x5b7ea1(0x1bf)](_0x5b7ea1(0x1df)+_0x2d9f61['id']);}catch(_0xcec197){Sentry[_0x5b7ea1(0x1b2)](_0xcec197);}}}async function handleUserConnection(_0x2d82ad){const _0x3cd9e8=a316_0x255d4c;try{const {id:_0x4ef2a2}=_0x2d82ad['data'];if(!(0x0,lodash_1['isNil'])(_0x4ef2a2)&&_0x4ef2a2!=='null'){const _0x1c38bf=await User_1[_0x3cd9e8(0x1b3)][_0x3cd9e8(0x1d5)](_0x4ef2a2);_0x1c38bf&&(_0x1c38bf[_0x3cd9e8(0x1d0)]=!![],await _0x1c38bf['save']());}}catch(_0x2615f3){Sentry[_0x3cd9e8(0x1b2)](_0x2615f3);}}exports[a316_0x255d4c(0x1bb)][a316_0x255d4c(0x1c7)](a316_0x255d4c(0x1c4),handleUserConnection),exports['userMonitor'][a316_0x255d4c(0x1c7)](a316_0x255d4c(0x1ce),handleLoginStatus);async function initUserMonitorQueues(){const _0x3c8e8a=a316_0x255d4c,_0x4c2d62=await exports[_0x3c8e8a(0x1bb)][_0x3c8e8a(0x1b9)]();for(let _0x479329 of _0x4c2d62){await exports['userMonitor'][_0x3c8e8a(0x1d7)](_0x479329[_0x3c8e8a(0x1cc)]);}exports[_0x3c8e8a(0x1bb)]['add'](_0x3c8e8a(0x1ce),{},{'repeat':{'cron':_0x3c8e8a(0x1c6),'key':_0x3c8e8a(0x1d4)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1['logger'][_0x3c8e8a(0x1bf)]('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuÃ¡rio\x20inicializado');}exports[a316_0x255d4c(0x1de)]=initUserMonitorQueues;