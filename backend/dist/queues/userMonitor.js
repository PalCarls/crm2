'use strict';const a276_0x211994=a276_0x32f4;(function(_0x518b09,_0xc75d05){const _0xa910e3=a276_0x32f4,_0x5a1c4d=_0x518b09();while(!![]){try{const _0x3ea10f=-parseInt(_0xa910e3(0x81))/0x1+parseInt(_0xa910e3(0x84))/0x2*(parseInt(_0xa910e3(0x90))/0x3)+-parseInt(_0xa910e3(0x8b))/0x4+-parseInt(_0xa910e3(0x78))/0x5+-parseInt(_0xa910e3(0x6d))/0x6*(parseInt(_0xa910e3(0x80))/0x7)+parseInt(_0xa910e3(0x8c))/0x8+parseInt(_0xa910e3(0x83))/0x9;if(_0x3ea10f===_0xc75d05)break;else _0x5a1c4d['push'](_0x5a1c4d['shift']());}catch(_0x5b4c0a){_0x5a1c4d['push'](_0x5a1c4d['shift']());}}}(a276_0x5d55,0x3082e));var __createBinding=this&&this['__createBinding']||(Object[a276_0x211994(0x95)]?function(_0xfa868,_0x2e1469,_0x3447bb,_0x45948b){const _0x34c4a0=a276_0x211994;if(_0x45948b===undefined)_0x45948b=_0x3447bb;var _0x2e303b=Object['getOwnPropertyDescriptor'](_0x2e1469,_0x3447bb);(!_0x2e303b||(_0x34c4a0(0x7b)in _0x2e303b?!_0x2e1469[_0x34c4a0(0x73)]:_0x2e303b[_0x34c4a0(0x71)]||_0x2e303b[_0x34c4a0(0x94)]))&&(_0x2e303b={'enumerable':!![],'get':function(){return _0x2e1469[_0x3447bb];}}),Object[_0x34c4a0(0x79)](_0xfa868,_0x45948b,_0x2e303b);}:function(_0x533221,_0x443a4e,_0x17ce0b,_0x43da4a){if(_0x43da4a===undefined)_0x43da4a=_0x17ce0b;_0x533221[_0x43da4a]=_0x443a4e[_0x17ce0b];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x21af55,_0x13b16c){const _0x1bee2a=a276_0x211994;Object[_0x1bee2a(0x79)](_0x21af55,_0x1bee2a(0x8a),{'enumerable':!![],'value':_0x13b16c});}:function(_0xf5b0b0,_0x483a84){const _0x586b61=a276_0x211994;_0xf5b0b0[_0x586b61(0x8a)]=_0x483a84;}),__importStar=this&&this['__importStar']||function(_0x2f88c1){const _0x5b51f9=a276_0x211994;if(_0x2f88c1&&_0x2f88c1[_0x5b51f9(0x73)])return _0x2f88c1;var _0x9956c8={};if(_0x2f88c1!=null){for(var _0x410b06 in _0x2f88c1)if(_0x410b06!=='default'&&Object['prototype'][_0x5b51f9(0x85)][_0x5b51f9(0x7f)](_0x2f88c1,_0x410b06))__createBinding(_0x9956c8,_0x2f88c1,_0x410b06);}return __setModuleDefault(_0x9956c8,_0x2f88c1),_0x9956c8;},__importDefault=this&&this[a276_0x211994(0x74)]||function(_0x53b328){const _0x1577a8=a276_0x211994;return _0x53b328&&_0x53b328[_0x1577a8(0x73)]?_0x53b328:{'default':_0x53b328};};Object[a276_0x211994(0x79)](exports,a276_0x211994(0x73),{'value':!![]}),exports[a276_0x211994(0x72)]=exports[a276_0x211994(0x8e)]=void 0x0;const bull_1=__importDefault(require('bull')),Sentry=__importStar(require(a276_0x211994(0x6f))),sequelize_1=require(a276_0x211994(0x7a)),lodash_1=require('lodash'),logger_1=require('../utils/logger'),database_1=__importDefault(require(a276_0x211994(0x6e))),User_1=__importDefault(require('../models/User')),connection=process['env'][a276_0x211994(0x68)]||'';function a276_0x32f4(_0x81ad2d,_0x3e72dc){const _0x5d55b1=a276_0x5d55();return a276_0x32f4=function(_0x32f483,_0xe8708f){_0x32f483=_0x32f483-0x67;let _0x113bdd=_0x5d55b1[_0x32f483];return _0x113bdd;},a276_0x32f4(_0x81ad2d,_0x3e72dc);}exports['userMonitor']=new bull_1[(a276_0x211994(0x8a))](a276_0x211994(0x6b),connection);async function handleLoginStatus(_0x3b216f){const _0x19249e=a276_0x211994,_0x194fd8=await database_1[_0x19249e(0x8a)][_0x19249e(0x67)](_0x19249e(0x88),{'type':sequelize_1['QueryTypes'][_0x19249e(0x93)]});for(let _0x2d8747 of _0x194fd8){try{const _0x3f5b1e=await User_1[_0x19249e(0x8a)][_0x19249e(0x8f)](_0x2d8747['id']);await _0x3f5b1e[_0x19249e(0x77)]({'online':![]}),logger_1[_0x19249e(0x82)]['info'](_0x19249e(0x7d)+_0x2d8747['id']);}catch(_0x5c1803){Sentry[_0x19249e(0x89)](_0x5c1803);}}}async function handleUserConnection(_0x233d1b){const _0x1579c9=a276_0x211994;try{const {id:_0x1daef9}=_0x233d1b['data'];if(!(0x0,lodash_1[_0x1579c9(0x75)])(_0x1daef9)&&_0x1daef9!==_0x1579c9(0x69)){const _0x3df980=await User_1[_0x1579c9(0x8a)][_0x1579c9(0x8f)](_0x1daef9);_0x3df980&&(_0x3df980[_0x1579c9(0x76)]=!![],await _0x3df980[_0x1579c9(0x6c)]());}}catch(_0x4b444f){Sentry[_0x1579c9(0x89)](_0x4b444f);}}function a276_0x5d55(){const _0x5c7877=['getRepeatableJobs','*\x20*\x20*\x20*\x20*','SELECT','configurable','create','query','REDIS_URI','null','process','UserMonitor','save','557046LDktdh','../database','@sentry/node','UserConnection','writable','initUserMonitorQueues','__esModule','__importDefault','isNil','online','update','126325Aqzdhx','defineProperty','sequelize','get','add','Usuario\x20passado\x20para\x20offline:\x20','Queue:\x20monitoramento\x20de\x20status\x20de\x20usu√°rio\x20inicializado','call','14dVHZiS','82502PfjxZx','logger','3583620sJbtfz','143356hIWlRF','hasOwnProperty','verify-loginstatus','key','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','captureException','default','853668gZPfTM','1885680mjWXQN','VerifyLoginStatus','userMonitor','findByPk','3SDBWMT'];a276_0x5d55=function(){return _0x5c7877;};return a276_0x5d55();}exports[a276_0x211994(0x8e)]['process'](a276_0x211994(0x70),handleUserConnection),exports[a276_0x211994(0x8e)][a276_0x211994(0x6a)](a276_0x211994(0x8d),handleLoginStatus);async function initUserMonitorQueues(){const _0x48b2a7=a276_0x211994,_0x2d01b7=await exports['userMonitor'][_0x48b2a7(0x91)]();for(let _0x120f04 of _0x2d01b7){await exports[_0x48b2a7(0x8e)]['removeRepeatableByKey'](_0x120f04[_0x48b2a7(0x87)]);}exports['userMonitor'][_0x48b2a7(0x7c)](_0x48b2a7(0x8d),{},{'repeat':{'cron':_0x48b2a7(0x92),'key':_0x48b2a7(0x86)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1['logger']['info'](_0x48b2a7(0x7e));}exports[a276_0x211994(0x72)]=initUserMonitorQueues;