'use strict';const a305_0x1c6012=a305_0x5d36;(function(_0x2eaf84,_0x33b323){const _0x34124b=a305_0x5d36,_0xacbee1=_0x2eaf84();while(!![]){try{const _0xf92284=parseInt(_0x34124b(0x205))/0x1*(parseInt(_0x34124b(0x200))/0x2)+-parseInt(_0x34124b(0x1ed))/0x3+-parseInt(_0x34124b(0x1f1))/0x4*(-parseInt(_0x34124b(0x208))/0x5)+-parseInt(_0x34124b(0x204))/0x6+-parseInt(_0x34124b(0x201))/0x7+parseInt(_0x34124b(0x1e0))/0x8+parseInt(_0x34124b(0x1f8))/0x9;if(_0xf92284===_0x33b323)break;else _0xacbee1['push'](_0xacbee1['shift']());}catch(_0x1df307){_0xacbee1['push'](_0xacbee1['shift']());}}}(a305_0x4fb6,0xecaa8));var __createBinding=this&&this[a305_0x1c6012(0x209)]||(Object[a305_0x1c6012(0x1e7)]?function(_0x5540b3,_0x349beb,_0x1f250a,_0x6ec38f){const _0x59770f=a305_0x1c6012;if(_0x6ec38f===undefined)_0x6ec38f=_0x1f250a;var _0x45fddd=Object[_0x59770f(0x1f7)](_0x349beb,_0x1f250a);(!_0x45fddd||(_0x59770f(0x1df)in _0x45fddd?!_0x349beb[_0x59770f(0x20d)]:_0x45fddd[_0x59770f(0x20c)]||_0x45fddd[_0x59770f(0x1f3)]))&&(_0x45fddd={'enumerable':!![],'get':function(){return _0x349beb[_0x1f250a];}}),Object['defineProperty'](_0x5540b3,_0x6ec38f,_0x45fddd);}:function(_0x441149,_0x744ba9,_0x3da364,_0x348030){if(_0x348030===undefined)_0x348030=_0x3da364;_0x441149[_0x348030]=_0x744ba9[_0x3da364];}),__setModuleDefault=this&&this[a305_0x1c6012(0x1ea)]||(Object['create']?function(_0x240872,_0x4e26c5){const _0x33699e=a305_0x1c6012;Object[_0x33699e(0x1eb)](_0x240872,_0x33699e(0x20e),{'enumerable':!![],'value':_0x4e26c5});}:function(_0x54cdb9,_0x255781){const _0x47aa31=a305_0x1c6012;_0x54cdb9[_0x47aa31(0x20e)]=_0x255781;}),__importStar=this&&this['__importStar']||function(_0x2f2b7b){const _0x1c4bce=a305_0x1c6012;if(_0x2f2b7b&&_0x2f2b7b[_0x1c4bce(0x20d)])return _0x2f2b7b;var _0x336b1b={};if(_0x2f2b7b!=null){for(var _0x16675e in _0x2f2b7b)if(_0x16675e!==_0x1c4bce(0x20e)&&Object[_0x1c4bce(0x1ff)]['hasOwnProperty'][_0x1c4bce(0x1fd)](_0x2f2b7b,_0x16675e))__createBinding(_0x336b1b,_0x2f2b7b,_0x16675e);}return __setModuleDefault(_0x336b1b,_0x2f2b7b),_0x336b1b;},__importDefault=this&&this[a305_0x1c6012(0x20b)]||function(_0x440c1e){const _0x317948=a305_0x1c6012;return _0x440c1e&&_0x440c1e[_0x317948(0x20d)]?_0x440c1e:{'default':_0x440c1e};};Object[a305_0x1c6012(0x1eb)](exports,'__esModule',{'value':!![]}),exports[a305_0x1c6012(0x207)]=exports[a305_0x1c6012(0x1e2)]=void 0x0;const bull_1=__importDefault(require(a305_0x1c6012(0x1e8))),Sentry=__importStar(require(a305_0x1c6012(0x1ef))),sequelize_1=require('sequelize'),lodash_1=require('lodash'),logger_1=require(a305_0x1c6012(0x1e6)),database_1=__importDefault(require(a305_0x1c6012(0x1e9))),User_1=__importDefault(require(a305_0x1c6012(0x20f))),connection=process['env'][a305_0x1c6012(0x1f0)]||'';function a305_0x4fb6(){const _0x16c78a=['info','key','../utils/logger','create','bull','../database','__setModuleDefault','defineProperty','*\x20*\x20*\x20*\x20*','2399724hQafCB','online','@sentry/node','REDIS_URI','180BTdfub','save','configurable','UserConnection','VerifyLoginStatus','logger','getOwnPropertyDescriptor','6122718JroWKT','update','SELECT','UserMonitor','query','call','removeRepeatableByKey','prototype','361306qCvhnR','6332662oGNOTI','add','Usuario\x20passado\x20para\x20offline:\x20','1934256zkYxKK','1KuTfnG','data','initUserMonitorQueues','165565mrcqZR','__createBinding','Queue:\x20monitoramento\x20de\x20status\x20de\x20usu√°rio\x20inicializado','__importDefault','writable','__esModule','default','../models/User','get','5162352ErfJdT','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','userMonitor','captureException'];a305_0x4fb6=function(){return _0x16c78a;};return a305_0x4fb6();}exports[a305_0x1c6012(0x1e2)]=new bull_1['default'](a305_0x1c6012(0x1fb),connection);async function handleLoginStatus(_0x2738ec){const _0x48c028=a305_0x1c6012,_0x8bcf6d=await database_1[_0x48c028(0x20e)][_0x48c028(0x1fc)](_0x48c028(0x1e1),{'type':sequelize_1['QueryTypes'][_0x48c028(0x1fa)]});for(let _0x4c1580 of _0x8bcf6d){try{const _0x157fae=await User_1['default']['findByPk'](_0x4c1580['id']);await _0x157fae[_0x48c028(0x1f9)]({'online':![]}),logger_1[_0x48c028(0x1f6)]['info'](_0x48c028(0x203)+_0x4c1580['id']);}catch(_0xb84b25){Sentry['captureException'](_0xb84b25);}}}async function handleUserConnection(_0x3af366){const _0x263e16=a305_0x1c6012;try{const {id:_0x51c36c}=_0x3af366[_0x263e16(0x206)];if(!(0x0,lodash_1['isNil'])(_0x51c36c)&&_0x51c36c!=='null'){const _0x11b21e=await User_1[_0x263e16(0x20e)]['findByPk'](_0x51c36c);_0x11b21e&&(_0x11b21e[_0x263e16(0x1ee)]=!![],await _0x11b21e[_0x263e16(0x1f2)]());}}catch(_0x34a4cf){Sentry[_0x263e16(0x1e3)](_0x34a4cf);}}exports[a305_0x1c6012(0x1e2)]['process'](a305_0x1c6012(0x1f4),handleUserConnection),exports[a305_0x1c6012(0x1e2)]['process']('VerifyLoginStatus',handleLoginStatus);async function initUserMonitorQueues(){const _0x1aa358=a305_0x1c6012,_0x310f25=await exports['userMonitor']['getRepeatableJobs']();for(let _0x6bdaa4 of _0x310f25){await exports['userMonitor'][_0x1aa358(0x1fe)](_0x6bdaa4[_0x1aa358(0x1e5)]);}exports['userMonitor'][_0x1aa358(0x202)](_0x1aa358(0x1f5),{},{'repeat':{'cron':_0x1aa358(0x1ec),'key':'verify-loginstatus'},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x1aa358(0x1f6)][_0x1aa358(0x1e4)](_0x1aa358(0x20a));}function a305_0x5d36(_0x3209d3,_0x7f3a33){const _0x4fb663=a305_0x4fb6();return a305_0x5d36=function(_0x5d3619,_0x992ae3){_0x5d3619=_0x5d3619-0x1df;let _0x5a1a59=_0x4fb663[_0x5d3619];return _0x5a1a59;},a305_0x5d36(_0x3209d3,_0x7f3a33);}exports[a305_0x1c6012(0x207)]=initUserMonitorQueues;