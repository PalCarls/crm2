'use strict';const a352_0x37bf89=a352_0x16b6;(function(_0x51ede6,_0x20ee61){const _0x5eaba3=a352_0x16b6,_0x4b18ce=_0x51ede6();while(!![]){try{const _0x507f7d=-parseInt(_0x5eaba3(0xd0))/0x1+parseInt(_0x5eaba3(0xba))/0x2*(-parseInt(_0x5eaba3(0xd1))/0x3)+parseInt(_0x5eaba3(0xbd))/0x4+-parseInt(_0x5eaba3(0xc6))/0x5+-parseInt(_0x5eaba3(0xda))/0x6*(-parseInt(_0x5eaba3(0xb9))/0x7)+parseInt(_0x5eaba3(0xb4))/0x8+parseInt(_0x5eaba3(0xd3))/0x9;if(_0x507f7d===_0x20ee61)break;else _0x4b18ce['push'](_0x4b18ce['shift']());}catch(_0x2a6178){_0x4b18ce['push'](_0x4b18ce['shift']());}}}(a352_0x4187,0x6cc84));var __createBinding=this&&this['__createBinding']||(Object[a352_0x37bf89(0xde)]?function(_0x45f8ba,_0x5e28d8,_0x11e6ec,_0x35fa61){const _0x292e69=a352_0x37bf89;if(_0x35fa61===undefined)_0x35fa61=_0x11e6ec;var _0x45f8e5=Object[_0x292e69(0xbf)](_0x5e28d8,_0x11e6ec);(!_0x45f8e5||(_0x292e69(0xc5)in _0x45f8e5?!_0x5e28d8[_0x292e69(0xae)]:_0x45f8e5[_0x292e69(0xcf)]||_0x45f8e5[_0x292e69(0xe0)]))&&(_0x45f8e5={'enumerable':!![],'get':function(){return _0x5e28d8[_0x11e6ec];}}),Object['defineProperty'](_0x45f8ba,_0x35fa61,_0x45f8e5);}:function(_0x5ab44a,_0x45af54,_0x4af6bf,_0x28fa60){if(_0x28fa60===undefined)_0x28fa60=_0x4af6bf;_0x5ab44a[_0x28fa60]=_0x45af54[_0x4af6bf];}),__setModuleDefault=this&&this[a352_0x37bf89(0xb0)]||(Object[a352_0x37bf89(0xde)]?function(_0x146395,_0x9e6a49){const _0x2f803e=a352_0x37bf89;Object[_0x2f803e(0xb3)](_0x146395,_0x2f803e(0xcc),{'enumerable':!![],'value':_0x9e6a49});}:function(_0x5ee945,_0x4929c7){const _0x4b4c5a=a352_0x37bf89;_0x5ee945[_0x4b4c5a(0xcc)]=_0x4929c7;}),__importStar=this&&this[a352_0x37bf89(0xdc)]||function(_0x5446cd){const _0x49d37d=a352_0x37bf89;if(_0x5446cd&&_0x5446cd[_0x49d37d(0xae)])return _0x5446cd;var _0xc67f4a={};if(_0x5446cd!=null){for(var _0x47dbab in _0x5446cd)if(_0x47dbab!=='default'&&Object[_0x49d37d(0xd4)][_0x49d37d(0xc2)][_0x49d37d(0xb1)](_0x5446cd,_0x47dbab))__createBinding(_0xc67f4a,_0x5446cd,_0x47dbab);}return __setModuleDefault(_0xc67f4a,_0x5446cd),_0xc67f4a;},__importDefault=this&&this[a352_0x37bf89(0xbc)]||function(_0x3224fb){const _0x2bd17c=a352_0x37bf89;return _0x3224fb&&_0x3224fb[_0x2bd17c(0xae)]?_0x3224fb:{'default':_0x3224fb};};Object['defineProperty'](exports,a352_0x37bf89(0xae),{'value':!![]}),exports[a352_0x37bf89(0xe1)]=exports[a352_0x37bf89(0xce)]=void 0x0;const bull_1=__importDefault(require('bull')),Sentry=__importStar(require(a352_0x37bf89(0xbe))),sequelize_1=require(a352_0x37bf89(0xc0)),lodash_1=require(a352_0x37bf89(0xdf)),logger_1=require('../utils/logger'),database_1=__importDefault(require('../database')),User_1=__importDefault(require(a352_0x37bf89(0xdb))),connection=process[a352_0x37bf89(0xd9)][a352_0x37bf89(0xca)]||'';function a352_0x16b6(_0x171585,_0x388151){const _0x418795=a352_0x4187();return a352_0x16b6=function(_0x16b6d0,_0x13094b){_0x16b6d0=_0x16b6d0-0xae;let _0x505800=_0x418795[_0x16b6d0];return _0x505800;},a352_0x16b6(_0x171585,_0x388151);}exports['userMonitor']=new bull_1[(a352_0x37bf89(0xcc))](a352_0x37bf89(0xe2),connection);async function handleLoginStatus(_0x20d47f){const _0x1c1851=a352_0x37bf89,_0x287c7b=await database_1[_0x1c1851(0xcc)][_0x1c1851(0xd2)](_0x1c1851(0xc7),{'type':sequelize_1[_0x1c1851(0xc1)][_0x1c1851(0xb2)]});for(let _0x992bb8 of _0x287c7b){try{const _0xd28bc2=await User_1[_0x1c1851(0xcc)]['findByPk'](_0x992bb8['id']);await _0xd28bc2[_0x1c1851(0xe3)]({'online':![]}),logger_1[_0x1c1851(0xb6)][_0x1c1851(0xaf)](_0x1c1851(0xdd)+_0x992bb8['id']);}catch(_0x64fc07){Sentry[_0x1c1851(0xcd)](_0x64fc07);}}}async function handleUserConnection(_0x269640){const _0x21f901=a352_0x37bf89;try{const {id:_0x556fac}=_0x269640[_0x21f901(0xd7)];if(!(0x0,lodash_1[_0x21f901(0xcb)])(_0x556fac)&&_0x556fac!==_0x21f901(0xc8)){const _0x5a3840=await User_1[_0x21f901(0xcc)][_0x21f901(0xd6)](_0x556fac);_0x5a3840&&(_0x5a3840[_0x21f901(0xb5)]=!![],await _0x5a3840['save']());}}catch(_0x5991ec){Sentry['captureException'](_0x5991ec);}}exports['userMonitor'][a352_0x37bf89(0xc3)](a352_0x37bf89(0xbb),handleUserConnection),exports[a352_0x37bf89(0xce)]['process'](a352_0x37bf89(0xd8),handleLoginStatus);async function initUserMonitorQueues(){const _0x18e27b=a352_0x37bf89,_0x163e9f=await exports[_0x18e27b(0xce)]['getRepeatableJobs']();for(let _0x66b7f2 of _0x163e9f){await exports[_0x18e27b(0xce)][_0x18e27b(0xb8)](_0x66b7f2[_0x18e27b(0xc4)]);}exports['userMonitor'][_0x18e27b(0xc9)](_0x18e27b(0xd8),{},{'repeat':{'cron':_0x18e27b(0xb7),'key':_0x18e27b(0xd5)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x18e27b(0xb6)][_0x18e27b(0xaf)]('Queue:\x20monitoramento\x20de\x20status\x20de\x20usu√°rio\x20inicializado');}function a352_0x4187(){const _0xa2b82e=['657551jjJjYm','9891ixrJpX','query','3543615bWtfxB','prototype','verify-loginstatus','findByPk','data','VerifyLoginStatus','env','2513898kYJOMg','../models/User','__importStar','Usuario\x20passado\x20para\x20offline:\x20','create','lodash','configurable','initUserMonitorQueues','UserMonitor','update','__esModule','info','__setModuleDefault','call','SELECT','defineProperty','2912496XKxQGU','online','logger','*\x20*\x20*\x20*\x20*','removeRepeatableByKey','7wYicBr','242vIAqUY','UserConnection','__importDefault','2108884TOTuzq','@sentry/node','getOwnPropertyDescriptor','sequelize','QueryTypes','hasOwnProperty','process','key','get','1009705EgzoRf','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','null','add','REDIS_URI','isNil','default','captureException','userMonitor','writable'];a352_0x4187=function(){return _0xa2b82e;};return a352_0x4187();}exports[a352_0x37bf89(0xe1)]=initUserMonitorQueues;