'use strict';const a289_0x647d0a=a289_0x2558;function a289_0x1cd2(){const _0x4c080e=['getRepeatableJobs','update','3RMNPeY','2172vswCWH','../models/User','__importDefault','initUserMonitorQueues','786630rFQLSF','verify-loginstatus','@sentry/node','online','UserConnection','lodash','removeRepeatableByKey','8dcKsAl','userMonitor','5516553JZlZep','key','4810773ZvDrYd','add','captureException','query','default','writable','process','findByPk','isNil','__importStar','logger','__createBinding','data','135091bbhQjD','create','env','6330VjfEmX','__setModuleDefault','36fGtvtH','SELECT','save','27WjRiVo','1421328SrfjGI','configurable','1606084ssNFOp','Queue:\x20monitoramento\x20de\x20status\x20de\x20usu√°rio\x20inicializado','null','*\x20*\x20*\x20*\x20*','defineProperty','__esModule','VerifyLoginStatus','sequelize','bull','prototype','get','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','../database'];a289_0x1cd2=function(){return _0x4c080e;};return a289_0x1cd2();}(function(_0x27620b,_0x3aa2b5){const _0x56d879=a289_0x2558,_0x35e8a6=_0x27620b();while(!![]){try{const _0x4700be=parseInt(_0x56d879(0xd5))/0x1+-parseInt(_0x56d879(0xa9))/0x2+parseInt(_0x56d879(0xb8))/0x3*(parseInt(_0x56d879(0xa7))/0x4)+parseInt(_0x56d879(0xa1))/0x5*(parseInt(_0x56d879(0xb9))/0x6)+-parseInt(_0x56d879(0xc6))/0x7*(parseInt(_0x56d879(0xc4))/0x8)+-parseInt(_0x56d879(0xa6))/0x9*(-parseInt(_0x56d879(0xbd))/0xa)+-parseInt(_0x56d879(0xc8))/0xb*(-parseInt(_0x56d879(0xa3))/0xc);if(_0x4700be===_0x3aa2b5)break;else _0x35e8a6['push'](_0x35e8a6['shift']());}catch(_0x45dfa9){_0x35e8a6['push'](_0x35e8a6['shift']());}}}(a289_0x1cd2,0xdd18c));var __createBinding=this&&this[a289_0x647d0a(0xd3)]||(Object['create']?function(_0x43ba75,_0x3ed156,_0x35321c,_0x15f71f){const _0x18331e=a289_0x647d0a;if(_0x15f71f===undefined)_0x15f71f=_0x35321c;var _0xeda7de=Object['getOwnPropertyDescriptor'](_0x3ed156,_0x35321c);(!_0xeda7de||(_0x18331e(0xb3)in _0xeda7de?!_0x3ed156[_0x18331e(0xae)]:_0xeda7de[_0x18331e(0xcd)]||_0xeda7de[_0x18331e(0xa8)]))&&(_0xeda7de={'enumerable':!![],'get':function(){return _0x3ed156[_0x35321c];}}),Object[_0x18331e(0xad)](_0x43ba75,_0x15f71f,_0xeda7de);}:function(_0x493fb2,_0x535bc7,_0x30a1aa,_0x1c47eb){if(_0x1c47eb===undefined)_0x1c47eb=_0x30a1aa;_0x493fb2[_0x1c47eb]=_0x535bc7[_0x30a1aa];}),__setModuleDefault=this&&this[a289_0x647d0a(0xa2)]||(Object[a289_0x647d0a(0xd6)]?function(_0x36a4c0,_0x176a76){const _0x310894=a289_0x647d0a;Object[_0x310894(0xad)](_0x36a4c0,_0x310894(0xcc),{'enumerable':!![],'value':_0x176a76});}:function(_0x51d89a,_0x3d2f83){const _0x153fa6=a289_0x647d0a;_0x51d89a[_0x153fa6(0xcc)]=_0x3d2f83;}),__importStar=this&&this[a289_0x647d0a(0xd1)]||function(_0x3e3ab9){const _0x1b1772=a289_0x647d0a;if(_0x3e3ab9&&_0x3e3ab9[_0x1b1772(0xae)])return _0x3e3ab9;var _0x46e4f2={};if(_0x3e3ab9!=null){for(var _0x14dfe in _0x3e3ab9)if(_0x14dfe!=='default'&&Object[_0x1b1772(0xb2)]['hasOwnProperty']['call'](_0x3e3ab9,_0x14dfe))__createBinding(_0x46e4f2,_0x3e3ab9,_0x14dfe);}return __setModuleDefault(_0x46e4f2,_0x3e3ab9),_0x46e4f2;},__importDefault=this&&this[a289_0x647d0a(0xbb)]||function(_0xcea47f){const _0x256bf9=a289_0x647d0a;return _0xcea47f&&_0xcea47f[_0x256bf9(0xae)]?_0xcea47f:{'default':_0xcea47f};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a289_0x647d0a(0xbc)]=exports[a289_0x647d0a(0xc5)]=void 0x0;const bull_1=__importDefault(require(a289_0x647d0a(0xb1))),Sentry=__importStar(require(a289_0x647d0a(0xbf))),sequelize_1=require(a289_0x647d0a(0xb0)),lodash_1=require(a289_0x647d0a(0xc2)),logger_1=require('../utils/logger'),database_1=__importDefault(require(a289_0x647d0a(0xb5))),User_1=__importDefault(require(a289_0x647d0a(0xba))),connection=process[a289_0x647d0a(0xd7)]['REDIS_URI']||'';exports[a289_0x647d0a(0xc5)]=new bull_1['default']('UserMonitor',connection);function a289_0x2558(_0x3b83de,_0x5544b4){const _0x1cd2a8=a289_0x1cd2();return a289_0x2558=function(_0x255821,_0x46b563){_0x255821=_0x255821-0xa1;let _0x1d2759=_0x1cd2a8[_0x255821];return _0x1d2759;},a289_0x2558(_0x3b83de,_0x5544b4);}async function handleLoginStatus(_0x514b32){const _0x4fd3af=a289_0x647d0a,_0x19098b=await database_1[_0x4fd3af(0xcc)][_0x4fd3af(0xcb)](_0x4fd3af(0xb4),{'type':sequelize_1['QueryTypes'][_0x4fd3af(0xa4)]});for(let _0x57df17 of _0x19098b){try{const _0x3548de=await User_1[_0x4fd3af(0xcc)][_0x4fd3af(0xcf)](_0x57df17['id']);await _0x3548de[_0x4fd3af(0xb7)]({'online':![]}),logger_1[_0x4fd3af(0xd2)]['info']('Usuario\x20passado\x20para\x20offline:\x20'+_0x57df17['id']);}catch(_0x19dbfc){Sentry['captureException'](_0x19dbfc);}}}async function handleUserConnection(_0x442803){const _0x55bac3=a289_0x647d0a;try{const {id:_0x10e85a}=_0x442803[_0x55bac3(0xd4)];if(!(0x0,lodash_1[_0x55bac3(0xd0)])(_0x10e85a)&&_0x10e85a!==_0x55bac3(0xab)){const _0x5ecb54=await User_1[_0x55bac3(0xcc)][_0x55bac3(0xcf)](_0x10e85a);_0x5ecb54&&(_0x5ecb54[_0x55bac3(0xc0)]=!![],await _0x5ecb54[_0x55bac3(0xa5)]());}}catch(_0x110ea3){Sentry[_0x55bac3(0xca)](_0x110ea3);}}exports[a289_0x647d0a(0xc5)][a289_0x647d0a(0xce)](a289_0x647d0a(0xc1),handleUserConnection),exports['userMonitor'][a289_0x647d0a(0xce)](a289_0x647d0a(0xaf),handleLoginStatus);async function initUserMonitorQueues(){const _0x5063b7=a289_0x647d0a,_0x5135e8=await exports['userMonitor'][_0x5063b7(0xb6)]();for(let _0x24a389 of _0x5135e8){await exports[_0x5063b7(0xc5)][_0x5063b7(0xc3)](_0x24a389[_0x5063b7(0xc7)]);}exports[_0x5063b7(0xc5)][_0x5063b7(0xc9)](_0x5063b7(0xaf),{},{'repeat':{'cron':_0x5063b7(0xac),'key':_0x5063b7(0xbe)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1['logger']['info'](_0x5063b7(0xaa));}exports[a289_0x647d0a(0xbc)]=initUserMonitorQueues;