'use strict';const a316_0x3e901a=a316_0x81d3;(function(_0x18db7d,_0x261204){const _0x480760=a316_0x81d3,_0x2dc778=_0x18db7d();while(!![]){try{const _0x354afd=-parseInt(_0x480760(0xe7))/0x1*(-parseInt(_0x480760(0xe0))/0x2)+parseInt(_0x480760(0xeb))/0x3*(parseInt(_0x480760(0xd5))/0x4)+parseInt(_0x480760(0xf6))/0x5*(-parseInt(_0x480760(0xf9))/0x6)+-parseInt(_0x480760(0xe9))/0x7+parseInt(_0x480760(0xfd))/0x8*(parseInt(_0x480760(0xd9))/0x9)+parseInt(_0x480760(0xf4))/0xa+parseInt(_0x480760(0xf7))/0xb*(-parseInt(_0x480760(0xd4))/0xc);if(_0x354afd===_0x261204)break;else _0x2dc778['push'](_0x2dc778['shift']());}catch(_0x597208){_0x2dc778['push'](_0x2dc778['shift']());}}}(a316_0x440d,0x84935));var __createBinding=this&&this[a316_0x3e901a(0xed)]||(Object[a316_0x3e901a(0xda)]?function(_0x5be893,_0x3a0279,_0xee694c,_0x49372f){const _0x2b7889=a316_0x3e901a;if(_0x49372f===undefined)_0x49372f=_0xee694c;var _0x1267fc=Object[_0x2b7889(0xdb)](_0x3a0279,_0xee694c);(!_0x1267fc||(_0x2b7889(0xd0)in _0x1267fc?!_0x3a0279['__esModule']:_0x1267fc[_0x2b7889(0xdf)]||_0x1267fc[_0x2b7889(0xf0)]))&&(_0x1267fc={'enumerable':!![],'get':function(){return _0x3a0279[_0xee694c];}}),Object[_0x2b7889(0xd6)](_0x5be893,_0x49372f,_0x1267fc);}:function(_0x22d9f2,_0x22117d,_0x4196c5,_0x4c7640){if(_0x4c7640===undefined)_0x4c7640=_0x4196c5;_0x22d9f2[_0x4c7640]=_0x22117d[_0x4196c5];}),__setModuleDefault=this&&this[a316_0x3e901a(0xe2)]||(Object[a316_0x3e901a(0xda)]?function(_0x1c7a6a,_0xbea258){const _0x51720a=a316_0x3e901a;Object[_0x51720a(0xd6)](_0x1c7a6a,'default',{'enumerable':!![],'value':_0xbea258});}:function(_0x3edc1d,_0x4752e6){const _0x4ef42a=a316_0x3e901a;_0x3edc1d[_0x4ef42a(0xf5)]=_0x4752e6;}),__importStar=this&&this['__importStar']||function(_0x25cd43){const _0x4ffe48=a316_0x3e901a;if(_0x25cd43&&_0x25cd43[_0x4ffe48(0xef)])return _0x25cd43;var _0x45db60={};if(_0x25cd43!=null){for(var _0x3a0da2 in _0x25cd43)if(_0x3a0da2!==_0x4ffe48(0xf5)&&Object[_0x4ffe48(0xd8)][_0x4ffe48(0xfc)][_0x4ffe48(0xea)](_0x25cd43,_0x3a0da2))__createBinding(_0x45db60,_0x25cd43,_0x3a0da2);}return __setModuleDefault(_0x45db60,_0x25cd43),_0x45db60;},__importDefault=this&&this['__importDefault']||function(_0x5df21a){const _0x509b19=a316_0x3e901a;return _0x5df21a&&_0x5df21a[_0x509b19(0xef)]?_0x5df21a:{'default':_0x5df21a};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a316_0x3e901a(0xd7)]=exports[a316_0x3e901a(0xd1)]=void 0x0;const bull_1=__importDefault(require(a316_0x3e901a(0xd3))),Sentry=__importStar(require('@sentry/node')),sequelize_1=require(a316_0x3e901a(0xde)),lodash_1=require('lodash'),logger_1=require(a316_0x3e901a(0xf3)),database_1=__importDefault(require(a316_0x3e901a(0xd2))),User_1=__importDefault(require('../models/User')),connection=process[a316_0x3e901a(0xe8)][a316_0x3e901a(0xe4)]||'';exports[a316_0x3e901a(0xd1)]=new bull_1[(a316_0x3e901a(0xf5))](a316_0x3e901a(0xe1),connection);async function handleLoginStatus(_0x4478ba){const _0x5b2d33=a316_0x3e901a,_0x21f171=await database_1[_0x5b2d33(0xf5)]['query']('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x5b2d33(0xfe)][_0x5b2d33(0xf1)]});for(let _0x4d61e5 of _0x21f171){try{const _0x4aed23=await User_1[_0x5b2d33(0xf5)][_0x5b2d33(0xcd)](_0x4d61e5['id']);await _0x4aed23[_0x5b2d33(0xee)]({'online':![]}),logger_1['logger'][_0x5b2d33(0xec)](_0x5b2d33(0xf8)+_0x4d61e5['id']);}catch(_0x12460d){Sentry[_0x5b2d33(0xdd)](_0x12460d);}}}async function handleUserConnection(_0x37bbdb){const _0x22ee02=a316_0x3e901a;try{const {id:_0x148f73}=_0x37bbdb[_0x22ee02(0xe3)];if(!(0x0,lodash_1[_0x22ee02(0xe5)])(_0x148f73)&&_0x148f73!==_0x22ee02(0xfa)){const _0xf37a6a=await User_1[_0x22ee02(0xf5)][_0x22ee02(0xcd)](_0x148f73);_0xf37a6a&&(_0xf37a6a[_0x22ee02(0xfb)]=!![],await _0xf37a6a[_0x22ee02(0xcc)]());}}catch(_0x552422){Sentry[_0x22ee02(0xdd)](_0x552422);}}function a316_0x440d(){const _0x327c22=['removeRepeatableByKey','../utils/logger','7690960stoQvv','default','5VPrpbn','14047jtCgXe','Usuario\x20passado\x20para\x20offline:\x20','2170794lkSKzk','null','online','hasOwnProperty','8cAcqco','QueryTypes','*\x20*\x20*\x20*\x20*','save','findByPk','verify-loginstatus','process','get','userMonitor','../database','bull','22164Dmeqrq','8bxouEP','defineProperty','initUserMonitorQueues','prototype','7421508FtEaao','create','getOwnPropertyDescriptor','getRepeatableJobs','captureException','sequelize','writable','2oxYZTJ','UserMonitor','__setModuleDefault','data','REDIS_URI','isNil','add','1060351VyGPAJ','env','3260628gcxMhX','call','1612788VBdCmt','info','__createBinding','update','__esModule','configurable','SELECT'];a316_0x440d=function(){return _0x327c22;};return a316_0x440d();}function a316_0x81d3(_0x4a6fa1,_0x2be8c6){const _0x440d98=a316_0x440d();return a316_0x81d3=function(_0x81d366,_0x3fcf3d){_0x81d366=_0x81d366-0xcb;let _0xdaea3e=_0x440d98[_0x81d366];return _0xdaea3e;},a316_0x81d3(_0x4a6fa1,_0x2be8c6);}exports[a316_0x3e901a(0xd1)][a316_0x3e901a(0xcf)]('UserConnection',handleUserConnection),exports[a316_0x3e901a(0xd1)][a316_0x3e901a(0xcf)]('VerifyLoginStatus',handleLoginStatus);async function initUserMonitorQueues(){const _0x296d3e=a316_0x3e901a,_0x2d328b=await exports[_0x296d3e(0xd1)][_0x296d3e(0xdc)]();for(let _0x47100a of _0x2d328b){await exports['userMonitor'][_0x296d3e(0xf2)](_0x47100a['key']);}exports[_0x296d3e(0xd1)][_0x296d3e(0xe6)]('VerifyLoginStatus',{},{'repeat':{'cron':_0x296d3e(0xcb),'key':_0x296d3e(0xce)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1['logger']['info']('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuÃ¡rio\x20inicializado');}exports[a316_0x3e901a(0xd7)]=initUserMonitorQueues;