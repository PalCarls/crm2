'use strict';function a336_0x286a(_0x522049,_0x18562f){const _0x578062=a336_0x5780();return a336_0x286a=function(_0x286acf,_0x1d5daa){_0x286acf=_0x286acf-0x193;let _0x14876b=_0x578062[_0x286acf];return _0x14876b;},a336_0x286a(_0x522049,_0x18562f);}const a336_0x483b25=a336_0x286a;(function(_0x2062fa,_0x482634){const _0x3c4ca8=a336_0x286a,_0xba3168=_0x2062fa();while(!![]){try{const _0x2c373e=parseInt(_0x3c4ca8(0x1c3))/0x1+-parseInt(_0x3c4ca8(0x19e))/0x2*(-parseInt(_0x3c4ca8(0x1a3))/0x3)+-parseInt(_0x3c4ca8(0x1ba))/0x4*(parseInt(_0x3c4ca8(0x1ab))/0x5)+-parseInt(_0x3c4ca8(0x1bf))/0x6+-parseInt(_0x3c4ca8(0x1ad))/0x7+parseInt(_0x3c4ca8(0x1c1))/0x8+parseInt(_0x3c4ca8(0x1a7))/0x9;if(_0x2c373e===_0x482634)break;else _0xba3168['push'](_0xba3168['shift']());}catch(_0x554370){_0xba3168['push'](_0xba3168['shift']());}}}(a336_0x5780,0x818e5));function a336_0x5780(){const _0x1350f7=['__importDefault','logger','verify-loginstatus','writable','../database','prototype','removeRepeatableByKey','VerifyLoginStatus','4LuzzPE','lodash','info','getRepeatableJobs','process','490566Vxrhxf','UserMonitor','Usuario\x20passado\x20para\x20offline:\x20','create','8246898mAFNhx','null','captureException','configurable','5HxkwWX','env','3268748BRUVtJ','update','SELECT','*\x20*\x20*\x20*\x20*','userMonitor','isNil','default','add','UserConnection','query','findByPk','QueryTypes','__createBinding','300796AsNjhi','initUserMonitorQueues','getOwnPropertyDescriptor','__importStar','REDIS_URI','5258328VqIwRH','__esModule','5186456tNwKKB','sequelize','57539EXZzEa','__setModuleDefault','data','defineProperty','hasOwnProperty'];a336_0x5780=function(){return _0x1350f7;};return a336_0x5780();}var __createBinding=this&&this[a336_0x483b25(0x1b9)]||(Object['create']?function(_0x6f2f3,_0x138cdb,_0x21fd8a,_0x38f8cc){const _0x36899c=a336_0x483b25;if(_0x38f8cc===undefined)_0x38f8cc=_0x21fd8a;var _0x3bfa5a=Object[_0x36899c(0x1bc)](_0x138cdb,_0x21fd8a);(!_0x3bfa5a||('get'in _0x3bfa5a?!_0x138cdb['__esModule']:_0x3bfa5a[_0x36899c(0x199)]||_0x3bfa5a[_0x36899c(0x1aa)]))&&(_0x3bfa5a={'enumerable':!![],'get':function(){return _0x138cdb[_0x21fd8a];}}),Object[_0x36899c(0x194)](_0x6f2f3,_0x38f8cc,_0x3bfa5a);}:function(_0x2a0822,_0x59cfd5,_0x8b833b,_0x15668c){if(_0x15668c===undefined)_0x15668c=_0x8b833b;_0x2a0822[_0x15668c]=_0x59cfd5[_0x8b833b];}),__setModuleDefault=this&&this[a336_0x483b25(0x1c4)]||(Object[a336_0x483b25(0x1a6)]?function(_0x4d6232,_0x59152d){const _0x558259=a336_0x483b25;Object[_0x558259(0x194)](_0x4d6232,_0x558259(0x1b3),{'enumerable':!![],'value':_0x59152d});}:function(_0xc2a134,_0x79f540){const _0x120a55=a336_0x483b25;_0xc2a134[_0x120a55(0x1b3)]=_0x79f540;}),__importStar=this&&this[a336_0x483b25(0x1bd)]||function(_0x2124b4){const _0x168d00=a336_0x483b25;if(_0x2124b4&&_0x2124b4['__esModule'])return _0x2124b4;var _0x2fd1e3={};if(_0x2124b4!=null){for(var _0x428083 in _0x2124b4)if(_0x428083!==_0x168d00(0x1b3)&&Object[_0x168d00(0x19b)][_0x168d00(0x195)]['call'](_0x2124b4,_0x428083))__createBinding(_0x2fd1e3,_0x2124b4,_0x428083);}return __setModuleDefault(_0x2fd1e3,_0x2124b4),_0x2fd1e3;},__importDefault=this&&this[a336_0x483b25(0x196)]||function(_0x1c7353){const _0x5e7f80=a336_0x483b25;return _0x1c7353&&_0x1c7353[_0x5e7f80(0x1c0)]?_0x1c7353:{'default':_0x1c7353};};Object['defineProperty'](exports,a336_0x483b25(0x1c0),{'value':!![]}),exports[a336_0x483b25(0x1bb)]=exports[a336_0x483b25(0x1b1)]=void 0x0;const bull_1=__importDefault(require('bull')),Sentry=__importStar(require('@sentry/node')),sequelize_1=require(a336_0x483b25(0x1c2)),lodash_1=require(a336_0x483b25(0x19f)),logger_1=require('../utils/logger'),database_1=__importDefault(require(a336_0x483b25(0x19a))),User_1=__importDefault(require('../models/User')),connection=process[a336_0x483b25(0x1ac)][a336_0x483b25(0x1be)]||'';exports[a336_0x483b25(0x1b1)]=new bull_1[(a336_0x483b25(0x1b3))](a336_0x483b25(0x1a4),connection);async function handleLoginStatus(_0x53309a){const _0x2c48b3=a336_0x483b25,_0x4b9962=await database_1[_0x2c48b3(0x1b3)][_0x2c48b3(0x1b6)]('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x2c48b3(0x1b8)][_0x2c48b3(0x1af)]});for(let _0x2d26ce of _0x4b9962){try{const _0x3c6301=await User_1[_0x2c48b3(0x1b3)][_0x2c48b3(0x1b7)](_0x2d26ce['id']);await _0x3c6301[_0x2c48b3(0x1ae)]({'online':![]}),logger_1[_0x2c48b3(0x197)][_0x2c48b3(0x1a0)](_0x2c48b3(0x1a5)+_0x2d26ce['id']);}catch(_0x2c8cc9){Sentry[_0x2c48b3(0x1a9)](_0x2c8cc9);}}}async function handleUserConnection(_0x51bfc1){const _0x25f9bc=a336_0x483b25;try{const {id:_0x4064bf}=_0x51bfc1[_0x25f9bc(0x193)];if(!(0x0,lodash_1[_0x25f9bc(0x1b2)])(_0x4064bf)&&_0x4064bf!==_0x25f9bc(0x1a8)){const _0x146e9f=await User_1['default'][_0x25f9bc(0x1b7)](_0x4064bf);_0x146e9f&&(_0x146e9f['online']=!![],await _0x146e9f['save']());}}catch(_0x4b422f){Sentry[_0x25f9bc(0x1a9)](_0x4b422f);}}exports[a336_0x483b25(0x1b1)]['process'](a336_0x483b25(0x1b5),handleUserConnection),exports['userMonitor'][a336_0x483b25(0x1a2)](a336_0x483b25(0x19d),handleLoginStatus);async function initUserMonitorQueues(){const _0x561e94=a336_0x483b25,_0x4bf812=await exports['userMonitor'][_0x561e94(0x1a1)]();for(let _0x46c040 of _0x4bf812){await exports[_0x561e94(0x1b1)][_0x561e94(0x19c)](_0x46c040['key']);}exports[_0x561e94(0x1b1)][_0x561e94(0x1b4)](_0x561e94(0x19d),{},{'repeat':{'cron':_0x561e94(0x1b0),'key':_0x561e94(0x198)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x561e94(0x197)][_0x561e94(0x1a0)]('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuÃ¡rio\x20inicializado');}exports['initUserMonitorQueues']=initUserMonitorQueues;