<<<<<<< HEAD
'use strict';const a336_0x514fad=a336_0x59cb;(function(_0x51aa4,_0x47bdd8){const _0x480950=a336_0x59cb,_0x100b9d=_0x51aa4();while(!![]){try{const _0xff20e8=parseInt(_0x480950(0x122))/0x1*(-parseInt(_0x480950(0x12c))/0x2)+-parseInt(_0x480950(0x131))/0x3+-parseInt(_0x480950(0x12f))/0x4*(parseInt(_0x480950(0x136))/0x5)+-parseInt(_0x480950(0x119))/0x6*(-parseInt(_0x480950(0x135))/0x7)+-parseInt(_0x480950(0x123))/0x8+parseInt(_0x480950(0x126))/0x9*(parseInt(_0x480950(0x13f))/0xa)+parseInt(_0x480950(0x11a))/0xb*(parseInt(_0x480950(0x148))/0xc);if(_0xff20e8===_0x47bdd8)break;else _0x100b9d['push'](_0x100b9d['shift']());}catch(_0x547190){_0x100b9d['push'](_0x100b9d['shift']());}}}(a336_0x5e68,0x8a76d));var __createBinding=this&&this[a336_0x514fad(0x125)]||(Object['create']?function(_0x4a74b3,_0x213bf1,_0x35b7a0,_0x15d8c3){const _0x8cc1f3=a336_0x514fad;if(_0x15d8c3===undefined)_0x15d8c3=_0x35b7a0;var _0x72c9e3=Object[_0x8cc1f3(0x12d)](_0x213bf1,_0x35b7a0);(!_0x72c9e3||(_0x8cc1f3(0x130)in _0x72c9e3?!_0x213bf1[_0x8cc1f3(0x138)]:_0x72c9e3[_0x8cc1f3(0x12b)]||_0x72c9e3[_0x8cc1f3(0x137)]))&&(_0x72c9e3={'enumerable':!![],'get':function(){return _0x213bf1[_0x35b7a0];}}),Object[_0x8cc1f3(0x133)](_0x4a74b3,_0x15d8c3,_0x72c9e3);}:function(_0x175a56,_0x2680d1,_0x39fed2,_0x44f50e){if(_0x44f50e===undefined)_0x44f50e=_0x39fed2;_0x175a56[_0x44f50e]=_0x2680d1[_0x39fed2];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x11ed4b,_0x3327a5){const _0x22c9fd=a336_0x514fad;Object[_0x22c9fd(0x133)](_0x11ed4b,_0x22c9fd(0x120),{'enumerable':!![],'value':_0x3327a5});}:function(_0x4d4def,_0x238439){const _0x15478b=a336_0x514fad;_0x4d4def[_0x15478b(0x120)]=_0x238439;}),__importStar=this&&this['__importStar']||function(_0x3aa001){const _0x2ce115=a336_0x514fad;if(_0x3aa001&&_0x3aa001[_0x2ce115(0x138)])return _0x3aa001;var _0xbc7c7b={};if(_0x3aa001!=null){for(var _0x2ad036 in _0x3aa001)if(_0x2ad036!==_0x2ce115(0x120)&&Object[_0x2ce115(0x124)][_0x2ce115(0x142)][_0x2ce115(0x127)](_0x3aa001,_0x2ad036))__createBinding(_0xbc7c7b,_0x3aa001,_0x2ad036);}return __setModuleDefault(_0xbc7c7b,_0x3aa001),_0xbc7c7b;},__importDefault=this&&this[a336_0x514fad(0x147)]||function(_0x285387){const _0x3fa039=a336_0x514fad;return _0x285387&&_0x285387[_0x3fa039(0x138)]?_0x285387:{'default':_0x285387};};Object[a336_0x514fad(0x133)](exports,'__esModule',{'value':!![]}),exports[a336_0x514fad(0x134)]=exports[a336_0x514fad(0x149)]=void 0x0;const bull_1=__importDefault(require(a336_0x514fad(0x121))),Sentry=__importStar(require('@sentry/node')),sequelize_1=require('sequelize'),lodash_1=require(a336_0x514fad(0x13e)),logger_1=require(a336_0x514fad(0x129)),database_1=__importDefault(require(a336_0x514fad(0x14a))),User_1=__importDefault(require(a336_0x514fad(0x128))),connection=process[a336_0x514fad(0x118)]['REDIS_URI']||'';exports['userMonitor']=new bull_1[(a336_0x514fad(0x120))]('UserMonitor',connection);async function handleLoginStatus(_0x307741){const _0x219647=a336_0x514fad,_0x3994ad=await database_1['default'][_0x219647(0x13d)]('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x219647(0x13b)][_0x219647(0x11f)]});for(let _0x33337c of _0x3994ad){try{const _0x33c534=await User_1[_0x219647(0x120)][_0x219647(0x139)](_0x33337c['id']);await _0x33c534[_0x219647(0x141)]({'online':![]}),logger_1[_0x219647(0x11b)][_0x219647(0x12a)]('Usuario\x20passado\x20para\x20offline:\x20'+_0x33337c['id']);}catch(_0x3af76c){Sentry[_0x219647(0x11d)](_0x3af76c);}}}async function handleUserConnection(_0x504b2b){const _0x4f673a=a336_0x514fad;try{const {id:_0x9c94f0}=_0x504b2b[_0x4f673a(0x11c)];if(!(0x0,lodash_1[_0x4f673a(0x146)])(_0x9c94f0)&&_0x9c94f0!==_0x4f673a(0x143)){const _0x51ad3=await User_1[_0x4f673a(0x120)][_0x4f673a(0x139)](_0x9c94f0);_0x51ad3&&(_0x51ad3[_0x4f673a(0x140)]=!![],await _0x51ad3[_0x4f673a(0x145)]());}}catch(_0x1fcb22){Sentry['captureException'](_0x1fcb22);}}function a336_0x59cb(_0x82e7aa,_0xf6f960){const _0x5e6836=a336_0x5e68();return a336_0x59cb=function(_0x59cb9a,_0x591405){_0x59cb9a=_0x59cb9a-0x118;let _0x591260=_0x5e6836[_0x59cb9a];return _0x591260;},a336_0x59cb(_0x82e7aa,_0xf6f960);}exports[a336_0x514fad(0x149)]['process'](a336_0x514fad(0x14b),handleUserConnection),exports[a336_0x514fad(0x149)][a336_0x514fad(0x12e)](a336_0x514fad(0x11e),handleLoginStatus);async function initUserMonitorQueues(){const _0x4403ec=a336_0x514fad,_0x402227=await exports['userMonitor'][_0x4403ec(0x144)]();for(let _0x346e39 of _0x402227){await exports['userMonitor']['removeRepeatableByKey'](_0x346e39[_0x4403ec(0x13a)]);}exports[_0x4403ec(0x149)][_0x4403ec(0x132)](_0x4403ec(0x11e),{},{'repeat':{'cron':'*\x20*\x20*\x20*\x20*','key':'verify-loginstatus'},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x4403ec(0x11b)][_0x4403ec(0x12a)](_0x4403ec(0x13c));}exports['initUserMonitorQueues']=initUserMonitorQueues;function a336_0x5e68(){const _0x50c361=['null','getRepeatableJobs','save','isNil','__importDefault','1050576BXCNdA','userMonitor','../database','UserConnection','env','139326rKXWys','473HBOqEJ','logger','data','captureException','VerifyLoginStatus','SELECT','default','bull','1tUiFcF','5974560zepxvq','prototype','__createBinding','603ddspOj','call','../models/User','../utils/logger','info','writable','1609942ONzrzh','getOwnPropertyDescriptor','process','261236bLKqNR','get','3384942mLslMm','add','defineProperty','initUserMonitorQueues','119SDZoRL','85ldUCBP','configurable','__esModule','findByPk','key','QueryTypes','Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado','query','lodash','29580nXbISO','online','update','hasOwnProperty'];a336_0x5e68=function(){return _0x50c361;};return a336_0x5e68();}
=======
'use strict';function a336_0x286a(_0x522049,_0x18562f){const _0x578062=a336_0x5780();return a336_0x286a=function(_0x286acf,_0x1d5daa){_0x286acf=_0x286acf-0x193;let _0x14876b=_0x578062[_0x286acf];return _0x14876b;},a336_0x286a(_0x522049,_0x18562f);}const a336_0x483b25=a336_0x286a;(function(_0x2062fa,_0x482634){const _0x3c4ca8=a336_0x286a,_0xba3168=_0x2062fa();while(!![]){try{const _0x2c373e=parseInt(_0x3c4ca8(0x1c3))/0x1+-parseInt(_0x3c4ca8(0x19e))/0x2*(-parseInt(_0x3c4ca8(0x1a3))/0x3)+-parseInt(_0x3c4ca8(0x1ba))/0x4*(parseInt(_0x3c4ca8(0x1ab))/0x5)+-parseInt(_0x3c4ca8(0x1bf))/0x6+-parseInt(_0x3c4ca8(0x1ad))/0x7+parseInt(_0x3c4ca8(0x1c1))/0x8+parseInt(_0x3c4ca8(0x1a7))/0x9;if(_0x2c373e===_0x482634)break;else _0xba3168['push'](_0xba3168['shift']());}catch(_0x554370){_0xba3168['push'](_0xba3168['shift']());}}}(a336_0x5780,0x818e5));function a336_0x5780(){const _0x1350f7=['__importDefault','logger','verify-loginstatus','writable','../database','prototype','removeRepeatableByKey','VerifyLoginStatus','4LuzzPE','lodash','info','getRepeatableJobs','process','490566Vxrhxf','UserMonitor','Usuario\x20passado\x20para\x20offline:\x20','create','8246898mAFNhx','null','captureException','configurable','5HxkwWX','env','3268748BRUVtJ','update','SELECT','*\x20*\x20*\x20*\x20*','userMonitor','isNil','default','add','UserConnection','query','findByPk','QueryTypes','__createBinding','300796AsNjhi','initUserMonitorQueues','getOwnPropertyDescriptor','__importStar','REDIS_URI','5258328VqIwRH','__esModule','5186456tNwKKB','sequelize','57539EXZzEa','__setModuleDefault','data','defineProperty','hasOwnProperty'];a336_0x5780=function(){return _0x1350f7;};return a336_0x5780();}var __createBinding=this&&this[a336_0x483b25(0x1b9)]||(Object['create']?function(_0x6f2f3,_0x138cdb,_0x21fd8a,_0x38f8cc){const _0x36899c=a336_0x483b25;if(_0x38f8cc===undefined)_0x38f8cc=_0x21fd8a;var _0x3bfa5a=Object[_0x36899c(0x1bc)](_0x138cdb,_0x21fd8a);(!_0x3bfa5a||('get'in _0x3bfa5a?!_0x138cdb['__esModule']:_0x3bfa5a[_0x36899c(0x199)]||_0x3bfa5a[_0x36899c(0x1aa)]))&&(_0x3bfa5a={'enumerable':!![],'get':function(){return _0x138cdb[_0x21fd8a];}}),Object[_0x36899c(0x194)](_0x6f2f3,_0x38f8cc,_0x3bfa5a);}:function(_0x2a0822,_0x59cfd5,_0x8b833b,_0x15668c){if(_0x15668c===undefined)_0x15668c=_0x8b833b;_0x2a0822[_0x15668c]=_0x59cfd5[_0x8b833b];}),__setModuleDefault=this&&this[a336_0x483b25(0x1c4)]||(Object[a336_0x483b25(0x1a6)]?function(_0x4d6232,_0x59152d){const _0x558259=a336_0x483b25;Object[_0x558259(0x194)](_0x4d6232,_0x558259(0x1b3),{'enumerable':!![],'value':_0x59152d});}:function(_0xc2a134,_0x79f540){const _0x120a55=a336_0x483b25;_0xc2a134[_0x120a55(0x1b3)]=_0x79f540;}),__importStar=this&&this[a336_0x483b25(0x1bd)]||function(_0x2124b4){const _0x168d00=a336_0x483b25;if(_0x2124b4&&_0x2124b4['__esModule'])return _0x2124b4;var _0x2fd1e3={};if(_0x2124b4!=null){for(var _0x428083 in _0x2124b4)if(_0x428083!==_0x168d00(0x1b3)&&Object[_0x168d00(0x19b)][_0x168d00(0x195)]['call'](_0x2124b4,_0x428083))__createBinding(_0x2fd1e3,_0x2124b4,_0x428083);}return __setModuleDefault(_0x2fd1e3,_0x2124b4),_0x2fd1e3;},__importDefault=this&&this[a336_0x483b25(0x196)]||function(_0x1c7353){const _0x5e7f80=a336_0x483b25;return _0x1c7353&&_0x1c7353[_0x5e7f80(0x1c0)]?_0x1c7353:{'default':_0x1c7353};};Object['defineProperty'](exports,a336_0x483b25(0x1c0),{'value':!![]}),exports[a336_0x483b25(0x1bb)]=exports[a336_0x483b25(0x1b1)]=void 0x0;const bull_1=__importDefault(require('bull')),Sentry=__importStar(require('@sentry/node')),sequelize_1=require(a336_0x483b25(0x1c2)),lodash_1=require(a336_0x483b25(0x19f)),logger_1=require('../utils/logger'),database_1=__importDefault(require(a336_0x483b25(0x19a))),User_1=__importDefault(require('../models/User')),connection=process[a336_0x483b25(0x1ac)][a336_0x483b25(0x1be)]||'';exports[a336_0x483b25(0x1b1)]=new bull_1[(a336_0x483b25(0x1b3))](a336_0x483b25(0x1a4),connection);async function handleLoginStatus(_0x53309a){const _0x2c48b3=a336_0x483b25,_0x4b9962=await database_1[_0x2c48b3(0x1b3)][_0x2c48b3(0x1b6)]('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x2c48b3(0x1b8)][_0x2c48b3(0x1af)]});for(let _0x2d26ce of _0x4b9962){try{const _0x3c6301=await User_1[_0x2c48b3(0x1b3)][_0x2c48b3(0x1b7)](_0x2d26ce['id']);await _0x3c6301[_0x2c48b3(0x1ae)]({'online':![]}),logger_1[_0x2c48b3(0x197)][_0x2c48b3(0x1a0)](_0x2c48b3(0x1a5)+_0x2d26ce['id']);}catch(_0x2c8cc9){Sentry[_0x2c48b3(0x1a9)](_0x2c8cc9);}}}async function handleUserConnection(_0x51bfc1){const _0x25f9bc=a336_0x483b25;try{const {id:_0x4064bf}=_0x51bfc1[_0x25f9bc(0x193)];if(!(0x0,lodash_1[_0x25f9bc(0x1b2)])(_0x4064bf)&&_0x4064bf!==_0x25f9bc(0x1a8)){const _0x146e9f=await User_1['default'][_0x25f9bc(0x1b7)](_0x4064bf);_0x146e9f&&(_0x146e9f['online']=!![],await _0x146e9f['save']());}}catch(_0x4b422f){Sentry[_0x25f9bc(0x1a9)](_0x4b422f);}}exports[a336_0x483b25(0x1b1)]['process'](a336_0x483b25(0x1b5),handleUserConnection),exports['userMonitor'][a336_0x483b25(0x1a2)](a336_0x483b25(0x19d),handleLoginStatus);async function initUserMonitorQueues(){const _0x561e94=a336_0x483b25,_0x4bf812=await exports['userMonitor'][_0x561e94(0x1a1)]();for(let _0x46c040 of _0x4bf812){await exports[_0x561e94(0x1b1)][_0x561e94(0x19c)](_0x46c040['key']);}exports[_0x561e94(0x1b1)][_0x561e94(0x1b4)](_0x561e94(0x19d),{},{'repeat':{'cron':_0x561e94(0x1b0),'key':_0x561e94(0x198)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x561e94(0x197)][_0x561e94(0x1a0)]('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado');}exports['initUserMonitorQueues']=initUserMonitorQueues;
>>>>>>> ab722bfbcf394d74dd0b99a984c0dcf6ffbcff7f
