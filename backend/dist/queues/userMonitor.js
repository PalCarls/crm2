'use strict';const a336_0x4f6d62=a336_0x4a2e;(function(_0x2e7ce9,_0x76a783){const _0x266502=a336_0x4a2e,_0xe45226=_0x2e7ce9();while(!![]){try{const _0x47d251=-parseInt(_0x266502(0xda))/0x1*(-parseInt(_0x266502(0xd4))/0x2)+parseInt(_0x266502(0xac))/0x3+-parseInt(_0x266502(0xc0))/0x4+parseInt(_0x266502(0xb1))/0x5+parseInt(_0x266502(0xb8))/0x6*(parseInt(_0x266502(0xa7))/0x7)+parseInt(_0x266502(0xd1))/0x8*(-parseInt(_0x266502(0xba))/0x9)+parseInt(_0x266502(0xc6))/0xa;if(_0x47d251===_0x76a783)break;else _0xe45226['push'](_0xe45226['shift']());}catch(_0x1f959f){_0xe45226['push'](_0xe45226['shift']());}}}(a336_0x2156,0xdc46a));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x3ccc60,_0x2c51ec,_0x31ddfb,_0x20c4e2){const _0xc84e0b=a336_0x4a2e;if(_0x20c4e2===undefined)_0x20c4e2=_0x31ddfb;var _0x376519=Object[_0xc84e0b(0xab)](_0x2c51ec,_0x31ddfb);(!_0x376519||(_0xc84e0b(0xbb)in _0x376519?!_0x2c51ec[_0xc84e0b(0xb7)]:_0x376519[_0xc84e0b(0xc2)]||_0x376519[_0xc84e0b(0xad)]))&&(_0x376519={'enumerable':!![],'get':function(){return _0x2c51ec[_0x31ddfb];}}),Object[_0xc84e0b(0xd7)](_0x3ccc60,_0x20c4e2,_0x376519);}:function(_0x5e945c,_0xa57ec1,_0x3d0859,_0x409b6f){if(_0x409b6f===undefined)_0x409b6f=_0x3d0859;_0x5e945c[_0x409b6f]=_0xa57ec1[_0x3d0859];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a336_0x4f6d62(0xca)]?function(_0x2ba9c3,_0x10dd83){const _0x5d900d=a336_0x4f6d62;Object['defineProperty'](_0x2ba9c3,_0x5d900d(0xb0),{'enumerable':!![],'value':_0x10dd83});}:function(_0x57c3be,_0x534f3c){_0x57c3be['default']=_0x534f3c;}),__importStar=this&&this[a336_0x4f6d62(0xd3)]||function(_0x122c4a){const _0x288153=a336_0x4f6d62;if(_0x122c4a&&_0x122c4a['__esModule'])return _0x122c4a;var _0x157099={};if(_0x122c4a!=null){for(var _0x4b7c90 in _0x122c4a)if(_0x4b7c90!==_0x288153(0xb0)&&Object[_0x288153(0xd0)][_0x288153(0xd8)][_0x288153(0xa8)](_0x122c4a,_0x4b7c90))__createBinding(_0x157099,_0x122c4a,_0x4b7c90);}return __setModuleDefault(_0x157099,_0x122c4a),_0x157099;},__importDefault=this&&this[a336_0x4f6d62(0xc1)]||function(_0x335ce1){const _0x53e7e6=a336_0x4f6d62;return _0x335ce1&&_0x335ce1[_0x53e7e6(0xb7)]?_0x335ce1:{'default':_0x335ce1};};function a336_0x4a2e(_0x15f717,_0xa7c18b){const _0x215624=a336_0x2156();return a336_0x4a2e=function(_0x4a2eca,_0x599219){_0x4a2eca=_0x4a2eca-0xa4;let _0x5c85ed=_0x215624[_0x4a2eca];return _0x5c85ed;},a336_0x4a2e(_0x15f717,_0xa7c18b);}Object['defineProperty'](exports,a336_0x4f6d62(0xb7),{'value':!![]}),exports[a336_0x4f6d62(0xcd)]=exports[a336_0x4f6d62(0xb4)]=void 0x0;const bull_1=__importDefault(require(a336_0x4f6d62(0xcc))),Sentry=__importStar(require(a336_0x4f6d62(0xa5))),sequelize_1=require(a336_0x4f6d62(0xb6)),lodash_1=require(a336_0x4f6d62(0xcf)),logger_1=require(a336_0x4f6d62(0xbc)),database_1=__importDefault(require(a336_0x4f6d62(0xbd))),User_1=__importDefault(require('../models/User')),connection=process[a336_0x4f6d62(0xc5)][a336_0x4f6d62(0xb5)]||'';exports[a336_0x4f6d62(0xb4)]=new bull_1[(a336_0x4f6d62(0xb0))](a336_0x4f6d62(0xc3),connection);async function handleLoginStatus(_0x35ee4d){const _0x246a66=a336_0x4f6d62,_0x1cea11=await database_1[_0x246a66(0xb0)][_0x246a66(0xbe)](_0x246a66(0xa9),{'type':sequelize_1[_0x246a66(0xce)]['SELECT']});for(let _0x2803ef of _0x1cea11){try{const _0x3789ca=await User_1['default']['findByPk'](_0x2803ef['id']);await _0x3789ca[_0x246a66(0xc4)]({'online':![]}),logger_1[_0x246a66(0xaa)]['info']('Usuario\x20passado\x20para\x20offline:\x20'+_0x2803ef['id']);}catch(_0x888836){Sentry['captureException'](_0x888836);}}}async function handleUserConnection(_0xf7e233){const _0x1f33c4=a336_0x4f6d62;try{const {id:_0x4f3f7f}=_0xf7e233[_0x1f33c4(0xd9)];if(!(0x0,lodash_1[_0x1f33c4(0xc8)])(_0x4f3f7f)&&_0x4f3f7f!==_0x1f33c4(0xaf)){const _0xca320=await User_1[_0x1f33c4(0xb0)][_0x1f33c4(0xae)](_0x4f3f7f);_0xca320&&(_0xca320['online']=!![],await _0xca320[_0x1f33c4(0xdb)]());}}catch(_0x4d554c){Sentry[_0x1f33c4(0xb9)](_0x4d554c);}}function a336_0x2156(){const _0x36eec0=['QueryTypes','lodash','prototype','3202504oFJPhK','key','__importStar','696686eCMlSz','process','Queue:\x20monitoramento\x20de\x20status\x20de\x20usu√°rio\x20inicializado','defineProperty','hasOwnProperty','data','1QWHESP','save','UserConnection','@sentry/node','add','7gOtuLl','call','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','logger','getOwnPropertyDescriptor','1150836OjgUVc','configurable','findByPk','null','default','3100390RMVJRe','verify-loginstatus','removeRepeatableByKey','userMonitor','REDIS_URI','sequelize','__esModule','1709082bbwCmV','captureException','27YbBVIs','get','../utils/logger','../database','query','*\x20*\x20*\x20*\x20*','4206404PSFuAV','__importDefault','writable','UserMonitor','update','env','15179100GSXKNn','VerifyLoginStatus','isNil','info','create','getRepeatableJobs','bull','initUserMonitorQueues'];a336_0x2156=function(){return _0x36eec0;};return a336_0x2156();}exports[a336_0x4f6d62(0xb4)][a336_0x4f6d62(0xd5)](a336_0x4f6d62(0xa4),handleUserConnection),exports[a336_0x4f6d62(0xb4)][a336_0x4f6d62(0xd5)]('VerifyLoginStatus',handleLoginStatus);async function initUserMonitorQueues(){const _0x5ad26f=a336_0x4f6d62,_0x16a6c3=await exports['userMonitor'][_0x5ad26f(0xcb)]();for(let _0x2f0b70 of _0x16a6c3){await exports[_0x5ad26f(0xb4)][_0x5ad26f(0xb3)](_0x2f0b70[_0x5ad26f(0xd2)]);}exports[_0x5ad26f(0xb4)][_0x5ad26f(0xa6)](_0x5ad26f(0xc7),{},{'repeat':{'cron':_0x5ad26f(0xbf),'key':_0x5ad26f(0xb2)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x5ad26f(0xaa)][_0x5ad26f(0xc9)](_0x5ad26f(0xd6));}exports[a336_0x4f6d62(0xcd)]=initUserMonitorQueues;