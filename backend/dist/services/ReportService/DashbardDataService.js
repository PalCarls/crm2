'use strict';function a540_0x1200(_0x3ab0e5,_0x2134f8){const _0x3aa442=a540_0x3aa4();return a540_0x1200=function(_0x120016,_0x57cc43){_0x120016=_0x120016-0x104;let _0x3e4fe8=_0x3aa442[_0x120016];return _0x3e4fe8;},a540_0x1200(_0x3ab0e5,_0x2134f8);}const a540_0xce371a=a540_0x1200;(function(_0x3941f1,_0x4f6dec){const _0x4205fb=a540_0x1200,_0x3326ec=_0x3941f1();while(!![]){try{const _0x311ffb=-parseInt(_0x4205fb(0x116))/0x1+parseInt(_0x4205fb(0x11b))/0x2*(parseInt(_0x4205fb(0x107))/0x3)+parseInt(_0x4205fb(0x11c))/0x4*(-parseInt(_0x4205fb(0x118))/0x5)+parseInt(_0x4205fb(0x121))/0x6*(-parseInt(_0x4205fb(0x113))/0x7)+parseInt(_0x4205fb(0x120))/0x8*(parseInt(_0x4205fb(0x108))/0x9)+-parseInt(_0x4205fb(0x117))/0xa+-parseInt(_0x4205fb(0x110))/0xb*(-parseInt(_0x4205fb(0x115))/0xc);if(_0x311ffb===_0x4f6dec)break;else _0x3326ec['push'](_0x3326ec['shift']());}catch(_0x3988ab){_0x3326ec['push'](_0x3326ec['shift']());}}}(a540_0x3aa4,0xdfd72));var __createBinding=this&&this[a540_0xce371a(0x11a)]||(Object[a540_0xce371a(0x109)]?function(_0x3ce6f8,_0x57fdaa,_0x58653e,_0x40cda2){const _0x377c82=a540_0xce371a;if(_0x40cda2===undefined)_0x40cda2=_0x58653e;var _0x14199f=Object[_0x377c82(0x12a)](_0x57fdaa,_0x58653e);(!_0x14199f||(_0x377c82(0x11d)in _0x14199f?!_0x57fdaa[_0x377c82(0x124)]:_0x14199f[_0x377c82(0x104)]||_0x14199f[_0x377c82(0x10a)]))&&(_0x14199f={'enumerable':!![],'get':function(){return _0x57fdaa[_0x58653e];}}),Object[_0x377c82(0x10c)](_0x3ce6f8,_0x40cda2,_0x14199f);}:function(_0x53b5d8,_0x9c365b,_0x2bc77,_0x4400a5){if(_0x4400a5===undefined)_0x4400a5=_0x2bc77;_0x53b5d8[_0x4400a5]=_0x9c365b[_0x2bc77];}),__setModuleDefault=this&&this[a540_0xce371a(0x122)]||(Object[a540_0xce371a(0x109)]?function(_0x252554,_0x715e63){const _0x47f831=a540_0xce371a;Object[_0x47f831(0x10c)](_0x252554,'default',{'enumerable':!![],'value':_0x715e63});}:function(_0x3ae63d,_0x5a0e5e){const _0x5834c4=a540_0xce371a;_0x3ae63d[_0x5834c4(0x10d)]=_0x5a0e5e;}),__importStar=this&&this[a540_0xce371a(0x119)]||function(_0xae595a){const _0x1f07f0=a540_0xce371a;if(_0xae595a&&_0xae595a[_0x1f07f0(0x124)])return _0xae595a;var _0xc2e66b={};if(_0xae595a!=null){for(var _0x2eca81 in _0xae595a)if(_0x2eca81!=='default'&&Object[_0x1f07f0(0x105)][_0x1f07f0(0x126)][_0x1f07f0(0x127)](_0xae595a,_0x2eca81))__createBinding(_0xc2e66b,_0xae595a,_0x2eca81);}return __setModuleDefault(_0xc2e66b,_0xae595a),_0xc2e66b;},__importDefault=this&&this[a540_0xce371a(0x11e)]||function(_0x382c6c){const _0x4ba9d8=a540_0xce371a;return _0x382c6c&&_0x382c6c[_0x4ba9d8(0x124)]?_0x382c6c:{'default':_0x382c6c};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const sequelize_1=require(a540_0xce371a(0x123)),_=__importStar(require('lodash')),database_1=__importDefault(require(a540_0xce371a(0x10e))),fs=require('fs');async function DashboardDataService(_0x25c097,_0x4b28dd){const _0x418723=a540_0xce371a,_0x2bb8b8=_0x418723(0x10b);let _0x2edb10='where\x20tt.\x22companyId\x22\x20=\x20?';const _0x1a2324=[_0x25c097];_[_0x418723(0x129)](_0x4b28dd,_0x418723(0x10f))&&(_0x2edb10+='\x20and\x20tt.\x22createdAt\x22\x20>=\x20(now()\x20-\x20\x27?\x20days\x27::interval)',_0x1a2324[_0x418723(0x125)](parseInt((''+_0x4b28dd[_0x418723(0x10f)])[_0x418723(0x111)](/\D/g,''),0xa)));_[_0x418723(0x129)](_0x4b28dd,_0x418723(0x11f))&&(_0x2edb10+=_0x418723(0x128),_0x1a2324[_0x418723(0x125)](_0x4b28dd[_0x418723(0x11f)]+'\x2000:00:00'));_[_0x418723(0x129)](_0x4b28dd,_0x418723(0x12c))&&(_0x2edb10+=_0x418723(0x12b),_0x1a2324['push'](_0x4b28dd[_0x418723(0x12c)]+'\x2023:59:59'));_0x1a2324[_0x418723(0x125)](_0x25c097),_0x1a2324[_0x418723(0x125)](_0x25c097),_0x1a2324[_0x418723(0x125)](_0x25c097),_0x1a2324[_0x418723(0x125)](_0x25c097),_0x1a2324[_0x418723(0x125)](_0x25c097);const _0x3bab53=_0x2bb8b8['replace'](_0x418723(0x114),_0x2edb10),_0x266843=await database_1[_0x418723(0x10d)][_0x418723(0x106)](_0x3bab53,{'replacements':_0x1a2324,'type':sequelize_1['QueryTypes'][_0x418723(0x112)],'plain':!![]});return _0x266843;}exports[a540_0xce371a(0x10d)]=DashboardDataService;function a540_0x3aa4(){const _0x4dc2af=['../../database','days','11mYcdNx','replace','SELECT','7RfgKvP','--\x20filterPeriod','55922916ulmxqY','1069706KYYTFy','13710610UERxWa','5ivhtPX','__importStar','__createBinding','2vTKkGj','6368852hphdGH','get','__importDefault','date_from','3340472Etpcct','5070594wxySvv','__setModuleDefault','sequelize','__esModule','push','hasOwnProperty','call','\x20and\x20tt.\x22createdAt\x22\x20>=\x20?','has','getOwnPropertyDescriptor','\x20and\x20tt.\x22createdAt\x22\x20<=\x20?','date_to','writable','prototype','query','2151381JMVmMy','9yerIqw','create','configurable','\x0a\x20\x20\x20\x20with\x0a\x20\x20\x20\x20traking\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.name\x20\x22companyName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name\x20\x22userName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.online\x20\x22userOnline\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20w.name\x20\x22whatsappName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.name\x20\x22contactName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.number\x20\x22contactNumber\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(t.\x22status\x22\x20=\x20\x27closed\x27)\x20\x22finished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22userId\x22\x20is\x20null\x20and\x20coalesce(tt.\x22closedAt\x22,tt.\x22finishedAt\x22)\x20is\x20null\x20and\x20t.\x22status\x22\x20=\x20\x27pending\x27)\x20\x22pending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(coalesce(tt.\x22closedAt\x22,tt.\x22finishedAt\x22)))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(coalesce(tt.\x22closedAt\x22,tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(coalesce(tt.\x22closedAt\x22,tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22supportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(\x20tt.\x22queuedAt\x22,\x20tt.\x22startedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(tt.\x22queuedAt\x22,\x20tt.\x22startedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(tt.\x22queuedAt\x22,\x20tt.\x22startedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22waitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20t.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20tt.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.\x22id\x22\x20\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20from\x20\x22TicketTraking\x22\x20tt\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Companies\x22\x20c\x20on\x20c.id\x20=\x20tt.\x22companyId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20u.id\x20=\x20tt.\x22userId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20w.id\x20=\x20tt.\x22whatsappId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t\x20on\x20t.id\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct\x20on\x20ct.id\x20=\x20t.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20--\x20filterPeriod\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20counters\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22supportTime\x22)\x20from\x20traking\x20where\x20\x22supportTime\x22\x20>\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22waitTime\x22)\x20from\x20traking\x20where\x20\x22waitTime\x22\x20>\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27open\x27\x20and\x20t.\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportHappening\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27pending\x27\x20and\x20t.\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportPending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20finished)\x20\x22supportFinished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(leads.id)\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ct1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(tt1.id)\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20tt1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t1\x20on\x20t1.id\x20=\x20tt1.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct1\x20on\x20ct1.id\x20=\x20t1.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20having\x20count(tt1.id)\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20leads\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22leads\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20\x22status\x22\x20=\x20\x27closed\x27)\x20\x22tickets\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20\x22status\x22\x20=\x20\x27nps\x27)\x20\x22waitRating\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20\x22status\x22\x20=\x20\x27closed\x27\x20and\x20\x22rated\x22\x20=\x20false)\x20\x22withoutRating\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20\x22status\x22\x20=\x20\x27closed\x27\x20and\x20\x22rated\x22\x20=\x20true)\x20\x22withRating\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(((select\x20count(id)\x20from\x20traking\x20where\x20\x22rated\x22\x20=\x20true)*\x20100)\x20/\x20nullif((select\x20count(id)\x20from\x20traking),0))\x20\x22percRating\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(100*count(tt.*))/NULLIF((select\x20count(*)\x20total\x20from\x20traking\x20tt\x20inner\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22ticketId\x22\x20=\x20tt.\x22ticketId\x22\x20where\x20rated=\x20true),0)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20\x20tt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20inner\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22ticketId\x22\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20tt.rated\x20=\x20true\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20ur.\x22rate\x22\x20>\x208\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22npsPromotersPerc\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(100*count(tt.*))/NULLIF((select\x20count(*)\x20total\x20from\x20traking\x20tt\x20inner\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22ticketId\x22\x20=\x20tt.\x22ticketId\x22\x20where\x20rated=\x20true),0)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20\x20tt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20inner\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22ticketId\x22\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20tt.rated\x20=\x20true\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20ur.\x22rate\x22\x20in\x20(7,8)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22npsPassivePerc\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(100*count(tt.*))/NULLIF((select\x20count(*)\x20total\x20from\x20traking\x20tt\x20inner\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22ticketId\x22\x20=\x20tt.\x22ticketId\x22\x20where\x20rated=\x20true),0)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20\x20tt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20inner\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22ticketId\x22\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20tt.rated\x20=\x20true\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20ur.\x22rate\x22\x20<\x207\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22npsDetractorsPerc\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20sum(nps.promoter)\x20-\x20sum(nps.detractor)\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(100*count(tt.*))/NULLIF((select\x20count(*)\x20total\x20from\x20traking\x20tt\x20inner\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22ticketId\x22\x20=\x20tt.\x22ticketId\x22\x20where\x20rated=\x20true),0)\x20promoter\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,0\x20detractor\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20tt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20inner\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22ticketId\x22\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20tt.rated\x20=true\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20ur.\x22rate\x22\x20>\x208\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20union\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x200,(100*count(tt.*))/NULLIF((select\x20count(*)\x20total\x20from\x20traking\x20tt\x20inner\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22ticketId\x22\x20=\x20tt.\x22ticketId\x22\x20where\x20rated=\x20true),0)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20\x20tt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20inner\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22ticketId\x22\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20tt.rated\x20=true\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20ur.rate\x20<\x207))\x20nps\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22npsScore\x22\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20attedants\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20u1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u1.\x22name\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u1.\x22online\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22waitTime\x22)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22supportTime\x22)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(t.\x22id\x22)\x20\x22tickets\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20round(coalesce(avg(ur.\x22rate\x22),\x200),2)\x20\x22rating\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(count(ur.\x22id\x22),\x200)\x20\x22countRating\x22\x0a\x20\x20\x20\x20\x20\x20from\x20\x22Users\x22\x20u1\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20traking\x20t\x20on\x20t.\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22userId\x22\x20=\x20t.\x22userId\x22\x20and\x20ur.\x22ticketId\x22\x20=\x20t.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20where\x20u1.\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20group\x20by\x201,\x202\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20u1.\x22name\x22\x0a\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20coalesce(jsonb_build_object(\x27counters\x27,\x20c.*)->>\x27counters\x27,\x20\x27{}\x27)::jsonb\x20from\x20counters\x20c)\x20counters,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20coalesce(json_agg(a.*),\x20\x27[]\x27)::jsonb\x20from\x20attedants\x20a)\x20attendants;\x0a\x20\x20','defineProperty','default'];a540_0x3aa4=function(){return _0x4dc2af;};return a540_0x3aa4();}