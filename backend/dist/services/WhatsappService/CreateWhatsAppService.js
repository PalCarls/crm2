'use strict';const a630_0x9b7d8d=a630_0x52f2;function a630_0x52f2(_0x3dcffd,_0x23c089){const _0x11942b=a630_0x1194();return a630_0x52f2=function(_0x52f2de,_0x4eac27){_0x52f2de=_0x52f2de-0x136;let _0x16944e=_0x11942b[_0x52f2de];return _0x16944e;},a630_0x52f2(_0x3dcffd,_0x23c089);}(function(_0x4489df,_0x84aa2d){const _0x89bf6f=a630_0x52f2,_0x445bc0=_0x4489df();while(!![]){try{const _0x337472=-parseInt(_0x89bf6f(0x13b))/0x1*(parseInt(_0x89bf6f(0x14c))/0x2)+parseInt(_0x89bf6f(0x156))/0x3*(parseInt(_0x89bf6f(0x138))/0x4)+-parseInt(_0x89bf6f(0x13a))/0x5+-parseInt(_0x89bf6f(0x15b))/0x6+parseInt(_0x89bf6f(0x140))/0x7+parseInt(_0x89bf6f(0x157))/0x8*(parseInt(_0x89bf6f(0x151))/0x9)+parseInt(_0x89bf6f(0x136))/0xa;if(_0x337472===_0x84aa2d)break;else _0x445bc0['push'](_0x445bc0['shift']());}catch(_0x111e30){_0x445bc0['push'](_0x445bc0['shift']());}}}(a630_0x1194,0x55f21));var __createBinding=this&&this[a630_0x9b7d8d(0x147)]||(Object['create']?function(_0x5189ee,_0x4177db,_0x3c803c,_0x5bffef){const _0x45cfdd=a630_0x9b7d8d;if(_0x5bffef===undefined)_0x5bffef=_0x3c803c;var _0x300db5=Object[_0x45cfdd(0x139)](_0x4177db,_0x3c803c);(!_0x300db5||(_0x45cfdd(0x14b)in _0x300db5?!_0x4177db['__esModule']:_0x300db5[_0x45cfdd(0x13e)]||_0x300db5['configurable']))&&(_0x300db5={'enumerable':!![],'get':function(){return _0x4177db[_0x3c803c];}}),Object[_0x45cfdd(0x15a)](_0x5189ee,_0x5bffef,_0x300db5);}:function(_0x8aa7ab,_0xc4afa5,_0x4eeb83,_0x4c632c){if(_0x4c632c===undefined)_0x4c632c=_0x4eeb83;_0x8aa7ab[_0x4c632c]=_0xc4afa5[_0x4eeb83];}),__setModuleDefault=this&&this[a630_0x9b7d8d(0x15f)]||(Object['create']?function(_0x32ac7c,_0x56b28d){const _0x3cb48c=a630_0x9b7d8d;Object[_0x3cb48c(0x15a)](_0x32ac7c,_0x3cb48c(0x15e),{'enumerable':!![],'value':_0x56b28d});}:function(_0xc977a0,_0x3d4428){const _0x4a0107=a630_0x9b7d8d;_0xc977a0[_0x4a0107(0x15e)]=_0x3d4428;}),__importStar=this&&this[a630_0x9b7d8d(0x154)]||function(_0x429d77){const _0x452eee=a630_0x9b7d8d;if(_0x429d77&&_0x429d77['__esModule'])return _0x429d77;var _0x1acc30={};if(_0x429d77!=null){for(var _0x291046 in _0x429d77)if(_0x291046!==_0x452eee(0x15e)&&Object[_0x452eee(0x144)]['hasOwnProperty']['call'](_0x429d77,_0x291046))__createBinding(_0x1acc30,_0x429d77,_0x291046);}return __setModuleDefault(_0x1acc30,_0x429d77),_0x1acc30;},__importDefault=this&&this['__importDefault']||function(_0x1ac191){const _0x1a5e4b=a630_0x9b7d8d;return _0x1ac191&&_0x1ac191[_0x1a5e4b(0x148)]?_0x1ac191:{'default':_0x1ac191};};Object[a630_0x9b7d8d(0x15a)](exports,a630_0x9b7d8d(0x148),{'value':!![]});const Yup=__importStar(require(a630_0x9b7d8d(0x153))),AppError_1=__importDefault(require('../../errors/AppError')),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),Company_1=__importDefault(require('../../models/Company')),Plan_1=__importDefault(require(a630_0x9b7d8d(0x161))),AssociateWhatsappQueue_1=__importDefault(require(a630_0x9b7d8d(0x145))),CreateWhatsAppService=async({name:_0x4527d1,status:status='OPENING',queueIds:queueIds=[],greetingMessage:_0x274a6a,complationMessage:_0x3eadb7,outOfHoursMessage:_0x566905,isDefault:isDefault=![],companyId:_0x4e02f1,token:token='',provider:provider='beta',facebookUserId:_0x44f754,facebookUserToken:_0x297d1e,facebookPageUserId:_0x4eb794,tokenMeta:_0x49c14d,channel:channel=a630_0x9b7d8d(0x158),maxUseBotQueues:_0x2386ee,timeUseBotQueues:_0x535bf8,expiresTicket:_0x50bd2a,allowGroup:allowGroup=![],timeSendQueue:_0x5e1e45,sendIdQueue:_0x266225,timeInactiveMessage:_0x455ac7,inactiveMessage:_0x557510,ratingMessage:_0x219b17,maxUseBotQueuesNPS:_0x42ec27,expiresTicketNPS:_0xc681f0,whenExpiresTicket:_0x534947,expiresInactiveMessage:_0x1b9506,groupAsTicket:_0x31db74,importOldMessages:_0x480f9b,importRecentMessages:_0x2276c4,closedTicketsPostImported:_0x1079ed,importOldMessagesGroups:_0x43a86d,timeCreateNewTicket:_0x4fa381,integrationId:_0x4b070d,schedules:_0x9f9123,promptId:_0x3aa21f})=>{const _0x19a630=a630_0x9b7d8d,_0x39a75b=await Company_1[_0x19a630(0x15e)][_0x19a630(0x14e)]({'where':{'id':_0x4e02f1},'include':[{'model':Plan_1[_0x19a630(0x15e)],'as':'plan'}]});if(_0x39a75b!==null){const _0x4bf81b=await Whatsapp_1[_0x19a630(0x15e)]['count']({'where':{'companyId':_0x4e02f1,'channel':channel}});if(_0x4bf81b>=_0x39a75b[_0x19a630(0x146)][_0x19a630(0x141)])throw new AppError_1['default'](_0x19a630(0x143)+_0x4bf81b);}const _0x5c9d5b=Yup[_0x19a630(0x15d)]()['shape']({'name':Yup[_0x19a630(0x13c)]()['required']()[_0x19a630(0x162)](0x2)['test'](_0x19a630(0x150),_0x19a630(0x142),async _0x3d5a95=>{const _0x43ec02=_0x19a630;if(!_0x3d5a95)return![];const _0x4ced56=await Whatsapp_1[_0x43ec02(0x15e)][_0x43ec02(0x14e)]({'where':{'name':_0x3d5a95,'channel':channel,'companyId':_0x4e02f1}});return!_0x4ced56;}),'isDefault':Yup[_0x19a630(0x13f)]()[_0x19a630(0x159)]()});try{await _0x5c9d5b[_0x19a630(0x137)]({'name':_0x4527d1,'status':status,'isDefault':isDefault});}catch(_0x53292e){throw new AppError_1[(_0x19a630(0x15e))](_0x53292e['message']);}const _0x506386=await Whatsapp_1['default'][_0x19a630(0x14e)]({'where':{'companyId':_0x4e02f1}});isDefault=channel==='whatsapp'?!_0x506386:![];let _0x3952f4=null;channel===_0x19a630(0x158)&&isDefault&&(_0x3952f4=await Whatsapp_1[_0x19a630(0x15e)][_0x19a630(0x14e)]({'where':{'isDefault':!![],'companyId':_0x4e02f1,'channel':channel}}),_0x3952f4&&await _0x3952f4[_0x19a630(0x14f)]({'isDefault':![],'companyId':_0x4e02f1}));if(queueIds['length']>0x1&&!_0x274a6a)throw new AppError_1['default'](_0x19a630(0x14a));if(token!==null&&token!==''){const _0x543762=Yup[_0x19a630(0x15d)]()[_0x19a630(0x14d)]({'token':Yup[_0x19a630(0x13c)]()[_0x19a630(0x159)]()[_0x19a630(0x162)](0x2)[_0x19a630(0x160)](_0x19a630(0x155),_0x19a630(0x15c),async _0xa56df8=>{const _0x35ed20=_0x19a630;if(!_0xa56df8)return![];const _0x25a246=await Whatsapp_1[_0x35ed20(0x15e)]['findOne']({'where':{'token':_0xa56df8,'channel':channel}});return!_0x25a246;})});try{await _0x543762[_0x19a630(0x137)]({'token':token});}catch(_0x2f1353){throw new AppError_1[(_0x19a630(0x15e))](_0x2f1353[_0x19a630(0x149)]);}}const _0x46c9b0=await Whatsapp_1[_0x19a630(0x15e)][_0x19a630(0x152)]({'name':_0x4527d1,'status':status,'greetingMessage':_0x274a6a,'complationMessage':_0x3eadb7,'outOfHoursMessage':_0x566905,'ratingMessage':_0x219b17,'isDefault':isDefault,'companyId':_0x4e02f1,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x44f754,'facebookUserToken':_0x297d1e,'facebookPageUserId':_0x4eb794,'tokenMeta':_0x49c14d,'maxUseBotQueues':_0x2386ee,'timeUseBotQueues':_0x535bf8,'expiresTicket':_0x50bd2a,'allowGroup':allowGroup,'timeSendQueue':_0x5e1e45,'sendIdQueue':_0x266225,'timeInactiveMessage':_0x455ac7,'inactiveMessage':_0x557510,'maxUseBotQueuesNPS':_0x42ec27,'expiresTicketNPS':_0xc681f0,'whenExpiresTicket':_0x534947,'expiresInactiveMessage':_0x1b9506,'groupAsTicket':_0x31db74,'importOldMessages':_0x480f9b,'importRecentMessages':_0x2276c4,'closedTicketsPostImported':_0x1079ed,'importOldMessagesGroups':_0x43a86d,'timeCreateNewTicket':_0x4fa381,'integrationId':_0x4b070d,'schedules':_0x9f9123,'promptId':_0x3aa21f},{'include':[_0x19a630(0x13d)]});return await(0x0,AssociateWhatsappQueue_1[_0x19a630(0x15e)])(_0x46c9b0,queueIds),{'whatsapp':_0x46c9b0,'oldDefaultWhatsapp':_0x3952f4};};exports[a630_0x9b7d8d(0x15e)]=CreateWhatsAppService;function a630_0x1194(){const _0x281230=['yup','__importStar','Check-token','1170843gkzDaV','5912HjmTAC','whatsapp','required','defineProperty','1780740nMiwLl','This\x20whatsapp\x20token\x20is\x20already\x20used.','object','default','__setModuleDefault','test','../../models/Plan','min','495620RZsqrs','validate','4KdOGPy','getOwnPropertyDescriptor','953240fQhLSd','9274jmoCxw','string','queues','writable','boolean','2931544mftSuO','connections','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','prototype','./AssociateWhatsappQueue','plan','__createBinding','__esModule','message','ERR_WAPP_GREETING_REQUIRED','get','58XZEuAG','shape','findOne','update','Check-name','3042FXRXMs','create'];a630_0x1194=function(){return _0x281230;};return a630_0x1194();}