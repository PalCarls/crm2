'use strict';const a572_0x3c7dd3=a572_0x38a1;(function(_0xb247c,_0x3ca53b){const _0x40f91c=a572_0x38a1,_0x1ad728=_0xb247c();while(!![]){try{const _0x558a87=parseInt(_0x40f91c(0x18b))/0x1+-parseInt(_0x40f91c(0x17a))/0x2*(-parseInt(_0x40f91c(0x183))/0x3)+-parseInt(_0x40f91c(0x172))/0x4+-parseInt(_0x40f91c(0x185))/0x5+parseInt(_0x40f91c(0x175))/0x6*(parseInt(_0x40f91c(0x164))/0x7)+-parseInt(_0x40f91c(0x181))/0x8*(-parseInt(_0x40f91c(0x16d))/0x9)+parseInt(_0x40f91c(0x189))/0xa*(parseInt(_0x40f91c(0x18d))/0xb);if(_0x558a87===_0x3ca53b)break;else _0x1ad728['push'](_0x1ad728['shift']());}catch(_0x336f47){_0x1ad728['push'](_0x1ad728['shift']());}}}(a572_0x58dd,0xd2360));var __createBinding=this&&this['__createBinding']||(Object[a572_0x3c7dd3(0x16c)]?function(_0x1c7aee,_0x1633e3,_0x2e4321,_0x32f4b8){const _0xa57c22=a572_0x3c7dd3;if(_0x32f4b8===undefined)_0x32f4b8=_0x2e4321;var _0x2b52ce=Object['getOwnPropertyDescriptor'](_0x1633e3,_0x2e4321);(!_0x2b52ce||(_0xa57c22(0x184)in _0x2b52ce?!_0x1633e3[_0xa57c22(0x16e)]:_0x2b52ce['writable']||_0x2b52ce[_0xa57c22(0x176)]))&&(_0x2b52ce={'enumerable':!![],'get':function(){return _0x1633e3[_0x2e4321];}}),Object['defineProperty'](_0x1c7aee,_0x32f4b8,_0x2b52ce);}:function(_0x186af6,_0x1d93fd,_0x2b8d8e,_0x1b2def){if(_0x1b2def===undefined)_0x1b2def=_0x2b8d8e;_0x186af6[_0x1b2def]=_0x1d93fd[_0x2b8d8e];}),__setModuleDefault=this&&this[a572_0x3c7dd3(0x191)]||(Object[a572_0x3c7dd3(0x16c)]?function(_0x2f4362,_0x39810c){const _0x226e9c=a572_0x3c7dd3;Object[_0x226e9c(0x180)](_0x2f4362,_0x226e9c(0x18a),{'enumerable':!![],'value':_0x39810c});}:function(_0x53414c,_0x319962){const _0x44a781=a572_0x3c7dd3;_0x53414c[_0x44a781(0x18a)]=_0x319962;}),__importStar=this&&this['__importStar']||function(_0x3daaf3){const _0x58fdc4=a572_0x3c7dd3;if(_0x3daaf3&&_0x3daaf3['__esModule'])return _0x3daaf3;var _0x5670e8={};if(_0x3daaf3!=null){for(var _0x5eb3e5 in _0x3daaf3)if(_0x5eb3e5!==_0x58fdc4(0x18a)&&Object[_0x58fdc4(0x16f)][_0x58fdc4(0x16a)][_0x58fdc4(0x178)](_0x3daaf3,_0x5eb3e5))__createBinding(_0x5670e8,_0x3daaf3,_0x5eb3e5);}return __setModuleDefault(_0x5670e8,_0x3daaf3),_0x5670e8;},__importDefault=this&&this[a572_0x3c7dd3(0x173)]||function(_0x385062){const _0x5ea73a=a572_0x3c7dd3;return _0x385062&&_0x385062[_0x5ea73a(0x16e)]?_0x385062:{'default':_0x385062};};Object[a572_0x3c7dd3(0x180)](exports,'__esModule',{'value':!![]});function a572_0x38a1(_0x20515a,_0x17ec49){const _0x58dd7d=a572_0x58dd();return a572_0x38a1=function(_0x38a1bb,_0x29641b){_0x38a1bb=_0x38a1bb-0x163;let _0x217e8f=_0x58dd7d[_0x38a1bb];return _0x217e8f;},a572_0x38a1(_0x20515a,_0x17ec49);}const Yup=__importStar(require(a572_0x3c7dd3(0x174))),AppError_1=__importDefault(require(a572_0x3c7dd3(0x182))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),Company_1=__importDefault(require(a572_0x3c7dd3(0x179))),Plan_1=__importDefault(require(a572_0x3c7dd3(0x187))),AssociateWhatsappQueue_1=__importDefault(require('./AssociateWhatsappQueue')),CreateWhatsAppService=async({name:_0x2968ea,status:status='OPENING',queueIds:queueIds=[],greetingMessage:_0x4af6d2,complationMessage:_0x62c5ac,outOfHoursMessage:_0x50dd0e,isDefault:isDefault=![],companyId:_0x109b68,token:token='',provider:provider=a572_0x3c7dd3(0x170),facebookUserId:_0x2a6b49,facebookUserToken:_0x371132,facebookPageUserId:_0x347762,tokenMeta:_0x1b9803,channel:channel='whatsapp',maxUseBotQueues:_0x4abce0,timeUseBotQueues:_0x4b1125,expiresTicket:_0x5cf635,allowGroup:allowGroup=![],timeSendQueue:_0x5f30b1,sendIdQueue:_0xf27c8f,timeInactiveMessage:_0xc98901,inactiveMessage:_0x4a39f7,ratingMessage:_0x100a93,maxUseBotQueuesNPS:_0x1ff128,expiresTicketNPS:_0x25f4f1,whenExpiresTicket:_0x447960,expiresInactiveMessage:_0x3a8cf8,groupAsTicket:_0x303b9f,importOldMessages:_0x505e40,importRecentMessages:_0x15ff28,closedTicketsPostImported:_0x12b58e,importOldMessagesGroups:_0x28d648,timeCreateNewTicket:_0x553fbb})=>{const _0x624174=a572_0x3c7dd3,_0x334766=await Company_1[_0x624174(0x18a)][_0x624174(0x18e)]({'where':{'id':_0x109b68},'include':[{'model':Plan_1[_0x624174(0x18a)],'as':_0x624174(0x18f)}]});if(_0x334766!==null){const _0x4d4362=await Whatsapp_1[_0x624174(0x18a)][_0x624174(0x192)]({'where':{'companyId':_0x109b68,'channel':channel}});if(_0x4d4362>=_0x334766['plan'][_0x624174(0x16b)])throw new AppError_1[(_0x624174(0x18a))](_0x624174(0x186)+_0x4d4362);}const _0x5e0252=Yup[_0x624174(0x18c)]()[_0x624174(0x171)]({'name':Yup[_0x624174(0x168)]()[_0x624174(0x177)]()[_0x624174(0x166)](0x2)[_0x624174(0x17f)](_0x624174(0x17e),_0x624174(0x167),async _0x55a25e=>{const _0x5c36e2=_0x624174;if(!_0x55a25e)return![];const _0x334f5c=await Whatsapp_1[_0x5c36e2(0x18a)][_0x5c36e2(0x18e)]({'where':{'name':_0x55a25e,'channel':channel,'companyId':_0x109b68}});return!_0x334f5c;}),'isDefault':Yup[_0x624174(0x169)]()[_0x624174(0x177)]()});try{await _0x5e0252['validate']({'name':_0x2968ea,'status':status,'isDefault':isDefault});}catch(_0x408d66){throw new AppError_1[(_0x624174(0x18a))](_0x408d66[_0x624174(0x17b)]);}const _0x81ec93=await Whatsapp_1[_0x624174(0x18a)]['findOne']({'where':{'companyId':_0x109b68}});isDefault=channel===_0x624174(0x17d)?!_0x81ec93:![];let _0x2c6e5c=null;channel==='whatsapp'&&isDefault&&(_0x2c6e5c=await Whatsapp_1[_0x624174(0x18a)][_0x624174(0x18e)]({'where':{'isDefault':!![],'companyId':_0x109b68,'channel':channel}}),_0x2c6e5c&&await _0x2c6e5c[_0x624174(0x188)]({'isDefault':![],'companyId':_0x109b68}));if(queueIds['length']>0x1&&!_0x4af6d2)throw new AppError_1[(_0x624174(0x18a))](_0x624174(0x193));if(token!==null&&token!==''){const _0xb73508=Yup[_0x624174(0x18c)]()[_0x624174(0x171)]({'token':Yup[_0x624174(0x168)]()[_0x624174(0x177)]()['min'](0x2)['test'](_0x624174(0x190),_0x624174(0x17c),async _0x2bca1e=>{const _0x48e3f0=_0x624174;if(!_0x2bca1e)return![];const _0x13beb2=await Whatsapp_1[_0x48e3f0(0x18a)][_0x48e3f0(0x18e)]({'where':{'token':_0x2bca1e,'channel':channel}});return!_0x13beb2;})});try{await _0xb73508[_0x624174(0x165)]({'token':token});}catch(_0x105dc6){throw new AppError_1[(_0x624174(0x18a))](_0x105dc6[_0x624174(0x17b)]);}}const _0x2ba6e8=await Whatsapp_1[_0x624174(0x18a)][_0x624174(0x16c)]({'name':_0x2968ea,'status':status,'greetingMessage':_0x4af6d2,'complationMessage':_0x62c5ac,'outOfHoursMessage':_0x50dd0e,'ratingMessage':_0x100a93,'isDefault':isDefault,'companyId':_0x109b68,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x2a6b49,'facebookUserToken':_0x371132,'facebookPageUserId':_0x347762,'tokenMeta':_0x1b9803,'maxUseBotQueues':_0x4abce0,'timeUseBotQueues':_0x4b1125,'expiresTicket':_0x5cf635,'allowGroup':allowGroup,'timeSendQueue':_0x5f30b1,'sendIdQueue':_0xf27c8f,'timeInactiveMessage':_0xc98901,'inactiveMessage':_0x4a39f7,'maxUseBotQueuesNPS':_0x1ff128,'expiresTicketNPS':_0x25f4f1,'whenExpiresTicket':_0x447960,'expiresInactiveMessage':_0x3a8cf8,'groupAsTicket':_0x303b9f,'importOldMessages':_0x505e40,'importRecentMessages':_0x15ff28,'closedTicketsPostImported':_0x12b58e,'importOldMessagesGroups':_0x28d648,'timeCreateNewTicket':_0x553fbb},{'include':[_0x624174(0x163)]});return await(0x0,AssociateWhatsappQueue_1[_0x624174(0x18a)])(_0x2ba6e8,queueIds),{'whatsapp':_0x2ba6e8,'oldDefaultWhatsapp':_0x2c6e5c};};function a572_0x58dd(){const _0x374fed=['5218220Yxuetf','__importDefault','yup','624FuxLyi','configurable','required','call','../../models/Company','648364ECvNRM','message','This\x20whatsapp\x20token\x20is\x20already\x20used.','whatsapp','Check-name','test','defineProperty','1344kwZGRi','../../errors/AppError','3rkTJfH','get','5771340lXRPiE','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','../../models/Plan','update','40ElUCcD','default','15157amvmxE','object','4091219WIVnnH','findOne','plan','Check-token','__setModuleDefault','count','ERR_WAPP_GREETING_REQUIRED','queues','56399jGWUlv','validate','min','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','string','boolean','hasOwnProperty','connections','create','35082IuKCSY','__esModule','prototype','beta','shape'];a572_0x58dd=function(){return _0x374fed;};return a572_0x58dd();}exports[a572_0x3c7dd3(0x18a)]=CreateWhatsAppService;