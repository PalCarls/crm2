'use strict';function a555_0x5509(){const _0x442445=['message','min','Check-token','getOwnPropertyDescriptor','prototype','configurable','plan','object','2FeMYHu','ERR_WAPP_GREETING_REQUIRED','count','connections','745495WRPeAq','__esModule','__importDefault','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','244557KxxUqH','OPENING','hasOwnProperty','length','86780VJGcdt','4345ckQteT','validate','140338iMVnFc','This\x20whatsapp\x20token\x20is\x20already\x20used.','required','findOne','yup','boolean','create','../../models/Plan','call','update','__importStar','shape','whatsapp','2076YRKCnr','24040nNNgjp','defineProperty','./AssociateWhatsappQueue','1505mDXsPY','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','250tysnFP','default','../../models/Whatsapp','3912kLOCRj','Check-name','1835889PgWfaE','queues'];a555_0x5509=function(){return _0x442445;};return a555_0x5509();}function a555_0x1961(_0x29a066,_0x2ebbb1){const _0x5509bd=a555_0x5509();return a555_0x1961=function(_0x19615d,_0xccba65){_0x19615d=_0x19615d-0x162;let _0xf1302a=_0x5509bd[_0x19615d];return _0xf1302a;},a555_0x1961(_0x29a066,_0x2ebbb1);}const a555_0x251ee6=a555_0x1961;(function(_0x4cab89,_0x10fe5c){const _0x384a1d=a555_0x1961,_0x4adb41=_0x4cab89();while(!![]){try{const _0x1aac12=parseInt(_0x384a1d(0x17f))/0x1+-parseInt(_0x384a1d(0x17b))/0x2*(parseInt(_0x384a1d(0x171))/0x3)+-parseInt(_0x384a1d(0x187))/0x4+-parseInt(_0x384a1d(0x188))/0x5*(parseInt(_0x384a1d(0x16f))/0x6)+parseInt(_0x384a1d(0x16a))/0x7*(-parseInt(_0x384a1d(0x167))/0x8)+-parseInt(_0x384a1d(0x183))/0x9*(parseInt(_0x384a1d(0x16c))/0xa)+-parseInt(_0x384a1d(0x18a))/0xb*(-parseInt(_0x384a1d(0x166))/0xc);if(_0x1aac12===_0x10fe5c)break;else _0x4adb41['push'](_0x4adb41['shift']());}catch(_0x4fb4b8){_0x4adb41['push'](_0x4adb41['shift']());}}}(a555_0x5509,0x683e7));var __createBinding=this&&this['__createBinding']||(Object[a555_0x251ee6(0x190)]?function(_0x2621ef,_0x289f59,_0x5121d1,_0x1f0875){const _0x5b194b=a555_0x251ee6;if(_0x1f0875===undefined)_0x1f0875=_0x5121d1;var _0x595035=Object[_0x5b194b(0x176)](_0x289f59,_0x5121d1);(!_0x595035||('get'in _0x595035?!_0x289f59['__esModule']:_0x595035['writable']||_0x595035[_0x5b194b(0x178)]))&&(_0x595035={'enumerable':!![],'get':function(){return _0x289f59[_0x5121d1];}}),Object[_0x5b194b(0x168)](_0x2621ef,_0x1f0875,_0x595035);}:function(_0x2cc00e,_0x3f7a2b,_0x21ace6,_0x4e6b17){if(_0x4e6b17===undefined)_0x4e6b17=_0x21ace6;_0x2cc00e[_0x4e6b17]=_0x3f7a2b[_0x21ace6];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x315b6a,_0x2e4d28){const _0x5bae3a=a555_0x251ee6;Object[_0x5bae3a(0x168)](_0x315b6a,_0x5bae3a(0x16d),{'enumerable':!![],'value':_0x2e4d28});}:function(_0x2925d1,_0x2df5de){const _0x3f1a0d=a555_0x251ee6;_0x2925d1[_0x3f1a0d(0x16d)]=_0x2df5de;}),__importStar=this&&this[a555_0x251ee6(0x163)]||function(_0x504097){const _0xd0c4bb=a555_0x251ee6;if(_0x504097&&_0x504097[_0xd0c4bb(0x180)])return _0x504097;var _0x484e60={};if(_0x504097!=null){for(var _0x4cc216 in _0x504097)if(_0x4cc216!==_0xd0c4bb(0x16d)&&Object[_0xd0c4bb(0x177)][_0xd0c4bb(0x185)][_0xd0c4bb(0x192)](_0x504097,_0x4cc216))__createBinding(_0x484e60,_0x504097,_0x4cc216);}return __setModuleDefault(_0x484e60,_0x504097),_0x484e60;},__importDefault=this&&this[a555_0x251ee6(0x181)]||function(_0x4d5960){const _0x2033cf=a555_0x251ee6;return _0x4d5960&&_0x4d5960[_0x2033cf(0x180)]?_0x4d5960:{'default':_0x4d5960};};Object[a555_0x251ee6(0x168)](exports,a555_0x251ee6(0x180),{'value':!![]});const Yup=__importStar(require(a555_0x251ee6(0x18e))),AppError_1=__importDefault(require('../../errors/AppError')),Whatsapp_1=__importDefault(require(a555_0x251ee6(0x16e))),Company_1=__importDefault(require('../../models/Company')),Plan_1=__importDefault(require(a555_0x251ee6(0x191))),AssociateWhatsappQueue_1=__importDefault(require(a555_0x251ee6(0x169))),CreateWhatsAppService=async({name:_0x1bc21a,status:status=a555_0x251ee6(0x184),queueIds:queueIds=[],greetingMessage:_0x57afe1,complationMessage:_0x77a761,outOfHoursMessage:_0x582d60,isDefault:isDefault=![],companyId:_0x3d157d,token:token='',provider:provider='beta',facebookUserId:_0x15090b,facebookUserToken:_0x3bd9ec,facebookPageUserId:_0x3a9730,tokenMeta:_0x184eb7,channel:channel=a555_0x251ee6(0x165),maxUseBotQueues:_0x3a0690,timeUseBotQueues:_0x34f555,expiresTicket:_0x3592b7,allowGroup:allowGroup=![],timeSendQueue:_0xfab8bb,sendIdQueue:_0xa8bd1b,timeInactiveMessage:_0x1f1309,inactiveMessage:_0x4306e3,ratingMessage:_0x5dd22d,maxUseBotQueuesNPS:_0x1c2fa0,expiresTicketNPS:_0x5d5f73,whenExpiresTicket:_0xe8e507,expiresInactiveMessage:_0x537778,groupAsTicket:_0x18f029,importOldMessages:_0x5329c9,importRecentMessages:_0x54ed91,closedTicketsPostImported:_0x2b5b60,importOldMessagesGroups:_0x5f0dce,timeCreateNewTicket:_0x35a987})=>{const _0x3a2b99=a555_0x251ee6,_0x16aaa5=await Company_1[_0x3a2b99(0x16d)][_0x3a2b99(0x18d)]({'where':{'id':_0x3d157d},'include':[{'model':Plan_1[_0x3a2b99(0x16d)],'as':_0x3a2b99(0x179)}]});if(_0x16aaa5!==null){const _0x3fc82d=await Whatsapp_1[_0x3a2b99(0x16d)][_0x3a2b99(0x17d)]({'where':{'companyId':_0x3d157d,'channel':channel}});if(_0x3fc82d>=_0x16aaa5['plan'][_0x3a2b99(0x17e)])throw new AppError_1[(_0x3a2b99(0x16d))](_0x3a2b99(0x182)+_0x3fc82d);}const _0x1882d1=Yup[_0x3a2b99(0x17a)]()[_0x3a2b99(0x164)]({'name':Yup['string']()[_0x3a2b99(0x18c)]()[_0x3a2b99(0x174)](0x2)['test'](_0x3a2b99(0x170),_0x3a2b99(0x16b),async _0x58e146=>{const _0x31a114=_0x3a2b99;if(!_0x58e146)return![];const _0x44768c=await Whatsapp_1[_0x31a114(0x16d)]['findOne']({'where':{'name':_0x58e146,'channel':channel,'companyId':_0x3d157d}});return!_0x44768c;}),'isDefault':Yup[_0x3a2b99(0x18f)]()[_0x3a2b99(0x18c)]()});try{await _0x1882d1[_0x3a2b99(0x189)]({'name':_0x1bc21a,'status':status,'isDefault':isDefault});}catch(_0xe4c685){throw new AppError_1[(_0x3a2b99(0x16d))](_0xe4c685[_0x3a2b99(0x173)]);}const _0x1181e5=await Whatsapp_1['default'][_0x3a2b99(0x18d)]({'where':{'companyId':_0x3d157d}});isDefault=channel===_0x3a2b99(0x165)?!_0x1181e5:![];let _0x497063=null;channel===_0x3a2b99(0x165)&&isDefault&&(_0x497063=await Whatsapp_1['default']['findOne']({'where':{'isDefault':!![],'companyId':_0x3d157d,'channel':channel}}),_0x497063&&await _0x497063[_0x3a2b99(0x162)]({'isDefault':![],'companyId':_0x3d157d}));if(queueIds[_0x3a2b99(0x186)]>0x1&&!_0x57afe1)throw new AppError_1[(_0x3a2b99(0x16d))](_0x3a2b99(0x17c));if(token!==null&&token!==''){const _0x16a945=Yup[_0x3a2b99(0x17a)]()[_0x3a2b99(0x164)]({'token':Yup['string']()[_0x3a2b99(0x18c)]()[_0x3a2b99(0x174)](0x2)['test'](_0x3a2b99(0x175),_0x3a2b99(0x18b),async _0x1f8104=>{const _0x76e6e8=_0x3a2b99;if(!_0x1f8104)return![];const _0x31a244=await Whatsapp_1[_0x76e6e8(0x16d)][_0x76e6e8(0x18d)]({'where':{'token':_0x1f8104,'channel':channel}});return!_0x31a244;})});try{await _0x16a945[_0x3a2b99(0x189)]({'token':token});}catch(_0x27bf04){throw new AppError_1[(_0x3a2b99(0x16d))](_0x27bf04['message']);}}const _0x1f7969=await Whatsapp_1[_0x3a2b99(0x16d)][_0x3a2b99(0x190)]({'name':_0x1bc21a,'status':status,'greetingMessage':_0x57afe1,'complationMessage':_0x77a761,'outOfHoursMessage':_0x582d60,'ratingMessage':_0x5dd22d,'isDefault':isDefault,'companyId':_0x3d157d,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x15090b,'facebookUserToken':_0x3bd9ec,'facebookPageUserId':_0x3a9730,'tokenMeta':_0x184eb7,'maxUseBotQueues':_0x3a0690,'timeUseBotQueues':_0x34f555,'expiresTicket':_0x3592b7,'allowGroup':allowGroup,'timeSendQueue':_0xfab8bb,'sendIdQueue':_0xa8bd1b,'timeInactiveMessage':_0x1f1309,'inactiveMessage':_0x4306e3,'maxUseBotQueuesNPS':_0x1c2fa0,'expiresTicketNPS':_0x5d5f73,'whenExpiresTicket':_0xe8e507,'expiresInactiveMessage':_0x537778,'groupAsTicket':_0x18f029,'importOldMessages':_0x5329c9,'importRecentMessages':_0x54ed91,'closedTicketsPostImported':_0x2b5b60,'importOldMessagesGroups':_0x5f0dce,'timeCreateNewTicket':_0x35a987},{'include':[_0x3a2b99(0x172)]});return await(0x0,AssociateWhatsappQueue_1[_0x3a2b99(0x16d)])(_0x1f7969,queueIds),{'whatsapp':_0x1f7969,'oldDefaultWhatsapp':_0x497063};};exports[a555_0x251ee6(0x16d)]=CreateWhatsAppService;