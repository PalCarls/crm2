'use strict';const a519_0x353531=a519_0x4103;(function(_0x5b81c4,_0xc96ebf){const _0x5d5989=a519_0x4103,_0x1f6f35=_0x5b81c4();while(!![]){try{const _0x59650b=-parseInt(_0x5d5989(0x1ff))/0x1+-parseInt(_0x5d5989(0x1ec))/0x2*(-parseInt(_0x5d5989(0x201))/0x3)+parseInt(_0x5d5989(0x209))/0x4*(-parseInt(_0x5d5989(0x1fd))/0x5)+parseInt(_0x5d5989(0x203))/0x6+parseInt(_0x5d5989(0x1ed))/0x7+-parseInt(_0x5d5989(0x1df))/0x8*(-parseInt(_0x5d5989(0x1ea))/0x9)+parseInt(_0x5d5989(0x1fe))/0xa;if(_0x59650b===_0xc96ebf)break;else _0x1f6f35['push'](_0x1f6f35['shift']());}catch(_0x2b6547){_0x1f6f35['push'](_0x1f6f35['shift']());}}}(a519_0x41c4,0xa54f2));var __createBinding=this&&this[a519_0x353531(0x1ef)]||(Object['create']?function(_0x496c78,_0x47aa2f,_0x1817c5,_0x2becd5){const _0x33e78a=a519_0x353531;if(_0x2becd5===undefined)_0x2becd5=_0x1817c5;var _0x1a6511=Object[_0x33e78a(0x1e3)](_0x47aa2f,_0x1817c5);(!_0x1a6511||(_0x33e78a(0x1dd)in _0x1a6511?!_0x47aa2f['__esModule']:_0x1a6511[_0x33e78a(0x1e2)]||_0x1a6511['configurable']))&&(_0x1a6511={'enumerable':!![],'get':function(){return _0x47aa2f[_0x1817c5];}}),Object[_0x33e78a(0x1fa)](_0x496c78,_0x2becd5,_0x1a6511);}:function(_0x3020ea,_0x117ba1,_0x5782ec,_0x53c8c9){if(_0x53c8c9===undefined)_0x53c8c9=_0x5782ec;_0x3020ea[_0x53c8c9]=_0x117ba1[_0x5782ec];}),__setModuleDefault=this&&this[a519_0x353531(0x1e1)]||(Object['create']?function(_0x169207,_0x19df03){const _0x20d8b8=a519_0x353531;Object[_0x20d8b8(0x1fa)](_0x169207,_0x20d8b8(0x1ee),{'enumerable':!![],'value':_0x19df03});}:function(_0x151ecb,_0x498e9d){_0x151ecb['default']=_0x498e9d;}),__importStar=this&&this[a519_0x353531(0x1e8)]||function(_0x233b27){const _0x1a9b55=a519_0x353531;if(_0x233b27&&_0x233b27['__esModule'])return _0x233b27;var _0x29b221={};if(_0x233b27!=null){for(var _0x11079c in _0x233b27)if(_0x11079c!==_0x1a9b55(0x1ee)&&Object[_0x1a9b55(0x204)][_0x1a9b55(0x1f2)][_0x1a9b55(0x1f7)](_0x233b27,_0x11079c))__createBinding(_0x29b221,_0x233b27,_0x11079c);}return __setModuleDefault(_0x29b221,_0x233b27),_0x29b221;},__importDefault=this&&this[a519_0x353531(0x202)]||function(_0x15bf00){const _0x10a8c6=a519_0x353531;return _0x15bf00&&_0x15bf00[_0x10a8c6(0x1eb)]?_0x15bf00:{'default':_0x15bf00};};Object['defineProperty'](exports,a519_0x353531(0x1eb),{'value':!![]});function a519_0x4103(_0x1a573b,_0x5240a0){const _0x41c479=a519_0x41c4();return a519_0x4103=function(_0x410309,_0x527bce){_0x410309=_0x410309-0x1db;let _0x248690=_0x41c479[_0x410309];return _0x248690;},a519_0x4103(_0x1a573b,_0x5240a0);}const Yup=__importStar(require(a519_0x353531(0x207))),AppError_1=__importDefault(require('../../errors/AppError')),Whatsapp_1=__importDefault(require(a519_0x353531(0x1db))),Company_1=__importDefault(require(a519_0x353531(0x1f0))),Plan_1=__importDefault(require(a519_0x353531(0x1f9))),AssociateWhatsappQueue_1=__importDefault(require('./AssociateWhatsappQueue')),CreateWhatsAppService=async({name:_0x57a402,status:status='OPENING',queueIds:queueIds=[],greetingMessage:_0x2c9bb2,complationMessage:_0x44f38a,outOfHoursMessage:_0x4a13c1,isDefault:isDefault=![],companyId:_0x18ed2d,token:token='',provider:provider=a519_0x353531(0x205),facebookUserId:_0x517bde,facebookUserToken:_0xa6fcb2,facebookPageUserId:_0x386ec7,tokenMeta:_0x16a9a3,channel:channel=a519_0x353531(0x1f8),maxUseBotQueues:_0x40bfa5,timeUseBotQueues:_0x2b4446,expiresTicket:_0x2d61d4,allowGroup:allowGroup=![],timeSendQueue:_0x1c86d8,sendIdQueue:_0x2f5304,timeInactiveMessage:_0x5dc6f7,inactiveMessage:_0x5b8552,ratingMessage:_0x44fc78,maxUseBotQueuesNPS:_0x18c3ac,expiresTicketNPS:_0x3fcc04,whenExpiresTicket:_0x4c4a21,expiresInactiveMessage:_0x5a276e,groupAsTicket:_0x1be63c})=>{const _0x348f61=a519_0x353531,_0x3a9f69=await Company_1[_0x348f61(0x1ee)][_0x348f61(0x1de)]({'where':{'id':_0x18ed2d},'include':[{'model':Plan_1['default'],'as':_0x348f61(0x1f3)}]});if(_0x3a9f69!==null){const _0x35c381=await Whatsapp_1[_0x348f61(0x1ee)]['count']({'where':{'companyId':_0x18ed2d,'channel':channel}});if(_0x35c381>=_0x3a9f69[_0x348f61(0x1f3)]['connections'])throw new AppError_1[(_0x348f61(0x1ee))](_0x348f61(0x1f6)+_0x35c381);}const _0x3e46eb=Yup['object']()['shape']({'name':Yup[_0x348f61(0x1e9)]()['required']()[_0x348f61(0x1e6)](0x2)['test'](_0x348f61(0x1e0),_0x348f61(0x20a),async _0x210f58=>{const _0x5a88db=_0x348f61;if(!_0x210f58)return![];const _0x114eaf=await Whatsapp_1['default'][_0x5a88db(0x1de)]({'where':{'name':_0x210f58,'channel':channel}});return!_0x114eaf;}),'isDefault':Yup['boolean']()[_0x348f61(0x1e5)]()});try{await _0x3e46eb[_0x348f61(0x1f5)]({'name':_0x57a402,'status':status,'isDefault':isDefault});}catch(_0x105c52){throw new AppError_1[(_0x348f61(0x1ee))](_0x105c52['message']);}const _0x5e913a=await Whatsapp_1['default'][_0x348f61(0x1de)]({'where':{'companyId':_0x18ed2d}});isDefault=channel==='whatsapp'?!_0x5e913a:![];let _0x9cfd50=null;channel===_0x348f61(0x1f8)&&isDefault&&(_0x9cfd50=await Whatsapp_1[_0x348f61(0x1ee)][_0x348f61(0x1de)]({'where':{'isDefault':!![],'companyId':_0x18ed2d,'channel':channel}}),_0x9cfd50&&await _0x9cfd50[_0x348f61(0x1f1)]({'isDefault':![],'companyId':_0x18ed2d}));if(queueIds[_0x348f61(0x1f4)]>0x1&&!_0x2c9bb2)throw new AppError_1[(_0x348f61(0x1ee))](_0x348f61(0x1dc));if(token!==null&&token!==''){const _0x4835ad=Yup['object']()[_0x348f61(0x1fb)]({'token':Yup[_0x348f61(0x1e9)]()[_0x348f61(0x1e5)]()[_0x348f61(0x1e6)](0x2)[_0x348f61(0x1fc)](_0x348f61(0x206),_0x348f61(0x1e7),async _0x22f75b=>{const _0x473349=_0x348f61;if(!_0x22f75b)return![];const _0x221067=await Whatsapp_1['default'][_0x473349(0x1de)]({'where':{'token':_0x22f75b,'channel':channel}});return!_0x221067;})});try{await _0x4835ad[_0x348f61(0x1f5)]({'token':token});}catch(_0x5019da){throw new AppError_1[(_0x348f61(0x1ee))](_0x5019da[_0x348f61(0x208)]);}}const _0xa63a4d=await Whatsapp_1[_0x348f61(0x1ee)][_0x348f61(0x1e4)]({'name':_0x57a402,'status':status,'greetingMessage':_0x2c9bb2,'complationMessage':_0x44f38a,'outOfHoursMessage':_0x4a13c1,'ratingMessage':_0x44fc78,'isDefault':isDefault,'companyId':_0x18ed2d,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x517bde,'facebookUserToken':_0xa6fcb2,'facebookPageUserId':_0x386ec7,'tokenMeta':_0x16a9a3,'maxUseBotQueues':_0x40bfa5,'timeUseBotQueues':_0x2b4446,'expiresTicket':_0x2d61d4,'allowGroup':allowGroup,'timeSendQueue':_0x1c86d8,'sendIdQueue':_0x2f5304,'timeInactiveMessage':_0x5dc6f7,'inactiveMessage':_0x5b8552,'maxUseBotQueuesNPS':_0x18c3ac,'expiresTicketNPS':_0x3fcc04,'whenExpiresTicket':_0x4c4a21,'expiresInactiveMessage':_0x5a276e,'groupAsTicket':_0x1be63c},{'include':[_0x348f61(0x200)]});return await(0x0,AssociateWhatsappQueue_1[_0x348f61(0x1ee)])(_0xa63a4d,queueIds),{'whatsapp':_0xa63a4d,'oldDefaultWhatsapp':_0x9cfd50};};exports[a519_0x353531(0x1ee)]=CreateWhatsAppService;function a519_0x41c4(){const _0x38ffa8=['yup','message','1268kqLLlr','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','../../models/Whatsapp','ERR_WAPP_GREETING_REQUIRED','get','findOne','352YdlTDO','Check-name','__setModuleDefault','writable','getOwnPropertyDescriptor','create','required','min','This\x20whatsapp\x20token\x20is\x20already\x20used.','__importStar','string','153702GjPkSE','__esModule','2RaEEDA','2016021rgrczJ','default','__createBinding','../../models/Company','update','hasOwnProperty','plan','length','validate','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','call','whatsapp','../../models/Plan','defineProperty','shape','test','20385SWdBBj','7696080PyicVE','1129362yQsEXi','queues','2558706VhGCtE','__importDefault','2621592DQkkGj','prototype','beta','Check-token'];a519_0x41c4=function(){return _0x38ffa8;};return a519_0x41c4();}