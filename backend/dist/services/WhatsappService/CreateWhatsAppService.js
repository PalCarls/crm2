'use strict';const a556_0xbc23e1=a556_0x5ba1;(function(_0x38f5cf,_0x1ffa07){const _0x163e59=a556_0x5ba1,_0x2213b0=_0x38f5cf();while(!![]){try{const _0x3d6435=-parseInt(_0x163e59(0xd1))/0x1+-parseInt(_0x163e59(0xdb))/0x2+-parseInt(_0x163e59(0xd0))/0x3*(parseInt(_0x163e59(0xe7))/0x4)+-parseInt(_0x163e59(0xe1))/0x5+-parseInt(_0x163e59(0xe0))/0x6+parseInt(_0x163e59(0xe5))/0x7+parseInt(_0x163e59(0xbb))/0x8*(parseInt(_0x163e59(0xd2))/0x9);if(_0x3d6435===_0x1ffa07)break;else _0x2213b0['push'](_0x2213b0['shift']());}catch(_0x46c3b7){_0x2213b0['push'](_0x2213b0['shift']());}}}(a556_0x3995,0x645e6));var __createBinding=this&&this[a556_0xbc23e1(0xce)]||(Object['create']?function(_0x165101,_0x5b5413,_0x1ca413,_0x1b55ee){const _0x1af967=a556_0xbc23e1;if(_0x1b55ee===undefined)_0x1b55ee=_0x1ca413;var _0x46725c=Object['getOwnPropertyDescriptor'](_0x5b5413,_0x1ca413);(!_0x46725c||(_0x1af967(0xc6)in _0x46725c?!_0x5b5413[_0x1af967(0xc2)]:_0x46725c[_0x1af967(0xc7)]||_0x46725c[_0x1af967(0xc3)]))&&(_0x46725c={'enumerable':!![],'get':function(){return _0x5b5413[_0x1ca413];}}),Object[_0x1af967(0xdc)](_0x165101,_0x1b55ee,_0x46725c);}:function(_0x9e2700,_0x18756c,_0x1a41ec,_0x2c78e8){if(_0x2c78e8===undefined)_0x2c78e8=_0x1a41ec;_0x9e2700[_0x2c78e8]=_0x18756c[_0x1a41ec];}),__setModuleDefault=this&&this[a556_0xbc23e1(0xbe)]||(Object[a556_0xbc23e1(0xe6)]?function(_0x5cd263,_0x1df751){const _0x468587=a556_0xbc23e1;Object[_0x468587(0xdc)](_0x5cd263,_0x468587(0xbf),{'enumerable':!![],'value':_0x1df751});}:function(_0x1bd937,_0x18733a){const _0x550e25=a556_0xbc23e1;_0x1bd937[_0x550e25(0xbf)]=_0x18733a;}),__importStar=this&&this[a556_0xbc23e1(0xc1)]||function(_0x369b25){const _0x487afc=a556_0xbc23e1;if(_0x369b25&&_0x369b25[_0x487afc(0xc2)])return _0x369b25;var _0xee6d3b={};if(_0x369b25!=null){for(var _0x3c925e in _0x369b25)if(_0x3c925e!=='default'&&Object[_0x487afc(0xcb)]['hasOwnProperty'][_0x487afc(0xc4)](_0x369b25,_0x3c925e))__createBinding(_0xee6d3b,_0x369b25,_0x3c925e);}return __setModuleDefault(_0xee6d3b,_0x369b25),_0xee6d3b;},__importDefault=this&&this['__importDefault']||function(_0x382308){const _0x43cc77=a556_0xbc23e1;return _0x382308&&_0x382308[_0x43cc77(0xc2)]?_0x382308:{'default':_0x382308};};Object['defineProperty'](exports,a556_0xbc23e1(0xc2),{'value':!![]});const Yup=__importStar(require('yup')),AppError_1=__importDefault(require(a556_0xbc23e1(0xde))),Whatsapp_1=__importDefault(require(a556_0xbc23e1(0xda))),Company_1=__importDefault(require('../../models/Company')),Plan_1=__importDefault(require(a556_0xbc23e1(0xdf))),AssociateWhatsappQueue_1=__importDefault(require('./AssociateWhatsappQueue')),CreateWhatsAppService=async({name:_0x461d08,status:status=a556_0xbc23e1(0xd5),queueIds:queueIds=[],greetingMessage:_0x4bc4ac,complationMessage:_0x1cd515,outOfHoursMessage:_0x166f4d,isDefault:isDefault=![],companyId:_0x405b22,token:token='',provider:provider=a556_0xbc23e1(0xd8),facebookUserId:_0x139bb7,facebookUserToken:_0x45b004,facebookPageUserId:_0x960f87,tokenMeta:_0x3112c7,channel:channel=a556_0xbc23e1(0xcc),maxUseBotQueues:_0x2a17da,timeUseBotQueues:_0x59295f,expiresTicket:_0x29b3b2,allowGroup:allowGroup=![],timeSendQueue:_0x5ab64d,sendIdQueue:_0x3aa5af,timeInactiveMessage:_0x23a976,inactiveMessage:_0x489c08,ratingMessage:_0x24188e,maxUseBotQueuesNPS:_0x55b384,expiresTicketNPS:_0x2be60d,whenExpiresTicket:_0x5b004e,expiresInactiveMessage:_0x81600,groupAsTicket:_0x357ceb,importOldMessages:_0x101604,importRecentMessages:_0x6bd57c,closedTicketsPostImported:_0x40f9b8,importOldMessagesGroups:_0x19753e,timeCreateNewTicket:_0x1f006e})=>{const _0x5a5268=a556_0xbc23e1,_0x86f1e8=await Company_1['default'][_0x5a5268(0xc8)]({'where':{'id':_0x405b22},'include':[{'model':Plan_1[_0x5a5268(0xbf)],'as':_0x5a5268(0xd9)}]});if(_0x86f1e8!==null){const _0x358db2=await Whatsapp_1[_0x5a5268(0xbf)][_0x5a5268(0xca)]({'where':{'companyId':_0x405b22,'channel':channel}});if(_0x358db2>=_0x86f1e8[_0x5a5268(0xd9)][_0x5a5268(0xd3)])throw new AppError_1[(_0x5a5268(0xbf))](_0x5a5268(0xc9)+_0x358db2);}const _0x30942e=Yup[_0x5a5268(0xcd)]()[_0x5a5268(0xbd)]({'name':Yup[_0x5a5268(0xd4)]()[_0x5a5268(0xd6)]()[_0x5a5268(0xdd)](0x2)['test'](_0x5a5268(0xcf),'Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão',async _0x9bd72e=>{const _0x4414b=_0x5a5268;if(!_0x9bd72e)return![];const _0x34dc64=await Whatsapp_1[_0x4414b(0xbf)][_0x4414b(0xc8)]({'where':{'name':_0x9bd72e,'channel':channel,'companyId':_0x405b22}});return!_0x34dc64;}),'isDefault':Yup['boolean']()['required']()});try{await _0x30942e[_0x5a5268(0xbc)]({'name':_0x461d08,'status':status,'isDefault':isDefault});}catch(_0x5e462d){throw new AppError_1['default'](_0x5e462d[_0x5a5268(0xc0)]);}const _0x34c545=await Whatsapp_1[_0x5a5268(0xbf)][_0x5a5268(0xc8)]({'where':{'companyId':_0x405b22}});isDefault=channel===_0x5a5268(0xcc)?!_0x34c545:![];let _0x29a637=null;channel==='whatsapp'&&isDefault&&(_0x29a637=await Whatsapp_1[_0x5a5268(0xbf)]['findOne']({'where':{'isDefault':!![],'companyId':_0x405b22,'channel':channel}}),_0x29a637&&await _0x29a637[_0x5a5268(0xe3)]({'isDefault':![],'companyId':_0x405b22}));if(queueIds['length']>0x1&&!_0x4bc4ac)throw new AppError_1['default'](_0x5a5268(0xe2));if(token!==null&&token!==''){const _0x1d38c5=Yup[_0x5a5268(0xcd)]()['shape']({'token':Yup[_0x5a5268(0xd4)]()[_0x5a5268(0xd6)]()['min'](0x2)[_0x5a5268(0xc5)]('Check-token',_0x5a5268(0xe4),async _0x20a881=>{const _0x1544db=_0x5a5268;if(!_0x20a881)return![];const _0x2b273f=await Whatsapp_1['default'][_0x1544db(0xc8)]({'where':{'token':_0x20a881,'channel':channel}});return!_0x2b273f;})});try{await _0x1d38c5[_0x5a5268(0xbc)]({'token':token});}catch(_0xadc060){throw new AppError_1['default'](_0xadc060['message']);}}const _0x362b0=await Whatsapp_1[_0x5a5268(0xbf)][_0x5a5268(0xe6)]({'name':_0x461d08,'status':status,'greetingMessage':_0x4bc4ac,'complationMessage':_0x1cd515,'outOfHoursMessage':_0x166f4d,'ratingMessage':_0x24188e,'isDefault':isDefault,'companyId':_0x405b22,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x139bb7,'facebookUserToken':_0x45b004,'facebookPageUserId':_0x960f87,'tokenMeta':_0x3112c7,'maxUseBotQueues':_0x2a17da,'timeUseBotQueues':_0x59295f,'expiresTicket':_0x29b3b2,'allowGroup':allowGroup,'timeSendQueue':_0x5ab64d,'sendIdQueue':_0x3aa5af,'timeInactiveMessage':_0x23a976,'inactiveMessage':_0x489c08,'maxUseBotQueuesNPS':_0x55b384,'expiresTicketNPS':_0x2be60d,'whenExpiresTicket':_0x5b004e,'expiresInactiveMessage':_0x81600,'groupAsTicket':_0x357ceb,'importOldMessages':_0x101604,'importRecentMessages':_0x6bd57c,'closedTicketsPostImported':_0x40f9b8,'importOldMessagesGroups':_0x19753e,'timeCreateNewTicket':_0x1f006e},{'include':[_0x5a5268(0xd7)]});return await(0x0,AssociateWhatsappQueue_1[_0x5a5268(0xbf)])(_0x362b0,queueIds),{'whatsapp':_0x362b0,'oldDefaultWhatsapp':_0x29a637};};exports[a556_0xbc23e1(0xbf)]=CreateWhatsAppService;function a556_0x5ba1(_0xb58e98,_0x35f1b2){const _0x3995d2=a556_0x3995();return a556_0x5ba1=function(_0x5ba107,_0x2cdb93){_0x5ba107=_0x5ba107-0xbb;let _0x231dd6=_0x3995d2[_0x5ba107];return _0x231dd6;},a556_0x5ba1(_0xb58e98,_0x35f1b2);}function a556_0x3995(){const _0x2e727b=['14128kYAkmI','validate','shape','__setModuleDefault','default','message','__importStar','__esModule','configurable','call','test','get','writable','findOne','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','count','prototype','whatsapp','object','__createBinding','Check-name','76224mUqGOq','299592FNIvyt','9495pWqLkb','connections','string','OPENING','required','queues','beta','plan','../../models/Whatsapp','777152UAGguW','defineProperty','min','../../errors/AppError','../../models/Plan','2484624dyTrDl','2517080SZYYdY','ERR_WAPP_GREETING_REQUIRED','update','This\x20whatsapp\x20token\x20is\x20already\x20used.','4988508Bflwdc','create','88lQqOGV'];a556_0x3995=function(){return _0x2e727b;};return a556_0x3995();}