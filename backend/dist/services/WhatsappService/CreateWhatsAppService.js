'use strict';const a618_0x41d1df=a618_0x481a;(function(_0x46548d,_0x5a0f1c){const _0x346f2d=a618_0x481a,_0x51ac7a=_0x46548d();while(!![]){try{const _0x4c21d2=-parseInt(_0x346f2d(0xc9))/0x1+parseInt(_0x346f2d(0xe4))/0x2+-parseInt(_0x346f2d(0xd1))/0x3+-parseInt(_0x346f2d(0xec))/0x4*(parseInt(_0x346f2d(0xe0))/0x5)+-parseInt(_0x346f2d(0xda))/0x6+parseInt(_0x346f2d(0xeb))/0x7+parseInt(_0x346f2d(0xc8))/0x8;if(_0x4c21d2===_0x5a0f1c)break;else _0x51ac7a['push'](_0x51ac7a['shift']());}catch(_0x5bece9){_0x51ac7a['push'](_0x51ac7a['shift']());}}}(a618_0x12b9,0xb14b7));function a618_0x481a(_0x411872,_0x41b9){const _0x12b9dd=a618_0x12b9();return a618_0x481a=function(_0x481a8b,_0x4a4eb2){_0x481a8b=_0x481a8b-0xbe;let _0x56d25f=_0x12b9dd[_0x481a8b];return _0x56d25f;},a618_0x481a(_0x411872,_0x41b9);}var __createBinding=this&&this[a618_0x41d1df(0xc4)]||(Object[a618_0x41d1df(0xd7)]?function(_0x18828a,_0x346d5e,_0x2f8131,_0x4a6858){const _0x4dfc78=a618_0x41d1df;if(_0x4a6858===undefined)_0x4a6858=_0x2f8131;var _0x35abda=Object[_0x4dfc78(0xcd)](_0x346d5e,_0x2f8131);(!_0x35abda||(_0x4dfc78(0xe2)in _0x35abda?!_0x346d5e[_0x4dfc78(0xd2)]:_0x35abda['writable']||_0x35abda[_0x4dfc78(0xdb)]))&&(_0x35abda={'enumerable':!![],'get':function(){return _0x346d5e[_0x2f8131];}}),Object[_0x4dfc78(0xd8)](_0x18828a,_0x4a6858,_0x35abda);}:function(_0x4f4ce4,_0x58e723,_0x175ed5,_0x3acbf6){if(_0x3acbf6===undefined)_0x3acbf6=_0x175ed5;_0x4f4ce4[_0x3acbf6]=_0x58e723[_0x175ed5];}),__setModuleDefault=this&&this[a618_0x41d1df(0xc5)]||(Object[a618_0x41d1df(0xd7)]?function(_0x5a7297,_0x486cff){const _0x44cf44=a618_0x41d1df;Object[_0x44cf44(0xd8)](_0x5a7297,_0x44cf44(0xc0),{'enumerable':!![],'value':_0x486cff});}:function(_0xf873ae,_0x21ef79){_0xf873ae['default']=_0x21ef79;}),__importStar=this&&this['__importStar']||function(_0xf604c1){const _0x56f873=a618_0x41d1df;if(_0xf604c1&&_0xf604c1[_0x56f873(0xd2)])return _0xf604c1;var _0x2fbfb8={};if(_0xf604c1!=null){for(var _0x276ad5 in _0xf604c1)if(_0x276ad5!==_0x56f873(0xc0)&&Object['prototype'][_0x56f873(0xd3)][_0x56f873(0xe6)](_0xf604c1,_0x276ad5))__createBinding(_0x2fbfb8,_0xf604c1,_0x276ad5);}return __setModuleDefault(_0x2fbfb8,_0xf604c1),_0x2fbfb8;},__importDefault=this&&this[a618_0x41d1df(0xc3)]||function(_0x1c7ebe){return _0x1c7ebe&&_0x1c7ebe['__esModule']?_0x1c7ebe:{'default':_0x1c7ebe};};Object['defineProperty'](exports,a618_0x41d1df(0xd2),{'value':!![]});const Yup=__importStar(require(a618_0x41d1df(0xbe))),AppError_1=__importDefault(require(a618_0x41d1df(0xc7))),Whatsapp_1=__importDefault(require(a618_0x41d1df(0xd6))),Company_1=__importDefault(require(a618_0x41d1df(0xc2))),Plan_1=__importDefault(require('../../models/Plan')),AssociateWhatsappQueue_1=__importDefault(require(a618_0x41d1df(0xdd))),CreateWhatsAppService=async({name:_0x4b7c7c,status:status=a618_0x41d1df(0xd0),queueIds:queueIds=[],greetingMessage:_0x332f8a,complationMessage:_0x2c951f,outOfHoursMessage:_0x467901,isDefault:isDefault=![],companyId:_0x2e3c5e,token:token='',provider:provider='beta',facebookUserId:_0x58f29b,facebookUserToken:_0x33646e,facebookPageUserId:_0x2dad3b,tokenMeta:_0x1ec588,channel:channel=a618_0x41d1df(0xcb),maxUseBotQueues:_0x3a48f8,timeUseBotQueues:_0x2ababf,expiresTicket:_0xbaabad,allowGroup:allowGroup=![],timeSendQueue:_0xa42486,sendIdQueue:_0x4d8d67,timeInactiveMessage:_0x4e33ce,inactiveMessage:_0x1fa99c,ratingMessage:_0x577d30,maxUseBotQueuesNPS:_0x406724,expiresTicketNPS:_0xa41a70,whenExpiresTicket:_0x126d55,expiresInactiveMessage:_0x2afc7e,groupAsTicket:_0x12086a,importOldMessages:_0xc8d1dc,importRecentMessages:_0xaccf6f,closedTicketsPostImported:_0x2a9a91,importOldMessagesGroups:_0x26e764,timeCreateNewTicket:_0x58b878,integrationId:_0x25e9e0,schedules:_0x5784ea,promptId:_0x57a017})=>{const _0xd7c5c0=a618_0x41d1df,_0x5481fc=await Company_1[_0xd7c5c0(0xc0)][_0xd7c5c0(0xe8)]({'where':{'id':_0x2e3c5e},'include':[{'model':Plan_1[_0xd7c5c0(0xc0)],'as':'plan'}]});if(_0x5481fc!==null){const _0x1e2b10=await Whatsapp_1[_0xd7c5c0(0xc0)][_0xd7c5c0(0xcc)]({'where':{'companyId':_0x2e3c5e,'channel':channel}});if(_0x1e2b10>=_0x5481fc[_0xd7c5c0(0xc1)]['connections'])throw new AppError_1[(_0xd7c5c0(0xc0))](_0xd7c5c0(0xcf)+_0x1e2b10);}const _0x2ca897=Yup['object']()[_0xd7c5c0(0xe7)]({'name':Yup[_0xd7c5c0(0xe1)]()['required']()[_0xd7c5c0(0xd9)](0x2)['test'](_0xd7c5c0(0xdf),_0xd7c5c0(0xe9),async _0x18a88c=>{const _0x5b41f5=_0xd7c5c0;if(!_0x18a88c)return![];const _0x347eaa=await Whatsapp_1['default'][_0x5b41f5(0xe8)]({'where':{'name':_0x18a88c,'channel':channel,'companyId':_0x2e3c5e}});return!_0x347eaa;}),'isDefault':Yup[_0xd7c5c0(0xde)]()[_0xd7c5c0(0xc6)]()});try{await _0x2ca897[_0xd7c5c0(0xca)]({'name':_0x4b7c7c,'status':status,'isDefault':isDefault});}catch(_0x20fa6f){throw new AppError_1[(_0xd7c5c0(0xc0))](_0x20fa6f[_0xd7c5c0(0xdc)]);}const _0x5595f1=await Whatsapp_1['default'][_0xd7c5c0(0xe8)]({'where':{'companyId':_0x2e3c5e}});isDefault=channel===_0xd7c5c0(0xcb)?!_0x5595f1:![];let _0x33d815=null;channel==='whatsapp'&&isDefault&&(_0x33d815=await Whatsapp_1[_0xd7c5c0(0xc0)]['findOne']({'where':{'isDefault':!![],'companyId':_0x2e3c5e,'channel':channel}}),_0x33d815&&await _0x33d815[_0xd7c5c0(0xe3)]({'isDefault':![],'companyId':_0x2e3c5e}));if(queueIds[_0xd7c5c0(0xd4)]>0x1&&!_0x332f8a)throw new AppError_1[(_0xd7c5c0(0xc0))](_0xd7c5c0(0xbf));if(token!==null&&token!==''){const _0x32a691=Yup[_0xd7c5c0(0xd5)]()['shape']({'token':Yup['string']()[_0xd7c5c0(0xc6)]()[_0xd7c5c0(0xd9)](0x2)[_0xd7c5c0(0xe5)](_0xd7c5c0(0xea),_0xd7c5c0(0xce),async _0x1f87cd=>{const _0x4ef3fc=_0xd7c5c0;if(!_0x1f87cd)return![];const _0x176dde=await Whatsapp_1[_0x4ef3fc(0xc0)][_0x4ef3fc(0xe8)]({'where':{'token':_0x1f87cd,'channel':channel}});return!_0x176dde;})});try{await _0x32a691[_0xd7c5c0(0xca)]({'token':token});}catch(_0x32289b){throw new AppError_1['default'](_0x32289b[_0xd7c5c0(0xdc)]);}}const _0x4378ba=await Whatsapp_1[_0xd7c5c0(0xc0)][_0xd7c5c0(0xd7)]({'name':_0x4b7c7c,'status':status,'greetingMessage':_0x332f8a,'complationMessage':_0x2c951f,'outOfHoursMessage':_0x467901,'ratingMessage':_0x577d30,'isDefault':isDefault,'companyId':_0x2e3c5e,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x58f29b,'facebookUserToken':_0x33646e,'facebookPageUserId':_0x2dad3b,'tokenMeta':_0x1ec588,'maxUseBotQueues':_0x3a48f8,'timeUseBotQueues':_0x2ababf,'expiresTicket':_0xbaabad,'allowGroup':allowGroup,'timeSendQueue':_0xa42486,'sendIdQueue':_0x4d8d67,'timeInactiveMessage':_0x4e33ce,'inactiveMessage':_0x1fa99c,'maxUseBotQueuesNPS':_0x406724,'expiresTicketNPS':_0xa41a70,'whenExpiresTicket':_0x126d55,'expiresInactiveMessage':_0x2afc7e,'groupAsTicket':_0x12086a,'importOldMessages':_0xc8d1dc,'importRecentMessages':_0xaccf6f,'closedTicketsPostImported':_0x2a9a91,'importOldMessagesGroups':_0x26e764,'timeCreateNewTicket':_0x58b878,'integrationId':_0x25e9e0,'schedules':_0x5784ea,'promptId':_0x57a017},{'include':['queues']});return await(0x0,AssociateWhatsappQueue_1[_0xd7c5c0(0xc0)])(_0x4378ba,queueIds),{'whatsapp':_0x4378ba,'oldDefaultWhatsapp':_0x33d815};};exports[a618_0x41d1df(0xc0)]=CreateWhatsAppService;function a618_0x12b9(){const _0x1828a0=['create','defineProperty','min','3838866GXfAXY','configurable','message','./AssociateWhatsappQueue','boolean','Check-name','3797870xAwEfu','string','get','update','2499426NhwKzf','test','call','shape','findOne','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','Check-token','7431123FAPALi','4PQXlHv','yup','ERR_WAPP_GREETING_REQUIRED','default','plan','../../models/Company','__importDefault','__createBinding','__setModuleDefault','required','../../errors/AppError','12864408YZxzoL','1266275GUoChm','validate','whatsapp','count','getOwnPropertyDescriptor','This\x20whatsapp\x20token\x20is\x20already\x20used.','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','OPENING','1582482XOigYy','__esModule','hasOwnProperty','length','object','../../models/Whatsapp'];a618_0x12b9=function(){return _0x1828a0;};return a618_0x12b9();}