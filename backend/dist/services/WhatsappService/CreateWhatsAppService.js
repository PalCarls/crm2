'use strict';const a618_0xb7e1cb=a618_0x19a3;(function(_0x546392,_0x3de81e){const _0x1454ff=a618_0x19a3,_0x5bec8b=_0x546392();while(!![]){try{const _0x1dcd19=-parseInt(_0x1454ff(0x150))/0x1*(parseInt(_0x1454ff(0x14e))/0x2)+parseInt(_0x1454ff(0x14a))/0x3+parseInt(_0x1454ff(0x174))/0x4+parseInt(_0x1454ff(0x153))/0x5*(-parseInt(_0x1454ff(0x155))/0x6)+-parseInt(_0x1454ff(0x164))/0x7*(parseInt(_0x1454ff(0x178))/0x8)+parseInt(_0x1454ff(0x172))/0x9*(parseInt(_0x1454ff(0x15a))/0xa)+parseInt(_0x1454ff(0x169))/0xb;if(_0x1dcd19===_0x3de81e)break;else _0x5bec8b['push'](_0x5bec8b['shift']());}catch(_0x546f14){_0x5bec8b['push'](_0x5bec8b['shift']());}}}(a618_0x47cc,0x2704f));function a618_0x47cc(){const _0x4af0f4=['7czlnvS','get','beta','findOne','validate','3871648dIDgQk','../../models/Whatsapp','length','update','plan','object','OPENING','connections','default','24210XbedFy','../../errors/AppError','460548sFGcLw','string','yup','create','1223080jnvReV','min','./AssociateWhatsappQueue','queues','shape','377616yuNRUo','This\x20whatsapp\x20token\x20is\x20already\x20used.','count','Check-name','94PhdRwy','../../models/Company','2704KDBjdQ','Check-token','__esModule','5PNSZBi','__importStar','935226OZTbcQ','__importDefault','test','getOwnPropertyDescriptor','message','10GWnHBJ','writable','required','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','__setModuleDefault','defineProperty','whatsapp','__createBinding','ERR_WAPP_GREETING_REQUIRED','../../models/Plan'];a618_0x47cc=function(){return _0x4af0f4;};return a618_0x47cc();}var __createBinding=this&&this[a618_0xb7e1cb(0x161)]||(Object[a618_0xb7e1cb(0x177)]?function(_0x46d152,_0x3fa1b5,_0x23c33a,_0xa7a7b7){const _0x1a6247=a618_0xb7e1cb;if(_0xa7a7b7===undefined)_0xa7a7b7=_0x23c33a;var _0x4c4eb5=Object[_0x1a6247(0x158)](_0x3fa1b5,_0x23c33a);(!_0x4c4eb5||(_0x1a6247(0x165)in _0x4c4eb5?!_0x3fa1b5['__esModule']:_0x4c4eb5[_0x1a6247(0x15b)]||_0x4c4eb5['configurable']))&&(_0x4c4eb5={'enumerable':!![],'get':function(){return _0x3fa1b5[_0x23c33a];}}),Object['defineProperty'](_0x46d152,_0xa7a7b7,_0x4c4eb5);}:function(_0x52cfb4,_0x4bddfd,_0x14d5d6,_0x42579a){if(_0x42579a===undefined)_0x42579a=_0x14d5d6;_0x52cfb4[_0x42579a]=_0x4bddfd[_0x14d5d6];}),__setModuleDefault=this&&this[a618_0xb7e1cb(0x15e)]||(Object[a618_0xb7e1cb(0x177)]?function(_0x38a8a9,_0x2a570b){const _0x2579cc=a618_0xb7e1cb;Object['defineProperty'](_0x38a8a9,_0x2579cc(0x171),{'enumerable':!![],'value':_0x2a570b});}:function(_0x3bbcbe,_0x389404){const _0x4a9194=a618_0xb7e1cb;_0x3bbcbe[_0x4a9194(0x171)]=_0x389404;}),__importStar=this&&this[a618_0xb7e1cb(0x154)]||function(_0x41ee65){const _0x32a1eb=a618_0xb7e1cb;if(_0x41ee65&&_0x41ee65[_0x32a1eb(0x152)])return _0x41ee65;var _0x4f6c04={};if(_0x41ee65!=null){for(var _0x40e70b in _0x41ee65)if(_0x40e70b!==_0x32a1eb(0x171)&&Object['prototype']['hasOwnProperty']['call'](_0x41ee65,_0x40e70b))__createBinding(_0x4f6c04,_0x41ee65,_0x40e70b);}return __setModuleDefault(_0x4f6c04,_0x41ee65),_0x4f6c04;},__importDefault=this&&this[a618_0xb7e1cb(0x156)]||function(_0x3b1bd1){const _0x3b63cf=a618_0xb7e1cb;return _0x3b1bd1&&_0x3b1bd1[_0x3b63cf(0x152)]?_0x3b1bd1:{'default':_0x3b1bd1};};Object[a618_0xb7e1cb(0x15f)](exports,a618_0xb7e1cb(0x152),{'value':!![]});function a618_0x19a3(_0x7575ed,_0x1c551d){const _0x47cc80=a618_0x47cc();return a618_0x19a3=function(_0x19a39c,_0x2492f7){_0x19a39c=_0x19a39c-0x14a;let _0x53c252=_0x47cc80[_0x19a39c];return _0x53c252;},a618_0x19a3(_0x7575ed,_0x1c551d);}const Yup=__importStar(require(a618_0xb7e1cb(0x176))),AppError_1=__importDefault(require(a618_0xb7e1cb(0x173))),Whatsapp_1=__importDefault(require(a618_0xb7e1cb(0x16a))),Company_1=__importDefault(require(a618_0xb7e1cb(0x14f))),Plan_1=__importDefault(require(a618_0xb7e1cb(0x163))),AssociateWhatsappQueue_1=__importDefault(require(a618_0xb7e1cb(0x17a))),CreateWhatsAppService=async({name:_0x5ee733,status:status=a618_0xb7e1cb(0x16f),queueIds:queueIds=[],greetingMessage:_0x351473,complationMessage:_0x4a7e38,outOfHoursMessage:_0x41592b,isDefault:isDefault=![],companyId:_0xc135cc,token:token='',provider:provider=a618_0xb7e1cb(0x166),facebookUserId:_0x45fe67,facebookUserToken:_0x2e1134,facebookPageUserId:_0x263a40,tokenMeta:_0x3f75b8,channel:channel=a618_0xb7e1cb(0x160),maxUseBotQueues:_0x6a0907,timeUseBotQueues:_0xc61ad9,expiresTicket:_0x180abf,allowGroup:allowGroup=![],timeSendQueue:_0xc9a95c,sendIdQueue:_0x3786de,timeInactiveMessage:_0x35f525,inactiveMessage:_0x55777a,ratingMessage:_0x167059,maxUseBotQueuesNPS:_0x4fb075,expiresTicketNPS:_0x47f98c,whenExpiresTicket:_0x52f471,expiresInactiveMessage:_0x2c3ec5,groupAsTicket:_0x3c232d,importOldMessages:_0x1b1402,importRecentMessages:_0x583c66,closedTicketsPostImported:_0x13089f,importOldMessagesGroups:_0x56ee98,timeCreateNewTicket:_0xf3cafe,integrationId:_0x10c1e8,schedules:_0x2d045b,promptId:_0x286fae})=>{const _0x39d0e1=a618_0xb7e1cb,_0x246a92=await Company_1['default'][_0x39d0e1(0x167)]({'where':{'id':_0xc135cc},'include':[{'model':Plan_1[_0x39d0e1(0x171)],'as':_0x39d0e1(0x16d)}]});if(_0x246a92!==null){const _0x4b76f7=await Whatsapp_1[_0x39d0e1(0x171)][_0x39d0e1(0x14c)]({'where':{'companyId':_0xc135cc,'channel':channel}});if(_0x4b76f7>=_0x246a92[_0x39d0e1(0x16d)][_0x39d0e1(0x170)])throw new AppError_1[(_0x39d0e1(0x171))]('Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20'+_0x4b76f7);}const _0x2ea851=Yup[_0x39d0e1(0x16e)]()[_0x39d0e1(0x17c)]({'name':Yup[_0x39d0e1(0x175)]()[_0x39d0e1(0x15c)]()[_0x39d0e1(0x179)](0x2)[_0x39d0e1(0x157)](_0x39d0e1(0x14d),_0x39d0e1(0x15d),async _0x9f37e8=>{const _0x283200=_0x39d0e1;if(!_0x9f37e8)return![];const _0x5dfafc=await Whatsapp_1[_0x283200(0x171)][_0x283200(0x167)]({'where':{'name':_0x9f37e8,'channel':channel,'companyId':_0xc135cc}});return!_0x5dfafc;}),'isDefault':Yup['boolean']()['required']()});try{await _0x2ea851[_0x39d0e1(0x168)]({'name':_0x5ee733,'status':status,'isDefault':isDefault});}catch(_0x5438c0){throw new AppError_1[(_0x39d0e1(0x171))](_0x5438c0[_0x39d0e1(0x159)]);}const _0x51dcee=await Whatsapp_1[_0x39d0e1(0x171)][_0x39d0e1(0x167)]({'where':{'companyId':_0xc135cc}});isDefault=channel===_0x39d0e1(0x160)?!_0x51dcee:![];let _0x2edcd1=null;channel===_0x39d0e1(0x160)&&isDefault&&(_0x2edcd1=await Whatsapp_1['default'][_0x39d0e1(0x167)]({'where':{'isDefault':!![],'companyId':_0xc135cc,'channel':channel}}),_0x2edcd1&&await _0x2edcd1[_0x39d0e1(0x16c)]({'isDefault':![],'companyId':_0xc135cc}));if(queueIds[_0x39d0e1(0x16b)]>0x1&&!_0x351473)throw new AppError_1[(_0x39d0e1(0x171))](_0x39d0e1(0x162));if(token!==null&&token!==''){const _0x7fb3f7=Yup[_0x39d0e1(0x16e)]()[_0x39d0e1(0x17c)]({'token':Yup[_0x39d0e1(0x175)]()['required']()[_0x39d0e1(0x179)](0x2)[_0x39d0e1(0x157)](_0x39d0e1(0x151),_0x39d0e1(0x14b),async _0x4b304f=>{const _0x5c0956=_0x39d0e1;if(!_0x4b304f)return![];const _0x2e4bab=await Whatsapp_1[_0x5c0956(0x171)][_0x5c0956(0x167)]({'where':{'token':_0x4b304f,'channel':channel}});return!_0x2e4bab;})});try{await _0x7fb3f7['validate']({'token':token});}catch(_0x113a8f){throw new AppError_1[(_0x39d0e1(0x171))](_0x113a8f[_0x39d0e1(0x159)]);}}const _0x27c720=await Whatsapp_1[_0x39d0e1(0x171)][_0x39d0e1(0x177)]({'name':_0x5ee733,'status':status,'greetingMessage':_0x351473,'complationMessage':_0x4a7e38,'outOfHoursMessage':_0x41592b,'ratingMessage':_0x167059,'isDefault':isDefault,'companyId':_0xc135cc,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x45fe67,'facebookUserToken':_0x2e1134,'facebookPageUserId':_0x263a40,'tokenMeta':_0x3f75b8,'maxUseBotQueues':_0x6a0907,'timeUseBotQueues':_0xc61ad9,'expiresTicket':_0x180abf,'allowGroup':allowGroup,'timeSendQueue':_0xc9a95c,'sendIdQueue':_0x3786de,'timeInactiveMessage':_0x35f525,'inactiveMessage':_0x55777a,'maxUseBotQueuesNPS':_0x4fb075,'expiresTicketNPS':_0x47f98c,'whenExpiresTicket':_0x52f471,'expiresInactiveMessage':_0x2c3ec5,'groupAsTicket':_0x3c232d,'importOldMessages':_0x1b1402,'importRecentMessages':_0x583c66,'closedTicketsPostImported':_0x13089f,'importOldMessagesGroups':_0x56ee98,'timeCreateNewTicket':_0xf3cafe,'integrationId':_0x10c1e8,'schedules':_0x2d045b,'promptId':_0x286fae},{'include':[_0x39d0e1(0x17b)]});return await(0x0,AssociateWhatsappQueue_1[_0x39d0e1(0x171)])(_0x27c720,queueIds),{'whatsapp':_0x27c720,'oldDefaultWhatsapp':_0x2edcd1};};exports[a618_0xb7e1cb(0x171)]=CreateWhatsAppService;