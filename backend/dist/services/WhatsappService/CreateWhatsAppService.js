'use strict';const a572_0x501efb=a572_0x1470;(function(_0x5d0eeb,_0x15fdac){const _0x598a6e=a572_0x1470,_0x2cff9b=_0x5d0eeb();while(!![]){try{const _0x195ca8=-parseInt(_0x598a6e(0xee))/0x1+-parseInt(_0x598a6e(0x10b))/0x2+parseInt(_0x598a6e(0x10a))/0x3*(-parseInt(_0x598a6e(0x10c))/0x4)+parseInt(_0x598a6e(0xe4))/0x5*(-parseInt(_0x598a6e(0xe9))/0x6)+-parseInt(_0x598a6e(0xeb))/0x7*(-parseInt(_0x598a6e(0xf8))/0x8)+-parseInt(_0x598a6e(0xec))/0x9*(-parseInt(_0x598a6e(0xe2))/0xa)+parseInt(_0x598a6e(0x108))/0xb;if(_0x195ca8===_0x15fdac)break;else _0x2cff9b['push'](_0x2cff9b['shift']());}catch(_0xcf41d6){_0x2cff9b['push'](_0x2cff9b['shift']());}}}(a572_0x526b,0x1fb1e));var __createBinding=this&&this['__createBinding']||(Object[a572_0x501efb(0xf1)]?function(_0x140106,_0x459e80,_0x40aada,_0x23f26f){const _0x5cf953=a572_0x501efb;if(_0x23f26f===undefined)_0x23f26f=_0x40aada;var _0x50c63b=Object[_0x5cf953(0xfe)](_0x459e80,_0x40aada);(!_0x50c63b||('get'in _0x50c63b?!_0x459e80['__esModule']:_0x50c63b[_0x5cf953(0xfc)]||_0x50c63b['configurable']))&&(_0x50c63b={'enumerable':!![],'get':function(){return _0x459e80[_0x40aada];}}),Object[_0x5cf953(0xff)](_0x140106,_0x23f26f,_0x50c63b);}:function(_0x1e39e2,_0x49e953,_0x4a6dae,_0xa5b57f){if(_0xa5b57f===undefined)_0xa5b57f=_0x4a6dae;_0x1e39e2[_0xa5b57f]=_0x49e953[_0x4a6dae];}),__setModuleDefault=this&&this[a572_0x501efb(0xf5)]||(Object[a572_0x501efb(0xf1)]?function(_0x453124,_0x39cf55){const _0x327d60=a572_0x501efb;Object[_0x327d60(0xff)](_0x453124,_0x327d60(0x105),{'enumerable':!![],'value':_0x39cf55});}:function(_0x42df97,_0x333370){_0x42df97['default']=_0x333370;}),__importStar=this&&this['__importStar']||function(_0xf79489){const _0x1c21e0=a572_0x501efb;if(_0xf79489&&_0xf79489[_0x1c21e0(0xed)])return _0xf79489;var _0x267cc4={};if(_0xf79489!=null){for(var _0x1f2b3 in _0xf79489)if(_0x1f2b3!==_0x1c21e0(0x105)&&Object[_0x1c21e0(0x10d)][_0x1c21e0(0xf6)][_0x1c21e0(0x109)](_0xf79489,_0x1f2b3))__createBinding(_0x267cc4,_0xf79489,_0x1f2b3);}return __setModuleDefault(_0x267cc4,_0xf79489),_0x267cc4;},__importDefault=this&&this['__importDefault']||function(_0x55e3ef){return _0x55e3ef&&_0x55e3ef['__esModule']?_0x55e3ef:{'default':_0x55e3ef};};Object[a572_0x501efb(0xff)](exports,a572_0x501efb(0xed),{'value':!![]});function a572_0x526b(){const _0x2824d7=['363216veGRoT','11788nnzrOc','prototype','../../models/Company','update','../../models/Whatsapp','41580nqOTQw','min','25rmPhtC','whatsapp','plan','../../errors/AppError','findOne','211998PcJRPt','test','5642rvmIZW','99EQmpKg','__esModule','124407vKEVcQ','length','ERR_WAPP_GREETING_REQUIRED','create','./AssociateWhatsappQueue','object','Check-name','__setModuleDefault','hasOwnProperty','shape','200QXWguP','connections','queues','yup','writable','string','getOwnPropertyDescriptor','defineProperty','This\x20whatsapp\x20token\x20is\x20already\x20used.','required','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','Check-token','default','message','validate','7114932FtjrKX','call','102QxGTyq'];a572_0x526b=function(){return _0x2824d7;};return a572_0x526b();}const Yup=__importStar(require(a572_0x501efb(0xfb))),AppError_1=__importDefault(require(a572_0x501efb(0xe7))),Whatsapp_1=__importDefault(require(a572_0x501efb(0xe1))),Company_1=__importDefault(require(a572_0x501efb(0x10e))),Plan_1=__importDefault(require('../../models/Plan')),AssociateWhatsappQueue_1=__importDefault(require(a572_0x501efb(0xf2))),CreateWhatsAppService=async({name:_0x568048,status:status='OPENING',queueIds:queueIds=[],greetingMessage:_0x3eb2b4,complationMessage:_0x9c2136,outOfHoursMessage:_0x4cfaf0,isDefault:isDefault=![],companyId:_0x32fbff,token:token='',provider:provider='beta',facebookUserId:_0x566e88,facebookUserToken:_0x56b4a5,facebookPageUserId:_0x4ba43b,tokenMeta:_0x48f2eb,channel:channel='whatsapp',maxUseBotQueues:_0x243dbc,timeUseBotQueues:_0xe106d3,expiresTicket:_0xbf8323,allowGroup:allowGroup=![],timeSendQueue:_0x292e76,sendIdQueue:_0x581f61,timeInactiveMessage:_0x48cde0,inactiveMessage:_0x5b1269,ratingMessage:_0x1a83e6,maxUseBotQueuesNPS:_0x44fc0d,expiresTicketNPS:_0x378b20,whenExpiresTicket:_0x381ae1,expiresInactiveMessage:_0xfa16e6,groupAsTicket:_0x22740a,importOldMessages:_0x30cd70,importRecentMessages:_0x2dc3e0,closedTicketsPostImported:_0x2e17fe,importOldMessagesGroups:_0x1139e8,timeCreateNewTicket:_0x50a4da})=>{const _0x36898f=a572_0x501efb,_0x362108=await Company_1['default'][_0x36898f(0xe8)]({'where':{'id':_0x32fbff},'include':[{'model':Plan_1[_0x36898f(0x105)],'as':_0x36898f(0xe6)}]});if(_0x362108!==null){const _0x3deb8b=await Whatsapp_1[_0x36898f(0x105)]['count']({'where':{'companyId':_0x32fbff,'channel':channel}});if(_0x3deb8b>=_0x362108[_0x36898f(0xe6)][_0x36898f(0xf9)])throw new AppError_1[(_0x36898f(0x105))](_0x36898f(0x102)+_0x3deb8b);}const _0x57ce10=Yup['object']()['shape']({'name':Yup[_0x36898f(0xfd)]()[_0x36898f(0x101)]()[_0x36898f(0xe3)](0x2)[_0x36898f(0xea)](_0x36898f(0xf4),_0x36898f(0x103),async _0x491ea3=>{if(!_0x491ea3)return![];const _0x2d1e49=await Whatsapp_1['default']['findOne']({'where':{'name':_0x491ea3,'channel':channel,'companyId':_0x32fbff}});return!_0x2d1e49;}),'isDefault':Yup['boolean']()[_0x36898f(0x101)]()});try{await _0x57ce10[_0x36898f(0x107)]({'name':_0x568048,'status':status,'isDefault':isDefault});}catch(_0x45affc){throw new AppError_1[(_0x36898f(0x105))](_0x45affc[_0x36898f(0x106)]);}const _0x54419d=await Whatsapp_1[_0x36898f(0x105)]['findOne']({'where':{'companyId':_0x32fbff}});isDefault=channel===_0x36898f(0xe5)?!_0x54419d:![];let _0x863945=null;channel===_0x36898f(0xe5)&&isDefault&&(_0x863945=await Whatsapp_1[_0x36898f(0x105)][_0x36898f(0xe8)]({'where':{'isDefault':!![],'companyId':_0x32fbff,'channel':channel}}),_0x863945&&await _0x863945[_0x36898f(0xe0)]({'isDefault':![],'companyId':_0x32fbff}));if(queueIds[_0x36898f(0xef)]>0x1&&!_0x3eb2b4)throw new AppError_1[(_0x36898f(0x105))](_0x36898f(0xf0));if(token!==null&&token!==''){const _0x5b38e0=Yup[_0x36898f(0xf3)]()[_0x36898f(0xf7)]({'token':Yup[_0x36898f(0xfd)]()[_0x36898f(0x101)]()[_0x36898f(0xe3)](0x2)['test'](_0x36898f(0x104),_0x36898f(0x100),async _0x46955e=>{const _0x510475=_0x36898f;if(!_0x46955e)return![];const _0x3353bb=await Whatsapp_1[_0x510475(0x105)][_0x510475(0xe8)]({'where':{'token':_0x46955e,'channel':channel}});return!_0x3353bb;})});try{await _0x5b38e0[_0x36898f(0x107)]({'token':token});}catch(_0x330a80){throw new AppError_1[(_0x36898f(0x105))](_0x330a80['message']);}}const _0x31134e=await Whatsapp_1['default'][_0x36898f(0xf1)]({'name':_0x568048,'status':status,'greetingMessage':_0x3eb2b4,'complationMessage':_0x9c2136,'outOfHoursMessage':_0x4cfaf0,'ratingMessage':_0x1a83e6,'isDefault':isDefault,'companyId':_0x32fbff,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x566e88,'facebookUserToken':_0x56b4a5,'facebookPageUserId':_0x4ba43b,'tokenMeta':_0x48f2eb,'maxUseBotQueues':_0x243dbc,'timeUseBotQueues':_0xe106d3,'expiresTicket':_0xbf8323,'allowGroup':allowGroup,'timeSendQueue':_0x292e76,'sendIdQueue':_0x581f61,'timeInactiveMessage':_0x48cde0,'inactiveMessage':_0x5b1269,'maxUseBotQueuesNPS':_0x44fc0d,'expiresTicketNPS':_0x378b20,'whenExpiresTicket':_0x381ae1,'expiresInactiveMessage':_0xfa16e6,'groupAsTicket':_0x22740a,'importOldMessages':_0x30cd70,'importRecentMessages':_0x2dc3e0,'closedTicketsPostImported':_0x2e17fe,'importOldMessagesGroups':_0x1139e8,'timeCreateNewTicket':_0x50a4da},{'include':[_0x36898f(0xfa)]});return await(0x0,AssociateWhatsappQueue_1[_0x36898f(0x105)])(_0x31134e,queueIds),{'whatsapp':_0x31134e,'oldDefaultWhatsapp':_0x863945};};function a572_0x1470(_0x26a30b,_0x1b45e3){const _0x526bba=a572_0x526b();return a572_0x1470=function(_0x1470b7,_0x116a8f){_0x1470b7=_0x1470b7-0xe0;let _0x1f7eca=_0x526bba[_0x1470b7];return _0x1f7eca;},a572_0x1470(_0x26a30b,_0x1b45e3);}exports[a572_0x501efb(0x105)]=CreateWhatsAppService;