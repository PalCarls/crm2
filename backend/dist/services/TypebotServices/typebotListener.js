'use strict';const a601_0x41370d=a601_0x5179;(function(_0x5b3f63,_0x257463){const _0x3c0ce9=a601_0x5179,_0x4d90b3=_0x5b3f63();while(!![]){try{const _0x204b7e=parseInt(_0x3c0ce9(0xdb))/0x1+parseInt(_0x3c0ce9(0xdc))/0x2+-parseInt(_0x3c0ce9(0xcd))/0x3*(parseInt(_0x3c0ce9(0xfa))/0x4)+-parseInt(_0x3c0ce9(0xf2))/0x5+parseInt(_0x3c0ce9(0xee))/0x6*(parseInt(_0x3c0ce9(0xf5))/0x7)+parseInt(_0x3c0ce9(0xcb))/0x8+-parseInt(_0x3c0ce9(0xc4))/0x9;if(_0x204b7e===_0x257463)break;else _0x4d90b3['push'](_0x4d90b3['shift']());}catch(_0x53039b){_0x4d90b3['push'](_0x4d90b3['shift']());}}}(a601_0x218a,0xbd2f3));var __importDefault=this&&this['__importDefault']||function(_0x58f536){return _0x58f536&&_0x58f536['__esModule']?_0x58f536:{'default':_0x58f536};};function a601_0x218a(){const _0x55d015=['../../utils/logger','replace','default','public','underline','error','12OEUwAc','isNil','filename','richText','1102295dUxWxx','getBodyMessage','key','5410517mjxevn','post','info','typebotSessionId','Error\x20on\x20typebotListener:\x20','20TMvhKb','content','lodash','19969308EdXmIH','bold','pushName','defineProperty','text','length','messages','9010520kKUlGn','companyId','396141NdViiT','urlN8N','reload','@c.us','downloadMedia','log','Erro\x20ao\x20processar\x20mensagem\x20de\x20midia\x20no\x20typebot:\x20','axios','logger','floor','typebotKeywordFinish','sendMessage','random','path','371777UvLAPm','1660902SXhzmD','getMessageOptions','remoteJid','company','../WbotServices/wbotMessageListener','toString','data','__esModule','typebotSlug','children','resolve','update'];a601_0x218a=function(){return _0x55d015;};return a601_0x218a();}Object[a601_0x41370d(0xc7)](exports,a601_0x41370d(0xe3),{'value':!![]});function a601_0x5179(_0x27b096,_0x2c9a55){const _0x218a0a=a601_0x218a();return a601_0x5179=function(_0x5179b1,_0x47c771){_0x5179b1=_0x5179b1-0xc2;let _0x2de3ff=_0x218a0a[_0x5179b1];return _0x2de3ff;},a601_0x5179(_0x27b096,_0x2c9a55);}const path_1=__importDefault(require(a601_0x41370d(0xda))),axios_1=__importDefault(require(a601_0x41370d(0xd4))),wbotMessageListener_1=require(a601_0x41370d(0xe0)),SendWhatsAppMedia_1=require('../WbotServices/SendWhatsAppMedia'),logger_1=require(a601_0x41370d(0xe8)),lodash_1=require(a601_0x41370d(0xc3)),publicFolder=path_1[a601_0x41370d(0xea)]['resolve'](__dirname,'..','..','..',a601_0x41370d(0xeb));async function createSession(_0x33e4f6,_0x4427a2,_0x229543){const _0x2d0fe1=a601_0x41370d;try{const _0xdc25d=Math[_0x2d0fe1(0xd6)](Math[_0x2d0fe1(0xd9)]()*0x2540be400)[_0x2d0fe1(0xe1)](),_0x3d62ae={'sessionId':_0x33e4f6[_0x2d0fe1(0xf4)][_0x2d0fe1(0xde)],'startParams':{'typebot':_0x4427a2[_0x2d0fe1(0xe4)],'prefilledVariables':{'number':_0x229543,'name':_0x33e4f6[_0x2d0fe1(0xf4)][_0x2d0fe1(0xc6)]}}},_0xfd8c4f=await axios_1[_0x2d0fe1(0xea)][_0x2d0fe1(0xf6)](_0x4427a2[_0x2d0fe1(0xce)],_0x3d62ae),_0x19b06a=''+_0xfd8c4f['data']['sessionId'];return _0x19b06a;}catch(_0x500db2){logger_1[_0x2d0fe1(0xd5)][_0x2d0fe1(0xf7)]('Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:\x20',_0x500db2);throw _0x500db2;}}const typebotListener=async({wbot:_0x5e77ab,msg:_0x49acea,ticket:_0x6f3874,typebot:_0x72d288})=>{const _0x592998=a601_0x41370d,_0x1bbed8=_0x49acea[_0x592998(0xf4)]['remoteJid']['replace'](/\D/g,'');let _0x44f982;try{(0x0,lodash_1[_0x592998(0xef)])(_0x6f3874[_0x592998(0xf8)])?(_0x44f982=await createSession(_0x49acea,_0x72d288,_0x1bbed8),await _0x6f3874[_0x592998(0xe7)]({'typebotSessionId':_0x44f982})):_0x44f982=_0x6f3874['typebotSessionId'];let _0x2c32ad=(0x0,wbotMessageListener_1[_0x592998(0xf3)])(_0x49acea);if(_0x2c32ad!==_0x72d288['typebotKeywordFinish']){const _0xa826={'message':_0x2c32ad,'sessionId':_0x44f982};console['log'](_0xa826);const _0xbd8d9f=await axios_1[_0x592998(0xea)][_0x592998(0xf6)](_0x72d288[_0x592998(0xce)],_0xa826),_0x43a6d1=_0xbd8d9f[_0x592998(0xe2)]?.[_0x592998(0xca)];if(_0x43a6d1[_0x592998(0xc9)]===0x0)await _0x5e77ab[_0x592998(0xd8)](_0x1bbed8+_0x592998(0xd0),{'text':_0x72d288['typebotUnknownMessage']});else for(const _0x5981e7 of _0x43a6d1){if(_0x5981e7['type']==='text'){let _0x167715='';for(const _0x3017ed of _0x5981e7[_0x592998(0xc2)][_0x592998(0xf1)]){for(const _0x56cf73 of _0x3017ed[_0x592998(0xe5)]){let _0x5048dc='';_0x56cf73[_0x592998(0xc8)]&&(_0x5048dc=_0x56cf73[_0x592998(0xc8)]),_0x56cf73[_0x592998(0xc5)]&&(_0x5048dc='*'+_0x5048dc+'*'),_0x56cf73['italic']&&(_0x5048dc='_'+_0x5048dc+'_'),_0x56cf73[_0x592998(0xec)]&&(_0x5048dc='~'+_0x5048dc+'~'),_0x167715+=_0x5048dc;}_0x167715+='\x0a';}_0x167715=_0x167715[_0x592998(0xe9)](/\n$/,''),await _0x5e77ab[_0x592998(0xd8)](_0x1bbed8+_0x592998(0xd0),{'text':_0x167715});}else try{console[_0x592998(0xd2)](_0x5981e7);const _0x4199ba=await(0x0,wbotMessageListener_1[_0x592998(0xd1)])(_0x5981e7);console['log'](_0x4199ba);const _0x24f953=path_1['default'][_0x592998(0xe6)](publicFolder,_0x592998(0xdf)+_0x6f3874[_0x592998(0xcc)],_0x4199ba['filename']),_0x4c7819=await(0x0,SendWhatsAppMedia_1[_0x592998(0xdd)])(_0x4199ba[_0x592998(0xf0)],_0x24f953,_0x6f3874[_0x592998(0xcc)][_0x592998(0xe1)](),_0x5981e7?.[_0x592998(0xc2)]?.[_0x592998(0xf1)]),_0x417a82=await _0x5e77ab[_0x592998(0xd8)](_0x1bbed8+_0x592998(0xd0),{..._0x4c7819});}catch(_0x126bd4){logger_1[_0x592998(0xd5)][_0x592998(0xed)](_0x592998(0xd3),_0x126bd4);}}}_0x2c32ad===_0x72d288[_0x592998(0xd7)]&&(await _0x6f3874[_0x592998(0xe7)]({'integrationId':null,'useIntegration':![],'isBot':!![]}),await _0x6f3874[_0x592998(0xcf)],await _0x6f3874['update']({'typebotSessionId':null}),await _0x5e77ab[_0x592998(0xd8)](_0x1bbed8+'@c.us',{'text':'Atendimento\x20automático\x20reiniciado.'}));}catch(_0x4ecfef){logger_1[_0x592998(0xd5)][_0x592998(0xf7)](_0x592998(0xf9),_0x4ecfef);throw _0x4ecfef;}};exports[a601_0x41370d(0xea)]=typebotListener;