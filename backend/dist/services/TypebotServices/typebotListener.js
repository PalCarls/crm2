'use strict';function a608_0x466e(){const _0x3367e9=['input','audio/mp4','bold','/api/v1/typebots/','image','sessionId','status@broadcast','default','children','4934912cqoGbi','request','__esModule','defineProperty','1620384WmTfHg','text','type','url','isNil','paused','underline','9716zkZUPm','post','delay','audio','reload','756yaawqX','messages','sendPresenceUpdate','/api/v1/sessions/','update','1582eOujIa','info','2154ijckCF','replace','lodash','content','startsWith','../../utils/logger','userId','queueId','application/json','../WbotServices/wbotMessageListener','@c.us','toString','logger','typebotStatus','19130jZTTWP','data','parse','stringify','length','878Piagbn','../TicketServices/UpdateTicketService','__importDefault','remoteJid','3569500GRDwxM','composing','getBodyMessage','items','/continueChat','key','richText','italic','sendMessage','1767388VwoolU','choice\x20input','companyId','typebotSessionId','presenceSubscribe','@whiskeysockets/baileys'];a608_0x466e=function(){return _0x3367e9;};return a608_0x466e();}function a608_0x4f5d(_0x10ca5c,_0x1d1e9b){const _0x466e40=a608_0x466e();return a608_0x4f5d=function(_0x4f5d09,_0x5261e9){_0x4f5d09=_0x4f5d09-0x13e;let _0x5abe54=_0x466e40[_0x4f5d09];return _0x5abe54;},a608_0x4f5d(_0x10ca5c,_0x1d1e9b);}const a608_0x58d400=a608_0x4f5d;(function(_0xb75e79,_0xa71d2b){const _0x27c806=a608_0x4f5d,_0x3e663b=_0xb75e79();while(!![]){try{const _0xc84809=parseInt(_0x27c806(0x152))/0x1*(-parseInt(_0x27c806(0x167))/0x2)+parseInt(_0x27c806(0x141))/0x3+-parseInt(_0x27c806(0x174))/0x4+parseInt(_0x27c806(0x16b))/0x5+-parseInt(_0x27c806(0x154))/0x6*(parseInt(_0x27c806(0x148))/0x7)+parseInt(_0x27c806(0x183))/0x8+parseInt(_0x27c806(0x14d))/0x9*(parseInt(_0x27c806(0x162))/0xa);if(_0xc84809===_0xa71d2b)break;else _0x3e663b['push'](_0x3e663b['shift']());}catch(_0x5e7da7){_0x3e663b['push'](_0x3e663b['shift']());}}}(a608_0x466e,0x60e93));var __importDefault=this&&this[a608_0x58d400(0x169)]||function(_0x3b7c71){const _0x4f1c06=a608_0x58d400;return _0x3b7c71&&_0x3b7c71[_0x4f1c06(0x13f)]?_0x3b7c71:{'default':_0x3b7c71};};Object[a608_0x58d400(0x140)](exports,a608_0x58d400(0x13f),{'value':!![]});const axios_1=__importDefault(require('axios')),baileys_1=require(a608_0x58d400(0x179)),wbotMessageListener_1=require(a608_0x58d400(0x15d)),logger_1=require(a608_0x58d400(0x159)),lodash_1=require(a608_0x58d400(0x156)),UpdateTicketService_1=__importDefault(require(a608_0x58d400(0x168))),typebotListener=async({wbot:_0x25a52,msg:_0x252d8a,ticket:_0x3d9355,typebot:_0x2860d5})=>{const _0x51732c=a608_0x58d400;if(_0x252d8a[_0x51732c(0x170)][_0x51732c(0x16a)]===_0x51732c(0x180))return;const {urlN8N:_0x3654d5,typebotExpires:_0x32ba80,typebotKeywordFinish:_0x4d555d,typebotKeywordRestart:_0x3cca26,typebotUnknownMessage:_0x1c5f39,typebotSlug:_0x49c699,typebotDelayMessage:_0x3de20a,typebotRestartMessage:_0xfeb264}=_0x2860d5,_0x33f899=_0x252d8a[_0x51732c(0x170)][_0x51732c(0x16a)][_0x51732c(0x155)](/\D/g,'');let _0x58490d=(0x0,wbotMessageListener_1[_0x51732c(0x16d)])(_0x252d8a);async function _0x55a7c2(_0x41e1b1,_0x6031bf,_0x5ae836){const _0x5b0559=_0x51732c;try{const _0x1025bb=Math['floor'](Math['random']()*0x2540be400)[_0x5b0559(0x15f)](),_0x410007=JSON[_0x5b0559(0x165)]({'isStreamEnabled':!![],'message':'string','resultId':'string','isOnlyRegistering':![],'prefilledVariables':{'number':_0x5ae836,'pushName':_0x41e1b1['pushName']||'','remoteJid':_0x3d9355?.['contact']?.[_0x5b0559(0x16a)]}}),_0xb9d34={'method':_0x5b0559(0x149),'maxBodyLength':Infinity,'url':_0x3654d5+_0x5b0559(0x17d)+_0x49c699+'/startChat','headers':{'Content-Type':_0x5b0559(0x15c),'Accept':_0x5b0559(0x15c)},'data':_0x410007},_0x46674e=await axios_1[_0x5b0559(0x181)][_0x5b0559(0x13e)](_0xb9d34);return _0x46674e[_0x5b0559(0x163)];}catch(_0x345532){logger_1[_0x5b0559(0x160)][_0x5b0559(0x153)]('Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:\x20',_0x345532);throw _0x345532;}}let _0x36cebc,_0x20dcd8,_0x5dff15=![];try{const _0xfcbe99=new Date();_0xfcbe99['setMinutes'](_0xfcbe99['getMinutes']()-Number(_0x32ba80));_0x32ba80>0x0&&_0x3d9355['updatedAt']<_0xfcbe99&&(await _0x3d9355[_0x51732c(0x151)]({'typebotSessionId':null,'isBot':!![]}),await _0x3d9355[_0x51732c(0x14c)]());(0x0,lodash_1[_0x51732c(0x145)])(_0x3d9355[_0x51732c(0x177)])?(_0x20dcd8=await _0x55a7c2(_0x252d8a,_0x2860d5,_0x33f899),_0x36cebc=_0x20dcd8[_0x51732c(0x17f)],_0x5dff15=!![],await _0x3d9355[_0x51732c(0x151)]({'typebotSessionId':_0x36cebc,'typebotStatus':!![],'useIntegration':!![],'integrationId':_0x2860d5['id']})):(_0x36cebc=_0x3d9355[_0x51732c(0x177)],_0x5dff15=_0x3d9355[_0x51732c(0x161)]);if(!_0x5dff15)return;if(_0x58490d!==_0x4d555d&&_0x58490d!==_0x3cca26){let _0x2501c4,_0x4fa76f,_0x2ac769;if(_0x20dcd8?.['messages'][_0x51732c(0x166)]===0x0||_0x20dcd8===undefined){const _0x54ca48=JSON['stringify']({'message':_0x58490d});let _0x1d8b7b={'method':'post','maxBodyLength':Infinity,'url':_0x3654d5+_0x51732c(0x150)+_0x36cebc+_0x51732c(0x16f),'headers':{'Content-Type':_0x51732c(0x15c),'Accept':_0x51732c(0x15c)},'data':_0x54ca48};_0x2501c4=await axios_1[_0x51732c(0x181)][_0x51732c(0x13e)](_0x1d8b7b),_0x4fa76f=_0x2501c4['data']?.[_0x51732c(0x14e)],_0x2ac769=_0x2501c4[_0x51732c(0x163)]?.[_0x51732c(0x17a)];}else _0x4fa76f=_0x20dcd8?.['messages'],_0x2ac769=_0x20dcd8?.['input'];if(_0x4fa76f?.[_0x51732c(0x166)]===0x0)await _0x25a52['sendMessage'](_0x33f899+_0x51732c(0x15e),{'text':_0x1c5f39});else{for(const _0x5865f8 of _0x4fa76f){if(_0x5865f8[_0x51732c(0x143)]===_0x51732c(0x142)){let _0x484bae='',_0x531ee5=![];for(const _0x1023f5 of _0x5865f8[_0x51732c(0x157)][_0x51732c(0x171)]){for(const _0x6f752c of _0x1023f5[_0x51732c(0x182)]){let _0x7273c1='';_0x6f752c['text']&&(_0x7273c1=_0x6f752c[_0x51732c(0x142)]);if(_0x6f752c[_0x51732c(0x143)]&&_0x6f752c[_0x51732c(0x182)])for(const _0x43603b of _0x6f752c['children']){let _0xaca729='';_0x43603b['text']&&(_0xaca729=_0x43603b[_0x51732c(0x142)]);if(_0x43603b[_0x51732c(0x143)]&&_0x43603b['children'])for(const _0x31a207 of _0x43603b[_0x51732c(0x182)]){let _0x296b43='';_0x31a207[_0x51732c(0x142)]&&(_0x296b43=_0x31a207[_0x51732c(0x142)]);_0x31a207[_0x51732c(0x17c)]&&(_0x296b43='*'+_0x296b43+'*');_0x31a207['italic']&&(_0x296b43='_'+_0x296b43+'_');_0x31a207[_0x51732c(0x147)]&&(_0x296b43='~'+_0x296b43+'~');if(_0x31a207[_0x51732c(0x144)]){const _0x2ea3c4=_0x31a207[_0x51732c(0x182)][0x0]['text'];_0x296b43='['+_0x2ea3c4+']('+_0x31a207[_0x51732c(0x144)]+')',_0x531ee5=!![];}_0x484bae+=_0x296b43;}_0x43603b[_0x51732c(0x17c)]&&(_0xaca729='*'+_0xaca729+'*');_0x43603b[_0x51732c(0x172)]&&(_0xaca729='_'+_0xaca729+'_');_0x43603b['underline']&&(_0xaca729='~'+_0xaca729+'~');if(_0x43603b[_0x51732c(0x144)]){const _0x507afa=_0x43603b[_0x51732c(0x182)][0x0][_0x51732c(0x142)];_0xaca729='['+_0x507afa+']('+_0x43603b[_0x51732c(0x144)]+')',_0x531ee5=!![];}_0x484bae+=_0xaca729;}_0x6f752c[_0x51732c(0x17c)]&&(_0x7273c1='*'+_0x7273c1+'*');_0x6f752c['italic']&&(_0x7273c1='_'+_0x7273c1+'_');_0x6f752c['underline']&&(_0x7273c1='~'+_0x7273c1+'~');if(_0x6f752c[_0x51732c(0x144)]){const _0x51340c=_0x6f752c[_0x51732c(0x182)][0x0]['text'];_0x7273c1='['+_0x51340c+']('+_0x6f752c[_0x51732c(0x144)]+')',_0x531ee5=!![];}_0x484bae+=_0x7273c1;}_0x484bae+='\x0a';}_0x484bae=_0x484bae[_0x51732c(0x155)]('**','')[_0x51732c(0x155)](/\n$/,'');_0x484bae==='Invalid\x20message.\x20Please,\x20try\x20again.'&&(_0x484bae=_0x1c5f39);if(_0x484bae[_0x51732c(0x158)]('#')){let _0x19a8ae=_0x484bae['replace']('#','');try{let _0x35138d=JSON[_0x51732c(0x164)](_0x19a8ae);if(_0x35138d['stopBot']&&(0x0,lodash_1[_0x51732c(0x145)])(_0x35138d[_0x51732c(0x15a)])&&(0x0,lodash_1[_0x51732c(0x145)])(_0x35138d[_0x51732c(0x15b)])){await _0x3d9355[_0x51732c(0x151)]({'useIntegration':![],'isBot':![]});return;}if(!(0x0,lodash_1[_0x51732c(0x145)])(_0x35138d[_0x51732c(0x15b)])&&_0x35138d[_0x51732c(0x15b)]>0x0&&(0x0,lodash_1[_0x51732c(0x145)])(_0x35138d[_0x51732c(0x15a)])){await(0x0,UpdateTicketService_1[_0x51732c(0x181)])({'ticketData':{'queueId':_0x35138d[_0x51732c(0x15b)],'isBot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x3d9355['id'],'companyId':_0x3d9355[_0x51732c(0x176)]});return;}if(!(0x0,lodash_1[_0x51732c(0x145)])(_0x35138d[_0x51732c(0x15b)])&&_0x35138d[_0x51732c(0x15b)]>0x0&&!(0x0,lodash_1[_0x51732c(0x145)])(_0x35138d[_0x51732c(0x15a)])&&_0x35138d['userId']>0x0){await(0x0,UpdateTicketService_1[_0x51732c(0x181)])({'ticketData':{'queueId':_0x35138d[_0x51732c(0x15b)],'userId':_0x35138d[_0x51732c(0x15a)],'isBot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x3d9355['id'],'companyId':_0x3d9355[_0x51732c(0x176)]});return;}}catch(_0x160d6f){throw _0x160d6f;}}await _0x25a52[_0x51732c(0x178)](_0x252d8a[_0x51732c(0x170)]['remoteJid']),await _0x25a52[_0x51732c(0x14f)](_0x51732c(0x16c),_0x252d8a[_0x51732c(0x170)][_0x51732c(0x16a)]),await(0x0,baileys_1[_0x51732c(0x14a)])(_0x3de20a),await _0x25a52[_0x51732c(0x14f)](_0x51732c(0x146),_0x252d8a[_0x51732c(0x170)]['remoteJid']),await _0x25a52[_0x51732c(0x173)](_0x252d8a[_0x51732c(0x170)][_0x51732c(0x16a)],{'text':_0x484bae});}if(_0x5865f8[_0x51732c(0x143)]===_0x51732c(0x14b)){await _0x25a52[_0x51732c(0x178)](_0x252d8a[_0x51732c(0x170)][_0x51732c(0x16a)]),await _0x25a52[_0x51732c(0x14f)]('composing',_0x252d8a['key'][_0x51732c(0x16a)]),await(0x0,baileys_1[_0x51732c(0x14a)])(_0x3de20a),await _0x25a52[_0x51732c(0x14f)]('paused',_0x252d8a[_0x51732c(0x170)][_0x51732c(0x16a)]);const _0x5b6505={'audio':{'url':_0x5865f8[_0x51732c(0x157)][_0x51732c(0x144)],'mimetype':_0x51732c(0x17b),'ptt':!![]}};await _0x25a52[_0x51732c(0x173)](_0x252d8a[_0x51732c(0x170)][_0x51732c(0x16a)],_0x5b6505);}if(_0x5865f8['type']===_0x51732c(0x17e)){await _0x25a52[_0x51732c(0x178)](_0x252d8a[_0x51732c(0x170)]['remoteJid']),await _0x25a52[_0x51732c(0x14f)](_0x51732c(0x16c),_0x252d8a[_0x51732c(0x170)][_0x51732c(0x16a)]),await(0x0,baileys_1[_0x51732c(0x14a)])(_0x3de20a),await _0x25a52[_0x51732c(0x14f)](_0x51732c(0x146),_0x252d8a[_0x51732c(0x170)][_0x51732c(0x16a)]);const _0xb3836f={'image':{'url':_0x5865f8['content']['url']}};await _0x25a52[_0x51732c(0x173)](_0x252d8a['key'][_0x51732c(0x16a)],_0xb3836f);}}if(_0x2ac769){if(_0x2ac769[_0x51732c(0x143)]===_0x51732c(0x175)){let _0x164930='';const _0x3905da=_0x2ac769[_0x51732c(0x16e)];for(const _0x3de2b2 of _0x3905da){_0x164930+='▶️\x20'+_0x3de2b2[_0x51732c(0x157)]+'\x0a';}_0x164930=_0x164930[_0x51732c(0x155)](/\n$/,''),await _0x25a52[_0x51732c(0x178)](_0x252d8a['key'][_0x51732c(0x16a)]),await _0x25a52[_0x51732c(0x14f)]('composing',_0x252d8a['key'][_0x51732c(0x16a)]),await(0x0,baileys_1[_0x51732c(0x14a)])(_0x3de20a),await _0x25a52[_0x51732c(0x14f)](_0x51732c(0x146),_0x252d8a[_0x51732c(0x170)][_0x51732c(0x16a)]),await _0x25a52['sendMessage'](_0x252d8a['key']['remoteJid'],{'text':_0x164930});}}}}_0x58490d===_0x3cca26&&(await _0x3d9355['update']({'isBot':!![],'typebotSessionId':null}),await _0x3d9355['reload'](),await _0x25a52['sendMessage'](_0x33f899+'@c.us',{'text':_0xfeb264}));if(_0x58490d===_0x4d555d){await(0x0,UpdateTicketService_1[_0x51732c(0x181)])({'ticketData':{'status':'closed','useIntegration':![],'integrationId':null,'sendFarewellMessage':!![]},'ticketId':_0x3d9355['id'],'companyId':_0x3d9355[_0x51732c(0x176)]});return;}}catch(_0x51b115){logger_1['logger']['info']('Error\x20on\x20typebotListener:\x20',_0x51b115),await _0x3d9355[_0x51732c(0x151)]({'typebotSessionId':null});throw _0x51b115;}};exports[a608_0x58d400(0x181)]=typebotListener;