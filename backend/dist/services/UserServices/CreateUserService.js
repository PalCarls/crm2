'use strict';const a592_0x5c77ca=a592_0x1161;function a592_0x3ad4(){const _0x376c31=['555115XbvQVO','company','26079300eWSzsJ','../../errors/AppError','$set','count','5995071NwOunZ','get','__createBinding','190qpHVcc','configurable','test','object','writable','defineProperty','13wOcaiU','3OVeuJw','yup','4078iUVYmE','__setModuleDefault','findOne','An\x20user\x20with\x20this\x20email\x20already\x20exists.','../../helpers/SerializeUser','min','plan','3289395lLTIsF','default','../../models/User','SerializeUser','create','string','users','174gsAtFD','../../models/Plan','prototype','428HgFJco','required','queues','hasOwnProperty','182833fbEUBN','../../models/Company','message','admin','8XFAZEH','3970184MaSJMM','getOwnPropertyDescriptor','__esModule'];a592_0x3ad4=function(){return _0x376c31;};return a592_0x3ad4();}(function(_0x4da2c5,_0x154df1){const _0x3f2732=a592_0x1161,_0x9ca67e=_0x4da2c5();while(!![]){try{const _0x4d251b=-parseInt(_0x3f2732(0xa1))/0x1*(parseInt(_0x3f2732(0x90))/0x2)+-parseInt(_0x3f2732(0x8e))/0x3*(parseInt(_0x3f2732(0xaa))/0x4)+-parseInt(_0x3f2732(0x97))/0x5+parseInt(_0x3f2732(0x9e))/0x6*(-parseInt(_0x3f2732(0xa5))/0x7)+-parseInt(_0x3f2732(0xa9))/0x8*(-parseInt(_0x3f2732(0xb3))/0x9)+-parseInt(_0x3f2732(0xb6))/0xa*(-parseInt(_0x3f2732(0xad))/0xb)+-parseInt(_0x3f2732(0xaf))/0xc*(-parseInt(_0x3f2732(0x8d))/0xd);if(_0x4d251b===_0x154df1)break;else _0x9ca67e['push'](_0x9ca67e['shift']());}catch(_0x5a5c08){_0x9ca67e['push'](_0x9ca67e['shift']());}}}(a592_0x3ad4,0x7e61d));var __createBinding=this&&this[a592_0x5c77ca(0xb5)]||(Object[a592_0x5c77ca(0x9b)]?function(_0x220a84,_0x4c89c1,_0x2c9b1f,_0x5ea3e7){const _0x552be8=a592_0x5c77ca;if(_0x5ea3e7===undefined)_0x5ea3e7=_0x2c9b1f;var _0xf5b96d=Object[_0x552be8(0xab)](_0x4c89c1,_0x2c9b1f);(!_0xf5b96d||(_0x552be8(0xb4)in _0xf5b96d?!_0x4c89c1['__esModule']:_0xf5b96d[_0x552be8(0x8b)]||_0xf5b96d[_0x552be8(0x88)]))&&(_0xf5b96d={'enumerable':!![],'get':function(){return _0x4c89c1[_0x2c9b1f];}}),Object[_0x552be8(0x8c)](_0x220a84,_0x5ea3e7,_0xf5b96d);}:function(_0x10c6ef,_0x4228b6,_0x3e8347,_0x57f6ae){if(_0x57f6ae===undefined)_0x57f6ae=_0x3e8347;_0x10c6ef[_0x57f6ae]=_0x4228b6[_0x3e8347];}),__setModuleDefault=this&&this[a592_0x5c77ca(0x91)]||(Object[a592_0x5c77ca(0x9b)]?function(_0x38ef5c,_0x72cb5c){const _0x2dd9d2=a592_0x5c77ca;Object[_0x2dd9d2(0x8c)](_0x38ef5c,_0x2dd9d2(0x98),{'enumerable':!![],'value':_0x72cb5c});}:function(_0x4a9d3a,_0x8e9eb5){_0x4a9d3a['default']=_0x8e9eb5;}),__importStar=this&&this['__importStar']||function(_0x1538c8){const _0x47e45a=a592_0x5c77ca;if(_0x1538c8&&_0x1538c8[_0x47e45a(0xac)])return _0x1538c8;var _0x5c30e7={};if(_0x1538c8!=null){for(var _0x27d000 in _0x1538c8)if(_0x27d000!==_0x47e45a(0x98)&&Object[_0x47e45a(0xa0)][_0x47e45a(0xa4)]['call'](_0x1538c8,_0x27d000))__createBinding(_0x5c30e7,_0x1538c8,_0x27d000);}return __setModuleDefault(_0x5c30e7,_0x1538c8),_0x5c30e7;},__importDefault=this&&this['__importDefault']||function(_0x2ef25){return _0x2ef25&&_0x2ef25['__esModule']?_0x2ef25:{'default':_0x2ef25};};Object[a592_0x5c77ca(0x8c)](exports,a592_0x5c77ca(0xac),{'value':!![]});function a592_0x1161(_0x46f42f,_0x164745){const _0x3ad419=a592_0x3ad4();return a592_0x1161=function(_0x116113,_0x54e878){_0x116113=_0x116113-0x88;let _0x25996e=_0x3ad419[_0x116113];return _0x25996e;},a592_0x1161(_0x46f42f,_0x164745);}const Yup=__importStar(require(a592_0x5c77ca(0x8f))),AppError_1=__importDefault(require(a592_0x5c77ca(0xb0))),SerializeUser_1=require(a592_0x5c77ca(0x94)),User_1=__importDefault(require(a592_0x5c77ca(0x99))),Plan_1=__importDefault(require(a592_0x5c77ca(0x9f))),Company_1=__importDefault(require(a592_0x5c77ca(0xa6))),CreateUserService=async({email:_0x22cbe1,password:_0x58ecca,name:_0x516487,queueIds:queueIds=[],companyId:_0x417ca1,profile:profile=a592_0x5c77ca(0xa8),startWork:_0x4e57a8,endWork:_0x46a6f2,whatsappId:_0x42550e,allTicket:_0x1ef56f,defaultTheme:_0x54418d,defaultMenu:_0x24e903,allowGroup:_0x5be270,allHistoric:_0x18dda3,allUserChat:_0x1ac05c})=>{const _0x3c0439=a592_0x5c77ca;if(_0x417ca1!==undefined){const _0x424e01=await Company_1[_0x3c0439(0x98)][_0x3c0439(0x92)]({'where':{'id':_0x417ca1},'include':[{'model':Plan_1[_0x3c0439(0x98)],'as':_0x3c0439(0x96)}]});if(_0x424e01!==null){const _0x4bf859=await User_1[_0x3c0439(0x98)][_0x3c0439(0xb2)]({'where':{'companyId':_0x417ca1}});if(_0x4bf859>=_0x424e01[_0x3c0439(0x96)][_0x3c0439(0x9d)])throw new AppError_1[(_0x3c0439(0x98))]('Número\x20máximo\x20de\x20usuários\x20já\x20alcançado:\x20'+_0x4bf859);}}const _0x2a7253=Yup[_0x3c0439(0x8a)]()['shape']({'name':Yup['string']()[_0x3c0439(0xa2)]()[_0x3c0439(0x95)](0x2),'allHistoric':Yup['string'](),'email':Yup[_0x3c0439(0x9c)]()['email']()[_0x3c0439(0xa2)]()[_0x3c0439(0x89)]('Check-email',_0x3c0439(0x93),async _0x22972d=>{const _0x579f9b=_0x3c0439;if(!_0x22972d)return![];const _0x419f5a=await User_1[_0x579f9b(0x98)]['findOne']({'where':{'email':_0x22972d}});return!_0x419f5a;}),'password':Yup[_0x3c0439(0x9c)]()[_0x3c0439(0xa2)]()[_0x3c0439(0x95)](0x5)});try{await _0x2a7253['validate']({'email':_0x22cbe1,'password':_0x58ecca,'name':_0x516487});}catch(_0x302772){throw new AppError_1[(_0x3c0439(0x98))](_0x302772[_0x3c0439(0xa7)]);}const _0xcd38a4=await User_1[_0x3c0439(0x98)]['create']({'email':_0x22cbe1,'password':_0x58ecca,'name':_0x516487,'companyId':_0x417ca1,'profile':profile,'startWork':_0x4e57a8,'endWork':_0x46a6f2,'whatsappId':_0x42550e||null,'allTicket':_0x1ef56f,'defaultTheme':_0x54418d,'defaultMenu':_0x24e903,'allowGroup':_0x5be270,'allHistoric':_0x18dda3,'allUserChat':_0x1ac05c},{'include':[_0x3c0439(0xa3),_0x3c0439(0xae)]});await _0xcd38a4[_0x3c0439(0xb1)]('queues',queueIds),await _0xcd38a4['reload']();const _0x56c048=(0x0,SerializeUser_1[_0x3c0439(0x9a)])(_0xcd38a4);return _0x56c048;};exports['default']=CreateUserService;