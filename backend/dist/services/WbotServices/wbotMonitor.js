'use strict';const a553_0x2e7343=a553_0xbdbd;(function(_0x41027e,_0xaf88e6){const _0xfcc2b5=a553_0xbdbd,_0x3f4da2=_0x41027e();while(!![]){try{const _0x22af2f=-parseInt(_0xfcc2b5(0xb9))/0x1*(parseInt(_0xfcc2b5(0xb5))/0x2)+-parseInt(_0xfcc2b5(0xba))/0x3*(parseInt(_0xfcc2b5(0xc2))/0x4)+-parseInt(_0xfcc2b5(0xc5))/0x5*(-parseInt(_0xfcc2b5(0xd9))/0x6)+-parseInt(_0xfcc2b5(0xdc))/0x7*(parseInt(_0xfcc2b5(0xda))/0x8)+parseInt(_0xfcc2b5(0xe1))/0x9*(parseInt(_0xfcc2b5(0xdb))/0xa)+parseInt(_0xfcc2b5(0xb3))/0xb+parseInt(_0xfcc2b5(0xbc))/0xc;if(_0x22af2f===_0xaf88e6)break;else _0x3f4da2['push'](_0x3f4da2['shift']());}catch(_0xfbd648){_0x3f4da2['push'](_0x3f4da2['shift']());}}}(a553_0xa540,0xc3e96));function a553_0xa540(){const _0x5020e5=['12405041tYHPia','get','27256fJokOW','@sentry/node','findOne','attrs','8yKjcNg','612627iDgazA','defineProperty','4590936uKTVaZ','acceptCallWhatsapp','value','default','__importStar','captureException','8LlrFML','call_log','configurable','385fXpRNY','__esModule','getOwnPropertyDescriptor','tag','disabled','logger','pending','../../models/Contact','call-id','../MessageServices/CreateMessageService','writable','closed','content','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','../../models/Ticket','replace','../../utils/logger','create','contacts.upsert','prototype','71082KPxTJI','8SZGmeK','814180PehoBy','9998128RFVkDp','update','CB:call','__createBinding','../BaileysServices/CreateOrUpdateBaileysService','36ENnTqK','hasOwnProperty','terminate','__setModuleDefault','call'];a553_0xa540=function(){return _0x5020e5;};return a553_0xa540();}var __createBinding=this&&this[a553_0x2e7343(0xdf)]||(Object[a553_0x2e7343(0xd6)]?function(_0x380ffb,_0x37dbf5,_0x231954,_0x46d175){const _0x32a089=a553_0x2e7343;if(_0x46d175===undefined)_0x46d175=_0x231954;var _0x1bc555=Object[_0x32a089(0xc7)](_0x37dbf5,_0x231954);(!_0x1bc555||(_0x32a089(0xb4)in _0x1bc555?!_0x37dbf5[_0x32a089(0xc6)]:_0x1bc555[_0x32a089(0xcf)]||_0x1bc555[_0x32a089(0xc4)]))&&(_0x1bc555={'enumerable':!![],'get':function(){return _0x37dbf5[_0x231954];}}),Object[_0x32a089(0xbb)](_0x380ffb,_0x46d175,_0x1bc555);}:function(_0xb7a57d,_0x43690a,_0x467c15,_0x11d6e4){if(_0x11d6e4===undefined)_0x11d6e4=_0x467c15;_0xb7a57d[_0x11d6e4]=_0x43690a[_0x467c15];}),__setModuleDefault=this&&this[a553_0x2e7343(0xb1)]||(Object[a553_0x2e7343(0xd6)]?function(_0x14a788,_0x388ad0){const _0x3de31e=a553_0x2e7343;Object['defineProperty'](_0x14a788,_0x3de31e(0xbf),{'enumerable':!![],'value':_0x388ad0});}:function(_0x50c376,_0x4b1f10){const _0x24f50d=a553_0x2e7343;_0x50c376[_0x24f50d(0xbf)]=_0x4b1f10;}),__importStar=this&&this[a553_0x2e7343(0xc0)]||function(_0x120ff1){const _0x403e81=a553_0x2e7343;if(_0x120ff1&&_0x120ff1[_0x403e81(0xc6)])return _0x120ff1;var _0x4b7ef1={};if(_0x120ff1!=null){for(var _0x5e1bb5 in _0x120ff1)if(_0x5e1bb5!==_0x403e81(0xbf)&&Object[_0x403e81(0xd8)][_0x403e81(0xe2)][_0x403e81(0xb2)](_0x120ff1,_0x5e1bb5))__createBinding(_0x4b7ef1,_0x120ff1,_0x5e1bb5);}return __setModuleDefault(_0x4b7ef1,_0x120ff1),_0x4b7ef1;},__importDefault=this&&this['__importDefault']||function(_0x4de113){const _0x495e48=a553_0x2e7343;return _0x4de113&&_0x4de113[_0x495e48(0xc6)]?_0x4de113:{'default':_0x4de113};};Object['defineProperty'](exports,'__esModule',{'value':!![]});function a553_0xbdbd(_0x491a5c,_0x2d383a){const _0xa5408a=a553_0xa540();return a553_0xbdbd=function(_0xbdbde9,_0x68f82f){_0xbdbde9=_0xbdbde9-0xb1;let _0x1875c3=_0xa5408a[_0xbdbde9];return _0x1875c3;},a553_0xbdbd(_0x491a5c,_0x2d383a);}const Sentry=__importStar(require(a553_0x2e7343(0xb6))),Contact_1=__importDefault(require(a553_0x2e7343(0xcc))),Setting_1=__importDefault(require('../../models/Setting')),Ticket_1=__importDefault(require(a553_0x2e7343(0xd3))),logger_1=require(a553_0x2e7343(0xd5)),CreateOrUpdateBaileysService_1=__importDefault(require(a553_0x2e7343(0xe0))),CreateMessageService_1=__importDefault(require(a553_0x2e7343(0xce))),wbotMonitor=async(_0x49050e,_0x207e28,_0x1a4615)=>{const _0x43585a=a553_0x2e7343;try{_0x49050e['ws']['on'](_0x43585a(0xde),async _0x4b46ef=>{const _0x52519c=_0x43585a,_0x19fc6b=_0x4b46ef[_0x52519c(0xd1)][0x0];if(_0x19fc6b[_0x52519c(0xc8)]===_0x52519c(0xe3)){const _0x156469=await Setting_1[_0x52519c(0xbf)][_0x52519c(0xb7)]({'where':{'key':_0x52519c(0xbd),'companyId':_0x1a4615}});if(_0x156469[_0x52519c(0xbe)]===_0x52519c(0xc9)){await _0x49050e['sendMessage'](_0x4b46ef['attrs']['from'],{'text':'*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado'});const _0x25f7f3=_0x4b46ef['attrs']['from'][_0x52519c(0xd4)](/\D/g,''),_0x1a63af=await Contact_1[_0x52519c(0xbf)][_0x52519c(0xb7)]({'where':{'companyId':_0x1a4615,'number':_0x25f7f3}}),_0x21ecd0=await Ticket_1[_0x52519c(0xbf)][_0x52519c(0xb7)]({'where':{'contactId':_0x1a63af['id'],'whatsappId':_0x49050e['id'],'companyId':_0x1a4615}});if(!_0x21ecd0)return;const _0xf09992=new Date(),_0x35c2a5=_0xf09992['getHours'](),_0x3498cc=_0xf09992['getMinutes'](),_0x1b64bf=_0x52519c(0xd2)+_0x35c2a5+':'+_0x3498cc,_0x2462e5={'wid':_0x19fc6b[_0x52519c(0xb8)][_0x52519c(0xcd)],'ticketId':_0x21ecd0['id'],'contactId':_0x1a63af['id'],'body':_0x1b64bf,'fromMe':![],'mediaType':_0x52519c(0xc3),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x21ecd0[_0x52519c(0xdd)]({'lastMessage':_0x1b64bf}),_0x21ecd0['status']===_0x52519c(0xd0)&&await _0x21ecd0[_0x52519c(0xdd)]({'status':_0x52519c(0xcb)}),(0x0,CreateMessageService_1[_0x52519c(0xbf)])({'messageData':_0x2462e5,'companyId':_0x1a4615});}}}),_0x49050e['ev']['on'](_0x43585a(0xd7),async _0x526e32=>{const _0x17dc40=_0x43585a;await(0x0,CreateOrUpdateBaileysService_1[_0x17dc40(0xbf)])({'whatsappId':_0x207e28['id'],'contacts':_0x526e32});});}catch(_0x28311f){Sentry[_0x43585a(0xc1)](_0x28311f),logger_1[_0x43585a(0xca)]['error'](_0x28311f);}};exports['default']=wbotMonitor;