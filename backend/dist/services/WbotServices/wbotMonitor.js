'use strict';function a570_0x1cd0(){const _0xbb9ede=['7029896LyvtCX','defineProperty','CB:call','__importStar','../../models/Contact','error','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','../../models/CompaniesSettings','default','update','acceptCallWhatsapp','content','writable','406283wGcFKg','pending','hasOwnProperty','__esModule','tag','6675221qvPiis','../../models/Ticket','contacts.upsert','create','8wYTTCk','status','getMinutes','replace','__importDefault','995331dEjeSk','getOwnPropertyDescriptor','logger','disabled','25CWhGkZ','__setModuleDefault','findOne','9SVglUV','../../utils/logger','from','call-id','closed','call','captureException','1376012ONlWcF','sendMessage','get','attrs','../MessageServices/CreateMessageService','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','15071110RrPTKH','945426VZMxSE','configurable'];a570_0x1cd0=function(){return _0xbb9ede;};return a570_0x1cd0();}function a570_0x2aad(_0x1b93f3,_0xab388f){const _0x1cd066=a570_0x1cd0();return a570_0x2aad=function(_0x2aad86,_0x201889){_0x2aad86=_0x2aad86-0x16e;let _0x57307d=_0x1cd066[_0x2aad86];return _0x57307d;},a570_0x2aad(_0x1b93f3,_0xab388f);}const a570_0x296a4c=a570_0x2aad;(function(_0x5f45be,_0x821236){const _0x34adb1=a570_0x2aad,_0x153a15=_0x5f45be();while(!![]){try{const _0x46611b=parseInt(_0x34adb1(0x17f))/0x1+parseInt(_0x34adb1(0x19b))/0x2+-parseInt(_0x34adb1(0x18d))/0x3*(-parseInt(_0x34adb1(0x188))/0x4)+-parseInt(_0x34adb1(0x191))/0x5*(parseInt(_0x34adb1(0x170))/0x6)+-parseInt(_0x34adb1(0x184))/0x7+parseInt(_0x34adb1(0x172))/0x8*(-parseInt(_0x34adb1(0x194))/0x9)+parseInt(_0x34adb1(0x16f))/0xa;if(_0x46611b===_0x821236)break;else _0x153a15['push'](_0x153a15['shift']());}catch(_0x5c2d1d){_0x153a15['push'](_0x153a15['shift']());}}}(a570_0x1cd0,0x9d697));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x291aea,_0x15cfae,_0x178418,_0x1200b4){const _0x3c735a=a570_0x2aad;if(_0x1200b4===undefined)_0x1200b4=_0x178418;var _0xfd8e9a=Object[_0x3c735a(0x18e)](_0x15cfae,_0x178418);(!_0xfd8e9a||(_0x3c735a(0x19d)in _0xfd8e9a?!_0x15cfae[_0x3c735a(0x182)]:_0xfd8e9a[_0x3c735a(0x17e)]||_0xfd8e9a[_0x3c735a(0x171)]))&&(_0xfd8e9a={'enumerable':!![],'get':function(){return _0x15cfae[_0x178418];}}),Object['defineProperty'](_0x291aea,_0x1200b4,_0xfd8e9a);}:function(_0x1aefde,_0x348028,_0x42c44e,_0x51b15f){if(_0x51b15f===undefined)_0x51b15f=_0x42c44e;_0x1aefde[_0x51b15f]=_0x348028[_0x42c44e];}),__setModuleDefault=this&&this[a570_0x296a4c(0x192)]||(Object[a570_0x296a4c(0x187)]?function(_0x15b344,_0x33820e){const _0x1da7f8=a570_0x296a4c;Object[_0x1da7f8(0x173)](_0x15b344,_0x1da7f8(0x17a),{'enumerable':!![],'value':_0x33820e});}:function(_0x34bd72,_0x251e0c){const _0x1a22de=a570_0x296a4c;_0x34bd72[_0x1a22de(0x17a)]=_0x251e0c;}),__importStar=this&&this[a570_0x296a4c(0x175)]||function(_0x491871){const _0x1457e8=a570_0x296a4c;if(_0x491871&&_0x491871[_0x1457e8(0x182)])return _0x491871;var _0x32679e={};if(_0x491871!=null){for(var _0x3c2bc8 in _0x491871)if(_0x3c2bc8!=='default'&&Object['prototype'][_0x1457e8(0x181)][_0x1457e8(0x199)](_0x491871,_0x3c2bc8))__createBinding(_0x32679e,_0x491871,_0x3c2bc8);}return __setModuleDefault(_0x32679e,_0x491871),_0x32679e;},__importDefault=this&&this[a570_0x296a4c(0x18c)]||function(_0x4405ac){const _0x32a8b4=a570_0x296a4c;return _0x4405ac&&_0x4405ac[_0x32a8b4(0x182)]?_0x4405ac:{'default':_0x4405ac};};Object[a570_0x296a4c(0x173)](exports,a570_0x296a4c(0x182),{'value':!![]});const Sentry=__importStar(require('@sentry/node')),Contact_1=__importDefault(require(a570_0x296a4c(0x176))),Ticket_1=__importDefault(require(a570_0x296a4c(0x185))),logger_1=require(a570_0x296a4c(0x195)),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require(a570_0x296a4c(0x19f))),CompaniesSettings_1=__importDefault(require(a570_0x296a4c(0x179))),wbotMonitor=async(_0x522b8f,_0x14677a,_0x143c0a)=>{const _0x22b52e=a570_0x296a4c;try{_0x522b8f['ws']['on'](_0x22b52e(0x174),async _0xe83d98=>{const _0x4e3d05=_0x22b52e,_0x20d0eb=_0xe83d98[_0x4e3d05(0x17d)][0x0];if(_0x20d0eb[_0x4e3d05(0x183)]==='terminate'){const _0x481324=await CompaniesSettings_1[_0x4e3d05(0x17a)][_0x4e3d05(0x193)]({'where':{'companyId':_0x143c0a}});if(_0x481324[_0x4e3d05(0x17c)]===_0x4e3d05(0x190)){await _0x522b8f[_0x4e3d05(0x19c)](_0xe83d98[_0x4e3d05(0x19e)][_0x4e3d05(0x196)],{'text':_0x4e3d05(0x16e)});const _0x5635b8=_0xe83d98[_0x4e3d05(0x19e)][_0x4e3d05(0x196)][_0x4e3d05(0x18b)](/\D/g,''),_0x4f53b4=await Contact_1['default']['findOne']({'where':{'companyId':_0x143c0a,'number':_0x5635b8}}),_0x4a01a9=await Ticket_1[_0x4e3d05(0x17a)]['findOne']({'where':{'contactId':_0x4f53b4['id'],'whatsappId':_0x522b8f['id'],'companyId':_0x143c0a}});if(!_0x4a01a9)return;const _0x7d65d9=new Date(),_0x5e7bb7=_0x7d65d9['getHours'](),_0x4d615c=_0x7d65d9[_0x4e3d05(0x18a)](),_0x1262d6=_0x4e3d05(0x178)+_0x5e7bb7+':'+_0x4d615c,_0x2b3437={'wid':_0x20d0eb[_0x4e3d05(0x19e)][_0x4e3d05(0x197)],'ticketId':_0x4a01a9['id'],'contactId':_0x4f53b4['id'],'body':_0x1262d6,'fromMe':![],'mediaType':'call_log','read':!![],'quotedMsgId':null,'ack':0x1};return await _0x4a01a9[_0x4e3d05(0x17b)]({'lastMessage':_0x1262d6}),_0x4a01a9[_0x4e3d05(0x189)]===_0x4e3d05(0x198)&&await _0x4a01a9['update']({'status':_0x4e3d05(0x180)}),(0x0,CreateMessageService_1[_0x4e3d05(0x17a)])({'messageData':_0x2b3437,'companyId':_0x143c0a});}}}),_0x522b8f['ev']['on'](_0x22b52e(0x186),async _0xddbd90=>{const _0x15ace2=_0x22b52e;await(0x0,CreateOrUpdateBaileysService_1[_0x15ace2(0x17a)])({'whatsappId':_0x14677a['id'],'contacts':_0xddbd90});});}catch(_0x5629f3){Sentry[_0x22b52e(0x19a)](_0x5629f3),logger_1[_0x22b52e(0x18f)][_0x22b52e(0x177)](_0x5629f3);}};exports[a570_0x296a4c(0x17a)]=wbotMonitor;