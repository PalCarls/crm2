'use strict';function a628_0x3054(){const _0x35dfba=['__setModuleDefault','DESC','../../models/Contact','hasOwnProperty','isJidBroadcast','get','2197308lXvORU','enabled','isJidStatusBroadcast','@sentry/node','all','5525051ZVAHXy','call_log','‎\x20*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitadas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','company','logger','configurable','121464jrBGYP','closed','sendMessage','13PflkSV','replace','attrs','public','stringify','../../models/Ticket','tag','call-id','35mWiXRv','97392HAbNxm','2229286jegZae','68UgYhMO','getMinutes','__importStar','__importDefault','join','pending','isJidUser','52150QBopWv','map','contactJson.txt','1mXwKmc','../../utils/logger','defineProperty','findOne','__createBinding','captureException','writeFile','459QdoWIi','158019cEunXM','log','split','unlinkSync','from','@whiskeysockets/baileys','../../models/CompaniesSettings','default','update','error','create','call','getHours','name','contacts.upsert','CB:call','1496ovMEvV','chmodSync','existsSync','writable','Erro\x20contacts.upsert:\x20','content','push','__esModule','acceptCallWhatsapp','getOwnPropertyDescriptor'];a628_0x3054=function(){return _0x35dfba;};return a628_0x3054();}const a628_0xbfc070=a628_0x2a17;(function(_0x2f5269,_0x5220e5){const _0x292521=a628_0x2a17,_0x17b013=_0x2f5269();while(!![]){try{const _0x445a79=parseInt(_0x292521(0x1b8))/0x1*(-parseInt(_0x292521(0x1f8))/0x2)+parseInt(_0x292521(0x1c0))/0x3*(parseInt(_0x292521(0x1f9))/0x4)+-parseInt(_0x292521(0x1f6))/0x5*(parseInt(_0x292521(0x1f7))/0x6)+parseInt(_0x292521(0x1e5))/0x7+-parseInt(_0x292521(0x1eb))/0x8*(parseInt(_0x292521(0x1bf))/0x9)+parseInt(_0x292521(0x1b5))/0xa*(parseInt(_0x292521(0x1d0))/0xb)+-parseInt(_0x292521(0x1e0))/0xc*(-parseInt(_0x292521(0x1ee))/0xd);if(_0x445a79===_0x5220e5)break;else _0x17b013['push'](_0x17b013['shift']());}catch(_0x31554d){_0x17b013['push'](_0x17b013['shift']());}}}(a628_0x3054,0x8c413));function a628_0x2a17(_0x549394,_0x55a0ae){const _0x30544f=a628_0x3054();return a628_0x2a17=function(_0x2a17f9,_0x1c324f){_0x2a17f9=_0x2a17f9-0x1b0;let _0x176b29=_0x30544f[_0x2a17f9];return _0x176b29;},a628_0x2a17(_0x549394,_0x55a0ae);}var __createBinding=this&&this[a628_0xbfc070(0x1bc)]||(Object[a628_0xbfc070(0x1ca)]?function(_0x22baa6,_0x531a3a,_0x2002e4,_0x415418){const _0x3457d5=a628_0xbfc070;if(_0x415418===undefined)_0x415418=_0x2002e4;var _0x74858=Object[_0x3457d5(0x1d9)](_0x531a3a,_0x2002e4);(!_0x74858||(_0x3457d5(0x1df)in _0x74858?!_0x531a3a[_0x3457d5(0x1d7)]:_0x74858[_0x3457d5(0x1d3)]||_0x74858[_0x3457d5(0x1ea)]))&&(_0x74858={'enumerable':!![],'get':function(){return _0x531a3a[_0x2002e4];}}),Object[_0x3457d5(0x1ba)](_0x22baa6,_0x415418,_0x74858);}:function(_0x334d75,_0x3870fa,_0x3ccdb8,_0x2fc046){if(_0x2fc046===undefined)_0x2fc046=_0x3ccdb8;_0x334d75[_0x2fc046]=_0x3870fa[_0x3ccdb8];}),__setModuleDefault=this&&this[a628_0xbfc070(0x1da)]||(Object[a628_0xbfc070(0x1ca)]?function(_0x2f44ba,_0x5c43d6){Object['defineProperty'](_0x2f44ba,'default',{'enumerable':!![],'value':_0x5c43d6});}:function(_0x1854f6,_0x8e78a2){const _0x2fb410=a628_0xbfc070;_0x1854f6[_0x2fb410(0x1c7)]=_0x8e78a2;}),__importStar=this&&this[a628_0xbfc070(0x1b0)]||function(_0x254b05){const _0x125da2=a628_0xbfc070;if(_0x254b05&&_0x254b05[_0x125da2(0x1d7)])return _0x254b05;var _0x8f96f={};if(_0x254b05!=null){for(var _0x5a2571 in _0x254b05)if(_0x5a2571!==_0x125da2(0x1c7)&&Object['prototype'][_0x125da2(0x1dd)][_0x125da2(0x1cb)](_0x254b05,_0x5a2571))__createBinding(_0x8f96f,_0x254b05,_0x5a2571);}return __setModuleDefault(_0x8f96f,_0x254b05),_0x8f96f;},__importDefault=this&&this[a628_0xbfc070(0x1b1)]||function(_0x1197f8){const _0x5283f8=a628_0xbfc070;return _0x1197f8&&_0x1197f8[_0x5283f8(0x1d7)]?_0x1197f8:{'default':_0x1197f8};};Object[a628_0xbfc070(0x1ba)](exports,a628_0xbfc070(0x1d7),{'value':!![]});const baileys_1=require(a628_0xbfc070(0x1c5)),Sentry=__importStar(require(a628_0xbfc070(0x1e3))),fs_1=__importDefault(require('fs')),Contact_1=__importDefault(require(a628_0xbfc070(0x1dc))),Ticket_1=__importDefault(require(a628_0xbfc070(0x1f3))),logger_1=require(a628_0xbfc070(0x1b9)),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),CompaniesSettings_1=__importDefault(require(a628_0xbfc070(0x1c6))),path_1=__importDefault(require('path'));let i=0x0;setInterval(()=>{i=0x0;},0x1388);const wbotMonitor=async(_0x36a30c,_0x163ea0,_0xa5242f)=>{const _0x5e45ab=a628_0xbfc070;try{_0x36a30c['ws']['on'](_0x5e45ab(0x1cf),async _0x3517b2=>{const _0x448759=_0x5e45ab,_0x3f4b7a=_0x3517b2[_0x448759(0x1d5)][0x0];await new Promise(_0x22cc0e=>setTimeout(_0x22cc0e,i*0x28a)),i++;if(_0x3f4b7a[_0x448759(0x1f4)]==='terminate'&&!_0x3517b2[_0x448759(0x1f0)][_0x448759(0x1c4)]['includes']('@call')){const _0x4ee4d5=await CompaniesSettings_1[_0x448759(0x1c7)][_0x448759(0x1bb)]({'where':{'companyId':_0xa5242f}});if(_0x4ee4d5[_0x448759(0x1d8)]===_0x448759(0x1e1)){await _0x36a30c[_0x448759(0x1ed)](_0x3517b2['attrs'][_0x448759(0x1c4)],{'text':_0x448759(0x1e7)});const _0x83082d=_0x3517b2[_0x448759(0x1f0)][_0x448759(0x1c4)][_0x448759(0x1c2)](':')[0x0][_0x448759(0x1ef)](/\D/g,''),_0x2e150c=await Contact_1[_0x448759(0x1c7)][_0x448759(0x1bb)]({'where':{'companyId':_0xa5242f,'number':_0x83082d}});if(!_0x2e150c)return;const _0x4c8a9c=await Ticket_1[_0x448759(0x1c7)][_0x448759(0x1bb)]({'where':{'contactId':_0x2e150c['id'],'whatsappId':_0x36a30c['id'],'companyId':_0xa5242f},'order':[['id',_0x448759(0x1db)]]});if(!_0x4c8a9c)return;const _0x47f26a=new Date(),_0x426fdd=_0x47f26a[_0x448759(0x1cc)](),_0x1dd9b7=_0x47f26a[_0x448759(0x1fa)](),_0x2cbe0a='Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20'+_0x426fdd+':'+_0x1dd9b7,_0x225e82={'wid':_0x3f4b7a[_0x448759(0x1f0)][_0x448759(0x1f5)],'ticketId':_0x4c8a9c['id'],'contactId':_0x2e150c['id'],'body':_0x2cbe0a,'fromMe':![],'mediaType':_0x448759(0x1e6),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x4c8a9c[_0x448759(0x1c8)]({'lastMessage':_0x2cbe0a}),_0x4c8a9c['status']===_0x448759(0x1ec)&&await _0x4c8a9c[_0x448759(0x1c8)]({'status':_0x448759(0x1b3)}),(0x0,CreateMessageService_1[_0x448759(0x1c7)])({'messageData':_0x225e82,'companyId':_0xa5242f});}}});function _0x2ff539(_0x40e6fe){return _0x40e6fe['replace'](/[\x00-\x1F"\\']/g,'');}_0x36a30c['ev']['on'](_0x5e45ab(0x1ce),async _0x959903=>{const _0x4f84d2=_0x5e45ab,_0x2cce85=[];try{Promise[_0x4f84d2(0x1e4)](_0x959903[_0x4f84d2(0x1b6)](async _0x365b0e=>{const _0x234ea0=_0x4f84d2;if(!(0x0,baileys_1[_0x234ea0(0x1de)])(_0x365b0e['id'])&&!(0x0,baileys_1[_0x234ea0(0x1e2)])(_0x365b0e['id'])&&(0x0,baileys_1[_0x234ea0(0x1b4)])(_0x365b0e['id'])){const _0x469719={'id':_0x365b0e['id'],'name':_0x365b0e[_0x234ea0(0x1cd)]?_0x2ff539(_0x365b0e[_0x234ea0(0x1cd)]):_0x365b0e['id'][_0x234ea0(0x1c2)]('@')[0x0]['split'](':')[0x0]};_0x2cce85[_0x234ea0(0x1d6)](_0x469719);}}));const _0x528331=path_1['default']['resolve'](__dirname,'..','..','..',_0x4f84d2(0x1f1));!fs_1[_0x4f84d2(0x1c7)][_0x4f84d2(0x1d2)](path_1[_0x4f84d2(0x1c7)][_0x4f84d2(0x1b2)](_0x528331,'company'+_0xa5242f))&&(fs_1[_0x4f84d2(0x1c7)]['mkdirSync'](path_1[_0x4f84d2(0x1c7)][_0x4f84d2(0x1b2)](_0x528331,_0x4f84d2(0x1e8)+_0xa5242f),{'recursive':!![]}),fs_1[_0x4f84d2(0x1c7)][_0x4f84d2(0x1d1)](path_1[_0x4f84d2(0x1c7)]['join'](_0x528331,_0x4f84d2(0x1e8)+_0xa5242f),0x1ff));const _0x4d4e2e=path_1[_0x4f84d2(0x1c7)][_0x4f84d2(0x1b2)](_0x528331,_0x4f84d2(0x1e8)+_0xa5242f,_0x4f84d2(0x1b7));fs_1[_0x4f84d2(0x1c7)][_0x4f84d2(0x1d2)](_0x4d4e2e)&&await fs_1[_0x4f84d2(0x1c7)][_0x4f84d2(0x1c3)](_0x4d4e2e),await fs_1['default']['promises'][_0x4f84d2(0x1be)](_0x4d4e2e,JSON[_0x4f84d2(0x1f2)](_0x2cce85,null,0x2)),console[_0x4f84d2(0x1c1)](_0x2cce85);}catch(_0x469f24){Sentry[_0x4f84d2(0x1bd)](_0x469f24),logger_1[_0x4f84d2(0x1e9)][_0x4f84d2(0x1c9)](_0x4f84d2(0x1d4)+JSON[_0x4f84d2(0x1f2)](_0x469f24));}try{await(0x0,CreateOrUpdateBaileysService_1[_0x4f84d2(0x1c7)])({'whatsappId':_0x163ea0['id'],'contacts':_0x2cce85});}catch(_0x45c7bc){logger_1[_0x4f84d2(0x1e9)][_0x4f84d2(0x1c9)](_0x45c7bc);}});}catch(_0x943c2){Sentry[_0x5e45ab(0x1bd)](_0x943c2),logger_1['logger']['error'](_0x943c2);}};exports[a628_0xbfc070(0x1c7)]=wbotMonitor;