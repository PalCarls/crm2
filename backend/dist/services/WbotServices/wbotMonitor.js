'use strict';function a553_0x96bd(_0x2996fb,_0x3b66b7){const _0x1fa13c=a553_0x1fa1();return a553_0x96bd=function(_0x96bd18,_0x50b28f){_0x96bd18=_0x96bd18-0xb5;let _0x44c4be=_0x1fa13c[_0x96bd18];return _0x44c4be;},a553_0x96bd(_0x2996fb,_0x3b66b7);}function a553_0x1fa1(){const _0x118a00=['error','status','3GNBvXO','5415416hSsici','__importStar','1763868ewUTUL','get','configurable','getMinutes','content','default','../../models/Ticket','4430937GznCfa','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','getOwnPropertyDescriptor','update','findOne','call_log','pending','hasOwnProperty','contacts.upsert','closed','__esModule','@sentry/node','value','../BaileysServices/CreateOrUpdateBaileysService','12360jsuPKJ','captureException','CB:call','7767500ICSkiV','create','__setModuleDefault','47545232qPiaRp','disabled','prototype','defineProperty','sendMessage','from','writable','attrs','acceptCallWhatsapp','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','tag','2101338aJPLzq'];a553_0x1fa1=function(){return _0x118a00;};return a553_0x1fa1();}const a553_0x34b8cf=a553_0x96bd;(function(_0x42e0fc,_0xf8df1a){const _0x24d3ca=a553_0x96bd,_0x226b69=_0x42e0fc();while(!![]){try{const _0x468e97=-parseInt(_0x24d3ca(0xc4))/0x1+parseInt(_0x24d3ca(0xd9))/0x2*(-parseInt(_0x24d3ca(0xc1))/0x3)+-parseInt(_0x24d3ca(0xc2))/0x4+-parseInt(_0x24d3ca(0xdc))/0x5+parseInt(_0x24d3ca(0xbe))/0x6+-parseInt(_0x24d3ca(0xcb))/0x7+parseInt(_0x24d3ca(0xdf))/0x8;if(_0x468e97===_0xf8df1a)break;else _0x226b69['push'](_0x226b69['shift']());}catch(_0x29c81e){_0x226b69['push'](_0x226b69['shift']());}}}(a553_0x1fa1,0xeffc8));var __createBinding=this&&this['__createBinding']||(Object[a553_0x34b8cf(0xdd)]?function(_0x524905,_0x5857c1,_0xcc1b7c,_0x27c293){const _0x1a916c=a553_0x34b8cf;if(_0x27c293===undefined)_0x27c293=_0xcc1b7c;var _0x4f3c1f=Object[_0x1a916c(0xcd)](_0x5857c1,_0xcc1b7c);(!_0x4f3c1f||(_0x1a916c(0xc5)in _0x4f3c1f?!_0x5857c1[_0x1a916c(0xd5)]:_0x4f3c1f[_0x1a916c(0xb9)]||_0x4f3c1f[_0x1a916c(0xc6)]))&&(_0x4f3c1f={'enumerable':!![],'get':function(){return _0x5857c1[_0xcc1b7c];}}),Object[_0x1a916c(0xb6)](_0x524905,_0x27c293,_0x4f3c1f);}:function(_0x4659c5,_0x10e265,_0x29424a,_0x2d9142){if(_0x2d9142===undefined)_0x2d9142=_0x29424a;_0x4659c5[_0x2d9142]=_0x10e265[_0x29424a];}),__setModuleDefault=this&&this[a553_0x34b8cf(0xde)]||(Object[a553_0x34b8cf(0xdd)]?function(_0x3d02cc,_0x243e9a){const _0x5e23bb=a553_0x34b8cf;Object[_0x5e23bb(0xb6)](_0x3d02cc,_0x5e23bb(0xc9),{'enumerable':!![],'value':_0x243e9a});}:function(_0x1cc57a,_0xe4ea92){const _0xd06e4d=a553_0x34b8cf;_0x1cc57a[_0xd06e4d(0xc9)]=_0xe4ea92;}),__importStar=this&&this[a553_0x34b8cf(0xc3)]||function(_0x32be9d){const _0x118090=a553_0x34b8cf;if(_0x32be9d&&_0x32be9d['__esModule'])return _0x32be9d;var _0x1bda10={};if(_0x32be9d!=null){for(var _0x5324c6 in _0x32be9d)if(_0x5324c6!==_0x118090(0xc9)&&Object[_0x118090(0xb5)][_0x118090(0xd2)]['call'](_0x32be9d,_0x5324c6))__createBinding(_0x1bda10,_0x32be9d,_0x5324c6);}return __setModuleDefault(_0x1bda10,_0x32be9d),_0x1bda10;},__importDefault=this&&this['__importDefault']||function(_0x96afe){const _0x37aba0=a553_0x34b8cf;return _0x96afe&&_0x96afe[_0x37aba0(0xd5)]?_0x96afe:{'default':_0x96afe};};Object[a553_0x34b8cf(0xb6)](exports,'__esModule',{'value':!![]});const Sentry=__importStar(require(a553_0x34b8cf(0xd6))),Contact_1=__importDefault(require('../../models/Contact')),Setting_1=__importDefault(require('../../models/Setting')),Ticket_1=__importDefault(require(a553_0x34b8cf(0xca))),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require(a553_0x34b8cf(0xd8))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),wbotMonitor=async(_0x577924,_0xde4ad,_0x2a3c5d)=>{const _0x450b89=a553_0x34b8cf;try{_0x577924['ws']['on'](_0x450b89(0xdb),async _0x5e996f=>{const _0x5aab6f=_0x450b89,_0x346ab2=_0x5e996f[_0x5aab6f(0xc8)][0x0];if(_0x346ab2[_0x5aab6f(0xbd)]==='terminate'){const _0x2b5925=await Setting_1[_0x5aab6f(0xc9)][_0x5aab6f(0xcf)]({'where':{'key':_0x5aab6f(0xbb),'companyId':_0x2a3c5d}});if(_0x2b5925[_0x5aab6f(0xd7)]===_0x5aab6f(0xe0)){await _0x577924[_0x5aab6f(0xb7)](_0x5e996f[_0x5aab6f(0xba)][_0x5aab6f(0xb8)],{'text':_0x5aab6f(0xcc)});const _0xdfe7e4=_0x5e996f['attrs'][_0x5aab6f(0xb8)]['replace'](/\D/g,''),_0x5cfc4d=await Contact_1['default'][_0x5aab6f(0xcf)]({'where':{'companyId':_0x2a3c5d,'number':_0xdfe7e4}}),_0x49797c=await Ticket_1[_0x5aab6f(0xc9)]['findOne']({'where':{'contactId':_0x5cfc4d['id'],'whatsappId':_0x577924['id'],'companyId':_0x2a3c5d}});if(!_0x49797c)return;const _0x7682c1=new Date(),_0x1347a7=_0x7682c1['getHours'](),_0x4f58a0=_0x7682c1[_0x5aab6f(0xc7)](),_0xb3b8d1=_0x5aab6f(0xbc)+_0x1347a7+':'+_0x4f58a0,_0x1b0f58={'wid':_0x346ab2[_0x5aab6f(0xba)]['call-id'],'ticketId':_0x49797c['id'],'contactId':_0x5cfc4d['id'],'body':_0xb3b8d1,'fromMe':![],'mediaType':_0x5aab6f(0xd0),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x49797c[_0x5aab6f(0xce)]({'lastMessage':_0xb3b8d1}),_0x49797c[_0x5aab6f(0xc0)]===_0x5aab6f(0xd4)&&await _0x49797c[_0x5aab6f(0xce)]({'status':_0x5aab6f(0xd1)}),(0x0,CreateMessageService_1[_0x5aab6f(0xc9)])({'messageData':_0x1b0f58,'companyId':_0x2a3c5d});}}}),_0x577924['ev']['on'](_0x450b89(0xd3),async _0x3a82d2=>{const _0x307ce6=_0x450b89;await(0x0,CreateOrUpdateBaileysService_1[_0x307ce6(0xc9)])({'whatsappId':_0xde4ad['id'],'contacts':_0x3a82d2});});}catch(_0xac6f94){Sentry[_0x450b89(0xda)](_0xac6f94),logger_1['logger'][_0x450b89(0xbf)](_0xac6f94);}};exports[a553_0x34b8cf(0xc9)]=wbotMonitor;