'use strict';const a517_0x1f8ed6=a517_0xfe81;function a517_0xfe81(_0x18d7ed,_0x12598b){const _0x364c69=a517_0x364c();return a517_0xfe81=function(_0xfe81fa,_0x3cfc89){_0xfe81fa=_0xfe81fa-0xd1;let _0x35831c=_0x364c69[_0xfe81fa];return _0x35831c;},a517_0xfe81(_0x18d7ed,_0x12598b);}(function(_0x103b14,_0x5846fa){const _0x16304a=a517_0xfe81,_0x58ee25=_0x103b14();while(!![]){try{const _0x2235d8=parseInt(_0x16304a(0xef))/0x1+-parseInt(_0x16304a(0xf7))/0x2+parseInt(_0x16304a(0xda))/0x3*(parseInt(_0x16304a(0xdc))/0x4)+parseInt(_0x16304a(0xeb))/0x5+-parseInt(_0x16304a(0xd1))/0x6*(parseInt(_0x16304a(0xe1))/0x7)+parseInt(_0x16304a(0x104))/0x8*(parseInt(_0x16304a(0xfa))/0x9)+-parseInt(_0x16304a(0xdf))/0xa;if(_0x2235d8===_0x5846fa)break;else _0x58ee25['push'](_0x58ee25['shift']());}catch(_0x131e07){_0x58ee25['push'](_0x58ee25['shift']());}}}(a517_0x364c,0x9276b));function a517_0x364c(){const _0x3213ba=['\x20is\x20calling\x20you\x20with\x20id\x20','getHours','call_log','default','prototype','attrs','4667705LebIQx','@sentry/node','defineProperty','replace','902486aqDecz','enabled','closed','contacts.upsert','*Mensagem\x20Automática:*\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x0a\x0aObrigado!','terminate','writable','getMinutes','2238608mFVrLc','content','pending','18zAavbM','findOne','from','__importStar','sendMessage','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','error','__esModule','__createBinding','../../models/Contact','2592656YmgJif','318HDrRAm','configurable','tag','value','log','../../models/Ticket','status','__importDefault','../../models/Setting','3ERXyuU','logger','319756MAcWdK','CB:call','update','2026040JfYvMj','call','84833nhzvFC','../MessageServices/CreateMessageService','create','../../utils/logger'];a517_0x364c=function(){return _0x3213ba;};return a517_0x364c();}var __createBinding=this&&this[a517_0x1f8ed6(0x102)]||(Object[a517_0x1f8ed6(0xe3)]?function(_0x485cb5,_0x5df475,_0x1c6e4e,_0x1ee6da){const _0x2b3926=a517_0x1f8ed6;if(_0x1ee6da===undefined)_0x1ee6da=_0x1c6e4e;var _0x5c21a6=Object['getOwnPropertyDescriptor'](_0x5df475,_0x1c6e4e);(!_0x5c21a6||('get'in _0x5c21a6?!_0x5df475[_0x2b3926(0x101)]:_0x5c21a6[_0x2b3926(0xf5)]||_0x5c21a6[_0x2b3926(0xd2)]))&&(_0x5c21a6={'enumerable':!![],'get':function(){return _0x5df475[_0x1c6e4e];}}),Object[_0x2b3926(0xed)](_0x485cb5,_0x1ee6da,_0x5c21a6);}:function(_0x327164,_0x3e0ca6,_0x31c794,_0xff37f1){if(_0xff37f1===undefined)_0xff37f1=_0x31c794;_0x327164[_0xff37f1]=_0x3e0ca6[_0x31c794];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a517_0x1f8ed6(0xe3)]?function(_0x14ca34,_0x2eb7d9){const _0x558925=a517_0x1f8ed6;Object[_0x558925(0xed)](_0x14ca34,_0x558925(0xe8),{'enumerable':!![],'value':_0x2eb7d9});}:function(_0x455bf6,_0x41e999){const _0x55ffa5=a517_0x1f8ed6;_0x455bf6[_0x55ffa5(0xe8)]=_0x41e999;}),__importStar=this&&this[a517_0x1f8ed6(0xfd)]||function(_0x8f3c30){const _0x1854c3=a517_0x1f8ed6;if(_0x8f3c30&&_0x8f3c30[_0x1854c3(0x101)])return _0x8f3c30;var _0x50af78={};if(_0x8f3c30!=null){for(var _0x142bef in _0x8f3c30)if(_0x142bef!==_0x1854c3(0xe8)&&Object[_0x1854c3(0xe9)]['hasOwnProperty'][_0x1854c3(0xe0)](_0x8f3c30,_0x142bef))__createBinding(_0x50af78,_0x8f3c30,_0x142bef);}return __setModuleDefault(_0x50af78,_0x8f3c30),_0x50af78;},__importDefault=this&&this[a517_0x1f8ed6(0xd8)]||function(_0x471115){const _0x2d3b9e=a517_0x1f8ed6;return _0x471115&&_0x471115[_0x2d3b9e(0x101)]?_0x471115:{'default':_0x471115};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const Sentry=__importStar(require(a517_0x1f8ed6(0xec))),Setting_1=__importDefault(require(a517_0x1f8ed6(0xd9))),Ticket_1=__importDefault(require(a517_0x1f8ed6(0xd6))),Contact_1=__importDefault(require(a517_0x1f8ed6(0x103))),logger_1=require(a517_0x1f8ed6(0xe4)),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require(a517_0x1f8ed6(0xe2))),wbotMonitor=async(_0x1a25f4,_0x53ef83,_0x39a52a)=>{const _0x208ecd=a517_0x1f8ed6;try{_0x1a25f4['ws']['on'](_0x208ecd(0xdd),async _0x35e16b=>{const _0x14e088=_0x208ecd,_0x2d7fdb=_0x35e16b[_0x14e088(0xf8)][0x0];if(_0x2d7fdb['tag']==='offer'){const {from:_0x5a48ea,id:_0x170a57}=_0x35e16b[_0x14e088(0xea)];console[_0x14e088(0xd5)](_0x5a48ea+_0x14e088(0xe5)+_0x170a57);}if(_0x2d7fdb[_0x14e088(0xd3)]===_0x14e088(0xf4)){const _0x364d5a=await Setting_1[_0x14e088(0xe8)][_0x14e088(0xfb)]({'where':{'key':'acceptCallWhatsapp','companyId':_0x39a52a}});if(_0x364d5a?.[_0x14e088(0xd4)]===_0x14e088(0xf0)){await _0x1a25f4[_0x14e088(0xfe)](_0x35e16b[_0x14e088(0xea)][_0x14e088(0xfc)],{'text':_0x14e088(0xf3)});const _0x287399=_0x35e16b[_0x14e088(0xea)]['from'][_0x14e088(0xee)](/\D/g,''),_0xc223fb=await Contact_1[_0x14e088(0xe8)][_0x14e088(0xfb)]({'where':{'number':_0x287399,'companyId':_0x39a52a}}),_0x11aa4f=await Ticket_1['default'][_0x14e088(0xfb)]({'where':{'contactId':_0xc223fb['id'],'whatsappId':_0x1a25f4['id'],'companyId':_0x39a52a}});if(!_0x11aa4f)return;const _0xb645eb=new Date(),_0x209287=_0xb645eb[_0x14e088(0xe6)](),_0x237a3c=_0xb645eb[_0x14e088(0xf6)](),_0x3a015d=_0x14e088(0xff)+_0x209287+':'+_0x237a3c,_0x30b0c7={'wid':_0x2d7fdb['attrs']['call-id'],'ticketId':_0x11aa4f['id'],'contactId':_0xc223fb['id'],'body':_0x3a015d,'fromMe':![],'mediaType':_0x14e088(0xe7),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x11aa4f['update']({'lastMessage':_0x3a015d}),_0x11aa4f[_0x14e088(0xd7)]===_0x14e088(0xf1)&&await _0x11aa4f[_0x14e088(0xde)]({'status':_0x14e088(0xf9)}),(0x0,CreateMessageService_1[_0x14e088(0xe8)])({'messageData':_0x30b0c7,'companyId':_0x39a52a});}}}),_0x1a25f4['ev']['on'](_0x208ecd(0xf2),async _0x3f4992=>{await(0x0,CreateOrUpdateBaileysService_1['default'])({'whatsappId':_0x53ef83['id'],'contacts':_0x3f4992});});}catch(_0x1e6b77){Sentry['captureException'](_0x1e6b77),logger_1[_0x208ecd(0xdb)][_0x208ecd(0x100)](_0x1e6b77);}};exports[a517_0x1f8ed6(0xe8)]=wbotMonitor;