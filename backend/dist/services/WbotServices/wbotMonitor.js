'use strict';const a616_0x5d4f5b=a616_0x5d17;(function(_0x4f0f03,_0x3f86ed){const _0x800da2=a616_0x5d17,_0x243dbf=_0x4f0f03();while(!![]){try{const _0x17f25e=-parseInt(_0x800da2(0x1e4))/0x1*(-parseInt(_0x800da2(0x1f5))/0x2)+-parseInt(_0x800da2(0x1e8))/0x3*(parseInt(_0x800da2(0x1e1))/0x4)+parseInt(_0x800da2(0x1e7))/0x5*(-parseInt(_0x800da2(0x207))/0x6)+parseInt(_0x800da2(0x1fb))/0x7*(parseInt(_0x800da2(0x215))/0x8)+-parseInt(_0x800da2(0x1e9))/0x9*(-parseInt(_0x800da2(0x20b))/0xa)+parseInt(_0x800da2(0x1f7))/0xb+-parseInt(_0x800da2(0x1eb))/0xc*(-parseInt(_0x800da2(0x209))/0xd);if(_0x17f25e===_0x3f86ed)break;else _0x243dbf['push'](_0x243dbf['shift']());}catch(_0x528403){_0x243dbf['push'](_0x243dbf['shift']());}}}(a616_0x3ed5,0x3ce65));function a616_0x5d17(_0x537600,_0x38949b){const _0x3ed5f5=a616_0x3ed5();return a616_0x5d17=function(_0x5d17d9,_0x2e0737){_0x5d17d9=_0x5d17d9-0x1e1;let _0x46f83a=_0x3ed5f5[_0x5d17d9];return _0x46f83a;},a616_0x5d17(_0x537600,_0x38949b);}var __createBinding=this&&this[a616_0x5d4f5b(0x20f)]||(Object['create']?function(_0xad65c1,_0x8324c0,_0xfb6ea4,_0x19f652){const _0x30ddb1=a616_0x5d4f5b;if(_0x19f652===undefined)_0x19f652=_0xfb6ea4;var _0x27b4d0=Object['getOwnPropertyDescriptor'](_0x8324c0,_0xfb6ea4);(!_0x27b4d0||(_0x30ddb1(0x205)in _0x27b4d0?!_0x8324c0[_0x30ddb1(0x1ed)]:_0x27b4d0[_0x30ddb1(0x1ec)]||_0x27b4d0[_0x30ddb1(0x208)]))&&(_0x27b4d0={'enumerable':!![],'get':function(){return _0x8324c0[_0xfb6ea4];}}),Object[_0x30ddb1(0x1f6)](_0xad65c1,_0x19f652,_0x27b4d0);}:function(_0x1c61aa,_0x2c683e,_0x4eafc8,_0x9a262c){if(_0x9a262c===undefined)_0x9a262c=_0x4eafc8;_0x1c61aa[_0x9a262c]=_0x2c683e[_0x4eafc8];}),__setModuleDefault=this&&this[a616_0x5d4f5b(0x1f3)]||(Object[a616_0x5d4f5b(0x212)]?function(_0x30b7aa,_0x57627c){const _0x7feff5=a616_0x5d4f5b;Object[_0x7feff5(0x1f6)](_0x30b7aa,_0x7feff5(0x1f0),{'enumerable':!![],'value':_0x57627c});}:function(_0x1d69bb,_0x48b060){const _0x3ad613=a616_0x5d4f5b;_0x1d69bb[_0x3ad613(0x1f0)]=_0x48b060;}),__importStar=this&&this[a616_0x5d4f5b(0x219)]||function(_0x28c493){const _0x3d7f51=a616_0x5d4f5b;if(_0x28c493&&_0x28c493['__esModule'])return _0x28c493;var _0x35d677={};if(_0x28c493!=null){for(var _0x1e6350 in _0x28c493)if(_0x1e6350!==_0x3d7f51(0x1f0)&&Object[_0x3d7f51(0x1f4)][_0x3d7f51(0x1fe)][_0x3d7f51(0x201)](_0x28c493,_0x1e6350))__createBinding(_0x35d677,_0x28c493,_0x1e6350);}return __setModuleDefault(_0x35d677,_0x28c493),_0x35d677;},__importDefault=this&&this['__importDefault']||function(_0x20b956){const _0x410c99=a616_0x5d4f5b;return _0x20b956&&_0x20b956[_0x410c99(0x1ed)]?_0x20b956:{'default':_0x20b956};};function a616_0x3ed5(){const _0x5c3fad=['tag','346660OKfNJz','enabled','../../models/Contact','sendMessage','__createBinding','acceptCallWhatsapp','push','create','all','split','56hPAwZh','findOne','replace','map','__importStar','getMinutes','update','‎\x20*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitadas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','108BFonkj','closed','includes','36650YhRCza','call_log','contacts.upsert','243550xttFXG','43404TyRaau','72GCACDb','Erro\x20contacts.upsert:\x20','96LNdMKk','writable','__esModule','pending','terminate','default','../BaileysServices/CreateOrUpdateBaileysService','logger','__setModuleDefault','prototype','4qaaaWT','defineProperty','1165901voEOHP','attrs','isJidStatusBroadcast','isJidUser','154714kdIItQ','from','isJidBroadcast','hasOwnProperty','../../models/CompaniesSettings','DESC','call','error','@call','name','get','captureException','60NOfhCO','configurable','838253rewnCU'];a616_0x3ed5=function(){return _0x5c3fad;};return a616_0x3ed5();}Object[a616_0x5d4f5b(0x1f6)](exports,a616_0x5d4f5b(0x1ed),{'value':!![]});const baileys_1=require('@whiskeysockets/baileys'),Sentry=__importStar(require('@sentry/node')),Contact_1=__importDefault(require(a616_0x5d4f5b(0x20d))),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require(a616_0x5d4f5b(0x1f1))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),CompaniesSettings_1=__importDefault(require(a616_0x5d4f5b(0x1ff)));let i=0x0;setInterval(()=>{i=0x0;},0x1388);const wbotMonitor=async(_0x421086,_0x5af889,_0x3b1bb0)=>{const _0xdc6ce8=a616_0x5d4f5b;try{_0x421086['ws']['on']('CB:call',async _0x10f1c4=>{const _0x494f6b=a616_0x5d17,_0x353f37=_0x10f1c4['content'][0x0];await new Promise(_0x36f362=>setTimeout(_0x36f362,i*0x28a)),i++;if(_0x353f37[_0x494f6b(0x20a)]===_0x494f6b(0x1ef)&&!_0x10f1c4[_0x494f6b(0x1f8)][_0x494f6b(0x1fc)][_0x494f6b(0x1e3)](_0x494f6b(0x203))){const _0x4e6827=await CompaniesSettings_1[_0x494f6b(0x1f0)][_0x494f6b(0x216)]({'where':{'companyId':_0x3b1bb0}});if(_0x4e6827[_0x494f6b(0x210)]===_0x494f6b(0x20c)){await _0x421086[_0x494f6b(0x20e)](_0x10f1c4[_0x494f6b(0x1f8)][_0x494f6b(0x1fc)],{'text':_0x494f6b(0x21c)});const _0x17f678=_0x10f1c4[_0x494f6b(0x1f8)][_0x494f6b(0x1fc)][_0x494f6b(0x214)](':')[0x0]['replace'](/\D/g,''),_0x5575dc=await Contact_1[_0x494f6b(0x1f0)][_0x494f6b(0x216)]({'where':{'companyId':_0x3b1bb0,'number':_0x17f678}}),_0x238c9c=await Ticket_1[_0x494f6b(0x1f0)][_0x494f6b(0x216)]({'where':{'contactId':_0x5575dc['id'],'whatsappId':_0x421086['id'],'companyId':_0x3b1bb0},'order':[['id',_0x494f6b(0x200)]]});if(!_0x238c9c)return;const _0xfa003=new Date(),_0x348bb8=_0xfa003['getHours'](),_0x1403b3=_0xfa003[_0x494f6b(0x21a)](),_0x4469f4='Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20'+_0x348bb8+':'+_0x1403b3,_0x13cc1c={'wid':_0x353f37[_0x494f6b(0x1f8)]['call-id'],'ticketId':_0x238c9c['id'],'contactId':_0x5575dc['id'],'body':_0x4469f4,'fromMe':![],'mediaType':_0x494f6b(0x1e5),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x238c9c[_0x494f6b(0x21b)]({'lastMessage':_0x4469f4}),_0x238c9c['status']===_0x494f6b(0x1e2)&&await _0x238c9c['update']({'status':_0x494f6b(0x1ee)}),(0x0,CreateMessageService_1[_0x494f6b(0x1f0)])({'messageData':_0x13cc1c,'companyId':_0x3b1bb0});}}});function _0x187129(_0x5495f4){const _0x46b70c=a616_0x5d17;return _0x5495f4[_0x46b70c(0x217)](/[\x00-\x1F"\\']/g,'');}_0x421086['ev']['on'](_0xdc6ce8(0x1e6),async _0x55f5e1=>{const _0x2b680c=_0xdc6ce8,_0x503f73=[];try{Promise[_0x2b680c(0x213)](_0x55f5e1[_0x2b680c(0x218)](async _0x3bdff2=>{const _0x8b2e50=_0x2b680c;if(!(0x0,baileys_1[_0x8b2e50(0x1fd)])(_0x3bdff2['id'])&&!(0x0,baileys_1[_0x8b2e50(0x1f9)])(_0x3bdff2['id'])&&(0x0,baileys_1[_0x8b2e50(0x1fa)])(_0x3bdff2['id'])){const _0x3ec270={'id':_0x3bdff2['id'],'name':_0x3bdff2[_0x8b2e50(0x204)]?_0x187129(_0x3bdff2[_0x8b2e50(0x204)]):_0x3bdff2['id']['split']('@')[0x0][_0x8b2e50(0x214)](':')[0x0]};_0x503f73[_0x8b2e50(0x211)](_0x3ec270);}}));}catch(_0x297ac4){Sentry[_0x2b680c(0x206)](_0x297ac4),logger_1[_0x2b680c(0x1f2)][_0x2b680c(0x202)](_0x2b680c(0x1ea)+JSON['stringify'](_0x297ac4));}try{await(0x0,CreateOrUpdateBaileysService_1[_0x2b680c(0x1f0)])({'whatsappId':_0x5af889['id'],'contacts':_0x503f73});}catch(_0x264b5c){logger_1['logger']['error'](_0x264b5c);}});}catch(_0x2a4bdb){Sentry['captureException'](_0x2a4bdb),logger_1['logger'][_0xdc6ce8(0x202)](_0x2a4bdb);}};exports[a616_0x5d4f5b(0x1f0)]=wbotMonitor;