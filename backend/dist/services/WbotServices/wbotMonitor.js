'use strict';const a616_0x582706=a616_0x1746;(function(_0xf4605b,_0x23f0b2){const _0x4a9e3f=a616_0x1746,_0x5ae469=_0xf4605b();while(!![]){try{const _0x1cbe46=parseInt(_0x4a9e3f(0xe9))/0x1*(-parseInt(_0x4a9e3f(0x104))/0x2)+-parseInt(_0x4a9e3f(0x115))/0x3+parseInt(_0x4a9e3f(0x10e))/0x4+-parseInt(_0x4a9e3f(0xeb))/0x5*(-parseInt(_0x4a9e3f(0x10a))/0x6)+parseInt(_0x4a9e3f(0xe1))/0x7*(parseInt(_0x4a9e3f(0xef))/0x8)+-parseInt(_0x4a9e3f(0x100))/0x9*(parseInt(_0x4a9e3f(0xe8))/0xa)+-parseInt(_0x4a9e3f(0x111))/0xb*(parseInt(_0x4a9e3f(0xfa))/0xc);if(_0x1cbe46===_0x23f0b2)break;else _0x5ae469['push'](_0x5ae469['shift']());}catch(_0x24f3e5){_0x5ae469['push'](_0x5ae469['shift']());}}}(a616_0x4e25,0x2f05c));function a616_0x4e25(){const _0x11843d=['isJidUser','413538FgHmvC','../BaileysServices/CreateOrUpdateBaileysService','error','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','terminate','DESC','writable','hasOwnProperty','../../models/CompaniesSettings','@whiskeysockets/baileys','183687fudmFl','status','stringify','all','default','logger','@call','2870Tavosp','18026pnqjPz','create','55ByjnSv','CB:call','attrs','get','24VIYWBq','call-id','name','update','__importStar','../../models/Ticket','configurable','from','__esModule','__createBinding','../../models/Contact','2898516fEOBQY','captureException','push','call_log','../../utils/logger','tag','4113mQfAWV','getOwnPropertyDescriptor','split','findOne','2ejVmOd','contacts.upsert','isJidStatusBroadcast','__importDefault','pending','getHours','170274ukYZfp','getMinutes','sendMessage','@sentry/node','1321144Uolnfp','defineProperty','map','11xITcAF','closed','replace'];a616_0x4e25=function(){return _0x11843d;};return a616_0x4e25();}function a616_0x1746(_0x5ab61e,_0x4aeae1){const _0x4e259a=a616_0x4e25();return a616_0x1746=function(_0x174653,_0x1f491e){_0x174653=_0x174653-0xdf;let _0x45bf1a=_0x4e259a[_0x174653];return _0x45bf1a;},a616_0x1746(_0x5ab61e,_0x4aeae1);}var __createBinding=this&&this[a616_0x582706(0xf8)]||(Object[a616_0x582706(0xea)]?function(_0x261990,_0x4a129f,_0x2de8c0,_0x4326e4){const _0x5124e7=a616_0x582706;if(_0x4326e4===undefined)_0x4326e4=_0x2de8c0;var _0x274fed=Object[_0x5124e7(0x101)](_0x4a129f,_0x2de8c0);(!_0x274fed||(_0x5124e7(0xee)in _0x274fed?!_0x4a129f[_0x5124e7(0xf7)]:_0x274fed[_0x5124e7(0x11b)]||_0x274fed[_0x5124e7(0xf5)]))&&(_0x274fed={'enumerable':!![],'get':function(){return _0x4a129f[_0x2de8c0];}}),Object['defineProperty'](_0x261990,_0x4326e4,_0x274fed);}:function(_0x95c450,_0x31c471,_0x1c7724,_0x1e3bd1){if(_0x1e3bd1===undefined)_0x1e3bd1=_0x1c7724;_0x95c450[_0x1e3bd1]=_0x31c471[_0x1c7724];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a616_0x582706(0xea)]?function(_0x16c042,_0x53a1dd){const _0x2f384e=a616_0x582706;Object[_0x2f384e(0x10f)](_0x16c042,_0x2f384e(0xe5),{'enumerable':!![],'value':_0x53a1dd});}:function(_0x15ab79,_0x4352dd){const _0x1f93b9=a616_0x582706;_0x15ab79[_0x1f93b9(0xe5)]=_0x4352dd;}),__importStar=this&&this[a616_0x582706(0xf3)]||function(_0x199755){const _0x5066cc=a616_0x582706;if(_0x199755&&_0x199755[_0x5066cc(0xf7)])return _0x199755;var _0x3d430b={};if(_0x199755!=null){for(var _0x32c251 in _0x199755)if(_0x32c251!==_0x5066cc(0xe5)&&Object['prototype'][_0x5066cc(0x11c)]['call'](_0x199755,_0x32c251))__createBinding(_0x3d430b,_0x199755,_0x32c251);}return __setModuleDefault(_0x3d430b,_0x199755),_0x3d430b;},__importDefault=this&&this[a616_0x582706(0x107)]||function(_0x177889){const _0x4e4a7=a616_0x582706;return _0x177889&&_0x177889[_0x4e4a7(0xf7)]?_0x177889:{'default':_0x177889};};Object[a616_0x582706(0x10f)](exports,a616_0x582706(0xf7),{'value':!![]});const baileys_1=require(a616_0x582706(0xe0)),Sentry=__importStar(require(a616_0x582706(0x10d))),Contact_1=__importDefault(require(a616_0x582706(0xf9))),Ticket_1=__importDefault(require(a616_0x582706(0xf4))),logger_1=require(a616_0x582706(0xfe)),CreateOrUpdateBaileysService_1=__importDefault(require(a616_0x582706(0x116))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),CompaniesSettings_1=__importDefault(require(a616_0x582706(0xdf)));let i=0x0;setInterval(()=>{i=0x0;},0x1388);const wbotMonitor=async(_0x52ab59,_0x170318,_0x22afd9)=>{const _0x83f707=a616_0x582706;try{_0x52ab59['ws']['on'](_0x83f707(0xec),async _0xcef9f=>{const _0x5da940=_0x83f707,_0x4dc2d8=_0xcef9f['content'][0x0];await new Promise(_0x7f0e2d=>setTimeout(_0x7f0e2d,i*0x28a)),i++;if(_0x4dc2d8[_0x5da940(0xff)]===_0x5da940(0x119)&&!_0xcef9f['attrs'][_0x5da940(0xf6)]['includes'](_0x5da940(0xe7))){const _0x31fa2e=await CompaniesSettings_1['default'][_0x5da940(0x103)]({'where':{'companyId':_0x22afd9}});if(_0x31fa2e['acceptCallWhatsapp']==='enabled'){await _0x52ab59[_0x5da940(0x10c)](_0xcef9f['attrs'][_0x5da940(0xf6)],{'text':'‎\x20*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitadas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado'});const _0x3df14d=_0xcef9f[_0x5da940(0xed)][_0x5da940(0xf6)]['split'](':')[0x0][_0x5da940(0x113)](/\D/g,''),_0x3aac1c=await Contact_1[_0x5da940(0xe5)][_0x5da940(0x103)]({'where':{'companyId':_0x22afd9,'number':_0x3df14d}}),_0x34c3c5=await Ticket_1['default'][_0x5da940(0x103)]({'where':{'contactId':_0x3aac1c['id'],'whatsappId':_0x52ab59['id'],'companyId':_0x22afd9},'order':[['id',_0x5da940(0x11a)]]});if(!_0x34c3c5)return;const _0x17c9f2=new Date(),_0x43f93f=_0x17c9f2[_0x5da940(0x109)](),_0x58f273=_0x17c9f2[_0x5da940(0x10b)](),_0x84869c=_0x5da940(0x118)+_0x43f93f+':'+_0x58f273,_0x4fac17={'wid':_0x4dc2d8[_0x5da940(0xed)][_0x5da940(0xf0)],'ticketId':_0x34c3c5['id'],'contactId':_0x3aac1c['id'],'body':_0x84869c,'fromMe':![],'mediaType':_0x5da940(0xfd),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x34c3c5['update']({'lastMessage':_0x84869c}),_0x34c3c5[_0x5da940(0xe2)]===_0x5da940(0x112)&&await _0x34c3c5[_0x5da940(0xf2)]({'status':_0x5da940(0x108)}),(0x0,CreateMessageService_1['default'])({'messageData':_0x4fac17,'companyId':_0x22afd9});}}});function _0x1d1c31(_0x388a56){const _0x5d8c7a=_0x83f707;return _0x388a56[_0x5d8c7a(0x113)](/[\x00-\x1F"\\']/g,'');}_0x52ab59['ev']['on'](_0x83f707(0x105),async _0x27afd5=>{const _0x2fd6a6=_0x83f707,_0x14e430=[];try{Promise[_0x2fd6a6(0xe4)](_0x27afd5[_0x2fd6a6(0x110)](async _0xc7056d=>{const _0x21bd87=_0x2fd6a6;if(!(0x0,baileys_1['isJidBroadcast'])(_0xc7056d['id'])&&!(0x0,baileys_1[_0x21bd87(0x106)])(_0xc7056d['id'])&&(0x0,baileys_1[_0x21bd87(0x114)])(_0xc7056d['id'])){const _0x47a0a1={'id':_0xc7056d['id'],'name':_0xc7056d[_0x21bd87(0xf1)]?_0x1d1c31(_0xc7056d['name']):_0xc7056d['id'][_0x21bd87(0x102)]('@')[0x0][_0x21bd87(0x102)](':')[0x0]};_0x14e430[_0x21bd87(0xfc)](_0x47a0a1);}})),console['log'](_0x14e430);}catch(_0x472c41){Sentry['captureException'](_0x472c41),logger_1[_0x2fd6a6(0xe6)][_0x2fd6a6(0x117)]('Erro\x20contacts.upsert:\x20'+JSON[_0x2fd6a6(0xe3)](_0x472c41));}try{await(0x0,CreateOrUpdateBaileysService_1['default'])({'whatsappId':_0x170318['id'],'contacts':_0x14e430});}catch(_0x5adc0d){logger_1[_0x2fd6a6(0xe6)][_0x2fd6a6(0x117)](_0x5adc0d);}});}catch(_0x328f80){Sentry[_0x83f707(0xfb)](_0x328f80),logger_1[_0x83f707(0xe6)][_0x83f707(0x117)](_0x328f80);}};exports[a616_0x582706(0xe5)]=wbotMonitor;