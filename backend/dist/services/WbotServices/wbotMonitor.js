'use strict';function a628_0x1681(){const _0x5e12c3=['__importDefault','company','getHours','logger','contactJson.txt','hasOwnProperty','stringify','__createBinding','mkdirSync','unlinkSync','pending','from','push','default','../../models/CompaniesSettings','../MessageServices/CreateMessageService','../BaileysServices/CreateOrUpdateBaileysService','CB:call','update','log','findOne','captureException','content','85KFYNEH','47956XNGPnN','isJidBroadcast','@sentry/node','__esModule','__setModuleDefault','writable','call_log','sendMessage','__importStar','all','get','call','create','983528elRTVj','2xQXMdi','acceptCallWhatsapp','@whiskeysockets/baileys','split','5319kIsNvc','name','writeFile','existsSync','DESC','status','6800IQXLbF','prototype','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','configurable','replace','error','resolve','enabled','3431610VREYya','getOwnPropertyDescriptor','@call','join','Erro\x20contacts.upsert:\x20','defineProperty','public','path','terminate','call-id','76470vBCUnJ','472203SPZYYX','tag','‎\x20*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitadas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','3142818jdtQMQ'];a628_0x1681=function(){return _0x5e12c3;};return a628_0x1681();}const a628_0x15364d=a628_0x4dba;(function(_0x16c996,_0x15ab37){const _0x3ae963=a628_0x4dba,_0x213f6e=_0x16c996();while(!![]){try{const _0x1d6264=-parseInt(_0x3ae963(0x126))/0x1+-parseInt(_0x3ae963(0x10a))/0x2*(parseInt(_0x3ae963(0x127))/0x3)+parseInt(_0x3ae963(0x143))/0x4*(parseInt(_0x3ae963(0x142))/0x5)+parseInt(_0x3ae963(0x11c))/0x6+-parseInt(_0x3ae963(0x12a))/0x7+-parseInt(_0x3ae963(0x109))/0x8+-parseInt(_0x3ae963(0x10e))/0x9*(-parseInt(_0x3ae963(0x114))/0xa);if(_0x1d6264===_0x15ab37)break;else _0x213f6e['push'](_0x213f6e['shift']());}catch(_0x3b4e70){_0x213f6e['push'](_0x213f6e['shift']());}}}(a628_0x1681,0x5ac82));var __createBinding=this&&this[a628_0x15364d(0x132)]||(Object[a628_0x15364d(0x108)]?function(_0x13a033,_0x54b1ae,_0x5199d1,_0x946b9){const _0x3f30c8=a628_0x15364d;if(_0x946b9===undefined)_0x946b9=_0x5199d1;var _0x516fb0=Object[_0x3f30c8(0x11d)](_0x54b1ae,_0x5199d1);(!_0x516fb0||(_0x3f30c8(0x106)in _0x516fb0?!_0x54b1ae[_0x3f30c8(0x146)]:_0x516fb0[_0x3f30c8(0x148)]||_0x516fb0[_0x3f30c8(0x117)]))&&(_0x516fb0={'enumerable':!![],'get':function(){return _0x54b1ae[_0x5199d1];}}),Object[_0x3f30c8(0x121)](_0x13a033,_0x946b9,_0x516fb0);}:function(_0x29f763,_0x4e0c9c,_0x51b74b,_0x10c734){if(_0x10c734===undefined)_0x10c734=_0x51b74b;_0x29f763[_0x10c734]=_0x4e0c9c[_0x51b74b];}),__setModuleDefault=this&&this[a628_0x15364d(0x147)]||(Object[a628_0x15364d(0x108)]?function(_0x27f568,_0x1aada4){const _0x327064=a628_0x15364d;Object[_0x327064(0x121)](_0x27f568,'default',{'enumerable':!![],'value':_0x1aada4});}:function(_0x477987,_0x1bbd41){const _0x46c23a=a628_0x15364d;_0x477987[_0x46c23a(0x138)]=_0x1bbd41;}),__importStar=this&&this[a628_0x15364d(0x104)]||function(_0x42f40a){const _0x5c9695=a628_0x15364d;if(_0x42f40a&&_0x42f40a[_0x5c9695(0x146)])return _0x42f40a;var _0x535228={};if(_0x42f40a!=null){for(var _0x3de247 in _0x42f40a)if(_0x3de247!=='default'&&Object[_0x5c9695(0x115)][_0x5c9695(0x130)][_0x5c9695(0x107)](_0x42f40a,_0x3de247))__createBinding(_0x535228,_0x42f40a,_0x3de247);}return __setModuleDefault(_0x535228,_0x42f40a),_0x535228;},__importDefault=this&&this[a628_0x15364d(0x12b)]||function(_0x3b0faf){const _0x30f99d=a628_0x15364d;return _0x3b0faf&&_0x3b0faf[_0x30f99d(0x146)]?_0x3b0faf:{'default':_0x3b0faf};};Object[a628_0x15364d(0x121)](exports,a628_0x15364d(0x146),{'value':!![]});const baileys_1=require(a628_0x15364d(0x10c)),Sentry=__importStar(require(a628_0x15364d(0x145))),fs_1=__importDefault(require('fs')),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require(a628_0x15364d(0x13b))),CreateMessageService_1=__importDefault(require(a628_0x15364d(0x13a))),CompaniesSettings_1=__importDefault(require(a628_0x15364d(0x139))),path_1=__importDefault(require(a628_0x15364d(0x123)));let i=0x0;function a628_0x4dba(_0x37c0a7,_0x13dc22){const _0x168110=a628_0x1681();return a628_0x4dba=function(_0x4dba76,_0x4515b2){_0x4dba76=_0x4dba76-0x102;let _0x404538=_0x168110[_0x4dba76];return _0x404538;},a628_0x4dba(_0x37c0a7,_0x13dc22);}setInterval(()=>{i=0x0;},0x1388);const wbotMonitor=async(_0x1ca066,_0x2f2153,_0x265c0e)=>{const _0x491cd5=a628_0x15364d;try{_0x1ca066['ws']['on'](_0x491cd5(0x13c),async _0x3b6f50=>{const _0x2929f4=_0x491cd5,_0x52db17=_0x3b6f50[_0x2929f4(0x141)][0x0];await new Promise(_0x4b2693=>setTimeout(_0x4b2693,i*0x28a)),i++;if(_0x52db17[_0x2929f4(0x128)]===_0x2929f4(0x124)&&!_0x3b6f50['attrs'][_0x2929f4(0x136)]['includes'](_0x2929f4(0x11e))){const _0x5af45d=await CompaniesSettings_1[_0x2929f4(0x138)][_0x2929f4(0x13f)]({'where':{'companyId':_0x265c0e}});if(_0x5af45d[_0x2929f4(0x10b)]===_0x2929f4(0x11b)){await _0x1ca066[_0x2929f4(0x103)](_0x3b6f50['attrs'][_0x2929f4(0x136)],{'text':_0x2929f4(0x129)});const _0x4e5a8f=_0x3b6f50['attrs'][_0x2929f4(0x136)]['split'](':')[0x0]['replace'](/\D/g,''),_0x25a51b=await Contact_1[_0x2929f4(0x138)][_0x2929f4(0x13f)]({'where':{'companyId':_0x265c0e,'number':_0x4e5a8f}});if(!_0x25a51b)return;const _0x46a260=await Ticket_1['default'][_0x2929f4(0x13f)]({'where':{'contactId':_0x25a51b['id'],'whatsappId':_0x1ca066['id'],'companyId':_0x265c0e},'order':[['id',_0x2929f4(0x112)]]});if(!_0x46a260)return;const _0x3c3234=new Date(),_0x17a513=_0x3c3234[_0x2929f4(0x12d)](),_0xf77249=_0x3c3234['getMinutes'](),_0x4763c6=_0x2929f4(0x116)+_0x17a513+':'+_0xf77249,_0x17c435={'wid':_0x52db17['attrs'][_0x2929f4(0x125)],'ticketId':_0x46a260['id'],'contactId':_0x25a51b['id'],'body':_0x4763c6,'fromMe':![],'mediaType':_0x2929f4(0x102),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x46a260[_0x2929f4(0x13d)]({'lastMessage':_0x4763c6}),_0x46a260[_0x2929f4(0x113)]==='closed'&&await _0x46a260[_0x2929f4(0x13d)]({'status':_0x2929f4(0x135)}),(0x0,CreateMessageService_1[_0x2929f4(0x138)])({'messageData':_0x17c435,'companyId':_0x265c0e});}}});function _0x3bc9e3(_0x4413dc){const _0x41e0ca=_0x491cd5;return _0x4413dc[_0x41e0ca(0x118)](/[\x00-\x1F"\\']/g,'');}_0x1ca066['ev']['on']('contacts.upsert',async _0x562526=>{const _0x3184f6=_0x491cd5,_0x54ff5d=[];try{Promise[_0x3184f6(0x105)](_0x562526['map'](async _0x196698=>{const _0x172a24=_0x3184f6;if(!(0x0,baileys_1[_0x172a24(0x144)])(_0x196698['id'])&&!(0x0,baileys_1['isJidStatusBroadcast'])(_0x196698['id'])&&(0x0,baileys_1['isJidUser'])(_0x196698['id'])){const _0x199502={'id':_0x196698['id'],'name':_0x196698[_0x172a24(0x10f)]?_0x3bc9e3(_0x196698['name']):_0x196698['id']['split']('@')[0x0][_0x172a24(0x10d)](':')[0x0]};_0x54ff5d[_0x172a24(0x137)](_0x199502);}}));const _0x176860=path_1[_0x3184f6(0x138)][_0x3184f6(0x11a)](__dirname,'..','..','..',_0x3184f6(0x122));!fs_1['default'][_0x3184f6(0x111)](path_1[_0x3184f6(0x138)]['join'](_0x176860,_0x3184f6(0x12c)+_0x265c0e))&&(fs_1[_0x3184f6(0x138)][_0x3184f6(0x133)](path_1['default'][_0x3184f6(0x11f)](_0x176860,_0x3184f6(0x12c)+_0x265c0e),{'recursive':!![]}),fs_1[_0x3184f6(0x138)]['chmodSync'](path_1[_0x3184f6(0x138)][_0x3184f6(0x11f)](_0x176860,'company'+_0x265c0e),0x1ff));const _0x3e4a2c=path_1['default']['join'](_0x176860,_0x3184f6(0x12c)+_0x265c0e,_0x3184f6(0x12f));fs_1[_0x3184f6(0x138)][_0x3184f6(0x111)](_0x3e4a2c)&&await fs_1[_0x3184f6(0x138)][_0x3184f6(0x134)](_0x3e4a2c),await fs_1[_0x3184f6(0x138)]['promises'][_0x3184f6(0x110)](_0x3e4a2c,JSON['stringify'](_0x54ff5d,null,0x2)),console[_0x3184f6(0x13e)](_0x54ff5d);}catch(_0x4a8d4a){Sentry[_0x3184f6(0x140)](_0x4a8d4a),logger_1[_0x3184f6(0x12e)][_0x3184f6(0x119)](_0x3184f6(0x120)+JSON[_0x3184f6(0x131)](_0x4a8d4a));}try{await(0x0,CreateOrUpdateBaileysService_1['default'])({'whatsappId':_0x2f2153['id'],'contacts':_0x54ff5d});}catch(_0x218760){logger_1[_0x3184f6(0x12e)][_0x3184f6(0x119)](_0x218760);}});}catch(_0x37c53d){Sentry['captureException'](_0x37c53d),logger_1['logger'][_0x491cd5(0x119)](_0x37c53d);}};exports[a628_0x15364d(0x138)]=wbotMonitor;