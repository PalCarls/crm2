'use strict';function a628_0xe1e8(_0x4d1d34,_0xc72e9f){const _0xda0c74=a628_0xda0c();return a628_0xe1e8=function(_0xe1e848,_0xdb735){_0xe1e848=_0xe1e848-0xa1;let _0x45674b=_0xda0c74[_0xe1e848];return _0x45674b;},a628_0xe1e8(_0x4d1d34,_0xc72e9f);}const a628_0x44896d=a628_0xe1e8;(function(_0xb21059,_0xa27d2f){const _0x51e10b=a628_0xe1e8,_0x17ecd9=_0xb21059();while(!![]){try{const _0x1f6060=-parseInt(_0x51e10b(0xdd))/0x1*(-parseInt(_0x51e10b(0xd1))/0x2)+-parseInt(_0x51e10b(0xa4))/0x3+parseInt(_0x51e10b(0xaf))/0x4*(-parseInt(_0x51e10b(0xba))/0x5)+-parseInt(_0x51e10b(0xa6))/0x6+-parseInt(_0x51e10b(0xcc))/0x7*(parseInt(_0x51e10b(0xe4))/0x8)+-parseInt(_0x51e10b(0xac))/0x9*(parseInt(_0x51e10b(0xce))/0xa)+-parseInt(_0x51e10b(0xa1))/0xb*(-parseInt(_0x51e10b(0xbe))/0xc);if(_0x1f6060===_0xa27d2f)break;else _0x17ecd9['push'](_0x17ecd9['shift']());}catch(_0x3fc123){_0x17ecd9['push'](_0x17ecd9['shift']());}}}(a628_0xda0c,0x881d8));function a628_0xda0c(){const _0x467abd=['resolve','../../models/Ticket','path','getOwnPropertyDescriptor','@whiskeysockets/baileys','default','enabled','__esModule','name','error','call-id','2842MAcNdo','attrs','5230RfQLEc','../MessageServices/CreateMessageService','create','321338etkvjp','all','__importDefault','captureException','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','@call','tag','../../utils/logger','join','mkdirSync','stringify','company','3oHStwn','isJidStatusBroadcast','unlinkSync','log','DESC','acceptCallWhatsapp','content','4280cJytvh','11ndxrJR','writeFile','get','2236272VLjqSF','logger','2780580NKgRpk','sendMessage','isJidUser','../../models/Contact','__createBinding','contacts.upsert','288kOPEkz','from','isJidBroadcast','16RYKnro','‎\x20*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitadas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','call_log','terminate','contactJson.txt','writable','update','push','closed','split','defineProperty','680545VrvLjz','status','__setModuleDefault','@sentry/node','24753084FnitxS','prototype','pending'];a628_0xda0c=function(){return _0x467abd;};return a628_0xda0c();}var __createBinding=this&&this[a628_0x44896d(0xaa)]||(Object['create']?function(_0xc8b7d,_0x22aec7,_0x3cfddb,_0x38ac7e){const _0x3341b4=a628_0x44896d;if(_0x38ac7e===undefined)_0x38ac7e=_0x3cfddb;var _0x294cf5=Object[_0x3341b4(0xc4)](_0x22aec7,_0x3cfddb);(!_0x294cf5||(_0x3341b4(0xa3)in _0x294cf5?!_0x22aec7[_0x3341b4(0xc8)]:_0x294cf5[_0x3341b4(0xb4)]||_0x294cf5['configurable']))&&(_0x294cf5={'enumerable':!![],'get':function(){return _0x22aec7[_0x3cfddb];}}),Object[_0x3341b4(0xb9)](_0xc8b7d,_0x38ac7e,_0x294cf5);}:function(_0x2fda3e,_0x4aebb0,_0x28b17f,_0x3d4fd0){if(_0x3d4fd0===undefined)_0x3d4fd0=_0x28b17f;_0x2fda3e[_0x3d4fd0]=_0x4aebb0[_0x28b17f];}),__setModuleDefault=this&&this[a628_0x44896d(0xbc)]||(Object[a628_0x44896d(0xd0)]?function(_0x41bc02,_0x1cb404){const _0x1765cf=a628_0x44896d;Object[_0x1765cf(0xb9)](_0x41bc02,_0x1765cf(0xc6),{'enumerable':!![],'value':_0x1cb404});}:function(_0x17a95a,_0x40727a){const _0x22c532=a628_0x44896d;_0x17a95a[_0x22c532(0xc6)]=_0x40727a;}),__importStar=this&&this['__importStar']||function(_0x2a1672){const _0x377952=a628_0x44896d;if(_0x2a1672&&_0x2a1672['__esModule'])return _0x2a1672;var _0x1a47ca={};if(_0x2a1672!=null){for(var _0x233625 in _0x2a1672)if(_0x233625!==_0x377952(0xc6)&&Object[_0x377952(0xbf)]['hasOwnProperty']['call'](_0x2a1672,_0x233625))__createBinding(_0x1a47ca,_0x2a1672,_0x233625);}return __setModuleDefault(_0x1a47ca,_0x2a1672),_0x1a47ca;},__importDefault=this&&this[a628_0x44896d(0xd3)]||function(_0x22d9c2){return _0x22d9c2&&_0x22d9c2['__esModule']?_0x22d9c2:{'default':_0x22d9c2};};Object[a628_0x44896d(0xb9)](exports,a628_0x44896d(0xc8),{'value':!![]});const baileys_1=require(a628_0x44896d(0xc5)),Sentry=__importStar(require(a628_0x44896d(0xbd))),fs_1=__importDefault(require('fs')),Contact_1=__importDefault(require(a628_0x44896d(0xa9))),Ticket_1=__importDefault(require(a628_0x44896d(0xc2))),logger_1=require(a628_0x44896d(0xd8)),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require(a628_0x44896d(0xcf))),CompaniesSettings_1=__importDefault(require('../../models/CompaniesSettings')),path_1=__importDefault(require(a628_0x44896d(0xc3)));let i=0x0;setInterval(()=>{i=0x0;},0x1388);const wbotMonitor=async(_0x6aec87,_0x1c0726,_0x4fa39e)=>{const _0x921056=a628_0x44896d;try{_0x6aec87['ws']['on']('CB:call',async _0x3ed5bb=>{const _0x4ec344=a628_0xe1e8,_0x276bd1=_0x3ed5bb[_0x4ec344(0xe3)][0x0];await new Promise(_0x2bf4d8=>setTimeout(_0x2bf4d8,i*0x28a)),i++;if(_0x276bd1[_0x4ec344(0xd7)]===_0x4ec344(0xb2)&&!_0x3ed5bb[_0x4ec344(0xcd)][_0x4ec344(0xad)]['includes'](_0x4ec344(0xd6))){const _0x2baebf=await CompaniesSettings_1[_0x4ec344(0xc6)]['findOne']({'where':{'companyId':_0x4fa39e}});if(_0x2baebf[_0x4ec344(0xe2)]===_0x4ec344(0xc7)){await _0x6aec87[_0x4ec344(0xa7)](_0x3ed5bb['attrs'][_0x4ec344(0xad)],{'text':_0x4ec344(0xb0)});const _0x394d89=_0x3ed5bb[_0x4ec344(0xcd)][_0x4ec344(0xad)]['split'](':')[0x0]['replace'](/\D/g,''),_0x12b764=await Contact_1[_0x4ec344(0xc6)]['findOne']({'where':{'companyId':_0x4fa39e,'number':_0x394d89}});if(!_0x12b764)return;const _0x2f63b0=await Ticket_1[_0x4ec344(0xc6)]['findOne']({'where':{'contactId':_0x12b764['id'],'whatsappId':_0x6aec87['id'],'companyId':_0x4fa39e},'order':[['id',_0x4ec344(0xe1)]]});if(!_0x2f63b0)return;const _0x5945e5=new Date(),_0x4c5795=_0x5945e5['getHours'](),_0x40e871=_0x5945e5['getMinutes'](),_0x101cbe=_0x4ec344(0xd5)+_0x4c5795+':'+_0x40e871,_0xae19b1={'wid':_0x276bd1[_0x4ec344(0xcd)][_0x4ec344(0xcb)],'ticketId':_0x2f63b0['id'],'contactId':_0x12b764['id'],'body':_0x101cbe,'fromMe':![],'mediaType':_0x4ec344(0xb1),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x2f63b0[_0x4ec344(0xb5)]({'lastMessage':_0x101cbe}),_0x2f63b0[_0x4ec344(0xbb)]===_0x4ec344(0xb7)&&await _0x2f63b0[_0x4ec344(0xb5)]({'status':_0x4ec344(0xc0)}),(0x0,CreateMessageService_1['default'])({'messageData':_0xae19b1,'companyId':_0x4fa39e});}}});function _0x2a1278(_0x3b5c8a){return _0x3b5c8a['replace'](/[\x00-\x1F"\\']/g,'');}_0x6aec87['ev']['on'](_0x921056(0xab),async _0x27f23d=>{const _0x34e379=_0x921056,_0x633d12=[];try{Promise[_0x34e379(0xd2)](_0x27f23d['map'](async _0x30287b=>{const _0x162fba=_0x34e379;if(!(0x0,baileys_1[_0x162fba(0xae)])(_0x30287b['id'])&&!(0x0,baileys_1[_0x162fba(0xde)])(_0x30287b['id'])&&(0x0,baileys_1[_0x162fba(0xa8)])(_0x30287b['id'])){const _0x7a7d40={'id':_0x30287b['id'],'name':_0x30287b[_0x162fba(0xc9)]?_0x2a1278(_0x30287b[_0x162fba(0xc9)]):_0x30287b['id'][_0x162fba(0xb8)]('@')[0x0][_0x162fba(0xb8)](':')[0x0]};_0x633d12[_0x162fba(0xb6)](_0x7a7d40);}}));const _0x1334d1=path_1[_0x34e379(0xc6)][_0x34e379(0xc1)](__dirname,'..','..','..','public');!fs_1[_0x34e379(0xc6)]['existsSync'](path_1[_0x34e379(0xc6)][_0x34e379(0xd9)](_0x1334d1,_0x34e379(0xdc)+_0x4fa39e))&&(fs_1[_0x34e379(0xc6)][_0x34e379(0xda)](path_1['default']['join'](_0x1334d1,_0x34e379(0xdc)+_0x4fa39e),{'recursive':!![]}),fs_1[_0x34e379(0xc6)]['chmodSync'](path_1[_0x34e379(0xc6)]['join'](_0x1334d1,_0x34e379(0xdc)+_0x4fa39e),0x1ff));const _0x6b4aec=path_1[_0x34e379(0xc6)][_0x34e379(0xd9)](_0x1334d1,'company'+_0x4fa39e,_0x34e379(0xb3));fs_1[_0x34e379(0xc6)]['existsSync'](_0x6b4aec)&&await fs_1['default'][_0x34e379(0xdf)](_0x6b4aec),await fs_1[_0x34e379(0xc6)]['promises'][_0x34e379(0xa2)](_0x6b4aec,JSON[_0x34e379(0xdb)](_0x633d12,null,0x2)),console[_0x34e379(0xe0)](_0x633d12);}catch(_0x2fac34){Sentry[_0x34e379(0xd4)](_0x2fac34),logger_1[_0x34e379(0xa5)][_0x34e379(0xca)]('Erro\x20contacts.upsert:\x20'+JSON[_0x34e379(0xdb)](_0x2fac34));}try{await(0x0,CreateOrUpdateBaileysService_1[_0x34e379(0xc6)])({'whatsappId':_0x1c0726['id'],'contacts':_0x633d12});}catch(_0x55cd17){logger_1[_0x34e379(0xa5)]['error'](_0x55cd17);}});}catch(_0x43b535){Sentry[_0x921056(0xd4)](_0x43b535),logger_1[_0x921056(0xa5)][_0x921056(0xca)](_0x43b535);}};exports['default']=wbotMonitor;