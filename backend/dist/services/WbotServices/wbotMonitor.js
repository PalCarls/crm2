'use strict';const a575_0x241086=a575_0x442b;(function(_0x47ef2e,_0x2b959c){const _0x28b697=a575_0x442b,_0x164fa9=_0x47ef2e();while(!![]){try{const _0x379a7a=-parseInt(_0x28b697(0x12e))/0x1+parseInt(_0x28b697(0x12a))/0x2*(parseInt(_0x28b697(0x121))/0x3)+parseInt(_0x28b697(0x129))/0x4*(-parseInt(_0x28b697(0x11a))/0x5)+parseInt(_0x28b697(0x12b))/0x6*(parseInt(_0x28b697(0x112))/0x7)+-parseInt(_0x28b697(0x124))/0x8*(-parseInt(_0x28b697(0x12d))/0x9)+parseInt(_0x28b697(0x110))/0xa+-parseInt(_0x28b697(0x11f))/0xb;if(_0x379a7a===_0x2b959c)break;else _0x164fa9['push'](_0x164fa9['shift']());}catch(_0x4f324f){_0x164fa9['push'](_0x164fa9['shift']());}}}(a575_0xc649,0x94f39));var __createBinding=this&&this[a575_0x241086(0x111)]||(Object[a575_0x241086(0x134)]?function(_0x23ac3,_0x2464f3,_0x13f5ec,_0x1e5f13){const _0x39abe8=a575_0x241086;if(_0x1e5f13===undefined)_0x1e5f13=_0x13f5ec;var _0x53c1d2=Object[_0x39abe8(0x139)](_0x2464f3,_0x13f5ec);(!_0x53c1d2||('get'in _0x53c1d2?!_0x2464f3[_0x39abe8(0x12f)]:_0x53c1d2['writable']||_0x53c1d2['configurable']))&&(_0x53c1d2={'enumerable':!![],'get':function(){return _0x2464f3[_0x13f5ec];}}),Object[_0x39abe8(0x133)](_0x23ac3,_0x1e5f13,_0x53c1d2);}:function(_0x100f38,_0x551311,_0x5de7e4,_0x2c9b40){if(_0x2c9b40===undefined)_0x2c9b40=_0x5de7e4;_0x100f38[_0x2c9b40]=_0x551311[_0x5de7e4];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x238cd4,_0x306510){const _0x31f952=a575_0x241086;Object[_0x31f952(0x133)](_0x238cd4,_0x31f952(0x117),{'enumerable':!![],'value':_0x306510});}:function(_0x9c7519,_0x26f8c4){const _0x35ee6a=a575_0x241086;_0x9c7519[_0x35ee6a(0x117)]=_0x26f8c4;}),__importStar=this&&this['__importStar']||function(_0x421221){const _0x24f356=a575_0x241086;if(_0x421221&&_0x421221['__esModule'])return _0x421221;var _0x14cf1c={};if(_0x421221!=null){for(var _0x5c603f in _0x421221)if(_0x5c603f!==_0x24f356(0x117)&&Object[_0x24f356(0x12c)][_0x24f356(0x11d)]['call'](_0x421221,_0x5c603f))__createBinding(_0x14cf1c,_0x421221,_0x5c603f);}return __setModuleDefault(_0x14cf1c,_0x421221),_0x14cf1c;},__importDefault=this&&this[a575_0x241086(0x115)]||function(_0x545f83){return _0x545f83&&_0x545f83['__esModule']?_0x545f83:{'default':_0x545f83};};Object[a575_0x241086(0x133)](exports,a575_0x241086(0x12f),{'value':!![]});function a575_0xc649(){const _0x4459e8=['153116GxFiOk','__esModule','../../models/CompaniesSettings','captureException','includes','defineProperty','create','@call','../../utils/logger','getHours','sendMessage','getOwnPropertyDescriptor','findOne','from','status','error','../BaileysServices/CreateOrUpdateBaileysService','6991160eFsxwZ','__createBinding','21WJuLHY','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','CB:call','__importDefault','getMinutes','default','../MessageServices/CreateMessageService','acceptCallWhatsapp','19335FovGir','tag','logger','hasOwnProperty','update','15953377yBxkLn','content','6UCfoJN','terminate','call-id','1368WHxhkj','call_log','../../models/Ticket','attrs','replace','1132vYaNQW','1202178XfAHcA','913722fTTvYd','prototype','49986WKCODQ'];a575_0xc649=function(){return _0x4459e8;};return a575_0xc649();}const Sentry=__importStar(require('@sentry/node')),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require(a575_0x241086(0x126))),logger_1=require(a575_0x241086(0x136)),CreateOrUpdateBaileysService_1=__importDefault(require(a575_0x241086(0x10f))),CreateMessageService_1=__importDefault(require(a575_0x241086(0x118))),CompaniesSettings_1=__importDefault(require(a575_0x241086(0x130))),wbotMonitor=async(_0x827514,_0x5d6342,_0x12d038)=>{const _0x5a09a6=a575_0x241086;try{_0x827514['ws']['on'](_0x5a09a6(0x114),async _0x59a23a=>{const _0x375eed=_0x5a09a6,_0x570b3d=_0x59a23a[_0x375eed(0x120)][0x0];if(_0x570b3d[_0x375eed(0x11b)]===_0x375eed(0x122)&&!_0x59a23a[_0x375eed(0x127)]['from'][_0x375eed(0x132)](_0x375eed(0x135))){const _0x2b04f4=await CompaniesSettings_1[_0x375eed(0x117)][_0x375eed(0x13a)]({'where':{'companyId':_0x12d038}});if(_0x2b04f4[_0x375eed(0x119)]==='enabled'){await _0x827514[_0x375eed(0x138)](_0x59a23a['attrs']['from'],{'text':'*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado'});const _0x503be5=_0x59a23a[_0x375eed(0x127)][_0x375eed(0x13b)][_0x375eed(0x128)](/\D/g,''),_0x4c12ba=await Contact_1['default'][_0x375eed(0x13a)]({'where':{'companyId':_0x12d038,'number':_0x503be5}}),_0x2fbb09=await Ticket_1[_0x375eed(0x117)][_0x375eed(0x13a)]({'where':{'contactId':_0x4c12ba['id'],'whatsappId':_0x827514['id'],'companyId':_0x12d038}});if(!_0x2fbb09)return;const _0x2d10c7=new Date(),_0x45339b=_0x2d10c7[_0x375eed(0x137)](),_0x245384=_0x2d10c7[_0x375eed(0x116)](),_0x1a8057=_0x375eed(0x113)+_0x45339b+':'+_0x245384,_0x1d2902={'wid':_0x570b3d[_0x375eed(0x127)][_0x375eed(0x123)],'ticketId':_0x2fbb09['id'],'contactId':_0x4c12ba['id'],'body':_0x1a8057,'fromMe':![],'mediaType':_0x375eed(0x125),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x2fbb09['update']({'lastMessage':_0x1a8057}),_0x2fbb09[_0x375eed(0x10d)]==='closed'&&await _0x2fbb09[_0x375eed(0x11e)]({'status':'pending'}),(0x0,CreateMessageService_1[_0x375eed(0x117)])({'messageData':_0x1d2902,'companyId':_0x12d038});}}}),_0x827514['ev']['on']('contacts.upsert',async _0x68a463=>{const _0x3331ff=_0x5a09a6;await(0x0,CreateOrUpdateBaileysService_1[_0x3331ff(0x117)])({'whatsappId':_0x5d6342['id'],'contacts':_0x68a463});});}catch(_0x1e49b1){Sentry[_0x5a09a6(0x131)](_0x1e49b1),logger_1[_0x5a09a6(0x11c)][_0x5a09a6(0x10e)](_0x1e49b1);}};function a575_0x442b(_0x479dc1,_0x1ad146){const _0xc64982=a575_0xc649();return a575_0x442b=function(_0x442b7e,_0x5d1f5f){_0x442b7e=_0x442b7e-0x10d;let _0x2c5738=_0xc64982[_0x442b7e];return _0x2c5738;},a575_0x442b(_0x479dc1,_0x1ad146);}exports['default']=wbotMonitor;