<<<<<<< HEAD
'use strict';const a617_0x163f83=a617_0x182d;(function(_0x405cc6,_0x2489e3){const _0x4d6008=a617_0x182d,_0xab94ce=_0x405cc6();while(!![]){try{const _0x33562c=-parseInt(_0x4d6008(0x167))/0x1*(parseInt(_0x4d6008(0x189))/0x2)+parseInt(_0x4d6008(0x15f))/0x3+-parseInt(_0x4d6008(0x17e))/0x4*(parseInt(_0x4d6008(0x17d))/0x5)+-parseInt(_0x4d6008(0x177))/0x6*(parseInt(_0x4d6008(0x180))/0x7)+parseInt(_0x4d6008(0x16a))/0x8*(parseInt(_0x4d6008(0x169))/0x9)+parseInt(_0x4d6008(0x195))/0xa+parseInt(_0x4d6008(0x178))/0xb;if(_0x33562c===_0x2489e3)break;else _0xab94ce['push'](_0xab94ce['shift']());}catch(_0x4ca0da){_0xab94ce['push'](_0xab94ce['shift']());}}}(a617_0xb865,0xabb22));var __createBinding=this&&this[a617_0x163f83(0x16c)]||(Object[a617_0x163f83(0x198)]?function(_0x7f35a8,_0x1e1a02,_0x4c34a0,_0x10cfce){const _0x3b27d2=a617_0x163f83;if(_0x10cfce===undefined)_0x10cfce=_0x4c34a0;var _0x2e0a68=Object[_0x3b27d2(0x191)](_0x1e1a02,_0x4c34a0);(!_0x2e0a68||(_0x3b27d2(0x16e)in _0x2e0a68?!_0x1e1a02[_0x3b27d2(0x18e)]:_0x2e0a68[_0x3b27d2(0x18d)]||_0x2e0a68[_0x3b27d2(0x160)]))&&(_0x2e0a68={'enumerable':!![],'get':function(){return _0x1e1a02[_0x4c34a0];}}),Object[_0x3b27d2(0x17b)](_0x7f35a8,_0x10cfce,_0x2e0a68);}:function(_0x355425,_0x3c887d,_0x1d9e52,_0x1367bd){if(_0x1367bd===undefined)_0x1367bd=_0x1d9e52;_0x355425[_0x1367bd]=_0x3c887d[_0x1d9e52];}),__setModuleDefault=this&&this[a617_0x163f83(0x183)]||(Object['create']?function(_0x3269e8,_0x3ef4bf){const _0x31d2ef=a617_0x163f83;Object['defineProperty'](_0x3269e8,_0x31d2ef(0x193),{'enumerable':!![],'value':_0x3ef4bf});}:function(_0xdf481c,_0x26776c){_0xdf481c['default']=_0x26776c;}),__importStar=this&&this['__importStar']||function(_0x1dce2a){const _0x4178ab=a617_0x163f83;if(_0x1dce2a&&_0x1dce2a[_0x4178ab(0x18e)])return _0x1dce2a;var _0xe63c27={};if(_0x1dce2a!=null){for(var _0x1f7504 in _0x1dce2a)if(_0x1f7504!==_0x4178ab(0x193)&&Object[_0x4178ab(0x190)][_0x4178ab(0x19a)][_0x4178ab(0x199)](_0x1dce2a,_0x1f7504))__createBinding(_0xe63c27,_0x1dce2a,_0x1f7504);}return __setModuleDefault(_0xe63c27,_0x1dce2a),_0xe63c27;},__importDefault=this&&this['__importDefault']||function(_0x1264c6){const _0x153ada=a617_0x163f83;return _0x1264c6&&_0x1264c6[_0x153ada(0x18e)]?_0x1264c6:{'default':_0x1264c6};};Object[a617_0x163f83(0x17b)](exports,a617_0x163f83(0x18e),{'value':!![]});const baileys_1=require(a617_0x163f83(0x181)),Sentry=__importStar(require(a617_0x163f83(0x16f))),Contact_1=__importDefault(require(a617_0x163f83(0x173))),Ticket_1=__importDefault(require(a617_0x163f83(0x170))),logger_1=require(a617_0x163f83(0x175)),CreateOrUpdateBaileysService_1=__importDefault(require(a617_0x163f83(0x188))),CreateMessageService_1=__importDefault(require(a617_0x163f83(0x176))),CompaniesSettings_1=__importDefault(require(a617_0x163f83(0x185)));function a617_0x182d(_0x589ef7,_0x189b5e){const _0xb865d7=a617_0xb865();return a617_0x182d=function(_0x182db7,_0x9b4214){_0x182db7=_0x182db7-0x15b;let _0x262550=_0xb865d7[_0x182db7];return _0x262550;},a617_0x182d(_0x589ef7,_0x189b5e);}let i=0x0;setInterval(()=>{i=0x0;},0x1388);const wbotMonitor=async(_0x44c8a0,_0x4325bb,_0x24f816)=>{const _0x48a347=a617_0x163f83;try{_0x44c8a0['ws']['on'](_0x48a347(0x162),async _0x37414e=>{const _0x16f056=_0x48a347,_0x527428=_0x37414e[_0x16f056(0x15d)][0x0];await new Promise(_0xc6bf4e=>setTimeout(_0xc6bf4e,i*0x28a)),i++;if(_0x527428['tag']==='terminate'&&!_0x37414e[_0x16f056(0x166)]['from'][_0x16f056(0x18a)](_0x16f056(0x163))){const _0x580a7e=await CompaniesSettings_1['default']['findOne']({'where':{'companyId':_0x24f816}});if(_0x580a7e[_0x16f056(0x196)]===_0x16f056(0x179)){await _0x44c8a0[_0x16f056(0x164)](_0x37414e[_0x16f056(0x166)][_0x16f056(0x17c)],{'text':_0x16f056(0x17a)});const _0x913844=_0x37414e[_0x16f056(0x166)][_0x16f056(0x17c)][_0x16f056(0x182)](':')[0x0]['replace'](/\D/g,''),_0x5dc354=await Contact_1['default'][_0x16f056(0x197)]({'where':{'companyId':_0x24f816,'number':_0x913844}}),_0x2c46f8=await Ticket_1[_0x16f056(0x193)][_0x16f056(0x197)]({'where':{'contactId':_0x5dc354['id'],'whatsappId':_0x44c8a0['id'],'companyId':_0x24f816},'order':[['id',_0x16f056(0x192)]]});if(!_0x2c46f8)return;const _0x32a381=new Date(),_0x14994f=_0x32a381[_0x16f056(0x187)](),_0x242be4=_0x32a381['getMinutes'](),_0x5ba766=_0x16f056(0x18b)+_0x14994f+':'+_0x242be4,_0x2ecae7={'wid':_0x527428[_0x16f056(0x166)][_0x16f056(0x171)],'ticketId':_0x2c46f8['id'],'contactId':_0x5dc354['id'],'body':_0x5ba766,'fromMe':![],'mediaType':'call_log','read':!![],'quotedMsgId':null,'ack':0x1};return await _0x2c46f8[_0x16f056(0x18f)]({'lastMessage':_0x5ba766}),_0x2c46f8[_0x16f056(0x15e)]===_0x16f056(0x161)&&await _0x2c46f8[_0x16f056(0x18f)]({'status':_0x16f056(0x174)}),(0x0,CreateMessageService_1[_0x16f056(0x193)])({'messageData':_0x2ecae7,'companyId':_0x24f816});}}});function _0x39d624(_0x33f47c){const _0x45285f=_0x48a347;return _0x33f47c[_0x45285f(0x15c)](/[\x00-\x1F"\\']/g,'');}_0x44c8a0['ev']['on'](_0x48a347(0x194),async _0x3d9e98=>{const _0x304744=_0x48a347,_0x4c42e5=[];try{Promise['all'](_0x3d9e98[_0x304744(0x15b)](async _0x5242a1=>{const _0x1bd1c4=_0x304744;if(!(0x0,baileys_1[_0x1bd1c4(0x172)])(_0x5242a1['id'])&&!(0x0,baileys_1[_0x1bd1c4(0x186)])(_0x5242a1['id'])&&(0x0,baileys_1[_0x1bd1c4(0x17f)])(_0x5242a1['id'])){const _0x1a9946={'id':_0x5242a1['id'],'name':_0x5242a1[_0x1bd1c4(0x165)]?_0x39d624(_0x5242a1[_0x1bd1c4(0x165)]):_0x5242a1['id'][_0x1bd1c4(0x182)]('@')[0x0]['split'](':')[0x0]};_0x4c42e5['push'](_0x1a9946);}})),console['log'](_0x4c42e5);}catch(_0x194a17){Sentry[_0x304744(0x16d)](_0x194a17),logger_1[_0x304744(0x18c)][_0x304744(0x168)](_0x304744(0x16b)+JSON[_0x304744(0x184)](_0x194a17));}try{await(0x0,CreateOrUpdateBaileysService_1[_0x304744(0x193)])({'whatsappId':_0x4325bb['id'],'contacts':_0x4c42e5});}catch(_0x333d35){logger_1[_0x304744(0x18c)][_0x304744(0x168)](_0x333d35);}});}catch(_0x158814){Sentry[_0x48a347(0x16d)](_0x158814),logger_1['logger']['error'](_0x158814);}};exports[a617_0x163f83(0x193)]=wbotMonitor;function a617_0xb865(){const _0x45942f=['acceptCallWhatsapp','findOne','create','call','hasOwnProperty','map','replace','content','status','3865122MPxEvq','configurable','closed','CB:call','@call','sendMessage','name','attrs','39658kbLczS','error','9qCmClU','2308984QAMaCK','Erro\x20contacts.upsert:\x20','__createBinding','captureException','get','@sentry/node','../../models/Ticket','call-id','isJidBroadcast','../../models/Contact','pending','../../utils/logger','../MessageServices/CreateMessageService','6YQnZfX','11507881OQOtjT','enabled','‎\x20*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitadas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','defineProperty','from','1893075bCTAEn','12fwVMos','isJidUser','8167789OBocsz','@whiskeysockets/baileys','split','__setModuleDefault','stringify','../../models/CompaniesSettings','isJidStatusBroadcast','getHours','../BaileysServices/CreateOrUpdateBaileysService','6BaETMA','includes','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','logger','writable','__esModule','update','prototype','getOwnPropertyDescriptor','DESC','default','contacts.upsert','5017440wSphJn'];a617_0xb865=function(){return _0x45942f;};return a617_0xb865();}
=======
'use strict';const a616_0x582706=a616_0x1746;(function(_0xf4605b,_0x23f0b2){const _0x4a9e3f=a616_0x1746,_0x5ae469=_0xf4605b();while(!![]){try{const _0x1cbe46=parseInt(_0x4a9e3f(0xe9))/0x1*(-parseInt(_0x4a9e3f(0x104))/0x2)+-parseInt(_0x4a9e3f(0x115))/0x3+parseInt(_0x4a9e3f(0x10e))/0x4+-parseInt(_0x4a9e3f(0xeb))/0x5*(-parseInt(_0x4a9e3f(0x10a))/0x6)+parseInt(_0x4a9e3f(0xe1))/0x7*(parseInt(_0x4a9e3f(0xef))/0x8)+-parseInt(_0x4a9e3f(0x100))/0x9*(parseInt(_0x4a9e3f(0xe8))/0xa)+-parseInt(_0x4a9e3f(0x111))/0xb*(parseInt(_0x4a9e3f(0xfa))/0xc);if(_0x1cbe46===_0x23f0b2)break;else _0x5ae469['push'](_0x5ae469['shift']());}catch(_0x24f3e5){_0x5ae469['push'](_0x5ae469['shift']());}}}(a616_0x4e25,0x2f05c));function a616_0x4e25(){const _0x11843d=['isJidUser','413538FgHmvC','../BaileysServices/CreateOrUpdateBaileysService','error','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','terminate','DESC','writable','hasOwnProperty','../../models/CompaniesSettings','@whiskeysockets/baileys','183687fudmFl','status','stringify','all','default','logger','@call','2870Tavosp','18026pnqjPz','create','55ByjnSv','CB:call','attrs','get','24VIYWBq','call-id','name','update','__importStar','../../models/Ticket','configurable','from','__esModule','__createBinding','../../models/Contact','2898516fEOBQY','captureException','push','call_log','../../utils/logger','tag','4113mQfAWV','getOwnPropertyDescriptor','split','findOne','2ejVmOd','contacts.upsert','isJidStatusBroadcast','__importDefault','pending','getHours','170274ukYZfp','getMinutes','sendMessage','@sentry/node','1321144Uolnfp','defineProperty','map','11xITcAF','closed','replace'];a616_0x4e25=function(){return _0x11843d;};return a616_0x4e25();}function a616_0x1746(_0x5ab61e,_0x4aeae1){const _0x4e259a=a616_0x4e25();return a616_0x1746=function(_0x174653,_0x1f491e){_0x174653=_0x174653-0xdf;let _0x45bf1a=_0x4e259a[_0x174653];return _0x45bf1a;},a616_0x1746(_0x5ab61e,_0x4aeae1);}var __createBinding=this&&this[a616_0x582706(0xf8)]||(Object[a616_0x582706(0xea)]?function(_0x261990,_0x4a129f,_0x2de8c0,_0x4326e4){const _0x5124e7=a616_0x582706;if(_0x4326e4===undefined)_0x4326e4=_0x2de8c0;var _0x274fed=Object[_0x5124e7(0x101)](_0x4a129f,_0x2de8c0);(!_0x274fed||(_0x5124e7(0xee)in _0x274fed?!_0x4a129f[_0x5124e7(0xf7)]:_0x274fed[_0x5124e7(0x11b)]||_0x274fed[_0x5124e7(0xf5)]))&&(_0x274fed={'enumerable':!![],'get':function(){return _0x4a129f[_0x2de8c0];}}),Object['defineProperty'](_0x261990,_0x4326e4,_0x274fed);}:function(_0x95c450,_0x31c471,_0x1c7724,_0x1e3bd1){if(_0x1e3bd1===undefined)_0x1e3bd1=_0x1c7724;_0x95c450[_0x1e3bd1]=_0x31c471[_0x1c7724];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a616_0x582706(0xea)]?function(_0x16c042,_0x53a1dd){const _0x2f384e=a616_0x582706;Object[_0x2f384e(0x10f)](_0x16c042,_0x2f384e(0xe5),{'enumerable':!![],'value':_0x53a1dd});}:function(_0x15ab79,_0x4352dd){const _0x1f93b9=a616_0x582706;_0x15ab79[_0x1f93b9(0xe5)]=_0x4352dd;}),__importStar=this&&this[a616_0x582706(0xf3)]||function(_0x199755){const _0x5066cc=a616_0x582706;if(_0x199755&&_0x199755[_0x5066cc(0xf7)])return _0x199755;var _0x3d430b={};if(_0x199755!=null){for(var _0x32c251 in _0x199755)if(_0x32c251!==_0x5066cc(0xe5)&&Object['prototype'][_0x5066cc(0x11c)]['call'](_0x199755,_0x32c251))__createBinding(_0x3d430b,_0x199755,_0x32c251);}return __setModuleDefault(_0x3d430b,_0x199755),_0x3d430b;},__importDefault=this&&this[a616_0x582706(0x107)]||function(_0x177889){const _0x4e4a7=a616_0x582706;return _0x177889&&_0x177889[_0x4e4a7(0xf7)]?_0x177889:{'default':_0x177889};};Object[a616_0x582706(0x10f)](exports,a616_0x582706(0xf7),{'value':!![]});const baileys_1=require(a616_0x582706(0xe0)),Sentry=__importStar(require(a616_0x582706(0x10d))),Contact_1=__importDefault(require(a616_0x582706(0xf9))),Ticket_1=__importDefault(require(a616_0x582706(0xf4))),logger_1=require(a616_0x582706(0xfe)),CreateOrUpdateBaileysService_1=__importDefault(require(a616_0x582706(0x116))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),CompaniesSettings_1=__importDefault(require(a616_0x582706(0xdf)));let i=0x0;setInterval(()=>{i=0x0;},0x1388);const wbotMonitor=async(_0x52ab59,_0x170318,_0x22afd9)=>{const _0x83f707=a616_0x582706;try{_0x52ab59['ws']['on'](_0x83f707(0xec),async _0xcef9f=>{const _0x5da940=_0x83f707,_0x4dc2d8=_0xcef9f['content'][0x0];await new Promise(_0x7f0e2d=>setTimeout(_0x7f0e2d,i*0x28a)),i++;if(_0x4dc2d8[_0x5da940(0xff)]===_0x5da940(0x119)&&!_0xcef9f['attrs'][_0x5da940(0xf6)]['includes'](_0x5da940(0xe7))){const _0x31fa2e=await CompaniesSettings_1['default'][_0x5da940(0x103)]({'where':{'companyId':_0x22afd9}});if(_0x31fa2e['acceptCallWhatsapp']==='enabled'){await _0x52ab59[_0x5da940(0x10c)](_0xcef9f['attrs'][_0x5da940(0xf6)],{'text':'‎\x20*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitadas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado'});const _0x3df14d=_0xcef9f[_0x5da940(0xed)][_0x5da940(0xf6)]['split'](':')[0x0][_0x5da940(0x113)](/\D/g,''),_0x3aac1c=await Contact_1[_0x5da940(0xe5)][_0x5da940(0x103)]({'where':{'companyId':_0x22afd9,'number':_0x3df14d}}),_0x34c3c5=await Ticket_1['default'][_0x5da940(0x103)]({'where':{'contactId':_0x3aac1c['id'],'whatsappId':_0x52ab59['id'],'companyId':_0x22afd9},'order':[['id',_0x5da940(0x11a)]]});if(!_0x34c3c5)return;const _0x17c9f2=new Date(),_0x43f93f=_0x17c9f2[_0x5da940(0x109)](),_0x58f273=_0x17c9f2[_0x5da940(0x10b)](),_0x84869c=_0x5da940(0x118)+_0x43f93f+':'+_0x58f273,_0x4fac17={'wid':_0x4dc2d8[_0x5da940(0xed)][_0x5da940(0xf0)],'ticketId':_0x34c3c5['id'],'contactId':_0x3aac1c['id'],'body':_0x84869c,'fromMe':![],'mediaType':_0x5da940(0xfd),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x34c3c5['update']({'lastMessage':_0x84869c}),_0x34c3c5[_0x5da940(0xe2)]===_0x5da940(0x112)&&await _0x34c3c5[_0x5da940(0xf2)]({'status':_0x5da940(0x108)}),(0x0,CreateMessageService_1['default'])({'messageData':_0x4fac17,'companyId':_0x22afd9});}}});function _0x1d1c31(_0x388a56){const _0x5d8c7a=_0x83f707;return _0x388a56[_0x5d8c7a(0x113)](/[\x00-\x1F"\\']/g,'');}_0x52ab59['ev']['on'](_0x83f707(0x105),async _0x27afd5=>{const _0x2fd6a6=_0x83f707,_0x14e430=[];try{Promise[_0x2fd6a6(0xe4)](_0x27afd5[_0x2fd6a6(0x110)](async _0xc7056d=>{const _0x21bd87=_0x2fd6a6;if(!(0x0,baileys_1['isJidBroadcast'])(_0xc7056d['id'])&&!(0x0,baileys_1[_0x21bd87(0x106)])(_0xc7056d['id'])&&(0x0,baileys_1[_0x21bd87(0x114)])(_0xc7056d['id'])){const _0x47a0a1={'id':_0xc7056d['id'],'name':_0xc7056d[_0x21bd87(0xf1)]?_0x1d1c31(_0xc7056d['name']):_0xc7056d['id'][_0x21bd87(0x102)]('@')[0x0][_0x21bd87(0x102)](':')[0x0]};_0x14e430[_0x21bd87(0xfc)](_0x47a0a1);}})),console['log'](_0x14e430);}catch(_0x472c41){Sentry['captureException'](_0x472c41),logger_1[_0x2fd6a6(0xe6)][_0x2fd6a6(0x117)]('Erro\x20contacts.upsert:\x20'+JSON[_0x2fd6a6(0xe3)](_0x472c41));}try{await(0x0,CreateOrUpdateBaileysService_1['default'])({'whatsappId':_0x170318['id'],'contacts':_0x14e430});}catch(_0x5adc0d){logger_1[_0x2fd6a6(0xe6)][_0x2fd6a6(0x117)](_0x5adc0d);}});}catch(_0x328f80){Sentry[_0x83f707(0xfb)](_0x328f80),logger_1[_0x83f707(0xe6)][_0x83f707(0x117)](_0x328f80);}};exports[a616_0x582706(0xe5)]=wbotMonitor;
>>>>>>> ab722bfbcf394d74dd0b99a984c0dcf6ffbcff7f
