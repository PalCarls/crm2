'use strict';const a636_0x34e5b0=a636_0x1bb1;(function(_0xeee36a,_0x1c9b9d){const _0x5780cb=a636_0x1bb1,_0x72f399=_0xeee36a();while(!![]){try{const _0x5725fd=-parseInt(_0x5780cb(0x1b3))/0x1*(parseInt(_0x5780cb(0x19f))/0x2)+-parseInt(_0x5780cb(0x176))/0x3*(-parseInt(_0x5780cb(0x19c))/0x4)+-parseInt(_0x5780cb(0x183))/0x5+-parseInt(_0x5780cb(0x196))/0x6+parseInt(_0x5780cb(0x1aa))/0x7*(-parseInt(_0x5780cb(0x189))/0x8)+parseInt(_0x5780cb(0x171))/0x9+parseInt(_0x5780cb(0x191))/0xa*(parseInt(_0x5780cb(0x18e))/0xb);if(_0x5725fd===_0x1c9b9d)break;else _0x72f399['push'](_0x72f399['shift']());}catch(_0x2a1b62){_0x72f399['push'](_0x72f399['shift']());}}}(a636_0x4fa2,0xa5a4a));function a636_0x1bb1(_0x5dddf7,_0x3c46a1){const _0x4fa2b3=a636_0x4fa2();return a636_0x1bb1=function(_0x1bb1e8,_0x340988){_0x1bb1e8=_0x1bb1e8-0x169;let _0x2a5597=_0x4fa2b3[_0x1bb1e8];return _0x2a5597;},a636_0x1bb1(_0x5dddf7,_0x3c46a1);}var __createBinding=this&&this[a636_0x34e5b0(0x1ac)]||(Object[a636_0x34e5b0(0x174)]?function(_0x4103de,_0x5d5d4d,_0x4d9f37,_0x2fb2d2){const _0x17b901=a636_0x34e5b0;if(_0x2fb2d2===undefined)_0x2fb2d2=_0x4d9f37;var _0x480380=Object[_0x17b901(0x194)](_0x5d5d4d,_0x4d9f37);(!_0x480380||(_0x17b901(0x1a8)in _0x480380?!_0x5d5d4d[_0x17b901(0x16e)]:_0x480380[_0x17b901(0x187)]||_0x480380[_0x17b901(0x1a7)]))&&(_0x480380={'enumerable':!![],'get':function(){return _0x5d5d4d[_0x4d9f37];}}),Object['defineProperty'](_0x4103de,_0x2fb2d2,_0x480380);}:function(_0x308f4c,_0xd8e2c,_0x4533d5,_0x51fdd6){if(_0x51fdd6===undefined)_0x51fdd6=_0x4533d5;_0x308f4c[_0x51fdd6]=_0xd8e2c[_0x4533d5];}),__setModuleDefault=this&&this[a636_0x34e5b0(0x17d)]||(Object[a636_0x34e5b0(0x174)]?function(_0x59f3d7,_0x222fd2){Object['defineProperty'](_0x59f3d7,'default',{'enumerable':!![],'value':_0x222fd2});}:function(_0x500f59,_0xa4d032){_0x500f59['default']=_0xa4d032;}),__importStar=this&&this[a636_0x34e5b0(0x1af)]||function(_0x2aeaee){const _0x2dd164=a636_0x34e5b0;if(_0x2aeaee&&_0x2aeaee[_0x2dd164(0x16e)])return _0x2aeaee;var _0x4ddf1b={};if(_0x2aeaee!=null){for(var _0xc00cf6 in _0x2aeaee)if(_0xc00cf6!==_0x2dd164(0x18d)&&Object[_0x2dd164(0x1b1)][_0x2dd164(0x16a)]['call'](_0x2aeaee,_0xc00cf6))__createBinding(_0x4ddf1b,_0x2aeaee,_0xc00cf6);}return __setModuleDefault(_0x4ddf1b,_0x2aeaee),_0x4ddf1b;},__importDefault=this&&this[a636_0x34e5b0(0x1a1)]||function(_0x2c3de6){const _0x58c4a6=a636_0x34e5b0;return _0x2c3de6&&_0x2c3de6[_0x58c4a6(0x16e)]?_0x2c3de6:{'default':_0x2c3de6};};Object[a636_0x34e5b0(0x190)](exports,'__esModule',{'value':!![]});const baileys_1=require(a636_0x34e5b0(0x192)),Sentry=__importStar(require(a636_0x34e5b0(0x19a))),fs_1=__importDefault(require('fs')),Contact_1=__importDefault(require(a636_0x34e5b0(0x16d))),Ticket_1=__importDefault(require(a636_0x34e5b0(0x1a6))),logger_1=require(a636_0x34e5b0(0x175)),CreateOrUpdateBaileysService_1=__importDefault(require(a636_0x34e5b0(0x1b2))),CreateMessageService_1=__importDefault(require(a636_0x34e5b0(0x1a2))),CompaniesSettings_1=__importDefault(require(a636_0x34e5b0(0x1a0))),path_1=__importDefault(require(a636_0x34e5b0(0x186)));function a636_0x4fa2(){const _0xf36d77=['defineProperty','2228540LDqqKM','@whiskeysockets/baileys','resolve','getOwnPropertyDescriptor','acceptCallWhatsapp','1502700gZwPrr','captureException','from','update','@sentry/node','existsSync','627092wSKztu','replace','getMinutes','194OMVowq','../../models/CompaniesSettings','__importDefault','../MessageServices/CreateMessageService','chmodSync','join','map','../../models/Ticket','configurable','get','tag','1404172Nhnkgp','call-id','__createBinding','all','@call','__importStar','public','prototype','../BaileysServices/CreateOrUpdateBaileysService','8743yaXUte','pending','hasOwnProperty','status','findOne','../../models/Contact','__esModule','split','Erro\x20contacts.upsert:\x20','113823Aavnyc','call_log','push','create','../../utils/logger','3FREeUt','name','log','terminate','‎\x20*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitadas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','isJidBroadcast','getHours','__setModuleDefault','company','attrs','includes','contactJson.txt','DESC','6558925jGPdzj','contacts.upsert','CB:call','path','writable','sendMessage','8mIpVuA','promises','error','enabled','default','154WkQtNN','logger'];a636_0x4fa2=function(){return _0xf36d77;};return a636_0x4fa2();}let i=0x0;setInterval(()=>{i=0x0;},0x1388);const wbotMonitor=async(_0x40714d,_0x46cb49,_0x389b59)=>{const _0x205ef7=a636_0x34e5b0;try{_0x40714d['ws']['on'](_0x205ef7(0x185),async _0x442559=>{const _0x3bf540=_0x205ef7,_0x3813eb=_0x442559['content'][0x0];await new Promise(_0x2f00b4=>setTimeout(_0x2f00b4,i*0x28a)),i++;if(_0x3813eb[_0x3bf540(0x1a9)]===_0x3bf540(0x179)&&!_0x442559['attrs'][_0x3bf540(0x198)][_0x3bf540(0x180)](_0x3bf540(0x1ae))){const _0x153881=await CompaniesSettings_1[_0x3bf540(0x18d)][_0x3bf540(0x16c)]({'where':{'companyId':_0x389b59}});if(_0x153881[_0x3bf540(0x195)]===_0x3bf540(0x18c)){await _0x40714d[_0x3bf540(0x188)](_0x442559[_0x3bf540(0x17f)][_0x3bf540(0x198)],{'text':_0x3bf540(0x17a)});const _0x4e590b=_0x442559[_0x3bf540(0x17f)][_0x3bf540(0x198)][_0x3bf540(0x16f)](':')[0x0][_0x3bf540(0x19d)](/\D/g,''),_0x49f13d=await Contact_1['default'][_0x3bf540(0x16c)]({'where':{'companyId':_0x389b59,'number':_0x4e590b}});if(!_0x49f13d)return;const _0x2a0bee=await Ticket_1[_0x3bf540(0x18d)][_0x3bf540(0x16c)]({'where':{'contactId':_0x49f13d['id'],'whatsappId':_0x40714d['id'],'companyId':_0x389b59},'order':[['id',_0x3bf540(0x182)]]});if(!_0x2a0bee)return;const _0x166016=new Date(),_0x38effb=_0x166016[_0x3bf540(0x17c)](),_0x544ffd=_0x166016[_0x3bf540(0x19e)](),_0x439f72='Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20'+_0x38effb+':'+_0x544ffd,_0x4ac8ae={'wid':_0x3813eb['attrs'][_0x3bf540(0x1ab)],'ticketId':_0x2a0bee['id'],'contactId':_0x49f13d['id'],'body':_0x439f72,'fromMe':![],'mediaType':_0x3bf540(0x172),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x2a0bee[_0x3bf540(0x199)]({'lastMessage':_0x439f72}),_0x2a0bee[_0x3bf540(0x16b)]==='closed'&&await _0x2a0bee[_0x3bf540(0x199)]({'status':_0x3bf540(0x169)}),(0x0,CreateMessageService_1[_0x3bf540(0x18d)])({'messageData':_0x4ac8ae,'companyId':_0x389b59});}}});function _0x9a8004(_0x32ca91){return _0x32ca91['replace'](/[\x00-\x1F"\\']/g,'');}_0x40714d['ev']['on'](_0x205ef7(0x184),async _0x4d277e=>{const _0x115c6e=_0x205ef7,_0x2bd6e0=[];try{Promise[_0x115c6e(0x1ad)](_0x4d277e[_0x115c6e(0x1a5)](async _0x252a86=>{const _0x1254ee=_0x115c6e;if(!(0x0,baileys_1[_0x1254ee(0x17b)])(_0x252a86['id'])&&!(0x0,baileys_1['isJidStatusBroadcast'])(_0x252a86['id'])&&(0x0,baileys_1['isJidUser'])(_0x252a86['id'])){const _0x366af2={'id':_0x252a86['id'],'name':_0x252a86[_0x1254ee(0x177)]?_0x9a8004(_0x252a86[_0x1254ee(0x177)]):_0x252a86['id'][_0x1254ee(0x16f)]('@')[0x0][_0x1254ee(0x16f)](':')[0x0]};_0x2bd6e0[_0x1254ee(0x173)](_0x366af2);}}));const _0x47d535=path_1['default'][_0x115c6e(0x193)](__dirname,'..','..','..',_0x115c6e(0x1b0));!fs_1[_0x115c6e(0x18d)][_0x115c6e(0x19b)](path_1[_0x115c6e(0x18d)]['join'](_0x47d535,_0x115c6e(0x17e)+_0x389b59))&&(fs_1[_0x115c6e(0x18d)]['mkdirSync'](path_1[_0x115c6e(0x18d)][_0x115c6e(0x1a4)](_0x47d535,_0x115c6e(0x17e)+_0x389b59),{'recursive':!![]}),fs_1[_0x115c6e(0x18d)][_0x115c6e(0x1a3)](path_1[_0x115c6e(0x18d)]['join'](_0x47d535,_0x115c6e(0x17e)+_0x389b59),0x1ff));const _0x5bd366=path_1[_0x115c6e(0x18d)]['join'](_0x47d535,_0x115c6e(0x17e)+_0x389b59,_0x115c6e(0x181));fs_1['default'][_0x115c6e(0x19b)](_0x5bd366)&&await fs_1[_0x115c6e(0x18d)]['unlinkSync'](_0x5bd366),await fs_1[_0x115c6e(0x18d)][_0x115c6e(0x18a)]['writeFile'](_0x5bd366,JSON['stringify'](_0x2bd6e0,null,0x2)),console[_0x115c6e(0x178)](_0x2bd6e0);}catch(_0x4607c9){Sentry[_0x115c6e(0x197)](_0x4607c9),logger_1[_0x115c6e(0x18f)][_0x115c6e(0x18b)](_0x115c6e(0x170)+JSON['stringify'](_0x4607c9));}try{await(0x0,CreateOrUpdateBaileysService_1['default'])({'whatsappId':_0x46cb49['id'],'contacts':_0x2bd6e0});}catch(_0x39b8ec){logger_1['logger'][_0x115c6e(0x18b)](_0x39b8ec);}});}catch(_0x18a44a){Sentry['captureException'](_0x18a44a),logger_1[_0x205ef7(0x18f)][_0x205ef7(0x18b)](_0x18a44a);}};exports[a636_0x34e5b0(0x18d)]=wbotMonitor;