'use strict';const a554_0x4b7caa=a554_0x3630;(function(_0x503be8,_0x218c4e){const _0x54bfe9=a554_0x3630,_0x2ba173=_0x503be8();while(!![]){try{const _0x13a27d=parseInt(_0x54bfe9(0x1b8))/0x1*(-parseInt(_0x54bfe9(0x1af))/0x2)+-parseInt(_0x54bfe9(0x1a3))/0x3+-parseInt(_0x54bfe9(0x19f))/0x4*(-parseInt(_0x54bfe9(0x195))/0x5)+parseInt(_0x54bfe9(0x1ae))/0x6*(-parseInt(_0x54bfe9(0x1a2))/0x7)+parseInt(_0x54bfe9(0x1b9))/0x8*(-parseInt(_0x54bfe9(0x1b6))/0x9)+-parseInt(_0x54bfe9(0x1a1))/0xa+parseInt(_0x54bfe9(0x1a4))/0xb*(parseInt(_0x54bfe9(0x1aa))/0xc);if(_0x13a27d===_0x218c4e)break;else _0x2ba173['push'](_0x2ba173['shift']());}catch(_0x4ec022){_0x2ba173['push'](_0x2ba173['shift']());}}}(a554_0x21a5,0xf2d86));var __createBinding=this&&this[a554_0x4b7caa(0x1b1)]||(Object['create']?function(_0x4bf9bb,_0x158c5d,_0x1b6b93,_0x3abe59){const _0x4c4a27=a554_0x4b7caa;if(_0x3abe59===undefined)_0x3abe59=_0x1b6b93;var _0x5a3806=Object[_0x4c4a27(0x199)](_0x158c5d,_0x1b6b93);(!_0x5a3806||('get'in _0x5a3806?!_0x158c5d[_0x4c4a27(0x1b5)]:_0x5a3806['writable']||_0x5a3806[_0x4c4a27(0x1ac)]))&&(_0x5a3806={'enumerable':!![],'get':function(){return _0x158c5d[_0x1b6b93];}}),Object['defineProperty'](_0x4bf9bb,_0x3abe59,_0x5a3806);}:function(_0x18b444,_0x4661bf,_0x2b19ad,_0x335354){if(_0x335354===undefined)_0x335354=_0x2b19ad;_0x18b444[_0x335354]=_0x4661bf[_0x2b19ad];}),__setModuleDefault=this&&this[a554_0x4b7caa(0x194)]||(Object['create']?function(_0x525824,_0x57aa18){const _0x47d51b=a554_0x4b7caa;Object[_0x47d51b(0x1ab)](_0x525824,_0x47d51b(0x192),{'enumerable':!![],'value':_0x57aa18});}:function(_0x4e98ad,_0x59f9f1){_0x4e98ad['default']=_0x59f9f1;}),__importStar=this&&this['__importStar']||function(_0xf45280){const _0x41acca=a554_0x4b7caa;if(_0xf45280&&_0xf45280['__esModule'])return _0xf45280;var _0x382b7d={};if(_0xf45280!=null){for(var _0x4f0192 in _0xf45280)if(_0x4f0192!==_0x41acca(0x192)&&Object['prototype']['hasOwnProperty']['call'](_0xf45280,_0x4f0192))__createBinding(_0x382b7d,_0xf45280,_0x4f0192);}return __setModuleDefault(_0x382b7d,_0xf45280),_0x382b7d;},__importDefault=this&&this[a554_0x4b7caa(0x1a7)]||function(_0x1b60e6){const _0x3ed181=a554_0x4b7caa;return _0x1b60e6&&_0x1b60e6[_0x3ed181(0x1b5)]?_0x1b60e6:{'default':_0x1b60e6};};function a554_0x3630(_0x5a3958,_0x353bb7){const _0x21a590=a554_0x21a5();return a554_0x3630=function(_0x36301f,_0x3ef4d8){_0x36301f=_0x36301f-0x190;let _0x32cb96=_0x21a590[_0x36301f];return _0x32cb96;},a554_0x3630(_0x5a3958,_0x353bb7);}function a554_0x21a5(){const _0x233405=['../BaileysServices/CreateOrUpdateBaileysService','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','CB:call','getOwnPropertyDescriptor','call_log','update','@sentry/node','closed','../../models/Setting','5240oUjGEg','getHours','19380240LgYaSQ','2431499ozrUGx','3665871YIvUxz','155386yZDcRl','captureException','findOne','__importDefault','getMinutes','contacts.upsert','5412axbTzq','defineProperty','configurable','terminate','18ZQCeZV','12XBAcka','../../models/Contact','__createBinding','replace','pending','from','__esModule','3955266UbmzNo','disabled','95153xdACnU','24pTPHez','attrs','acceptCallWhatsapp','../../models/Ticket','tag','value','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','default','logger','__setModuleDefault','2730oVLGAQ'];a554_0x21a5=function(){return _0x233405;};return a554_0x21a5();}Object[a554_0x4b7caa(0x1ab)](exports,'__esModule',{'value':!![]});const Sentry=__importStar(require(a554_0x4b7caa(0x19c))),Contact_1=__importDefault(require(a554_0x4b7caa(0x1b0))),Setting_1=__importDefault(require(a554_0x4b7caa(0x19e))),Ticket_1=__importDefault(require(a554_0x4b7caa(0x1bc))),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require(a554_0x4b7caa(0x196))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),wbotMonitor=async(_0x26fb6c,_0x57e3f9,_0x33fd91)=>{const _0x4ebbb1=a554_0x4b7caa;try{_0x26fb6c['ws']['on'](_0x4ebbb1(0x198),async _0x4cc9ca=>{const _0x5c6f77=_0x4ebbb1,_0x306d7e=_0x4cc9ca['content'][0x0];if(_0x306d7e[_0x5c6f77(0x1bd)]===_0x5c6f77(0x1ad)){const _0x359a58=await Setting_1['default'][_0x5c6f77(0x1a6)]({'where':{'key':_0x5c6f77(0x1bb),'companyId':_0x33fd91}});if(_0x359a58[_0x5c6f77(0x190)]===_0x5c6f77(0x1b7)){await _0x26fb6c['sendMessage'](_0x4cc9ca[_0x5c6f77(0x1ba)][_0x5c6f77(0x1b4)],{'text':_0x5c6f77(0x191)});const _0xeb000e=_0x4cc9ca['attrs'][_0x5c6f77(0x1b4)][_0x5c6f77(0x1b2)](/\D/g,''),_0x1fcf0a=await Contact_1[_0x5c6f77(0x192)][_0x5c6f77(0x1a6)]({'where':{'companyId':_0x33fd91,'number':_0xeb000e}}),_0x2852cf=await Ticket_1[_0x5c6f77(0x192)][_0x5c6f77(0x1a6)]({'where':{'contactId':_0x1fcf0a['id'],'whatsappId':_0x26fb6c['id'],'companyId':_0x33fd91}});if(!_0x2852cf)return;const _0x13549d=new Date(),_0x45e08b=_0x13549d[_0x5c6f77(0x1a0)](),_0x23f8a8=_0x13549d[_0x5c6f77(0x1a8)](),_0x580002=_0x5c6f77(0x197)+_0x45e08b+':'+_0x23f8a8,_0x5616de={'wid':_0x306d7e[_0x5c6f77(0x1ba)]['call-id'],'ticketId':_0x2852cf['id'],'contactId':_0x1fcf0a['id'],'body':_0x580002,'fromMe':![],'mediaType':_0x5c6f77(0x19a),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x2852cf[_0x5c6f77(0x19b)]({'lastMessage':_0x580002}),_0x2852cf['status']===_0x5c6f77(0x19d)&&await _0x2852cf[_0x5c6f77(0x19b)]({'status':_0x5c6f77(0x1b3)}),(0x0,CreateMessageService_1[_0x5c6f77(0x192)])({'messageData':_0x5616de,'companyId':_0x33fd91});}}}),_0x26fb6c['ev']['on'](_0x4ebbb1(0x1a9),async _0xb6503f=>{const _0x224830=_0x4ebbb1;await(0x0,CreateOrUpdateBaileysService_1[_0x224830(0x192)])({'whatsappId':_0x57e3f9['id'],'contacts':_0xb6503f});});}catch(_0x1b69e2){Sentry[_0x4ebbb1(0x1a5)](_0x1b69e2),logger_1[_0x4ebbb1(0x193)]['error'](_0x1b69e2);}};exports[a554_0x4b7caa(0x192)]=wbotMonitor;