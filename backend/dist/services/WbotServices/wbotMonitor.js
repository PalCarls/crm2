'use strict';const a570_0x10f0a4=a570_0x158a;(function(_0x337c53,_0x493a63){const _0x38dead=a570_0x158a,_0x1f961e=_0x337c53();while(!![]){try{const _0x2c9a62=-parseInt(_0x38dead(0xc8))/0x1*(-parseInt(_0x38dead(0xb8))/0x2)+parseInt(_0x38dead(0xb4))/0x3+parseInt(_0x38dead(0xba))/0x4*(parseInt(_0x38dead(0xbd))/0x5)+-parseInt(_0x38dead(0xbc))/0x6+parseInt(_0x38dead(0xd2))/0x7*(parseInt(_0x38dead(0xb2))/0x8)+-parseInt(_0x38dead(0xd1))/0x9+-parseInt(_0x38dead(0xc5))/0xa;if(_0x2c9a62===_0x493a63)break;else _0x1f961e['push'](_0x1f961e['shift']());}catch(_0x2e2c14){_0x1f961e['push'](_0x1f961e['shift']());}}}(a570_0x4bd1,0xe4988));var __createBinding=this&&this[a570_0x10f0a4(0xb7)]||(Object[a570_0x10f0a4(0xc9)]?function(_0x516f6f,_0x1ed303,_0x5f14fc,_0x38c9fd){const _0x2583f7=a570_0x10f0a4;if(_0x38c9fd===undefined)_0x38c9fd=_0x5f14fc;var _0x41175b=Object[_0x2583f7(0xd0)](_0x1ed303,_0x5f14fc);(!_0x41175b||(_0x2583f7(0xb0)in _0x41175b?!_0x1ed303[_0x2583f7(0xb9)]:_0x41175b[_0x2583f7(0xca)]||_0x41175b[_0x2583f7(0xb6)]))&&(_0x41175b={'enumerable':!![],'get':function(){return _0x1ed303[_0x5f14fc];}}),Object['defineProperty'](_0x516f6f,_0x38c9fd,_0x41175b);}:function(_0x4dc27a,_0x17fe2c,_0x49bf37,_0x196874){if(_0x196874===undefined)_0x196874=_0x49bf37;_0x4dc27a[_0x196874]=_0x17fe2c[_0x49bf37];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x35299a,_0x52602a){const _0x24deaf=a570_0x10f0a4;Object[_0x24deaf(0xad)](_0x35299a,_0x24deaf(0xc3),{'enumerable':!![],'value':_0x52602a});}:function(_0x427989,_0x185db3){const _0x54c5ca=a570_0x10f0a4;_0x427989[_0x54c5ca(0xc3)]=_0x185db3;}),__importStar=this&&this[a570_0x10f0a4(0xcf)]||function(_0x2cb511){const _0xb86ad7=a570_0x10f0a4;if(_0x2cb511&&_0x2cb511[_0xb86ad7(0xb9)])return _0x2cb511;var _0x2f95cc={};if(_0x2cb511!=null){for(var _0x4b3c96 in _0x2cb511)if(_0x4b3c96!==_0xb86ad7(0xc3)&&Object['prototype'][_0xb86ad7(0xab)]['call'](_0x2cb511,_0x4b3c96))__createBinding(_0x2f95cc,_0x2cb511,_0x4b3c96);}return __setModuleDefault(_0x2f95cc,_0x2cb511),_0x2f95cc;},__importDefault=this&&this[a570_0x10f0a4(0xcc)]||function(_0xade3dc){const _0x5db2e7=a570_0x10f0a4;return _0xade3dc&&_0xade3dc[_0x5db2e7(0xb9)]?_0xade3dc:{'default':_0xade3dc};};Object[a570_0x10f0a4(0xad)](exports,'__esModule',{'value':!![]});const Sentry=__importStar(require('@sentry/node')),Contact_1=__importDefault(require(a570_0x10f0a4(0xce))),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require(a570_0x10f0a4(0xc6)),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require(a570_0x10f0a4(0xae))),CompaniesSettings_1=__importDefault(require('../../models/CompaniesSettings')),wbotMonitor=async(_0x59d2b3,_0x5e2876,_0x43c2d4)=>{const _0x29bcc0=a570_0x10f0a4;try{_0x59d2b3['ws']['on'](_0x29bcc0(0xd5),async _0xbdd6fb=>{const _0x35103d=_0x29bcc0,_0x1578fb=_0xbdd6fb[_0x35103d(0xcd)][0x0];if(_0x1578fb[_0x35103d(0xc1)]===_0x35103d(0xd4)){const _0x210222=await CompaniesSettings_1[_0x35103d(0xc3)][_0x35103d(0xc0)]({'where':{'companyId':_0x43c2d4}});if(_0x210222['acceptCallWhatsapp']===_0x35103d(0xaf)){await _0x59d2b3[_0x35103d(0xb3)](_0xbdd6fb[_0x35103d(0xbf)][_0x35103d(0xd6)],{'text':_0x35103d(0xc2)});const _0x9f7a89=_0xbdd6fb[_0x35103d(0xbf)]['from'][_0x35103d(0xbb)](/\D/g,''),_0x147852=await Contact_1['default'][_0x35103d(0xc0)]({'where':{'companyId':_0x43c2d4,'number':_0x9f7a89}}),_0x1fc00b=await Ticket_1[_0x35103d(0xc3)][_0x35103d(0xc0)]({'where':{'contactId':_0x147852['id'],'whatsappId':_0x59d2b3['id'],'companyId':_0x43c2d4}});if(!_0x1fc00b)return;const _0x4f505e=new Date(),_0x4f852c=_0x4f505e['getHours'](),_0xa69c6=_0x4f505e[_0x35103d(0xbe)](),_0x3ddab8=_0x35103d(0xac)+_0x4f852c+':'+_0xa69c6,_0x301789={'wid':_0x1578fb[_0x35103d(0xbf)][_0x35103d(0xb5)],'ticketId':_0x1fc00b['id'],'contactId':_0x147852['id'],'body':_0x3ddab8,'fromMe':![],'mediaType':_0x35103d(0xcb),'read':!![],'quotedMsgId':null,'ack':0x1};return await _0x1fc00b[_0x35103d(0xc7)]({'lastMessage':_0x3ddab8}),_0x1fc00b[_0x35103d(0xd3)]==='closed'&&await _0x1fc00b[_0x35103d(0xc7)]({'status':_0x35103d(0xc4)}),(0x0,CreateMessageService_1[_0x35103d(0xc3)])({'messageData':_0x301789,'companyId':_0x43c2d4});}}}),_0x59d2b3['ev']['on'](_0x29bcc0(0xb1),async _0x14099a=>{const _0x257ac4=_0x29bcc0;await(0x0,CreateOrUpdateBaileysService_1[_0x257ac4(0xc3)])({'whatsappId':_0x5e2876['id'],'contacts':_0x14099a});});}catch(_0x139996){Sentry['captureException'](_0x139996),logger_1[_0x29bcc0(0xaa)]['error'](_0x139996);}};function a570_0x158a(_0x3a1b4c,_0x3c5268){const _0x4bd162=a570_0x4bd1();return a570_0x158a=function(_0x158a60,_0x12fc7c){_0x158a60=_0x158a60-0xaa;let _0x13f4de=_0x4bd162[_0x158a60];return _0x13f4de;},a570_0x158a(_0x3a1b4c,_0x3c5268);}function a570_0x4bd1(){const _0x4d32e8=['replace','8394684kUZJYL','5224260RMYaWo','getMinutes','attrs','findOne','tag','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','default','pending','5269810xPdvSd','../../utils/logger','update','21QCSlUV','create','writable','call_log','__importDefault','content','../../models/Contact','__importStar','getOwnPropertyDescriptor','13859910QxKENo','53984xEOTVo','status','terminate','CB:call','from','logger','hasOwnProperty','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','defineProperty','../MessageServices/CreateMessageService','disabled','get','contacts.upsert','1672IxBMQm','sendMessage','3078501mMrpIl','call-id','configurable','__createBinding','68532UekQNz','__esModule','4IDsMFW'];a570_0x4bd1=function(){return _0x4d32e8;};return a570_0x4bd1();}exports['default']=wbotMonitor;