'use strict';const a599_0x3f5fdd=a599_0x353d;function a599_0x353d(_0x497f73,_0x5b4785){const _0x32af5f=a599_0x32af();return a599_0x353d=function(_0x353d98,_0x2eb3d1){_0x353d98=_0x353d98-0xaa;let _0x5891ef=_0x32af5f[_0x353d98];return _0x5891ef;},a599_0x353d(_0x497f73,_0x5b4785);}(function(_0x259ec8,_0xb73505){const _0x3c609d=a599_0x353d,_0x47158f=_0x259ec8();while(!![]){try{const _0x3511d4=-parseInt(_0x3c609d(0xef))/0x1+-parseInt(_0x3c609d(0xaf))/0x2*(-parseInt(_0x3c609d(0xf2))/0x3)+-parseInt(_0x3c609d(0xb8))/0x4*(parseInt(_0x3c609d(0x112))/0x5)+-parseInt(_0x3c609d(0xfd))/0x6+-parseInt(_0x3c609d(0xbd))/0x7*(parseInt(_0x3c609d(0xd8))/0x8)+parseInt(_0x3c609d(0xbb))/0x9*(-parseInt(_0x3c609d(0x114))/0xa)+-parseInt(_0x3c609d(0xe9))/0xb*(-parseInt(_0x3c609d(0xbe))/0xc);if(_0x3511d4===_0xb73505)break;else _0x47158f['push'](_0x47158f['shift']());}catch(_0x3c8945){_0x47158f['push'](_0x47158f['shift']());}}}(a599_0x32af,0x30b33));var __createBinding=this&&this['__createBinding']||(Object[a599_0x3f5fdd(0xcc)]?function(_0x286d54,_0x1ea7cd,_0x19015b,_0x522683){const _0xb0d0bb=a599_0x3f5fdd;if(_0x522683===undefined)_0x522683=_0x19015b;var _0x2e958d=Object[_0xb0d0bb(0xb7)](_0x1ea7cd,_0x19015b);(!_0x2e958d||(_0xb0d0bb(0xe8)in _0x2e958d?!_0x1ea7cd[_0xb0d0bb(0xac)]:_0x2e958d[_0xb0d0bb(0xcb)]||_0x2e958d[_0xb0d0bb(0x10c)]))&&(_0x2e958d={'enumerable':!![],'get':function(){return _0x1ea7cd[_0x19015b];}}),Object[_0xb0d0bb(0xb1)](_0x286d54,_0x522683,_0x2e958d);}:function(_0x56ed70,_0x536f7e,_0x1333fd,_0x45b1c6){if(_0x45b1c6===undefined)_0x45b1c6=_0x1333fd;_0x56ed70[_0x45b1c6]=_0x536f7e[_0x1333fd];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x1febeb,_0x4d050d){const _0x2be123=a599_0x3f5fdd;Object[_0x2be123(0xb1)](_0x1febeb,_0x2be123(0xf7),{'enumerable':!![],'value':_0x4d050d});}:function(_0x33992e,_0x51bd69){_0x33992e['default']=_0x51bd69;}),__importStar=this&&this[a599_0x3f5fdd(0xf1)]||function(_0x12c7a9){const _0x4cc044=a599_0x3f5fdd;if(_0x12c7a9&&_0x12c7a9['__esModule'])return _0x12c7a9;var _0x317691={};if(_0x12c7a9!=null){for(var _0x43d933 in _0x12c7a9)if(_0x43d933!==_0x4cc044(0xf7)&&Object['prototype']['hasOwnProperty']['call'](_0x12c7a9,_0x43d933))__createBinding(_0x317691,_0x12c7a9,_0x43d933);}return __setModuleDefault(_0x317691,_0x12c7a9),_0x317691;},__importDefault=this&&this['__importDefault']||function(_0x3005a5){const _0x2d05aa=a599_0x3f5fdd;return _0x3005a5&&_0x3005a5[_0x2d05aa(0xac)]?_0x3005a5:{'default':_0x3005a5};};Object['defineProperty'](exports,a599_0x3f5fdd(0xac),{'value':!![]}),exports[a599_0x3f5fdd(0xb0)]=exports[a599_0x3f5fdd(0xd6)]=void 0x0;const path_1=__importDefault(require(a599_0x3f5fdd(0xe5))),wbotMessageListener_1=require(a599_0x3f5fdd(0xde)),ShowDialogChatBotsServices_1=__importDefault(require(a599_0x3f5fdd(0x110))),ShowQueueService_1=__importDefault(require('../QueueService/ShowQueueService')),ShowChatBotServices_1=__importDefault(require(a599_0x3f5fdd(0xd3))),DeleteDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/DeleteDialogChatBotsServices')),ShowChatBotByChatbotIdServices_1=__importDefault(require(a599_0x3f5fdd(0x107))),CreateDialogChatBotsServices_1=__importDefault(require(a599_0x3f5fdd(0x10a))),ShowWhatsAppService_1=__importDefault(require(a599_0x3f5fdd(0xae))),Mustache_1=__importDefault(require('../../helpers/Mustache')),UpdateTicketService_1=__importDefault(require(a599_0x3f5fdd(0xdc))),ShowService_1=__importDefault(require(a599_0x3f5fdd(0xb4))),SendWhatsAppMedia_1=__importStar(require(a599_0x3f5fdd(0xdd))),CompaniesSettings_1=__importDefault(require(a599_0x3f5fdd(0xb9))),fs=require('fs');var axios=require(a599_0x3f5fdd(0xf3));const isNumeric=_0x4f81de=>/^-?\d+$/[a599_0x3f5fdd(0x108)](_0x4f81de),deleteAndCreateDialogStage=async(_0x2506ea,_0x2ca177,_0x1820a1)=>{const _0x53e5c0=a599_0x3f5fdd;try{await(0x0,DeleteDialogChatBotsServices_1[_0x53e5c0(0xf7)])(_0x2506ea['id']);const _0x315cab=await(0x0,ShowChatBotByChatbotIdServices_1[_0x53e5c0(0xf7)])(_0x2ca177);return!_0x315cab&&await _0x1820a1['update']({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1['default'])({'awaiting':0x1,'contactId':_0x2506ea['id'],'chatbotId':_0x2ca177,'queueId':_0x315cab[_0x53e5c0(0xf8)]});}catch(_0x1b60de){await _0x1820a1['update']({'isBot':![]});}};exports[a599_0x3f5fdd(0xd6)]=deleteAndCreateDialogStage;const sendMessage=async(_0x2fd008,_0x458df5,_0xbbae9,_0x334663)=>{const _0x4cbc88=a599_0x3f5fdd,_0x180681=await _0x2fd008[_0x4cbc88(0x10b)](_0x458df5[_0x4cbc88(0xad)]+'@'+(_0xbbae9['isGroup']?_0x4cbc88(0xd2):_0x4cbc88(0x109)),{'text':(0x0,Mustache_1[_0x4cbc88(0xf7)])(_0x334663,_0xbbae9)});(0x0,wbotMessageListener_1['verifyMessage'])(_0x180681,_0xbbae9,_0x458df5);},sendMessageLink=async(_0x3ea1b4,_0x27772f,_0xf50e0a,_0x2cb675,_0x284146)=>{const _0x11398d=a599_0x3f5fdd;let _0x20d2e4;try{_0x20d2e4=await _0x3ea1b4[_0x11398d(0x10b)](_0x27772f[_0x11398d(0xad)]+'@'+(_0xf50e0a[_0x11398d(0xbc)]?_0x11398d(0xd2):_0x11398d(0x109)),{'document':_0x2cb675?{'url':_0x2cb675}:fs[_0x11398d(0xf9)](_0x11398d(0xe4)+_0x284146+'-'+makeid(0xa)),'fileName':_0x284146,'mimetype':_0x11398d(0xd9)});}catch(_0x18c033){_0x20d2e4=await _0x3ea1b4[_0x11398d(0x10b)](_0x27772f[_0x11398d(0xad)]+'@'+(_0xf50e0a['isGroup']?'g.us':_0x11398d(0x109)),{'text':(0x0,Mustache_1[_0x11398d(0xf7)])(_0x11398d(0x104),_0xf50e0a)});}(0x0,wbotMessageListener_1['verifyMessage'])(_0x20d2e4,_0xf50e0a,_0x27772f);},sendMessageImage=async(_0x28430d,_0x12bfe2,_0x56b685,_0x193f19,_0xead64e)=>{const _0x4407e2=a599_0x3f5fdd;let _0x4fa4bf;try{_0x4fa4bf=await _0x28430d[_0x4407e2(0x10b)](_0x12bfe2[_0x4407e2(0xad)]+'@'+(_0x56b685[_0x4407e2(0xbc)]?_0x4407e2(0xd2):_0x4407e2(0x109)),{'image':_0x193f19?{'url':_0x193f19}:fs['readFileSync'](_0x4407e2(0xe4)+_0xead64e+'-'+makeid(0xa)),'fileName':_0xead64e,'caption':_0xead64e,'mimetype':_0x4407e2(0xf4)});}catch(_0x5e9041){_0x4fa4bf=await _0x28430d[_0x4407e2(0x10b)](_0x12bfe2[_0x4407e2(0xad)]+'@'+(_0x56b685[_0x4407e2(0xbc)]?'g.us':_0x4407e2(0x109)),{'text':(0x0,Mustache_1['default'])(_0x4407e2(0xed),_0x56b685)});}(0x0,wbotMessageListener_1['verifyMessage'])(_0x4fa4bf,_0x56b685,_0x12bfe2);},sendDialog=async(_0x49aa42,_0x601647,_0x261eca,_0x3e526e)=>{const _0x4b6d2b=a599_0x3f5fdd,_0x10c759=await(0x0,ShowChatBotServices_1[_0x4b6d2b(0xf7)])(_0x49aa42['id']);if(_0x10c759[_0x4b6d2b(0xe3)]){let _0x1d5e81=_0x3e526e[_0x4b6d2b(0xd4)];const _0x71ed47=await CompaniesSettings_1[_0x4b6d2b(0xf7)][_0x4b6d2b(0xb3)]({'where':{'companyId':_0x1d5e81}}),_0x930f66=_0x71ed47?.['chatBotType']||_0x4b6d2b(0xe7),_0x5e4eda=async()=>{const _0x2885c2=_0x4b6d2b;let _0x4d48f9='';_0x10c759['options'][_0x2885c2(0xc0)]((_0x2c4eb4,_0x520483)=>{const _0x2c3883=_0x2885c2;_0x4d48f9+=_0x2c3883(0xc3)+(_0x520483+0x1)+_0x2c3883(0x115)+_0x2c4eb4[_0x2c3883(0xda)]+'\x0a';});const _0x4cc8f2=_0x4d48f9[_0x2885c2(0xe6)]>0x0?_0x4d48f9+_0x2885c2(0xc4):_0x4d48f9+'\x0a*[\x20Sair\x20]*\x20Encerrar\x20atendimento';if(_0x4d48f9[_0x2885c2(0xe6)]>0x0){const _0x20f215='‎'+_0x49aa42[_0x2885c2(0xc7)]+'\x0a\x0a'+_0x4cc8f2,_0xc2105a=await sendMessage(_0x601647,_0x261eca,_0x3e526e,_0x20f215);return _0xc2105a;}const _0x42a5bd='‎'+_0x49aa42[_0x2885c2(0xc7)],_0x9ecc9b=await sendMessage(_0x601647,_0x261eca,_0x3e526e,_0x42a5bd);return _0x9ecc9b;},_0x2f60fa=async()=>{const _0x15185f=_0x4b6d2b,_0x1e3bc2=[];_0x10c759[_0x15185f(0xe3)][_0x15185f(0xc0)]((_0x3a41e0,_0x202739)=>{const _0x57d638=_0x15185f;_0x1e3bc2[_0x57d638(0x116)]({'buttonId':''+(_0x202739+0x1),'buttonText':{'displayText':_0x3a41e0[_0x57d638(0xda)]},'type':0x1});});if(_0x1e3bc2['length']>0x0){const _0x3074e5={'text':'‎'+_0x49aa42[_0x15185f(0xc7)],'buttons':_0x1e3bc2,'headerType':0x1},_0x131851=await _0x601647[_0x15185f(0x10b)](_0x261eca['number']+'@'+(_0x3e526e['isGroup']?'g.us':_0x15185f(0x109)),_0x3074e5);return await(0x0,wbotMessageListener_1[_0x15185f(0x102)])(_0x131851,_0x3e526e,_0x261eca),_0x131851;}const _0x4f46e2='‎'+_0x49aa42[_0x15185f(0xc7)],_0x3269c5=await sendMessage(_0x601647,_0x261eca,_0x3e526e,_0x4f46e2);return _0x3269c5;},_0x50cd4a=async()=>{const _0x5473b9=_0x4b6d2b,_0x5c6e7e=[];_0x10c759[_0x5473b9(0xe3)][_0x5473b9(0xc0)]((_0x4ccad3,_0x4af47a)=>{const _0x36b188=_0x5473b9;_0x5c6e7e[_0x36b188(0x116)]({'title':_0x4ccad3[_0x36b188(0xda)],'rowId':''+(_0x4af47a+0x1)});});if(_0x5c6e7e[_0x5473b9(0xe6)]>0x0){const _0x4039e8=[{'title':'Menu','rows':_0x5c6e7e}],_0x1e4445={'text':(0x0,Mustache_1['default'])('‎'+_0x49aa42['greetingMessage'],_0x3e526e),'buttonText':_0x5473b9(0x11a),'sections':_0x4039e8},_0xe1b4db=await _0x601647['sendMessage'](_0x261eca['number']+'@'+(_0x3e526e[_0x5473b9(0xbc)]?'g.us':_0x5473b9(0x109)),_0x1e4445);return await(0x0,wbotMessageListener_1[_0x5473b9(0x102)])(_0xe1b4db,_0x3e526e,_0x261eca),_0xe1b4db;}const _0x17fe67='‎'+_0x49aa42[_0x5473b9(0xc7)],_0x535b9b=await sendMessage(_0x601647,_0x261eca,_0x3e526e,_0x17fe67);return _0x535b9b;};if(_0x930f66===_0x4b6d2b(0xe7))return await _0x5e4eda();if(_0x930f66===_0x4b6d2b(0xcf)&&_0x10c759[_0x4b6d2b(0xe3)][_0x4b6d2b(0xe6)]>0x4)return await _0x5e4eda();if(_0x930f66===_0x4b6d2b(0xcf)&&_0x10c759[_0x4b6d2b(0xe3)][_0x4b6d2b(0xe6)]<=0x4)return await _0x2f60fa();if(_0x930f66===_0x4b6d2b(0xca))return await _0x50cd4a();}},backToMainMenu=async(_0x514d86,_0x25c772,_0x2bdd94)=>{const _0x35cac6=a599_0x3f5fdd;await(0x0,UpdateTicketService_1[_0x35cac6(0xf7)])({'ticketData':{'queueId':null,'userId':null},'ticketId':_0x2bdd94['id'],'companyId':_0x2bdd94[_0x35cac6(0xd4)]});const {queues:_0x350d2d,greetingMessage:_0xa79e84,greetingMediaAttachment:_0x172b96}=await(0x0,ShowWhatsAppService_1['default'])(_0x514d86['id'],_0x2bdd94[_0x35cac6(0xd4)]),_0x4d7cff=await CompaniesSettings_1['default']['findOne']({'where':{'companyId':_0x2bdd94[_0x35cac6(0xd4)]}}),_0x8304a2=async()=>{const _0x2aa492=_0x35cac6;let _0x4f98d7='';_0x350d2d[_0x2aa492(0xc0)]((_0x31eede,_0x1efbe5)=>{const _0x28ca92=_0x2aa492;_0x4f98d7+=_0x28ca92(0xc3)+(_0x1efbe5+0x1)+_0x28ca92(0x115)+_0x31eede[_0x28ca92(0xda)]+'\x0a';}),_0x4f98d7+=_0x2aa492(0x10e);const _0x2c3cd9=(0x0,Mustache_1['default'])('‎'+_0xa79e84+'\x0a\x0a'+_0x4f98d7,_0x2bdd94);if(_0x172b96!==null){const _0x207150=path_1[_0x2aa492(0xf7)]['resolve']('public',_0x2aa492(0xee)+_0x2bdd94['companyId'],_0x2bdd94['whatsapp']['greetingMediaAttachment']),_0x13623a=_0x2bdd94[_0x2aa492(0x100)][_0x2aa492(0xba)],_0x2d1455=await(0x0,SendWhatsAppMedia_1[_0x2aa492(0xc6)])(_0x13623a,_0x207150,String(_0x2bdd94[_0x2aa492(0xd4)]),_0x2c3cd9),_0xc81640=await _0x514d86[_0x2aa492(0x10b)](_0x2bdd94[_0x2aa492(0xcd)][_0x2aa492(0xad)]+'@'+(_0x2bdd94[_0x2aa492(0xbc)]?_0x2aa492(0xd2):_0x2aa492(0x109)),{..._0x2d1455});await(0x0,wbotMessageListener_1['verifyMediaMessage'])(_0xc81640,_0x2bdd94,_0x25c772);}else await _0x514d86[_0x2aa492(0x10b)](_0x25c772['number']+'@'+(_0x2bdd94[_0x2aa492(0xbc)]?_0x2aa492(0xd2):_0x2aa492(0x109)),{'text':_0x2c3cd9});const _0x5aa787=await(0x0,DeleteDialogChatBotsServices_1[_0x2aa492(0xf7)])(_0x25c772['id']);return _0x5aa787;};if(_0x4d7cff[_0x35cac6(0xe0)]===_0x35cac6(0xe7))return _0x8304a2();};function validaCpfCnpj(_0x489dfa){const _0xcafac4=a599_0x3f5fdd;if(_0x489dfa[_0xcafac4(0xe6)]==0xb){var _0x574853=_0x489dfa[_0xcafac4(0xd0)]();_0x574853=_0x574853[_0xcafac4(0x119)](/\./g,''),_0x574853=_0x574853[_0xcafac4(0x119)]('-',''),_0x574853=_0x574853[_0xcafac4(0xb2)]('');var _0x5976b6=0x0,_0x41dd06=0x0,_0x3b68c7=![];for(var _0x2f0c8b=0x1;_0x574853[_0xcafac4(0xe6)]>_0x2f0c8b;_0x2f0c8b++){_0x574853[_0x2f0c8b-0x1]!=_0x574853[_0x2f0c8b]&&(_0x3b68c7=!![]);}if(_0x3b68c7==![])return![];for(var _0x2f0c8b=0x0,_0x485c5b=0xa;_0x574853[_0xcafac4(0xe6)]-0x2>_0x2f0c8b;_0x2f0c8b++,_0x485c5b--){_0x5976b6+=_0x574853[_0x2f0c8b]*_0x485c5b;}_0x5976b6=_0x5976b6*0xa%0xb;_0x5976b6==0xa&&(_0x5976b6=0x0);if(_0x5976b6!=_0x574853[0x9])return![];for(var _0x2f0c8b=0x0,_0x485c5b=0xb;_0x574853['length']-0x1>_0x2f0c8b;_0x2f0c8b++,_0x485c5b--){_0x41dd06+=_0x574853[_0x2f0c8b]*_0x485c5b;}return _0x41dd06=_0x41dd06*0xa%0xb,_0x41dd06==0xa&&(_0x41dd06=0x0),_0x41dd06!=_0x574853[0xa]?![]:!![];}else{if(_0x489dfa[_0xcafac4(0xe6)]==0xe){var _0x27b9a3=_0x489dfa[_0xcafac4(0xd0)]();_0x27b9a3=_0x27b9a3['replace'](/\./g,''),_0x27b9a3=_0x27b9a3[_0xcafac4(0x119)]('-',''),_0x27b9a3=_0x27b9a3[_0xcafac4(0x119)]('/',''),_0x27b9a3=_0x27b9a3['split']('');var _0x5976b6=0x0,_0x41dd06=0x0,_0x3b68c7=![];for(var _0x2f0c8b=0x1;_0x27b9a3[_0xcafac4(0xe6)]>_0x2f0c8b;_0x2f0c8b++){_0x27b9a3[_0x2f0c8b-0x1]!=_0x27b9a3[_0x2f0c8b]&&(_0x3b68c7=!![]);}if(_0x3b68c7==![])return![];for(var _0x2f0c8b=0x0,_0x61b7a9=0x5,_0x10728e=0xd;_0x27b9a3[_0xcafac4(0xe6)]-0x2>_0x2f0c8b;_0x2f0c8b++,_0x61b7a9--,_0x10728e--){_0x61b7a9>=0x2?_0x5976b6+=_0x27b9a3[_0x2f0c8b]*_0x61b7a9:_0x5976b6+=_0x27b9a3[_0x2f0c8b]*_0x10728e;}_0x5976b6=_0x5976b6%0xb;_0x5976b6<0x2?_0x5976b6=0x0:_0x5976b6=0xb-_0x5976b6;if(_0x5976b6!=_0x27b9a3[0xc])return![];for(var _0x2f0c8b=0x0,_0x61b7a9=0x6,_0x10728e=0xe;_0x27b9a3[_0xcafac4(0xe6)]-0x1>_0x2f0c8b;_0x2f0c8b++,_0x61b7a9--,_0x10728e--){_0x61b7a9>=0x2?_0x41dd06+=_0x27b9a3[_0x2f0c8b]*_0x61b7a9:_0x41dd06+=_0x27b9a3[_0x2f0c8b]*_0x10728e;}return _0x41dd06=_0x41dd06%0xb,_0x41dd06<0x2?_0x41dd06=0x0:_0x41dd06=0xb-_0x41dd06,_0x41dd06!=_0x27b9a3[0xd]?![]:!![];}else return![];}}function timeout(_0x2a5853){return new Promise(_0x4324a2=>setTimeout(_0x4324a2,_0x2a5853));}async function sleep(_0x3de59b){await timeout(_0x3de59b);}function firstDayOfMonth(_0x3eacd6){const _0x43b952=a599_0x3f5fdd,_0x35a2f6=new Date(),_0x12c32e=new Date(_0x35a2f6['getFullYear'](),_0x35a2f6[_0x43b952(0x101)]()-_0x3eacd6,0x1);return _0x12c32e;};function lastDayOfMonth(_0x52d0ff){const _0xf5b20e=a599_0x3f5fdd,_0x34a273=new Date(),_0xe502ae=new Date(_0x34a273[_0xf5b20e(0x103)](),_0x34a273['getMonth']()+_0x52d0ff,0x0);return _0xe502ae;};function dataAtualFormatada(_0x1ebe51){const _0x419252=a599_0x3f5fdd;var _0x1fa975=_0x1ebe51[_0x419252(0xaa)]()[_0x419252(0xfb)](),_0x4acf01=_0x1fa975[_0x419252(0xe6)]==0x1?'0'+_0x1fa975:_0x1fa975,_0x12ff2a=(_0x1ebe51['getMonth']()+0x1)[_0x419252(0xfb)](),_0x343596=_0x12ff2a[_0x419252(0xe6)]==0x1?'0'+_0x12ff2a:_0x12ff2a,_0x4981c0=_0x1ebe51[_0x419252(0x103)]();return _0x4acf01+'/'+_0x343596+'/'+_0x4981c0;}function makeid(_0x20fc52){const _0x5d3705=a599_0x3f5fdd;var _0x4dedd5='',_0x2729fe=_0x5d3705(0x11b),_0x527e2b=_0x2729fe[_0x5d3705(0xe6)];for(var _0x23f41a=0x0;_0x23f41a<_0x20fc52;_0x23f41a++){_0x4dedd5+=_0x2729fe['charAt'](Math[_0x5d3705(0xdb)](Math[_0x5d3705(0xc8)]()*_0x527e2b));}return _0x4dedd5;}function replaceAll(_0xbb7886,_0x50e1d3,_0x1c50d4){const _0x315f35=a599_0x3f5fdd;return _0xbb7886[_0x315f35(0x119)](new RegExp(_0x50e1d3,'g'),_0x1c50d4);}function a599_0x32af(){const _0x59fb58=['getFullYear','‎Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','ticketId','userId','../ChatBotServices/ShowChatBotByChatbotIdServices','test','s.whatsapp.net','../DialogChatBotsServices/CreateDialogChatBotsServices','sendMessage','configurable','attendent','\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento','localeCompare','../DialogChatBotsServices/ShowDialogChatBotsServices','medias','10WpvYbp','substring','1852220EMgrIi','\x20]*\x20-\x20','push','ticketData','optQueueId','replace','Escolha\x20uma\x20opção','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','integration','7bit','optIntegrationId','getDate','entries','__esModule','number','../WhatsappService/ShowWhatsAppService','2ctWcmb','sayChatbot','defineProperty','split','findOne','../../services/FileServices/ShowService','mediaType','sair','getOwnPropertyDescriptor','598616pgqgvr','../../models/CompaniesSettings','greetingMediaAttachment','9eIueDq','isGroup','203ifWkzM','300lXBuNu','resolve','forEach','dueDate','message','*[\x20','\x0a*[\x20#\x20]*\x20Voltar\x20para\x20o\x20menu\x20principal\x0a*[\x20Sair\x20]*\x20Encerrar\x20atendimento','public','getMessageOptions','greetingMessage','random','optUserId','list','writable','create','contact','closed','button','trim','selectedButtonId','g.us','../ChatBotServices/ShowChatBotServices','companyId','queue','deleteAndCreateDialogStage','chatbots','32488rVOLQJ','application/pdf','name','floor','../TicketServices/UpdateTicketService','./SendWhatsAppMedia','./wbotMessageListener','chatbotId','chatBotType','listResponseMessage','optFileId','options','public/temp/','path','length','text','get','336039zVhUoR','closeTicket','getBodyMessage','pending','Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','company','324872stNfMN','key','__importStar','1143222fBAOVn','axios','image/jpeg','buttonsResponseMessage','file','default','queueId','readFileSync','queueType','toString','toLocaleLowerCase','108918nSgBaX','selectedRowId','singleSelectReply','whatsapp','getMonth','verifyMessage'];a599_0x32af=function(){return _0x59fb58;};return a599_0x32af();}function formatDate(_0x230217){const _0x886b7e=a599_0x3f5fdd;return _0x230217[_0x886b7e(0x113)](0x8,0xa)+'/'+_0x230217[_0x886b7e(0x113)](0x5,0x7)+'/'+_0x230217[_0x886b7e(0x113)](0x0,0x4);}function sortfunction(_0x140f03,_0x36febc){const _0x2ba666=a599_0x3f5fdd;return _0x140f03[_0x2ba666(0xc1)][_0x2ba666(0x10f)](_0x36febc[_0x2ba666(0xc1)]);}async function sendMsgAndCloseTicket(_0x367985,_0x524ff9,_0x3dd647){const _0x517acf=a599_0x3f5fdd,_0x1ed406={'ticketData':{'status':'closed','userId':_0x3dd647?.[_0x517acf(0x106)]||null,'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'ticketId':_0x3dd647['id'],'companyId':_0x3dd647[_0x517acf(0xd4)]};await sleep(0x7d0),await(0x0,UpdateTicketService_1['default'])(_0x1ed406);}const sayChatbot=async(_0x39d856,_0xd2f2fa,_0x11dcd5,_0x27f2dc,_0x283cc9)=>{const _0x2b0203=a599_0x3f5fdd,_0x2d47eb=_0x283cc9?.[_0x2b0203(0xc2)]?.['buttonsResponseMessage']?.[_0x2b0203(0xd1)]||_0x283cc9?.[_0x2b0203(0xc2)]?.[_0x2b0203(0xe1)]?.[_0x2b0203(0xff)][_0x2b0203(0xfe)]||(0x0,wbotMessageListener_1[_0x2b0203(0xeb)])(_0x283cc9);if(!_0x39d856&&_0x2d47eb&&_0x283cc9[_0x2b0203(0xf0)]['fromMe'])return;const _0x24bc09=await(0x0,ShowDialogChatBotsServices_1[_0x2b0203(0xf7)])(_0x27f2dc['id']);if(_0x2d47eb[_0x2b0203(0xfc)]()===_0x2b0203(0xb6)){const _0x514bc7={'ticketData':{'status':_0x2b0203(0xce),'sendFarewellMessage':!![],'amountUsedBotQueues':0x0},'ticketId':_0x11dcd5['id'],'companyId':_0x11dcd5[_0x2b0203(0xd4)]};await(0x0,UpdateTicketService_1[_0x2b0203(0xf7)])(_0x514bc7);return;}if(_0x2d47eb==='#'){const _0x1bccd0=await backToMainMenu(_0xd2f2fa,_0x27f2dc,_0x11dcd5);return;}if(!_0x24bc09){const _0x461a54=await(0x0,ShowQueueService_1['default'])(_0x39d856,_0x11dcd5[_0x2b0203(0xd4)]),_0x382f5b=_0x283cc9?.[_0x2b0203(0xc2)]?.[_0x2b0203(0xf5)]?.['selectedButtonId']||_0x283cc9?.[_0x2b0203(0xc2)]?.[_0x2b0203(0xe1)]?.[_0x2b0203(0xff)]['selectedRowId']||(0x0,wbotMessageListener_1[_0x2b0203(0xeb)])(_0x283cc9),_0x41cbd5=_0x461a54[_0x2b0203(0xd7)][+_0x382f5b-0x1];if(_0x41cbd5){if(_0x41cbd5[_0x2b0203(0xfa)]===_0x2b0203(0x11c))try{const _0x19d4db={'ticketData':{'integrationId':_0x41cbd5['optIntegrationId'],'useIntegration':!![],'status':'pending'},'ticketId':_0x11dcd5['id']};await(0x0,UpdateTicketService_1[_0x2b0203(0xf7)])({'ticketData':{..._0x19d4db[_0x2b0203(0x117)]},'ticketId':_0x19d4db[_0x2b0203(0x105)],'companyId':_0x11dcd5['companyId']});}catch(_0x32b47f){await(0x0,exports[_0x2b0203(0xd6)])(_0x27f2dc,_0x41cbd5['id'],_0x11dcd5);}else{if(_0x41cbd5[_0x2b0203(0xfa)]===_0x2b0203(0xd5))try{const _0x31131f={'ticketData':{'queueId':_0x41cbd5[_0x2b0203(0x118)],'status':'pending'},'ticketId':_0x11dcd5['id']};await(0x0,UpdateTicketService_1['default'])({'ticketData':{..._0x31131f['ticketData']},'ticketId':_0x31131f[_0x2b0203(0x105)],'companyId':_0x11dcd5[_0x2b0203(0xd4)]});}catch(_0x29b8a0){await(0x0,exports[_0x2b0203(0xd6)])(_0x27f2dc,_0x41cbd5['id'],_0x11dcd5);}else{if(_0x41cbd5[_0x2b0203(0xfa)]===_0x2b0203(0x10d))try{const _0x251444={'ticketData':{'queueId':_0x41cbd5[_0x2b0203(0x118)],'userId':_0x41cbd5['optUserId'],'status':_0x2b0203(0xec)},'ticketId':_0x11dcd5['id']};await(0x0,UpdateTicketService_1[_0x2b0203(0xf7)])({'ticketData':{..._0x251444[_0x2b0203(0x117)]},'ticketId':_0x251444[_0x2b0203(0x105)],'companyId':_0x11dcd5['companyId']});}catch(_0x2a8393){await(0x0,exports[_0x2b0203(0xd6)])(_0x27f2dc,_0x41cbd5['id'],_0x11dcd5);}}}await(0x0,exports[_0x2b0203(0xd6)])(_0x27f2dc,_0x41cbd5['id'],_0x11dcd5);let _0x2a6dc8;_0x41cbd5?.[_0x2b0203(0xc7)]&&(_0x2a6dc8=await sendDialog(_0x41cbd5,_0xd2f2fa,_0x27f2dc,_0x11dcd5));if(_0x41cbd5[_0x2b0203(0xfa)]===_0x2b0203(0xf6))try{const _0x19eb5f=path_1[_0x2b0203(0xf7)]['resolve'](__dirname,'..','..','..',_0x2b0203(0xc5)),_0x3c51b1=await(0x0,ShowService_1['default'])(_0x41cbd5[_0x2b0203(0xe2)],_0x11dcd5['companyId']),_0x3ec221=path_1['default'][_0x2b0203(0xbf)](_0x19eb5f,_0x2b0203(0xee)+_0x11dcd5['companyId'],'fileList',String(_0x3c51b1['id']));for(const [_0x26f33c,_0x2e415d]of _0x3c51b1['options'][_0x2b0203(0xab)]()){const _0x370b4f={'fieldname':_0x2b0203(0x111),'originalname':_0x2e415d[_0x2b0203(0xe5)],'encoding':_0x2b0203(0x11d),'mimetype':_0x2e415d[_0x2b0203(0xb5)],'filename':_0x2e415d['path'],'path':path_1['default'][_0x2b0203(0xbf)](_0x3ec221,_0x2e415d[_0x2b0203(0xe5)])};await(0x0,SendWhatsAppMedia_1[_0x2b0203(0xf7)])({'media':_0x370b4f,'ticket':_0x11dcd5,'body':_0x2e415d[_0x2b0203(0xda)],'isForwarded':![]});};}catch(_0x521e5b){await(0x0,exports['deleteAndCreateDialogStage'])(_0x27f2dc,_0x41cbd5['id'],_0x11dcd5);}return _0x41cbd5['closeTicket']&&await sendMsgAndCloseTicket(_0xd2f2fa,_0x11dcd5[_0x2b0203(0xcd)],_0x11dcd5),_0x2a6dc8;}}if(_0x24bc09){const _0x456364=isNumeric(_0x2d47eb)?_0x2d47eb:0x1,_0x5a361a=await(0x0,ShowChatBotServices_1[_0x2b0203(0xf7)])(_0x24bc09[_0x2b0203(0xdf)]),_0x1a1d41=_0x5a361a['options'][+_0x456364-0x1]?_0x5a361a[_0x2b0203(0xe3)][+_0x456364-0x1]:_0x5a361a['options'][0x0];if(!_0x1a1d41['greetingMessage']){await(0x0,DeleteDialogChatBotsServices_1[_0x2b0203(0xf7)])(_0x27f2dc['id']);return;}if(_0x1a1d41){if(_0x1a1d41[_0x2b0203(0xfa)]===_0x2b0203(0x11c))try{const _0x16a0fa={'ticketData':{'integrationId':_0x1a1d41[_0x2b0203(0x11e)],'useIntegration':!![],'status':_0x2b0203(0xec)},'ticketId':_0x11dcd5['id']};await(0x0,UpdateTicketService_1[_0x2b0203(0xf7)])({'ticketData':{..._0x16a0fa[_0x2b0203(0x117)]},'ticketId':_0x16a0fa[_0x2b0203(0x105)],'companyId':_0x11dcd5[_0x2b0203(0xd4)]});}catch(_0x5cb5b1){await(0x0,exports[_0x2b0203(0xd6)])(_0x27f2dc,_0x1a1d41['id'],_0x11dcd5);}else{if(_0x1a1d41[_0x2b0203(0xfa)]===_0x2b0203(0xd5))try{const _0x5c5a22={'ticketData':{'queueId':_0x1a1d41[_0x2b0203(0x118)],'status':_0x2b0203(0xec)},'ticketId':_0x11dcd5['id']};await(0x0,UpdateTicketService_1[_0x2b0203(0xf7)])({'ticketData':{..._0x5c5a22[_0x2b0203(0x117)]},'ticketId':_0x5c5a22[_0x2b0203(0x105)],'companyId':_0x11dcd5[_0x2b0203(0xd4)]});}catch(_0xec4cfc){await(0x0,exports[_0x2b0203(0xd6)])(_0x27f2dc,_0x1a1d41['id'],_0x11dcd5);}else{if(_0x1a1d41[_0x2b0203(0xfa)]===_0x2b0203(0x10d))try{const _0x2528e4={'ticketData':{'queueId':_0x1a1d41['optQueueId'],'userId':_0x1a1d41[_0x2b0203(0xc9)],'status':'pending'},'ticketId':_0x11dcd5['id']};await(0x0,UpdateTicketService_1[_0x2b0203(0xf7)])({'ticketData':{..._0x2528e4['ticketData']},'ticketId':_0x2528e4['ticketId'],'companyId':_0x11dcd5[_0x2b0203(0xd4)]});}catch(_0x161b23){await(0x0,exports['deleteAndCreateDialogStage'])(_0x27f2dc,_0x1a1d41['id'],_0x11dcd5);}}}await(0x0,exports[_0x2b0203(0xd6)])(_0x27f2dc,_0x1a1d41['id'],_0x11dcd5);if(_0x1a1d41[_0x2b0203(0xfa)]==='file')try{const _0x193b4d=path_1[_0x2b0203(0xf7)][_0x2b0203(0xbf)](__dirname,'..','..','..',_0x2b0203(0xc5)),_0x2d8576=await(0x0,ShowService_1[_0x2b0203(0xf7)])(_0x1a1d41[_0x2b0203(0xe2)],_0x11dcd5[_0x2b0203(0xd4)]),_0x4fcf7a=path_1[_0x2b0203(0xf7)]['resolve'](_0x193b4d,_0x2b0203(0xee)+_0x11dcd5['companyId'],'fileList',String(_0x2d8576['id']));for(const [_0x30e8da,_0x367774]of _0x2d8576['options'][_0x2b0203(0xab)]()){const _0x4b0909={'fieldname':_0x2b0203(0x111),'originalname':_0x367774[_0x2b0203(0xe5)],'encoding':_0x2b0203(0x11d),'mimetype':_0x367774[_0x2b0203(0xb5)],'filename':_0x367774['path'],'path':path_1[_0x2b0203(0xf7)]['resolve'](_0x4fcf7a,_0x367774['path'])};await(0x0,SendWhatsAppMedia_1[_0x2b0203(0xf7)])({'media':_0x4b0909,'ticket':_0x11dcd5,'body':_0x367774['name'],'isForwarded':![]});};}catch(_0x16fad1){await(0x0,exports['deleteAndCreateDialogStage'])(_0x27f2dc,_0x1a1d41['id'],_0x11dcd5);}_0x1a1d41[_0x2b0203(0xea)]&&await sendMsgAndCloseTicket(_0xd2f2fa,_0x11dcd5[_0x2b0203(0xcd)],_0x11dcd5);await(0x0,exports[_0x2b0203(0xd6)])(_0x27f2dc,_0x1a1d41['id'],_0x11dcd5);const _0x170e1c=await sendDialog(_0x1a1d41,_0xd2f2fa,_0x27f2dc,_0x11dcd5);return _0x170e1c;}}};exports[a599_0x3f5fdd(0xb0)]=sayChatbot;