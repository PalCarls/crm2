'use strict';const a558_0x4efea9=a558_0x23bb;(function(_0xea2fc8,_0x1aceb7){const _0x4fa04d=a558_0x23bb,_0x4f477b=_0xea2fc8();while(!![]){try{const _0x1664d5=-parseInt(_0x4fa04d(0x19c))/0x1*(parseInt(_0x4fa04d(0x18d))/0x2)+-parseInt(_0x4fa04d(0x143))/0x3+-parseInt(_0x4fa04d(0x195))/0x4+parseInt(_0x4fa04d(0x15c))/0x5+parseInt(_0x4fa04d(0x193))/0x6*(parseInt(_0x4fa04d(0x19b))/0x7)+-parseInt(_0x4fa04d(0x16c))/0x8+parseInt(_0x4fa04d(0x146))/0x9;if(_0x1664d5===_0x1aceb7)break;else _0x4f477b['push'](_0x4f477b['shift']());}catch(_0x1568a2){_0x4f477b['push'](_0x4f477b['shift']());}}}(a558_0x5d51,0x64cde));var __createBinding=this&&this[a558_0x4efea9(0x154)]||(Object[a558_0x4efea9(0x19e)]?function(_0x240929,_0x44cda6,_0x53cdcc,_0x1b51ae){const _0x414e8a=a558_0x4efea9;if(_0x1b51ae===undefined)_0x1b51ae=_0x53cdcc;var _0x43fc44=Object[_0x414e8a(0x135)](_0x44cda6,_0x53cdcc);(!_0x43fc44||(_0x414e8a(0x197)in _0x43fc44?!_0x44cda6[_0x414e8a(0x142)]:_0x43fc44[_0x414e8a(0x15a)]||_0x43fc44['configurable']))&&(_0x43fc44={'enumerable':!![],'get':function(){return _0x44cda6[_0x53cdcc];}}),Object[_0x414e8a(0x189)](_0x240929,_0x1b51ae,_0x43fc44);}:function(_0x5c5615,_0x3e988e,_0x5c2291,_0x2544be){if(_0x2544be===undefined)_0x2544be=_0x5c2291;_0x5c5615[_0x2544be]=_0x3e988e[_0x5c2291];}),__setModuleDefault=this&&this[a558_0x4efea9(0x178)]||(Object[a558_0x4efea9(0x19e)]?function(_0x15a502,_0x228c64){const _0x3bae65=a558_0x4efea9;Object[_0x3bae65(0x189)](_0x15a502,_0x3bae65(0x194),{'enumerable':!![],'value':_0x228c64});}:function(_0x2ac1ba,_0x4fc140){const _0x2508f3=a558_0x4efea9;_0x2ac1ba[_0x2508f3(0x194)]=_0x4fc140;}),__importStar=this&&this[a558_0x4efea9(0x13d)]||function(_0x49033b){const _0x4a3409=a558_0x4efea9;if(_0x49033b&&_0x49033b['__esModule'])return _0x49033b;var _0x1cec8f={};if(_0x49033b!=null){for(var _0x766785 in _0x49033b)if(_0x766785!=='default'&&Object[_0x4a3409(0x166)][_0x4a3409(0x19d)][_0x4a3409(0x183)](_0x49033b,_0x766785))__createBinding(_0x1cec8f,_0x49033b,_0x766785);}return __setModuleDefault(_0x1cec8f,_0x49033b),_0x1cec8f;},__importDefault=this&&this[a558_0x4efea9(0x130)]||function(_0x3efa86){const _0x565fbe=a558_0x4efea9;return _0x3efa86&&_0x3efa86[_0x565fbe(0x142)]?_0x3efa86:{'default':_0x3efa86};};Object[a558_0x4efea9(0x189)](exports,a558_0x4efea9(0x142),{'value':!![]}),exports[a558_0x4efea9(0x15d)]=exports['deleteAndCreateDialogStage']=void 0x0;function a558_0x23bb(_0xbab43d,_0x5da287){const _0x5d51e8=a558_0x5d51();return a558_0x23bb=function(_0x23bb5a,_0x3358a2){_0x23bb5a=_0x23bb5a-0x12e;let _0xa3cf25=_0x5d51e8[_0x23bb5a];return _0xa3cf25;},a558_0x23bb(_0xbab43d,_0x5da287);}const path_1=__importDefault(require(a558_0x4efea9(0x163))),wbotMessageListener_1=require(a558_0x4efea9(0x17e)),ShowDialogChatBotsServices_1=__importDefault(require(a558_0x4efea9(0x175))),ShowQueueService_1=__importDefault(require('../QueueService/ShowQueueService')),ShowChatBotServices_1=__importDefault(require(a558_0x4efea9(0x1a0))),DeleteDialogChatBotsServices_1=__importDefault(require(a558_0x4efea9(0x14b))),ShowChatBotByChatbotIdServices_1=__importDefault(require(a558_0x4efea9(0x149))),CreateDialogChatBotsServices_1=__importDefault(require(a558_0x4efea9(0x168))),ShowWhatsAppService_1=__importDefault(require(a558_0x4efea9(0x132))),Mustache_1=__importDefault(require(a558_0x4efea9(0x13b))),UpdateTicketService_1=__importDefault(require(a558_0x4efea9(0x16d))),User_1=__importDefault(require(a558_0x4efea9(0x198))),ShowService_1=__importDefault(require(a558_0x4efea9(0x173))),lodash_1=require('lodash'),SendWhatsAppMedia_1=__importStar(require(a558_0x4efea9(0x14a))),CompaniesSettings_1=__importDefault(require(a558_0x4efea9(0x131))),fs=require('fs');var axios=require(a558_0x4efea9(0x12e));function a558_0x5d51(){const _0x332d21=['contact','get','../../models/User','charAt','localeCompare','161819welJGU','11lRtdwv','hasOwnProperty','create','sendMessage','../ChatBotServices/ShowChatBotServices','optIntegrationId','greetingMediaAttachment','axios','optFileId','__importDefault','../../models/CompaniesSettings','../WhatsappService/ShowWhatsAppService','selectedButtonId','image/jpeg','getOwnPropertyDescriptor','pending','queueType','file','userId','options','../../helpers/Mustache','entries','__importStar','queue','verifyMediaMessage','medias','getFullYear','__esModule','1435926FOWewn','\x20]*\x20-\x20','toString','6327027IumlZP','attendent','optUserId','../ChatBotServices/ShowChatBotByChatbotIdServices','./SendWhatsAppMedia','../DialogChatBotsServices/DeleteDialogChatBotsServices','name','fromMe','findOne','chatbots','Menu','push','key','closeTicket','__createBinding','companyId','replace','getBodyMessage','7bit','verifyMessage','writable','substring','2881665aIHTFM','sayChatbot','application/pdf','ticketData','number','closed','forEach','path','split','integration','prototype','chatBotType','../DialogChatBotsServices/CreateDialogChatBotsServices','*[\x20','text','isGroup','2698776yJgctf','../TicketServices/UpdateTicketService','random','list','g.us','public','ticketId','../../services/FileServices/ShowService','length','../DialogChatBotsServices/ShowDialogChatBotsServices','trim','getMonth','__setModuleDefault','\x0a*[\x20#\x20]*\x20Voltar\x20para\x20o\x20menu\x20principal\x0a*[\x20Sair\x20]*\x20Encerrar\x20atendimento','s.whatsapp.net','Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','resolve','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','./wbotMessageListener','‎Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','dueDate','\x0a*[\x20Sair\x20]*\x20Encerrar\x20atendimento','message','call','deleteAndCreateDialogStage','public/temp/','listResponseMessage','button','greetingMessage','defineProperty','Escolha\x20uma\x20opção','floor','selectedRowId','122166QTYvny','singleSelectReply','company','readFileSync','optQueueId','mediaType','174xnUTMT','default','195732lZxOwK'];a558_0x5d51=function(){return _0x332d21;};return a558_0x5d51();}const isNumeric=_0x357e50=>/^-?\d+$/['test'](_0x357e50),deleteAndCreateDialogStage=async(_0x2eb4a0,_0x13ff2a,_0x2a2dda)=>{const _0x6458b7=a558_0x4efea9;try{await(0x0,DeleteDialogChatBotsServices_1[_0x6458b7(0x194)])(_0x2eb4a0['id']);const _0x9a99d6=await(0x0,ShowChatBotByChatbotIdServices_1[_0x6458b7(0x194)])(_0x13ff2a);return!_0x9a99d6&&await _0x2a2dda['update']({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x6458b7(0x194)])({'awaiting':0x1,'contactId':_0x2eb4a0['id'],'chatbotId':_0x13ff2a,'queueId':_0x9a99d6['queueId']});}catch(_0x46d3fe){await _0x2a2dda['update']({'isBot':![]});}};exports[a558_0x4efea9(0x184)]=deleteAndCreateDialogStage;const sendMessage=async(_0x36de8a,_0x505a42,_0x13141f,_0x5eb357)=>{const _0x2c626e=a558_0x4efea9,_0x5c6863=await _0x36de8a[_0x2c626e(0x19f)](_0x505a42['number']+'@'+(_0x13141f[_0x2c626e(0x16b)]?_0x2c626e(0x170):_0x2c626e(0x17a)),{'text':(0x0,Mustache_1[_0x2c626e(0x194)])(_0x5eb357,_0x13141f)});(0x0,wbotMessageListener_1[_0x2c626e(0x159)])(_0x5c6863,_0x13141f,_0x505a42);},sendMessageLink=async(_0x52bd0d,_0x1aaa15,_0x1ff913,_0x4453c3,_0x37114b)=>{const _0xc7df77=a558_0x4efea9;let _0x161e91;try{_0x161e91=await _0x52bd0d[_0xc7df77(0x19f)](_0x1aaa15[_0xc7df77(0x160)]+'@'+(_0x1ff913[_0xc7df77(0x16b)]?_0xc7df77(0x170):'s.whatsapp.net'),{'document':_0x4453c3?{'url':_0x4453c3}:fs[_0xc7df77(0x190)](_0xc7df77(0x185)+_0x37114b+'-'+makeid(0xa)),'fileName':_0x37114b,'mimetype':_0xc7df77(0x15e)});}catch(_0x3ed880){_0x161e91=await _0x52bd0d[_0xc7df77(0x19f)](_0x1aaa15[_0xc7df77(0x160)]+'@'+(_0x1ff913['isGroup']?_0xc7df77(0x170):_0xc7df77(0x17a)),{'text':(0x0,Mustache_1[_0xc7df77(0x194)])(_0xc7df77(0x17f),_0x1ff913)});}(0x0,wbotMessageListener_1[_0xc7df77(0x159)])(_0x161e91,_0x1ff913,_0x1aaa15);},sendMessageImage=async(_0x4f303a,_0x4b1608,_0x370e1b,_0x34415d,_0x1176bb)=>{const _0x1cba67=a558_0x4efea9;let _0x569040;try{_0x569040=await _0x4f303a[_0x1cba67(0x19f)](_0x4b1608[_0x1cba67(0x160)]+'@'+(_0x370e1b[_0x1cba67(0x16b)]?_0x1cba67(0x170):'s.whatsapp.net'),{'image':_0x34415d?{'url':_0x34415d}:fs['readFileSync'](_0x1cba67(0x185)+_0x1176bb+'-'+makeid(0xa)),'fileName':_0x1176bb,'caption':_0x1176bb,'mimetype':_0x1cba67(0x134)});}catch(_0x17a502){_0x569040=await _0x4f303a[_0x1cba67(0x19f)](_0x4b1608['number']+'@'+(_0x370e1b[_0x1cba67(0x16b)]?_0x1cba67(0x170):_0x1cba67(0x17a)),{'text':(0x0,Mustache_1[_0x1cba67(0x194)])(_0x1cba67(0x17b),_0x370e1b)});}(0x0,wbotMessageListener_1['verifyMessage'])(_0x569040,_0x370e1b,_0x4b1608);},sendDialog=async(_0x18a871,_0x5157f8,_0x4e36b1,_0x13dbe3)=>{const _0x2968dc=a558_0x4efea9,_0x139892=await(0x0,ShowChatBotServices_1[_0x2968dc(0x194)])(_0x18a871['id']);if(_0x139892[_0x2968dc(0x13a)]){let _0x3f84ed=_0x13dbe3[_0x2968dc(0x155)];const _0x3ac4c6=await CompaniesSettings_1['default'][_0x2968dc(0x14e)]({'where':{'companyId':_0x3f84ed}}),_0x1ced78=_0x3ac4c6?.[_0x2968dc(0x167)]||_0x2968dc(0x16a),_0x50883b=async()=>{const _0x19fc3f=_0x2968dc;let _0x4c8724='';_0x139892[_0x19fc3f(0x13a)][_0x19fc3f(0x162)]((_0x5b67b2,_0x258956)=>{const _0x56c4e4=_0x19fc3f;_0x4c8724+=_0x56c4e4(0x169)+(_0x258956+0x1)+_0x56c4e4(0x144)+_0x5b67b2[_0x56c4e4(0x14c)]+'\x0a';});const _0x4611b8=_0x4c8724[_0x19fc3f(0x174)]>0x0?_0x4c8724+_0x19fc3f(0x179):_0x4c8724+_0x19fc3f(0x181);if(_0x4c8724[_0x19fc3f(0x174)]>0x0){const _0x1a2750='‎'+_0x18a871[_0x19fc3f(0x188)]+'\x0a\x0a'+_0x4611b8,_0x19145a=await sendMessage(_0x5157f8,_0x4e36b1,_0x13dbe3,_0x1a2750);return _0x19145a;}const _0x1a7c59='‎'+_0x18a871[_0x19fc3f(0x188)],_0x265bd9=await sendMessage(_0x5157f8,_0x4e36b1,_0x13dbe3,_0x1a7c59);return _0x265bd9;},_0x2df7cc=async()=>{const _0x126efc=_0x2968dc,_0x566d6e=[];_0x139892[_0x126efc(0x13a)][_0x126efc(0x162)]((_0x4531bf,_0x2d437e)=>{const _0xbef2c7=_0x126efc;_0x566d6e[_0xbef2c7(0x151)]({'buttonId':''+(_0x2d437e+0x1),'buttonText':{'displayText':_0x4531bf[_0xbef2c7(0x14c)]},'type':0x1});});if(_0x566d6e[_0x126efc(0x174)]>0x0){const _0x231b1c={'text':'‎'+_0x18a871[_0x126efc(0x188)],'buttons':_0x566d6e,'headerType':0x1},_0x16b712=await _0x5157f8[_0x126efc(0x19f)](_0x4e36b1[_0x126efc(0x160)]+'@'+(_0x13dbe3[_0x126efc(0x16b)]?_0x126efc(0x170):_0x126efc(0x17a)),_0x231b1c);return await(0x0,wbotMessageListener_1[_0x126efc(0x159)])(_0x16b712,_0x13dbe3,_0x4e36b1),_0x16b712;}const _0x18a8ac='‎'+_0x18a871['greetingMessage'],_0x437c1c=await sendMessage(_0x5157f8,_0x4e36b1,_0x13dbe3,_0x18a8ac);return _0x437c1c;},_0x580e36=async()=>{const _0x30f6b9=_0x2968dc,_0x2f6773=[];_0x139892[_0x30f6b9(0x13a)][_0x30f6b9(0x162)]((_0x44684b,_0x5ceabc)=>{const _0x5eff5a=_0x30f6b9;_0x2f6773[_0x5eff5a(0x151)]({'title':_0x44684b[_0x5eff5a(0x14c)],'rowId':''+(_0x5ceabc+0x1)});});if(_0x2f6773['length']>0x0){const _0x26cfdb=[{'title':_0x30f6b9(0x150),'rows':_0x2f6773}],_0xd4d046={'text':(0x0,Mustache_1[_0x30f6b9(0x194)])('‎'+_0x18a871[_0x30f6b9(0x188)],_0x13dbe3),'buttonText':_0x30f6b9(0x18a),'sections':_0x26cfdb},_0x19ba1e=await _0x5157f8[_0x30f6b9(0x19f)](_0x4e36b1[_0x30f6b9(0x160)]+'@'+(_0x13dbe3[_0x30f6b9(0x16b)]?_0x30f6b9(0x170):'s.whatsapp.net'),_0xd4d046);return await(0x0,wbotMessageListener_1[_0x30f6b9(0x159)])(_0x19ba1e,_0x13dbe3,_0x4e36b1),_0x19ba1e;}const _0x57110f='‎'+_0x18a871[_0x30f6b9(0x188)],_0x154621=await sendMessage(_0x5157f8,_0x4e36b1,_0x13dbe3,_0x57110f);return _0x154621;};if(_0x1ced78==='text')return await _0x50883b();if(_0x1ced78===_0x2968dc(0x187)&&_0x139892['options']['length']>0x4)return await _0x50883b();if(_0x1ced78===_0x2968dc(0x187)&&_0x139892[_0x2968dc(0x13a)][_0x2968dc(0x174)]<=0x4)return await _0x2df7cc();if(_0x1ced78===_0x2968dc(0x16f))return await _0x580e36();}},backToMainMenu=async(_0x57af9a,_0x282324,_0x262468)=>{const _0x439a5d=a558_0x4efea9;await(0x0,UpdateTicketService_1[_0x439a5d(0x194)])({'ticketData':{'queueId':null,'userId':null},'ticketId':_0x262468['id'],'companyId':_0x262468[_0x439a5d(0x155)]});const {queues:_0xea4e92,greetingMessage:_0x510b5b,greetingMediaAttachment:_0x4704c4}=await(0x0,ShowWhatsAppService_1['default'])(_0x57af9a['id'],_0x262468[_0x439a5d(0x155)]),_0x505535=await CompaniesSettings_1[_0x439a5d(0x194)][_0x439a5d(0x14e)]({'where':{'companyId':_0x262468['companyId']}}),_0x2666fc=async()=>{const _0x16095f=_0x439a5d;let _0x24cd64='';_0xea4e92['forEach']((_0x26143a,_0x260389)=>{const _0xa04ebd=a558_0x23bb;_0x24cd64+=_0xa04ebd(0x169)+(_0x260389+0x1)+'\x20]*\x20-\x20'+_0x26143a['name']+'\x0a';}),_0x24cd64+='\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento';const _0x57b5e9=(0x0,Mustache_1[_0x16095f(0x194)])('‎'+_0x510b5b+'\x0a\x0a'+_0x24cd64,_0x262468);if(_0x4704c4!==null){const _0xf70760=path_1[_0x16095f(0x194)][_0x16095f(0x17c)]('public',_0x16095f(0x18f)+_0x262468['companyId'],_0x262468['whatsapp'][_0x16095f(0x1a2)]),_0x412a3a=_0x262468['whatsapp'][_0x16095f(0x1a2)],_0x599985=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x412a3a,_0xf70760,String(_0x262468[_0x16095f(0x155)]),_0x57b5e9),_0x1e0051=await _0x57af9a[_0x16095f(0x19f)](_0x262468[_0x16095f(0x196)]['number']+'@'+(_0x262468[_0x16095f(0x16b)]?_0x16095f(0x170):_0x16095f(0x17a)),{..._0x599985});await(0x0,wbotMessageListener_1[_0x16095f(0x13f)])(_0x1e0051,_0x262468,_0x282324);}else await _0x57af9a[_0x16095f(0x19f)](_0x282324[_0x16095f(0x160)]+'@'+(_0x262468[_0x16095f(0x16b)]?_0x16095f(0x170):_0x16095f(0x17a)),{'text':_0x57b5e9});const _0x4a9152=await(0x0,DeleteDialogChatBotsServices_1[_0x16095f(0x194)])(_0x282324['id']);return _0x4a9152;},_0xf79484=async()=>{const _0x233f6f=_0x439a5d,_0x1ad65d=[];_0xea4e92[_0x233f6f(0x162)]((_0x489c07,_0x39baee)=>{const _0x54a063=_0x233f6f;_0x1ad65d['push']({'buttonId':''+(_0x39baee+0x1),'buttonText':{'displayText':_0x489c07[_0x54a063(0x14c)]},'type':0x1});});const _0x2eb7d4={'text':(0x0,Mustache_1[_0x233f6f(0x194)])('‎'+_0x510b5b,_0x262468),'buttons':_0x1ad65d,'headerType':0x1},_0x1a3eee=await _0x57af9a[_0x233f6f(0x19f)](_0x282324[_0x233f6f(0x160)]+'@'+(_0x262468[_0x233f6f(0x16b)]?_0x233f6f(0x170):_0x233f6f(0x17a)),_0x2eb7d4);await(0x0,wbotMessageListener_1[_0x233f6f(0x159)])(_0x1a3eee,_0x262468,_0x282324);const _0x46de6d=await(0x0,DeleteDialogChatBotsServices_1[_0x233f6f(0x194)])(_0x282324['id']);return _0x46de6d;},_0x414aa5=async()=>{const _0x18c147=_0x439a5d,_0x1d4fe0=[];_0xea4e92[_0x18c147(0x162)]((_0x5e0e5a,_0xaa5873)=>{const _0x2c0ee3=_0x18c147;_0x1d4fe0[_0x2c0ee3(0x151)]({'title':_0x5e0e5a[_0x2c0ee3(0x14c)],'rowId':''+(_0xaa5873+0x1)});});const _0x2addbb=[{'title':_0x18c147(0x150),'rows':_0x1d4fe0}],_0x48c70e={'text':(0x0,Mustache_1[_0x18c147(0x194)])('‎'+_0x510b5b,_0x262468),'buttonText':'Escolha\x20uma\x20opção','sections':_0x2addbb},_0x3e3261=await _0x57af9a[_0x18c147(0x19f)](_0x282324['number']+'@'+(_0x262468[_0x18c147(0x16b)]?_0x18c147(0x170):'s.whatsapp.net'),_0x48c70e);await(0x0,wbotMessageListener_1[_0x18c147(0x159)])(_0x3e3261,_0x262468,_0x282324);const _0x5e3c06=await(0x0,DeleteDialogChatBotsServices_1[_0x18c147(0x194)])(_0x282324['id']);return _0x5e3c06;};if(_0x505535[_0x439a5d(0x167)]===_0x439a5d(0x16a))return _0x2666fc();if(_0x505535[_0x439a5d(0x167)]===_0x439a5d(0x187)&&_0xea4e92[_0x439a5d(0x174)]>0x4)return _0x2666fc();if(_0x505535[_0x439a5d(0x167)]===_0x439a5d(0x187)&&_0xea4e92[_0x439a5d(0x174)]<=0x4)return _0xf79484();if(_0x505535[_0x439a5d(0x167)]==='list')return _0x414aa5();};function validaCpfCnpj(_0x3dcc12){const _0x16bbce=a558_0x4efea9;if(_0x3dcc12[_0x16bbce(0x174)]==0xb){var _0x1c27e4=_0x3dcc12[_0x16bbce(0x176)]();_0x1c27e4=_0x1c27e4['replace'](/\./g,''),_0x1c27e4=_0x1c27e4['replace']('-',''),_0x1c27e4=_0x1c27e4[_0x16bbce(0x164)]('');var _0x3a23b2=0x0,_0x2533fd=0x0,_0x362207=![];for(var _0xb93e16=0x1;_0x1c27e4[_0x16bbce(0x174)]>_0xb93e16;_0xb93e16++){_0x1c27e4[_0xb93e16-0x1]!=_0x1c27e4[_0xb93e16]&&(_0x362207=!![]);}if(_0x362207==![])return![];for(var _0xb93e16=0x0,_0x1a66b7=0xa;_0x1c27e4['length']-0x2>_0xb93e16;_0xb93e16++,_0x1a66b7--){_0x3a23b2+=_0x1c27e4[_0xb93e16]*_0x1a66b7;}_0x3a23b2=_0x3a23b2*0xa%0xb;_0x3a23b2==0xa&&(_0x3a23b2=0x0);if(_0x3a23b2!=_0x1c27e4[0x9])return![];for(var _0xb93e16=0x0,_0x1a66b7=0xb;_0x1c27e4['length']-0x1>_0xb93e16;_0xb93e16++,_0x1a66b7--){_0x2533fd+=_0x1c27e4[_0xb93e16]*_0x1a66b7;}return _0x2533fd=_0x2533fd*0xa%0xb,_0x2533fd==0xa&&(_0x2533fd=0x0),_0x2533fd!=_0x1c27e4[0xa]?![]:!![];}else{if(_0x3dcc12[_0x16bbce(0x174)]==0xe){var _0x132410=_0x3dcc12[_0x16bbce(0x176)]();_0x132410=_0x132410[_0x16bbce(0x156)](/\./g,''),_0x132410=_0x132410[_0x16bbce(0x156)]('-',''),_0x132410=_0x132410[_0x16bbce(0x156)]('/',''),_0x132410=_0x132410[_0x16bbce(0x164)]('');var _0x3a23b2=0x0,_0x2533fd=0x0,_0x362207=![];for(var _0xb93e16=0x1;_0x132410[_0x16bbce(0x174)]>_0xb93e16;_0xb93e16++){_0x132410[_0xb93e16-0x1]!=_0x132410[_0xb93e16]&&(_0x362207=!![]);}if(_0x362207==![])return![];for(var _0xb93e16=0x0,_0xf90519=0x5,_0x3d7936=0xd;_0x132410[_0x16bbce(0x174)]-0x2>_0xb93e16;_0xb93e16++,_0xf90519--,_0x3d7936--){_0xf90519>=0x2?_0x3a23b2+=_0x132410[_0xb93e16]*_0xf90519:_0x3a23b2+=_0x132410[_0xb93e16]*_0x3d7936;}_0x3a23b2=_0x3a23b2%0xb;_0x3a23b2<0x2?_0x3a23b2=0x0:_0x3a23b2=0xb-_0x3a23b2;if(_0x3a23b2!=_0x132410[0xc])return![];for(var _0xb93e16=0x0,_0xf90519=0x6,_0x3d7936=0xe;_0x132410[_0x16bbce(0x174)]-0x1>_0xb93e16;_0xb93e16++,_0xf90519--,_0x3d7936--){_0xf90519>=0x2?_0x2533fd+=_0x132410[_0xb93e16]*_0xf90519:_0x2533fd+=_0x132410[_0xb93e16]*_0x3d7936;}return _0x2533fd=_0x2533fd%0xb,_0x2533fd<0x2?_0x2533fd=0x0:_0x2533fd=0xb-_0x2533fd,_0x2533fd!=_0x132410[0xd]?![]:!![];}else return![];}}function timeout(_0x886f40){return new Promise(_0xf0f030=>setTimeout(_0xf0f030,_0x886f40));}async function sleep(_0x41a720){await timeout(_0x41a720);}function firstDayOfMonth(_0x5daeee){const _0x52c897=a558_0x4efea9,_0x264640=new Date(),_0xa4740e=new Date(_0x264640[_0x52c897(0x141)](),_0x264640[_0x52c897(0x177)]()-_0x5daeee,0x1);return _0xa4740e;};function lastDayOfMonth(_0x5b909b){const _0x70c38a=a558_0x4efea9,_0x1531cd=new Date(),_0x4e7d6a=new Date(_0x1531cd[_0x70c38a(0x141)](),_0x1531cd[_0x70c38a(0x177)]()+_0x5b909b,0x0);return _0x4e7d6a;};function dataAtualFormatada(_0x12a6b7){const _0x487495=a558_0x4efea9;var _0x4f0373=_0x12a6b7['getDate']()[_0x487495(0x145)](),_0xe5a832=_0x4f0373[_0x487495(0x174)]==0x1?'0'+_0x4f0373:_0x4f0373,_0x3249a4=(_0x12a6b7[_0x487495(0x177)]()+0x1)['toString'](),_0x2fb249=_0x3249a4[_0x487495(0x174)]==0x1?'0'+_0x3249a4:_0x3249a4,_0x53af96=_0x12a6b7[_0x487495(0x141)]();return _0xe5a832+'/'+_0x2fb249+'/'+_0x53af96;}function makeid(_0x2c8916){const _0x3ddae6=a558_0x4efea9;var _0x1d7466='',_0x400637=_0x3ddae6(0x17d),_0x4875c0=_0x400637['length'];for(var _0x41e714=0x0;_0x41e714<_0x2c8916;_0x41e714++){_0x1d7466+=_0x400637[_0x3ddae6(0x199)](Math[_0x3ddae6(0x18b)](Math[_0x3ddae6(0x16e)]()*_0x4875c0));}return _0x1d7466;}function replaceAll(_0x44eaba,_0x493a1d,_0x5c2e6b){const _0x53c6b9=a558_0x4efea9;return _0x44eaba[_0x53c6b9(0x156)](new RegExp(_0x493a1d,'g'),_0x5c2e6b);}function formatDate(_0x30de6e){const _0x71bb63=a558_0x4efea9;return _0x30de6e['substring'](0x8,0xa)+'/'+_0x30de6e[_0x71bb63(0x15b)](0x5,0x7)+'/'+_0x30de6e[_0x71bb63(0x15b)](0x0,0x4);}function sortfunction(_0x561bb9,_0x435fb9){const _0x973488=a558_0x4efea9;return _0x561bb9[_0x973488(0x180)][_0x973488(0x19a)](_0x435fb9['dueDate']);}async function sendMsgAndCloseTicket(_0x4aa733,_0x4c3695,_0x20e646){const _0x3535f9=a558_0x4efea9,_0xdd03bd={'ticketData':{'status':_0x3535f9(0x161),'userId':_0x20e646?.[_0x3535f9(0x139)]||null,'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'ticketId':_0x20e646['id'],'companyId':_0x20e646[_0x3535f9(0x155)]};await sleep(0x7d0),await(0x0,UpdateTicketService_1[_0x3535f9(0x194)])(_0xdd03bd);}const sayChatbot=async(_0x2f0db9,_0x5bc48e,_0x40cc45,_0x457a81,_0x123ec7)=>{const _0x5d145b=a558_0x4efea9,_0x644f16=_0x123ec7?.[_0x5d145b(0x182)]?.['buttonsResponseMessage']?.['selectedButtonId']||_0x123ec7?.['message']?.['listResponseMessage']?.[_0x5d145b(0x18e)][_0x5d145b(0x18c)]||(0x0,wbotMessageListener_1[_0x5d145b(0x157)])(_0x123ec7);if(!_0x2f0db9&&_0x644f16&&_0x123ec7[_0x5d145b(0x152)][_0x5d145b(0x14d)])return;const _0x2fe72c=await(0x0,ShowDialogChatBotsServices_1[_0x5d145b(0x194)])(_0x457a81['id']);if(_0x644f16['toLocaleLowerCase']()==='sair'){const _0x2c90fa={'ticketData':{'status':_0x5d145b(0x161),'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'ticketId':_0x40cc45['id'],'companyId':_0x40cc45[_0x5d145b(0x155)]};await(0x0,UpdateTicketService_1[_0x5d145b(0x194)])(_0x2c90fa);const _0x4d10de=_0x40cc45['whatsapp']?.['complationMessage'],_0x3ff359={'text':(0x0,Mustache_1[_0x5d145b(0x194)])('‎'+_0x4d10de,_0x40cc45)};if(!(0x0,lodash_1['isNil'])(_0x4d10de)){const _0x1e6ec1=await _0x5bc48e[_0x5d145b(0x19f)](_0x40cc45?.[_0x5d145b(0x196)]?.[_0x5d145b(0x160)]+'@'+(_0x40cc45[_0x5d145b(0x16b)]?'g.us':_0x5d145b(0x17a)),_0x3ff359);await(0x0,wbotMessageListener_1[_0x5d145b(0x159)])(_0x1e6ec1,_0x40cc45,_0x40cc45[_0x5d145b(0x196)]);}return;}if(_0x644f16==='#'){const _0xbefd86=await backToMainMenu(_0x5bc48e,_0x457a81,_0x40cc45);return;}if(!_0x2fe72c){const _0x1ce6ac=await(0x0,ShowQueueService_1['default'])(_0x2f0db9,_0x40cc45[_0x5d145b(0x155)]),_0x67f877=_0x123ec7?.['message']?.['buttonsResponseMessage']?.[_0x5d145b(0x133)]||_0x123ec7?.[_0x5d145b(0x182)]?.[_0x5d145b(0x186)]?.[_0x5d145b(0x18e)][_0x5d145b(0x18c)]||(0x0,wbotMessageListener_1[_0x5d145b(0x157)])(_0x123ec7),_0x1dfa3d=_0x1ce6ac[_0x5d145b(0x14f)][+_0x67f877-0x1];if(_0x1dfa3d){if(_0x1dfa3d[_0x5d145b(0x137)]===_0x5d145b(0x165))try{const _0x55881c={'ticketData':{'integrationId':_0x1dfa3d[_0x5d145b(0x1a1)],'useIntegration':!![],'status':_0x5d145b(0x136)},'ticketId':_0x40cc45['id']};await(0x0,UpdateTicketService_1[_0x5d145b(0x194)])({'ticketData':{..._0x55881c[_0x5d145b(0x15f)]},'ticketId':_0x55881c['ticketId'],'companyId':_0x40cc45[_0x5d145b(0x155)]});}catch(_0x13d364){await(0x0,exports[_0x5d145b(0x184)])(_0x457a81,_0x1dfa3d['id'],_0x40cc45);}if(_0x1dfa3d[_0x5d145b(0x137)]===_0x5d145b(0x13e))try{const _0x569b33={'ticketData':{'queueId':_0x1dfa3d[_0x5d145b(0x191)],'status':'pending'},'ticketId':_0x40cc45['id']};await(0x0,UpdateTicketService_1[_0x5d145b(0x194)])({'ticketData':{..._0x569b33[_0x5d145b(0x15f)]},'ticketId':_0x569b33['ticketId'],'companyId':_0x40cc45[_0x5d145b(0x155)]});}catch(_0x195591){await(0x0,exports[_0x5d145b(0x184)])(_0x457a81,_0x1dfa3d['id'],_0x40cc45);}if(_0x1dfa3d[_0x5d145b(0x137)]===_0x5d145b(0x147))try{const _0x54c1f9={'ticketData':{'queueId':_0x1dfa3d[_0x5d145b(0x191)],'userId':_0x1dfa3d[_0x5d145b(0x148)],'status':_0x5d145b(0x136)},'ticketId':_0x40cc45['id']};await(0x0,UpdateTicketService_1[_0x5d145b(0x194)])({'ticketData':{..._0x54c1f9[_0x5d145b(0x15f)]},'ticketId':_0x54c1f9[_0x5d145b(0x172)],'companyId':_0x40cc45[_0x5d145b(0x155)]});}catch(_0x56e974){await(0x0,exports[_0x5d145b(0x184)])(_0x457a81,_0x1dfa3d['id'],_0x40cc45);}await(0x0,exports[_0x5d145b(0x184)])(_0x457a81,_0x1dfa3d['id'],_0x40cc45);let _0x2e848b;_0x1dfa3d?.[_0x5d145b(0x188)]&&(_0x2e848b=await sendDialog(_0x1dfa3d,_0x5bc48e,_0x457a81,_0x40cc45));if(_0x1dfa3d[_0x5d145b(0x137)]===_0x5d145b(0x138))try{const _0x5c6ef6=path_1[_0x5d145b(0x194)][_0x5d145b(0x17c)](__dirname,'..','..','..',_0x5d145b(0x171)),_0xa7d419=await(0x0,ShowService_1[_0x5d145b(0x194)])(_0x1dfa3d[_0x5d145b(0x12f)],_0x40cc45[_0x5d145b(0x155)]),_0x632343=path_1[_0x5d145b(0x194)][_0x5d145b(0x17c)](_0x5c6ef6,_0x5d145b(0x18f)+_0x40cc45['companyId'],'fileList',String(_0xa7d419['id']));for(const [_0x328975,_0x41b394]of _0xa7d419[_0x5d145b(0x13a)][_0x5d145b(0x13c)]()){const _0x151d1e={'fieldname':_0x5d145b(0x140),'originalname':_0x41b394['path'],'encoding':_0x5d145b(0x158),'mimetype':_0x41b394[_0x5d145b(0x192)],'filename':_0x41b394[_0x5d145b(0x163)],'path':path_1[_0x5d145b(0x194)][_0x5d145b(0x17c)](_0x632343,_0x41b394[_0x5d145b(0x163)])};await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x151d1e,'ticket':_0x40cc45,'body':_0x41b394[_0x5d145b(0x14c)],'isForwarded':![]});};}catch(_0x1f8ca2){await(0x0,exports[_0x5d145b(0x184)])(_0x457a81,_0x1dfa3d['id'],_0x40cc45);}return _0x1dfa3d[_0x5d145b(0x153)]&&await sendMsgAndCloseTicket(_0x5bc48e,_0x40cc45[_0x5d145b(0x196)],_0x40cc45),_0x2e848b;}}if(_0x2fe72c){const _0x5edf57=isNumeric(_0x644f16)?_0x644f16:0x1,_0x25cdb3=await(0x0,ShowChatBotServices_1[_0x5d145b(0x194)])(_0x2fe72c['chatbotId']),_0x27bb8f=_0x25cdb3[_0x5d145b(0x13a)][+_0x5edf57-0x1]?_0x25cdb3[_0x5d145b(0x13a)][+_0x5edf57-0x1]:_0x25cdb3['options'][0x0];if(!_0x27bb8f[_0x5d145b(0x188)]){await(0x0,DeleteDialogChatBotsServices_1[_0x5d145b(0x194)])(_0x457a81['id']);return;}if(_0x27bb8f){if(_0x27bb8f['isAgent']){const _0xb155b=await User_1[_0x5d145b(0x194)][_0x5d145b(0x14e)]({'where':{'name':_0x27bb8f[_0x5d145b(0x14c)]}}),_0xd1d549={'ticketData':{'userId':_0xb155b['id'],'status':'open'},'ticketId':_0x40cc45['id']};await(0x0,UpdateTicketService_1[_0x5d145b(0x194)])({'ticketData':{..._0xd1d549[_0x5d145b(0x15f)]},'ticketId':_0xd1d549[_0x5d145b(0x172)],'companyId':_0x40cc45[_0x5d145b(0x155)]});}await(0x0,exports[_0x5d145b(0x184)])(_0x457a81,_0x27bb8f['id'],_0x40cc45);const _0x166c46=await sendDialog(_0x27bb8f,_0x5bc48e,_0x457a81,_0x40cc45);return _0x166c46;}}};exports[a558_0x4efea9(0x15d)]=sayChatbot;