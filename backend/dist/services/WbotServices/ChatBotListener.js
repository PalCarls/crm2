'use strict';const a611_0x292a0a=a611_0x3c11;(function(_0x4f52c6,_0x492f6b){const _0x4620bf=a611_0x3c11,_0x5a6011=_0x4f52c6();while(!![]){try{const _0x40fa39=parseInt(_0x4620bf(0x128))/0x1+parseInt(_0x4620bf(0x10f))/0x2*(parseInt(_0x4620bf(0x10c))/0x3)+-parseInt(_0x4620bf(0xf5))/0x4*(-parseInt(_0x4620bf(0x10a))/0x5)+parseInt(_0x4620bf(0x12f))/0x6+-parseInt(_0x4620bf(0x131))/0x7*(-parseInt(_0x4620bf(0x109))/0x8)+-parseInt(_0x4620bf(0x118))/0x9+-parseInt(_0x4620bf(0x104))/0xa;if(_0x40fa39===_0x492f6b)break;else _0x5a6011['push'](_0x5a6011['shift']());}catch(_0x133728){_0x5a6011['push'](_0x5a6011['shift']());}}}(a611_0x2a3f,0x520f5));var __createBinding=this&&this[a611_0x292a0a(0x11a)]||(Object[a611_0x292a0a(0xd4)]?function(_0x105830,_0x281611,_0x39c388,_0x3867c0){const _0x59cc53=a611_0x292a0a;if(_0x3867c0===undefined)_0x3867c0=_0x39c388;var _0x432eb7=Object[_0x59cc53(0xe0)](_0x281611,_0x39c388);(!_0x432eb7||(_0x59cc53(0xf6)in _0x432eb7?!_0x281611[_0x59cc53(0x12d)]:_0x432eb7[_0x59cc53(0x126)]||_0x432eb7[_0x59cc53(0xef)]))&&(_0x432eb7={'enumerable':!![],'get':function(){return _0x281611[_0x39c388];}}),Object[_0x59cc53(0xf3)](_0x105830,_0x3867c0,_0x432eb7);}:function(_0x534382,_0x2117e5,_0x122b2a,_0x18ef6c){if(_0x18ef6c===undefined)_0x18ef6c=_0x122b2a;_0x534382[_0x18ef6c]=_0x2117e5[_0x122b2a];}),__setModuleDefault=this&&this[a611_0x292a0a(0xcd)]||(Object[a611_0x292a0a(0xd4)]?function(_0x31f814,_0x53259c){const _0x24c212=a611_0x292a0a;Object[_0x24c212(0xf3)](_0x31f814,_0x24c212(0xe4),{'enumerable':!![],'value':_0x53259c});}:function(_0x113f8,_0x1750a2){const _0x5e7c80=a611_0x292a0a;_0x113f8[_0x5e7c80(0xe4)]=_0x1750a2;}),__importStar=this&&this[a611_0x292a0a(0x102)]||function(_0x3990cb){const _0x74b46e=a611_0x292a0a;if(_0x3990cb&&_0x3990cb[_0x74b46e(0x12d)])return _0x3990cb;var _0x3e6bc9={};if(_0x3990cb!=null){for(var _0x30ce79 in _0x3990cb)if(_0x30ce79!=='default'&&Object[_0x74b46e(0x11c)][_0x74b46e(0xd0)][_0x74b46e(0xe1)](_0x3990cb,_0x30ce79))__createBinding(_0x3e6bc9,_0x3990cb,_0x30ce79);}return __setModuleDefault(_0x3e6bc9,_0x3990cb),_0x3e6bc9;},__importDefault=this&&this['__importDefault']||function(_0x10e872){const _0xfa7ead=a611_0x292a0a;return _0x10e872&&_0x10e872[_0xfa7ead(0x12d)]?_0x10e872:{'default':_0x10e872};};Object[a611_0x292a0a(0xf3)](exports,'__esModule',{'value':!![]}),exports[a611_0x292a0a(0x122)]=exports[a611_0x292a0a(0x11e)]=void 0x0;const path_1=__importDefault(require('path')),wbotMessageListener_1=require(a611_0x292a0a(0xf9)),ShowDialogChatBotsServices_1=__importDefault(require(a611_0x292a0a(0x13f))),ShowQueueService_1=__importDefault(require(a611_0x292a0a(0x10e))),ShowChatBotServices_1=__importDefault(require(a611_0x292a0a(0xf2))),DeleteDialogChatBotsServices_1=__importDefault(require(a611_0x292a0a(0xdf))),ShowChatBotByChatbotIdServices_1=__importDefault(require(a611_0x292a0a(0x116))),CreateDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/CreateDialogChatBotsServices')),ShowWhatsAppService_1=__importDefault(require(a611_0x292a0a(0xf7))),Mustache_1=__importDefault(require('../../helpers/Mustache')),UpdateTicketService_1=__importDefault(require(a611_0x292a0a(0x101))),ShowService_1=__importDefault(require(a611_0x292a0a(0xe8))),SendWhatsAppMedia_1=__importStar(require(a611_0x292a0a(0xe2))),CompaniesSettings_1=__importDefault(require(a611_0x292a0a(0x139))),fs=require('fs');var axios=require(a611_0x292a0a(0xe9));const isNumeric=_0x54c6b5=>/^-?\d+$/[a611_0x292a0a(0x121)](_0x54c6b5),deleteAndCreateDialogStage=async(_0x336479,_0x2dab04,_0x38b1e4)=>{const _0x21f9ce=a611_0x292a0a;try{await(0x0,DeleteDialogChatBotsServices_1[_0x21f9ce(0xe4)])(_0x336479['id']);const _0x1c6eec=await(0x0,ShowChatBotByChatbotIdServices_1[_0x21f9ce(0xe4)])(_0x2dab04);return!_0x1c6eec&&await _0x38b1e4[_0x21f9ce(0xd2)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x21f9ce(0xe4)])({'awaiting':0x1,'contactId':_0x336479['id'],'chatbotId':_0x2dab04,'queueId':_0x1c6eec[_0x21f9ce(0xc8)]});}catch(_0x328f56){await _0x38b1e4[_0x21f9ce(0xd2)]({'isBot':![]});}};exports[a611_0x292a0a(0x11e)]=deleteAndCreateDialogStage;const sendMessage=async(_0x1efb08,_0x2befe7,_0x48b3e2,_0x16497c)=>{const _0x541849=a611_0x292a0a,_0x5cfc22=await _0x1efb08[_0x541849(0x13e)](_0x2befe7[_0x541849(0xd7)]+'@'+(_0x48b3e2[_0x541849(0x105)]?_0x541849(0xca):_0x541849(0xc7)),{'text':(0x0,Mustache_1[_0x541849(0xe4)])(_0x16497c,_0x48b3e2)});(0x0,wbotMessageListener_1['verifyMessage'])(_0x5cfc22,_0x48b3e2,_0x2befe7);},sendMessageLink=async(_0x215f3d,_0x28b96a,_0x2a2418,_0x57c14a,_0x41ce31)=>{const _0x137c35=a611_0x292a0a;let _0x4519da;try{_0x4519da=await _0x215f3d['sendMessage'](_0x28b96a[_0x137c35(0xd7)]+'@'+(_0x2a2418['isGroup']?_0x137c35(0xca):_0x137c35(0xc7)),{'document':_0x57c14a?{'url':_0x57c14a}:fs['readFileSync']('public/temp/'+_0x41ce31+'-'+makeid(0xa)),'fileName':_0x41ce31,'mimetype':_0x137c35(0xf0)});}catch(_0xe6a83e){_0x4519da=await _0x215f3d[_0x137c35(0x13e)](_0x28b96a[_0x137c35(0xd7)]+'@'+(_0x2a2418['isGroup']?'g.us':'s.whatsapp.net'),{'text':(0x0,Mustache_1[_0x137c35(0xe4)])('‎Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!',_0x2a2418)});}(0x0,wbotMessageListener_1['verifyMessage'])(_0x4519da,_0x2a2418,_0x28b96a);},sendMessageImage=async(_0x5548a6,_0x36963b,_0x1eb8fe,_0x32a37a,_0x3bc39d)=>{const _0x1b7bd4=a611_0x292a0a;let _0x3210db;try{_0x3210db=await _0x5548a6[_0x1b7bd4(0x13e)](_0x36963b[_0x1b7bd4(0xd7)]+'@'+(_0x1eb8fe['isGroup']?_0x1b7bd4(0xca):_0x1b7bd4(0xc7)),{'image':_0x32a37a?{'url':_0x32a37a}:fs['readFileSync'](_0x1b7bd4(0xe5)+_0x3bc39d+'-'+makeid(0xa)),'fileName':_0x3bc39d,'caption':_0x3bc39d,'mimetype':'image/jpeg'});}catch(_0x4207be){_0x3210db=await _0x5548a6[_0x1b7bd4(0x13e)](_0x36963b[_0x1b7bd4(0xd7)]+'@'+(_0x1eb8fe['isGroup']?_0x1b7bd4(0xca):_0x1b7bd4(0xc7)),{'text':(0x0,Mustache_1[_0x1b7bd4(0xe4)])(_0x1b7bd4(0x12c),_0x1eb8fe)});}(0x0,wbotMessageListener_1[_0x1b7bd4(0xff)])(_0x3210db,_0x1eb8fe,_0x36963b);},sendDialog=async(_0x53b8bc,_0x380f62,_0x3e278a,_0x4dbdf8)=>{const _0x4b1fa0=a611_0x292a0a,_0x29e6a2=await(0x0,ShowChatBotServices_1[_0x4b1fa0(0xe4)])(_0x53b8bc['id']);if(_0x29e6a2[_0x4b1fa0(0xcf)]){let _0x7e9bf=_0x4dbdf8[_0x4b1fa0(0xf8)];const _0x57df3a=await CompaniesSettings_1[_0x4b1fa0(0xe4)][_0x4b1fa0(0x125)]({'where':{'companyId':_0x7e9bf}}),_0x5da6b9=_0x57df3a?.[_0x4b1fa0(0xcb)]||_0x4b1fa0(0x106),_0x3806b7=async()=>{const _0x48e4e4=_0x4b1fa0;let _0x145217='';_0x29e6a2[_0x48e4e4(0xcf)][_0x48e4e4(0x10b)]((_0x44b013,_0x55e1a8)=>{const _0x522583=_0x48e4e4;_0x145217+=_0x522583(0xe3)+(_0x55e1a8+0x1)+_0x522583(0x11d)+_0x44b013['name']+'\x0a';});const _0x318c2d=_0x145217['length']>0x0?_0x145217+'\x0a*[\x20#\x20]*\x20Voltar\x20para\x20o\x20menu\x20principal\x0a*[\x20Sair\x20]*\x20Encerrar\x20atendimento':_0x145217+_0x48e4e4(0xd9);if(_0x145217[_0x48e4e4(0xd5)]>0x0){const _0x143419=(0x0,Mustache_1[_0x48e4e4(0xe4)])('‎\x20'+_0x53b8bc[_0x48e4e4(0xd6)]+'\x0a\x0a'+_0x318c2d,_0x4dbdf8),_0x22fd56=await sendMessage(_0x380f62,_0x3e278a,_0x4dbdf8,_0x143419);return _0x22fd56;}const _0xd532e9=(0x0,Mustache_1['default'])('‎\x20'+_0x53b8bc[_0x48e4e4(0xd6)],_0x4dbdf8),_0x452e51=await sendMessage(_0x380f62,_0x3e278a,_0x4dbdf8,_0xd532e9);return _0x452e51;},_0x3ac39c=async()=>{const _0x2db82f=_0x4b1fa0,_0x925999=[];_0x29e6a2[_0x2db82f(0xcf)]['forEach']((_0x3b93a6,_0x2e884b)=>{const _0x2a4678=_0x2db82f;_0x925999[_0x2a4678(0x133)]({'buttonId':''+(_0x2e884b+0x1),'buttonText':{'displayText':_0x3b93a6[_0x2a4678(0x129)]},'type':0x1});});if(_0x925999[_0x2db82f(0xd5)]>0x0){const _0x28b270={'text':'‎'+_0x53b8bc['greetingMessage'],'buttons':_0x925999,'headerType':0x1},_0x3fc0c0=await _0x380f62[_0x2db82f(0x13e)](_0x3e278a[_0x2db82f(0xd7)]+'@'+(_0x4dbdf8[_0x2db82f(0x105)]?_0x2db82f(0xca):'s.whatsapp.net'),_0x28b270);return await(0x0,wbotMessageListener_1['verifyMessage'])(_0x3fc0c0,_0x4dbdf8,_0x3e278a),_0x3fc0c0;}const _0x3dfccd='‎'+_0x53b8bc[_0x2db82f(0xd6)],_0x200026=await sendMessage(_0x380f62,_0x3e278a,_0x4dbdf8,_0x3dfccd);return _0x200026;},_0x6ec578=async()=>{const _0x1331f2=_0x4b1fa0,_0x4ab877=[];_0x29e6a2[_0x1331f2(0xcf)][_0x1331f2(0x10b)]((_0x4f58c8,_0x1a500d)=>{const _0x3d4c07=_0x1331f2;_0x4ab877[_0x3d4c07(0x133)]({'title':_0x4f58c8[_0x3d4c07(0x129)],'rowId':''+(_0x1a500d+0x1)});});if(_0x4ab877[_0x1331f2(0xd5)]>0x0){const _0x3f83bd=[{'title':_0x1331f2(0xce),'rows':_0x4ab877}],_0x40ca88={'text':(0x0,Mustache_1[_0x1331f2(0xe4)])('‎'+_0x53b8bc[_0x1331f2(0xd6)],_0x4dbdf8),'buttonText':'Escolha\x20uma\x20opção','sections':_0x3f83bd},_0x3b8e3=await _0x380f62[_0x1331f2(0x13e)](_0x3e278a[_0x1331f2(0xd7)]+'@'+(_0x4dbdf8[_0x1331f2(0x105)]?_0x1331f2(0xca):'s.whatsapp.net'),_0x40ca88);return await(0x0,wbotMessageListener_1['verifyMessage'])(_0x3b8e3,_0x4dbdf8,_0x3e278a),_0x3b8e3;}const _0x5328f4='‎'+_0x53b8bc[_0x1331f2(0xd6)],_0x34f2f6=await sendMessage(_0x380f62,_0x3e278a,_0x4dbdf8,_0x5328f4);return _0x34f2f6;};if(_0x5da6b9===_0x4b1fa0(0x106))return await _0x3806b7();if(_0x5da6b9===_0x4b1fa0(0xfa)&&_0x29e6a2['options'][_0x4b1fa0(0xd5)]>0x4)return await _0x3806b7();if(_0x5da6b9==='button'&&_0x29e6a2[_0x4b1fa0(0xcf)]['length']<=0x4)return await _0x3ac39c();if(_0x5da6b9===_0x4b1fa0(0xed))return await _0x6ec578();}},backToMainMenu=async(_0xffc510,_0x450d99,_0x3a9f61)=>{const _0x345ba9=a611_0x292a0a;await(0x0,UpdateTicketService_1[_0x345ba9(0xe4)])({'ticketData':{'queueId':null,'userId':null},'ticketId':_0x3a9f61['id'],'companyId':_0x3a9f61[_0x345ba9(0xf8)]});const {queues:_0x6b377c,greetingMessage:_0xc4d63,greetingMediaAttachment:_0x10b637}=await(0x0,ShowWhatsAppService_1[_0x345ba9(0xe4)])(_0xffc510['id'],_0x3a9f61[_0x345ba9(0xf8)]),_0x5eeb87=await CompaniesSettings_1[_0x345ba9(0xe4)]['findOne']({'where':{'companyId':_0x3a9f61[_0x345ba9(0xf8)]}}),_0x5124df=async()=>{const _0x1ae05b=_0x345ba9;let _0x3e042e='';_0x6b377c[_0x1ae05b(0x10b)]((_0x2d08fe,_0x1040c7)=>{const _0x4c399b=_0x1ae05b;_0x3e042e+=_0x4c399b(0xe3)+(_0x1040c7+0x1)+_0x4c399b(0x11d)+_0x2d08fe[_0x4c399b(0x129)]+'\x0a';}),_0x3e042e+=_0x1ae05b(0x137);const _0x284f97=(0x0,Mustache_1[_0x1ae05b(0xe4)])('‎\x20'+_0xc4d63+'\x0a\x0a'+_0x3e042e,_0x3a9f61);if(_0x10b637!==null){const _0x4f2366=path_1['default'][_0x1ae05b(0x12e)]('public',_0x1ae05b(0xdc)+_0x3a9f61[_0x1ae05b(0xf8)],_0x3a9f61['whatsapp']['greetingMediaAttachment']),_0x3a2f70=_0x3a9f61[_0x1ae05b(0x12b)][_0x1ae05b(0x110)],_0x26184b=await(0x0,SendWhatsAppMedia_1[_0x1ae05b(0x115)])(_0x3a2f70,_0x4f2366,String(_0x3a9f61['companyId']),_0x284f97),_0x364e16=await _0xffc510[_0x1ae05b(0x13e)](_0x3a9f61[_0x1ae05b(0xde)]['number']+'@'+(_0x3a9f61[_0x1ae05b(0x105)]?_0x1ae05b(0xca):_0x1ae05b(0xc7)),{..._0x26184b});await(0x0,wbotMessageListener_1[_0x1ae05b(0x124)])(_0x364e16,_0x3a9f61,_0x450d99);}else{const _0x4129ce=await _0xffc510[_0x1ae05b(0x13e)](_0x450d99[_0x1ae05b(0xd7)]+'@'+(_0x3a9f61['isGroup']?_0x1ae05b(0xca):_0x1ae05b(0xc7)),{'text':_0x284f97});await(0x0,wbotMessageListener_1[_0x1ae05b(0xff)])(_0x4129ce,_0x3a9f61,_0x450d99);}const _0x2c093b=await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x450d99['id']);return _0x2c093b;};if(_0x5eeb87[_0x345ba9(0xcb)]===_0x345ba9(0x106))return _0x5124df();};function validaCpfCnpj(_0x2cf2ec){const _0x26ca88=a611_0x292a0a;if(_0x2cf2ec['length']==0xb){var _0xf4dcb4=_0x2cf2ec['trim']();_0xf4dcb4=_0xf4dcb4[_0x26ca88(0x113)](/\./g,''),_0xf4dcb4=_0xf4dcb4['replace']('-',''),_0xf4dcb4=_0xf4dcb4[_0x26ca88(0xec)]('');var _0x4ddfde=0x0,_0x4a1b6f=0x0,_0x13b742=![];for(var _0x318668=0x1;_0xf4dcb4[_0x26ca88(0xd5)]>_0x318668;_0x318668++){_0xf4dcb4[_0x318668-0x1]!=_0xf4dcb4[_0x318668]&&(_0x13b742=!![]);}if(_0x13b742==![])return![];for(var _0x318668=0x0,_0x331029=0xa;_0xf4dcb4[_0x26ca88(0xd5)]-0x2>_0x318668;_0x318668++,_0x331029--){_0x4ddfde+=_0xf4dcb4[_0x318668]*_0x331029;}_0x4ddfde=_0x4ddfde*0xa%0xb;_0x4ddfde==0xa&&(_0x4ddfde=0x0);if(_0x4ddfde!=_0xf4dcb4[0x9])return![];for(var _0x318668=0x0,_0x331029=0xb;_0xf4dcb4[_0x26ca88(0xd5)]-0x1>_0x318668;_0x318668++,_0x331029--){_0x4a1b6f+=_0xf4dcb4[_0x318668]*_0x331029;}return _0x4a1b6f=_0x4a1b6f*0xa%0xb,_0x4a1b6f==0xa&&(_0x4a1b6f=0x0),_0x4a1b6f!=_0xf4dcb4[0xa]?![]:!![];}else{if(_0x2cf2ec['length']==0xe){var _0x483bb3=_0x2cf2ec[_0x26ca88(0x12a)]();_0x483bb3=_0x483bb3[_0x26ca88(0x113)](/\./g,''),_0x483bb3=_0x483bb3[_0x26ca88(0x113)]('-',''),_0x483bb3=_0x483bb3[_0x26ca88(0x113)]('/',''),_0x483bb3=_0x483bb3[_0x26ca88(0xec)]('');var _0x4ddfde=0x0,_0x4a1b6f=0x0,_0x13b742=![];for(var _0x318668=0x1;_0x483bb3['length']>_0x318668;_0x318668++){_0x483bb3[_0x318668-0x1]!=_0x483bb3[_0x318668]&&(_0x13b742=!![]);}if(_0x13b742==![])return![];for(var _0x318668=0x0,_0x47f2cf=0x5,_0x33734d=0xd;_0x483bb3[_0x26ca88(0xd5)]-0x2>_0x318668;_0x318668++,_0x47f2cf--,_0x33734d--){_0x47f2cf>=0x2?_0x4ddfde+=_0x483bb3[_0x318668]*_0x47f2cf:_0x4ddfde+=_0x483bb3[_0x318668]*_0x33734d;}_0x4ddfde=_0x4ddfde%0xb;_0x4ddfde<0x2?_0x4ddfde=0x0:_0x4ddfde=0xb-_0x4ddfde;if(_0x4ddfde!=_0x483bb3[0xc])return![];for(var _0x318668=0x0,_0x47f2cf=0x6,_0x33734d=0xe;_0x483bb3[_0x26ca88(0xd5)]-0x1>_0x318668;_0x318668++,_0x47f2cf--,_0x33734d--){_0x47f2cf>=0x2?_0x4a1b6f+=_0x483bb3[_0x318668]*_0x47f2cf:_0x4a1b6f+=_0x483bb3[_0x318668]*_0x33734d;}return _0x4a1b6f=_0x4a1b6f%0xb,_0x4a1b6f<0x2?_0x4a1b6f=0x0:_0x4a1b6f=0xb-_0x4a1b6f,_0x4a1b6f!=_0x483bb3[0xd]?![]:!![];}else return![];}}function timeout(_0x46e5e4){return new Promise(_0xfabbae=>setTimeout(_0xfabbae,_0x46e5e4));}async function sleep(_0x27b8ab){await timeout(_0x27b8ab);}function firstDayOfMonth(_0x575e7b){const _0x4cc05c=a611_0x292a0a,_0x31c5bc=new Date(),_0x3e7f28=new Date(_0x31c5bc[_0x4cc05c(0xf4)](),_0x31c5bc[_0x4cc05c(0xee)]()-_0x575e7b,0x1);return _0x3e7f28;};function lastDayOfMonth(_0x16041a){const _0x4d3bcd=a611_0x292a0a,_0x5dd981=new Date(),_0x43c6a0=new Date(_0x5dd981[_0x4d3bcd(0xf4)](),_0x5dd981[_0x4d3bcd(0xee)]()+_0x16041a,0x0);return _0x43c6a0;};function dataAtualFormatada(_0x1e469d){const _0x2f331f=a611_0x292a0a;var _0x11f353=_0x1e469d[_0x2f331f(0xe6)]()[_0x2f331f(0x10d)](),_0x1110b5=_0x11f353[_0x2f331f(0xd5)]==0x1?'0'+_0x11f353:_0x11f353,_0x8052d8=(_0x1e469d[_0x2f331f(0xee)]()+0x1)['toString'](),_0x59579c=_0x8052d8['length']==0x1?'0'+_0x8052d8:_0x8052d8,_0x3123bf=_0x1e469d[_0x2f331f(0xf4)]();return _0x1110b5+'/'+_0x59579c+'/'+_0x3123bf;}function makeid(_0x44274c){const _0xeaba12=a611_0x292a0a;var _0x2db362='',_0x29adb6=_0xeaba12(0x11f),_0x2ad03b=_0x29adb6[_0xeaba12(0xd5)];for(var _0x3e2629=0x0;_0x3e2629<_0x44274c;_0x3e2629++){_0x2db362+=_0x29adb6['charAt'](Math[_0xeaba12(0x103)](Math[_0xeaba12(0x123)]()*_0x2ad03b));}return _0x2db362;}function a611_0x3c11(_0x5666a3,_0x4dd844){const _0x2a3f7a=a611_0x2a3f();return a611_0x3c11=function(_0x3c1192,_0xce6de5){_0x3c1192=_0x3c1192-0xc7;let _0x1bb7f8=_0x2a3f7a[_0x3c1192];return _0x1bb7f8;},a611_0x3c11(_0x5666a3,_0x4dd844);}function replaceAll(_0x8b2a61,_0x49c64f,_0x5920a8){const _0x537644=a611_0x292a0a;return _0x8b2a61[_0x537644(0x113)](new RegExp(_0x49c64f,'g'),_0x5920a8);}function formatDate(_0x5b073c){const _0xf3bade=a611_0x292a0a;return _0x5b073c[_0xf3bade(0x120)](0x8,0xa)+'/'+_0x5b073c[_0xf3bade(0x120)](0x5,0x7)+'/'+_0x5b073c[_0xf3bade(0x120)](0x0,0x4);}function sortfunction(_0x5de8c4,_0x24367c){const _0x2c990f=a611_0x292a0a;return _0x5de8c4[_0x2c990f(0xc9)][_0x2c990f(0x132)](_0x24367c[_0x2c990f(0xc9)]);}async function sendMsgAndCloseTicket(_0x1e73b3,_0x1031e3,_0x22508c){const _0x13575e=a611_0x292a0a,_0x427234={'ticketData':{'status':_0x13575e(0x107),'userId':_0x22508c?.['userId']||null,'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'ticketId':_0x22508c['id'],'companyId':_0x22508c[_0x13575e(0xf8)]};await sleep(0x7d0),await(0x0,UpdateTicketService_1[_0x13575e(0xe4)])(_0x427234);}const sayChatbot=async(_0x465904,_0x3d5b29,_0x5d8391,_0x217948,_0x1352db)=>{const _0x5d42af=a611_0x292a0a,_0x6f7362=_0x1352db?.[_0x5d42af(0xda)]?.[_0x5d42af(0xdb)]?.[_0x5d42af(0xd8)]||_0x1352db?.[_0x5d42af(0xda)]?.['listResponseMessage']?.['singleSelectReply'][_0x5d42af(0x117)]||(0x0,wbotMessageListener_1[_0x5d42af(0xdd)])(_0x1352db);if(!_0x465904&&_0x6f7362&&_0x1352db[_0x5d42af(0xd1)][_0x5d42af(0x100)])return;const _0x6598c1=await(0x0,ShowDialogChatBotsServices_1['default'])(_0x217948['id']);if(_0x6f7362[_0x5d42af(0x134)]()===_0x5d42af(0xe7)){const _0xc66f58={'ticketData':{'status':'closed','sendFarewellMessage':!![],'amountUsedBotQueues':0x0},'ticketId':_0x5d8391['id'],'companyId':_0x5d8391[_0x5d42af(0xf8)]};await(0x0,UpdateTicketService_1['default'])(_0xc66f58);return;}if(_0x6f7362==='#'){const _0x39c4d3=await backToMainMenu(_0x3d5b29,_0x217948,_0x5d8391);return;}if(!_0x6598c1){const _0x12f1c5=await(0x0,ShowQueueService_1[_0x5d42af(0xe4)])(_0x465904,_0x5d8391[_0x5d42af(0xf8)]),_0x2efebd=_0x1352db?.['message']?.['buttonsResponseMessage']?.[_0x5d42af(0xd8)]||_0x1352db?.['message']?.[_0x5d42af(0x13a)]?.[_0x5d42af(0xea)][_0x5d42af(0x117)]||(0x0,wbotMessageListener_1[_0x5d42af(0xdd)])(_0x1352db),_0x376cc6=_0x12f1c5[_0x5d42af(0x112)][+_0x2efebd-0x1];if(_0x376cc6){if(_0x376cc6[_0x5d42af(0x136)]===_0x5d42af(0xfb))try{const _0x3c4dcf={'ticketData':{'integrationId':_0x376cc6[_0x5d42af(0x13b)],'useIntegration':!![],'status':_0x5d42af(0x119)},'ticketId':_0x5d8391['id']};await(0x0,UpdateTicketService_1['default'])({'ticketData':{..._0x3c4dcf[_0x5d42af(0xfe)]},'ticketId':_0x3c4dcf['ticketId'],'companyId':_0x5d8391['companyId']});}catch(_0x41bd5f){await(0x0,exports['deleteAndCreateDialogStage'])(_0x217948,_0x376cc6['id'],_0x5d8391);}else{if(_0x376cc6[_0x5d42af(0x136)]===_0x5d42af(0x138))try{const _0x183640={'ticketData':{'queueId':_0x376cc6[_0x5d42af(0x127)],'status':_0x5d42af(0x119)},'ticketId':_0x5d8391['id']};await(0x0,UpdateTicketService_1[_0x5d42af(0xe4)])({'ticketData':{..._0x183640[_0x5d42af(0xfe)]},'ticketId':_0x183640[_0x5d42af(0x135)],'companyId':_0x5d8391[_0x5d42af(0xf8)]});}catch(_0x1d955f){await(0x0,exports['deleteAndCreateDialogStage'])(_0x217948,_0x376cc6['id'],_0x5d8391);}else{if(_0x376cc6['queueType']==='attendent')try{const _0x509e59={'ticketData':{'queueId':_0x376cc6[_0x5d42af(0x127)],'userId':_0x376cc6[_0x5d42af(0x111)],'status':_0x5d42af(0x119)},'ticketId':_0x5d8391['id']};await(0x0,UpdateTicketService_1[_0x5d42af(0xe4)])({'ticketData':{..._0x509e59[_0x5d42af(0xfe)]},'ticketId':_0x509e59[_0x5d42af(0x135)],'companyId':_0x5d8391['companyId']});}catch(_0x36c725){await(0x0,exports[_0x5d42af(0x11e)])(_0x217948,_0x376cc6['id'],_0x5d8391);}}}await(0x0,exports[_0x5d42af(0x11e)])(_0x217948,_0x376cc6['id'],_0x5d8391);let _0x1a20a7;_0x376cc6?.[_0x5d42af(0xd6)]&&(_0x1a20a7=await sendDialog(_0x376cc6,_0x3d5b29,_0x217948,_0x5d8391));if(_0x376cc6[_0x5d42af(0x136)]===_0x5d42af(0xfd))try{const _0x493156=path_1[_0x5d42af(0xe4)][_0x5d42af(0x12e)](__dirname,'..','..','..','public'),_0x1d0eb1=await(0x0,ShowService_1[_0x5d42af(0xe4)])(_0x376cc6['optFileId'],_0x5d8391['companyId']),_0x25ddb3=path_1[_0x5d42af(0xe4)]['resolve'](_0x493156,'company'+_0x5d8391[_0x5d42af(0xf8)],'fileList',String(_0x1d0eb1['id']));for(const [_0x2c273c,_0xd68dac]of _0x1d0eb1[_0x5d42af(0xcf)][_0x5d42af(0x114)]()){const _0x42dc1e={'fieldname':_0x5d42af(0x11b),'originalname':_0xd68dac[_0x5d42af(0x13d)],'encoding':_0x5d42af(0x130),'mimetype':_0xd68dac[_0x5d42af(0x108)],'filename':_0xd68dac[_0x5d42af(0x13d)],'path':path_1['default'][_0x5d42af(0x12e)](_0x25ddb3,_0xd68dac[_0x5d42af(0x13d)])};await(0x0,SendWhatsAppMedia_1[_0x5d42af(0xe4)])({'media':_0x42dc1e,'ticket':_0x5d8391,'body':_0xd68dac[_0x5d42af(0x129)],'isForwarded':![]});};}catch(_0x36543c){await(0x0,exports['deleteAndCreateDialogStage'])(_0x217948,_0x376cc6['id'],_0x5d8391);}return _0x376cc6[_0x5d42af(0xf1)]&&await sendMsgAndCloseTicket(_0x3d5b29,_0x5d8391['contact'],_0x5d8391),_0x1a20a7;}}if(_0x6598c1){const _0x233f68=isNumeric(_0x6f7362)?_0x6f7362:0x1,_0x3ccf16=await(0x0,ShowChatBotServices_1['default'])(_0x6598c1[_0x5d42af(0xcc)]),_0x392465=_0x3ccf16[_0x5d42af(0xcf)][+_0x233f68-0x1]?_0x3ccf16[_0x5d42af(0xcf)][+_0x233f68-0x1]:_0x3ccf16['options'][0x0];if(!_0x392465[_0x5d42af(0xd6)]){await(0x0,DeleteDialogChatBotsServices_1[_0x5d42af(0xe4)])(_0x217948['id']);return;}if(_0x392465){if(_0x392465[_0x5d42af(0x136)]===_0x5d42af(0xfb))try{const _0x1a48cb={'ticketData':{'integrationId':_0x392465[_0x5d42af(0x13b)],'useIntegration':!![],'status':'pending'},'ticketId':_0x5d8391['id']};await(0x0,UpdateTicketService_1[_0x5d42af(0xe4)])({'ticketData':{..._0x1a48cb['ticketData']},'ticketId':_0x1a48cb[_0x5d42af(0x135)],'companyId':_0x5d8391[_0x5d42af(0xf8)]});}catch(_0x480bac){await(0x0,exports[_0x5d42af(0x11e)])(_0x217948,_0x392465['id'],_0x5d8391);}else{if(_0x392465[_0x5d42af(0x136)]===_0x5d42af(0x138))try{const _0x5d37d6={'ticketData':{'queueId':_0x392465[_0x5d42af(0x127)],'status':_0x5d42af(0x119)},'ticketId':_0x5d8391['id']};await(0x0,UpdateTicketService_1[_0x5d42af(0xe4)])({'ticketData':{..._0x5d37d6[_0x5d42af(0xfe)]},'ticketId':_0x5d37d6[_0x5d42af(0x135)],'companyId':_0x5d8391[_0x5d42af(0xf8)]});}catch(_0x567f02){await(0x0,exports['deleteAndCreateDialogStage'])(_0x217948,_0x392465['id'],_0x5d8391);}else{if(_0x392465[_0x5d42af(0x136)]===_0x5d42af(0xeb))try{const _0x2aad98={'ticketData':{'queueId':_0x392465[_0x5d42af(0x127)],'userId':_0x392465[_0x5d42af(0x111)],'status':'pending'},'ticketId':_0x5d8391['id']};await(0x0,UpdateTicketService_1['default'])({'ticketData':{..._0x2aad98[_0x5d42af(0xfe)]},'ticketId':_0x2aad98[_0x5d42af(0x135)],'companyId':_0x5d8391['companyId']});}catch(_0x3f06a5){await(0x0,exports['deleteAndCreateDialogStage'])(_0x217948,_0x392465['id'],_0x5d8391);}}}await(0x0,exports[_0x5d42af(0x11e)])(_0x217948,_0x392465['id'],_0x5d8391);if(_0x392465[_0x5d42af(0x136)]==='file')try{const _0x115b7e=path_1[_0x5d42af(0xe4)][_0x5d42af(0x12e)](__dirname,'..','..','..',_0x5d42af(0xd3)),_0x43824e=await(0x0,ShowService_1[_0x5d42af(0xe4)])(_0x392465[_0x5d42af(0xfc)],_0x5d8391[_0x5d42af(0xf8)]),_0x209825=path_1[_0x5d42af(0xe4)][_0x5d42af(0x12e)](_0x115b7e,_0x5d42af(0xdc)+_0x5d8391[_0x5d42af(0xf8)],_0x5d42af(0x13c),String(_0x43824e['id']));for(const [_0x5cd47c,_0x1f8936]of _0x43824e[_0x5d42af(0xcf)]['entries']()){const _0x337c66={'fieldname':_0x5d42af(0x11b),'originalname':_0x1f8936[_0x5d42af(0x13d)],'encoding':'7bit','mimetype':_0x1f8936[_0x5d42af(0x108)],'filename':_0x1f8936[_0x5d42af(0x13d)],'path':path_1[_0x5d42af(0xe4)][_0x5d42af(0x12e)](_0x209825,_0x1f8936[_0x5d42af(0x13d)])};await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x337c66,'ticket':_0x5d8391,'body':_0x1f8936[_0x5d42af(0x129)],'isForwarded':![]});};}catch(_0x9c7382){await(0x0,exports['deleteAndCreateDialogStage'])(_0x217948,_0x392465['id'],_0x5d8391);}_0x392465[_0x5d42af(0xf1)]&&await sendMsgAndCloseTicket(_0x3d5b29,_0x5d8391[_0x5d42af(0xde)],_0x5d8391);await(0x0,exports[_0x5d42af(0x11e)])(_0x217948,_0x392465['id'],_0x5d8391);const _0x1c3cb8=await sendDialog(_0x392465,_0x3d5b29,_0x217948,_0x5d8391);return _0x1c3cb8;}}};function a611_0x2a3f(){const _0x4dab7e=['contact','../DialogChatBotsServices/DeleteDialogChatBotsServices','getOwnPropertyDescriptor','call','./SendWhatsAppMedia','*[\x20','default','public/temp/','getDate','sair','../../services/FileServices/ShowService','axios','singleSelectReply','attendent','split','list','getMonth','configurable','application/pdf','closeTicket','../ChatBotServices/ShowChatBotServices','defineProperty','getFullYear','8yGQeui','get','../WhatsappService/ShowWhatsAppService','companyId','./wbotMessageListener','button','integration','optFileId','file','ticketData','verifyMessage','fromMe','../TicketServices/UpdateTicketService','__importStar','floor','12230990jVcgwC','isGroup','text','closed','mediaType','1192gYnnky','1414270lqUENe','forEach','3UMYVRc','toString','../QueueService/ShowQueueService','244746lzFkOK','greetingMediaAttachment','optUserId','chatbots','replace','entries','getMessageOptions','../ChatBotServices/ShowChatBotByChatbotIdServices','selectedRowId','1983231pedtlo','pending','__createBinding','medias','prototype','\x20]*\x20-\x20','deleteAndCreateDialogStage','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','substring','test','sayChatbot','random','verifyMediaMessage','findOne','writable','optQueueId','611858fbJHyG','name','trim','whatsapp','Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','__esModule','resolve','359418bAaJrv','7bit','19719OFqFdi','localeCompare','push','toLocaleLowerCase','ticketId','queueType','\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento','queue','../../models/CompaniesSettings','listResponseMessage','optIntegrationId','fileList','path','sendMessage','../DialogChatBotsServices/ShowDialogChatBotsServices','s.whatsapp.net','queueId','dueDate','g.us','chatBotType','chatbotId','__setModuleDefault','Menu','options','hasOwnProperty','key','update','public','create','length','greetingMessage','number','selectedButtonId','\x0a*[\x20Sair\x20]*\x20Encerrar\x20atendimento','message','buttonsResponseMessage','company','getBodyMessage'];a611_0x2a3f=function(){return _0x4dab7e;};return a611_0x2a3f();}exports[a611_0x292a0a(0x122)]=sayChatbot;