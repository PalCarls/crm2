'use strict';const a611_0x501d27=a611_0x1486;(function(_0x576e57,_0x53675a){const _0x37eae7=a611_0x1486,_0xd83635=_0x576e57();while(!![]){try{const _0x529a24=parseInt(_0x37eae7(0x1f2))/0x1+parseInt(_0x37eae7(0x1b3))/0x2+parseInt(_0x37eae7(0x1db))/0x3+-parseInt(_0x37eae7(0x1d4))/0x4*(parseInt(_0x37eae7(0x1c8))/0x5)+-parseInt(_0x37eae7(0x1cd))/0x6+-parseInt(_0x37eae7(0x1ec))/0x7*(-parseInt(_0x37eae7(0x1c2))/0x8)+parseInt(_0x37eae7(0x1cb))/0x9*(-parseInt(_0x37eae7(0x202))/0xa);if(_0x529a24===_0x53675a)break;else _0xd83635['push'](_0xd83635['shift']());}catch(_0x26b8e0){_0xd83635['push'](_0xd83635['shift']());}}}(a611_0x53e9,0x782f1));var __createBinding=this&&this['__createBinding']||(Object[a611_0x501d27(0x1f8)]?function(_0xada4a7,_0x5a73db,_0x510e2e,_0x19a68f){const _0x2cc008=a611_0x501d27;if(_0x19a68f===undefined)_0x19a68f=_0x510e2e;var _0x5db2ae=Object['getOwnPropertyDescriptor'](_0x5a73db,_0x510e2e);(!_0x5db2ae||(_0x2cc008(0x211)in _0x5db2ae?!_0x5a73db['__esModule']:_0x5db2ae['writable']||_0x5db2ae[_0x2cc008(0x1df)]))&&(_0x5db2ae={'enumerable':!![],'get':function(){return _0x5a73db[_0x510e2e];}}),Object[_0x2cc008(0x1d7)](_0xada4a7,_0x19a68f,_0x5db2ae);}:function(_0x13ed47,_0x17f45b,_0x5879cb,_0xf70b9f){if(_0xf70b9f===undefined)_0xf70b9f=_0x5879cb;_0x13ed47[_0xf70b9f]=_0x17f45b[_0x5879cb];}),__setModuleDefault=this&&this[a611_0x501d27(0x1fa)]||(Object['create']?function(_0x1fd63d,_0xf2dc22){const _0x58eb41=a611_0x501d27;Object['defineProperty'](_0x1fd63d,_0x58eb41(0x1d9),{'enumerable':!![],'value':_0xf2dc22});}:function(_0x31a65b,_0x499ee9){const _0x425668=a611_0x501d27;_0x31a65b[_0x425668(0x1d9)]=_0x499ee9;}),__importStar=this&&this['__importStar']||function(_0x2c8019){const _0x6b9e82=a611_0x501d27;if(_0x2c8019&&_0x2c8019[_0x6b9e82(0x1dc)])return _0x2c8019;var _0x44de6a={};if(_0x2c8019!=null){for(var _0x33272c in _0x2c8019)if(_0x33272c!=='default'&&Object['prototype'][_0x6b9e82(0x1ed)]['call'](_0x2c8019,_0x33272c))__createBinding(_0x44de6a,_0x2c8019,_0x33272c);}return __setModuleDefault(_0x44de6a,_0x2c8019),_0x44de6a;},__importDefault=this&&this[a611_0x501d27(0x1eb)]||function(_0x2c6ad7){return _0x2c6ad7&&_0x2c6ad7['__esModule']?_0x2c6ad7:{'default':_0x2c6ad7};};Object[a611_0x501d27(0x1d7)](exports,'__esModule',{'value':!![]}),exports[a611_0x501d27(0x1bb)]=exports['deleteAndCreateDialogStage']=void 0x0;function a611_0x53e9(){const _0x3a5797=['get','key','findOne','selectedRowId','isGroup','../DialogChatBotsServices/ShowDialogChatBotsServices','message','optUserId','Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','../QueueService/ShowQueueService','test','listResponseMessage','public','1794594GgJEtN','../ChatBotServices/ShowChatBotByChatbotIdServices','attendent','forEach','../../models/CompaniesSettings','optQueueId','integration','*[\x20','sayChatbot','application/pdf','options','getBodyMessage','text','./wbotMessageListener','selectedButtonId','80872ptIFve','chatbots','mediaType','length','getMonth','optIntegrationId','5PuVXfp','../TicketServices/UpdateTicketService','path','109845SvGMEz','7bit','3101208RDimqi','verifyMediaMessage','getDate','../WhatsappService/ShowWhatsAppService','queue','queueType','getFullYear','1590476ljhyWG','replace','company','defineProperty','greetingMediaAttachment','default','update','2095872nObgvB','__esModule','fileList','pending','configurable','readFileSync','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','floor','getMessageOptions','medias','button','\x0a*[\x20Sair\x20]*\x20Encerrar\x20atendimento','substring','list','image/jpeg','number','__importDefault','119uwwFVE','hasOwnProperty','optFileId','s.whatsapp.net','greetingMessage','buttonsResponseMessage','17341blGgfH','verifyMessage','chatbotId','closed','name','companyId','create','push','__setModuleDefault','chatBotType','fromMe','closeTicket','../../services/FileServices/ShowService','singleSelectReply','deleteAndCreateDialogStage','g.us','310roSfVw','./SendWhatsAppMedia','userId','dueDate','ticketId','contact','charAt','‎Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','ticketData','public/temp/','trim','sendMessage','toString','resolve','toLocaleLowerCase'];a611_0x53e9=function(){return _0x3a5797;};return a611_0x53e9();}const path_1=__importDefault(require('path')),wbotMessageListener_1=require(a611_0x501d27(0x1c0)),ShowDialogChatBotsServices_1=__importDefault(require(a611_0x501d27(0x1ab))),ShowQueueService_1=__importDefault(require(a611_0x501d27(0x1af))),ShowChatBotServices_1=__importDefault(require('../ChatBotServices/ShowChatBotServices')),DeleteDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/DeleteDialogChatBotsServices')),ShowChatBotByChatbotIdServices_1=__importDefault(require(a611_0x501d27(0x1b4))),CreateDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/CreateDialogChatBotsServices')),ShowWhatsAppService_1=__importDefault(require(a611_0x501d27(0x1d0))),Mustache_1=__importDefault(require('../../helpers/Mustache')),UpdateTicketService_1=__importDefault(require(a611_0x501d27(0x1c9))),ShowService_1=__importDefault(require(a611_0x501d27(0x1fe))),SendWhatsAppMedia_1=__importStar(require(a611_0x501d27(0x203))),CompaniesSettings_1=__importDefault(require(a611_0x501d27(0x1b7))),fs=require('fs');var axios=require('axios');const isNumeric=_0x862179=>/^-?\d+$/[a611_0x501d27(0x1b0)](_0x862179),deleteAndCreateDialogStage=async(_0x5d1531,_0x14e236,_0x1ac1a4)=>{const _0x1e90ed=a611_0x501d27;try{await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x5d1531['id']);const _0x59ce8c=await(0x0,ShowChatBotByChatbotIdServices_1[_0x1e90ed(0x1d9)])(_0x14e236);return!_0x59ce8c&&await _0x1ac1a4[_0x1e90ed(0x1da)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x1e90ed(0x1d9)])({'awaiting':0x1,'contactId':_0x5d1531['id'],'chatbotId':_0x14e236,'queueId':_0x59ce8c['queueId']});}catch(_0x328eda){await _0x1ac1a4[_0x1e90ed(0x1da)]({'isBot':![]});}};exports[a611_0x501d27(0x200)]=deleteAndCreateDialogStage;const sendMessage=async(_0x4b762b,_0x47bf8c,_0xa21725,_0x330b3a)=>{const _0x46e97f=a611_0x501d27,_0x4e7407=await _0x4b762b[_0x46e97f(0x20d)](_0x47bf8c['number']+'@'+(_0xa21725['isGroup']?_0x46e97f(0x201):_0x46e97f(0x1ef)),{'text':(0x0,Mustache_1['default'])(_0x330b3a,_0xa21725)});(0x0,wbotMessageListener_1[_0x46e97f(0x1f3)])(_0x4e7407,_0xa21725,_0x47bf8c);},sendMessageLink=async(_0xef9524,_0x1f0b67,_0x37cfb6,_0x9499fa,_0x1874bc)=>{const _0x1ea49a=a611_0x501d27;let _0x96014a;try{_0x96014a=await _0xef9524['sendMessage'](_0x1f0b67['number']+'@'+(_0x37cfb6[_0x1ea49a(0x1aa)]?_0x1ea49a(0x201):_0x1ea49a(0x1ef)),{'document':_0x9499fa?{'url':_0x9499fa}:fs[_0x1ea49a(0x1e0)](_0x1ea49a(0x20b)+_0x1874bc+'-'+makeid(0xa)),'fileName':_0x1874bc,'mimetype':_0x1ea49a(0x1bc)});}catch(_0x273c22){_0x96014a=await _0xef9524['sendMessage'](_0x1f0b67[_0x1ea49a(0x1ea)]+'@'+(_0x37cfb6['isGroup']?'g.us':_0x1ea49a(0x1ef)),{'text':(0x0,Mustache_1[_0x1ea49a(0x1d9)])(_0x1ea49a(0x209),_0x37cfb6)});}(0x0,wbotMessageListener_1[_0x1ea49a(0x1f3)])(_0x96014a,_0x37cfb6,_0x1f0b67);},sendMessageImage=async(_0xaf031,_0x48b172,_0x5b072a,_0x3268b8,_0x422da9)=>{const _0x28099c=a611_0x501d27;let _0x288856;try{_0x288856=await _0xaf031[_0x28099c(0x20d)](_0x48b172[_0x28099c(0x1ea)]+'@'+(_0x5b072a[_0x28099c(0x1aa)]?_0x28099c(0x201):'s.whatsapp.net'),{'image':_0x3268b8?{'url':_0x3268b8}:fs[_0x28099c(0x1e0)](_0x28099c(0x20b)+_0x422da9+'-'+makeid(0xa)),'fileName':_0x422da9,'caption':_0x422da9,'mimetype':_0x28099c(0x1e9)});}catch(_0x1039d2){_0x288856=await _0xaf031[_0x28099c(0x20d)](_0x48b172[_0x28099c(0x1ea)]+'@'+(_0x5b072a[_0x28099c(0x1aa)]?'g.us':_0x28099c(0x1ef)),{'text':(0x0,Mustache_1[_0x28099c(0x1d9)])(_0x28099c(0x1ae),_0x5b072a)});}(0x0,wbotMessageListener_1[_0x28099c(0x1f3)])(_0x288856,_0x5b072a,_0x48b172);},sendDialog=async(_0x1bcf42,_0xd53ab4,_0x1c6c47,_0x47fd0f)=>{const _0x1c8e37=a611_0x501d27,_0x15b0db=await(0x0,ShowChatBotServices_1[_0x1c8e37(0x1d9)])(_0x1bcf42['id']);if(_0x15b0db[_0x1c8e37(0x1bd)]){let _0x30238c=_0x47fd0f[_0x1c8e37(0x1f7)];const _0x5c1840=await CompaniesSettings_1[_0x1c8e37(0x1d9)]['findOne']({'where':{'companyId':_0x30238c}}),_0x46e33a=_0x5c1840?.[_0x1c8e37(0x1fb)]||_0x1c8e37(0x1bf),_0x26459e=async()=>{const _0x6826fc=_0x1c8e37;let _0x2c0de3='';_0x15b0db[_0x6826fc(0x1bd)][_0x6826fc(0x1b6)]((_0x49db8b,_0x12408a)=>{const _0x5c3bc4=_0x6826fc;_0x2c0de3+=_0x5c3bc4(0x1ba)+(_0x12408a+0x1)+'\x20]*\x20-\x20'+_0x49db8b[_0x5c3bc4(0x1f6)]+'\x0a';});const _0x22d37f=_0x2c0de3['length']>0x0?_0x2c0de3+'\x0a*[\x20#\x20]*\x20Voltar\x20para\x20o\x20menu\x20principal\x0a*[\x20Sair\x20]*\x20Encerrar\x20atendimento':_0x2c0de3+_0x6826fc(0x1e6);if(_0x2c0de3[_0x6826fc(0x1c5)]>0x0){const _0x35a02e=(0x0,Mustache_1[_0x6826fc(0x1d9)])('‎\x20'+_0x1bcf42[_0x6826fc(0x1f0)]+'\x0a\x0a'+_0x22d37f,_0x47fd0f),_0x62b278=await sendMessage(_0xd53ab4,_0x1c6c47,_0x47fd0f,_0x35a02e);return _0x62b278;}const _0x4d515a=(0x0,Mustache_1[_0x6826fc(0x1d9)])('‎\x20'+_0x1bcf42[_0x6826fc(0x1f0)],_0x47fd0f),_0x5a4b4e=await sendMessage(_0xd53ab4,_0x1c6c47,_0x47fd0f,_0x4d515a);return _0x5a4b4e;},_0x33527d=async()=>{const _0x3361fe=_0x1c8e37,_0x3a9411=[];_0x15b0db[_0x3361fe(0x1bd)]['forEach']((_0x587118,_0x2820d1)=>{_0x3a9411['push']({'buttonId':''+(_0x2820d1+0x1),'buttonText':{'displayText':_0x587118['name']},'type':0x1});});if(_0x3a9411[_0x3361fe(0x1c5)]>0x0){const _0xdd7175={'text':'‎'+_0x1bcf42[_0x3361fe(0x1f0)],'buttons':_0x3a9411,'headerType':0x1},_0x175f41=await _0xd53ab4[_0x3361fe(0x20d)](_0x1c6c47[_0x3361fe(0x1ea)]+'@'+(_0x47fd0f[_0x3361fe(0x1aa)]?'g.us':'s.whatsapp.net'),_0xdd7175);return await(0x0,wbotMessageListener_1[_0x3361fe(0x1f3)])(_0x175f41,_0x47fd0f,_0x1c6c47),_0x175f41;}const _0x9c3fd9='‎'+_0x1bcf42[_0x3361fe(0x1f0)],_0x48c032=await sendMessage(_0xd53ab4,_0x1c6c47,_0x47fd0f,_0x9c3fd9);return _0x48c032;},_0x548625=async()=>{const _0x1a7637=_0x1c8e37,_0x1a60d6=[];_0x15b0db[_0x1a7637(0x1bd)][_0x1a7637(0x1b6)]((_0x5cd144,_0x4495b7)=>{const _0x30816b=_0x1a7637;_0x1a60d6[_0x30816b(0x1f9)]({'title':_0x5cd144[_0x30816b(0x1f6)],'rowId':''+(_0x4495b7+0x1)});});if(_0x1a60d6[_0x1a7637(0x1c5)]>0x0){const _0xdf550d=[{'title':'Menu','rows':_0x1a60d6}],_0x42bf63={'text':(0x0,Mustache_1[_0x1a7637(0x1d9)])('‎'+_0x1bcf42[_0x1a7637(0x1f0)],_0x47fd0f),'buttonText':'Escolha\x20uma\x20opção','sections':_0xdf550d},_0x3deb1f=await _0xd53ab4[_0x1a7637(0x20d)](_0x1c6c47[_0x1a7637(0x1ea)]+'@'+(_0x47fd0f[_0x1a7637(0x1aa)]?_0x1a7637(0x201):_0x1a7637(0x1ef)),_0x42bf63);return await(0x0,wbotMessageListener_1[_0x1a7637(0x1f3)])(_0x3deb1f,_0x47fd0f,_0x1c6c47),_0x3deb1f;}const _0x1dd97e='‎'+_0x1bcf42[_0x1a7637(0x1f0)],_0x43495c=await sendMessage(_0xd53ab4,_0x1c6c47,_0x47fd0f,_0x1dd97e);return _0x43495c;};if(_0x46e33a===_0x1c8e37(0x1bf))return await _0x26459e();if(_0x46e33a===_0x1c8e37(0x1e5)&&_0x15b0db[_0x1c8e37(0x1bd)][_0x1c8e37(0x1c5)]>0x4)return await _0x26459e();if(_0x46e33a==='button'&&_0x15b0db['options'][_0x1c8e37(0x1c5)]<=0x4)return await _0x33527d();if(_0x46e33a===_0x1c8e37(0x1e8))return await _0x548625();}},backToMainMenu=async(_0x3635a7,_0x185518,_0x5f50f3)=>{const _0x595d2e=a611_0x501d27;await(0x0,UpdateTicketService_1[_0x595d2e(0x1d9)])({'ticketData':{'queueId':null,'userId':null},'ticketId':_0x5f50f3['id'],'companyId':_0x5f50f3['companyId']});const {queues:_0x5774a2,greetingMessage:_0x3c03e5,greetingMediaAttachment:_0x417ccd}=await(0x0,ShowWhatsAppService_1[_0x595d2e(0x1d9)])(_0x3635a7['id'],_0x5f50f3['companyId']),_0x160bc3=await CompaniesSettings_1[_0x595d2e(0x1d9)][_0x595d2e(0x1a8)]({'where':{'companyId':_0x5f50f3[_0x595d2e(0x1f7)]}}),_0x48f2b4=async()=>{const _0x3e78f8=_0x595d2e;let _0x3d6f5f='';_0x5774a2[_0x3e78f8(0x1b6)]((_0xcc862f,_0x3cbf2b)=>{const _0x235431=_0x3e78f8;_0x3d6f5f+=_0x235431(0x1ba)+(_0x3cbf2b+0x1)+'\x20]*\x20-\x20'+_0xcc862f[_0x235431(0x1f6)]+'\x0a';}),_0x3d6f5f+='\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento';const _0x54643e=(0x0,Mustache_1[_0x3e78f8(0x1d9)])('‎\x20'+_0x3c03e5+'\x0a\x0a'+_0x3d6f5f,_0x5f50f3);if(_0x417ccd!==null){const _0x3b28e7=path_1['default']['resolve']('public',_0x3e78f8(0x1d6)+_0x5f50f3['companyId'],_0x5f50f3['whatsapp'][_0x3e78f8(0x1d8)]),_0x263440=_0x5f50f3['whatsapp'][_0x3e78f8(0x1d8)],_0x5b5539=await(0x0,SendWhatsAppMedia_1[_0x3e78f8(0x1e3)])(_0x263440,_0x3b28e7,String(_0x5f50f3[_0x3e78f8(0x1f7)]),_0x54643e),_0x1574e4=await _0x3635a7['sendMessage'](_0x5f50f3[_0x3e78f8(0x207)][_0x3e78f8(0x1ea)]+'@'+(_0x5f50f3[_0x3e78f8(0x1aa)]?_0x3e78f8(0x201):_0x3e78f8(0x1ef)),{..._0x5b5539});await(0x0,wbotMessageListener_1[_0x3e78f8(0x1ce)])(_0x1574e4,_0x5f50f3,_0x185518);}else{const _0x5d138f=await _0x3635a7[_0x3e78f8(0x20d)](_0x185518['number']+'@'+(_0x5f50f3['isGroup']?_0x3e78f8(0x201):_0x3e78f8(0x1ef)),{'text':_0x54643e});await(0x0,wbotMessageListener_1[_0x3e78f8(0x1f3)])(_0x5d138f,_0x5f50f3,_0x185518);}const _0x4e66dd=await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x185518['id']);return _0x4e66dd;};if(_0x160bc3[_0x595d2e(0x1fb)]===_0x595d2e(0x1bf))return _0x48f2b4();};function validaCpfCnpj(_0x497968){const _0x3d7cd2=a611_0x501d27;if(_0x497968['length']==0xb){var _0x3f8810=_0x497968[_0x3d7cd2(0x20c)]();_0x3f8810=_0x3f8810[_0x3d7cd2(0x1d5)](/\./g,''),_0x3f8810=_0x3f8810[_0x3d7cd2(0x1d5)]('-',''),_0x3f8810=_0x3f8810['split']('');var _0xced25d=0x0,_0x20505b=0x0,_0x48567f=![];for(var _0x454b2e=0x1;_0x3f8810[_0x3d7cd2(0x1c5)]>_0x454b2e;_0x454b2e++){_0x3f8810[_0x454b2e-0x1]!=_0x3f8810[_0x454b2e]&&(_0x48567f=!![]);}if(_0x48567f==![])return![];for(var _0x454b2e=0x0,_0x52d97d=0xa;_0x3f8810[_0x3d7cd2(0x1c5)]-0x2>_0x454b2e;_0x454b2e++,_0x52d97d--){_0xced25d+=_0x3f8810[_0x454b2e]*_0x52d97d;}_0xced25d=_0xced25d*0xa%0xb;_0xced25d==0xa&&(_0xced25d=0x0);if(_0xced25d!=_0x3f8810[0x9])return![];for(var _0x454b2e=0x0,_0x52d97d=0xb;_0x3f8810[_0x3d7cd2(0x1c5)]-0x1>_0x454b2e;_0x454b2e++,_0x52d97d--){_0x20505b+=_0x3f8810[_0x454b2e]*_0x52d97d;}return _0x20505b=_0x20505b*0xa%0xb,_0x20505b==0xa&&(_0x20505b=0x0),_0x20505b!=_0x3f8810[0xa]?![]:!![];}else{if(_0x497968[_0x3d7cd2(0x1c5)]==0xe){var _0x470e25=_0x497968['trim']();_0x470e25=_0x470e25['replace'](/\./g,''),_0x470e25=_0x470e25[_0x3d7cd2(0x1d5)]('-',''),_0x470e25=_0x470e25[_0x3d7cd2(0x1d5)]('/',''),_0x470e25=_0x470e25['split']('');var _0xced25d=0x0,_0x20505b=0x0,_0x48567f=![];for(var _0x454b2e=0x1;_0x470e25[_0x3d7cd2(0x1c5)]>_0x454b2e;_0x454b2e++){_0x470e25[_0x454b2e-0x1]!=_0x470e25[_0x454b2e]&&(_0x48567f=!![]);}if(_0x48567f==![])return![];for(var _0x454b2e=0x0,_0x1aafa2=0x5,_0x51d886=0xd;_0x470e25[_0x3d7cd2(0x1c5)]-0x2>_0x454b2e;_0x454b2e++,_0x1aafa2--,_0x51d886--){_0x1aafa2>=0x2?_0xced25d+=_0x470e25[_0x454b2e]*_0x1aafa2:_0xced25d+=_0x470e25[_0x454b2e]*_0x51d886;}_0xced25d=_0xced25d%0xb;_0xced25d<0x2?_0xced25d=0x0:_0xced25d=0xb-_0xced25d;if(_0xced25d!=_0x470e25[0xc])return![];for(var _0x454b2e=0x0,_0x1aafa2=0x6,_0x51d886=0xe;_0x470e25[_0x3d7cd2(0x1c5)]-0x1>_0x454b2e;_0x454b2e++,_0x1aafa2--,_0x51d886--){_0x1aafa2>=0x2?_0x20505b+=_0x470e25[_0x454b2e]*_0x1aafa2:_0x20505b+=_0x470e25[_0x454b2e]*_0x51d886;}return _0x20505b=_0x20505b%0xb,_0x20505b<0x2?_0x20505b=0x0:_0x20505b=0xb-_0x20505b,_0x20505b!=_0x470e25[0xd]?![]:!![];}else return![];}}function timeout(_0x38fa62){return new Promise(_0x1fef8c=>setTimeout(_0x1fef8c,_0x38fa62));}async function sleep(_0x2eef88){await timeout(_0x2eef88);}function firstDayOfMonth(_0x1adde9){const _0x3488a3=a611_0x501d27,_0x3ae481=new Date(),_0x19b605=new Date(_0x3ae481[_0x3488a3(0x1d3)](),_0x3ae481[_0x3488a3(0x1c6)]()-_0x1adde9,0x1);return _0x19b605;};function lastDayOfMonth(_0x17478e){const _0x4c05ad=a611_0x501d27,_0x1caefb=new Date(),_0x45667d=new Date(_0x1caefb['getFullYear'](),_0x1caefb[_0x4c05ad(0x1c6)]()+_0x17478e,0x0);return _0x45667d;};function a611_0x1486(_0x2d24f1,_0x47f428){const _0x53e92a=a611_0x53e9();return a611_0x1486=function(_0x148693,_0x1dfdb9){_0x148693=_0x148693-0x1a7;let _0x561e1b=_0x53e92a[_0x148693];return _0x561e1b;},a611_0x1486(_0x2d24f1,_0x47f428);}function dataAtualFormatada(_0x266008){const _0x6bfebc=a611_0x501d27;var _0x56f2d7=_0x266008[_0x6bfebc(0x1cf)]()[_0x6bfebc(0x20e)](),_0x6be1de=_0x56f2d7[_0x6bfebc(0x1c5)]==0x1?'0'+_0x56f2d7:_0x56f2d7,_0x2f8c6b=(_0x266008[_0x6bfebc(0x1c6)]()+0x1)[_0x6bfebc(0x20e)](),_0x311901=_0x2f8c6b[_0x6bfebc(0x1c5)]==0x1?'0'+_0x2f8c6b:_0x2f8c6b,_0x216329=_0x266008[_0x6bfebc(0x1d3)]();return _0x6be1de+'/'+_0x311901+'/'+_0x216329;}function makeid(_0x2b58ba){const _0xfa4cee=a611_0x501d27;var _0xec268f='',_0x1ca727=_0xfa4cee(0x1e1),_0x44977f=_0x1ca727[_0xfa4cee(0x1c5)];for(var _0xbbfbe9=0x0;_0xbbfbe9<_0x2b58ba;_0xbbfbe9++){_0xec268f+=_0x1ca727[_0xfa4cee(0x208)](Math[_0xfa4cee(0x1e2)](Math['random']()*_0x44977f));}return _0xec268f;}function replaceAll(_0xd6dd,_0x1edc8d,_0x369010){const _0x555e4f=a611_0x501d27;return _0xd6dd[_0x555e4f(0x1d5)](new RegExp(_0x1edc8d,'g'),_0x369010);}function formatDate(_0x3232f0){const _0x22f63b=a611_0x501d27;return _0x3232f0['substring'](0x8,0xa)+'/'+_0x3232f0[_0x22f63b(0x1e7)](0x5,0x7)+'/'+_0x3232f0[_0x22f63b(0x1e7)](0x0,0x4);}function sortfunction(_0x5b9288,_0x53a587){const _0x22b8c7=a611_0x501d27;return _0x5b9288['dueDate']['localeCompare'](_0x53a587[_0x22b8c7(0x205)]);}async function sendMsgAndCloseTicket(_0x19f4ee,_0x110c53,_0x34f92d){const _0x35ab32=a611_0x501d27,_0x284d9f={'ticketData':{'status':_0x35ab32(0x1f5),'userId':_0x34f92d?.[_0x35ab32(0x204)]||null,'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'ticketId':_0x34f92d['id'],'companyId':_0x34f92d[_0x35ab32(0x1f7)]};await sleep(0x7d0),await(0x0,UpdateTicketService_1[_0x35ab32(0x1d9)])(_0x284d9f);}const sayChatbot=async(_0x4e274a,_0x23efeb,_0xc61086,_0x2c123b,_0x3d5fca)=>{const _0x8d547b=a611_0x501d27,_0x90db48=_0x3d5fca?.['message']?.[_0x8d547b(0x1f1)]?.[_0x8d547b(0x1c1)]||_0x3d5fca?.[_0x8d547b(0x1ac)]?.[_0x8d547b(0x1b1)]?.['singleSelectReply'][_0x8d547b(0x1a9)]||(0x0,wbotMessageListener_1[_0x8d547b(0x1be)])(_0x3d5fca);if(!_0x4e274a&&_0x90db48&&_0x3d5fca[_0x8d547b(0x1a7)][_0x8d547b(0x1fc)])return;const _0x485fd9=await(0x0,ShowDialogChatBotsServices_1[_0x8d547b(0x1d9)])(_0x2c123b['id']);if(_0x90db48[_0x8d547b(0x210)]()==='sair'){const _0x4671c4={'ticketData':{'status':_0x8d547b(0x1f5),'sendFarewellMessage':!![],'amountUsedBotQueues':0x0},'ticketId':_0xc61086['id'],'companyId':_0xc61086['companyId']};await(0x0,UpdateTicketService_1[_0x8d547b(0x1d9)])(_0x4671c4);return;}if(_0x90db48==='#'){const _0x2bb711=await backToMainMenu(_0x23efeb,_0x2c123b,_0xc61086);return;}if(!_0x485fd9){const _0x58490d=await(0x0,ShowQueueService_1[_0x8d547b(0x1d9)])(_0x4e274a,_0xc61086[_0x8d547b(0x1f7)]),_0x2f3eb7=_0x3d5fca?.['message']?.[_0x8d547b(0x1f1)]?.[_0x8d547b(0x1c1)]||_0x3d5fca?.[_0x8d547b(0x1ac)]?.[_0x8d547b(0x1b1)]?.[_0x8d547b(0x1ff)][_0x8d547b(0x1a9)]||(0x0,wbotMessageListener_1[_0x8d547b(0x1be)])(_0x3d5fca),_0x1f4ce2=_0x58490d[_0x8d547b(0x1c3)][+_0x2f3eb7-0x1];if(_0x1f4ce2){if(_0x1f4ce2[_0x8d547b(0x1d2)]==='integration')try{const _0xae0500={'ticketData':{'integrationId':_0x1f4ce2['optIntegrationId'],'useIntegration':!![],'status':_0x8d547b(0x1de)},'ticketId':_0xc61086['id']};await(0x0,UpdateTicketService_1[_0x8d547b(0x1d9)])({'ticketData':{..._0xae0500[_0x8d547b(0x20a)]},'ticketId':_0xae0500[_0x8d547b(0x206)],'companyId':_0xc61086[_0x8d547b(0x1f7)]});}catch(_0x47a177){await(0x0,exports['deleteAndCreateDialogStage'])(_0x2c123b,_0x1f4ce2['id'],_0xc61086);}else{if(_0x1f4ce2[_0x8d547b(0x1d2)]===_0x8d547b(0x1d1))try{const _0x305cb5={'ticketData':{'queueId':_0x1f4ce2[_0x8d547b(0x1b8)],'status':'pending'},'ticketId':_0xc61086['id']};await(0x0,UpdateTicketService_1['default'])({'ticketData':{..._0x305cb5[_0x8d547b(0x20a)]},'ticketId':_0x305cb5[_0x8d547b(0x206)],'companyId':_0xc61086[_0x8d547b(0x1f7)]});}catch(_0x120114){await(0x0,exports[_0x8d547b(0x200)])(_0x2c123b,_0x1f4ce2['id'],_0xc61086);}else{if(_0x1f4ce2[_0x8d547b(0x1d2)]===_0x8d547b(0x1b5))try{const _0x137bf2={'ticketData':{'queueId':_0x1f4ce2['optQueueId'],'userId':_0x1f4ce2['optUserId'],'status':_0x8d547b(0x1de)},'ticketId':_0xc61086['id']};await(0x0,UpdateTicketService_1[_0x8d547b(0x1d9)])({'ticketData':{..._0x137bf2['ticketData']},'ticketId':_0x137bf2[_0x8d547b(0x206)],'companyId':_0xc61086['companyId']});}catch(_0xd9649e){await(0x0,exports[_0x8d547b(0x200)])(_0x2c123b,_0x1f4ce2['id'],_0xc61086);}}}await(0x0,exports[_0x8d547b(0x200)])(_0x2c123b,_0x1f4ce2['id'],_0xc61086);let _0x4348cf;_0x1f4ce2?.['greetingMessage']&&(_0x4348cf=await sendDialog(_0x1f4ce2,_0x23efeb,_0x2c123b,_0xc61086));if(_0x1f4ce2[_0x8d547b(0x1d2)]==='file')try{const _0x156088=path_1[_0x8d547b(0x1d9)][_0x8d547b(0x20f)](__dirname,'..','..','..',_0x8d547b(0x1b2)),_0x38e789=await(0x0,ShowService_1[_0x8d547b(0x1d9)])(_0x1f4ce2[_0x8d547b(0x1ee)],_0xc61086['companyId']),_0x4f1556=path_1[_0x8d547b(0x1d9)][_0x8d547b(0x20f)](_0x156088,_0x8d547b(0x1d6)+_0xc61086[_0x8d547b(0x1f7)],_0x8d547b(0x1dd),String(_0x38e789['id']));for(const [_0x5d89e9,_0x10e45e]of _0x38e789[_0x8d547b(0x1bd)]['entries']()){const _0x1171c9={'fieldname':_0x8d547b(0x1e4),'originalname':_0x10e45e[_0x8d547b(0x1ca)],'encoding':_0x8d547b(0x1cc),'mimetype':_0x10e45e[_0x8d547b(0x1c4)],'filename':_0x10e45e[_0x8d547b(0x1ca)],'path':path_1[_0x8d547b(0x1d9)][_0x8d547b(0x20f)](_0x4f1556,_0x10e45e[_0x8d547b(0x1ca)])};await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x1171c9,'ticket':_0xc61086,'body':_0x10e45e['name'],'isForwarded':![]});};}catch(_0x3b8455){await(0x0,exports[_0x8d547b(0x200)])(_0x2c123b,_0x1f4ce2['id'],_0xc61086);}return _0x1f4ce2['closeTicket']&&await sendMsgAndCloseTicket(_0x23efeb,_0xc61086['contact'],_0xc61086),_0x4348cf;}}if(_0x485fd9){const _0xe496c7=isNumeric(_0x90db48)?_0x90db48:0x1,_0x11ae91=await(0x0,ShowChatBotServices_1[_0x8d547b(0x1d9)])(_0x485fd9[_0x8d547b(0x1f4)]),_0xb63d26=_0x11ae91[_0x8d547b(0x1bd)][+_0xe496c7-0x1]?_0x11ae91[_0x8d547b(0x1bd)][+_0xe496c7-0x1]:_0x11ae91[_0x8d547b(0x1bd)][0x0];if(!_0xb63d26[_0x8d547b(0x1f0)]){await(0x0,DeleteDialogChatBotsServices_1[_0x8d547b(0x1d9)])(_0x2c123b['id']);return;}if(_0xb63d26){if(_0xb63d26['queueType']===_0x8d547b(0x1b9))try{const _0x17a79f={'ticketData':{'integrationId':_0xb63d26[_0x8d547b(0x1c7)],'useIntegration':!![],'status':_0x8d547b(0x1de)},'ticketId':_0xc61086['id']};await(0x0,UpdateTicketService_1[_0x8d547b(0x1d9)])({'ticketData':{..._0x17a79f[_0x8d547b(0x20a)]},'ticketId':_0x17a79f[_0x8d547b(0x206)],'companyId':_0xc61086['companyId']});}catch(_0x5efcb6){await(0x0,exports[_0x8d547b(0x200)])(_0x2c123b,_0xb63d26['id'],_0xc61086);}else{if(_0xb63d26[_0x8d547b(0x1d2)]===_0x8d547b(0x1d1))try{const _0xab91a7={'ticketData':{'queueId':_0xb63d26[_0x8d547b(0x1b8)],'status':_0x8d547b(0x1de)},'ticketId':_0xc61086['id']};await(0x0,UpdateTicketService_1[_0x8d547b(0x1d9)])({'ticketData':{..._0xab91a7['ticketData']},'ticketId':_0xab91a7[_0x8d547b(0x206)],'companyId':_0xc61086[_0x8d547b(0x1f7)]});}catch(_0x11093f){await(0x0,exports[_0x8d547b(0x200)])(_0x2c123b,_0xb63d26['id'],_0xc61086);}else{if(_0xb63d26['queueType']===_0x8d547b(0x1b5))try{const _0x8b08af={'ticketData':{'queueId':_0xb63d26[_0x8d547b(0x1b8)],'userId':_0xb63d26[_0x8d547b(0x1ad)],'status':_0x8d547b(0x1de)},'ticketId':_0xc61086['id']};await(0x0,UpdateTicketService_1[_0x8d547b(0x1d9)])({'ticketData':{..._0x8b08af[_0x8d547b(0x20a)]},'ticketId':_0x8b08af[_0x8d547b(0x206)],'companyId':_0xc61086[_0x8d547b(0x1f7)]});}catch(_0x318adc){await(0x0,exports['deleteAndCreateDialogStage'])(_0x2c123b,_0xb63d26['id'],_0xc61086);}}}await(0x0,exports[_0x8d547b(0x200)])(_0x2c123b,_0xb63d26['id'],_0xc61086);if(_0xb63d26[_0x8d547b(0x1d2)]==='file')try{const _0x4a66d6=path_1[_0x8d547b(0x1d9)][_0x8d547b(0x20f)](__dirname,'..','..','..','public'),_0x369b0c=await(0x0,ShowService_1[_0x8d547b(0x1d9)])(_0xb63d26[_0x8d547b(0x1ee)],_0xc61086['companyId']),_0x2c429e=path_1[_0x8d547b(0x1d9)][_0x8d547b(0x20f)](_0x4a66d6,'company'+_0xc61086[_0x8d547b(0x1f7)],'fileList',String(_0x369b0c['id']));for(const [_0x9a6e15,_0x1880f9]of _0x369b0c[_0x8d547b(0x1bd)]['entries']()){const _0x5dd867={'fieldname':'medias','originalname':_0x1880f9[_0x8d547b(0x1ca)],'encoding':_0x8d547b(0x1cc),'mimetype':_0x1880f9[_0x8d547b(0x1c4)],'filename':_0x1880f9['path'],'path':path_1[_0x8d547b(0x1d9)][_0x8d547b(0x20f)](_0x2c429e,_0x1880f9[_0x8d547b(0x1ca)])};await(0x0,SendWhatsAppMedia_1[_0x8d547b(0x1d9)])({'media':_0x5dd867,'ticket':_0xc61086,'body':_0x1880f9[_0x8d547b(0x1f6)],'isForwarded':![]});};}catch(_0x5d58e1){await(0x0,exports[_0x8d547b(0x200)])(_0x2c123b,_0xb63d26['id'],_0xc61086);}_0xb63d26[_0x8d547b(0x1fd)]&&await sendMsgAndCloseTicket(_0x23efeb,_0xc61086['contact'],_0xc61086);await(0x0,exports['deleteAndCreateDialogStage'])(_0x2c123b,_0xb63d26['id'],_0xc61086);const _0x35b70d=await sendDialog(_0xb63d26,_0x23efeb,_0x2c123b,_0xc61086);return _0x35b70d;}}};exports[a611_0x501d27(0x1bb)]=sayChatbot;