'use strict';const a569_0x5b4444=a569_0x3423;(function(_0x5029cd,_0x4ac0b3){const _0x401599=a569_0x3423,_0x47fe55=_0x5029cd();while(!![]){try{const _0x3b56d6=-parseInt(_0x401599(0x184))/0x1+-parseInt(_0x401599(0x193))/0x2+parseInt(_0x401599(0x174))/0x3*(parseInt(_0x401599(0x169))/0x4)+-parseInt(_0x401599(0x107))/0x5+-parseInt(_0x401599(0x1a8))/0x6+parseInt(_0x401599(0xd2))/0x7+parseInt(_0x401599(0x1f0))/0x8;if(_0x3b56d6===_0x4ac0b3)break;else _0x47fe55['push'](_0x47fe55['shift']());}catch(_0x20a5f9){_0x47fe55['push'](_0x47fe55['shift']());}}}(a569_0x5a4a,0x7d263));function a569_0x3423(_0x4a833e,_0x28bd56){const _0x5a4a6e=a569_0x5a4a();return a569_0x3423=function(_0x34230f,_0x5a70bd){_0x34230f=_0x34230f-0xd1;let _0x25b27c=_0x5a4a6e[_0x34230f];return _0x25b27c;},a569_0x3423(_0x4a833e,_0x28bd56);}var __createBinding=this&&this['__createBinding']||(Object[a569_0x5b4444(0x163)]?function(_0x33f92a,_0x100318,_0x524932,_0x214cfa){const _0x1d02be=a569_0x5b4444;if(_0x214cfa===undefined)_0x214cfa=_0x524932;var _0x48037b=Object[_0x1d02be(0x19b)](_0x100318,_0x524932);(!_0x48037b||(_0x1d02be(0x153)in _0x48037b?!_0x100318['__esModule']:_0x48037b[_0x1d02be(0xf6)]||_0x48037b[_0x1d02be(0x197)]))&&(_0x48037b={'enumerable':!![],'get':function(){return _0x100318[_0x524932];}}),Object[_0x1d02be(0x1be)](_0x33f92a,_0x214cfa,_0x48037b);}:function(_0x480a3a,_0x58e824,_0x2db3e2,_0x24b859){if(_0x24b859===undefined)_0x24b859=_0x2db3e2;_0x480a3a[_0x24b859]=_0x58e824[_0x2db3e2];}),__setModuleDefault=this&&this[a569_0x5b4444(0x1f6)]||(Object[a569_0x5b4444(0x163)]?function(_0x17deb4,_0x35bb2f){const _0x25f58e=a569_0x5b4444;Object[_0x25f58e(0x1be)](_0x17deb4,_0x25f58e(0x18a),{'enumerable':!![],'value':_0x35bb2f});}:function(_0xd5ab7a,_0x1b952d){const _0xbe95b2=a569_0x5b4444;_0xd5ab7a[_0xbe95b2(0x18a)]=_0x1b952d;}),__importStar=this&&this[a569_0x5b4444(0x1a5)]||function(_0x4e9ac1){const _0x2467bf=a569_0x5b4444;if(_0x4e9ac1&&_0x4e9ac1[_0x2467bf(0x1ae)])return _0x4e9ac1;var _0x473d3c={};if(_0x4e9ac1!=null){for(var _0x64be1a in _0x4e9ac1)if(_0x64be1a!=='default'&&Object[_0x2467bf(0x13f)][_0x2467bf(0x204)][_0x2467bf(0x1f4)](_0x4e9ac1,_0x64be1a))__createBinding(_0x473d3c,_0x4e9ac1,_0x64be1a);}return __setModuleDefault(_0x473d3c,_0x4e9ac1),_0x473d3c;},__importDefault=this&&this[a569_0x5b4444(0x12b)]||function(_0x3dbdcd){const _0x6b5a7=a569_0x5b4444;return _0x3dbdcd&&_0x3dbdcd[_0x6b5a7(0x1ae)]?_0x3dbdcd:{'default':_0x3dbdcd};};function a569_0x5a4a(){const _0x22c873=['./ChatBotListener','../TicketServices/CreateLogTicketService','stickerMessage','isNil','__importStar','text','trim','2364408eyAbdg','outOfHoursMessage','../WhatsappService/ShowWhatsAppService','./MarkDeleteWhatsAppMessage','buttonText','body','__esModule','isValidMsg','getMinutes','delay','stringify','audioMessage','../../models/Ticket','g.us','Latitude:\x20','isNull','listMessage','*\x20-\x20','unlink','../TicketServices/FindOrCreateATicketTrakingService','complationMessage','parameters','defineProperty','split','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','promisify','presenceSubscribe','set','vcard','filename','BEGIN:','application/json','processImportMessagesWppId','contactMessage','join','composing','profilePictureUrl','contentText','../QueueIntegrationServices/CreateSessionDialogflow','‚ÄéEstou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20N√£o','*Assistente\x20Virtual*:\x0aInfelizmente\x20n√£o\x20conseguimos\x20escutar\x20nem\x20enviar\x20√°udios\x20por\x20este\x20canal\x20de\x20atendimento,\x20por\x20favor,\x20envie\x20uma\x20mensagem\x20de\x20*texto*.','readMessages','s.whatsapp.net','maxUseBotQueuesNPS','./SendWhatsAppMessage','includes','queryDialogFlow','Importando\x20Mensagem:\x20','@whiskeysockets/baileys','count','POST','audio/mp4','caption','test','env','encodedAudio','findByPk','locationMessage','Erro\x20ao\x20baixar\x20media','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','isForwarded','moment','quotedMessage','sendPresenceUpdate','../../models/Queue','wbotMessageListener','nps','data:image/png;base64,\x20','lgpd','imageMessage','debounce','listResponseMessage','17252208paNzNW','setExtra','allowGroup','Valida√ß√£o\x20de\x20mensagem\x20de\x20campanha\x20enviada\x20por\x20terceiros:\x20','call','messageContextInfo','__setModuleDefault','lgpdAcceptedAt','../ContactServices/CreateOrUpdateContactService','endConversation','Menu','verifyRating','warn','handleRating','whatsapp','DispatchCampaign','path','reaction','stanzaId','pending','hasOwnProperty','documentWithCaptionMessage','.ogg','image','remoteJid','%2C','./SendWhatsAppMedia','conversation','button','queueId','TIMEOUT_TO_IMPORT_MESSAGE','downloadMediaMessage','mimetype','ticketId','responses','status@broadcast','####\x20Nao\x20achou\x20o\x20type\x20152:\x20','reactionMessage','amountUseBotQueuesNPS','toISOString','data','singleSelectReply','chatbots','description','toString','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','selectedId','toDate','indexOf','quotedMsg','inActivity','keys','2360400TXgKIr','emit','chatbotAt','\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento','degreesLatitude','contact',';;;','delete','buttonsMessage','base64','viewOnceMessage','push','Error\x20getTypeMessage','company','Escolha\x20uma\x20op√ß√£o','resolve','extractMessageContent','closedAt','isNaN','dialogflow','type','queues','acceptAudioMessageContact','scheduleType','../MessageServices/CreateMessageService','isGroup','displayText','title','videoMessage','-ticket','useIntegration','setMinutes','webhook','Mensagem','sections','getMessageOptions','writable','reload','key','update','from','pushName','company-','stringValue','values','participant','messages.upsert','senderKeyDistributionMessage','error','templateButtonReplyMessage','protocolMessage','list','messages','3738720BLqFDG',':unreads','disableBot','../../models/CampaignShipping','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posi√ß√£o\x20na\x20fila\x20de\x20atendimento\x20√©:\x20*','../../libs/socket','Falha\x20ao\x20fazer\x20o\x20download\x20de\x20uma\x20mensagem\x20importada,\x20provavelmente\x20a\x20mensagem\x20j√°\x20n√£o\x20esta\x20mais\x20dispon√≠vel','enabled','ratingMessage','../../models/UserRating','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20getTypeMessage','queue','farewellMessage','getQuotedMessageId',':\x20üìû','../../queues','user','axolotlSenderKeyDistributionMessage','messageStubType','ratingAt','greetingMessage','@c.us','E2E_IDENTITY_CHANGED','whatsappId','queuePosition','../../helpers/addLogs','rows','E2E_DEVICE_CHANGED','extendedTextMessage','\x20|\x20https://maps.google.com/maps?q=','timeUseBotQueues','fromMe','contextInfo','ephemeralMessage','getBodyMessage','__importDefault',':*\x20N√£o\x20consegui\x20entender\x20sua\x20d√∫vida.','status','../QueueIntegrationServices/QueryDialogflow','greetingMediaAttachment','Esta\x20mensagem\x20j√°\x20existe','value','filter','‚ÄéOp√ß√£o\x20inv√°lida,\x20tente\x20novamente.\x0a','&z=17&hl=pt-BR|','replace','getTime','findAll','userId','public','add','open','floor','sayChatbot','language','prototype','subject','paused','contactsArrayMessage','pop','typebot','*System:*\x20\x0aFalha\x20no\x20download\x20da\x20m√≠dia\x20verifique\x20no\x20dispositivo','\x20-\x20Longitude:\x20','recording','jidNormalizedUser','disabled','mkdirSync','../../helpers/Debounce','buttonsResponseMessage','map','lgpdSendMessageAt','debug','forEach','name','logger','get','util','editedMessage','Erro\x20media','messages.update','number','Sair','request','@g.us','getQuotedMessage','projectName','enableLGPD','createDialogflowSessionWithModel','WAMessageStubType','buffer','../../models/User','create','contacts:','maxUseBotQueues','Error\x20handling\x20message\x20ack.\x20Err:\x20','../../utils/logger','ERR_WAPP_DOWNLOAD_MEDIA','4QNWwKJ','verifyMessage','urlN8N','next','selectedRowId','findOne','integrationId','facebook','*[\x20','chatBot','captureException','1629771OQkgYc','voiceMessage','handleMessage','companyId','lodash','queueIntegration','message','getIO','settingsUserRandom','sequelize','destroy','mediaMessage','chatBotType','>>>>>>>>>>>>>>>>>>>','../CompanyService/VerifyCurrentSchedule','Erro\x20ao\x20baixar\x20m√≠dia:','738973sufTtk','imported','campaignId','sendMessage','documentMessage','length','default','selectedButtonId','endsWith','amountUsedBotQueues','substring','jpegThumbnail','../TicketServices/UpdateTicketService','lgpdLink','closed','1287174qrnnhQ','messageTimestamp','sendGreetingMessageOneQueues','contacts','configurable','groupMetadata','lgpdMessage','findAndCountAll','getOwnPropertyDescriptor','.txt','lgpdConsent','viewOnceMessageV2','log','EM_ANDAMENTO'];a569_0x5a4a=function(){return _0x22c873;};return a569_0x5a4a();}Object[a569_0x5b4444(0x1be)](exports,'__esModule',{'value':!![]}),exports['getTypeMessage']=exports['isValidMsg']=exports['handleMessage']=exports[a569_0x5b4444(0x1e9)]=exports[a569_0x5b4444(0x1fd)]=exports[a569_0x5b4444(0x1fb)]=exports[a569_0x5b4444(0x16a)]=exports[a569_0x5b4444(0x115)]=exports[a569_0x5b4444(0x15c)]=exports[a569_0x5b4444(0x12a)]=void 0x0;const path_1=__importStar(require(a569_0x5b4444(0x200))),util_1=require(a569_0x5b4444(0x154)),fs_1=require('fs'),fs_2=__importDefault(require('fs')),Sentry=__importStar(require('@sentry/node')),lodash_1=require(a569_0x5b4444(0x178)),baileys_1=require(a569_0x5b4444(0x1d8)),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require(a569_0x5b4444(0x1b4))),Message_1=__importDefault(require('../../models/Message')),socket_1=require(a569_0x5b4444(0x10d)),CreateMessageService_1=__importDefault(require(a569_0x5b4444(0xea))),logger_1=require(a569_0x5b4444(0x167)),CreateOrUpdateContactService_1=__importDefault(require(a569_0x5b4444(0x1f8))),FindOrCreateTicketService_1=__importDefault(require('../TicketServices/FindOrCreateTicketService')),ShowWhatsAppService_1=__importDefault(require(a569_0x5b4444(0x1aa))),Debounce_1=require(a569_0x5b4444(0x14b)),UpdateTicketService_1=__importDefault(require(a569_0x5b4444(0x190))),Mustache_1=__importDefault(require('../../helpers/Mustache')),UserRating_1=__importDefault(require(a569_0x5b4444(0x111))),SendWhatsAppMessage_1=__importDefault(require(a569_0x5b4444(0x1d4))),sendFacebookMessage_1=__importDefault(require('../FacebookServices/sendFacebookMessage')),moment_1=__importDefault(require(a569_0x5b4444(0x1e5))),Queue_1=__importDefault(require(a569_0x5b4444(0x1e8))),FindOrCreateATicketTrakingService_1=__importDefault(require(a569_0x5b4444(0x1bb))),VerifyCurrentSchedule_1=__importDefault(require(a569_0x5b4444(0x182))),Campaign_1=__importDefault(require('../../models/Campaign')),CampaignShipping_1=__importDefault(require(a569_0x5b4444(0x10a))),sequelize_1=require(a569_0x5b4444(0x17d)),queues_1=require(a569_0x5b4444(0x117)),User_1=__importDefault(require(a569_0x5b4444(0x162))),ChatBotListener_1=require(a569_0x5b4444(0x1a1)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a569_0x5b4444(0x1ab))),ListUserQueueServices_1=__importDefault(require('../UserQueueServices/ListUserQueueServices')),cache_1=__importDefault(require('../../libs/cache')),addLogs_1=require(a569_0x5b4444(0x121)),SendWhatsAppMedia_1=require(a569_0x5b4444(0x20a)),ShowQueueIntegrationService_1=__importDefault(require('../QueueIntegrationServices/ShowQueueIntegrationService')),CreateSessionDialogflow_1=require(a569_0x5b4444(0x1ce)),QueryDialogflow_1=require(a569_0x5b4444(0x12e)),CompaniesSettings_1=__importDefault(require('../../models/CompaniesSettings')),CreateLogTicketService_1=__importDefault(require(a569_0x5b4444(0x1a2))),request=require(a569_0x5b4444(0x15a));let i=0x0;setInterval(()=>{i=0x0;},0x1388);const writeFileAsync=(0x0,util_1[a569_0x5b4444(0x1c1)])(fs_1['writeFile']);function removeFile(_0x116c44){const _0x1f8eed=a569_0x5b4444;fs_2[_0x1f8eed(0x18a)][_0x1f8eed(0x1ba)](_0x116c44,_0x184de4=>{if(_0x184de4)throw _0x184de4;});}const getTimestampMessage=_0x33e4be=>{return _0x33e4be*0x1;},multVecardGet=function(_0x1bea38){const _0x2d18c1=a569_0x5b4444;let _0x322772='\x20',_0x339858=_0x1bea38['split']('\x0a')[0x2][_0x2d18c1(0x135)](_0x2d18c1(0xd8),'\x0a')[_0x2d18c1(0x135)]('N:','')[_0x2d18c1(0x135)](';','')[_0x2d18c1(0x135)](';','\x20')[_0x2d18c1(0x135)](';;','\x20')[_0x2d18c1(0x135)]('\x0a',''),_0x46b2b7=_0x1bea38['split']('\x0a')[0x4][_0x2d18c1(0x220)]('='),_0x541d63=_0x1bea38['split']('\x0a')[0x4]['indexOf'](':'),_0x43a997=_0x1bea38['split']('\x0a')[0x4][_0x2d18c1(0x18e)](_0x46b2b7+0x1,_0x541d63)[_0x2d18c1(0x135)](';',''),_0x3808ea=_0x1bea38[_0x2d18c1(0x1bf)]('\x0a')[0x4][_0x2d18c1(0x135)]('item1.TEL:','');if(_0x43a997!='item1.TEL')_0x322772=_0x322772+_0x339858+_0x2d18c1(0x116)+_0x43a997+''+'\x0a';else _0x322772=_0x322772+_0x339858+':\x20üìû'+_0x3808ea+''+'\x0a';return _0x322772;},contactsArrayMessageGet=_0x775721=>{const _0x4ded57=a569_0x5b4444;let _0x223952=_0x775721[_0x4ded57(0x17a)]?.['contactsArrayMessage']?.[_0x4ded57(0x196)],_0x151d02=_0x223952[_0x4ded57(0x14d)](function(_0x2875f9,_0x28c3d3){const _0x31ff46=_0x4ded57;return _0x2875f9[_0x31ff46(0x1c4)];}),_0x4b63c6='';_0x151d02['forEach'](function(_0x464818,_0x58fe1a){_0x4b63c6+=_0x464818+'\x0a\x0a'+'';});let _0x38c322=_0x4b63c6[_0x4ded57(0x1bf)](_0x4ded57(0x1c6));_0x38c322['shift']();let _0x18d7c0='';for(let _0x4a5ae9 of _0x38c322){_0x18d7c0=_0x18d7c0+multVecardGet(_0x4a5ae9);}return _0x18d7c0;},getTypeMessage=_0x1fea96=>{const _0x41f11c=a569_0x5b4444,_0xf168d2=(0x0,baileys_1['getContentType'])(_0x1fea96[_0x41f11c(0x17a)]);if(_0x1fea96[_0x41f11c(0x17a)]?.[_0x41f11c(0x19e)])return _0x41f11c(0x19e);return _0xf168d2;};exports['getTypeMessage']=getTypeMessage;const getBodyButton=_0x2fc3dd=>{const _0x50e540=a569_0x5b4444;if(_0x2fc3dd[_0x50e540(0xf8)][_0x50e540(0x127)]&&_0x2fc3dd['message'][_0x50e540(0xda)]?.[_0x50e540(0x1cd)]){let _0x45111b=''+_0x2fc3dd?.[_0x50e540(0x17a)]?.[_0x50e540(0xda)]?.['contentText'];for(const _0x2ba995 of _0x2fc3dd[_0x50e540(0x17a)]?.[_0x50e540(0xda)]?.['buttons']){_0x45111b+='\x0a\x0a'+_0x2ba995[_0x50e540(0x1ac)]?.[_0x50e540(0xec)];}return _0x45111b;}if(_0x2fc3dd['key'][_0x50e540(0x127)]&&_0x2fc3dd?.[_0x50e540(0x17a)]?.[_0x50e540(0xdc)]?.[_0x50e540(0x17a)]?.[_0x50e540(0x1b8)]){let _0x2c9b33=''+_0x2fc3dd?.[_0x50e540(0x17a)]?.[_0x50e540(0xdc)]?.[_0x50e540(0x17a)]?.[_0x50e540(0x1b8)]?.[_0x50e540(0x21b)];for(const _0x130a05 of _0x2fc3dd['message']?.[_0x50e540(0xdc)]?.[_0x50e540(0x17a)]?.[_0x50e540(0x1b8)]?.[_0x50e540(0xf4)]){for(const _0x17d150 of _0x130a05['rows']){_0x2c9b33+='\x0a\x0a'+_0x17d150[_0x50e540(0xed)];}}return _0x2c9b33;}},getBodyList=_0x1d6d11=>{const _0x134704=a569_0x5b4444;if(_0x1d6d11[_0x134704(0xf8)][_0x134704(0x127)]&&_0x1d6d11['message'][_0x134704(0x1b8)]?.[_0x134704(0x21b)]){let _0x25a32e=''+_0x1d6d11[_0x134704(0x17a)]['listMessage']?.[_0x134704(0x21b)];for(const _0x182cc9 of _0x1d6d11['message'][_0x134704(0x1b8)]?.[_0x134704(0xf4)]){for(const _0x3d9abb of _0x182cc9[_0x134704(0x122)]){_0x25a32e+='\x0a\x0a'+_0x3d9abb[_0x134704(0xed)];}}return _0x25a32e;}if(_0x1d6d11[_0x134704(0xf8)][_0x134704(0x127)]&&_0x1d6d11?.[_0x134704(0x17a)]?.[_0x134704(0xdc)]?.[_0x134704(0x17a)]?.[_0x134704(0x1b8)]){let _0x162663=''+_0x1d6d11?.['message']?.['viewOnceMessage']?.[_0x134704(0x17a)]?.['listMessage']?.[_0x134704(0x21b)];for(const _0x4ef62d of _0x1d6d11['message']?.[_0x134704(0xdc)]?.[_0x134704(0x17a)]?.[_0x134704(0x1b8)]?.['sections']){for(const _0x3d3b28 of _0x4ef62d[_0x134704(0x122)]){_0x162663+='\x0a\x0a'+_0x3d3b28[_0x134704(0xed)];}}return _0x162663;}},msgLocation=(_0x2b69a6,_0xf3bcdd,_0x26e530)=>{const _0x1de508=a569_0x5b4444;if(_0x2b69a6){var _0x518c9d=Buffer[_0x1de508(0xfa)](_0x2b69a6)[_0x1de508(0x21c)]('base64');let _0xd8c2d5=_0x1de508(0x1eb)+_0x518c9d+_0x1de508(0x125)+_0xf3bcdd+_0x1de508(0x209)+_0x26e530+_0x1de508(0x134)+_0xf3bcdd+',\x20'+_0x26e530+'\x20';return _0xd8c2d5;}},getBodyMessage=_0x2ae7da=>{const _0x1c25d1=a569_0x5b4444;try{let _0x240966=getTypeMessage(_0x2ae7da);const _0x250d49={'conversation':_0x2ae7da[_0x1c25d1(0x17a)]?.['conversation'],'imageMessage':_0x2ae7da[_0x1c25d1(0x17a)]?.['imageMessage']?.[_0x1c25d1(0x1dc)],'videoMessage':_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0xee)]?.['caption'],'extendedTextMessage':_0x2ae7da?.[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x124)]?.[_0x1c25d1(0x1a6)],'buttonsResponseMessage':_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x14c)]?.['selectedDisplayText'],'listResponseMessage':_0x2ae7da['message']?.['listResponseMessage']?.['title']||_0x2ae7da['message']?.[_0x1c25d1(0x1ef)]?.[_0x1c25d1(0x219)]?.[_0x1c25d1(0x16d)],'templateButtonReplyMessage':_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x103)]?.[_0x1c25d1(0x21e)],'messageContextInfo':_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x14c)]?.[_0x1c25d1(0x18b)]||_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x1ef)]?.[_0x1c25d1(0xed)],'buttonsMessage':getBodyButton(_0x2ae7da)||_0x2ae7da['message']?.['listResponseMessage']?.['title'],'stickerMessage':'sticker','contactMessage':_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x1c9)]?.[_0x1c25d1(0x1c4)],'contactsArrayMessage':_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x142)]?.[_0x1c25d1(0x196)]&&contactsArrayMessageGet(_0x2ae7da),'locationMessage':msgLocation(_0x2ae7da['message']?.[_0x1c25d1(0x1e1)]?.[_0x1c25d1(0x18f)],_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x1e1)]?.[_0x1c25d1(0xd6)],_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x1e1)]?.['degreesLongitude']),'liveLocationMessage':_0x1c25d1(0x1b6)+_0x2ae7da['message']?.['liveLocationMessage']?.['degreesLatitude']+_0x1c25d1(0x146)+_0x2ae7da[_0x1c25d1(0x17a)]?.['liveLocationMessage']?.['degreesLongitude'],'documentMessage':_0x2ae7da['message']?.[_0x1c25d1(0x188)]?.['title'],'audioMessage':'√Åudio','listMessage':getBodyList(_0x2ae7da)||_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x1ef)]?.['title'],'viewOnceMessage':getBodyButton(_0x2ae7da),'reactionMessage':_0x2ae7da[_0x1c25d1(0x17a)]?.['reactionMessage']?.[_0x1c25d1(0x1a6)]||_0x1c25d1(0x201),'senderKeyDistributionMessage':_0x2ae7da?.['message']?.[_0x1c25d1(0x101)]?.[_0x1c25d1(0x119)],'documentWithCaptionMessage':_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x205)]?.['message']?.[_0x1c25d1(0x188)]?.[_0x1c25d1(0x1dc)],'viewOnceMessageV2':_0x2ae7da[_0x1c25d1(0x17a)]?.['viewOnceMessageV2']?.[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x1ed)]?.[_0x1c25d1(0x1dc)],'editedMessage':_0x2ae7da[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x155)]?.[_0x1c25d1(0x17a)]?.[_0x1c25d1(0x124)]?.[_0x1c25d1(0x1a6)],'ephemeralMessage':_0x2ae7da[_0x1c25d1(0x17a)]?.['ephemeralMessage']?.[_0x1c25d1(0x17a)]?.['extendedTextMessage']?.[_0x1c25d1(0x1a6)]},_0x3d8547=Object[_0x1c25d1(0xd1)](_0x250d49)['find'](_0x48d531=>_0x48d531===_0x240966);return!_0x3d8547&&(logger_1[_0x1c25d1(0x152)]['warn'](_0x1c25d1(0x214)+_0x240966+'\x0a'+JSON[_0x1c25d1(0x1b2)](_0x2ae7da)),Sentry[_0x1c25d1(0x1f1)](_0x1c25d1(0xf3),{'BodyMsg':_0x2ae7da[_0x1c25d1(0x17a)],'msg':_0x2ae7da,'type':_0x240966}),Sentry[_0x1c25d1(0x173)](new Error(_0x1c25d1(0x112)))),_0x250d49[_0x240966];}catch(_0x41d035){Sentry[_0x1c25d1(0x1f1)](_0x1c25d1(0xde),{'msg':_0x2ae7da,'BodyMsg':_0x2ae7da['message']}),Sentry[_0x1c25d1(0x173)](_0x41d035),console[_0x1c25d1(0x19f)](_0x41d035);}};exports[a569_0x5b4444(0x12a)]=getBodyMessage;const getQuotedMessage=_0x197f90=>{const _0x1c87b9=a569_0x5b4444,_0x3a6c0c=(0x0,baileys_1[_0x1c87b9(0xe2)])(_0x197f90[_0x1c87b9(0x17a)])[Object[_0x1c87b9(0xd1)](_0x197f90?.[_0x1c87b9(0x17a)])[_0x1c87b9(0xfe)]()[_0x1c87b9(0x16c)]()[_0x1c87b9(0x131)]];if(!_0x3a6c0c?.[_0x1c87b9(0x128)]?.[_0x1c87b9(0x1e6)])return;const _0x2766c4=(0x0,baileys_1[_0x1c87b9(0xe2)])(_0x3a6c0c?.[_0x1c87b9(0x128)]?.[_0x1c87b9(0x1e6)][Object[_0x1c87b9(0xd1)](_0x3a6c0c?.[_0x1c87b9(0x128)]?.['quotedMessage'])['values']()['next']()[_0x1c87b9(0x131)]]);return _0x2766c4;};exports[a569_0x5b4444(0x15c)]=getQuotedMessage;const getQuotedMessageId=_0x3eeaa2=>{const _0xa87907=a569_0x5b4444,_0x3eb10d=(0x0,baileys_1['extractMessageContent'])(_0x3eeaa2[_0xa87907(0x17a)])[Object[_0xa87907(0xd1)](_0x3eeaa2?.['message'])['values']()[_0xa87907(0x16c)]()[_0xa87907(0x131)]];let _0x43f64e=_0x3eeaa2?.[_0xa87907(0x17a)]?.[_0xa87907(0x215)]?_0x3eeaa2?.[_0xa87907(0x17a)]?.[_0xa87907(0x215)]?.['key']?.['id']:'';return _0x43f64e?_0x43f64e:_0x3eb10d?.[_0xa87907(0x128)]?.[_0xa87907(0x202)];};exports[a569_0x5b4444(0x115)]=getQuotedMessageId;const getMeSocket=_0x2466e0=>{const _0x5ebc6c=a569_0x5b4444;return{'id':(0x0,baileys_1['jidNormalizedUser'])(_0x2466e0[_0x5ebc6c(0x118)]['id']),'name':_0x2466e0[_0x5ebc6c(0x118)][_0x5ebc6c(0x151)]};},getSenderMessage=(_0x55c013,_0xc44285)=>{const _0x94d0ef=a569_0x5b4444,_0x3e6156=getMeSocket(_0xc44285);if(_0x55c013[_0x94d0ef(0xf8)][_0x94d0ef(0x127)])return _0x3e6156['id'];const _0x58a335=_0x55c013[_0x94d0ef(0xff)]||_0x55c013[_0x94d0ef(0xf8)]['participant']||_0x55c013[_0x94d0ef(0xf8)][_0x94d0ef(0x208)]||undefined;return _0x58a335&&(0x0,baileys_1[_0x94d0ef(0x148)])(_0x58a335);},getContactMessage=async(_0x1fbb09,_0x171118)=>{const _0x36d55b=a569_0x5b4444,_0x2e7196=_0x1fbb09[_0x36d55b(0xf8)][_0x36d55b(0x208)]['includes']('g.us'),_0x114c4e=_0x1fbb09[_0x36d55b(0xf8)][_0x36d55b(0x208)]['replace'](/\D/g,'');return _0x2e7196?{'id':getSenderMessage(_0x1fbb09,_0x171118),'name':_0x1fbb09[_0x36d55b(0xfb)]}:{'id':_0x1fbb09[_0x36d55b(0xf8)][_0x36d55b(0x208)],'name':_0x1fbb09[_0x36d55b(0xf8)][_0x36d55b(0x127)]?_0x114c4e:_0x1fbb09[_0x36d55b(0xfb)]};},downloadMedia=async(_0x965344,_0x54ded3=null)=>{const _0x536c82=a569_0x5b4444;let _0x33dc28;try{_0x33dc28=await(0x0,baileys_1[_0x536c82(0x20f)])(_0x965344,_0x536c82(0x161),{});}catch(_0x1d2c86){_0x54ded3?console[_0x536c82(0x19f)](_0x536c82(0x10e)):console[_0x536c82(0x102)](_0x536c82(0x183),_0x1d2c86);}let _0x5dcee4=_0x965344[_0x536c82(0x17a)]?.['documentMessage']?.['fileName']||'';const _0x55c0bd=_0x965344[_0x536c82(0x17a)]?.[_0x536c82(0x1ed)]||_0x965344['message']?.[_0x536c82(0x1b3)]||_0x965344[_0x536c82(0x17a)]?.[_0x536c82(0xee)]||_0x965344['message']?.[_0x536c82(0x1a3)]||_0x965344[_0x536c82(0x17a)]?.[_0x536c82(0x188)]||_0x965344[_0x536c82(0x17a)]?.[_0x536c82(0x205)]?.[_0x536c82(0x17a)]?.['documentMessage']||_0x965344[_0x536c82(0x17a)]?.['extendedTextMessage']?.[_0x536c82(0x128)]?.['quotedMessage']?.[_0x536c82(0x1ed)]||_0x965344[_0x536c82(0x17a)]?.['extendedTextMessage']?.[_0x536c82(0x128)]?.[_0x536c82(0x1e6)]?.[_0x536c82(0xee)];if(!_0x55c0bd)console[_0x536c82(0x19f)](_0x965344);if(!_0x5dcee4){const _0x587081=_0x55c0bd[_0x536c82(0x210)][_0x536c82(0x1bf)]('/')[0x1][_0x536c82(0x1bf)](';')[0x0];_0x5dcee4=new Date()['getTime']()+'.'+_0x587081;}else _0x5dcee4=new Date()[_0x536c82(0x136)]()+'_'+_0x5dcee4;const _0x2afea5={'data':_0x33dc28,'mimetype':_0x55c0bd[_0x536c82(0x210)],'filename':_0x5dcee4};return _0x2afea5;},verifyContact=async(_0x33dcf4,_0x283978,_0x13621b)=>{const _0x102742=a569_0x5b4444;let _0xf11e97;try{_0xf11e97=await _0x283978[_0x102742(0x1cc)](_0x33dcf4['id'],_0x102742(0x207));}catch(_0x5c4585){Sentry[_0x102742(0x173)](_0x5c4585),_0xf11e97=process[_0x102742(0x1de)]['FRONTEND_URL']+'/nopicture.png';}const _0x1e92d8={'name':_0x33dcf4['name']||_0x33dcf4['id'][_0x102742(0x135)](/\D/g,''),'number':_0x33dcf4['id'][_0x102742(0x135)](/\D/g,''),'profilePicUrl':_0xf11e97,'isGroup':_0x33dcf4['id']['includes'](_0x102742(0x1b5)),'companyId':_0x13621b,'remoteJid':_0x33dcf4['id']};_0x1e92d8[_0x102742(0xeb)]&&(_0x1e92d8[_0x102742(0x158)]=_0x33dcf4['id'][_0x102742(0x135)](_0x102742(0x15b),''));const _0x53ff43=(0x0,CreateOrUpdateContactService_1['default'])(_0x1e92d8);return _0x53ff43;},verifyQuotedMessage=async _0x562e3a=>{const _0x23f3a0=a569_0x5b4444;if(!_0x562e3a)return null;const _0x21b92c=(0x0,exports['getQuotedMessageId'])(_0x562e3a);if(!_0x21b92c)return null;const _0x355e5b=await Message_1[_0x23f3a0(0x18a)][_0x23f3a0(0x16e)]({'where':{'wid':_0x21b92c}});if(!_0x355e5b)return null;return _0x355e5b;},verifyMediaMessage=async(_0xe0392e,_0x21e6e6,_0x1f0b5e,_0x3d3519,_0x26e1aa)=>{const _0xa4b010=a569_0x5b4444,_0x1a71b4=(0x0,socket_1[_0xa4b010(0x17b)])(),_0x29dff4=await verifyQuotedMessage(_0xe0392e);try{const _0x2d92d4=await downloadMedia(_0xe0392e,_0x21e6e6?.['imported']);if(!_0x2d92d4&&_0x21e6e6[_0xa4b010(0x185)]){const _0x26d832=_0xa4b010(0x145),_0x4e96c1={'wid':_0xe0392e[_0xa4b010(0xf8)]['id'],'ticketId':_0x21e6e6['id'],'contactId':_0xe0392e[_0xa4b010(0xf8)]['fromMe']?undefined:_0x21e6e6['contactId'],'body':_0x26d832,'reactionMessage':_0xe0392e['message']?.['reactionMessage'],'fromMe':_0xe0392e[_0xa4b010(0xf8)][_0xa4b010(0x127)],'mediaType':getTypeMessage(_0xe0392e),'read':_0xe0392e[_0xa4b010(0xf8)][_0xa4b010(0x127)],'quotedMsgId':_0x29dff4?.['id']||_0xe0392e[_0xa4b010(0x17a)]?.[_0xa4b010(0x215)]?.['key']?.['id'],'ack':_0xe0392e[_0xa4b010(0x12d)],'companyId':_0x21e6e6[_0xa4b010(0x177)],'remoteJid':_0xe0392e[_0xa4b010(0xf8)]['remoteJid'],'participant':_0xe0392e[_0xa4b010(0xf8)][_0xa4b010(0xff)],'timestamp':getTimestampMessage(_0xe0392e['messageTimestamp']),'createdAt':new Date(Math[_0xa4b010(0x13c)](getTimestampMessage(_0xe0392e[_0xa4b010(0x194)])*0x3e8))[_0xa4b010(0x217)](),'dataJson':JSON['stringify'](_0xe0392e),'ticketImported':_0x21e6e6[_0xa4b010(0x185)],'isForwarded':_0x26e1aa};return await _0x21e6e6[_0xa4b010(0xf9)]({'lastMessage':_0x26d832}),logger_1[_0xa4b010(0x152)][_0xa4b010(0x102)](Error(_0xa4b010(0x168))),(0x0,CreateMessageService_1['default'])({'messageData':_0x4e96c1,'companyId':_0x21e6e6[_0xa4b010(0x177)]});}if(!_0x2d92d4)throw new Error(_0xa4b010(0x168));if(!_0x2d92d4['filename']||_0x2d92d4[_0xa4b010(0x210)]===_0xa4b010(0x1db)){const _0x2c9996=_0x2d92d4['mimetype']==='audio/mp4'?'m4a':_0x2d92d4['mimetype'][_0xa4b010(0x1bf)]('/')[0x1][_0xa4b010(0x1bf)](';')[0x0];_0x2d92d4[_0xa4b010(0x1c5)]=new Date()['getTime']()+'.'+_0x2c9996;}else{const _0x5b639a=_0x2d92d4[_0xa4b010(0x1c5)][_0xa4b010(0x1bf)]('.')[_0xa4b010(0x143)](),_0xb89ae4=_0x2d92d4[_0xa4b010(0x1c5)]['split']('.')['slice'](0x0,-0x1)[_0xa4b010(0x1ca)]('.')['replace'](/\s/g,'_')['normalize']('NFD')[_0xa4b010(0x135)](/[\u0300-\u036f]/g,'');_0x2d92d4[_0xa4b010(0x1c5)]=_0xb89ae4[_0xa4b010(0x1a7)]()+'_'+new Date()[_0xa4b010(0x136)]()+'.'+_0x5b639a;}try{const _0x5e1db3=path_1['default'][_0xa4b010(0xe1)](__dirname,'..','..','..',_0xa4b010(0x139),'company'+_0x21e6e6[_0xa4b010(0x177)]);!fs_2[_0xa4b010(0x18a)]['existsSync'](_0x5e1db3)&&(fs_2[_0xa4b010(0x18a)][_0xa4b010(0x14a)](_0x5e1db3,{'recursive':!![]}),fs_2['default']['chmodSync'](_0x5e1db3,0x1ff)),await writeFileAsync((0x0,path_1[_0xa4b010(0x1ca)])(_0x5e1db3,_0x2d92d4['filename']),_0x2d92d4[_0xa4b010(0x218)][_0xa4b010(0x21c)]('base64'),_0xa4b010(0xdb));}catch(_0x4485b3){Sentry[_0xa4b010(0x1f1)](_0xa4b010(0x156),{'companyId':_0x21e6e6[_0xa4b010(0x177)],'ticket':_0x21e6e6,'contact':_0x1f0b5e,'media':_0x2d92d4,'quotedMsg':_0x29dff4}),Sentry['captureException'](_0x4485b3),logger_1[_0xa4b010(0x152)][_0xa4b010(0x102)](_0x4485b3),console[_0xa4b010(0x19f)](_0xe0392e);}const _0x12d250=(0x0,exports[_0xa4b010(0x12a)])(_0xe0392e),_0x43b486={'wid':_0xe0392e['key']['id'],'ticketId':_0x21e6e6['id'],'contactId':_0xe0392e[_0xa4b010(0xf8)][_0xa4b010(0x127)]?undefined:_0x1f0b5e['id'],'body':_0x12d250||_0x2d92d4[_0xa4b010(0x1c5)],'fromMe':_0xe0392e[_0xa4b010(0xf8)]['fromMe'],'read':_0xe0392e[_0xa4b010(0xf8)][_0xa4b010(0x127)],'mediaUrl':_0x2d92d4[_0xa4b010(0x1c5)],'mediaType':_0x2d92d4[_0xa4b010(0x210)][_0xa4b010(0x1bf)]('/')[0x0],'quotedMsgId':_0x29dff4?.['id'],'ack':_0xe0392e[_0xa4b010(0x12d)],'remoteJid':_0xe0392e[_0xa4b010(0xf8)][_0xa4b010(0x208)],'participant':_0xe0392e[_0xa4b010(0xf8)][_0xa4b010(0xff)],'dataJson':JSON[_0xa4b010(0x1b2)](_0xe0392e),'ticketTrakingId':_0x3d3519?.['id'],'createdAt':new Date(Math[_0xa4b010(0x13c)](getTimestampMessage(_0xe0392e[_0xa4b010(0x194)])*0x3e8))[_0xa4b010(0x217)](),'ticketImported':_0x21e6e6[_0xa4b010(0x185)],'isForwarded':_0x26e1aa};await _0x21e6e6['update']({'lastMessage':_0x12d250||_0x2d92d4[_0xa4b010(0x1c5)]});const _0xe4fc5e=await(0x0,CreateMessageService_1[_0xa4b010(0x18a)])({'messageData':_0x43b486,'companyId':_0x21e6e6[_0xa4b010(0x177)]});return!_0xe0392e[_0xa4b010(0xf8)]['fromMe']&&_0x21e6e6[_0xa4b010(0x12d)]===_0xa4b010(0x192)&&(await _0x21e6e6['update']({'status':'pending'}),await _0x21e6e6[_0xa4b010(0xf7)]({'include':[{'model':Queue_1[_0xa4b010(0x18a)],'as':_0xa4b010(0x113)},{'model':User_1[_0xa4b010(0x18a)],'as':_0xa4b010(0x118)},{'model':Contact_1[_0xa4b010(0x18a)],'as':'contact'}]}),_0x1a71b4['to'](_0xa4b010(0x192))[_0xa4b010(0xd3)]('company-'+_0x21e6e6['companyId']+_0xa4b010(0xef),{'action':'delete','ticket':_0x21e6e6,'ticketId':_0x21e6e6['id']}),_0x1a71b4['to'](_0x21e6e6[_0xa4b010(0x12d)])['to'](_0x21e6e6['id'][_0xa4b010(0x21c)]())[_0xa4b010(0xd3)](_0xa4b010(0xfc)+_0x21e6e6['companyId']+'-ticket',{'action':_0xa4b010(0xf9),'ticket':_0x21e6e6,'ticketId':_0x21e6e6['id']})),_0xe4fc5e;}catch(_0xf44fab){console['log'](_0xf44fab),logger_1[_0xa4b010(0x152)][_0xa4b010(0x1fc)](_0xa4b010(0x1e2));}},verifyMessage=async(_0x462a82,_0x4428c8,_0x354a70,_0x3b9e99,_0x318874,_0x54d29e)=>{const _0x4d1a21=a569_0x5b4444,_0x557892=(0x0,socket_1[_0x4d1a21(0x17b)])(),_0x326419=await verifyQuotedMessage(_0x462a82),_0x4583a2=(0x0,exports[_0x4d1a21(0x12a)])(_0x462a82),_0x43d725={'wid':_0x462a82['key']['id'],'ticketId':_0x4428c8['id'],'contactId':_0x462a82[_0x4d1a21(0xf8)][_0x4d1a21(0x127)]?undefined:_0x354a70['id'],'body':_0x4583a2,'fromMe':_0x462a82[_0x4d1a21(0xf8)][_0x4d1a21(0x127)],'mediaType':getTypeMessage(_0x462a82),'read':_0x462a82['key']['fromMe'],'quotedMsgId':_0x326419?.['id'],'ack':_0x462a82[_0x4d1a21(0x12d)],'remoteJid':_0x462a82[_0x4d1a21(0xf8)][_0x4d1a21(0x208)],'participant':_0x462a82[_0x4d1a21(0xf8)]['participant'],'dataJson':JSON['stringify'](_0x462a82),'ticketTrakingId':_0x3b9e99?.['id'],'isPrivate':_0x318874,'createdAt':new Date(Math[_0x4d1a21(0x13c)](getTimestampMessage(_0x462a82[_0x4d1a21(0x194)])*0x3e8))[_0x4d1a21(0x217)](),'ticketImported':_0x4428c8[_0x4d1a21(0x185)],'isForwarded':_0x54d29e};await _0x4428c8[_0x4d1a21(0xf9)]({'lastMessage':_0x4583a2}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x43d725,'companyId':_0x4428c8['companyId']}),!_0x462a82[_0x4d1a21(0xf8)][_0x4d1a21(0x127)]&&_0x4428c8[_0x4d1a21(0x12d)]==='closed'&&(await _0x4428c8[_0x4d1a21(0xf9)]({'status':'pending'}),await _0x4428c8['reload']({'include':[{'model':Queue_1[_0x4d1a21(0x18a)],'as':_0x4d1a21(0x113)},{'model':User_1[_0x4d1a21(0x18a)],'as':'user'},{'model':Contact_1[_0x4d1a21(0x18a)],'as':_0x4d1a21(0xd7)}]}),_0x557892['to'](_0x4d1a21(0x192))[_0x4d1a21(0xd3)](_0x4d1a21(0xfc)+_0x4428c8[_0x4d1a21(0x177)]+_0x4d1a21(0xef),{'action':_0x4d1a21(0xd9),'ticket':_0x4428c8,'ticketId':_0x4428c8['id']}),!_0x4428c8[_0x4d1a21(0x185)]&&_0x557892['to'](_0x4428c8[_0x4d1a21(0x12d)])['to'](_0x4428c8['id'][_0x4d1a21(0x21c)]())['emit'](_0x4d1a21(0xfc)+_0x4428c8['companyId']+'-ticket',{'action':'update','ticket':_0x4428c8,'ticketId':_0x4428c8['id']}));};exports[a569_0x5b4444(0x16a)]=verifyMessage;const isValidMsg=_0x85cb92=>{const _0x32dea7=a569_0x5b4444;if(_0x85cb92[_0x32dea7(0xf8)]['remoteJid']===_0x32dea7(0x213))return![];try{const _0xb04a36=getTypeMessage(_0x85cb92);if(!_0xb04a36)return;const _0x42c9b6=_0xb04a36===_0x32dea7(0x20b)||_0xb04a36===_0x32dea7(0x124)||_0xb04a36===_0x32dea7(0x1b3)||_0xb04a36==='videoMessage'||_0xb04a36===_0x32dea7(0x1ed)||_0xb04a36===_0x32dea7(0x188)||_0xb04a36==='stickerMessage'||_0xb04a36===_0x32dea7(0x14c)||_0xb04a36===_0x32dea7(0xda)||_0xb04a36===_0x32dea7(0x1f5)||_0xb04a36===_0x32dea7(0x1e1)||_0xb04a36==='liveLocationMessage'||_0xb04a36===_0x32dea7(0x1c9)||_0xb04a36===_0x32dea7(0x175)||_0xb04a36===_0x32dea7(0x17f)||_0xb04a36===_0x32dea7(0x142)||_0xb04a36===_0x32dea7(0x215)||_0xb04a36===_0x32dea7(0x129)||_0xb04a36===_0x32dea7(0x104)||_0xb04a36===_0x32dea7(0x1ef)||_0xb04a36===_0x32dea7(0x1b8)||_0xb04a36==='viewOnceMessage'||_0xb04a36===_0x32dea7(0x205)||_0xb04a36==='viewOnceMessageV2'||_0xb04a36===_0x32dea7(0x155);return!_0x42c9b6&&(logger_1[_0x32dea7(0x152)][_0x32dea7(0x1fc)](_0x32dea7(0x1c0)+_0xb04a36+'\x0a'+JSON['stringify'](_0x85cb92?.[_0x32dea7(0x17a)])),Sentry['setExtra'](_0x32dea7(0xf3),{'BodyMsg':_0x85cb92[_0x32dea7(0x17a)],'msg':_0x85cb92,'msgType':_0xb04a36}),Sentry[_0x32dea7(0x173)](new Error(_0x32dea7(0x21d)))),!!_0x42c9b6;}catch(_0x4fedad){Sentry[_0x32dea7(0x1f1)]('Error\x20isValidMsg',{'msg':_0x85cb92}),Sentry['captureException'](_0x4fedad);}};exports[a569_0x5b4444(0x1af)]=isValidMsg;const sendDialogflowAwswer=async(_0x41f170,_0x1e4a3a,_0x2e7e51,_0x4ab64a,_0x8c9737)=>{const _0x2f8b02=a569_0x5b4444,_0x42f2db=await(0x0,ShowQueueIntegrationService_1[_0x2f8b02(0x18a)])(_0x1e4a3a[_0x2f8b02(0x16f)],_0x1e4a3a[_0x2f8b02(0x177)]),_0x5278f6=await(0x0,CreateSessionDialogflow_1[_0x2f8b02(0x15f)])(_0x42f2db);if(_0x5278f6===undefined)return;_0x41f170[_0x2f8b02(0x1c2)](_0x4ab64a['remoteJid']),await(0x0,baileys_1[_0x2f8b02(0x1b1)])(0x1f4);let _0x3ce9fa=await(0x0,QueryDialogflow_1[_0x2f8b02(0x1d6)])(_0x5278f6,_0x42f2db[_0x2f8b02(0x15d)],_0x4ab64a['remoteJid'],(0x0,exports[_0x2f8b02(0x12a)])(_0x2e7e51),_0x42f2db[_0x2f8b02(0x13e)],_0x8c9737);if(!_0x3ce9fa){_0x41f170[_0x2f8b02(0x1e7)](_0x2f8b02(0x1cb),_0x4ab64a[_0x2f8b02(0x208)]);const _0x35197a=(0x0,Mustache_1[_0x2f8b02(0x18a)])('‚Äé\x20*'+_0x1e4a3a?.[_0x2f8b02(0x179)]?.['name']+_0x2f8b02(0x12c));await(0x0,baileys_1[_0x2f8b02(0x1b1)])(0x3e8),await _0x41f170[_0x2f8b02(0x1e7)](_0x2f8b02(0x141),_0x4ab64a[_0x2f8b02(0x208)]);const _0x3b0068=await _0x41f170[_0x2f8b02(0x187)](_0x4ab64a[_0x2f8b02(0x158)]+'@c.us',{'text':_0x35197a});await(0x0,exports[_0x2f8b02(0x16a)])(_0x3b0068,_0x1e4a3a,_0x4ab64a);return;}_0x3ce9fa[_0x2f8b02(0x1f9)]&&await _0x1e4a3a[_0x2f8b02(0xf9)]({'contactId':_0x1e4a3a['contact']['id'][_0x2f8b02(0x21c)](),'useIntegration':![]});const _0x5127ba=_0x3ce9fa[_0x2f8b02(0x1bd)][_0x2f8b02(0x207)]?.[_0x2f8b02(0xfd)]??undefined,_0x39992e=_0x3ce9fa[_0x2f8b02(0x1bd)]['react']?.[_0x2f8b02(0xfd)]??undefined,_0x1d608f=_0x3ce9fa[_0x2f8b02(0x1df)][_0x2f8b02(0x21c)]('base64')??undefined;_0x41f170['sendPresenceUpdate']('composing',_0x4ab64a[_0x2f8b02(0x208)]),await(0x0,baileys_1[_0x2f8b02(0x1b1)])(0x1f4);let _0x13bcf0;for(let _0x139e6a of _0x3ce9fa[_0x2f8b02(0x212)]){_0x13bcf0=_0x139e6a[_0x2f8b02(0x1a6)]['text'][0x0]?_0x139e6a[_0x2f8b02(0x1a6)][_0x2f8b02(0x1a6)][0x0]:_0x13bcf0;}for(let _0x2df863 of _0x3ce9fa['responses']){_0x2df863[_0x2f8b02(0x1a6)]&&await sendDelayedMessages(_0x41f170,_0x1e4a3a,_0x4ab64a,_0x2e7e51,_0x2df863[_0x2f8b02(0x1a6)][_0x2f8b02(0x1a6)][0x0],_0x13bcf0,_0x5127ba,_0x1d608f,_0x39992e);}};async function sendDelayedMessages(_0x18ac78,_0x2d938d,_0x112986,_0x320abc,_0x2c947e,_0x58f523,_0x53b807,_0x5db417,_0x458e1f){const _0xf9d61=a569_0x5b4444,_0x49ffad=await(0x0,ShowWhatsAppService_1['default'])(_0x18ac78['id'],_0x2d938d[_0xf9d61(0x177)]),_0xf049be=_0x49ffad[_0xf9d61(0x114)][_0xf9d61(0x135)](/[_*]/g,''),_0x11fbf6=await(0x0,ShowQueueIntegrationService_1[_0xf9d61(0x18a)])(_0x2d938d[_0xf9d61(0x16f)],_0x2d938d[_0xf9d61(0x177)]),_0x29cc40=await _0x18ac78['sendMessage'](_0x112986[_0xf9d61(0x158)]+_0xf9d61(0x11d),{'text':'‚Äé\x20*'+_0x2d938d[_0xf9d61(0x179)]?.[_0xf9d61(0x151)]+':*\x20'+_0x2c947e});await(0x0,exports[_0xf9d61(0x16a)])(_0x29cc40,_0x2d938d,_0x112986);if(_0x2c947e!=_0x58f523)await(0x0,baileys_1['delay'])(0x1f4),_0x18ac78['sendPresenceUpdate']('composing',_0x112986[_0xf9d61(0x208)]);else _0x5db417&&(_0x18ac78['sendPresenceUpdate'](_0xf9d61(0x147),_0x112986[_0xf9d61(0x208)]),await(0x0,baileys_1['delay'])(0x1f4),_0xf049be&&_0x2c947e['includes'](_0xf049be)&&(await(0x0,baileys_1[_0xf9d61(0x1b1)])(0x2710),setTimeout(async()=>{const _0x4b5eaa=_0xf9d61;await _0x2d938d[_0x4b5eaa(0xf9)]({'contactId':_0x2d938d[_0x4b5eaa(0xd7)]['id']['toString'](),'useIntegration':!![]}),await(0x0,UpdateTicketService_1[_0x4b5eaa(0x18a)])({'ticketId':_0x2d938d['id'],'ticketData':{'status':_0x4b5eaa(0x192)},'companyId':_0x2d938d[_0x4b5eaa(0x177)]});},0xbb8)));}const verifyQueue=async(_0x2aed3a,_0x1cf8d2,_0x7f366b,_0x2c8533,_0x5ac754)=>{const _0x31c384=a569_0x5b4444,{queues:_0x4e9085,greetingMessage:_0xf83d65,maxUseBotQueues:_0x1cac22,timeUseBotQueues:_0x464851}=await(0x0,ShowWhatsAppService_1[_0x31c384(0x18a)])(_0x2aed3a['id'],_0x7f366b['companyId']),_0x310bba=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x7f366b['id'],'companyId':_0x7f366b[_0x31c384(0x177)],'whatsappId':_0x7f366b[_0x31c384(0x1fe)]?.['id']});let _0x54ff99=![];_0x4e9085[_0x31c384(0x189)]===0x1&&(_0x54ff99=_0x4e9085[0x0]?.[_0x31c384(0x21a)][_0x31c384(0x189)]>0x1);const _0x2f7694=_0x5ac754[_0x31c384(0x120)]===_0x31c384(0x10f)||![];if(_0x4e9085[_0x31c384(0x189)]===0x1&&!_0x54ff99){const _0x43ca77=_0x5ac754[_0x31c384(0x195)]==='enabled'||![];if(_0xf83d65[_0x31c384(0x189)]>0x1&&_0x43ca77){const _0x57cc5b=(0x0,Mustache_1['default'])(''+_0xf83d65,_0x7f366b);if(_0x7f366b[_0x31c384(0x1fe)][_0x31c384(0x12f)]!==null){const _0x12bc13=path_1[_0x31c384(0x18a)]['resolve'](_0x31c384(0x139),'company'+_0x7f366b[_0x31c384(0x177)],_0x7f366b['whatsapp']['greetingMediaAttachment']),_0x31daeb=_0x7f366b['whatsapp'][_0x31c384(0x12f)],_0x618169=await(0x0,SendWhatsAppMedia_1[_0x31c384(0xf5)])(_0x31daeb,_0x12bc13,String(_0x7f366b['companyId']),_0x57cc5b),_0x1fec20=await _0x2aed3a[_0x31c384(0x187)](_0x7f366b[_0x31c384(0xd7)][_0x31c384(0x158)]+'@'+(_0x7f366b['isGroup']?'g.us':_0x31c384(0x1d2)),{..._0x618169});await verifyMediaMessage(_0x1fec20,_0x7f366b,_0x2c8533,_0x310bba);}else await _0x2aed3a[_0x31c384(0x187)](_0x2c8533[_0x31c384(0x158)]+'@'+(_0x7f366b[_0x31c384(0xeb)]?_0x31c384(0x1b5):'s.whatsapp.net'),{'text':_0x57cc5b});}await(0x0,UpdateTicketService_1[_0x31c384(0x18a)])({'ticketData':{'queueId':_0x4e9085[0x0]['id']},'ticketId':_0x7f366b['id'],'companyId':_0x7f366b[_0x31c384(0x177)]});const _0x3c909c=await Ticket_1['default'][_0x31c384(0x19a)]({'where':{'userId':null,'status':_0x31c384(0x203),'companyId':_0x7f366b[_0x31c384(0x177)],'queueId':_0x4e9085[0x0]['id'],'isGroup':![]}});if(_0x2f7694){const _0x362afd=_0x3c909c[_0x31c384(0x1d9)]===0x0?0x1:_0x3c909c[_0x31c384(0x1d9)],_0x5a3e05='*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posi√ß√£o\x20na\x20fila\x20de\x20atendimento\x20√©:\x20*'+_0x362afd+'*',_0x1959ee=(0x0,Mustache_1['default'])(''+_0x5a3e05,_0x7f366b),_0x57a7d6=(0x0,Debounce_1[_0x31c384(0x1ee)])(async()=>{const _0x527fe6=_0x31c384;await _0x2aed3a['sendMessage'](_0x2c8533[_0x527fe6(0x158)]+'@'+(_0x7f366b[_0x527fe6(0xeb)]?'g.us':_0x527fe6(0x1d2)),{'text':_0x1959ee});},0xbb8,_0x7f366b['id']);_0x57a7d6();}return;}if(_0x2c8533[_0x31c384(0x109)])return;let _0xc16b58='';if(_0x7f366b[_0x31c384(0x12d)]!==_0x31c384(0x1ec))_0xc16b58=_0x1cf8d2?.[_0x31c384(0x17a)]?.['buttonsResponseMessage']?.[_0x31c384(0x18b)]||_0x1cf8d2?.[_0x31c384(0x17a)]?.[_0x31c384(0x1ef)]?.[_0x31c384(0x219)][_0x31c384(0x16d)]||(0x0,exports[_0x31c384(0x12a)])(_0x1cf8d2);else{if(!(0x0,lodash_1[_0x31c384(0x1a4)])(_0x7f366b[_0x31c384(0x1f7)]))await _0x7f366b[_0x31c384(0xf9)]({'status':_0x31c384(0x203)});await _0x7f366b['reload']();}if(_0xc16b58==_0x31c384(0x159)){const _0x2f5076={'isBot':![],'queueId':null,'userId':null,'status':'closed','sendFarewellMessage':![],'maxUseBotQueues':0x0};await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x2f5076,'ticketId':_0x7f366b['id'],'companyId':_0x7f366b['companyId']});const _0x1adbba=_0x7f366b[_0x31c384(0x1fe)]?.[_0x31c384(0x1bc)],_0x3fefcc={'text':(0x0,Mustache_1['default'])('‚Äé'+_0x1adbba,_0x7f366b)};if(!(0x0,lodash_1[_0x31c384(0x1a4)])(_0x1adbba)){const _0x4ac8a7=await _0x2aed3a[_0x31c384(0x187)](_0x7f366b?.[_0x31c384(0xd7)]?.[_0x31c384(0x158)]+'@'+(_0x7f366b[_0x31c384(0xeb)]?_0x31c384(0x1b5):_0x31c384(0x1d2)),_0x3fefcc);await(0x0,exports[_0x31c384(0x16a)])(_0x4ac8a7,_0x7f366b,_0x7f366b[_0x31c384(0xd7)]);}return;}const _0x616452=_0x54ff99&&_0x4e9085[_0x31c384(0x189)]===0x1?_0x4e9085[+_0xc16b58]:_0x4e9085[+_0xc16b58-0x1],_0x3562fd=_0x5ac754?.[_0x31c384(0x180)]||'text';let _0x5a1c89;if(_0x616452)try{const _0x3c6139=await(0x0,ListUserQueueServices_1[_0x31c384(0x18a)])(_0x616452['id']);_0x3c6139[_0x31c384(0x138)]>-0x1&&(_0x5a1c89=_0x3c6139['userId']);}catch(_0x5b5250){console[_0x31c384(0x102)](_0x5b5250);}const _0x4c21e1=async()=>{const _0x3d704c=_0x31c384;if(_0x616452||_0x4e9085[_0x3d704c(0x189)]===0x1&&_0x54ff99){const _0x4b2051=await Queue_1[_0x3d704c(0x18a)][_0x3d704c(0x1e0)](_0x616452['id']);let _0x1be372;_0x5ac754?.['scheduleType']==='queue'&&(_0x1be372=await(0x0,VerifyCurrentSchedule_1[_0x3d704c(0x18a)])(_0x7f366b[_0x3d704c(0x177)],_0x4b2051['id']));if(_0x5ac754?.[_0x3d704c(0xe9)]==='queue'&&!(0x0,lodash_1[_0x3d704c(0x1a4)])(_0x1be372)&&(!_0x1be372||_0x1be372[_0x3d704c(0x222)]===![])){const _0x5bb484=_0x4b2051[_0x3d704c(0x1a9)];if(_0x5bb484!==''){const _0xbdf1b6=(0x0,Mustache_1[_0x3d704c(0x18a)])(''+_0x5bb484,_0x7f366b),_0xbc6a29=(0x0,Debounce_1[_0x3d704c(0x1ee)])(async()=>{const _0x3439bd=_0x3d704c;await _0x2aed3a[_0x3439bd(0x187)](_0x7f366b[_0x3439bd(0xd7)][_0x3439bd(0x158)]+'@'+(_0x7f366b[_0x3439bd(0xeb)]?_0x3439bd(0x1b5):_0x3439bd(0x1d2)),{'text':_0xbdf1b6});},0x3e8,_0x7f366b['id']);_0xbc6a29(),await _0x7f366b[_0x3d704c(0xf9)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x7f366b[_0x3d704c(0x18d)]+0x1});return;}await _0x7f366b[_0x3d704c(0xf9)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x7f366b['amountUsedBotQueues']+0x1});return;}await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':0x0,'queueId':_0x616452['id']},'ticketId':_0x7f366b['id'],'companyId':_0x7f366b[_0x3d704c(0x177)]});if(_0x616452[_0x3d704c(0x21a)][_0x3d704c(0x189)]>0x0){let _0x15bde7='';_0x616452[_0x3d704c(0x21a)]['forEach']((_0x1dd841,_0x595913)=>{const _0x29595d=_0x3d704c;_0x15bde7+='*'+(_0x595913+0x1)+_0x29595d(0x1b9)+_0x1dd841[_0x29595d(0x151)]+'\x0a';});const _0x288724=(0x0,Mustache_1[_0x3d704c(0x18a)])('‚Äé'+_0x616452[_0x3d704c(0x11c)]+'\x0a\x0a'+_0x15bde7+_0x3d704c(0x1e3),_0x7f366b),_0x376310=await _0x2aed3a[_0x3d704c(0x187)](_0x2c8533[_0x3d704c(0x158)]+'@'+(_0x7f366b['isGroup']?_0x3d704c(0x1b5):'s.whatsapp.net'),{'text':_0x288724});await(0x0,exports[_0x3d704c(0x16a)])(_0x376310,_0x7f366b,_0x2c8533,_0x310bba),_0x5ac754?.[_0x3d704c(0x17c)]===_0x3d704c(0x10f)&&await(0x0,UpdateTicketService_1[_0x3d704c(0x18a)])({'ticketData':{'userId':_0x5a1c89},'ticketId':_0x7f366b['id'],'companyId':_0x7f366b['companyId']});}if(!_0x616452[_0x3d704c(0x21a)][_0x3d704c(0x189)]&&_0x616452[_0x3d704c(0x11c)][_0x3d704c(0x189)]!==0x0){const _0x33f460=(0x0,Mustache_1[_0x3d704c(0x18a)])('‚Äé'+_0x616452[_0x3d704c(0x11c)],_0x7f366b),_0x5a5d66=await _0x2aed3a[_0x3d704c(0x187)](_0x2c8533[_0x3d704c(0x158)]+'@'+(_0x7f366b[_0x3d704c(0xeb)]?_0x3d704c(0x1b5):_0x3d704c(0x1d2)),{'text':_0x33f460});await(0x0,exports[_0x3d704c(0x16a)])(_0x5a5d66,_0x7f366b,_0x2c8533,_0x310bba);}const _0x27e7b8=await Ticket_1[_0x3d704c(0x18a)]['findAndCountAll']({'where':{'userId':null,'status':_0x3d704c(0x203),'companyId':_0x7f366b[_0x3d704c(0x177)],'queueId':_0x616452['id'],'isGroup':![]}});await(0x0,CreateLogTicketService_1['default'])({'ticketId':_0x7f366b['id'],'type':_0x3d704c(0x113),'queueId':_0x616452['id']});if(_0x2f7694&&!_0x616452['chatbots'][_0x3d704c(0x189)]){const _0x568979=_0x27e7b8[_0x3d704c(0x1d9)]===0x0?0x1:_0x27e7b8[_0x3d704c(0x1d9)],_0x5b631e=_0x3d704c(0x10c)+_0x568979+'*',_0x1f6d71=(0x0,Mustache_1[_0x3d704c(0x18a)])(''+_0x5b631e,_0x7f366b),_0x2978f1=(0x0,Debounce_1[_0x3d704c(0x1ee)])(async()=>{const _0x4d8857=_0x3d704c;await _0x2aed3a[_0x4d8857(0x187)](_0x2c8533[_0x4d8857(0x158)]+'@'+(_0x7f366b[_0x4d8857(0xeb)]?'g.us':_0x4d8857(0x1d2)),{'text':_0x1f6d71});},0xbb8,_0x7f366b['id']);_0x2978f1();}}else{if(_0x1cac22&&_0x1cac22!==0x0&&_0x7f366b[_0x3d704c(0x18d)]>=_0x1cac22)return;const _0x58ca11=await(0x0,FindOrCreateATicketTrakingService_1[_0x3d704c(0x18a)])({'ticketId':_0x7f366b['id'],'companyId':_0x7f366b[_0x3d704c(0x177)]});let _0x37a7bd=new Date(),_0x37941d=new Date();if(_0x58ca11['chatbotAt']!==null){_0x37a7bd[_0x3d704c(0xf1)](_0x58ca11['chatbotAt'][_0x3d704c(0x1b0)]()+Number(_0x464851));if(_0x58ca11['chatbotAt']!==null&&_0x37941d<_0x37a7bd&&_0x464851!=='0')return;}await _0x58ca11[_0x3d704c(0xf9)]({'chatbotAt':null});let _0x4c6608='';_0x4e9085['forEach']((_0x3db4a5,_0x3eb423)=>{const _0x4b6421=_0x3d704c;_0x4c6608+=_0x4b6421(0x171)+(_0x3eb423+0x1)+'\x20]*\x20-\x20'+_0x3db4a5[_0x4b6421(0x151)]+'\x0a';}),_0x4c6608+=_0x3d704c(0xd5);const _0x19dc4c=(0x0,Mustache_1[_0x3d704c(0x18a)])('‚Äé'+_0xf83d65+'\x0a\x0a'+_0x4c6608,_0x7f366b);await(0x0,CreateLogTicketService_1[_0x3d704c(0x18a)])({'ticketId':_0x7f366b['id'],'type':_0x3d704c(0x172)});if(_0x7f366b[_0x3d704c(0x1fe)][_0x3d704c(0x12f)]!==null){const _0xd1f653=path_1[_0x3d704c(0x18a)]['resolve'](_0x3d704c(0x139),_0x3d704c(0xdf)+_0x7f366b[_0x3d704c(0x177)],_0x7f366b[_0x3d704c(0x1fe)][_0x3d704c(0x12f)]),_0x360086=_0x7f366b['whatsapp']['greetingMediaAttachment'],_0x2921b4=await(0x0,SendWhatsAppMedia_1[_0x3d704c(0xf5)])(_0x360086,_0xd1f653,String(_0x7f366b[_0x3d704c(0x177)]),_0x19dc4c);let _0x285d44=await _0x2aed3a[_0x3d704c(0x187)](_0x7f366b[_0x3d704c(0xd7)]['number']+'@'+(_0x7f366b['isGroup']?_0x3d704c(0x1b5):_0x3d704c(0x1d2)),{..._0x2921b4});await verifyMediaMessage(_0x285d44,_0x7f366b,_0x2c8533,_0x58ca11),await(0x0,UpdateTicketService_1[_0x3d704c(0x18a)])({'ticketData':{'amountUsedBotQueues':_0x7f366b[_0x3d704c(0x18d)]+0x1},'ticketId':_0x7f366b['id'],'companyId':_0x7f366b[_0x3d704c(0x177)]});return;}else{const _0x4d6dcb=(0x0,Debounce_1[_0x3d704c(0x1ee)])(async()=>{const _0x333311=_0x3d704c,_0x216a03=await _0x2aed3a[_0x333311(0x187)](_0x2c8533[_0x333311(0x158)]+'@'+(_0x7f366b['isGroup']?_0x333311(0x1b5):'s.whatsapp.net'),{'text':_0x19dc4c});(0x0,exports[_0x333311(0x16a)])(_0x216a03,_0x7f366b,_0x2c8533,_0x58ca11);},0x3e8,_0x7f366b['id']);await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x7f366b[_0x3d704c(0x18d)]+0x1},'ticketId':_0x7f366b['id'],'companyId':_0x7f366b[_0x3d704c(0x177)]}),_0x4d6dcb();}}},_0x1af30b=async()=>{const _0x485bef=_0x31c384;if(_0x616452){await(0x0,UpdateTicketService_1[_0x485bef(0x18a)])({'ticketData':{'queueId':_0x616452['id']},'ticketId':_0x7f366b['id'],'companyId':_0x7f366b[_0x485bef(0x177)]});if(_0x616452[_0x485bef(0x21a)][_0x485bef(0x189)]>0x0){const _0x3209bd=[];_0x616452[_0x485bef(0x21a)][_0x485bef(0x150)]((_0x12419b,_0x479ec8)=>{const _0x251d7b=_0x485bef;_0x3209bd[_0x251d7b(0xdd)]({'buttonId':''+(_0x479ec8+0x1),'buttonText':{'displayText':_0x12419b[_0x251d7b(0x151)]},'type':0x1});});const _0x54377a={'text':(0x0,Mustache_1[_0x485bef(0x18a)])(''+_0x616452['greetingMessage'],_0x7f366b),'buttons':_0x3209bd,'headerType':0x4},_0x63b90a=await _0x2aed3a['sendMessage'](_0x2c8533[_0x485bef(0x158)]+'@'+(_0x7f366b['isGroup']?_0x485bef(0x1b5):_0x485bef(0x1d2)),_0x54377a);await(0x0,exports[_0x485bef(0x16a)])(_0x63b90a,_0x7f366b,_0x2c8533,_0x310bba);}if(!_0x616452[_0x485bef(0x21a)][_0x485bef(0x189)]){const _0x45a0f5=(0x0,Mustache_1[_0x485bef(0x18a)])(''+_0x616452[_0x485bef(0x11c)],_0x7f366b),_0x268af7=await _0x2aed3a['sendMessage'](_0x2c8533[_0x485bef(0x158)]+'@'+(_0x7f366b[_0x485bef(0xeb)]?_0x485bef(0x1b5):_0x485bef(0x1d2)),{'text':_0x45a0f5});await(0x0,exports[_0x485bef(0x16a)])(_0x268af7,_0x7f366b,_0x2c8533,_0x310bba);}}else{const _0x2ebdc8=[];_0x4e9085[_0x485bef(0x150)]((_0x241b77,_0x584f25)=>{const _0x3b17d8=_0x485bef;_0x2ebdc8[_0x3b17d8(0xdd)]({'buttonId':''+(_0x584f25+0x1),'buttonText':{'displayText':_0x241b77[_0x3b17d8(0x151)]},'type':0x4});});const _0x2e0762={'text':(0x0,Mustache_1[_0x485bef(0x18a)])(''+_0xf83d65,_0x7f366b),'footer':'','buttons':_0x2ebdc8,'headerType':0x4},_0x29f256=await _0x2aed3a[_0x485bef(0x187)](_0x2c8533[_0x485bef(0x158)]+'@'+(_0x7f366b[_0x485bef(0xeb)]?'g.us':_0x485bef(0x1d2)),_0x2e0762);await(0x0,exports[_0x485bef(0x16a)])(_0x29f256,_0x7f366b,_0x2c8533,_0x310bba),await(0x0,UpdateTicketService_1[_0x485bef(0x18a)])({'ticketData':{'amountUsedBotQueues':_0x7f366b[_0x485bef(0x18d)]+0x1},'ticketId':_0x7f366b['id'],'companyId':_0x7f366b[_0x485bef(0x177)]});}},_0x394c67=async()=>{const _0x110bf1=_0x31c384;if(_0x616452){await(0x0,UpdateTicketService_1[_0x110bf1(0x18a)])({'ticketData':{'queueId':_0x616452['id']},'ticketId':_0x7f366b['id'],'companyId':_0x7f366b[_0x110bf1(0x177)]});if(_0x616452['chatbots'][_0x110bf1(0x189)]>0x0){const _0x1684ec=[];_0x616452[_0x110bf1(0x21a)][_0x110bf1(0x150)]((_0x38aa4f,_0x1e454d)=>{const _0x3fbbdb=_0x110bf1;_0x1684ec[_0x3fbbdb(0xdd)]({'title':_0x38aa4f[_0x3fbbdb(0x151)],'rowId':''+(_0x1e454d+0x1)});});const _0x48e1ee=[{'title':'Menu','rows':_0x1684ec}],_0x3c8dd1={'text':(0x0,Mustache_1[_0x110bf1(0x18a)])(''+_0x616452[_0x110bf1(0x11c)],_0x7f366b),'buttonText':_0x110bf1(0xe0),'sections':_0x48e1ee},_0x11743b=await _0x2aed3a['sendMessage'](_0x2c8533[_0x110bf1(0x158)]+'@'+(_0x7f366b[_0x110bf1(0xeb)]?_0x110bf1(0x1b5):'s.whatsapp.net'),_0x3c8dd1);await(0x0,exports[_0x110bf1(0x16a)])(_0x11743b,_0x7f366b,_0x2c8533,_0x310bba);}if(!_0x616452[_0x110bf1(0x21a)]['length']){const _0x331cd9=(0x0,Mustache_1[_0x110bf1(0x18a)])(''+_0x616452[_0x110bf1(0x11c)],_0x7f366b),_0x3cb3ef=await _0x2aed3a['sendMessage'](_0x2c8533[_0x110bf1(0x158)]+'@'+(_0x7f366b[_0x110bf1(0xeb)]?_0x110bf1(0x1b5):_0x110bf1(0x1d2)),{'text':_0x331cd9});await(0x0,exports[_0x110bf1(0x16a)])(_0x3cb3ef,_0x7f366b,_0x2c8533,_0x310bba);}}else{const _0x1698a1=[];_0x4e9085[_0x110bf1(0x150)]((_0x55d167,_0x4099a5)=>{const _0x570c25=_0x110bf1;_0x1698a1[_0x570c25(0xdd)]({'title':_0x55d167[_0x570c25(0x151)],'rowId':''+(_0x4099a5+0x1)});});const _0x1e0b34=[{'title':_0x110bf1(0x1fa),'rows':_0x1698a1}],_0x5cf6d5={'text':(0x0,Mustache_1['default'])(''+_0xf83d65,_0x7f366b),'buttonText':_0x110bf1(0xe0),'sections':_0x1e0b34},_0x53ddb9=await _0x2aed3a['sendMessage'](_0x2c8533['number']+'@'+(_0x7f366b[_0x110bf1(0xeb)]?_0x110bf1(0x1b5):_0x110bf1(0x1d2)),_0x5cf6d5);await(0x0,exports[_0x110bf1(0x16a)])(_0x53ddb9,_0x7f366b,_0x2c8533,_0x310bba),await(0x0,UpdateTicketService_1[_0x110bf1(0x18a)])({'ticketData':{'amountUsedBotQueues':_0x7f366b[_0x110bf1(0x18d)]+0x1},'ticketId':_0x7f366b['id'],'companyId':_0x7f366b[_0x110bf1(0x177)]});}};if(_0x3562fd===_0x31c384(0x1a6))return _0x4c21e1();if(_0x3562fd===_0x31c384(0x20c)&&_0x4e9085[_0x31c384(0x189)]>0x3)return _0x4c21e1();if(_0x3562fd==='button'&&_0x4e9085['length']<=0x3)return _0x1af30b();if(_0x3562fd===_0x31c384(0x105))return _0x394c67();},verifyRating=_0x73150f=>{const _0x495a2c=a569_0x5b4444;if(_0x73150f&&_0x73150f['finishedAt']===null&&_0x73150f[_0x495a2c(0xe3)]!==null&&_0x73150f[_0x495a2c(0x138)]!==null&&_0x73150f[_0x495a2c(0x11b)]===null)return!![];return![];};exports['verifyRating']=verifyRating;const handleRating=async(_0x5811ba,_0xc27f5b,_0x51bc32)=>{const _0x31d517=a569_0x5b4444,_0x217e31=(0x0,socket_1[_0x31d517(0x17b)])(),{complationMessage:_0x8e0cb8}=await(0x0,ShowWhatsAppService_1['default'])(_0xc27f5b[_0x31d517(0x11f)],_0xc27f5b[_0x31d517(0x177)]);let _0x53915e=_0x5811ba;_0x5811ba<0x0&&(_0x53915e=0x0);_0x5811ba>0xa&&(_0x53915e=0xa);await UserRating_1[_0x31d517(0x18a)]['create']({'ticketId':_0x51bc32[_0x31d517(0x211)],'companyId':_0x51bc32[_0x31d517(0x177)],'userId':_0x51bc32[_0x31d517(0x138)],'rate':_0x53915e});if(!(0x0,lodash_1[_0x31d517(0x1a4)])(_0x8e0cb8)&&_0x8e0cb8!==''&&!_0xc27f5b[_0x31d517(0xeb)]){const _0x30617b=(0x0,Mustache_1[_0x31d517(0x18a)])('‚Äé'+_0x8e0cb8,_0xc27f5b);if(_0xc27f5b['channel']==='whatsapp'){const _0x1843c6=await(0x0,SendWhatsAppMessage_1[_0x31d517(0x18a)])({'body':_0x30617b,'ticket':_0xc27f5b});await(0x0,exports[_0x31d517(0x16a)])(_0x1843c6,_0xc27f5b,_0xc27f5b[_0x31d517(0xd7)],_0x51bc32);}[_0x31d517(0x170),'instagram'][_0x31d517(0x1d5)](_0xc27f5b['channel'])&&await(0x0,sendFacebookMessage_1[_0x31d517(0x18a)])({'body':_0x30617b,'ticket':_0xc27f5b});}await _0xc27f5b[_0x31d517(0xf9)]({'chatbot':null,'status':_0x31d517(0x192),'amountUseBotQueuesNPS':0x0}),await(0x0,CreateLogTicketService_1[_0x31d517(0x18a)])({'userId':_0xc27f5b[_0x31d517(0x138)],'queueId':_0xc27f5b[_0x31d517(0x20d)],'ticketId':_0xc27f5b['id'],'type':_0x31d517(0x192)}),_0x217e31['to'](_0x31d517(0x13b))['emit'](_0x31d517(0xfc)+_0xc27f5b['companyId']+_0x31d517(0xef),{'action':_0x31d517(0xd9),'ticket':_0xc27f5b,'ticketId':_0xc27f5b['id']}),_0x217e31['to'](_0xc27f5b[_0x31d517(0x12d)])['to'](_0xc27f5b['id'][_0x31d517(0x21c)]())[_0x31d517(0xd3)]('company-'+_0xc27f5b[_0x31d517(0x177)]+_0x31d517(0xef),{'action':_0x31d517(0xf9),'ticket':_0xc27f5b,'ticketId':_0xc27f5b['id']});};exports['handleRating']=handleRating;const handleMessage=async(_0x14807c,_0x55ccbc,_0x56c337,_0x260f01=![])=>{const _0x29398e=a569_0x5b4444;if(_0x260f01){(0x0,addLogs_1['addLogs'])({'fileName':_0x29398e(0x1c8)+_0x55ccbc['id']+_0x29398e(0x19c),'text':_0x29398e(0x1d7)+JSON['stringify'](_0x14807c,null,0x2)+_0x29398e(0x181)});let _0x320985=_0x14807c['key']['id'],_0x167328=await Message_1['default']['findOne']({'where':{'wid':_0x320985}});if(_0x167328){await new Promise(_0x130ba7=>setTimeout(_0x130ba7,0x96)),console[_0x29398e(0x19f)](_0x29398e(0x130));return;}else await new Promise(_0x275caf=>setTimeout(_0x275caf,parseInt(process[_0x29398e(0x1de)][_0x29398e(0x20e)])||0x14a));}else await new Promise(_0x5e11cc=>setTimeout(_0x5e11cc,i*0x28a)),i++;if(!isValidMsg(_0x14807c))return;try{let _0x5a851c,_0xf64fae,_0xc86903=0x0,_0x1f4eb3=0x0,_0x446eb9=0x0,_0x1eb637=(0x0,exports[_0x29398e(0x12a)])(_0x14807c);const _0x220095=getTypeMessage(_0x14807c);if(_0x220095===_0x29398e(0x104))return;const _0x116cdd=_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0x1b3)]||_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0x1ed)]||_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0xee)]||_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0x188)]||_0x14807c['message'][_0x29398e(0x1a3)]||_0x14807c?.[_0x29398e(0x17a)]?.[_0x29398e(0x129)]?.[_0x29398e(0x17a)]?.[_0x29398e(0x1ed)]||_0x14807c?.['message']?.[_0x29398e(0x129)]?.[_0x29398e(0x17a)]?.['audioMessage']||_0x14807c?.[_0x29398e(0x17a)]?.[_0x29398e(0x129)]?.[_0x29398e(0x17a)]?.['videoMessage']||_0x14807c?.[_0x29398e(0x17a)]?.[_0x29398e(0x129)]?.[_0x29398e(0x17a)]?.['documentMessage']||_0x14807c?.['message']?.['ephemeralMessage']?.[_0x29398e(0x17a)]?.[_0x29398e(0x1a3)]||_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0xdc)]?.[_0x29398e(0x17a)]?.['imageMessage']||_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0xdc)]?.[_0x29398e(0x17a)]?.[_0x29398e(0xee)]||_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0x129)]?.[_0x29398e(0x17a)]?.[_0x29398e(0xdc)]?.[_0x29398e(0x17a)]?.['imageMessage']||_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0x129)]?.['message']?.[_0x29398e(0xdc)]?.[_0x29398e(0x17a)]?.['videoMessage']||_0x14807c['message']?.[_0x29398e(0x205)]?.[_0x29398e(0x17a)]?.[_0x29398e(0x188)],_0x27ed10=/\u200d/['test'](_0x1eb637);if(_0x14807c[_0x29398e(0xf8)][_0x29398e(0x127)]){if(/\u200e/[_0x29398e(0x1dd)](_0x1eb637))return;if(!_0x116cdd&&_0x220095!==_0x29398e(0x20b)&&_0x220095!==_0x29398e(0x124)&&_0x220095!==_0x29398e(0x1c9)&&_0x220095!==_0x29398e(0x215)&&_0x220095!=='ephemeralMessage'&&_0x220095!=='protocolMessage'&&_0x220095!==_0x29398e(0xdc)&&_0x220095!==_0x29398e(0x155))return;_0x5a851c=await getContactMessage(_0x14807c,_0x55ccbc);}else _0x5a851c=await getContactMessage(_0x14807c,_0x55ccbc);const _0x3ac5e7=_0x14807c['key']['remoteJid']?.[_0x29398e(0x18c)]('@g.us'),_0x258482=await(0x0,ShowWhatsAppService_1[_0x29398e(0x18a)])(_0x55ccbc['id'],_0x56c337);if(!_0x258482[_0x29398e(0x1f2)]&&_0x3ac5e7)return;if(_0x3ac5e7){const _0x1188e9=await _0x55ccbc[_0x29398e(0x198)](_0x14807c[_0x29398e(0xf8)][_0x29398e(0x208)]),_0x125811={'id':_0x1188e9['id'],'name':_0x1188e9[_0x29398e(0x140)]};_0xf64fae=await verifyContact(_0x125811,_0x55ccbc,_0x56c337);}const _0x543af9=await verifyContact(_0x5a851c,_0x55ccbc,_0x56c337);let _0x1c9fa6=0x0,_0x16aa44=null;if(_0x14807c['key'][_0x29398e(0x127)])await cache_1[_0x29398e(0x18a)][_0x29398e(0x1c3)](_0x29398e(0x164)+_0x543af9['id']+':unreads','0');else{const _0x21c2b8=await cache_1[_0x29398e(0x18a)][_0x29398e(0x153)](_0x29398e(0x164)+_0x543af9['id']+_0x29398e(0x108));_0x1c9fa6=+_0x21c2b8+0x1,await cache_1[_0x29398e(0x18a)][_0x29398e(0x1c3)](_0x29398e(0x164)+_0x543af9['id']+_0x29398e(0x108),''+_0x1c9fa6);}const _0x58a253=await CompaniesSettings_1[_0x29398e(0x18a)][_0x29398e(0x16e)]({'where':{'companyId':_0x56c337}}),_0x44c3f6=_0x58a253[_0x29398e(0x15e)]===_0x29398e(0x10f),{ticket:_0x5b17bc,isCreated:_0x1b1fed}=await(0x0,FindOrCreateTicketService_1[_0x29398e(0x18a)])(_0x543af9,_0x258482,_0x1c9fa6,_0x56c337,_0xc86903,_0x446eb9,_0xf64fae,_0x29398e(0x1fe),_0x260f01,![],_0x58a253);_0x16aa44=_0x5b17bc;if(_0x16aa44[_0x29398e(0x12d)]===_0x29398e(0x192)||_0x1c9fa6===0x0&&_0x258482[_0x29398e(0x1bc)]&&(0x0,Mustache_1[_0x29398e(0x18a)])(_0x258482[_0x29398e(0x1bc)],_0x16aa44)===_0x1eb637)return;if(_0x220095===_0x29398e(0x155)){const _0x18883b=_0x14807c[_0x29398e(0x17a)]['editedMessage']['message']['protocolMessage'][_0x29398e(0xf8)]['id'],_0x52ed35=_0x14807c[_0x29398e(0x17a)][_0x29398e(0x155)][_0x29398e(0x17a)]['protocolMessage'][_0x29398e(0x155)]['conversation'],_0x3cc570=(0x0,socket_1[_0x29398e(0x17b)])();try{const _0x333804=await Message_1[_0x29398e(0x18a)][_0x29398e(0x16e)]({'where':{'wid':_0x18883b,'companyId':_0x56c337,'ticketId':_0x16aa44['id']}});if(!_0x333804)return;await _0x333804['update']({'isEdited':!![],'body':_0x52ed35}),await _0x16aa44['update']({'lastMessage':_0x52ed35}),_0x3cc570['to'](_0x333804[_0x29398e(0x211)][_0x29398e(0x21c)]())[_0x29398e(0xd3)](_0x29398e(0xfc)+_0x333804[_0x29398e(0x177)]+'-appMessage',{'action':_0x29398e(0xf9),'message':_0x333804});}catch(_0x646c3){Sentry[_0x29398e(0x173)](_0x646c3),logger_1[_0x29398e(0x152)][_0x29398e(0x102)](_0x29398e(0x166)+_0x646c3);}return;}const _0x2453be=await(0x0,FindOrCreateATicketTrakingService_1[_0x29398e(0x18a)])({'ticketId':_0x16aa44['id'],'companyId':_0x56c337,'whatsappId':_0x258482?.['id']});try{if(!_0x14807c[_0x29398e(0xf8)][_0x29398e(0x127)]){if(_0x16aa44[_0x29398e(0x12d)]===_0x29398e(0x1ea)&&_0x2453be!==null&&(0x0,exports['verifyRating'])(_0x2453be)){if(!isNaN(parseFloat(_0x1eb637))){(0x0,exports[_0x29398e(0x1fd)])(parseFloat(_0x1eb637),_0x16aa44,_0x2453be),await _0x2453be[_0x29398e(0xf9)]({'ratingAt':(0x0,moment_1[_0x29398e(0x18a)])()[_0x29398e(0x21f)](),'finishedAt':(0x0,moment_1[_0x29398e(0x18a)])()[_0x29398e(0x21f)](),'rated':!![]});return;}else{if(_0x16aa44[_0x29398e(0x216)]<_0x258482[_0x29398e(0x1d3)]){let _0x5478f1=_0x29398e(0x133);const _0x2c2aef=await _0x55ccbc['sendMessage'](_0x16aa44[_0x29398e(0xd7)][_0x29398e(0x158)]+'@'+(_0x16aa44[_0x29398e(0xeb)]?_0x29398e(0x1b5):_0x29398e(0x1d2)),{'text':_0x5478f1});(0x0,exports[_0x29398e(0x16a)])(_0x2c2aef,_0x16aa44,_0x543af9,_0x2453be),await(0x0,baileys_1['delay'])(0x3e8);let _0x34f330='‚Äé'+_0x258482[_0x29398e(0x110)]+'\x0a';const _0x39b430=await(0x0,SendWhatsAppMessage_1[_0x29398e(0x18a)])({'body':_0x34f330,'ticket':_0x16aa44});await(0x0,exports[_0x29398e(0x16a)])(_0x39b430,_0x16aa44,_0x16aa44[_0x29398e(0xd7)]),await _0x16aa44['update']({'amountUseBotQueuesNPS':_0x16aa44[_0x29398e(0x216)]+0x1});}return;}}if(_0x44c3f6){if(_0x16aa44[_0x29398e(0x12d)]==='lgpd'&&_0x58a253?.[_0x29398e(0x15e)]==='enabled'&&!_0x260f01){if((0x0,lodash_1[_0x29398e(0x1a4)])(_0x16aa44['lgpdAcceptedAt'])&&!(0x0,lodash_1[_0x29398e(0x1a4)])(_0x16aa44[_0x29398e(0x14e)])){let _0x1476c5=null;_0x14807c?.[_0x29398e(0x17a)]?.['conversation']&&(_0x1476c5=~~+_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0x20b)]);if(!Number[_0x29398e(0xe4)](_0x1476c5)&&Number['isInteger'](_0x1476c5)&&!(0x0,lodash_1[_0x29398e(0x1b7)])(_0x1476c5)&&_0x1476c5>0x0){if(_0x1476c5===0x1)await _0x543af9[_0x29398e(0xf9)]({'lgpdAcceptedAt':(0x0,moment_1[_0x29398e(0x18a)])()[_0x29398e(0x21f)]()}),await _0x16aa44['update']({'lgpdAcceptedAt':(0x0,moment_1[_0x29398e(0x18a)])()['toDate'](),'amountUsedBotQueues':0x0});else{if(_0x1476c5===0x2){if(_0x258482['complationMessage']!==''&&_0x258482[_0x29398e(0x1bc)]!==undefined){const _0x4a62d6=await _0x55ccbc[_0x29398e(0x187)](_0x16aa44[_0x29398e(0xd7)]['number']+'@'+(_0x16aa44[_0x29398e(0xeb)]?'g.us':'s.whatsapp.net'),{'text':'‚Äé'+_0x258482[_0x29398e(0x1bc)]});(0x0,exports[_0x29398e(0x16a)])(_0x4a62d6,_0x16aa44,_0x543af9,_0x2453be);}await _0x16aa44['update']({'status':_0x29398e(0x192),'amountUsedBotQueues':0x0}),await _0x2453be[_0x29398e(0x17e)];return;}else _0x16aa44[_0x29398e(0x18d)]<_0x258482[_0x29398e(0x165)]&&await _0x16aa44['update']({'amountUsedBotQueues':_0x16aa44[_0x29398e(0x18d)]+0x1,'lgpdSendMessageAt':null});}}else _0x16aa44[_0x29398e(0x18d)]<_0x258482[_0x29398e(0x165)]&&await _0x16aa44[_0x29398e(0xf9)]({'amountUsedBotQueues':_0x16aa44[_0x29398e(0x18d)]+0x1,'lgpdSendMessageAt':null});}if((_0x543af9[_0x29398e(0x1f7)]===null||_0x58a253?.[_0x29398e(0x19d)]===_0x29398e(0x10f))&&!_0x543af9['isGroup']&&(0x0,lodash_1['isNil'])(_0x16aa44[_0x29398e(0x14e)])&&_0x16aa44[_0x29398e(0x18d)]<=_0x258482[_0x29398e(0x165)]&&!(0x0,lodash_1['isNil'])(_0x58a253?.['lgpdMessage'])){_0x116cdd?await verifyMediaMessage(_0x14807c,_0x16aa44,_0x543af9):await(0x0,exports['verifyMessage'])(_0x14807c,_0x16aa44,_0x543af9,_0x2453be,_0x27ed10);if(!(0x0,lodash_1[_0x29398e(0x1a4)])(_0x58a253?.[_0x29398e(0x199)])&&_0x58a253[_0x29398e(0x199)]!==''){const _0x25d919=(0x0,Mustache_1[_0x29398e(0x18a)])('‚Äé'+_0x58a253?.['lgpdMessage'],_0x16aa44),_0x26cb10=await _0x55ccbc[_0x29398e(0x187)](_0x16aa44[_0x29398e(0xd7)]['number']+'@'+(_0x16aa44[_0x29398e(0xeb)]?_0x29398e(0x1b5):_0x29398e(0x1d2)),{'text':_0x25d919});(0x0,exports['verifyMessage'])(_0x26cb10,_0x16aa44,_0x543af9,_0x2453be);}await(0x0,baileys_1[_0x29398e(0x1b1)])(0x3e8);if(!(0x0,lodash_1['isNil'])(_0x58a253?.[_0x29398e(0x191)])&&_0x58a253?.[_0x29398e(0x191)]!==''){const _0x55631d=(0x0,Mustache_1[_0x29398e(0x18a)])('‚Äé'+_0x58a253?.[_0x29398e(0x191)],_0x16aa44),_0x898753=await _0x55ccbc[_0x29398e(0x187)](_0x16aa44['contact'][_0x29398e(0x158)]+'@'+(_0x16aa44[_0x29398e(0xeb)]?_0x29398e(0x1b5):_0x29398e(0x1d2)),{'text':_0x55631d});await(0x0,exports[_0x29398e(0x16a)])(_0x898753,_0x16aa44,_0x543af9,_0x2453be);};await(0x0,baileys_1[_0x29398e(0x1b1)])(0x3e8);const _0x25c742=(0x0,Mustache_1[_0x29398e(0x18a)])(_0x29398e(0x1cf),_0x16aa44),_0x4ef1ff=await _0x55ccbc['sendMessage'](_0x16aa44[_0x29398e(0xd7)][_0x29398e(0x158)]+'@'+(_0x16aa44[_0x29398e(0xeb)]?_0x29398e(0x1b5):_0x29398e(0x1d2)),{'text':_0x25c742});await(0x0,exports[_0x29398e(0x16a)])(_0x4ef1ff,_0x16aa44,_0x543af9,_0x2453be),await _0x16aa44['update']({'lgpdSendMessageAt':(0x0,moment_1[_0x29398e(0x18a)])()[_0x29398e(0x21f)](),'amountUsedBotQueues':_0x16aa44[_0x29398e(0x18d)]+0x1}),await _0x16aa44[_0x29398e(0xf7)]();return;};if(!(0x0,lodash_1['isNil'])(_0x16aa44[_0x29398e(0x14e)])&&(0x0,lodash_1['isNil'])(_0x16aa44['lgpdAcceptedAt']))return;}}}}catch(_0xfdc1f4){Sentry[_0x29398e(0x173)](_0xfdc1f4),console[_0x29398e(0x19f)](_0xfdc1f4);}const _0x41d068=_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0x124)]?.[_0x29398e(0x128)]?.['isForwarded']||_0x14807c['message']?.[_0x29398e(0x1ed)]?.[_0x29398e(0x128)]?.[_0x29398e(0x1e4)]||_0x14807c['message']?.[_0x29398e(0x1b3)]?.['contextInfo']?.['isForwarded']||_0x14807c[_0x29398e(0x17a)]?.[_0x29398e(0xee)]?.[_0x29398e(0x128)]?.[_0x29398e(0x1e4)]||_0x14807c[_0x29398e(0x17a)]?.['documentMessage']?.[_0x29398e(0x128)]?.[_0x29398e(0x1e4)];_0x116cdd?await verifyMediaMessage(_0x14807c,_0x16aa44,_0x543af9,_0x2453be,_0x41d068):await(0x0,exports[_0x29398e(0x16a)])(_0x14807c,_0x16aa44,_0x543af9,_0x2453be,_0x27ed10,_0x41d068);try{await _0x16aa44[_0x29398e(0xf9)]({'fromMe':_0x14807c[_0x29398e(0xf8)]['fromMe']});}catch(_0xfca5bc){Sentry[_0x29398e(0x173)](_0xfca5bc),console[_0x29398e(0x19f)](_0xfca5bc);}let _0x23ac08;_0x58a253[_0x29398e(0xe9)]===_0x29398e(0xdf)&&(_0x23ac08=await(0x0,VerifyCurrentSchedule_1[_0x29398e(0x18a)])(_0x56c337));try{if(!_0x14807c[_0x29398e(0xf8)][_0x29398e(0x127)]&&_0x58a253[_0x29398e(0xe9)]){if(_0x58a253[_0x29398e(0xe9)]==='company'&&!(0x0,lodash_1[_0x29398e(0x1a4)])(_0x23ac08)&&(!_0x23ac08||_0x23ac08[_0x29398e(0x222)]===![])){_0x2453be['chatbotAt']===null&&await _0x2453be['update']({'chatbotAt':(0x0,moment_1[_0x29398e(0x18a)])()[_0x29398e(0x21f)]()});if(_0x258482[_0x29398e(0x165)]&&_0x258482[_0x29398e(0x165)]!==0x0&&_0x16aa44[_0x29398e(0x18d)]>=_0x258482['maxUseBotQueues'])return;let _0x2e8414=new Date(),_0x14476b=new Date();if(_0x2453be['chatbotAt']!==null){_0x2e8414['setMinutes'](_0x2453be['chatbotAt']['getMinutes']()+Number(_0x258482['timeUseBotQueues']));if(_0x2453be[_0x29398e(0xd4)]!==null&&_0x14476b<_0x2e8414&&_0x258482[_0x29398e(0x126)]!=='0')return;}await _0x2453be['update']({'chatbotAt':null});if(_0x258482[_0x29398e(0x1a9)]!==''){const _0x43ea46=(0x0,Mustache_1['default'])(''+_0x258482[_0x29398e(0x1a9)],_0x16aa44),_0xb8f5ed=(0x0,Debounce_1[_0x29398e(0x1ee)])(async()=>{const _0xeb1dc1=_0x29398e;await _0x55ccbc[_0xeb1dc1(0x187)](_0x16aa44[_0xeb1dc1(0xd7)][_0xeb1dc1(0x158)]+'@'+(_0x16aa44[_0xeb1dc1(0xeb)]?_0xeb1dc1(0x1b5):_0xeb1dc1(0x1d2)),{'text':_0x43ea46});},0x3e8,_0x16aa44['id']);_0xb8f5ed(),await _0x16aa44[_0x29398e(0xf9)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x16aa44[_0x29398e(0x18d)]+0x1});return;}await _0x16aa44[_0x29398e(0xf9)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x16aa44[_0x29398e(0x18d)]+0x1});return;}}}catch(_0x5c13ca){Sentry['captureException'](_0x5c13ca),console[_0x29398e(0x19f)](_0x5c13ca);}!_0x16aa44[_0x29398e(0x185)]&&!_0x16aa44[_0x29398e(0x113)]&&!_0x3ac5e7&&!_0x14807c['key'][_0x29398e(0x127)]&&!_0x16aa44[_0x29398e(0x138)]&&_0x258482[_0x29398e(0xe7)][_0x29398e(0x189)]>=0x1&&(await verifyQueue(_0x55ccbc,_0x14807c,_0x16aa44,_0x543af9,_0x58a253),_0x2453be[_0x29398e(0xd4)]===null&&await _0x2453be[_0x29398e(0xf9)]({'chatbotAt':(0x0,moment_1[_0x29398e(0x18a)])()[_0x29398e(0x21f)]()}));if(!_0x14807c[_0x29398e(0xf8)][_0x29398e(0x127)]&&!_0x16aa44[_0x29398e(0xeb)]&&_0x16aa44['queue']&&_0x16aa44[_0x29398e(0x16f)]&&_0x16aa44[_0x29398e(0xf0)]){const _0x16e9dc=await(0x0,ShowQueueIntegrationService_1[_0x29398e(0x18a)])(_0x16aa44[_0x29398e(0x16f)],_0x56c337);if(_0x16e9dc[_0x29398e(0xe6)]==='n8n'||_0x16e9dc[_0x29398e(0xe6)]===_0x29398e(0xf2)){if(_0x16e9dc?.[_0x29398e(0x16b)]){const _0xa3a36f={'method':_0x29398e(0x1da),'url':_0x16e9dc?.[_0x29398e(0x16b)],'headers':{'Content-Type':_0x29398e(0x1c7)},'json':_0x14807c};try{const _0x12c263=await request(_0xa3a36f);console[_0x29398e(0x19f)](_0x12c263[_0x29398e(0x1ad)]);}catch(_0x3e19fb){throw new Error(_0x3e19fb);}}}else{if(_0x16e9dc[_0x29398e(0xe6)]===_0x29398e(0xe5)){let _0x12b36b;if(_0x220095==='audioMessage'){let _0x765137=_0x14807c['messageTimestamp']+_0x29398e(0x206);(0x0,fs_1['readFile'])((0x0,path_1[_0x29398e(0x1ca)])(__dirname,'..','..','..',_0x29398e(0x139),_0x29398e(0xdf)+_0x56c337,_0x765137),_0x29398e(0xdb),(_0x4a6cce,_0x23a59a)=>{const _0x4d552d=_0x29398e;_0x12b36b=_0x23a59a,_0x4a6cce&&logger_1[_0x4d552d(0x152)][_0x4d552d(0x102)](_0x4a6cce);});}else _0x12b36b=undefined;console[_0x29398e(0x19f)]('ENTROU\x20NO\x20DIALOGFLOW');const _0x275585=(0x0,Debounce_1[_0x29398e(0x1ee)])(async()=>{await sendDialogflowAwswer(_0x55ccbc,_0x16aa44,_0x14807c,_0x543af9,_0x12b36b);},0x1f4,_0x16aa44['id']);_0x275585();}else{if(_0x16e9dc[_0x29398e(0xe6)]===_0x29398e(0x144)){}}}}_0x16aa44[_0x29398e(0x20d)]>0x0&&await _0x2453be[_0x29398e(0xf9)]({'queueId':_0x16aa44[_0x29398e(0x20d)]});if(getTypeMessage(_0x14807c)==='audioMessage'&&!_0x14807c[_0x29398e(0xf8)][_0x29398e(0x127)]&&!_0x3ac5e7&&!_0x543af9?.['acceptAudioMessage']&&_0x58a253?.[_0x29398e(0xe8)]===_0x29398e(0x149)){const _0xbe894a=await _0x55ccbc[_0x29398e(0x187)](_0x543af9['number']+_0x29398e(0x11d),{'text':_0x29398e(0x1d0)},{'quoted':{'key':_0x14807c[_0x29398e(0xf8)],'message':{'extendedTextMessage':_0x14807c[_0x29398e(0x17a)][_0x29398e(0x124)]}}});await(0x0,exports[_0x29398e(0x16a)])(_0xbe894a,_0x16aa44,_0x543af9,_0x2453be);}try{if(!_0x14807c[_0x29398e(0xf8)][_0x29398e(0x127)]&&_0x58a253?.[_0x29398e(0xe9)]&&_0x16aa44[_0x29398e(0x20d)]!==null){const _0x362cbd=await Queue_1[_0x29398e(0x18a)][_0x29398e(0x1e0)](_0x16aa44[_0x29398e(0x20d)]);_0x58a253?.[_0x29398e(0xe9)]===_0x29398e(0x113)&&(_0x23ac08=await(0x0,VerifyCurrentSchedule_1[_0x29398e(0x18a)])(_0x56c337,_0x362cbd['id']));if(_0x58a253?.[_0x29398e(0xe9)]===_0x29398e(0x113)&&!(0x0,lodash_1[_0x29398e(0x1a4)])(_0x23ac08)&&(!_0x23ac08||_0x23ac08[_0x29398e(0x222)]===![])){const _0xc92f29=_0x362cbd['outOfHoursMessage'];if(_0xc92f29!==''){const _0x341efa=(0x0,Mustache_1['default'])(''+_0xc92f29,_0x16aa44),_0xbaca9f=(0x0,Debounce_1['debounce'])(async()=>{const _0x264c1f=_0x29398e;await _0x55ccbc[_0x264c1f(0x187)](_0x16aa44[_0x264c1f(0xd7)][_0x264c1f(0x158)]+'@'+(_0x16aa44['isGroup']?_0x264c1f(0x1b5):_0x264c1f(0x1d2)),{'text':_0x341efa});},0x3e8,_0x16aa44['id']);_0xbaca9f(),await _0x16aa44[_0x29398e(0xf9)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x16aa44[_0x29398e(0x18d)]+0x1});return;}await _0x16aa44[_0x29398e(0xf9)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x16aa44[_0x29398e(0x18d)]+0x1});return;}}}catch(_0x28537a){Sentry[_0x29398e(0x173)](_0x28537a),console[_0x29398e(0x19f)](_0x28537a);}_0x16aa44['queue']&&_0x16aa44[_0x29398e(0x20d)]&&!_0x14807c[_0x29398e(0xf8)][_0x29398e(0x127)]&&((!_0x16aa44[_0x29398e(0x118)]||_0x16aa44[_0x29398e(0x113)]?.[_0x29398e(0x21a)]?.[_0x29398e(0x189)]>0x0)&&await(0x0,ChatBotListener_1[_0x29398e(0x13d)])(_0x16aa44['queueId'],_0x55ccbc,_0x16aa44,_0x543af9,_0x14807c),await _0x16aa44['update']({'sendInactiveMessage':![]})),await _0x16aa44[_0x29398e(0xf7)]();}catch(_0x3c393e){Sentry['captureException'](_0x3c393e),console[_0x29398e(0x19f)](_0x3c393e),logger_1[_0x29398e(0x152)][_0x29398e(0x102)](_0x29398e(0x10b)+_0x3c393e);}};exports[a569_0x5b4444(0x176)]=handleMessage;const handleMsgAck=async(_0x2d2969,_0x306ca8)=>{const _0xce369d=a569_0x5b4444;await new Promise(_0x511691=>setTimeout(_0x511691,0x1f4));const _0x2ba83d=(0x0,socket_1['getIO'])();try{const _0x461086=await Message_1['default'][_0xce369d(0x16e)]({'where':{'wid':_0x2d2969[_0xce369d(0xf8)]['id']},'include':[_0xce369d(0xd7),{'model':Message_1['default'],'as':_0xce369d(0x221),'include':['contact']}]});if(!_0x461086)return;await _0x461086['update']({'ack':_0x306ca8}),_0x2ba83d['to'](_0x461086[_0xce369d(0x211)]['toString']())[_0xce369d(0xd3)](_0xce369d(0xfc)+_0x461086[_0xce369d(0x177)]+'-appMessage',{'action':_0xce369d(0xf9),'message':_0x461086});}catch(_0x26cff3){Sentry[_0xce369d(0x173)](_0x26cff3),logger_1[_0xce369d(0x152)]['error']('Error\x20handling\x20message\x20ack.\x20Err:\x20'+_0x26cff3);}},verifyRecentCampaign=async(_0x259324,_0x3211f3)=>{const _0x5024cf=a569_0x5b4444;if(!isValidMsg(_0x259324))return;if(!_0x259324[_0x5024cf(0xf8)][_0x5024cf(0x127)]){const _0x3add56=_0x259324[_0x5024cf(0xf8)][_0x5024cf(0x208)][_0x5024cf(0x135)](/\D/g,''),_0x25e9c1=await Campaign_1[_0x5024cf(0x18a)][_0x5024cf(0x137)]({'where':{'companyId':_0x3211f3,'status':_0x5024cf(0x1a0),'confirmation':!![]}});if(_0x25e9c1){const _0x28f97d=_0x25e9c1[_0x5024cf(0x14d)](_0x27ae9a=>_0x27ae9a['id']),_0xcf67d8=await CampaignShipping_1[_0x5024cf(0x18a)][_0x5024cf(0x16e)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x28f97d},'number':_0x3add56,'confirmation':null}});_0xcf67d8&&(await _0xcf67d8[_0x5024cf(0xf9)]({'confirmedAt':(0x0,moment_1[_0x5024cf(0x18a)])(),'confirmation':!![]}),await queues_1['campaignQueue'][_0x5024cf(0x13a)](_0x5024cf(0x1ff),{'campaignShippingId':_0xcf67d8['id'],'campaignId':_0xcf67d8[_0x5024cf(0x186)]},{'delay':(0x0,queues_1['parseToMilliseconds'])((0x0,queues_1['randomValue'])(0x0,0xa))}));}}},verifyCampaignMessageAndCloseTicket=async(_0xedd8fb,_0x12eba9,_0x4b3d9a)=>{const _0x47964c=a569_0x5b4444;if(!isValidMsg(_0xedd8fb))return;let _0x28a827;_0x28a827=await getContactMessage(_0xedd8fb,_0x4b3d9a);const _0x493b54=await verifyContact(_0x28a827,_0x4b3d9a,_0x12eba9),_0xf39db5=(0x0,socket_1[_0x47964c(0x17b)])(),_0x1e0d4d=await(0x0,exports[_0x47964c(0x12a)])(_0xedd8fb),_0x4f0887=/\u200c/[_0x47964c(0x1dd)](_0x1e0d4d);if(_0xedd8fb['key'][_0x47964c(0x127)]&&_0x4f0887){const _0x28a456=await Message_1[_0x47964c(0x18a)]['findOne']({'where':{[sequelize_1['Op']['or']]:[{'wid':_0xedd8fb[_0x47964c(0xf8)]['id']},{'contactId':_0x493b54['id']}],'companyId':_0x12eba9}});if(!(0x0,lodash_1[_0x47964c(0x1b7)])(_0x28a456)||!(0x0,lodash_1[_0x47964c(0x1a4)])(_0x28a456)||_0x28a456!==null){const _0x1655c6=await Ticket_1[_0x47964c(0x18a)][_0x47964c(0x1e0)](_0x28a456[_0x47964c(0x211)]);await _0x1655c6['update']({'status':_0x47964c(0x192),'amountUsedBotQueues':0x0,'amountUseOutOfHours':0x0}),_0xf39db5['to']('open')[_0x47964c(0xd3)](_0x47964c(0xfc)+_0x1655c6[_0x47964c(0x177)]+'-ticket',{'action':_0x47964c(0xd9),'ticket':_0x1655c6,'ticketId':_0x1655c6['id']}),_0xf39db5['to'](_0x1655c6[_0x47964c(0x12d)])['to'](_0x1655c6['id'][_0x47964c(0x21c)]())[_0x47964c(0xd3)](_0x47964c(0xfc)+_0x1655c6[_0x47964c(0x177)]+'-ticket',{'action':'update','ticket':_0x1655c6,'ticketId':_0x1655c6['id']});}}},filterMessages=_0x474990=>{const _0x3a5566=a569_0x5b4444;if(_0x474990[_0x3a5566(0x17a)]?.[_0x3a5566(0x104)])return![];if([baileys_1['WAMessageStubType']['REVOKE'],baileys_1[_0x3a5566(0x160)][_0x3a5566(0x123)],baileys_1[_0x3a5566(0x160)][_0x3a5566(0x11e)],baileys_1[_0x3a5566(0x160)]['CIPHERTEXT']][_0x3a5566(0x1d5)](_0x474990[_0x3a5566(0x11a)]))return![];return!![];},wbotMessageListener=(_0xe79763,_0x3004e2)=>{const _0x4bcc6f=a569_0x5b4444;_0xe79763['ev']['on'](_0x4bcc6f(0x100),async _0x29733d=>{const _0x369037=_0x4bcc6f,_0x4cada5=_0x29733d[_0x369037(0x106)][_0x369037(0x132)](filterMessages)['map'](_0x5ccd1b=>_0x5ccd1b);if(!_0x4cada5)return;_0x4cada5['forEach'](async _0xc73d88=>{const _0x18b041=_0x369037,_0x3367ec=await Message_1[_0x18b041(0x18a)]['count']({'where':{'wid':_0xc73d88[_0x18b041(0xf8)]['id'],'companyId':_0x3004e2}});if(!_0x3367ec){let _0x47e3c0=![],_0x37551d=await(0x0,exports[_0x18b041(0x12a)])(_0xc73d88);const _0x27b965=_0xc73d88?.[_0x18b041(0xf8)]?.[_0x18b041(0x127)];if(_0x27b965)_0x47e3c0=/\u200c/['test'](_0x37551d);else{if(/\u200c/[_0x18b041(0x1dd)](_0x37551d))_0x37551d=_0x37551d[_0x18b041(0x135)](/\u200c/,'');logger_1[_0x18b041(0x152)][_0x18b041(0x14f)](_0x18b041(0x1f3)+_0x37551d);}!_0x47e3c0&&await handleMessage(_0xc73d88,_0xe79763,_0x3004e2),await verifyRecentCampaign(_0xc73d88,_0x3004e2),await verifyCampaignMessageAndCloseTicket(_0xc73d88,_0x3004e2,_0xe79763);}_0xc73d88['key']['remoteJid']?.[_0x18b041(0x18c)](_0x18b041(0x15b))&&handleMsgAck(_0xc73d88,0x2);});}),_0xe79763['ev']['on'](_0x4bcc6f(0x157),_0x5626de=>{const _0x4062c0=_0x4bcc6f;if(_0x5626de[_0x4062c0(0x189)]===0x0)return;_0x5626de['forEach'](async _0x1139cc=>{const _0x25760e=_0x4062c0;_0xe79763[_0x25760e(0x1d1)]([_0x1139cc[_0x25760e(0xf8)]]);const _0x51d318={..._0x5626de};_0x51d318['0']?.[_0x25760e(0xf9)]['messageStubType']===0x1&&_0x51d318['0']?.[_0x25760e(0xf8)]['remoteJid']!=='status@broadcast'&&(0x0,MarkDeleteWhatsAppMessage_1[_0x25760e(0x18a)])(_0x51d318['0']?.[_0x25760e(0xf8)][_0x25760e(0x208)],null,_0x51d318['0']?.['key']['id'],_0x3004e2);let _0x569e0d;_0x1139cc[_0x25760e(0xf9)][_0x25760e(0x12d)]===0x3&&_0x1139cc?.['key']?.[_0x25760e(0x127)]?_0x569e0d=0x2:_0x569e0d=_0x1139cc[_0x25760e(0xf9)]['status'],handleMsgAck(_0x1139cc,_0x569e0d);});}),_0xe79763['ev']['on']('groups.update',_0x130b31=>{const _0x5dc1d5=_0x4bcc6f;if(_0x130b31['length']===0x0)return;_0x130b31[_0x5dc1d5(0x150)](async _0x15f3cb=>{const _0x13e0e1=_0x5dc1d5,_0x39e21a=_0x15f3cb['id'][_0x13e0e1(0x135)](/\D/g,''),_0x2136b7=_0x15f3cb[_0x13e0e1(0x140)]||_0x39e21a,_0x35f810={'name':_0x2136b7,'number':_0x39e21a,'isGroup':!![],'companyId':_0x3004e2},_0x26ba71=await(0x0,CreateOrUpdateContactService_1['default'])(_0x35f810);});});};exports[a569_0x5b4444(0x1e9)]=wbotMessageListener;