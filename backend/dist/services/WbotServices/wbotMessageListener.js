'use strict';const a552_0xe4db4f=a552_0x3697;(function(_0x5789a7,_0x35f303){const _0x1687d1=a552_0x3697,_0x120dc0=_0x5789a7();while(!![]){try{const _0x3aa6cd=parseInt(_0x1687d1(0x2a0))/0x1*(-parseInt(_0x1687d1(0x285))/0x2)+-parseInt(_0x1687d1(0x22f))/0x3+parseInt(_0x1687d1(0x291))/0x4+parseInt(_0x1687d1(0x292))/0x5+-parseInt(_0x1687d1(0x245))/0x6+parseInt(_0x1687d1(0x235))/0x7+parseInt(_0x1687d1(0x2eb))/0x8;if(_0x3aa6cd===_0x35f303)break;else _0x120dc0['push'](_0x120dc0['shift']());}catch(_0x33407b){_0x120dc0['push'](_0x120dc0['shift']());}}}(a552_0x38d9,0x6bc2a));var __createBinding=this&&this['__createBinding']||(Object[a552_0xe4db4f(0x24e)]?function(_0x65f46,_0x500b84,_0x4fc4a5,_0x2c4eb5){const _0x4151bc=a552_0xe4db4f;if(_0x2c4eb5===undefined)_0x2c4eb5=_0x4fc4a5;var _0x571c56=Object[_0x4151bc(0x286)](_0x500b84,_0x4fc4a5);(!_0x571c56||(_0x4151bc(0x2d4)in _0x571c56?!_0x500b84[_0x4151bc(0x2aa)]:_0x571c56[_0x4151bc(0x2d6)]||_0x571c56[_0x4151bc(0x2ad)]))&&(_0x571c56={'enumerable':!![],'get':function(){return _0x500b84[_0x4fc4a5];}}),Object[_0x4151bc(0x273)](_0x65f46,_0x2c4eb5,_0x571c56);}:function(_0x1ae68b,_0x1ded43,_0x4f0114,_0x32502e){if(_0x32502e===undefined)_0x32502e=_0x4f0114;_0x1ae68b[_0x32502e]=_0x1ded43[_0x4f0114];}),__setModuleDefault=this&&this[a552_0xe4db4f(0x284)]||(Object[a552_0xe4db4f(0x24e)]?function(_0x3837f1,_0xe13d52){const _0x3532bb=a552_0xe4db4f;Object[_0x3532bb(0x273)](_0x3837f1,'default',{'enumerable':!![],'value':_0xe13d52});}:function(_0x647c0f,_0x41add8){const _0xfc892a=a552_0xe4db4f;_0x647c0f[_0xfc892a(0x23c)]=_0x41add8;}),__importStar=this&&this['__importStar']||function(_0x20cb95){const _0x2e13a1=a552_0xe4db4f;if(_0x20cb95&&_0x20cb95[_0x2e13a1(0x2aa)])return _0x20cb95;var _0x3066d4={};if(_0x20cb95!=null){for(var _0x30ca05 in _0x20cb95)if(_0x30ca05!==_0x2e13a1(0x23c)&&Object[_0x2e13a1(0x1fe)][_0x2e13a1(0x301)][_0x2e13a1(0x1f8)](_0x20cb95,_0x30ca05))__createBinding(_0x3066d4,_0x20cb95,_0x30ca05);}return __setModuleDefault(_0x3066d4,_0x20cb95),_0x3066d4;},__importDefault=this&&this['__importDefault']||function(_0x2a7c7c){const _0x564c26=a552_0xe4db4f;return _0x2a7c7c&&_0x2a7c7c[_0x564c26(0x2aa)]?_0x2a7c7c:{'default':_0x2a7c7c};};Object[a552_0xe4db4f(0x273)](exports,'__esModule',{'value':!![]}),exports[a552_0xe4db4f(0x297)]=exports[a552_0xe4db4f(0x2f3)]=exports['handleMessage']=exports[a552_0xe4db4f(0x2de)]=exports[a552_0xe4db4f(0x2e4)]=exports['verifyRating']=exports[a552_0xe4db4f(0x288)]=exports[a552_0xe4db4f(0x28d)]=exports[a552_0xe4db4f(0x254)]=exports[a552_0xe4db4f(0x222)]=void 0x0;const path_1=__importStar(require(a552_0xe4db4f(0x212))),util_1=require(a552_0xe4db4f(0x2d7)),fs_1=require('fs'),fs_2=__importDefault(require('fs')),Sentry=__importStar(require('@sentry/node')),lodash_1=require('lodash'),baileys_1=require(a552_0xe4db4f(0x2f9)),Contact_1=__importDefault(require(a552_0xe4db4f(0x2e5))),Ticket_1=__importDefault(require('../../models/Ticket')),Message_1=__importDefault(require('../../models/Message')),socket_1=require(a552_0xe4db4f(0x29d)),CreateMessageService_1=__importDefault(require(a552_0xe4db4f(0x232))),logger_1=require(a552_0xe4db4f(0x27e)),CreateOrUpdateContactService_1=__importDefault(require(a552_0xe4db4f(0x206))),FindOrCreateTicketService_1=__importDefault(require(a552_0xe4db4f(0x2ff))),ShowWhatsAppService_1=__importDefault(require(a552_0xe4db4f(0x258))),Debounce_1=require(a552_0xe4db4f(0x25e)),UpdateTicketService_1=__importDefault(require(a552_0xe4db4f(0x287))),Mustache_1=__importDefault(require('../../helpers/Mustache')),UserRating_1=__importDefault(require(a552_0xe4db4f(0x21e))),SendWhatsAppMessage_1=__importDefault(require(a552_0xe4db4f(0x2e7))),sendFacebookMessage_1=__importDefault(require('../FacebookServices/sendFacebookMessage')),moment_1=__importDefault(require(a552_0xe4db4f(0x246))),Queue_1=__importDefault(require(a552_0xe4db4f(0x2ea))),FindOrCreateATicketTrakingService_1=__importDefault(require(a552_0xe4db4f(0x2b6))),VerifyCurrentSchedule_1=__importDefault(require(a552_0xe4db4f(0x205))),Campaign_1=__importDefault(require(a552_0xe4db4f(0x30b))),CampaignShipping_1=__importDefault(require(a552_0xe4db4f(0x2ce))),sequelize_1=require(a552_0xe4db4f(0x2cc)),queues_1=require('../../queues'),User_1=__importDefault(require('../../models/User')),Setting_1=__importDefault(require(a552_0xe4db4f(0x2c9))),ChatBotListener_1=require(a552_0xe4db4f(0x1ff)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a552_0xe4db4f(0x2c3))),ListUserQueueServices_1=__importDefault(require('../UserQueueServices/ListUserQueueServices')),cache_1=__importDefault(require('../../libs/cache')),ListSettingsService_1=__importDefault(require(a552_0xe4db4f(0x2a3))),addLogs_1=require('../../helpers/addLogs'),SendWhatsAppMedia_1=require('./SendWhatsAppMedia');let i=0x0;setInterval(()=>{i=0x0;},0x1388);const writeFileAsync=(0x0,util_1[a552_0xe4db4f(0x227)])(fs_1[a552_0xe4db4f(0x29a)]);function removeFile(_0x1ff5b4){const _0x174473=a552_0xe4db4f;fs_2[_0x174473(0x23c)][_0x174473(0x1f2)](_0x1ff5b4,_0x4f3355=>{if(_0x4f3355)throw _0x4f3355;});}const getTimestampMessage=_0x5c2847=>{return _0x5c2847*0x1;},multVecardGet=function(_0x15efd8){const _0x75437=a552_0xe4db4f;let _0xd06486='\x20',_0x4b84fc=_0x15efd8['split']('\x0a')[0x2][_0x75437(0x2c7)](';;;','\x0a')[_0x75437(0x2c7)]('N:','')[_0x75437(0x2c7)](';','')[_0x75437(0x2c7)](';','\x20')[_0x75437(0x2c7)](';;','\x20')[_0x75437(0x2c7)]('\x0a',''),_0x4f2b68=_0x15efd8['split']('\x0a')[0x4][_0x75437(0x200)]('='),_0xa92fbb=_0x15efd8[_0x75437(0x1f4)]('\x0a')[0x4][_0x75437(0x200)](':'),_0x3760fd=_0x15efd8[_0x75437(0x1f4)]('\x0a')[0x4][_0x75437(0x300)](_0x4f2b68+0x1,_0xa92fbb)[_0x75437(0x2c7)](';',''),_0x1013a4=_0x15efd8[_0x75437(0x1f4)]('\x0a')[0x4][_0x75437(0x2c7)](_0x75437(0x265),'');if(_0x3760fd!=_0x75437(0x207))_0xd06486=_0xd06486+_0x4b84fc+_0x75437(0x243)+_0x3760fd+''+'\x0a';else _0xd06486=_0xd06486+_0x4b84fc+_0x75437(0x243)+_0x1013a4+''+'\x0a';return _0xd06486;},contactsArrayMessageGet=_0x553af8=>{const _0xc247ff=a552_0xe4db4f;let _0x43589a=_0x553af8[_0xc247ff(0x2fd)]?.[_0xc247ff(0x2fa)]?.['contacts'],_0x10ea36=_0x43589a[_0xc247ff(0x302)](function(_0x489031,_0x6052b2){return _0x489031['vcard'];}),_0x4f8a0a='';_0x10ea36['forEach'](function(_0x365840,_0x1d1a93){_0x4f8a0a+=_0x365840+'\x0a\x0a'+'';});let _0x549c65=_0x4f8a0a[_0xc247ff(0x1f4)](_0xc247ff(0x240));_0x549c65['shift']();let _0x24e1c5='';for(let _0x1bd3e5 of _0x549c65){_0x24e1c5=_0x24e1c5+multVecardGet(_0x1bd3e5);}return _0x24e1c5;},getTypeMessage=_0x46abf7=>{const _0x2b83c8=a552_0xe4db4f,_0x2d821c=(0x0,baileys_1[_0x2b83c8(0x262)])(_0x46abf7['message']);if(_0x46abf7[_0x2b83c8(0x2fd)]?.[_0x2b83c8(0x30d)])return'viewOnceMessageV2';return _0x2d821c;};function a552_0x38d9(){const _0xd9d6db=['3608836AUDkKU','templateButtonReplyMessage','set','-ticket','queueId','description','forEach','default','buttonText','contact','Mensagem','BEGIN:','amountUsedBotQueues','verifyRating',':\x20ðŸ“ž','Sair','2948808LCgNVS','moment','selectedRowId','chmodSync','companyId','singleSelectReply','Error\x20handling\x20message\x20ack.\x20Err:\x20','participant','getTime','create','extendedTextMessage','update','base64','audioMessage','extractMessageContent','getQuotedMessage','buffer','listMessage','Menu','../WhatsappService/ShowWhatsAppService','allowGroup','lgpd','\x20|\x20https://maps.google.com/maps?q=','destroy','isInteger','../../helpers/Debounce','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','chatBotType','randomValue','getContentType','@g.us','messageStubType','item1.TEL:','lgpdSendMessageAt','findByPk','messageTimestamp','ratingMessage','campaignQueue','subject','buttons','locationMessage','imported',':unreads','public','stanzaId','chatbots','defineProperty','nps','name','mkdirSync','contextInfo','/nopicture.png','sticker','debounce','chatbotAt','downloadMediaMessage','lgpdAcceptedAt','../../utils/logger','log','sendGreetingMessageOneQueues','Ãudio','number','m4a','__setModuleDefault','8uwOIdC','getOwnPropertyDescriptor','../TicketServices/UpdateTicketService','verifyMessage','stickerMessage','sendMessage','delay','setMinutes','getQuotedMessageId','button','closedAt','findOne','1380116xSsWod','945015gkbYxI','ERR_WAPP_DOWNLOAD_MEDIA','company','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','editedMessage','getTypeMessage','REVOKE','length','writeFile','warn','closed','../../libs/socket','resolve','isNil','112570eHnZZm','senderKeyDistributionMessage','rows','../SettingServices/ListSettingsService','delete','*\x20-\x20','isNull','endsWith','getMessageOptions','conversation','__esModule','quotedMessage','Erro\x20ao\x20baixar\x20mÃ­dia:','configurable','includes','captureException','emit','Falha\x20ao\x20fazer\x20o\x20download\x20de\x20uma\x20mensagem\x20importada,\x20provavelmente\x20a\x20mensagem\x20jÃ¡\x20nÃ£o\x20esta\x20mais\x20disponÃ­vel','floor','Latitude:\x20','degreesLongitude','keys','../TicketServices/FindOrCreateATicketTrakingService','profilePictureUrl','sayChatbot','pop','disableBot','contacts:','status','enableLGPD','whatsappId','quotedMsg','acceptAudioMessage','lgpdLink','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','./MarkDeleteWhatsAppMessage','reaction','company-','E2E_IDENTITY_CHANGED','replace','normalize','../../models/Setting','count','userId','sequelize','g.us','../../models/CampaignShipping','degreesLatitude','toString','setExtra','Escolha\x20uma\x20opÃ§Ã£o','####\x20Nao\x20achou\x20o\x20type\x20152:\x20','get','voiceMessage','writable','util','ticketId','*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posiÃ§Ã£o\x20na\x20fila\x20de\x20atendimento\x20Ã©:\x20*','lgpdConsent','join','campaignId','Erro\x20ao\x20baixar\x20media','wbotMessageListener','text','messages','outOfHoursMessage','NFD','existsSync','handleRating','../../models/Contact','toDate','./SendWhatsAppMessage','greetingMediaAttachment','push','../../models/Queue','7142376FYjRmp','vcard','mimetype','data:image/png;base64,\x20','*[\x20','contactId','test','Importando\x20Mensagem:\x20','isValidMsg','DispatchCampaign','toISOString','jidNormalizedUser','sendQueuePosition','maxUseBotQueues','@whiskeysockets/baileys','contactsArrayMessage','logger','&z=17&hl=pt-BR|','message','next','../TicketServices/FindOrCreateTicketService','substring','hasOwnProperty','map','FRONTEND_URL','videoMessage','greetingMessage','stringify','liveLocationMessage','queue','Erro\x20media','scheduleType','../../models/Campaign','slice','viewOnceMessageV2','>>>>>>>>>>>>>>>>>>>','disabled','buttonsResponseMessage','selectedId','mediaMessage','WAMessageStubType','audio/mp4','title','remoteJid','displayText','error','*System:*\x20\x0aFalha\x20no\x20download\x20da\x20mÃ­dia\x20verifique\x20no\x20dispositivo','protocolMessage','inActivity','unlink','amountUseBotQueuesNPS','split','values','acceptAudioMessageContact','list','call','reactionMessage','timeUseBotQueues','data','filter','documentMessage','prototype','./ChatBotListener','indexOf','isGroup','E2E_DEVICE_CHANGED','ratingAt','buttonsMessage','../CompanyService/VerifyCurrentSchedule','../ContactServices/CreateOrUpdateContactService','item1.TEL','-appMessage','find','instagram','fromMe','EM_ANDAMENTO','reload','caption','complationMessage','isNaN','filename','path','whatsapp','value','selectedButtonId','channel','ephemeralMessage','sections','getIO','debug','contentText','pushName','groups.update','../../models/UserRating','documentWithCaptionMessage','enabled','contactMessage','getBodyMessage','Error\x20isValidMsg','key','image','queues','promisify','Esta\x20mensagem\x20jÃ¡\x20existe','pending','lgpdMessage','maxUseBotQueuesNPS','user','imageMessage','getMinutes','1677729theeiR','s.whatsapp.net','@c.us','../MessageServices/CreateMessageService','listResponseMessage','viewOnceMessage'];a552_0x38d9=function(){return _0xd9d6db;};return a552_0x38d9();}exports[a552_0xe4db4f(0x297)]=getTypeMessage;const getBodyButton=_0x13e800=>{const _0x2d7904=a552_0xe4db4f;if(_0x13e800['key'][_0x2d7904(0x20b)]&&_0x13e800[_0x2d7904(0x2fd)][_0x2d7904(0x204)]?.[_0x2d7904(0x21b)]){let _0x12f88c=''+_0x13e800?.[_0x2d7904(0x2fd)]?.[_0x2d7904(0x204)]?.[_0x2d7904(0x21b)];for(const _0xc2fe9e of _0x13e800['message']?.[_0x2d7904(0x204)]?.[_0x2d7904(0x26c)]){_0x12f88c+='\x0a\x0a'+_0xc2fe9e[_0x2d7904(0x23d)]?.[_0x2d7904(0x1ed)];}return _0x12f88c;}if(_0x13e800[_0x2d7904(0x224)][_0x2d7904(0x20b)]&&_0x13e800?.['message']?.['viewOnceMessage']?.[_0x2d7904(0x2fd)]?.[_0x2d7904(0x256)]){let _0xd24e17=''+_0x13e800?.[_0x2d7904(0x2fd)]?.['viewOnceMessage']?.[_0x2d7904(0x2fd)]?.[_0x2d7904(0x256)]?.[_0x2d7904(0x23a)];for(const _0x1d8c13 of _0x13e800[_0x2d7904(0x2fd)]?.[_0x2d7904(0x234)]?.[_0x2d7904(0x2fd)]?.[_0x2d7904(0x256)]?.[_0x2d7904(0x218)]){for(const _0x2a559f of _0x1d8c13[_0x2d7904(0x2a2)]){_0xd24e17+='\x0a\x0a'+_0x2a559f[_0x2d7904(0x315)];}}return _0xd24e17;}},getBodyList=_0x5b1a76=>{const _0x1bb495=a552_0xe4db4f;if(_0x5b1a76['key'][_0x1bb495(0x20b)]&&_0x5b1a76[_0x1bb495(0x2fd)][_0x1bb495(0x256)]?.[_0x1bb495(0x23a)]){let _0x1abc26=''+_0x5b1a76[_0x1bb495(0x2fd)][_0x1bb495(0x256)]?.[_0x1bb495(0x23a)];for(const _0x3a8783 of _0x5b1a76['message']['listMessage']?.[_0x1bb495(0x218)]){for(const _0x38ca2c of _0x3a8783[_0x1bb495(0x2a2)]){_0x1abc26+='\x0a\x0a'+_0x38ca2c['title'];}}return _0x1abc26;}if(_0x5b1a76[_0x1bb495(0x224)][_0x1bb495(0x20b)]&&_0x5b1a76?.['message']?.['viewOnceMessage']?.[_0x1bb495(0x2fd)]?.[_0x1bb495(0x256)]){let _0xc969eb=''+_0x5b1a76?.['message']?.[_0x1bb495(0x234)]?.['message']?.[_0x1bb495(0x256)]?.[_0x1bb495(0x23a)];for(const _0x3e3b95 of _0x5b1a76[_0x1bb495(0x2fd)]?.[_0x1bb495(0x234)]?.['message']?.['listMessage']?.[_0x1bb495(0x218)]){for(const _0xaae24 of _0x3e3b95[_0x1bb495(0x2a2)]){_0xc969eb+='\x0a\x0a'+_0xaae24['title'];}}return _0xc969eb;}},msgLocation=(_0x57bb9e,_0x167dbc,_0x4e11b7)=>{const _0x4ae199=a552_0xe4db4f;if(_0x57bb9e){var _0x17945c=Buffer['from'](_0x57bb9e)['toString'](_0x4ae199(0x251));let _0x9d103d=_0x4ae199(0x2ee)+_0x17945c+_0x4ae199(0x25b)+_0x167dbc+'%2C'+_0x4e11b7+_0x4ae199(0x2fc)+_0x167dbc+',\x20'+_0x4e11b7+'\x20';return _0x9d103d;}},getBodyMessage=_0x2a6cc6=>{const _0x419152=a552_0xe4db4f;try{let _0x1b318d=getTypeMessage(_0x2a6cc6);const _0x40d049={'conversation':_0x2a6cc6['message']?.[_0x419152(0x2a9)],'imageMessage':_0x2a6cc6['message']?.[_0x419152(0x22d)]?.[_0x419152(0x20e)],'videoMessage':_0x2a6cc6['message']?.[_0x419152(0x304)]?.[_0x419152(0x20e)],'extendedTextMessage':_0x2a6cc6?.[_0x419152(0x2fd)]?.[_0x419152(0x24f)]?.[_0x419152(0x2df)],'buttonsResponseMessage':_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x310)]?.['selectedDisplayText'],'listResponseMessage':_0x2a6cc6[_0x419152(0x2fd)]?.['listResponseMessage']?.['title']||_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x233)]?.[_0x419152(0x24a)]?.[_0x419152(0x247)],'templateButtonReplyMessage':_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x236)]?.[_0x419152(0x311)],'messageContextInfo':_0x2a6cc6['message']?.[_0x419152(0x310)]?.['selectedButtonId']||_0x2a6cc6[_0x419152(0x2fd)]?.['listResponseMessage']?.[_0x419152(0x315)],'buttonsMessage':getBodyButton(_0x2a6cc6)||_0x2a6cc6['message']?.[_0x419152(0x233)]?.[_0x419152(0x315)],'stickerMessage':_0x419152(0x279),'contactMessage':_0x2a6cc6[_0x419152(0x2fd)]?.['contactMessage']?.[_0x419152(0x2ec)],'contactsArrayMessage':_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x2fa)]?.['contacts']&&contactsArrayMessageGet(_0x2a6cc6),'locationMessage':msgLocation(_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x26d)]?.['jpegThumbnail'],_0x2a6cc6['message']?.[_0x419152(0x26d)]?.[_0x419152(0x2cf)],_0x2a6cc6[_0x419152(0x2fd)]?.['locationMessage']?.['degreesLongitude']),'liveLocationMessage':_0x419152(0x2b3)+_0x2a6cc6['message']?.[_0x419152(0x307)]?.[_0x419152(0x2cf)]+'\x20-\x20Longitude:\x20'+_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x307)]?.[_0x419152(0x2b4)],'documentMessage':_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x1fd)]?.[_0x419152(0x315)],'audioMessage':_0x419152(0x281),'listMessage':getBodyList(_0x2a6cc6)||_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x233)]?.[_0x419152(0x315)],'viewOnceMessage':getBodyButton(_0x2a6cc6),'reactionMessage':_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x1f9)]?.[_0x419152(0x2df)]||_0x419152(0x2c4),'senderKeyDistributionMessage':_0x2a6cc6?.['message']?.[_0x419152(0x2a1)]?.['axolotlSenderKeyDistributionMessage'],'documentWithCaptionMessage':_0x2a6cc6['message']?.['documentWithCaptionMessage']?.[_0x419152(0x2fd)]?.['documentMessage']?.['caption'],'viewOnceMessageV2':_0x2a6cc6['message']?.['viewOnceMessageV2']?.['message']?.[_0x419152(0x22d)]?.[_0x419152(0x20e)],'editedMessage':_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x296)]?.[_0x419152(0x2fd)]?.[_0x419152(0x24f)]?.['text'],'ephemeralMessage':_0x2a6cc6[_0x419152(0x2fd)]?.[_0x419152(0x217)]?.[_0x419152(0x2fd)]?.[_0x419152(0x24f)]?.[_0x419152(0x2df)]},_0x4466ec=Object[_0x419152(0x2b5)](_0x40d049)[_0x419152(0x209)](_0x23ebd4=>_0x23ebd4===_0x1b318d);return!_0x4466ec&&(logger_1[_0x419152(0x2fb)][_0x419152(0x29b)](_0x419152(0x2d3)+_0x1b318d+'\x0a'+JSON[_0x419152(0x306)](_0x2a6cc6)),Sentry['setExtra']('Mensagem',{'BodyMsg':_0x2a6cc6['message'],'msg':_0x2a6cc6,'type':_0x1b318d}),Sentry['captureException'](new Error('Novo\x20Tipo\x20de\x20Mensagem\x20em\x20getTypeMessage'))),_0x40d049[_0x1b318d];}catch(_0x204b6c){Sentry['setExtra']('Error\x20getTypeMessage',{'msg':_0x2a6cc6,'BodyMsg':_0x2a6cc6[_0x419152(0x2fd)]}),Sentry[_0x419152(0x2af)](_0x204b6c),console[_0x419152(0x27f)](_0x204b6c);}};exports['getBodyMessage']=getBodyMessage;const getQuotedMessage=_0xed21dc=>{const _0x4c9ce0=a552_0xe4db4f,_0x54f9f6=(0x0,baileys_1[_0x4c9ce0(0x253)])(_0xed21dc['message'])[Object[_0x4c9ce0(0x2b5)](_0xed21dc?.[_0x4c9ce0(0x2fd)])[_0x4c9ce0(0x1f5)]()[_0x4c9ce0(0x2fe)]()[_0x4c9ce0(0x214)]];if(!_0x54f9f6?.[_0x4c9ce0(0x277)]?.['quotedMessage'])return;const _0x222b2a=(0x0,baileys_1['extractMessageContent'])(_0x54f9f6?.[_0x4c9ce0(0x277)]?.['quotedMessage'][Object['keys'](_0x54f9f6?.[_0x4c9ce0(0x277)]?.[_0x4c9ce0(0x2ab)])[_0x4c9ce0(0x1f5)]()[_0x4c9ce0(0x2fe)]()[_0x4c9ce0(0x214)]]);return _0x222b2a;};function a552_0x3697(_0x1e1109,_0x174d85){const _0x38d91c=a552_0x38d9();return a552_0x3697=function(_0x369795,_0x5a8174){_0x369795=_0x369795-0x1ec;let _0x298188=_0x38d91c[_0x369795];return _0x298188;},a552_0x3697(_0x1e1109,_0x174d85);}exports[a552_0xe4db4f(0x254)]=getQuotedMessage;const getQuotedMessageId=_0x51f6f7=>{const _0x42b793=a552_0xe4db4f,_0x2a81c8=(0x0,baileys_1[_0x42b793(0x253)])(_0x51f6f7['message'])[Object[_0x42b793(0x2b5)](_0x51f6f7?.['message'])[_0x42b793(0x1f5)]()[_0x42b793(0x2fe)]()['value']];let _0x2c1d2f=_0x51f6f7?.[_0x42b793(0x2fd)]?.[_0x42b793(0x1f9)]?_0x51f6f7?.[_0x42b793(0x2fd)]?.[_0x42b793(0x1f9)]?.[_0x42b793(0x224)]?.['id']:'';return _0x2c1d2f?_0x2c1d2f:_0x2a81c8?.[_0x42b793(0x277)]?.[_0x42b793(0x271)];};exports[a552_0xe4db4f(0x28d)]=getQuotedMessageId;const getMeSocket=_0x2bf9e5=>{const _0x45387b=a552_0xe4db4f;return{'id':(0x0,baileys_1[_0x45387b(0x2f6)])(_0x2bf9e5[_0x45387b(0x22c)]['id']),'name':_0x2bf9e5[_0x45387b(0x22c)][_0x45387b(0x275)]};},getSenderMessage=(_0x230464,_0x3d2c2c)=>{const _0x46df83=a552_0xe4db4f,_0x11ecb4=getMeSocket(_0x3d2c2c);if(_0x230464[_0x46df83(0x224)]['fromMe'])return _0x11ecb4['id'];const _0x1967e5=_0x230464[_0x46df83(0x24c)]||_0x230464['key']['participant']||_0x230464['key'][_0x46df83(0x1ec)]||undefined;return _0x1967e5&&(0x0,baileys_1[_0x46df83(0x2f6)])(_0x1967e5);},getContactMessage=async(_0x4c1c09,_0x2f4f70)=>{const _0x21ca45=a552_0xe4db4f,_0x2c9740=_0x4c1c09[_0x21ca45(0x224)][_0x21ca45(0x1ec)][_0x21ca45(0x2ae)](_0x21ca45(0x2cd)),_0x3471de=_0x4c1c09[_0x21ca45(0x224)][_0x21ca45(0x1ec)]['replace'](/\D/g,'');return _0x2c9740?{'id':getSenderMessage(_0x4c1c09,_0x2f4f70),'name':_0x4c1c09['pushName']}:{'id':_0x4c1c09[_0x21ca45(0x224)]['remoteJid'],'name':_0x4c1c09[_0x21ca45(0x224)][_0x21ca45(0x20b)]?_0x3471de:_0x4c1c09[_0x21ca45(0x21c)]};},downloadMedia=async(_0x3591b6,_0x56ac66=null)=>{const _0x31c9e5=a552_0xe4db4f;let _0x46a914;try{_0x46a914=await(0x0,baileys_1[_0x31c9e5(0x27c)])(_0x3591b6,_0x31c9e5(0x255),{});}catch(_0x48f270){_0x56ac66?console[_0x31c9e5(0x27f)](_0x31c9e5(0x2b1)):console[_0x31c9e5(0x1ee)](_0x31c9e5(0x2ac),_0x48f270);}let _0x44ff4b=_0x3591b6[_0x31c9e5(0x2fd)]?.['documentMessage']?.['fileName']||'';const _0x3fd21a=_0x3591b6[_0x31c9e5(0x2fd)]?.['imageMessage']||_0x3591b6[_0x31c9e5(0x2fd)]?.['audioMessage']||_0x3591b6['message']?.[_0x31c9e5(0x304)]||_0x3591b6[_0x31c9e5(0x2fd)]?.[_0x31c9e5(0x289)]||_0x3591b6[_0x31c9e5(0x2fd)]?.['documentMessage']||_0x3591b6[_0x31c9e5(0x2fd)]?.['documentWithCaptionMessage']?.[_0x31c9e5(0x2fd)]?.[_0x31c9e5(0x1fd)]||_0x3591b6['message']?.[_0x31c9e5(0x24f)]?.[_0x31c9e5(0x277)]?.[_0x31c9e5(0x2ab)]?.[_0x31c9e5(0x22d)]||_0x3591b6[_0x31c9e5(0x2fd)]?.[_0x31c9e5(0x24f)]?.[_0x31c9e5(0x277)]?.[_0x31c9e5(0x2ab)]?.[_0x31c9e5(0x304)];if(!_0x3fd21a)console[_0x31c9e5(0x27f)](_0x3591b6);if(!_0x44ff4b){const _0x4a29f4=_0x3fd21a[_0x31c9e5(0x2ed)][_0x31c9e5(0x1f4)]('/')[0x1][_0x31c9e5(0x1f4)](';')[0x0];_0x44ff4b=new Date()[_0x31c9e5(0x24d)]()+'.'+_0x4a29f4;}else _0x44ff4b=new Date()[_0x31c9e5(0x24d)]()+'_'+_0x44ff4b;const _0x14d7dd={'data':_0x46a914,'mimetype':_0x3fd21a[_0x31c9e5(0x2ed)],'filename':_0x44ff4b};return _0x14d7dd;},verifyContact=async(_0x4e5e4b,_0x370b47,_0x4b0877)=>{const _0x1ad8b3=a552_0xe4db4f;let _0x5db0e5;try{_0x5db0e5=await _0x370b47[_0x1ad8b3(0x2b7)](_0x4e5e4b['id'],_0x1ad8b3(0x225));}catch(_0x4f2a0e){Sentry[_0x1ad8b3(0x2af)](_0x4f2a0e),_0x5db0e5=process['env'][_0x1ad8b3(0x303)]+_0x1ad8b3(0x278);}const _0x2e0bdd={'name':_0x4e5e4b[_0x1ad8b3(0x275)]||_0x4e5e4b['id'][_0x1ad8b3(0x2c7)](/\D/g,''),'number':_0x4e5e4b['id'][_0x1ad8b3(0x2c7)](/\D/g,''),'profilePicUrl':_0x5db0e5,'isGroup':_0x4e5e4b['id'][_0x1ad8b3(0x2ae)](_0x1ad8b3(0x2cd)),'companyId':_0x4b0877,'remoteJid':_0x4e5e4b['id']};_0x2e0bdd[_0x1ad8b3(0x201)]&&(_0x2e0bdd['number']=_0x4e5e4b['id'][_0x1ad8b3(0x2c7)](_0x1ad8b3(0x263),''));const _0xe5f43f=(0x0,CreateOrUpdateContactService_1[_0x1ad8b3(0x23c)])(_0x2e0bdd);return _0xe5f43f;},verifyQuotedMessage=async _0x17d734=>{const _0x5f10d8=a552_0xe4db4f;if(!_0x17d734)return null;const _0x4434dc=(0x0,exports[_0x5f10d8(0x28d)])(_0x17d734);if(!_0x4434dc)return null;const _0x15da31=await Message_1[_0x5f10d8(0x23c)][_0x5f10d8(0x290)]({'where':{'wid':_0x4434dc}});if(!_0x15da31)return null;return _0x15da31;},verifyMediaMessage=async(_0xb83cee,_0x58430d,_0x47e9a4,_0xa78bb9)=>{const _0x4655d4=a552_0xe4db4f,_0x7679ea=(0x0,socket_1[_0x4655d4(0x219)])(),_0x15a420=await verifyQuotedMessage(_0xb83cee);try{const _0x26794f=await downloadMedia(_0xb83cee,_0x58430d?.[_0x4655d4(0x26e)]);if(!_0x26794f&&_0x58430d['imported']){const _0x3e6ea2=_0x4655d4(0x1ef),_0x483a61={'wid':_0xb83cee[_0x4655d4(0x224)]['id'],'ticketId':_0x58430d['id'],'contactId':_0xb83cee['key'][_0x4655d4(0x20b)]?undefined:_0x58430d[_0x4655d4(0x2f0)],'body':_0x3e6ea2,'reactionMessage':_0xb83cee[_0x4655d4(0x2fd)]?.[_0x4655d4(0x1f9)],'fromMe':_0xb83cee[_0x4655d4(0x224)][_0x4655d4(0x20b)],'mediaType':getTypeMessage(_0xb83cee),'read':_0xb83cee[_0x4655d4(0x224)][_0x4655d4(0x20b)],'quotedMsgId':_0x15a420?.['id']||_0xb83cee['message']?.[_0x4655d4(0x1f9)]?.[_0x4655d4(0x224)]?.['id'],'ack':_0xb83cee[_0x4655d4(0x2bc)],'companyId':_0x58430d[_0x4655d4(0x249)],'remoteJid':_0xb83cee[_0x4655d4(0x224)]['remoteJid'],'participant':_0xb83cee[_0x4655d4(0x224)][_0x4655d4(0x24c)],'timestamp':getTimestampMessage(_0xb83cee['messageTimestamp']),'createdAt':new Date(Math['floor'](getTimestampMessage(_0xb83cee['messageTimestamp'])*0x3e8))[_0x4655d4(0x2f5)](),'dataJson':JSON[_0x4655d4(0x306)](_0xb83cee),'ticketImported':_0x58430d[_0x4655d4(0x26e)]};return await _0x58430d[_0x4655d4(0x250)]({'lastMessage':_0x3e6ea2}),logger_1['logger'][_0x4655d4(0x1ee)](Error('ERR_WAPP_DOWNLOAD_MEDIA')),(0x0,CreateMessageService_1['default'])({'messageData':_0x483a61,'companyId':_0x58430d['companyId']});}if(!_0x26794f)throw new Error(_0x4655d4(0x293));if(!_0x26794f[_0x4655d4(0x211)]||_0x26794f[_0x4655d4(0x2ed)]===_0x4655d4(0x314)){const _0x4ed723=_0x26794f['mimetype']===_0x4655d4(0x314)?_0x4655d4(0x283):_0x26794f['mimetype'][_0x4655d4(0x1f4)]('/')[0x1][_0x4655d4(0x1f4)](';')[0x0];_0x26794f[_0x4655d4(0x211)]=new Date()['getTime']()+'.'+_0x4ed723;}else{const _0x1b590b=_0x26794f[_0x4655d4(0x211)][_0x4655d4(0x1f4)]('.')[_0x4655d4(0x2b9)](),_0x29cec5=_0x26794f[_0x4655d4(0x211)][_0x4655d4(0x1f4)]('.')[_0x4655d4(0x30c)](0x0,-0x1)['join']('.')['replace'](/\s/g,'_')[_0x4655d4(0x2c8)](_0x4655d4(0x2e2))['replace'](/[\u0300-\u036f]/g,'');_0x26794f[_0x4655d4(0x211)]=_0x29cec5['trim']()+'_'+new Date()[_0x4655d4(0x24d)]()+'.'+_0x1b590b;}try{const _0x205770=path_1[_0x4655d4(0x23c)][_0x4655d4(0x29e)](__dirname,'..','..','..',_0x4655d4(0x270),'company'+_0x58430d[_0x4655d4(0x249)]);!fs_2[_0x4655d4(0x23c)][_0x4655d4(0x2e3)](_0x205770)&&(fs_2[_0x4655d4(0x23c)][_0x4655d4(0x276)](_0x205770,{'recursive':!![]}),fs_2[_0x4655d4(0x23c)][_0x4655d4(0x248)](_0x205770,0x1ff)),await writeFileAsync((0x0,path_1[_0x4655d4(0x2db)])(_0x205770,_0x26794f[_0x4655d4(0x211)]),_0x26794f[_0x4655d4(0x1fb)]['toString'](_0x4655d4(0x251)),_0x4655d4(0x251));}catch(_0x3d6075){Sentry[_0x4655d4(0x2d1)](_0x4655d4(0x309),{'companyId':_0x58430d['companyId'],'ticket':_0x58430d,'contact':_0x47e9a4,'media':_0x26794f,'quotedMsg':_0x15a420}),Sentry[_0x4655d4(0x2af)](_0x3d6075),logger_1[_0x4655d4(0x2fb)][_0x4655d4(0x1ee)](_0x3d6075),console[_0x4655d4(0x27f)](_0xb83cee);}const _0x2d8a92=(0x0,exports[_0x4655d4(0x222)])(_0xb83cee),_0x3dcf87={'wid':_0xb83cee[_0x4655d4(0x224)]['id'],'ticketId':_0x58430d['id'],'contactId':_0xb83cee['key'][_0x4655d4(0x20b)]?undefined:_0x47e9a4['id'],'body':_0x2d8a92||_0x26794f[_0x4655d4(0x211)],'fromMe':_0xb83cee[_0x4655d4(0x224)][_0x4655d4(0x20b)],'read':_0xb83cee[_0x4655d4(0x224)]['fromMe'],'mediaUrl':_0x26794f['filename'],'mediaType':_0x26794f['mimetype'][_0x4655d4(0x1f4)]('/')[0x0],'quotedMsgId':_0x15a420?.['id'],'ack':_0xb83cee['status'],'remoteJid':_0xb83cee[_0x4655d4(0x224)][_0x4655d4(0x1ec)],'participant':_0xb83cee[_0x4655d4(0x224)][_0x4655d4(0x24c)],'dataJson':JSON[_0x4655d4(0x306)](_0xb83cee),'ticketTrakingId':_0xa78bb9?.['id'],'createdAt':new Date(Math[_0x4655d4(0x2b2)](getTimestampMessage(_0xb83cee[_0x4655d4(0x268)])*0x3e8))['toISOString'](),'ticketImported':_0x58430d[_0x4655d4(0x26e)]};await _0x58430d[_0x4655d4(0x250)]({'lastMessage':_0x2d8a92||_0x26794f[_0x4655d4(0x211)]});const _0xaddcbd=await(0x0,CreateMessageService_1[_0x4655d4(0x23c)])({'messageData':_0x3dcf87,'companyId':_0x58430d[_0x4655d4(0x249)]});return!_0xb83cee[_0x4655d4(0x224)]['fromMe']&&_0x58430d['status']===_0x4655d4(0x29c)&&(await _0x58430d['update']({'status':_0x4655d4(0x229)}),await _0x58430d['reload']({'include':[{'model':Queue_1[_0x4655d4(0x23c)],'as':'queue'},{'model':User_1[_0x4655d4(0x23c)],'as':'user'},{'model':Contact_1['default'],'as':_0x4655d4(0x23e)}]}),_0x7679ea['to'](_0x4655d4(0x29c))[_0x4655d4(0x2b0)](_0x4655d4(0x2c5)+_0x58430d[_0x4655d4(0x249)]+'-ticket',{'action':_0x4655d4(0x2a4),'ticket':_0x58430d,'ticketId':_0x58430d['id']}),_0x7679ea['to'](_0x58430d[_0x4655d4(0x2bc)])['to'](_0x58430d['id']['toString']())[_0x4655d4(0x2b0)](_0x4655d4(0x2c5)+_0x58430d[_0x4655d4(0x249)]+_0x4655d4(0x238),{'action':'update','ticket':_0x58430d,'ticketId':_0x58430d['id']})),_0xaddcbd;}catch(_0x608a6d){console['log'](_0x608a6d),logger_1[_0x4655d4(0x2fb)][_0x4655d4(0x29b)](_0x4655d4(0x2dd));}},verifyMessage=async(_0x298a00,_0x159a0e,_0x164240,_0x381607,_0x24ba5b)=>{const _0x237e03=a552_0xe4db4f,_0x5ea097=(0x0,socket_1['getIO'])(),_0xfbfb91=await verifyQuotedMessage(_0x298a00),_0x31e4aa=(0x0,exports[_0x237e03(0x222)])(_0x298a00),_0x1a98e4={'wid':_0x298a00['key']['id'],'ticketId':_0x159a0e['id'],'contactId':_0x298a00[_0x237e03(0x224)][_0x237e03(0x20b)]?undefined:_0x164240['id'],'body':_0x31e4aa,'fromMe':_0x298a00[_0x237e03(0x224)][_0x237e03(0x20b)],'mediaType':getTypeMessage(_0x298a00),'read':_0x298a00[_0x237e03(0x224)][_0x237e03(0x20b)],'quotedMsgId':_0xfbfb91?.['id'],'ack':_0x298a00['status'],'remoteJid':_0x298a00[_0x237e03(0x224)][_0x237e03(0x1ec)],'participant':_0x298a00['key'][_0x237e03(0x24c)],'dataJson':JSON['stringify'](_0x298a00),'ticketTrakingId':_0x381607?.['id'],'isPrivate':_0x24ba5b,'createdAt':new Date(Math[_0x237e03(0x2b2)](getTimestampMessage(_0x298a00[_0x237e03(0x268)])*0x3e8))[_0x237e03(0x2f5)](),'ticketImported':_0x159a0e[_0x237e03(0x26e)]};await _0x159a0e[_0x237e03(0x250)]({'lastMessage':_0x31e4aa}),await(0x0,CreateMessageService_1[_0x237e03(0x23c)])({'messageData':_0x1a98e4,'companyId':_0x159a0e[_0x237e03(0x249)]}),!_0x298a00[_0x237e03(0x224)]['fromMe']&&_0x159a0e[_0x237e03(0x2bc)]===_0x237e03(0x29c)&&(await _0x159a0e[_0x237e03(0x250)]({'status':_0x237e03(0x229)}),await _0x159a0e[_0x237e03(0x20d)]({'include':[{'model':Queue_1[_0x237e03(0x23c)],'as':_0x237e03(0x308)},{'model':User_1[_0x237e03(0x23c)],'as':'user'},{'model':Contact_1[_0x237e03(0x23c)],'as':_0x237e03(0x23e)}]}),_0x5ea097['to'](_0x237e03(0x29c))['emit'](_0x237e03(0x2c5)+_0x159a0e[_0x237e03(0x249)]+_0x237e03(0x238),{'action':_0x237e03(0x2a4),'ticket':_0x159a0e,'ticketId':_0x159a0e['id']}),!_0x159a0e['imported']&&_0x5ea097['to'](_0x159a0e[_0x237e03(0x2bc)])['to'](_0x159a0e['id'][_0x237e03(0x2d0)]())['emit'](_0x237e03(0x2c5)+_0x159a0e[_0x237e03(0x249)]+_0x237e03(0x238),{'action':_0x237e03(0x250),'ticket':_0x159a0e,'ticketId':_0x159a0e['id']}));};exports[a552_0xe4db4f(0x288)]=verifyMessage;const isValidMsg=_0x354410=>{const _0x3f5908=a552_0xe4db4f;if(_0x354410[_0x3f5908(0x224)][_0x3f5908(0x1ec)]==='status@broadcast')return![];try{const _0x1dd59f=getTypeMessage(_0x354410);if(!_0x1dd59f)return;const _0x47fee7=_0x1dd59f==='conversation'||_0x1dd59f===_0x3f5908(0x24f)||_0x1dd59f===_0x3f5908(0x252)||_0x1dd59f===_0x3f5908(0x304)||_0x1dd59f==='imageMessage'||_0x1dd59f===_0x3f5908(0x1fd)||_0x1dd59f==='stickerMessage'||_0x1dd59f===_0x3f5908(0x310)||_0x1dd59f===_0x3f5908(0x204)||_0x1dd59f==='messageContextInfo'||_0x1dd59f==='locationMessage'||_0x1dd59f==='liveLocationMessage'||_0x1dd59f===_0x3f5908(0x221)||_0x1dd59f===_0x3f5908(0x2d5)||_0x1dd59f===_0x3f5908(0x312)||_0x1dd59f===_0x3f5908(0x2fa)||_0x1dd59f===_0x3f5908(0x1f9)||_0x1dd59f===_0x3f5908(0x217)||_0x1dd59f===_0x3f5908(0x1f0)||_0x1dd59f===_0x3f5908(0x233)||_0x1dd59f===_0x3f5908(0x256)||_0x1dd59f===_0x3f5908(0x234)||_0x1dd59f===_0x3f5908(0x21f)||_0x1dd59f==='viewOnceMessageV2'||_0x1dd59f===_0x3f5908(0x296);return!_0x47fee7&&(logger_1['logger']['warn'](_0x3f5908(0x25f)+_0x1dd59f+'\x0a'+JSON['stringify'](_0x354410?.[_0x3f5908(0x2fd)])),Sentry[_0x3f5908(0x2d1)](_0x3f5908(0x23f),{'BodyMsg':_0x354410[_0x3f5908(0x2fd)],'msg':_0x354410,'msgType':_0x1dd59f}),Sentry['captureException'](new Error(_0x3f5908(0x295)))),!!_0x47fee7;}catch(_0xf5a481){Sentry[_0x3f5908(0x2d1)](_0x3f5908(0x223),{'msg':_0x354410}),Sentry[_0x3f5908(0x2af)](_0xf5a481);}};exports[a552_0xe4db4f(0x2f3)]=isValidMsg;const verifyQueue=async(_0x2f04ba,_0x1ed294,_0x580275,_0x50e48a,_0x521a54)=>{const _0x1c61ee=a552_0xe4db4f,{queues:_0x2eb381,greetingMessage:_0x54f451,maxUseBotQueues:_0x470082,timeUseBotQueues:_0x37566a}=await(0x0,ShowWhatsAppService_1['default'])(_0x2f04ba['id'],_0x580275[_0x1c61ee(0x249)]),_0x50da5b=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x580275['id'],'companyId':_0x580275[_0x1c61ee(0x249)],'whatsappId':_0x580275['whatsapp']?.['id']});let _0x4df010=![];_0x2eb381[_0x1c61ee(0x299)]===0x1&&(_0x4df010=_0x2eb381[0x0]?.[_0x1c61ee(0x272)][_0x1c61ee(0x299)]>0x1);const _0xa7396d=_0x521a54[_0x1c61ee(0x209)](_0x761a0=>_0x761a0['key']===_0x1c61ee(0x2f7))??_0x1c61ee(0x30f),_0x5ecc90=_0xa7396d&&_0xa7396d?.[_0x1c61ee(0x214)]===_0x1c61ee(0x220);if(_0x2eb381[_0x1c61ee(0x299)]===0x1&&!_0x4df010){const _0x2e956c=_0x521a54[_0x1c61ee(0x209)](_0x21952f=>_0x21952f['key']===_0x1c61ee(0x280));if(_0x54f451[_0x1c61ee(0x299)]>0x1&&_0x2e956c[_0x1c61ee(0x214)]==='enabled'){const _0x54d733=(0x0,Mustache_1['default'])(''+_0x54f451,_0x580275);if(_0x580275['whatsapp']['greetingMediaAttachment']!==null){const _0x13f0f2=path_1[_0x1c61ee(0x23c)][_0x1c61ee(0x29e)]('public',_0x1c61ee(0x294)+_0x580275[_0x1c61ee(0x249)],_0x580275[_0x1c61ee(0x213)][_0x1c61ee(0x2e8)]),_0x2fa791=_0x580275[_0x1c61ee(0x213)][_0x1c61ee(0x2e8)],_0x4e0987=await(0x0,SendWhatsAppMedia_1[_0x1c61ee(0x2a8)])(_0x2fa791,_0x13f0f2,String(_0x580275['companyId']),_0x54d733),_0x5223f7=await _0x2f04ba[_0x1c61ee(0x28a)](_0x580275[_0x1c61ee(0x23e)][_0x1c61ee(0x282)]+'@'+(_0x580275[_0x1c61ee(0x201)]?_0x1c61ee(0x2cd):_0x1c61ee(0x230)),{..._0x4e0987});await verifyMediaMessage(_0x5223f7,_0x580275,_0x50e48a,_0x50da5b);}else await _0x2f04ba['sendMessage'](_0x50e48a[_0x1c61ee(0x282)]+'@'+(_0x580275[_0x1c61ee(0x201)]?_0x1c61ee(0x2cd):_0x1c61ee(0x230)),{'text':_0x54d733});}await(0x0,UpdateTicketService_1[_0x1c61ee(0x23c)])({'ticketData':{'queueId':_0x2eb381[0x0]['id']},'ticketId':_0x580275['id'],'companyId':_0x580275[_0x1c61ee(0x249)]});const _0x5e25eb=await Ticket_1[_0x1c61ee(0x23c)]['findAndCountAll']({'where':{'userId':null,'status':_0x1c61ee(0x229),'companyId':_0x580275[_0x1c61ee(0x249)],'queueId':_0x2eb381[0x0]['id'],'isGroup':![]}});if(_0x5ecc90){const _0x313a27=_0x5e25eb[_0x1c61ee(0x2ca)]===0x0?0x1:_0x5e25eb['count'],_0x69281d=_0x1c61ee(0x2d9)+_0x313a27+'*',_0x21f6a7=(0x0,Mustache_1[_0x1c61ee(0x23c)])(''+_0x69281d,_0x580275),_0x396a9c=(0x0,Debounce_1[_0x1c61ee(0x27a)])(async()=>{const _0x319cd0=_0x1c61ee;await _0x2f04ba['sendMessage'](_0x50e48a['number']+'@'+(_0x580275['isGroup']?_0x319cd0(0x2cd):_0x319cd0(0x230)),{'text':_0x21f6a7});},0xbb8,_0x580275['id']);_0x396a9c();}return;}if(_0x50e48a[_0x1c61ee(0x2ba)])return;let _0x56a507='';if(_0x580275[_0x1c61ee(0x2bc)]!==_0x1c61ee(0x25a))_0x56a507=_0x1ed294?.[_0x1c61ee(0x2fd)]?.[_0x1c61ee(0x310)]?.[_0x1c61ee(0x215)]||_0x1ed294?.[_0x1c61ee(0x2fd)]?.[_0x1c61ee(0x233)]?.['singleSelectReply'][_0x1c61ee(0x247)]||(0x0,exports[_0x1c61ee(0x222)])(_0x1ed294);else{if(!(0x0,lodash_1[_0x1c61ee(0x29f)])(_0x580275[_0x1c61ee(0x27d)]))await _0x580275[_0x1c61ee(0x250)]({'status':_0x1c61ee(0x229)});await _0x580275[_0x1c61ee(0x20d)]();}if(_0x56a507==_0x1c61ee(0x244)){const _0x2d0a59={'isBot':![],'queueId':null,'userId':null,'status':_0x1c61ee(0x29c),'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1[_0x1c61ee(0x23c)])({'ticketData':_0x2d0a59,'ticketId':_0x580275['id'],'companyId':_0x580275[_0x1c61ee(0x249)]});const {complationMessage:_0x446577}=await(0x0,ShowWhatsAppService_1['default'])(_0x580275[_0x1c61ee(0x2be)],_0x580275['companyId']),_0x53d5db={'text':(0x0,Mustache_1['default'])('â€Ž'+_0x446577,_0x580275)};if(!(0x0,lodash_1['isNil'])(_0x446577)){const _0x2f3cb9=await _0x2f04ba['sendMessage'](_0x580275?.[_0x1c61ee(0x23e)]?.[_0x1c61ee(0x282)]+'@'+(_0x580275[_0x1c61ee(0x201)]?_0x1c61ee(0x2cd):'s.whatsapp.net'),_0x53d5db);await(0x0,exports['verifyMessage'])(_0x2f3cb9,_0x580275,_0x580275[_0x1c61ee(0x23e)]);}return;}const _0x341052=_0x4df010&&_0x2eb381[_0x1c61ee(0x299)]===0x1?_0x2eb381[+_0x56a507]:_0x2eb381[+_0x56a507-0x1],_0x5ebf4b=await Setting_1[_0x1c61ee(0x23c)][_0x1c61ee(0x290)]({'where':{'key':_0x1c61ee(0x260),'companyId':_0x580275[_0x1c61ee(0x249)]}}),_0x24f39d=_0x5ebf4b?.['value']||'text';let _0x2bb608;if(_0x341052)try{const _0x380e79=await(0x0,ListUserQueueServices_1[_0x1c61ee(0x23c)])(_0x341052['id']);_0x380e79[_0x1c61ee(0x2cb)]>-0x1&&(_0x2bb608=_0x380e79[_0x1c61ee(0x2cb)]);}catch(_0x2f1b3e){console[_0x1c61ee(0x1ee)](_0x2f1b3e);}let _0x2827ea=await Setting_1[_0x1c61ee(0x23c)]['findOne']({'where':{'key':'userRandom','companyId':_0x580275[_0x1c61ee(0x249)]}});const _0x413734=async()=>{const _0xf01116=_0x1c61ee;if(_0x341052||_0x2eb381['length']===0x1&&_0x4df010){await(0x0,UpdateTicketService_1[_0xf01116(0x23c)])({'ticketData':{'amountUsedBotQueues':0x0,'queueId':_0x341052['id']},'ticketId':_0x580275['id'],'companyId':_0x580275[_0xf01116(0x249)]});if(_0x341052[_0xf01116(0x272)]['length']>0x0){let _0x47fd87='';_0x341052[_0xf01116(0x272)][_0xf01116(0x23b)]((_0x4214d0,_0xcbd2d0)=>{const _0x2dad17=_0xf01116;_0x47fd87+='*'+(_0xcbd2d0+0x1)+_0x2dad17(0x2a5)+_0x4214d0[_0x2dad17(0x275)]+'\x0a';});const _0x31b236=(0x0,Mustache_1[_0xf01116(0x23c)])('â€Ž'+_0x341052['greetingMessage']+'\x0a\x0a'+_0x47fd87+'\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal',_0x580275),_0x593f47=await _0x2f04ba[_0xf01116(0x28a)](_0x50e48a[_0xf01116(0x282)]+'@'+(_0x580275[_0xf01116(0x201)]?_0xf01116(0x2cd):_0xf01116(0x230)),{'text':_0x31b236});await(0x0,exports[_0xf01116(0x288)])(_0x593f47,_0x580275,_0x50e48a,_0x50da5b),_0x2827ea?.[_0xf01116(0x214)]===_0xf01116(0x220)&&await(0x0,UpdateTicketService_1[_0xf01116(0x23c)])({'ticketData':{'userId':_0x2bb608},'ticketId':_0x580275['id'],'companyId':_0x580275[_0xf01116(0x249)]});}if(!_0x341052[_0xf01116(0x272)][_0xf01116(0x299)]&&_0x341052[_0xf01116(0x305)][_0xf01116(0x299)]!==0x0){const _0x34d1c8=(0x0,Mustache_1['default'])('â€Ž'+_0x341052[_0xf01116(0x305)],_0x580275),_0x15ed75=await _0x2f04ba[_0xf01116(0x28a)](_0x50e48a[_0xf01116(0x282)]+'@'+(_0x580275[_0xf01116(0x201)]?_0xf01116(0x2cd):_0xf01116(0x230)),{'text':_0x34d1c8});await(0x0,exports[_0xf01116(0x288)])(_0x15ed75,_0x580275,_0x50e48a,_0x50da5b);}const _0x3274bf=await Ticket_1[_0xf01116(0x23c)]['findAndCountAll']({'where':{'userId':null,'status':'pending','companyId':_0x580275[_0xf01116(0x249)],'queueId':_0x341052['id'],'isGroup':![]}});if(_0xa7396d['value']===_0xf01116(0x220)&&!_0x341052[_0xf01116(0x272)][_0xf01116(0x299)]){const _0x53aed5=_0x3274bf[_0xf01116(0x2ca)]===0x0?0x1:_0x3274bf[_0xf01116(0x2ca)],_0x245e6b=_0xf01116(0x2d9)+_0x53aed5+'*',_0xf4be99=(0x0,Mustache_1[_0xf01116(0x23c)])(''+_0x245e6b,_0x580275),_0x11be89=(0x0,Debounce_1[_0xf01116(0x27a)])(async()=>{const _0x816a69=_0xf01116;await _0x2f04ba[_0x816a69(0x28a)](_0x50e48a['number']+'@'+(_0x580275['isGroup']?_0x816a69(0x2cd):_0x816a69(0x230)),{'text':_0xf4be99});},0xbb8,_0x580275['id']);_0x11be89();}}else{if(_0x470082&&_0x470082!==0x0&&_0x580275[_0xf01116(0x241)]>=_0x470082)return;const _0x4ffcc6=await(0x0,FindOrCreateATicketTrakingService_1[_0xf01116(0x23c)])({'ticketId':_0x580275['id'],'companyId':_0x580275[_0xf01116(0x249)]});let _0x3d5797=new Date(),_0x59050a=new Date();if(_0x4ffcc6['chatbotAt']!==null){_0x3d5797[_0xf01116(0x28c)](_0x4ffcc6[_0xf01116(0x27b)]['getMinutes']()+Number(_0x37566a));if(_0x4ffcc6[_0xf01116(0x27b)]!==null&&_0x59050a<_0x3d5797&&_0x37566a!=='0')return;}await _0x4ffcc6['update']({'chatbotAt':null});let _0x5ba77e='';_0x2eb381[_0xf01116(0x23b)]((_0x3c64b9,_0x255df0)=>{const _0xfc2190=_0xf01116;_0x5ba77e+=_0xfc2190(0x2ef)+(_0x255df0+0x1)+'\x20]*\x20-\x20'+_0x3c64b9['name']+'\x0a';}),_0x5ba77e+='\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento';const _0x5e82dd=(0x0,Mustache_1[_0xf01116(0x23c)])('â€Ž'+_0x54f451+'\x0a\x0a'+_0x5ba77e,_0x580275);if(_0x580275[_0xf01116(0x213)][_0xf01116(0x2e8)]!==null){const _0x55cd9f=path_1[_0xf01116(0x23c)]['resolve'](_0xf01116(0x270),_0xf01116(0x294)+_0x580275[_0xf01116(0x249)],_0x580275[_0xf01116(0x213)][_0xf01116(0x2e8)]),_0x267056=_0x580275[_0xf01116(0x213)][_0xf01116(0x2e8)],_0x2ab6b8=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x267056,_0x55cd9f,String(_0x580275[_0xf01116(0x249)]),_0x5e82dd);let _0x498f3b=await _0x2f04ba[_0xf01116(0x28a)](_0x580275[_0xf01116(0x23e)][_0xf01116(0x282)]+'@'+(_0x580275[_0xf01116(0x201)]?'g.us':'s.whatsapp.net'),{..._0x2ab6b8});await verifyMediaMessage(_0x498f3b,_0x580275,_0x50e48a,_0x4ffcc6),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x580275['amountUsedBotQueues']+0x1},'ticketId':_0x580275['id'],'companyId':_0x580275[_0xf01116(0x249)]});return;}else{const _0x1774d4=(0x0,Debounce_1[_0xf01116(0x27a)])(async()=>{const _0x3a5f91=_0xf01116,_0x32f9f4=await _0x2f04ba['sendMessage'](_0x50e48a['number']+'@'+(_0x580275['isGroup']?_0x3a5f91(0x2cd):'s.whatsapp.net'),{'text':_0x5e82dd});(0x0,exports[_0x3a5f91(0x288)])(_0x32f9f4,_0x580275,_0x50e48a,_0x4ffcc6);},0x3e8,_0x580275['id']);await(0x0,UpdateTicketService_1[_0xf01116(0x23c)])({'ticketData':{'amountUsedBotQueues':_0x580275[_0xf01116(0x241)]+0x1},'ticketId':_0x580275['id'],'companyId':_0x580275[_0xf01116(0x249)]}),_0x1774d4();}}},_0x193d29=async()=>{const _0x2b1efd=_0x1c61ee;if(_0x341052){await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x341052['id']},'ticketId':_0x580275['id'],'companyId':_0x580275[_0x2b1efd(0x249)]});if(_0x341052[_0x2b1efd(0x272)][_0x2b1efd(0x299)]>0x0){const _0x10324c=[];_0x341052[_0x2b1efd(0x272)]['forEach']((_0x106421,_0x145dbd)=>{const _0x838270=_0x2b1efd;_0x10324c['push']({'buttonId':''+(_0x145dbd+0x1),'buttonText':{'displayText':_0x106421[_0x838270(0x275)]},'type':0x1});});const _0x1c4f15={'text':(0x0,Mustache_1[_0x2b1efd(0x23c)])(''+_0x341052[_0x2b1efd(0x305)],_0x580275),'buttons':_0x10324c,'headerType':0x4},_0x29b17a=await _0x2f04ba[_0x2b1efd(0x28a)](_0x50e48a[_0x2b1efd(0x282)]+'@'+(_0x580275[_0x2b1efd(0x201)]?_0x2b1efd(0x2cd):_0x2b1efd(0x230)),_0x1c4f15);await(0x0,exports[_0x2b1efd(0x288)])(_0x29b17a,_0x580275,_0x50e48a,_0x50da5b);}if(!_0x341052[_0x2b1efd(0x272)][_0x2b1efd(0x299)]){const _0x92af62=(0x0,Mustache_1['default'])(''+_0x341052[_0x2b1efd(0x305)],_0x580275),_0x27bc0d=await _0x2f04ba['sendMessage'](_0x50e48a['number']+'@'+(_0x580275['isGroup']?_0x2b1efd(0x2cd):_0x2b1efd(0x230)),{'text':_0x92af62});await(0x0,exports['verifyMessage'])(_0x27bc0d,_0x580275,_0x50e48a,_0x50da5b);}}else{const _0x23ad82=[];_0x2eb381[_0x2b1efd(0x23b)]((_0x3830b5,_0x1e817b)=>{const _0xc50c6d=_0x2b1efd;_0x23ad82[_0xc50c6d(0x2e9)]({'buttonId':''+(_0x1e817b+0x1),'buttonText':{'displayText':_0x3830b5[_0xc50c6d(0x275)]},'type':0x4});});const _0x4696fd={'text':(0x0,Mustache_1[_0x2b1efd(0x23c)])(''+_0x54f451,_0x580275),'footer':'','buttons':_0x23ad82,'headerType':0x4},_0x4003a9=await _0x2f04ba[_0x2b1efd(0x28a)](_0x50e48a[_0x2b1efd(0x282)]+'@'+(_0x580275[_0x2b1efd(0x201)]?'g.us':_0x2b1efd(0x230)),_0x4696fd);await(0x0,exports[_0x2b1efd(0x288)])(_0x4003a9,_0x580275,_0x50e48a,_0x50da5b),await(0x0,UpdateTicketService_1[_0x2b1efd(0x23c)])({'ticketData':{'amountUsedBotQueues':_0x580275['amountUsedBotQueues']+0x1},'ticketId':_0x580275['id'],'companyId':_0x580275[_0x2b1efd(0x249)]});}},_0x41a0e1=async()=>{const _0x419440=_0x1c61ee;if(_0x341052){await(0x0,UpdateTicketService_1[_0x419440(0x23c)])({'ticketData':{'queueId':_0x341052['id']},'ticketId':_0x580275['id'],'companyId':_0x580275[_0x419440(0x249)]});if(_0x341052[_0x419440(0x272)][_0x419440(0x299)]>0x0){const _0x2b7b5d=[];_0x341052[_0x419440(0x272)][_0x419440(0x23b)]((_0x12a8b9,_0xdbcad9)=>{const _0x1373bb=_0x419440;_0x2b7b5d['push']({'title':_0x12a8b9[_0x1373bb(0x275)],'rowId':''+(_0xdbcad9+0x1)});});const _0x57bff6=[{'title':_0x419440(0x257),'rows':_0x2b7b5d}],_0x395ad5={'text':(0x0,Mustache_1[_0x419440(0x23c)])(''+_0x341052[_0x419440(0x305)],_0x580275),'buttonText':'Escolha\x20uma\x20opÃ§Ã£o','sections':_0x57bff6},_0x243ead=await _0x2f04ba['sendMessage'](_0x50e48a[_0x419440(0x282)]+'@'+(_0x580275['isGroup']?_0x419440(0x2cd):'s.whatsapp.net'),_0x395ad5);await(0x0,exports[_0x419440(0x288)])(_0x243ead,_0x580275,_0x50e48a,_0x50da5b);}if(!_0x341052[_0x419440(0x272)][_0x419440(0x299)]){const _0x2b134a=(0x0,Mustache_1[_0x419440(0x23c)])(''+_0x341052[_0x419440(0x305)],_0x580275),_0x974a64=await _0x2f04ba[_0x419440(0x28a)](_0x50e48a[_0x419440(0x282)]+'@'+(_0x580275[_0x419440(0x201)]?_0x419440(0x2cd):'s.whatsapp.net'),{'text':_0x2b134a});await(0x0,exports[_0x419440(0x288)])(_0x974a64,_0x580275,_0x50e48a,_0x50da5b);}}else{const _0x4b9d9a=[];_0x2eb381[_0x419440(0x23b)]((_0x318f60,_0x3627b5)=>{const _0x423b99=_0x419440;_0x4b9d9a[_0x423b99(0x2e9)]({'title':_0x318f60[_0x423b99(0x275)],'rowId':''+(_0x3627b5+0x1)});});const _0x363442=[{'title':_0x419440(0x257),'rows':_0x4b9d9a}],_0x4193a5={'text':(0x0,Mustache_1['default'])(''+_0x54f451,_0x580275),'buttonText':_0x419440(0x2d2),'sections':_0x363442},_0x3419f2=await _0x2f04ba[_0x419440(0x28a)](_0x50e48a['number']+'@'+(_0x580275[_0x419440(0x201)]?_0x419440(0x2cd):_0x419440(0x230)),_0x4193a5);await(0x0,exports[_0x419440(0x288)])(_0x3419f2,_0x580275,_0x50e48a,_0x50da5b),await(0x0,UpdateTicketService_1[_0x419440(0x23c)])({'ticketData':{'amountUsedBotQueues':_0x580275[_0x419440(0x241)]+0x1},'ticketId':_0x580275['id'],'companyId':_0x580275[_0x419440(0x249)]});}};if(_0x24f39d===_0x1c61ee(0x2df))return _0x413734();if(_0x24f39d===_0x1c61ee(0x28e)&&_0x2eb381[_0x1c61ee(0x299)]>0x3)return _0x413734();if(_0x24f39d===_0x1c61ee(0x28e)&&_0x2eb381[_0x1c61ee(0x299)]<=0x3)return _0x193d29();if(_0x24f39d===_0x1c61ee(0x1f7))return _0x41a0e1();},verifyRating=_0x5e1ee6=>{const _0x510e01=a552_0xe4db4f;if(_0x5e1ee6&&_0x5e1ee6['finishedAt']===null&&_0x5e1ee6[_0x510e01(0x28f)]!==null&&_0x5e1ee6[_0x510e01(0x2cb)]!==null&&_0x5e1ee6[_0x510e01(0x203)]===null)return!![];return![];};exports[a552_0xe4db4f(0x242)]=verifyRating;const handleRating=async(_0x582475,_0x3f80bd,_0x2e7e79)=>{const _0x31cb47=a552_0xe4db4f,_0x48b233=(0x0,socket_1[_0x31cb47(0x219)])(),{complationMessage:_0x6f23fd}=await(0x0,ShowWhatsAppService_1[_0x31cb47(0x23c)])(_0x3f80bd[_0x31cb47(0x2be)],_0x3f80bd[_0x31cb47(0x249)]);let _0x595741=_0x582475;_0x582475<0x0&&(_0x595741=0x0);_0x582475>0xa&&(_0x595741=0xa);await UserRating_1['default'][_0x31cb47(0x24e)]({'ticketId':_0x2e7e79[_0x31cb47(0x2d8)],'companyId':_0x2e7e79[_0x31cb47(0x249)],'userId':_0x2e7e79[_0x31cb47(0x2cb)],'rate':_0x595741});if(!(0x0,lodash_1[_0x31cb47(0x29f)])(_0x6f23fd)&&_0x6f23fd!==''&&!_0x3f80bd['isGroup']){const _0x3c61b9=(0x0,Mustache_1['default'])('â€Ž'+_0x6f23fd,_0x3f80bd);if(_0x3f80bd[_0x31cb47(0x216)]===_0x31cb47(0x213)){const _0x31a038=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x3c61b9,'ticket':_0x3f80bd});await(0x0,exports['verifyMessage'])(_0x31a038,_0x3f80bd,_0x3f80bd['contact'],_0x2e7e79);}['facebook',_0x31cb47(0x20a)][_0x31cb47(0x2ae)](_0x3f80bd[_0x31cb47(0x216)])&&await(0x0,sendFacebookMessage_1[_0x31cb47(0x23c)])({'body':_0x3c61b9,'ticket':_0x3f80bd});}await _0x3f80bd[_0x31cb47(0x250)]({'chatbot':null,'status':'closed','amountUseBotQueuesNPS':0x0}),_0x48b233['to']('open')[_0x31cb47(0x2b0)]('company-'+_0x3f80bd[_0x31cb47(0x249)]+_0x31cb47(0x238),{'action':_0x31cb47(0x2a4),'ticket':_0x3f80bd,'ticketId':_0x3f80bd['id']}),_0x48b233['to'](_0x3f80bd['status'])['to'](_0x3f80bd['id'][_0x31cb47(0x2d0)]())[_0x31cb47(0x2b0)](_0x31cb47(0x2c5)+_0x3f80bd['companyId']+'-ticket',{'action':'update','ticket':_0x3f80bd,'ticketId':_0x3f80bd['id']});};exports[a552_0xe4db4f(0x2e4)]=handleRating;const handleMessage=async(_0x4331df,_0x29a97a,_0x29d3df,_0x4d49dd=![])=>{const _0x1264dc=a552_0xe4db4f;if(_0x4d49dd){(0x0,addLogs_1['addLogs'])({'fileName':'processImportMessagesWppId'+_0x29a97a['id']+'.txt','text':_0x1264dc(0x2f2)+JSON[_0x1264dc(0x306)](_0x4331df,null,0x2)+_0x1264dc(0x30e)});let _0x3134cd=_0x4331df[_0x1264dc(0x224)]['id'],_0x54c390=await Message_1[_0x1264dc(0x23c)][_0x1264dc(0x290)]({'where':{'wid':_0x3134cd}});if(_0x54c390){await new Promise(_0x13c9c8=>setTimeout(_0x13c9c8,0x96)),console['log'](_0x1264dc(0x228));return;}else await new Promise(_0x26251c=>setTimeout(_0x26251c,parseInt(process['env']['TIMEOUT_TO_IMPORT_MESSAGE'])||0x14a));}else await new Promise(_0x1463ee=>setTimeout(_0x1463ee,i*0x28a)),console[_0x1264dc(0x27f)](i),i++;if(!isValidMsg(_0x4331df))return;try{let _0x22459f,_0x3edb39,_0x11422b=0x0,_0x277e1b=0x0,_0x3feae9=0x0,_0x589574=(0x0,exports['getBodyMessage'])(_0x4331df);const _0x57e26d=getTypeMessage(_0x4331df);if(_0x57e26d===_0x1264dc(0x1f0))return;const _0x5becec=_0x4331df[_0x1264dc(0x2fd)]?.[_0x1264dc(0x252)]||_0x4331df[_0x1264dc(0x2fd)]?.[_0x1264dc(0x22d)]||_0x4331df[_0x1264dc(0x2fd)]?.[_0x1264dc(0x304)]||_0x4331df[_0x1264dc(0x2fd)]?.['documentMessage']||_0x4331df[_0x1264dc(0x2fd)][_0x1264dc(0x289)]||_0x4331df?.[_0x1264dc(0x2fd)]?.[_0x1264dc(0x217)]?.[_0x1264dc(0x2fd)]?.[_0x1264dc(0x22d)]||_0x4331df?.[_0x1264dc(0x2fd)]?.[_0x1264dc(0x217)]?.['message']?.[_0x1264dc(0x252)]||_0x4331df?.[_0x1264dc(0x2fd)]?.[_0x1264dc(0x217)]?.['message']?.[_0x1264dc(0x304)]||_0x4331df?.['message']?.['ephemeralMessage']?.[_0x1264dc(0x2fd)]?.[_0x1264dc(0x1fd)]||_0x4331df?.[_0x1264dc(0x2fd)]?.[_0x1264dc(0x217)]?.[_0x1264dc(0x2fd)]?.['stickerMessage']||_0x4331df['message']?.[_0x1264dc(0x234)]?.[_0x1264dc(0x2fd)]?.[_0x1264dc(0x22d)]||_0x4331df[_0x1264dc(0x2fd)]?.['viewOnceMessage']?.[_0x1264dc(0x2fd)]?.[_0x1264dc(0x304)]||_0x4331df[_0x1264dc(0x2fd)]?.[_0x1264dc(0x217)]?.['message']?.[_0x1264dc(0x234)]?.[_0x1264dc(0x2fd)]?.[_0x1264dc(0x22d)]||_0x4331df[_0x1264dc(0x2fd)]?.[_0x1264dc(0x217)]?.['message']?.[_0x1264dc(0x234)]?.[_0x1264dc(0x2fd)]?.['videoMessage']||_0x4331df[_0x1264dc(0x2fd)]?.[_0x1264dc(0x21f)]?.[_0x1264dc(0x2fd)]?.[_0x1264dc(0x1fd)],_0x3b60b8=/\u200d/['test'](_0x589574);if(_0x4331df[_0x1264dc(0x224)]['fromMe']){if(/\u200e/['test'](_0x589574))return;if(!_0x5becec&&_0x57e26d!=='conversation'&&_0x57e26d!=='extendedTextMessage'&&_0x57e26d!==_0x1264dc(0x221)&&_0x57e26d!==_0x1264dc(0x1f9)&&_0x57e26d!==_0x1264dc(0x217)&&_0x57e26d!==_0x1264dc(0x1f0)&&_0x57e26d!=='viewOnceMessage'&&_0x57e26d!==_0x1264dc(0x296))return;_0x22459f=await getContactMessage(_0x4331df,_0x29a97a);}else _0x22459f=await getContactMessage(_0x4331df,_0x29a97a);const _0x1c7276=_0x4331df[_0x1264dc(0x224)][_0x1264dc(0x1ec)]?.[_0x1264dc(0x2a7)](_0x1264dc(0x263)),_0x173c3e=await(0x0,ShowWhatsAppService_1[_0x1264dc(0x23c)])(_0x29a97a['id'],_0x29d3df);if(!_0x173c3e[_0x1264dc(0x259)]&&_0x1c7276)return;if(_0x1c7276){const _0x2c0d84=await _0x29a97a['groupMetadata'](_0x4331df[_0x1264dc(0x224)][_0x1264dc(0x1ec)]),_0x498550={'id':_0x2c0d84['id'],'name':_0x2c0d84[_0x1264dc(0x26b)]};_0x3edb39=await verifyContact(_0x498550,_0x29a97a,_0x29d3df);}const _0x5bb7ab=await verifyContact(_0x22459f,_0x29a97a,_0x29d3df);let _0x20f9ed=0x0,_0x3ad5ff=null;if(_0x4331df['key']['fromMe'])await cache_1[_0x1264dc(0x23c)][_0x1264dc(0x237)]('contacts:'+_0x5bb7ab['id']+':unreads','0');else{const _0x3c0403=await cache_1[_0x1264dc(0x23c)][_0x1264dc(0x2d4)](_0x1264dc(0x2bb)+_0x5bb7ab['id']+_0x1264dc(0x26f));_0x20f9ed=+_0x3c0403+0x1,await cache_1[_0x1264dc(0x23c)]['set'](_0x1264dc(0x2bb)+_0x5bb7ab['id']+_0x1264dc(0x26f),''+_0x20f9ed);}const _0xfafe0=await(0x0,ListSettingsService_1[_0x1264dc(0x23c)])({'companyId':_0x29d3df}),_0x2ed4a7=_0xfafe0[_0x1264dc(0x209)](_0x2b1808=>_0x2b1808[_0x1264dc(0x224)]===_0x1264dc(0x2bd)),_0x1a355a=_0xfafe0[_0x1264dc(0x209)](_0x3c89fe=>_0x3c89fe[_0x1264dc(0x224)]===_0x1264dc(0x22a)),_0x1e1005=_0xfafe0[_0x1264dc(0x209)](_0x375606=>_0x375606[_0x1264dc(0x224)]===_0x1264dc(0x2c1)),_0x43a17b=_0xfafe0[_0x1264dc(0x209)](_0x26809d=>_0x26809d['key']===_0x1264dc(0x2da)),{ticket:_0x5654c3,isCreated:_0x134000}=await(0x0,FindOrCreateTicketService_1[_0x1264dc(0x23c)])(_0x5bb7ab,_0x173c3e,_0x20f9ed,_0x29d3df,_0x11422b,_0x3feae9,_0x3edb39,'whatsapp',_0x4d49dd,![],_0xfafe0);_0x3ad5ff=_0x5654c3;if(_0x20f9ed===0x0&&_0x173c3e[_0x1264dc(0x20f)]&&(0x0,Mustache_1['default'])(_0x173c3e[_0x1264dc(0x20f)],_0x3ad5ff)===_0x589574)return;if(_0x57e26d==='editedMessage'){const _0x3936f9=_0x4331df[_0x1264dc(0x2fd)][_0x1264dc(0x296)]['message'][_0x1264dc(0x1f0)][_0x1264dc(0x224)]['id'],_0x2a8c55=_0x4331df[_0x1264dc(0x2fd)][_0x1264dc(0x296)][_0x1264dc(0x2fd)][_0x1264dc(0x1f0)][_0x1264dc(0x296)][_0x1264dc(0x2a9)],_0x4e88c3=(0x0,socket_1[_0x1264dc(0x219)])();try{const _0x408349=await Message_1['default'][_0x1264dc(0x290)]({'where':{'wid':_0x3936f9,'companyId':_0x29d3df,'ticketId':_0x3ad5ff['id']}});if(!_0x408349)return;await _0x408349['update']({'isEdited':!![],'body':_0x2a8c55}),_0x4e88c3['to'](_0x408349[_0x1264dc(0x2d8)]['toString']())[_0x1264dc(0x2b0)](_0x1264dc(0x2c5)+_0x408349[_0x1264dc(0x249)]+'-appMessage',{'action':_0x1264dc(0x250),'message':_0x408349});}catch(_0x525775){Sentry[_0x1264dc(0x2af)](_0x525775),logger_1[_0x1264dc(0x2fb)][_0x1264dc(0x1ee)](_0x1264dc(0x24b)+_0x525775);}return;}const _0x223cc4=await(0x0,FindOrCreateATicketTrakingService_1[_0x1264dc(0x23c)])({'ticketId':_0x3ad5ff['id'],'companyId':_0x29d3df,'whatsappId':_0x173c3e?.['id']});try{if(!_0x4331df[_0x1264dc(0x224)][_0x1264dc(0x20b)]){if(_0x3ad5ff[_0x1264dc(0x2bc)]===_0x1264dc(0x274)&&_0x223cc4!==null&&(0x0,exports[_0x1264dc(0x242)])(_0x223cc4)){if(!isNaN(parseFloat(_0x589574))){(0x0,exports[_0x1264dc(0x2e4)])(parseFloat(_0x589574),_0x3ad5ff,_0x223cc4),await _0x223cc4[_0x1264dc(0x250)]({'ratingAt':(0x0,moment_1[_0x1264dc(0x23c)])()[_0x1264dc(0x2e6)](),'finishedAt':(0x0,moment_1[_0x1264dc(0x23c)])()[_0x1264dc(0x2e6)](),'rated':!![]});return;}else{if(_0x3ad5ff[_0x1264dc(0x1f3)]<_0x173c3e[_0x1264dc(0x22b)]){let _0x45a47f='â€ŽOpÃ§Ã£o\x20invÃ¡lida,\x20tente\x20novamente.\x0a';const _0x27f0f4=await _0x29a97a[_0x1264dc(0x28a)](_0x3ad5ff[_0x1264dc(0x23e)]['number']+'@'+(_0x3ad5ff['isGroup']?'g.us':_0x1264dc(0x230)),{'text':_0x45a47f});(0x0,exports[_0x1264dc(0x288)])(_0x27f0f4,_0x3ad5ff,_0x5bb7ab,_0x223cc4),await(0x0,baileys_1['delay'])(0x3e8);let _0xb30fb1='â€Ž'+_0x173c3e[_0x1264dc(0x269)]+'\x0a';const _0x5442cc=await(0x0,SendWhatsAppMessage_1[_0x1264dc(0x23c)])({'body':_0xb30fb1,'ticket':_0x3ad5ff});await(0x0,exports[_0x1264dc(0x288)])(_0x5442cc,_0x3ad5ff,_0x3ad5ff[_0x1264dc(0x23e)]),await _0x3ad5ff[_0x1264dc(0x250)]({'amountUseBotQueuesNPS':_0x3ad5ff[_0x1264dc(0x1f3)]+0x1});}return;}}if(_0x2ed4a7){if(_0x3ad5ff['status']===_0x1264dc(0x25a)&&!(0x0,lodash_1[_0x1264dc(0x29f)])(_0x2ed4a7?.[_0x1264dc(0x214)])&&_0x2ed4a7?.[_0x1264dc(0x214)]===_0x1264dc(0x220)&&!_0x4d49dd){if((0x0,lodash_1[_0x1264dc(0x29f)])(_0x3ad5ff[_0x1264dc(0x27d)])&&!(0x0,lodash_1['isNil'])(_0x3ad5ff[_0x1264dc(0x266)])){let _0x2f9623=null;_0x4331df?.[_0x1264dc(0x2fd)]?.['conversation']&&(_0x2f9623=~~+_0x4331df['message']?.[_0x1264dc(0x2a9)]);if(!Number[_0x1264dc(0x210)](_0x2f9623)&&Number[_0x1264dc(0x25d)](_0x2f9623)&&!(0x0,lodash_1[_0x1264dc(0x2a6)])(_0x2f9623)&&_0x2f9623>0x0){if(_0x2f9623===0x1)await _0x5bb7ab[_0x1264dc(0x250)]({'lgpdAcceptedAt':(0x0,moment_1[_0x1264dc(0x23c)])()[_0x1264dc(0x2e6)]()}),await _0x3ad5ff[_0x1264dc(0x250)]({'lgpdAcceptedAt':(0x0,moment_1['default'])()[_0x1264dc(0x2e6)](),'amountUsedBotQueues':0x0});else{if(_0x2f9623===0x2){if(_0x173c3e[_0x1264dc(0x20f)]!==''&&_0x173c3e[_0x1264dc(0x20f)]!==undefined){const _0x5f29b4=await _0x29a97a[_0x1264dc(0x28a)](_0x3ad5ff[_0x1264dc(0x23e)][_0x1264dc(0x282)]+'@'+(_0x3ad5ff[_0x1264dc(0x201)]?_0x1264dc(0x2cd):'s.whatsapp.net'),{'text':'â€Ž'+_0x173c3e[_0x1264dc(0x20f)]});(0x0,exports[_0x1264dc(0x288)])(_0x5f29b4,_0x3ad5ff,_0x5bb7ab,_0x223cc4);}await _0x3ad5ff[_0x1264dc(0x250)]({'status':_0x1264dc(0x29c),'amountUsedBotQueues':0x0}),await _0x223cc4[_0x1264dc(0x25c)];return;}else _0x3ad5ff[_0x1264dc(0x241)]<_0x173c3e[_0x1264dc(0x2f8)]&&await _0x3ad5ff[_0x1264dc(0x250)]({'amountUsedBotQueues':_0x3ad5ff[_0x1264dc(0x241)]+0x1,'lgpdSendMessageAt':null});}}else _0x3ad5ff[_0x1264dc(0x241)]<_0x173c3e['maxUseBotQueues']&&await _0x3ad5ff[_0x1264dc(0x250)]({'amountUsedBotQueues':_0x3ad5ff[_0x1264dc(0x241)]+0x1,'lgpdSendMessageAt':null});}if((_0x5bb7ab[_0x1264dc(0x27d)]===null||_0x43a17b?.[_0x1264dc(0x214)]==='enabled')&&!_0x5bb7ab[_0x1264dc(0x201)]&&(0x0,lodash_1['isNil'])(_0x3ad5ff[_0x1264dc(0x266)])&&_0x3ad5ff[_0x1264dc(0x241)]<=_0x173c3e[_0x1264dc(0x2f8)]&&!(0x0,lodash_1['isNil'])(_0x1a355a?.[_0x1264dc(0x214)])){_0x5becec?await verifyMediaMessage(_0x4331df,_0x3ad5ff,_0x5bb7ab):await(0x0,exports['verifyMessage'])(_0x4331df,_0x3ad5ff,_0x5bb7ab,_0x223cc4,_0x3b60b8);if(!(0x0,lodash_1[_0x1264dc(0x29f)])(_0x1a355a?.[_0x1264dc(0x214)])){const _0x1482b7=(0x0,Mustache_1[_0x1264dc(0x23c)])('â€Ž'+_0x1a355a?.[_0x1264dc(0x214)],_0x3ad5ff),_0x45846f=await _0x29a97a['sendMessage'](_0x3ad5ff['contact']['number']+'@'+(_0x3ad5ff[_0x1264dc(0x201)]?'g.us':_0x1264dc(0x230)),{'text':_0x1482b7});(0x0,exports[_0x1264dc(0x288)])(_0x45846f,_0x3ad5ff,_0x5bb7ab,_0x223cc4);}await(0x0,baileys_1[_0x1264dc(0x28b)])(0x3e8);if((0x0,lodash_1[_0x1264dc(0x29f)])(_0x1e1005?.[_0x1264dc(0x214)])){const _0x51ecb2=(0x0,Mustache_1[_0x1264dc(0x23c)])('â€Ž'+_0x1e1005['value'],_0x3ad5ff),_0x4bd9d6=await _0x29a97a['sendMessage'](_0x3ad5ff[_0x1264dc(0x23e)][_0x1264dc(0x282)]+'@'+(_0x3ad5ff['isGroup']?_0x1264dc(0x2cd):'s.whatsapp.net'),{'text':_0x51ecb2});await(0x0,exports[_0x1264dc(0x288)])(_0x4bd9d6,_0x3ad5ff,_0x5bb7ab,_0x223cc4);};await(0x0,baileys_1[_0x1264dc(0x28b)])(0x3e8);const _0x20124f=(0x0,Mustache_1[_0x1264dc(0x23c)])('â€ŽEstou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20NÃ£o',_0x3ad5ff),_0x4f224f=await _0x29a97a[_0x1264dc(0x28a)](_0x3ad5ff['contact'][_0x1264dc(0x282)]+'@'+(_0x3ad5ff['isGroup']?'g.us':_0x1264dc(0x230)),{'text':_0x20124f});await(0x0,exports[_0x1264dc(0x288)])(_0x4f224f,_0x3ad5ff,_0x5bb7ab,_0x223cc4),await _0x3ad5ff[_0x1264dc(0x250)]({'lgpdSendMessageAt':(0x0,moment_1[_0x1264dc(0x23c)])()[_0x1264dc(0x2e6)](),'amountUsedBotQueues':_0x3ad5ff['amountUsedBotQueues']+0x1}),await _0x3ad5ff[_0x1264dc(0x20d)]();return;};if(!(0x0,lodash_1[_0x1264dc(0x29f)])(_0x3ad5ff['lgpdSendMessageAt'])&&(0x0,lodash_1[_0x1264dc(0x29f)])(_0x3ad5ff[_0x1264dc(0x27d)]))return;}}}}catch(_0x176f66){Sentry[_0x1264dc(0x2af)](_0x176f66),console['log'](_0x176f66);}_0x5becec?await verifyMediaMessage(_0x4331df,_0x3ad5ff,_0x5bb7ab):await(0x0,exports['verifyMessage'])(_0x4331df,_0x3ad5ff,_0x5bb7ab,_0x223cc4,_0x3b60b8);try{await _0x3ad5ff[_0x1264dc(0x250)]({'fromMe':_0x4331df['key'][_0x1264dc(0x20b)]});}catch(_0x224340){Sentry[_0x1264dc(0x2af)](_0x224340),console[_0x1264dc(0x27f)](_0x224340);}const _0x5de935=await Setting_1[_0x1264dc(0x23c)][_0x1264dc(0x290)]({'where':{'companyId':_0x29d3df,'key':_0x1264dc(0x30a)}}),_0x198e3a=await Setting_1[_0x1264dc(0x23c)][_0x1264dc(0x290)]({'where':{'companyId':_0x29d3df,'key':_0x1264dc(0x1f6)}});let _0x5c732f;_0x5de935[_0x1264dc(0x214)]==='company'&&(_0x5c732f=await(0x0,VerifyCurrentSchedule_1[_0x1264dc(0x23c)])(_0x29d3df));try{if(!_0x4331df[_0x1264dc(0x224)]['fromMe']&&_0x5de935){if(_0x5de935[_0x1264dc(0x214)]===_0x1264dc(0x294)&&!(0x0,lodash_1[_0x1264dc(0x29f)])(_0x5c732f)&&(!_0x5c732f||_0x5c732f[_0x1264dc(0x1f1)]===![])){_0x223cc4[_0x1264dc(0x27b)]===null&&await _0x223cc4['update']({'chatbotAt':(0x0,moment_1['default'])()[_0x1264dc(0x2e6)]()});if(_0x173c3e[_0x1264dc(0x2f8)]&&_0x173c3e[_0x1264dc(0x2f8)]!==0x0&&_0x3ad5ff[_0x1264dc(0x241)]>=_0x173c3e[_0x1264dc(0x2f8)])return;let _0x34969d=new Date(),_0x3b2bbd=new Date();if(_0x223cc4['chatbotAt']!==null){_0x34969d[_0x1264dc(0x28c)](_0x223cc4[_0x1264dc(0x27b)][_0x1264dc(0x22e)]()+Number(_0x173c3e['timeUseBotQueues']));if(_0x223cc4[_0x1264dc(0x27b)]!==null&&_0x3b2bbd<_0x34969d&&_0x173c3e[_0x1264dc(0x1fa)]!=='0')return;}await _0x223cc4[_0x1264dc(0x250)]({'chatbotAt':null});if(_0x173c3e[_0x1264dc(0x2e1)]!==''){const _0x3f3f5d=(0x0,Mustache_1['default'])(''+_0x173c3e[_0x1264dc(0x2e1)],_0x3ad5ff),_0xe06e4b=(0x0,Debounce_1[_0x1264dc(0x27a)])(async()=>{const _0x5c1b3c=_0x1264dc;await _0x29a97a[_0x5c1b3c(0x28a)](_0x3ad5ff['contact'][_0x5c1b3c(0x282)]+'@'+(_0x3ad5ff[_0x5c1b3c(0x201)]?_0x5c1b3c(0x2cd):_0x5c1b3c(0x230)),{'text':_0x3f3f5d});},0x3e8,_0x3ad5ff['id']);_0xe06e4b();return;}await _0x3ad5ff[_0x1264dc(0x250)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x3ad5ff['amountUsedBotQueues']+0x1});return;}}}catch(_0x4f6490){Sentry[_0x1264dc(0x2af)](_0x4f6490),console[_0x1264dc(0x27f)](_0x4f6490);}!_0x3ad5ff[_0x1264dc(0x26e)]&&!_0x3ad5ff[_0x1264dc(0x308)]&&!_0x1c7276&&!_0x4331df[_0x1264dc(0x224)][_0x1264dc(0x20b)]&&!_0x3ad5ff['userId']&&_0x173c3e[_0x1264dc(0x226)][_0x1264dc(0x299)]>=0x1&&(await verifyQueue(_0x29a97a,_0x4331df,_0x3ad5ff,_0x5bb7ab,_0xfafe0),_0x223cc4[_0x1264dc(0x27b)]===null&&await _0x223cc4['update']({'chatbotAt':(0x0,moment_1[_0x1264dc(0x23c)])()[_0x1264dc(0x2e6)]()}));_0x3ad5ff[_0x1264dc(0x239)]>0x0&&await _0x223cc4[_0x1264dc(0x250)]({'queueId':_0x3ad5ff[_0x1264dc(0x239)]});if(getTypeMessage(_0x4331df)==='audioMessage'&&!_0x4331df['key'][_0x1264dc(0x20b)]&&!_0x1c7276&&!_0x5bb7ab?.[_0x1264dc(0x2c0)]&&_0x198e3a?.[_0x1264dc(0x214)]===_0x1264dc(0x30f)){const _0x243539=await _0x29a97a[_0x1264dc(0x28a)](_0x5bb7ab[_0x1264dc(0x282)]+_0x1264dc(0x231),{'text':'*Assistente\x20Virtual*:\x0aInfelizmente\x20nÃ£o\x20conseguimos\x20escutar\x20nem\x20enviar\x20Ã¡udios\x20por\x20este\x20canal\x20de\x20atendimento,\x20por\x20favor,\x20envie\x20uma\x20mensagem\x20de\x20*texto*.'},{'quoted':{'key':_0x4331df[_0x1264dc(0x224)],'message':{'extendedTextMessage':_0x4331df['message'][_0x1264dc(0x24f)]}}});await(0x0,exports[_0x1264dc(0x288)])(_0x243539,_0x3ad5ff,_0x5bb7ab,_0x223cc4);}try{if(!_0x4331df[_0x1264dc(0x224)][_0x1264dc(0x20b)]&&_0x5de935&&_0x3ad5ff[_0x1264dc(0x239)]!==null){const _0x361048=await Queue_1['default']['findByPk'](_0x3ad5ff[_0x1264dc(0x239)]);_0x5de935?.['value']===_0x1264dc(0x308)&&(_0x5c732f=await(0x0,VerifyCurrentSchedule_1[_0x1264dc(0x23c)])(_0x29d3df,_0x361048['id']));if(_0x5de935[_0x1264dc(0x214)]==='queue'&&!(0x0,lodash_1[_0x1264dc(0x29f)])(_0x5c732f)&&(!_0x5c732f||_0x5c732f[_0x1264dc(0x1f1)]===![])){const _0x5ce34b=_0x361048[_0x1264dc(0x2e1)];if(_0x5ce34b!==''){const _0x50a934=(0x0,Mustache_1[_0x1264dc(0x23c)])(''+_0x5ce34b,_0x3ad5ff),_0x5987da=(0x0,Debounce_1[_0x1264dc(0x27a)])(async()=>{const _0x55964d=_0x1264dc;await _0x29a97a[_0x55964d(0x28a)](_0x3ad5ff[_0x55964d(0x23e)][_0x55964d(0x282)]+'@'+(_0x3ad5ff[_0x55964d(0x201)]?_0x55964d(0x2cd):_0x55964d(0x230)),{'text':_0x50a934});},0x3e8,_0x3ad5ff['id']);_0x5987da();return;}return;}}}catch(_0x1385c3){Sentry[_0x1264dc(0x2af)](_0x1385c3),console[_0x1264dc(0x27f)](_0x1385c3);}_0x3ad5ff[_0x1264dc(0x308)]&&_0x3ad5ff[_0x1264dc(0x239)]&&!_0x4331df[_0x1264dc(0x224)][_0x1264dc(0x20b)]&&((!_0x3ad5ff[_0x1264dc(0x22c)]||_0x3ad5ff[_0x1264dc(0x308)]?.[_0x1264dc(0x272)]?.[_0x1264dc(0x299)]>0x0)&&await(0x0,ChatBotListener_1[_0x1264dc(0x2b8)])(_0x3ad5ff['queueId'],_0x29a97a,_0x3ad5ff,_0x5bb7ab,_0x4331df),await _0x3ad5ff[_0x1264dc(0x250)]({'sendInactiveMessage':![]})),await _0x3ad5ff[_0x1264dc(0x20d)]();}catch(_0x140831){Sentry[_0x1264dc(0x2af)](_0x140831),console[_0x1264dc(0x27f)](_0x140831),logger_1['logger'][_0x1264dc(0x1ee)](_0x1264dc(0x2c2)+_0x140831);}};exports['handleMessage']=handleMessage;const handleMsgAck=async(_0x1105f1,_0x487e6f)=>{const _0x5ca2d5=a552_0xe4db4f;await new Promise(_0x286109=>setTimeout(_0x286109,0x1f4));const _0x171560=(0x0,socket_1['getIO'])();try{const _0xd0e441=await Message_1[_0x5ca2d5(0x23c)][_0x5ca2d5(0x290)]({'where':{'wid':_0x1105f1[_0x5ca2d5(0x224)]['id']},'include':[_0x5ca2d5(0x23e),{'model':Message_1[_0x5ca2d5(0x23c)],'as':_0x5ca2d5(0x2bf),'include':['contact']}]});if(!_0xd0e441)return;await _0xd0e441[_0x5ca2d5(0x250)]({'ack':_0x487e6f}),_0x171560['to'](_0xd0e441[_0x5ca2d5(0x2d8)][_0x5ca2d5(0x2d0)]())[_0x5ca2d5(0x2b0)](_0x5ca2d5(0x2c5)+_0xd0e441[_0x5ca2d5(0x249)]+_0x5ca2d5(0x208),{'action':_0x5ca2d5(0x250),'message':_0xd0e441});}catch(_0x4c8bfe){Sentry[_0x5ca2d5(0x2af)](_0x4c8bfe),logger_1[_0x5ca2d5(0x2fb)][_0x5ca2d5(0x1ee)](_0x5ca2d5(0x24b)+_0x4c8bfe);}},verifyRecentCampaign=async(_0xd72057,_0x2b116a)=>{const _0x16722e=a552_0xe4db4f;if(!isValidMsg(_0xd72057))return;if(!_0xd72057['key']['fromMe']){const _0x2058af=_0xd72057[_0x16722e(0x224)][_0x16722e(0x1ec)]['replace'](/\D/g,''),_0x534924=await Campaign_1[_0x16722e(0x23c)]['findAll']({'where':{'companyId':_0x2b116a,'status':_0x16722e(0x20c),'confirmation':!![]}});if(_0x534924){const _0x227412=_0x534924['map'](_0x1dfcee=>_0x1dfcee['id']),_0x2a4b26=await CampaignShipping_1[_0x16722e(0x23c)][_0x16722e(0x290)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x227412},'number':_0x2058af,'confirmation':null}});_0x2a4b26&&(await _0x2a4b26[_0x16722e(0x250)]({'confirmedAt':(0x0,moment_1[_0x16722e(0x23c)])(),'confirmation':!![]}),await queues_1[_0x16722e(0x26a)]['add'](_0x16722e(0x2f4),{'campaignShippingId':_0x2a4b26['id'],'campaignId':_0x2a4b26[_0x16722e(0x2dc)]},{'delay':(0x0,queues_1['parseToMilliseconds'])((0x0,queues_1[_0x16722e(0x261)])(0x0,0xa))}));}}},verifyCampaignMessageAndCloseTicket=async(_0x82c94b,_0x5dc51c,_0xe5ebc4)=>{const _0x796216=a552_0xe4db4f;if(!isValidMsg(_0x82c94b))return;let _0x37b0f7;_0x37b0f7=await getContactMessage(_0x82c94b,_0xe5ebc4);const _0x45322e=await verifyContact(_0x37b0f7,_0xe5ebc4,_0x5dc51c),_0x35fb67=(0x0,socket_1['getIO'])(),_0x1508f1=await(0x0,exports[_0x796216(0x222)])(_0x82c94b),_0x3518a0=/\u200c/[_0x796216(0x2f1)](_0x1508f1);if(_0x82c94b['key'][_0x796216(0x20b)]&&_0x3518a0){const _0x12e8e3=await Message_1[_0x796216(0x23c)][_0x796216(0x290)]({'where':{[sequelize_1['Op']['or']]:[{'wid':_0x82c94b[_0x796216(0x224)]['id']},{'contactId':_0x45322e['id']}],'companyId':_0x5dc51c}});if(!(0x0,lodash_1[_0x796216(0x2a6)])(_0x12e8e3)||!(0x0,lodash_1[_0x796216(0x29f)])(_0x12e8e3)||_0x12e8e3!==null){const _0x4f9f9c=await Ticket_1['default'][_0x796216(0x267)](_0x12e8e3[_0x796216(0x2d8)]);await _0x4f9f9c[_0x796216(0x250)]({'status':_0x796216(0x29c),'amountUsedBotQueues':0x0,'amountUseOutOfHours':0x0}),_0x35fb67['to']('open')[_0x796216(0x2b0)](_0x796216(0x2c5)+_0x4f9f9c[_0x796216(0x249)]+'-ticket',{'action':'delete','ticket':_0x4f9f9c,'ticketId':_0x4f9f9c['id']}),_0x35fb67['to'](_0x4f9f9c[_0x796216(0x2bc)])['to'](_0x4f9f9c['id']['toString']())[_0x796216(0x2b0)]('company-'+_0x4f9f9c[_0x796216(0x249)]+'-ticket',{'action':_0x796216(0x250),'ticket':_0x4f9f9c,'ticketId':_0x4f9f9c['id']});}}},filterMessages=_0x3b6f60=>{const _0x4c6c98=a552_0xe4db4f;if(_0x3b6f60[_0x4c6c98(0x2fd)]?.['protocolMessage'])return![];if([baileys_1[_0x4c6c98(0x313)][_0x4c6c98(0x298)],baileys_1['WAMessageStubType'][_0x4c6c98(0x202)],baileys_1[_0x4c6c98(0x313)][_0x4c6c98(0x2c6)],baileys_1[_0x4c6c98(0x313)]['CIPHERTEXT']][_0x4c6c98(0x2ae)](_0x3b6f60[_0x4c6c98(0x264)]))return![];return!![];},wbotMessageListener=(_0x3e29dc,_0x576148)=>{const _0xfb746b=a552_0xe4db4f;_0x3e29dc['ev']['on']('messages.upsert',async _0x5a9108=>{const _0x5484aa=a552_0x3697,_0x3eb0cd=_0x5a9108[_0x5484aa(0x2e0)][_0x5484aa(0x1fc)](filterMessages)['map'](_0x2cd911=>_0x2cd911);if(!_0x3eb0cd)return;_0x3eb0cd[_0x5484aa(0x23b)](async _0x494eeb=>{const _0x4af4f1=_0x5484aa,_0x491671=await Message_1['default'][_0x4af4f1(0x2ca)]({'where':{'wid':_0x494eeb[_0x4af4f1(0x224)]['id'],'companyId':_0x576148}});if(!_0x491671){let _0x3f9470=![],_0x17430c=await(0x0,exports[_0x4af4f1(0x222)])(_0x494eeb);const _0x4e702a=_0x494eeb?.[_0x4af4f1(0x224)]?.[_0x4af4f1(0x20b)];if(_0x4e702a)_0x3f9470=/\u200c/[_0x4af4f1(0x2f1)](_0x17430c);else{if(/\u200c/[_0x4af4f1(0x2f1)](_0x17430c))_0x17430c=_0x17430c['replace'](/\u200c/,'');logger_1[_0x4af4f1(0x2fb)][_0x4af4f1(0x21a)]('ValidaÃ§Ã£o\x20de\x20mensagem\x20de\x20campanha\x20enviada\x20por\x20terceiros:\x20'+_0x17430c);}!_0x3f9470&&await handleMessage(_0x494eeb,_0x3e29dc,_0x576148),await verifyRecentCampaign(_0x494eeb,_0x576148),await verifyCampaignMessageAndCloseTicket(_0x494eeb,_0x576148,_0x3e29dc);}_0x494eeb['key'][_0x4af4f1(0x1ec)]?.['endsWith'](_0x4af4f1(0x263))&&handleMsgAck(_0x494eeb,0x2);});}),_0x3e29dc['ev']['on']('messages.update',_0x4454da=>{const _0x2535dd=a552_0x3697;if(_0x4454da[_0x2535dd(0x299)]===0x0)return;_0x4454da['forEach'](async _0x350b1d=>{const _0x5be5e1=_0x2535dd;_0x3e29dc['readMessages']([_0x350b1d[_0x5be5e1(0x224)]]);const _0x227702={..._0x4454da};_0x227702['0']?.[_0x5be5e1(0x250)][_0x5be5e1(0x264)]===0x1&&_0x227702['0']?.[_0x5be5e1(0x224)]['remoteJid']!=='status@broadcast'&&(0x0,MarkDeleteWhatsAppMessage_1[_0x5be5e1(0x23c)])(_0x227702['0']?.[_0x5be5e1(0x224)][_0x5be5e1(0x1ec)],null,_0x227702['0']?.[_0x5be5e1(0x224)]['id'],_0x576148);let _0xd31cb9;_0x350b1d[_0x5be5e1(0x250)][_0x5be5e1(0x2bc)]===0x3&&_0x350b1d?.[_0x5be5e1(0x224)]?.[_0x5be5e1(0x20b)]?_0xd31cb9=0x2:_0xd31cb9=_0x350b1d['update'][_0x5be5e1(0x2bc)],handleMsgAck(_0x350b1d,_0xd31cb9);});}),_0x3e29dc['ev']['on'](_0xfb746b(0x21d),_0x1e0b7e=>{const _0x432f96=_0xfb746b;if(_0x1e0b7e[_0x432f96(0x299)]===0x0)return;_0x1e0b7e[_0x432f96(0x23b)](async _0x939b00=>{const _0x52975d=_0x432f96,_0x36eede=_0x939b00['id'][_0x52975d(0x2c7)](/\D/g,''),_0xbd15ab=_0x939b00[_0x52975d(0x26b)]||_0x36eede,_0x33659c={'name':_0xbd15ab,'number':_0x36eede,'isGroup':!![],'companyId':_0x576148},_0x1b4813=await(0x0,CreateOrUpdateContactService_1[_0x52975d(0x23c)])(_0x33659c);});});};exports['wbotMessageListener']=wbotMessageListener;