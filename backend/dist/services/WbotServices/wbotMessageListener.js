'use strict';const a552_0x181c7f=a552_0x4ed1;function a552_0x1f6e(){const _0x4ce8b7=['axolotlSenderKeyDistributionMessage','*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posiÃ§Ã£o\x20na\x20fila\x20de\x20atendimento\x20Ã©:\x20*','DispatchCampaign','/nopicture.png','count','key','split','*\x20-\x20','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','../CompanyService/VerifyCurrentSchedule','REVOKE','getMinutes','name','documentWithCaptionMessage','user','imported','endsWith','*Assistente\x20Virtual*:\x0aInfelizmente\x20nÃ£o\x20conseguimos\x20escutar\x20nem\x20enviar\x20Ã¡udios\x20por\x20este\x20canal\x20de\x20atendimento,\x20por\x20favor,\x20envie\x20uma\x20mensagem\x20de\x20*texto*.','slice','item1.TEL','floor','substring','next',';;;','update','Sair','isNull','whatsappId','contentText','path','facebook','pop','19463300CxfLqZ','selectedDisplayText','getMessageOptions','lgpdLink','captureException','../UserQueueServices/ListUserQueueServices','util','../../queues','isGroup','contextInfo','ratingMessage','company-','-appMessage','editedMessage','lgpdMessage','quotedMsg','profilePictureUrl','Menu','item1.TEL:','__esModule','buffer','toDate','setExtra','Esta\x20mensagem\x20jÃ¡\x20existe','imageMessage','create','1359786WagmCz','rows','buttons','amountUsedBotQueues','text','toISOString','selectedButtonId','../../utils/logger','senderKeyDistributionMessage','getContentType','addLogs','verifyRating','contacts:','disabled','chatBotType','campaignQueue','acceptAudioMessage','listMessage','find','get','setMinutes','@g.us','viewOnceMessageV2','messageStubType','includes','wbotMessageListener','__setModuleDefault','./MarkDeleteWhatsAppMessage','getQuotedMessageId','sendQueuePosition','description','../../models/Message','buttonsMessage','number','disableBot','status','messageTimestamp','liveLocationMessage','outOfHoursMessage','../../models/UserRating','FRONTEND_URL','join','finishedAt','normalize','ephemeralMessage','remoteJid','moment','handleRating','length','sayChatbot','inActivity','displayText','closed','closedAt','protocolMessage','debounce','messages','userId','maxUseBotQueues','isNil','extendedTextMessage','isValidMsg','Mensagem','selectedRowId','filename','parseToMilliseconds','open','buttonText','../MessageServices/CreateMessageService','findByPk','Latitude:\x20','__createBinding','log','readMessages','contactsArrayMessage','findAll','map','../TicketServices/FindOrCreateTicketService','documentMessage','test','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','default','../../models/Campaign','4548964xwdEKH','-ticket','../ContactServices/CreateOrUpdateContactService','degreesLongitude','sticker','voiceMessage','./SendWhatsAppMessage','conversation','processImportMessagesWppId','../TicketServices/FindOrCreateATicketTrakingService','sections','buttonsResponseMessage','mediaMessage','__importStar','>>>>>>>>>>>>>>>>>>>','s.whatsapp.net','greetingMessage','stanzaId','keys','contact','subject','selectedId','g.us','error','WAMessageStubType','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','%2C','Error\x20isValidMsg','ERR_WAPP_DOWNLOAD_MEDIA','getIO','Error\x20handling\x20message\x20ack.\x20Err:\x20','stickerMessage','set','trim','../FacebookServices/sendFacebookMessage',':\x20ðŸ“ž',':unreads','verifyMessage','quotedMessage','@whiskeysockets/baileys','delete','warn','viewOnceMessage','queues','getQuotedMessage','debug','lodash','vcard','writable','whatsapp','15BdWvUx','lgpd','company','Escolha\x20uma\x20opÃ§Ã£o','reactionMessage','listResponseMessage','queueId','timeUseBotQueues','534266eUxwjr','getTime','â€ŽOpÃ§Ã£o\x20invÃ¡lida,\x20tente\x20novamente.\x0a','getBodyMessage','chatbots','public','groups.update','mkdirSync','groupMetadata','reaction','locationMessage','13368744nxsoBx','message','status@broadcast','allowGroup','../../helpers/Mustache','singleSelectReply','ticketId','getTypeMessage','\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento','env','toString','./ChatBotListener','companyId','resolve','sequelize','image','data','lgpdSendMessageAt','../../models/Setting','E2E_DEVICE_CHANGED','values','TIMEOUT_TO_IMPORT_MESSAGE','fromMe','add','logger','Erro\x20media','isNaN','NFD','78099VGOTEQ','####\x20Nao\x20achou\x20o\x20type\x20152:\x20','push','messages.update','existsSync','indexOf','contactMessage','forEach','replace','amountUseBotQueuesNPS','__importDefault','queue','hasOwnProperty','jpegThumbnail','button','\x20]*\x20-\x20','audio/mp4','pending','ratingAt','acceptAudioMessageContact','findAndCountAll','defineProperty','audioMessage','../../libs/socket','degreesLatitude','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20getTypeMessage','channel','stringify','prototype','value','../../helpers/addLogs','pushName','findOne','ValidaÃ§Ã£o\x20de\x20mensagem\x20de\x20campanha\x20enviada\x20por\x20terceiros:\x20','enabled','isInteger','sendGreetingMessageOneQueues','emit','participant','sendMessage','â€ŽEstou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20NÃ£o','complationMessage','2696316UXNJJT','reload','writeFile','mimetype','contacts','lgpdAcceptedAt','jidNormalizedUser','getOwnPropertyDescriptor','../../models/CampaignShipping','../../libs/cache','title','../../models/Ticket','caption','destroy','@c.us','templateButtonReplyMessage','greetingMediaAttachment','configurable','216jIOCTl','base64','userRandom','5yRueJP','chatbotAt','maxUseBotQueuesNPS','videoMessage','Erro\x20ao\x20baixar\x20mÃ­dia:'];a552_0x1f6e=function(){return _0x4ce8b7;};return a552_0x1f6e();}(function(_0x561871,_0xe998c0){const _0x3501f4=a552_0x4ed1,_0x4d5f7e=_0x561871();while(!![]){try{const _0x40f0c8=-parseInt(_0x3501f4(0x1f9))/0x1+-parseInt(_0x3501f4(0x286))/0x2*(-parseInt(_0x3501f4(0x27e))/0x3)+parseInt(_0x3501f4(0x24c))/0x4*(parseInt(_0x3501f4(0x1ba))/0x5)+parseInt(_0x3501f4(0x1a5))/0x6+-parseInt(_0x3501f4(0x2ad))/0x7*(parseInt(_0x3501f4(0x1b7))/0x8)+parseInt(_0x3501f4(0x291))/0x9+-parseInt(_0x3501f4(0x1df))/0xa;if(_0x40f0c8===_0xe998c0)break;else _0x4d5f7e['push'](_0x4d5f7e['shift']());}catch(_0x2e6e4e){_0x4d5f7e['push'](_0x4d5f7e['shift']());}}}(a552_0x1f6e,0xc3661));var __createBinding=this&&this[a552_0x181c7f(0x240)]||(Object[a552_0x181c7f(0x1f8)]?function(_0x958cc6,_0x4f5869,_0x51aa53,_0xf73c4){const _0x1de0e6=a552_0x181c7f;if(_0xf73c4===undefined)_0xf73c4=_0x51aa53;var _0x51fa15=Object[_0x1de0e6(0x1ac)](_0x4f5869,_0x51aa53);(!_0x51fa15||(_0x1de0e6(0x20c)in _0x51fa15?!_0x4f5869[_0x1de0e6(0x1f2)]:_0x51fa15[_0x1de0e6(0x27c)]||_0x51fa15[_0x1de0e6(0x1b6)]))&&(_0x51fa15={'enumerable':!![],'get':function(){return _0x4f5869[_0x51aa53];}}),Object[_0x1de0e6(0x2c2)](_0x958cc6,_0xf73c4,_0x51fa15);}:function(_0x524a63,_0x32da1f,_0x42cbf5,_0x49c145){if(_0x49c145===undefined)_0x49c145=_0x42cbf5;_0x524a63[_0x49c145]=_0x32da1f[_0x42cbf5];}),__setModuleDefault=this&&this[a552_0x181c7f(0x213)]||(Object[a552_0x181c7f(0x1f8)]?function(_0x3f0b25,_0x5e07ed){const _0x1685fc=a552_0x181c7f;Object[_0x1685fc(0x2c2)](_0x3f0b25,_0x1685fc(0x24a),{'enumerable':!![],'value':_0x5e07ed});}:function(_0x4b1894,_0x510b4d){_0x4b1894['default']=_0x510b4d;}),__importStar=this&&this[a552_0x181c7f(0x259)]||function(_0x1ea1e4){const _0x30c678=a552_0x181c7f;if(_0x1ea1e4&&_0x1ea1e4[_0x30c678(0x1f2)])return _0x1ea1e4;var _0x3e764c={};if(_0x1ea1e4!=null){for(var _0x1b9c35 in _0x1ea1e4)if(_0x1b9c35!=='default'&&Object[_0x30c678(0x197)][_0x30c678(0x2b9)]['call'](_0x1ea1e4,_0x1b9c35))__createBinding(_0x3e764c,_0x1ea1e4,_0x1b9c35);}return __setModuleDefault(_0x3e764c,_0x1ea1e4),_0x3e764c;},__importDefault=this&&this[a552_0x181c7f(0x2b7)]||function(_0x479dc2){const _0x3e7480=a552_0x181c7f;return _0x479dc2&&_0x479dc2[_0x3e7480(0x1f2)]?_0x479dc2:{'default':_0x479dc2};};Object[a552_0x181c7f(0x2c2)](exports,a552_0x181c7f(0x1f2),{'value':!![]}),exports[a552_0x181c7f(0x298)]=exports['isValidMsg']=exports['handleMessage']=exports[a552_0x181c7f(0x212)]=exports[a552_0x181c7f(0x228)]=exports[a552_0x181c7f(0x204)]=exports['verifyMessage']=exports[a552_0x181c7f(0x215)]=exports['getQuotedMessage']=exports[a552_0x181c7f(0x289)]=void 0x0;const path_1=__importStar(require(a552_0x181c7f(0x1dc))),util_1=require(a552_0x181c7f(0x1e5)),fs_1=require('fs'),fs_2=__importDefault(require('fs')),Sentry=__importStar(require('@sentry/node')),lodash_1=require(a552_0x181c7f(0x27a)),baileys_1=require(a552_0x181c7f(0x273)),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require(a552_0x181c7f(0x1b0))),Message_1=__importDefault(require(a552_0x181c7f(0x218))),socket_1=require(a552_0x181c7f(0x192)),CreateMessageService_1=__importDefault(require(a552_0x181c7f(0x23d))),logger_1=require(a552_0x181c7f(0x200)),CreateOrUpdateContactService_1=__importDefault(require(a552_0x181c7f(0x24e))),FindOrCreateTicketService_1=__importDefault(require(a552_0x181c7f(0x246))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),Debounce_1=require('../../helpers/Debounce'),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),Mustache_1=__importDefault(require(a552_0x181c7f(0x295))),UserRating_1=__importDefault(require(a552_0x181c7f(0x220))),SendWhatsAppMessage_1=__importDefault(require(a552_0x181c7f(0x252))),sendFacebookMessage_1=__importDefault(require(a552_0x181c7f(0x26e))),moment_1=__importDefault(require(a552_0x181c7f(0x227))),Queue_1=__importDefault(require('../../models/Queue')),FindOrCreateATicketTrakingService_1=__importDefault(require(a552_0x181c7f(0x255))),VerifyCurrentSchedule_1=__importDefault(require(a552_0x181c7f(0x1c8))),Campaign_1=__importDefault(require(a552_0x181c7f(0x24b))),CampaignShipping_1=__importDefault(require(a552_0x181c7f(0x1ad))),sequelize_1=require(a552_0x181c7f(0x29f)),queues_1=require(a552_0x181c7f(0x1e6)),User_1=__importDefault(require('../../models/User')),Setting_1=__importDefault(require(a552_0x181c7f(0x2a3))),ChatBotListener_1=require(a552_0x181c7f(0x29c)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a552_0x181c7f(0x214))),ListUserQueueServices_1=__importDefault(require(a552_0x181c7f(0x1e4))),cache_1=__importDefault(require(a552_0x181c7f(0x1ae))),ListSettingsService_1=__importDefault(require('../SettingServices/ListSettingsService')),addLogs_1=require(a552_0x181c7f(0x199)),SendWhatsAppMedia_1=require('./SendWhatsAppMedia');let i=0x0;setInterval(()=>{i=0x0;},0x1388);const writeFileAsync=(0x0,util_1['promisify'])(fs_1[a552_0x181c7f(0x1a7)]);function removeFile(_0x1e2cb5){fs_2['default']['unlink'](_0x1e2cb5,_0x364d9d=>{if(_0x364d9d)throw _0x364d9d;});}const getTimestampMessage=_0x48112c=>{return _0x48112c*0x1;},multVecardGet=function(_0x59cdc3){const _0xb98b3c=a552_0x181c7f;let _0x2dcb43='\x20',_0x40906d=_0x59cdc3[_0xb98b3c(0x1c5)]('\x0a')[0x2][_0xb98b3c(0x2b5)](_0xb98b3c(0x1d6),'\x0a')[_0xb98b3c(0x2b5)]('N:','')[_0xb98b3c(0x2b5)](';','')[_0xb98b3c(0x2b5)](';','\x20')[_0xb98b3c(0x2b5)](';;','\x20')[_0xb98b3c(0x2b5)]('\x0a',''),_0x1cd787=_0x59cdc3[_0xb98b3c(0x1c5)]('\x0a')[0x4][_0xb98b3c(0x2b2)]('='),_0x3cc848=_0x59cdc3[_0xb98b3c(0x1c5)]('\x0a')[0x4][_0xb98b3c(0x2b2)](':'),_0x1e6239=_0x59cdc3[_0xb98b3c(0x1c5)]('\x0a')[0x4][_0xb98b3c(0x1d4)](_0x1cd787+0x1,_0x3cc848)[_0xb98b3c(0x2b5)](';',''),_0x99d099=_0x59cdc3['split']('\x0a')[0x4][_0xb98b3c(0x2b5)](_0xb98b3c(0x1f1),'');if(_0x1e6239!=_0xb98b3c(0x1d2))_0x2dcb43=_0x2dcb43+_0x40906d+_0xb98b3c(0x26f)+_0x1e6239+''+'\x0a';else _0x2dcb43=_0x2dcb43+_0x40906d+_0xb98b3c(0x26f)+_0x99d099+''+'\x0a';return _0x2dcb43;},contactsArrayMessageGet=_0x3d21f3=>{const _0x17c6f3=a552_0x181c7f;let _0x4b5446=_0x3d21f3[_0x17c6f3(0x292)]?.[_0x17c6f3(0x243)]?.[_0x17c6f3(0x1a9)],_0x57c45d=_0x4b5446[_0x17c6f3(0x245)](function(_0x34b50c,_0x36626d){const _0x14f0b8=_0x17c6f3;return _0x34b50c[_0x14f0b8(0x27b)];}),_0x6a35e0='';_0x57c45d[_0x17c6f3(0x2b4)](function(_0x3a631a,_0x1955ab){_0x6a35e0+=_0x3a631a+'\x0a\x0a'+'';});let _0x2ea778=_0x6a35e0[_0x17c6f3(0x1c5)]('BEGIN:');_0x2ea778['shift']();let _0x48b020='';for(let _0x527c16 of _0x2ea778){_0x48b020=_0x48b020+multVecardGet(_0x527c16);}return _0x48b020;},getTypeMessage=_0x52c351=>{const _0x43d174=a552_0x181c7f,_0x3f2f66=(0x0,baileys_1[_0x43d174(0x202)])(_0x52c351['message']);if(_0x52c351[_0x43d174(0x292)]?.['viewOnceMessageV2'])return _0x43d174(0x20f);return _0x3f2f66;};exports['getTypeMessage']=getTypeMessage;const getBodyButton=_0x1009ad=>{const _0x27f4b4=a552_0x181c7f;if(_0x1009ad[_0x27f4b4(0x1c4)]['fromMe']&&_0x1009ad['message']['buttonsMessage']?.[_0x27f4b4(0x1db)]){let _0x2efd36=''+_0x1009ad?.[_0x27f4b4(0x292)]?.[_0x27f4b4(0x219)]?.[_0x27f4b4(0x1db)];for(const _0x436c78 of _0x1009ad[_0x27f4b4(0x292)]?.[_0x27f4b4(0x219)]?.[_0x27f4b4(0x1fb)]){_0x2efd36+='\x0a\x0a'+_0x436c78[_0x27f4b4(0x23c)]?.[_0x27f4b4(0x22c)];}return _0x2efd36;}if(_0x1009ad[_0x27f4b4(0x1c4)][_0x27f4b4(0x2a7)]&&_0x1009ad?.[_0x27f4b4(0x292)]?.[_0x27f4b4(0x276)]?.[_0x27f4b4(0x292)]?.[_0x27f4b4(0x20a)]){let _0x317d95=''+_0x1009ad?.[_0x27f4b4(0x292)]?.[_0x27f4b4(0x276)]?.['message']?.[_0x27f4b4(0x20a)]?.['description'];for(const _0x59b8e3 of _0x1009ad[_0x27f4b4(0x292)]?.[_0x27f4b4(0x276)]?.[_0x27f4b4(0x292)]?.[_0x27f4b4(0x20a)]?.[_0x27f4b4(0x256)]){for(const _0x55598d of _0x59b8e3[_0x27f4b4(0x1fa)]){_0x317d95+='\x0a\x0a'+_0x55598d[_0x27f4b4(0x1af)];}}return _0x317d95;}},getBodyList=_0x3bbc03=>{const _0x1567d2=a552_0x181c7f;if(_0x3bbc03['key'][_0x1567d2(0x2a7)]&&_0x3bbc03['message']['listMessage']?.[_0x1567d2(0x217)]){let _0xf5b9ff=''+_0x3bbc03['message']['listMessage']?.[_0x1567d2(0x217)];for(const _0x55cdda of _0x3bbc03[_0x1567d2(0x292)][_0x1567d2(0x20a)]?.[_0x1567d2(0x256)]){for(const _0x5dbaac of _0x55cdda['rows']){_0xf5b9ff+='\x0a\x0a'+_0x5dbaac[_0x1567d2(0x1af)];}}return _0xf5b9ff;}if(_0x3bbc03[_0x1567d2(0x1c4)][_0x1567d2(0x2a7)]&&_0x3bbc03?.[_0x1567d2(0x292)]?.[_0x1567d2(0x276)]?.[_0x1567d2(0x292)]?.[_0x1567d2(0x20a)]){let _0x2b615f=''+_0x3bbc03?.[_0x1567d2(0x292)]?.['viewOnceMessage']?.[_0x1567d2(0x292)]?.[_0x1567d2(0x20a)]?.[_0x1567d2(0x217)];for(const _0x47c530 of _0x3bbc03[_0x1567d2(0x292)]?.[_0x1567d2(0x276)]?.[_0x1567d2(0x292)]?.[_0x1567d2(0x20a)]?.[_0x1567d2(0x256)]){for(const _0xd5e4a7 of _0x47c530[_0x1567d2(0x1fa)]){_0x2b615f+='\x0a\x0a'+_0xd5e4a7[_0x1567d2(0x1af)];}}return _0x2b615f;}},msgLocation=(_0x44188c,_0x2bac30,_0x33d765)=>{const _0x3b251a=a552_0x181c7f;if(_0x44188c){var _0x290d91=Buffer['from'](_0x44188c)[_0x3b251a(0x29b)](_0x3b251a(0x1b8));let _0x3aee24='data:image/png;base64,\x20'+_0x290d91+'\x20|\x20https://maps.google.com/maps?q='+_0x2bac30+_0x3b251a(0x266)+_0x33d765+'&z=17&hl=pt-BR|'+_0x2bac30+',\x20'+_0x33d765+'\x20';return _0x3aee24;}},getBodyMessage=_0x492872=>{const _0x22ab71=a552_0x181c7f;try{let _0x189079=getTypeMessage(_0x492872);const _0x328eb4={'conversation':_0x492872['message']?.['conversation'],'imageMessage':_0x492872[_0x22ab71(0x292)]?.['imageMessage']?.[_0x22ab71(0x1b1)],'videoMessage':_0x492872['message']?.[_0x22ab71(0x1bd)]?.['caption'],'extendedTextMessage':_0x492872?.[_0x22ab71(0x292)]?.['extendedTextMessage']?.[_0x22ab71(0x1fd)],'buttonsResponseMessage':_0x492872['message']?.['buttonsResponseMessage']?.[_0x22ab71(0x1e0)],'listResponseMessage':_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x283)]?.['title']||_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x283)]?.[_0x22ab71(0x296)]?.['selectedRowId'],'templateButtonReplyMessage':_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x1b4)]?.[_0x22ab71(0x261)],'messageContextInfo':_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x257)]?.[_0x22ab71(0x1ff)]||_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x283)]?.[_0x22ab71(0x1af)],'buttonsMessage':getBodyButton(_0x492872)||_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x283)]?.[_0x22ab71(0x1af)],'stickerMessage':_0x22ab71(0x250),'contactMessage':_0x492872['message']?.[_0x22ab71(0x2b3)]?.[_0x22ab71(0x27b)],'contactsArrayMessage':_0x492872['message']?.['contactsArrayMessage']?.[_0x22ab71(0x1a9)]&&contactsArrayMessageGet(_0x492872),'locationMessage':msgLocation(_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x290)]?.[_0x22ab71(0x2ba)],_0x492872[_0x22ab71(0x292)]?.['locationMessage']?.[_0x22ab71(0x193)],_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x290)]?.[_0x22ab71(0x24f)]),'liveLocationMessage':_0x22ab71(0x23f)+_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x21e)]?.[_0x22ab71(0x193)]+'\x20-\x20Longitude:\x20'+_0x492872[_0x22ab71(0x292)]?.['liveLocationMessage']?.[_0x22ab71(0x24f)],'documentMessage':_0x492872['message']?.['documentMessage']?.['title'],'audioMessage':'Ãudio','listMessage':getBodyList(_0x492872)||_0x492872[_0x22ab71(0x292)]?.['listResponseMessage']?.[_0x22ab71(0x1af)],'viewOnceMessage':getBodyButton(_0x492872),'reactionMessage':_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x282)]?.[_0x22ab71(0x1fd)]||_0x22ab71(0x28f),'senderKeyDistributionMessage':_0x492872?.['message']?.[_0x22ab71(0x201)]?.[_0x22ab71(0x1bf)],'documentWithCaptionMessage':_0x492872[_0x22ab71(0x292)]?.['documentWithCaptionMessage']?.[_0x22ab71(0x292)]?.[_0x22ab71(0x247)]?.[_0x22ab71(0x1b1)],'viewOnceMessageV2':_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x20f)]?.[_0x22ab71(0x292)]?.[_0x22ab71(0x1f7)]?.[_0x22ab71(0x1b1)],'editedMessage':_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x1ec)]?.['message']?.['extendedTextMessage']?.[_0x22ab71(0x1fd)],'ephemeralMessage':_0x492872[_0x22ab71(0x292)]?.[_0x22ab71(0x225)]?.[_0x22ab71(0x292)]?.['extendedTextMessage']?.[_0x22ab71(0x1fd)]},_0x20f1e5=Object[_0x22ab71(0x25e)](_0x328eb4)['find'](_0x18486d=>_0x18486d===_0x189079);return!_0x20f1e5&&(logger_1[_0x22ab71(0x2a9)][_0x22ab71(0x275)](_0x22ab71(0x2ae)+_0x189079+'\x0a'+JSON[_0x22ab71(0x196)](_0x492872)),Sentry[_0x22ab71(0x1f5)](_0x22ab71(0x237),{'BodyMsg':_0x492872['message'],'msg':_0x492872,'type':_0x189079}),Sentry[_0x22ab71(0x1e3)](new Error(_0x22ab71(0x194)))),_0x328eb4[_0x189079];}catch(_0x1a6be2){Sentry[_0x22ab71(0x1f5)]('Error\x20getTypeMessage',{'msg':_0x492872,'BodyMsg':_0x492872[_0x22ab71(0x292)]}),Sentry['captureException'](_0x1a6be2),console[_0x22ab71(0x241)](_0x1a6be2);}};exports[a552_0x181c7f(0x289)]=getBodyMessage;const getQuotedMessage=_0x1ebdc5=>{const _0x5d36ad=a552_0x181c7f,_0x437c4d=(0x0,baileys_1['extractMessageContent'])(_0x1ebdc5['message'])[Object[_0x5d36ad(0x25e)](_0x1ebdc5?.['message'])[_0x5d36ad(0x2a5)]()[_0x5d36ad(0x1d5)]()[_0x5d36ad(0x198)]];if(!_0x437c4d?.[_0x5d36ad(0x1e8)]?.[_0x5d36ad(0x272)])return;const _0x333d47=(0x0,baileys_1['extractMessageContent'])(_0x437c4d?.['contextInfo']?.[_0x5d36ad(0x272)][Object[_0x5d36ad(0x25e)](_0x437c4d?.['contextInfo']?.['quotedMessage'])[_0x5d36ad(0x2a5)]()['next']()[_0x5d36ad(0x198)]]);return _0x333d47;};exports[a552_0x181c7f(0x278)]=getQuotedMessage;const getQuotedMessageId=_0x2a9aaf=>{const _0x37b05e=a552_0x181c7f,_0x5ca216=(0x0,baileys_1['extractMessageContent'])(_0x2a9aaf[_0x37b05e(0x292)])[Object[_0x37b05e(0x25e)](_0x2a9aaf?.[_0x37b05e(0x292)])[_0x37b05e(0x2a5)]()[_0x37b05e(0x1d5)]()['value']];let _0x3199bb=_0x2a9aaf?.['message']?.[_0x37b05e(0x282)]?_0x2a9aaf?.[_0x37b05e(0x292)]?.[_0x37b05e(0x282)]?.[_0x37b05e(0x1c4)]?.['id']:'';return _0x3199bb?_0x3199bb:_0x5ca216?.[_0x37b05e(0x1e8)]?.[_0x37b05e(0x25d)];};exports[a552_0x181c7f(0x215)]=getQuotedMessageId;const getMeSocket=_0x5155e5=>{const _0x29373d=a552_0x181c7f;return{'id':(0x0,baileys_1[_0x29373d(0x1ab)])(_0x5155e5[_0x29373d(0x1cd)]['id']),'name':_0x5155e5[_0x29373d(0x1cd)][_0x29373d(0x1cb)]};},getSenderMessage=(_0x2f893b,_0x59c0d4)=>{const _0x264c62=a552_0x181c7f,_0x113980=getMeSocket(_0x59c0d4);if(_0x2f893b[_0x264c62(0x1c4)][_0x264c62(0x2a7)])return _0x113980['id'];const _0x1b1048=_0x2f893b['participant']||_0x2f893b[_0x264c62(0x1c4)][_0x264c62(0x1a1)]||_0x2f893b[_0x264c62(0x1c4)][_0x264c62(0x226)]||undefined;return _0x1b1048&&(0x0,baileys_1[_0x264c62(0x1ab)])(_0x1b1048);},getContactMessage=async(_0x29dead,_0x146daa)=>{const _0x14e1a1=a552_0x181c7f,_0x17df8f=_0x29dead[_0x14e1a1(0x1c4)][_0x14e1a1(0x226)][_0x14e1a1(0x211)](_0x14e1a1(0x262)),_0x421ce8=_0x29dead[_0x14e1a1(0x1c4)][_0x14e1a1(0x226)][_0x14e1a1(0x2b5)](/\D/g,'');return _0x17df8f?{'id':getSenderMessage(_0x29dead,_0x146daa),'name':_0x29dead[_0x14e1a1(0x19a)]}:{'id':_0x29dead[_0x14e1a1(0x1c4)][_0x14e1a1(0x226)],'name':_0x29dead[_0x14e1a1(0x1c4)]['fromMe']?_0x421ce8:_0x29dead[_0x14e1a1(0x19a)]};},downloadMedia=async(_0x330122,_0x31ad71=null)=>{const _0x22c93b=a552_0x181c7f;let _0x25258d;try{_0x25258d=await(0x0,baileys_1['downloadMediaMessage'])(_0x330122,_0x22c93b(0x1f3),{});}catch(_0x1e3550){_0x31ad71?console[_0x22c93b(0x241)]('Falha\x20ao\x20fazer\x20o\x20download\x20de\x20uma\x20mensagem\x20importada,\x20provavelmente\x20a\x20mensagem\x20jÃ¡\x20nÃ£o\x20esta\x20mais\x20disponÃ­vel'):console[_0x22c93b(0x263)](_0x22c93b(0x1be),_0x1e3550);}let _0x482828=_0x330122[_0x22c93b(0x292)]?.[_0x22c93b(0x247)]?.['fileName']||'';const _0xe2e5e3=_0x330122[_0x22c93b(0x292)]?.[_0x22c93b(0x1f7)]||_0x330122[_0x22c93b(0x292)]?.[_0x22c93b(0x2c3)]||_0x330122[_0x22c93b(0x292)]?.[_0x22c93b(0x1bd)]||_0x330122[_0x22c93b(0x292)]?.[_0x22c93b(0x26b)]||_0x330122['message']?.[_0x22c93b(0x247)]||_0x330122[_0x22c93b(0x292)]?.[_0x22c93b(0x1cc)]?.['message']?.[_0x22c93b(0x247)]||_0x330122['message']?.[_0x22c93b(0x235)]?.[_0x22c93b(0x1e8)]?.[_0x22c93b(0x272)]?.[_0x22c93b(0x1f7)]||_0x330122[_0x22c93b(0x292)]?.[_0x22c93b(0x235)]?.[_0x22c93b(0x1e8)]?.[_0x22c93b(0x272)]?.['videoMessage'];if(!_0xe2e5e3)console['log'](_0x330122);if(!_0x482828){const _0x1d1b9b=_0xe2e5e3[_0x22c93b(0x1a8)][_0x22c93b(0x1c5)]('/')[0x1][_0x22c93b(0x1c5)](';')[0x0];_0x482828=new Date()[_0x22c93b(0x287)]()+'.'+_0x1d1b9b;}else _0x482828=new Date()[_0x22c93b(0x287)]()+'_'+_0x482828;const _0x2b08d6={'data':_0x25258d,'mimetype':_0xe2e5e3['mimetype'],'filename':_0x482828};return _0x2b08d6;},verifyContact=async(_0x558e1c,_0x2f606d,_0x266f4d)=>{const _0xe7d72f=a552_0x181c7f;let _0x23efc4;try{_0x23efc4=await _0x2f606d[_0xe7d72f(0x1ef)](_0x558e1c['id'],_0xe7d72f(0x2a0));}catch(_0x4188d0){Sentry['captureException'](_0x4188d0),_0x23efc4=process[_0xe7d72f(0x29a)][_0xe7d72f(0x221)]+_0xe7d72f(0x1c2);}const _0x233c20={'name':_0x558e1c['name']||_0x558e1c['id']['replace'](/\D/g,''),'number':_0x558e1c['id']['replace'](/\D/g,''),'profilePicUrl':_0x23efc4,'isGroup':_0x558e1c['id'][_0xe7d72f(0x211)](_0xe7d72f(0x262)),'companyId':_0x266f4d,'remoteJid':_0x558e1c['id']};_0x233c20['isGroup']&&(_0x233c20['number']=_0x558e1c['id'][_0xe7d72f(0x2b5)](_0xe7d72f(0x20e),''));const _0x378227=(0x0,CreateOrUpdateContactService_1[_0xe7d72f(0x24a)])(_0x233c20);return _0x378227;},verifyQuotedMessage=async _0x1e712=>{const _0x4b7b44=a552_0x181c7f;if(!_0x1e712)return null;const _0x69903a=(0x0,exports['getQuotedMessageId'])(_0x1e712);if(!_0x69903a)return null;const _0x12041b=await Message_1[_0x4b7b44(0x24a)][_0x4b7b44(0x19b)]({'where':{'wid':_0x69903a}});if(!_0x12041b)return null;return _0x12041b;},verifyMediaMessage=async(_0x5917e1,_0x1e641b,_0x10844e,_0x125deb)=>{const _0x398b30=a552_0x181c7f,_0x29ba55=(0x0,socket_1['getIO'])(),_0x295f78=await verifyQuotedMessage(_0x5917e1);try{const _0xd130cd=await downloadMedia(_0x5917e1,_0x1e641b?.[_0x398b30(0x1ce)]);if(!_0xd130cd&&_0x1e641b[_0x398b30(0x1ce)]){const _0x43549d='*System:*\x20\x0aFalha\x20no\x20download\x20da\x20mÃ­dia\x20verifique\x20no\x20dispositivo',_0xc1354e={'wid':_0x5917e1[_0x398b30(0x1c4)]['id'],'ticketId':_0x1e641b['id'],'contactId':_0x5917e1['key'][_0x398b30(0x2a7)]?undefined:_0x1e641b['contactId'],'body':_0x43549d,'reactionMessage':_0x5917e1[_0x398b30(0x292)]?.[_0x398b30(0x282)],'fromMe':_0x5917e1[_0x398b30(0x1c4)][_0x398b30(0x2a7)],'mediaType':getTypeMessage(_0x5917e1),'read':_0x5917e1[_0x398b30(0x1c4)][_0x398b30(0x2a7)],'quotedMsgId':_0x295f78?.['id']||_0x5917e1['message']?.[_0x398b30(0x282)]?.['key']?.['id'],'ack':_0x5917e1[_0x398b30(0x21c)],'companyId':_0x1e641b[_0x398b30(0x29d)],'remoteJid':_0x5917e1['key'][_0x398b30(0x226)],'participant':_0x5917e1['key']['participant'],'timestamp':getTimestampMessage(_0x5917e1[_0x398b30(0x21d)]),'createdAt':new Date(Math[_0x398b30(0x1d3)](getTimestampMessage(_0x5917e1['messageTimestamp'])*0x3e8))[_0x398b30(0x1fe)](),'dataJson':JSON[_0x398b30(0x196)](_0x5917e1),'ticketImported':_0x1e641b['imported']};return await _0x1e641b['update']({'lastMessage':_0x43549d}),logger_1[_0x398b30(0x2a9)]['error'](Error(_0x398b30(0x268))),(0x0,CreateMessageService_1[_0x398b30(0x24a)])({'messageData':_0xc1354e,'companyId':_0x1e641b[_0x398b30(0x29d)]});}if(!_0xd130cd)throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');if(!_0xd130cd[_0x398b30(0x239)]||_0xd130cd[_0x398b30(0x1a8)]==='audio/mp4'){const _0x295867=_0xd130cd['mimetype']===_0x398b30(0x2bd)?'m4a':_0xd130cd[_0x398b30(0x1a8)][_0x398b30(0x1c5)]('/')[0x1][_0x398b30(0x1c5)](';')[0x0];_0xd130cd[_0x398b30(0x239)]=new Date()[_0x398b30(0x287)]()+'.'+_0x295867;}else{const _0x3abe1c=_0xd130cd[_0x398b30(0x239)][_0x398b30(0x1c5)]('.')[_0x398b30(0x1de)](),_0x426952=_0xd130cd[_0x398b30(0x239)][_0x398b30(0x1c5)]('.')[_0x398b30(0x1d1)](0x0,-0x1)[_0x398b30(0x222)]('.')[_0x398b30(0x2b5)](/\s/g,'_')[_0x398b30(0x224)](_0x398b30(0x2ac))['replace'](/[\u0300-\u036f]/g,'');_0xd130cd[_0x398b30(0x239)]=_0x426952[_0x398b30(0x26d)]()+'_'+new Date()[_0x398b30(0x287)]()+'.'+_0x3abe1c;}try{const _0x481215=path_1['default'][_0x398b30(0x29e)](__dirname,'..','..','..',_0x398b30(0x28b),_0x398b30(0x280)+_0x1e641b[_0x398b30(0x29d)]);!fs_2[_0x398b30(0x24a)][_0x398b30(0x2b1)](_0x481215)&&(fs_2[_0x398b30(0x24a)][_0x398b30(0x28d)](_0x481215,{'recursive':!![]}),fs_2[_0x398b30(0x24a)]['chmodSync'](_0x481215,0x1ff)),await writeFileAsync((0x0,path_1['join'])(_0x481215,_0xd130cd[_0x398b30(0x239)]),_0xd130cd[_0x398b30(0x2a1)][_0x398b30(0x29b)]('base64'),_0x398b30(0x1b8));}catch(_0x195def){Sentry[_0x398b30(0x1f5)](_0x398b30(0x2aa),{'companyId':_0x1e641b[_0x398b30(0x29d)],'ticket':_0x1e641b,'contact':_0x10844e,'media':_0xd130cd,'quotedMsg':_0x295f78}),Sentry[_0x398b30(0x1e3)](_0x195def),logger_1['logger'][_0x398b30(0x263)](_0x195def),console[_0x398b30(0x241)](_0x5917e1);}const _0x20c178=(0x0,exports['getBodyMessage'])(_0x5917e1),_0x407379={'wid':_0x5917e1['key']['id'],'ticketId':_0x1e641b['id'],'contactId':_0x5917e1['key'][_0x398b30(0x2a7)]?undefined:_0x10844e['id'],'body':_0x20c178||_0xd130cd['filename'],'fromMe':_0x5917e1[_0x398b30(0x1c4)][_0x398b30(0x2a7)],'read':_0x5917e1[_0x398b30(0x1c4)][_0x398b30(0x2a7)],'mediaUrl':_0xd130cd['filename'],'mediaType':_0xd130cd['mimetype']['split']('/')[0x0],'quotedMsgId':_0x295f78?.['id'],'ack':_0x5917e1[_0x398b30(0x21c)],'remoteJid':_0x5917e1[_0x398b30(0x1c4)]['remoteJid'],'participant':_0x5917e1[_0x398b30(0x1c4)]['participant'],'dataJson':JSON[_0x398b30(0x196)](_0x5917e1),'ticketTrakingId':_0x125deb?.['id'],'createdAt':new Date(Math[_0x398b30(0x1d3)](getTimestampMessage(_0x5917e1[_0x398b30(0x21d)])*0x3e8))['toISOString'](),'ticketImported':_0x1e641b[_0x398b30(0x1ce)]};await _0x1e641b[_0x398b30(0x1d7)]({'lastMessage':_0x20c178||_0xd130cd[_0x398b30(0x239)]});const _0x312d5d=await(0x0,CreateMessageService_1[_0x398b30(0x24a)])({'messageData':_0x407379,'companyId':_0x1e641b['companyId']});return!_0x5917e1['key']['fromMe']&&_0x1e641b[_0x398b30(0x21c)]==='closed'&&(await _0x1e641b[_0x398b30(0x1d7)]({'status':'pending'}),await _0x1e641b[_0x398b30(0x1a6)]({'include':[{'model':Queue_1[_0x398b30(0x24a)],'as':_0x398b30(0x2b8)},{'model':User_1[_0x398b30(0x24a)],'as':_0x398b30(0x1cd)},{'model':Contact_1[_0x398b30(0x24a)],'as':_0x398b30(0x25f)}]}),_0x29ba55['to']('closed')[_0x398b30(0x1a0)](_0x398b30(0x1ea)+_0x1e641b[_0x398b30(0x29d)]+_0x398b30(0x24d),{'action':_0x398b30(0x274),'ticket':_0x1e641b,'ticketId':_0x1e641b['id']}),_0x29ba55['to'](_0x1e641b[_0x398b30(0x21c)])['to'](_0x1e641b['id'][_0x398b30(0x29b)]())[_0x398b30(0x1a0)](_0x398b30(0x1ea)+_0x1e641b['companyId']+_0x398b30(0x24d),{'action':_0x398b30(0x1d7),'ticket':_0x1e641b,'ticketId':_0x1e641b['id']})),_0x312d5d;}catch(_0x58d943){console[_0x398b30(0x241)](_0x58d943),logger_1['logger']['warn']('Erro\x20ao\x20baixar\x20media');}},verifyMessage=async(_0x42a363,_0x3031fe,_0x293eb8,_0x1e3237,_0x4bfca0)=>{const _0x602ebf=a552_0x181c7f,_0x90c0af=(0x0,socket_1[_0x602ebf(0x269)])(),_0x2415fc=await verifyQuotedMessage(_0x42a363),_0x150fc7=(0x0,exports[_0x602ebf(0x289)])(_0x42a363),_0xebbcaa={'wid':_0x42a363[_0x602ebf(0x1c4)]['id'],'ticketId':_0x3031fe['id'],'contactId':_0x42a363[_0x602ebf(0x1c4)][_0x602ebf(0x2a7)]?undefined:_0x293eb8['id'],'body':_0x150fc7,'fromMe':_0x42a363[_0x602ebf(0x1c4)][_0x602ebf(0x2a7)],'mediaType':getTypeMessage(_0x42a363),'read':_0x42a363[_0x602ebf(0x1c4)][_0x602ebf(0x2a7)],'quotedMsgId':_0x2415fc?.['id'],'ack':_0x42a363[_0x602ebf(0x21c)],'remoteJid':_0x42a363[_0x602ebf(0x1c4)][_0x602ebf(0x226)],'participant':_0x42a363[_0x602ebf(0x1c4)][_0x602ebf(0x1a1)],'dataJson':JSON[_0x602ebf(0x196)](_0x42a363),'ticketTrakingId':_0x1e3237?.['id'],'isPrivate':_0x4bfca0,'createdAt':new Date(Math[_0x602ebf(0x1d3)](getTimestampMessage(_0x42a363['messageTimestamp'])*0x3e8))['toISOString'](),'ticketImported':_0x3031fe[_0x602ebf(0x1ce)]};await _0x3031fe[_0x602ebf(0x1d7)]({'lastMessage':_0x150fc7}),await(0x0,CreateMessageService_1['default'])({'messageData':_0xebbcaa,'companyId':_0x3031fe['companyId']}),!_0x42a363[_0x602ebf(0x1c4)]['fromMe']&&_0x3031fe[_0x602ebf(0x21c)]==='closed'&&(await _0x3031fe[_0x602ebf(0x1d7)]({'status':'pending'}),await _0x3031fe[_0x602ebf(0x1a6)]({'include':[{'model':Queue_1[_0x602ebf(0x24a)],'as':_0x602ebf(0x2b8)},{'model':User_1[_0x602ebf(0x24a)],'as':'user'},{'model':Contact_1[_0x602ebf(0x24a)],'as':_0x602ebf(0x25f)}]}),_0x90c0af['to']('closed')[_0x602ebf(0x1a0)]('company-'+_0x3031fe[_0x602ebf(0x29d)]+_0x602ebf(0x24d),{'action':_0x602ebf(0x274),'ticket':_0x3031fe,'ticketId':_0x3031fe['id']}),!_0x3031fe[_0x602ebf(0x1ce)]&&_0x90c0af['to'](_0x3031fe[_0x602ebf(0x21c)])['to'](_0x3031fe['id'][_0x602ebf(0x29b)]())[_0x602ebf(0x1a0)]('company-'+_0x3031fe[_0x602ebf(0x29d)]+_0x602ebf(0x24d),{'action':_0x602ebf(0x1d7),'ticket':_0x3031fe,'ticketId':_0x3031fe['id']}));};exports['verifyMessage']=verifyMessage;const isValidMsg=_0x1fca10=>{const _0x1621d1=a552_0x181c7f;if(_0x1fca10['key'][_0x1621d1(0x226)]===_0x1621d1(0x293))return![];try{const _0x375202=getTypeMessage(_0x1fca10);if(!_0x375202)return;const _0xad4314=_0x375202===_0x1621d1(0x253)||_0x375202===_0x1621d1(0x235)||_0x375202===_0x1621d1(0x2c3)||_0x375202===_0x1621d1(0x1bd)||_0x375202===_0x1621d1(0x1f7)||_0x375202===_0x1621d1(0x247)||_0x375202==='stickerMessage'||_0x375202===_0x1621d1(0x257)||_0x375202===_0x1621d1(0x219)||_0x375202==='messageContextInfo'||_0x375202===_0x1621d1(0x290)||_0x375202===_0x1621d1(0x21e)||_0x375202===_0x1621d1(0x2b3)||_0x375202===_0x1621d1(0x251)||_0x375202===_0x1621d1(0x258)||_0x375202===_0x1621d1(0x243)||_0x375202===_0x1621d1(0x282)||_0x375202===_0x1621d1(0x225)||_0x375202===_0x1621d1(0x22f)||_0x375202==='listResponseMessage'||_0x375202==='listMessage'||_0x375202===_0x1621d1(0x276)||_0x375202===_0x1621d1(0x1cc)||_0x375202===_0x1621d1(0x20f)||_0x375202===_0x1621d1(0x1ec);return!_0xad4314&&(logger_1[_0x1621d1(0x2a9)][_0x1621d1(0x275)]('####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20'+_0x375202+'\x0a'+JSON[_0x1621d1(0x196)](_0x1fca10?.[_0x1621d1(0x292)])),Sentry[_0x1621d1(0x1f5)](_0x1621d1(0x237),{'BodyMsg':_0x1fca10[_0x1621d1(0x292)],'msg':_0x1fca10,'msgType':_0x375202}),Sentry[_0x1621d1(0x1e3)](new Error(_0x1621d1(0x249)))),!!_0xad4314;}catch(_0xad2c0){Sentry['setExtra'](_0x1621d1(0x267),{'msg':_0x1fca10}),Sentry[_0x1621d1(0x1e3)](_0xad2c0);}};exports[a552_0x181c7f(0x236)]=isValidMsg;const verifyQueue=async(_0x253271,_0x1ce50b,_0x20b37e,_0x574de0,_0x34a2be)=>{const _0x1d9340=a552_0x181c7f,{queues:_0x22f03b,greetingMessage:_0x2199e5,maxUseBotQueues:_0x1d2e88,timeUseBotQueues:_0x3e6643}=await(0x0,ShowWhatsAppService_1['default'])(_0x253271['id'],_0x20b37e[_0x1d9340(0x29d)]),_0x19c21c=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x20b37e['id'],'companyId':_0x20b37e['companyId'],'whatsappId':_0x20b37e['whatsapp']?.['id']});let _0xd37394=![];_0x22f03b[_0x1d9340(0x229)]===0x1&&(_0xd37394=_0x22f03b[0x0]?.[_0x1d9340(0x28a)][_0x1d9340(0x229)]>0x1);const _0x27213c=_0x34a2be[_0x1d9340(0x20b)](_0x45144e=>_0x45144e[_0x1d9340(0x1c4)]===_0x1d9340(0x216))??'disabled',_0x23faf6=_0x27213c&&_0x27213c?.[_0x1d9340(0x198)]===_0x1d9340(0x19d);if(_0x22f03b[_0x1d9340(0x229)]===0x1&&!_0xd37394){const _0x128f9e=_0x34a2be[_0x1d9340(0x20b)](_0x425359=>_0x425359[_0x1d9340(0x1c4)]===_0x1d9340(0x19f));if(_0x2199e5['length']>0x1&&_0x128f9e['value']===_0x1d9340(0x19d)){const _0x42a8bd=(0x0,Mustache_1['default'])(''+_0x2199e5,_0x20b37e);if(_0x20b37e[_0x1d9340(0x27d)][_0x1d9340(0x1b5)]!==null){const _0x18f42e=path_1[_0x1d9340(0x24a)]['resolve'](_0x1d9340(0x28b),_0x1d9340(0x280)+_0x20b37e[_0x1d9340(0x29d)],_0x20b37e['whatsapp'][_0x1d9340(0x1b5)]),_0x1cffe6=_0x20b37e[_0x1d9340(0x27d)][_0x1d9340(0x1b5)],_0x154e2e=await(0x0,SendWhatsAppMedia_1[_0x1d9340(0x1e1)])(_0x1cffe6,_0x18f42e,String(_0x20b37e[_0x1d9340(0x29d)]),_0x42a8bd),_0x19257a=await _0x253271['sendMessage'](_0x20b37e[_0x1d9340(0x25f)][_0x1d9340(0x21a)]+'@'+(_0x20b37e[_0x1d9340(0x1e7)]?_0x1d9340(0x262):_0x1d9340(0x25b)),{..._0x154e2e});await verifyMediaMessage(_0x19257a,_0x20b37e,_0x574de0,_0x19c21c);}else await _0x253271[_0x1d9340(0x1a2)](_0x574de0[_0x1d9340(0x21a)]+'@'+(_0x20b37e[_0x1d9340(0x1e7)]?_0x1d9340(0x262):_0x1d9340(0x25b)),{'text':_0x42a8bd});}await(0x0,UpdateTicketService_1[_0x1d9340(0x24a)])({'ticketData':{'queueId':_0x22f03b[0x0]['id']},'ticketId':_0x20b37e['id'],'companyId':_0x20b37e[_0x1d9340(0x29d)]});const _0xc85f6d=await Ticket_1[_0x1d9340(0x24a)][_0x1d9340(0x2c1)]({'where':{'userId':null,'status':_0x1d9340(0x2be),'companyId':_0x20b37e[_0x1d9340(0x29d)],'queueId':_0x22f03b[0x0]['id'],'isGroup':![]}});if(_0x23faf6){const _0x55ad38=_0xc85f6d[_0x1d9340(0x1c3)]===0x0?0x1:_0xc85f6d[_0x1d9340(0x1c3)],_0x5f2d94=_0x1d9340(0x1c0)+_0x55ad38+'*',_0x282403=(0x0,Mustache_1['default'])(''+_0x5f2d94,_0x20b37e),_0x971406=(0x0,Debounce_1[_0x1d9340(0x230)])(async()=>{const _0x5355f6=_0x1d9340;await _0x253271[_0x5355f6(0x1a2)](_0x574de0[_0x5355f6(0x21a)]+'@'+(_0x20b37e[_0x5355f6(0x1e7)]?_0x5355f6(0x262):_0x5355f6(0x25b)),{'text':_0x282403});},0xbb8,_0x20b37e['id']);_0x971406();}return;}if(_0x574de0[_0x1d9340(0x21b)])return;let _0x30fcfd='';if(_0x20b37e[_0x1d9340(0x21c)]!==_0x1d9340(0x27f))_0x30fcfd=_0x1ce50b?.[_0x1d9340(0x292)]?.['buttonsResponseMessage']?.[_0x1d9340(0x1ff)]||_0x1ce50b?.[_0x1d9340(0x292)]?.[_0x1d9340(0x283)]?.[_0x1d9340(0x296)][_0x1d9340(0x238)]||(0x0,exports[_0x1d9340(0x289)])(_0x1ce50b);else{if(!(0x0,lodash_1[_0x1d9340(0x234)])(_0x20b37e[_0x1d9340(0x1aa)]))await _0x20b37e['update']({'status':_0x1d9340(0x2be)});await _0x20b37e[_0x1d9340(0x1a6)]();}if(_0x30fcfd==_0x1d9340(0x1d8)){const _0x2130af={'isBot':![],'queueId':null,'userId':null,'status':'closed','sendFarewellMessage':![]};await(0x0,UpdateTicketService_1[_0x1d9340(0x24a)])({'ticketData':_0x2130af,'ticketId':_0x20b37e['id'],'companyId':_0x20b37e[_0x1d9340(0x29d)]});const {complationMessage:_0x280020}=await(0x0,ShowWhatsAppService_1[_0x1d9340(0x24a)])(_0x20b37e[_0x1d9340(0x1da)],_0x20b37e[_0x1d9340(0x29d)]),_0x33d3de={'text':(0x0,Mustache_1[_0x1d9340(0x24a)])('â€Ž'+_0x280020,_0x20b37e)};if(!(0x0,lodash_1['isNil'])(_0x280020)){const _0xc356ce=await _0x253271['sendMessage'](_0x20b37e?.['contact']?.[_0x1d9340(0x21a)]+'@'+(_0x20b37e[_0x1d9340(0x1e7)]?_0x1d9340(0x262):_0x1d9340(0x25b)),_0x33d3de);await(0x0,exports[_0x1d9340(0x271)])(_0xc356ce,_0x20b37e,_0x20b37e['contact']);}return;}const _0x327b5d=_0xd37394&&_0x22f03b['length']===0x1?_0x22f03b[+_0x30fcfd]:_0x22f03b[+_0x30fcfd-0x1],_0x34a4a9=await Setting_1['default'][_0x1d9340(0x19b)]({'where':{'key':_0x1d9340(0x207),'companyId':_0x20b37e[_0x1d9340(0x29d)]}}),_0xcdf11f=_0x34a4a9?.[_0x1d9340(0x198)]||'text';let _0x26133e;if(_0x327b5d)try{const _0x514e80=await(0x0,ListUserQueueServices_1[_0x1d9340(0x24a)])(_0x327b5d['id']);_0x514e80[_0x1d9340(0x232)]>-0x1&&(_0x26133e=_0x514e80[_0x1d9340(0x232)]);}catch(_0x116e71){console[_0x1d9340(0x263)](_0x116e71);}let _0x4ba436=await Setting_1['default'][_0x1d9340(0x19b)]({'where':{'key':_0x1d9340(0x1b9),'companyId':_0x20b37e['companyId']}});const _0x476698=async()=>{const _0x28215c=_0x1d9340;if(_0x327b5d||_0x22f03b[_0x28215c(0x229)]===0x1&&_0xd37394){await(0x0,UpdateTicketService_1[_0x28215c(0x24a)])({'ticketData':{'amountUsedBotQueues':0x0,'queueId':_0x327b5d['id']},'ticketId':_0x20b37e['id'],'companyId':_0x20b37e['companyId']});if(_0x327b5d[_0x28215c(0x28a)]['length']>0x0){let _0x1f140a='';_0x327b5d[_0x28215c(0x28a)]['forEach']((_0x294da7,_0x510287)=>{const _0x561131=_0x28215c;_0x1f140a+='*'+(_0x510287+0x1)+_0x561131(0x1c6)+_0x294da7['name']+'\x0a';});const _0x44c39d=(0x0,Mustache_1[_0x28215c(0x24a)])('â€Ž'+_0x327b5d[_0x28215c(0x25c)]+'\x0a\x0a'+_0x1f140a+_0x28215c(0x1c7),_0x20b37e),_0x59c26a=await _0x253271['sendMessage'](_0x574de0['number']+'@'+(_0x20b37e['isGroup']?_0x28215c(0x262):_0x28215c(0x25b)),{'text':_0x44c39d});await(0x0,exports[_0x28215c(0x271)])(_0x59c26a,_0x20b37e,_0x574de0,_0x19c21c),_0x4ba436?.[_0x28215c(0x198)]==='enabled'&&await(0x0,UpdateTicketService_1[_0x28215c(0x24a)])({'ticketData':{'userId':_0x26133e},'ticketId':_0x20b37e['id'],'companyId':_0x20b37e[_0x28215c(0x29d)]});}if(!_0x327b5d[_0x28215c(0x28a)]['length']&&_0x327b5d[_0x28215c(0x25c)]['length']!==0x0){const _0x334a04=(0x0,Mustache_1[_0x28215c(0x24a)])('â€Ž'+_0x327b5d['greetingMessage'],_0x20b37e),_0x4ce527=await _0x253271[_0x28215c(0x1a2)](_0x574de0['number']+'@'+(_0x20b37e[_0x28215c(0x1e7)]?_0x28215c(0x262):'s.whatsapp.net'),{'text':_0x334a04});await(0x0,exports['verifyMessage'])(_0x4ce527,_0x20b37e,_0x574de0,_0x19c21c);}const _0x4cb8fa=await Ticket_1['default'][_0x28215c(0x2c1)]({'where':{'userId':null,'status':'pending','companyId':_0x20b37e['companyId'],'queueId':_0x327b5d['id'],'isGroup':![]}});if(_0x27213c[_0x28215c(0x198)]==='enabled'&&!_0x327b5d['chatbots'][_0x28215c(0x229)]){const _0x16a29d=_0x4cb8fa[_0x28215c(0x1c3)]===0x0?0x1:_0x4cb8fa['count'],_0x2d54bc=_0x28215c(0x1c0)+_0x16a29d+'*',_0x582c7b=(0x0,Mustache_1[_0x28215c(0x24a)])(''+_0x2d54bc,_0x20b37e),_0x54ce5a=(0x0,Debounce_1[_0x28215c(0x230)])(async()=>{const _0x1b2160=_0x28215c;await _0x253271[_0x1b2160(0x1a2)](_0x574de0[_0x1b2160(0x21a)]+'@'+(_0x20b37e['isGroup']?_0x1b2160(0x262):_0x1b2160(0x25b)),{'text':_0x582c7b});},0xbb8,_0x20b37e['id']);_0x54ce5a();}}else{if(_0x1d2e88&&_0x1d2e88!==0x0&&_0x20b37e[_0x28215c(0x1fc)]>=_0x1d2e88)return;const _0x2563e7=await(0x0,FindOrCreateATicketTrakingService_1[_0x28215c(0x24a)])({'ticketId':_0x20b37e['id'],'companyId':_0x20b37e[_0x28215c(0x29d)]});let _0xf63476=new Date(),_0x1e0ddd=new Date();if(_0x2563e7[_0x28215c(0x1bb)]!==null){_0xf63476[_0x28215c(0x20d)](_0x2563e7[_0x28215c(0x1bb)][_0x28215c(0x1ca)]()+Number(_0x3e6643));if(_0x2563e7[_0x28215c(0x1bb)]!==null&&_0x1e0ddd<_0xf63476&&_0x3e6643!=='0')return;}await _0x2563e7['update']({'chatbotAt':null});let _0x4eccc4='';_0x22f03b[_0x28215c(0x2b4)]((_0x5795e8,_0x2321a3)=>{const _0x3c3bc8=_0x28215c;_0x4eccc4+='*[\x20'+(_0x2321a3+0x1)+_0x3c3bc8(0x2bc)+_0x5795e8[_0x3c3bc8(0x1cb)]+'\x0a';}),_0x4eccc4+=_0x28215c(0x299);const _0x95d6cb=(0x0,Mustache_1['default'])('â€Ž'+_0x2199e5+'\x0a\x0a'+_0x4eccc4,_0x20b37e);if(_0x20b37e[_0x28215c(0x27d)][_0x28215c(0x1b5)]!==null){const _0x48cd2c=path_1[_0x28215c(0x24a)]['resolve'](_0x28215c(0x28b),_0x28215c(0x280)+_0x20b37e[_0x28215c(0x29d)],_0x20b37e[_0x28215c(0x27d)][_0x28215c(0x1b5)]),_0x492f2e=_0x20b37e[_0x28215c(0x27d)][_0x28215c(0x1b5)],_0x254169=await(0x0,SendWhatsAppMedia_1[_0x28215c(0x1e1)])(_0x492f2e,_0x48cd2c,String(_0x20b37e[_0x28215c(0x29d)]),_0x95d6cb);let _0x184c6b=await _0x253271['sendMessage'](_0x20b37e['contact'][_0x28215c(0x21a)]+'@'+(_0x20b37e[_0x28215c(0x1e7)]?_0x28215c(0x262):_0x28215c(0x25b)),{..._0x254169});await verifyMediaMessage(_0x184c6b,_0x20b37e,_0x574de0,_0x2563e7),await(0x0,UpdateTicketService_1[_0x28215c(0x24a)])({'ticketData':{'amountUsedBotQueues':_0x20b37e['amountUsedBotQueues']+0x1},'ticketId':_0x20b37e['id'],'companyId':_0x20b37e[_0x28215c(0x29d)]});return;}else{const _0x44c16a=(0x0,Debounce_1[_0x28215c(0x230)])(async()=>{const _0x1e13fb=_0x28215c,_0x2c19c1=await _0x253271[_0x1e13fb(0x1a2)](_0x574de0[_0x1e13fb(0x21a)]+'@'+(_0x20b37e[_0x1e13fb(0x1e7)]?_0x1e13fb(0x262):'s.whatsapp.net'),{'text':_0x95d6cb});(0x0,exports[_0x1e13fb(0x271)])(_0x2c19c1,_0x20b37e,_0x574de0,_0x2563e7);},0x3e8,_0x20b37e['id']);await(0x0,UpdateTicketService_1[_0x28215c(0x24a)])({'ticketData':{'amountUsedBotQueues':_0x20b37e[_0x28215c(0x1fc)]+0x1},'ticketId':_0x20b37e['id'],'companyId':_0x20b37e[_0x28215c(0x29d)]}),_0x44c16a();}}},_0x49584a=async()=>{const _0x34d792=_0x1d9340;if(_0x327b5d){await(0x0,UpdateTicketService_1[_0x34d792(0x24a)])({'ticketData':{'queueId':_0x327b5d['id']},'ticketId':_0x20b37e['id'],'companyId':_0x20b37e[_0x34d792(0x29d)]});if(_0x327b5d['chatbots'][_0x34d792(0x229)]>0x0){const _0x41b5b=[];_0x327b5d['chatbots'][_0x34d792(0x2b4)]((_0x396891,_0xfe0843)=>{const _0x432bad=_0x34d792;_0x41b5b[_0x432bad(0x2af)]({'buttonId':''+(_0xfe0843+0x1),'buttonText':{'displayText':_0x396891[_0x432bad(0x1cb)]},'type':0x1});});const _0x5b605e={'text':(0x0,Mustache_1[_0x34d792(0x24a)])(''+_0x327b5d[_0x34d792(0x25c)],_0x20b37e),'buttons':_0x41b5b,'headerType':0x4},_0x201693=await _0x253271[_0x34d792(0x1a2)](_0x574de0['number']+'@'+(_0x20b37e[_0x34d792(0x1e7)]?_0x34d792(0x262):'s.whatsapp.net'),_0x5b605e);await(0x0,exports[_0x34d792(0x271)])(_0x201693,_0x20b37e,_0x574de0,_0x19c21c);}if(!_0x327b5d[_0x34d792(0x28a)][_0x34d792(0x229)]){const _0x2d48fb=(0x0,Mustache_1[_0x34d792(0x24a)])(''+_0x327b5d['greetingMessage'],_0x20b37e),_0x43343b=await _0x253271[_0x34d792(0x1a2)](_0x574de0['number']+'@'+(_0x20b37e['isGroup']?_0x34d792(0x262):_0x34d792(0x25b)),{'text':_0x2d48fb});await(0x0,exports['verifyMessage'])(_0x43343b,_0x20b37e,_0x574de0,_0x19c21c);}}else{const _0x3b1afc=[];_0x22f03b[_0x34d792(0x2b4)]((_0x5ec8ff,_0x2ea934)=>{const _0x254d3a=_0x34d792;_0x3b1afc[_0x254d3a(0x2af)]({'buttonId':''+(_0x2ea934+0x1),'buttonText':{'displayText':_0x5ec8ff['name']},'type':0x4});});const _0x28a61e={'text':(0x0,Mustache_1[_0x34d792(0x24a)])(''+_0x2199e5,_0x20b37e),'footer':'','buttons':_0x3b1afc,'headerType':0x4},_0x1f53ae=await _0x253271['sendMessage'](_0x574de0['number']+'@'+(_0x20b37e[_0x34d792(0x1e7)]?_0x34d792(0x262):_0x34d792(0x25b)),_0x28a61e);await(0x0,exports['verifyMessage'])(_0x1f53ae,_0x20b37e,_0x574de0,_0x19c21c),await(0x0,UpdateTicketService_1[_0x34d792(0x24a)])({'ticketData':{'amountUsedBotQueues':_0x20b37e[_0x34d792(0x1fc)]+0x1},'ticketId':_0x20b37e['id'],'companyId':_0x20b37e[_0x34d792(0x29d)]});}},_0x3492cc=async()=>{const _0x102023=_0x1d9340;if(_0x327b5d){await(0x0,UpdateTicketService_1[_0x102023(0x24a)])({'ticketData':{'queueId':_0x327b5d['id']},'ticketId':_0x20b37e['id'],'companyId':_0x20b37e[_0x102023(0x29d)]});if(_0x327b5d[_0x102023(0x28a)][_0x102023(0x229)]>0x0){const _0x445b07=[];_0x327b5d[_0x102023(0x28a)]['forEach']((_0x3ae004,_0x43fb03)=>{const _0x54c02a=_0x102023;_0x445b07['push']({'title':_0x3ae004[_0x54c02a(0x1cb)],'rowId':''+(_0x43fb03+0x1)});});const _0x33ec10=[{'title':'Menu','rows':_0x445b07}],_0x5b2e37={'text':(0x0,Mustache_1[_0x102023(0x24a)])(''+_0x327b5d[_0x102023(0x25c)],_0x20b37e),'buttonText':'Escolha\x20uma\x20opÃ§Ã£o','sections':_0x33ec10},_0x47ba5f=await _0x253271[_0x102023(0x1a2)](_0x574de0['number']+'@'+(_0x20b37e['isGroup']?_0x102023(0x262):_0x102023(0x25b)),_0x5b2e37);await(0x0,exports[_0x102023(0x271)])(_0x47ba5f,_0x20b37e,_0x574de0,_0x19c21c);}if(!_0x327b5d['chatbots'][_0x102023(0x229)]){const _0x40c97c=(0x0,Mustache_1[_0x102023(0x24a)])(''+_0x327b5d[_0x102023(0x25c)],_0x20b37e),_0x37725f=await _0x253271['sendMessage'](_0x574de0['number']+'@'+(_0x20b37e[_0x102023(0x1e7)]?_0x102023(0x262):_0x102023(0x25b)),{'text':_0x40c97c});await(0x0,exports['verifyMessage'])(_0x37725f,_0x20b37e,_0x574de0,_0x19c21c);}}else{const _0x561201=[];_0x22f03b[_0x102023(0x2b4)]((_0xea3846,_0x324256)=>{const _0x3e90ae=_0x102023;_0x561201['push']({'title':_0xea3846[_0x3e90ae(0x1cb)],'rowId':''+(_0x324256+0x1)});});const _0x5654d7=[{'title':_0x102023(0x1f0),'rows':_0x561201}],_0x33b205={'text':(0x0,Mustache_1['default'])(''+_0x2199e5,_0x20b37e),'buttonText':_0x102023(0x281),'sections':_0x5654d7},_0x5ed737=await _0x253271[_0x102023(0x1a2)](_0x574de0[_0x102023(0x21a)]+'@'+(_0x20b37e[_0x102023(0x1e7)]?_0x102023(0x262):'s.whatsapp.net'),_0x33b205);await(0x0,exports['verifyMessage'])(_0x5ed737,_0x20b37e,_0x574de0,_0x19c21c),await(0x0,UpdateTicketService_1[_0x102023(0x24a)])({'ticketData':{'amountUsedBotQueues':_0x20b37e[_0x102023(0x1fc)]+0x1},'ticketId':_0x20b37e['id'],'companyId':_0x20b37e[_0x102023(0x29d)]});}};if(_0xcdf11f==='text')return _0x476698();if(_0xcdf11f===_0x1d9340(0x2bb)&&_0x22f03b['length']>0x3)return _0x476698();if(_0xcdf11f===_0x1d9340(0x2bb)&&_0x22f03b['length']<=0x3)return _0x49584a();if(_0xcdf11f==='list')return _0x3492cc();},verifyRating=_0x4cadee=>{const _0x232f89=a552_0x181c7f;if(_0x4cadee&&_0x4cadee[_0x232f89(0x223)]===null&&_0x4cadee[_0x232f89(0x22e)]!==null&&_0x4cadee[_0x232f89(0x232)]!==null&&_0x4cadee[_0x232f89(0x2bf)]===null)return!![];return![];};exports[a552_0x181c7f(0x204)]=verifyRating;function a552_0x4ed1(_0x21193a,_0x3d063c){const _0x1f6e92=a552_0x1f6e();return a552_0x4ed1=function(_0x4ed19b,_0x3ffd0d){_0x4ed19b=_0x4ed19b-0x192;let _0x214d37=_0x1f6e92[_0x4ed19b];return _0x214d37;},a552_0x4ed1(_0x21193a,_0x3d063c);}const handleRating=async(_0x334d0f,_0x4747f5,_0x3d0e10)=>{const _0x315bee=a552_0x181c7f,_0x5e8a37=(0x0,socket_1[_0x315bee(0x269)])(),{complationMessage:_0xe1c847}=await(0x0,ShowWhatsAppService_1[_0x315bee(0x24a)])(_0x4747f5[_0x315bee(0x1da)],_0x4747f5[_0x315bee(0x29d)]);let _0x53ced9=_0x334d0f;_0x334d0f<0x0&&(_0x53ced9=0x0);_0x334d0f>0xa&&(_0x53ced9=0xa);await UserRating_1[_0x315bee(0x24a)][_0x315bee(0x1f8)]({'ticketId':_0x3d0e10[_0x315bee(0x297)],'companyId':_0x3d0e10[_0x315bee(0x29d)],'userId':_0x3d0e10['userId'],'rate':_0x53ced9});if(!(0x0,lodash_1[_0x315bee(0x234)])(_0xe1c847)&&_0xe1c847!==''&&!_0x4747f5[_0x315bee(0x1e7)]){const _0x1dfc19=(0x0,Mustache_1[_0x315bee(0x24a)])('â€Ž'+_0xe1c847,_0x4747f5);if(_0x4747f5['channel']===_0x315bee(0x27d)){const _0x257868=await(0x0,SendWhatsAppMessage_1[_0x315bee(0x24a)])({'body':_0x1dfc19,'ticket':_0x4747f5});await(0x0,exports[_0x315bee(0x271)])(_0x257868,_0x4747f5,_0x4747f5[_0x315bee(0x25f)],_0x3d0e10);}[_0x315bee(0x1dd),'instagram'][_0x315bee(0x211)](_0x4747f5[_0x315bee(0x195)])&&await(0x0,sendFacebookMessage_1['default'])({'body':_0x1dfc19,'ticket':_0x4747f5});}await _0x4747f5[_0x315bee(0x1d7)]({'chatbot':null,'status':_0x315bee(0x22d),'amountUseBotQueuesNPS':0x0}),_0x5e8a37['to'](_0x315bee(0x23b))[_0x315bee(0x1a0)](_0x315bee(0x1ea)+_0x4747f5[_0x315bee(0x29d)]+_0x315bee(0x24d),{'action':_0x315bee(0x274),'ticket':_0x4747f5,'ticketId':_0x4747f5['id']}),_0x5e8a37['to'](_0x4747f5[_0x315bee(0x21c)])['to'](_0x4747f5['id'][_0x315bee(0x29b)]())['emit']('company-'+_0x4747f5[_0x315bee(0x29d)]+_0x315bee(0x24d),{'action':'update','ticket':_0x4747f5,'ticketId':_0x4747f5['id']});};exports[a552_0x181c7f(0x228)]=handleRating;const handleMessage=async(_0x3b56ab,_0x1e6e57,_0x214701,_0x5085c3=![])=>{const _0x5bb1d5=a552_0x181c7f;if(_0x5085c3){(0x0,addLogs_1[_0x5bb1d5(0x203)])({'fileName':_0x5bb1d5(0x254)+_0x1e6e57['id']+'.txt','text':'Importando\x20Mensagem:\x20'+JSON[_0x5bb1d5(0x196)](_0x3b56ab,null,0x2)+_0x5bb1d5(0x25a)});let _0x59cb46=_0x3b56ab[_0x5bb1d5(0x1c4)]['id'],_0x34f0f1=await Message_1[_0x5bb1d5(0x24a)][_0x5bb1d5(0x19b)]({'where':{'wid':_0x59cb46}});if(_0x34f0f1){await new Promise(_0x303204=>setTimeout(_0x303204,0x96)),console[_0x5bb1d5(0x241)](_0x5bb1d5(0x1f6));return;}else await new Promise(_0x373c96=>setTimeout(_0x373c96,parseInt(process[_0x5bb1d5(0x29a)][_0x5bb1d5(0x2a6)])||0x14a));}else await new Promise(_0x292dbe=>setTimeout(_0x292dbe,i*0x28a)),console[_0x5bb1d5(0x241)](i),i++;if(!isValidMsg(_0x3b56ab))return;try{let _0xe37cbc,_0x37c7b9,_0x2ad916=0x0,_0x580b68=0x0,_0x52b081=0x0,_0x4a89a6=(0x0,exports[_0x5bb1d5(0x289)])(_0x3b56ab);const _0x4334f1=getTypeMessage(_0x3b56ab);if(_0x4334f1===_0x5bb1d5(0x22f))return;const _0x3efa7c=_0x3b56ab[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x2c3)]||_0x3b56ab['message']?.[_0x5bb1d5(0x1f7)]||_0x3b56ab[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x1bd)]||_0x3b56ab[_0x5bb1d5(0x292)]?.['documentMessage']||_0x3b56ab[_0x5bb1d5(0x292)][_0x5bb1d5(0x26b)]||_0x3b56ab?.[_0x5bb1d5(0x292)]?.['ephemeralMessage']?.[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x1f7)]||_0x3b56ab?.[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x225)]?.[_0x5bb1d5(0x292)]?.['audioMessage']||_0x3b56ab?.[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x225)]?.[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x1bd)]||_0x3b56ab?.[_0x5bb1d5(0x292)]?.['ephemeralMessage']?.['message']?.['documentMessage']||_0x3b56ab?.['message']?.[_0x5bb1d5(0x225)]?.[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x26b)]||_0x3b56ab[_0x5bb1d5(0x292)]?.['viewOnceMessage']?.[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x1f7)]||_0x3b56ab['message']?.[_0x5bb1d5(0x276)]?.[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x1bd)]||_0x3b56ab[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x225)]?.[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x276)]?.['message']?.['imageMessage']||_0x3b56ab[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x225)]?.['message']?.['viewOnceMessage']?.[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x1bd)]||_0x3b56ab['message']?.[_0x5bb1d5(0x1cc)]?.[_0x5bb1d5(0x292)]?.['documentMessage'],_0x3b6eb7=/\u200d/[_0x5bb1d5(0x248)](_0x4a89a6);if(_0x3b56ab[_0x5bb1d5(0x1c4)][_0x5bb1d5(0x2a7)]){if(/\u200e/[_0x5bb1d5(0x248)](_0x4a89a6))return;if(!_0x3efa7c&&_0x4334f1!=='conversation'&&_0x4334f1!==_0x5bb1d5(0x235)&&_0x4334f1!==_0x5bb1d5(0x2b3)&&_0x4334f1!==_0x5bb1d5(0x282)&&_0x4334f1!=='ephemeralMessage'&&_0x4334f1!==_0x5bb1d5(0x22f)&&_0x4334f1!==_0x5bb1d5(0x276)&&_0x4334f1!==_0x5bb1d5(0x1ec))return;_0xe37cbc=await getContactMessage(_0x3b56ab,_0x1e6e57);}else _0xe37cbc=await getContactMessage(_0x3b56ab,_0x1e6e57);const _0x5f1a56=_0x3b56ab['key'][_0x5bb1d5(0x226)]?.[_0x5bb1d5(0x1cf)](_0x5bb1d5(0x20e)),_0x4e6d23=await(0x0,ShowWhatsAppService_1[_0x5bb1d5(0x24a)])(_0x1e6e57['id'],_0x214701);if(!_0x4e6d23[_0x5bb1d5(0x294)]&&_0x5f1a56)return;if(_0x5f1a56){const _0x1ce893=await _0x1e6e57[_0x5bb1d5(0x28e)](_0x3b56ab[_0x5bb1d5(0x1c4)][_0x5bb1d5(0x226)]),_0x36b802={'id':_0x1ce893['id'],'name':_0x1ce893[_0x5bb1d5(0x260)]};_0x37c7b9=await verifyContact(_0x36b802,_0x1e6e57,_0x214701);}const _0x5f5619=await verifyContact(_0xe37cbc,_0x1e6e57,_0x214701);let _0x355e99=0x0,_0x36a413=null;if(_0x3b56ab[_0x5bb1d5(0x1c4)]['fromMe'])await cache_1['default'][_0x5bb1d5(0x26c)]('contacts:'+_0x5f5619['id']+':unreads','0');else{const _0x37481b=await cache_1[_0x5bb1d5(0x24a)][_0x5bb1d5(0x20c)](_0x5bb1d5(0x205)+_0x5f5619['id']+_0x5bb1d5(0x270));_0x355e99=+_0x37481b+0x1,await cache_1[_0x5bb1d5(0x24a)][_0x5bb1d5(0x26c)](_0x5bb1d5(0x205)+_0x5f5619['id']+_0x5bb1d5(0x270),''+_0x355e99);}const _0x38b7b2=await(0x0,ListSettingsService_1['default'])({'companyId':_0x214701}),_0x288ccc=_0x38b7b2[_0x5bb1d5(0x20b)](_0x53484e=>_0x53484e[_0x5bb1d5(0x1c4)]==='enableLGPD'),_0x576cb6=_0x38b7b2[_0x5bb1d5(0x20b)](_0x489ebe=>_0x489ebe[_0x5bb1d5(0x1c4)]===_0x5bb1d5(0x1ed)),_0x51a313=_0x38b7b2[_0x5bb1d5(0x20b)](_0x3246e5=>_0x3246e5[_0x5bb1d5(0x1c4)]===_0x5bb1d5(0x1e2)),_0x496728=_0x38b7b2['find'](_0x2a2960=>_0x2a2960[_0x5bb1d5(0x1c4)]==='lgpdConsent'),{ticket:_0x4faeaf,isCreated:_0x24f734}=await(0x0,FindOrCreateTicketService_1[_0x5bb1d5(0x24a)])(_0x5f5619,_0x4e6d23,_0x355e99,_0x214701,_0x2ad916,_0x52b081,_0x37c7b9,_0x5bb1d5(0x27d),_0x5085c3,![],_0x38b7b2);_0x36a413=_0x4faeaf;if(_0x355e99===0x0&&_0x4e6d23['complationMessage']&&(0x0,Mustache_1[_0x5bb1d5(0x24a)])(_0x4e6d23[_0x5bb1d5(0x1a4)],_0x36a413)===_0x4a89a6)return;if(_0x4334f1==='editedMessage'){const _0x5a8cf9=_0x3b56ab[_0x5bb1d5(0x292)][_0x5bb1d5(0x1ec)][_0x5bb1d5(0x292)][_0x5bb1d5(0x22f)][_0x5bb1d5(0x1c4)]['id'],_0x340ab0=_0x3b56ab[_0x5bb1d5(0x292)][_0x5bb1d5(0x1ec)]['message'][_0x5bb1d5(0x22f)][_0x5bb1d5(0x1ec)]['conversation'],_0x594485=(0x0,socket_1['getIO'])();try{const _0xd64bc5=await Message_1[_0x5bb1d5(0x24a)][_0x5bb1d5(0x19b)]({'where':{'wid':_0x5a8cf9,'companyId':_0x214701,'ticketId':_0x36a413['id']}});if(!_0xd64bc5)return;await _0xd64bc5[_0x5bb1d5(0x1d7)]({'isEdited':!![],'body':_0x340ab0}),_0x594485['to'](_0xd64bc5[_0x5bb1d5(0x297)]['toString']())[_0x5bb1d5(0x1a0)](_0x5bb1d5(0x1ea)+_0xd64bc5[_0x5bb1d5(0x29d)]+_0x5bb1d5(0x1eb),{'action':'update','message':_0xd64bc5});}catch(_0x4dc59b){Sentry[_0x5bb1d5(0x1e3)](_0x4dc59b),logger_1[_0x5bb1d5(0x2a9)]['error'](_0x5bb1d5(0x26a)+_0x4dc59b);}return;}const _0x3f95d9=await(0x0,FindOrCreateATicketTrakingService_1[_0x5bb1d5(0x24a)])({'ticketId':_0x36a413['id'],'companyId':_0x214701,'whatsappId':_0x4e6d23?.['id']});try{if(!_0x3b56ab[_0x5bb1d5(0x1c4)][_0x5bb1d5(0x2a7)]){if(_0x36a413[_0x5bb1d5(0x21c)]==='nps'&&_0x3f95d9!==null&&(0x0,exports['verifyRating'])(_0x3f95d9)){if(!isNaN(parseFloat(_0x4a89a6))){(0x0,exports[_0x5bb1d5(0x228)])(parseFloat(_0x4a89a6),_0x36a413,_0x3f95d9),await _0x3f95d9[_0x5bb1d5(0x1d7)]({'ratingAt':(0x0,moment_1[_0x5bb1d5(0x24a)])()[_0x5bb1d5(0x1f4)](),'finishedAt':(0x0,moment_1[_0x5bb1d5(0x24a)])()['toDate'](),'rated':!![]});return;}else{if(_0x36a413['amountUseBotQueuesNPS']<_0x4e6d23[_0x5bb1d5(0x1bc)]){let _0x3dbd90=_0x5bb1d5(0x288);const _0x599294=await _0x1e6e57[_0x5bb1d5(0x1a2)](_0x36a413[_0x5bb1d5(0x25f)]['number']+'@'+(_0x36a413[_0x5bb1d5(0x1e7)]?'g.us':_0x5bb1d5(0x25b)),{'text':_0x3dbd90});(0x0,exports['verifyMessage'])(_0x599294,_0x36a413,_0x5f5619,_0x3f95d9),await(0x0,baileys_1['delay'])(0x3e8);let _0x8c362b='â€Ž'+_0x4e6d23[_0x5bb1d5(0x1e9)]+'\x0a';const _0x146168=await(0x0,SendWhatsAppMessage_1[_0x5bb1d5(0x24a)])({'body':_0x8c362b,'ticket':_0x36a413});await(0x0,exports[_0x5bb1d5(0x271)])(_0x146168,_0x36a413,_0x36a413['contact']),await _0x36a413[_0x5bb1d5(0x1d7)]({'amountUseBotQueuesNPS':_0x36a413[_0x5bb1d5(0x2b6)]+0x1});}return;}}if(_0x288ccc){if(_0x36a413[_0x5bb1d5(0x21c)]==='lgpd'&&!(0x0,lodash_1['isNil'])(_0x288ccc?.[_0x5bb1d5(0x198)])&&_0x288ccc?.[_0x5bb1d5(0x198)]==='enabled'&&!_0x5085c3){if((0x0,lodash_1[_0x5bb1d5(0x234)])(_0x36a413[_0x5bb1d5(0x1aa)])&&!(0x0,lodash_1[_0x5bb1d5(0x234)])(_0x36a413['lgpdSendMessageAt'])){let _0x39e766=null;_0x3b56ab?.[_0x5bb1d5(0x292)]?.[_0x5bb1d5(0x253)]&&(_0x39e766=~~+_0x3b56ab['message']?.[_0x5bb1d5(0x253)]);if(!Number[_0x5bb1d5(0x2ab)](_0x39e766)&&Number[_0x5bb1d5(0x19e)](_0x39e766)&&!(0x0,lodash_1[_0x5bb1d5(0x1d9)])(_0x39e766)&&_0x39e766>0x0){if(_0x39e766===0x1)await _0x5f5619['update']({'lgpdAcceptedAt':(0x0,moment_1[_0x5bb1d5(0x24a)])()[_0x5bb1d5(0x1f4)]()}),await _0x36a413[_0x5bb1d5(0x1d7)]({'lgpdAcceptedAt':(0x0,moment_1[_0x5bb1d5(0x24a)])()['toDate'](),'amountUsedBotQueues':0x0});else{if(_0x39e766===0x2){if(_0x4e6d23[_0x5bb1d5(0x1a4)]!==''&&_0x4e6d23[_0x5bb1d5(0x1a4)]!==undefined){const _0x190159=await _0x1e6e57['sendMessage'](_0x36a413[_0x5bb1d5(0x25f)][_0x5bb1d5(0x21a)]+'@'+(_0x36a413[_0x5bb1d5(0x1e7)]?_0x5bb1d5(0x262):'s.whatsapp.net'),{'text':'â€Ž'+_0x4e6d23['complationMessage']});(0x0,exports[_0x5bb1d5(0x271)])(_0x190159,_0x36a413,_0x5f5619,_0x3f95d9);}await _0x36a413[_0x5bb1d5(0x1d7)]({'status':_0x5bb1d5(0x22d),'amountUsedBotQueues':0x0}),await _0x3f95d9[_0x5bb1d5(0x1b2)];return;}else _0x36a413[_0x5bb1d5(0x1fc)]<_0x4e6d23[_0x5bb1d5(0x233)]&&await _0x36a413[_0x5bb1d5(0x1d7)]({'amountUsedBotQueues':_0x36a413[_0x5bb1d5(0x1fc)]+0x1,'lgpdSendMessageAt':null});}}else _0x36a413[_0x5bb1d5(0x1fc)]<_0x4e6d23['maxUseBotQueues']&&await _0x36a413[_0x5bb1d5(0x1d7)]({'amountUsedBotQueues':_0x36a413[_0x5bb1d5(0x1fc)]+0x1,'lgpdSendMessageAt':null});}if((_0x5f5619['lgpdAcceptedAt']===null||_0x496728?.[_0x5bb1d5(0x198)]===_0x5bb1d5(0x19d))&&!_0x5f5619[_0x5bb1d5(0x1e7)]&&(0x0,lodash_1[_0x5bb1d5(0x234)])(_0x36a413[_0x5bb1d5(0x2a2)])&&_0x36a413['amountUsedBotQueues']<=_0x4e6d23['maxUseBotQueues']&&!(0x0,lodash_1[_0x5bb1d5(0x234)])(_0x576cb6?.[_0x5bb1d5(0x198)])){_0x3efa7c?await verifyMediaMessage(_0x3b56ab,_0x36a413,_0x5f5619):await(0x0,exports[_0x5bb1d5(0x271)])(_0x3b56ab,_0x36a413,_0x5f5619,_0x3f95d9,_0x3b6eb7);if(!(0x0,lodash_1[_0x5bb1d5(0x234)])(_0x576cb6?.[_0x5bb1d5(0x198)])){const _0x2d6c0f=(0x0,Mustache_1[_0x5bb1d5(0x24a)])('â€Ž'+_0x576cb6?.['value'],_0x36a413),_0x1c40f2=await _0x1e6e57[_0x5bb1d5(0x1a2)](_0x36a413['contact'][_0x5bb1d5(0x21a)]+'@'+(_0x36a413[_0x5bb1d5(0x1e7)]?_0x5bb1d5(0x262):_0x5bb1d5(0x25b)),{'text':_0x2d6c0f});(0x0,exports['verifyMessage'])(_0x1c40f2,_0x36a413,_0x5f5619,_0x3f95d9);}await(0x0,baileys_1['delay'])(0x3e8);if((0x0,lodash_1['isNil'])(_0x51a313?.[_0x5bb1d5(0x198)])){const _0x1b990b=(0x0,Mustache_1[_0x5bb1d5(0x24a)])('â€Ž'+_0x51a313['value'],_0x36a413),_0x433e86=await _0x1e6e57[_0x5bb1d5(0x1a2)](_0x36a413[_0x5bb1d5(0x25f)][_0x5bb1d5(0x21a)]+'@'+(_0x36a413[_0x5bb1d5(0x1e7)]?_0x5bb1d5(0x262):_0x5bb1d5(0x25b)),{'text':_0x1b990b});await(0x0,exports['verifyMessage'])(_0x433e86,_0x36a413,_0x5f5619,_0x3f95d9);};await(0x0,baileys_1['delay'])(0x3e8);const _0x2295f0=(0x0,Mustache_1[_0x5bb1d5(0x24a)])(_0x5bb1d5(0x1a3),_0x36a413),_0x50c2c5=await _0x1e6e57[_0x5bb1d5(0x1a2)](_0x36a413[_0x5bb1d5(0x25f)]['number']+'@'+(_0x36a413['isGroup']?_0x5bb1d5(0x262):_0x5bb1d5(0x25b)),{'text':_0x2295f0});await(0x0,exports[_0x5bb1d5(0x271)])(_0x50c2c5,_0x36a413,_0x5f5619,_0x3f95d9),await _0x36a413[_0x5bb1d5(0x1d7)]({'lgpdSendMessageAt':(0x0,moment_1['default'])()[_0x5bb1d5(0x1f4)](),'amountUsedBotQueues':_0x36a413['amountUsedBotQueues']+0x1}),await _0x36a413[_0x5bb1d5(0x1a6)]();return;};if(!(0x0,lodash_1['isNil'])(_0x36a413[_0x5bb1d5(0x2a2)])&&(0x0,lodash_1['isNil'])(_0x36a413[_0x5bb1d5(0x1aa)]))return;}}}}catch(_0x1ee9b8){Sentry['captureException'](_0x1ee9b8),console['log'](_0x1ee9b8);}_0x3efa7c?await verifyMediaMessage(_0x3b56ab,_0x36a413,_0x5f5619):await(0x0,exports['verifyMessage'])(_0x3b56ab,_0x36a413,_0x5f5619,_0x3f95d9,_0x3b6eb7);try{await _0x36a413[_0x5bb1d5(0x1d7)]({'fromMe':_0x3b56ab[_0x5bb1d5(0x1c4)][_0x5bb1d5(0x2a7)]});}catch(_0x396c35){Sentry[_0x5bb1d5(0x1e3)](_0x396c35),console[_0x5bb1d5(0x241)](_0x396c35);}const _0x5cc099=await Setting_1['default'][_0x5bb1d5(0x19b)]({'where':{'companyId':_0x214701,'key':'scheduleType'}}),_0x4bfbd1=await Setting_1[_0x5bb1d5(0x24a)][_0x5bb1d5(0x19b)]({'where':{'companyId':_0x214701,'key':_0x5bb1d5(0x2c0)}});let _0xe54c2;_0x5cc099['value']===_0x5bb1d5(0x280)&&(_0xe54c2=await(0x0,VerifyCurrentSchedule_1[_0x5bb1d5(0x24a)])(_0x214701));try{if(!_0x3b56ab[_0x5bb1d5(0x1c4)][_0x5bb1d5(0x2a7)]&&_0x5cc099){if(_0x5cc099['value']===_0x5bb1d5(0x280)&&!(0x0,lodash_1['isNil'])(_0xe54c2)&&(!_0xe54c2||_0xe54c2['inActivity']===![])){_0x3f95d9[_0x5bb1d5(0x1bb)]===null&&await _0x3f95d9[_0x5bb1d5(0x1d7)]({'chatbotAt':(0x0,moment_1[_0x5bb1d5(0x24a)])()[_0x5bb1d5(0x1f4)]()});if(_0x4e6d23[_0x5bb1d5(0x233)]&&_0x4e6d23[_0x5bb1d5(0x233)]!==0x0&&_0x36a413[_0x5bb1d5(0x1fc)]>=_0x4e6d23[_0x5bb1d5(0x233)])return;let _0x3e4dfd=new Date(),_0x4e601e=new Date();if(_0x3f95d9[_0x5bb1d5(0x1bb)]!==null){_0x3e4dfd[_0x5bb1d5(0x20d)](_0x3f95d9['chatbotAt'][_0x5bb1d5(0x1ca)]()+Number(_0x4e6d23[_0x5bb1d5(0x285)]));if(_0x3f95d9[_0x5bb1d5(0x1bb)]!==null&&_0x4e601e<_0x3e4dfd&&_0x4e6d23['timeUseBotQueues']!=='0')return;}await _0x3f95d9[_0x5bb1d5(0x1d7)]({'chatbotAt':null});if(_0x4e6d23[_0x5bb1d5(0x21f)]!==''){const _0x3fa807=(0x0,Mustache_1['default'])(''+_0x4e6d23[_0x5bb1d5(0x21f)],_0x36a413),_0x275231=(0x0,Debounce_1[_0x5bb1d5(0x230)])(async()=>{const _0x34abdf=_0x5bb1d5;await _0x1e6e57[_0x34abdf(0x1a2)](_0x36a413[_0x34abdf(0x25f)][_0x34abdf(0x21a)]+'@'+(_0x36a413[_0x34abdf(0x1e7)]?'g.us':_0x34abdf(0x25b)),{'text':_0x3fa807});},0x3e8,_0x36a413['id']);_0x275231();return;}await _0x36a413[_0x5bb1d5(0x1d7)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x36a413[_0x5bb1d5(0x1fc)]+0x1});return;}}}catch(_0x52a488){Sentry['captureException'](_0x52a488),console[_0x5bb1d5(0x241)](_0x52a488);}!_0x36a413[_0x5bb1d5(0x1ce)]&&!_0x36a413['queue']&&!_0x5f1a56&&!_0x3b56ab[_0x5bb1d5(0x1c4)][_0x5bb1d5(0x2a7)]&&!_0x36a413['userId']&&_0x4e6d23[_0x5bb1d5(0x277)][_0x5bb1d5(0x229)]>=0x1&&(await verifyQueue(_0x1e6e57,_0x3b56ab,_0x36a413,_0x5f5619,_0x38b7b2),_0x3f95d9[_0x5bb1d5(0x1bb)]===null&&await _0x3f95d9[_0x5bb1d5(0x1d7)]({'chatbotAt':(0x0,moment_1['default'])()['toDate']()}));_0x36a413['queueId']>0x0&&await _0x3f95d9[_0x5bb1d5(0x1d7)]({'queueId':_0x36a413[_0x5bb1d5(0x284)]});if(getTypeMessage(_0x3b56ab)===_0x5bb1d5(0x2c3)&&!_0x3b56ab[_0x5bb1d5(0x1c4)]['fromMe']&&!_0x5f1a56&&!_0x5f5619?.[_0x5bb1d5(0x209)]&&_0x4bfbd1?.[_0x5bb1d5(0x198)]===_0x5bb1d5(0x206)){const _0xe273ed=await _0x1e6e57['sendMessage'](_0x5f5619[_0x5bb1d5(0x21a)]+_0x5bb1d5(0x1b3),{'text':_0x5bb1d5(0x1d0)},{'quoted':{'key':_0x3b56ab[_0x5bb1d5(0x1c4)],'message':{'extendedTextMessage':_0x3b56ab[_0x5bb1d5(0x292)][_0x5bb1d5(0x235)]}}});await(0x0,exports[_0x5bb1d5(0x271)])(_0xe273ed,_0x36a413,_0x5f5619,_0x3f95d9);}try{if(!_0x3b56ab['key']['fromMe']&&_0x5cc099&&_0x36a413['queueId']!==null){const _0x2c39a0=await Queue_1[_0x5bb1d5(0x24a)][_0x5bb1d5(0x23e)](_0x36a413[_0x5bb1d5(0x284)]);_0x5cc099?.[_0x5bb1d5(0x198)]===_0x5bb1d5(0x2b8)&&(_0xe54c2=await(0x0,VerifyCurrentSchedule_1['default'])(_0x214701,_0x2c39a0['id']));if(_0x5cc099[_0x5bb1d5(0x198)]===_0x5bb1d5(0x2b8)&&!(0x0,lodash_1['isNil'])(_0xe54c2)&&(!_0xe54c2||_0xe54c2[_0x5bb1d5(0x22b)]===![])){const _0x3584b3=_0x2c39a0[_0x5bb1d5(0x21f)];if(_0x3584b3!==''){const _0x42f268=(0x0,Mustache_1[_0x5bb1d5(0x24a)])(''+_0x3584b3,_0x36a413),_0x33de08=(0x0,Debounce_1[_0x5bb1d5(0x230)])(async()=>{const _0x232d5e=_0x5bb1d5;await _0x1e6e57[_0x232d5e(0x1a2)](_0x36a413[_0x232d5e(0x25f)]['number']+'@'+(_0x36a413[_0x232d5e(0x1e7)]?_0x232d5e(0x262):_0x232d5e(0x25b)),{'text':_0x42f268});},0x3e8,_0x36a413['id']);_0x33de08();return;}return;}}}catch(_0x909340){Sentry[_0x5bb1d5(0x1e3)](_0x909340),console['log'](_0x909340);}_0x36a413[_0x5bb1d5(0x2b8)]&&_0x36a413[_0x5bb1d5(0x284)]&&!_0x3b56ab[_0x5bb1d5(0x1c4)][_0x5bb1d5(0x2a7)]&&((!_0x36a413['user']||_0x36a413['queue']?.[_0x5bb1d5(0x28a)]?.['length']>0x0)&&await(0x0,ChatBotListener_1[_0x5bb1d5(0x22a)])(_0x36a413[_0x5bb1d5(0x284)],_0x1e6e57,_0x36a413,_0x5f5619,_0x3b56ab),await _0x36a413[_0x5bb1d5(0x1d7)]({'sendInactiveMessage':![]})),await _0x36a413[_0x5bb1d5(0x1a6)]();}catch(_0x49a37c){Sentry[_0x5bb1d5(0x1e3)](_0x49a37c),console[_0x5bb1d5(0x241)](_0x49a37c),logger_1[_0x5bb1d5(0x2a9)][_0x5bb1d5(0x263)](_0x5bb1d5(0x265)+_0x49a37c);}};exports['handleMessage']=handleMessage;const handleMsgAck=async(_0x15be98,_0x1360b5)=>{const _0x3f4252=a552_0x181c7f;await new Promise(_0x23e649=>setTimeout(_0x23e649,0x1f4));const _0x437c22=(0x0,socket_1[_0x3f4252(0x269)])();try{const _0x110223=await Message_1[_0x3f4252(0x24a)][_0x3f4252(0x19b)]({'where':{'wid':_0x15be98['key']['id']},'include':[_0x3f4252(0x25f),{'model':Message_1['default'],'as':_0x3f4252(0x1ee),'include':[_0x3f4252(0x25f)]}]});if(!_0x110223)return;await _0x110223[_0x3f4252(0x1d7)]({'ack':_0x1360b5}),_0x437c22['to'](_0x110223[_0x3f4252(0x297)]['toString']())[_0x3f4252(0x1a0)]('company-'+_0x110223[_0x3f4252(0x29d)]+'-appMessage',{'action':_0x3f4252(0x1d7),'message':_0x110223});}catch(_0x553519){Sentry[_0x3f4252(0x1e3)](_0x553519),logger_1[_0x3f4252(0x2a9)][_0x3f4252(0x263)](_0x3f4252(0x26a)+_0x553519);}},verifyRecentCampaign=async(_0x5ab215,_0x4ed80d)=>{const _0x1190f8=a552_0x181c7f;if(!isValidMsg(_0x5ab215))return;if(!_0x5ab215['key'][_0x1190f8(0x2a7)]){const _0x1ee17a=_0x5ab215[_0x1190f8(0x1c4)][_0x1190f8(0x226)]['replace'](/\D/g,''),_0x3580f2=await Campaign_1[_0x1190f8(0x24a)][_0x1190f8(0x244)]({'where':{'companyId':_0x4ed80d,'status':'EM_ANDAMENTO','confirmation':!![]}});if(_0x3580f2){const _0x1b7b8c=_0x3580f2['map'](_0x5a8883=>_0x5a8883['id']),_0x4afd33=await CampaignShipping_1[_0x1190f8(0x24a)][_0x1190f8(0x19b)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x1b7b8c},'number':_0x1ee17a,'confirmation':null}});_0x4afd33&&(await _0x4afd33[_0x1190f8(0x1d7)]({'confirmedAt':(0x0,moment_1['default'])(),'confirmation':!![]}),await queues_1[_0x1190f8(0x208)][_0x1190f8(0x2a8)](_0x1190f8(0x1c1),{'campaignShippingId':_0x4afd33['id'],'campaignId':_0x4afd33['campaignId']},{'delay':(0x0,queues_1[_0x1190f8(0x23a)])((0x0,queues_1['randomValue'])(0x0,0xa))}));}}},verifyCampaignMessageAndCloseTicket=async(_0x235801,_0x3670af,_0x1b05fd)=>{const _0x356daa=a552_0x181c7f;if(!isValidMsg(_0x235801))return;let _0x1578c3;_0x1578c3=await getContactMessage(_0x235801,_0x1b05fd);const _0x1b23ea=await verifyContact(_0x1578c3,_0x1b05fd,_0x3670af),_0x488d5b=(0x0,socket_1[_0x356daa(0x269)])(),_0x5ab411=await(0x0,exports[_0x356daa(0x289)])(_0x235801),_0x34f331=/\u200c/[_0x356daa(0x248)](_0x5ab411);if(_0x235801['key'][_0x356daa(0x2a7)]&&_0x34f331){const _0x153a26=await Message_1[_0x356daa(0x24a)][_0x356daa(0x19b)]({'where':{[sequelize_1['Op']['or']]:[{'wid':_0x235801['key']['id']},{'contactId':_0x1b23ea['id']}],'companyId':_0x3670af}});if(!(0x0,lodash_1[_0x356daa(0x1d9)])(_0x153a26)||!(0x0,lodash_1[_0x356daa(0x234)])(_0x153a26)||_0x153a26!==null){const _0x305ea6=await Ticket_1[_0x356daa(0x24a)]['findByPk'](_0x153a26[_0x356daa(0x297)]);await _0x305ea6['update']({'status':_0x356daa(0x22d),'amountUsedBotQueues':0x0,'amountUseOutOfHours':0x0}),_0x488d5b['to'](_0x356daa(0x23b))[_0x356daa(0x1a0)](_0x356daa(0x1ea)+_0x305ea6[_0x356daa(0x29d)]+_0x356daa(0x24d),{'action':_0x356daa(0x274),'ticket':_0x305ea6,'ticketId':_0x305ea6['id']}),_0x488d5b['to'](_0x305ea6[_0x356daa(0x21c)])['to'](_0x305ea6['id']['toString']())[_0x356daa(0x1a0)]('company-'+_0x305ea6[_0x356daa(0x29d)]+_0x356daa(0x24d),{'action':'update','ticket':_0x305ea6,'ticketId':_0x305ea6['id']});}}},filterMessages=_0x27ca9c=>{const _0x96123d=a552_0x181c7f;if(_0x27ca9c[_0x96123d(0x292)]?.[_0x96123d(0x22f)])return![];if([baileys_1['WAMessageStubType'][_0x96123d(0x1c9)],baileys_1[_0x96123d(0x264)][_0x96123d(0x2a4)],baileys_1[_0x96123d(0x264)]['E2E_IDENTITY_CHANGED'],baileys_1[_0x96123d(0x264)]['CIPHERTEXT']]['includes'](_0x27ca9c[_0x96123d(0x210)]))return![];return!![];},wbotMessageListener=(_0x2093ec,_0x3f70c6)=>{const _0x569cac=a552_0x181c7f;_0x2093ec['ev']['on']('messages.upsert',async _0x57b179=>{const _0x15c48f=a552_0x4ed1,_0x40f292=_0x57b179[_0x15c48f(0x231)]['filter'](filterMessages)['map'](_0x4f5eb8=>_0x4f5eb8);if(!_0x40f292)return;_0x40f292['forEach'](async _0x38b869=>{const _0x3568e4=_0x15c48f,_0x10efe2=await Message_1[_0x3568e4(0x24a)][_0x3568e4(0x1c3)]({'where':{'wid':_0x38b869[_0x3568e4(0x1c4)]['id'],'companyId':_0x3f70c6}});if(!_0x10efe2){let _0x23fb95=![],_0x1f1ad7=await(0x0,exports[_0x3568e4(0x289)])(_0x38b869);const _0x5a0da7=_0x38b869?.[_0x3568e4(0x1c4)]?.['fromMe'];if(_0x5a0da7)_0x23fb95=/\u200c/[_0x3568e4(0x248)](_0x1f1ad7);else{if(/\u200c/[_0x3568e4(0x248)](_0x1f1ad7))_0x1f1ad7=_0x1f1ad7['replace'](/\u200c/,'');logger_1[_0x3568e4(0x2a9)][_0x3568e4(0x279)](_0x3568e4(0x19c)+_0x1f1ad7);}!_0x23fb95&&await handleMessage(_0x38b869,_0x2093ec,_0x3f70c6),await verifyRecentCampaign(_0x38b869,_0x3f70c6),await verifyCampaignMessageAndCloseTicket(_0x38b869,_0x3f70c6,_0x2093ec);}_0x38b869[_0x3568e4(0x1c4)][_0x3568e4(0x226)]?.[_0x3568e4(0x1cf)](_0x3568e4(0x20e))&&handleMsgAck(_0x38b869,0x2);});}),_0x2093ec['ev']['on'](_0x569cac(0x2b0),_0x2a87a5=>{if(_0x2a87a5['length']===0x0)return;_0x2a87a5['forEach'](async _0x1012e7=>{const _0x3f40ee=a552_0x4ed1;_0x2093ec[_0x3f40ee(0x242)]([_0x1012e7[_0x3f40ee(0x1c4)]]);const _0x4b08e7={..._0x2a87a5};_0x4b08e7['0']?.['update'][_0x3f40ee(0x210)]===0x1&&_0x4b08e7['0']?.['key'][_0x3f40ee(0x226)]!==_0x3f40ee(0x293)&&(0x0,MarkDeleteWhatsAppMessage_1[_0x3f40ee(0x24a)])(_0x4b08e7['0']?.['key'][_0x3f40ee(0x226)],null,_0x4b08e7['0']?.['key']['id'],_0x3f70c6);let _0x23899c;_0x1012e7[_0x3f40ee(0x1d7)][_0x3f40ee(0x21c)]===0x3&&_0x1012e7?.[_0x3f40ee(0x1c4)]?.[_0x3f40ee(0x2a7)]?_0x23899c=0x2:_0x23899c=_0x1012e7[_0x3f40ee(0x1d7)][_0x3f40ee(0x21c)],handleMsgAck(_0x1012e7,_0x23899c);});}),_0x2093ec['ev']['on'](_0x569cac(0x28c),_0x2e3ea4=>{const _0x43ef6e=_0x569cac;if(_0x2e3ea4[_0x43ef6e(0x229)]===0x0)return;_0x2e3ea4['forEach'](async _0xe265e2=>{const _0xb0a371=_0x43ef6e,_0x43e4ff=_0xe265e2['id'][_0xb0a371(0x2b5)](/\D/g,''),_0x1cc18f=_0xe265e2[_0xb0a371(0x260)]||_0x43e4ff,_0x2c99b7={'name':_0x1cc18f,'number':_0x43e4ff,'isGroup':!![],'companyId':_0x3f70c6},_0x3d2439=await(0x0,CreateOrUpdateContactService_1['default'])(_0x2c99b7);});});};exports[a552_0x181c7f(0x212)]=wbotMessageListener;