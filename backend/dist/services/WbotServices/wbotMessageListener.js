'use strict';const a615_0xeefcd9=a615_0x5e6b;(function(_0x48b05f,_0x27b721){const _0x531713=a615_0x5e6b,_0x5e8a61=_0x48b05f();while(!![]){try{const _0x4dce3c=-parseInt(_0x531713(0x2e3))/0x1+parseInt(_0x531713(0x1c5))/0x2+parseInt(_0x531713(0x28a))/0x3+-parseInt(_0x531713(0x214))/0x4+-parseInt(_0x531713(0x270))/0x5*(parseInt(_0x531713(0x2e9))/0x6)+parseInt(_0x531713(0x20e))/0x7+-parseInt(_0x531713(0x1db))/0x8*(parseInt(_0x531713(0x187))/0x9);if(_0x4dce3c===_0x27b721)break;else _0x5e8a61['push'](_0x5e8a61['shift']());}catch(_0x22e150){_0x5e8a61['push'](_0x5e8a61['shift']());}}}(a615_0x1a66,0x21b44));var __createBinding=this&&this[a615_0xeefcd9(0x2c4)]||(Object['create']?function(_0x451940,_0x1f6e52,_0xb240a,_0x59e379){const _0x27729f=a615_0xeefcd9;if(_0x59e379===undefined)_0x59e379=_0xb240a;var _0x182c2c=Object['getOwnPropertyDescriptor'](_0x1f6e52,_0xb240a);(!_0x182c2c||(_0x27729f(0x26b)in _0x182c2c?!_0x1f6e52['__esModule']:_0x182c2c[_0x27729f(0x2e0)]||_0x182c2c[_0x27729f(0x161)]))&&(_0x182c2c={'enumerable':!![],'get':function(){return _0x1f6e52[_0xb240a];}}),Object[_0x27729f(0x25a)](_0x451940,_0x59e379,_0x182c2c);}:function(_0x96af26,_0x25d9e6,_0x1b9f07,_0x26f4c2){if(_0x26f4c2===undefined)_0x26f4c2=_0x1b9f07;_0x96af26[_0x26f4c2]=_0x25d9e6[_0x1b9f07];}),__setModuleDefault=this&&this[a615_0xeefcd9(0x1f4)]||(Object['create']?function(_0x5b20b7,_0x326104){const _0xd08a98=a615_0xeefcd9;Object[_0xd08a98(0x25a)](_0x5b20b7,'default',{'enumerable':!![],'value':_0x326104});}:function(_0x30c197,_0x3cdae1){_0x30c197['default']=_0x3cdae1;}),__importStar=this&&this[a615_0xeefcd9(0x1f7)]||function(_0xe8016b){const _0x86e2c8=a615_0xeefcd9;if(_0xe8016b&&_0xe8016b['__esModule'])return _0xe8016b;var _0x30d5fe={};if(_0xe8016b!=null){for(var _0x2ad0b4 in _0xe8016b)if(_0x2ad0b4!==_0x86e2c8(0x16b)&&Object[_0x86e2c8(0x2cd)][_0x86e2c8(0x228)][_0x86e2c8(0x15c)](_0xe8016b,_0x2ad0b4))__createBinding(_0x30d5fe,_0xe8016b,_0x2ad0b4);}return __setModuleDefault(_0x30d5fe,_0xe8016b),_0x30d5fe;},__importDefault=this&&this[a615_0xeefcd9(0x1c8)]||function(_0x145c2f){return _0x145c2f&&_0x145c2f['__esModule']?_0x145c2f:{'default':_0x145c2f};};Object['defineProperty'](exports,a615_0xeefcd9(0x157),{'value':!![]}),exports[a615_0xeefcd9(0x1e5)]=exports[a615_0xeefcd9(0x260)]=exports[a615_0xeefcd9(0x2d6)]=exports['wbotMessageListener']=exports['handleMessageIntegration']=exports[a615_0xeefcd9(0x1aa)]=exports[a615_0xeefcd9(0x1f8)]=exports[a615_0xeefcd9(0x1c4)]=exports['verifyMediaMessage']=exports['getQuotedMessageId']=exports[a615_0xeefcd9(0x152)]=exports[a615_0xeefcd9(0x2e4)]=void 0x0;const path_1=__importStar(require(a615_0xeefcd9(0x2ba))),util_1=require(a615_0xeefcd9(0x183)),fs_1=require('fs'),fs_2=__importDefault(require('fs')),Sentry=__importStar(require(a615_0xeefcd9(0x2d9))),lodash_1=require('lodash'),baileys_1=require('@whiskeysockets/baileys'),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require(a615_0xeefcd9(0x196))),Message_1=__importDefault(require(a615_0xeefcd9(0x2cb))),socket_1=require(a615_0xeefcd9(0x26d)),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),logger_1=require(a615_0xeefcd9(0x162)),CreateOrUpdateContactService_1=__importDefault(require(a615_0xeefcd9(0x177))),FindOrCreateTicketService_1=__importDefault(require('../TicketServices/FindOrCreateTicketService')),ShowWhatsAppService_1=__importDefault(require(a615_0xeefcd9(0x1bd))),Debounce_1=require(a615_0xeefcd9(0x2b0)),UpdateTicketService_1=__importDefault(require(a615_0xeefcd9(0x2bc))),Mustache_1=__importDefault(require(a615_0xeefcd9(0x17b))),UserRating_1=__importDefault(require(a615_0xeefcd9(0x185))),SendWhatsAppMessage_1=__importDefault(require(a615_0xeefcd9(0x184))),sendFacebookMessage_1=__importDefault(require(a615_0xeefcd9(0x2d5))),moment_1=__importDefault(require(a615_0xeefcd9(0x179))),Queue_1=__importDefault(require(a615_0xeefcd9(0x1f5))),FindOrCreateATicketTrakingService_1=__importDefault(require(a615_0xeefcd9(0x1ea))),VerifyCurrentSchedule_1=__importDefault(require('../CompanyService/VerifyCurrentSchedule')),Campaign_1=__importDefault(require('../../models/Campaign')),CampaignShipping_1=__importDefault(require(a615_0xeefcd9(0x268))),sequelize_1=require(a615_0xeefcd9(0x1e3)),queues_1=require(a615_0xeefcd9(0x282)),User_1=__importDefault(require(a615_0xeefcd9(0x1c1))),ChatBotListener_1=require(a615_0xeefcd9(0x2ae)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a615_0xeefcd9(0x20a))),ListUserQueueServices_1=__importDefault(require(a615_0xeefcd9(0x1fd))),cache_1=__importDefault(require(a615_0xeefcd9(0x1ed))),addLogs_1=require('../../helpers/addLogs'),SendWhatsAppMedia_1=__importStar(require(a615_0xeefcd9(0x2e7))),ShowQueueIntegrationService_1=__importDefault(require('../QueueIntegrationServices/ShowQueueIntegrationService')),CreateSessionDialogflow_1=require(a615_0xeefcd9(0x2ad)),QueryDialogflow_1=require(a615_0xeefcd9(0x27f)),CompaniesSettings_1=__importDefault(require('../../models/CompaniesSettings')),CreateLogTicketService_1=__importDefault(require(a615_0xeefcd9(0x1a6))),Whatsapp_1=__importDefault(require(a615_0xeefcd9(0x231))),ShowService_1=__importDefault(require(a615_0xeefcd9(0x219))),openai_1=require('openai'),fluent_ffmpeg_1=__importDefault(require(a615_0xeefcd9(0x254))),microsoft_cognitiveservices_speech_sdk_1=require(a615_0xeefcd9(0x1c2)),os=require('os'),request=require(a615_0xeefcd9(0x29e));let ffmpegPath;if(os[a615_0xeefcd9(0x1d0)]()===a615_0xeefcd9(0x2a4))ffmpegPath='C:\x5cffmpeg\x5cffmpeg.exe';else os[a615_0xeefcd9(0x1d0)]()===a615_0xeefcd9(0x264)?ffmpegPath=a615_0xeefcd9(0x1d3):ffmpegPath='/usr/bin/ffmpeg';fluent_ffmpeg_1['default'][a615_0xeefcd9(0x1f9)](ffmpegPath);let i=0x0;setInterval(()=>{i=0x0;},0x1388);const sessionsOpenAi=[],writeFileAsync=(0x0,util_1[a615_0xeefcd9(0x170)])(fs_1[a615_0xeefcd9(0x225)]);function removeFile(_0x404aea){const _0x6a107f=a615_0xeefcd9;fs_2['default'][_0x6a107f(0x2e5)](_0x404aea,_0x8188ec=>{if(_0x8188ec)throw _0x8188ec;});}const getTimestampMessage=_0x1ca6c6=>{return _0x1ca6c6*0x1;},multVecardGet=function(_0x53bbd8){const _0x1dee00=a615_0xeefcd9;let _0x336c70='\x20',_0x18fcee=_0x53bbd8[_0x1dee00(0x1e4)]('\x0a')[0x2][_0x1dee00(0x279)](_0x1dee00(0x20d),'\x0a')[_0x1dee00(0x279)]('N:','')[_0x1dee00(0x279)](';','')[_0x1dee00(0x279)](';','\x20')[_0x1dee00(0x279)](';;','\x20')[_0x1dee00(0x279)]('\x0a',''),_0x38d9eb=_0x53bbd8[_0x1dee00(0x1e4)]('\x0a')[0x4][_0x1dee00(0x2e1)]('='),_0x323d00=_0x53bbd8[_0x1dee00(0x1e4)]('\x0a')[0x4][_0x1dee00(0x2e1)](':'),_0xc2b2ec=_0x53bbd8[_0x1dee00(0x1e4)]('\x0a')[0x4][_0x1dee00(0x2ec)](_0x38d9eb+0x1,_0x323d00)[_0x1dee00(0x279)](';',''),_0x5bfb5c=_0x53bbd8[_0x1dee00(0x1e4)]('\x0a')[0x4]['replace']('item1.TEL:','');if(_0xc2b2ec!=_0x1dee00(0x1ce))_0x336c70=_0x336c70+_0x18fcee+_0x1dee00(0x195)+_0xc2b2ec+''+'\x0a';else _0x336c70=_0x336c70+_0x18fcee+_0x1dee00(0x195)+_0x5bfb5c+''+'\x0a';return _0x336c70;},contactsArrayMessageGet=_0xba873d=>{const _0x4ba4ec=a615_0xeefcd9;let _0x8bab69=_0xba873d['message']?.[_0x4ba4ec(0x1ff)]?.['contacts'],_0x44b0ef=_0x8bab69[_0x4ba4ec(0x19c)](function(_0x2acbc3,_0x219923){return _0x2acbc3['vcard'];}),_0x496257='';_0x44b0ef[_0x4ba4ec(0x192)](function(_0x19302c,_0x30dbde){_0x496257+=_0x19302c+'\x0a\x0a'+'';});let _0x4982ac=_0x496257[_0x4ba4ec(0x1e4)](_0x4ba4ec(0x1f3));_0x4982ac[_0x4ba4ec(0x2cf)]();let _0x140858='';for(let _0x4d92d6 of _0x4982ac){_0x140858=_0x140858+multVecardGet(_0x4d92d6);}return _0x140858;},getTypeMessage=_0x985a01=>{const _0x2023f7=a615_0xeefcd9,_0x39c39e=(0x0,baileys_1['getContentType'])(_0x985a01[_0x2023f7(0x1ae)]);if(_0x985a01['message']?.['viewOnceMessageV2'])return'viewOnceMessageV2';return _0x39c39e;};exports[a615_0xeefcd9(0x1e5)]=getTypeMessage;const getBodyButton=_0x302098=>{const _0x5d5f28=a615_0xeefcd9;if(_0x302098[_0x5d5f28(0x163)][_0x5d5f28(0x2ea)]&&_0x302098[_0x5d5f28(0x1ae)][_0x5d5f28(0x286)]?.[_0x5d5f28(0x24c)]){let _0x3c417d=''+_0x302098?.['message']?.[_0x5d5f28(0x286)]?.[_0x5d5f28(0x24c)];for(const _0x3a1fd6 of _0x302098['message']?.['buttonsMessage']?.[_0x5d5f28(0x1b8)]){_0x3c417d+='\x0a\x0a'+_0x3a1fd6['buttonText']?.[_0x5d5f28(0x160)];}return _0x3c417d;}if(_0x302098[_0x5d5f28(0x163)]['fromMe']&&_0x302098?.[_0x5d5f28(0x1ae)]?.[_0x5d5f28(0x169)]?.['message']?.[_0x5d5f28(0x289)]){let _0x8dbf43=''+_0x302098?.[_0x5d5f28(0x1ae)]?.[_0x5d5f28(0x169)]?.['message']?.[_0x5d5f28(0x289)]?.[_0x5d5f28(0x203)];for(const _0x7fefed of _0x302098[_0x5d5f28(0x1ae)]?.['viewOnceMessage']?.[_0x5d5f28(0x1ae)]?.['listMessage']?.[_0x5d5f28(0x227)]){for(const _0x546a7f of _0x7fefed[_0x5d5f28(0x28e)]){_0x8dbf43+='\x0a\x0a'+_0x546a7f[_0x5d5f28(0x1a5)];}}return _0x8dbf43;}},getBodyList=_0x809099=>{const _0x5c7627=a615_0xeefcd9;if(_0x809099[_0x5c7627(0x163)][_0x5c7627(0x2ea)]&&_0x809099['message'][_0x5c7627(0x289)]?.[_0x5c7627(0x203)]){let _0x9baa77=''+_0x809099[_0x5c7627(0x1ae)]['listMessage']?.[_0x5c7627(0x203)];for(const _0x2f539f of _0x809099[_0x5c7627(0x1ae)][_0x5c7627(0x289)]?.['sections']){for(const _0x177a32 of _0x2f539f['rows']){_0x9baa77+='\x0a\x0a'+_0x177a32[_0x5c7627(0x1a5)];}}return _0x9baa77;}if(_0x809099[_0x5c7627(0x163)][_0x5c7627(0x2ea)]&&_0x809099?.['message']?.['viewOnceMessage']?.[_0x5c7627(0x1ae)]?.[_0x5c7627(0x289)]){let _0x594117=''+_0x809099?.[_0x5c7627(0x1ae)]?.[_0x5c7627(0x169)]?.['message']?.[_0x5c7627(0x289)]?.[_0x5c7627(0x203)];for(const _0x1e89a5 of _0x809099['message']?.[_0x5c7627(0x169)]?.[_0x5c7627(0x1ae)]?.[_0x5c7627(0x289)]?.[_0x5c7627(0x227)]){for(const _0x38470e of _0x1e89a5['rows']){_0x594117+='\x0a\x0a'+_0x38470e[_0x5c7627(0x1a5)];}}return _0x594117;}},msgLocation=(_0x3dfe97,_0x3b2f7c,_0x2f542e)=>{const _0x250b19=a615_0xeefcd9;if(_0x3dfe97){var _0x5284e7=Buffer['from'](_0x3dfe97)[_0x250b19(0x230)](_0x250b19(0x20b));let _0x155b17=_0x250b19(0x1b3)+_0x5284e7+'\x20|\x20https://maps.google.com/maps?q='+_0x3b2f7c+_0x250b19(0x28f)+_0x2f542e+'&z=17&hl=pt-BR|'+_0x3b2f7c+',\x20'+_0x2f542e+'\x20';return _0x155b17;}},getBodyMessage=_0x25bfbb=>{const _0xc13fa0=a615_0xeefcd9;try{let _0x504f0a=getTypeMessage(_0x25bfbb);if(_0x504f0a===undefined)console[_0xc13fa0(0x2a7)](_0x25bfbb);const _0x3f8cd9={'conversation':_0x25bfbb[_0xc13fa0(0x1ae)]?.['conversation'],'imageMessage':_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x2aa)]?.[_0xc13fa0(0x1b7)],'videoMessage':_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x288)]?.['caption'],'extendedTextMessage':_0x25bfbb?.[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x2a6)]?.['text'],'buttonsResponseMessage':_0x25bfbb['message']?.[_0xc13fa0(0x2af)]?.['selectedDisplayText'],'listResponseMessage':_0x25bfbb['message']?.[_0xc13fa0(0x202)]?.[_0xc13fa0(0x1a5)]||_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x202)]?.[_0xc13fa0(0x168)]?.[_0xc13fa0(0x29c)],'templateButtonReplyMessage':_0x25bfbb['message']?.[_0xc13fa0(0x1ee)]?.[_0xc13fa0(0x22e)],'messageContextInfo':_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x2af)]?.['selectedButtonId']||_0x25bfbb[_0xc13fa0(0x1ae)]?.['listResponseMessage']?.['title'],'buttonsMessage':getBodyButton(_0x25bfbb)||_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x202)]?.[_0xc13fa0(0x1a5)],'stickerMessage':_0xc13fa0(0x1d9),'contactMessage':_0x25bfbb[_0xc13fa0(0x1ae)]?.['contactMessage']?.[_0xc13fa0(0x218)],'contactsArrayMessage':_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x1ff)]?.[_0xc13fa0(0x1d1)]&&contactsArrayMessageGet(_0x25bfbb),'locationMessage':msgLocation(_0x25bfbb[_0xc13fa0(0x1ae)]?.['locationMessage']?.['jpegThumbnail'],_0x25bfbb[_0xc13fa0(0x1ae)]?.['locationMessage']?.[_0xc13fa0(0x178)],_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x24e)]?.[_0xc13fa0(0x167)]),'liveLocationMessage':_0xc13fa0(0x182)+_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x1bf)]?.[_0xc13fa0(0x178)]+_0xc13fa0(0x23f)+_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x1bf)]?.[_0xc13fa0(0x167)],'documentMessage':_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x2f0)]?.['caption'],'audioMessage':_0xc13fa0(0x2df),'listMessage':getBodyList(_0x25bfbb)||_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x202)]?.[_0xc13fa0(0x1a5)],'viewOnceMessage':getBodyButton(_0x25bfbb),'reactionMessage':_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x156)]?.[_0xc13fa0(0x285)]||_0xc13fa0(0x281),'senderKeyDistributionMessage':_0x25bfbb?.['message']?.[_0xc13fa0(0x1dc)]?.[_0xc13fa0(0x2db)],'documentWithCaptionMessage':_0x25bfbb['message']?.[_0xc13fa0(0x248)]?.[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x2f0)]?.[_0xc13fa0(0x1b7)],'viewOnceMessageV2':_0x25bfbb['message']?.[_0xc13fa0(0x21f)]?.[_0xc13fa0(0x1ae)]?.['imageMessage']?.['caption'],'editedMessage':_0x25bfbb['message']?.[_0xc13fa0(0x175)]?.[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x2a6)]?.[_0xc13fa0(0x285)],'ephemeralMessage':_0x25bfbb[_0xc13fa0(0x1ae)]?.[_0xc13fa0(0x15e)]?.[_0xc13fa0(0x1ae)]?.['extendedTextMessage']?.[_0xc13fa0(0x285)]},_0x5e2860=Object[_0xc13fa0(0x296)](_0x3f8cd9)[_0xc13fa0(0x164)](_0xc81b96=>_0xc81b96===_0x504f0a);return!_0x5e2860&&(logger_1[_0xc13fa0(0x1e1)]['warn'](_0xc13fa0(0x21d)+_0x504f0a+'\x0a'+JSON[_0xc13fa0(0x204)](_0x25bfbb)),Sentry[_0xc13fa0(0x2a1)](_0xc13fa0(0x213),{'BodyMsg':_0x25bfbb[_0xc13fa0(0x1ae)],'msg':_0x25bfbb,'type':_0x504f0a}),Sentry['captureException'](new Error('Novo\x20Tipo\x20de\x20Mensagem\x20em\x20getTypeMessage'))),_0x3f8cd9[_0x504f0a];}catch(_0x4364cb){Sentry[_0xc13fa0(0x2a1)](_0xc13fa0(0x1f0),{'msg':_0x25bfbb,'BodyMsg':_0x25bfbb[_0xc13fa0(0x1ae)]}),Sentry[_0xc13fa0(0x217)](_0x4364cb),console[_0xc13fa0(0x2a7)](_0x4364cb);}};exports[a615_0xeefcd9(0x2e4)]=getBodyMessage;const getQuotedMessage=_0x466342=>{const _0x319eed=a615_0xeefcd9,_0x5c54b8=(0x0,baileys_1[_0x319eed(0x1c9)])(_0x466342[_0x319eed(0x1ae)])[Object[_0x319eed(0x296)](_0x466342?.['message'])[_0x319eed(0x208)]()[_0x319eed(0x1fc)]()[_0x319eed(0x180)]];if(!_0x5c54b8?.['contextInfo']?.['quotedMessage'])return;const _0x2d54d8=(0x0,baileys_1[_0x319eed(0x1c9)])(_0x5c54b8?.[_0x319eed(0x249)]?.[_0x319eed(0x2a2)][Object[_0x319eed(0x296)](_0x5c54b8?.['contextInfo']?.['quotedMessage'])[_0x319eed(0x208)]()['next']()[_0x319eed(0x180)]]);return _0x2d54d8;};exports[a615_0xeefcd9(0x152)]=getQuotedMessage;const getQuotedMessageId=_0x304dff=>{const _0x2f31f5=a615_0xeefcd9,_0x251eed=(0x0,baileys_1[_0x2f31f5(0x1c9)])(_0x304dff['message'])[Object['keys'](_0x304dff?.['message'])['values']()['next']()[_0x2f31f5(0x180)]];let _0x4a7249=_0x304dff?.['message']?.[_0x2f31f5(0x156)]?_0x304dff?.[_0x2f31f5(0x1ae)]?.[_0x2f31f5(0x156)]?.[_0x2f31f5(0x163)]?.['id']:'';return _0x4a7249?_0x4a7249:_0x251eed?.[_0x2f31f5(0x249)]?.['stanzaId'];};exports[a615_0xeefcd9(0x2d1)]=getQuotedMessageId;const getMeSocket=_0x4b664f=>{const _0x5641e1=a615_0xeefcd9;return{'id':(0x0,baileys_1[_0x5641e1(0x24d)])(_0x4b664f[_0x5641e1(0x1b2)]['id']),'name':_0x4b664f[_0x5641e1(0x1b2)][_0x5641e1(0x18e)]};},getSenderMessage=(_0x5a9e01,_0x1325cc)=>{const _0x33f489=a615_0xeefcd9,_0x4161f4=getMeSocket(_0x1325cc);if(_0x5a9e01[_0x33f489(0x163)][_0x33f489(0x2ea)])return _0x4161f4['id'];const _0x128b4f=_0x5a9e01[_0x33f489(0x165)]||_0x5a9e01[_0x33f489(0x163)][_0x33f489(0x165)]||_0x5a9e01['key'][_0x33f489(0x2bd)]||undefined;return _0x128b4f&&(0x0,baileys_1[_0x33f489(0x24d)])(_0x128b4f);},getContactMessage=async(_0x55991d,_0x2c8421)=>{const _0x4cc589=a615_0xeefcd9,_0x456b6e=_0x55991d[_0x4cc589(0x163)]['remoteJid'][_0x4cc589(0x2be)]('g.us'),_0x261145=_0x55991d['key'][_0x4cc589(0x2bd)][_0x4cc589(0x279)](/\D/g,'');return _0x456b6e?{'id':getSenderMessage(_0x55991d,_0x2c8421),'name':_0x55991d['pushName']}:{'id':_0x55991d['key'][_0x4cc589(0x2bd)],'name':_0x55991d[_0x4cc589(0x163)][_0x4cc589(0x2ea)]?_0x261145:_0x55991d[_0x4cc589(0x201)]};},downloadMedia=async(_0x28b15e,_0x67c3e9=null)=>{const _0xf22926=a615_0xeefcd9;let _0xe503eb;try{_0xe503eb=await(0x0,baileys_1[_0xf22926(0x275)])(_0x28b15e,'buffer',{});}catch(_0x4b1873){_0x67c3e9?console[_0xf22926(0x2a7)](_0xf22926(0x1be)):console[_0xf22926(0x2c6)](_0xf22926(0x206),_0x4b1873);}let _0x404cf8=_0x28b15e['message']?.[_0xf22926(0x2f0)]?.[_0xf22926(0x2ef)]||'';const _0x4f9231=_0x28b15e['message']?.[_0xf22926(0x2aa)]||_0x28b15e['message']?.[_0xf22926(0x1cb)]||_0x28b15e['message']?.[_0xf22926(0x288)]||_0x28b15e[_0xf22926(0x1ae)]?.[_0xf22926(0x1a9)]||_0x28b15e[_0xf22926(0x1ae)]?.[_0xf22926(0x2f0)]||_0x28b15e[_0xf22926(0x1ae)]?.[_0xf22926(0x248)]?.['message']?.[_0xf22926(0x2f0)]||_0x28b15e[_0xf22926(0x1ae)]?.[_0xf22926(0x2a6)]?.[_0xf22926(0x249)]?.[_0xf22926(0x2a2)]?.['imageMessage']||_0x28b15e[_0xf22926(0x1ae)]?.[_0xf22926(0x2a6)]?.[_0xf22926(0x249)]?.[_0xf22926(0x2a2)]?.[_0xf22926(0x288)];if(!_0x4f9231)console[_0xf22926(0x2a7)](_0x28b15e);if(!_0x404cf8){const _0x4d1262=_0x4f9231[_0xf22926(0x1fb)][_0xf22926(0x1e4)]('/')[0x1]['split'](';')[0x0];_0x404cf8=new Date()[_0xf22926(0x27d)]()+'.'+_0x4d1262;}else _0x404cf8=new Date()['getTime']()+'_'+_0x404cf8;const _0x5c5598={'data':_0xe503eb,'mimetype':_0x4f9231['mimetype'],'filename':_0x404cf8};return _0x5c5598;},verifyContact=async(_0x595fb9,_0x5f0c91,_0x14fe9c)=>{const _0x15b9e2=a615_0xeefcd9;let _0x4ec301;try{_0x4ec301=await _0x5f0c91['profilePictureUrl'](_0x595fb9['id'],_0x15b9e2(0x1e8));}catch(_0x4785b7){Sentry['captureException'](_0x4785b7),_0x4ec301=process['env'][_0x15b9e2(0x22f)]+_0x15b9e2(0x261);}const _0x374768={'name':_0x595fb9[_0x15b9e2(0x18e)]||_0x595fb9['id'][_0x15b9e2(0x279)](/\D/g,''),'number':_0x595fb9['id'][_0x15b9e2(0x279)](/\D/g,''),'profilePicUrl':_0x4ec301,'isGroup':_0x595fb9['id'][_0x15b9e2(0x2be)]('g.us'),'companyId':_0x14fe9c,'remoteJid':_0x595fb9['id']};_0x374768['isGroup']&&(_0x374768[_0x15b9e2(0x252)]=_0x595fb9['id']['replace']('@g.us',''));const _0x24ab30=await(0x0,CreateOrUpdateContactService_1[_0x15b9e2(0x16b)])(_0x374768);return _0x24ab30;},verifyQuotedMessage=async _0x882af2=>{const _0x183b37=a615_0xeefcd9;if(!_0x882af2)return null;const _0x4ec642=(0x0,exports[_0x183b37(0x2d1)])(_0x882af2);if(!_0x4ec642)return null;const _0x1671ed=await Message_1[_0x183b37(0x16b)]['findOne']({'where':{'wid':_0x4ec642}});if(!_0x1671ed)return null;return _0x1671ed;},verifyMediaMessage=async(_0x1599ef,_0x4ccde8,_0x4ef2c3,_0x3a10e1,_0x1ebe58)=>{const _0x4d4e10=a615_0xeefcd9,_0xdd622=(0x0,socket_1['getIO'])(),_0x2480fc=await verifyQuotedMessage(_0x1599ef),_0x3555f7=_0x4ccde8[_0x4d4e10(0x2c0)];try{const _0x3adcfe=await downloadMedia(_0x1599ef,_0x4ccde8?.[_0x4d4e10(0x2b3)]);if(!_0x3adcfe&&_0x4ccde8[_0x4d4e10(0x2b3)]){const _0x449b83=_0x4d4e10(0x1b5),_0x360eb3={'wid':_0x1599ef['key']['id'],'ticketId':_0x4ccde8['id'],'contactId':_0x1599ef[_0x4d4e10(0x163)][_0x4d4e10(0x2ea)]?undefined:_0x4ccde8[_0x4d4e10(0x2e8)],'body':_0x449b83,'reactionMessage':_0x1599ef[_0x4d4e10(0x1ae)]?.[_0x4d4e10(0x156)],'fromMe':_0x1599ef['key'][_0x4d4e10(0x2ea)],'mediaType':getTypeMessage(_0x1599ef),'read':_0x1599ef['key'][_0x4d4e10(0x2ea)],'quotedMsgId':_0x2480fc?.['id']||_0x1599ef['message']?.[_0x4d4e10(0x156)]?.['key']?.['id'],'ack':_0x1599ef[_0x4d4e10(0x234)],'companyId':_0x3555f7,'remoteJid':_0x1599ef[_0x4d4e10(0x163)]['remoteJid'],'participant':_0x1599ef['key'][_0x4d4e10(0x165)],'timestamp':getTimestampMessage(_0x1599ef['messageTimestamp']),'createdAt':new Date(Math[_0x4d4e10(0x262)](getTimestampMessage(_0x1599ef[_0x4d4e10(0x244)])*0x3e8))[_0x4d4e10(0x2ee)](),'dataJson':JSON[_0x4d4e10(0x204)](_0x1599ef),'ticketImported':_0x4ccde8[_0x4d4e10(0x2b3)],'isForwarded':_0x1ebe58};return await _0x4ccde8['update']({'lastMessage':_0x449b83}),logger_1[_0x4d4e10(0x1e1)][_0x4d4e10(0x2c6)](Error('ERR_WAPP_DOWNLOAD_MEDIA')),(0x0,CreateMessageService_1[_0x4d4e10(0x16b)])({'messageData':_0x360eb3,'companyId':_0x3555f7});}if(!_0x3adcfe)throw new Error(_0x4d4e10(0x1bb));if(!_0x3adcfe[_0x4d4e10(0x2d4)]){const _0x4d5cd9=_0x3adcfe[_0x4d4e10(0x1fb)][_0x4d4e10(0x1e4)]('/')[0x1][_0x4d4e10(0x1e4)](';')[0x0];_0x3adcfe['filename']=new Date()[_0x4d4e10(0x27d)]()+'.'+_0x4d5cd9;}else{const _0x5bda8f=_0x3adcfe['filename'][_0x4d4e10(0x1e4)]('.')['pop'](),_0x25984c=_0x3adcfe[_0x4d4e10(0x2d4)][_0x4d4e10(0x1e4)]('.')['slice'](0x0,-0x1)['join']('.')['replace'](/\s/g,'_')['normalize'](_0x4d4e10(0x24a))['replace'](/[\u0300-\u036f]/g,'');_0x3adcfe[_0x4d4e10(0x2d4)]=_0x25984c[_0x4d4e10(0x243)]()+'_'+new Date()[_0x4d4e10(0x27d)]()+'.'+_0x5bda8f;}try{const _0x359ab0=path_1['default']['resolve'](__dirname,'..','..','..',_0x4d4e10(0x1f6),_0x4d4e10(0x21a)+_0x3555f7);!fs_2['default'][_0x4d4e10(0x17f)](_0x359ab0)&&(fs_2[_0x4d4e10(0x16b)][_0x4d4e10(0x1e9)](_0x359ab0,{'recursive':!![]}),fs_2[_0x4d4e10(0x16b)][_0x4d4e10(0x25f)](_0x359ab0,0x1ff)),await writeFileAsync((0x0,path_1[_0x4d4e10(0x1d2)])(_0x359ab0,_0x3adcfe[_0x4d4e10(0x2d4)]),_0x3adcfe['data'][_0x4d4e10(0x230)](_0x4d4e10(0x20b)),'base64')['then'](()=>{const _0x4d408b=_0x4d4e10;console[_0x4d408b(0x2a7)](_0x3adcfe['mimetype']),console['log'](_0x4d408b(0x22d));if(_0x3adcfe[_0x4d408b(0x1fb)][_0x4d408b(0x2be)](_0x4d408b(0x2b4))){const _0x46e0f3=path_1[_0x4d408b(0x16b)][_0x4d408b(0x1d2)](_0x359ab0,_0x3adcfe[_0x4d408b(0x2d4)]);let _0x59b4ae;if(_0x46e0f3[_0x4d408b(0x2a5)](_0x4d408b(0x1bc)))_0x59b4ae=_0x46e0f3[_0x4d408b(0x279)](_0x4d408b(0x1bc),_0x4d408b(0x15d));else{if(_0x46e0f3[_0x4d408b(0x2a5)]('.ogg'))_0x59b4ae=_0x46e0f3['replace'](_0x4d408b(0x1e2),_0x4d408b(0x15d));else{console[_0x4d408b(0x2c6)](_0x4d408b(0x212),_0x46e0f3);return;}}return console[_0x4d408b(0x2a7)]('Input\x20File:',_0x46e0f3),console['log'](_0x4d408b(0x1e6),_0x59b4ae),new Promise((_0x1f0ea7,_0x11d25e)=>{const _0x27f117=_0x4d408b;(0x0,fluent_ffmpeg_1[_0x27f117(0x16b)])(_0x46e0f3)[_0x27f117(0x1a1)](_0x27f117(0x220))[_0x27f117(0x2da)](_0x59b4ae)['on'](_0x27f117(0x1d5),()=>{_0x1f0ea7();})['on'](_0x27f117(0x2c6),_0x6456db=>{_0x11d25e(_0x6456db);});});}})[_0x4d4e10(0x2b2)](()=>{const _0xac40bb=_0x4d4e10;console[_0xac40bb(0x2a7)](_0xac40bb(0x216));});}catch(_0x4b839a){Sentry['setExtra']('Erro\x20media',{'companyId':_0x3555f7,'ticket':_0x4ccde8,'contact':_0x4ef2c3,'media':_0x3adcfe,'quotedMsg':_0x2480fc}),Sentry['captureException'](_0x4b839a),logger_1[_0x4d4e10(0x1e1)]['error'](_0x4b839a),console[_0x4d4e10(0x2a7)](_0x1599ef);}const _0x50d466=(0x0,exports[_0x4d4e10(0x2e4)])(_0x1599ef),_0x1d7044={'wid':_0x1599ef[_0x4d4e10(0x163)]['id'],'ticketId':_0x4ccde8['id'],'contactId':_0x1599ef[_0x4d4e10(0x163)]['fromMe']?undefined:_0x4ef2c3['id'],'body':_0x50d466||_0x3adcfe[_0x4d4e10(0x2d4)],'fromMe':_0x1599ef[_0x4d4e10(0x163)][_0x4d4e10(0x2ea)],'read':_0x1599ef[_0x4d4e10(0x163)][_0x4d4e10(0x2ea)],'mediaUrl':_0x3adcfe['filename'],'mediaType':_0x3adcfe[_0x4d4e10(0x1fb)][_0x4d4e10(0x1e4)]('/')[0x0],'quotedMsgId':_0x2480fc?.['id'],'ack':_0x1599ef[_0x4d4e10(0x234)],'remoteJid':_0x1599ef[_0x4d4e10(0x163)][_0x4d4e10(0x2bd)],'participant':_0x1599ef[_0x4d4e10(0x163)][_0x4d4e10(0x165)],'dataJson':JSON['stringify'](_0x1599ef),'ticketTrakingId':_0x3a10e1?.['id'],'createdAt':new Date(Math[_0x4d4e10(0x262)](getTimestampMessage(_0x1599ef[_0x4d4e10(0x244)])*0x3e8))[_0x4d4e10(0x2ee)](),'ticketImported':_0x4ccde8[_0x4d4e10(0x2b3)],'isForwarded':_0x1ebe58};await _0x4ccde8[_0x4d4e10(0x1c0)]({'lastMessage':_0x50d466||_0x3adcfe['filename']});const _0x453f44=await(0x0,CreateMessageService_1[_0x4d4e10(0x16b)])({'messageData':_0x1d7044,'companyId':_0x3555f7});return!_0x1599ef[_0x4d4e10(0x163)][_0x4d4e10(0x2ea)]&&_0x4ccde8[_0x4d4e10(0x234)]===_0x4d4e10(0x19f)&&(await _0x4ccde8[_0x4d4e10(0x1c0)]({'status':_0x4d4e10(0x2c5)}),await _0x4ccde8['reload']({'include':[{'model':Queue_1[_0x4d4e10(0x16b)],'as':'queue'},{'model':User_1[_0x4d4e10(0x16b)],'as':'user'},{'model':Contact_1[_0x4d4e10(0x16b)],'as':'contact'},{'model':Whatsapp_1['default'],'as':_0x4d4e10(0x1e7)}]}),_0xdd622['to']('closed')['emit'](_0x4d4e10(0x21c)+_0x3555f7+'-ticket',{'action':_0x4d4e10(0x2a9),'ticket':_0x4ccde8,'ticketId':_0x4ccde8['id']}),_0xdd622['to'](_0x4ccde8[_0x4d4e10(0x234)])['to'](_0x4ccde8['id'][_0x4d4e10(0x230)]())[_0x4d4e10(0x17a)](_0x4d4e10(0x21c)+_0x3555f7+_0x4d4e10(0x263),{'action':_0x4d4e10(0x1c0),'ticket':_0x4ccde8,'ticketId':_0x4ccde8['id']})),_0x453f44;}catch(_0x30349a){console[_0x4d4e10(0x2a7)](_0x30349a),logger_1[_0x4d4e10(0x1e1)]['warn'](_0x4d4e10(0x2a0));}};exports[a615_0xeefcd9(0x18f)]=verifyMediaMessage;const verifyMessage=async(_0x19fc4b,_0x4dcde1,_0x413a5e,_0x1106a4,_0x33656e,_0x4af48c)=>{const _0x4183e9=a615_0xeefcd9,_0x3a6c78=(0x0,socket_1[_0x4183e9(0x26f)])(),_0x3c9eab=await verifyQuotedMessage(_0x19fc4b),_0x2560b8=(0x0,exports[_0x4183e9(0x2e4)])(_0x19fc4b),_0xe9e4c2=_0x4dcde1[_0x4183e9(0x2c0)],_0x317e68={'wid':_0x19fc4b[_0x4183e9(0x163)]['id'],'ticketId':_0x4dcde1['id'],'contactId':_0x19fc4b[_0x4183e9(0x163)][_0x4183e9(0x2ea)]?undefined:_0x413a5e['id'],'body':_0x2560b8,'fromMe':_0x19fc4b['key'][_0x4183e9(0x2ea)],'mediaType':getTypeMessage(_0x19fc4b),'read':_0x19fc4b[_0x4183e9(0x163)][_0x4183e9(0x2ea)],'quotedMsgId':_0x3c9eab?.['id'],'ack':_0x19fc4b[_0x4183e9(0x234)],'remoteJid':_0x19fc4b[_0x4183e9(0x163)][_0x4183e9(0x2bd)],'participant':_0x19fc4b[_0x4183e9(0x163)][_0x4183e9(0x165)],'dataJson':JSON[_0x4183e9(0x204)](_0x19fc4b),'ticketTrakingId':_0x1106a4?.['id'],'isPrivate':![],'createdAt':new Date(Math['floor'](getTimestampMessage(_0x19fc4b[_0x4183e9(0x244)])*0x3e8))['toISOString'](),'ticketImported':_0x4dcde1[_0x4183e9(0x2b3)],'isForwarded':_0x4af48c};await _0x4dcde1[_0x4183e9(0x1c0)]({'lastMessage':_0x2560b8}),await(0x0,CreateMessageService_1[_0x4183e9(0x16b)])({'messageData':_0x317e68,'companyId':_0xe9e4c2}),!_0x19fc4b[_0x4183e9(0x163)][_0x4183e9(0x2ea)]&&_0x4dcde1[_0x4183e9(0x234)]===_0x4183e9(0x19f)&&(await _0x4dcde1[_0x4183e9(0x1c0)]({'status':_0x4183e9(0x2c5)}),await _0x4dcde1[_0x4183e9(0x151)]({'include':[{'model':Queue_1['default'],'as':'queue'},{'model':User_1[_0x4183e9(0x16b)],'as':_0x4183e9(0x1b2)},{'model':Contact_1[_0x4183e9(0x16b)],'as':_0x4183e9(0x2b1)},{'model':Whatsapp_1[_0x4183e9(0x16b)],'as':'whatsapp'}]}),!_0x4dcde1[_0x4183e9(0x2b3)]&&_0x3a6c78['to'](_0x4dcde1[_0x4183e9(0x234)])['to'](_0x4dcde1['id'][_0x4183e9(0x230)]())[_0x4183e9(0x17a)](_0x4183e9(0x21c)+_0xe9e4c2+_0x4183e9(0x263),{'action':_0x4183e9(0x1c0),'ticket':_0x4dcde1,'ticketId':_0x4dcde1['id']}));};exports[a615_0xeefcd9(0x1c4)]=verifyMessage;const isValidMsg=_0x2f17ab=>{const _0x4351b0=a615_0xeefcd9;if(_0x2f17ab[_0x4351b0(0x163)][_0x4351b0(0x2bd)]===_0x4351b0(0x2eb))return![];try{const _0x457dd2=getTypeMessage(_0x2f17ab);if(!_0x457dd2)return;const _0x2ade35=_0x457dd2===_0x4351b0(0x210)||_0x457dd2==='extendedTextMessage'||_0x457dd2===_0x4351b0(0x1cb)||_0x457dd2===_0x4351b0(0x288)||_0x457dd2===_0x4351b0(0x2aa)||_0x457dd2==='documentMessage'||_0x457dd2===_0x4351b0(0x1a9)||_0x457dd2==='buttonsResponseMessage'||_0x457dd2===_0x4351b0(0x286)||_0x457dd2==='messageContextInfo'||_0x457dd2===_0x4351b0(0x24e)||_0x457dd2===_0x4351b0(0x1bf)||_0x457dd2===_0x4351b0(0x1ef)||_0x457dd2==='voiceMessage'||_0x457dd2===_0x4351b0(0x194)||_0x457dd2===_0x4351b0(0x1ff)||_0x457dd2===_0x4351b0(0x156)||_0x457dd2===_0x4351b0(0x15e)||_0x457dd2===_0x4351b0(0x293)||_0x457dd2===_0x4351b0(0x202)||_0x457dd2===_0x4351b0(0x289)||_0x457dd2===_0x4351b0(0x169)||_0x457dd2===_0x4351b0(0x248)||_0x457dd2===_0x4351b0(0x21f)||_0x457dd2==='editedMessage';return!_0x2ade35&&(logger_1['logger'][_0x4351b0(0x15f)](_0x4351b0(0x1cf)+_0x457dd2+'\x0a'+JSON[_0x4351b0(0x204)](_0x2f17ab?.[_0x4351b0(0x1ae)])),Sentry['setExtra'](_0x4351b0(0x213),{'BodyMsg':_0x2f17ab[_0x4351b0(0x1ae)],'msg':_0x2f17ab,'msgType':_0x457dd2}),Sentry['captureException'](new Error('Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg'))),!!_0x2ade35;}catch(_0x188c28){Sentry[_0x4351b0(0x2a1)](_0x4351b0(0x2b9),{'msg':_0x2f17ab}),Sentry[_0x4351b0(0x217)](_0x188c28);}};exports['isValidMsg']=isValidMsg;const sendDialogflowAwswer=async(_0xee544,_0x5dde0b,_0x43cee3,_0xfa7f98,_0x5c2c5c,_0x5c13de,_0x4dc07f)=>{const _0x20ae3f=a615_0xeefcd9,_0x21eab5=await(0x0,CreateSessionDialogflow_1[_0x20ae3f(0x266)])(_0x4dc07f);if(_0x21eab5===undefined)return;_0xee544['presenceSubscribe'](_0xfa7f98[_0x20ae3f(0x2bd)]),await(0x0,baileys_1[_0x20ae3f(0x2c2)])(0x1f4);let _0x3ff52d=await(0x0,QueryDialogflow_1['queryDialogFlow'])(_0x21eab5,_0x4dc07f[_0x20ae3f(0x24f)],_0xfa7f98[_0x20ae3f(0x2bd)],(0x0,exports[_0x20ae3f(0x2e4)])(_0x43cee3),_0x4dc07f[_0x20ae3f(0x26c)],_0x5c2c5c);if(!_0x3ff52d){_0xee544[_0x20ae3f(0x291)](_0x20ae3f(0x2bf),_0xfa7f98['remoteJid']);const _0x16a1e1=(0x0,Mustache_1[_0x20ae3f(0x16b)])(_0x20ae3f(0x200)+_0x4dc07f?.[_0x20ae3f(0x18e)]+_0x20ae3f(0x1af));await(0x0,baileys_1[_0x20ae3f(0x2c2)])(0x3e8),await _0xee544[_0x20ae3f(0x291)](_0x20ae3f(0x2bb),_0xfa7f98[_0x20ae3f(0x2bd)]);const _0x1299f5=await _0xee544[_0x20ae3f(0x25e)](_0xfa7f98[_0x20ae3f(0x252)]+'@c.us',{'text':_0x16a1e1});await(0x0,exports[_0x20ae3f(0x1c4)])(_0x1299f5,_0x5dde0b,_0xfa7f98);return;}_0x3ff52d[_0x20ae3f(0x166)]&&await _0x5dde0b[_0x20ae3f(0x1c0)]({'contactId':_0x5dde0b[_0x20ae3f(0x2b1)]['id'][_0x20ae3f(0x230)](),'useIntegration':![]});const _0x14a9a6=_0x3ff52d['parameters'][_0x20ae3f(0x1e8)]?.['stringValue']??undefined,_0x363a5a=_0x3ff52d[_0x20ae3f(0x1c6)][_0x20ae3f(0x1a8)]?.[_0x20ae3f(0x186)]??undefined,_0x52dc23=_0x3ff52d[_0x20ae3f(0x2e2)][_0x20ae3f(0x230)](_0x20ae3f(0x20b))??undefined;_0xee544[_0x20ae3f(0x291)](_0x20ae3f(0x2bf),_0xfa7f98[_0x20ae3f(0x2bd)]),await(0x0,baileys_1[_0x20ae3f(0x2c2)])(0x1f4);let _0x2e918a;for(let _0xca986d of _0x3ff52d[_0x20ae3f(0x2b8)]){_0x2e918a=_0xca986d[_0x20ae3f(0x285)][_0x20ae3f(0x285)][0x0]?_0xca986d[_0x20ae3f(0x285)][_0x20ae3f(0x285)][0x0]:_0x2e918a;}for(let _0x32d0e7 of _0x3ff52d[_0x20ae3f(0x2b8)]){_0x32d0e7[_0x20ae3f(0x285)]&&await sendDelayedMessages(_0xee544,_0x5dde0b,_0xfa7f98,_0x32d0e7[_0x20ae3f(0x285)]['text'][0x0],_0x2e918a,_0x52dc23,_0x4dc07f);}};async function sendDelayedMessages(_0x53c582,_0x5aa249,_0x505ac3,_0x17cc6f,_0x4c0f63,_0x31d0ff,_0x1ca9b){const _0x14b3fd=a615_0xeefcd9,_0x5d3ca6=_0x5aa249[_0x14b3fd(0x2c0)],_0x1dede3=await(0x0,ShowWhatsAppService_1[_0x14b3fd(0x16b)])(_0x53c582['id'],_0x5d3ca6),_0x4a47ff=_0x1dede3[_0x14b3fd(0x2c3)][_0x14b3fd(0x279)](/[_*]/g,''),_0x46e221=await _0x53c582[_0x14b3fd(0x25e)](_0x505ac3['number']+_0x14b3fd(0x2d8),{'text':'‎\x20*'+_0x1ca9b?.[_0x14b3fd(0x18e)]+':*\x20'+_0x17cc6f});await(0x0,exports[_0x14b3fd(0x1c4)])(_0x46e221,_0x5aa249,_0x505ac3);if(_0x17cc6f!=_0x4c0f63)await(0x0,baileys_1[_0x14b3fd(0x2c2)])(0x1f4),_0x53c582[_0x14b3fd(0x291)]('composing',_0x505ac3[_0x14b3fd(0x2bd)]);else _0x31d0ff&&(_0x53c582[_0x14b3fd(0x291)](_0x14b3fd(0x15a),_0x505ac3[_0x14b3fd(0x2bd)]),await(0x0,baileys_1[_0x14b3fd(0x2c2)])(0x1f4),_0x4a47ff&&_0x17cc6f[_0x14b3fd(0x2be)](_0x4a47ff)&&(await(0x0,baileys_1[_0x14b3fd(0x2c2)])(0x2710),setTimeout(async()=>{const _0x162c82=_0x14b3fd;await _0x5aa249[_0x162c82(0x1c0)]({'contactId':_0x5aa249[_0x162c82(0x2b1)]['id'][_0x162c82(0x230)](),'useIntegration':!![]}),await(0x0,UpdateTicketService_1[_0x162c82(0x16b)])({'ticketId':_0x5aa249['id'],'ticketData':{'status':'closed'},'companyId':_0x5d3ca6});},0xbb8)));}const verifyQueue=async(_0x1fd440,_0x15502a,_0x341084,_0x522f22,_0x1c4b28,_0x3f785a)=>{const _0x426d09=a615_0xeefcd9,_0x3ef3ee=_0x341084[_0x426d09(0x2c0)],{queues:_0x157ef7,greetingMessage:_0x292eca,maxUseBotQueues:_0xf6d2fc,timeUseBotQueues:_0x207412}=await(0x0,ShowWhatsAppService_1[_0x426d09(0x16b)])(_0x1fd440['id'],_0x3ef3ee);let _0x37991f=![];_0x157ef7[_0x426d09(0x172)]===0x1&&(_0x37991f=_0x157ef7[0x0]?.[_0x426d09(0x1eb)][_0x426d09(0x172)]>0x1);const _0x2f2a69=_0x1c4b28[_0x426d09(0x19d)]===_0x426d09(0x295);if(_0x157ef7['length']===0x1&&!_0x37991f){const _0x1bc329=_0x1c4b28[_0x426d09(0x1d8)]===_0x426d09(0x295)||![];if(!_0x15502a[_0x426d09(0x163)][_0x426d09(0x2ea)]&&!_0x341084['isGroup']&&_0x157ef7[0x0][_0x426d09(0x2cc)]){const _0x21d002=await(0x0,ShowQueueIntegrationService_1[_0x426d09(0x16b)])(_0x341084['integrationId'],_0x3ef3ee);await(0x0,exports[_0x426d09(0x2b5)])(_0x15502a,_0x1fd440,_0x3ef3ee,_0x21d002,_0x341084),await _0x341084['update']({'useIntegration':!![],'integrationId':_0x21d002['id']});}if(_0x292eca[_0x426d09(0x172)]>0x1&&_0x1bc329){const _0x44f373=(0x0,Mustache_1[_0x426d09(0x16b)])(''+_0x292eca,_0x341084);if(_0x341084['whatsapp'][_0x426d09(0x29f)]!==null){const _0x44ca74=path_1[_0x426d09(0x16b)][_0x426d09(0x294)](_0x426d09(0x1f6),_0x426d09(0x21a)+_0x3ef3ee,_0x341084['whatsapp']['greetingMediaAttachment']),_0x1a5516=_0x341084['whatsapp'][_0x426d09(0x29f)],_0x4dc442=await(0x0,SendWhatsAppMedia_1[_0x426d09(0x174)])(_0x1a5516,_0x44ca74,String(_0x3ef3ee),_0x44f373),_0x295583=(0x0,Debounce_1[_0x426d09(0x23b)])(async()=>{const _0x26ac44=_0x426d09,_0x475e2b=await _0x1fd440[_0x26ac44(0x25e)](_0x341084[_0x26ac44(0x2b1)][_0x26ac44(0x252)]+'@'+(_0x341084[_0x26ac44(0x258)]?'g.us':'s.whatsapp.net'),{..._0x4dc442});await(0x0,exports[_0x26ac44(0x18f)])(_0x475e2b,_0x341084,_0x522f22,_0x3f785a);},0x3e8,_0x341084['id']);_0x295583();}else await _0x1fd440[_0x426d09(0x25e)](_0x522f22['number']+'@'+(_0x341084[_0x426d09(0x258)]?_0x426d09(0x229):_0x426d09(0x257)),{'text':_0x44f373});}if(!(0x0,lodash_1[_0x426d09(0x19e)])(_0x157ef7[0x0][_0x426d09(0x159)]))try{const _0x1e609f=path_1['default'][_0x426d09(0x294)](__dirname,'..','..','..',_0x426d09(0x1f6)),_0x4180a0=await(0x0,ShowService_1[_0x426d09(0x16b)])(_0x157ef7[0x0]['fileListId'],_0x341084['companyId']),_0x42ed4b=path_1[_0x426d09(0x16b)]['resolve'](_0x1e609f,_0x426d09(0x21a)+_0x341084[_0x426d09(0x2c0)],_0x426d09(0x158),String(_0x4180a0['id']));for(const [_0x288d8f,_0x241a9d]of _0x4180a0[_0x426d09(0x16c)]['entries']()){const _0xeec34e={'fieldname':_0x426d09(0x27e),'originalname':_0x241a9d['path'],'encoding':'7bit','mimetype':_0x241a9d[_0x426d09(0x1e0)],'filename':_0x241a9d[_0x426d09(0x2ba)],'path':path_1[_0x426d09(0x16b)][_0x426d09(0x294)](_0x42ed4b,_0x241a9d['path'])};await(0x0,SendWhatsAppMedia_1[_0x426d09(0x16b)])({'media':_0xeec34e,'ticket':_0x341084,'body':_0x241a9d[_0x426d09(0x18e)],'isPrivate':![],'isForwarded':![]});};}catch(_0x217c8e){logger_1[_0x426d09(0x1e1)][_0x426d09(0x247)](_0x217c8e);}if(_0x157ef7[0x0][_0x426d09(0x1a3)]){await(0x0,UpdateTicketService_1[_0x426d09(0x16b)])({'ticketData':{'status':_0x426d09(0x19f),'queueId':_0x157ef7[0x0]['id'],'sendFarewellMessage':![]},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});return;}else await(0x0,UpdateTicketService_1[_0x426d09(0x16b)])({'ticketData':{'queueId':_0x157ef7[0x0]['id']},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});const _0x5945c3=await Ticket_1['default'][_0x426d09(0x259)]({'where':{'userId':null,'status':'pending','companyId':_0x3ef3ee,'queueId':_0x157ef7[0x0]['id'],'isGroup':![]}});if(_0x2f2a69){const _0x446408=_0x5945c3[_0x426d09(0x25d)]===0x0?0x1:_0x5945c3[_0x426d09(0x25d)],_0x302bd4=_0x426d09(0x1d4)+_0x446408+'*',_0x3237e6=(0x0,Mustache_1[_0x426d09(0x16b)])(''+_0x302bd4,_0x341084),_0xde561f=(0x0,Debounce_1[_0x426d09(0x23b)])(async()=>{const _0x3f57ae=_0x426d09;await _0x1fd440[_0x3f57ae(0x25e)](_0x522f22[_0x3f57ae(0x252)]+'@'+(_0x341084[_0x3f57ae(0x258)]?_0x3f57ae(0x229):'s.whatsapp.net'),{'text':_0x3237e6});},0xbb8,_0x341084['id']);_0xde561f();}return;}if(_0x522f22[_0x426d09(0x240)])return;let _0x1299a2='';if(_0x341084[_0x426d09(0x234)]!=='lgpd')_0x1299a2=_0x15502a?.['message']?.['buttonsResponseMessage']?.[_0x426d09(0x1de)]||_0x15502a?.['message']?.[_0x426d09(0x202)]?.[_0x426d09(0x168)]['selectedRowId']||(0x0,exports['getBodyMessage'])(_0x15502a);else{if(!(0x0,lodash_1['isNil'])(_0x341084[_0x426d09(0x27a)]))await _0x341084[_0x426d09(0x1c0)]({'status':'pending'});await _0x341084['reload']();}if(_0x1299a2[_0x426d09(0x265)]()==_0x426d09(0x241)){const _0x2c51c5={'isBot':![],'status':'closed','sendFarewellMessage':!![],'maxUseBotQueues':0x0};await(0x0,UpdateTicketService_1[_0x426d09(0x16b)])({'ticketData':_0x2c51c5,'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});return;}const _0x5d3eb1=_0x37991f&&_0x157ef7[_0x426d09(0x172)]===0x1?_0x157ef7[+_0x1299a2]:_0x157ef7[+_0x1299a2-0x1];if(!_0x15502a['key'][_0x426d09(0x2ea)]&&!_0x341084[_0x426d09(0x258)]&&_0x5d3eb1?.[_0x426d09(0x2cc)]){const _0x4ce4e6=await(0x0,ShowQueueIntegrationService_1['default'])(_0x5d3eb1[_0x426d09(0x2cc)],_0x3ef3ee);await(0x0,exports[_0x426d09(0x2b5)])(_0x15502a,_0x1fd440,_0x3ef3ee,_0x4ce4e6,_0x341084),await _0x341084['update']({'useIntegration':!![],'integrationId':_0x4ce4e6['id']});}const _0x3f6ad2=_0x1c4b28?.[_0x426d09(0x173)]||_0x426d09(0x285);let _0x22d768;if(_0x5d3eb1)try{const _0x2aad80=await(0x0,ListUserQueueServices_1[_0x426d09(0x16b)])(_0x5d3eb1['id']);_0x2aad80['userId']>-0x1&&(_0x22d768=_0x2aad80[_0x426d09(0x283)]);}catch(_0x2d1e17){console['error'](_0x2d1e17);}const _0x1677be=async()=>{const _0x42e7d3=_0x426d09;if(_0x5d3eb1||_0x157ef7['length']===0x1&&_0x37991f){const _0x265dae=await Queue_1[_0x42e7d3(0x16b)][_0x42e7d3(0x242)](_0x5d3eb1['id']);let _0x128544;_0x1c4b28?.[_0x42e7d3(0x171)]==='queue'&&(_0x128544=await(0x0,VerifyCurrentSchedule_1[_0x42e7d3(0x16b)])(_0x3ef3ee,_0x265dae['id'],0x0));if(_0x1c4b28?.[_0x42e7d3(0x171)]==='queue'&&!(0x0,lodash_1[_0x42e7d3(0x19e)])(_0x128544)&&(!_0x128544||_0x128544[_0x42e7d3(0x237)]===![])&&(!_0x341084[_0x42e7d3(0x258)]||_0x341084[_0x42e7d3(0x1e7)]?.[_0x42e7d3(0x2c8)]==='enabled')){const _0x1ac6d4=_0x265dae[_0x42e7d3(0x256)];if(_0x1ac6d4!==''){const _0x1eddaa=(0x0,Mustache_1[_0x42e7d3(0x16b)])(''+_0x1ac6d4,_0x341084),_0x487230=(0x0,Debounce_1[_0x42e7d3(0x23b)])(async()=>{const _0xb0ada5=_0x42e7d3;await _0x1fd440[_0xb0ada5(0x25e)](_0x341084[_0xb0ada5(0x2b1)][_0xb0ada5(0x252)]+'@'+(_0x341084[_0xb0ada5(0x258)]?_0xb0ada5(0x229):_0xb0ada5(0x257)),{'text':_0x1eddaa});},0x3e8,_0x341084['id']);_0x487230(),await _0x341084[_0x42e7d3(0x1c0)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x341084[_0x42e7d3(0x28b)]+0x1});return;}await _0x341084[_0x42e7d3(0x1c0)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x341084[_0x42e7d3(0x28b)]+0x1});return;}await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':0x0,'queueId':_0x5d3eb1['id']},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});if(_0x5d3eb1[_0x42e7d3(0x1eb)][_0x42e7d3(0x172)]>0x0&&!_0x341084['isGroup']){let _0x5c9b3c='';_0x5d3eb1[_0x42e7d3(0x1eb)]['forEach']((_0x58ea55,_0x3449a3)=>{const _0x15a3a6=_0x42e7d3;_0x5c9b3c+=_0x15a3a6(0x29d)+(_0x3449a3+0x1)+_0x15a3a6(0x236)+_0x58ea55[_0x15a3a6(0x18e)]+'\x0a';});const _0x8a6e1e=(0x0,Mustache_1[_0x42e7d3(0x16b)])('‎'+_0x5d3eb1['greetingMessage']+'\x0a\x0a'+_0x5c9b3c+_0x42e7d3(0x199),_0x341084),_0x7eaea4=await _0x1fd440[_0x42e7d3(0x25e)](_0x522f22[_0x42e7d3(0x252)]+'@'+(_0x341084[_0x42e7d3(0x258)]?_0x42e7d3(0x229):'s.whatsapp.net'),{'text':_0x8a6e1e});await(0x0,exports[_0x42e7d3(0x1c4)])(_0x7eaea4,_0x341084,_0x522f22,_0x3f785a),_0x1c4b28?.['settingsUserRandom']===_0x42e7d3(0x295)&&await(0x0,UpdateTicketService_1['default'])({'ticketData':{'userId':_0x22d768},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});}if(!_0x5d3eb1['chatbots'][_0x42e7d3(0x172)]&&_0x5d3eb1[_0x42e7d3(0x2c9)]['length']!==0x0){const _0x264690=(0x0,Mustache_1[_0x42e7d3(0x16b)])('‎'+_0x5d3eb1[_0x42e7d3(0x2c9)],_0x341084),_0x42522b=await _0x1fd440['sendMessage'](_0x522f22[_0x42e7d3(0x252)]+'@'+(_0x341084[_0x42e7d3(0x258)]?_0x42e7d3(0x229):_0x42e7d3(0x257)),{'text':_0x264690});await(0x0,exports[_0x42e7d3(0x1c4)])(_0x42522b,_0x341084,_0x522f22,_0x3f785a);}if(!(0x0,lodash_1[_0x42e7d3(0x19e)])(_0x5d3eb1[_0x42e7d3(0x159)]))try{const _0x533db2=path_1[_0x42e7d3(0x16b)][_0x42e7d3(0x294)](__dirname,'..','..','..',_0x42e7d3(0x1f6)),_0x16756b=await(0x0,ShowService_1['default'])(_0x5d3eb1[_0x42e7d3(0x159)],_0x341084[_0x42e7d3(0x2c0)]),_0x2b9439=path_1['default']['resolve'](_0x533db2,_0x42e7d3(0x21a)+_0x341084['companyId'],'fileList',String(_0x16756b['id']));for(const [_0x296b65,_0x5e1182]of _0x16756b[_0x42e7d3(0x16c)][_0x42e7d3(0x23a)]()){const _0x1adf6a={'fieldname':_0x42e7d3(0x27e),'originalname':_0x5e1182['path'],'encoding':'7bit','mimetype':_0x5e1182[_0x42e7d3(0x1e0)],'filename':_0x5e1182[_0x42e7d3(0x2ba)],'path':path_1[_0x42e7d3(0x16b)]['resolve'](_0x2b9439,_0x5e1182[_0x42e7d3(0x2ba)])};await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x1adf6a,'ticket':_0x341084,'body':_0x5e1182[_0x42e7d3(0x18e)],'isPrivate':![],'isForwarded':![]});};await(0x0,baileys_1[_0x42e7d3(0x2c2)])(0x7d0);}catch(_0x48dba7){logger_1[_0x42e7d3(0x1e1)][_0x42e7d3(0x247)](_0x48dba7);}if(_0x5d3eb1['closeTicket']){await(0x0,UpdateTicketService_1[_0x42e7d3(0x16b)])({'ticketData':{'status':'closed','queueId':_0x5d3eb1['id'],'sendFarewellMessage':![]},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee}),await(0x0,CreateLogTicketService_1[_0x42e7d3(0x16b)])({'ticketId':_0x341084['id'],'type':_0x42e7d3(0x19f),'queueId':_0x5d3eb1['id']});return;}const _0x5b330f=await Ticket_1[_0x42e7d3(0x16b)][_0x42e7d3(0x259)]({'where':{'userId':null,'status':_0x42e7d3(0x2c5),'companyId':_0x3ef3ee,'queueId':_0x5d3eb1['id'],'isGroup':![]}});await(0x0,CreateLogTicketService_1[_0x42e7d3(0x16b)])({'ticketId':_0x341084['id'],'type':_0x42e7d3(0x1b4),'queueId':_0x5d3eb1['id']});if(_0x2f2a69&&!_0x5d3eb1[_0x42e7d3(0x1eb)][_0x42e7d3(0x172)]){const _0x7a06fc=_0x5b330f['count']===0x0?0x1:_0x5b330f['count'],_0x53fa0b='*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posição\x20na\x20fila\x20de\x20atendimento\x20é:\x20*'+_0x7a06fc+'*',_0x4c3751=(0x0,Mustache_1[_0x42e7d3(0x16b)])(''+_0x53fa0b,_0x341084),_0x5dac6d=(0x0,Debounce_1[_0x42e7d3(0x23b)])(async()=>{const _0xea5c2=_0x42e7d3;await _0x1fd440[_0xea5c2(0x25e)](_0x522f22[_0xea5c2(0x252)]+'@'+(_0x341084['isGroup']?_0xea5c2(0x229):_0xea5c2(0x257)),{'text':_0x4c3751});},0xbb8,_0x341084['id']);_0x5dac6d();}}else{if(_0x341084[_0x42e7d3(0x258)])return;if(_0xf6d2fc&&_0xf6d2fc!==0x0&&_0x341084[_0x42e7d3(0x28b)]>=_0xf6d2fc)return;const _0x1ff904=await(0x0,FindOrCreateATicketTrakingService_1[_0x42e7d3(0x16b)])({'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});let _0x1a374c=new Date(),_0x3eb366=new Date();if(_0x1ff904[_0x42e7d3(0x17e)]!==null){_0x1a374c[_0x42e7d3(0x19b)](_0x1ff904[_0x42e7d3(0x17e)][_0x42e7d3(0x22a)]()+Number(_0x207412));if(_0x1ff904['chatbotAt']!==null&&_0x3eb366<_0x1a374c&&_0x207412!=='0'&&_0x341084[_0x42e7d3(0x28b)]!==0x0)return;}await _0x1ff904[_0x42e7d3(0x1c0)]({'chatbotAt':null}),_0x1fd440[_0x42e7d3(0x1dd)](_0x522f22[_0x42e7d3(0x2bd)]);let _0x32ee24='';_0x1fd440[_0x42e7d3(0x291)](_0x42e7d3(0x2bf),_0x522f22[_0x42e7d3(0x2bd)]),_0x157ef7[_0x42e7d3(0x192)]((_0x171749,_0xa0a07e)=>{const _0x43d8bd=_0x42e7d3;_0x32ee24+='*[\x20'+(_0xa0a07e+0x1)+_0x43d8bd(0x236)+_0x171749[_0x43d8bd(0x18e)]+'\x0a';}),_0x32ee24+='\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20atendimento';const _0x513055=(0x0,Mustache_1[_0x42e7d3(0x16b)])('‎'+_0x292eca+'\x0a\x0a'+_0x32ee24,_0x341084);await(0x0,CreateLogTicketService_1[_0x42e7d3(0x16b)])({'ticketId':_0x341084['id'],'type':'chatBot'}),await(0x0,baileys_1['delay'])(0x3e8),await _0x1fd440[_0x42e7d3(0x291)](_0x42e7d3(0x2bb),_0x522f22[_0x42e7d3(0x2bd)]);if(_0x341084[_0x42e7d3(0x1e7)][_0x42e7d3(0x29f)]!==null){const _0x252346=path_1[_0x42e7d3(0x16b)]['resolve'](_0x42e7d3(0x1f6),_0x42e7d3(0x21a)+_0x3ef3ee,_0x341084[_0x42e7d3(0x1e7)][_0x42e7d3(0x29f)]),_0x1cfe00=_0x341084[_0x42e7d3(0x1e7)][_0x42e7d3(0x29f)],_0x53de09=await(0x0,SendWhatsAppMedia_1[_0x42e7d3(0x174)])(_0x1cfe00,_0x252346,String(_0x3ef3ee),_0x513055),_0x2a7e62=(0x0,Debounce_1['debounce'])(async()=>{const _0x12b873=_0x42e7d3;let _0x413c3b=await _0x1fd440['sendMessage'](_0x341084[_0x12b873(0x2b1)][_0x12b873(0x252)]+'@'+(_0x341084[_0x12b873(0x258)]?'g.us':_0x12b873(0x257)),{..._0x53de09});await(0x0,exports[_0x12b873(0x18f)])(_0x413c3b,_0x341084,_0x522f22,_0x1ff904);},0x3e8,_0x341084['id']);_0x2a7e62(),await(0x0,UpdateTicketService_1[_0x42e7d3(0x16b)])({'ticketData':{'amountUsedBotQueues':_0x341084[_0x42e7d3(0x28b)]+0x1},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});return;}else{const _0x4d0d29=(0x0,Debounce_1[_0x42e7d3(0x23b)])(async()=>{const _0x2a4b69=_0x42e7d3,_0x34d64c=await _0x1fd440[_0x2a4b69(0x25e)](_0x522f22[_0x2a4b69(0x252)]+'@'+(_0x341084[_0x2a4b69(0x258)]?_0x2a4b69(0x229):_0x2a4b69(0x257)),{'text':_0x513055});(0x0,exports['verifyMessage'])(_0x34d64c,_0x341084,_0x522f22,_0x1ff904);},0x3e8,_0x341084['id']);await(0x0,UpdateTicketService_1[_0x42e7d3(0x16b)])({'ticketData':{'amountUsedBotQueues':_0x341084['amountUsedBotQueues']+0x1},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee}),_0x4d0d29();}}},_0x428469=async()=>{const _0x7cddf0=_0x426d09;if(_0x5d3eb1){await(0x0,UpdateTicketService_1[_0x7cddf0(0x16b)])({'ticketData':{'queueId':_0x5d3eb1['id']},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});if(_0x5d3eb1[_0x7cddf0(0x1eb)][_0x7cddf0(0x172)]>0x0){const _0x18b7db=[];_0x5d3eb1[_0x7cddf0(0x1eb)][_0x7cddf0(0x192)]((_0x32d066,_0x5b6b3d)=>{const _0x54c4cc=_0x7cddf0;_0x18b7db['push']({'buttonId':''+(_0x5b6b3d+0x1),'buttonText':{'displayText':_0x32d066[_0x54c4cc(0x18e)]},'type':0x1});});const _0x280c48={'text':(0x0,Mustache_1[_0x7cddf0(0x16b)])(''+_0x5d3eb1['greetingMessage'],_0x341084),'buttons':_0x18b7db,'headerType':0x4},_0x10944d=await _0x1fd440['sendMessage'](_0x522f22[_0x7cddf0(0x252)]+'@'+(_0x341084[_0x7cddf0(0x258)]?_0x7cddf0(0x229):_0x7cddf0(0x257)),_0x280c48);await(0x0,exports[_0x7cddf0(0x1c4)])(_0x10944d,_0x341084,_0x522f22,_0x3f785a);}if(!_0x5d3eb1[_0x7cddf0(0x1eb)][_0x7cddf0(0x172)]){const _0x320475=(0x0,Mustache_1[_0x7cddf0(0x16b)])(''+_0x5d3eb1[_0x7cddf0(0x2c9)],_0x341084),_0x319f33=await _0x1fd440['sendMessage'](_0x522f22[_0x7cddf0(0x252)]+'@'+(_0x341084[_0x7cddf0(0x258)]?_0x7cddf0(0x229):'s.whatsapp.net'),{'text':_0x320475});await(0x0,exports[_0x7cddf0(0x1c4)])(_0x319f33,_0x341084,_0x522f22,_0x3f785a);}}else{const _0x46d141=[];_0x157ef7[_0x7cddf0(0x192)]((_0x4bdb42,_0x2ff03c)=>{const _0x5e21ca=_0x7cddf0;_0x46d141[_0x5e21ca(0x25b)]({'buttonId':''+(_0x2ff03c+0x1),'buttonText':{'displayText':_0x4bdb42[_0x5e21ca(0x18e)]},'type':0x4});});const _0x56d679={'text':(0x0,Mustache_1[_0x7cddf0(0x16b)])(''+_0x292eca,_0x341084),'footer':'','buttons':_0x46d141,'headerType':0x4},_0x440be0=await _0x1fd440[_0x7cddf0(0x25e)](_0x522f22[_0x7cddf0(0x252)]+'@'+(_0x341084[_0x7cddf0(0x258)]?_0x7cddf0(0x229):_0x7cddf0(0x257)),_0x56d679);await(0x0,exports[_0x7cddf0(0x1c4)])(_0x440be0,_0x341084,_0x522f22,_0x3f785a),await(0x0,UpdateTicketService_1[_0x7cddf0(0x16b)])({'ticketData':{'amountUsedBotQueues':_0x341084['amountUsedBotQueues']+0x1},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});}},_0x4b82dd=async()=>{const _0x2812d2=_0x426d09;if(_0x5d3eb1){await(0x0,UpdateTicketService_1[_0x2812d2(0x16b)])({'ticketData':{'queueId':_0x5d3eb1['id']},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});if(_0x5d3eb1[_0x2812d2(0x1eb)][_0x2812d2(0x172)]>0x0){const _0x39b0f6=[];_0x5d3eb1[_0x2812d2(0x1eb)][_0x2812d2(0x192)]((_0x52637e,_0x1a4db2)=>{const _0x4fb646=_0x2812d2;_0x39b0f6[_0x4fb646(0x25b)]({'title':_0x52637e['name'],'rowId':''+(_0x1a4db2+0x1)});});const _0x3e32f5=[{'title':_0x2812d2(0x2ce),'rows':_0x39b0f6}],_0x3e2dfa={'text':(0x0,Mustache_1[_0x2812d2(0x16b)])(''+_0x5d3eb1[_0x2812d2(0x2c9)],_0x341084),'buttonText':_0x2812d2(0x267),'sections':_0x3e32f5},_0x208c07=await _0x1fd440[_0x2812d2(0x25e)](_0x522f22['number']+'@'+(_0x341084[_0x2812d2(0x258)]?'g.us':'s.whatsapp.net'),_0x3e2dfa);await(0x0,exports[_0x2812d2(0x1c4)])(_0x208c07,_0x341084,_0x522f22,_0x3f785a);}if(!_0x5d3eb1[_0x2812d2(0x1eb)]['length']){const _0x19c226=(0x0,Mustache_1[_0x2812d2(0x16b)])(''+_0x5d3eb1[_0x2812d2(0x2c9)],_0x341084),_0x1b9c7c=await _0x1fd440[_0x2812d2(0x25e)](_0x522f22[_0x2812d2(0x252)]+'@'+(_0x341084['isGroup']?_0x2812d2(0x229):'s.whatsapp.net'),{'text':_0x19c226});await(0x0,exports[_0x2812d2(0x1c4)])(_0x1b9c7c,_0x341084,_0x522f22,_0x3f785a);}}else{const _0xee2697=[];_0x157ef7['forEach']((_0x5ebaa8,_0x134ee8)=>{const _0x36eee7=_0x2812d2;_0xee2697[_0x36eee7(0x25b)]({'title':_0x5ebaa8[_0x36eee7(0x18e)],'rowId':''+(_0x134ee8+0x1)});});const _0x3e26d7=[{'title':_0x2812d2(0x2ce),'rows':_0xee2697}],_0x44b876={'text':(0x0,Mustache_1['default'])(''+_0x292eca,_0x341084),'buttonText':_0x2812d2(0x267),'sections':_0x3e26d7},_0x1b9420=await _0x1fd440[_0x2812d2(0x25e)](_0x522f22['number']+'@'+(_0x341084[_0x2812d2(0x258)]?_0x2812d2(0x229):'s.whatsapp.net'),_0x44b876);await(0x0,exports[_0x2812d2(0x1c4)])(_0x1b9420,_0x341084,_0x522f22,_0x3f785a),await(0x0,UpdateTicketService_1[_0x2812d2(0x16b)])({'ticketData':{'amountUsedBotQueues':_0x341084[_0x2812d2(0x28b)]+0x1},'ticketId':_0x341084['id'],'companyId':_0x3ef3ee});}};if(_0x3f6ad2===_0x426d09(0x285))return _0x1677be();if(_0x3f6ad2==='button'&&_0x157ef7['length']>0x3)return _0x1677be();if(_0x3f6ad2===_0x426d09(0x1c3)&&_0x157ef7[_0x426d09(0x172)]<=0x3)return _0x428469();if(_0x3f6ad2===_0x426d09(0x22c))return _0x4b82dd();},verifyRating=_0x503ca7=>{const _0x6589e5=a615_0xeefcd9;if(_0x503ca7&&_0x503ca7[_0x6589e5(0x23d)]===null&&_0x503ca7[_0x6589e5(0x198)]!==null&&_0x503ca7[_0x6589e5(0x283)]!==null&&_0x503ca7[_0x6589e5(0x246)]===null)return!![];return![];};exports[a615_0xeefcd9(0x1f8)]=verifyRating;const handleRating=async(_0x50fb2a,_0x463920,_0x2d0c4a)=>{const _0x5cffe3=a615_0xeefcd9,_0xeca263=(0x0,socket_1[_0x5cffe3(0x26f)])(),_0x52c616=_0x463920[_0x5cffe3(0x2c0)],{complationMessage:_0x3c763c}=await(0x0,ShowWhatsAppService_1[_0x5cffe3(0x16b)])(_0x463920[_0x5cffe3(0x205)],_0x52c616);let _0x516e75=_0x50fb2a;_0x50fb2a<0x0&&(_0x516e75=0x0);_0x50fb2a>0xa&&(_0x516e75=0xa);await UserRating_1[_0x5cffe3(0x16b)][_0x5cffe3(0x278)]({'ticketId':_0x2d0c4a[_0x5cffe3(0x1f1)],'companyId':_0x2d0c4a[_0x5cffe3(0x2c0)],'userId':_0x2d0c4a[_0x5cffe3(0x283)],'rate':_0x516e75});if(!(0x0,lodash_1['isNil'])(_0x3c763c)&&_0x3c763c!==''&&!_0x463920['isGroup']){const _0x3288e0=(0x0,Mustache_1[_0x5cffe3(0x16b)])('‎'+_0x3c763c,_0x463920);if(_0x463920['channel']===_0x5cffe3(0x1e7)){const _0x45d98d=await(0x0,SendWhatsAppMessage_1[_0x5cffe3(0x16b)])({'body':_0x3288e0,'ticket':_0x463920});await(0x0,exports['verifyMessage'])(_0x45d98d,_0x463920,_0x463920[_0x5cffe3(0x2b1)],_0x2d0c4a);}['facebook',_0x5cffe3(0x2ca)][_0x5cffe3(0x2be)](_0x463920['channel'])&&await(0x0,sendFacebookMessage_1[_0x5cffe3(0x16b)])({'body':_0x3288e0,'ticket':_0x463920});}await _0x463920[_0x5cffe3(0x1c0)]({'chatbot':null,'status':_0x5cffe3(0x19f),'amountUseBotQueuesNPS':0x0}),await(0x0,CreateLogTicketService_1['default'])({'userId':_0x463920['userId'],'queueId':_0x463920['queueId'],'ticketId':_0x463920['id'],'type':_0x5cffe3(0x19f)}),_0xeca263['to'](_0x5cffe3(0x16e))[_0x5cffe3(0x17a)](_0x5cffe3(0x21c)+_0x52c616+_0x5cffe3(0x263),{'action':_0x5cffe3(0x2a9),'ticket':_0x463920,'ticketId':_0x463920['id']}),_0xeca263['to'](_0x463920[_0x5cffe3(0x234)])['to'](_0x463920['id']['toString']())[_0x5cffe3(0x17a)](_0x5cffe3(0x21c)+_0x52c616+_0x5cffe3(0x263),{'action':_0x5cffe3(0x1c0),'ticket':_0x463920,'ticketId':_0x463920['id']});};function a615_0x1a66(){const _0x298f5d=['existsSync','value','quotedMsg','Latitude:\x20','util','./SendWhatsAppMessage','../../models/UserRating','stringValue','81009XmSpcu','lgpdConsent','maxUseBotQueuesNPS','filter','chat','sayChatbot','.txt','name','verifyMediaMessage','audio/mpeg','speakTextAsync','forEach','createChatCompletion','mediaMessage',':\x20📞','../../models/Ticket','createReadStream','closedAt','\x0a*[\x20#\x20]*\x20Voltar\x20para\x20o\x20menu\x20principal\x0a*[\x20Sair\x20]*\x20Encerrar\x20atendimento','isNull','setMinutes','map','sendQueuePosition','isNil','closed','voiceRegion','toFormat','subject','closeTicket','gpt-3.5-turbo','title','../TicketServices/CreateLogTicketService','debug','react','stickerMessage','handleRating','voiceKey','lgpdSendMessageAt','readMessages','message',':*\x20Não\x20consegui\x20entender\x20sua\x20dúvida.','fromAudioFileOutput','messages.update','user','data:image/png;base64,\x20','queue','*System:*\x20\x0aFalha\x20no\x20download\x20da\x20mídia\x20verifique\x20no\x20dispositivo','fromSubscription','caption','buttons','amountUseBotQueuesNPS','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','ERR_WAPP_DOWNLOAD_MEDIA','.mpeg','../WhatsappService/ShowWhatsAppService','Falha\x20ao\x20fazer\x20o\x20download\x20de\x20uma\x20mensagem\x20importada,\x20provavelmente\x20a\x20mensagem\x20já\x20não\x20esta\x20mais\x20disponível','liveLocationMessage','update','../../models/User','microsoft-cognitiveservices-speech-sdk','button','verifyMessage','373830hDXYZc','parameters','Error\x20converting\x20file:\x20','__importDefault','extractMessageContent','type','audioMessage','‎Opção\x20inválida,\x20tente\x20novamente.\x0a','Configuration','item1.TEL','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','platform','contacts','join','/opt/homebrew/bin/ffmpeg','*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posição\x20na\x20fila\x20de\x20atendimento\x20é:\x20*','end','timeUseBotQueues','Erro\x20ao\x20deletar\x20o\x20arquivo:','sendGreetingMessageOneQueues','sticker','acceptAudioMessage','232LeYpvP','senderKeyDistributionMessage','presenceSubscribe','selectedButtonId','set','mediaType','logger','.ogg','sequelize','split','getTypeMessage','Output\x20File:','whatsapp','image','mkdirSync','../TicketServices/FindOrCreateATicketTrakingService','chatbots','maxUseBotQueues','../../libs/cache','templateButtonReplyMessage','contactMessage','Error\x20getTypeMessage','ticketId','dialogflow','BEGIN:','__setModuleDefault','../../models/Queue','public','__importStar','verifyRating','setFfmpegPath','destroy','mimetype','next','../UserQueueServices/ListUserQueueServices','Error:\x20','contactsArrayMessage','‎\x20*','pushName','listResponseMessage','description','stringify','whatsappId','Erro\x20ao\x20baixar\x20mídia:','now','values','content','./MarkDeleteWhatsAppMessage','base64','No\x20result\x20from\x20synthesizer',';;;','1433460JjqYks','findOne','conversation','min','Formato\x20de\x20arquivo\x20não\x20suportado:','Mensagem','96512INptaz','mediaUrl','Conversão\x20concluída!','captureException','vcard','../FileServices/ShowService','company','close','company-','####\x20Nao\x20achou\x20o\x20type\x20152:\x20','queueId','viewOnceMessageV2','mp3','‎Estou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20Não','SpeechSynthesizer','processImportMessagesWppId','body','writeFile','TIMEOUT_TO_IMPORT_MESSAGE','sections','hasOwnProperty','g.us','getMinutes','Esta\x20mensagem\x20já\x20existe','list','Arquivo\x20salvo\x20com\x20sucesso!','selectedId','FRONTEND_URL','toString','../../models/Whatsapp','@g.us','voice','status','pop','\x20]*\x20-\x20','inActivity','queues','speechSynthesisVoiceName','entries','debounce','isForwarded','finishedAt','WAMessageStubType','\x20-\x20Longitude:\x20','disableBot','sair','findByPk','trim','messageTimestamp','whisper-1','ratingAt','info','documentWithCaptionMessage','contextInfo','NFD','Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','contentText','jidNormalizedUser','locationMessage','projectName','DispatchCampaign','‎*Assistente\x20Virtual*:\x0aInfelizmente\x20não\x20conseguimos\x20escutar\x20nem\x20enviar\x20áudios\x20por\x20este\x20canal\x20de\x20atendimento,\x20por\x20favor,\x20envie\x20uma\x20mensagem\x20de\x20*texto*.','number','test','fluent-ffmpeg','lgpdMessage','outOfHoursMessage','s.whatsapp.net','isGroup','findAndCountAll','defineProperty','push','complationMessage','count','sendMessage','chmodSync','isValidMsg','/nopicture.png','floor','-ticket','darwin','toLocaleLowerCase','createDialogflowSessionWithModel','Escolha\x20uma\x20opção','../../models/CampaignShipping','useIntegration','texto','get','language','../../libs/socket','groupMetadata','getIO','70945ffXKms','messages.upsert','\x20para\x20identificar\x20o\x20cliente.\x0aSua\x20resposta\x20deve\x20usar\x20no\x20máximo\x20','promptId','messageStubType','downloadMediaMessage','temperature','wbotMessageListener','create','replace','lgpdAcceptedAt',':unreads','OpenAIApi','getTime','medias','../QueueIntegrationServices/QueryDialogflow','system','reaction','../../queues','userId','Importando\x20Mensagem:\x20','text','buttonsMessage','disabled','videoMessage','listMessage','497871CdqXAk','amountUsedBotQueues','lgpd','connection','rows','%2C','enableLGPD','sendPresenceUpdate','E2E_DEVICE_CHANGED','protocolMessage','resolve','enabled','keys','Validação\x20de\x20mensagem\x20de\x20campanha\x20enviada\x20por\x20terceiros:\x20','lgpdLink','maxTokens','Amigo(a)','Error\x20handling\x20message\x20ack.\x20Err:\x20','selectedRowId','*[\x20','request','greetingMediaAttachment','Erro\x20ao\x20baixar\x20media','setExtra','quotedMessage','urlN8N','win32','endsWith','extendedTextMessage','log','maxMessages','delete','imageMessage','webhook','CIPHERTEXT','../QueueIntegrationServices/CreateSessionDialogflow','./ChatBotListener','buttonsResponseMessage','../../helpers/Debounce','contact','then','imported','audio','handleMessageIntegration','>>>>>>>>>>>>>>>>>>>','SpeechConfig','responses','Error\x20isValidMsg','path','paused','../TicketServices/UpdateTicketService','remoteJid','includes','composing','companyId','REVOKE','delay','farewellMessage','__createBinding','pending','error','createTranscription','groupAsTicket','greetingMessage','instagram','../../models/Message','integrationId','prototype','Menu','shift','choices','getQuotedMessageId','parseToMilliseconds','allowGroup','filename','../FacebookServices/sendFacebookMessage','handleMessage','add','@c.us','@sentry/node','save','axolotlSenderKeyDistributionMessage','messages','application/json','.wav','Áudio','writable','indexOf','encodedAudio','120254cRDaVv','getBodyMessage','unlink','createdAt','./SendWhatsAppMedia','contactId','6gcJNQR','fromMe','status@broadcast','substring','campaignId','toISOString','fileName','documentMessage','reload','getQuotedMessage','contacts:','groups.update','isNaN','reactionMessage','__esModule','fileList','fileListId','recording','data','call','.mp3','ephemeralMessage','warn','displayText','configurable','../../utils/logger','key','find','participant','endConversation','degreesLongitude','singleSelectReply','viewOnceMessage','assistant','default','options','findAll','open','env','promisify','scheduleType','length','chatBotType','getMessageOptions','editedMessage','toDate','../ContactServices/CreateOrUpdateContactService','degreesLatitude','moment','emit','../../helpers/Mustache','ASC','Erro\x20para\x20responder\x20com\x20audio:\x20','chatbotAt'];a615_0x1a66=function(){return _0x298f5d;};return a615_0x1a66();}exports[a615_0xeefcd9(0x1aa)]=handleRating;const sanitizeName=_0x36753c=>{const _0x1c71c6=a615_0xeefcd9;let _0x48b215=_0x36753c[_0x1c71c6(0x1e4)]('\x20')[0x0];return _0x48b215=_0x48b215[_0x1c71c6(0x279)](/[^a-zA-Z0-9]/g,''),_0x48b215[_0x1c71c6(0x2ec)](0x0,0x3c);},deleteFileSync=_0x32757b=>{const _0x3c9696=a615_0xeefcd9;try{fs_2['default']['unlinkSync'](_0x32757b);}catch(_0x422fbb){console[_0x3c9696(0x2c6)](_0x3c9696(0x1d7),_0x422fbb);}},convertTextToSpeechAndSaveToFile=(_0x1b2aeb,_0x5d2d7b,_0x342f29,_0x3bae95,_0x3f2fc3='pt-BR-FabioNeural',_0x4ee1a6='mp3')=>{return new Promise((_0x45aadb,_0x2bd8db)=>{const _0x54d4ef=a615_0x5e6b,_0x594283=microsoft_cognitiveservices_speech_sdk_1[_0x54d4ef(0x2b7)][_0x54d4ef(0x1b6)](_0x342f29,_0x3bae95);_0x594283[_0x54d4ef(0x239)]=_0x3f2fc3;const _0x4bc1da=microsoft_cognitiveservices_speech_sdk_1['AudioConfig'][_0x54d4ef(0x1b0)](_0x5d2d7b+_0x54d4ef(0x2de)),_0x33a825=new microsoft_cognitiveservices_speech_sdk_1[(_0x54d4ef(0x222))](_0x594283,_0x4bc1da);_0x33a825[_0x54d4ef(0x191)](_0x1b2aeb,_0x35f7f3=>{const _0x40f865=_0x54d4ef;_0x35f7f3?convertWavToAnotherFormat(_0x5d2d7b+_0x40f865(0x2de),_0x5d2d7b+'.'+_0x4ee1a6,_0x4ee1a6)[_0x40f865(0x2b2)](_0x463c4c=>{_0x45aadb();})['catch'](_0x42388e=>{console['error'](_0x42388e),_0x2bd8db(_0x42388e);}):_0x2bd8db(new Error(_0x40f865(0x20c))),_0x33a825[_0x40f865(0x21b)]();},_0x2429b1=>{const _0x3c79a1=_0x54d4ef;console[_0x3c79a1(0x2c6)](_0x3c79a1(0x1fe)+_0x2429b1),_0x33a825[_0x3c79a1(0x21b)](),_0x2bd8db(_0x2429b1);});});},convertWavToAnotherFormat=(_0xdded69,_0x156f21,_0x34c690)=>{return new Promise((_0x4651a2,_0xe3c8a9)=>{const _0x5a0f2b=a615_0x5e6b;(0x0,fluent_ffmpeg_1[_0x5a0f2b(0x16b)])()['input'](_0xdded69)[_0x5a0f2b(0x1a1)](_0x34c690)['on'](_0x5a0f2b(0x1d5),()=>_0x4651a2(_0x156f21))['on'](_0x5a0f2b(0x2c6),_0x55c4f6=>_0xe3c8a9(new Error(_0x5a0f2b(0x1c7)+_0x55c4f6[_0x5a0f2b(0x1ae)])))[_0x5a0f2b(0x2da)](_0x156f21);});},keepOnlySpecifiedChars=_0xfd972c=>{const _0x22f80b=a615_0xeefcd9;return _0xfd972c[_0x22f80b(0x279)](/[^a-zA-Z0-9áéíóúÁÉÍÓÚâêîôûÂÊÎÔÛãõÃÕçÇ!?.,;:\s]/g,'');},handleOpenAi=async(_0xd8b061,_0x94cbda,_0x11c72d,_0x4e0331,_0xa33106)=>{const _0x443bdb=a615_0xeefcd9,_0x2b55b0=(0x0,exports['getBodyMessage'])(_0xd8b061);if(!_0x2b55b0)return;const {prompt:_0x3bdcfb}=await(0x0,ShowWhatsAppService_1[_0x443bdb(0x16b)])(_0x94cbda['id'],_0x11c72d[_0x443bdb(0x2c0)]);if(!_0x3bdcfb)return;if(_0xd8b061[_0x443bdb(0x274)])return;const _0x5c70bc=path_1['default']['resolve'](__dirname,'..','..','..',_0x443bdb(0x1f6),_0x443bdb(0x21a)+_0x11c72d['companyId']);let _0x4dfe2f;const _0x2a8622=sessionsOpenAi['findIndex'](_0x4e421b=>_0x4e421b['id']===_0x94cbda['id']);if(_0x2a8622===-0x1){const _0x5a7918=new openai_1[(_0x443bdb(0x1cd))]({'apiKey':_0x3bdcfb['apiKey']});_0x4dfe2f=new openai_1[(_0x443bdb(0x27c))](_0x5a7918),_0x4dfe2f['id']=_0x94cbda['id'],sessionsOpenAi[_0x443bdb(0x25b)](_0x4dfe2f);}else _0x4dfe2f=sessionsOpenAi[_0x2a8622];const _0xee707d=await Message_1['default'][_0x443bdb(0x16d)]({'where':{'ticketId':_0x11c72d['id']},'order':[[_0x443bdb(0x2e6),_0x443bdb(0x17c)]],'limit':_0x3bdcfb['maxMessages']}),_0x413c86='Nas\x20respostas\x20utilize\x20o\x20nome\x20'+sanitizeName(_0x4e0331[_0x443bdb(0x18e)]||_0x443bdb(0x29a))+_0x443bdb(0x272)+_0x3bdcfb[_0x443bdb(0x299)]+'\x20tokens\x20e\x20cuide\x20para\x20não\x20truncar\x20o\x20final.\x0aSempre\x20que\x20possível,\x20mencione\x20o\x20nome\x20dele\x20para\x20ser\x20mais\x20personalizado\x20o\x20atendimento\x20e\x20mais\x20educado.\x20Quando\x20a\x20resposta\x20requer\x20uma\x20transferência\x20para\x20o\x20setor\x20de\x20atendimento,\x20comece\x20sua\x20resposta\x20com\x20\x27Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento\x27.\x0a\x0a\x20\x20'+_0x3bdcfb['prompt']+'\x0a';let _0x3f99df=[];if(_0xd8b061[_0x443bdb(0x1ae)]?.[_0x443bdb(0x210)]||_0xd8b061[_0x443bdb(0x1ae)]?.[_0x443bdb(0x2a6)]?.['text']){_0x3f99df=[],_0x3f99df[_0x443bdb(0x25b)]({'role':_0x443bdb(0x280),'content':_0x413c86});for(let _0x102f82=0x0;_0x102f82<Math[_0x443bdb(0x211)](_0x3bdcfb[_0x443bdb(0x2a8)],_0xee707d[_0x443bdb(0x172)]);_0x102f82++){const _0x175eb0=_0xee707d[_0x102f82];_0x175eb0['mediaType']===_0x443bdb(0x18b)&&(_0x175eb0[_0x443bdb(0x2ea)]?_0x3f99df[_0x443bdb(0x25b)]({'role':_0x443bdb(0x16a),'content':_0x175eb0[_0x443bdb(0x224)]}):_0x3f99df[_0x443bdb(0x25b)]({'role':'user','content':_0x175eb0[_0x443bdb(0x224)]}));}_0x3f99df[_0x443bdb(0x25b)]({'role':'user','content':_0x2b55b0});const _0x52546e=await _0x4dfe2f[_0x443bdb(0x193)]({'model':_0x443bdb(0x1a4),'messages':_0x3f99df,'max_tokens':_0x3bdcfb[_0x443bdb(0x299)],'temperature':_0x3bdcfb[_0x443bdb(0x276)]});let _0x405e3b=_0x52546e[_0x443bdb(0x15b)]['choices'][0x0][_0x443bdb(0x1ae)]?.[_0x443bdb(0x209)];_0x405e3b?.['includes'](_0x443bdb(0x24b))&&(await transferQueue(_0x3bdcfb[_0x443bdb(0x21e)],_0x11c72d,_0x4e0331),_0x405e3b=_0x405e3b[_0x443bdb(0x279)]('Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','')[_0x443bdb(0x243)]());if(_0x3bdcfb['voice']===_0x443bdb(0x26a)){const _0x10f426=await _0x94cbda[_0x443bdb(0x25e)](_0xd8b061[_0x443bdb(0x163)][_0x443bdb(0x2bd)],{'text':_0x405e3b});await(0x0,exports[_0x443bdb(0x1c4)])(_0x10f426,_0x11c72d,_0x4e0331);}else{const _0x37c90b=_0x11c72d['id']+'_'+Date['now']();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x405e3b),_0x5c70bc+'/'+_0x37c90b,_0x3bdcfb[_0x443bdb(0x1ab)],_0x3bdcfb['voiceRegion'],_0x3bdcfb[_0x443bdb(0x233)],_0x443bdb(0x220))['then'](async()=>{const _0x2f63ce=_0x443bdb;try{const _0x440a4c=await _0x94cbda['sendMessage'](_0xd8b061[_0x2f63ce(0x163)]['remoteJid'],{'audio':{'url':_0x5c70bc+'/'+_0x37c90b+_0x2f63ce(0x15d)},'mimetype':_0x2f63ce(0x190),'ptt':!![]});await(0x0,exports[_0x2f63ce(0x18f)])(_0x440a4c,_0x11c72d,_0x4e0331),deleteFileSync(_0x5c70bc+'/'+_0x37c90b+_0x2f63ce(0x15d)),deleteFileSync(_0x5c70bc+'/'+_0x37c90b+'.wav');}catch(_0x5296b2){console[_0x2f63ce(0x2a7)]('Erro\x20para\x20responder\x20com\x20audio:\x20'+_0x5296b2);}});}}else{if(_0xd8b061['message']?.[_0x443bdb(0x1cb)]){const _0x4dd119=_0xa33106[_0x443bdb(0x215)]['split']('/')[_0x443bdb(0x235)](),_0x19a4df=fs_2['default'][_0x443bdb(0x197)](_0x5c70bc+'/'+_0x4dd119),_0x4c7977=await _0x4dfe2f[_0x443bdb(0x2c7)](_0x19a4df,_0x443bdb(0x245));_0x3f99df=[],_0x3f99df[_0x443bdb(0x25b)]({'role':_0x443bdb(0x280),'content':_0x413c86});for(let _0x3e2af8=0x0;_0x3e2af8<Math[_0x443bdb(0x211)](_0x3bdcfb[_0x443bdb(0x2a8)],_0xee707d['length']);_0x3e2af8++){const _0x521cc1=_0xee707d[_0x3e2af8];_0x521cc1['mediaType']==='chat'&&(_0x521cc1[_0x443bdb(0x2ea)]?_0x3f99df[_0x443bdb(0x25b)]({'role':'assistant','content':_0x521cc1[_0x443bdb(0x224)]}):_0x3f99df['push']({'role':_0x443bdb(0x1b2),'content':_0x521cc1[_0x443bdb(0x224)]}));}_0x3f99df[_0x443bdb(0x25b)]({'role':_0x443bdb(0x1b2),'content':_0x4c7977[_0x443bdb(0x15b)][_0x443bdb(0x285)]});const _0x1bfd5b=await _0x4dfe2f[_0x443bdb(0x193)]({'model':_0x443bdb(0x1a4),'messages':_0x3f99df,'max_tokens':_0x3bdcfb[_0x443bdb(0x299)],'temperature':_0x3bdcfb[_0x443bdb(0x276)]});let _0xfc5c29=_0x1bfd5b[_0x443bdb(0x15b)][_0x443bdb(0x2d0)][0x0][_0x443bdb(0x1ae)]?.['content'];_0xfc5c29?.['includes'](_0x443bdb(0x24b))&&(await transferQueue(_0x3bdcfb[_0x443bdb(0x21e)],_0x11c72d,_0x4e0331),_0xfc5c29=_0xfc5c29[_0x443bdb(0x279)](_0x443bdb(0x24b),'')['trim']());if(_0x3bdcfb['voice']===_0x443bdb(0x26a)){const _0x3cef81=await _0x94cbda['sendMessage'](_0xd8b061[_0x443bdb(0x163)][_0x443bdb(0x2bd)],{'text':_0xfc5c29});await(0x0,exports[_0x443bdb(0x1c4)])(_0x3cef81,_0x11c72d,_0x4e0331);}else{const _0x1ab8f9=_0x11c72d['id']+'_'+Date[_0x443bdb(0x207)]();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0xfc5c29),_0x5c70bc+'/'+_0x1ab8f9,_0x3bdcfb[_0x443bdb(0x1ab)],_0x3bdcfb[_0x443bdb(0x1a0)],_0x3bdcfb[_0x443bdb(0x233)],'mp3')[_0x443bdb(0x2b2)](async()=>{const _0x9bdd1a=_0x443bdb;try{const _0x596e14=await _0x94cbda[_0x9bdd1a(0x25e)](_0xd8b061['key'][_0x9bdd1a(0x2bd)],{'audio':{'url':_0x5c70bc+'/'+_0x1ab8f9+_0x9bdd1a(0x15d)},'mimetype':'audio/mpeg','ptt':!![]});await(0x0,exports[_0x9bdd1a(0x18f)])(_0x596e14,_0x11c72d,_0x4e0331),deleteFileSync(_0x5c70bc+'/'+_0x1ab8f9+'.mp3'),deleteFileSync(_0x5c70bc+'/'+_0x1ab8f9+'.wav');}catch(_0x4e5c7a){console[_0x9bdd1a(0x2a7)](_0x9bdd1a(0x17d)+_0x4e5c7a);}});}}}_0x3f99df=[];},transferQueue=async(_0x22c195,_0x10ee36,_0x4bf57d)=>{const _0x10ab74=a615_0xeefcd9;await(0x0,UpdateTicketService_1[_0x10ab74(0x16b)])({'ticketData':{'queueId':_0x22c195},'ticketId':_0x10ee36['id'],'companyId':_0x10ee36['companyId']});},handleMessageIntegration=async(_0x337b09,_0x99ceec,_0x6dbdb8,_0x2f1a72,_0x49a969)=>{const _0x2955ad=a615_0xeefcd9,_0x4f5800=getTypeMessage(_0x337b09);if(_0x2f1a72['type']==='n8n'||_0x2f1a72['type']===_0x2955ad(0x2ab)){if(_0x2f1a72?.[_0x2955ad(0x2a3)]){const _0x5d2d12={'method':'POST','url':_0x2f1a72?.[_0x2955ad(0x2a3)],'headers':{'Content-Type':_0x2955ad(0x2dd)},'json':_0x337b09};try{request(_0x5d2d12,function(_0x49d9c4,_0x290766){const _0x21fa1e=_0x2955ad;if(_0x49d9c4)throw new Error(_0x49d9c4);else console[_0x21fa1e(0x2a7)](_0x290766[_0x21fa1e(0x224)]);});}catch(_0x51d26d){throw new Error(_0x51d26d);}}}else{if(_0x2f1a72[_0x2955ad(0x1ca)]===_0x2955ad(0x1f2)){let _0xb68384;if(_0x4f5800==='audioMessage'){let _0x538da7=_0x337b09[_0x2955ad(0x244)]+_0x2955ad(0x1e2);(0x0,fs_1['readFile'])((0x0,path_1[_0x2955ad(0x1d2)])(__dirname,'..','..','..',_0x2955ad(0x1f6),_0x2955ad(0x21a)+_0x6dbdb8,_0x538da7),_0x2955ad(0x20b),(_0x52ba74,_0x1f3d0d)=>{const _0x48f468=_0x2955ad;_0xb68384=_0x1f3d0d,_0x52ba74&&logger_1[_0x48f468(0x1e1)][_0x48f468(0x2c6)](_0x52ba74);});}else _0xb68384=undefined;const _0x280587=(0x0,Debounce_1['debounce'])(async()=>{await sendDialogflowAwswer(_0x99ceec,_0x49a969,_0x337b09,_0x49a969['contact'],_0xb68384,_0x6dbdb8,_0x2f1a72);},0x1f4,_0x49a969['id']);_0x280587();}else{if(_0x2f1a72[_0x2955ad(0x1ca)]==='typebot'){}}}};exports[a615_0xeefcd9(0x2b5)]=handleMessageIntegration;const handleMessage=async(_0x17c798,_0x1a53c7,_0x3c13e4,_0x369d40=![])=>{const _0x1bdaf8=a615_0xeefcd9;if(_0x369d40){(0x0,addLogs_1['addLogs'])({'fileName':_0x1bdaf8(0x223)+_0x1a53c7['id']+_0x1bdaf8(0x18d),'text':_0x1bdaf8(0x284)+JSON[_0x1bdaf8(0x204)](_0x17c798,null,0x2)+_0x1bdaf8(0x2b6)});let _0x3487f5=_0x17c798[_0x1bdaf8(0x163)]['id'],_0x1d8fd4=await Message_1['default'][_0x1bdaf8(0x20f)]({'where':{'wid':_0x3487f5}});if(_0x1d8fd4){await new Promise(_0x4d4c79=>setTimeout(_0x4d4c79,0x96)),console['log'](_0x1bdaf8(0x22b));return;}else await new Promise(_0x204ab8=>setTimeout(_0x204ab8,parseInt(process[_0x1bdaf8(0x16f)][_0x1bdaf8(0x226)])||0x14a));}else await new Promise(_0x2c7330=>setTimeout(_0x2c7330,i*0x28a)),i++;if(!isValidMsg(_0x17c798))return;try{let _0x676d20,_0x4e7a97,_0x236bd9=0x0,_0x3c59c7=0x0,_0x1083b0=0x0,_0x47a419=(0x0,exports[_0x1bdaf8(0x2e4)])(_0x17c798);const _0x3b2952=getTypeMessage(_0x17c798);if(_0x3b2952===_0x1bdaf8(0x293))return;const _0x1f1c51=_0x17c798[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x1cb)]||_0x17c798[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x2aa)]||_0x17c798[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x288)]||_0x17c798[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x2f0)]||_0x17c798[_0x1bdaf8(0x1ae)]['stickerMessage']||_0x17c798?.['message']?.['ephemeralMessage']?.[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x2aa)]||_0x17c798?.[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x15e)]?.['message']?.['audioMessage']||_0x17c798?.['message']?.['ephemeralMessage']?.[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x288)]||_0x17c798?.[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x15e)]?.[_0x1bdaf8(0x1ae)]?.['documentMessage']||_0x17c798?.[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x15e)]?.[_0x1bdaf8(0x1ae)]?.['stickerMessage']||_0x17c798[_0x1bdaf8(0x1ae)]?.['viewOnceMessage']?.['message']?.[_0x1bdaf8(0x2aa)]||_0x17c798[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x169)]?.[_0x1bdaf8(0x1ae)]?.['videoMessage']||_0x17c798['message']?.[_0x1bdaf8(0x15e)]?.[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x169)]?.[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x2aa)]||_0x17c798['message']?.[_0x1bdaf8(0x15e)]?.['message']?.['viewOnceMessage']?.[_0x1bdaf8(0x1ae)]?.['videoMessage']||_0x17c798[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x248)]?.[_0x1bdaf8(0x1ae)]?.['documentMessage'];if(_0x17c798[_0x1bdaf8(0x163)]['fromMe']){if(/\u200e/[_0x1bdaf8(0x253)](_0x47a419))return;if(!_0x1f1c51&&_0x3b2952!==_0x1bdaf8(0x210)&&_0x3b2952!==_0x1bdaf8(0x2a6)&&_0x3b2952!==_0x1bdaf8(0x1ef)&&_0x3b2952!==_0x1bdaf8(0x156)&&_0x3b2952!==_0x1bdaf8(0x15e)&&_0x3b2952!==_0x1bdaf8(0x293)&&_0x3b2952!=='viewOnceMessage'&&_0x3b2952!==_0x1bdaf8(0x175))return;_0x676d20=await getContactMessage(_0x17c798,_0x1a53c7);}else _0x676d20=await getContactMessage(_0x17c798,_0x1a53c7);const _0x2fff07=_0x17c798[_0x1bdaf8(0x163)]['remoteJid']?.['endsWith'](_0x1bdaf8(0x232)),_0xb1295a=await(0x0,ShowWhatsAppService_1[_0x1bdaf8(0x16b)])(_0x1a53c7['id'],_0x3c13e4);if(!_0xb1295a[_0x1bdaf8(0x2d3)]&&_0x2fff07)return;if(_0x2fff07){const _0x107ab5=await _0x1a53c7[_0x1bdaf8(0x26e)](_0x17c798['key'][_0x1bdaf8(0x2bd)]),_0x55573f={'id':_0x107ab5['id'],'name':_0x107ab5[_0x1bdaf8(0x1a2)]};_0x4e7a97=await verifyContact(_0x55573f,_0x1a53c7,_0x3c13e4);}const _0x5188d2=await verifyContact(_0x676d20,_0x1a53c7,_0x3c13e4);let _0x4e50dd=0x0,_0x2866aa=null;if(_0x17c798['key'][_0x1bdaf8(0x2ea)])await cache_1[_0x1bdaf8(0x16b)]['set']('contacts:'+_0x5188d2['id']+_0x1bdaf8(0x27b),'0');else{const _0x29bf90=await cache_1[_0x1bdaf8(0x16b)]['get'](_0x1bdaf8(0x153)+_0x5188d2['id']+_0x1bdaf8(0x27b));_0x4e50dd=+_0x29bf90+0x1,await cache_1[_0x1bdaf8(0x16b)][_0x1bdaf8(0x1df)](_0x1bdaf8(0x153)+_0x5188d2['id']+':unreads',''+_0x4e50dd);}const _0x54fc10=await CompaniesSettings_1['default'][_0x1bdaf8(0x20f)]({'where':{'companyId':_0x3c13e4}}),_0xda60b2=_0x54fc10[_0x1bdaf8(0x290)]===_0x1bdaf8(0x295),{ticket:_0xdfe907,isCreated:_0x34f545}=await(0x0,FindOrCreateTicketService_1[_0x1bdaf8(0x16b)])(_0x5188d2,_0xb1295a,_0x4e50dd,_0x3c13e4,_0x236bd9,_0x1083b0,_0x4e7a97,_0x1bdaf8(0x1e7),_0x369d40,![],_0x54fc10);_0x2866aa=_0xdfe907;if(_0x2866aa[_0x1bdaf8(0x234)]===_0x1bdaf8(0x19f)||_0x4e50dd===0x0&&_0xb1295a[_0x1bdaf8(0x25c)]&&(0x0,Mustache_1[_0x1bdaf8(0x16b)])(_0xb1295a[_0x1bdaf8(0x25c)],_0x2866aa)===_0x47a419)return;if(!_0x17c798[_0x1bdaf8(0x163)][_0x1bdaf8(0x2ea)]&&_0xb1295a?.[_0x1bdaf8(0x2cc)]>0x0){const _0x24074d=await(0x0,ShowQueueIntegrationService_1[_0x1bdaf8(0x16b)])(_0xb1295a[_0x1bdaf8(0x2cc)],_0x3c13e4);await(0x0,exports[_0x1bdaf8(0x2b5)])(_0x17c798,_0x1a53c7,_0x3c13e4,_0x24074d,_0x2866aa),await _0x2866aa['update']({'useIntegration':!![],'integrationId':_0x24074d['id']});}if(_0x3b2952===_0x1bdaf8(0x175)){const _0x5db1ae=_0x17c798[_0x1bdaf8(0x1ae)]['editedMessage'][_0x1bdaf8(0x1ae)][_0x1bdaf8(0x293)][_0x1bdaf8(0x163)]['id'],_0x3ee3eb=_0x17c798[_0x1bdaf8(0x1ae)][_0x1bdaf8(0x175)]['message'][_0x1bdaf8(0x293)][_0x1bdaf8(0x175)][_0x1bdaf8(0x210)],_0x34a381=(0x0,socket_1[_0x1bdaf8(0x26f)])();try{const _0x127b67=await Message_1[_0x1bdaf8(0x16b)][_0x1bdaf8(0x20f)]({'where':{'wid':_0x5db1ae,'companyId':_0x3c13e4,'ticketId':_0x2866aa['id']}});if(!_0x127b67)return;await _0x127b67['update']({'isEdited':!![],'body':_0x3ee3eb}),await _0x2866aa[_0x1bdaf8(0x1c0)]({'lastMessage':_0x3ee3eb}),_0x34a381['to'](_0x127b67[_0x1bdaf8(0x1f1)][_0x1bdaf8(0x230)]())[_0x1bdaf8(0x17a)](_0x1bdaf8(0x21c)+_0x127b67[_0x1bdaf8(0x2c0)]+'-appMessage',{'action':_0x1bdaf8(0x1c0),'message':_0x127b67});}catch(_0x1c4259){Sentry[_0x1bdaf8(0x217)](_0x1c4259),logger_1[_0x1bdaf8(0x1e1)][_0x1bdaf8(0x2c6)](_0x1bdaf8(0x29b)+_0x1c4259);}return;}const _0x946950=await(0x0,FindOrCreateATicketTrakingService_1[_0x1bdaf8(0x16b)])({'ticketId':_0x2866aa['id'],'companyId':_0x3c13e4,'whatsappId':_0xb1295a?.['id']});try{if(!_0x17c798[_0x1bdaf8(0x163)][_0x1bdaf8(0x2ea)]){if(_0x2866aa[_0x1bdaf8(0x234)]==='nps'&&_0x946950!==null&&(0x0,exports['verifyRating'])(_0x946950)){_0x1f1c51?await(0x0,exports[_0x1bdaf8(0x18f)])(_0x17c798,_0x2866aa,_0x5188d2):await(0x0,exports['verifyMessage'])(_0x17c798,_0x2866aa,_0x5188d2,_0x946950);if(!isNaN(parseFloat(_0x47a419))){(0x0,exports[_0x1bdaf8(0x1aa)])(parseFloat(_0x47a419),_0x2866aa,_0x946950),await _0x946950[_0x1bdaf8(0x1c0)]({'ratingAt':(0x0,moment_1[_0x1bdaf8(0x16b)])()[_0x1bdaf8(0x176)](),'finishedAt':(0x0,moment_1[_0x1bdaf8(0x16b)])()[_0x1bdaf8(0x176)](),'rated':!![]});return;}else{if(_0x2866aa[_0x1bdaf8(0x1b9)]<_0xb1295a[_0x1bdaf8(0x189)]){let _0x535f58=_0x1bdaf8(0x1cc);const _0x47e75c=await _0x1a53c7[_0x1bdaf8(0x25e)](_0x2866aa['contact']['number']+'@'+(_0x2866aa[_0x1bdaf8(0x258)]?_0x1bdaf8(0x229):_0x1bdaf8(0x257)),{'text':_0x535f58});(0x0,exports['verifyMessage'])(_0x47e75c,_0x2866aa,_0x5188d2,_0x946950),await(0x0,baileys_1[_0x1bdaf8(0x2c2)])(0x3e8);let _0x4d0c00='‎'+_0xb1295a['ratingMessage']+'\x0a';const _0x3c69ec=await(0x0,SendWhatsAppMessage_1[_0x1bdaf8(0x16b)])({'body':_0x4d0c00,'ticket':_0x2866aa});await(0x0,exports[_0x1bdaf8(0x1c4)])(_0x3c69ec,_0x2866aa,_0x2866aa[_0x1bdaf8(0x2b1)]),await _0x2866aa[_0x1bdaf8(0x1c0)]({'amountUseBotQueuesNPS':_0x2866aa['amountUseBotQueuesNPS']+0x1});}return;}}if(_0xda60b2&&_0x2866aa[_0x1bdaf8(0x234)]===_0x1bdaf8(0x28c)&&!_0x369d40){if((0x0,lodash_1['isNil'])(_0x2866aa['lgpdAcceptedAt'])&&!(0x0,lodash_1[_0x1bdaf8(0x19e)])(_0x2866aa[_0x1bdaf8(0x1ac)])){let _0x573a3e=parseFloat(_0x47a419);if(!Number[_0x1bdaf8(0x155)](_0x573a3e)&&Number['isInteger'](_0x573a3e)&&!(0x0,lodash_1[_0x1bdaf8(0x19a)])(_0x573a3e)&&_0x573a3e>0x0){if(_0x573a3e===0x1)await _0x5188d2[_0x1bdaf8(0x1c0)]({'lgpdAcceptedAt':(0x0,moment_1[_0x1bdaf8(0x16b)])()[_0x1bdaf8(0x176)]()}),await _0x2866aa[_0x1bdaf8(0x1c0)]({'lgpdAcceptedAt':(0x0,moment_1[_0x1bdaf8(0x16b)])()[_0x1bdaf8(0x176)](),'amountUsedBotQueues':0x0});else{if(_0x573a3e===0x2){if(_0xb1295a[_0x1bdaf8(0x25c)]!==''&&_0xb1295a['complationMessage']!==undefined){const _0x4c162e=await _0x1a53c7[_0x1bdaf8(0x25e)](_0x2866aa[_0x1bdaf8(0x2b1)][_0x1bdaf8(0x252)]+'@'+(_0x2866aa[_0x1bdaf8(0x258)]?_0x1bdaf8(0x229):_0x1bdaf8(0x257)),{'text':'‎'+_0xb1295a[_0x1bdaf8(0x25c)]});(0x0,exports[_0x1bdaf8(0x1c4)])(_0x4c162e,_0x2866aa,_0x5188d2,_0x946950);}await _0x2866aa['update']({'status':_0x1bdaf8(0x19f),'amountUsedBotQueues':0x0}),await _0x946950[_0x1bdaf8(0x1fa)];return;}else _0x2866aa[_0x1bdaf8(0x28b)]<_0xb1295a[_0x1bdaf8(0x1ec)]&&_0xb1295a[_0x1bdaf8(0x1ec)]>0x0&&await _0x2866aa[_0x1bdaf8(0x1c0)]({'amountUsedBotQueues':_0x2866aa['amountUsedBotQueues']+0x1,'lgpdSendMessageAt':null});}}else _0x2866aa['amountUsedBotQueues']<_0xb1295a[_0x1bdaf8(0x1ec)]&&_0xb1295a['maxUseBotQueues']>0x0&&await _0x2866aa['update']({'amountUsedBotQueues':_0x2866aa[_0x1bdaf8(0x28b)]+0x1,'lgpdSendMessageAt':null});}if((_0x5188d2[_0x1bdaf8(0x27a)]===null||_0x54fc10?.[_0x1bdaf8(0x188)]===_0x1bdaf8(0x295))&&!_0x5188d2[_0x1bdaf8(0x258)]&&(0x0,lodash_1[_0x1bdaf8(0x19e)])(_0x2866aa[_0x1bdaf8(0x1ac)])&&_0x2866aa[_0x1bdaf8(0x28b)]<=_0xb1295a[_0x1bdaf8(0x1ec)]&&!(0x0,lodash_1['isNil'])(_0x54fc10?.[_0x1bdaf8(0x255)])){_0x1f1c51?await(0x0,exports[_0x1bdaf8(0x18f)])(_0x17c798,_0x2866aa,_0x5188d2):await(0x0,exports[_0x1bdaf8(0x1c4)])(_0x17c798,_0x2866aa,_0x5188d2,_0x946950);if(!(0x0,lodash_1[_0x1bdaf8(0x19e)])(_0x54fc10?.[_0x1bdaf8(0x255)])&&_0x54fc10[_0x1bdaf8(0x255)]!==''){const _0x2ec475=(0x0,Mustache_1['default'])('‎'+_0x54fc10?.[_0x1bdaf8(0x255)],_0x2866aa),_0x4a7715=await _0x1a53c7[_0x1bdaf8(0x25e)](_0x2866aa[_0x1bdaf8(0x2b1)][_0x1bdaf8(0x252)]+'@'+(_0x2866aa[_0x1bdaf8(0x258)]?_0x1bdaf8(0x229):_0x1bdaf8(0x257)),{'text':_0x2ec475});(0x0,exports[_0x1bdaf8(0x1c4)])(_0x4a7715,_0x2866aa,_0x5188d2,_0x946950);}await(0x0,baileys_1[_0x1bdaf8(0x2c2)])(0x3e8);if(!(0x0,lodash_1['isNil'])(_0x54fc10?.[_0x1bdaf8(0x298)])&&_0x54fc10?.[_0x1bdaf8(0x298)]!==''){const _0x2281ad=(0x0,Mustache_1[_0x1bdaf8(0x16b)])('‎'+_0x54fc10?.[_0x1bdaf8(0x298)],_0x2866aa),_0x47b3e4=await _0x1a53c7[_0x1bdaf8(0x25e)](_0x2866aa[_0x1bdaf8(0x2b1)][_0x1bdaf8(0x252)]+'@'+(_0x2866aa['isGroup']?_0x1bdaf8(0x229):_0x1bdaf8(0x257)),{'text':_0x2281ad});await(0x0,exports[_0x1bdaf8(0x1c4)])(_0x47b3e4,_0x2866aa,_0x5188d2,_0x946950);};await(0x0,baileys_1[_0x1bdaf8(0x2c2)])(0x3e8);const _0x4da72e=(0x0,Mustache_1[_0x1bdaf8(0x16b)])(_0x1bdaf8(0x221),_0x2866aa),_0x5b259e=await _0x1a53c7[_0x1bdaf8(0x25e)](_0x2866aa['contact']['number']+'@'+(_0x2866aa[_0x1bdaf8(0x258)]?_0x1bdaf8(0x229):_0x1bdaf8(0x257)),{'text':_0x4da72e});await(0x0,exports[_0x1bdaf8(0x1c4)])(_0x5b259e,_0x2866aa,_0x5188d2,_0x946950),await _0x2866aa[_0x1bdaf8(0x1c0)]({'lgpdSendMessageAt':(0x0,moment_1[_0x1bdaf8(0x16b)])()['toDate'](),'amountUsedBotQueues':_0x2866aa[_0x1bdaf8(0x28b)]+0x1}),await _0x2866aa[_0x1bdaf8(0x151)]();return;};if(!(0x0,lodash_1[_0x1bdaf8(0x19e)])(_0x2866aa[_0x1bdaf8(0x1ac)])&&(0x0,lodash_1[_0x1bdaf8(0x19e)])(_0x2866aa['lgpdAcceptedAt']))return;}}}catch(_0x1d2e81){Sentry[_0x1bdaf8(0x217)](_0x1d2e81),console['log'](_0x1d2e81);}const _0x4c1149=_0x17c798[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x2a6)]?.[_0x1bdaf8(0x249)]?.[_0x1bdaf8(0x23c)]||_0x17c798[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x2aa)]?.[_0x1bdaf8(0x249)]?.[_0x1bdaf8(0x23c)]||_0x17c798['message']?.['audioMessage']?.[_0x1bdaf8(0x249)]?.[_0x1bdaf8(0x23c)]||_0x17c798['message']?.['videoMessage']?.[_0x1bdaf8(0x249)]?.[_0x1bdaf8(0x23c)]||_0x17c798[_0x1bdaf8(0x1ae)]?.[_0x1bdaf8(0x2f0)]?.[_0x1bdaf8(0x249)]?.[_0x1bdaf8(0x23c)];let _0x137874;_0x1f1c51?_0x137874=await(0x0,exports[_0x1bdaf8(0x18f)])(_0x17c798,_0x2866aa,_0x5188d2,_0x946950,_0x4c1149):await(0x0,exports[_0x1bdaf8(0x1c4)])(_0x17c798,_0x2866aa,_0x5188d2,_0x946950,![],_0x4c1149);try{await _0x2866aa['update']({'fromMe':_0x17c798[_0x1bdaf8(0x163)][_0x1bdaf8(0x2ea)]});}catch(_0x5672e6){Sentry[_0x1bdaf8(0x217)](_0x5672e6),console[_0x1bdaf8(0x2a7)](_0x5672e6);}let _0x5f5082;if(_0x54fc10[_0x1bdaf8(0x171)]==='company')_0x5f5082=await(0x0,VerifyCurrentSchedule_1['default'])(_0x3c13e4,0x0,0x0);else _0x54fc10[_0x1bdaf8(0x171)]==='connection'&&(_0x5f5082=await(0x0,VerifyCurrentSchedule_1[_0x1bdaf8(0x16b)])(_0x3c13e4,0x0,_0xb1295a['id']));try{if(!_0x17c798['key']['fromMe']&&_0x54fc10[_0x1bdaf8(0x171)]&&(!_0x2866aa[_0x1bdaf8(0x258)]||_0xb1295a[_0x1bdaf8(0x2c8)]===_0x1bdaf8(0x295))){if((_0x54fc10['scheduleType']===_0x1bdaf8(0x21a)||_0x54fc10[_0x1bdaf8(0x171)]===_0x1bdaf8(0x28d))&&!(0x0,lodash_1[_0x1bdaf8(0x19e)])(_0x5f5082)&&(!_0x5f5082||_0x5f5082[_0x1bdaf8(0x237)]===![])){_0x946950[_0x1bdaf8(0x17e)]===null&&await _0x946950[_0x1bdaf8(0x1c0)]({'chatbotAt':(0x0,moment_1[_0x1bdaf8(0x16b)])()[_0x1bdaf8(0x176)]()});if(_0xb1295a[_0x1bdaf8(0x1ec)]&&_0xb1295a[_0x1bdaf8(0x1ec)]!==0x0&&_0x2866aa[_0x1bdaf8(0x28b)]>=_0xb1295a['maxUseBotQueues'])return;let _0x4aad32=new Date(),_0x2c394a=new Date();if(_0x946950[_0x1bdaf8(0x17e)]!==null){_0x4aad32['setMinutes'](_0x946950['chatbotAt']['getMinutes']()+Number(_0xb1295a[_0x1bdaf8(0x1d6)]));if(_0x946950[_0x1bdaf8(0x17e)]!==null&&_0x2c394a<_0x4aad32&&_0xb1295a[_0x1bdaf8(0x1d6)]!=='0'&&_0x2866aa[_0x1bdaf8(0x28b)]!==0x0)return;}await _0x946950['update']({'chatbotAt':null});if(_0xb1295a['outOfHoursMessage']!==''){const _0xe4c355=(0x0,Mustache_1['default'])(''+_0xb1295a[_0x1bdaf8(0x256)],_0x2866aa),_0x56ebeb=(0x0,Debounce_1[_0x1bdaf8(0x23b)])(async()=>{const _0x4a36d7=_0x1bdaf8;await _0x1a53c7[_0x4a36d7(0x25e)](_0x2866aa[_0x4a36d7(0x2b1)][_0x4a36d7(0x252)]+'@'+(_0x2866aa[_0x4a36d7(0x258)]?_0x4a36d7(0x229):'s.whatsapp.net'),{'text':_0xe4c355});},0x3e8,_0x2866aa['id']);_0x56ebeb(),await _0x2866aa[_0x1bdaf8(0x1c0)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x2866aa[_0x1bdaf8(0x28b)]+0x1});return;}await _0x2866aa[_0x1bdaf8(0x1c0)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x2866aa[_0x1bdaf8(0x28b)]+0x1});return;}}}catch(_0x2483d0){Sentry['captureException'](_0x2483d0),console[_0x1bdaf8(0x2a7)](_0x2483d0);}!_0x2866aa[_0x1bdaf8(0x2b3)]&&!_0x2866aa['queue']&&!_0x2fff07&&!_0x17c798['key'][_0x1bdaf8(0x2ea)]&&!_0x2866aa[_0x1bdaf8(0x283)]&&!(0x0,lodash_1[_0x1bdaf8(0x19e)])(_0xb1295a[_0x1bdaf8(0x273)])&&await handleOpenAi(_0x17c798,_0x1a53c7,_0x2866aa,_0x5188d2,_0x137874);if(!_0x17c798[_0x1bdaf8(0x163)]['fromMe']&&(!_0x2866aa[_0x1bdaf8(0x258)]||_0xb1295a[_0x1bdaf8(0x2c8)]==='enabled')&&_0x2866aa[_0x1bdaf8(0x1b4)]&&_0x2866aa[_0x1bdaf8(0x2cc)]&&_0x2866aa[_0x1bdaf8(0x269)]){const _0x933221=await(0x0,ShowQueueIntegrationService_1[_0x1bdaf8(0x16b)])(_0x2866aa[_0x1bdaf8(0x2cc)],_0x3c13e4);await(0x0,exports['handleMessageIntegration'])(_0x17c798,_0x1a53c7,_0x3c13e4,_0x933221,_0x2866aa);return;}!_0x2866aa[_0x1bdaf8(0x2b3)]&&!_0x2866aa[_0x1bdaf8(0x1b4)]&&(!_0x2866aa['isGroup']||_0xb1295a[_0x1bdaf8(0x2c8)]===_0x1bdaf8(0x295))&&!_0x17c798[_0x1bdaf8(0x163)][_0x1bdaf8(0x2ea)]&&!_0x2866aa[_0x1bdaf8(0x283)]&&_0xb1295a[_0x1bdaf8(0x238)][_0x1bdaf8(0x172)]>=0x1&&(await verifyQueue(_0x1a53c7,_0x17c798,_0x2866aa,_0x5188d2,_0x54fc10),_0x946950[_0x1bdaf8(0x17e)]===null&&await _0x946950[_0x1bdaf8(0x1c0)]({'chatbotAt':(0x0,moment_1[_0x1bdaf8(0x16b)])()[_0x1bdaf8(0x176)]()}));_0x2866aa[_0x1bdaf8(0x21e)]>0x0&&await _0x946950[_0x1bdaf8(0x1c0)]({'queueId':_0x2866aa[_0x1bdaf8(0x21e)]});if((getTypeMessage(_0x17c798)==='audioMessage'||getTypeMessage(_0x17c798)==='videoMessage')&&!_0x17c798[_0x1bdaf8(0x163)][_0x1bdaf8(0x2ea)]&&(!_0x2866aa[_0x1bdaf8(0x258)]||_0xb1295a[_0x1bdaf8(0x2c8)]==='enabled')&&(!_0x5188d2?.[_0x1bdaf8(0x1da)]||_0x54fc10?.['acceptAudioMessageContact']===_0x1bdaf8(0x287))){const _0x27ff04=await _0x1a53c7[_0x1bdaf8(0x25e)](_0x5188d2[_0x1bdaf8(0x252)]+'@c.us',{'text':_0x1bdaf8(0x251)},{'quoted':{'key':_0x17c798[_0x1bdaf8(0x163)],'message':{'extendedTextMessage':_0x17c798['message']['extendedTextMessage']}}});await(0x0,exports[_0x1bdaf8(0x1c4)])(_0x27ff04,_0x2866aa,_0x5188d2,_0x946950);}try{if(!_0x17c798[_0x1bdaf8(0x163)][_0x1bdaf8(0x2ea)]&&_0x54fc10?.[_0x1bdaf8(0x171)]&&_0x2866aa[_0x1bdaf8(0x21e)]!==null&&(!_0x2866aa[_0x1bdaf8(0x258)]||_0xb1295a[_0x1bdaf8(0x2c8)]===_0x1bdaf8(0x295))){const _0x584453=await Queue_1['default'][_0x1bdaf8(0x242)](_0x2866aa[_0x1bdaf8(0x21e)]);_0x54fc10?.['scheduleType']==='queue'&&(_0x5f5082=await(0x0,VerifyCurrentSchedule_1['default'])(_0x3c13e4,_0x584453['id'],0x0));if(_0x54fc10?.['scheduleType']===_0x1bdaf8(0x1b4)&&!(0x0,lodash_1[_0x1bdaf8(0x19e)])(_0x5f5082)&&(!_0x5f5082||_0x5f5082[_0x1bdaf8(0x237)]===![])){const _0x2c2cf8=_0x584453[_0x1bdaf8(0x256)];if(_0x2c2cf8!==''){const _0x24b95d=(0x0,Mustache_1[_0x1bdaf8(0x16b)])(''+_0x2c2cf8,_0x2866aa),_0x881901=(0x0,Debounce_1[_0x1bdaf8(0x23b)])(async()=>{const _0x3182dc=_0x1bdaf8;await _0x1a53c7[_0x3182dc(0x25e)](_0x2866aa[_0x3182dc(0x2b1)][_0x3182dc(0x252)]+'@'+(_0x2866aa['isGroup']?_0x3182dc(0x229):_0x3182dc(0x257)),{'text':_0x24b95d});},0x3e8,_0x2866aa['id']);_0x881901(),await _0x2866aa[_0x1bdaf8(0x1c0)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x2866aa[_0x1bdaf8(0x28b)]+0x1});return;}await _0x2866aa[_0x1bdaf8(0x1c0)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x2866aa[_0x1bdaf8(0x28b)]+0x1});return;}}}catch(_0x557f5c){Sentry[_0x1bdaf8(0x217)](_0x557f5c),console[_0x1bdaf8(0x2a7)](_0x557f5c);}_0x2866aa[_0x1bdaf8(0x1b4)]&&_0x2866aa[_0x1bdaf8(0x21e)]&&!_0x17c798['key']['fromMe']&&((!_0x2866aa['user']||_0x2866aa[_0x1bdaf8(0x1b4)]?.[_0x1bdaf8(0x1eb)]?.[_0x1bdaf8(0x172)]>0x0)&&await(0x0,ChatBotListener_1[_0x1bdaf8(0x18c)])(_0x2866aa[_0x1bdaf8(0x21e)],_0x1a53c7,_0x2866aa,_0x5188d2,_0x17c798),await _0x2866aa[_0x1bdaf8(0x1c0)]({'sendInactiveMessage':![]})),await _0x2866aa[_0x1bdaf8(0x151)]();}catch(_0x3e14d4){Sentry[_0x1bdaf8(0x217)](_0x3e14d4),console['log'](_0x3e14d4),logger_1[_0x1bdaf8(0x1e1)][_0x1bdaf8(0x2c6)](_0x1bdaf8(0x1ba)+_0x3e14d4);}};function a615_0x5e6b(_0x138307,_0x270439){const _0x1a6694=a615_0x1a66();return a615_0x5e6b=function(_0x5e6b87,_0x6eb6fa){_0x5e6b87=_0x5e6b87-0x151;let _0x2e7d60=_0x1a6694[_0x5e6b87];return _0x2e7d60;},a615_0x5e6b(_0x138307,_0x270439);}exports['handleMessage']=handleMessage;const handleMsgAck=async(_0x517fcb,_0x31e9a6)=>{const _0x4f79ff=a615_0xeefcd9;await new Promise(_0xdc7234=>setTimeout(_0xdc7234,0x1f4));const _0xd1fe25=(0x0,socket_1['getIO'])();try{const _0x5e656f=await Message_1[_0x4f79ff(0x16b)][_0x4f79ff(0x20f)]({'where':{'wid':_0x517fcb[_0x4f79ff(0x163)]['id']},'include':[_0x4f79ff(0x2b1),{'model':Message_1['default'],'as':_0x4f79ff(0x181),'include':[_0x4f79ff(0x2b1)]}]});if(!_0x5e656f)return;await _0x5e656f[_0x4f79ff(0x1c0)]({'ack':_0x31e9a6}),_0xd1fe25['to'](_0x5e656f[_0x4f79ff(0x1f1)][_0x4f79ff(0x230)]())['emit']('company-'+_0x5e656f['companyId']+'-appMessage',{'action':'update','message':_0x5e656f});}catch(_0x538076){Sentry[_0x4f79ff(0x217)](_0x538076),logger_1['logger'][_0x4f79ff(0x2c6)](_0x4f79ff(0x29b)+_0x538076);}},verifyRecentCampaign=async(_0x59b682,_0x2706a5)=>{const _0x5a848a=a615_0xeefcd9;if(!isValidMsg(_0x59b682))return;if(!_0x59b682['key'][_0x5a848a(0x2ea)]){const _0x1a875f=_0x59b682[_0x5a848a(0x163)][_0x5a848a(0x2bd)][_0x5a848a(0x279)](/\D/g,''),_0x20e4d1=await Campaign_1[_0x5a848a(0x16b)]['findAll']({'where':{'companyId':_0x2706a5,'status':'EM_ANDAMENTO','confirmation':!![]}});if(_0x20e4d1){const _0x3af1f4=_0x20e4d1['map'](_0x18ce86=>_0x18ce86['id']),_0x37bc21=await CampaignShipping_1[_0x5a848a(0x16b)][_0x5a848a(0x20f)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x3af1f4},'number':_0x1a875f,'confirmation':null}});_0x37bc21&&(await _0x37bc21[_0x5a848a(0x1c0)]({'confirmedAt':(0x0,moment_1['default'])(),'confirmation':!![]}),await queues_1['campaignQueue'][_0x5a848a(0x2d7)](_0x5a848a(0x250),{'campaignShippingId':_0x37bc21['id'],'campaignId':_0x37bc21[_0x5a848a(0x2ed)]},{'delay':(0x0,queues_1[_0x5a848a(0x2d2)])((0x0,queues_1['randomValue'])(0x0,0xa))}));}}},verifyCampaignMessageAndCloseTicket=async(_0x3f60d2,_0x4ad03e,_0x425c3e)=>{const _0x406e51=a615_0xeefcd9;if(!isValidMsg(_0x3f60d2))return;let _0x584b13;_0x584b13=await getContactMessage(_0x3f60d2,_0x425c3e);const _0x597ed0=await verifyContact(_0x584b13,_0x425c3e,_0x4ad03e),_0x5a815b=(0x0,socket_1[_0x406e51(0x26f)])(),_0x1820af=await(0x0,exports[_0x406e51(0x2e4)])(_0x3f60d2),_0x5e20c0=/\u200c/[_0x406e51(0x253)](_0x1820af);if(_0x3f60d2[_0x406e51(0x163)]['fromMe']&&_0x5e20c0){const _0x1ba9af=await Message_1[_0x406e51(0x16b)][_0x406e51(0x20f)]({'where':{[sequelize_1['Op']['or']]:[{'wid':_0x3f60d2[_0x406e51(0x163)]['id']},{'contactId':_0x597ed0['id']}],'companyId':_0x4ad03e}});if(!(0x0,lodash_1[_0x406e51(0x19a)])(_0x1ba9af)||!(0x0,lodash_1[_0x406e51(0x19e)])(_0x1ba9af)||_0x1ba9af!==null){const _0x121494=await Ticket_1[_0x406e51(0x16b)][_0x406e51(0x242)](_0x1ba9af['ticketId']);await _0x121494['update']({'status':_0x406e51(0x19f),'amountUsedBotQueues':0x0,'amountUseOutOfHours':0x0}),_0x5a815b['to'](_0x406e51(0x16e))['emit'](_0x406e51(0x21c)+_0x4ad03e+'-ticket',{'action':_0x406e51(0x2a9),'ticket':_0x121494,'ticketId':_0x121494['id']}),_0x5a815b['to'](_0x121494[_0x406e51(0x234)])['to'](_0x121494['id'][_0x406e51(0x230)]())[_0x406e51(0x17a)]('company-'+_0x4ad03e+_0x406e51(0x263),{'action':_0x406e51(0x1c0),'ticket':_0x121494,'ticketId':_0x121494['id']});}}},filterMessages=_0x30828f=>{const _0x5b0877=a615_0xeefcd9;if(_0x30828f[_0x5b0877(0x1ae)]?.[_0x5b0877(0x293)])return![];if([baileys_1['WAMessageStubType'][_0x5b0877(0x2c1)],baileys_1['WAMessageStubType'][_0x5b0877(0x292)],baileys_1[_0x5b0877(0x23e)]['E2E_IDENTITY_CHANGED'],baileys_1['WAMessageStubType'][_0x5b0877(0x2ac)]]['includes'](_0x30828f[_0x5b0877(0x274)]))return![];return!![];},wbotMessageListener=(_0x5b5a3c,_0x1ecd07)=>{const _0x51ab36=a615_0xeefcd9;_0x5b5a3c['ev']['on'](_0x51ab36(0x271),async _0x20b112=>{const _0x4f8385=_0x51ab36,_0x278c1c=_0x20b112[_0x4f8385(0x2dc)][_0x4f8385(0x18a)](filterMessages)[_0x4f8385(0x19c)](_0x5cb43b=>_0x5cb43b);if(!_0x278c1c)return;_0x278c1c['forEach'](async _0x15d4d5=>{const _0x183569=_0x4f8385,_0x8c5d73=await Message_1[_0x183569(0x16b)]['count']({'where':{'wid':_0x15d4d5[_0x183569(0x163)]['id'],'companyId':_0x1ecd07}});if(!_0x8c5d73){let _0x400df5=![],_0xf94154=await(0x0,exports[_0x183569(0x2e4)])(_0x15d4d5);const _0x22bbc0=_0x15d4d5?.[_0x183569(0x163)]?.[_0x183569(0x2ea)];if(_0x22bbc0)_0x400df5=/\u200c/['test'](_0xf94154);else{if(/\u200c/['test'](_0xf94154))_0xf94154=_0xf94154[_0x183569(0x279)](/\u200c/,'');logger_1['logger'][_0x183569(0x1a7)](_0x183569(0x297)+_0xf94154);}if(!_0x400df5){await handleMessage(_0x15d4d5,_0x5b5a3c,_0x1ecd07);return;}await verifyRecentCampaign(_0x15d4d5,_0x1ecd07),await verifyCampaignMessageAndCloseTicket(_0x15d4d5,_0x1ecd07,_0x5b5a3c);}_0x15d4d5['key']['remoteJid']?.[_0x183569(0x2a5)]('@g.us')&&handleMsgAck(_0x15d4d5,0x2);});}),_0x5b5a3c['ev']['on'](_0x51ab36(0x1b1),_0x3217d1=>{const _0x46d73d=_0x51ab36;if(_0x3217d1[_0x46d73d(0x172)]===0x0)return;_0x3217d1[_0x46d73d(0x192)](async _0x2d9972=>{const _0x1dd686=_0x46d73d;_0x5b5a3c[_0x1dd686(0x1ad)]([_0x2d9972['key']]);const _0x42cf00={..._0x3217d1};_0x42cf00['0']?.[_0x1dd686(0x1c0)][_0x1dd686(0x274)]===0x1&&_0x42cf00['0']?.['key'][_0x1dd686(0x2bd)]!==_0x1dd686(0x2eb)&&(0x0,MarkDeleteWhatsAppMessage_1[_0x1dd686(0x16b)])(_0x42cf00['0']?.['key'][_0x1dd686(0x2bd)],null,_0x42cf00['0']?.['key']['id'],_0x1ecd07);let _0x3c1247;_0x2d9972[_0x1dd686(0x1c0)][_0x1dd686(0x234)]===0x3&&_0x2d9972?.[_0x1dd686(0x163)]?.[_0x1dd686(0x2ea)]?_0x3c1247=0x2:_0x3c1247=_0x2d9972[_0x1dd686(0x1c0)]['status'],handleMsgAck(_0x2d9972,_0x3c1247);});}),_0x5b5a3c['ev']['on'](_0x51ab36(0x154),_0x4d0a06=>{const _0x36005e=_0x51ab36;if(_0x4d0a06[_0x36005e(0x172)]===0x0)return;_0x4d0a06[_0x36005e(0x192)](async _0x3f0b1c=>{const _0x16a142=_0x36005e,_0x5b7356=_0x3f0b1c['id']['replace'](/\D/g,''),_0x5a2c98=_0x3f0b1c[_0x16a142(0x1a2)]||_0x5b7356;let _0x188da9;try{_0x188da9=await _0x5b5a3c['profilePictureUrl'](_0x3f0b1c['id'],'image');}catch(_0x571b44){Sentry[_0x16a142(0x217)](_0x571b44),_0x188da9=process['env'][_0x16a142(0x22f)]+'/nopicture.png';}const _0x93fa31={'name':_0x5a2c98,'number':_0x5b7356,'isGroup':!![],'companyId':_0x1ecd07,'remoteJid':_0x3f0b1c['id'],'profilePicUrl':_0x188da9},_0x54dc5b=await(0x0,CreateOrUpdateContactService_1[_0x16a142(0x16b)])(_0x93fa31);});});};exports[a615_0xeefcd9(0x277)]=wbotMessageListener;