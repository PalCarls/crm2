'use strict';const a533_0x224ed2=a533_0x1c65;(function(_0x418eb1,_0x5d14a7){const _0x32ae66=a533_0x1c65,_0x1ba2c8=_0x418eb1();while(!![]){try{const _0x2ceb00=parseInt(_0x32ae66(0x201))/0x1*(-parseInt(_0x32ae66(0x1fc))/0x2)+-parseInt(_0x32ae66(0xf1))/0x3*(-parseInt(_0x32ae66(0x12f))/0x4)+-parseInt(_0x32ae66(0x108))/0x5+parseInt(_0x32ae66(0x10a))/0x6*(parseInt(_0x32ae66(0x11b))/0x7)+-parseInt(_0x32ae66(0x1ba))/0x8+parseInt(_0x32ae66(0x15b))/0x9+parseInt(_0x32ae66(0x1cb))/0xa*(parseInt(_0x32ae66(0x129))/0xb);if(_0x2ceb00===_0x5d14a7)break;else _0x1ba2c8['push'](_0x1ba2c8['shift']());}catch(_0x5b37a0){_0x1ba2c8['push'](_0x1ba2c8['shift']());}}}(a533_0x24bc,0x81e18));var __createBinding=this&&this[a533_0x224ed2(0x1f2)]||(Object[a533_0x224ed2(0x1f5)]?function(_0x598e46,_0x16e59b,_0xdb04a,_0x17fb46){const _0x3aef36=a533_0x224ed2;if(_0x17fb46===undefined)_0x17fb46=_0xdb04a;var _0x23e593=Object[_0x3aef36(0x1af)](_0x16e59b,_0xdb04a);(!_0x23e593||(_0x3aef36(0x1b4)in _0x23e593?!_0x16e59b[_0x3aef36(0x12b)]:_0x23e593['writable']||_0x23e593['configurable']))&&(_0x23e593={'enumerable':!![],'get':function(){return _0x16e59b[_0xdb04a];}}),Object[_0x3aef36(0x142)](_0x598e46,_0x17fb46,_0x23e593);}:function(_0x1c0794,_0x51b626,_0x438029,_0x2a5d0b){if(_0x2a5d0b===undefined)_0x2a5d0b=_0x438029;_0x1c0794[_0x2a5d0b]=_0x51b626[_0x438029];}),__setModuleDefault=this&&this[a533_0x224ed2(0x1b2)]||(Object[a533_0x224ed2(0x1f5)]?function(_0x5cc785,_0x571a98){const _0x37c2c8=a533_0x224ed2;Object['defineProperty'](_0x5cc785,_0x37c2c8(0x115),{'enumerable':!![],'value':_0x571a98});}:function(_0x2c6201,_0x5ea4cc){const _0x2b57e6=a533_0x224ed2;_0x2c6201[_0x2b57e6(0x115)]=_0x5ea4cc;}),__importStar=this&&this[a533_0x224ed2(0x175)]||function(_0x1b6d2c){const _0x2cc509=a533_0x224ed2;if(_0x1b6d2c&&_0x1b6d2c['__esModule'])return _0x1b6d2c;var _0x1f67c8={};if(_0x1b6d2c!=null){for(var _0x58b92d in _0x1b6d2c)if(_0x58b92d!==_0x2cc509(0x115)&&Object[_0x2cc509(0x196)][_0x2cc509(0x120)][_0x2cc509(0xf0)](_0x1b6d2c,_0x58b92d))__createBinding(_0x1f67c8,_0x1b6d2c,_0x58b92d);}return __setModuleDefault(_0x1f67c8,_0x1b6d2c),_0x1f67c8;},__importDefault=this&&this['__importDefault']||function(_0x27b1d0){const _0x58ea92=a533_0x224ed2;return _0x27b1d0&&_0x27b1d0[_0x58ea92(0x12b)]?_0x27b1d0:{'default':_0x27b1d0};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a533_0x224ed2(0x125)]=exports[a533_0x224ed2(0x17d)]=exports[a533_0x224ed2(0x14a)]=exports[a533_0x224ed2(0x1e3)]=exports['verifyRating']=exports[a533_0x224ed2(0xfc)]=exports[a533_0x224ed2(0x181)]=exports[a533_0x224ed2(0x1b5)]=exports[a533_0x224ed2(0x174)]=void 0x0;const path_1=__importStar(require('path')),util_1=require('util'),fs_1=require('fs'),fs_2=__importDefault(require('fs')),Sentry=__importStar(require(a533_0x224ed2(0x177))),lodash_1=require('lodash'),baileys_1=require('@whiskeysockets/baileys'),Contact_1=__importDefault(require(a533_0x224ed2(0xef))),Ticket_1=__importDefault(require(a533_0x224ed2(0x1ea))),Message_1=__importDefault(require(a533_0x224ed2(0x1d5))),socket_1=require(a533_0x224ed2(0x12d)),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),logger_1=require('../../utils/logger'),CreateOrUpdateContactService_1=__importDefault(require('../ContactServices/CreateOrUpdateContactService')),FindOrCreateTicketService_1=__importDefault(require(a533_0x224ed2(0x1d9))),ShowWhatsAppService_1=__importDefault(require(a533_0x224ed2(0x1f4))),Debounce_1=require(a533_0x224ed2(0x194)),UpdateTicketService_1=__importDefault(require(a533_0x224ed2(0x14e))),Mustache_1=__importDefault(require(a533_0x224ed2(0x102))),UserRating_1=__importDefault(require(a533_0x224ed2(0x13b))),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),sendFacebookMessage_1=__importDefault(require(a533_0x224ed2(0x20f))),moment_1=__importDefault(require(a533_0x224ed2(0x144))),Queue_1=__importDefault(require('../../models/Queue')),FindOrCreateATicketTrakingService_1=__importDefault(require(a533_0x224ed2(0xf7))),VerifyCurrentSchedule_1=__importDefault(require(a533_0x224ed2(0x1f1))),Campaign_1=__importDefault(require(a533_0x224ed2(0x1ac))),CampaignShipping_1=__importDefault(require(a533_0x224ed2(0x1fe))),sequelize_1=require('sequelize'),queues_1=require('../../queues'),User_1=__importDefault(require('../../models/User')),Setting_1=__importDefault(require('../../models/Setting')),ChatBotListener_1=require(a533_0x224ed2(0x180)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a533_0x224ed2(0x136))),ListUserQueueServices_1=__importDefault(require(a533_0x224ed2(0x164))),cache_1=require(a533_0x224ed2(0x17f)),ListSettingsService_1=__importDefault(require(a533_0x224ed2(0x1dc)));let i=0x0;setInterval(()=>{i=0x0;},0x1388);const writeFileAsync=(0x0,util_1[a533_0x224ed2(0x18e)])(fs_1[a533_0x224ed2(0x184)]);function removeFile(_0x1fdb5a){const _0x1f4751=a533_0x224ed2;fs_2[_0x1f4751(0x115)]['unlink'](_0x1fdb5a,_0x506585=>{if(_0x506585)throw _0x506585;});}const getTimestampMessage=_0x3eaf77=>{return _0x3eaf77*0x1;},multVecardGet=function(_0x52b25d){const _0x24ab4a=a533_0x224ed2;let _0x1edf1f='\x20',_0x436ac2=_0x52b25d[_0x24ab4a(0x1d1)]('\x0a')[0x2]['replace'](';;;','\x0a')[_0x24ab4a(0x1bf)]('N:','')['replace'](';','')[_0x24ab4a(0x1bf)](';','\x20')[_0x24ab4a(0x1bf)](';;','\x20')[_0x24ab4a(0x1bf)]('\x0a',''),_0x43c06a=_0x52b25d[_0x24ab4a(0x1d1)]('\x0a')[0x4][_0x24ab4a(0x17b)]('='),_0x3e5d8a=_0x52b25d['split']('\x0a')[0x4][_0x24ab4a(0x17b)](':'),_0x393a47=_0x52b25d[_0x24ab4a(0x1d1)]('\x0a')[0x4][_0x24ab4a(0x134)](_0x43c06a+0x1,_0x3e5d8a)[_0x24ab4a(0x1bf)](';',''),_0x12f8e6=_0x52b25d['split']('\x0a')[0x4][_0x24ab4a(0x1bf)]('item1.TEL:','');if(_0x393a47!=_0x24ab4a(0x1d4))_0x1edf1f=_0x1edf1f+_0x436ac2+':\x20📞'+_0x393a47+''+'\x0a';else _0x1edf1f=_0x1edf1f+_0x436ac2+_0x24ab4a(0x191)+_0x12f8e6+''+'\x0a';return _0x1edf1f;},contactsArrayMessageGet=_0x581c03=>{const _0xa0f7e8=a533_0x224ed2;let _0x2296e9=_0x581c03[_0xa0f7e8(0x1c7)]?.['contactsArrayMessage']?.[_0xa0f7e8(0x18c)],_0x320b31=_0x2296e9['map'](function(_0x4ef130,_0x2a88d5){const _0x540596=_0xa0f7e8;return _0x4ef130[_0x540596(0x1de)];}),_0x3199ed='';_0x320b31['forEach'](function(_0x356d28,_0xc8e2ec){_0x3199ed+=_0x356d28+'\x0a\x0a'+'';});let _0x59fe70=_0x3199ed['split']('BEGIN:');_0x59fe70[_0xa0f7e8(0x128)]();let _0xda32bd='';for(let _0x1e20a1 of _0x59fe70){_0xda32bd=_0xda32bd+multVecardGet(_0x1e20a1);}return _0xda32bd;},getTypeMessage=_0x13b151=>{const _0x2c34b1=a533_0x224ed2,_0x72655d=(0x0,baileys_1[_0x2c34b1(0x159)])(_0x13b151[_0x2c34b1(0x1c7)]);if(_0x13b151[_0x2c34b1(0x1c7)]?.[_0x2c34b1(0x1fb)])return _0x2c34b1(0x1fb);return _0x72655d;},getBodyButton=_0x173bb7=>{const _0x139337=a533_0x224ed2;if(_0x173bb7['key'][_0x139337(0x19b)]&&_0x173bb7[_0x139337(0x1c7)][_0x139337(0x16c)]?.[_0x139337(0xfd)]){let _0x2dc208=''+_0x173bb7?.[_0x139337(0x1c7)]?.[_0x139337(0x16c)]?.['contentText'];for(const _0xe90a9f of _0x173bb7[_0x139337(0x1c7)]?.['buttonsMessage']?.[_0x139337(0x139)]){_0x2dc208+='\x0a\x0a'+_0xe90a9f[_0x139337(0x1ab)]?.[_0x139337(0x148)];}return _0x2dc208;}if(_0x173bb7['key'][_0x139337(0x19b)]&&_0x173bb7?.['message']?.[_0x139337(0x1b0)]?.['message']?.[_0x139337(0x1ef)]){let _0x457f6b=''+_0x173bb7?.[_0x139337(0x1c7)]?.[_0x139337(0x1b0)]?.['message']?.[_0x139337(0x1ef)]?.[_0x139337(0x1bb)];for(const _0x44c8b2 of _0x173bb7['message']?.[_0x139337(0x1b0)]?.[_0x139337(0x1c7)]?.['listMessage']?.[_0x139337(0x19f)]){for(const _0x910bb6 of _0x44c8b2['rows']){_0x457f6b+='\x0a\x0a'+_0x910bb6[_0x139337(0x10f)];}}return _0x457f6b;}},getBodyList=_0x2f240a=>{const _0x4bfb5b=a533_0x224ed2;if(_0x2f240a['key'][_0x4bfb5b(0x19b)]&&_0x2f240a['message'][_0x4bfb5b(0x1ef)]?.['description']){let _0x208de2=''+_0x2f240a['message'][_0x4bfb5b(0x1ef)]?.['description'];for(const _0x1dea31 of _0x2f240a[_0x4bfb5b(0x1c7)][_0x4bfb5b(0x1ef)]?.[_0x4bfb5b(0x19f)]){for(const _0x5baf71 of _0x1dea31[_0x4bfb5b(0x11f)]){_0x208de2+='\x0a\x0a'+_0x5baf71[_0x4bfb5b(0x10f)];}}return _0x208de2;}if(_0x2f240a['key'][_0x4bfb5b(0x19b)]&&_0x2f240a?.[_0x4bfb5b(0x1c7)]?.[_0x4bfb5b(0x1b0)]?.[_0x4bfb5b(0x1c7)]?.['listMessage']){let _0x148c2e=''+_0x2f240a?.[_0x4bfb5b(0x1c7)]?.[_0x4bfb5b(0x1b0)]?.['message']?.[_0x4bfb5b(0x1ef)]?.[_0x4bfb5b(0x1bb)];for(const _0x31c251 of _0x2f240a[_0x4bfb5b(0x1c7)]?.['viewOnceMessage']?.[_0x4bfb5b(0x1c7)]?.['listMessage']?.[_0x4bfb5b(0x19f)]){for(const _0x497029 of _0x31c251[_0x4bfb5b(0x11f)]){_0x148c2e+='\x0a\x0a'+_0x497029[_0x4bfb5b(0x10f)];}}return _0x148c2e;}},msgLocation=(_0x4bbae5,_0x5df8ce,_0x1e993f)=>{const _0x26cc04=a533_0x224ed2;if(_0x4bbae5){var _0x12f285=Buffer[_0x26cc04(0x135)](_0x4bbae5)[_0x26cc04(0x149)](_0x26cc04(0x1db));let _0x30377a=_0x26cc04(0x105)+_0x12f285+_0x26cc04(0xf9)+_0x5df8ce+_0x26cc04(0x152)+_0x1e993f+'&z=17&hl=pt-BR|'+_0x5df8ce+',\x20'+_0x1e993f+'\x20';return _0x30377a;}},getBodyMessage=_0x20596a=>{const _0x3de2ca=a533_0x224ed2;try{let _0xa7a5ff=getTypeMessage(_0x20596a);const _0x9d1ac7={'conversation':_0x20596a['message']?.[_0x3de2ca(0x114)],'imageMessage':_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x122)]?.[_0x3de2ca(0x210)],'videoMessage':_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x1eb)]?.['caption'],'extendedTextMessage':_0x20596a?.[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x200)]?.[_0x3de2ca(0x1c5)],'buttonsResponseMessage':_0x20596a['message']?.[_0x3de2ca(0x214)]?.[_0x3de2ca(0x215)],'listResponseMessage':_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x10b)]?.[_0x3de2ca(0x10f)]||_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x10b)]?.[_0x3de2ca(0x1e1)]?.[_0x3de2ca(0x1bd)],'templateButtonReplyMessage':_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x101)]?.['selectedId'],'messageContextInfo':_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x214)]?.['selectedButtonId']||_0x20596a[_0x3de2ca(0x1c7)][_0x3de2ca(0x10b)]?.[_0x3de2ca(0x10f)],'buttonsMessage':getBodyButton(_0x20596a)||_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x10b)]?.[_0x3de2ca(0x10f)],'stickerMessage':_0x3de2ca(0x213),'contactMessage':_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x1df)]?.[_0x3de2ca(0x1de)],'contactsArrayMessage':_0x20596a[_0x3de2ca(0x1c7)]?.['contactsArrayMessage']?.[_0x3de2ca(0x18c)]&&contactsArrayMessageGet(_0x20596a),'locationMessage':msgLocation(_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x17e)]?.['jpegThumbnail'],_0x20596a['message']?.['locationMessage']?.[_0x3de2ca(0x20c)],_0x20596a['message']?.['locationMessage']?.['degreesLongitude']),'liveLocationMessage':_0x3de2ca(0x1cf)+_0x20596a[_0x3de2ca(0x1c7)][_0x3de2ca(0x173)]?.[_0x3de2ca(0x20c)]+_0x3de2ca(0x193)+_0x20596a[_0x3de2ca(0x1c7)][_0x3de2ca(0x173)]?.[_0x3de2ca(0x211)],'documentMessage':_0x20596a[_0x3de2ca(0x1c7)][_0x3de2ca(0x14f)]?.['title'],'audioMessage':_0x3de2ca(0x147),'listMessage':getBodyList(_0x20596a)||_0x20596a['message']['listResponseMessage']?.[_0x3de2ca(0x10f)],'viewOnceMessage':getBodyButton(_0x20596a),'reactionMessage':_0x20596a[_0x3de2ca(0x1c7)]['reactionMessage']?.[_0x3de2ca(0x1c5)]||'reaction','senderKeyDistributionMessage':_0x20596a?.[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x1ce)]?.['axolotlSenderKeyDistributionMessage'],'documentWithCaptionMessage':_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x1d6)]?.[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x14f)]?.[_0x3de2ca(0x210)],'viewOnceMessageV2':_0x20596a[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x1fb)]?.[_0x3de2ca(0x1c7)]?.[_0x3de2ca(0x122)]?.[_0x3de2ca(0x210)],'editedMessage':_0x20596a['message']?.[_0x3de2ca(0x1fa)]?.['message']?.['extendedTextMessage']?.[_0x3de2ca(0x1c5)]},_0x117a0b=Object[_0x3de2ca(0x18a)](_0x9d1ac7)[_0x3de2ca(0x203)](_0xafa042=>_0xafa042===_0xa7a5ff);return!_0x117a0b&&(logger_1['logger'][_0x3de2ca(0x18d)](_0x3de2ca(0x198)+_0xa7a5ff+'\x0a'+JSON[_0x3de2ca(0x208)](_0x20596a)),Sentry[_0x3de2ca(0x1d8)](_0x3de2ca(0x207),{'BodyMsg':_0x20596a[_0x3de2ca(0x1c7)],'msg':_0x20596a,'type':_0xa7a5ff}),Sentry['captureException'](new Error(_0x3de2ca(0x13a)))),_0x9d1ac7[_0xa7a5ff];}catch(_0xf36bd0){Sentry[_0x3de2ca(0x1d8)](_0x3de2ca(0x20e),{'msg':_0x20596a,'BodyMsg':_0x20596a[_0x3de2ca(0x1c7)]}),Sentry[_0x3de2ca(0x216)](_0xf36bd0),console[_0x3de2ca(0x13f)](_0xf36bd0);}};exports[a533_0x224ed2(0x174)]=getBodyMessage;const getQuotedMessage=_0x27971f=>{const _0x282b9a=a533_0x224ed2,_0x534046=(0x0,baileys_1['extractMessageContent'])(_0x27971f[_0x282b9a(0x1c7)])[Object[_0x282b9a(0x18a)](_0x27971f?.[_0x282b9a(0x1c7)])[_0x282b9a(0x1e5)]()[_0x282b9a(0xf5)]()['value']];if(!_0x534046?.[_0x282b9a(0x131)]?.['quotedMessage'])return;const _0x251073=(0x0,baileys_1[_0x282b9a(0x1cd)])(_0x534046?.[_0x282b9a(0x131)]?.[_0x282b9a(0x15f)][Object[_0x282b9a(0x18a)](_0x534046?.[_0x282b9a(0x131)]?.['quotedMessage'])[_0x282b9a(0x1e5)]()[_0x282b9a(0xf5)]()[_0x282b9a(0x154)]]);return _0x251073;};exports[a533_0x224ed2(0x1b5)]=getQuotedMessage;const getQuotedMessageId=_0x19edf2=>{const _0x5946a5=a533_0x224ed2,_0x15e6e5=(0x0,baileys_1['extractMessageContent'])(_0x19edf2['message'])[Object['keys'](_0x19edf2?.[_0x5946a5(0x1c7)])['values']()[_0x5946a5(0xf5)]()['value']];let _0x2b6ef9=_0x19edf2?.[_0x5946a5(0x1c7)]?.[_0x5946a5(0x20b)]?_0x19edf2?.[_0x5946a5(0x1c7)]?.[_0x5946a5(0x20b)]?.[_0x5946a5(0x1ff)]?.['id']:'';return _0x2b6ef9?_0x2b6ef9:_0x15e6e5?.['contextInfo']?.[_0x5946a5(0x127)];};exports[a533_0x224ed2(0x181)]=getQuotedMessageId;const getMeSocket=_0x1a3c7c=>{const _0x427ea9=a533_0x224ed2;return{'id':(0x0,baileys_1[_0x427ea9(0x132)])(_0x1a3c7c[_0x427ea9(0x20a)]['id']),'name':_0x1a3c7c[_0x427ea9(0x20a)][_0x427ea9(0x104)]};},getSenderMessage=(_0x5e089a,_0x1e96d0)=>{const _0xd6ec9=a533_0x224ed2,_0x266f64=getMeSocket(_0x1e96d0);if(_0x5e089a[_0xd6ec9(0x1ff)][_0xd6ec9(0x19b)])return _0x266f64['id'];const _0x201dfd=_0x5e089a[_0xd6ec9(0x11e)]||_0x5e089a['key'][_0xd6ec9(0x11e)]||_0x5e089a[_0xd6ec9(0x1ff)]['remoteJid']||undefined;return _0x201dfd&&(0x0,baileys_1['jidNormalizedUser'])(_0x201dfd);},getContactMessage=async(_0x435560,_0x2a70a6)=>{const _0xe7429c=a533_0x224ed2,_0x22230e=_0x435560[_0xe7429c(0x1ff)]['remoteJid'][_0xe7429c(0x13e)]('g.us'),_0x337d04=_0x435560[_0xe7429c(0x1ff)][_0xe7429c(0x171)]['replace'](/\D/g,'');return _0x22230e?{'id':getSenderMessage(_0x435560,_0x2a70a6),'name':_0x435560[_0xe7429c(0xf8)]}:{'id':_0x435560[_0xe7429c(0x1ff)][_0xe7429c(0x171)],'name':_0x435560['key'][_0xe7429c(0x19b)]?_0x337d04:_0x435560[_0xe7429c(0xf8)]};},downloadMedia=async(_0x3cd72f,_0x12922f=null)=>{const _0x5c86ea=a533_0x224ed2;let _0xba1a77;try{_0xba1a77=await(0x0,baileys_1[_0x5c86ea(0x1e7)])(_0x3cd72f,_0x5c86ea(0x12e),{});}catch(_0x2d6f1f){_0x12922f?console['log'](_0x5c86ea(0x1ae)):console[_0x5c86ea(0x10c)](_0x5c86ea(0x1d7),_0x2d6f1f);}let _0x46d848=_0x3cd72f[_0x5c86ea(0x1c7)]?.[_0x5c86ea(0x14f)]?.[_0x5c86ea(0x109)]||'';const _0x1d6c23=_0x3cd72f[_0x5c86ea(0x1c7)]?.['imageMessage']||_0x3cd72f['message']?.[_0x5c86ea(0x150)]||_0x3cd72f[_0x5c86ea(0x1c7)]?.[_0x5c86ea(0x1eb)]||_0x3cd72f['message']?.[_0x5c86ea(0x11c)]||_0x3cd72f[_0x5c86ea(0x1c7)]?.[_0x5c86ea(0x14f)]||_0x3cd72f['message']?.[_0x5c86ea(0x1d6)]?.[_0x5c86ea(0x1c7)]?.[_0x5c86ea(0x14f)]||_0x3cd72f[_0x5c86ea(0x1c7)]?.[_0x5c86ea(0x200)]?.[_0x5c86ea(0x131)]?.[_0x5c86ea(0x15f)]?.[_0x5c86ea(0x122)]||_0x3cd72f['message']?.[_0x5c86ea(0x200)]?.[_0x5c86ea(0x131)]?.['quotedMessage']?.['videoMessage'];if(!_0x46d848){const _0x5295eb=_0x1d6c23['mimetype'][_0x5c86ea(0x1d1)]('/')[0x1]['split'](';')[0x0];_0x46d848=new Date()[_0x5c86ea(0x1f9)]()+'.'+_0x5295eb;}else _0x46d848=new Date()[_0x5c86ea(0x1f9)]()+'_'+_0x46d848;const _0x522fce={'data':_0xba1a77,'mimetype':_0x1d6c23['mimetype'],'filename':_0x46d848};return _0x522fce;},verifyContact=async(_0x21bcd8,_0x4eeb23,_0x17b51a)=>{const _0x14c13f=a533_0x224ed2;let _0x120ca3;try{_0x120ca3=await _0x4eeb23[_0x14c13f(0x124)](_0x21bcd8['id'],_0x14c13f(0x138));}catch(_0x25fc2f){Sentry[_0x14c13f(0x216)](_0x25fc2f),_0x120ca3=process[_0x14c13f(0x162)]['FRONTEND_URL']+'/nopicture.png';}const _0x5dcc86={'name':_0x21bcd8[_0x14c13f(0x104)]||_0x21bcd8['id'][_0x14c13f(0x1bf)](/\D/g,''),'number':_0x21bcd8['id']['replace'](/\D/g,''),'profilePicUrl':_0x120ca3,'isGroup':_0x21bcd8['id'][_0x14c13f(0x13e)](_0x14c13f(0x14d)),'companyId':_0x17b51a,'remoteJid':_0x21bcd8['id']};_0x5dcc86['isGroup']&&(_0x5dcc86[_0x14c13f(0x10e)]=_0x21bcd8['id'][_0x14c13f(0x1bf)](_0x14c13f(0x172),''));const _0x12ee0c=(0x0,CreateOrUpdateContactService_1[_0x14c13f(0x115)])(_0x5dcc86);return _0x12ee0c;},verifyQuotedMessage=async _0x20347a=>{const _0x1038b3=a533_0x224ed2;if(!_0x20347a)return null;const _0x2b9e3d=(0x0,exports['getQuotedMessageId'])(_0x20347a);if(!_0x2b9e3d)return null;const _0x1f552e=await Message_1['default'][_0x1038b3(0x130)]({'where':{'wid':_0x2b9e3d}});if(!_0x1f552e)return null;return _0x1f552e;},verifyMediaMessage=async(_0x1d3c93,_0x4ab911,_0x1a23a7,_0x13631f)=>{const _0x5663cb=a533_0x224ed2,_0x33c2f8=(0x0,socket_1[_0x5663cb(0x161)])(),_0x4827b4=await verifyQuotedMessage(_0x1d3c93);try{const _0x122ec2=await downloadMedia(_0x1d3c93,_0x4ab911?.[_0x5663cb(0x15c)]);if(!_0x122ec2&&_0x4ab911[_0x5663cb(0x15c)]){const _0x55993c=_0x5663cb(0x153),_0xc9b50f={'wid':_0x1d3c93['key']['id'],'ticketId':_0x4ab911['id'],'contactId':_0x1d3c93[_0x5663cb(0x1ff)]['fromMe']?undefined:_0x4ab911[_0x5663cb(0x126)],'body':_0x55993c,'reactionMessage':_0x1d3c93['message']?.[_0x5663cb(0x20b)],'fromMe':_0x1d3c93[_0x5663cb(0x1ff)][_0x5663cb(0x19b)],'mediaType':getTypeMessage(_0x1d3c93),'read':_0x1d3c93[_0x5663cb(0x1ff)][_0x5663cb(0x19b)],'quotedMsgId':_0x4827b4?.['id']||_0x1d3c93[_0x5663cb(0x1c7)]?.[_0x5663cb(0x20b)]?.[_0x5663cb(0x1ff)]?.['id'],'ack':_0x1d3c93['status'],'companyId':_0x4ab911[_0x5663cb(0xf6)],'remoteJid':_0x1d3c93[_0x5663cb(0x1ff)][_0x5663cb(0x171)],'participant':_0x1d3c93[_0x5663cb(0x1ff)][_0x5663cb(0x11e)],'timestamp':getTimestampMessage(_0x1d3c93['messageTimestamp']),'createdAt':new Date(Math['floor'](getTimestampMessage(_0x1d3c93['messageTimestamp'])*0x3e8))[_0x5663cb(0x187)](),'dataJson':JSON['stringify'](_0x1d3c93),'ticketImported':_0x4ab911[_0x5663cb(0x15c)]};return await _0x4ab911[_0x5663cb(0x15d)]({'lastMessage':_0x55993c}),logger_1[_0x5663cb(0x106)]['error'](Error('ERR_WAPP_DOWNLOAD_MEDIA')),(0x0,CreateMessageService_1['default'])({'messageData':_0xc9b50f,'companyId':_0x4ab911['companyId']});}if(!_0x122ec2)throw new Error(_0x5663cb(0x1c8));if(!_0x122ec2[_0x5663cb(0x209)]||_0x122ec2[_0x5663cb(0x1c4)]===_0x5663cb(0x183)){const _0xb2a80a=_0x122ec2[_0x5663cb(0x1c4)]===_0x5663cb(0x183)?_0x5663cb(0x140):_0x122ec2[_0x5663cb(0x1c4)][_0x5663cb(0x1d1)]('/')[0x1][_0x5663cb(0x1d1)](';')[0x0];_0x122ec2[_0x5663cb(0x209)]=new Date()['getTime']()+'.'+_0xb2a80a;}else{const _0x42d956=_0x122ec2[_0x5663cb(0x209)][_0x5663cb(0x1d1)]('.')[_0x5663cb(0x167)](),_0x230500=_0x122ec2[_0x5663cb(0x209)][_0x5663cb(0x1d1)]('.')[_0x5663cb(0x133)](0x0,-0x1)[_0x5663cb(0x185)]('.')[_0x5663cb(0x1bf)](/\s/g,'_')[_0x5663cb(0x12c)](_0x5663cb(0x116))['replace'](/[\u0300-\u036f]/g,'');_0x122ec2[_0x5663cb(0x209)]=_0x230500['trim']()+'_'+new Date()[_0x5663cb(0x1f9)]()+'.'+_0x42d956;}try{const _0x2b0e5b=path_1[_0x5663cb(0x115)][_0x5663cb(0x212)](__dirname,'..','..','..',_0x5663cb(0x19e),_0x5663cb(0x14c)+_0x4ab911[_0x5663cb(0xf6)]);!fs_2[_0x5663cb(0x115)][_0x5663cb(0x217)](_0x2b0e5b)&&(fs_2[_0x5663cb(0x115)][_0x5663cb(0x1c0)](_0x2b0e5b,{'recursive':!![]}),fs_2[_0x5663cb(0x115)][_0x5663cb(0x160)](_0x2b0e5b,0x1ff)),await writeFileAsync((0x0,path_1[_0x5663cb(0x185)])(_0x2b0e5b,_0x122ec2[_0x5663cb(0x209)]),_0x122ec2[_0x5663cb(0xf3)][_0x5663cb(0x149)](_0x5663cb(0x1db)),_0x5663cb(0x1db));}catch(_0x4d4062){Sentry[_0x5663cb(0x1d8)]('Erro\x20media',{'companyId':_0x4ab911[_0x5663cb(0xf6)],'ticket':_0x4ab911,'contact':_0x1a23a7,'media':_0x122ec2,'quotedMsg':_0x4827b4}),Sentry[_0x5663cb(0x216)](_0x4d4062),logger_1[_0x5663cb(0x106)][_0x5663cb(0x10c)](_0x4d4062),console['log'](_0x1d3c93);}const _0x4b2343=(0x0,exports['getBodyMessage'])(_0x1d3c93),_0x2133bf={'wid':_0x1d3c93[_0x5663cb(0x1ff)]['id'],'ticketId':_0x4ab911['id'],'contactId':_0x1d3c93[_0x5663cb(0x1ff)]['fromMe']?undefined:_0x1a23a7['id'],'body':_0x4b2343||_0x122ec2['filename'],'fromMe':_0x1d3c93[_0x5663cb(0x1ff)][_0x5663cb(0x19b)],'read':_0x1d3c93[_0x5663cb(0x1ff)]['fromMe'],'mediaUrl':_0x122ec2[_0x5663cb(0x209)],'mediaType':_0x122ec2['mimetype'][_0x5663cb(0x1d1)]('/')[0x0],'quotedMsgId':_0x4827b4?.['id'],'ack':_0x1d3c93[_0x5663cb(0x1d2)],'remoteJid':_0x1d3c93[_0x5663cb(0x1ff)]['remoteJid'],'participant':_0x1d3c93['key'][_0x5663cb(0x11e)],'dataJson':JSON[_0x5663cb(0x208)](_0x1d3c93),'ticketTrakingId':_0x13631f?.['id'],'createdAt':new Date(Math[_0x5663cb(0x1f0)](getTimestampMessage(_0x1d3c93[_0x5663cb(0x1a7)])*0x3e8))[_0x5663cb(0x187)](),'ticketImported':_0x4ab911[_0x5663cb(0x15c)]};await _0x4ab911[_0x5663cb(0x15d)]({'lastMessage':_0x4b2343||_0x122ec2[_0x5663cb(0x209)]});const _0x46c181=await(0x0,CreateMessageService_1[_0x5663cb(0x115)])({'messageData':_0x2133bf,'companyId':_0x4ab911[_0x5663cb(0xf6)]});return!_0x1d3c93[_0x5663cb(0x1ff)]['fromMe']&&_0x4ab911[_0x5663cb(0x1d2)]===_0x5663cb(0x1a3)&&(await _0x4ab911[_0x5663cb(0x15d)]({'status':'pending'}),await _0x4ab911[_0x5663cb(0x163)]({'include':[{'model':Queue_1[_0x5663cb(0x115)],'as':_0x5663cb(0x1f7)},{'model':User_1[_0x5663cb(0x115)],'as':_0x5663cb(0x20a)},{'model':Contact_1['default'],'as':_0x5663cb(0x16f)}]}),_0x33c2f8['to'](_0x5663cb(0x1a3))[_0x5663cb(0x11a)](_0x5663cb(0x156)+_0x4ab911[_0x5663cb(0xf6)]+_0x5663cb(0x1aa),{'action':_0x5663cb(0x13d),'ticket':_0x4ab911,'ticketId':_0x4ab911['id']}),_0x33c2f8['to'](_0x4ab911[_0x5663cb(0x1d2)])['to'](_0x4ab911['id'][_0x5663cb(0x149)]())[_0x5663cb(0x11a)](_0x5663cb(0x156)+_0x4ab911[_0x5663cb(0xf6)]+_0x5663cb(0x1aa),{'action':'update','ticket':_0x4ab911,'ticketId':_0x4ab911['id']})),_0x46c181;}catch(_0x16a317){console[_0x5663cb(0x13f)](_0x16a317),logger_1['logger'][_0x5663cb(0x18d)](_0x5663cb(0xf4));}},verifyMessage=async(_0x129bf9,_0xa0d42a,_0x265449,_0x513d1f,_0x5917ac)=>{const _0x144770=a533_0x224ed2,_0x417ff6=(0x0,socket_1[_0x144770(0x161)])(),_0x37ad52=await verifyQuotedMessage(_0x129bf9),_0x483d87=(0x0,exports[_0x144770(0x174)])(_0x129bf9),_0x461900={'wid':_0x129bf9[_0x144770(0x1ff)]['id'],'ticketId':_0xa0d42a['id'],'contactId':_0x129bf9[_0x144770(0x1ff)][_0x144770(0x19b)]?undefined:_0x265449['id'],'body':_0x483d87,'fromMe':_0x129bf9[_0x144770(0x1ff)]['fromMe'],'mediaType':getTypeMessage(_0x129bf9),'read':_0x129bf9['key'][_0x144770(0x19b)],'quotedMsgId':_0x37ad52?.['id'],'ack':_0x129bf9[_0x144770(0x1d2)],'remoteJid':_0x129bf9['key'][_0x144770(0x171)],'participant':_0x129bf9[_0x144770(0x1ff)][_0x144770(0x11e)],'dataJson':JSON['stringify'](_0x129bf9),'ticketTrakingId':_0x513d1f?.['id'],'isPrivate':_0x5917ac,'createdAt':new Date(Math['floor'](getTimestampMessage(_0x129bf9[_0x144770(0x1a7)])*0x3e8))[_0x144770(0x187)](),'ticketImported':_0xa0d42a[_0x144770(0x15c)]};await _0xa0d42a['update']({'lastMessage':_0x483d87}),await(0x0,CreateMessageService_1[_0x144770(0x115)])({'messageData':_0x461900,'companyId':_0xa0d42a[_0x144770(0xf6)]}),!_0x129bf9[_0x144770(0x1ff)][_0x144770(0x19b)]&&_0xa0d42a[_0x144770(0x1d2)]==='closed'&&(await _0xa0d42a[_0x144770(0x15d)]({'status':_0x144770(0x1ee)}),await _0xa0d42a[_0x144770(0x163)]({'include':[{'model':Queue_1[_0x144770(0x115)],'as':_0x144770(0x1f7)},{'model':User_1['default'],'as':'user'},{'model':Contact_1[_0x144770(0x115)],'as':_0x144770(0x16f)}]}),_0x417ff6['to'](_0x144770(0x1a3))[_0x144770(0x11a)](_0x144770(0x156)+_0xa0d42a[_0x144770(0xf6)]+_0x144770(0x1aa),{'action':_0x144770(0x13d),'ticket':_0xa0d42a,'ticketId':_0xa0d42a['id']}),!_0xa0d42a[_0x144770(0x15c)]&&_0x417ff6['to'](_0xa0d42a['status'])['to'](_0xa0d42a['id'][_0x144770(0x149)]())[_0x144770(0x11a)]('company-'+_0xa0d42a[_0x144770(0xf6)]+_0x144770(0x1aa),{'action':'update','ticket':_0xa0d42a,'ticketId':_0xa0d42a['id']}));};exports[a533_0x224ed2(0xfc)]=verifyMessage;function a533_0x24bc(){const _0x4374c5=['outOfHoursMessage','queue','randomValue','getTime','editedMessage','viewOnceMessageV2','1631396hCRriQ','map','../../models/CampaignShipping','key','extendedTextMessage','1bhJIux','messages.update','find','userRandom','queueId','setMinutes','Mensagem','stringify','filename','user','reactionMessage','degreesLatitude','lgpdConsent','Error\x20getTypeMessage','../FacebookServices/sendFacebookMessage','caption','degreesLongitude','resolve','sticker','buttonsResponseMessage','selectedDisplayText','captureException','existsSync','Escolha\x20uma\x20opção','../../models/Contact','call','33591NKhbGH','scheduleType','data','Erro\x20ao\x20baixar\x20media','next','companyId','../TicketServices/FindOrCreateATicketTrakingService','pushName','\x20|\x20https://maps.google.com/maps?q=','parseToMilliseconds','set','verifyMessage','contentText','delay','forEach',':unreads','templateButtonReplyMessage','../../helpers/Mustache','Error\x20handling\x20message\x20ack.\x20Err:\x20','name','data:image/png;base64,\x20','logger','verifyRating','3395855REmvhz','fileName','76926QNFqKG','listResponseMessage','error','messages','number','title','sayChatbot','nps','contacts:','\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento','conversation','default','NFD','-appMessage','acceptAudioMessageContact','maxUseBotQueues','emit','77kmSAhw','stickerMessage','lgpdSendMessageAt','participant','rows','hasOwnProperty','isNull','imageMessage','protocolMessage','profilePictureUrl','isValidMsg','contactId','stanzaId','shift','1518uBzttK','enabled','__esModule','normalize','../../libs/socket','buffer','304apNNgu','findOne','contextInfo','jidNormalizedUser','slice','substring','from','./MarkDeleteWhatsAppMessage','enableLGPD','image','buttons','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20getTypeMessage','../../models/UserRating','WAMessageStubType','delete','includes','log','m4a','*[\x20','defineProperty','lgpdAcceptedAt','moment','disabled','amountUsedBotQueues','Áudio','displayText','toString','wbotMessageListener','s.whatsapp.net','company','g.us','../TicketServices/UpdateTicketService','documentMessage','audioMessage','ratingMessage','%2C','*System:*\x20\x0aFalha\x20no\x20download\x20da\x20mídia\x20verifique\x20no\x20dispositivo','value','amountUseBotQueuesNPS','company-','endsWith','destroy','getContentType','Menu','4252158EbMnLe','imported','update','lgpd','quotedMessage','chmodSync','getIO','env','reload','../UserQueueServices/ListUserQueueServices','*\x20-\x20','mediaMessage','pop','chatbotAt','closedAt','*Assistente\x20Virtual*:\x0aInfelizmente\x20não\x20conseguimos\x20escutar\x20nem\x20enviar\x20áudios\x20por\x20este\x20canal\x20de\x20atendimento,\x20por\x20favor,\x20envie\x20uma\x20mensagem\x20de\x20*texto*.','Validação\x20de\x20mensagem\x20de\x20campanha\x20enviada\x20por\x20terceiros:\x20','buttonsMessage','lgpdMessage','*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posição\x20na\x20fila\x20de\x20atendimento\x20é:\x20*','contact','CIPHERTEXT','remoteJid','@g.us','liveLocationMessage','getBodyMessage','__importStar','ephemeralMessage','@sentry/node','subject','list','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','indexOf','sendGreetingMessageOneQueues','handleMessage','locationMessage','../../libs/cache','./ChatBotListener','getQuotedMessageId','push','audio/mp4','writeFile','join','count','toISOString','open','toDate','keys','complationMessage','contacts','warn','promisify','cacheLayer','allowGroup',':\x20📞','disableBot','\x20-\x20Longitude:\x20','../../helpers/Debounce','whatsapp','prototype','length','####\x20Nao\x20achou\x20o\x20type\x20152:\x20','facebook','messageContextInfo','fromMe','chatbots','button','public','sections','quotedMsg','sendMessage','DispatchCampaign','closed','maxUseBotQueuesNPS','findByPk','ratingAt','messageTimestamp','greetingMessage','test','-ticket','buttonText','../../models/Campaign','debounce','Falha\x20ao\x20fazer\x20o\x20download\x20de\x20uma\x20mensagem\x20importada,\x20provavelmente\x20a\x20mensagem\x20já\x20não\x20esta\x20mais\x20disponível','getOwnPropertyDescriptor','viewOnceMessage','channel','__setModuleDefault','ticketId','get','getQuotedMessage','getMinutes','Esta\x20mensagem\x20já\x20existe','isGroup','filter','6044032ZJUMDI','description','queues','selectedRowId','lgpdLink','replace','mkdirSync','\x20]*\x20-\x20','inActivity','messageStubType','mimetype','text','isNil','message','ERR_WAPP_DOWNLOAD_MEDIA','E2E_IDENTITY_CHANGED','groupMetadata','95500xwmmgK','findAll','extractMessageContent','senderKeyDistributionMessage','Latitude:\x20','‎Opção\x20inválida,\x20tente\x20novamente.\x0a','split','status','@c.us','item1.TEL','../../models/Message','documentWithCaptionMessage','Erro\x20ao\x20baixar\x20mídia:','setExtra','../TicketServices/FindOrCreateTicketService','sendQueuePosition','base64','../SettingServices/ListSettingsService','findAndCountAll','vcard','contactMessage','whatsappId','singleSelectReply','userId','handleRating','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','values','messages.upsert','downloadMediaMessage','EM_ANDAMENTO','finishedAt','../../models/Ticket','videoMessage','‎Estou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20Não','chatBotType','pending','listMessage','floor','../CompanyService/VerifyCurrentSchedule','__createBinding','voiceMessage','../WhatsappService/ShowWhatsAppService','create'];a533_0x24bc=function(){return _0x4374c5;};return a533_0x24bc();}const isValidMsg=_0xceb4d5=>{const _0x4bd85f=a533_0x224ed2;if(_0xceb4d5[_0x4bd85f(0x1ff)]['remoteJid']==='status@broadcast')return![];try{const _0x7e3d66=getTypeMessage(_0xceb4d5);if(!_0x7e3d66)return;const _0x981f90=_0x7e3d66===_0x4bd85f(0x114)||_0x7e3d66==='extendedTextMessage'||_0x7e3d66==='audioMessage'||_0x7e3d66===_0x4bd85f(0x1eb)||_0x7e3d66==='imageMessage'||_0x7e3d66===_0x4bd85f(0x14f)||_0x7e3d66===_0x4bd85f(0x11c)||_0x7e3d66==='buttonsResponseMessage'||_0x7e3d66===_0x4bd85f(0x16c)||_0x7e3d66===_0x4bd85f(0x19a)||_0x7e3d66===_0x4bd85f(0x17e)||_0x7e3d66===_0x4bd85f(0x173)||_0x7e3d66===_0x4bd85f(0x1df)||_0x7e3d66===_0x4bd85f(0x1f3)||_0x7e3d66===_0x4bd85f(0x166)||_0x7e3d66==='contactsArrayMessage'||_0x7e3d66===_0x4bd85f(0x20b)||_0x7e3d66===_0x4bd85f(0x176)||_0x7e3d66==='protocolMessage'||_0x7e3d66==='listResponseMessage'||_0x7e3d66==='listMessage'||_0x7e3d66===_0x4bd85f(0x1b0)||_0x7e3d66==='documentWithCaptionMessage'||_0x7e3d66==='viewOnceMessageV2'||_0x7e3d66==='editedMessage';return!_0x981f90&&(logger_1[_0x4bd85f(0x106)][_0x4bd85f(0x18d)](_0x4bd85f(0x17a)+_0x7e3d66+'\x0a'+JSON[_0x4bd85f(0x208)](_0xceb4d5?.[_0x4bd85f(0x1c7)])),Sentry[_0x4bd85f(0x1d8)](_0x4bd85f(0x207),{'BodyMsg':_0xceb4d5[_0x4bd85f(0x1c7)],'msg':_0xceb4d5,'msgType':_0x7e3d66}),Sentry[_0x4bd85f(0x216)](new Error(_0x4bd85f(0x1e4)))),!!_0x981f90;}catch(_0x4b1453){Sentry[_0x4bd85f(0x1d8)]('Error\x20isValidMsg',{'msg':_0xceb4d5}),Sentry[_0x4bd85f(0x216)](_0x4b1453);}};exports['isValidMsg']=isValidMsg;const verifyQueue=async(_0x22b144,_0xab3682,_0x5290ae,_0xe1f905,_0x370d75)=>{const _0xbf3aaf=a533_0x224ed2,{queues:_0x425d7d,greetingMessage:_0x14ff74,maxUseBotQueues:_0x4a5003,timeUseBotQueues:_0x27e4f9}=await(0x0,ShowWhatsAppService_1[_0xbf3aaf(0x115)])(_0x22b144['id'],_0x5290ae[_0xbf3aaf(0xf6)]),_0x302bce=await(0x0,FindOrCreateATicketTrakingService_1[_0xbf3aaf(0x115)])({'ticketId':_0x5290ae['id'],'companyId':_0x5290ae['companyId'],'whatsappId':_0x5290ae['whatsapp']?.['id']});let _0x266458=![];_0x425d7d[_0xbf3aaf(0x197)]===0x1&&(_0x266458=_0x425d7d[0x0]?.['chatbots'][_0xbf3aaf(0x197)]>0x1);const _0x5ce8c2=_0x370d75[_0xbf3aaf(0x203)](_0x2d5362=>_0x2d5362[_0xbf3aaf(0x1ff)]===_0xbf3aaf(0x1da));if(_0x425d7d[_0xbf3aaf(0x197)]===0x1&&!_0x266458){const _0x57108=_0x370d75[_0xbf3aaf(0x203)](_0x32dc2b=>_0x32dc2b[_0xbf3aaf(0x1ff)]===_0xbf3aaf(0x17c));if(_0x14ff74[_0xbf3aaf(0x197)]>0x1&&_0x57108[_0xbf3aaf(0x154)]===_0xbf3aaf(0x12a)){const _0x21a466=(0x0,Mustache_1['default'])(''+_0x14ff74,_0x5290ae);await _0x22b144['sendMessage'](_0xe1f905[_0xbf3aaf(0x10e)]+'@'+(_0x5290ae[_0xbf3aaf(0x1b8)]?'g.us':_0xbf3aaf(0x14b)),{'text':_0x21a466});}await(0x0,UpdateTicketService_1[_0xbf3aaf(0x115)])({'ticketData':{'queueId':_0x425d7d[0x0]['id']},'ticketId':_0x5290ae['id'],'companyId':_0x5290ae[_0xbf3aaf(0xf6)]});const _0x31f0c4=await Ticket_1[_0xbf3aaf(0x115)][_0xbf3aaf(0x1dd)]({'where':{'userId':null,'status':_0xbf3aaf(0x1ee),'companyId':_0x5290ae['companyId'],'queueId':_0x425d7d[0x0]['id'],'isGroup':![]}});if(_0x5ce8c2['value']===_0xbf3aaf(0x12a)){const _0x3be713=_0x31f0c4[_0xbf3aaf(0x186)]===0x0?0x1:_0x31f0c4[_0xbf3aaf(0x186)],_0x444fcc=_0xbf3aaf(0x16e)+_0x3be713+'*',_0x3d39a8=(0x0,Mustache_1[_0xbf3aaf(0x115)])(''+_0x444fcc,_0x5290ae),_0x25e3ba=(0x0,Debounce_1[_0xbf3aaf(0x1ad)])(async()=>{const _0x24f87c=_0xbf3aaf;await _0x22b144['sendMessage'](_0xe1f905[_0x24f87c(0x10e)]+'@'+(_0x5290ae[_0x24f87c(0x1b8)]?_0x24f87c(0x14d):_0x24f87c(0x14b)),{'text':_0x3d39a8});},0xbb8,_0x5290ae['id']);_0x25e3ba();}return;}if(_0xe1f905[_0xbf3aaf(0x192)])return;let _0xad6b9c='';if(_0x5290ae[_0xbf3aaf(0x1d2)]!=='lgpd')_0xad6b9c=_0xab3682?.[_0xbf3aaf(0x1c7)]?.[_0xbf3aaf(0x214)]?.['selectedButtonId']||_0xab3682?.[_0xbf3aaf(0x1c7)]?.[_0xbf3aaf(0x10b)]?.['singleSelectReply'][_0xbf3aaf(0x1bd)]||(0x0,exports[_0xbf3aaf(0x174)])(_0xab3682);else{if(!(0x0,lodash_1[_0xbf3aaf(0x1c6)])(_0x5290ae['lgpdAcceptedAt']))await _0x5290ae[_0xbf3aaf(0x15d)]({'status':'pending'});await _0x5290ae[_0xbf3aaf(0x163)]();}if(_0xad6b9c=='Sair'){const _0x1d1a25={'isBot':![],'queueId':null,'userId':null,'status':_0xbf3aaf(0x1a3),'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1[_0xbf3aaf(0x115)])({'ticketData':_0x1d1a25,'ticketId':_0x5290ae['id'],'companyId':_0x5290ae[_0xbf3aaf(0xf6)]});const {complationMessage:_0x2151a3}=await(0x0,ShowWhatsAppService_1[_0xbf3aaf(0x115)])(_0x5290ae[_0xbf3aaf(0x1e0)],_0x5290ae[_0xbf3aaf(0xf6)]),_0x5b2d3d={'text':(0x0,Mustache_1[_0xbf3aaf(0x115)])('‎'+_0x2151a3,_0x5290ae)},_0x599c63=await _0x22b144[_0xbf3aaf(0x1a1)](_0x5290ae?.['contact']?.[_0xbf3aaf(0x10e)]+'@'+(_0x5290ae[_0xbf3aaf(0x1b8)]?_0xbf3aaf(0x14d):_0xbf3aaf(0x14b)),_0x5b2d3d);await(0x0,exports[_0xbf3aaf(0xfc)])(_0x599c63,_0x5290ae,_0x5290ae[_0xbf3aaf(0x16f)]);return;}const _0x48edb7=_0x266458&&_0x425d7d[_0xbf3aaf(0x197)]===0x1?_0x425d7d[+_0xad6b9c]:_0x425d7d[+_0xad6b9c-0x1],_0x28846d=await Setting_1[_0xbf3aaf(0x115)][_0xbf3aaf(0x130)]({'where':{'key':_0xbf3aaf(0x1ed),'companyId':_0x5290ae[_0xbf3aaf(0xf6)]}}),_0x58e3d2=_0x28846d?.[_0xbf3aaf(0x154)]||_0xbf3aaf(0x1c5);let _0x45d84b;if(_0x48edb7)try{const _0x2f3e05=await(0x0,ListUserQueueServices_1[_0xbf3aaf(0x115)])(_0x48edb7['id']);_0x2f3e05[_0xbf3aaf(0x1e2)]>-0x1&&(_0x45d84b=_0x2f3e05[_0xbf3aaf(0x1e2)]);}catch(_0x51909b){console[_0xbf3aaf(0x10c)](_0x51909b);}let _0x162c53=await Setting_1[_0xbf3aaf(0x115)]['findOne']({'where':{'key':_0xbf3aaf(0x204),'companyId':_0x5290ae[_0xbf3aaf(0xf6)]}});const _0x3c5345=async()=>{const _0xfcfb28=_0xbf3aaf;if(_0x48edb7||_0x425d7d[_0xfcfb28(0x197)]===0x1&&_0x266458){await(0x0,UpdateTicketService_1[_0xfcfb28(0x115)])({'ticketData':{'queueId':_0x48edb7['id']},'ticketId':_0x5290ae['id'],'companyId':_0x5290ae['companyId']});if(_0x48edb7[_0xfcfb28(0x19c)][_0xfcfb28(0x197)]>0x0){let _0x3793b4='';_0x48edb7[_0xfcfb28(0x19c)]['forEach']((_0x4202a6,_0x1a3180)=>{const _0x1eade1=_0xfcfb28;_0x3793b4+='*'+(_0x1a3180+0x1)+_0x1eade1(0x165)+_0x4202a6[_0x1eade1(0x104)]+'\x0a';});const _0x4d0081=(0x0,Mustache_1[_0xfcfb28(0x115)])('‎'+_0x48edb7[_0xfcfb28(0x1a8)]+'\x0a\x0a'+_0x3793b4+'\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal',_0x5290ae),_0x1088a4=await _0x22b144['sendMessage'](_0xe1f905['number']+'@'+(_0x5290ae['isGroup']?_0xfcfb28(0x14d):_0xfcfb28(0x14b)),{'text':_0x4d0081});await(0x0,exports[_0xfcfb28(0xfc)])(_0x1088a4,_0x5290ae,_0xe1f905,_0x302bce),_0x162c53?.['value']===_0xfcfb28(0x12a)&&await(0x0,UpdateTicketService_1['default'])({'ticketData':{'userId':_0x45d84b},'ticketId':_0x5290ae['id'],'companyId':_0x5290ae['companyId']});}if(!_0x48edb7[_0xfcfb28(0x19c)][_0xfcfb28(0x197)]&&_0x48edb7[_0xfcfb28(0x1a8)][_0xfcfb28(0x197)]!==0x0){const _0x89fc8d=(0x0,Mustache_1[_0xfcfb28(0x115)])('‎'+_0x48edb7[_0xfcfb28(0x1a8)],_0x5290ae),_0x4c5f7d=await _0x22b144[_0xfcfb28(0x1a1)](_0xe1f905['number']+'@'+(_0x5290ae[_0xfcfb28(0x1b8)]?'g.us':_0xfcfb28(0x14b)),{'text':_0x89fc8d});await(0x0,exports[_0xfcfb28(0xfc)])(_0x4c5f7d,_0x5290ae,_0xe1f905,_0x302bce);}const _0x412942=await Ticket_1['default'][_0xfcfb28(0x1dd)]({'where':{'userId':null,'status':_0xfcfb28(0x1ee),'companyId':_0x5290ae[_0xfcfb28(0xf6)],'queueId':_0x48edb7['id'],'isGroup':![]}});if(_0x5ce8c2[_0xfcfb28(0x154)]===_0xfcfb28(0x12a)&&!_0x48edb7[_0xfcfb28(0x19c)][_0xfcfb28(0x197)]){const _0x2af548=_0x412942[_0xfcfb28(0x186)]===0x0?0x1:_0x412942[_0xfcfb28(0x186)],_0x33bca0=_0xfcfb28(0x16e)+_0x2af548+'*',_0x54673e=(0x0,Mustache_1[_0xfcfb28(0x115)])(''+_0x33bca0,_0x5290ae),_0x1d1ed3=(0x0,Debounce_1[_0xfcfb28(0x1ad)])(async()=>{const _0x36d054=_0xfcfb28;await _0x22b144[_0x36d054(0x1a1)](_0xe1f905[_0x36d054(0x10e)]+'@'+(_0x5290ae[_0x36d054(0x1b8)]?_0x36d054(0x14d):_0x36d054(0x14b)),{'text':_0x54673e});},0xbb8,_0x5290ae['id']);_0x1d1ed3();}await(0x0,UpdateTicketService_1[_0xfcfb28(0x115)])({'ticketData':{'amountUsedBotQueues':0x0},'ticketId':_0x5290ae['id'],'companyId':_0x5290ae['companyId']});}else{if(_0x4a5003&&_0x4a5003!==0x0&&_0x5290ae[_0xfcfb28(0x146)]>=_0x4a5003)return;const _0x3d3b27=await(0x0,FindOrCreateATicketTrakingService_1[_0xfcfb28(0x115)])({'ticketId':_0x5290ae['id'],'companyId':_0x5290ae[_0xfcfb28(0xf6)]});let _0x176e1f=new Date(),_0x1281f4=new Date();if(_0x3d3b27[_0xfcfb28(0x168)]!==null){_0x176e1f[_0xfcfb28(0x206)](_0x3d3b27[_0xfcfb28(0x168)][_0xfcfb28(0x1b6)]()+Number(_0x27e4f9));if(_0x3d3b27['chatbotAt']!==null&&_0x1281f4<_0x176e1f&&_0x27e4f9!=='0')return;}await _0x3d3b27[_0xfcfb28(0x15d)]({'chatbotAt':null});let _0x244bf3='';_0x425d7d[_0xfcfb28(0xff)]((_0xa68584,_0x253fe8)=>{const _0x2b1fb6=_0xfcfb28;_0x244bf3+=_0x2b1fb6(0x141)+(_0x253fe8+0x1)+_0x2b1fb6(0x1c1)+_0xa68584[_0x2b1fb6(0x104)]+'\x0a';}),_0x244bf3+=_0xfcfb28(0x113);const _0xf0c44=(0x0,Mustache_1[_0xfcfb28(0x115)])('‎'+_0x14ff74+'\x0a\x0a'+_0x244bf3,_0x5290ae),_0x456efa=(0x0,Debounce_1[_0xfcfb28(0x1ad)])(async()=>{const _0x247d9a=_0xfcfb28,_0x3c86c9=await _0x22b144[_0x247d9a(0x1a1)](_0xe1f905[_0x247d9a(0x10e)]+'@'+(_0x5290ae[_0x247d9a(0x1b8)]?_0x247d9a(0x14d):_0x247d9a(0x14b)),{'text':_0xf0c44});(0x0,exports['verifyMessage'])(_0x3c86c9,_0x5290ae,_0xe1f905,_0x3d3b27);},0x3e8,_0x5290ae['id']);await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x5290ae[_0xfcfb28(0x146)]+0x1},'ticketId':_0x5290ae['id'],'companyId':_0x5290ae[_0xfcfb28(0xf6)]}),_0x456efa();}},_0x5173a6=async()=>{const _0x2a5809=_0xbf3aaf;if(_0x48edb7){await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x48edb7['id']},'ticketId':_0x5290ae['id'],'companyId':_0x5290ae[_0x2a5809(0xf6)]});if(_0x48edb7[_0x2a5809(0x19c)][_0x2a5809(0x197)]>0x0){const _0x3a9aee=[];_0x48edb7[_0x2a5809(0x19c)][_0x2a5809(0xff)]((_0x2d3434,_0x3216c3)=>{const _0x266b96=_0x2a5809;_0x3a9aee[_0x266b96(0x182)]({'buttonId':''+(_0x3216c3+0x1),'buttonText':{'displayText':_0x2d3434[_0x266b96(0x104)]},'type':0x1});});const _0x54d8f8={'text':(0x0,Mustache_1['default'])(''+_0x48edb7[_0x2a5809(0x1a8)],_0x5290ae),'buttons':_0x3a9aee,'headerType':0x4},_0x1c6f6a=await _0x22b144['sendMessage'](_0xe1f905[_0x2a5809(0x10e)]+'@'+(_0x5290ae[_0x2a5809(0x1b8)]?_0x2a5809(0x14d):_0x2a5809(0x14b)),_0x54d8f8);await(0x0,exports['verifyMessage'])(_0x1c6f6a,_0x5290ae,_0xe1f905,_0x302bce);}if(!_0x48edb7[_0x2a5809(0x19c)][_0x2a5809(0x197)]){const _0x3af82b=(0x0,Mustache_1[_0x2a5809(0x115)])(''+_0x48edb7[_0x2a5809(0x1a8)],_0x5290ae),_0x451012=await _0x22b144[_0x2a5809(0x1a1)](_0xe1f905[_0x2a5809(0x10e)]+'@'+(_0x5290ae[_0x2a5809(0x1b8)]?_0x2a5809(0x14d):_0x2a5809(0x14b)),{'text':_0x3af82b});await(0x0,exports[_0x2a5809(0xfc)])(_0x451012,_0x5290ae,_0xe1f905,_0x302bce);}}else{const _0x110a4f=[];_0x425d7d['forEach']((_0x5c6124,_0x46b0cf)=>{const _0x488083=_0x2a5809;_0x110a4f[_0x488083(0x182)]({'buttonId':''+(_0x46b0cf+0x1),'buttonText':{'displayText':_0x5c6124['name']},'type':0x4});});const _0x3c9f52={'text':(0x0,Mustache_1[_0x2a5809(0x115)])(''+_0x14ff74,_0x5290ae),'footer':'','buttons':_0x110a4f,'headerType':0x4},_0x29b52f=await _0x22b144[_0x2a5809(0x1a1)](_0xe1f905[_0x2a5809(0x10e)]+'@'+(_0x5290ae[_0x2a5809(0x1b8)]?_0x2a5809(0x14d):_0x2a5809(0x14b)),_0x3c9f52);await(0x0,exports[_0x2a5809(0xfc)])(_0x29b52f,_0x5290ae,_0xe1f905,_0x302bce),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x5290ae[_0x2a5809(0x146)]+0x1},'ticketId':_0x5290ae['id'],'companyId':_0x5290ae[_0x2a5809(0xf6)]});}},_0x49b0fe=async()=>{const _0x1ebdee=_0xbf3aaf;if(_0x48edb7){await(0x0,UpdateTicketService_1[_0x1ebdee(0x115)])({'ticketData':{'queueId':_0x48edb7['id']},'ticketId':_0x5290ae['id'],'companyId':_0x5290ae[_0x1ebdee(0xf6)]});if(_0x48edb7[_0x1ebdee(0x19c)][_0x1ebdee(0x197)]>0x0){const _0x28d6c0=[];_0x48edb7[_0x1ebdee(0x19c)][_0x1ebdee(0xff)]((_0x4283f2,_0x1cd3b3)=>{const _0x2cbfa6=_0x1ebdee;_0x28d6c0[_0x2cbfa6(0x182)]({'title':_0x4283f2[_0x2cbfa6(0x104)],'rowId':''+(_0x1cd3b3+0x1)});});const _0x7ad5fa=[{'title':_0x1ebdee(0x15a),'rows':_0x28d6c0}],_0x426356={'text':(0x0,Mustache_1['default'])(''+_0x48edb7[_0x1ebdee(0x1a8)],_0x5290ae),'buttonText':_0x1ebdee(0x218),'sections':_0x7ad5fa},_0x4fcb40=await _0x22b144[_0x1ebdee(0x1a1)](_0xe1f905[_0x1ebdee(0x10e)]+'@'+(_0x5290ae[_0x1ebdee(0x1b8)]?_0x1ebdee(0x14d):_0x1ebdee(0x14b)),_0x426356);await(0x0,exports['verifyMessage'])(_0x4fcb40,_0x5290ae,_0xe1f905,_0x302bce);}if(!_0x48edb7['chatbots'][_0x1ebdee(0x197)]){const _0x22c46d=(0x0,Mustache_1[_0x1ebdee(0x115)])(''+_0x48edb7[_0x1ebdee(0x1a8)],_0x5290ae),_0x5527f7=await _0x22b144[_0x1ebdee(0x1a1)](_0xe1f905[_0x1ebdee(0x10e)]+'@'+(_0x5290ae[_0x1ebdee(0x1b8)]?_0x1ebdee(0x14d):_0x1ebdee(0x14b)),{'text':_0x22c46d});await(0x0,exports[_0x1ebdee(0xfc)])(_0x5527f7,_0x5290ae,_0xe1f905,_0x302bce);}}else{const _0x31ec46=[];_0x425d7d[_0x1ebdee(0xff)]((_0x74fa73,_0x524bf5)=>{const _0x1a6f35=_0x1ebdee;_0x31ec46['push']({'title':_0x74fa73[_0x1a6f35(0x104)],'rowId':''+(_0x524bf5+0x1)});});const _0x4a3df9=[{'title':'Menu','rows':_0x31ec46}],_0x5c2f23={'text':(0x0,Mustache_1['default'])(''+_0x14ff74,_0x5290ae),'buttonText':_0x1ebdee(0x218),'sections':_0x4a3df9},_0x555501=await _0x22b144['sendMessage'](_0xe1f905[_0x1ebdee(0x10e)]+'@'+(_0x5290ae[_0x1ebdee(0x1b8)]?'g.us':_0x1ebdee(0x14b)),_0x5c2f23);await(0x0,exports[_0x1ebdee(0xfc)])(_0x555501,_0x5290ae,_0xe1f905,_0x302bce),await(0x0,UpdateTicketService_1[_0x1ebdee(0x115)])({'ticketData':{'amountUsedBotQueues':_0x5290ae[_0x1ebdee(0x146)]+0x1},'ticketId':_0x5290ae['id'],'companyId':_0x5290ae[_0x1ebdee(0xf6)]});}};if(_0x58e3d2===_0xbf3aaf(0x1c5))return _0x3c5345();if(_0x58e3d2==='button'&&_0x425d7d['length']>0x3)return _0x3c5345();if(_0x58e3d2===_0xbf3aaf(0x19d)&&_0x425d7d[_0xbf3aaf(0x197)]<=0x3)return _0x5173a6();if(_0x58e3d2===_0xbf3aaf(0x179))return _0x49b0fe();},verifyRating=_0x2dbbed=>{const _0x656bf8=a533_0x224ed2;if(_0x2dbbed&&_0x2dbbed[_0x656bf8(0x1e9)]===null&&_0x2dbbed[_0x656bf8(0x169)]!==null&&_0x2dbbed[_0x656bf8(0x1e2)]!==null&&_0x2dbbed[_0x656bf8(0x1a6)]===null)return!![];return![];};exports[a533_0x224ed2(0x107)]=verifyRating;const handleRating=async(_0x4ad3a9,_0x2679b5,_0x292d50)=>{const _0x49ed49=a533_0x224ed2,_0x2fa6ad=(0x0,socket_1[_0x49ed49(0x161)])(),{complationMessage:_0x2215a1}=await(0x0,ShowWhatsAppService_1['default'])(_0x2679b5[_0x49ed49(0x1e0)],_0x2679b5[_0x49ed49(0xf6)]);let _0x2a7d2e=_0x4ad3a9;_0x4ad3a9<0x0&&(_0x2a7d2e=0x0);_0x4ad3a9>0xa&&(_0x2a7d2e=0xa);await UserRating_1[_0x49ed49(0x115)][_0x49ed49(0x1f5)]({'ticketId':_0x292d50[_0x49ed49(0x1b3)],'companyId':_0x292d50['companyId'],'userId':_0x292d50['userId'],'rate':_0x2a7d2e});if(!(0x0,lodash_1[_0x49ed49(0x1c6)])(_0x2215a1)&&_0x2215a1!==''&&!_0x2679b5[_0x49ed49(0x1b8)]){const _0x56190d=(0x0,Mustache_1[_0x49ed49(0x115)])('‎'+_0x2215a1,_0x2679b5);if(_0x2679b5[_0x49ed49(0x1b1)]==='whatsapp'){const _0xb1e9ee=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x56190d,'ticket':_0x2679b5});await(0x0,exports[_0x49ed49(0xfc)])(_0xb1e9ee,_0x2679b5,_0x2679b5[_0x49ed49(0x16f)],_0x292d50);}[_0x49ed49(0x199),'instagram']['includes'](_0x2679b5[_0x49ed49(0x1b1)])&&await(0x0,sendFacebookMessage_1[_0x49ed49(0x115)])({'body':_0x56190d,'ticket':_0x2679b5});}await _0x2679b5[_0x49ed49(0x15d)]({'chatbot':null,'status':_0x49ed49(0x1a3),'amountUseBotQueuesNPS':0x0}),_0x2fa6ad['to'](_0x49ed49(0x188))[_0x49ed49(0x11a)](_0x49ed49(0x156)+_0x2679b5[_0x49ed49(0xf6)]+_0x49ed49(0x1aa),{'action':_0x49ed49(0x13d),'ticket':_0x2679b5,'ticketId':_0x2679b5['id']}),_0x2fa6ad['to'](_0x2679b5[_0x49ed49(0x1d2)])['to'](_0x2679b5['id'][_0x49ed49(0x149)]())[_0x49ed49(0x11a)](_0x49ed49(0x156)+_0x2679b5[_0x49ed49(0xf6)]+_0x49ed49(0x1aa),{'action':_0x49ed49(0x15d),'ticket':_0x2679b5,'ticketId':_0x2679b5['id']}),!_0x2679b5[_0x49ed49(0x15c)]&&_0x2fa6ad['to'](_0x2679b5['status'])['to'](_0x2679b5['id']['toString']())[_0x49ed49(0x11a)](_0x49ed49(0x156)+_0x2679b5[_0x49ed49(0xf6)]+'-ticket',{'action':_0x49ed49(0x15d),'ticket':_0x2679b5,'ticketId':_0x2679b5['id']});};exports[a533_0x224ed2(0x1e3)]=handleRating;const handleMessage=async(_0x5eeddc,_0x29b8ba,_0x1d99f0,_0x36e7d1=![])=>{const _0x5b70c2=a533_0x224ed2;if(_0x36e7d1){let _0x33dfd7=_0x5eeddc[_0x5b70c2(0x1ff)]['id'],_0x31d104=await Message_1['default'][_0x5b70c2(0x130)]({'where':{'wid':_0x33dfd7}});if(_0x31d104){await new Promise(_0x3d6bd8=>setTimeout(_0x3d6bd8,0x96)),console['log'](_0x5b70c2(0x1b7));return;}else await new Promise(_0xa36fce=>setTimeout(_0xa36fce,parseInt(process[_0x5b70c2(0x162)]['TIMEOUT_TO_IMPORT_MESSAGE'])||0x14a));}else await new Promise(_0x2c3e67=>setTimeout(_0x2c3e67,i*0x28a)),console['log'](i),i++;if(!isValidMsg(_0x5eeddc))return;try{let _0x3717c2,_0x53cc35,_0x1b2b9f=0x0,_0x56d09e=0x0,_0x155662=0x0,_0x3fa0d2=(0x0,exports[_0x5b70c2(0x174)])(_0x5eeddc);const _0x2dacc9=getTypeMessage(_0x5eeddc);if(_0x2dacc9===_0x5b70c2(0x123))return;const _0x511952=_0x5eeddc['message']?.[_0x5b70c2(0x150)]||_0x5eeddc[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x122)]||_0x5eeddc[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x1eb)]||_0x5eeddc['message']?.['documentMessage']||_0x5eeddc['message'][_0x5b70c2(0x11c)]||_0x5eeddc?.[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x176)]?.['message']?.[_0x5b70c2(0x122)]||_0x5eeddc?.[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x176)]?.[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x150)]||_0x5eeddc?.[_0x5b70c2(0x1c7)]?.['ephemeralMessage']?.[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x1eb)]||_0x5eeddc?.[_0x5b70c2(0x1c7)]?.['ephemeralMessage']?.['message']?.[_0x5b70c2(0x14f)]||_0x5eeddc?.[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x176)]?.[_0x5b70c2(0x1c7)]?.['stickerMessage']||_0x5eeddc[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x1b0)]?.[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x122)]||_0x5eeddc[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x1b0)]?.['message']?.['videoMessage']||_0x5eeddc['message']?.[_0x5b70c2(0x176)]?.[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x1b0)]?.['message']?.['imageMessage']||_0x5eeddc['message']?.[_0x5b70c2(0x176)]?.[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x1b0)]?.['message']?.['videoMessage']||_0x5eeddc[_0x5b70c2(0x1c7)]?.['documentWithCaptionMessage']?.[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x14f)],_0x359d29=/\u200d/[_0x5b70c2(0x1a9)](_0x3fa0d2);if(_0x5eeddc[_0x5b70c2(0x1ff)][_0x5b70c2(0x19b)]){if(/\u200e/[_0x5b70c2(0x1a9)](_0x3fa0d2))return;if(!_0x511952&&_0x2dacc9!=='conversation'&&_0x2dacc9!==_0x5b70c2(0x200)&&_0x2dacc9!==_0x5b70c2(0x1df)&&_0x2dacc9!==_0x5b70c2(0x20b)&&_0x2dacc9!=='ephemeralMessage'&&_0x2dacc9!==_0x5b70c2(0x123)&&_0x2dacc9!=='viewOnceMessage'&&_0x2dacc9!==_0x5b70c2(0x1fa))return;_0x3717c2=await getContactMessage(_0x5eeddc,_0x29b8ba);}else _0x3717c2=await getContactMessage(_0x5eeddc,_0x29b8ba);const _0x32934f=_0x5eeddc[_0x5b70c2(0x1ff)][_0x5b70c2(0x171)]?.[_0x5b70c2(0x157)](_0x5b70c2(0x172)),_0x719658=await(0x0,ShowWhatsAppService_1[_0x5b70c2(0x115)])(_0x29b8ba['id'],_0x1d99f0);if(!_0x719658[_0x5b70c2(0x190)]&&_0x32934f)return;if(_0x32934f){const _0x1600ac=await _0x29b8ba[_0x5b70c2(0x1ca)](_0x5eeddc[_0x5b70c2(0x1ff)][_0x5b70c2(0x171)]),_0x284d7a={'id':_0x1600ac['id'],'name':_0x1600ac['subject']};_0x53cc35=await verifyContact(_0x284d7a,_0x29b8ba,_0x1d99f0);}const _0x1dccb4=await verifyContact(_0x3717c2,_0x29b8ba,_0x1d99f0);let _0x47f8eb=0x0,_0x241ee3=null;if(_0x5eeddc['key'][_0x5b70c2(0x19b)])await cache_1[_0x5b70c2(0x18f)]['set'](_0x5b70c2(0x112)+_0x1dccb4['id']+':unreads','0');else{const _0x43ef75=await cache_1['cacheLayer'][_0x5b70c2(0x1b4)](_0x5b70c2(0x112)+_0x1dccb4['id']+_0x5b70c2(0x100));_0x47f8eb=+_0x43ef75+0x1,await cache_1[_0x5b70c2(0x18f)][_0x5b70c2(0xfb)](_0x5b70c2(0x112)+_0x1dccb4['id']+_0x5b70c2(0x100),''+_0x47f8eb);}const _0x50497d=await(0x0,ListSettingsService_1[_0x5b70c2(0x115)])({'companyId':_0x1d99f0}),_0x32f9f5=_0x50497d[_0x5b70c2(0x203)](_0x5eb79a=>_0x5eb79a[_0x5b70c2(0x1ff)]===_0x5b70c2(0x137)),_0x591aae=_0x50497d[_0x5b70c2(0x203)](_0x17e803=>_0x17e803[_0x5b70c2(0x1ff)]===_0x5b70c2(0x16d)),_0xb6aea0=_0x50497d['find'](_0x36ecd8=>_0x36ecd8[_0x5b70c2(0x1ff)]===_0x5b70c2(0x1be)),_0x43edbf=_0x50497d[_0x5b70c2(0x203)](_0x519198=>_0x519198[_0x5b70c2(0x1ff)]===_0x5b70c2(0x20d)),{ticket:_0x389549,isCreated:_0x256488}=await(0x0,FindOrCreateTicketService_1[_0x5b70c2(0x115)])(_0x1dccb4,_0x719658,_0x47f8eb,_0x1d99f0,_0x1b2b9f,_0x155662,_0x53cc35,_0x5b70c2(0x195),_0x36e7d1,![],_0x50497d);_0x241ee3=_0x389549;if(_0x47f8eb===0x0&&_0x719658[_0x5b70c2(0x18b)]&&(0x0,Mustache_1['default'])(_0x719658['complationMessage'],_0x241ee3)===_0x3fa0d2)return;if(_0x2dacc9===_0x5b70c2(0x1fa)){const _0x2b4cbb=_0x5eeddc[_0x5b70c2(0x1c7)][_0x5b70c2(0x1fa)][_0x5b70c2(0x1c7)]['protocolMessage'][_0x5b70c2(0x1ff)]['id'],_0x46a93e=_0x5eeddc['message'][_0x5b70c2(0x1fa)]['message'][_0x5b70c2(0x123)][_0x5b70c2(0x1fa)]['conversation'],_0x413b25=(0x0,socket_1['getIO'])();try{const _0x558afa=await Message_1['default'][_0x5b70c2(0x130)]({'where':{'wid':_0x2b4cbb,'companyId':_0x1d99f0,'ticketId':_0x241ee3['id']}});if(!_0x558afa)return;await _0x558afa[_0x5b70c2(0x15d)]({'isEdited':!![],'body':_0x46a93e}),_0x413b25['to'](_0x558afa['ticketId']['toString']())[_0x5b70c2(0x11a)](_0x5b70c2(0x156)+_0x558afa[_0x5b70c2(0xf6)]+_0x5b70c2(0x117),{'action':'update','message':_0x558afa});}catch(_0x4410a4){Sentry[_0x5b70c2(0x216)](_0x4410a4),logger_1[_0x5b70c2(0x106)][_0x5b70c2(0x10c)](_0x5b70c2(0x103)+_0x4410a4);}return;}const _0x44777a=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x241ee3['id'],'companyId':_0x1d99f0,'whatsappId':_0x719658?.['id']});try{if(!_0x5eeddc[_0x5b70c2(0x1ff)]['fromMe']){if(_0x241ee3[_0x5b70c2(0x1d2)]===_0x5b70c2(0x111)&&_0x44777a!==null&&(0x0,exports[_0x5b70c2(0x107)])(_0x44777a)){if(!isNaN(parseFloat(_0x3fa0d2))){(0x0,exports[_0x5b70c2(0x1e3)])(parseFloat(_0x3fa0d2),_0x241ee3,_0x44777a),await _0x44777a[_0x5b70c2(0x15d)]({'ratingAt':(0x0,moment_1[_0x5b70c2(0x115)])()[_0x5b70c2(0x189)](),'finishedAt':(0x0,moment_1[_0x5b70c2(0x115)])()[_0x5b70c2(0x189)](),'rated':!![]});return;}else{if(_0x241ee3[_0x5b70c2(0x155)]<_0x719658[_0x5b70c2(0x1a4)]){let _0x5a7b48=_0x5b70c2(0x1d0);const _0x455eca=await _0x29b8ba[_0x5b70c2(0x1a1)](_0x241ee3[_0x5b70c2(0x16f)][_0x5b70c2(0x10e)]+'@'+(_0x241ee3[_0x5b70c2(0x1b8)]?_0x5b70c2(0x14d):'s.whatsapp.net'),{'text':_0x5a7b48});(0x0,exports['verifyMessage'])(_0x455eca,_0x241ee3,_0x1dccb4,_0x44777a),await(0x0,baileys_1[_0x5b70c2(0xfe)])(0x3e8);let _0x234035='‎'+_0x719658[_0x5b70c2(0x151)]+'\x0a';const _0x542dfb=await(0x0,SendWhatsAppMessage_1[_0x5b70c2(0x115)])({'body':_0x234035,'ticket':_0x241ee3});await(0x0,exports[_0x5b70c2(0xfc)])(_0x542dfb,_0x241ee3,_0x241ee3[_0x5b70c2(0x16f)]),await _0x241ee3[_0x5b70c2(0x15d)]({'amountUseBotQueuesNPS':_0x241ee3['amountUseBotQueuesNPS']+0x1});}return;}}if(!(0x0,lodash_1[_0x5b70c2(0x1c6)])(_0x32f9f5['value'])&&_0x32f9f5[_0x5b70c2(0x154)]===_0x5b70c2(0x12a)&&!_0x36e7d1){if(_0x241ee3[_0x5b70c2(0x1d2)]===_0x5b70c2(0x15e)&&(0x0,lodash_1[_0x5b70c2(0x1c6)])(_0x241ee3[_0x5b70c2(0x143)])&&!(0x0,lodash_1['isNil'])(_0x241ee3[_0x5b70c2(0x11d)])){let _0x40fae0=null;_0x5eeddc?.['message']?.[_0x5b70c2(0x114)]&&(_0x40fae0=~~+_0x5eeddc[_0x5b70c2(0x1c7)]?.[_0x5b70c2(0x114)]);if(!Number['isNaN'](_0x40fae0)&&Number['isInteger'](_0x40fae0)&&!(0x0,lodash_1[_0x5b70c2(0x121)])(_0x40fae0)&&_0x40fae0>0x0){if(_0x40fae0===0x1)await _0x1dccb4['update']({'lgpdAcceptedAt':(0x0,moment_1[_0x5b70c2(0x115)])()[_0x5b70c2(0x189)]()}),await _0x241ee3['update']({'lgpdAcceptedAt':(0x0,moment_1[_0x5b70c2(0x115)])()[_0x5b70c2(0x189)](),'amountUsedBotQueues':0x0});else{if(_0x40fae0===0x2){if(_0x719658[_0x5b70c2(0x18b)]!==''&&_0x719658[_0x5b70c2(0x18b)]!==undefined){const _0x27a32d=await _0x29b8ba[_0x5b70c2(0x1a1)](_0x241ee3[_0x5b70c2(0x16f)]['number']+'@'+(_0x241ee3[_0x5b70c2(0x1b8)]?_0x5b70c2(0x14d):'s.whatsapp.net'),{'text':'‎'+_0x719658[_0x5b70c2(0x18b)]});(0x0,exports[_0x5b70c2(0xfc)])(_0x27a32d,_0x241ee3,_0x1dccb4,_0x44777a);}await _0x241ee3['update']({'status':'closed','amountUsedBotQueues':0x0}),await _0x44777a[_0x5b70c2(0x158)];return;}else _0x241ee3['amountUsedBotQueues']<_0x719658[_0x5b70c2(0x119)]&&await _0x241ee3[_0x5b70c2(0x15d)]({'amountUsedBotQueues':_0x241ee3[_0x5b70c2(0x146)]+0x1,'lgpdSendMessageAt':null});}}else _0x241ee3[_0x5b70c2(0x146)]<_0x719658['maxUseBotQueues']&&await _0x241ee3[_0x5b70c2(0x15d)]({'amountUsedBotQueues':_0x241ee3[_0x5b70c2(0x146)]+0x1,'lgpdSendMessageAt':null});}if((_0x1dccb4[_0x5b70c2(0x143)]===null||_0x43edbf[_0x5b70c2(0x154)]===_0x5b70c2(0x12a))&&!_0x1dccb4[_0x5b70c2(0x1b8)]&&(_0x241ee3[_0x5b70c2(0x1d2)]===_0x5b70c2(0x15e)&&(0x0,lodash_1[_0x5b70c2(0x1c6)])(_0x241ee3[_0x5b70c2(0x11d)]))&&_0x241ee3[_0x5b70c2(0x146)]<=_0x719658[_0x5b70c2(0x119)]&&!(0x0,lodash_1[_0x5b70c2(0x1c6)])(_0x591aae[_0x5b70c2(0x154)])&&!(0x0,lodash_1[_0x5b70c2(0x1c6)])(_0xb6aea0[_0x5b70c2(0x154)])){_0x511952?await verifyMediaMessage(_0x5eeddc,_0x241ee3,_0x1dccb4):await(0x0,exports[_0x5b70c2(0xfc)])(_0x5eeddc,_0x241ee3,_0x1dccb4,_0x44777a,_0x359d29);if(_0x591aae[_0x5b70c2(0x154)]!==undefined&&_0x591aae['value']!==''){const _0x523992=(0x0,Mustache_1[_0x5b70c2(0x115)])('‎'+_0x591aae[_0x5b70c2(0x154)],_0x241ee3),_0x3f0abc=await _0x29b8ba['sendMessage'](_0x241ee3['contact'][_0x5b70c2(0x10e)]+'@'+(_0x241ee3[_0x5b70c2(0x1b8)]?_0x5b70c2(0x14d):_0x5b70c2(0x14b)),{'text':_0x523992});(0x0,exports['verifyMessage'])(_0x3f0abc,_0x241ee3,_0x1dccb4,_0x44777a);}await(0x0,baileys_1['delay'])(0x3e8);if(_0xb6aea0['value']!==undefined&&_0xb6aea0[_0x5b70c2(0x154)]!==''){const _0x1c129a=(0x0,Mustache_1[_0x5b70c2(0x115)])('‎'+_0xb6aea0[_0x5b70c2(0x154)],_0x241ee3),_0x8416c0=await _0x29b8ba[_0x5b70c2(0x1a1)](_0x241ee3[_0x5b70c2(0x16f)][_0x5b70c2(0x10e)]+'@'+(_0x241ee3[_0x5b70c2(0x1b8)]?_0x5b70c2(0x14d):'s.whatsapp.net'),{'text':_0x1c129a});await(0x0,exports['verifyMessage'])(_0x8416c0,_0x241ee3,_0x1dccb4,_0x44777a);};await(0x0,baileys_1[_0x5b70c2(0xfe)])(0x3e8);const _0x197eda=(0x0,Mustache_1[_0x5b70c2(0x115)])(_0x5b70c2(0x1ec),_0x241ee3),_0x23d5b9=await _0x29b8ba[_0x5b70c2(0x1a1)](_0x241ee3[_0x5b70c2(0x16f)]['number']+'@'+(_0x241ee3[_0x5b70c2(0x1b8)]?'g.us':_0x5b70c2(0x14b)),{'text':_0x197eda});await(0x0,exports[_0x5b70c2(0xfc)])(_0x23d5b9,_0x241ee3,_0x1dccb4,_0x44777a),await _0x241ee3[_0x5b70c2(0x15d)]({'lgpdSendMessageAt':(0x0,moment_1[_0x5b70c2(0x115)])()[_0x5b70c2(0x189)](),'amountUsedBotQueues':_0x241ee3[_0x5b70c2(0x146)]+0x1}),await _0x241ee3['reload']();return;};if(!(0x0,lodash_1[_0x5b70c2(0x1c6)])(_0x241ee3['lgpdSendMessageAt'])&&(0x0,lodash_1[_0x5b70c2(0x1c6)])(_0x241ee3[_0x5b70c2(0x143)]))return;}}}catch(_0x324f48){Sentry[_0x5b70c2(0x216)](_0x324f48),console[_0x5b70c2(0x13f)](_0x324f48);}_0x511952?await verifyMediaMessage(_0x5eeddc,_0x241ee3,_0x1dccb4):await(0x0,exports[_0x5b70c2(0xfc)])(_0x5eeddc,_0x241ee3,_0x1dccb4,_0x44777a,_0x359d29);try{await _0x241ee3['update']({'fromMe':_0x5eeddc[_0x5b70c2(0x1ff)][_0x5b70c2(0x19b)]});}catch(_0x4394c3){Sentry[_0x5b70c2(0x216)](_0x4394c3),console['log'](_0x4394c3);}const _0x5b9eac=await Setting_1[_0x5b70c2(0x115)][_0x5b70c2(0x130)]({'where':{'companyId':_0x1d99f0,'key':_0x5b70c2(0xf2)}}),_0x37bada=await Setting_1[_0x5b70c2(0x115)][_0x5b70c2(0x130)]({'where':{'companyId':_0x1d99f0,'key':_0x5b70c2(0x118)}});let _0x230d16;_0x5b9eac[_0x5b70c2(0x154)]===_0x5b70c2(0x14c)&&(_0x230d16=await(0x0,VerifyCurrentSchedule_1['default'])(_0x1d99f0));try{if(!_0x5eeddc[_0x5b70c2(0x1ff)][_0x5b70c2(0x19b)]&&_0x5b9eac){if(_0x5b9eac[_0x5b70c2(0x154)]===_0x5b70c2(0x14c)&&!(0x0,lodash_1['isNil'])(_0x230d16)&&(!_0x230d16||_0x230d16[_0x5b70c2(0x1c2)]===![])){if(_0x719658['outOfHoursMessage']!==''){const _0x1e078f=(0x0,Mustache_1[_0x5b70c2(0x115)])(''+_0x719658[_0x5b70c2(0x1f6)],_0x241ee3),_0x19ef8a=(0x0,Debounce_1['debounce'])(async()=>{const _0x23671b=_0x5b70c2;await _0x29b8ba[_0x23671b(0x1a1)](_0x241ee3[_0x23671b(0x16f)][_0x23671b(0x10e)]+'@'+(_0x241ee3[_0x23671b(0x1b8)]?_0x23671b(0x14d):_0x23671b(0x14b)),{'text':_0x1e078f});},0x3e8,_0x241ee3['id']);_0x19ef8a();return;}return;}}}catch(_0x4e08bc){Sentry['captureException'](_0x4e08bc),console[_0x5b70c2(0x13f)](_0x4e08bc);}!_0x241ee3['imported']&&!_0x241ee3[_0x5b70c2(0x1f7)]&&!_0x32934f&&!_0x5eeddc[_0x5b70c2(0x1ff)][_0x5b70c2(0x19b)]&&!_0x241ee3[_0x5b70c2(0x1e2)]&&_0x719658[_0x5b70c2(0x1bc)][_0x5b70c2(0x197)]>=0x1&&(await verifyQueue(_0x29b8ba,_0x5eeddc,_0x241ee3,_0x1dccb4,_0x50497d),_0x44777a[_0x5b70c2(0x168)]===null&&await _0x44777a['update']({'chatbotAt':(0x0,moment_1[_0x5b70c2(0x115)])()[_0x5b70c2(0x189)]()}));_0x241ee3['queueId']>0x0&&await _0x44777a[_0x5b70c2(0x15d)]({'queueId':_0x241ee3[_0x5b70c2(0x205)]});if(getTypeMessage(_0x5eeddc)===_0x5b70c2(0x150)&&!_0x5eeddc[_0x5b70c2(0x1ff)][_0x5b70c2(0x19b)]&&!_0x32934f&&!_0x1dccb4['acceptAudioMessage']&&_0x37bada[_0x5b70c2(0x154)]===_0x5b70c2(0x145)){const _0x499ddd=await _0x29b8ba[_0x5b70c2(0x1a1)](_0x1dccb4[_0x5b70c2(0x10e)]+_0x5b70c2(0x1d3),{'text':_0x5b70c2(0x16a)},{'quoted':{'key':_0x5eeddc['key'],'message':{'extendedTextMessage':_0x5eeddc[_0x5b70c2(0x1c7)][_0x5b70c2(0x200)]}}});await(0x0,exports['verifyMessage'])(_0x499ddd,_0x241ee3,_0x1dccb4,_0x44777a);}try{if(!_0x5eeddc[_0x5b70c2(0x1ff)][_0x5b70c2(0x19b)]&&_0x5b9eac&&_0x241ee3['queueId']!==null){const _0x3e0ec2=await Queue_1[_0x5b70c2(0x115)][_0x5b70c2(0x1a5)](_0x241ee3[_0x5b70c2(0x205)]);_0x5b9eac[_0x5b70c2(0x154)]===_0x5b70c2(0x1f7)&&(_0x230d16=await(0x0,VerifyCurrentSchedule_1[_0x5b70c2(0x115)])(_0x1d99f0,_0x3e0ec2['id']));if(_0x5b9eac[_0x5b70c2(0x154)]==='queue'&&!(0x0,lodash_1[_0x5b70c2(0x1c6)])(_0x230d16)&&(!_0x230d16||_0x230d16['inActivity']===![])){const _0x4fc59b=_0x3e0ec2[_0x5b70c2(0x1f6)];if(_0x4fc59b!==''){const _0x5de6e7=(0x0,Mustache_1[_0x5b70c2(0x115)])(''+_0x4fc59b,_0x241ee3),_0x4a8450=(0x0,Debounce_1[_0x5b70c2(0x1ad)])(async()=>{const _0x22696e=_0x5b70c2;await _0x29b8ba[_0x22696e(0x1a1)](_0x241ee3[_0x22696e(0x16f)][_0x22696e(0x10e)]+'@'+(_0x241ee3[_0x22696e(0x1b8)]?_0x22696e(0x14d):_0x22696e(0x14b)),{'text':_0x5de6e7});},0x3e8,_0x241ee3['id']);_0x4a8450();return;}return;}}}catch(_0x460b6b){Sentry[_0x5b70c2(0x216)](_0x460b6b),console['log'](_0x460b6b);}_0x241ee3['queue']&&_0x241ee3[_0x5b70c2(0x205)]&&!_0x5eeddc['key'][_0x5b70c2(0x19b)]&&(!_0x241ee3['user']&&await(0x0,ChatBotListener_1[_0x5b70c2(0x110)])(_0x241ee3['queueId'],_0x29b8ba,_0x241ee3,_0x1dccb4,_0x5eeddc),await _0x241ee3['update']({'sendInactiveMessage':![]})),await _0x241ee3['reload']();}catch(_0x2574b3){Sentry[_0x5b70c2(0x216)](_0x2574b3),console[_0x5b70c2(0x13f)](_0x2574b3),logger_1[_0x5b70c2(0x106)][_0x5b70c2(0x10c)]('Error\x20handling\x20whatsapp\x20message:\x20Err:\x20'+_0x2574b3);}};exports[a533_0x224ed2(0x17d)]=handleMessage;function a533_0x1c65(_0x1f0f0e,_0x3d3e58){const _0x24bc1a=a533_0x24bc();return a533_0x1c65=function(_0x1c6587,_0xf81822){_0x1c6587=_0x1c6587-0xef;let _0x546f02=_0x24bc1a[_0x1c6587];return _0x546f02;},a533_0x1c65(_0x1f0f0e,_0x3d3e58);}const handleMsgAck=async(_0x4da8e1,_0xf93030)=>{const _0x5e5ea0=a533_0x224ed2;await new Promise(_0x2e4e7e=>setTimeout(_0x2e4e7e,0x1f4));const _0x4eff4e=(0x0,socket_1[_0x5e5ea0(0x161)])();try{const _0x4e1a9=await Message_1[_0x5e5ea0(0x115)][_0x5e5ea0(0x130)]({'where':{'wid':_0x4da8e1[_0x5e5ea0(0x1ff)]['id']},'include':[_0x5e5ea0(0x16f),{'model':Message_1[_0x5e5ea0(0x115)],'as':_0x5e5ea0(0x1a0),'include':[_0x5e5ea0(0x16f)]}]});if(!_0x4e1a9)return;await _0x4e1a9[_0x5e5ea0(0x15d)]({'ack':_0xf93030}),_0x4eff4e['to'](_0x4e1a9[_0x5e5ea0(0x1b3)][_0x5e5ea0(0x149)]())[_0x5e5ea0(0x11a)](_0x5e5ea0(0x156)+_0x4e1a9[_0x5e5ea0(0xf6)]+_0x5e5ea0(0x117),{'action':_0x5e5ea0(0x15d),'message':_0x4e1a9});}catch(_0xfa333){Sentry['captureException'](_0xfa333),logger_1['logger'][_0x5e5ea0(0x10c)](_0x5e5ea0(0x103)+_0xfa333);}},verifyRecentCampaign=async(_0x5b964a,_0x27396e)=>{const _0xc9e361=a533_0x224ed2;if(!isValidMsg(_0x5b964a))return;if(!_0x5b964a[_0xc9e361(0x1ff)][_0xc9e361(0x19b)]){const _0x48a996=_0x5b964a[_0xc9e361(0x1ff)][_0xc9e361(0x171)][_0xc9e361(0x1bf)](/\D/g,''),_0x57fcec=await Campaign_1[_0xc9e361(0x115)][_0xc9e361(0x1cc)]({'where':{'companyId':_0x27396e,'status':_0xc9e361(0x1e8),'confirmation':!![]}});if(_0x57fcec){const _0x179d32=_0x57fcec[_0xc9e361(0x1fd)](_0x34c817=>_0x34c817['id']),_0x228952=await CampaignShipping_1[_0xc9e361(0x115)][_0xc9e361(0x130)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x179d32},'number':_0x48a996,'confirmation':null}});_0x228952&&(await _0x228952[_0xc9e361(0x15d)]({'confirmedAt':(0x0,moment_1['default'])(),'confirmation':!![]}),await queues_1['campaignQueue']['add'](_0xc9e361(0x1a2),{'campaignShippingId':_0x228952['id'],'campaignId':_0x228952['campaignId']},{'delay':(0x0,queues_1[_0xc9e361(0xfa)])((0x0,queues_1[_0xc9e361(0x1f8)])(0x0,0xa))}));}}},verifyCampaignMessageAndCloseTicket=async(_0x407305,_0xb4bd6)=>{const _0x41b2a=a533_0x224ed2;if(!isValidMsg(_0x407305))return;const _0x2c2e84=(0x0,socket_1['getIO'])(),_0x4e0e3f=(0x0,exports['getBodyMessage'])(_0x407305),_0x3931c5=/\u200c/['test'](_0x4e0e3f);if(_0x407305[_0x41b2a(0x1ff)]['fromMe']&&_0x3931c5){const _0x419712=await Message_1[_0x41b2a(0x115)][_0x41b2a(0x130)]({'where':{'wid':_0x407305[_0x41b2a(0x1ff)]['id'],'companyId':_0xb4bd6}}),_0xd4b582=await Ticket_1[_0x41b2a(0x115)][_0x41b2a(0x1a5)](_0x419712[_0x41b2a(0x1b3)]);await _0xd4b582[_0x41b2a(0x15d)]({'status':_0x41b2a(0x1a3),'amountUsedBotQueues':0x0}),_0x2c2e84['to'](_0x41b2a(0x188))[_0x41b2a(0x11a)](_0x41b2a(0x156)+_0xd4b582[_0x41b2a(0xf6)]+_0x41b2a(0x1aa),{'action':_0x41b2a(0x13d),'ticket':_0xd4b582,'ticketId':_0xd4b582['id']}),!_0xd4b582[_0x41b2a(0x15c)]&&_0x2c2e84['to'](_0xd4b582['status'])['to'](_0xd4b582['id'][_0x41b2a(0x149)]())[_0x41b2a(0x11a)]('company-'+_0xd4b582[_0x41b2a(0xf6)]+_0x41b2a(0x1aa),{'action':'update','ticket':_0xd4b582,'ticketId':_0xd4b582['id']});}},filterMessages=_0x23ef18=>{const _0x3a5f55=a533_0x224ed2;if(_0x23ef18[_0x3a5f55(0x1c7)]?.[_0x3a5f55(0x123)])return![];if([baileys_1[_0x3a5f55(0x13c)]['REVOKE'],baileys_1[_0x3a5f55(0x13c)]['E2E_DEVICE_CHANGED'],baileys_1[_0x3a5f55(0x13c)][_0x3a5f55(0x1c9)],baileys_1['WAMessageStubType'][_0x3a5f55(0x170)]][_0x3a5f55(0x13e)](_0x23ef18[_0x3a5f55(0x1c3)]))return![];return!![];},wbotMessageListener=(_0x13577f,_0x2f7394)=>{const _0x2ca32d=a533_0x224ed2;_0x13577f['ev']['on'](_0x2ca32d(0x1e6),async _0x255c27=>{const _0x59e067=_0x2ca32d,_0x24ff83=_0x255c27[_0x59e067(0x10d)][_0x59e067(0x1b9)](filterMessages)['map'](_0x1cf800=>_0x1cf800);if(!_0x24ff83)return;_0x24ff83['forEach'](async _0x3d7945=>{const _0x2fa390=_0x59e067,_0x30cd74=await Message_1[_0x2fa390(0x115)][_0x2fa390(0x186)]({'where':{'wid':_0x3d7945['key']['id'],'companyId':_0x2f7394}});if(!_0x30cd74){let _0x3c8373=![],_0x455a15=await(0x0,exports['getBodyMessage'])(_0x3d7945);const _0x3e5116=_0x3d7945?.['key']?.[_0x2fa390(0x19b)];if(_0x3e5116)_0x3c8373=/\u200c/[_0x2fa390(0x1a9)](_0x455a15);else{if(/\u200c/[_0x2fa390(0x1a9)](_0x455a15))_0x455a15=_0x455a15[_0x2fa390(0x1bf)](/\u200c/,'');logger_1[_0x2fa390(0x106)]['debug'](_0x2fa390(0x16b)+_0x455a15);}!_0x3c8373&&await handleMessage(_0x3d7945,_0x13577f,_0x2f7394),await verifyRecentCampaign(_0x3d7945,_0x2f7394),await verifyCampaignMessageAndCloseTicket(_0x3d7945,_0x2f7394);}_0x3d7945['key'][_0x2fa390(0x171)]?.[_0x2fa390(0x157)](_0x2fa390(0x172))&&handleMsgAck(_0x3d7945,0x2);});}),_0x13577f['ev']['on'](_0x2ca32d(0x202),_0xea26c6=>{const _0x3ac3ac=_0x2ca32d;if(_0xea26c6[_0x3ac3ac(0x197)]===0x0)return;_0xea26c6[_0x3ac3ac(0xff)](async _0x41c555=>{const _0x4551f3=_0x3ac3ac;_0x13577f['readMessages']([_0x41c555[_0x4551f3(0x1ff)]]);const _0x3d48cb={..._0xea26c6};_0x3d48cb['0']?.['update'][_0x4551f3(0x1c3)]===0x1&&_0x3d48cb['0']?.[_0x4551f3(0x1ff)]['remoteJid']!=='status@broadcast'&&(0x0,MarkDeleteWhatsAppMessage_1[_0x4551f3(0x115)])(_0x3d48cb['0']?.[_0x4551f3(0x1ff)]['remoteJid'],null,_0x3d48cb['0']?.[_0x4551f3(0x1ff)]['id'],_0x2f7394);let _0x15faa0;_0x41c555[_0x4551f3(0x15d)][_0x4551f3(0x1d2)]===0x3&&_0x41c555?.[_0x4551f3(0x1ff)]?.['fromMe']?_0x15faa0=0x2:_0x15faa0=_0x41c555[_0x4551f3(0x15d)]['status'],handleMsgAck(_0x41c555,_0x15faa0);});}),_0x13577f['ev']['on']('groups.update',_0x31f19f=>{const _0x2320b6=_0x2ca32d;if(_0x31f19f[_0x2320b6(0x197)]===0x0)return;_0x31f19f['forEach'](async _0x198cd5=>{const _0x308149=_0x2320b6,_0x4d8659=_0x198cd5['id'][_0x308149(0x1bf)](/\D/g,''),_0x1772bf=_0x198cd5[_0x308149(0x178)]||_0x4d8659,_0x30465e={'name':_0x1772bf,'number':_0x4d8659,'isGroup':!![],'companyId':_0x2f7394},_0x2d5de4=await(0x0,CreateOrUpdateContactService_1[_0x308149(0x115)])(_0x30465e);});});};exports['wbotMessageListener']=wbotMessageListener;