'use strict';const a552_0xc40998=a552_0x182d;(function(_0x552c96,_0x22d783){const _0x53534a=a552_0x182d,_0x171e64=_0x552c96();while(!![]){try{const _0x3b2b4c=-parseInt(_0x53534a(0x181))/0x1+-parseInt(_0x53534a(0x20b))/0x2*(-parseInt(_0x53534a(0x232))/0x3)+-parseInt(_0x53534a(0x1da))/0x4*(-parseInt(_0x53534a(0x1b2))/0x5)+parseInt(_0x53534a(0x182))/0x6+-parseInt(_0x53534a(0x1ac))/0x7*(-parseInt(_0x53534a(0x27e))/0x8)+parseInt(_0x53534a(0x170))/0x9+-parseInt(_0x53534a(0x216))/0xa*(parseInt(_0x53534a(0x25b))/0xb);if(_0x3b2b4c===_0x22d783)break;else _0x171e64['push'](_0x171e64['shift']());}catch(_0xa45fbc){_0x171e64['push'](_0x171e64['shift']());}}}(a552_0x58f7,0xda0bd));var __createBinding=this&&this[a552_0xc40998(0x289)]||(Object[a552_0xc40998(0x253)]?function(_0xaca499,_0x8b9d14,_0x3962f4,_0x118a09){const _0xe6e129=a552_0xc40998;if(_0x118a09===undefined)_0x118a09=_0x3962f4;var _0x3fec97=Object[_0xe6e129(0x16e)](_0x8b9d14,_0x3962f4);(!_0x3fec97||(_0xe6e129(0x21f)in _0x3fec97?!_0x8b9d14['__esModule']:_0x3fec97[_0xe6e129(0x1b4)]||_0x3fec97['configurable']))&&(_0x3fec97={'enumerable':!![],'get':function(){return _0x8b9d14[_0x3962f4];}}),Object[_0xe6e129(0x171)](_0xaca499,_0x118a09,_0x3fec97);}:function(_0x26ae90,_0x3b910e,_0x44d96d,_0x348e72){if(_0x348e72===undefined)_0x348e72=_0x44d96d;_0x26ae90[_0x348e72]=_0x3b910e[_0x44d96d];}),__setModuleDefault=this&&this[a552_0xc40998(0x17c)]||(Object['create']?function(_0x643378,_0x1320fc){const _0x343e43=a552_0xc40998;Object[_0x343e43(0x171)](_0x643378,_0x343e43(0x225),{'enumerable':!![],'value':_0x1320fc});}:function(_0x21af11,_0x496e8c){const _0x373d12=a552_0xc40998;_0x21af11[_0x373d12(0x225)]=_0x496e8c;}),__importStar=this&&this['__importStar']||function(_0x49de9e){const _0x592f96=a552_0xc40998;if(_0x49de9e&&_0x49de9e['__esModule'])return _0x49de9e;var _0x5590bf={};if(_0x49de9e!=null){for(var _0x5913d8 in _0x49de9e)if(_0x5913d8!=='default'&&Object[_0x592f96(0x18e)]['hasOwnProperty']['call'](_0x49de9e,_0x5913d8))__createBinding(_0x5590bf,_0x49de9e,_0x5913d8);}return __setModuleDefault(_0x5590bf,_0x49de9e),_0x5590bf;},__importDefault=this&&this[a552_0xc40998(0x19c)]||function(_0xe109a){const _0x58af55=a552_0xc40998;return _0xe109a&&_0xe109a[_0x58af55(0x165)]?_0xe109a:{'default':_0xe109a};};Object[a552_0xc40998(0x171)](exports,a552_0xc40998(0x165),{'value':!![]}),exports[a552_0xc40998(0x25a)]=exports['isValidMsg']=exports[a552_0xc40998(0x1c8)]=exports['wbotMessageListener']=exports[a552_0xc40998(0x295)]=exports[a552_0xc40998(0x1a0)]=exports[a552_0xc40998(0x172)]=exports[a552_0xc40998(0x1b1)]=exports['getQuotedMessage']=exports[a552_0xc40998(0x276)]=void 0x0;const path_1=__importStar(require(a552_0xc40998(0x162))),util_1=require('util'),fs_1=require('fs'),fs_2=__importDefault(require('fs')),Sentry=__importStar(require(a552_0xc40998(0x17f))),lodash_1=require(a552_0xc40998(0x185)),baileys_1=require('@whiskeysockets/baileys'),Contact_1=__importDefault(require(a552_0xc40998(0x1cc))),Ticket_1=__importDefault(require(a552_0xc40998(0x28d))),Message_1=__importDefault(require(a552_0xc40998(0x270))),socket_1=require(a552_0xc40998(0x1ed)),CreateMessageService_1=__importDefault(require(a552_0xc40998(0x26a))),logger_1=require('../../utils/logger'),CreateOrUpdateContactService_1=__importDefault(require(a552_0xc40998(0x299))),FindOrCreateTicketService_1=__importDefault(require(a552_0xc40998(0x203))),ShowWhatsAppService_1=__importDefault(require(a552_0xc40998(0x22d))),Debounce_1=require(a552_0xc40998(0x16f)),UpdateTicketService_1=__importDefault(require(a552_0xc40998(0x196))),Mustache_1=__importDefault(require(a552_0xc40998(0x20e))),UserRating_1=__importDefault(require(a552_0xc40998(0x19e))),SendWhatsAppMessage_1=__importDefault(require(a552_0xc40998(0x24f))),sendFacebookMessage_1=__importDefault(require(a552_0xc40998(0x21b))),moment_1=__importDefault(require('moment')),Queue_1=__importDefault(require(a552_0xc40998(0x283))),FindOrCreateATicketTrakingService_1=__importDefault(require(a552_0xc40998(0x290))),VerifyCurrentSchedule_1=__importDefault(require('../CompanyService/VerifyCurrentSchedule')),Campaign_1=__importDefault(require('../../models/Campaign')),CampaignShipping_1=__importDefault(require(a552_0xc40998(0x285))),sequelize_1=require(a552_0xc40998(0x236)),queues_1=require(a552_0xc40998(0x220)),User_1=__importDefault(require(a552_0xc40998(0x163))),Setting_1=__importDefault(require(a552_0xc40998(0x1f1))),ChatBotListener_1=require(a552_0xc40998(0x1dc)),MarkDeleteWhatsAppMessage_1=__importDefault(require('./MarkDeleteWhatsAppMessage')),ListUserQueueServices_1=__importDefault(require('../UserQueueServices/ListUserQueueServices')),cache_1=__importDefault(require(a552_0xc40998(0x16d))),ListSettingsService_1=__importDefault(require(a552_0xc40998(0x1e8))),addLogs_1=require('../../helpers/addLogs'),SendWhatsAppMedia_1=require('./SendWhatsAppMedia');let i=0x0;function a552_0x182d(_0xe105cf,_0x5d4223){const _0x58f7dd=a552_0x58f7();return a552_0x182d=function(_0x182d1b,_0x45c328){_0x182d1b=_0x182d1b-0x162;let _0x49fbb8=_0x58f7dd[_0x182d1b];return _0x49fbb8;},a552_0x182d(_0xe105cf,_0x5d4223);}setInterval(()=>{i=0x0;},0x1388);const writeFileAsync=(0x0,util_1[a552_0xc40998(0x1a8)])(fs_1[a552_0xc40998(0x176)]);function removeFile(_0x1fc6fd){const _0x6a1e46=a552_0xc40998;fs_2[_0x6a1e46(0x225)]['unlink'](_0x1fc6fd,_0x442b1c=>{if(_0x442b1c)throw _0x442b1c;});}const getTimestampMessage=_0x50681a=>{return _0x50681a*0x1;},multVecardGet=function(_0x551ce0){const _0xe6d952=a552_0xc40998;let _0x104bd0='\x20',_0x125016=_0x551ce0[_0xe6d952(0x1fb)]('\x0a')[0x2]['replace'](_0xe6d952(0x169),'\x0a')[_0xe6d952(0x298)]('N:','')[_0xe6d952(0x298)](';','')['replace'](';','\x20')[_0xe6d952(0x298)](';;','\x20')[_0xe6d952(0x298)]('\x0a',''),_0x305b46=_0x551ce0[_0xe6d952(0x1fb)]('\x0a')[0x4][_0xe6d952(0x1e7)]('='),_0xc49bea=_0x551ce0[_0xe6d952(0x1fb)]('\x0a')[0x4][_0xe6d952(0x1e7)](':'),_0x352a14=_0x551ce0[_0xe6d952(0x1fb)]('\x0a')[0x4][_0xe6d952(0x29b)](_0x305b46+0x1,_0xc49bea)[_0xe6d952(0x298)](';',''),_0x4eedee=_0x551ce0[_0xe6d952(0x1fb)]('\x0a')[0x4]['replace'](_0xe6d952(0x28b),'');if(_0x352a14!=_0xe6d952(0x1c9))_0x104bd0=_0x104bd0+_0x125016+_0xe6d952(0x219)+_0x352a14+''+'\x0a';else _0x104bd0=_0x104bd0+_0x125016+':\x20ðŸ“ž'+_0x4eedee+''+'\x0a';return _0x104bd0;},contactsArrayMessageGet=_0x184d45=>{const _0x22383e=a552_0xc40998;let _0x4f5995=_0x184d45[_0x22383e(0x264)]?.[_0x22383e(0x1e6)]?.[_0x22383e(0x22c)],_0x67ba59=_0x4f5995[_0x22383e(0x177)](function(_0x312bb7,_0x52402c){return _0x312bb7['vcard'];}),_0x3a4a99='';_0x67ba59[_0x22383e(0x1f3)](function(_0x49cac2,_0x19d72f){_0x3a4a99+=_0x49cac2+'\x0a\x0a'+'';});let _0x405755=_0x3a4a99[_0x22383e(0x1fb)]('BEGIN:');_0x405755['shift']();let _0x1d495d='';for(let _0x7cd92d of _0x405755){_0x1d495d=_0x1d495d+multVecardGet(_0x7cd92d);}return _0x1d495d;},getTypeMessage=_0x215599=>{const _0x233f2b=a552_0xc40998,_0x357432=(0x0,baileys_1[_0x233f2b(0x1df)])(_0x215599['message']);if(_0x215599[_0x233f2b(0x264)]?.[_0x233f2b(0x1f2)])return _0x233f2b(0x1f2);return _0x357432;};exports['getTypeMessage']=getTypeMessage;const getBodyButton=_0x1a799e=>{const _0x504a86=a552_0xc40998;if(_0x1a799e[_0x504a86(0x1ea)][_0x504a86(0x1d7)]&&_0x1a799e[_0x504a86(0x264)][_0x504a86(0x230)]?.[_0x504a86(0x1af)]){let _0xc40360=''+_0x1a799e?.['message']?.[_0x504a86(0x230)]?.[_0x504a86(0x1af)];for(const _0x2a43df of _0x1a799e['message']?.[_0x504a86(0x230)]?.[_0x504a86(0x274)]){_0xc40360+='\x0a\x0a'+_0x2a43df[_0x504a86(0x215)]?.[_0x504a86(0x1fa)];}return _0xc40360;}if(_0x1a799e[_0x504a86(0x1ea)][_0x504a86(0x1d7)]&&_0x1a799e?.[_0x504a86(0x264)]?.[_0x504a86(0x243)]?.[_0x504a86(0x264)]?.[_0x504a86(0x191)]){let _0x3697b4=''+_0x1a799e?.[_0x504a86(0x264)]?.[_0x504a86(0x243)]?.[_0x504a86(0x264)]?.[_0x504a86(0x191)]?.[_0x504a86(0x257)];for(const _0x2ce3f2 of _0x1a799e[_0x504a86(0x264)]?.[_0x504a86(0x243)]?.[_0x504a86(0x264)]?.[_0x504a86(0x191)]?.[_0x504a86(0x27c)]){for(const _0x261e0d of _0x2ce3f2['rows']){_0x3697b4+='\x0a\x0a'+_0x261e0d[_0x504a86(0x275)];}}return _0x3697b4;}},getBodyList=_0x4266dd=>{const _0x295bdc=a552_0xc40998;if(_0x4266dd[_0x295bdc(0x1ea)][_0x295bdc(0x1d7)]&&_0x4266dd[_0x295bdc(0x264)][_0x295bdc(0x191)]?.[_0x295bdc(0x257)]){let _0x51267e=''+_0x4266dd['message'][_0x295bdc(0x191)]?.['description'];for(const _0x4c51ba of _0x4266dd[_0x295bdc(0x264)][_0x295bdc(0x191)]?.[_0x295bdc(0x27c)]){for(const _0x1229b2 of _0x4c51ba[_0x295bdc(0x1d9)]){_0x51267e+='\x0a\x0a'+_0x1229b2[_0x295bdc(0x275)];}}return _0x51267e;}if(_0x4266dd[_0x295bdc(0x1ea)][_0x295bdc(0x1d7)]&&_0x4266dd?.[_0x295bdc(0x264)]?.['viewOnceMessage']?.['message']?.[_0x295bdc(0x191)]){let _0x2a1e91=''+_0x4266dd?.['message']?.[_0x295bdc(0x243)]?.['message']?.[_0x295bdc(0x191)]?.[_0x295bdc(0x257)];for(const _0x33a1f8 of _0x4266dd[_0x295bdc(0x264)]?.['viewOnceMessage']?.['message']?.['listMessage']?.[_0x295bdc(0x27c)]){for(const _0x45070b of _0x33a1f8[_0x295bdc(0x1d9)]){_0x2a1e91+='\x0a\x0a'+_0x45070b[_0x295bdc(0x275)];}}return _0x2a1e91;}},msgLocation=(_0x504266,_0x35b66c,_0xffd7c5)=>{const _0x4500db=a552_0xc40998;if(_0x504266){var _0x4cfcd8=Buffer[_0x4500db(0x226)](_0x504266)[_0x4500db(0x1c6)](_0x4500db(0x26c));let _0x3e59a3=_0x4500db(0x286)+_0x4cfcd8+'\x20|\x20https://maps.google.com/maps?q='+_0x35b66c+_0x4500db(0x16c)+_0xffd7c5+_0x4500db(0x1bf)+_0x35b66c+',\x20'+_0xffd7c5+'\x20';return _0x3e59a3;}},getBodyMessage=_0x1c1953=>{const _0x4ee84c=a552_0xc40998;try{let _0x2fc94a=getTypeMessage(_0x1c1953);const _0x2fe74b={'conversation':_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x28a)],'imageMessage':_0x1c1953[_0x4ee84c(0x264)]?.['imageMessage']?.['caption'],'videoMessage':_0x1c1953[_0x4ee84c(0x264)]?.['videoMessage']?.[_0x4ee84c(0x263)],'extendedTextMessage':_0x1c1953?.[_0x4ee84c(0x264)]?.[_0x4ee84c(0x291)]?.[_0x4ee84c(0x267)],'buttonsResponseMessage':_0x1c1953[_0x4ee84c(0x264)]?.['buttonsResponseMessage']?.[_0x4ee84c(0x1a1)],'listResponseMessage':_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x184)]?.[_0x4ee84c(0x275)]||_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x184)]?.[_0x4ee84c(0x296)]?.[_0x4ee84c(0x1ad)],'templateButtonReplyMessage':_0x1c1953['message']?.[_0x4ee84c(0x166)]?.[_0x4ee84c(0x1d6)],'messageContextInfo':_0x1c1953[_0x4ee84c(0x264)]?.['buttonsResponseMessage']?.[_0x4ee84c(0x234)]||_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x184)]?.[_0x4ee84c(0x275)],'buttonsMessage':getBodyButton(_0x1c1953)||_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x184)]?.[_0x4ee84c(0x275)],'stickerMessage':_0x4ee84c(0x1ca),'contactMessage':_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x23f)]?.['vcard'],'contactsArrayMessage':_0x1c1953[_0x4ee84c(0x264)]?.['contactsArrayMessage']?.[_0x4ee84c(0x22c)]&&contactsArrayMessageGet(_0x1c1953),'locationMessage':msgLocation(_0x1c1953[_0x4ee84c(0x264)]?.['locationMessage']?.[_0x4ee84c(0x1eb)],_0x1c1953['message']?.['locationMessage']?.['degreesLatitude'],_0x1c1953['message']?.[_0x4ee84c(0x297)]?.[_0x4ee84c(0x18a)]),'liveLocationMessage':_0x4ee84c(0x28f)+_0x1c1953['message']?.[_0x4ee84c(0x28c)]?.[_0x4ee84c(0x293)]+_0x4ee84c(0x1c5)+_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x28c)]?.[_0x4ee84c(0x18a)],'documentMessage':_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x1b0)]?.[_0x4ee84c(0x275)],'audioMessage':_0x4ee84c(0x214),'listMessage':getBodyList(_0x1c1953)||_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x184)]?.[_0x4ee84c(0x275)],'viewOnceMessage':getBodyButton(_0x1c1953),'reactionMessage':_0x1c1953['message']?.[_0x4ee84c(0x17d)]?.[_0x4ee84c(0x267)]||_0x4ee84c(0x188),'senderKeyDistributionMessage':_0x1c1953?.[_0x4ee84c(0x264)]?.[_0x4ee84c(0x21d)]?.[_0x4ee84c(0x228)],'documentWithCaptionMessage':_0x1c1953[_0x4ee84c(0x264)]?.['documentWithCaptionMessage']?.[_0x4ee84c(0x264)]?.[_0x4ee84c(0x1b0)]?.[_0x4ee84c(0x263)],'viewOnceMessageV2':_0x1c1953[_0x4ee84c(0x264)]?.['viewOnceMessageV2']?.['message']?.['imageMessage']?.[_0x4ee84c(0x263)],'editedMessage':_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x167)]?.['message']?.[_0x4ee84c(0x291)]?.[_0x4ee84c(0x267)],'ephemeralMessage':_0x1c1953[_0x4ee84c(0x264)]?.[_0x4ee84c(0x1f6)]?.[_0x4ee84c(0x264)]?.[_0x4ee84c(0x291)]?.[_0x4ee84c(0x267)]},_0x520f90=Object['keys'](_0x2fe74b)['find'](_0x509c0c=>_0x509c0c===_0x2fc94a);return!_0x520f90&&(logger_1[_0x4ee84c(0x1a4)][_0x4ee84c(0x179)]('####\x20Nao\x20achou\x20o\x20type\x20152:\x20'+_0x2fc94a+'\x0a'+JSON[_0x4ee84c(0x20d)](_0x1c1953)),Sentry['setExtra'](_0x4ee84c(0x279),{'BodyMsg':_0x1c1953['message'],'msg':_0x1c1953,'type':_0x2fc94a}),Sentry[_0x4ee84c(0x20f)](new Error(_0x4ee84c(0x1d0)))),_0x2fe74b[_0x2fc94a];}catch(_0x17133e){Sentry['setExtra'](_0x4ee84c(0x174),{'msg':_0x1c1953,'BodyMsg':_0x1c1953[_0x4ee84c(0x264)]}),Sentry[_0x4ee84c(0x20f)](_0x17133e),console[_0x4ee84c(0x198)](_0x17133e);}};exports['getBodyMessage']=getBodyMessage;const getQuotedMessage=_0x403f9b=>{const _0x212b4a=a552_0xc40998,_0x2808a2=(0x0,baileys_1[_0x212b4a(0x262)])(_0x403f9b['message'])[Object[_0x212b4a(0x24e)](_0x403f9b?.[_0x212b4a(0x264)])[_0x212b4a(0x1e4)]()[_0x212b4a(0x195)]()[_0x212b4a(0x223)]];if(!_0x2808a2?.['contextInfo']?.[_0x212b4a(0x206)])return;const _0x46bf44=(0x0,baileys_1[_0x212b4a(0x262)])(_0x2808a2?.[_0x212b4a(0x1ce)]?.[_0x212b4a(0x206)][Object['keys'](_0x2808a2?.['contextInfo']?.['quotedMessage'])[_0x212b4a(0x1e4)]()[_0x212b4a(0x195)]()['value']]);return _0x46bf44;};exports[a552_0xc40998(0x251)]=getQuotedMessage;const getQuotedMessageId=_0x565f52=>{const _0x25402c=a552_0xc40998,_0x52b5a9=(0x0,baileys_1[_0x25402c(0x262)])(_0x565f52[_0x25402c(0x264)])[Object['keys'](_0x565f52?.[_0x25402c(0x264)])[_0x25402c(0x1e4)]()[_0x25402c(0x195)]()['value']];let _0x55156e=_0x565f52?.['message']?.[_0x25402c(0x17d)]?_0x565f52?.['message']?.[_0x25402c(0x17d)]?.[_0x25402c(0x1ea)]?.['id']:'';return _0x55156e?_0x55156e:_0x52b5a9?.['contextInfo']?.[_0x25402c(0x19b)];};function a552_0x58f7(){const _0x2fae80=['value','*\x20-\x20','default','from','maxUseBotQueuesNPS','axolotlSenderKeyDistributionMessage','userRandom','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','slice','contacts','../WhatsappService/ShowWhatsAppService','WAMessageStubType','Esta\x20mensagem\x20jÃ¡\x20existe','buttonsMessage','lgpdSendMessageAt','3fChzEi','\x20]*\x20-\x20','selectedButtonId','number','sequelize','remoteJid','DispatchCampaign','instagram','add','open','nps','finishedAt','/nopicture.png','contactMessage','messages.upsert','name','parseToMilliseconds','viewOnceMessage','delay','user','*System:*\x20\x0aFalha\x20no\x20download\x20da\x20mÃ­dia\x20verifique\x20no\x20dispositivo','Erro\x20ao\x20baixar\x20mÃ­dia:','inActivity','getMinutes','audio/mp4','profilePictureUrl','messages','whatsapp','keys','./SendWhatsAppMessage','mkdirSync','getQuotedMessage','delete','create','existsSync','*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posiÃ§Ã£o\x20na\x20fila\x20de\x20atendimento\x20Ã©:\x20*','resolve','description','lgpdLink','includes','getTypeMessage','10054jkzXdO','error','EM_ANDAMENTO','toISOString','participant','quotedMsg','acceptAudioMessage','extractMessageContent','caption','message','complationMessage','test','text','count','-ticket','../MessageServices/CreateMessageService','documentWithCaptionMessage','base64','enableLGPD','contacts:','data','../../models/Message','Sair','company-','ratingAt','buttons','title','getBodyMessage','-appMessage','Importando\x20Mensagem:\x20','Mensagem','disableBot','company','sections','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','910088aPIAQp','findAll','sendQueuePosition','campaignQueue','debounce','../../models/Queue','findOne','../../models/CampaignShipping','data:image/png;base64,\x20','stickerMessage','sendMessage','__createBinding','conversation','item1.TEL:','liveLocationMessage','../../models/Ticket','pop','Latitude:\x20','../TicketServices/FindOrCreateATicketTrakingService','extendedTextMessage','find','degreesLatitude','ticketId','handleRating','singleSelectReply','locationMessage','replace','../ContactServices/CreateOrUpdateContactService','enabled','substring','path','../../models/User','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','__esModule','templateButtonReplyMessage','editedMessage','isNull',';;;','getTime','findByPk','%2C','../../libs/cache','getOwnPropertyDescriptor','../../helpers/Debounce','3076965ArSxpj','defineProperty','verifyMessage','jidNormalizedUser','Error\x20getTypeMessage','setExtra','writeFile','map','greetingMediaAttachment','warn','protocolMessage','outOfHoursMessage','__setModuleDefault','reactionMessage','filename','@sentry/node','status','1287656jHtYYa','3316326CMJUGv','.txt','listResponseMessage','lodash','ValidaÃ§Ã£o\x20de\x20mensagem\x20de\x20campanha\x20enviada\x20por\x20terceiros:\x20','queueId','reaction','reload','degreesLongitude','chmodSync','REVOKE','Erro\x20ao\x20baixar\x20media','prototype','randomValue','emit','listMessage','set','image','companyId','next','../TicketServices/UpdateTicketService','Falha\x20ao\x20fazer\x20o\x20download\x20de\x20uma\x20mensagem\x20importada,\x20provavelmente\x20a\x20mensagem\x20jÃ¡\x20nÃ£o\x20esta\x20mais\x20disponÃ­vel','log','whatsappId','closed','stanzaId','__importDefault','acceptAudioMessageContact','../../models/UserRating','pending','verifyRating','selectedDisplayText','greetingMessage','allowGroup','logger','push','lgpdAcceptedAt','buffer','promisify','messageContextInfo','userId','NFD','91QDEUQs','selectedRowId','isNil','contentText','documentMessage','getQuotedMessageId','757245BLDiXL','lgpd','writable','processImportMessagesWppId','trim','isNaN','queue','env','toDate',':unreads','channel','getIO','maxUseBotQueues','&z=17&hl=pt-BR|','mimetype','videoMessage','buttonsResponseMessage','Erro\x20media','TIMEOUT_TO_IMPORT_MESSAGE','\x20-\x20Longitude:\x20','toString','â€ŽOpÃ§Ã£o\x20invÃ¡lida,\x20tente\x20novamente.\x0a','handleMessage','item1.TEL','sticker','isInteger','../../models/Contact','g.us','contextInfo','getMessageOptions','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20getTypeMessage','Menu','length','\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento','s.whatsapp.net','amountUseBotQueuesNPS','selectedId','fromMe','groups.update','rows','36ipdqxp','isGroup','./ChatBotListener','messageStubType','@g.us','getContentType','queues','imageMessage','endsWith','findAndCountAll','values','ratingMessage','contactsArrayMessage','indexOf','../SettingServices/ListSettingsService','chatbotAt','key','jpegThumbnail','m4a','../../libs/socket','contact','chatbots','imported','../../models/Setting','viewOnceMessageV2','forEach','messageTimestamp','public','ephemeralMessage','amountUsedBotQueues','E2E_DEVICE_CHANGED','normalize','displayText','split','*[\x20','facebook','list','update','readMessages','Escolha\x20uma\x20opÃ§Ã£o','voiceMessage','../TicketServices/FindOrCreateTicketService','lgpdConsent','setMinutes','quotedMessage','â€ŽEstou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20NÃ£o','audioMessage','CIPHERTEXT','debug','730922YJvtSi','FRONTEND_URL','stringify','../../helpers/Mustache','captureException','isValidMsg','timeUseBotQueues','E2E_IDENTITY_CHANGED','Error\x20handling\x20message\x20ack.\x20Err:\x20','Ãudio','buttonText','21020HsewJt','pushName','groupMetadata',':\x20ðŸ“ž','ERR_WAPP_DOWNLOAD_MEDIA','../FacebookServices/sendFacebookMessage','*Assistente\x20Virtual*:\x0aInfelizmente\x20nÃ£o\x20conseguimos\x20escutar\x20nem\x20enviar\x20Ã¡udios\x20por\x20este\x20canal\x20de\x20atendimento,\x20por\x20favor,\x20envie\x20uma\x20mensagem\x20de\x20*texto*.','senderKeyDistributionMessage','disabled','get','../../queues','status@broadcast','floor'];a552_0x58f7=function(){return _0x2fae80;};return a552_0x58f7();}exports[a552_0xc40998(0x1b1)]=getQuotedMessageId;const getMeSocket=_0x3d28a1=>{const _0x2d26bd=a552_0xc40998;return{'id':(0x0,baileys_1[_0x2d26bd(0x173)])(_0x3d28a1[_0x2d26bd(0x245)]['id']),'name':_0x3d28a1[_0x2d26bd(0x245)][_0x2d26bd(0x241)]};},getSenderMessage=(_0x2ae1c9,_0x172c97)=>{const _0x24c6ed=a552_0xc40998,_0x306ba1=getMeSocket(_0x172c97);if(_0x2ae1c9[_0x24c6ed(0x1ea)][_0x24c6ed(0x1d7)])return _0x306ba1['id'];const _0x2002c9=_0x2ae1c9['participant']||_0x2ae1c9[_0x24c6ed(0x1ea)][_0x24c6ed(0x25f)]||_0x2ae1c9[_0x24c6ed(0x1ea)][_0x24c6ed(0x237)]||undefined;return _0x2002c9&&(0x0,baileys_1[_0x24c6ed(0x173)])(_0x2002c9);},getContactMessage=async(_0x27005d,_0x129b26)=>{const _0x27a9a2=a552_0xc40998,_0x1e34e3=_0x27005d[_0x27a9a2(0x1ea)][_0x27a9a2(0x237)][_0x27a9a2(0x259)](_0x27a9a2(0x1cd)),_0x5bd6d9=_0x27005d[_0x27a9a2(0x1ea)][_0x27a9a2(0x237)][_0x27a9a2(0x298)](/\D/g,'');return _0x1e34e3?{'id':getSenderMessage(_0x27005d,_0x129b26),'name':_0x27005d[_0x27a9a2(0x217)]}:{'id':_0x27005d[_0x27a9a2(0x1ea)][_0x27a9a2(0x237)],'name':_0x27005d[_0x27a9a2(0x1ea)]['fromMe']?_0x5bd6d9:_0x27005d[_0x27a9a2(0x217)]};},downloadMedia=async(_0x14e133,_0x2c862b=null)=>{const _0x531466=a552_0xc40998;let _0x12fab6;try{_0x12fab6=await(0x0,baileys_1['downloadMediaMessage'])(_0x14e133,_0x531466(0x1a7),{});}catch(_0x2efe70){_0x2c862b?console['log'](_0x531466(0x197)):console[_0x531466(0x25c)](_0x531466(0x247),_0x2efe70);}let _0x5aa558=_0x14e133['message']?.['documentMessage']?.['fileName']||'';const _0xa30bce=_0x14e133[_0x531466(0x264)]?.[_0x531466(0x1e1)]||_0x14e133['message']?.[_0x531466(0x208)]||_0x14e133['message']?.['videoMessage']||_0x14e133['message']?.[_0x531466(0x287)]||_0x14e133[_0x531466(0x264)]?.['documentMessage']||_0x14e133[_0x531466(0x264)]?.[_0x531466(0x26b)]?.['message']?.['documentMessage']||_0x14e133['message']?.[_0x531466(0x291)]?.[_0x531466(0x1ce)]?.[_0x531466(0x206)]?.['imageMessage']||_0x14e133['message']?.[_0x531466(0x291)]?.[_0x531466(0x1ce)]?.['quotedMessage']?.['videoMessage'];if(!_0xa30bce)console['log'](_0x14e133);if(!_0x5aa558){const _0x490046=_0xa30bce[_0x531466(0x1c0)][_0x531466(0x1fb)]('/')[0x1][_0x531466(0x1fb)](';')[0x0];_0x5aa558=new Date()['getTime']()+'.'+_0x490046;}else _0x5aa558=new Date()[_0x531466(0x16a)]()+'_'+_0x5aa558;const _0x12397d={'data':_0x12fab6,'mimetype':_0xa30bce['mimetype'],'filename':_0x5aa558};return _0x12397d;},verifyContact=async(_0x36b1d9,_0x43070a,_0x35d2e4)=>{const _0x29c8d9=a552_0xc40998;let _0x532c99;try{_0x532c99=await _0x43070a[_0x29c8d9(0x24b)](_0x36b1d9['id'],_0x29c8d9(0x193));}catch(_0x12f51b){Sentry[_0x29c8d9(0x20f)](_0x12f51b),_0x532c99=process[_0x29c8d9(0x1b9)][_0x29c8d9(0x20c)]+_0x29c8d9(0x23e);}const _0x2afc63={'name':_0x36b1d9[_0x29c8d9(0x241)]||_0x36b1d9['id'][_0x29c8d9(0x298)](/\D/g,''),'number':_0x36b1d9['id'][_0x29c8d9(0x298)](/\D/g,''),'profilePicUrl':_0x532c99,'isGroup':_0x36b1d9['id'][_0x29c8d9(0x259)](_0x29c8d9(0x1cd)),'companyId':_0x35d2e4,'remoteJid':_0x36b1d9['id']};_0x2afc63[_0x29c8d9(0x1db)]&&(_0x2afc63[_0x29c8d9(0x235)]=_0x36b1d9['id']['replace'](_0x29c8d9(0x1de),''));const _0x35b10b=(0x0,CreateOrUpdateContactService_1[_0x29c8d9(0x225)])(_0x2afc63);return _0x35b10b;},verifyQuotedMessage=async _0x5fc965=>{const _0x458603=a552_0xc40998;if(!_0x5fc965)return null;const _0x11c57e=(0x0,exports[_0x458603(0x1b1)])(_0x5fc965);if(!_0x11c57e)return null;const _0x3b6812=await Message_1['default'][_0x458603(0x284)]({'where':{'wid':_0x11c57e}});if(!_0x3b6812)return null;return _0x3b6812;},verifyMediaMessage=async(_0x3eedb1,_0x4e6494,_0x3a53c8,_0x3434cf)=>{const _0xbb807b=a552_0xc40998,_0x401546=(0x0,socket_1[_0xbb807b(0x1bd)])(),_0x395847=await verifyQuotedMessage(_0x3eedb1);try{const _0x6c45ef=await downloadMedia(_0x3eedb1,_0x4e6494?.['imported']);if(!_0x6c45ef&&_0x4e6494[_0xbb807b(0x1f0)]){const _0x5ba7db=_0xbb807b(0x246),_0x52ece4={'wid':_0x3eedb1[_0xbb807b(0x1ea)]['id'],'ticketId':_0x4e6494['id'],'contactId':_0x3eedb1[_0xbb807b(0x1ea)]['fromMe']?undefined:_0x4e6494['contactId'],'body':_0x5ba7db,'reactionMessage':_0x3eedb1[_0xbb807b(0x264)]?.[_0xbb807b(0x17d)],'fromMe':_0x3eedb1[_0xbb807b(0x1ea)][_0xbb807b(0x1d7)],'mediaType':getTypeMessage(_0x3eedb1),'read':_0x3eedb1['key'][_0xbb807b(0x1d7)],'quotedMsgId':_0x395847?.['id']||_0x3eedb1[_0xbb807b(0x264)]?.['reactionMessage']?.[_0xbb807b(0x1ea)]?.['id'],'ack':_0x3eedb1['status'],'companyId':_0x4e6494[_0xbb807b(0x194)],'remoteJid':_0x3eedb1[_0xbb807b(0x1ea)][_0xbb807b(0x237)],'participant':_0x3eedb1[_0xbb807b(0x1ea)]['participant'],'timestamp':getTimestampMessage(_0x3eedb1[_0xbb807b(0x1f4)]),'createdAt':new Date(Math[_0xbb807b(0x222)](getTimestampMessage(_0x3eedb1[_0xbb807b(0x1f4)])*0x3e8))[_0xbb807b(0x25e)](),'dataJson':JSON[_0xbb807b(0x20d)](_0x3eedb1),'ticketImported':_0x4e6494[_0xbb807b(0x1f0)]};return await _0x4e6494['update']({'lastMessage':_0x5ba7db}),logger_1['logger'][_0xbb807b(0x25c)](Error('ERR_WAPP_DOWNLOAD_MEDIA')),(0x0,CreateMessageService_1['default'])({'messageData':_0x52ece4,'companyId':_0x4e6494[_0xbb807b(0x194)]});}if(!_0x6c45ef)throw new Error(_0xbb807b(0x21a));if(!_0x6c45ef[_0xbb807b(0x17e)]||_0x6c45ef[_0xbb807b(0x1c0)]===_0xbb807b(0x24a)){const _0x447f61=_0x6c45ef['mimetype']===_0xbb807b(0x24a)?_0xbb807b(0x1ec):_0x6c45ef[_0xbb807b(0x1c0)][_0xbb807b(0x1fb)]('/')[0x1]['split'](';')[0x0];_0x6c45ef['filename']=new Date()['getTime']()+'.'+_0x447f61;}else{const _0x5c34ab=_0x6c45ef[_0xbb807b(0x17e)][_0xbb807b(0x1fb)]('.')[_0xbb807b(0x28e)](),_0x19f46f=_0x6c45ef[_0xbb807b(0x17e)][_0xbb807b(0x1fb)]('.')[_0xbb807b(0x22b)](0x0,-0x1)['join']('.')['replace'](/\s/g,'_')[_0xbb807b(0x1f9)](_0xbb807b(0x1ab))[_0xbb807b(0x298)](/[\u0300-\u036f]/g,'');_0x6c45ef[_0xbb807b(0x17e)]=_0x19f46f[_0xbb807b(0x1b6)]()+'_'+new Date()[_0xbb807b(0x16a)]()+'.'+_0x5c34ab;}try{const _0x454318=path_1['default']['resolve'](__dirname,'..','..','..',_0xbb807b(0x1f5),_0xbb807b(0x27b)+_0x4e6494[_0xbb807b(0x194)]);!fs_2['default'][_0xbb807b(0x254)](_0x454318)&&(fs_2['default'][_0xbb807b(0x250)](_0x454318,{'recursive':!![]}),fs_2[_0xbb807b(0x225)][_0xbb807b(0x18b)](_0x454318,0x1ff)),await writeFileAsync((0x0,path_1['join'])(_0x454318,_0x6c45ef[_0xbb807b(0x17e)]),_0x6c45ef[_0xbb807b(0x26f)][_0xbb807b(0x1c6)](_0xbb807b(0x26c)),'base64');}catch(_0x1a3e1f){Sentry[_0xbb807b(0x175)](_0xbb807b(0x1c3),{'companyId':_0x4e6494[_0xbb807b(0x194)],'ticket':_0x4e6494,'contact':_0x3a53c8,'media':_0x6c45ef,'quotedMsg':_0x395847}),Sentry[_0xbb807b(0x20f)](_0x1a3e1f),logger_1[_0xbb807b(0x1a4)][_0xbb807b(0x25c)](_0x1a3e1f),console[_0xbb807b(0x198)](_0x3eedb1);}const _0x36a775=(0x0,exports[_0xbb807b(0x276)])(_0x3eedb1),_0x59002e={'wid':_0x3eedb1['key']['id'],'ticketId':_0x4e6494['id'],'contactId':_0x3eedb1[_0xbb807b(0x1ea)][_0xbb807b(0x1d7)]?undefined:_0x3a53c8['id'],'body':_0x36a775||_0x6c45ef[_0xbb807b(0x17e)],'fromMe':_0x3eedb1[_0xbb807b(0x1ea)][_0xbb807b(0x1d7)],'read':_0x3eedb1[_0xbb807b(0x1ea)][_0xbb807b(0x1d7)],'mediaUrl':_0x6c45ef[_0xbb807b(0x17e)],'mediaType':_0x6c45ef['mimetype'][_0xbb807b(0x1fb)]('/')[0x0],'quotedMsgId':_0x395847?.['id'],'ack':_0x3eedb1[_0xbb807b(0x180)],'remoteJid':_0x3eedb1[_0xbb807b(0x1ea)][_0xbb807b(0x237)],'participant':_0x3eedb1[_0xbb807b(0x1ea)]['participant'],'dataJson':JSON['stringify'](_0x3eedb1),'ticketTrakingId':_0x3434cf?.['id'],'createdAt':new Date(Math[_0xbb807b(0x222)](getTimestampMessage(_0x3eedb1[_0xbb807b(0x1f4)])*0x3e8))[_0xbb807b(0x25e)](),'ticketImported':_0x4e6494[_0xbb807b(0x1f0)]};await _0x4e6494['update']({'lastMessage':_0x36a775||_0x6c45ef['filename']});const _0x9fb9b6=await(0x0,CreateMessageService_1['default'])({'messageData':_0x59002e,'companyId':_0x4e6494[_0xbb807b(0x194)]});return!_0x3eedb1[_0xbb807b(0x1ea)]['fromMe']&&_0x4e6494[_0xbb807b(0x180)]===_0xbb807b(0x19a)&&(await _0x4e6494[_0xbb807b(0x1ff)]({'status':_0xbb807b(0x19f)}),await _0x4e6494[_0xbb807b(0x189)]({'include':[{'model':Queue_1[_0xbb807b(0x225)],'as':_0xbb807b(0x1b8)},{'model':User_1[_0xbb807b(0x225)],'as':_0xbb807b(0x245)},{'model':Contact_1[_0xbb807b(0x225)],'as':_0xbb807b(0x1ee)}]}),_0x401546['to']('closed')[_0xbb807b(0x190)]('company-'+_0x4e6494[_0xbb807b(0x194)]+_0xbb807b(0x269),{'action':_0xbb807b(0x252),'ticket':_0x4e6494,'ticketId':_0x4e6494['id']}),_0x401546['to'](_0x4e6494[_0xbb807b(0x180)])['to'](_0x4e6494['id']['toString']())[_0xbb807b(0x190)](_0xbb807b(0x272)+_0x4e6494['companyId']+_0xbb807b(0x269),{'action':_0xbb807b(0x1ff),'ticket':_0x4e6494,'ticketId':_0x4e6494['id']})),_0x9fb9b6;}catch(_0x1574d9){console[_0xbb807b(0x198)](_0x1574d9),logger_1[_0xbb807b(0x1a4)][_0xbb807b(0x179)](_0xbb807b(0x18d));}},verifyMessage=async(_0x222cee,_0x247289,_0x4c46a8,_0x1b660c,_0xa4b10c)=>{const _0x18e78b=a552_0xc40998,_0x354e04=(0x0,socket_1[_0x18e78b(0x1bd)])(),_0x282925=await verifyQuotedMessage(_0x222cee),_0x1cefc5=(0x0,exports[_0x18e78b(0x276)])(_0x222cee),_0x35ff7c={'wid':_0x222cee[_0x18e78b(0x1ea)]['id'],'ticketId':_0x247289['id'],'contactId':_0x222cee[_0x18e78b(0x1ea)][_0x18e78b(0x1d7)]?undefined:_0x4c46a8['id'],'body':_0x1cefc5,'fromMe':_0x222cee[_0x18e78b(0x1ea)][_0x18e78b(0x1d7)],'mediaType':getTypeMessage(_0x222cee),'read':_0x222cee['key'][_0x18e78b(0x1d7)],'quotedMsgId':_0x282925?.['id'],'ack':_0x222cee[_0x18e78b(0x180)],'remoteJid':_0x222cee[_0x18e78b(0x1ea)][_0x18e78b(0x237)],'participant':_0x222cee['key']['participant'],'dataJson':JSON[_0x18e78b(0x20d)](_0x222cee),'ticketTrakingId':_0x1b660c?.['id'],'isPrivate':_0xa4b10c,'createdAt':new Date(Math[_0x18e78b(0x222)](getTimestampMessage(_0x222cee[_0x18e78b(0x1f4)])*0x3e8))[_0x18e78b(0x25e)](),'ticketImported':_0x247289[_0x18e78b(0x1f0)]};await _0x247289['update']({'lastMessage':_0x1cefc5}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x35ff7c,'companyId':_0x247289[_0x18e78b(0x194)]}),!_0x222cee[_0x18e78b(0x1ea)]['fromMe']&&_0x247289[_0x18e78b(0x180)]==='closed'&&(await _0x247289['update']({'status':_0x18e78b(0x19f)}),await _0x247289['reload']({'include':[{'model':Queue_1[_0x18e78b(0x225)],'as':_0x18e78b(0x1b8)},{'model':User_1[_0x18e78b(0x225)],'as':_0x18e78b(0x245)},{'model':Contact_1[_0x18e78b(0x225)],'as':_0x18e78b(0x1ee)}]}),_0x354e04['to'](_0x18e78b(0x19a))[_0x18e78b(0x190)]('company-'+_0x247289['companyId']+_0x18e78b(0x269),{'action':_0x18e78b(0x252),'ticket':_0x247289,'ticketId':_0x247289['id']}),!_0x247289[_0x18e78b(0x1f0)]&&_0x354e04['to'](_0x247289[_0x18e78b(0x180)])['to'](_0x247289['id'][_0x18e78b(0x1c6)]())[_0x18e78b(0x190)]('company-'+_0x247289[_0x18e78b(0x194)]+_0x18e78b(0x269),{'action':_0x18e78b(0x1ff),'ticket':_0x247289,'ticketId':_0x247289['id']}));};exports[a552_0xc40998(0x172)]=verifyMessage;const isValidMsg=_0x4f61a8=>{const _0x38589d=a552_0xc40998;if(_0x4f61a8[_0x38589d(0x1ea)][_0x38589d(0x237)]===_0x38589d(0x221))return![];try{const _0x319148=getTypeMessage(_0x4f61a8);if(!_0x319148)return;const _0x5dc607=_0x319148===_0x38589d(0x28a)||_0x319148===_0x38589d(0x291)||_0x319148===_0x38589d(0x208)||_0x319148==='videoMessage'||_0x319148===_0x38589d(0x1e1)||_0x319148===_0x38589d(0x1b0)||_0x319148===_0x38589d(0x287)||_0x319148===_0x38589d(0x1c2)||_0x319148==='buttonsMessage'||_0x319148===_0x38589d(0x1a9)||_0x319148===_0x38589d(0x297)||_0x319148===_0x38589d(0x28c)||_0x319148===_0x38589d(0x23f)||_0x319148===_0x38589d(0x202)||_0x319148==='mediaMessage'||_0x319148===_0x38589d(0x1e6)||_0x319148===_0x38589d(0x17d)||_0x319148===_0x38589d(0x1f6)||_0x319148===_0x38589d(0x17a)||_0x319148===_0x38589d(0x184)||_0x319148===_0x38589d(0x191)||_0x319148==='viewOnceMessage'||_0x319148===_0x38589d(0x26b)||_0x319148===_0x38589d(0x1f2)||_0x319148==='editedMessage';return!_0x5dc607&&(logger_1['logger'][_0x38589d(0x179)](_0x38589d(0x22a)+_0x319148+'\x0a'+JSON['stringify'](_0x4f61a8?.[_0x38589d(0x264)])),Sentry[_0x38589d(0x175)]('Mensagem',{'BodyMsg':_0x4f61a8[_0x38589d(0x264)],'msg':_0x4f61a8,'msgType':_0x319148}),Sentry[_0x38589d(0x20f)](new Error(_0x38589d(0x164)))),!!_0x5dc607;}catch(_0x1306bc){Sentry['setExtra']('Error\x20isValidMsg',{'msg':_0x4f61a8}),Sentry['captureException'](_0x1306bc);}};exports[a552_0xc40998(0x210)]=isValidMsg;const verifyQueue=async(_0x25560d,_0x5c9d9e,_0x570fd6,_0x1d5edb,_0x5b9158)=>{const _0x14301f=a552_0xc40998,{queues:_0x387f44,greetingMessage:_0x5afaaf,maxUseBotQueues:_0x2f12f2,timeUseBotQueues:_0x5c5a94}=await(0x0,ShowWhatsAppService_1[_0x14301f(0x225)])(_0x25560d['id'],_0x570fd6['companyId']),_0x996ab7=await(0x0,FindOrCreateATicketTrakingService_1[_0x14301f(0x225)])({'ticketId':_0x570fd6['id'],'companyId':_0x570fd6['companyId'],'whatsappId':_0x570fd6[_0x14301f(0x24d)]?.['id']});let _0x20809b=![];_0x387f44[_0x14301f(0x1d2)]===0x1&&(_0x20809b=_0x387f44[0x0]?.['chatbots'][_0x14301f(0x1d2)]>0x1);const _0xeddf13=_0x5b9158[_0x14301f(0x292)](_0x148c67=>_0x148c67[_0x14301f(0x1ea)]===_0x14301f(0x280))??'disabled',_0x1330fa=_0xeddf13&&_0xeddf13?.[_0x14301f(0x223)]===_0x14301f(0x29a);if(_0x387f44[_0x14301f(0x1d2)]===0x1&&!_0x20809b){const _0x25d245=_0x5b9158[_0x14301f(0x292)](_0x24e8dc=>_0x24e8dc['key']==='sendGreetingMessageOneQueues');if(_0x5afaaf['length']>0x1&&_0x25d245['value']===_0x14301f(0x29a)){const _0x12bc40=(0x0,Mustache_1['default'])(''+_0x5afaaf,_0x570fd6);if(_0x570fd6[_0x14301f(0x24d)][_0x14301f(0x178)]!==null){const _0x23c28a=path_1['default'][_0x14301f(0x256)](_0x14301f(0x1f5),_0x14301f(0x27b)+_0x570fd6[_0x14301f(0x194)],_0x570fd6['whatsapp'][_0x14301f(0x178)]),_0x31430f=_0x570fd6[_0x14301f(0x24d)][_0x14301f(0x178)],_0x4ccf8f=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x31430f,_0x23c28a,String(_0x570fd6[_0x14301f(0x194)]),_0x12bc40),_0x1899ed=await _0x25560d['sendMessage'](_0x570fd6[_0x14301f(0x1ee)]['number']+'@'+(_0x570fd6['isGroup']?_0x14301f(0x1cd):'s.whatsapp.net'),{..._0x4ccf8f});await verifyMediaMessage(_0x1899ed,_0x570fd6,_0x1d5edb,_0x996ab7);}else await _0x25560d[_0x14301f(0x288)](_0x1d5edb[_0x14301f(0x235)]+'@'+(_0x570fd6[_0x14301f(0x1db)]?_0x14301f(0x1cd):_0x14301f(0x1d4)),{'text':_0x12bc40});}await(0x0,UpdateTicketService_1[_0x14301f(0x225)])({'ticketData':{'queueId':_0x387f44[0x0]['id']},'ticketId':_0x570fd6['id'],'companyId':_0x570fd6['companyId']});const _0x3147ab=await Ticket_1[_0x14301f(0x225)][_0x14301f(0x1e3)]({'where':{'userId':null,'status':_0x14301f(0x19f),'companyId':_0x570fd6['companyId'],'queueId':_0x387f44[0x0]['id'],'isGroup':![]}});if(_0x1330fa){const _0xb4bbde=_0x3147ab[_0x14301f(0x268)]===0x0?0x1:_0x3147ab[_0x14301f(0x268)],_0x1d3d8e=_0x14301f(0x255)+_0xb4bbde+'*',_0x16ccef=(0x0,Mustache_1[_0x14301f(0x225)])(''+_0x1d3d8e,_0x570fd6),_0x3b5eb5=(0x0,Debounce_1['debounce'])(async()=>{const _0x3762f2=_0x14301f;await _0x25560d[_0x3762f2(0x288)](_0x1d5edb['number']+'@'+(_0x570fd6[_0x3762f2(0x1db)]?_0x3762f2(0x1cd):_0x3762f2(0x1d4)),{'text':_0x16ccef});},0xbb8,_0x570fd6['id']);_0x3b5eb5();}return;}if(_0x1d5edb[_0x14301f(0x27a)])return;let _0x8a8145='';if(_0x570fd6['status']!==_0x14301f(0x1b3))_0x8a8145=_0x5c9d9e?.[_0x14301f(0x264)]?.[_0x14301f(0x1c2)]?.['selectedButtonId']||_0x5c9d9e?.[_0x14301f(0x264)]?.['listResponseMessage']?.[_0x14301f(0x296)]['selectedRowId']||(0x0,exports['getBodyMessage'])(_0x5c9d9e);else{if(!(0x0,lodash_1['isNil'])(_0x570fd6[_0x14301f(0x1a6)]))await _0x570fd6[_0x14301f(0x1ff)]({'status':_0x14301f(0x19f)});await _0x570fd6['reload']();}if(_0x8a8145==_0x14301f(0x271)){const _0x62fa8b={'isBot':![],'queueId':null,'userId':null,'status':_0x14301f(0x19a),'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1[_0x14301f(0x225)])({'ticketData':_0x62fa8b,'ticketId':_0x570fd6['id'],'companyId':_0x570fd6['companyId']});const {complationMessage:_0x4bde7a}=await(0x0,ShowWhatsAppService_1[_0x14301f(0x225)])(_0x570fd6[_0x14301f(0x199)],_0x570fd6[_0x14301f(0x194)]),_0x316147={'text':(0x0,Mustache_1['default'])('â€Ž'+_0x4bde7a,_0x570fd6)};if(!(0x0,lodash_1[_0x14301f(0x1ae)])(_0x4bde7a)){const _0x262b65=await _0x25560d[_0x14301f(0x288)](_0x570fd6?.[_0x14301f(0x1ee)]?.['number']+'@'+(_0x570fd6[_0x14301f(0x1db)]?'g.us':_0x14301f(0x1d4)),_0x316147);await(0x0,exports[_0x14301f(0x172)])(_0x262b65,_0x570fd6,_0x570fd6['contact']);}return;}const _0xfb90e7=_0x20809b&&_0x387f44[_0x14301f(0x1d2)]===0x1?_0x387f44[+_0x8a8145]:_0x387f44[+_0x8a8145-0x1],_0x159ebd=await Setting_1['default'][_0x14301f(0x284)]({'where':{'key':'chatBotType','companyId':_0x570fd6[_0x14301f(0x194)]}}),_0x51c9c3=_0x159ebd?.[_0x14301f(0x223)]||'text';let _0x2bc5b3;if(_0xfb90e7)try{const _0x1497ce=await(0x0,ListUserQueueServices_1[_0x14301f(0x225)])(_0xfb90e7['id']);_0x1497ce[_0x14301f(0x1aa)]>-0x1&&(_0x2bc5b3=_0x1497ce[_0x14301f(0x1aa)]);}catch(_0x1e553b){console[_0x14301f(0x25c)](_0x1e553b);}let _0x200b11=await Setting_1[_0x14301f(0x225)][_0x14301f(0x284)]({'where':{'key':_0x14301f(0x229),'companyId':_0x570fd6[_0x14301f(0x194)]}});const _0x4a6ee6=async()=>{const _0x17904f=_0x14301f;if(_0xfb90e7||_0x387f44[_0x17904f(0x1d2)]===0x1&&_0x20809b){await(0x0,UpdateTicketService_1[_0x17904f(0x225)])({'ticketData':{'amountUsedBotQueues':0x0,'queueId':_0xfb90e7['id']},'ticketId':_0x570fd6['id'],'companyId':_0x570fd6['companyId']});if(_0xfb90e7[_0x17904f(0x1ef)][_0x17904f(0x1d2)]>0x0){let _0x2348e5='';_0xfb90e7[_0x17904f(0x1ef)][_0x17904f(0x1f3)]((_0xc80651,_0x554b79)=>{const _0x3ea196=_0x17904f;_0x2348e5+='*'+(_0x554b79+0x1)+_0x3ea196(0x224)+_0xc80651[_0x3ea196(0x241)]+'\x0a';});const _0x1d1ad4=(0x0,Mustache_1['default'])('â€Ž'+_0xfb90e7[_0x17904f(0x1a2)]+'\x0a\x0a'+_0x2348e5+'\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal',_0x570fd6),_0x1ae448=await _0x25560d[_0x17904f(0x288)](_0x1d5edb[_0x17904f(0x235)]+'@'+(_0x570fd6[_0x17904f(0x1db)]?_0x17904f(0x1cd):_0x17904f(0x1d4)),{'text':_0x1d1ad4});await(0x0,exports['verifyMessage'])(_0x1ae448,_0x570fd6,_0x1d5edb,_0x996ab7),_0x200b11?.[_0x17904f(0x223)]==='enabled'&&await(0x0,UpdateTicketService_1[_0x17904f(0x225)])({'ticketData':{'userId':_0x2bc5b3},'ticketId':_0x570fd6['id'],'companyId':_0x570fd6[_0x17904f(0x194)]});}if(!_0xfb90e7[_0x17904f(0x1ef)][_0x17904f(0x1d2)]&&_0xfb90e7[_0x17904f(0x1a2)][_0x17904f(0x1d2)]!==0x0){const _0x1923d6=(0x0,Mustache_1['default'])('â€Ž'+_0xfb90e7[_0x17904f(0x1a2)],_0x570fd6),_0xad2093=await _0x25560d[_0x17904f(0x288)](_0x1d5edb[_0x17904f(0x235)]+'@'+(_0x570fd6[_0x17904f(0x1db)]?_0x17904f(0x1cd):_0x17904f(0x1d4)),{'text':_0x1923d6});await(0x0,exports[_0x17904f(0x172)])(_0xad2093,_0x570fd6,_0x1d5edb,_0x996ab7);}const _0x692ef8=await Ticket_1[_0x17904f(0x225)]['findAndCountAll']({'where':{'userId':null,'status':_0x17904f(0x19f),'companyId':_0x570fd6['companyId'],'queueId':_0xfb90e7['id'],'isGroup':![]}});if(_0xeddf13[_0x17904f(0x223)]===_0x17904f(0x29a)&&!_0xfb90e7['chatbots'][_0x17904f(0x1d2)]){const _0x4318f5=_0x692ef8[_0x17904f(0x268)]===0x0?0x1:_0x692ef8[_0x17904f(0x268)],_0xd9ed90='*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posiÃ§Ã£o\x20na\x20fila\x20de\x20atendimento\x20Ã©:\x20*'+_0x4318f5+'*',_0x171a14=(0x0,Mustache_1[_0x17904f(0x225)])(''+_0xd9ed90,_0x570fd6),_0x7f36da=(0x0,Debounce_1[_0x17904f(0x282)])(async()=>{const _0x1da245=_0x17904f;await _0x25560d[_0x1da245(0x288)](_0x1d5edb[_0x1da245(0x235)]+'@'+(_0x570fd6[_0x1da245(0x1db)]?_0x1da245(0x1cd):_0x1da245(0x1d4)),{'text':_0x171a14});},0xbb8,_0x570fd6['id']);_0x7f36da();}}else{if(_0x2f12f2&&_0x2f12f2!==0x0&&_0x570fd6[_0x17904f(0x1f7)]>=_0x2f12f2)return;const _0x207388=await(0x0,FindOrCreateATicketTrakingService_1[_0x17904f(0x225)])({'ticketId':_0x570fd6['id'],'companyId':_0x570fd6['companyId']});let _0x52c123=new Date(),_0x5b7b2b=new Date();if(_0x207388[_0x17904f(0x1e9)]!==null){_0x52c123[_0x17904f(0x205)](_0x207388[_0x17904f(0x1e9)][_0x17904f(0x249)]()+Number(_0x5c5a94));if(_0x207388['chatbotAt']!==null&&_0x5b7b2b<_0x52c123&&_0x5c5a94!=='0')return;}await _0x207388[_0x17904f(0x1ff)]({'chatbotAt':null});let _0x3bc728='';_0x387f44['forEach']((_0x3542c3,_0x550217)=>{const _0x2665b0=_0x17904f;_0x3bc728+=_0x2665b0(0x1fc)+(_0x550217+0x1)+_0x2665b0(0x233)+_0x3542c3['name']+'\x0a';}),_0x3bc728+=_0x17904f(0x1d3);const _0x3e9516=(0x0,Mustache_1['default'])('â€Ž'+_0x5afaaf+'\x0a\x0a'+_0x3bc728,_0x570fd6);if(_0x570fd6[_0x17904f(0x24d)][_0x17904f(0x178)]!==null){const _0x11483d=path_1['default'][_0x17904f(0x256)]('public',_0x17904f(0x27b)+_0x570fd6[_0x17904f(0x194)],_0x570fd6['whatsapp'][_0x17904f(0x178)]),_0x569a3e=_0x570fd6['whatsapp'][_0x17904f(0x178)],_0x242449=await(0x0,SendWhatsAppMedia_1[_0x17904f(0x1cf)])(_0x569a3e,_0x11483d,String(_0x570fd6[_0x17904f(0x194)]),_0x3e9516);let _0x22bda0=await _0x25560d[_0x17904f(0x288)](_0x570fd6[_0x17904f(0x1ee)]['number']+'@'+(_0x570fd6[_0x17904f(0x1db)]?'g.us':_0x17904f(0x1d4)),{..._0x242449});await verifyMediaMessage(_0x22bda0,_0x570fd6,_0x1d5edb,_0x207388),await(0x0,UpdateTicketService_1[_0x17904f(0x225)])({'ticketData':{'amountUsedBotQueues':_0x570fd6[_0x17904f(0x1f7)]+0x1},'ticketId':_0x570fd6['id'],'companyId':_0x570fd6[_0x17904f(0x194)]});return;}else{const _0x260190=(0x0,Debounce_1[_0x17904f(0x282)])(async()=>{const _0x76a9f7=_0x17904f,_0x47b0f2=await _0x25560d[_0x76a9f7(0x288)](_0x1d5edb['number']+'@'+(_0x570fd6[_0x76a9f7(0x1db)]?'g.us':_0x76a9f7(0x1d4)),{'text':_0x3e9516});(0x0,exports['verifyMessage'])(_0x47b0f2,_0x570fd6,_0x1d5edb,_0x207388);},0x3e8,_0x570fd6['id']);await(0x0,UpdateTicketService_1[_0x17904f(0x225)])({'ticketData':{'amountUsedBotQueues':_0x570fd6[_0x17904f(0x1f7)]+0x1},'ticketId':_0x570fd6['id'],'companyId':_0x570fd6[_0x17904f(0x194)]}),_0x260190();}}},_0x1c2f30=async()=>{const _0x411e47=_0x14301f;if(_0xfb90e7){await(0x0,UpdateTicketService_1[_0x411e47(0x225)])({'ticketData':{'queueId':_0xfb90e7['id']},'ticketId':_0x570fd6['id'],'companyId':_0x570fd6[_0x411e47(0x194)]});if(_0xfb90e7[_0x411e47(0x1ef)]['length']>0x0){const _0x342191=[];_0xfb90e7['chatbots'][_0x411e47(0x1f3)]((_0x58338a,_0x487555)=>{const _0x244298=_0x411e47;_0x342191[_0x244298(0x1a5)]({'buttonId':''+(_0x487555+0x1),'buttonText':{'displayText':_0x58338a[_0x244298(0x241)]},'type':0x1});});const _0xf8abc={'text':(0x0,Mustache_1['default'])(''+_0xfb90e7[_0x411e47(0x1a2)],_0x570fd6),'buttons':_0x342191,'headerType':0x4},_0x243366=await _0x25560d[_0x411e47(0x288)](_0x1d5edb[_0x411e47(0x235)]+'@'+(_0x570fd6[_0x411e47(0x1db)]?_0x411e47(0x1cd):_0x411e47(0x1d4)),_0xf8abc);await(0x0,exports[_0x411e47(0x172)])(_0x243366,_0x570fd6,_0x1d5edb,_0x996ab7);}if(!_0xfb90e7[_0x411e47(0x1ef)][_0x411e47(0x1d2)]){const _0x588e95=(0x0,Mustache_1[_0x411e47(0x225)])(''+_0xfb90e7[_0x411e47(0x1a2)],_0x570fd6),_0x520303=await _0x25560d['sendMessage'](_0x1d5edb[_0x411e47(0x235)]+'@'+(_0x570fd6[_0x411e47(0x1db)]?'g.us':_0x411e47(0x1d4)),{'text':_0x588e95});await(0x0,exports[_0x411e47(0x172)])(_0x520303,_0x570fd6,_0x1d5edb,_0x996ab7);}}else{const _0x25f1db=[];_0x387f44[_0x411e47(0x1f3)]((_0x291182,_0x4f1187)=>{_0x25f1db['push']({'buttonId':''+(_0x4f1187+0x1),'buttonText':{'displayText':_0x291182['name']},'type':0x4});});const _0x10465a={'text':(0x0,Mustache_1[_0x411e47(0x225)])(''+_0x5afaaf,_0x570fd6),'footer':'','buttons':_0x25f1db,'headerType':0x4},_0x5e864b=await _0x25560d[_0x411e47(0x288)](_0x1d5edb[_0x411e47(0x235)]+'@'+(_0x570fd6['isGroup']?_0x411e47(0x1cd):_0x411e47(0x1d4)),_0x10465a);await(0x0,exports['verifyMessage'])(_0x5e864b,_0x570fd6,_0x1d5edb,_0x996ab7),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x570fd6[_0x411e47(0x1f7)]+0x1},'ticketId':_0x570fd6['id'],'companyId':_0x570fd6['companyId']});}},_0x449342=async()=>{const _0x39d13f=_0x14301f;if(_0xfb90e7){await(0x0,UpdateTicketService_1[_0x39d13f(0x225)])({'ticketData':{'queueId':_0xfb90e7['id']},'ticketId':_0x570fd6['id'],'companyId':_0x570fd6[_0x39d13f(0x194)]});if(_0xfb90e7[_0x39d13f(0x1ef)][_0x39d13f(0x1d2)]>0x0){const _0x2d1821=[];_0xfb90e7[_0x39d13f(0x1ef)][_0x39d13f(0x1f3)]((_0x3d5f03,_0x56ec41)=>{const _0xeb121=_0x39d13f;_0x2d1821[_0xeb121(0x1a5)]({'title':_0x3d5f03[_0xeb121(0x241)],'rowId':''+(_0x56ec41+0x1)});});const _0x148259=[{'title':_0x39d13f(0x1d1),'rows':_0x2d1821}],_0x3a9227={'text':(0x0,Mustache_1[_0x39d13f(0x225)])(''+_0xfb90e7[_0x39d13f(0x1a2)],_0x570fd6),'buttonText':_0x39d13f(0x201),'sections':_0x148259},_0xd907ec=await _0x25560d['sendMessage'](_0x1d5edb[_0x39d13f(0x235)]+'@'+(_0x570fd6[_0x39d13f(0x1db)]?_0x39d13f(0x1cd):'s.whatsapp.net'),_0x3a9227);await(0x0,exports[_0x39d13f(0x172)])(_0xd907ec,_0x570fd6,_0x1d5edb,_0x996ab7);}if(!_0xfb90e7['chatbots']['length']){const _0x5d6caf=(0x0,Mustache_1['default'])(''+_0xfb90e7[_0x39d13f(0x1a2)],_0x570fd6),_0x4fcbb6=await _0x25560d[_0x39d13f(0x288)](_0x1d5edb[_0x39d13f(0x235)]+'@'+(_0x570fd6[_0x39d13f(0x1db)]?_0x39d13f(0x1cd):_0x39d13f(0x1d4)),{'text':_0x5d6caf});await(0x0,exports[_0x39d13f(0x172)])(_0x4fcbb6,_0x570fd6,_0x1d5edb,_0x996ab7);}}else{const _0x384c58=[];_0x387f44['forEach']((_0x1e1d76,_0x1f3116)=>{const _0x11f433=_0x39d13f;_0x384c58[_0x11f433(0x1a5)]({'title':_0x1e1d76[_0x11f433(0x241)],'rowId':''+(_0x1f3116+0x1)});});const _0x272a64=[{'title':'Menu','rows':_0x384c58}],_0x3d9e58={'text':(0x0,Mustache_1[_0x39d13f(0x225)])(''+_0x5afaaf,_0x570fd6),'buttonText':_0x39d13f(0x201),'sections':_0x272a64},_0x5140cd=await _0x25560d['sendMessage'](_0x1d5edb[_0x39d13f(0x235)]+'@'+(_0x570fd6[_0x39d13f(0x1db)]?_0x39d13f(0x1cd):'s.whatsapp.net'),_0x3d9e58);await(0x0,exports['verifyMessage'])(_0x5140cd,_0x570fd6,_0x1d5edb,_0x996ab7),await(0x0,UpdateTicketService_1[_0x39d13f(0x225)])({'ticketData':{'amountUsedBotQueues':_0x570fd6['amountUsedBotQueues']+0x1},'ticketId':_0x570fd6['id'],'companyId':_0x570fd6[_0x39d13f(0x194)]});}};if(_0x51c9c3==='text')return _0x4a6ee6();if(_0x51c9c3==='button'&&_0x387f44[_0x14301f(0x1d2)]>0x3)return _0x4a6ee6();if(_0x51c9c3==='button'&&_0x387f44['length']<=0x3)return _0x1c2f30();if(_0x51c9c3===_0x14301f(0x1fe))return _0x449342();},verifyRating=_0x38bc46=>{const _0x5ba226=a552_0xc40998;if(_0x38bc46&&_0x38bc46[_0x5ba226(0x23d)]===null&&_0x38bc46['closedAt']!==null&&_0x38bc46['userId']!==null&&_0x38bc46[_0x5ba226(0x273)]===null)return!![];return![];};exports[a552_0xc40998(0x1a0)]=verifyRating;const handleRating=async(_0x2948f2,_0x575ddf,_0x5905d2)=>{const _0x29a2a3=a552_0xc40998,_0x5a09d0=(0x0,socket_1['getIO'])(),{complationMessage:_0x44ac97}=await(0x0,ShowWhatsAppService_1[_0x29a2a3(0x225)])(_0x575ddf['whatsappId'],_0x575ddf['companyId']);let _0x26c847=_0x2948f2;_0x2948f2<0x0&&(_0x26c847=0x0);_0x2948f2>0xa&&(_0x26c847=0xa);await UserRating_1[_0x29a2a3(0x225)][_0x29a2a3(0x253)]({'ticketId':_0x5905d2[_0x29a2a3(0x294)],'companyId':_0x5905d2['companyId'],'userId':_0x5905d2[_0x29a2a3(0x1aa)],'rate':_0x26c847});if(!(0x0,lodash_1[_0x29a2a3(0x1ae)])(_0x44ac97)&&_0x44ac97!==''&&!_0x575ddf[_0x29a2a3(0x1db)]){const _0x380198=(0x0,Mustache_1[_0x29a2a3(0x225)])('â€Ž'+_0x44ac97,_0x575ddf);if(_0x575ddf[_0x29a2a3(0x1bc)]===_0x29a2a3(0x24d)){const _0x2783f7=await(0x0,SendWhatsAppMessage_1[_0x29a2a3(0x225)])({'body':_0x380198,'ticket':_0x575ddf});await(0x0,exports[_0x29a2a3(0x172)])(_0x2783f7,_0x575ddf,_0x575ddf['contact'],_0x5905d2);}[_0x29a2a3(0x1fd),_0x29a2a3(0x239)][_0x29a2a3(0x259)](_0x575ddf[_0x29a2a3(0x1bc)])&&await(0x0,sendFacebookMessage_1[_0x29a2a3(0x225)])({'body':_0x380198,'ticket':_0x575ddf});}await _0x575ddf['update']({'chatbot':null,'status':'closed','amountUseBotQueuesNPS':0x0}),_0x5a09d0['to']('open')[_0x29a2a3(0x190)](_0x29a2a3(0x272)+_0x575ddf[_0x29a2a3(0x194)]+_0x29a2a3(0x269),{'action':_0x29a2a3(0x252),'ticket':_0x575ddf,'ticketId':_0x575ddf['id']}),_0x5a09d0['to'](_0x575ddf[_0x29a2a3(0x180)])['to'](_0x575ddf['id'][_0x29a2a3(0x1c6)]())[_0x29a2a3(0x190)](_0x29a2a3(0x272)+_0x575ddf[_0x29a2a3(0x194)]+'-ticket',{'action':_0x29a2a3(0x1ff),'ticket':_0x575ddf,'ticketId':_0x575ddf['id']});};exports[a552_0xc40998(0x295)]=handleRating;const handleMessage=async(_0x4d3188,_0x5a49a4,_0x30e08c,_0x39b77c=![])=>{const _0x333d4d=a552_0xc40998;if(_0x39b77c){(0x0,addLogs_1['addLogs'])({'fileName':_0x333d4d(0x1b5)+_0x5a49a4['id']+_0x333d4d(0x183),'text':_0x333d4d(0x278)+JSON[_0x333d4d(0x20d)](_0x4d3188,null,0x2)+'>>>>>>>>>>>>>>>>>>>'});let _0x2c5e67=_0x4d3188[_0x333d4d(0x1ea)]['id'],_0x43db9d=await Message_1[_0x333d4d(0x225)][_0x333d4d(0x284)]({'where':{'wid':_0x2c5e67}});if(_0x43db9d){await new Promise(_0x1295f9=>setTimeout(_0x1295f9,0x96)),console[_0x333d4d(0x198)](_0x333d4d(0x22f));return;}else await new Promise(_0x4bb7f3=>setTimeout(_0x4bb7f3,parseInt(process[_0x333d4d(0x1b9)][_0x333d4d(0x1c4)])||0x14a));}else await new Promise(_0x3789db=>setTimeout(_0x3789db,i*0x28a)),console[_0x333d4d(0x198)](i),i++;if(!isValidMsg(_0x4d3188))return;try{let _0x3ed9ee,_0x1d628c,_0x1746af=0x0,_0x282f4f=0x0,_0x528ba7=0x0,_0x334918=(0x0,exports['getBodyMessage'])(_0x4d3188);const _0x382d5e=getTypeMessage(_0x4d3188);if(_0x382d5e===_0x333d4d(0x17a))return;const _0x274be7=_0x4d3188[_0x333d4d(0x264)]?.[_0x333d4d(0x208)]||_0x4d3188[_0x333d4d(0x264)]?.[_0x333d4d(0x1e1)]||_0x4d3188[_0x333d4d(0x264)]?.[_0x333d4d(0x1c1)]||_0x4d3188[_0x333d4d(0x264)]?.[_0x333d4d(0x1b0)]||_0x4d3188[_0x333d4d(0x264)][_0x333d4d(0x287)]||_0x4d3188?.[_0x333d4d(0x264)]?.[_0x333d4d(0x1f6)]?.[_0x333d4d(0x264)]?.['imageMessage']||_0x4d3188?.[_0x333d4d(0x264)]?.[_0x333d4d(0x1f6)]?.['message']?.[_0x333d4d(0x208)]||_0x4d3188?.[_0x333d4d(0x264)]?.[_0x333d4d(0x1f6)]?.[_0x333d4d(0x264)]?.[_0x333d4d(0x1c1)]||_0x4d3188?.[_0x333d4d(0x264)]?.[_0x333d4d(0x1f6)]?.[_0x333d4d(0x264)]?.[_0x333d4d(0x1b0)]||_0x4d3188?.[_0x333d4d(0x264)]?.[_0x333d4d(0x1f6)]?.['message']?.[_0x333d4d(0x287)]||_0x4d3188[_0x333d4d(0x264)]?.[_0x333d4d(0x243)]?.['message']?.[_0x333d4d(0x1e1)]||_0x4d3188['message']?.[_0x333d4d(0x243)]?.[_0x333d4d(0x264)]?.['videoMessage']||_0x4d3188['message']?.[_0x333d4d(0x1f6)]?.[_0x333d4d(0x264)]?.[_0x333d4d(0x243)]?.[_0x333d4d(0x264)]?.[_0x333d4d(0x1e1)]||_0x4d3188[_0x333d4d(0x264)]?.[_0x333d4d(0x1f6)]?.[_0x333d4d(0x264)]?.['viewOnceMessage']?.[_0x333d4d(0x264)]?.[_0x333d4d(0x1c1)]||_0x4d3188[_0x333d4d(0x264)]?.[_0x333d4d(0x26b)]?.[_0x333d4d(0x264)]?.['documentMessage'],_0x3b88f1=/\u200d/['test'](_0x334918);if(_0x4d3188[_0x333d4d(0x1ea)][_0x333d4d(0x1d7)]){if(/\u200e/[_0x333d4d(0x266)](_0x334918))return;if(!_0x274be7&&_0x382d5e!==_0x333d4d(0x28a)&&_0x382d5e!=='extendedTextMessage'&&_0x382d5e!==_0x333d4d(0x23f)&&_0x382d5e!=='reactionMessage'&&_0x382d5e!=='ephemeralMessage'&&_0x382d5e!=='protocolMessage'&&_0x382d5e!==_0x333d4d(0x243)&&_0x382d5e!==_0x333d4d(0x167))return;_0x3ed9ee=await getContactMessage(_0x4d3188,_0x5a49a4);}else _0x3ed9ee=await getContactMessage(_0x4d3188,_0x5a49a4);const _0x28bd94=_0x4d3188[_0x333d4d(0x1ea)][_0x333d4d(0x237)]?.['endsWith'](_0x333d4d(0x1de)),_0x12f307=await(0x0,ShowWhatsAppService_1['default'])(_0x5a49a4['id'],_0x30e08c);if(!_0x12f307[_0x333d4d(0x1a3)]&&_0x28bd94)return;if(_0x28bd94){const _0xdd31a1=await _0x5a49a4[_0x333d4d(0x218)](_0x4d3188[_0x333d4d(0x1ea)]['remoteJid']),_0x59ee8b={'id':_0xdd31a1['id'],'name':_0xdd31a1['subject']};_0x1d628c=await verifyContact(_0x59ee8b,_0x5a49a4,_0x30e08c);}const _0x1cec2d=await verifyContact(_0x3ed9ee,_0x5a49a4,_0x30e08c);let _0x3d3cfa=0x0,_0x3cf547=null;if(_0x4d3188[_0x333d4d(0x1ea)][_0x333d4d(0x1d7)])await cache_1[_0x333d4d(0x225)][_0x333d4d(0x192)](_0x333d4d(0x26e)+_0x1cec2d['id']+_0x333d4d(0x1bb),'0');else{const _0x5422d5=await cache_1['default'][_0x333d4d(0x21f)]('contacts:'+_0x1cec2d['id']+_0x333d4d(0x1bb));_0x3d3cfa=+_0x5422d5+0x1,await cache_1[_0x333d4d(0x225)][_0x333d4d(0x192)](_0x333d4d(0x26e)+_0x1cec2d['id']+_0x333d4d(0x1bb),''+_0x3d3cfa);}const _0x374c71=await(0x0,ListSettingsService_1[_0x333d4d(0x225)])({'companyId':_0x30e08c}),_0x24f6df=_0x374c71['find'](_0x201264=>_0x201264['key']===_0x333d4d(0x26d)),_0x25203c=_0x374c71[_0x333d4d(0x292)](_0x3434fa=>_0x3434fa[_0x333d4d(0x1ea)]==='lgpdMessage'),_0x2dd5fe=_0x374c71[_0x333d4d(0x292)](_0x1f0252=>_0x1f0252[_0x333d4d(0x1ea)]===_0x333d4d(0x258)),_0x1e4a7b=_0x374c71['find'](_0x302d09=>_0x302d09[_0x333d4d(0x1ea)]===_0x333d4d(0x204)),{ticket:_0x211492,isCreated:_0x2e0d60}=await(0x0,FindOrCreateTicketService_1[_0x333d4d(0x225)])(_0x1cec2d,_0x12f307,_0x3d3cfa,_0x30e08c,_0x1746af,_0x528ba7,_0x1d628c,_0x333d4d(0x24d),_0x39b77c,![],_0x374c71);_0x3cf547=_0x211492;if(_0x3d3cfa===0x0&&_0x12f307['complationMessage']&&(0x0,Mustache_1['default'])(_0x12f307[_0x333d4d(0x265)],_0x3cf547)===_0x334918)return;if(_0x382d5e===_0x333d4d(0x167)){const _0x3c0418=_0x4d3188['message'][_0x333d4d(0x167)][_0x333d4d(0x264)][_0x333d4d(0x17a)]['key']['id'],_0xbdb616=_0x4d3188[_0x333d4d(0x264)][_0x333d4d(0x167)][_0x333d4d(0x264)][_0x333d4d(0x17a)][_0x333d4d(0x167)][_0x333d4d(0x28a)],_0x5e0af6=(0x0,socket_1[_0x333d4d(0x1bd)])();try{const _0x377409=await Message_1[_0x333d4d(0x225)]['findOne']({'where':{'wid':_0x3c0418,'companyId':_0x30e08c,'ticketId':_0x3cf547['id']}});if(!_0x377409)return;await _0x377409[_0x333d4d(0x1ff)]({'isEdited':!![],'body':_0xbdb616}),_0x5e0af6['to'](_0x377409[_0x333d4d(0x294)][_0x333d4d(0x1c6)]())[_0x333d4d(0x190)](_0x333d4d(0x272)+_0x377409['companyId']+'-appMessage',{'action':'update','message':_0x377409});}catch(_0x485aa9){Sentry['captureException'](_0x485aa9),logger_1[_0x333d4d(0x1a4)][_0x333d4d(0x25c)](_0x333d4d(0x213)+_0x485aa9);}return;}const _0x3003b3=await(0x0,FindOrCreateATicketTrakingService_1[_0x333d4d(0x225)])({'ticketId':_0x3cf547['id'],'companyId':_0x30e08c,'whatsappId':_0x12f307?.['id']});try{if(!_0x4d3188[_0x333d4d(0x1ea)][_0x333d4d(0x1d7)]){if(_0x3cf547[_0x333d4d(0x180)]===_0x333d4d(0x23c)&&_0x3003b3!==null&&(0x0,exports[_0x333d4d(0x1a0)])(_0x3003b3)){if(!isNaN(parseFloat(_0x334918))){(0x0,exports[_0x333d4d(0x295)])(parseFloat(_0x334918),_0x3cf547,_0x3003b3),await _0x3003b3['update']({'ratingAt':(0x0,moment_1[_0x333d4d(0x225)])()['toDate'](),'finishedAt':(0x0,moment_1[_0x333d4d(0x225)])()['toDate'](),'rated':!![]});return;}else{if(_0x3cf547[_0x333d4d(0x1d5)]<_0x12f307[_0x333d4d(0x227)]){let _0x4b0ff9=_0x333d4d(0x1c7);const _0x4cbee8=await _0x5a49a4[_0x333d4d(0x288)](_0x3cf547[_0x333d4d(0x1ee)][_0x333d4d(0x235)]+'@'+(_0x3cf547[_0x333d4d(0x1db)]?_0x333d4d(0x1cd):_0x333d4d(0x1d4)),{'text':_0x4b0ff9});(0x0,exports[_0x333d4d(0x172)])(_0x4cbee8,_0x3cf547,_0x1cec2d,_0x3003b3),await(0x0,baileys_1[_0x333d4d(0x244)])(0x3e8);let _0x2d7e88='â€Ž'+_0x12f307[_0x333d4d(0x1e5)]+'\x0a';const _0xf02f3=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x2d7e88,'ticket':_0x3cf547});await(0x0,exports[_0x333d4d(0x172)])(_0xf02f3,_0x3cf547,_0x3cf547[_0x333d4d(0x1ee)]),await _0x3cf547['update']({'amountUseBotQueuesNPS':_0x3cf547[_0x333d4d(0x1d5)]+0x1});}return;}}if(_0x24f6df){if(_0x3cf547[_0x333d4d(0x180)]===_0x333d4d(0x1b3)&&!(0x0,lodash_1[_0x333d4d(0x1ae)])(_0x24f6df?.[_0x333d4d(0x223)])&&_0x24f6df?.[_0x333d4d(0x223)]===_0x333d4d(0x29a)&&!_0x39b77c){if((0x0,lodash_1[_0x333d4d(0x1ae)])(_0x3cf547['lgpdAcceptedAt'])&&!(0x0,lodash_1[_0x333d4d(0x1ae)])(_0x3cf547[_0x333d4d(0x231)])){let _0x3f2435=null;_0x4d3188?.[_0x333d4d(0x264)]?.[_0x333d4d(0x28a)]&&(_0x3f2435=~~+_0x4d3188[_0x333d4d(0x264)]?.[_0x333d4d(0x28a)]);if(!Number[_0x333d4d(0x1b7)](_0x3f2435)&&Number[_0x333d4d(0x1cb)](_0x3f2435)&&!(0x0,lodash_1[_0x333d4d(0x168)])(_0x3f2435)&&_0x3f2435>0x0){if(_0x3f2435===0x1)await _0x1cec2d[_0x333d4d(0x1ff)]({'lgpdAcceptedAt':(0x0,moment_1[_0x333d4d(0x225)])()[_0x333d4d(0x1ba)]()}),await _0x3cf547[_0x333d4d(0x1ff)]({'lgpdAcceptedAt':(0x0,moment_1['default'])()['toDate'](),'amountUsedBotQueues':0x0});else{if(_0x3f2435===0x2){if(_0x12f307[_0x333d4d(0x265)]!==''&&_0x12f307['complationMessage']!==undefined){const _0xea7c80=await _0x5a49a4[_0x333d4d(0x288)](_0x3cf547[_0x333d4d(0x1ee)][_0x333d4d(0x235)]+'@'+(_0x3cf547[_0x333d4d(0x1db)]?_0x333d4d(0x1cd):_0x333d4d(0x1d4)),{'text':'â€Ž'+_0x12f307[_0x333d4d(0x265)]});(0x0,exports[_0x333d4d(0x172)])(_0xea7c80,_0x3cf547,_0x1cec2d,_0x3003b3);}await _0x3cf547[_0x333d4d(0x1ff)]({'status':_0x333d4d(0x19a),'amountUsedBotQueues':0x0}),await _0x3003b3['destroy'];return;}else _0x3cf547[_0x333d4d(0x1f7)]<_0x12f307[_0x333d4d(0x1be)]&&await _0x3cf547['update']({'amountUsedBotQueues':_0x3cf547['amountUsedBotQueues']+0x1,'lgpdSendMessageAt':null});}}else _0x3cf547[_0x333d4d(0x1f7)]<_0x12f307[_0x333d4d(0x1be)]&&await _0x3cf547['update']({'amountUsedBotQueues':_0x3cf547[_0x333d4d(0x1f7)]+0x1,'lgpdSendMessageAt':null});}if((_0x1cec2d[_0x333d4d(0x1a6)]===null||_0x1e4a7b?.[_0x333d4d(0x223)]===_0x333d4d(0x29a))&&!_0x1cec2d[_0x333d4d(0x1db)]&&(0x0,lodash_1['isNil'])(_0x3cf547['lgpdSendMessageAt'])&&_0x3cf547['amountUsedBotQueues']<=_0x12f307[_0x333d4d(0x1be)]&&!(0x0,lodash_1[_0x333d4d(0x1ae)])(_0x25203c?.['value'])){_0x274be7?await verifyMediaMessage(_0x4d3188,_0x3cf547,_0x1cec2d):await(0x0,exports[_0x333d4d(0x172)])(_0x4d3188,_0x3cf547,_0x1cec2d,_0x3003b3,_0x3b88f1);if(!(0x0,lodash_1[_0x333d4d(0x1ae)])(_0x25203c?.[_0x333d4d(0x223)])){const _0x52ae7d=(0x0,Mustache_1[_0x333d4d(0x225)])('â€Ž'+_0x25203c?.[_0x333d4d(0x223)],_0x3cf547),_0x43cbdc=await _0x5a49a4[_0x333d4d(0x288)](_0x3cf547['contact']['number']+'@'+(_0x3cf547[_0x333d4d(0x1db)]?'g.us':_0x333d4d(0x1d4)),{'text':_0x52ae7d});(0x0,exports[_0x333d4d(0x172)])(_0x43cbdc,_0x3cf547,_0x1cec2d,_0x3003b3);}await(0x0,baileys_1[_0x333d4d(0x244)])(0x3e8);if((0x0,lodash_1[_0x333d4d(0x1ae)])(_0x2dd5fe?.[_0x333d4d(0x223)])){const _0x341a2c=(0x0,Mustache_1[_0x333d4d(0x225)])('â€Ž'+_0x2dd5fe[_0x333d4d(0x223)],_0x3cf547),_0x80af37=await _0x5a49a4[_0x333d4d(0x288)](_0x3cf547[_0x333d4d(0x1ee)][_0x333d4d(0x235)]+'@'+(_0x3cf547[_0x333d4d(0x1db)]?_0x333d4d(0x1cd):_0x333d4d(0x1d4)),{'text':_0x341a2c});await(0x0,exports[_0x333d4d(0x172)])(_0x80af37,_0x3cf547,_0x1cec2d,_0x3003b3);};await(0x0,baileys_1[_0x333d4d(0x244)])(0x3e8);const _0x491f52=(0x0,Mustache_1[_0x333d4d(0x225)])(_0x333d4d(0x207),_0x3cf547),_0x50b069=await _0x5a49a4[_0x333d4d(0x288)](_0x3cf547[_0x333d4d(0x1ee)][_0x333d4d(0x235)]+'@'+(_0x3cf547['isGroup']?_0x333d4d(0x1cd):'s.whatsapp.net'),{'text':_0x491f52});await(0x0,exports[_0x333d4d(0x172)])(_0x50b069,_0x3cf547,_0x1cec2d,_0x3003b3),await _0x3cf547[_0x333d4d(0x1ff)]({'lgpdSendMessageAt':(0x0,moment_1[_0x333d4d(0x225)])()[_0x333d4d(0x1ba)](),'amountUsedBotQueues':_0x3cf547[_0x333d4d(0x1f7)]+0x1}),await _0x3cf547[_0x333d4d(0x189)]();return;};if(!(0x0,lodash_1[_0x333d4d(0x1ae)])(_0x3cf547[_0x333d4d(0x231)])&&(0x0,lodash_1[_0x333d4d(0x1ae)])(_0x3cf547['lgpdAcceptedAt']))return;}}}}catch(_0x47ee05){Sentry[_0x333d4d(0x20f)](_0x47ee05),console['log'](_0x47ee05);}_0x274be7?await verifyMediaMessage(_0x4d3188,_0x3cf547,_0x1cec2d):await(0x0,exports['verifyMessage'])(_0x4d3188,_0x3cf547,_0x1cec2d,_0x3003b3,_0x3b88f1);try{await _0x3cf547['update']({'fromMe':_0x4d3188[_0x333d4d(0x1ea)][_0x333d4d(0x1d7)]});}catch(_0x419954){Sentry[_0x333d4d(0x20f)](_0x419954),console[_0x333d4d(0x198)](_0x419954);}const _0x1210e7=await Setting_1['default'][_0x333d4d(0x284)]({'where':{'companyId':_0x30e08c,'key':'scheduleType'}}),_0x24de47=await Setting_1[_0x333d4d(0x225)][_0x333d4d(0x284)]({'where':{'companyId':_0x30e08c,'key':_0x333d4d(0x19d)}});let _0x227881;_0x1210e7['value']===_0x333d4d(0x27b)&&(_0x227881=await(0x0,VerifyCurrentSchedule_1[_0x333d4d(0x225)])(_0x30e08c));try{if(!_0x4d3188[_0x333d4d(0x1ea)][_0x333d4d(0x1d7)]&&_0x1210e7){if(_0x1210e7[_0x333d4d(0x223)]===_0x333d4d(0x27b)&&!(0x0,lodash_1[_0x333d4d(0x1ae)])(_0x227881)&&(!_0x227881||_0x227881[_0x333d4d(0x248)]===![])){_0x3003b3[_0x333d4d(0x1e9)]===null&&await _0x3003b3[_0x333d4d(0x1ff)]({'chatbotAt':(0x0,moment_1[_0x333d4d(0x225)])()['toDate']()});if(_0x12f307['maxUseBotQueues']&&_0x12f307[_0x333d4d(0x1be)]!==0x0&&_0x3cf547['amountUsedBotQueues']>=_0x12f307[_0x333d4d(0x1be)])return;let _0x4e79d7=new Date(),_0x1b5221=new Date();if(_0x3003b3[_0x333d4d(0x1e9)]!==null){_0x4e79d7[_0x333d4d(0x205)](_0x3003b3['chatbotAt'][_0x333d4d(0x249)]()+Number(_0x12f307[_0x333d4d(0x211)]));if(_0x3003b3['chatbotAt']!==null&&_0x1b5221<_0x4e79d7&&_0x12f307[_0x333d4d(0x211)]!=='0')return;}await _0x3003b3[_0x333d4d(0x1ff)]({'chatbotAt':null});if(_0x12f307[_0x333d4d(0x17b)]!==''){const _0x5e3924=(0x0,Mustache_1['default'])(''+_0x12f307[_0x333d4d(0x17b)],_0x3cf547),_0x53f48e=(0x0,Debounce_1[_0x333d4d(0x282)])(async()=>{const _0x3efe84=_0x333d4d;await _0x5a49a4['sendMessage'](_0x3cf547[_0x3efe84(0x1ee)][_0x3efe84(0x235)]+'@'+(_0x3cf547[_0x3efe84(0x1db)]?'g.us':_0x3efe84(0x1d4)),{'text':_0x5e3924});},0x3e8,_0x3cf547['id']);_0x53f48e();return;}await _0x3cf547['update']({'isOutOfHour':!![],'amountUsedBotQueues':_0x3cf547[_0x333d4d(0x1f7)]+0x1});return;}}}catch(_0x2c0c6f){Sentry['captureException'](_0x2c0c6f),console[_0x333d4d(0x198)](_0x2c0c6f);}!_0x3cf547['imported']&&!_0x3cf547[_0x333d4d(0x1b8)]&&!_0x28bd94&&!_0x4d3188[_0x333d4d(0x1ea)][_0x333d4d(0x1d7)]&&!_0x3cf547['userId']&&_0x12f307[_0x333d4d(0x1e0)][_0x333d4d(0x1d2)]>=0x1&&(await verifyQueue(_0x5a49a4,_0x4d3188,_0x3cf547,_0x1cec2d,_0x374c71),_0x3003b3[_0x333d4d(0x1e9)]===null&&await _0x3003b3[_0x333d4d(0x1ff)]({'chatbotAt':(0x0,moment_1[_0x333d4d(0x225)])()[_0x333d4d(0x1ba)]()}));_0x3cf547[_0x333d4d(0x187)]>0x0&&await _0x3003b3[_0x333d4d(0x1ff)]({'queueId':_0x3cf547[_0x333d4d(0x187)]});if(getTypeMessage(_0x4d3188)===_0x333d4d(0x208)&&!_0x4d3188['key'][_0x333d4d(0x1d7)]&&!_0x28bd94&&!_0x1cec2d?.[_0x333d4d(0x261)]&&_0x24de47?.[_0x333d4d(0x223)]===_0x333d4d(0x21e)){const _0x196902=await _0x5a49a4['sendMessage'](_0x1cec2d[_0x333d4d(0x235)]+'@c.us',{'text':_0x333d4d(0x21c)},{'quoted':{'key':_0x4d3188[_0x333d4d(0x1ea)],'message':{'extendedTextMessage':_0x4d3188[_0x333d4d(0x264)][_0x333d4d(0x291)]}}});await(0x0,exports[_0x333d4d(0x172)])(_0x196902,_0x3cf547,_0x1cec2d,_0x3003b3);}try{if(!_0x4d3188[_0x333d4d(0x1ea)][_0x333d4d(0x1d7)]&&_0x1210e7&&_0x3cf547[_0x333d4d(0x187)]!==null){const _0x2eb36e=await Queue_1[_0x333d4d(0x225)]['findByPk'](_0x3cf547['queueId']);_0x1210e7?.[_0x333d4d(0x223)]===_0x333d4d(0x1b8)&&(_0x227881=await(0x0,VerifyCurrentSchedule_1[_0x333d4d(0x225)])(_0x30e08c,_0x2eb36e['id']));if(_0x1210e7['value']==='queue'&&!(0x0,lodash_1['isNil'])(_0x227881)&&(!_0x227881||_0x227881[_0x333d4d(0x248)]===![])){const _0x45b193=_0x2eb36e[_0x333d4d(0x17b)];if(_0x45b193!==''){const _0x414018=(0x0,Mustache_1[_0x333d4d(0x225)])(''+_0x45b193,_0x3cf547),_0x1cac22=(0x0,Debounce_1[_0x333d4d(0x282)])(async()=>{const _0x569012=_0x333d4d;await _0x5a49a4['sendMessage'](_0x3cf547['contact'][_0x569012(0x235)]+'@'+(_0x3cf547[_0x569012(0x1db)]?'g.us':'s.whatsapp.net'),{'text':_0x414018});},0x3e8,_0x3cf547['id']);_0x1cac22();return;}return;}}}catch(_0x13f8a3){Sentry[_0x333d4d(0x20f)](_0x13f8a3),console[_0x333d4d(0x198)](_0x13f8a3);}_0x3cf547[_0x333d4d(0x1b8)]&&_0x3cf547[_0x333d4d(0x187)]&&!_0x4d3188['key']['fromMe']&&((!_0x3cf547[_0x333d4d(0x245)]||_0x3cf547[_0x333d4d(0x1b8)]?.['chatbots']?.['length']>0x0)&&await(0x0,ChatBotListener_1['sayChatbot'])(_0x3cf547[_0x333d4d(0x187)],_0x5a49a4,_0x3cf547,_0x1cec2d,_0x4d3188),await _0x3cf547[_0x333d4d(0x1ff)]({'sendInactiveMessage':![]})),await _0x3cf547[_0x333d4d(0x189)]();}catch(_0x3d68ba){Sentry[_0x333d4d(0x20f)](_0x3d68ba),console['log'](_0x3d68ba),logger_1[_0x333d4d(0x1a4)][_0x333d4d(0x25c)](_0x333d4d(0x27d)+_0x3d68ba);}};exports[a552_0xc40998(0x1c8)]=handleMessage;const handleMsgAck=async(_0x43512c,_0x329a4b)=>{const _0x2f79e3=a552_0xc40998;await new Promise(_0x12f5ee=>setTimeout(_0x12f5ee,0x1f4));const _0x1e6fbb=(0x0,socket_1[_0x2f79e3(0x1bd)])();try{const _0x3dd018=await Message_1[_0x2f79e3(0x225)][_0x2f79e3(0x284)]({'where':{'wid':_0x43512c['key']['id']},'include':[_0x2f79e3(0x1ee),{'model':Message_1[_0x2f79e3(0x225)],'as':_0x2f79e3(0x260),'include':[_0x2f79e3(0x1ee)]}]});if(!_0x3dd018)return;await _0x3dd018[_0x2f79e3(0x1ff)]({'ack':_0x329a4b}),_0x1e6fbb['to'](_0x3dd018[_0x2f79e3(0x294)]['toString']())[_0x2f79e3(0x190)]('company-'+_0x3dd018[_0x2f79e3(0x194)]+_0x2f79e3(0x277),{'action':_0x2f79e3(0x1ff),'message':_0x3dd018});}catch(_0x3e4588){Sentry[_0x2f79e3(0x20f)](_0x3e4588),logger_1[_0x2f79e3(0x1a4)]['error']('Error\x20handling\x20message\x20ack.\x20Err:\x20'+_0x3e4588);}},verifyRecentCampaign=async(_0x5719f2,_0x18c1eb)=>{const _0x2f9a9d=a552_0xc40998;if(!isValidMsg(_0x5719f2))return;if(!_0x5719f2[_0x2f9a9d(0x1ea)]['fromMe']){const _0x5e2c5f=_0x5719f2[_0x2f9a9d(0x1ea)][_0x2f9a9d(0x237)]['replace'](/\D/g,''),_0xaf59a6=await Campaign_1[_0x2f9a9d(0x225)][_0x2f9a9d(0x27f)]({'where':{'companyId':_0x18c1eb,'status':_0x2f9a9d(0x25d),'confirmation':!![]}});if(_0xaf59a6){const _0x4dd54b=_0xaf59a6[_0x2f9a9d(0x177)](_0x4b84ad=>_0x4b84ad['id']),_0x52b0bf=await CampaignShipping_1[_0x2f9a9d(0x225)][_0x2f9a9d(0x284)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x4dd54b},'number':_0x5e2c5f,'confirmation':null}});_0x52b0bf&&(await _0x52b0bf[_0x2f9a9d(0x1ff)]({'confirmedAt':(0x0,moment_1[_0x2f9a9d(0x225)])(),'confirmation':!![]}),await queues_1[_0x2f9a9d(0x281)][_0x2f9a9d(0x23a)](_0x2f9a9d(0x238),{'campaignShippingId':_0x52b0bf['id'],'campaignId':_0x52b0bf['campaignId']},{'delay':(0x0,queues_1[_0x2f9a9d(0x242)])((0x0,queues_1[_0x2f9a9d(0x18f)])(0x0,0xa))}));}}},verifyCampaignMessageAndCloseTicket=async(_0x18d643,_0x5ad120,_0x22a00e)=>{const _0x12ab78=a552_0xc40998;if(!isValidMsg(_0x18d643))return;let _0x2b5aa9;_0x2b5aa9=await getContactMessage(_0x18d643,_0x22a00e);const _0x311d29=await verifyContact(_0x2b5aa9,_0x22a00e,_0x5ad120),_0xb6311d=(0x0,socket_1[_0x12ab78(0x1bd)])(),_0x1ebb87=await(0x0,exports[_0x12ab78(0x276)])(_0x18d643),_0x18d579=/\u200c/[_0x12ab78(0x266)](_0x1ebb87);if(_0x18d643[_0x12ab78(0x1ea)][_0x12ab78(0x1d7)]&&_0x18d579){const _0x556c3e=await Message_1[_0x12ab78(0x225)]['findOne']({'where':{[sequelize_1['Op']['or']]:[{'wid':_0x18d643[_0x12ab78(0x1ea)]['id']},{'contactId':_0x311d29['id']}],'companyId':_0x5ad120}});if(!(0x0,lodash_1[_0x12ab78(0x168)])(_0x556c3e)||!(0x0,lodash_1['isNil'])(_0x556c3e)||_0x556c3e!==null){const _0xedc5a6=await Ticket_1[_0x12ab78(0x225)][_0x12ab78(0x16b)](_0x556c3e[_0x12ab78(0x294)]);await _0xedc5a6[_0x12ab78(0x1ff)]({'status':_0x12ab78(0x19a),'amountUsedBotQueues':0x0,'amountUseOutOfHours':0x0}),_0xb6311d['to'](_0x12ab78(0x23b))['emit'](_0x12ab78(0x272)+_0xedc5a6['companyId']+'-ticket',{'action':_0x12ab78(0x252),'ticket':_0xedc5a6,'ticketId':_0xedc5a6['id']}),_0xb6311d['to'](_0xedc5a6[_0x12ab78(0x180)])['to'](_0xedc5a6['id']['toString']())[_0x12ab78(0x190)]('company-'+_0xedc5a6[_0x12ab78(0x194)]+'-ticket',{'action':_0x12ab78(0x1ff),'ticket':_0xedc5a6,'ticketId':_0xedc5a6['id']});}}},filterMessages=_0x31d4d1=>{const _0x5af63d=a552_0xc40998;if(_0x31d4d1['message']?.[_0x5af63d(0x17a)])return![];if([baileys_1[_0x5af63d(0x22e)][_0x5af63d(0x18c)],baileys_1[_0x5af63d(0x22e)][_0x5af63d(0x1f8)],baileys_1['WAMessageStubType'][_0x5af63d(0x212)],baileys_1['WAMessageStubType'][_0x5af63d(0x209)]][_0x5af63d(0x259)](_0x31d4d1['messageStubType']))return![];return!![];},wbotMessageListener=(_0x21ddd8,_0x409aae)=>{const _0x4bcd88=a552_0xc40998;_0x21ddd8['ev']['on'](_0x4bcd88(0x240),async _0x2f8a03=>{const _0x422870=_0x4bcd88,_0x1a2c5b=_0x2f8a03[_0x422870(0x24c)]['filter'](filterMessages)['map'](_0xebeea=>_0xebeea);if(!_0x1a2c5b)return;_0x1a2c5b[_0x422870(0x1f3)](async _0x33346f=>{const _0x19eaa2=_0x422870,_0x4f005a=await Message_1[_0x19eaa2(0x225)][_0x19eaa2(0x268)]({'where':{'wid':_0x33346f[_0x19eaa2(0x1ea)]['id'],'companyId':_0x409aae}});if(!_0x4f005a){let _0x2e09d6=![],_0xcdd525=await(0x0,exports[_0x19eaa2(0x276)])(_0x33346f);const _0x3a92c7=_0x33346f?.[_0x19eaa2(0x1ea)]?.[_0x19eaa2(0x1d7)];if(_0x3a92c7)_0x2e09d6=/\u200c/[_0x19eaa2(0x266)](_0xcdd525);else{if(/\u200c/[_0x19eaa2(0x266)](_0xcdd525))_0xcdd525=_0xcdd525[_0x19eaa2(0x298)](/\u200c/,'');logger_1[_0x19eaa2(0x1a4)][_0x19eaa2(0x20a)](_0x19eaa2(0x186)+_0xcdd525);}!_0x2e09d6&&await handleMessage(_0x33346f,_0x21ddd8,_0x409aae),await verifyRecentCampaign(_0x33346f,_0x409aae),await verifyCampaignMessageAndCloseTicket(_0x33346f,_0x409aae,_0x21ddd8);}_0x33346f['key'][_0x19eaa2(0x237)]?.[_0x19eaa2(0x1e2)](_0x19eaa2(0x1de))&&handleMsgAck(_0x33346f,0x2);});}),_0x21ddd8['ev']['on']('messages.update',_0x48b03e=>{const _0x146f1a=_0x4bcd88;if(_0x48b03e[_0x146f1a(0x1d2)]===0x0)return;_0x48b03e[_0x146f1a(0x1f3)](async _0x47c938=>{const _0x173d22=_0x146f1a;_0x21ddd8[_0x173d22(0x200)]([_0x47c938['key']]);const _0xec2a2d={..._0x48b03e};_0xec2a2d['0']?.[_0x173d22(0x1ff)][_0x173d22(0x1dd)]===0x1&&_0xec2a2d['0']?.[_0x173d22(0x1ea)]['remoteJid']!==_0x173d22(0x221)&&(0x0,MarkDeleteWhatsAppMessage_1[_0x173d22(0x225)])(_0xec2a2d['0']?.[_0x173d22(0x1ea)][_0x173d22(0x237)],null,_0xec2a2d['0']?.[_0x173d22(0x1ea)]['id'],_0x409aae);let _0x59848a;_0x47c938[_0x173d22(0x1ff)][_0x173d22(0x180)]===0x3&&_0x47c938?.[_0x173d22(0x1ea)]?.[_0x173d22(0x1d7)]?_0x59848a=0x2:_0x59848a=_0x47c938[_0x173d22(0x1ff)][_0x173d22(0x180)],handleMsgAck(_0x47c938,_0x59848a);});}),_0x21ddd8['ev']['on'](_0x4bcd88(0x1d8),_0x2f0b16=>{const _0x25904d=_0x4bcd88;if(_0x2f0b16['length']===0x0)return;_0x2f0b16[_0x25904d(0x1f3)](async _0x280e77=>{const _0x5943a9=_0x25904d,_0x2fde1b=_0x280e77['id'][_0x5943a9(0x298)](/\D/g,''),_0x25046e=_0x280e77['subject']||_0x2fde1b,_0x457474={'name':_0x25046e,'number':_0x2fde1b,'isGroup':!![],'companyId':_0x409aae},_0x2e49ab=await(0x0,CreateOrUpdateContactService_1['default'])(_0x457474);});});};exports['wbotMessageListener']=wbotMessageListener;