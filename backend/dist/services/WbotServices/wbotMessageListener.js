'use strict';const a553_0x488c96=a553_0x4467;(function(_0x275cb6,_0x127080){const _0x1cb302=a553_0x4467,_0x4a30cc=_0x275cb6();while(!![]){try{const _0x5b904b=-parseInt(_0x1cb302(0x200))/0x1*(-parseInt(_0x1cb302(0x26c))/0x2)+-parseInt(_0x1cb302(0x213))/0x3*(-parseInt(_0x1cb302(0x163))/0x4)+-parseInt(_0x1cb302(0x269))/0x5*(parseInt(_0x1cb302(0x20d))/0x6)+-parseInt(_0x1cb302(0x18a))/0x7+-parseInt(_0x1cb302(0x157))/0x8+-parseInt(_0x1cb302(0x191))/0x9*(parseInt(_0x1cb302(0x266))/0xa)+parseInt(_0x1cb302(0x1e2))/0xb;if(_0x5b904b===_0x127080)break;else _0x4a30cc['push'](_0x4a30cc['shift']());}catch(_0x5bd107){_0x4a30cc['push'](_0x4a30cc['shift']());}}}(a553_0x5156,0xdc906));var __createBinding=this&&this['__createBinding']||(Object[a553_0x488c96(0x1e5)]?function(_0x3b7e84,_0xa7122c,_0x1af672,_0x3d1d19){const _0xe36422=a553_0x488c96;if(_0x3d1d19===undefined)_0x3d1d19=_0x1af672;var _0x326609=Object[_0xe36422(0x252)](_0xa7122c,_0x1af672);(!_0x326609||(_0xe36422(0x1a2)in _0x326609?!_0xa7122c['__esModule']:_0x326609[_0xe36422(0x1db)]||_0x326609['configurable']))&&(_0x326609={'enumerable':!![],'get':function(){return _0xa7122c[_0x1af672];}}),Object['defineProperty'](_0x3b7e84,_0x3d1d19,_0x326609);}:function(_0x23f1e7,_0xd24cad,_0x126767,_0x523f24){if(_0x523f24===undefined)_0x523f24=_0x126767;_0x23f1e7[_0x523f24]=_0xd24cad[_0x126767];}),__setModuleDefault=this&&this[a553_0x488c96(0x160)]||(Object[a553_0x488c96(0x1e5)]?function(_0x44c00e,_0x2d452a){const _0x47164b=a553_0x488c96;Object['defineProperty'](_0x44c00e,_0x47164b(0x188),{'enumerable':!![],'value':_0x2d452a});}:function(_0x2991b9,_0x32979e){const _0x5634ee=a553_0x488c96;_0x2991b9[_0x5634ee(0x188)]=_0x32979e;}),__importStar=this&&this[a553_0x488c96(0x218)]||function(_0x23660f){const _0x565fb5=a553_0x488c96;if(_0x23660f&&_0x23660f[_0x565fb5(0x20b)])return _0x23660f;var _0x2f30d1={};if(_0x23660f!=null){for(var _0x35661a in _0x23660f)if(_0x35661a!=='default'&&Object[_0x565fb5(0x19d)][_0x565fb5(0x21d)]['call'](_0x23660f,_0x35661a))__createBinding(_0x2f30d1,_0x23660f,_0x35661a);}return __setModuleDefault(_0x2f30d1,_0x23660f),_0x2f30d1;},__importDefault=this&&this[a553_0x488c96(0x210)]||function(_0x1612f2){const _0x38001b=a553_0x488c96;return _0x1612f2&&_0x1612f2[_0x38001b(0x20b)]?_0x1612f2:{'default':_0x1612f2};};Object['defineProperty'](exports,a553_0x488c96(0x20b),{'value':!![]}),exports[a553_0x488c96(0x1fd)]=exports['isValidMsg']=exports[a553_0x488c96(0x268)]=exports['wbotMessageListener']=exports[a553_0x488c96(0x1d7)]=exports[a553_0x488c96(0x1e4)]=exports[a553_0x488c96(0x1af)]=exports[a553_0x488c96(0x1e7)]=exports[a553_0x488c96(0x26f)]=exports[a553_0x488c96(0x1c5)]=void 0x0;const path_1=__importStar(require(a553_0x488c96(0x1f4))),util_1=require('util'),fs_1=require('fs'),fs_2=__importDefault(require('fs')),Sentry=__importStar(require(a553_0x488c96(0x16a))),lodash_1=require(a553_0x488c96(0x1d9)),baileys_1=require('@whiskeysockets/baileys'),Contact_1=__importDefault(require(a553_0x488c96(0x1bc))),Ticket_1=__importDefault(require(a553_0x488c96(0x1dc))),Message_1=__importDefault(require(a553_0x488c96(0x22e))),socket_1=require('../../libs/socket'),CreateMessageService_1=__importDefault(require(a553_0x488c96(0x23c))),logger_1=require('../../utils/logger'),CreateOrUpdateContactService_1=__importDefault(require(a553_0x488c96(0x153))),FindOrCreateTicketService_1=__importDefault(require('../TicketServices/FindOrCreateTicketService')),ShowWhatsAppService_1=__importDefault(require(a553_0x488c96(0x22a))),Debounce_1=require(a553_0x488c96(0x193)),UpdateTicketService_1=__importDefault(require(a553_0x488c96(0x1ad))),Mustache_1=__importDefault(require('../../helpers/Mustache')),UserRating_1=__importDefault(require(a553_0x488c96(0x217))),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),sendFacebookMessage_1=__importDefault(require(a553_0x488c96(0x189))),moment_1=__importDefault(require(a553_0x488c96(0x227))),Queue_1=__importDefault(require(a553_0x488c96(0x215))),FindOrCreateATicketTrakingService_1=__importDefault(require(a553_0x488c96(0x1df))),VerifyCurrentSchedule_1=__importDefault(require(a553_0x488c96(0x276))),Campaign_1=__importDefault(require(a553_0x488c96(0x17a))),CampaignShipping_1=__importDefault(require(a553_0x488c96(0x238))),sequelize_1=require('sequelize'),queues_1=require(a553_0x488c96(0x1c8)),User_1=__importDefault(require(a553_0x488c96(0x19b))),Setting_1=__importDefault(require(a553_0x488c96(0x248))),ChatBotListener_1=require('./ChatBotListener'),MarkDeleteWhatsAppMessage_1=__importDefault(require(a553_0x488c96(0x1ae))),ListUserQueueServices_1=__importDefault(require(a553_0x488c96(0x20c))),cache_1=__importDefault(require(a553_0x488c96(0x278))),ListSettingsService_1=__importDefault(require('../SettingServices/ListSettingsService')),addLogs_1=require(a553_0x488c96(0x18b)),SendWhatsAppMedia_1=require(a553_0x488c96(0x243));let i=0x0;setInterval(()=>{i=0x0;},0x1388);const writeFileAsync=(0x0,util_1[a553_0x488c96(0x275)])(fs_1['writeFile']);function a553_0x5156(){const _0x5f0ef0=['getMinutes','split','listMessage','instagram','sticker','pending','facebook','getOwnPropertyDescriptor','data','log','next','listResponseMessage','contextInfo','messages.update','liveLocationMessage','lgpdLink','filter','wbotMessageListener','pop','sendMessage','groupMetadata','shift','toString','update','findAndCountAll','imageMessage','outOfHoursMessage','821010ydTNFu','contact','handleMessage','25UNFfle','axolotlSenderKeyDistributionMessage',';;;','1385438vwnVUA','slice','isGroup','getQuotedMessage','queueId','trim','Erro\x20ao\x20baixar\x20media','>>>>>>>>>>>>>>>>>>>','item1.TEL','promisify','../CompanyService/VerifyCurrentSchedule','buffer','../../libs/cache','whatsappId','*\x20-\x20','find','buttons','jidNormalizedUser','set','*System:*\x20\x0aFalha\x20no\x20download\x20da\x20mÃ­dia\x20verifique\x20no\x20dispositivo','message','protocolMessage','Importando\x20Mensagem:\x20','../ContactServices/CreateOrUpdateContactService',':\x20ðŸ“ž','displayText','reactionMessage','4778208KRCCEg','setMinutes','count','fromMe','chatbotAt','mediaMessage','name','nps','Latitude:\x20','__setModuleDefault','viewOnceMessageV2','conversation','788QBqSZm','Escolha\x20uma\x20opÃ§Ã£o','m4a','/nopicture.png','push','values','status@broadcast','@sentry/node','WAMessageStubType','groups.update','s.whatsapp.net','Menu','Error\x20isValidMsg','ephemeralMessage','error','degreesLongitude','editedMessage','selectedId','stringify','list','floor','vcard','subject','../../models/Campaign','greetingMessage','imported','extractMessageContent','Erro\x20ao\x20baixar\x20mÃ­dia:','*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posiÃ§Ã£o\x20na\x20fila\x20de\x20atendimento\x20Ã©:\x20*','remoteJid','resolve','reload','stickerMessage','emit','whatsapp','value','title','default','../FacebookServices/sendFacebookMessage','6896708WLHLga','../../helpers/addLogs','lgpd','queue','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','isNil','channel','162KNPsNS','lgpdAcceptedAt','../../helpers/Debounce','CIPHERTEXT','\x20]*\x20-\x20','senderKeyDistributionMessage','contactsArrayMessage','messageTimestamp','inActivity','endsWith','../../models/User','item1.TEL:','prototype','DispatchCampaign','maxUseBotQueues','Sair','acceptAudioMessageContact','get','env','disableBot','base64','greetingMediaAttachment','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','contentText','-appMessage','caption','getMessageOptions','sections','../TicketServices/UpdateTicketService','./MarkDeleteWhatsAppMessage','verifyMessage','sendGreetingMessageOneQueues','existsSync','amountUseBotQueuesNPS','####\x20Nao\x20achou\x20o\x20type\x20152:\x20','lgpdSendMessageAt','rows','buttonsResponseMessage','participant','lgpdMessage','filename','buttonText','captureException','../../models/Contact','closedAt','Falha\x20ao\x20fazer\x20o\x20download\x20de\x20uma\x20mensagem\x20importada,\x20provavelmente\x20a\x20mensagem\x20jÃ¡\x20nÃ£o\x20esta\x20mais\x20disponÃ­vel','data:image/png;base64,\x20','selectedRowId','timeUseBotQueues','indexOf','closed','messages.upsert','getBodyMessage','Ãudio','add','../../queues','processImportMessagesWppId','ratingAt','unlink','map','company-','includes','\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento','public','BEGIN:','user','chatbots','allowGroup','destroy','getIO','handleRating','findAll','lodash','stanzaId','writable','../../models/Ticket','finishedAt','delete','../TicketServices/FindOrCreateATicketTrakingService','profilePictureUrl','documentWithCaptionMessage','39589462GXNfIe','isValidMsg','verifyRating','create','contacts','getQuotedMessageId','â€ŽEstou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20NÃ£o','viewOnceMessage','forEach','messages','singleSelectReply','join','\x20|\x20https://maps.google.com/maps?q=','messageStubType','enableLGPD','contactMessage','quotedMessage','audioMessage','path','voiceMessage','ticketId','findOne','documentMessage','setExtra','g.us','image','text','getTypeMessage','sendQueuePosition','NFD','2GGgRoi','Mensagem','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','replace','ERR_WAPP_DOWNLOAD_MEDIA','keys','locationMessage','scheduleType','readMessages','logger','userId','__esModule','../UserQueueServices/ListUserQueueServices','1314450SSOkiS','Error\x20handling\x20message\x20ack.\x20Err:\x20','toISOString','__importDefault','description','isInteger','1137mTjIdm','mkdirSync','../../models/Queue','contactId','../../models/UserRating','__importStar','mimetype','number','@g.us','&z=17&hl=pt-BR|','hasOwnProperty','amountUsedBotQueues','acceptAudioMessage',':unreads','getTime','companyId','toDate','company','contacts:','findByPk','moment','status','disabled','../WhatsappService/ShowWhatsAppService','key','button','open','../../models/Message','audio/mp4','selectedDisplayText','Esta\x20mensagem\x20jÃ¡\x20existe','templateButtonReplyMessage','videoMessage','warn','complationMessage','enabled','delay','../../models/CampaignShipping','queues','degreesLatitude','@c.us','../MessageServices/CreateMessageService','quotedMsg','buttonsMessage','test','debounce','fileName','-ticket','./SendWhatsAppMedia','extendedTextMessage','debug','getContentType','pushName','../../models/Setting','Error\x20getTypeMessage','length'];a553_0x5156=function(){return _0x5f0ef0;};return a553_0x5156();}function removeFile(_0x2f5b41){const _0x92d41f=a553_0x488c96;fs_2[_0x92d41f(0x188)][_0x92d41f(0x1cb)](_0x2f5b41,_0x5e33f0=>{if(_0x5e33f0)throw _0x5e33f0;});}const getTimestampMessage=_0x240b52=>{return _0x240b52*0x1;},multVecardGet=function(_0x5b4e22){const _0xfbc88d=a553_0x488c96;let _0x387751='\x20',_0x130905=_0x5b4e22[_0xfbc88d(0x24c)]('\x0a')[0x2][_0xfbc88d(0x203)](_0xfbc88d(0x26b),'\x0a')[_0xfbc88d(0x203)]('N:','')[_0xfbc88d(0x203)](';','')[_0xfbc88d(0x203)](';','\x20')[_0xfbc88d(0x203)](';;','\x20')[_0xfbc88d(0x203)]('\x0a',''),_0x115c2f=_0x5b4e22[_0xfbc88d(0x24c)]('\x0a')[0x4][_0xfbc88d(0x1c2)]('='),_0x1a70f2=_0x5b4e22['split']('\x0a')[0x4][_0xfbc88d(0x1c2)](':'),_0x5d5e55=_0x5b4e22['split']('\x0a')[0x4]['substring'](_0x115c2f+0x1,_0x1a70f2)['replace'](';',''),_0x46d199=_0x5b4e22[_0xfbc88d(0x24c)]('\x0a')[0x4][_0xfbc88d(0x203)](_0xfbc88d(0x19c),'');if(_0x5d5e55!=_0xfbc88d(0x274))_0x387751=_0x387751+_0x130905+_0xfbc88d(0x154)+_0x5d5e55+''+'\x0a';else _0x387751=_0x387751+_0x130905+_0xfbc88d(0x154)+_0x46d199+''+'\x0a';return _0x387751;},contactsArrayMessageGet=_0xae2a46=>{const _0x23f086=a553_0x488c96;let _0x176b2a=_0xae2a46[_0x23f086(0x280)]?.[_0x23f086(0x197)]?.[_0x23f086(0x1e6)],_0x34cf7e=_0x176b2a[_0x23f086(0x1cc)](function(_0x554bfc,_0x3b847e){const _0x5463cd=_0x23f086;return _0x554bfc[_0x5463cd(0x178)];}),_0x8087d='';_0x34cf7e[_0x23f086(0x1ea)](function(_0x1bf8ad,_0x2f5e1e){_0x8087d+=_0x1bf8ad+'\x0a\x0a'+'';});let _0x3ac9da=_0x8087d[_0x23f086(0x24c)](_0x23f086(0x1d1));_0x3ac9da[_0x23f086(0x260)]();let _0x25c23e='';for(let _0x311458 of _0x3ac9da){_0x25c23e=_0x25c23e+multVecardGet(_0x311458);}return _0x25c23e;},getTypeMessage=_0x354c3d=>{const _0x51fa2d=a553_0x488c96,_0x3180da=(0x0,baileys_1[_0x51fa2d(0x246)])(_0x354c3d[_0x51fa2d(0x280)]);if(_0x354c3d[_0x51fa2d(0x280)]?.[_0x51fa2d(0x161)])return _0x51fa2d(0x161);return _0x3180da;};exports[a553_0x488c96(0x1fd)]=getTypeMessage;const getBodyButton=_0x58e8bc=>{const _0x2b9584=a553_0x488c96;if(_0x58e8bc[_0x2b9584(0x22b)][_0x2b9584(0x15a)]&&_0x58e8bc[_0x2b9584(0x280)]['buttonsMessage']?.[_0x2b9584(0x1a8)]){let _0x11906b=''+_0x58e8bc?.[_0x2b9584(0x280)]?.[_0x2b9584(0x23e)]?.[_0x2b9584(0x1a8)];for(const _0xcff814 of _0x58e8bc['message']?.['buttonsMessage']?.[_0x2b9584(0x27c)]){_0x11906b+='\x0a\x0a'+_0xcff814[_0x2b9584(0x1ba)]?.[_0x2b9584(0x155)];}return _0x11906b;}if(_0x58e8bc['key'][_0x2b9584(0x15a)]&&_0x58e8bc?.[_0x2b9584(0x280)]?.[_0x2b9584(0x1e9)]?.[_0x2b9584(0x280)]?.[_0x2b9584(0x24d)]){let _0x201b5b=''+_0x58e8bc?.[_0x2b9584(0x280)]?.[_0x2b9584(0x1e9)]?.[_0x2b9584(0x280)]?.[_0x2b9584(0x24d)]?.[_0x2b9584(0x211)];for(const _0x55d5b4 of _0x58e8bc[_0x2b9584(0x280)]?.[_0x2b9584(0x1e9)]?.['message']?.[_0x2b9584(0x24d)]?.[_0x2b9584(0x1ac)]){for(const _0x5606d of _0x55d5b4[_0x2b9584(0x1b5)]){_0x201b5b+='\x0a\x0a'+_0x5606d['title'];}}return _0x201b5b;}},getBodyList=_0x3761b7=>{const _0x5706f9=a553_0x488c96;if(_0x3761b7[_0x5706f9(0x22b)][_0x5706f9(0x15a)]&&_0x3761b7['message'][_0x5706f9(0x24d)]?.[_0x5706f9(0x211)]){let _0x477a99=''+_0x3761b7['message']['listMessage']?.[_0x5706f9(0x211)];for(const _0x5349b5 of _0x3761b7[_0x5706f9(0x280)][_0x5706f9(0x24d)]?.[_0x5706f9(0x1ac)]){for(const _0x309de2 of _0x5349b5['rows']){_0x477a99+='\x0a\x0a'+_0x309de2[_0x5706f9(0x187)];}}return _0x477a99;}if(_0x3761b7[_0x5706f9(0x22b)][_0x5706f9(0x15a)]&&_0x3761b7?.[_0x5706f9(0x280)]?.[_0x5706f9(0x1e9)]?.[_0x5706f9(0x280)]?.['listMessage']){let _0x22e674=''+_0x3761b7?.[_0x5706f9(0x280)]?.['viewOnceMessage']?.[_0x5706f9(0x280)]?.[_0x5706f9(0x24d)]?.[_0x5706f9(0x211)];for(const _0x1c15c6 of _0x3761b7[_0x5706f9(0x280)]?.[_0x5706f9(0x1e9)]?.[_0x5706f9(0x280)]?.['listMessage']?.[_0x5706f9(0x1ac)]){for(const _0x5c2647 of _0x1c15c6[_0x5706f9(0x1b5)]){_0x22e674+='\x0a\x0a'+_0x5c2647[_0x5706f9(0x187)];}}return _0x22e674;}},msgLocation=(_0x2853a9,_0x4832e2,_0xa40de7)=>{const _0x1c7ebd=a553_0x488c96;if(_0x2853a9){var _0x2c02e8=Buffer['from'](_0x2853a9)[_0x1c7ebd(0x261)](_0x1c7ebd(0x1a5));let _0x2fb496=_0x1c7ebd(0x1bf)+_0x2c02e8+_0x1c7ebd(0x1ee)+_0x4832e2+'%2C'+_0xa40de7+_0x1c7ebd(0x21c)+_0x4832e2+',\x20'+_0xa40de7+'\x20';return _0x2fb496;}},getBodyMessage=_0x52a1c5=>{const _0x1d8c3c=a553_0x488c96;try{let _0x4a50cf=getTypeMessage(_0x52a1c5);const _0x462597={'conversation':_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x162)],'imageMessage':_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x264)]?.[_0x1d8c3c(0x1aa)],'videoMessage':_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x233)]?.[_0x1d8c3c(0x1aa)],'extendedTextMessage':_0x52a1c5?.[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x244)]?.['text'],'buttonsResponseMessage':_0x52a1c5['message']?.[_0x1d8c3c(0x1b6)]?.[_0x1d8c3c(0x230)],'listResponseMessage':_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x256)]?.[_0x1d8c3c(0x187)]||_0x52a1c5['message']?.[_0x1d8c3c(0x256)]?.[_0x1d8c3c(0x1ec)]?.[_0x1d8c3c(0x1c0)],'templateButtonReplyMessage':_0x52a1c5['message']?.[_0x1d8c3c(0x232)]?.[_0x1d8c3c(0x174)],'messageContextInfo':_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x1b6)]?.['selectedButtonId']||_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x256)]?.[_0x1d8c3c(0x187)],'buttonsMessage':getBodyButton(_0x52a1c5)||_0x52a1c5['message']?.[_0x1d8c3c(0x256)]?.[_0x1d8c3c(0x187)],'stickerMessage':_0x1d8c3c(0x24f),'contactMessage':_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x1f1)]?.[_0x1d8c3c(0x178)],'contactsArrayMessage':_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x197)]?.[_0x1d8c3c(0x1e6)]&&contactsArrayMessageGet(_0x52a1c5),'locationMessage':msgLocation(_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x206)]?.['jpegThumbnail'],_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x206)]?.[_0x1d8c3c(0x23a)],_0x52a1c5['message']?.[_0x1d8c3c(0x206)]?.['degreesLongitude']),'liveLocationMessage':_0x1d8c3c(0x15f)+_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x259)]?.[_0x1d8c3c(0x23a)]+'\x20-\x20Longitude:\x20'+_0x52a1c5['message']?.[_0x1d8c3c(0x259)]?.[_0x1d8c3c(0x172)],'documentMessage':_0x52a1c5[_0x1d8c3c(0x280)]?.['documentMessage']?.[_0x1d8c3c(0x187)],'audioMessage':_0x1d8c3c(0x1c6),'listMessage':getBodyList(_0x52a1c5)||_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x256)]?.[_0x1d8c3c(0x187)],'viewOnceMessage':getBodyButton(_0x52a1c5),'reactionMessage':_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x156)]?.[_0x1d8c3c(0x1fc)]||'reaction','senderKeyDistributionMessage':_0x52a1c5?.[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x196)]?.[_0x1d8c3c(0x26a)],'documentWithCaptionMessage':_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x1e1)]?.[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x1f8)]?.['caption'],'viewOnceMessageV2':_0x52a1c5['message']?.[_0x1d8c3c(0x161)]?.[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x264)]?.[_0x1d8c3c(0x1aa)],'editedMessage':_0x52a1c5['message']?.['editedMessage']?.[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x244)]?.[_0x1d8c3c(0x1fc)],'ephemeralMessage':_0x52a1c5[_0x1d8c3c(0x280)]?.[_0x1d8c3c(0x170)]?.['message']?.['extendedTextMessage']?.['text']},_0x5d3695=Object[_0x1d8c3c(0x205)](_0x462597)[_0x1d8c3c(0x27b)](_0x2fad7e=>_0x2fad7e===_0x4a50cf);return!_0x5d3695&&(logger_1[_0x1d8c3c(0x209)]['warn'](_0x1d8c3c(0x1b3)+_0x4a50cf+'\x0a'+JSON[_0x1d8c3c(0x175)](_0x52a1c5)),Sentry['setExtra'](_0x1d8c3c(0x201),{'BodyMsg':_0x52a1c5[_0x1d8c3c(0x280)],'msg':_0x52a1c5,'type':_0x4a50cf}),Sentry[_0x1d8c3c(0x1bb)](new Error('Novo\x20Tipo\x20de\x20Mensagem\x20em\x20getTypeMessage'))),_0x462597[_0x4a50cf];}catch(_0x3bbeda){Sentry[_0x1d8c3c(0x1f9)](_0x1d8c3c(0x249),{'msg':_0x52a1c5,'BodyMsg':_0x52a1c5[_0x1d8c3c(0x280)]}),Sentry[_0x1d8c3c(0x1bb)](_0x3bbeda),console[_0x1d8c3c(0x254)](_0x3bbeda);}};exports['getBodyMessage']=getBodyMessage;const getQuotedMessage=_0x2c6140=>{const _0x4b9118=a553_0x488c96,_0x55f972=(0x0,baileys_1[_0x4b9118(0x17d)])(_0x2c6140['message'])[Object['keys'](_0x2c6140?.[_0x4b9118(0x280)])[_0x4b9118(0x168)]()[_0x4b9118(0x255)]()[_0x4b9118(0x186)]];if(!_0x55f972?.[_0x4b9118(0x257)]?.[_0x4b9118(0x1f2)])return;const _0xdc0252=(0x0,baileys_1[_0x4b9118(0x17d)])(_0x55f972?.['contextInfo']?.[_0x4b9118(0x1f2)][Object[_0x4b9118(0x205)](_0x55f972?.[_0x4b9118(0x257)]?.[_0x4b9118(0x1f2)])[_0x4b9118(0x168)]()['next']()[_0x4b9118(0x186)]]);return _0xdc0252;};exports[a553_0x488c96(0x26f)]=getQuotedMessage;const getQuotedMessageId=_0x24cebb=>{const _0x522c94=a553_0x488c96,_0xa3be8c=(0x0,baileys_1['extractMessageContent'])(_0x24cebb['message'])[Object[_0x522c94(0x205)](_0x24cebb?.[_0x522c94(0x280)])['values']()['next']()[_0x522c94(0x186)]];let _0x12afa0=_0x24cebb?.['message']?.[_0x522c94(0x156)]?_0x24cebb?.[_0x522c94(0x280)]?.[_0x522c94(0x156)]?.[_0x522c94(0x22b)]?.['id']:'';return _0x12afa0?_0x12afa0:_0xa3be8c?.[_0x522c94(0x257)]?.[_0x522c94(0x1da)];};exports[a553_0x488c96(0x1e7)]=getQuotedMessageId;function a553_0x4467(_0x2b4474,_0x440468){const _0x51560d=a553_0x5156();return a553_0x4467=function(_0x44671a,_0x180353){_0x44671a=_0x44671a-0x153;let _0xd50305=_0x51560d[_0x44671a];return _0xd50305;},a553_0x4467(_0x2b4474,_0x440468);}const getMeSocket=_0x4a090d=>{const _0x3816e3=a553_0x488c96;return{'id':(0x0,baileys_1[_0x3816e3(0x27d)])(_0x4a090d['user']['id']),'name':_0x4a090d[_0x3816e3(0x1d2)][_0x3816e3(0x15d)]};},getSenderMessage=(_0x5227e1,_0x4f61ea)=>{const _0x414596=a553_0x488c96,_0x1fad81=getMeSocket(_0x4f61ea);if(_0x5227e1['key'][_0x414596(0x15a)])return _0x1fad81['id'];const _0x5b745c=_0x5227e1[_0x414596(0x1b7)]||_0x5227e1['key']['participant']||_0x5227e1[_0x414596(0x22b)][_0x414596(0x180)]||undefined;return _0x5b745c&&(0x0,baileys_1[_0x414596(0x27d)])(_0x5b745c);},getContactMessage=async(_0x3ff9af,_0x3e9a6b)=>{const _0x45fc63=a553_0x488c96,_0x204d76=_0x3ff9af[_0x45fc63(0x22b)][_0x45fc63(0x180)][_0x45fc63(0x1ce)](_0x45fc63(0x1fa)),_0x1c7a47=_0x3ff9af['key']['remoteJid'][_0x45fc63(0x203)](/\D/g,'');return _0x204d76?{'id':getSenderMessage(_0x3ff9af,_0x3e9a6b),'name':_0x3ff9af[_0x45fc63(0x247)]}:{'id':_0x3ff9af[_0x45fc63(0x22b)][_0x45fc63(0x180)],'name':_0x3ff9af[_0x45fc63(0x22b)]['fromMe']?_0x1c7a47:_0x3ff9af[_0x45fc63(0x247)]};},downloadMedia=async(_0x116091,_0x3de9f4=null)=>{const _0x55ea2f=a553_0x488c96;let _0x5f0f0b;try{_0x5f0f0b=await(0x0,baileys_1['downloadMediaMessage'])(_0x116091,_0x55ea2f(0x277),{});}catch(_0x98f131){_0x3de9f4?console[_0x55ea2f(0x254)](_0x55ea2f(0x1be)):console[_0x55ea2f(0x171)](_0x55ea2f(0x17e),_0x98f131);}let _0x5cfb80=_0x116091[_0x55ea2f(0x280)]?.[_0x55ea2f(0x1f8)]?.[_0x55ea2f(0x241)]||'';const _0x3c9074=_0x116091['message']?.['imageMessage']||_0x116091['message']?.[_0x55ea2f(0x1f3)]||_0x116091['message']?.[_0x55ea2f(0x233)]||_0x116091[_0x55ea2f(0x280)]?.[_0x55ea2f(0x183)]||_0x116091[_0x55ea2f(0x280)]?.[_0x55ea2f(0x1f8)]||_0x116091[_0x55ea2f(0x280)]?.[_0x55ea2f(0x1e1)]?.[_0x55ea2f(0x280)]?.['documentMessage']||_0x116091[_0x55ea2f(0x280)]?.[_0x55ea2f(0x244)]?.[_0x55ea2f(0x257)]?.[_0x55ea2f(0x1f2)]?.['imageMessage']||_0x116091['message']?.[_0x55ea2f(0x244)]?.[_0x55ea2f(0x257)]?.[_0x55ea2f(0x1f2)]?.[_0x55ea2f(0x233)];if(!_0x3c9074)console[_0x55ea2f(0x254)](_0x116091);if(!_0x5cfb80){const _0x4faa2f=_0x3c9074[_0x55ea2f(0x219)]['split']('/')[0x1][_0x55ea2f(0x24c)](';')[0x0];_0x5cfb80=new Date()[_0x55ea2f(0x221)]()+'.'+_0x4faa2f;}else _0x5cfb80=new Date()[_0x55ea2f(0x221)]()+'_'+_0x5cfb80;const _0x5efac0={'data':_0x5f0f0b,'mimetype':_0x3c9074[_0x55ea2f(0x219)],'filename':_0x5cfb80};return _0x5efac0;},verifyContact=async(_0x1df987,_0x2824bf,_0x538d26)=>{const _0x634b2d=a553_0x488c96;let _0x2b0731;try{_0x2b0731=await _0x2824bf[_0x634b2d(0x1e0)](_0x1df987['id'],_0x634b2d(0x1fb));}catch(_0x1b4a10){Sentry[_0x634b2d(0x1bb)](_0x1b4a10),_0x2b0731=process[_0x634b2d(0x1a3)]['FRONTEND_URL']+_0x634b2d(0x166);}const _0x135b57={'name':_0x1df987[_0x634b2d(0x15d)]||_0x1df987['id'][_0x634b2d(0x203)](/\D/g,''),'number':_0x1df987['id'][_0x634b2d(0x203)](/\D/g,''),'profilePicUrl':_0x2b0731,'isGroup':_0x1df987['id'][_0x634b2d(0x1ce)]('g.us'),'companyId':_0x538d26,'remoteJid':_0x1df987['id']};_0x135b57[_0x634b2d(0x26e)]&&(_0x135b57[_0x634b2d(0x21a)]=_0x1df987['id'][_0x634b2d(0x203)](_0x634b2d(0x21b),''));const _0x3c2b7b=(0x0,CreateOrUpdateContactService_1['default'])(_0x135b57);return _0x3c2b7b;},verifyQuotedMessage=async _0x4dc405=>{const _0x29a8c4=a553_0x488c96;if(!_0x4dc405)return null;const _0x4d7695=(0x0,exports[_0x29a8c4(0x1e7)])(_0x4dc405);if(!_0x4d7695)return null;const _0x19e1e4=await Message_1[_0x29a8c4(0x188)]['findOne']({'where':{'wid':_0x4d7695}});if(!_0x19e1e4)return null;return _0x19e1e4;},verifyMediaMessage=async(_0x409d13,_0x1dbebb,_0x2d78f4,_0x21f9e3)=>{const _0x553ad6=a553_0x488c96,_0x548594=(0x0,socket_1['getIO'])(),_0x401a53=await verifyQuotedMessage(_0x409d13);try{const _0x29d7eb=await downloadMedia(_0x409d13,_0x1dbebb?.[_0x553ad6(0x17c)]);if(!_0x29d7eb&&_0x1dbebb['imported']){const _0x7ad928=_0x553ad6(0x27f),_0x4cf2d5={'wid':_0x409d13['key']['id'],'ticketId':_0x1dbebb['id'],'contactId':_0x409d13[_0x553ad6(0x22b)][_0x553ad6(0x15a)]?undefined:_0x1dbebb[_0x553ad6(0x216)],'body':_0x7ad928,'reactionMessage':_0x409d13['message']?.[_0x553ad6(0x156)],'fromMe':_0x409d13[_0x553ad6(0x22b)][_0x553ad6(0x15a)],'mediaType':getTypeMessage(_0x409d13),'read':_0x409d13[_0x553ad6(0x22b)][_0x553ad6(0x15a)],'quotedMsgId':_0x401a53?.['id']||_0x409d13[_0x553ad6(0x280)]?.[_0x553ad6(0x156)]?.[_0x553ad6(0x22b)]?.['id'],'ack':_0x409d13[_0x553ad6(0x228)],'companyId':_0x1dbebb[_0x553ad6(0x222)],'remoteJid':_0x409d13[_0x553ad6(0x22b)][_0x553ad6(0x180)],'participant':_0x409d13[_0x553ad6(0x22b)]['participant'],'timestamp':getTimestampMessage(_0x409d13[_0x553ad6(0x198)]),'createdAt':new Date(Math[_0x553ad6(0x177)](getTimestampMessage(_0x409d13[_0x553ad6(0x198)])*0x3e8))[_0x553ad6(0x20f)](),'dataJson':JSON['stringify'](_0x409d13),'ticketImported':_0x1dbebb[_0x553ad6(0x17c)]};return await _0x1dbebb[_0x553ad6(0x262)]({'lastMessage':_0x7ad928}),logger_1[_0x553ad6(0x209)][_0x553ad6(0x171)](Error(_0x553ad6(0x204))),(0x0,CreateMessageService_1[_0x553ad6(0x188)])({'messageData':_0x4cf2d5,'companyId':_0x1dbebb[_0x553ad6(0x222)]});}if(!_0x29d7eb)throw new Error(_0x553ad6(0x204));if(!_0x29d7eb[_0x553ad6(0x1b9)]||_0x29d7eb['mimetype']===_0x553ad6(0x22f)){const _0x105ba8=_0x29d7eb[_0x553ad6(0x219)]==='audio/mp4'?_0x553ad6(0x165):_0x29d7eb['mimetype'][_0x553ad6(0x24c)]('/')[0x1][_0x553ad6(0x24c)](';')[0x0];_0x29d7eb[_0x553ad6(0x1b9)]=new Date()[_0x553ad6(0x221)]()+'.'+_0x105ba8;}else{const _0xf1e3af=_0x29d7eb[_0x553ad6(0x1b9)][_0x553ad6(0x24c)]('.')[_0x553ad6(0x25d)](),_0x431ecd=_0x29d7eb[_0x553ad6(0x1b9)]['split']('.')[_0x553ad6(0x26d)](0x0,-0x1)[_0x553ad6(0x1ed)]('.')[_0x553ad6(0x203)](/\s/g,'_')['normalize'](_0x553ad6(0x1ff))['replace'](/[\u0300-\u036f]/g,'');_0x29d7eb['filename']=_0x431ecd[_0x553ad6(0x271)]()+'_'+new Date()[_0x553ad6(0x221)]()+'.'+_0xf1e3af;}try{const _0x2fe382=path_1['default'][_0x553ad6(0x181)](__dirname,'..','..','..',_0x553ad6(0x1d0),_0x553ad6(0x224)+_0x1dbebb[_0x553ad6(0x222)]);!fs_2[_0x553ad6(0x188)][_0x553ad6(0x1b1)](_0x2fe382)&&(fs_2['default'][_0x553ad6(0x214)](_0x2fe382,{'recursive':!![]}),fs_2['default']['chmodSync'](_0x2fe382,0x1ff)),await writeFileAsync((0x0,path_1['join'])(_0x2fe382,_0x29d7eb[_0x553ad6(0x1b9)]),_0x29d7eb[_0x553ad6(0x253)]['toString'](_0x553ad6(0x1a5)),_0x553ad6(0x1a5));}catch(_0x222c31){Sentry[_0x553ad6(0x1f9)]('Erro\x20media',{'companyId':_0x1dbebb[_0x553ad6(0x222)],'ticket':_0x1dbebb,'contact':_0x2d78f4,'media':_0x29d7eb,'quotedMsg':_0x401a53}),Sentry[_0x553ad6(0x1bb)](_0x222c31),logger_1[_0x553ad6(0x209)][_0x553ad6(0x171)](_0x222c31),console[_0x553ad6(0x254)](_0x409d13);}const _0x2b991a=(0x0,exports[_0x553ad6(0x1c5)])(_0x409d13),_0x3d8574={'wid':_0x409d13[_0x553ad6(0x22b)]['id'],'ticketId':_0x1dbebb['id'],'contactId':_0x409d13[_0x553ad6(0x22b)][_0x553ad6(0x15a)]?undefined:_0x2d78f4['id'],'body':_0x2b991a||_0x29d7eb[_0x553ad6(0x1b9)],'fromMe':_0x409d13[_0x553ad6(0x22b)][_0x553ad6(0x15a)],'read':_0x409d13[_0x553ad6(0x22b)][_0x553ad6(0x15a)],'mediaUrl':_0x29d7eb['filename'],'mediaType':_0x29d7eb[_0x553ad6(0x219)][_0x553ad6(0x24c)]('/')[0x0],'quotedMsgId':_0x401a53?.['id'],'ack':_0x409d13[_0x553ad6(0x228)],'remoteJid':_0x409d13[_0x553ad6(0x22b)][_0x553ad6(0x180)],'participant':_0x409d13[_0x553ad6(0x22b)]['participant'],'dataJson':JSON['stringify'](_0x409d13),'ticketTrakingId':_0x21f9e3?.['id'],'createdAt':new Date(Math[_0x553ad6(0x177)](getTimestampMessage(_0x409d13['messageTimestamp'])*0x3e8))[_0x553ad6(0x20f)](),'ticketImported':_0x1dbebb['imported']};await _0x1dbebb[_0x553ad6(0x262)]({'lastMessage':_0x2b991a||_0x29d7eb[_0x553ad6(0x1b9)]});const _0x5262d8=await(0x0,CreateMessageService_1[_0x553ad6(0x188)])({'messageData':_0x3d8574,'companyId':_0x1dbebb[_0x553ad6(0x222)]});return!_0x409d13[_0x553ad6(0x22b)][_0x553ad6(0x15a)]&&_0x1dbebb[_0x553ad6(0x228)]===_0x553ad6(0x1c3)&&(await _0x1dbebb['update']({'status':_0x553ad6(0x250)}),await _0x1dbebb[_0x553ad6(0x182)]({'include':[{'model':Queue_1['default'],'as':_0x553ad6(0x18d)},{'model':User_1['default'],'as':'user'},{'model':Contact_1[_0x553ad6(0x188)],'as':_0x553ad6(0x267)}]}),_0x548594['to']('closed')[_0x553ad6(0x184)]('company-'+_0x1dbebb['companyId']+_0x553ad6(0x242),{'action':'delete','ticket':_0x1dbebb,'ticketId':_0x1dbebb['id']}),_0x548594['to'](_0x1dbebb[_0x553ad6(0x228)])['to'](_0x1dbebb['id']['toString']())[_0x553ad6(0x184)]('company-'+_0x1dbebb[_0x553ad6(0x222)]+_0x553ad6(0x242),{'action':_0x553ad6(0x262),'ticket':_0x1dbebb,'ticketId':_0x1dbebb['id']})),_0x5262d8;}catch(_0x307c86){console[_0x553ad6(0x254)](_0x307c86),logger_1[_0x553ad6(0x209)][_0x553ad6(0x234)](_0x553ad6(0x272));}},verifyMessage=async(_0x33b093,_0x3ff0ac,_0x4ba3d4,_0x408d19,_0x736a7a)=>{const _0x134f01=a553_0x488c96,_0x4b8ade=(0x0,socket_1[_0x134f01(0x1d6)])(),_0x451328=await verifyQuotedMessage(_0x33b093),_0x3a288b=(0x0,exports['getBodyMessage'])(_0x33b093),_0x12f6d3={'wid':_0x33b093[_0x134f01(0x22b)]['id'],'ticketId':_0x3ff0ac['id'],'contactId':_0x33b093[_0x134f01(0x22b)][_0x134f01(0x15a)]?undefined:_0x4ba3d4['id'],'body':_0x3a288b,'fromMe':_0x33b093['key'][_0x134f01(0x15a)],'mediaType':getTypeMessage(_0x33b093),'read':_0x33b093['key']['fromMe'],'quotedMsgId':_0x451328?.['id'],'ack':_0x33b093[_0x134f01(0x228)],'remoteJid':_0x33b093[_0x134f01(0x22b)][_0x134f01(0x180)],'participant':_0x33b093['key'][_0x134f01(0x1b7)],'dataJson':JSON[_0x134f01(0x175)](_0x33b093),'ticketTrakingId':_0x408d19?.['id'],'isPrivate':_0x736a7a,'createdAt':new Date(Math[_0x134f01(0x177)](getTimestampMessage(_0x33b093['messageTimestamp'])*0x3e8))[_0x134f01(0x20f)](),'ticketImported':_0x3ff0ac[_0x134f01(0x17c)]};await _0x3ff0ac[_0x134f01(0x262)]({'lastMessage':_0x3a288b}),await(0x0,CreateMessageService_1[_0x134f01(0x188)])({'messageData':_0x12f6d3,'companyId':_0x3ff0ac[_0x134f01(0x222)]}),!_0x33b093[_0x134f01(0x22b)][_0x134f01(0x15a)]&&_0x3ff0ac[_0x134f01(0x228)]===_0x134f01(0x1c3)&&(await _0x3ff0ac['update']({'status':_0x134f01(0x250)}),await _0x3ff0ac[_0x134f01(0x182)]({'include':[{'model':Queue_1[_0x134f01(0x188)],'as':_0x134f01(0x18d)},{'model':User_1['default'],'as':_0x134f01(0x1d2)},{'model':Contact_1[_0x134f01(0x188)],'as':_0x134f01(0x267)}]}),_0x4b8ade['to'](_0x134f01(0x1c3))[_0x134f01(0x184)](_0x134f01(0x1cd)+_0x3ff0ac[_0x134f01(0x222)]+_0x134f01(0x242),{'action':'delete','ticket':_0x3ff0ac,'ticketId':_0x3ff0ac['id']}),!_0x3ff0ac[_0x134f01(0x17c)]&&_0x4b8ade['to'](_0x3ff0ac[_0x134f01(0x228)])['to'](_0x3ff0ac['id'][_0x134f01(0x261)]())['emit'](_0x134f01(0x1cd)+_0x3ff0ac[_0x134f01(0x222)]+_0x134f01(0x242),{'action':_0x134f01(0x262),'ticket':_0x3ff0ac,'ticketId':_0x3ff0ac['id']}));};exports[a553_0x488c96(0x1af)]=verifyMessage;const isValidMsg=_0x21a2bc=>{const _0x3f7e09=a553_0x488c96;if(_0x21a2bc[_0x3f7e09(0x22b)][_0x3f7e09(0x180)]==='status@broadcast')return![];try{const _0x4ec76d=getTypeMessage(_0x21a2bc);if(!_0x4ec76d)return;const _0x4be3e6=_0x4ec76d===_0x3f7e09(0x162)||_0x4ec76d===_0x3f7e09(0x244)||_0x4ec76d==='audioMessage'||_0x4ec76d==='videoMessage'||_0x4ec76d==='imageMessage'||_0x4ec76d===_0x3f7e09(0x1f8)||_0x4ec76d===_0x3f7e09(0x183)||_0x4ec76d===_0x3f7e09(0x1b6)||_0x4ec76d==='buttonsMessage'||_0x4ec76d==='messageContextInfo'||_0x4ec76d===_0x3f7e09(0x206)||_0x4ec76d==='liveLocationMessage'||_0x4ec76d===_0x3f7e09(0x1f1)||_0x4ec76d===_0x3f7e09(0x1f5)||_0x4ec76d===_0x3f7e09(0x15c)||_0x4ec76d===_0x3f7e09(0x197)||_0x4ec76d==='reactionMessage'||_0x4ec76d==='ephemeralMessage'||_0x4ec76d==='protocolMessage'||_0x4ec76d===_0x3f7e09(0x256)||_0x4ec76d===_0x3f7e09(0x24d)||_0x4ec76d===_0x3f7e09(0x1e9)||_0x4ec76d===_0x3f7e09(0x1e1)||_0x4ec76d==='viewOnceMessageV2'||_0x4ec76d==='editedMessage';return!_0x4be3e6&&(logger_1[_0x3f7e09(0x209)]['warn'](_0x3f7e09(0x18e)+_0x4ec76d+'\x0a'+JSON[_0x3f7e09(0x175)](_0x21a2bc?.['message'])),Sentry[_0x3f7e09(0x1f9)](_0x3f7e09(0x201),{'BodyMsg':_0x21a2bc[_0x3f7e09(0x280)],'msg':_0x21a2bc,'msgType':_0x4ec76d}),Sentry[_0x3f7e09(0x1bb)](new Error(_0x3f7e09(0x202)))),!!_0x4be3e6;}catch(_0x4433ee){Sentry[_0x3f7e09(0x1f9)](_0x3f7e09(0x16f),{'msg':_0x21a2bc}),Sentry[_0x3f7e09(0x1bb)](_0x4433ee);}};exports[a553_0x488c96(0x1e3)]=isValidMsg;const verifyQueue=async(_0x450027,_0x4e479e,_0x23d893,_0x3a7067,_0x5021c5)=>{const _0x218567=a553_0x488c96,{queues:_0x249392,greetingMessage:_0x1c51c7,maxUseBotQueues:_0x2959fd,timeUseBotQueues:_0x3c3065}=await(0x0,ShowWhatsAppService_1[_0x218567(0x188)])(_0x450027['id'],_0x23d893[_0x218567(0x222)]),_0x352ba2=await(0x0,FindOrCreateATicketTrakingService_1[_0x218567(0x188)])({'ticketId':_0x23d893['id'],'companyId':_0x23d893[_0x218567(0x222)],'whatsappId':_0x23d893[_0x218567(0x185)]?.['id']});let _0x5b000c=![];_0x249392[_0x218567(0x24a)]===0x1&&(_0x5b000c=_0x249392[0x0]?.[_0x218567(0x1d3)][_0x218567(0x24a)]>0x1);const _0xb33e62=_0x5021c5[_0x218567(0x27b)](_0x1729c7=>_0x1729c7[_0x218567(0x22b)]===_0x218567(0x1fe))??_0x218567(0x229),_0x185347=_0xb33e62&&_0xb33e62?.[_0x218567(0x186)]===_0x218567(0x236);if(_0x249392[_0x218567(0x24a)]===0x1&&!_0x5b000c){const _0x1ce217=_0x5021c5[_0x218567(0x27b)](_0x3e85ec=>_0x3e85ec[_0x218567(0x22b)]===_0x218567(0x1b0));if(_0x1c51c7[_0x218567(0x24a)]>0x1&&_0x1ce217[_0x218567(0x186)]===_0x218567(0x236)){const _0x3eab5e=(0x0,Mustache_1[_0x218567(0x188)])(''+_0x1c51c7,_0x23d893);if(_0x23d893['whatsapp']['greetingMediaAttachment']!==null){const _0x1bc0f4=path_1['default'][_0x218567(0x181)]('public','company'+_0x23d893[_0x218567(0x222)],_0x23d893[_0x218567(0x185)][_0x218567(0x1a6)]),_0x7be017=_0x23d893['whatsapp'][_0x218567(0x1a6)],_0x167540=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x7be017,_0x1bc0f4,String(_0x23d893[_0x218567(0x222)]),_0x3eab5e),_0x311f48=await _0x450027[_0x218567(0x25e)](_0x23d893[_0x218567(0x267)][_0x218567(0x21a)]+'@'+(_0x23d893[_0x218567(0x26e)]?'g.us':_0x218567(0x16d)),{..._0x167540});await verifyMediaMessage(_0x311f48,_0x23d893,_0x3a7067,_0x352ba2);}else await _0x450027[_0x218567(0x25e)](_0x3a7067[_0x218567(0x21a)]+'@'+(_0x23d893[_0x218567(0x26e)]?_0x218567(0x1fa):'s.whatsapp.net'),{'text':_0x3eab5e});}await(0x0,UpdateTicketService_1[_0x218567(0x188)])({'ticketData':{'queueId':_0x249392[0x0]['id']},'ticketId':_0x23d893['id'],'companyId':_0x23d893['companyId']});const _0x5b8a3e=await Ticket_1[_0x218567(0x188)][_0x218567(0x263)]({'where':{'userId':null,'status':_0x218567(0x250),'companyId':_0x23d893['companyId'],'queueId':_0x249392[0x0]['id'],'isGroup':![]}});if(_0x185347){const _0x43e21c=_0x5b8a3e[_0x218567(0x159)]===0x0?0x1:_0x5b8a3e[_0x218567(0x159)],_0x53a824=_0x218567(0x17f)+_0x43e21c+'*',_0xf64643=(0x0,Mustache_1[_0x218567(0x188)])(''+_0x53a824,_0x23d893),_0x2799ad=(0x0,Debounce_1['debounce'])(async()=>{const _0x229d47=_0x218567;await _0x450027['sendMessage'](_0x3a7067['number']+'@'+(_0x23d893[_0x229d47(0x26e)]?'g.us':_0x229d47(0x16d)),{'text':_0xf64643});},0xbb8,_0x23d893['id']);_0x2799ad();}return;}if(_0x3a7067[_0x218567(0x1a4)])return;let _0x475fb0='';if(_0x23d893['status']!==_0x218567(0x18c))_0x475fb0=_0x4e479e?.['message']?.[_0x218567(0x1b6)]?.['selectedButtonId']||_0x4e479e?.['message']?.[_0x218567(0x256)]?.[_0x218567(0x1ec)][_0x218567(0x1c0)]||(0x0,exports[_0x218567(0x1c5)])(_0x4e479e);else{if(!(0x0,lodash_1['isNil'])(_0x23d893[_0x218567(0x192)]))await _0x23d893[_0x218567(0x262)]({'status':_0x218567(0x250)});await _0x23d893[_0x218567(0x182)]();}if(_0x475fb0==_0x218567(0x1a0)){const _0x31e2db={'isBot':![],'queueId':null,'userId':null,'status':_0x218567(0x1c3),'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1[_0x218567(0x188)])({'ticketData':_0x31e2db,'ticketId':_0x23d893['id'],'companyId':_0x23d893[_0x218567(0x222)]});const {complationMessage:_0xefed9f}=await(0x0,ShowWhatsAppService_1[_0x218567(0x188)])(_0x23d893[_0x218567(0x279)],_0x23d893['companyId']),_0xb692f={'text':(0x0,Mustache_1['default'])('â€Ž'+_0xefed9f,_0x23d893)};if(!(0x0,lodash_1[_0x218567(0x18f)])(_0xefed9f)){const _0x2f2425=await _0x450027[_0x218567(0x25e)](_0x23d893?.['contact']?.['number']+'@'+(_0x23d893['isGroup']?_0x218567(0x1fa):_0x218567(0x16d)),_0xb692f);await(0x0,exports['verifyMessage'])(_0x2f2425,_0x23d893,_0x23d893[_0x218567(0x267)]);}return;}const _0x3bb164=_0x5b000c&&_0x249392[_0x218567(0x24a)]===0x1?_0x249392[+_0x475fb0]:_0x249392[+_0x475fb0-0x1],_0xef2077=await Setting_1[_0x218567(0x188)][_0x218567(0x1f7)]({'where':{'key':'chatBotType','companyId':_0x23d893['companyId']}}),_0x76003d=_0xef2077?.[_0x218567(0x186)]||'text';let _0x59b822;if(_0x3bb164)try{const _0x52a6f4=await(0x0,ListUserQueueServices_1[_0x218567(0x188)])(_0x3bb164['id']);_0x52a6f4[_0x218567(0x20a)]>-0x1&&(_0x59b822=_0x52a6f4[_0x218567(0x20a)]);}catch(_0x309080){console[_0x218567(0x171)](_0x309080);}let _0x4e9be3=await Setting_1[_0x218567(0x188)]['findOne']({'where':{'key':'userRandom','companyId':_0x23d893[_0x218567(0x222)]}});const _0x420197=async()=>{const _0x4fd5fa=_0x218567;if(_0x3bb164||_0x249392[_0x4fd5fa(0x24a)]===0x1&&_0x5b000c){await(0x0,UpdateTicketService_1[_0x4fd5fa(0x188)])({'ticketData':{'amountUsedBotQueues':0x0,'queueId':_0x3bb164['id']},'ticketId':_0x23d893['id'],'companyId':_0x23d893['companyId']});if(_0x3bb164['chatbots'][_0x4fd5fa(0x24a)]>0x0){let _0x1cf750='';_0x3bb164['chatbots']['forEach']((_0xc658f3,_0x3ea857)=>{const _0x371604=_0x4fd5fa;_0x1cf750+='*'+(_0x3ea857+0x1)+_0x371604(0x27a)+_0xc658f3[_0x371604(0x15d)]+'\x0a';});const _0x53ded9=(0x0,Mustache_1['default'])('â€Ž'+_0x3bb164[_0x4fd5fa(0x17b)]+'\x0a\x0a'+_0x1cf750+_0x4fd5fa(0x1a7),_0x23d893),_0x2c4940=await _0x450027[_0x4fd5fa(0x25e)](_0x3a7067[_0x4fd5fa(0x21a)]+'@'+(_0x23d893['isGroup']?_0x4fd5fa(0x1fa):'s.whatsapp.net'),{'text':_0x53ded9});await(0x0,exports['verifyMessage'])(_0x2c4940,_0x23d893,_0x3a7067,_0x352ba2),_0x4e9be3?.[_0x4fd5fa(0x186)]==='enabled'&&await(0x0,UpdateTicketService_1['default'])({'ticketData':{'userId':_0x59b822},'ticketId':_0x23d893['id'],'companyId':_0x23d893[_0x4fd5fa(0x222)]});}if(!_0x3bb164[_0x4fd5fa(0x1d3)]['length']&&_0x3bb164['greetingMessage'][_0x4fd5fa(0x24a)]!==0x0){const _0x1a4ec7=(0x0,Mustache_1[_0x4fd5fa(0x188)])('â€Ž'+_0x3bb164[_0x4fd5fa(0x17b)],_0x23d893),_0x50a3d0=await _0x450027[_0x4fd5fa(0x25e)](_0x3a7067[_0x4fd5fa(0x21a)]+'@'+(_0x23d893[_0x4fd5fa(0x26e)]?_0x4fd5fa(0x1fa):'s.whatsapp.net'),{'text':_0x1a4ec7});await(0x0,exports[_0x4fd5fa(0x1af)])(_0x50a3d0,_0x23d893,_0x3a7067,_0x352ba2);}const _0x5eb4c7=await Ticket_1[_0x4fd5fa(0x188)][_0x4fd5fa(0x263)]({'where':{'userId':null,'status':_0x4fd5fa(0x250),'companyId':_0x23d893['companyId'],'queueId':_0x3bb164['id'],'isGroup':![]}});if(_0xb33e62[_0x4fd5fa(0x186)]===_0x4fd5fa(0x236)&&!_0x3bb164[_0x4fd5fa(0x1d3)]['length']){const _0x4c65d8=_0x5eb4c7[_0x4fd5fa(0x159)]===0x0?0x1:_0x5eb4c7['count'],_0x21cd2b='*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posiÃ§Ã£o\x20na\x20fila\x20de\x20atendimento\x20Ã©:\x20*'+_0x4c65d8+'*',_0x9aa38a=(0x0,Mustache_1[_0x4fd5fa(0x188)])(''+_0x21cd2b,_0x23d893),_0x3a2a79=(0x0,Debounce_1[_0x4fd5fa(0x240)])(async()=>{const _0x3a7b9e=_0x4fd5fa;await _0x450027['sendMessage'](_0x3a7067[_0x3a7b9e(0x21a)]+'@'+(_0x23d893[_0x3a7b9e(0x26e)]?_0x3a7b9e(0x1fa):'s.whatsapp.net'),{'text':_0x9aa38a});},0xbb8,_0x23d893['id']);_0x3a2a79();}}else{if(_0x2959fd&&_0x2959fd!==0x0&&_0x23d893[_0x4fd5fa(0x21e)]>=_0x2959fd)return;const _0x3d7b8f=await(0x0,FindOrCreateATicketTrakingService_1[_0x4fd5fa(0x188)])({'ticketId':_0x23d893['id'],'companyId':_0x23d893[_0x4fd5fa(0x222)]});let _0x1e7562=new Date(),_0x4a6c0d=new Date();if(_0x3d7b8f[_0x4fd5fa(0x15b)]!==null){_0x1e7562['setMinutes'](_0x3d7b8f[_0x4fd5fa(0x15b)][_0x4fd5fa(0x24b)]()+Number(_0x3c3065));if(_0x3d7b8f['chatbotAt']!==null&&_0x4a6c0d<_0x1e7562&&_0x3c3065!=='0')return;}await _0x3d7b8f['update']({'chatbotAt':null});let _0x4a02e4='';_0x249392[_0x4fd5fa(0x1ea)]((_0xf53640,_0x438447)=>{const _0x58f6a8=_0x4fd5fa;_0x4a02e4+='*[\x20'+(_0x438447+0x1)+_0x58f6a8(0x195)+_0xf53640['name']+'\x0a';}),_0x4a02e4+=_0x4fd5fa(0x1cf);const _0x173f66=(0x0,Mustache_1[_0x4fd5fa(0x188)])('â€Ž'+_0x1c51c7+'\x0a\x0a'+_0x4a02e4,_0x23d893);if(_0x23d893['whatsapp'][_0x4fd5fa(0x1a6)]!==null){const _0x50a329=path_1[_0x4fd5fa(0x188)]['resolve']('public',_0x4fd5fa(0x224)+_0x23d893[_0x4fd5fa(0x222)],_0x23d893[_0x4fd5fa(0x185)][_0x4fd5fa(0x1a6)]),_0x2a882f=_0x23d893[_0x4fd5fa(0x185)][_0x4fd5fa(0x1a6)],_0x394244=await(0x0,SendWhatsAppMedia_1[_0x4fd5fa(0x1ab)])(_0x2a882f,_0x50a329,String(_0x23d893[_0x4fd5fa(0x222)]),_0x173f66);let _0x4512c4=await _0x450027[_0x4fd5fa(0x25e)](_0x23d893[_0x4fd5fa(0x267)][_0x4fd5fa(0x21a)]+'@'+(_0x23d893[_0x4fd5fa(0x26e)]?_0x4fd5fa(0x1fa):_0x4fd5fa(0x16d)),{..._0x394244});await verifyMediaMessage(_0x4512c4,_0x23d893,_0x3a7067,_0x3d7b8f),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x23d893['amountUsedBotQueues']+0x1},'ticketId':_0x23d893['id'],'companyId':_0x23d893[_0x4fd5fa(0x222)]});return;}else{const _0xfb3fe7=(0x0,Debounce_1[_0x4fd5fa(0x240)])(async()=>{const _0x2c2b70=_0x4fd5fa,_0x2e2965=await _0x450027[_0x2c2b70(0x25e)](_0x3a7067['number']+'@'+(_0x23d893['isGroup']?_0x2c2b70(0x1fa):_0x2c2b70(0x16d)),{'text':_0x173f66});(0x0,exports[_0x2c2b70(0x1af)])(_0x2e2965,_0x23d893,_0x3a7067,_0x3d7b8f);},0x3e8,_0x23d893['id']);await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x23d893[_0x4fd5fa(0x21e)]+0x1},'ticketId':_0x23d893['id'],'companyId':_0x23d893[_0x4fd5fa(0x222)]}),_0xfb3fe7();}}},_0x233861=async()=>{const _0x66cd86=_0x218567;if(_0x3bb164){await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x3bb164['id']},'ticketId':_0x23d893['id'],'companyId':_0x23d893[_0x66cd86(0x222)]});if(_0x3bb164[_0x66cd86(0x1d3)][_0x66cd86(0x24a)]>0x0){const _0x198f0d=[];_0x3bb164['chatbots']['forEach']((_0x1b7c72,_0x7181b9)=>{_0x198f0d['push']({'buttonId':''+(_0x7181b9+0x1),'buttonText':{'displayText':_0x1b7c72['name']},'type':0x1});});const _0x39eb02={'text':(0x0,Mustache_1[_0x66cd86(0x188)])(''+_0x3bb164[_0x66cd86(0x17b)],_0x23d893),'buttons':_0x198f0d,'headerType':0x4},_0x44e633=await _0x450027['sendMessage'](_0x3a7067[_0x66cd86(0x21a)]+'@'+(_0x23d893['isGroup']?_0x66cd86(0x1fa):_0x66cd86(0x16d)),_0x39eb02);await(0x0,exports[_0x66cd86(0x1af)])(_0x44e633,_0x23d893,_0x3a7067,_0x352ba2);}if(!_0x3bb164['chatbots'][_0x66cd86(0x24a)]){const _0x2893dd=(0x0,Mustache_1[_0x66cd86(0x188)])(''+_0x3bb164[_0x66cd86(0x17b)],_0x23d893),_0xf639d2=await _0x450027[_0x66cd86(0x25e)](_0x3a7067[_0x66cd86(0x21a)]+'@'+(_0x23d893[_0x66cd86(0x26e)]?_0x66cd86(0x1fa):'s.whatsapp.net'),{'text':_0x2893dd});await(0x0,exports[_0x66cd86(0x1af)])(_0xf639d2,_0x23d893,_0x3a7067,_0x352ba2);}}else{const _0x2d2b1e=[];_0x249392[_0x66cd86(0x1ea)]((_0x3114d6,_0x59bd6c)=>{const _0x4d2e9b=_0x66cd86;_0x2d2b1e[_0x4d2e9b(0x167)]({'buttonId':''+(_0x59bd6c+0x1),'buttonText':{'displayText':_0x3114d6[_0x4d2e9b(0x15d)]},'type':0x4});});const _0x4c518c={'text':(0x0,Mustache_1[_0x66cd86(0x188)])(''+_0x1c51c7,_0x23d893),'footer':'','buttons':_0x2d2b1e,'headerType':0x4},_0x4cf011=await _0x450027['sendMessage'](_0x3a7067['number']+'@'+(_0x23d893[_0x66cd86(0x26e)]?_0x66cd86(0x1fa):_0x66cd86(0x16d)),_0x4c518c);await(0x0,exports[_0x66cd86(0x1af)])(_0x4cf011,_0x23d893,_0x3a7067,_0x352ba2),await(0x0,UpdateTicketService_1[_0x66cd86(0x188)])({'ticketData':{'amountUsedBotQueues':_0x23d893[_0x66cd86(0x21e)]+0x1},'ticketId':_0x23d893['id'],'companyId':_0x23d893[_0x66cd86(0x222)]});}},_0x136830=async()=>{const _0x5e7e71=_0x218567;if(_0x3bb164){await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x3bb164['id']},'ticketId':_0x23d893['id'],'companyId':_0x23d893[_0x5e7e71(0x222)]});if(_0x3bb164['chatbots'][_0x5e7e71(0x24a)]>0x0){const _0x2cfa24=[];_0x3bb164[_0x5e7e71(0x1d3)][_0x5e7e71(0x1ea)]((_0x32b399,_0x58ac1d)=>{const _0xcb2178=_0x5e7e71;_0x2cfa24[_0xcb2178(0x167)]({'title':_0x32b399[_0xcb2178(0x15d)],'rowId':''+(_0x58ac1d+0x1)});});const _0x46fc42=[{'title':_0x5e7e71(0x16e),'rows':_0x2cfa24}],_0x3a8135={'text':(0x0,Mustache_1[_0x5e7e71(0x188)])(''+_0x3bb164[_0x5e7e71(0x17b)],_0x23d893),'buttonText':_0x5e7e71(0x164),'sections':_0x46fc42},_0x25ce58=await _0x450027[_0x5e7e71(0x25e)](_0x3a7067[_0x5e7e71(0x21a)]+'@'+(_0x23d893[_0x5e7e71(0x26e)]?'g.us':_0x5e7e71(0x16d)),_0x3a8135);await(0x0,exports['verifyMessage'])(_0x25ce58,_0x23d893,_0x3a7067,_0x352ba2);}if(!_0x3bb164[_0x5e7e71(0x1d3)][_0x5e7e71(0x24a)]){const _0x197563=(0x0,Mustache_1['default'])(''+_0x3bb164[_0x5e7e71(0x17b)],_0x23d893),_0x33aa7f=await _0x450027[_0x5e7e71(0x25e)](_0x3a7067[_0x5e7e71(0x21a)]+'@'+(_0x23d893['isGroup']?_0x5e7e71(0x1fa):_0x5e7e71(0x16d)),{'text':_0x197563});await(0x0,exports[_0x5e7e71(0x1af)])(_0x33aa7f,_0x23d893,_0x3a7067,_0x352ba2);}}else{const _0x289dde=[];_0x249392['forEach']((_0x22bdf2,_0x1533b2)=>{const _0x484e14=_0x5e7e71;_0x289dde[_0x484e14(0x167)]({'title':_0x22bdf2['name'],'rowId':''+(_0x1533b2+0x1)});});const _0x1b92e0=[{'title':_0x5e7e71(0x16e),'rows':_0x289dde}],_0x4a2217={'text':(0x0,Mustache_1[_0x5e7e71(0x188)])(''+_0x1c51c7,_0x23d893),'buttonText':_0x5e7e71(0x164),'sections':_0x1b92e0},_0x59a9dd=await _0x450027['sendMessage'](_0x3a7067[_0x5e7e71(0x21a)]+'@'+(_0x23d893[_0x5e7e71(0x26e)]?_0x5e7e71(0x1fa):_0x5e7e71(0x16d)),_0x4a2217);await(0x0,exports[_0x5e7e71(0x1af)])(_0x59a9dd,_0x23d893,_0x3a7067,_0x352ba2),await(0x0,UpdateTicketService_1[_0x5e7e71(0x188)])({'ticketData':{'amountUsedBotQueues':_0x23d893[_0x5e7e71(0x21e)]+0x1},'ticketId':_0x23d893['id'],'companyId':_0x23d893[_0x5e7e71(0x222)]});}};if(_0x76003d===_0x218567(0x1fc))return _0x420197();if(_0x76003d===_0x218567(0x22c)&&_0x249392['length']>0x3)return _0x420197();if(_0x76003d===_0x218567(0x22c)&&_0x249392[_0x218567(0x24a)]<=0x3)return _0x233861();if(_0x76003d===_0x218567(0x176))return _0x136830();},verifyRating=_0x1ba2b8=>{const _0x240653=a553_0x488c96;if(_0x1ba2b8&&_0x1ba2b8[_0x240653(0x1dd)]===null&&_0x1ba2b8[_0x240653(0x1bd)]!==null&&_0x1ba2b8[_0x240653(0x20a)]!==null&&_0x1ba2b8[_0x240653(0x1ca)]===null)return!![];return![];};exports[a553_0x488c96(0x1e4)]=verifyRating;const handleRating=async(_0x5cb08d,_0x27e549,_0x23d7c2)=>{const _0x66ee5f=a553_0x488c96,_0x4e8f54=(0x0,socket_1[_0x66ee5f(0x1d6)])(),{complationMessage:_0x24ab9c}=await(0x0,ShowWhatsAppService_1[_0x66ee5f(0x188)])(_0x27e549['whatsappId'],_0x27e549[_0x66ee5f(0x222)]);let _0x333871=_0x5cb08d;_0x5cb08d<0x0&&(_0x333871=0x0);_0x5cb08d>0xa&&(_0x333871=0xa);await UserRating_1['default']['create']({'ticketId':_0x23d7c2[_0x66ee5f(0x1f6)],'companyId':_0x23d7c2['companyId'],'userId':_0x23d7c2[_0x66ee5f(0x20a)],'rate':_0x333871});if(!(0x0,lodash_1[_0x66ee5f(0x18f)])(_0x24ab9c)&&_0x24ab9c!==''&&!_0x27e549['isGroup']){const _0x3a7c43=(0x0,Mustache_1[_0x66ee5f(0x188)])('â€Ž'+_0x24ab9c,_0x27e549);if(_0x27e549[_0x66ee5f(0x190)]===_0x66ee5f(0x185)){const _0x1f7fb6=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x3a7c43,'ticket':_0x27e549});await(0x0,exports[_0x66ee5f(0x1af)])(_0x1f7fb6,_0x27e549,_0x27e549[_0x66ee5f(0x267)],_0x23d7c2);}[_0x66ee5f(0x251),_0x66ee5f(0x24e)]['includes'](_0x27e549['channel'])&&await(0x0,sendFacebookMessage_1[_0x66ee5f(0x188)])({'body':_0x3a7c43,'ticket':_0x27e549});}await _0x27e549[_0x66ee5f(0x262)]({'chatbot':null,'status':_0x66ee5f(0x1c3),'amountUseBotQueuesNPS':0x0}),_0x4e8f54['to'](_0x66ee5f(0x22d))[_0x66ee5f(0x184)](_0x66ee5f(0x1cd)+_0x27e549[_0x66ee5f(0x222)]+'-ticket',{'action':_0x66ee5f(0x1de),'ticket':_0x27e549,'ticketId':_0x27e549['id']}),_0x4e8f54['to'](_0x27e549['status'])['to'](_0x27e549['id']['toString']())[_0x66ee5f(0x184)](_0x66ee5f(0x1cd)+_0x27e549['companyId']+_0x66ee5f(0x242),{'action':_0x66ee5f(0x262),'ticket':_0x27e549,'ticketId':_0x27e549['id']});};exports[a553_0x488c96(0x1d7)]=handleRating;const handleMessage=async(_0xe4cccd,_0x20f4b1,_0x218b56,_0x32952a=![])=>{const _0x50c780=a553_0x488c96;if(_0x32952a){(0x0,addLogs_1['addLogs'])({'fileName':_0x50c780(0x1c9)+_0x20f4b1['id']+'.txt','text':_0x50c780(0x282)+JSON[_0x50c780(0x175)](_0xe4cccd,null,0x2)+_0x50c780(0x273)});let _0x1950a6=_0xe4cccd[_0x50c780(0x22b)]['id'],_0x558193=await Message_1[_0x50c780(0x188)][_0x50c780(0x1f7)]({'where':{'wid':_0x1950a6}});if(_0x558193){await new Promise(_0x5df1dd=>setTimeout(_0x5df1dd,0x96)),console[_0x50c780(0x254)](_0x50c780(0x231));return;}else await new Promise(_0x7b10b1=>setTimeout(_0x7b10b1,parseInt(process['env']['TIMEOUT_TO_IMPORT_MESSAGE'])||0x14a));}else await new Promise(_0x7b667c=>setTimeout(_0x7b667c,i*0x28a)),console[_0x50c780(0x254)](i),i++;if(!isValidMsg(_0xe4cccd))return;try{let _0x497cfb,_0x56158e,_0x36f833=0x0,_0x58014b=0x0,_0x2b47b4=0x0,_0x3c7f18=(0x0,exports[_0x50c780(0x1c5)])(_0xe4cccd);const _0x16287e=getTypeMessage(_0xe4cccd);if(_0x16287e===_0x50c780(0x281))return;const _0x5563ed=_0xe4cccd['message']?.[_0x50c780(0x1f3)]||_0xe4cccd[_0x50c780(0x280)]?.[_0x50c780(0x264)]||_0xe4cccd['message']?.['videoMessage']||_0xe4cccd[_0x50c780(0x280)]?.['documentMessage']||_0xe4cccd[_0x50c780(0x280)]['stickerMessage']||_0xe4cccd?.[_0x50c780(0x280)]?.[_0x50c780(0x170)]?.[_0x50c780(0x280)]?.['imageMessage']||_0xe4cccd?.[_0x50c780(0x280)]?.[_0x50c780(0x170)]?.['message']?.[_0x50c780(0x1f3)]||_0xe4cccd?.[_0x50c780(0x280)]?.[_0x50c780(0x170)]?.['message']?.[_0x50c780(0x233)]||_0xe4cccd?.['message']?.[_0x50c780(0x170)]?.['message']?.['documentMessage']||_0xe4cccd?.['message']?.['ephemeralMessage']?.[_0x50c780(0x280)]?.[_0x50c780(0x183)]||_0xe4cccd['message']?.[_0x50c780(0x1e9)]?.[_0x50c780(0x280)]?.[_0x50c780(0x264)]||_0xe4cccd['message']?.[_0x50c780(0x1e9)]?.[_0x50c780(0x280)]?.[_0x50c780(0x233)]||_0xe4cccd['message']?.[_0x50c780(0x170)]?.['message']?.[_0x50c780(0x1e9)]?.[_0x50c780(0x280)]?.[_0x50c780(0x264)]||_0xe4cccd['message']?.[_0x50c780(0x170)]?.[_0x50c780(0x280)]?.['viewOnceMessage']?.[_0x50c780(0x280)]?.[_0x50c780(0x233)]||_0xe4cccd[_0x50c780(0x280)]?.['documentWithCaptionMessage']?.[_0x50c780(0x280)]?.[_0x50c780(0x1f8)],_0x1f3b3a=/\u200d/[_0x50c780(0x23f)](_0x3c7f18);if(_0xe4cccd[_0x50c780(0x22b)][_0x50c780(0x15a)]){if(/\u200e/[_0x50c780(0x23f)](_0x3c7f18))return;if(!_0x5563ed&&_0x16287e!==_0x50c780(0x162)&&_0x16287e!==_0x50c780(0x244)&&_0x16287e!==_0x50c780(0x1f1)&&_0x16287e!=='reactionMessage'&&_0x16287e!==_0x50c780(0x170)&&_0x16287e!==_0x50c780(0x281)&&_0x16287e!=='viewOnceMessage'&&_0x16287e!==_0x50c780(0x173))return;_0x497cfb=await getContactMessage(_0xe4cccd,_0x20f4b1);}else _0x497cfb=await getContactMessage(_0xe4cccd,_0x20f4b1);const _0x1fd490=_0xe4cccd['key']['remoteJid']?.[_0x50c780(0x19a)](_0x50c780(0x21b)),_0x5e941d=await(0x0,ShowWhatsAppService_1[_0x50c780(0x188)])(_0x20f4b1['id'],_0x218b56);if(!_0x5e941d[_0x50c780(0x1d4)]&&_0x1fd490)return;if(_0x1fd490){const _0x335495=await _0x20f4b1[_0x50c780(0x25f)](_0xe4cccd[_0x50c780(0x22b)][_0x50c780(0x180)]),_0x9a09fa={'id':_0x335495['id'],'name':_0x335495['subject']};_0x56158e=await verifyContact(_0x9a09fa,_0x20f4b1,_0x218b56);}const _0x2d7d06=await verifyContact(_0x497cfb,_0x20f4b1,_0x218b56);let _0x5a190e=0x0,_0xb4a40=null;if(_0xe4cccd[_0x50c780(0x22b)]['fromMe'])await cache_1[_0x50c780(0x188)][_0x50c780(0x27e)](_0x50c780(0x225)+_0x2d7d06['id']+_0x50c780(0x220),'0');else{const _0x1644e6=await cache_1[_0x50c780(0x188)][_0x50c780(0x1a2)](_0x50c780(0x225)+_0x2d7d06['id']+_0x50c780(0x220));_0x5a190e=+_0x1644e6+0x1,await cache_1[_0x50c780(0x188)][_0x50c780(0x27e)](_0x50c780(0x225)+_0x2d7d06['id']+':unreads',''+_0x5a190e);}const _0x138675=await(0x0,ListSettingsService_1[_0x50c780(0x188)])({'companyId':_0x218b56}),_0x59d873=_0x138675[_0x50c780(0x27b)](_0x421894=>_0x421894['key']===_0x50c780(0x1f0)),_0x4a0e34=_0x138675[_0x50c780(0x27b)](_0x40cdb4=>_0x40cdb4['key']===_0x50c780(0x1b8)),_0x59611f=_0x138675[_0x50c780(0x27b)](_0x5c72bd=>_0x5c72bd[_0x50c780(0x22b)]===_0x50c780(0x25a)),_0x171c5d=_0x138675['find'](_0x152da8=>_0x152da8['key']==='lgpdConsent'),{ticket:_0x5aea23,isCreated:_0x522700}=await(0x0,FindOrCreateTicketService_1[_0x50c780(0x188)])(_0x2d7d06,_0x5e941d,_0x5a190e,_0x218b56,_0x36f833,_0x2b47b4,_0x56158e,_0x50c780(0x185),_0x32952a,![],_0x138675);_0xb4a40=_0x5aea23;if(_0x5a190e===0x0&&_0x5e941d[_0x50c780(0x235)]&&(0x0,Mustache_1[_0x50c780(0x188)])(_0x5e941d[_0x50c780(0x235)],_0xb4a40)===_0x3c7f18)return;if(_0x16287e===_0x50c780(0x173)){const _0x41756e=_0xe4cccd[_0x50c780(0x280)][_0x50c780(0x173)]['message']['protocolMessage'][_0x50c780(0x22b)]['id'],_0x2ec7c7=_0xe4cccd[_0x50c780(0x280)][_0x50c780(0x173)]['message'][_0x50c780(0x281)][_0x50c780(0x173)][_0x50c780(0x162)],_0x170963=(0x0,socket_1[_0x50c780(0x1d6)])();try{const _0x2f5107=await Message_1[_0x50c780(0x188)][_0x50c780(0x1f7)]({'where':{'wid':_0x41756e,'companyId':_0x218b56,'ticketId':_0xb4a40['id']}});if(!_0x2f5107)return;await _0x2f5107['update']({'isEdited':!![],'body':_0x2ec7c7}),_0x170963['to'](_0x2f5107[_0x50c780(0x1f6)][_0x50c780(0x261)]())[_0x50c780(0x184)](_0x50c780(0x1cd)+_0x2f5107[_0x50c780(0x222)]+_0x50c780(0x1a9),{'action':_0x50c780(0x262),'message':_0x2f5107});}catch(_0x2eec4d){Sentry[_0x50c780(0x1bb)](_0x2eec4d),logger_1['logger'][_0x50c780(0x171)](_0x50c780(0x20e)+_0x2eec4d);}return;}const _0x42ad1e=await(0x0,FindOrCreateATicketTrakingService_1[_0x50c780(0x188)])({'ticketId':_0xb4a40['id'],'companyId':_0x218b56,'whatsappId':_0x5e941d?.['id']});try{if(!_0xe4cccd[_0x50c780(0x22b)][_0x50c780(0x15a)]){if(_0xb4a40[_0x50c780(0x228)]===_0x50c780(0x15e)&&_0x42ad1e!==null&&(0x0,exports[_0x50c780(0x1e4)])(_0x42ad1e)){if(!isNaN(parseFloat(_0x3c7f18))){(0x0,exports[_0x50c780(0x1d7)])(parseFloat(_0x3c7f18),_0xb4a40,_0x42ad1e),await _0x42ad1e[_0x50c780(0x262)]({'ratingAt':(0x0,moment_1[_0x50c780(0x188)])()[_0x50c780(0x223)](),'finishedAt':(0x0,moment_1[_0x50c780(0x188)])()[_0x50c780(0x223)](),'rated':!![]});return;}else{if(_0xb4a40[_0x50c780(0x1b2)]<_0x5e941d['maxUseBotQueuesNPS']){let _0x4f1b2a='â€ŽOpÃ§Ã£o\x20invÃ¡lida,\x20tente\x20novamente.\x0a';const _0x32f6ef=await _0x20f4b1[_0x50c780(0x25e)](_0xb4a40['contact']['number']+'@'+(_0xb4a40[_0x50c780(0x26e)]?'g.us':_0x50c780(0x16d)),{'text':_0x4f1b2a});(0x0,exports['verifyMessage'])(_0x32f6ef,_0xb4a40,_0x2d7d06,_0x42ad1e),await(0x0,baileys_1[_0x50c780(0x237)])(0x3e8);let _0x7afbff='â€Ž'+_0x5e941d['ratingMessage']+'\x0a';const _0x484aca=await(0x0,SendWhatsAppMessage_1[_0x50c780(0x188)])({'body':_0x7afbff,'ticket':_0xb4a40});await(0x0,exports[_0x50c780(0x1af)])(_0x484aca,_0xb4a40,_0xb4a40['contact']),await _0xb4a40['update']({'amountUseBotQueuesNPS':_0xb4a40['amountUseBotQueuesNPS']+0x1});}return;}}if(_0x59d873){if(_0xb4a40[_0x50c780(0x228)]==='lgpd'&&!(0x0,lodash_1[_0x50c780(0x18f)])(_0x59d873?.[_0x50c780(0x186)])&&_0x59d873?.[_0x50c780(0x186)]===_0x50c780(0x236)&&!_0x32952a){if((0x0,lodash_1[_0x50c780(0x18f)])(_0xb4a40[_0x50c780(0x192)])&&!(0x0,lodash_1[_0x50c780(0x18f)])(_0xb4a40[_0x50c780(0x1b4)])){let _0x543a58=null;_0xe4cccd?.[_0x50c780(0x280)]?.[_0x50c780(0x162)]&&(_0x543a58=~~+_0xe4cccd[_0x50c780(0x280)]?.[_0x50c780(0x162)]);if(!Number['isNaN'](_0x543a58)&&Number[_0x50c780(0x212)](_0x543a58)&&!(0x0,lodash_1['isNull'])(_0x543a58)&&_0x543a58>0x0){if(_0x543a58===0x1)await _0x2d7d06[_0x50c780(0x262)]({'lgpdAcceptedAt':(0x0,moment_1[_0x50c780(0x188)])()[_0x50c780(0x223)]()}),await _0xb4a40[_0x50c780(0x262)]({'lgpdAcceptedAt':(0x0,moment_1['default'])()['toDate'](),'amountUsedBotQueues':0x0});else{if(_0x543a58===0x2){if(_0x5e941d[_0x50c780(0x235)]!==''&&_0x5e941d[_0x50c780(0x235)]!==undefined){const _0x74b5cd=await _0x20f4b1[_0x50c780(0x25e)](_0xb4a40['contact'][_0x50c780(0x21a)]+'@'+(_0xb4a40['isGroup']?_0x50c780(0x1fa):_0x50c780(0x16d)),{'text':'â€Ž'+_0x5e941d[_0x50c780(0x235)]});(0x0,exports[_0x50c780(0x1af)])(_0x74b5cd,_0xb4a40,_0x2d7d06,_0x42ad1e);}await _0xb4a40[_0x50c780(0x262)]({'status':'closed','amountUsedBotQueues':0x0}),await _0x42ad1e[_0x50c780(0x1d5)];return;}else _0xb4a40['amountUsedBotQueues']<_0x5e941d[_0x50c780(0x19f)]&&await _0xb4a40[_0x50c780(0x262)]({'amountUsedBotQueues':_0xb4a40[_0x50c780(0x21e)]+0x1,'lgpdSendMessageAt':null});}}else _0xb4a40['amountUsedBotQueues']<_0x5e941d[_0x50c780(0x19f)]&&await _0xb4a40[_0x50c780(0x262)]({'amountUsedBotQueues':_0xb4a40[_0x50c780(0x21e)]+0x1,'lgpdSendMessageAt':null});}if((_0x2d7d06['lgpdAcceptedAt']===null||_0x171c5d?.['value']===_0x50c780(0x236))&&!_0x2d7d06[_0x50c780(0x26e)]&&(0x0,lodash_1[_0x50c780(0x18f)])(_0xb4a40[_0x50c780(0x1b4)])&&_0xb4a40['amountUsedBotQueues']<=_0x5e941d[_0x50c780(0x19f)]&&!(0x0,lodash_1[_0x50c780(0x18f)])(_0x4a0e34?.[_0x50c780(0x186)])){_0x5563ed?await verifyMediaMessage(_0xe4cccd,_0xb4a40,_0x2d7d06):await(0x0,exports[_0x50c780(0x1af)])(_0xe4cccd,_0xb4a40,_0x2d7d06,_0x42ad1e,_0x1f3b3a);if(!(0x0,lodash_1[_0x50c780(0x18f)])(_0x4a0e34?.['value'])){const _0x140d9a=(0x0,Mustache_1['default'])('â€Ž'+_0x4a0e34?.[_0x50c780(0x186)],_0xb4a40),_0x56148a=await _0x20f4b1['sendMessage'](_0xb4a40['contact'][_0x50c780(0x21a)]+'@'+(_0xb4a40['isGroup']?_0x50c780(0x1fa):_0x50c780(0x16d)),{'text':_0x140d9a});(0x0,exports[_0x50c780(0x1af)])(_0x56148a,_0xb4a40,_0x2d7d06,_0x42ad1e);}await(0x0,baileys_1[_0x50c780(0x237)])(0x3e8);if(!(0x0,lodash_1[_0x50c780(0x18f)])(_0x59611f?.[_0x50c780(0x186)])){const _0x1fe1d0=(0x0,Mustache_1[_0x50c780(0x188)])('â€Ž'+_0x59611f['value'],_0xb4a40),_0x131b02=await _0x20f4b1[_0x50c780(0x25e)](_0xb4a40[_0x50c780(0x267)][_0x50c780(0x21a)]+'@'+(_0xb4a40[_0x50c780(0x26e)]?_0x50c780(0x1fa):_0x50c780(0x16d)),{'text':_0x1fe1d0});await(0x0,exports['verifyMessage'])(_0x131b02,_0xb4a40,_0x2d7d06,_0x42ad1e);};await(0x0,baileys_1['delay'])(0x3e8);const _0x3da5d1=(0x0,Mustache_1[_0x50c780(0x188)])(_0x50c780(0x1e8),_0xb4a40),_0xa87cea=await _0x20f4b1['sendMessage'](_0xb4a40[_0x50c780(0x267)][_0x50c780(0x21a)]+'@'+(_0xb4a40[_0x50c780(0x26e)]?_0x50c780(0x1fa):_0x50c780(0x16d)),{'text':_0x3da5d1});await(0x0,exports[_0x50c780(0x1af)])(_0xa87cea,_0xb4a40,_0x2d7d06,_0x42ad1e),await _0xb4a40[_0x50c780(0x262)]({'lgpdSendMessageAt':(0x0,moment_1['default'])()[_0x50c780(0x223)](),'amountUsedBotQueues':_0xb4a40['amountUsedBotQueues']+0x1}),await _0xb4a40[_0x50c780(0x182)]();return;};if(!(0x0,lodash_1[_0x50c780(0x18f)])(_0xb4a40['lgpdSendMessageAt'])&&(0x0,lodash_1[_0x50c780(0x18f)])(_0xb4a40[_0x50c780(0x192)]))return;}}}}catch(_0x3acd72){Sentry[_0x50c780(0x1bb)](_0x3acd72),console['log'](_0x3acd72);}_0x5563ed?await verifyMediaMessage(_0xe4cccd,_0xb4a40,_0x2d7d06):await(0x0,exports[_0x50c780(0x1af)])(_0xe4cccd,_0xb4a40,_0x2d7d06,_0x42ad1e,_0x1f3b3a);try{await _0xb4a40[_0x50c780(0x262)]({'fromMe':_0xe4cccd[_0x50c780(0x22b)][_0x50c780(0x15a)]});}catch(_0x429f3f){Sentry[_0x50c780(0x1bb)](_0x429f3f),console[_0x50c780(0x254)](_0x429f3f);}const _0x42b5c3=await Setting_1[_0x50c780(0x188)][_0x50c780(0x1f7)]({'where':{'companyId':_0x218b56,'key':_0x50c780(0x207)}}),_0x508c1b=await Setting_1[_0x50c780(0x188)][_0x50c780(0x1f7)]({'where':{'companyId':_0x218b56,'key':_0x50c780(0x1a1)}});let _0x5699e1;_0x42b5c3[_0x50c780(0x186)]===_0x50c780(0x224)&&(_0x5699e1=await(0x0,VerifyCurrentSchedule_1[_0x50c780(0x188)])(_0x218b56));try{if(!_0xe4cccd[_0x50c780(0x22b)]['fromMe']&&_0x42b5c3){if(_0x42b5c3[_0x50c780(0x186)]===_0x50c780(0x224)&&!(0x0,lodash_1[_0x50c780(0x18f)])(_0x5699e1)&&(!_0x5699e1||_0x5699e1[_0x50c780(0x199)]===![])){_0x42ad1e[_0x50c780(0x15b)]===null&&await _0x42ad1e[_0x50c780(0x262)]({'chatbotAt':(0x0,moment_1['default'])()[_0x50c780(0x223)]()});if(_0x5e941d['maxUseBotQueues']&&_0x5e941d['maxUseBotQueues']!==0x0&&_0xb4a40['amountUsedBotQueues']>=_0x5e941d['maxUseBotQueues'])return;let _0x1024ab=new Date(),_0x515b57=new Date();if(_0x42ad1e['chatbotAt']!==null){_0x1024ab[_0x50c780(0x158)](_0x42ad1e['chatbotAt'][_0x50c780(0x24b)]()+Number(_0x5e941d[_0x50c780(0x1c1)]));if(_0x42ad1e['chatbotAt']!==null&&_0x515b57<_0x1024ab&&_0x5e941d[_0x50c780(0x1c1)]!=='0')return;}await _0x42ad1e['update']({'chatbotAt':null});if(_0x5e941d[_0x50c780(0x265)]!==''){const _0x18f30d=(0x0,Mustache_1[_0x50c780(0x188)])(''+_0x5e941d[_0x50c780(0x265)],_0xb4a40),_0x28bf04=(0x0,Debounce_1[_0x50c780(0x240)])(async()=>{const _0x5cd6bf=_0x50c780;await _0x20f4b1[_0x5cd6bf(0x25e)](_0xb4a40[_0x5cd6bf(0x267)][_0x5cd6bf(0x21a)]+'@'+(_0xb4a40[_0x5cd6bf(0x26e)]?_0x5cd6bf(0x1fa):_0x5cd6bf(0x16d)),{'text':_0x18f30d});},0x3e8,_0xb4a40['id']);_0x28bf04();return;}await _0xb4a40['update']({'isOutOfHour':!![],'amountUsedBotQueues':_0xb4a40['amountUsedBotQueues']+0x1});return;}}}catch(_0x12bd24){Sentry[_0x50c780(0x1bb)](_0x12bd24),console[_0x50c780(0x254)](_0x12bd24);}!_0xb4a40[_0x50c780(0x17c)]&&!_0xb4a40['queue']&&!_0x1fd490&&!_0xe4cccd['key']['fromMe']&&!_0xb4a40[_0x50c780(0x20a)]&&_0x5e941d[_0x50c780(0x239)][_0x50c780(0x24a)]>=0x1&&(await verifyQueue(_0x20f4b1,_0xe4cccd,_0xb4a40,_0x2d7d06,_0x138675),_0x42ad1e[_0x50c780(0x15b)]===null&&await _0x42ad1e[_0x50c780(0x262)]({'chatbotAt':(0x0,moment_1[_0x50c780(0x188)])()[_0x50c780(0x223)]()}));_0xb4a40['queueId']>0x0&&await _0x42ad1e[_0x50c780(0x262)]({'queueId':_0xb4a40[_0x50c780(0x270)]});if(getTypeMessage(_0xe4cccd)===_0x50c780(0x1f3)&&!_0xe4cccd['key']['fromMe']&&!_0x1fd490&&!_0x2d7d06?.[_0x50c780(0x21f)]&&_0x508c1b?.[_0x50c780(0x186)]===_0x50c780(0x229)){const _0x25bc5d=await _0x20f4b1[_0x50c780(0x25e)](_0x2d7d06[_0x50c780(0x21a)]+_0x50c780(0x23b),{'text':'*Assistente\x20Virtual*:\x0aInfelizmente\x20nÃ£o\x20conseguimos\x20escutar\x20nem\x20enviar\x20Ã¡udios\x20por\x20este\x20canal\x20de\x20atendimento,\x20por\x20favor,\x20envie\x20uma\x20mensagem\x20de\x20*texto*.'},{'quoted':{'key':_0xe4cccd[_0x50c780(0x22b)],'message':{'extendedTextMessage':_0xe4cccd[_0x50c780(0x280)][_0x50c780(0x244)]}}});await(0x0,exports['verifyMessage'])(_0x25bc5d,_0xb4a40,_0x2d7d06,_0x42ad1e);}try{if(!_0xe4cccd['key'][_0x50c780(0x15a)]&&_0x42b5c3&&_0xb4a40[_0x50c780(0x270)]!==null){const _0x212314=await Queue_1[_0x50c780(0x188)][_0x50c780(0x226)](_0xb4a40['queueId']);_0x42b5c3?.[_0x50c780(0x186)]===_0x50c780(0x18d)&&(_0x5699e1=await(0x0,VerifyCurrentSchedule_1[_0x50c780(0x188)])(_0x218b56,_0x212314['id']));if(_0x42b5c3[_0x50c780(0x186)]===_0x50c780(0x18d)&&!(0x0,lodash_1[_0x50c780(0x18f)])(_0x5699e1)&&(!_0x5699e1||_0x5699e1[_0x50c780(0x199)]===![])){const _0x3cb9b3=_0x212314[_0x50c780(0x265)];if(_0x3cb9b3!==''){const _0x3d6238=(0x0,Mustache_1[_0x50c780(0x188)])(''+_0x3cb9b3,_0xb4a40),_0x22b99f=(0x0,Debounce_1['debounce'])(async()=>{const _0x332b56=_0x50c780;await _0x20f4b1[_0x332b56(0x25e)](_0xb4a40[_0x332b56(0x267)]['number']+'@'+(_0xb4a40[_0x332b56(0x26e)]?_0x332b56(0x1fa):_0x332b56(0x16d)),{'text':_0x3d6238});},0x3e8,_0xb4a40['id']);_0x22b99f();return;}return;}}}catch(_0x5518fc){Sentry[_0x50c780(0x1bb)](_0x5518fc),console['log'](_0x5518fc);}_0xb4a40[_0x50c780(0x18d)]&&_0xb4a40['queueId']&&!_0xe4cccd[_0x50c780(0x22b)][_0x50c780(0x15a)]&&((!_0xb4a40[_0x50c780(0x1d2)]||_0xb4a40['queue']?.[_0x50c780(0x1d3)]?.['length']>0x0)&&await(0x0,ChatBotListener_1['sayChatbot'])(_0xb4a40['queueId'],_0x20f4b1,_0xb4a40,_0x2d7d06,_0xe4cccd),await _0xb4a40['update']({'sendInactiveMessage':![]})),await _0xb4a40['reload']();}catch(_0x1d012e){Sentry[_0x50c780(0x1bb)](_0x1d012e),console['log'](_0x1d012e),logger_1['logger'][_0x50c780(0x171)]('Error\x20handling\x20whatsapp\x20message:\x20Err:\x20'+_0x1d012e);}};exports[a553_0x488c96(0x268)]=handleMessage;const handleMsgAck=async(_0x477e9d,_0x1515d8)=>{const _0x1b86ad=a553_0x488c96;await new Promise(_0x4c4f60=>setTimeout(_0x4c4f60,0x1f4));const _0x396e85=(0x0,socket_1['getIO'])();try{const _0x4e8e28=await Message_1[_0x1b86ad(0x188)]['findOne']({'where':{'wid':_0x477e9d[_0x1b86ad(0x22b)]['id']},'include':[_0x1b86ad(0x267),{'model':Message_1[_0x1b86ad(0x188)],'as':_0x1b86ad(0x23d),'include':[_0x1b86ad(0x267)]}]});if(!_0x4e8e28)return;await _0x4e8e28['update']({'ack':_0x1515d8}),_0x396e85['to'](_0x4e8e28[_0x1b86ad(0x1f6)][_0x1b86ad(0x261)]())['emit']('company-'+_0x4e8e28[_0x1b86ad(0x222)]+'-appMessage',{'action':_0x1b86ad(0x262),'message':_0x4e8e28});}catch(_0x3e36d8){Sentry[_0x1b86ad(0x1bb)](_0x3e36d8),logger_1[_0x1b86ad(0x209)][_0x1b86ad(0x171)](_0x1b86ad(0x20e)+_0x3e36d8);}},verifyRecentCampaign=async(_0x247697,_0x527ba2)=>{const _0x42d535=a553_0x488c96;if(!isValidMsg(_0x247697))return;if(!_0x247697[_0x42d535(0x22b)][_0x42d535(0x15a)]){const _0x1ee1d1=_0x247697[_0x42d535(0x22b)]['remoteJid'][_0x42d535(0x203)](/\D/g,''),_0x1d8346=await Campaign_1[_0x42d535(0x188)][_0x42d535(0x1d8)]({'where':{'companyId':_0x527ba2,'status':'EM_ANDAMENTO','confirmation':!![]}});if(_0x1d8346){const _0x1c6529=_0x1d8346['map'](_0x25af63=>_0x25af63['id']),_0x495e7d=await CampaignShipping_1['default'][_0x42d535(0x1f7)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x1c6529},'number':_0x1ee1d1,'confirmation':null}});_0x495e7d&&(await _0x495e7d[_0x42d535(0x262)]({'confirmedAt':(0x0,moment_1[_0x42d535(0x188)])(),'confirmation':!![]}),await queues_1['campaignQueue'][_0x42d535(0x1c7)](_0x42d535(0x19e),{'campaignShippingId':_0x495e7d['id'],'campaignId':_0x495e7d['campaignId']},{'delay':(0x0,queues_1['parseToMilliseconds'])((0x0,queues_1['randomValue'])(0x0,0xa))}));}}},verifyCampaignMessageAndCloseTicket=async(_0x159b90,_0x6f9a1f,_0x1d0ed2)=>{const _0xc384bb=a553_0x488c96;if(!isValidMsg(_0x159b90))return;let _0x2695cf;_0x2695cf=await getContactMessage(_0x159b90,_0x1d0ed2);const _0x4db209=await verifyContact(_0x2695cf,_0x1d0ed2,_0x6f9a1f),_0x5b04eb=(0x0,socket_1[_0xc384bb(0x1d6)])(),_0xc883b8=await(0x0,exports['getBodyMessage'])(_0x159b90),_0x375838=/\u200c/[_0xc384bb(0x23f)](_0xc883b8);if(_0x159b90[_0xc384bb(0x22b)][_0xc384bb(0x15a)]&&_0x375838){const _0x5b5068=await Message_1[_0xc384bb(0x188)][_0xc384bb(0x1f7)]({'where':{[sequelize_1['Op']['or']]:[{'wid':_0x159b90[_0xc384bb(0x22b)]['id']},{'contactId':_0x4db209['id']}],'companyId':_0x6f9a1f}});if(!(0x0,lodash_1['isNull'])(_0x5b5068)||!(0x0,lodash_1[_0xc384bb(0x18f)])(_0x5b5068)||_0x5b5068!==null){const _0x1b9c7a=await Ticket_1[_0xc384bb(0x188)]['findByPk'](_0x5b5068[_0xc384bb(0x1f6)]);await _0x1b9c7a['update']({'status':_0xc384bb(0x1c3),'amountUsedBotQueues':0x0,'amountUseOutOfHours':0x0}),_0x5b04eb['to'](_0xc384bb(0x22d))['emit'](_0xc384bb(0x1cd)+_0x1b9c7a[_0xc384bb(0x222)]+_0xc384bb(0x242),{'action':_0xc384bb(0x1de),'ticket':_0x1b9c7a,'ticketId':_0x1b9c7a['id']}),_0x5b04eb['to'](_0x1b9c7a[_0xc384bb(0x228)])['to'](_0x1b9c7a['id']['toString']())['emit'](_0xc384bb(0x1cd)+_0x1b9c7a[_0xc384bb(0x222)]+_0xc384bb(0x242),{'action':_0xc384bb(0x262),'ticket':_0x1b9c7a,'ticketId':_0x1b9c7a['id']});}}},filterMessages=_0x9527e4=>{const _0x589cee=a553_0x488c96;if(_0x9527e4['message']?.['protocolMessage'])return![];if([baileys_1['WAMessageStubType']['REVOKE'],baileys_1[_0x589cee(0x16b)]['E2E_DEVICE_CHANGED'],baileys_1[_0x589cee(0x16b)]['E2E_IDENTITY_CHANGED'],baileys_1[_0x589cee(0x16b)][_0x589cee(0x194)]]['includes'](_0x9527e4[_0x589cee(0x1ef)]))return![];return!![];},wbotMessageListener=(_0x567e44,_0x1cade4)=>{const _0x521651=a553_0x488c96;_0x567e44['ev']['on'](_0x521651(0x1c4),async _0x21d2ed=>{const _0x3a633a=_0x521651,_0x3a2cfa=_0x21d2ed[_0x3a633a(0x1eb)][_0x3a633a(0x25b)](filterMessages)[_0x3a633a(0x1cc)](_0x2d033b=>_0x2d033b);if(!_0x3a2cfa)return;_0x3a2cfa[_0x3a633a(0x1ea)](async _0x139b1a=>{const _0x29a6e6=_0x3a633a,_0x34b30d=await Message_1[_0x29a6e6(0x188)][_0x29a6e6(0x159)]({'where':{'wid':_0x139b1a[_0x29a6e6(0x22b)]['id'],'companyId':_0x1cade4}});if(!_0x34b30d){let _0x24a320=![],_0x5b597b=await(0x0,exports['getBodyMessage'])(_0x139b1a);const _0x13e7d5=_0x139b1a?.[_0x29a6e6(0x22b)]?.[_0x29a6e6(0x15a)];if(_0x13e7d5)_0x24a320=/\u200c/[_0x29a6e6(0x23f)](_0x5b597b);else{if(/\u200c/[_0x29a6e6(0x23f)](_0x5b597b))_0x5b597b=_0x5b597b[_0x29a6e6(0x203)](/\u200c/,'');logger_1[_0x29a6e6(0x209)][_0x29a6e6(0x245)]('ValidaÃ§Ã£o\x20de\x20mensagem\x20de\x20campanha\x20enviada\x20por\x20terceiros:\x20'+_0x5b597b);}!_0x24a320&&await handleMessage(_0x139b1a,_0x567e44,_0x1cade4),await verifyRecentCampaign(_0x139b1a,_0x1cade4),await verifyCampaignMessageAndCloseTicket(_0x139b1a,_0x1cade4,_0x567e44);}_0x139b1a[_0x29a6e6(0x22b)][_0x29a6e6(0x180)]?.[_0x29a6e6(0x19a)](_0x29a6e6(0x21b))&&handleMsgAck(_0x139b1a,0x2);});}),_0x567e44['ev']['on'](_0x521651(0x258),_0x13c385=>{const _0x505ae8=_0x521651;if(_0x13c385[_0x505ae8(0x24a)]===0x0)return;_0x13c385[_0x505ae8(0x1ea)](async _0x5978e5=>{const _0x509ea0=_0x505ae8;_0x567e44[_0x509ea0(0x208)]([_0x5978e5[_0x509ea0(0x22b)]]);const _0x1e8c8b={..._0x13c385};_0x1e8c8b['0']?.[_0x509ea0(0x262)][_0x509ea0(0x1ef)]===0x1&&_0x1e8c8b['0']?.['key'][_0x509ea0(0x180)]!==_0x509ea0(0x169)&&(0x0,MarkDeleteWhatsAppMessage_1[_0x509ea0(0x188)])(_0x1e8c8b['0']?.['key']['remoteJid'],null,_0x1e8c8b['0']?.['key']['id'],_0x1cade4);let _0x854e51;_0x5978e5['update'][_0x509ea0(0x228)]===0x3&&_0x5978e5?.['key']?.['fromMe']?_0x854e51=0x2:_0x854e51=_0x5978e5['update'][_0x509ea0(0x228)],handleMsgAck(_0x5978e5,_0x854e51);});}),_0x567e44['ev']['on'](_0x521651(0x16c),_0x3d9c5c=>{const _0x37e002=_0x521651;if(_0x3d9c5c[_0x37e002(0x24a)]===0x0)return;_0x3d9c5c[_0x37e002(0x1ea)](async _0x5d115b=>{const _0x550e66=_0x37e002,_0x9a46be=_0x5d115b['id'][_0x550e66(0x203)](/\D/g,''),_0x202060=_0x5d115b[_0x550e66(0x179)]||_0x9a46be,_0x242713={'name':_0x202060,'number':_0x9a46be,'isGroup':!![],'companyId':_0x1cade4},_0xad298a=await(0x0,CreateOrUpdateContactService_1[_0x550e66(0x188)])(_0x242713);});});};exports[a553_0x488c96(0x25c)]=wbotMessageListener;