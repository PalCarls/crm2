'use strict';const a516_0x310cd3=a516_0x29a6;(function(_0xad793a,_0x441f04){const _0x4c6f83=a516_0x29a6,_0x40edbc=_0xad793a();while(!![]){try{const _0x35f2be=parseInt(_0x4c6f83(0x156))/0x1*(-parseInt(_0x4c6f83(0x1b3))/0x2)+-parseInt(_0x4c6f83(0x1c2))/0x3*(-parseInt(_0x4c6f83(0x18c))/0x4)+-parseInt(_0x4c6f83(0x1ab))/0x5+-parseInt(_0x4c6f83(0x16b))/0x6+parseInt(_0x4c6f83(0x10d))/0x7*(parseInt(_0x4c6f83(0x14a))/0x8)+-parseInt(_0x4c6f83(0x1d7))/0x9+-parseInt(_0x4c6f83(0x1e6))/0xa*(-parseInt(_0x4c6f83(0x139))/0xb);if(_0x35f2be===_0x441f04)break;else _0x40edbc['push'](_0x40edbc['shift']());}catch(_0x3c8f7b){_0x40edbc['push'](_0x40edbc['shift']());}}}(a516_0x3b42,0x7e6ca));var __createBinding=this&&this[a516_0x310cd3(0x1a4)]||(Object[a516_0x310cd3(0x123)]?function(_0x3e933e,_0xf4edac,_0x54f58e,_0x4607f1){const _0x371cbe=a516_0x310cd3;if(_0x4607f1===undefined)_0x4607f1=_0x54f58e;var _0x282f67=Object[_0x371cbe(0x197)](_0xf4edac,_0x54f58e);(!_0x282f67||('get'in _0x282f67?!_0xf4edac[_0x371cbe(0x140)]:_0x282f67[_0x371cbe(0x1be)]||_0x282f67[_0x371cbe(0x1d5)]))&&(_0x282f67={'enumerable':!![],'get':function(){return _0xf4edac[_0x54f58e];}}),Object[_0x371cbe(0x173)](_0x3e933e,_0x4607f1,_0x282f67);}:function(_0x4f146b,_0x19e8e8,_0x20f5eb,_0x24dc98){if(_0x24dc98===undefined)_0x24dc98=_0x20f5eb;_0x4f146b[_0x24dc98]=_0x19e8e8[_0x20f5eb];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x10f598,_0x2a6c68){const _0x326ef9=a516_0x310cd3;Object[_0x326ef9(0x173)](_0x10f598,_0x326ef9(0x1ae),{'enumerable':!![],'value':_0x2a6c68});}:function(_0x3171b5,_0x17ed0a){const _0x4f1ffd=a516_0x310cd3;_0x3171b5[_0x4f1ffd(0x1ae)]=_0x17ed0a;}),__importStar=this&&this[a516_0x310cd3(0x11a)]||function(_0x4980cd){const _0x4ab08f=a516_0x310cd3;if(_0x4980cd&&_0x4980cd['__esModule'])return _0x4980cd;var _0x2c6e1a={};if(_0x4980cd!=null){for(var _0x1db920 in _0x4980cd)if(_0x1db920!==_0x4ab08f(0x1ae)&&Object[_0x4ab08f(0x1a0)]['hasOwnProperty'][_0x4ab08f(0x137)](_0x4980cd,_0x1db920))__createBinding(_0x2c6e1a,_0x4980cd,_0x1db920);}return __setModuleDefault(_0x2c6e1a,_0x4980cd),_0x2c6e1a;},__importDefault=this&&this['__importDefault']||function(_0x3ab28c){return _0x3ab28c&&_0x3ab28c['__esModule']?_0x3ab28c:{'default':_0x3ab28c};};Object[a516_0x310cd3(0x173)](exports,a516_0x310cd3(0x140),{'value':!![]}),exports[a516_0x310cd3(0x1dd)]=exports[a516_0x310cd3(0xdb)]=exports[a516_0x310cd3(0x129)]=exports[a516_0x310cd3(0x1d4)]=exports[a516_0x310cd3(0x102)]=exports['getQuotedMessage']=exports['getBodyMessage']=void 0x0;function a516_0x29a6(_0x375397,_0x48fcbc){const _0x3b42e0=a516_0x3b42();return a516_0x29a6=function(_0x29a6ca,_0x1a4614){_0x29a6ca=_0x29a6ca-0xd0;let _0x1bd903=_0x3b42e0[_0x29a6ca];return _0x1bd903;},a516_0x29a6(_0x375397,_0x48fcbc);}const path_1=require(a516_0x310cd3(0x1af)),util_1=require('util'),fs_1=require('fs'),fs_2=__importDefault(require('fs')),Sentry=__importStar(require('@sentry/node')),lodash_1=require(a516_0x310cd3(0x127)),baileys_1=require(a516_0x310cd3(0xdf)),Contact_1=__importDefault(require(a516_0x310cd3(0x1ef))),Ticket_1=__importDefault(require(a516_0x310cd3(0x10c))),Message_1=__importDefault(require(a516_0x310cd3(0x1df))),socket_1=require(a516_0x310cd3(0x120)),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),logger_1=require(a516_0x310cd3(0x155)),CreateOrUpdateContactService_1=__importDefault(require('../ContactServices/CreateOrUpdateContactService')),FindOrCreateTicketService_1=__importDefault(require(a516_0x310cd3(0x117))),ShowWhatsAppService_1=__importDefault(require(a516_0x310cd3(0x1ee))),Debounce_1=require(a516_0x310cd3(0x11c)),UpdateTicketService_1=__importDefault(require(a516_0x310cd3(0x1f5))),Mustache_1=__importDefault(require(a516_0x310cd3(0x15f))),UserRating_1=__importDefault(require(a516_0x310cd3(0x131))),SendWhatsAppMessage_1=__importDefault(require(a516_0x310cd3(0x119))),sendFacebookMessage_1=__importDefault(require(a516_0x310cd3(0x1e7))),moment_1=__importDefault(require(a516_0x310cd3(0xdc))),Queue_1=__importDefault(require(a516_0x310cd3(0xf3))),FindOrCreateATicketTrakingService_1=__importDefault(require(a516_0x310cd3(0x1e4))),VerifyCurrentSchedule_1=__importDefault(require('../CompanyService/VerifyCurrentSchedule')),Campaign_1=__importDefault(require(a516_0x310cd3(0xd7))),CampaignShipping_1=__importDefault(require(a516_0x310cd3(0xff))),sequelize_1=require(a516_0x310cd3(0x100)),queues_1=require(a516_0x310cd3(0x109)),User_1=__importDefault(require(a516_0x310cd3(0x130))),Setting_1=__importDefault(require(a516_0x310cd3(0xf6))),ChatBotListener_1=require(a516_0x310cd3(0xef)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a516_0x310cd3(0x132))),ListUserQueueServices_1=__importDefault(require(a516_0x310cd3(0xe0))),fluent_ffmpeg_1=__importDefault(require(a516_0x310cd3(0x15c))),ffmpeg_1=require('@ffmpeg-installer/ffmpeg'),cache_1=require(a516_0x310cd3(0x182)),ListSettingsServiceOne_1=__importDefault(require(a516_0x310cd3(0x18e))),ShowTicketService_1=__importDefault(require(a516_0x310cd3(0x166)));fluent_ffmpeg_1['default'][a516_0x310cd3(0x171)](ffmpeg_1[a516_0x310cd3(0x1af)]);function a516_0x3b42(){const _0x419681=['isGroup','getQuotedMessageId','buttonsMessage','user','queue','extractMessageContent','complationMessage','button','../../queues','key','getTime','../../models/Ticket','91UdqMJW','map','@g.us','s.whatsapp.net','contacts:','set','emit','quotedMessage','degreesLongitude','normalize','../TicketServices/FindOrCreateTicketService','values','./SendWhatsAppMessage','__importStar','campaignId','../../helpers/Debounce','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','writeFile','sendGreetingMessageOneQueues','../../libs/socket','liveLocationMessage','g.us','create','name','audio/mp4','findOne','lodash','groupMetadata','verifyRating','log','unlink','Erro\x20ao\x20baixar\x20media','documentMessage','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20getTypeMessage','trim','../../models/User','../../models/UserRating','./MarkDeleteWhatsAppMessage','â€ŽEstou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20NÃ£o','isNaN','caption','subject','call','outOfHoursMessage','11LbYqjm','viewOnceMessageV2','Escolha\x20uma\x20opÃ§Ã£o','FRONTEND_URL','lgpdSendMessageAt','buffer',':unreads','__esModule','selectedButtonId','base64','company','fileName','debug','degreesLatitude','filename','instagram','test','72968oLjjGm','E2E_DEVICE_CHANGED','destroy','group','company-','displayText','includes','forEach','isNil','reload','downloadMediaMessage','../../utils/logger','28109kXFiwG','setExtra','getQuotedMessage','conversation','m4a','ticketId','fluent-ffmpeg','messages','\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento','../../helpers/Mustache','debounce','Sair','%2C','NFD','status','value','../TicketServices/ShowTicketService','rows','open','warn','enabled','2433288tFpzsa','Error\x20getTypeMessage','maxUseBotQueuesNPS','contactMessage','messages.upsert','setMinutes','setFfmpegPath','chatbots','defineProperty','*\x20-\x20','LINHA\x20462','imageMessage','logger','lgpdAcceptedAt','greetingMessage','promisify','next','substring',':\x20ðŸ“ž','getIO','Error\x20isValidMsg','contentText','buttonText','../../libs/cache','groups.update','REVOKE','readMessages','sendQueuePosition','whatsappId','Erro\x20ao\x20baixar\x20mÃ­dia:','userRandom','getContentType','closed','2032JDmNle','whatsapp','../SettingServices/ListSettingsServiceOne','*Assistente\x20Virtual*:\x0aInfelizmente\x20nÃ£o\x20conseguimos\x20escutar\x20nem\x20enviar\x20Ã¡udios\x20por\x20este\x20canal\x20de\x20atendimento,\x20por\x20favor,\x20envie\x20uma\x20mensagem\x20de\x20*texto*.','locationMessage','documentWithCaptionMessage','env','update','find','count','messages.update','getOwnPropertyDescriptor','axolotlSenderKeyDistributionMessage','voiceMessage','videoMessage','acceptAudioMessage','replace','isNull','amountUseBotQueuesNPS','mkdirSync','prototype','####\x20Nao\x20achou\x20o\x20type\x20152:\x20','sayChatbot','randomValue','__createBinding','stringify','selectedDisplayText','stickerMessage','shift','extendedTextMessage','quotedMsg','2387990ZNcKNV','selectedId','disabled','default','path','list','getBodyMessage','sendMessage','68ynjzPo','sections','messageContextInfo','existsSync','userId','ERR_WAPP_DOWNLOAD_MEDIA','toDate','buttonsResponseMessage','WAMessageStubType','image','captureException','writable','participant','contacts','delay','4908JblHcR','scheduleType','DispatchCampaign','contactsArrayMessage','chatBotType','Menu','queueId','pop','*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posiÃ§Ã£o\x20na\x20fila\x20de\x20atendimento\x20Ã©:\x20*','from','maxUseBotQueues',';;;','profilePictureUrl','contact','Erro\x20midea','Mensagem','/nopicture.png','fromMe','verifyMessage','configurable','ephemeralMessage','3335652XawvZK','amountUsedBotQueues','inActivity','â€ŽOpÃ§Ã£o\x20invÃ¡lida,\x20tente\x20novamente.\x0a','pending','messageStubType','handleMessage','delete','../../models/Message','vcard','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','cacheLayer','findAll','../TicketServices/FindOrCreateATicketTrakingService','number','17776530NmcZQv','../FacebookServices/sendFacebookMessage','@c.us','isInteger','toString','closedAt','\x20|\x20https://maps.google.com/maps?q=','sticker','../WhatsappService/ShowWhatsAppService','../../models/Contact','buttons','item1.TEL','nps','-ticket','mimetype','../TicketServices/UpdateTicketService','facebook','ratingAt','editedMessage','companyId','reactionMessage','stanzaId','endsWith','audioMessage','viewOnceMessage','EM_ANDAMENTO','listResponseMessage','push','lgpdLink','../../models/Campaign','keys','item1.TEL:','chatbotAt','wbotMessageListener','moment','pushName','queues','@whiskeysockets/baileys','../UserQueueServices/ListUserQueueServices','lgpd','jpegThumbnail','filter','text','split','E2E_IDENTITY_CHANGED','Ãudio','title','join','BEGIN:','campaignQueue','findByPk','channel','remoteJid','./ChatBotListener','findAndCountAll','description','contextInfo','../../models/Queue','get','mediaMessage','../../models/Setting','error','protocolMessage','message','listMessage','length','status@broadcast','singleSelectReply','selectedRowId','../../models/CampaignShipping','sequelize'];a516_0x3b42=function(){return _0x419681;};return a516_0x3b42();}const writeFileAsync=(0x0,util_1[a516_0x310cd3(0x17a)])(fs_1[a516_0x310cd3(0x11e)]);function removeFile(_0x5af9e3){const _0x219caa=a516_0x310cd3;fs_2[_0x219caa(0x1ae)][_0x219caa(0x12b)](_0x5af9e3,_0x5e6246=>{if(_0x5e6246)throw _0x5e6246;});}const getTimestampMessage=_0x435a1f=>{return _0x435a1f*0x1;},multVecardGet=function(_0x4c9a88){const _0x3eccad=a516_0x310cd3;let _0xd7f76a='\x20',_0x5cddc6=_0x4c9a88[_0x3eccad(0xe5)]('\x0a')[0x2][_0x3eccad(0x19c)](_0x3eccad(0x1cd),'\x0a')[_0x3eccad(0x19c)]('N:','')[_0x3eccad(0x19c)](';','')[_0x3eccad(0x19c)](';','\x20')[_0x3eccad(0x19c)](';;','\x20')[_0x3eccad(0x19c)]('\x0a',''),_0x25b00a=_0x4c9a88['split']('\x0a')[0x4]['indexOf']('='),_0x348804=_0x4c9a88[_0x3eccad(0xe5)]('\x0a')[0x4]['indexOf'](':'),_0x38b80f=_0x4c9a88[_0x3eccad(0xe5)]('\x0a')[0x4][_0x3eccad(0x17c)](_0x25b00a+0x1,_0x348804)[_0x3eccad(0x19c)](';',''),_0x4399c5=_0x4c9a88[_0x3eccad(0xe5)]('\x0a')[0x4]['replace'](_0x3eccad(0xd9),'');if(_0x38b80f!=_0x3eccad(0x1f1))_0xd7f76a=_0xd7f76a+_0x5cddc6+':\x20ðŸ“ž'+_0x38b80f+''+'\x0a';else _0xd7f76a=_0xd7f76a+_0x5cddc6+_0x3eccad(0x17d)+_0x4399c5+''+'\x0a';return _0xd7f76a;},contactsArrayMessageGet=_0x424104=>{const _0x4aac9a=a516_0x310cd3;let _0xc96a7f=_0x424104[_0x4aac9a(0xf9)]?.[_0x4aac9a(0x1c5)]?.[_0x4aac9a(0x1c0)],_0x288ce4=_0xc96a7f['map'](function(_0x4cd408,_0x865c2f){const _0x55dc4d=_0x4aac9a;return _0x4cd408[_0x55dc4d(0x1e0)];}),_0x17c237='';_0x288ce4[_0x4aac9a(0x151)](function(_0xd8f85,_0x5a4866){_0x17c237+=_0xd8f85+'\x0a\x0a'+'';});let _0x2de4de=_0x17c237[_0x4aac9a(0xe5)](_0x4aac9a(0xea));_0x2de4de[_0x4aac9a(0x1a8)]();let _0x50728f='';for(let _0x4e1aa1 of _0x2de4de){_0x50728f=_0x50728f+multVecardGet(_0x4e1aa1);}return _0x50728f;},getTypeMessage=_0x447d62=>{const _0x55656d=a516_0x310cd3,_0x32d648=(0x0,baileys_1[_0x55656d(0x18a)])(_0x447d62['message']);if(_0x447d62[_0x55656d(0xf9)]?.['viewOnceMessageV2'])return _0x55656d(0x13a);return _0x32d648;},getBodyButton=_0x11d1b6=>{const _0x911692=a516_0x310cd3;if(_0x11d1b6[_0x911692(0x10a)][_0x911692(0x1d3)]&&_0x11d1b6['message']['buttonsMessage']?.[_0x911692(0x180)]){let _0x4db7da=''+_0x11d1b6?.[_0x911692(0xf9)]?.[_0x911692(0x103)]?.['contentText'];for(const _0x1a45d8 of _0x11d1b6[_0x911692(0xf9)]?.[_0x911692(0x103)]?.[_0x911692(0x1f0)]){_0x4db7da+='\x0a\x0a'+_0x1a45d8[_0x911692(0x181)]?.[_0x911692(0x14f)];}return _0x4db7da;}if(_0x11d1b6[_0x911692(0x10a)][_0x911692(0x1d3)]&&_0x11d1b6?.[_0x911692(0xf9)]?.['viewOnceMessage']?.[_0x911692(0xf9)]?.['listMessage']){let _0x545c38=''+_0x11d1b6?.[_0x911692(0xf9)]?.[_0x911692(0xd2)]?.[_0x911692(0xf9)]?.[_0x911692(0xfa)]?.['description'];for(const _0xb9f497 of _0x11d1b6[_0x911692(0xf9)]?.['viewOnceMessage']?.[_0x911692(0xf9)]?.[_0x911692(0xfa)]?.[_0x911692(0x1b4)]){for(const _0x131b25 of _0xb9f497['rows']){_0x545c38+='\x0a\x0a'+_0x131b25[_0x911692(0xe8)];}}return _0x545c38;}},getBodyList=_0x262e8b=>{const _0x7ce7=a516_0x310cd3;if(_0x262e8b[_0x7ce7(0x10a)][_0x7ce7(0x1d3)]&&_0x262e8b[_0x7ce7(0xf9)][_0x7ce7(0xfa)]?.[_0x7ce7(0xf1)]){let _0x4b504a=''+_0x262e8b[_0x7ce7(0xf9)][_0x7ce7(0xfa)]?.[_0x7ce7(0xf1)];for(const _0x1e48f5 of _0x262e8b[_0x7ce7(0xf9)]['listMessage']?.[_0x7ce7(0x1b4)]){for(const _0x3a79d9 of _0x1e48f5[_0x7ce7(0x167)]){_0x4b504a+='\x0a\x0a'+_0x3a79d9[_0x7ce7(0xe8)];}}return _0x4b504a;}if(_0x262e8b[_0x7ce7(0x10a)][_0x7ce7(0x1d3)]&&_0x262e8b?.['message']?.[_0x7ce7(0xd2)]?.['message']?.['listMessage']){let _0x12e0e5=''+_0x262e8b?.[_0x7ce7(0xf9)]?.[_0x7ce7(0xd2)]?.[_0x7ce7(0xf9)]?.[_0x7ce7(0xfa)]?.['description'];for(const _0x32960f of _0x262e8b[_0x7ce7(0xf9)]?.[_0x7ce7(0xd2)]?.[_0x7ce7(0xf9)]?.['listMessage']?.[_0x7ce7(0x1b4)]){for(const _0xb169d of _0x32960f[_0x7ce7(0x167)]){_0x12e0e5+='\x0a\x0a'+_0xb169d[_0x7ce7(0xe8)];}}return _0x12e0e5;}},msgLocation=(_0x160c70,_0x433d89,_0x5cced1)=>{const _0xf4d6b=a516_0x310cd3;if(_0x160c70){var _0x2167ba=Buffer[_0xf4d6b(0x1cb)](_0x160c70)['toString']('base64');let _0x37171e='data:image/png;base64,\x20'+_0x2167ba+_0xf4d6b(0x1ec)+_0x433d89+_0xf4d6b(0x162)+_0x5cced1+'&z=17&hl=pt-BR|'+_0x433d89+',\x20'+_0x5cced1+'\x20';return _0x37171e;}},getBodyMessage=_0x34e50d=>{const _0x43e5c9=a516_0x310cd3;try{let _0x494bc5=getTypeMessage(_0x34e50d);const _0x744f24={'conversation':_0x34e50d['message']?.[_0x43e5c9(0x159)],'imageMessage':_0x34e50d[_0x43e5c9(0xf9)]?.[_0x43e5c9(0x176)]?.['caption'],'videoMessage':_0x34e50d[_0x43e5c9(0xf9)]?.[_0x43e5c9(0x19a)]?.['caption'],'extendedTextMessage':_0x34e50d?.['message']?.[_0x43e5c9(0x1a9)]?.[_0x43e5c9(0xe4)],'buttonsResponseMessage':_0x34e50d[_0x43e5c9(0xf9)]?.['buttonsResponseMessage']?.[_0x43e5c9(0x1a6)],'listResponseMessage':_0x34e50d['message']?.[_0x43e5c9(0xd4)]?.[_0x43e5c9(0xe8)]||_0x34e50d['message']?.[_0x43e5c9(0xd4)]?.[_0x43e5c9(0xfd)]?.[_0x43e5c9(0xfe)],'templateButtonReplyMessage':_0x34e50d[_0x43e5c9(0xf9)]?.['templateButtonReplyMessage']?.[_0x43e5c9(0x1ac)],'messageContextInfo':_0x34e50d[_0x43e5c9(0xf9)]?.['buttonsResponseMessage']?.[_0x43e5c9(0x141)]||_0x34e50d[_0x43e5c9(0xf9)]['listResponseMessage']?.['title'],'buttonsMessage':getBodyButton(_0x34e50d)||_0x34e50d['message']?.[_0x43e5c9(0xd4)]?.[_0x43e5c9(0xe8)],'stickerMessage':_0x43e5c9(0x1ed),'contactMessage':_0x34e50d[_0x43e5c9(0xf9)]?.[_0x43e5c9(0x16e)]?.[_0x43e5c9(0x1e0)],'contactsArrayMessage':_0x34e50d[_0x43e5c9(0xf9)]?.[_0x43e5c9(0x1c5)]?.[_0x43e5c9(0x1c0)]&&contactsArrayMessageGet(_0x34e50d),'locationMessage':msgLocation(_0x34e50d[_0x43e5c9(0xf9)]?.['locationMessage']?.[_0x43e5c9(0xe2)],_0x34e50d['message']?.['locationMessage']?.[_0x43e5c9(0x146)],_0x34e50d[_0x43e5c9(0xf9)]?.[_0x43e5c9(0x190)]?.['degreesLongitude']),'liveLocationMessage':'Latitude:\x20'+_0x34e50d[_0x43e5c9(0xf9)][_0x43e5c9(0x121)]?.['degreesLatitude']+'\x20-\x20Longitude:\x20'+_0x34e50d[_0x43e5c9(0xf9)]['liveLocationMessage']?.[_0x43e5c9(0x115)],'documentMessage':_0x34e50d[_0x43e5c9(0xf9)]['documentMessage']?.[_0x43e5c9(0xe8)],'audioMessage':_0x43e5c9(0xe7),'listMessage':getBodyList(_0x34e50d)||_0x34e50d[_0x43e5c9(0xf9)][_0x43e5c9(0xd4)]?.['title'],'viewOnceMessage':getBodyButton(_0x34e50d),'reactionMessage':_0x34e50d[_0x43e5c9(0xf9)]['reactionMessage']?.['text']||'reaction','senderKeyDistributionMessage':_0x34e50d?.['message']?.['senderKeyDistributionMessage']?.[_0x43e5c9(0x198)],'documentWithCaptionMessage':_0x34e50d[_0x43e5c9(0xf9)]?.[_0x43e5c9(0x191)]?.['message']?.[_0x43e5c9(0x12d)]?.['caption'],'viewOnceMessageV2':_0x34e50d[_0x43e5c9(0xf9)]?.[_0x43e5c9(0x13a)]?.['message']?.[_0x43e5c9(0x176)]?.[_0x43e5c9(0x135)],'editedMessage':_0x34e50d[_0x43e5c9(0xf9)]?.['editedMessage']?.[_0x43e5c9(0xf9)]?.[_0x43e5c9(0x1a9)]?.[_0x43e5c9(0xe4)]},_0x5284aa=Object[_0x43e5c9(0xd8)](_0x744f24)[_0x43e5c9(0x194)](_0x49899e=>_0x49899e===_0x494bc5);return!_0x5284aa&&(logger_1[_0x43e5c9(0x177)]['warn'](_0x43e5c9(0x1a1)+_0x494bc5+'\x0a'+JSON[_0x43e5c9(0x1a5)](_0x34e50d)),Sentry[_0x43e5c9(0x157)](_0x43e5c9(0x1d1),{'BodyMsg':_0x34e50d['message'],'msg':_0x34e50d,'type':_0x494bc5}),Sentry[_0x43e5c9(0x1bd)](new Error(_0x43e5c9(0x12e)))),_0x744f24[_0x494bc5];}catch(_0x288038){Sentry['setExtra'](_0x43e5c9(0x16c),{'msg':_0x34e50d,'BodyMsg':_0x34e50d[_0x43e5c9(0xf9)]}),Sentry[_0x43e5c9(0x1bd)](_0x288038),console[_0x43e5c9(0x12a)](_0x288038);}};exports[a516_0x310cd3(0x1b1)]=getBodyMessage;const getQuotedMessage=_0x33022e=>{const _0x3051c0=a516_0x310cd3,_0x31aad6=(0x0,baileys_1[_0x3051c0(0x106)])(_0x33022e[_0x3051c0(0xf9)])[Object[_0x3051c0(0xd8)](_0x33022e?.['message'])[_0x3051c0(0x118)]()[_0x3051c0(0x17b)]()[_0x3051c0(0x165)]];if(!_0x31aad6?.[_0x3051c0(0xf2)]?.['quotedMessage'])return;const _0x6a8d48=(0x0,baileys_1[_0x3051c0(0x106)])(_0x31aad6?.[_0x3051c0(0xf2)]?.[_0x3051c0(0x114)][Object['keys'](_0x31aad6?.[_0x3051c0(0xf2)]?.[_0x3051c0(0x114)])[_0x3051c0(0x118)]()[_0x3051c0(0x17b)]()[_0x3051c0(0x165)]]);return _0x6a8d48;};exports[a516_0x310cd3(0x158)]=getQuotedMessage;const getQuotedMessageId=_0xb6607b=>{const _0x41b3b2=a516_0x310cd3,_0x4c9b1=(0x0,baileys_1[_0x41b3b2(0x106)])(_0xb6607b[_0x41b3b2(0xf9)])[Object[_0x41b3b2(0xd8)](_0xb6607b?.[_0x41b3b2(0xf9)])[_0x41b3b2(0x118)]()[_0x41b3b2(0x17b)]()['value']];let _0x14b9e7=_0xb6607b?.[_0x41b3b2(0xf9)]?.[_0x41b3b2(0x1fa)]?_0xb6607b?.[_0x41b3b2(0xf9)]?.['reactionMessage']?.[_0x41b3b2(0x10a)]?.['id']:'';return _0x14b9e7?_0x14b9e7:_0x4c9b1?.[_0x41b3b2(0xf2)]?.[_0x41b3b2(0x1fb)];};exports[a516_0x310cd3(0x102)]=getQuotedMessageId;const getMeSocket=_0x27bc21=>{const _0x79127b=a516_0x310cd3;return{'id':(0x0,baileys_1['jidNormalizedUser'])(_0x27bc21[_0x79127b(0x104)]['id']),'name':_0x27bc21['user']['name']};},getSenderMessage=(_0x1e94e1,_0x399f05)=>{const _0x31a992=a516_0x310cd3,_0xfa26ba=getMeSocket(_0x399f05);if(_0x1e94e1[_0x31a992(0x10a)]['fromMe'])return _0xfa26ba['id'];const _0x4290f3=_0x1e94e1[_0x31a992(0x1bf)]||_0x1e94e1[_0x31a992(0x10a)][_0x31a992(0x1bf)]||_0x1e94e1[_0x31a992(0x10a)][_0x31a992(0xee)]||undefined;return _0x4290f3&&(0x0,baileys_1['jidNormalizedUser'])(_0x4290f3);},getContactMessage=async(_0x44926c,_0x5d3b1e)=>{const _0xf010b2=a516_0x310cd3,_0x268856=_0x44926c[_0xf010b2(0x10a)][_0xf010b2(0xee)][_0xf010b2(0x150)]('g.us'),_0x498fdc=_0x44926c[_0xf010b2(0x10a)][_0xf010b2(0xee)][_0xf010b2(0x19c)](/\D/g,'');return _0x268856?{'id':getSenderMessage(_0x44926c,_0x5d3b1e),'name':_0x44926c['pushName']}:{'id':_0x44926c[_0xf010b2(0x10a)][_0xf010b2(0xee)],'name':_0x44926c['key'][_0xf010b2(0x1d3)]?_0x498fdc:_0x44926c[_0xf010b2(0xdd)]};},downloadMedia=async _0x2378cf=>{const _0xde6c76=a516_0x310cd3;let _0x4533de;try{_0x4533de=await(0x0,baileys_1[_0xde6c76(0x154)])(_0x2378cf,_0xde6c76(0x13e),{});}catch(_0x418032){console['error'](_0xde6c76(0x188),_0x418032);}let _0x53141f=_0x2378cf[_0xde6c76(0xf9)]?.[_0xde6c76(0x12d)]?.[_0xde6c76(0x144)]||'';const _0x2b0716=_0x2378cf['message']?.['imageMessage']||_0x2378cf[_0xde6c76(0xf9)]?.[_0xde6c76(0xd1)]||_0x2378cf['message']?.[_0xde6c76(0x19a)]||_0x2378cf[_0xde6c76(0xf9)]?.[_0xde6c76(0x1a7)]||_0x2378cf[_0xde6c76(0xf9)]?.[_0xde6c76(0x12d)]||_0x2378cf[_0xde6c76(0xf9)]?.[_0xde6c76(0x191)]?.[_0xde6c76(0xf9)]?.[_0xde6c76(0x12d)]||_0x2378cf[_0xde6c76(0xf9)]?.[_0xde6c76(0x1a9)]?.['contextInfo']?.[_0xde6c76(0x114)]?.[_0xde6c76(0x176)]||_0x2378cf[_0xde6c76(0xf9)]?.[_0xde6c76(0x1a9)]?.['contextInfo']?.[_0xde6c76(0x114)]?.[_0xde6c76(0x19a)];if(!_0x53141f){const _0x2bdae3=_0x2b0716[_0xde6c76(0x1f4)][_0xde6c76(0xe5)]('/')[0x1][_0xde6c76(0xe5)](';')[0x0];_0x53141f=new Date()[_0xde6c76(0x10b)]()+'.'+_0x2bdae3;}else _0x53141f=new Date()[_0xde6c76(0x10b)]()+'_'+_0x53141f;const _0x4a08a5={'data':_0x4533de,'mimetype':_0x2b0716[_0xde6c76(0x1f4)],'filename':_0x53141f};return _0x4a08a5;},verifyContact=async(_0x3a326f,_0x500083,_0x558dd0)=>{const _0x4937e2=a516_0x310cd3;let _0x2d2064;try{_0x2d2064=await _0x500083[_0x4937e2(0x1ce)](_0x3a326f['id'],_0x4937e2(0x1bc));}catch(_0x4109e3){Sentry[_0x4937e2(0x1bd)](_0x4109e3),_0x2d2064=process[_0x4937e2(0x192)][_0x4937e2(0x13c)]+_0x4937e2(0x1d2);}const _0xa63573={'name':_0x3a326f[_0x4937e2(0x124)]||_0x3a326f['id'][_0x4937e2(0x19c)](/\D/g,''),'number':_0x3a326f['id']['replace'](/\D/g,''),'profilePicUrl':_0x2d2064,'isGroup':_0x3a326f['id'][_0x4937e2(0x150)](_0x4937e2(0x122)),'companyId':_0x558dd0,'remoteJid':_0x3a326f['id']};_0xa63573[_0x4937e2(0x101)]&&(_0xa63573[_0x4937e2(0x1e5)]=_0x3a326f['id'][_0x4937e2(0x19c)](_0x4937e2(0x10f),''));const _0x4e0958=(0x0,CreateOrUpdateContactService_1[_0x4937e2(0x1ae)])(_0xa63573);return _0x4e0958;},verifyQuotedMessage=async _0x2df39c=>{const _0x33d15d=a516_0x310cd3;if(!_0x2df39c)return null;const _0x5d1532=(0x0,exports[_0x33d15d(0x102)])(_0x2df39c);if(!_0x5d1532)return null;const _0x58aeaa=await Message_1['default'][_0x33d15d(0x126)]({'where':{'wid':_0x5d1532}});if(!_0x58aeaa)return null;return _0x58aeaa;},verifyMediaMessage=async(_0x529918,_0x36c596,_0x5598a4,_0x1080ed)=>{const _0x24d313=a516_0x310cd3,_0x37b5db=(0x0,socket_1[_0x24d313(0x17e)])(),_0xcf6a02=await verifyQuotedMessage(_0x529918);try{const _0x59f136=await downloadMedia(_0x529918);if(!_0x59f136)throw new Error(_0x24d313(0x1b8));if(!_0x59f136[_0x24d313(0x147)]||_0x59f136[_0x24d313(0x1f4)]===_0x24d313(0x125)){const _0xfdf1d4=_0x59f136[_0x24d313(0x1f4)]==='audio/mp4'?_0x24d313(0x15a):_0x59f136[_0x24d313(0x1f4)][_0x24d313(0xe5)]('/')[0x1][_0x24d313(0xe5)](';')[0x0];_0x59f136[_0x24d313(0x147)]=new Date()['getTime']()+'.'+_0xfdf1d4;}else{const _0x5864d7=_0x59f136[_0x24d313(0x147)][_0x24d313(0xe5)]('.')[_0x24d313(0x1c9)](),_0x381fbf=_0x59f136['filename'][_0x24d313(0xe5)]('.')['slice'](0x0,-0x1)[_0x24d313(0xe9)]('.')[_0x24d313(0x19c)](/\s/g,'_')[_0x24d313(0x116)](_0x24d313(0x163))['replace'](/[\u0300-\u036f]/g,'');_0x59f136[_0x24d313(0x147)]=_0x381fbf[_0x24d313(0x12f)]()+'_'+new Date()[_0x24d313(0x10b)]()+'.'+_0x5864d7;}try{const _0x55265c='public/company'+_0x36c596[_0x24d313(0x1f9)];!fs_2[_0x24d313(0x1ae)][_0x24d313(0x1b6)](_0x55265c)&&(fs_2[_0x24d313(0x1ae)][_0x24d313(0x19f)](_0x55265c),fs_2[_0x24d313(0x1ae)]['chmodSync'](_0x55265c,0x1ff)),await writeFileAsync((0x0,path_1[_0x24d313(0xe9)])(__dirname,'..','..','..',_0x55265c,_0x59f136[_0x24d313(0x147)]),_0x59f136['data']['toString'](_0x24d313(0x142)),_0x24d313(0x142)),console[_0x24d313(0x12a)](_0x24d313(0x175));}catch(_0x254c9f){Sentry[_0x24d313(0x157)](_0x24d313(0x1d0),{'companyId':_0x36c596[_0x24d313(0x1f9)],'ticket':_0x36c596,'contact':_0x5598a4,'media':_0x59f136,'quotedMsg':_0xcf6a02}),Sentry[_0x24d313(0x1bd)](_0x254c9f),logger_1[_0x24d313(0x177)]['error'](_0x254c9f);}const _0x4cf055=(0x0,exports[_0x24d313(0x1b1)])(_0x529918),_0x14bdd9={'wid':_0x529918[_0x24d313(0x10a)]['id'],'ticketId':_0x36c596['id'],'contactId':_0x529918['key']['fromMe']?undefined:_0x5598a4['id'],'body':_0x4cf055||_0x59f136[_0x24d313(0x147)],'fromMe':_0x529918[_0x24d313(0x10a)]['fromMe'],'read':_0x529918['key'][_0x24d313(0x1d3)],'mediaUrl':_0x59f136[_0x24d313(0x147)],'mediaType':_0x59f136[_0x24d313(0x1f4)]['split']('/')[0x0],'quotedMsgId':_0xcf6a02?.['id'],'ack':_0x529918[_0x24d313(0x164)],'remoteJid':_0x529918['key']['remoteJid'],'participant':_0x529918[_0x24d313(0x10a)]['participant'],'dataJson':JSON[_0x24d313(0x1a5)](_0x529918),'ticketTrakingId':_0x1080ed?.['id']};await _0x36c596[_0x24d313(0x193)]({'lastMessage':_0x4cf055||_0x59f136[_0x24d313(0x147)]});const _0x27dec3=await(0x0,CreateMessageService_1[_0x24d313(0x1ae)])({'messageData':_0x14bdd9,'companyId':_0x36c596[_0x24d313(0x1f9)]});return!_0x529918[_0x24d313(0x10a)][_0x24d313(0x1d3)]&&_0x36c596[_0x24d313(0x164)]===_0x24d313(0x18b)&&(await _0x36c596[_0x24d313(0x193)]({'status':'pending'}),await _0x36c596['reload']({'include':[{'model':Queue_1['default'],'as':'queue'},{'model':User_1[_0x24d313(0x1ae)],'as':_0x24d313(0x104)},{'model':Contact_1[_0x24d313(0x1ae)],'as':_0x24d313(0x1cf)}]}),_0x37b5db['to'](_0x24d313(0x18b))[_0x24d313(0x113)](_0x24d313(0x14e)+_0x36c596['companyId']+_0x24d313(0x1f3),{'action':_0x24d313(0x1de),'ticket':_0x36c596,'ticketId':_0x36c596['id']}),_0x37b5db['to'](_0x36c596[_0x24d313(0x164)])['to'](_0x36c596['id']['toString']())['emit']('company-'+_0x36c596['companyId']+'-ticket',{'action':_0x24d313(0x193),'ticket':_0x36c596,'ticketId':_0x36c596['id']})),_0x27dec3;}catch(_0x2a1b7f){console['log'](_0x2a1b7f),logger_1[_0x24d313(0x177)][_0x24d313(0x169)](_0x24d313(0x12c));}},verifyMessage=async(_0x4a2070,_0x525033,_0x34ded7,_0xc35051,_0x1fd4d)=>{const _0x1f660a=a516_0x310cd3,_0x491d97=(0x0,socket_1[_0x1f660a(0x17e)])(),_0x26f574=await verifyQuotedMessage(_0x4a2070),_0x52c2df=(0x0,exports[_0x1f660a(0x1b1)])(_0x4a2070),_0xf20989={'wid':_0x4a2070[_0x1f660a(0x10a)]['id'],'ticketId':_0x525033['id'],'contactId':_0x4a2070[_0x1f660a(0x10a)][_0x1f660a(0x1d3)]?undefined:_0x34ded7['id'],'body':_0x52c2df,'fromMe':_0x4a2070[_0x1f660a(0x10a)][_0x1f660a(0x1d3)],'mediaType':getTypeMessage(_0x4a2070),'read':_0x4a2070[_0x1f660a(0x10a)][_0x1f660a(0x1d3)],'quotedMsgId':_0x26f574?.['id'],'ack':_0x4a2070[_0x1f660a(0x164)],'remoteJid':_0x4a2070[_0x1f660a(0x10a)]['remoteJid'],'participant':_0x4a2070['key'][_0x1f660a(0x1bf)],'dataJson':JSON[_0x1f660a(0x1a5)](_0x4a2070),'ticketTrakingId':_0xc35051?.['id'],'isPrivate':_0x1fd4d};await _0x525033[_0x1f660a(0x193)]({'lastMessage':_0x52c2df}),await(0x0,CreateMessageService_1[_0x1f660a(0x1ae)])({'messageData':_0xf20989,'companyId':_0x525033[_0x1f660a(0x1f9)]}),!_0x4a2070[_0x1f660a(0x10a)][_0x1f660a(0x1d3)]&&_0x525033[_0x1f660a(0x164)]===_0x1f660a(0x18b)&&(await _0x525033[_0x1f660a(0x193)]({'status':_0x1f660a(0x1db)}),await _0x525033['reload']({'include':[{'model':Queue_1[_0x1f660a(0x1ae)],'as':'queue'},{'model':User_1[_0x1f660a(0x1ae)],'as':'user'},{'model':Contact_1['default'],'as':_0x1f660a(0x1cf)}]}),_0x491d97['to'](_0x1f660a(0x18b))[_0x1f660a(0x113)](_0x1f660a(0x14e)+_0x525033[_0x1f660a(0x1f9)]+'-ticket',{'action':_0x1f660a(0x1de),'ticket':_0x525033,'ticketId':_0x525033['id']}),_0x491d97['to'](_0x525033[_0x1f660a(0x164)])['to'](_0x525033['id']['toString']())[_0x1f660a(0x113)](_0x1f660a(0x14e)+_0x525033[_0x1f660a(0x1f9)]+_0x1f660a(0x1f3),{'action':_0x1f660a(0x193),'ticket':_0x525033,'ticketId':_0x525033['id']}));};exports[a516_0x310cd3(0x1d4)]=verifyMessage;const isValidMsg=_0x5a0a88=>{const _0x2695c1=a516_0x310cd3;if(_0x5a0a88[_0x2695c1(0x10a)][_0x2695c1(0xee)]===_0x2695c1(0xfc))return![];try{const _0x3ce1fb=getTypeMessage(_0x5a0a88);if(!_0x3ce1fb)return;const _0x4c78cf=_0x3ce1fb===_0x2695c1(0x159)||_0x3ce1fb==='extendedTextMessage'||_0x3ce1fb===_0x2695c1(0xd1)||_0x3ce1fb===_0x2695c1(0x19a)||_0x3ce1fb==='imageMessage'||_0x3ce1fb==='documentMessage'||_0x3ce1fb===_0x2695c1(0x1a7)||_0x3ce1fb===_0x2695c1(0x1ba)||_0x3ce1fb===_0x2695c1(0x103)||_0x3ce1fb===_0x2695c1(0x1b5)||_0x3ce1fb===_0x2695c1(0x190)||_0x3ce1fb===_0x2695c1(0x121)||_0x3ce1fb===_0x2695c1(0x16e)||_0x3ce1fb===_0x2695c1(0x199)||_0x3ce1fb===_0x2695c1(0xf5)||_0x3ce1fb===_0x2695c1(0x1c5)||_0x3ce1fb==='reactionMessage'||_0x3ce1fb===_0x2695c1(0x1d6)||_0x3ce1fb===_0x2695c1(0xf8)||_0x3ce1fb==='listResponseMessage'||_0x3ce1fb==='listMessage'||_0x3ce1fb===_0x2695c1(0xd2)||_0x3ce1fb==='documentWithCaptionMessage'||_0x3ce1fb===_0x2695c1(0x13a)||_0x3ce1fb===_0x2695c1(0x1f8);return!_0x4c78cf&&(logger_1[_0x2695c1(0x177)][_0x2695c1(0x169)]('####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20'+_0x3ce1fb+'\x0a'+JSON[_0x2695c1(0x1a5)](_0x5a0a88?.[_0x2695c1(0xf9)])),Sentry['setExtra'](_0x2695c1(0x1d1),{'BodyMsg':_0x5a0a88[_0x2695c1(0xf9)],'msg':_0x5a0a88,'msgType':_0x3ce1fb}),Sentry[_0x2695c1(0x1bd)](new Error(_0x2695c1(0x11d)))),!!_0x4c78cf;}catch(_0x5d0e34){Sentry['setExtra'](_0x2695c1(0x17f),{'msg':_0x5a0a88}),Sentry['captureException'](_0x5d0e34);}},verifyQueue=async(_0x1967a3,_0x2c799a,_0x3544d6,_0x52cf95)=>{const _0xa18e82=a516_0x310cd3,{queues:_0x2828bd,greetingMessage:_0x2bcda9,maxUseBotQueues:_0xc5e980,timeUseBotQueues:_0x5866e3}=await(0x0,ShowWhatsAppService_1[_0xa18e82(0x1ae)])(_0x1967a3['id'],_0x3544d6['companyId']),_0x3f9786=await(0x0,FindOrCreateATicketTrakingService_1[_0xa18e82(0x1ae)])({'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0xa18e82(0x1f9)],'whatsappId':_0x3544d6[_0xa18e82(0x18d)]?.['id']});let _0x146660=await Setting_1[_0xa18e82(0x1ae)]['findOne']({'where':{'key':_0xa18e82(0x186),'companyId':_0x3544d6[_0xa18e82(0x1f9)]}}),_0x1a6aa3=![];_0x2828bd[_0xa18e82(0xfb)]===0x1&&(_0x1a6aa3=_0x2828bd[0x0]?.['chatbots'][_0xa18e82(0xfb)]>0x1);if(_0x2828bd[_0xa18e82(0xfb)]===0x1&&!_0x1a6aa3){const _0x2bcbb2=await Setting_1[_0xa18e82(0x1ae)]['findOne']({'where':{'key':_0xa18e82(0x11f),'companyId':_0x3544d6[_0xa18e82(0x1f9)]}});if(_0x2bcda9[_0xa18e82(0xfb)]>0x1&&_0x2bcbb2?.['value']===_0xa18e82(0x16a)){const _0x50c800=(0x0,Mustache_1[_0xa18e82(0x1ae)])(''+_0x2bcda9,_0x3544d6);await _0x1967a3[_0xa18e82(0x1b2)](_0x52cf95[_0xa18e82(0x1e5)]+'@'+(_0x3544d6[_0xa18e82(0x101)]?_0xa18e82(0x122):_0xa18e82(0x110)),{'text':_0x50c800});}await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x2828bd[0x0]['id']},'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0xa18e82(0x1f9)]});const _0x1f8680=await Ticket_1['default'][_0xa18e82(0xf0)]({'where':{'userId':null,'status':_0xa18e82(0x1db),'companyId':_0x3544d6['companyId'],'queueId':_0x2828bd[0x0]['id'],'isGroup':![]}});if(_0x146660?.[_0xa18e82(0x165)]==='enabled'){const _0x47882d=_0x1f8680[_0xa18e82(0x195)]===0x0?0x1:_0x1f8680[_0xa18e82(0x195)],_0x47b54b=_0xa18e82(0x1ca)+_0x47882d+'*',_0x4bbd91=(0x0,Mustache_1[_0xa18e82(0x1ae)])(''+_0x47b54b,_0x3544d6),_0x3c4eb1=(0x0,Debounce_1[_0xa18e82(0x160)])(async()=>{const _0x3203ff=_0xa18e82;await _0x1967a3['sendMessage'](_0x52cf95[_0x3203ff(0x1e5)]+'@'+(_0x3544d6[_0x3203ff(0x101)]?_0x3203ff(0x122):'s.whatsapp.net'),{'text':_0x4bbd91});},0xbb8,_0x3544d6['id']);_0x3c4eb1();}return;}if(_0x52cf95['disableBot'])return;let _0x2c592e='';if(_0x3544d6[_0xa18e82(0x164)]!=='lgpd')_0x2c592e=_0x2c799a?.['message']?.['buttonsResponseMessage']?.[_0xa18e82(0x141)]||_0x2c799a?.[_0xa18e82(0xf9)]?.[_0xa18e82(0xd4)]?.['singleSelectReply']['selectedRowId']||(0x0,exports[_0xa18e82(0x1b1)])(_0x2c799a);else{if(!(0x0,lodash_1[_0xa18e82(0x152)])(_0x3544d6[_0xa18e82(0x178)]))await _0x3544d6[_0xa18e82(0x193)]({'status':_0xa18e82(0x1db)});await _0x3544d6[_0xa18e82(0x153)]();}if(_0x2c592e==_0xa18e82(0x161)){const _0x2e2c97={'isBot':![],'queueId':null,'userId':null,'status':_0xa18e82(0x18b),'sendFarewellMessage':![]};await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x2e2c97,'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0xa18e82(0x1f9)]});const {complationMessage:_0x4dbedc}=await(0x0,ShowWhatsAppService_1[_0xa18e82(0x1ae)])(_0x3544d6[_0xa18e82(0x187)],_0x3544d6[_0xa18e82(0x1f9)]),_0x126b1c={'text':(0x0,Mustache_1[_0xa18e82(0x1ae)])('â€Ž'+_0x4dbedc,_0x3544d6)},_0x21f6a0=await _0x1967a3['sendMessage'](_0x3544d6?.[_0xa18e82(0x1cf)]?.[_0xa18e82(0x1e5)]+'@'+(_0x3544d6[_0xa18e82(0x101)]?'g.us':_0xa18e82(0x110)),_0x126b1c);await(0x0,exports['verifyMessage'])(_0x21f6a0,_0x3544d6,_0x3544d6['contact']);return;}const _0x3a7d54=_0x1a6aa3&&_0x2828bd[_0xa18e82(0xfb)]===0x1?_0x2828bd[+_0x2c592e]:_0x2828bd[+_0x2c592e-0x1],_0x5edfc9=await Setting_1[_0xa18e82(0x1ae)][_0xa18e82(0x126)]({'where':{'key':_0xa18e82(0x1c6),'companyId':_0x3544d6['companyId']}}),_0x189c57=_0x5edfc9?.[_0xa18e82(0x165)]||_0xa18e82(0xe4);let _0xd9680b;if(_0x3a7d54)try{const _0x4176e7=await(0x0,ListUserQueueServices_1[_0xa18e82(0x1ae)])(_0x3a7d54['id']);_0x4176e7['userId']>-0x1&&(_0xd9680b=_0x4176e7[_0xa18e82(0x1b7)]);}catch(_0x4dc2c7){console[_0xa18e82(0xf7)](_0x4dc2c7);}let _0x58e70b=await Setting_1[_0xa18e82(0x1ae)][_0xa18e82(0x126)]({'where':{'key':_0xa18e82(0x189),'companyId':_0x3544d6[_0xa18e82(0x1f9)]}});const _0x42d190=async()=>{const _0x4f727a=_0xa18e82;if(_0x3a7d54||_0x2828bd[_0x4f727a(0xfb)]===0x1&&_0x1a6aa3){await(0x0,UpdateTicketService_1[_0x4f727a(0x1ae)])({'ticketData':{'queueId':_0x3a7d54['id']},'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0x4f727a(0x1f9)]});if(_0x3a7d54['chatbots'][_0x4f727a(0xfb)]>0x0){let _0x503843='';_0x3a7d54['chatbots']['forEach']((_0x580c96,_0x5fd5d0)=>{const _0x56c100=_0x4f727a;_0x503843+='*'+(_0x5fd5d0+0x1)+_0x56c100(0x174)+_0x580c96[_0x56c100(0x124)]+'\x0a';});const _0x258233=(0x0,Mustache_1[_0x4f727a(0x1ae)])('â€Ž'+_0x3a7d54['greetingMessage']+'\x0a\x0a'+_0x503843+_0x4f727a(0x1e1),_0x3544d6),_0x4e1a75=await _0x1967a3[_0x4f727a(0x1b2)](_0x52cf95[_0x4f727a(0x1e5)]+'@'+(_0x3544d6[_0x4f727a(0x101)]?_0x4f727a(0x122):_0x4f727a(0x110)),{'text':_0x258233});await(0x0,exports[_0x4f727a(0x1d4)])(_0x4e1a75,_0x3544d6,_0x52cf95,_0x3f9786),_0x58e70b?.[_0x4f727a(0x165)]===_0x4f727a(0x16a)&&await(0x0,UpdateTicketService_1['default'])({'ticketData':{'userId':_0xd9680b},'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0x4f727a(0x1f9)]});}if(!_0x3a7d54[_0x4f727a(0x172)][_0x4f727a(0xfb)]&&_0x3a7d54['greetingMessage'][_0x4f727a(0xfb)]!==0x0){const _0x33c025=(0x0,Mustache_1['default'])('â€Ž'+_0x3a7d54[_0x4f727a(0x179)],_0x3544d6),_0x3c3790=await _0x1967a3['sendMessage'](_0x52cf95[_0x4f727a(0x1e5)]+'@'+(_0x3544d6['isGroup']?_0x4f727a(0x122):_0x4f727a(0x110)),{'text':_0x33c025});await(0x0,exports[_0x4f727a(0x1d4)])(_0x3c3790,_0x3544d6,_0x52cf95,_0x3f9786);}const _0x43ef72=await Ticket_1[_0x4f727a(0x1ae)][_0x4f727a(0xf0)]({'where':{'userId':null,'status':_0x4f727a(0x1db),'companyId':_0x3544d6['companyId'],'queueId':_0x3a7d54['id'],'isGroup':![]}});if(_0x146660?.['value']===_0x4f727a(0x16a)&&!_0x3a7d54[_0x4f727a(0x172)][_0x4f727a(0xfb)]){const _0x255279=_0x43ef72[_0x4f727a(0x195)]===0x0?0x1:_0x43ef72[_0x4f727a(0x195)],_0x7a1776=_0x4f727a(0x1ca)+_0x255279+'*',_0xdfae8c=(0x0,Mustache_1[_0x4f727a(0x1ae)])(''+_0x7a1776,_0x3544d6),_0x3dfcd7=(0x0,Debounce_1[_0x4f727a(0x160)])(async()=>{const _0x30d7de=_0x4f727a;await _0x1967a3[_0x30d7de(0x1b2)](_0x52cf95[_0x30d7de(0x1e5)]+'@'+(_0x3544d6[_0x30d7de(0x101)]?'g.us':_0x30d7de(0x110)),{'text':_0xdfae8c});},0xbb8,_0x3544d6['id']);_0x3dfcd7();}await(0x0,UpdateTicketService_1[_0x4f727a(0x1ae)])({'ticketData':{'amountUsedBotQueues':0x0},'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0x4f727a(0x1f9)]});}else{if(_0xc5e980&&_0xc5e980!==0x0&&_0x3544d6[_0x4f727a(0x1d8)]>=_0xc5e980)return;const _0x2d013f=await(0x0,FindOrCreateATicketTrakingService_1[_0x4f727a(0x1ae)])({'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0x4f727a(0x1f9)]});let _0x147fe4=new Date(),_0x5b40c0=new Date();if(_0x2d013f['chatbotAt']!==null){_0x147fe4[_0x4f727a(0x170)](_0x2d013f[_0x4f727a(0xda)]['getMinutes']()+Number(_0x5866e3));if(_0x2d013f[_0x4f727a(0xda)]!==null&&_0x5b40c0<_0x147fe4&&_0x5866e3!=='0')return;}await _0x2d013f[_0x4f727a(0x193)]({'chatbotAt':null});let _0x391a8a='';_0x2828bd[_0x4f727a(0x151)]((_0x269467,_0x3bfab0)=>{const _0x182b32=_0x4f727a;_0x391a8a+='*[\x20'+(_0x3bfab0+0x1)+'\x20]*\x20-\x20'+_0x269467[_0x182b32(0x124)]+'\x0a';}),_0x391a8a+=_0x4f727a(0x15e);const _0x1c152c=(0x0,Mustache_1['default'])('â€Ž'+_0x2bcda9+'\x0a\x0a'+_0x391a8a,_0x3544d6),_0x2df7d7=(0x0,Debounce_1[_0x4f727a(0x160)])(async()=>{const _0x51852b=_0x4f727a,_0x1496d7=await _0x1967a3[_0x51852b(0x1b2)](_0x52cf95[_0x51852b(0x1e5)]+'@'+(_0x3544d6[_0x51852b(0x101)]?_0x51852b(0x122):_0x51852b(0x110)),{'text':_0x1c152c});(0x0,exports[_0x51852b(0x1d4)])(_0x1496d7,_0x3544d6,_0x52cf95,_0x2d013f);},0x3e8,_0x3544d6['id']);await(0x0,UpdateTicketService_1[_0x4f727a(0x1ae)])({'ticketData':{'amountUsedBotQueues':_0x3544d6['amountUsedBotQueues']+0x1},'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0x4f727a(0x1f9)]}),_0x2df7d7();}},_0x5f335d=async()=>{const _0xf9cde7=_0xa18e82;if(_0x3a7d54){await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x3a7d54['id']},'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0xf9cde7(0x1f9)]});if(_0x3a7d54[_0xf9cde7(0x172)][_0xf9cde7(0xfb)]>0x0){const _0x8df141=[];_0x3a7d54[_0xf9cde7(0x172)][_0xf9cde7(0x151)]((_0x5736d9,_0x2c4c4b)=>{const _0x2dd18d=_0xf9cde7;_0x8df141[_0x2dd18d(0xd5)]({'buttonId':''+(_0x2c4c4b+0x1),'buttonText':{'displayText':_0x5736d9[_0x2dd18d(0x124)]},'type':0x1});});const _0x2ec951={'text':(0x0,Mustache_1['default'])(''+_0x3a7d54[_0xf9cde7(0x179)],_0x3544d6),'buttons':_0x8df141,'headerType':0x4},_0x3fa4df=await _0x1967a3['sendMessage'](_0x52cf95[_0xf9cde7(0x1e5)]+'@'+(_0x3544d6[_0xf9cde7(0x101)]?_0xf9cde7(0x122):'s.whatsapp.net'),_0x2ec951);await(0x0,exports[_0xf9cde7(0x1d4)])(_0x3fa4df,_0x3544d6,_0x52cf95,_0x3f9786);}if(!_0x3a7d54[_0xf9cde7(0x172)][_0xf9cde7(0xfb)]){const _0x20d447=(0x0,Mustache_1['default'])(''+_0x3a7d54[_0xf9cde7(0x179)],_0x3544d6),_0x199705=await _0x1967a3[_0xf9cde7(0x1b2)](_0x52cf95[_0xf9cde7(0x1e5)]+'@'+(_0x3544d6[_0xf9cde7(0x101)]?_0xf9cde7(0x122):_0xf9cde7(0x110)),{'text':_0x20d447});await(0x0,exports[_0xf9cde7(0x1d4)])(_0x199705,_0x3544d6,_0x52cf95,_0x3f9786);}}else{const _0x2080c3=[];_0x2828bd[_0xf9cde7(0x151)]((_0x1972de,_0x10b436)=>{const _0xb6263a=_0xf9cde7;_0x2080c3[_0xb6263a(0xd5)]({'buttonId':''+(_0x10b436+0x1),'buttonText':{'displayText':_0x1972de[_0xb6263a(0x124)]},'type':0x4});});const _0x50d6b7={'text':(0x0,Mustache_1['default'])(''+_0x2bcda9,_0x3544d6),'buttons':_0x2080c3,'headerType':0x4},_0x2897b4=await _0x1967a3[_0xf9cde7(0x1b2)](_0x52cf95[_0xf9cde7(0x1e5)]+'@'+(_0x3544d6[_0xf9cde7(0x101)]?'g.us':_0xf9cde7(0x110)),_0x50d6b7);await(0x0,exports['verifyMessage'])(_0x2897b4,_0x3544d6,_0x52cf95,_0x3f9786),await(0x0,UpdateTicketService_1[_0xf9cde7(0x1ae)])({'ticketData':{'amountUsedBotQueues':_0x3544d6['amountUsedBotQueues']+0x1},'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0xf9cde7(0x1f9)]});}},_0x2cafa1=async()=>{const _0x2fdb89=_0xa18e82;if(_0x3a7d54){await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x3a7d54['id']},'ticketId':_0x3544d6['id'],'companyId':_0x3544d6[_0x2fdb89(0x1f9)]});if(_0x3a7d54[_0x2fdb89(0x172)][_0x2fdb89(0xfb)]>0x0){const _0x5e0a39=[];_0x3a7d54[_0x2fdb89(0x172)]['forEach']((_0x4dd78b,_0x475357)=>{const _0x1b0f7d=_0x2fdb89;_0x5e0a39[_0x1b0f7d(0xd5)]({'title':_0x4dd78b[_0x1b0f7d(0x124)],'rowId':''+(_0x475357+0x1)});});const _0x42d426=[{'title':'Menu','rows':_0x5e0a39}],_0x247b4e={'text':(0x0,Mustache_1[_0x2fdb89(0x1ae)])(''+_0x3a7d54[_0x2fdb89(0x179)],_0x3544d6),'buttonText':_0x2fdb89(0x13b),'sections':_0x42d426},_0x3dcfd4=await _0x1967a3['sendMessage'](_0x52cf95[_0x2fdb89(0x1e5)]+'@'+(_0x3544d6['isGroup']?_0x2fdb89(0x122):_0x2fdb89(0x110)),_0x247b4e);await(0x0,exports[_0x2fdb89(0x1d4)])(_0x3dcfd4,_0x3544d6,_0x52cf95,_0x3f9786);}if(!_0x3a7d54[_0x2fdb89(0x172)]['length']){const _0x5a275e=(0x0,Mustache_1[_0x2fdb89(0x1ae)])(''+_0x3a7d54[_0x2fdb89(0x179)],_0x3544d6),_0x1aaff1=await _0x1967a3['sendMessage'](_0x52cf95['number']+'@'+(_0x3544d6[_0x2fdb89(0x101)]?_0x2fdb89(0x122):'s.whatsapp.net'),{'text':_0x5a275e});await(0x0,exports[_0x2fdb89(0x1d4)])(_0x1aaff1,_0x3544d6,_0x52cf95,_0x3f9786);}}else{const _0x2cf662=[];_0x2828bd[_0x2fdb89(0x151)]((_0x364476,_0x12f909)=>{const _0x551e0b=_0x2fdb89;_0x2cf662['push']({'title':_0x364476[_0x551e0b(0x124)],'rowId':''+(_0x12f909+0x1)});});const _0xb53854=[{'title':_0x2fdb89(0x1c7),'rows':_0x2cf662}],_0xd8d2f7={'text':(0x0,Mustache_1[_0x2fdb89(0x1ae)])(''+_0x2bcda9,_0x3544d6),'buttonText':'Escolha\x20uma\x20opÃ§Ã£o','sections':_0xb53854},_0x3c0e2a=await _0x1967a3['sendMessage'](_0x52cf95[_0x2fdb89(0x1e5)]+'@'+(_0x3544d6[_0x2fdb89(0x101)]?_0x2fdb89(0x122):_0x2fdb89(0x110)),_0xd8d2f7);await(0x0,exports['verifyMessage'])(_0x3c0e2a,_0x3544d6,_0x52cf95,_0x3f9786),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x3544d6[_0x2fdb89(0x1d8)]+0x1},'ticketId':_0x3544d6['id'],'companyId':_0x3544d6['companyId']});}};if(_0x189c57===_0xa18e82(0xe4))return _0x42d190();if(_0x189c57===_0xa18e82(0x108)&&_0x2828bd[_0xa18e82(0xfb)]>0x3)return _0x42d190();if(_0x189c57===_0xa18e82(0x108)&&_0x2828bd[_0xa18e82(0xfb)]<=0x3)return _0x5f335d();if(_0x189c57===_0xa18e82(0x1b0))return _0x2cafa1();},verifyRating=_0x158066=>{const _0x27e1fa=a516_0x310cd3;if(_0x158066&&_0x158066['finishedAt']===null&&_0x158066[_0x27e1fa(0x1eb)]!==null&&_0x158066[_0x27e1fa(0x1b7)]!==null&&_0x158066[_0x27e1fa(0x1f7)]===null)return!![];return![];};exports[a516_0x310cd3(0x129)]=verifyRating;const handleRating=async(_0x3ac43c,_0x1b96e6,_0x4c7791)=>{const _0x52522e=a516_0x310cd3,_0x2b9297=(0x0,socket_1[_0x52522e(0x17e)])(),{complationMessage:_0x35177d}=await(0x0,ShowWhatsAppService_1['default'])(_0x1b96e6[_0x52522e(0x187)],_0x1b96e6[_0x52522e(0x1f9)]);let _0x1152c9=_0x3ac43c;_0x3ac43c<0x0&&(_0x1152c9=0x0);_0x3ac43c>0xa&&(_0x1152c9=0xa);await UserRating_1[_0x52522e(0x1ae)][_0x52522e(0x123)]({'ticketId':_0x4c7791[_0x52522e(0x15b)],'companyId':_0x4c7791['companyId'],'userId':_0x4c7791[_0x52522e(0x1b7)],'rate':_0x1152c9});if(!(0x0,lodash_1[_0x52522e(0x152)])(_0x35177d)&&_0x35177d!==''&&!_0x1b96e6[_0x52522e(0x101)]){const _0x2d47e6=(0x0,Mustache_1['default'])('â€Ž'+_0x35177d,_0x1b96e6);if(_0x1b96e6[_0x52522e(0xed)]==='whatsapp'){const _0x52c522=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x2d47e6,'ticket':_0x1b96e6});await(0x0,exports[_0x52522e(0x1d4)])(_0x52c522,_0x1b96e6,_0x1b96e6['contact'],_0x4c7791);}[_0x52522e(0x1f6),_0x52522e(0x148)][_0x52522e(0x150)](_0x1b96e6[_0x52522e(0xed)])&&await(0x0,sendFacebookMessage_1[_0x52522e(0x1ae)])({'body':_0x2d47e6,'ticket':_0x1b96e6});}await _0x1b96e6[_0x52522e(0x193)]({'chatbot':null,'status':'closed','amountUseBotQueuesNPS':0x0}),_0x2b9297['to'](_0x52522e(0x168))['emit'](_0x52522e(0x14e)+_0x1b96e6['companyId']+_0x52522e(0x1f3),{'action':'delete','ticket':_0x1b96e6,'ticketId':_0x1b96e6['id']}),_0x2b9297['to'](_0x1b96e6[_0x52522e(0x164)])['to'](_0x1b96e6['id']['toString']())[_0x52522e(0x113)](_0x52522e(0x14e)+_0x1b96e6[_0x52522e(0x1f9)]+_0x52522e(0x1f3),{'action':_0x52522e(0x193),'ticket':_0x1b96e6,'ticketId':_0x1b96e6['id']});},handleMessage=async(_0x53ad36,_0x31daf7,_0x1eb820)=>{const _0x5ac173=a516_0x310cd3;if(!isValidMsg(_0x53ad36))return;try{let _0x19d8cf,_0x3797ee,_0x20506b=0x0,_0x69d071=0x0,_0x448b6f=0x0,_0x59134d=(0x0,exports[_0x5ac173(0x1b1)])(_0x53ad36);const _0x263a90=getTypeMessage(_0x53ad36);if(_0x263a90===_0x5ac173(0xf8))return;const _0x65ff4d=_0x53ad36['message']?.[_0x5ac173(0xd1)]||_0x53ad36[_0x5ac173(0xf9)]?.[_0x5ac173(0x176)]||_0x53ad36['message']?.[_0x5ac173(0x19a)]||_0x53ad36[_0x5ac173(0xf9)]?.[_0x5ac173(0x12d)]||_0x53ad36['message'][_0x5ac173(0x1a7)]||_0x53ad36?.['message']?.[_0x5ac173(0x1d6)]?.['message']?.[_0x5ac173(0x176)]||_0x53ad36?.[_0x5ac173(0xf9)]?.['ephemeralMessage']?.['message']?.[_0x5ac173(0xd1)]||_0x53ad36?.[_0x5ac173(0xf9)]?.[_0x5ac173(0x1d6)]?.[_0x5ac173(0xf9)]?.[_0x5ac173(0x19a)]||_0x53ad36?.[_0x5ac173(0xf9)]?.['ephemeralMessage']?.[_0x5ac173(0xf9)]?.[_0x5ac173(0x12d)]||_0x53ad36?.['message']?.[_0x5ac173(0x1d6)]?.[_0x5ac173(0xf9)]?.['stickerMessage']||_0x53ad36[_0x5ac173(0xf9)]?.['viewOnceMessage']?.[_0x5ac173(0xf9)]?.['imageMessage']||_0x53ad36[_0x5ac173(0xf9)]?.[_0x5ac173(0xd2)]?.[_0x5ac173(0xf9)]?.['videoMessage']||_0x53ad36['message']?.[_0x5ac173(0x1d6)]?.[_0x5ac173(0xf9)]?.[_0x5ac173(0xd2)]?.['message']?.[_0x5ac173(0x176)]||_0x53ad36['message']?.[_0x5ac173(0x1d6)]?.[_0x5ac173(0xf9)]?.[_0x5ac173(0xd2)]?.['message']?.[_0x5ac173(0x19a)]||_0x53ad36[_0x5ac173(0xf9)]?.[_0x5ac173(0x191)]?.['message']?.[_0x5ac173(0x12d)],_0x242aa5=/\u200d/[_0x5ac173(0x149)](_0x59134d);if(_0x53ad36[_0x5ac173(0x10a)][_0x5ac173(0x1d3)]){if(/\u200e/[_0x5ac173(0x149)](_0x59134d))return;if(!_0x65ff4d&&_0x263a90!==_0x5ac173(0x159)&&_0x263a90!==_0x5ac173(0x1a9)&&_0x263a90!==_0x5ac173(0x16e)&&_0x263a90!==_0x5ac173(0x1fa)&&_0x263a90!==_0x5ac173(0x1d6)&&_0x263a90!==_0x5ac173(0xf8)&&_0x263a90!=='viewOnceMessage'&&_0x263a90!==_0x5ac173(0x1f8))return;_0x19d8cf=await getContactMessage(_0x53ad36,_0x31daf7);}else _0x19d8cf=await getContactMessage(_0x53ad36,_0x31daf7);const _0x999a39=_0x53ad36[_0x5ac173(0x10a)]['remoteJid']?.['endsWith'](_0x5ac173(0x10f)),_0x3efacb=await(0x0,ShowWhatsAppService_1[_0x5ac173(0x1ae)])(_0x31daf7['id'],_0x1eb820);if(!_0x3efacb['allowGroup']&&_0x999a39)return;if(_0x999a39){const _0x1eb02a=await _0x31daf7[_0x5ac173(0x128)](_0x53ad36['key'][_0x5ac173(0xee)]),_0x34331b={'id':_0x1eb02a['id'],'name':_0x1eb02a[_0x5ac173(0x136)]};_0x3797ee=await verifyContact(_0x34331b,_0x31daf7,_0x1eb820);}const _0x627c5c=await verifyContact(_0x19d8cf,_0x31daf7,_0x1eb820);let _0x4e83fe=0x0,_0x412be1=null;if(_0x53ad36['key']['fromMe'])await cache_1[_0x5ac173(0x1e2)]['set'](_0x5ac173(0x111)+_0x627c5c['id']+':unreads','0');else{const _0x16078a=await cache_1[_0x5ac173(0x1e2)][_0x5ac173(0xf4)](_0x5ac173(0x111)+_0x627c5c['id']+_0x5ac173(0x13f));_0x4e83fe=+_0x16078a+0x1,await cache_1[_0x5ac173(0x1e2)][_0x5ac173(0x112)](_0x5ac173(0x111)+_0x627c5c['id']+_0x5ac173(0x13f),''+_0x4e83fe);}let _0x4aa366=![];const _0x146011=await Ticket_1[_0x5ac173(0x1ae)][_0x5ac173(0x126)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x5ac173(0x168),'pending',_0x5ac173(0x14d),_0x5ac173(0x1f2),_0x5ac173(0xe1)]},'contactId':_0x3797ee?_0x3797ee['id']:_0x627c5c['id'],'companyId':_0x1eb820,'whatsappId':_0x3efacb['id']},'order':[['id','DESC']]});console[_0x5ac173(0x12a)](_0x146011?.['id']);if((0x0,lodash_1[_0x5ac173(0x152)])(_0x146011)||_0x146011?.['id']===undefined){const {ticket:_0x1839de,isCreated:_0x1f528b}=await(0x0,FindOrCreateTicketService_1[_0x5ac173(0x1ae)])(_0x627c5c,_0x31daf7['id'],_0x4e83fe,_0x1eb820,_0x20506b,_0x448b6f,_0x3797ee);_0x412be1=_0x1839de,_0x4aa366=_0x1f528b,await(0x0,baileys_1[_0x5ac173(0x1c1)])(0x7d0);}else _0x412be1=await(0x0,ShowTicketService_1['default'])(_0x146011['id'],_0x1eb820),_0x4aa366=!![];if(_0x4e83fe===0x0&&_0x3efacb[_0x5ac173(0x107)]&&(0x0,Mustache_1['default'])(_0x3efacb[_0x5ac173(0x107)],_0x412be1)===_0x59134d)return;if(!_0x4aa366){const {ticket:_0x54a18f,isCreated:_0x487e2c}=await(0x0,FindOrCreateTicketService_1['default'])(_0x627c5c,_0x31daf7['id'],_0x4e83fe,_0x1eb820,_0x20506b,_0x448b6f,_0x3797ee);_0x412be1=_0x54a18f,_0x4aa366=_0x487e2c;}if(_0x263a90===_0x5ac173(0x1f8)){const _0x5e1dc0=_0x53ad36['message'][_0x5ac173(0x1f8)][_0x5ac173(0xf9)][_0x5ac173(0xf8)]['key']['id'],_0x176b5b=_0x53ad36[_0x5ac173(0xf9)][_0x5ac173(0x1f8)][_0x5ac173(0xf9)][_0x5ac173(0xf8)][_0x5ac173(0x1f8)][_0x5ac173(0x159)],_0x24d23d=(0x0,socket_1['getIO'])();try{const _0x1f36bf=await Message_1[_0x5ac173(0x1ae)]['findOne']({'where':{'wid':_0x5e1dc0,'companyId':_0x1eb820,'ticketId':_0x412be1['id']}});if(!_0x1f36bf)return;await _0x1f36bf[_0x5ac173(0x193)]({'isEdited':!![],'body':_0x176b5b}),_0x24d23d['to'](_0x1f36bf['ticketId'][_0x5ac173(0x1ea)]())[_0x5ac173(0x113)](_0x5ac173(0x14e)+_0x1f36bf[_0x5ac173(0x1f9)]+'-appMessage',{'action':_0x5ac173(0x193),'message':_0x1f36bf});}catch(_0x386f6e){Sentry['captureException'](_0x386f6e),logger_1['logger'][_0x5ac173(0xf7)]('Error\x20handling\x20message\x20ack.\x20Err:\x20'+_0x386f6e);}return;}const _0x47f404=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x412be1['id'],'companyId':_0x1eb820,'whatsappId':_0x3efacb?.['id']});try{if(!_0x53ad36[_0x5ac173(0x10a)][_0x5ac173(0x1d3)]){if(_0x412be1[_0x5ac173(0x164)]===_0x5ac173(0x1f2)&&_0x47f404!==null&&(0x0,exports[_0x5ac173(0x129)])(_0x47f404)){if(!isNaN(parseFloat(_0x59134d))){handleRating(parseFloat(_0x59134d),_0x412be1,_0x47f404),await _0x47f404[_0x5ac173(0x193)]({'ratingAt':(0x0,moment_1[_0x5ac173(0x1ae)])()[_0x5ac173(0x1b9)](),'finishedAt':(0x0,moment_1[_0x5ac173(0x1ae)])()[_0x5ac173(0x1b9)](),'rated':!![]});return;}else{if(_0x412be1[_0x5ac173(0x19e)]<_0x3efacb[_0x5ac173(0x16d)]){let _0x3fa3ce=_0x5ac173(0x1da);const _0x56389e=await _0x31daf7[_0x5ac173(0x1b2)](_0x412be1[_0x5ac173(0x1cf)][_0x5ac173(0x1e5)]+'@'+(_0x412be1[_0x5ac173(0x101)]?_0x5ac173(0x122):'s.whatsapp.net'),{'text':_0x3fa3ce});(0x0,exports['verifyMessage'])(_0x56389e,_0x412be1,_0x627c5c,_0x47f404),await(0x0,baileys_1['delay'])(0x3e8);let _0x5c186e='â€Ž'+_0x3efacb['ratingMessage']+'\x0a';const _0x10cff0=await(0x0,SendWhatsAppMessage_1[_0x5ac173(0x1ae)])({'body':_0x5c186e,'ticket':_0x412be1});await(0x0,exports[_0x5ac173(0x1d4)])(_0x10cff0,_0x412be1,_0x412be1[_0x5ac173(0x1cf)]),await _0x412be1[_0x5ac173(0x193)]({'amountUseBotQueuesNPS':_0x412be1[_0x5ac173(0x19e)]+0x1});}return;}}const _0x121727=await(0x0,ListSettingsServiceOne_1['default'])({'companyId':_0x1eb820,'key':'enableLGPD'});if(!(0x0,lodash_1[_0x5ac173(0x152)])(_0x121727[_0x5ac173(0x165)])&&_0x121727[_0x5ac173(0x165)]===_0x5ac173(0x16a)){const _0x4802bc=await(0x0,ListSettingsServiceOne_1['default'])({'companyId':_0x1eb820,'key':'lgpdMessage'}),_0x1f9a85=await(0x0,ListSettingsServiceOne_1['default'])({'companyId':_0x1eb820,'key':_0x5ac173(0xd6)}),_0x22e8b4=await(0x0,ListSettingsServiceOne_1['default'])({'companyId':_0x1eb820,'key':'lgpdConsent'});if(_0x412be1[_0x5ac173(0x164)]===_0x5ac173(0xe1)&&(0x0,lodash_1[_0x5ac173(0x152)])(_0x412be1['lgpdAcceptedAt'])&&!(0x0,lodash_1[_0x5ac173(0x152)])(_0x412be1[_0x5ac173(0x13d)])){let _0x19a5ae=null;_0x53ad36?.[_0x5ac173(0xf9)]?.[_0x5ac173(0x159)]&&(_0x19a5ae=~~+_0x53ad36[_0x5ac173(0xf9)]?.[_0x5ac173(0x159)]);if(!Number[_0x5ac173(0x134)](_0x19a5ae)&&Number[_0x5ac173(0x1e9)](_0x19a5ae)&&!(0x0,lodash_1[_0x5ac173(0x19d)])(_0x19a5ae)&&_0x19a5ae>0x0){if(_0x19a5ae===0x1)await _0x627c5c[_0x5ac173(0x193)]({'lgpdAcceptedAt':(0x0,moment_1['default'])()[_0x5ac173(0x1b9)]()}),await _0x412be1[_0x5ac173(0x193)]({'lgpdAcceptedAt':(0x0,moment_1[_0x5ac173(0x1ae)])()[_0x5ac173(0x1b9)](),'amountUsedBotQueues':0x0});else{if(_0x19a5ae===0x2){if(_0x3efacb[_0x5ac173(0x107)]!==''&&_0x3efacb[_0x5ac173(0x107)]!==undefined){const _0x37476b=await _0x31daf7['sendMessage'](_0x412be1[_0x5ac173(0x1cf)][_0x5ac173(0x1e5)]+'@'+(_0x412be1[_0x5ac173(0x101)]?_0x5ac173(0x122):_0x5ac173(0x110)),{'text':'â€Ž'+_0x3efacb['complationMessage']});(0x0,exports[_0x5ac173(0x1d4)])(_0x37476b,_0x412be1,_0x627c5c,_0x47f404);}await _0x412be1['update']({'status':'closed','amountUsedBotQueues':0x0}),await _0x47f404[_0x5ac173(0x14c)];return;}else _0x412be1['amountUsedBotQueues']<_0x3efacb[_0x5ac173(0x1cc)]&&await _0x412be1[_0x5ac173(0x193)]({'amountUsedBotQueues':_0x412be1[_0x5ac173(0x1d8)]+0x1,'lgpdSendMessageAt':null});}}else _0x412be1[_0x5ac173(0x1d8)]<_0x3efacb[_0x5ac173(0x1cc)]&&await _0x412be1[_0x5ac173(0x193)]({'amountUsedBotQueues':_0x412be1[_0x5ac173(0x1d8)]+0x1,'lgpdSendMessageAt':null});}if((_0x627c5c[_0x5ac173(0x178)]===null||_0x22e8b4[_0x5ac173(0x165)]==='enabled')&&!_0x627c5c['isGroup']&&(_0x412be1[_0x5ac173(0x164)]===_0x5ac173(0xe1)&&(0x0,lodash_1['isNil'])(_0x412be1[_0x5ac173(0x13d)]))&&_0x412be1[_0x5ac173(0x1d8)]<=_0x3efacb[_0x5ac173(0x1cc)]){if(_0x4802bc[_0x5ac173(0x165)]!==undefined&&_0x4802bc['value']!==''){const _0x1ad784=(0x0,Mustache_1[_0x5ac173(0x1ae)])('â€Ž'+_0x4802bc['value'],_0x412be1),_0x5ea713=await _0x31daf7[_0x5ac173(0x1b2)](_0x412be1[_0x5ac173(0x1cf)][_0x5ac173(0x1e5)]+'@'+(_0x412be1[_0x5ac173(0x101)]?_0x5ac173(0x122):_0x5ac173(0x110)),{'text':_0x1ad784});(0x0,exports[_0x5ac173(0x1d4)])(_0x5ea713,_0x412be1,_0x627c5c,_0x47f404);}await(0x0,baileys_1['delay'])(0x3e8);if(_0x1f9a85[_0x5ac173(0x165)]!==undefined&&_0x1f9a85['value']!==''){const _0x49e3be=(0x0,Mustache_1['default'])('â€Ž'+_0x1f9a85[_0x5ac173(0x165)],_0x412be1),_0x3c2af2=await _0x31daf7[_0x5ac173(0x1b2)](_0x412be1['contact']['number']+'@'+(_0x412be1[_0x5ac173(0x101)]?_0x5ac173(0x122):_0x5ac173(0x110)),{'text':_0x49e3be});await(0x0,exports[_0x5ac173(0x1d4)])(_0x3c2af2,_0x412be1,_0x627c5c,_0x47f404);};await(0x0,baileys_1[_0x5ac173(0x1c1)])(0x3e8);const _0x23f48c=(0x0,Mustache_1[_0x5ac173(0x1ae)])(_0x5ac173(0x133),_0x412be1),_0x4eaa3f=await _0x31daf7[_0x5ac173(0x1b2)](_0x412be1[_0x5ac173(0x1cf)]['number']+'@'+(_0x412be1[_0x5ac173(0x101)]?'g.us':_0x5ac173(0x110)),{'text':_0x23f48c});await(0x0,exports[_0x5ac173(0x1d4)])(_0x4eaa3f,_0x412be1,_0x627c5c,_0x47f404),await _0x412be1[_0x5ac173(0x193)]({'lgpdSendMessageAt':(0x0,moment_1[_0x5ac173(0x1ae)])()[_0x5ac173(0x1b9)](),'amountUsedBotQueues':_0x412be1[_0x5ac173(0x1d8)]+0x1}),await _0x412be1[_0x5ac173(0x153)]();return;};if(!(0x0,lodash_1[_0x5ac173(0x152)])(_0x412be1[_0x5ac173(0x13d)])&&(0x0,lodash_1[_0x5ac173(0x152)])(_0x412be1[_0x5ac173(0x178)]))return;}}}catch(_0x717361){Sentry[_0x5ac173(0x1bd)](_0x717361),console['log'](_0x717361);}_0x65ff4d?await verifyMediaMessage(_0x53ad36,_0x412be1,_0x627c5c):await(0x0,exports['verifyMessage'])(_0x53ad36,_0x412be1,_0x627c5c,_0x47f404,_0x242aa5);try{await _0x412be1[_0x5ac173(0x193)]({'fromMe':_0x53ad36[_0x5ac173(0x10a)][_0x5ac173(0x1d3)]});}catch(_0x7605ba){Sentry[_0x5ac173(0x1bd)](_0x7605ba),console[_0x5ac173(0x12a)](_0x7605ba);}const _0x2bea9f=await Setting_1[_0x5ac173(0x1ae)]['findOne']({'where':{'companyId':_0x1eb820,'key':_0x5ac173(0x1c3)}}),_0x584f00=await Setting_1[_0x5ac173(0x1ae)]['findOne']({'where':{'companyId':_0x1eb820,'key':'acceptAudioMessageContact'}});let _0x1f67dd;_0x2bea9f['value']===_0x5ac173(0x143)&&(_0x1f67dd=await(0x0,VerifyCurrentSchedule_1[_0x5ac173(0x1ae)])(_0x1eb820));try{if(!_0x53ad36[_0x5ac173(0x10a)][_0x5ac173(0x1d3)]&&_0x2bea9f){if(_0x2bea9f['value']===_0x5ac173(0x143)&&!(0x0,lodash_1[_0x5ac173(0x152)])(_0x1f67dd)&&(!_0x1f67dd||_0x1f67dd[_0x5ac173(0x1d9)]===![])){if(_0x3efacb[_0x5ac173(0x138)]!==''){const _0x2b89b5=(0x0,Mustache_1[_0x5ac173(0x1ae)])(''+_0x3efacb[_0x5ac173(0x138)],_0x412be1),_0x5f08b8=(0x0,Debounce_1[_0x5ac173(0x160)])(async()=>{const _0x430049=_0x5ac173;await _0x31daf7['sendMessage'](_0x412be1['contact']['number']+'@'+(_0x412be1[_0x430049(0x101)]?_0x430049(0x122):_0x430049(0x110)),{'text':_0x2b89b5});},0x3e8,_0x412be1['id']);_0x5f08b8();return;}return;}}}catch(_0x589f34){Sentry[_0x5ac173(0x1bd)](_0x589f34),console[_0x5ac173(0x12a)](_0x589f34);}!_0x412be1[_0x5ac173(0x105)]&&!_0x999a39&&!_0x53ad36[_0x5ac173(0x10a)][_0x5ac173(0x1d3)]&&!_0x412be1[_0x5ac173(0x1b7)]&&_0x3efacb[_0x5ac173(0xde)][_0x5ac173(0xfb)]>=0x1&&(await verifyQueue(_0x31daf7,_0x53ad36,_0x412be1,_0x627c5c),_0x47f404[_0x5ac173(0xda)]===null&&await _0x47f404[_0x5ac173(0x193)]({'chatbotAt':(0x0,moment_1[_0x5ac173(0x1ae)])()[_0x5ac173(0x1b9)]()}));_0x412be1[_0x5ac173(0x1c8)]>0x0&&await _0x47f404[_0x5ac173(0x193)]({'queueId':_0x412be1[_0x5ac173(0x1c8)]});if(getTypeMessage(_0x53ad36)==='audioMessage'&&!_0x53ad36[_0x5ac173(0x10a)][_0x5ac173(0x1d3)]&&!_0x999a39&&!_0x627c5c[_0x5ac173(0x19b)]&&_0x584f00[_0x5ac173(0x165)]===_0x5ac173(0x1ad)){const _0x5a5e33=await _0x31daf7[_0x5ac173(0x1b2)](_0x627c5c['number']+_0x5ac173(0x1e8),{'text':_0x5ac173(0x18f)},{'quoted':{'key':_0x53ad36[_0x5ac173(0x10a)],'message':{'extendedTextMessage':_0x53ad36['message'][_0x5ac173(0x1a9)]}}});await(0x0,exports[_0x5ac173(0x1d4)])(_0x5a5e33,_0x412be1,_0x627c5c,_0x47f404);}try{if(!_0x53ad36[_0x5ac173(0x10a)][_0x5ac173(0x1d3)]&&_0x2bea9f&&_0x412be1[_0x5ac173(0x1c8)]!==null){const _0x1c28ad=await Queue_1[_0x5ac173(0x1ae)][_0x5ac173(0xec)](_0x412be1[_0x5ac173(0x1c8)]);_0x2bea9f[_0x5ac173(0x165)]===_0x5ac173(0x105)&&(_0x1f67dd=await(0x0,VerifyCurrentSchedule_1[_0x5ac173(0x1ae)])(_0x1eb820,_0x1c28ad['id']));if(_0x2bea9f[_0x5ac173(0x165)]===_0x5ac173(0x105)&&!(0x0,lodash_1[_0x5ac173(0x152)])(_0x1f67dd)&&(!_0x1f67dd||_0x1f67dd['inActivity']===![])){const _0x14b8ce=_0x1c28ad[_0x5ac173(0x138)];if(_0x14b8ce!==''){const _0x13cffa=(0x0,Mustache_1[_0x5ac173(0x1ae)])(''+_0x14b8ce,_0x412be1),_0xb8a186=(0x0,Debounce_1[_0x5ac173(0x160)])(async()=>{const _0x4cd8c4=_0x5ac173;await _0x31daf7[_0x4cd8c4(0x1b2)](_0x412be1[_0x4cd8c4(0x1cf)][_0x4cd8c4(0x1e5)]+'@'+(_0x412be1[_0x4cd8c4(0x101)]?'g.us':'s.whatsapp.net'),{'text':_0x13cffa});},0x3e8,_0x412be1['id']);_0xb8a186();return;}return;}}}catch(_0x2ca823){Sentry[_0x5ac173(0x1bd)](_0x2ca823),console[_0x5ac173(0x12a)](_0x2ca823);}_0x412be1[_0x5ac173(0x105)]&&_0x412be1[_0x5ac173(0x1c8)]&&!_0x53ad36[_0x5ac173(0x10a)][_0x5ac173(0x1d3)]&&(!_0x412be1[_0x5ac173(0x104)]&&await(0x0,ChatBotListener_1[_0x5ac173(0x1a2)])(_0x412be1['queueId'],_0x31daf7,_0x412be1,_0x627c5c,_0x53ad36),await _0x412be1[_0x5ac173(0x193)]({'sendInactiveMessage':![]})),await _0x412be1[_0x5ac173(0x153)]();}catch(_0x326f93){Sentry[_0x5ac173(0x1bd)](_0x326f93),console['log'](_0x326f93),logger_1[_0x5ac173(0x177)][_0x5ac173(0xf7)]('Error\x20handling\x20whatsapp\x20message:\x20Err:\x20'+_0x326f93);}};exports[a516_0x310cd3(0x1dd)]=handleMessage;const handleMsgAck=async(_0x46bf8f,_0x467d2b)=>{const _0x30ba4b=a516_0x310cd3;await new Promise(_0x544647=>setTimeout(_0x544647,0x1f4));const _0x3e6b86=(0x0,socket_1[_0x30ba4b(0x17e)])();try{const _0xa9254=await Message_1[_0x30ba4b(0x1ae)][_0x30ba4b(0x126)]({'where':{'wid':_0x46bf8f[_0x30ba4b(0x10a)]['id']},'include':['contact',{'model':Message_1[_0x30ba4b(0x1ae)],'as':_0x30ba4b(0x1aa),'include':['contact']}]});if(!_0xa9254)return;await _0xa9254[_0x30ba4b(0x193)]({'ack':_0x467d2b}),_0x3e6b86['to'](_0xa9254[_0x30ba4b(0x15b)][_0x30ba4b(0x1ea)]())[_0x30ba4b(0x113)](_0x30ba4b(0x14e)+_0xa9254[_0x30ba4b(0x1f9)]+'-appMessage',{'action':_0x30ba4b(0x193),'message':_0xa9254});}catch(_0x1c8fa5){Sentry['captureException'](_0x1c8fa5),logger_1[_0x30ba4b(0x177)][_0x30ba4b(0xf7)]('Error\x20handling\x20message\x20ack.\x20Err:\x20'+_0x1c8fa5);}},verifyRecentCampaign=async(_0x23146c,_0x22178b)=>{const _0x1b1174=a516_0x310cd3;if(!isValidMsg(_0x23146c))return;if(!_0x23146c[_0x1b1174(0x10a)][_0x1b1174(0x1d3)]){const _0x44bbb6=_0x23146c[_0x1b1174(0x10a)][_0x1b1174(0xee)][_0x1b1174(0x19c)](/\D/g,''),_0xb9dfc7=await Campaign_1[_0x1b1174(0x1ae)][_0x1b1174(0x1e3)]({'where':{'companyId':_0x22178b,'status':_0x1b1174(0xd3),'confirmation':!![]}});if(_0xb9dfc7){const _0x54e595=_0xb9dfc7['map'](_0x183917=>_0x183917['id']),_0x36a841=await CampaignShipping_1['default'][_0x1b1174(0x126)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x54e595},'number':_0x44bbb6,'confirmation':null}});_0x36a841&&(await _0x36a841[_0x1b1174(0x193)]({'confirmedAt':(0x0,moment_1['default'])(),'confirmation':!![]}),await queues_1[_0x1b1174(0xeb)]['add'](_0x1b1174(0x1c4),{'campaignShippingId':_0x36a841['id'],'campaignId':_0x36a841[_0x1b1174(0x11b)]},{'delay':(0x0,queues_1['parseToMilliseconds'])((0x0,queues_1[_0x1b1174(0x1a3)])(0x0,0xa))}));}}},verifyCampaignMessageAndCloseTicket=async(_0x4c8d6d,_0x4184b4)=>{const _0x26f932=a516_0x310cd3;if(!isValidMsg(_0x4c8d6d))return;const _0x9950e1=(0x0,socket_1[_0x26f932(0x17e)])(),_0x2228a9=(0x0,exports['getBodyMessage'])(_0x4c8d6d),_0x345711=/\u200c/[_0x26f932(0x149)](_0x2228a9);if(_0x4c8d6d[_0x26f932(0x10a)][_0x26f932(0x1d3)]&&_0x345711){const _0x4a7ec0=await Message_1['default'][_0x26f932(0x126)]({'where':{'wid':_0x4c8d6d['key']['id'],'companyId':_0x4184b4}}),_0x5c1be6=await Ticket_1['default'][_0x26f932(0xec)](_0x4a7ec0[_0x26f932(0x15b)]);await _0x5c1be6[_0x26f932(0x193)]({'status':'closed','amountUsedBotQueues':0x0}),_0x9950e1['to'](_0x26f932(0x168))[_0x26f932(0x113)](_0x26f932(0x14e)+_0x5c1be6['companyId']+_0x26f932(0x1f3),{'action':_0x26f932(0x1de),'ticket':_0x5c1be6,'ticketId':_0x5c1be6['id']}),_0x9950e1['to'](_0x5c1be6['status'])['to'](_0x5c1be6['id'][_0x26f932(0x1ea)]())[_0x26f932(0x113)](_0x26f932(0x14e)+_0x5c1be6[_0x26f932(0x1f9)]+_0x26f932(0x1f3),{'action':_0x26f932(0x193),'ticket':_0x5c1be6,'ticketId':_0x5c1be6['id']});}},filterMessages=_0x21cb3c=>{const _0x1f7a44=a516_0x310cd3;if(_0x21cb3c['message']?.[_0x1f7a44(0xf8)])return![];if([baileys_1[_0x1f7a44(0x1bb)][_0x1f7a44(0x184)],baileys_1[_0x1f7a44(0x1bb)][_0x1f7a44(0x14b)],baileys_1[_0x1f7a44(0x1bb)][_0x1f7a44(0xe6)],baileys_1[_0x1f7a44(0x1bb)]['CIPHERTEXT']]['includes'](_0x21cb3c[_0x1f7a44(0x1dc)]))return![];return!![];},wbotMessageListener=(_0xbee860,_0x12792e)=>{const _0x1d4621=a516_0x310cd3;_0xbee860['ev']['on'](_0x1d4621(0x16f),async _0x39a876=>{const _0x3a3433=_0x1d4621,_0x4e6fcd=_0x39a876[_0x3a3433(0x15d)][_0x3a3433(0xe3)](filterMessages)[_0x3a3433(0x10e)](_0x10a74c=>_0x10a74c);if(!_0x4e6fcd)return;_0x4e6fcd['forEach'](async _0x68ab6b=>{const _0x7d6659=_0x3a3433,_0x3183f0=await Message_1['default'][_0x7d6659(0x195)]({'where':{'wid':_0x68ab6b['key']['id'],'companyId':_0x12792e}});if(!_0x3183f0){let _0x2041a5=![],_0x1c894d=await(0x0,exports[_0x7d6659(0x1b1)])(_0x68ab6b);const _0x5cbe5c=_0x68ab6b?.['key']?.[_0x7d6659(0x1d3)];if(_0x5cbe5c)_0x2041a5=/\u200c/[_0x7d6659(0x149)](_0x1c894d);else{if(/\u200c/[_0x7d6659(0x149)](_0x1c894d))_0x1c894d=_0x1c894d[_0x7d6659(0x19c)](/\u200c/,'');logger_1[_0x7d6659(0x177)][_0x7d6659(0x145)]('ValidaÃ§Ã£o\x20de\x20mensagem\x20de\x20campanha\x20enviada\x20por\x20terceiros:\x20'+_0x1c894d);}!_0x2041a5&&await handleMessage(_0x68ab6b,_0xbee860,_0x12792e),await verifyRecentCampaign(_0x68ab6b,_0x12792e),await verifyCampaignMessageAndCloseTicket(_0x68ab6b,_0x12792e);}_0x68ab6b[_0x7d6659(0x10a)][_0x7d6659(0xee)]?.[_0x7d6659(0xd0)]('@g.us')&&handleMsgAck(_0x68ab6b,0x2);});}),_0xbee860['ev']['on'](_0x1d4621(0x196),_0x3deba2=>{const _0x3cd6e7=_0x1d4621;if(_0x3deba2[_0x3cd6e7(0xfb)]===0x0)return;_0x3deba2[_0x3cd6e7(0x151)](async _0x8ea3cd=>{const _0x1f0c54=_0x3cd6e7;_0xbee860[_0x1f0c54(0x185)]([_0x8ea3cd[_0x1f0c54(0x10a)]]);const _0x2cd9c0={..._0x3deba2};_0x2cd9c0['0']?.[_0x1f0c54(0x193)][_0x1f0c54(0x1dc)]===0x1&&_0x2cd9c0['0']?.['key']['remoteJid']!==_0x1f0c54(0xfc)&&(0x0,MarkDeleteWhatsAppMessage_1['default'])(_0x2cd9c0['0']?.[_0x1f0c54(0x10a)][_0x1f0c54(0xee)],null,_0x2cd9c0['0']?.['key']['id'],_0x12792e);let _0xdda41a;_0x8ea3cd[_0x1f0c54(0x193)][_0x1f0c54(0x164)]===0x3&&_0x8ea3cd?.[_0x1f0c54(0x10a)]?.[_0x1f0c54(0x1d3)]?_0xdda41a=0x2:_0xdda41a=_0x8ea3cd['update'][_0x1f0c54(0x164)],handleMsgAck(_0x8ea3cd,_0xdda41a);});}),_0xbee860['ev']['on'](_0x1d4621(0x183),_0x466f37=>{const _0xa79f73=_0x1d4621;if(_0x466f37[_0xa79f73(0xfb)]===0x0)return;_0x466f37['forEach'](async _0x2c84b2=>{const _0x35930d=_0xa79f73,_0x561146=_0x2c84b2['id'][_0x35930d(0x19c)](/\D/g,''),_0x5ee515=_0x2c84b2['subject']||_0x561146,_0x5acdd8={'name':_0x5ee515,'number':_0x561146,'isGroup':!![],'companyId':_0x12792e},_0x510e8f=await(0x0,CreateOrUpdateContactService_1[_0x35930d(0x1ae)])(_0x5acdd8);});});};exports[a516_0x310cd3(0xdb)]=wbotMessageListener;