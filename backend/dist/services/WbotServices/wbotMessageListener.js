'use strict';const a569_0x6601f4=a569_0x1159;(function(_0x48e49d,_0x32e17c){const _0x29dfa6=a569_0x1159,_0x9cd09b=_0x48e49d();while(!![]){try{const _0x44565f=parseInt(_0x29dfa6(0x2d7))/0x1+parseInt(_0x29dfa6(0x2ba))/0x2*(parseInt(_0x29dfa6(0x21b))/0x3)+-parseInt(_0x29dfa6(0x2fa))/0x4+-parseInt(_0x29dfa6(0x28a))/0x5*(-parseInt(_0x29dfa6(0x328))/0x6)+parseInt(_0x29dfa6(0x225))/0x7+parseInt(_0x29dfa6(0x237))/0x8*(-parseInt(_0x29dfa6(0x2c8))/0x9)+-parseInt(_0x29dfa6(0x31d))/0xa*(parseInt(_0x29dfa6(0x319))/0xb);if(_0x44565f===_0x32e17c)break;else _0x9cd09b['push'](_0x9cd09b['shift']());}catch(_0x5e4039){_0x9cd09b['push'](_0x9cd09b['shift']());}}}(a569_0x4b86,0x97d62));var __createBinding=this&&this[a569_0x6601f4(0x2cb)]||(Object['create']?function(_0x1c7fc5,_0x4927d1,_0x1dd714,_0x119277){const _0x374b0d=a569_0x6601f4;if(_0x119277===undefined)_0x119277=_0x1dd714;var _0x11bd12=Object['getOwnPropertyDescriptor'](_0x4927d1,_0x1dd714);(!_0x11bd12||(_0x374b0d(0x32b)in _0x11bd12?!_0x4927d1[_0x374b0d(0x2a1)]:_0x11bd12[_0x374b0d(0x2dd)]||_0x11bd12[_0x374b0d(0x2c2)]))&&(_0x11bd12={'enumerable':!![],'get':function(){return _0x4927d1[_0x1dd714];}}),Object['defineProperty'](_0x1c7fc5,_0x119277,_0x11bd12);}:function(_0x51628b,_0x1769ca,_0x306ed0,_0x36f2b1){if(_0x36f2b1===undefined)_0x36f2b1=_0x306ed0;_0x51628b[_0x36f2b1]=_0x1769ca[_0x306ed0];}),__setModuleDefault=this&&this[a569_0x6601f4(0x21c)]||(Object[a569_0x6601f4(0x200)]?function(_0x32b018,_0x27d10a){const _0x408012=a569_0x6601f4;Object[_0x408012(0x2fd)](_0x32b018,_0x408012(0x2b4),{'enumerable':!![],'value':_0x27d10a});}:function(_0x2f5b8c,_0x2b5f81){const _0x1af27e=a569_0x6601f4;_0x2f5b8c[_0x1af27e(0x2b4)]=_0x2b5f81;}),__importStar=this&&this[a569_0x6601f4(0x217)]||function(_0x442189){const _0x2c10a2=a569_0x6601f4;if(_0x442189&&_0x442189[_0x2c10a2(0x2a1)])return _0x442189;var _0x5d9570={};if(_0x442189!=null){for(var _0x359dd2 in _0x442189)if(_0x359dd2!==_0x2c10a2(0x2b4)&&Object['prototype']['hasOwnProperty'][_0x2c10a2(0x28c)](_0x442189,_0x359dd2))__createBinding(_0x5d9570,_0x442189,_0x359dd2);}return __setModuleDefault(_0x5d9570,_0x442189),_0x5d9570;},__importDefault=this&&this['__importDefault']||function(_0x226aba){const _0x2b3c40=a569_0x6601f4;return _0x226aba&&_0x226aba[_0x2b3c40(0x2a1)]?_0x226aba:{'default':_0x226aba};};Object['defineProperty'](exports,a569_0x6601f4(0x2a1),{'value':!![]}),exports[a569_0x6601f4(0x221)]=exports[a569_0x6601f4(0x316)]=exports[a569_0x6601f4(0x207)]=exports[a569_0x6601f4(0x283)]=exports['handleRating']=exports[a569_0x6601f4(0x2c6)]=exports['verifyMessage']=exports['getQuotedMessageId']=exports['getQuotedMessage']=exports['getBodyMessage']=void 0x0;const path_1=__importStar(require(a569_0x6601f4(0x315))),util_1=require(a569_0x6601f4(0x2e7)),fs_1=require('fs'),fs_2=__importDefault(require('fs')),Sentry=__importStar(require(a569_0x6601f4(0x297))),lodash_1=require(a569_0x6601f4(0x2b7)),baileys_1=require('@whiskeysockets/baileys'),Contact_1=__importDefault(require(a569_0x6601f4(0x1fa))),Ticket_1=__importDefault(require(a569_0x6601f4(0x218))),Message_1=__importDefault(require('../../models/Message')),socket_1=require(a569_0x6601f4(0x2c5)),CreateMessageService_1=__importDefault(require(a569_0x6601f4(0x2ab))),logger_1=require(a569_0x6601f4(0x299)),CreateOrUpdateContactService_1=__importDefault(require(a569_0x6601f4(0x29a))),FindOrCreateTicketService_1=__importDefault(require(a569_0x6601f4(0x23c))),ShowWhatsAppService_1=__importDefault(require(a569_0x6601f4(0x296))),Debounce_1=require(a569_0x6601f4(0x22f)),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),Mustache_1=__importDefault(require(a569_0x6601f4(0x2ec))),UserRating_1=__importDefault(require(a569_0x6601f4(0x2e2))),SendWhatsAppMessage_1=__importDefault(require(a569_0x6601f4(0x33e))),sendFacebookMessage_1=__importDefault(require(a569_0x6601f4(0x246))),moment_1=__importDefault(require(a569_0x6601f4(0x2be))),Queue_1=__importDefault(require(a569_0x6601f4(0x282))),FindOrCreateATicketTrakingService_1=__importDefault(require(a569_0x6601f4(0x318))),VerifyCurrentSchedule_1=__importDefault(require(a569_0x6601f4(0x248))),Campaign_1=__importDefault(require('../../models/Campaign')),CampaignShipping_1=__importDefault(require(a569_0x6601f4(0x26b))),sequelize_1=require(a569_0x6601f4(0x337)),queues_1=require('../../queues'),User_1=__importDefault(require(a569_0x6601f4(0x231))),ChatBotListener_1=require(a569_0x6601f4(0x2d1)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a569_0x6601f4(0x261))),ListUserQueueServices_1=__importDefault(require(a569_0x6601f4(0x23a))),cache_1=__importDefault(require('../../libs/cache')),addLogs_1=require(a569_0x6601f4(0x24d)),SendWhatsAppMedia_1=require(a569_0x6601f4(0x219)),ShowQueueIntegrationService_1=__importDefault(require(a569_0x6601f4(0x233))),CreateSessionDialogflow_1=require(a569_0x6601f4(0x26c)),QueryDialogflow_1=require(a569_0x6601f4(0x21f)),CompaniesSettings_1=__importDefault(require(a569_0x6601f4(0x2b2))),CreateLogTicketService_1=__importDefault(require(a569_0x6601f4(0x243))),request=require(a569_0x6601f4(0x260));let i=0x0;function a569_0x4b86(){const _0x3d4692=['setMinutes','*System:*\x20\x0aFalha\x20no\x20download\x20da\x20mÃ­dia\x20verifique\x20no\x20dispositivo','forEach','Importando\x20Mensagem:\x20','audioMessage','*\x20-\x20','listMessage','3433964JeKkMX','amountUsedBotQueues','type','defineProperty','contacts:','parameters','delete','outOfHoursMessage','REVOKE','facebook','projectName','queryDialogFlow','set','Menu','channel','messageContextInfo','scheduleType','setExtra','degreesLatitude','inActivity','imported','m4a','â€ŽEstou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20NÃ£o','pushName','encodedAudio','finishedAt','*[\x20','path','isValidMsg','sendMessage','../TicketServices/FindOrCreateATicketTrakingService','45001TtTDYe','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20getTypeMessage','sections','parseToMilliseconds','610vAFhLH','acceptAudioMessage','\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20Atendimento','subject','vcard','locationMessage','company','extractMessageContent','extendedTextMessage','.ogg','*Assistente\x20Virtual*:\x0aInfelizmente\x20nÃ£o\x20conseguimos\x20escutar\x20nem\x20enviar\x20Ã¡udios\x20por\x20este\x20canal\x20de\x20atendimento,\x20por\x20favor,\x20envie\x20uma\x20mensagem\x20de\x20*texto*.','6900BMrQDJ','/nopicture.png','env','get','selectedId','Ãudio','Escolha\x20uma\x20opÃ§Ã£o',':\x20ðŸ“ž','status@broadcast','emit','POST','caption','editedMessage','-appMessage','find','sequelize','audio/mp4','toString','queuePosition','E2E_IDENTITY_CHANGED','whatsapp','contact','./SendWhatsAppMessage','viewOnceMessageV2','farewellMessage',';;;','item1.TEL:','*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posiÃ§Ã£o\x20na\x20fila\x20de\x20atendimento\x20Ã©:\x20*','â€Ž\x20*','count','lgpdAcceptedAt','sendPresenceUpdate','contacts','Erro\x20media','debounce','application/json','substring','filename','responses','paused','contextInfo','rows','../../models/Contact','randomValue','n8n','getMinutes','react','isNil','create','trim','buttonsMessage','>>>>>>>>>>>>>>>>>>>','reload','protocolMessage','instagram','handleMessage','mkdirSync','fileName','BEGIN:','disableBot','maxUseBotQueuesNPS','ENTROU\x20NO\x20DIALOGFLOW','settingsUserRandom','ERR_WAPP_DOWNLOAD_MEDIA','existsSync','viewOnceMessage','test','contactId','documentWithCaptionMessage','warn','enableLGPD','__importStar','../../models/Ticket','./SendWhatsAppMedia','ratingAt','4695mbmdbn','__setModuleDefault','campaignQueue','verifyMessage','../QueueIntegrationServices/QueryDialogflow','next','getTypeMessage','templateButtonReplyMessage','add','quotedMessage','7808493shWdSS','pop','getMessageOptions','push','groups.update','endsWith','isGroup','ephemeralMessage','messageTimestamp','downloadMediaMessage','../../helpers/Debounce','composing','../../models/User','s.whatsapp.net','../QueueIntegrationServices/ShowQueueIntegrationService','item1.TEL','queueIntegration','companyId','8yZjsSD','queueId','imageMessage','../UserQueueServices/ListUserQueueServices','quotedMsg','../TicketServices/FindOrCreateTicketService','urlN8N','EM_ANDAMENTO','length','voiceMessage','stringValue','messageStubType','../TicketServices/CreateLogTicketService','chatbotAt',':*\x20','../FacebookServices/sendFacebookMessage','dialogflow','../CompanyService/VerifyCurrentSchedule','g.us','name','buffer','Mensagem','../../helpers/addLogs','replace','@c.us','NFD','readFile','conversation','.txt','isForwarded','stickerMessage','ValidaÃ§Ã£o\x20de\x20mensagem\x20de\x20campanha\x20enviada\x20por\x20terceiros:\x20','value','closed','getIO','public','destroy','axolotlSenderKeyDistributionMessage','slice','groupMetadata','mimetype','request','./MarkDeleteWhatsAppMessage','promisify','getQuotedMessageId','useIntegration','split','toISOString','displayText','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','language','webhook','../../models/CampaignShipping','../QueueIntegrationServices/CreateSessionDialogflow','company-','lgpdSendMessageAt','logger','degreesLongitude','list','delay','amountUseBotQueuesNPS','CIPHERTEXT','endConversation','buttonText','ticketId','enabled','key','lgpdMessage','reaction','complationMessage','toDate','presenceSubscribe','stringify','data:image/png;base64,\x20','acceptAudioMessageContact','../../models/Queue','wbotMessageListener','integrationId','greetingMediaAttachment','title','getBodyMessage','greetingMessage','\x20]*\x20-\x20','2020wedFCx','E2E_DEVICE_CHANGED','call',':unreads','createDialogflowSessionWithModel','reactionMessage','messages','chatbots','getTime','remoteJid','pending','messages.upsert','../WhatsappService/ShowWhatsAppService','@sentry/node','senderKeyDistributionMessage','../../utils/logger','../ContactServices/CreateOrUpdateContactService','handleRating','map','body','captureException','participant','campaignId','__esModule','addLogs','profilePictureUrl','allowGroup','selectedDisplayText','jidNormalizedUser','user','contactsArrayMessage','Erro\x20ao\x20baixar\x20mÃ­dia:','contactMessage','../MessageServices/CreateMessageService','lgpdLink','@g.us','whatsappId','videoMessage','fromMe','update','../../models/CompaniesSettings','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','default','sticker','status','lodash','resolve','contentText','758KkArhp','closedAt','userId','debug','moment','-ticket','nps','base64','configurable','timeUseBotQueues','\x20-\x20Longitude:\x20','../../libs/socket','verifyRating','keys','9290961ypuwRO','includes','log','__createBinding','findOne','buttonsResponseMessage','floor','message','error','./ChatBotListener','isNull','Error\x20handling\x20message\x20ack.\x20Err:\x20','maxUseBotQueues','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','values','589059RtCfTj','jpegThumbnail','writeFile','button','listResponseMessage','selectedRowId','writable','indexOf','Latitude:\x20','join','liveLocationMessage','../../models/UserRating','findAndCountAll','documentMessage','singleSelectReply','chatBot','util','WAMessageStubType','sayChatbot','queue','Error\x20getTypeMessage','../../helpers/Mustache','number','open','text','findByPk','TIMEOUT_TO_IMPORT_MESSAGE','selectedButtonId'];a569_0x4b86=function(){return _0x3d4692;};return a569_0x4b86();}setInterval(()=>{i=0x0;},0x1388);const writeFileAsync=(0x0,util_1[a569_0x6601f4(0x262)])(fs_1[a569_0x6601f4(0x2d9)]);function removeFile(_0x3da864){const _0x55a940=a569_0x6601f4;fs_2[_0x55a940(0x2b4)]['unlink'](_0x3da864,_0x190880=>{if(_0x190880)throw _0x190880;});}const getTimestampMessage=_0x4cb4d4=>{return _0x4cb4d4*0x1;},multVecardGet=function(_0x593960){const _0x9f7fd5=a569_0x6601f4;let _0xc8f60d='\x20',_0x5e055e=_0x593960['split']('\x0a')[0x2][_0x9f7fd5(0x24e)](_0x9f7fd5(0x341),'\x0a')[_0x9f7fd5(0x24e)]('N:','')['replace'](';','')[_0x9f7fd5(0x24e)](';','\x20')[_0x9f7fd5(0x24e)](';;','\x20')['replace']('\x0a',''),_0xe161e8=_0x593960[_0x9f7fd5(0x265)]('\x0a')[0x4]['indexOf']('='),_0x5acdb3=_0x593960['split']('\x0a')[0x4][_0x9f7fd5(0x2de)](':'),_0x85e626=_0x593960[_0x9f7fd5(0x265)]('\x0a')[0x4][_0x9f7fd5(0x1f4)](_0xe161e8+0x1,_0x5acdb3)['replace'](';',''),_0x102b1c=_0x593960['split']('\x0a')[0x4][_0x9f7fd5(0x24e)](_0x9f7fd5(0x342),'');if(_0x85e626!=_0x9f7fd5(0x234))_0xc8f60d=_0xc8f60d+_0x5e055e+_0x9f7fd5(0x32f)+_0x85e626+''+'\x0a';else _0xc8f60d=_0xc8f60d+_0x5e055e+_0x9f7fd5(0x32f)+_0x102b1c+''+'\x0a';return _0xc8f60d;},contactsArrayMessageGet=_0x523855=>{const _0x300ac4=a569_0x6601f4;let _0x9383b9=_0x523855[_0x300ac4(0x2cf)]?.[_0x300ac4(0x2a8)]?.[_0x300ac4(0x348)],_0x183ae8=_0x9383b9[_0x300ac4(0x29c)](function(_0x1f7e84,_0xf48c99){const _0xf30ee5=_0x300ac4;return _0x1f7e84[_0xf30ee5(0x321)];}),_0x571c2a='';_0x183ae8['forEach'](function(_0x247d36,_0x2b9fef){_0x571c2a+=_0x247d36+'\x0a\x0a'+'';});let _0x19142c=_0x571c2a['split'](_0x300ac4(0x20a));_0x19142c['shift']();let _0x54355b='';for(let _0x1d3b1e of _0x19142c){_0x54355b=_0x54355b+multVecardGet(_0x1d3b1e);}return _0x54355b;},getTypeMessage=_0x38833f=>{const _0x39a7d4=a569_0x6601f4,_0x5d9fd4=(0x0,baileys_1['getContentType'])(_0x38833f[_0x39a7d4(0x2cf)]);if(_0x38833f['message']?.[_0x39a7d4(0x33f)])return _0x39a7d4(0x33f);return _0x5d9fd4;};exports['getTypeMessage']=getTypeMessage;const getBodyButton=_0x38957c=>{const _0x383f07=a569_0x6601f4;if(_0x38957c[_0x383f07(0x279)][_0x383f07(0x2b0)]&&_0x38957c[_0x383f07(0x2cf)][_0x383f07(0x202)]?.[_0x383f07(0x2b9)]){let _0x4bdce2=''+_0x38957c?.[_0x383f07(0x2cf)]?.[_0x383f07(0x202)]?.[_0x383f07(0x2b9)];for(const _0x5578ea of _0x38957c['message']?.[_0x383f07(0x202)]?.['buttons']){_0x4bdce2+='\x0a\x0a'+_0x5578ea[_0x383f07(0x276)]?.[_0x383f07(0x267)];}return _0x4bdce2;}if(_0x38957c[_0x383f07(0x279)][_0x383f07(0x2b0)]&&_0x38957c?.['message']?.[_0x383f07(0x211)]?.[_0x383f07(0x2cf)]?.['listMessage']){let _0x1fa2de=''+_0x38957c?.[_0x383f07(0x2cf)]?.['viewOnceMessage']?.['message']?.[_0x383f07(0x2f9)]?.['description'];for(const _0x52b842 of _0x38957c[_0x383f07(0x2cf)]?.[_0x383f07(0x211)]?.[_0x383f07(0x2cf)]?.['listMessage']?.[_0x383f07(0x31b)]){for(const _0xd50dd8 of _0x52b842[_0x383f07(0x1f9)]){_0x1fa2de+='\x0a\x0a'+_0xd50dd8[_0x383f07(0x286)];}}return _0x1fa2de;}},getBodyList=_0x3f09e3=>{const _0x51ad1d=a569_0x6601f4;if(_0x3f09e3['key'][_0x51ad1d(0x2b0)]&&_0x3f09e3[_0x51ad1d(0x2cf)][_0x51ad1d(0x2f9)]?.['description']){let _0x4249a3=''+_0x3f09e3[_0x51ad1d(0x2cf)]['listMessage']?.['description'];for(const _0x222155 of _0x3f09e3['message']['listMessage']?.['sections']){for(const _0x2e5bf9 of _0x222155['rows']){_0x4249a3+='\x0a\x0a'+_0x2e5bf9[_0x51ad1d(0x286)];}}return _0x4249a3;}if(_0x3f09e3[_0x51ad1d(0x279)][_0x51ad1d(0x2b0)]&&_0x3f09e3?.['message']?.[_0x51ad1d(0x211)]?.[_0x51ad1d(0x2cf)]?.['listMessage']){let _0x17fbf7=''+_0x3f09e3?.[_0x51ad1d(0x2cf)]?.['viewOnceMessage']?.['message']?.[_0x51ad1d(0x2f9)]?.['description'];for(const _0x343785 of _0x3f09e3[_0x51ad1d(0x2cf)]?.[_0x51ad1d(0x211)]?.[_0x51ad1d(0x2cf)]?.[_0x51ad1d(0x2f9)]?.[_0x51ad1d(0x31b)]){for(const _0x36c207 of _0x343785[_0x51ad1d(0x1f9)]){_0x17fbf7+='\x0a\x0a'+_0x36c207[_0x51ad1d(0x286)];}}return _0x17fbf7;}},msgLocation=(_0x52f370,_0x5a241e,_0x15384a)=>{const _0x4dbad1=a569_0x6601f4;if(_0x52f370){var _0x54065b=Buffer['from'](_0x52f370)[_0x4dbad1(0x339)]('base64');let _0x1bfb47=_0x4dbad1(0x280)+_0x54065b+'\x20|\x20https://maps.google.com/maps?q='+_0x5a241e+'%2C'+_0x15384a+'&z=17&hl=pt-BR|'+_0x5a241e+',\x20'+_0x15384a+'\x20';return _0x1bfb47;}},getBodyMessage=_0xcce6b8=>{const _0xe1f599=a569_0x6601f4;try{let _0x323808=getTypeMessage(_0xcce6b8);const _0x18f114={'conversation':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x252)],'imageMessage':_0xcce6b8['message']?.[_0xe1f599(0x239)]?.['caption'],'videoMessage':_0xcce6b8['message']?.['videoMessage']?.[_0xe1f599(0x333)],'extendedTextMessage':_0xcce6b8?.['message']?.[_0xe1f599(0x325)]?.[_0xe1f599(0x2ef)],'buttonsResponseMessage':_0xcce6b8[_0xe1f599(0x2cf)]?.['buttonsResponseMessage']?.[_0xe1f599(0x2a5)],'listResponseMessage':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x2db)]?.[_0xe1f599(0x286)]||_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x2db)]?.[_0xe1f599(0x2e5)]?.[_0xe1f599(0x2dc)],'templateButtonReplyMessage':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x222)]?.[_0xe1f599(0x32c)],'messageContextInfo':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x2cd)]?.[_0xe1f599(0x2f2)]||_0xcce6b8[_0xe1f599(0x2cf)]?.['listResponseMessage']?.[_0xe1f599(0x286)],'buttonsMessage':getBodyButton(_0xcce6b8)||_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x2db)]?.[_0xe1f599(0x286)],'stickerMessage':_0xe1f599(0x2b5),'contactMessage':_0xcce6b8[_0xe1f599(0x2cf)]?.['contactMessage']?.['vcard'],'contactsArrayMessage':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x2a8)]?.[_0xe1f599(0x348)]&&contactsArrayMessageGet(_0xcce6b8),'locationMessage':msgLocation(_0xcce6b8['message']?.[_0xe1f599(0x322)]?.[_0xe1f599(0x2d8)],_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x322)]?.[_0xe1f599(0x30c)],_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x322)]?.[_0xe1f599(0x270)]),'liveLocationMessage':_0xe1f599(0x2df)+_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x2e1)]?.[_0xe1f599(0x30c)]+_0xe1f599(0x2c4)+_0xcce6b8['message']?.[_0xe1f599(0x2e1)]?.[_0xe1f599(0x270)],'documentMessage':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x2e4)]?.[_0xe1f599(0x286)],'audioMessage':_0xe1f599(0x32d),'listMessage':getBodyList(_0xcce6b8)||_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x2db)]?.['title'],'viewOnceMessage':getBodyButton(_0xcce6b8),'reactionMessage':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x28f)]?.[_0xe1f599(0x2ef)]||_0xe1f599(0x27b),'senderKeyDistributionMessage':_0xcce6b8?.[_0xe1f599(0x2cf)]?.[_0xe1f599(0x298)]?.[_0xe1f599(0x25c)],'documentWithCaptionMessage':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x214)]?.[_0xe1f599(0x2cf)]?.[_0xe1f599(0x2e4)]?.[_0xe1f599(0x333)],'viewOnceMessageV2':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x33f)]?.[_0xe1f599(0x2cf)]?.[_0xe1f599(0x239)]?.['caption'],'editedMessage':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x334)]?.[_0xe1f599(0x2cf)]?.[_0xe1f599(0x325)]?.['text'],'ephemeralMessage':_0xcce6b8[_0xe1f599(0x2cf)]?.[_0xe1f599(0x22c)]?.[_0xe1f599(0x2cf)]?.[_0xe1f599(0x325)]?.[_0xe1f599(0x2ef)]},_0x39381a=Object['keys'](_0x18f114)[_0xe1f599(0x336)](_0x41a2d9=>_0x41a2d9===_0x323808);return!_0x39381a&&(logger_1['logger'][_0xe1f599(0x215)]('####\x20Nao\x20achou\x20o\x20type\x20152:\x20'+_0x323808+'\x0a'+JSON[_0xe1f599(0x27f)](_0xcce6b8)),Sentry[_0xe1f599(0x30b)]('Mensagem',{'BodyMsg':_0xcce6b8[_0xe1f599(0x2cf)],'msg':_0xcce6b8,'type':_0x323808}),Sentry[_0xe1f599(0x29e)](new Error(_0xe1f599(0x31a)))),_0x18f114[_0x323808];}catch(_0x386511){Sentry[_0xe1f599(0x30b)](_0xe1f599(0x2eb),{'msg':_0xcce6b8,'BodyMsg':_0xcce6b8[_0xe1f599(0x2cf)]}),Sentry[_0xe1f599(0x29e)](_0x386511),console[_0xe1f599(0x2ca)](_0x386511);}};exports[a569_0x6601f4(0x287)]=getBodyMessage;const getQuotedMessage=_0x350fc3=>{const _0x5d0d46=a569_0x6601f4,_0xf48b0e=(0x0,baileys_1[_0x5d0d46(0x324)])(_0x350fc3[_0x5d0d46(0x2cf)])[Object[_0x5d0d46(0x2c7)](_0x350fc3?.[_0x5d0d46(0x2cf)])[_0x5d0d46(0x2d6)]()['next']()[_0x5d0d46(0x257)]];if(!_0xf48b0e?.[_0x5d0d46(0x1f8)]?.['quotedMessage'])return;const _0x26a7fd=(0x0,baileys_1['extractMessageContent'])(_0xf48b0e?.['contextInfo']?.[_0x5d0d46(0x224)][Object[_0x5d0d46(0x2c7)](_0xf48b0e?.[_0x5d0d46(0x1f8)]?.[_0x5d0d46(0x224)])[_0x5d0d46(0x2d6)]()[_0x5d0d46(0x220)]()[_0x5d0d46(0x257)]]);return _0x26a7fd;};exports['getQuotedMessage']=getQuotedMessage;const getQuotedMessageId=_0x5bc52c=>{const _0xdd82de=a569_0x6601f4,_0x106307=(0x0,baileys_1[_0xdd82de(0x324)])(_0x5bc52c[_0xdd82de(0x2cf)])[Object['keys'](_0x5bc52c?.[_0xdd82de(0x2cf)])['values']()[_0xdd82de(0x220)]()[_0xdd82de(0x257)]];let _0x2a09c1=_0x5bc52c?.[_0xdd82de(0x2cf)]?.['reactionMessage']?_0x5bc52c?.[_0xdd82de(0x2cf)]?.[_0xdd82de(0x28f)]?.[_0xdd82de(0x279)]?.['id']:'';return _0x2a09c1?_0x2a09c1:_0x106307?.[_0xdd82de(0x1f8)]?.['stanzaId'];};exports[a569_0x6601f4(0x263)]=getQuotedMessageId;const getMeSocket=_0x5e830a=>{const _0x1ec2ed=a569_0x6601f4;return{'id':(0x0,baileys_1[_0x1ec2ed(0x2a6)])(_0x5e830a[_0x1ec2ed(0x2a7)]['id']),'name':_0x5e830a['user'][_0x1ec2ed(0x24a)]};},getSenderMessage=(_0x1f6f32,_0x51a909)=>{const _0x28c8f7=a569_0x6601f4,_0xd9c362=getMeSocket(_0x51a909);if(_0x1f6f32[_0x28c8f7(0x279)][_0x28c8f7(0x2b0)])return _0xd9c362['id'];const _0x530755=_0x1f6f32[_0x28c8f7(0x29f)]||_0x1f6f32[_0x28c8f7(0x279)][_0x28c8f7(0x29f)]||_0x1f6f32[_0x28c8f7(0x279)][_0x28c8f7(0x293)]||undefined;return _0x530755&&(0x0,baileys_1[_0x28c8f7(0x2a6)])(_0x530755);},getContactMessage=async(_0x1d6649,_0x4c9be5)=>{const _0x341395=a569_0x6601f4,_0x52749c=_0x1d6649[_0x341395(0x279)][_0x341395(0x293)][_0x341395(0x2c9)](_0x341395(0x249)),_0xa9752c=_0x1d6649[_0x341395(0x279)][_0x341395(0x293)][_0x341395(0x24e)](/\D/g,'');return _0x52749c?{'id':getSenderMessage(_0x1d6649,_0x4c9be5),'name':_0x1d6649[_0x341395(0x311)]}:{'id':_0x1d6649[_0x341395(0x279)][_0x341395(0x293)],'name':_0x1d6649[_0x341395(0x279)]['fromMe']?_0xa9752c:_0x1d6649[_0x341395(0x311)]};},downloadMedia=async(_0x2c72a3,_0x99860b=null)=>{const _0x1e6501=a569_0x6601f4;let _0x5b9b99;try{_0x5b9b99=await(0x0,baileys_1[_0x1e6501(0x22e)])(_0x2c72a3,_0x1e6501(0x24b),{});}catch(_0x59805b){_0x99860b?console[_0x1e6501(0x2ca)]('Falha\x20ao\x20fazer\x20o\x20download\x20de\x20uma\x20mensagem\x20importada,\x20provavelmente\x20a\x20mensagem\x20jÃ¡\x20nÃ£o\x20esta\x20mais\x20disponÃ­vel'):console['error'](_0x1e6501(0x2a9),_0x59805b);}let _0x1a96d7=_0x2c72a3[_0x1e6501(0x2cf)]?.['documentMessage']?.[_0x1e6501(0x209)]||'';const _0x2572b4=_0x2c72a3[_0x1e6501(0x2cf)]?.[_0x1e6501(0x239)]||_0x2c72a3['message']?.[_0x1e6501(0x2f7)]||_0x2c72a3[_0x1e6501(0x2cf)]?.[_0x1e6501(0x2af)]||_0x2c72a3['message']?.['stickerMessage']||_0x2c72a3['message']?.[_0x1e6501(0x2e4)]||_0x2c72a3[_0x1e6501(0x2cf)]?.['documentWithCaptionMessage']?.[_0x1e6501(0x2cf)]?.['documentMessage']||_0x2c72a3[_0x1e6501(0x2cf)]?.[_0x1e6501(0x325)]?.['contextInfo']?.[_0x1e6501(0x224)]?.[_0x1e6501(0x239)]||_0x2c72a3[_0x1e6501(0x2cf)]?.[_0x1e6501(0x325)]?.[_0x1e6501(0x1f8)]?.[_0x1e6501(0x224)]?.[_0x1e6501(0x2af)];if(!_0x2572b4)console[_0x1e6501(0x2ca)](_0x2c72a3);if(!_0x1a96d7){const _0x156ed3=_0x2572b4['mimetype'][_0x1e6501(0x265)]('/')[0x1][_0x1e6501(0x265)](';')[0x0];_0x1a96d7=new Date()[_0x1e6501(0x292)]()+'.'+_0x156ed3;}else _0x1a96d7=new Date()[_0x1e6501(0x292)]()+'_'+_0x1a96d7;const _0x38f6d9={'data':_0x5b9b99,'mimetype':_0x2572b4[_0x1e6501(0x25f)],'filename':_0x1a96d7};return _0x38f6d9;},verifyContact=async(_0x36f413,_0x500a4e,_0x1dadfb)=>{const _0x1fd9bf=a569_0x6601f4;let _0x44a62b;try{_0x44a62b=await _0x500a4e[_0x1fd9bf(0x2a3)](_0x36f413['id'],'image');}catch(_0x176aa4){Sentry[_0x1fd9bf(0x29e)](_0x176aa4),_0x44a62b=process[_0x1fd9bf(0x32a)]['FRONTEND_URL']+_0x1fd9bf(0x329);}const _0x149aa3={'name':_0x36f413[_0x1fd9bf(0x24a)]||_0x36f413['id']['replace'](/\D/g,''),'number':_0x36f413['id']['replace'](/\D/g,''),'profilePicUrl':_0x44a62b,'isGroup':_0x36f413['id'][_0x1fd9bf(0x2c9)](_0x1fd9bf(0x249)),'companyId':_0x1dadfb,'remoteJid':_0x36f413['id']};_0x149aa3[_0x1fd9bf(0x22b)]&&(_0x149aa3['number']=_0x36f413['id'][_0x1fd9bf(0x24e)](_0x1fd9bf(0x2ad),''));const _0x57a359=(0x0,CreateOrUpdateContactService_1['default'])(_0x149aa3);return _0x57a359;},verifyQuotedMessage=async _0x471cb9=>{const _0x38ea85=a569_0x6601f4;if(!_0x471cb9)return null;const _0x3c46df=(0x0,exports[_0x38ea85(0x263)])(_0x471cb9);if(!_0x3c46df)return null;const _0x291e3d=await Message_1[_0x38ea85(0x2b4)][_0x38ea85(0x2cc)]({'where':{'wid':_0x3c46df}});if(!_0x291e3d)return null;return _0x291e3d;},verifyMediaMessage=async(_0x5569cb,_0x48f7c4,_0xa98f6a,_0x113273,_0x41f342)=>{const _0x3023e4=a569_0x6601f4,_0x50fcd=(0x0,socket_1[_0x3023e4(0x259)])(),_0x5afb85=await verifyQuotedMessage(_0x5569cb);try{const _0x2ad578=await downloadMedia(_0x5569cb,_0x48f7c4?.[_0x3023e4(0x30e)]);if(!_0x2ad578&&_0x48f7c4['imported']){const _0x291e76=_0x3023e4(0x2f4),_0x1575c7={'wid':_0x5569cb[_0x3023e4(0x279)]['id'],'ticketId':_0x48f7c4['id'],'contactId':_0x5569cb[_0x3023e4(0x279)]['fromMe']?undefined:_0x48f7c4[_0x3023e4(0x213)],'body':_0x291e76,'reactionMessage':_0x5569cb[_0x3023e4(0x2cf)]?.['reactionMessage'],'fromMe':_0x5569cb[_0x3023e4(0x279)]['fromMe'],'mediaType':getTypeMessage(_0x5569cb),'read':_0x5569cb[_0x3023e4(0x279)][_0x3023e4(0x2b0)],'quotedMsgId':_0x5afb85?.['id']||_0x5569cb[_0x3023e4(0x2cf)]?.[_0x3023e4(0x28f)]?.[_0x3023e4(0x279)]?.['id'],'ack':_0x5569cb[_0x3023e4(0x2b6)],'companyId':_0x48f7c4[_0x3023e4(0x236)],'remoteJid':_0x5569cb['key'][_0x3023e4(0x293)],'participant':_0x5569cb[_0x3023e4(0x279)][_0x3023e4(0x29f)],'timestamp':getTimestampMessage(_0x5569cb['messageTimestamp']),'createdAt':new Date(Math[_0x3023e4(0x2ce)](getTimestampMessage(_0x5569cb[_0x3023e4(0x22d)])*0x3e8))['toISOString'](),'dataJson':JSON[_0x3023e4(0x27f)](_0x5569cb),'ticketImported':_0x48f7c4[_0x3023e4(0x30e)],'isForwarded':_0x41f342};return await _0x48f7c4[_0x3023e4(0x2b1)]({'lastMessage':_0x291e76}),logger_1[_0x3023e4(0x26f)]['error'](Error(_0x3023e4(0x20f))),(0x0,CreateMessageService_1[_0x3023e4(0x2b4)])({'messageData':_0x1575c7,'companyId':_0x48f7c4[_0x3023e4(0x236)]});}if(!_0x2ad578)throw new Error(_0x3023e4(0x20f));if(!_0x2ad578['filename']||_0x2ad578[_0x3023e4(0x25f)]===_0x3023e4(0x338)){const _0x1380f7=_0x2ad578['mimetype']===_0x3023e4(0x338)?_0x3023e4(0x30f):_0x2ad578[_0x3023e4(0x25f)][_0x3023e4(0x265)]('/')[0x1]['split'](';')[0x0];_0x2ad578[_0x3023e4(0x1f5)]=new Date()['getTime']()+'.'+_0x1380f7;}else{const _0x1ea346=_0x2ad578[_0x3023e4(0x1f5)]['split']('.')[_0x3023e4(0x226)](),_0x468aba=_0x2ad578[_0x3023e4(0x1f5)]['split']('.')[_0x3023e4(0x25d)](0x0,-0x1)[_0x3023e4(0x2e0)]('.')[_0x3023e4(0x24e)](/\s/g,'_')['normalize'](_0x3023e4(0x250))[_0x3023e4(0x24e)](/[\u0300-\u036f]/g,'');_0x2ad578[_0x3023e4(0x1f5)]=_0x468aba[_0x3023e4(0x201)]()+'_'+new Date()['getTime']()+'.'+_0x1ea346;}try{const _0x34d287=path_1['default'][_0x3023e4(0x2b8)](__dirname,'..','..','..',_0x3023e4(0x25a),_0x3023e4(0x323)+_0x48f7c4[_0x3023e4(0x236)]);!fs_2['default'][_0x3023e4(0x210)](_0x34d287)&&(fs_2[_0x3023e4(0x2b4)][_0x3023e4(0x208)](_0x34d287,{'recursive':!![]}),fs_2[_0x3023e4(0x2b4)]['chmodSync'](_0x34d287,0x1ff)),await writeFileAsync((0x0,path_1[_0x3023e4(0x2e0)])(_0x34d287,_0x2ad578[_0x3023e4(0x1f5)]),_0x2ad578['data'][_0x3023e4(0x339)](_0x3023e4(0x2c1)),_0x3023e4(0x2c1));}catch(_0x2901c5){Sentry['setExtra'](_0x3023e4(0x1f1),{'companyId':_0x48f7c4['companyId'],'ticket':_0x48f7c4,'contact':_0xa98f6a,'media':_0x2ad578,'quotedMsg':_0x5afb85}),Sentry[_0x3023e4(0x29e)](_0x2901c5),logger_1[_0x3023e4(0x26f)][_0x3023e4(0x2d0)](_0x2901c5),console[_0x3023e4(0x2ca)](_0x5569cb);}const _0xbd24a3=(0x0,exports[_0x3023e4(0x287)])(_0x5569cb),_0x495618={'wid':_0x5569cb['key']['id'],'ticketId':_0x48f7c4['id'],'contactId':_0x5569cb[_0x3023e4(0x279)][_0x3023e4(0x2b0)]?undefined:_0xa98f6a['id'],'body':_0xbd24a3||_0x2ad578[_0x3023e4(0x1f5)],'fromMe':_0x5569cb[_0x3023e4(0x279)][_0x3023e4(0x2b0)],'read':_0x5569cb[_0x3023e4(0x279)]['fromMe'],'mediaUrl':_0x2ad578[_0x3023e4(0x1f5)],'mediaType':_0x2ad578[_0x3023e4(0x25f)][_0x3023e4(0x265)]('/')[0x0],'quotedMsgId':_0x5afb85?.['id'],'ack':_0x5569cb[_0x3023e4(0x2b6)],'remoteJid':_0x5569cb['key']['remoteJid'],'participant':_0x5569cb[_0x3023e4(0x279)][_0x3023e4(0x29f)],'dataJson':JSON['stringify'](_0x5569cb),'ticketTrakingId':_0x113273?.['id'],'createdAt':new Date(Math[_0x3023e4(0x2ce)](getTimestampMessage(_0x5569cb[_0x3023e4(0x22d)])*0x3e8))[_0x3023e4(0x266)](),'ticketImported':_0x48f7c4[_0x3023e4(0x30e)],'isForwarded':_0x41f342};await _0x48f7c4[_0x3023e4(0x2b1)]({'lastMessage':_0xbd24a3||_0x2ad578['filename']});const _0x8887db=await(0x0,CreateMessageService_1[_0x3023e4(0x2b4)])({'messageData':_0x495618,'companyId':_0x48f7c4['companyId']});return!_0x5569cb[_0x3023e4(0x279)][_0x3023e4(0x2b0)]&&_0x48f7c4[_0x3023e4(0x2b6)]===_0x3023e4(0x258)&&(await _0x48f7c4[_0x3023e4(0x2b1)]({'status':_0x3023e4(0x294)}),await _0x48f7c4[_0x3023e4(0x204)]({'include':[{'model':Queue_1[_0x3023e4(0x2b4)],'as':_0x3023e4(0x2ea)},{'model':User_1[_0x3023e4(0x2b4)],'as':_0x3023e4(0x2a7)},{'model':Contact_1[_0x3023e4(0x2b4)],'as':_0x3023e4(0x33d)}]}),_0x50fcd['to'](_0x3023e4(0x258))[_0x3023e4(0x331)](_0x3023e4(0x26d)+_0x48f7c4[_0x3023e4(0x236)]+'-ticket',{'action':_0x3023e4(0x300),'ticket':_0x48f7c4,'ticketId':_0x48f7c4['id']}),_0x50fcd['to'](_0x48f7c4['status'])['to'](_0x48f7c4['id'][_0x3023e4(0x339)]())['emit'](_0x3023e4(0x26d)+_0x48f7c4[_0x3023e4(0x236)]+_0x3023e4(0x2bf),{'action':_0x3023e4(0x2b1),'ticket':_0x48f7c4,'ticketId':_0x48f7c4['id']})),_0x8887db;}catch(_0x3d6023){console['log'](_0x3d6023),logger_1[_0x3023e4(0x26f)][_0x3023e4(0x215)]('Erro\x20ao\x20baixar\x20media');}},verifyMessage=async(_0x252f34,_0x2bca86,_0x3efb60,_0xbd58a5,_0x38ddf0,_0x4eabaa)=>{const _0x1b6fb5=a569_0x6601f4,_0x5db2c4=(0x0,socket_1[_0x1b6fb5(0x259)])(),_0x4bb5da=await verifyQuotedMessage(_0x252f34),_0x5c7f70=(0x0,exports[_0x1b6fb5(0x287)])(_0x252f34),_0x560cf9={'wid':_0x252f34['key']['id'],'ticketId':_0x2bca86['id'],'contactId':_0x252f34[_0x1b6fb5(0x279)]['fromMe']?undefined:_0x3efb60['id'],'body':_0x5c7f70,'fromMe':_0x252f34[_0x1b6fb5(0x279)]['fromMe'],'mediaType':getTypeMessage(_0x252f34),'read':_0x252f34[_0x1b6fb5(0x279)][_0x1b6fb5(0x2b0)],'quotedMsgId':_0x4bb5da?.['id'],'ack':_0x252f34[_0x1b6fb5(0x2b6)],'remoteJid':_0x252f34[_0x1b6fb5(0x279)]['remoteJid'],'participant':_0x252f34['key']['participant'],'dataJson':JSON[_0x1b6fb5(0x27f)](_0x252f34),'ticketTrakingId':_0xbd58a5?.['id'],'isPrivate':_0x38ddf0,'createdAt':new Date(Math[_0x1b6fb5(0x2ce)](getTimestampMessage(_0x252f34[_0x1b6fb5(0x22d)])*0x3e8))[_0x1b6fb5(0x266)](),'ticketImported':_0x2bca86['imported'],'isForwarded':_0x4eabaa};await _0x2bca86[_0x1b6fb5(0x2b1)]({'lastMessage':_0x5c7f70}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x560cf9,'companyId':_0x2bca86[_0x1b6fb5(0x236)]}),!_0x252f34['key'][_0x1b6fb5(0x2b0)]&&_0x2bca86[_0x1b6fb5(0x2b6)]==='closed'&&(await _0x2bca86[_0x1b6fb5(0x2b1)]({'status':_0x1b6fb5(0x294)}),await _0x2bca86[_0x1b6fb5(0x204)]({'include':[{'model':Queue_1[_0x1b6fb5(0x2b4)],'as':'queue'},{'model':User_1[_0x1b6fb5(0x2b4)],'as':_0x1b6fb5(0x2a7)},{'model':Contact_1[_0x1b6fb5(0x2b4)],'as':_0x1b6fb5(0x33d)}]}),_0x5db2c4['to'](_0x1b6fb5(0x258))[_0x1b6fb5(0x331)]('company-'+_0x2bca86[_0x1b6fb5(0x236)]+'-ticket',{'action':_0x1b6fb5(0x300),'ticket':_0x2bca86,'ticketId':_0x2bca86['id']}),!_0x2bca86[_0x1b6fb5(0x30e)]&&_0x5db2c4['to'](_0x2bca86['status'])['to'](_0x2bca86['id'][_0x1b6fb5(0x339)]())[_0x1b6fb5(0x331)]('company-'+_0x2bca86['companyId']+_0x1b6fb5(0x2bf),{'action':'update','ticket':_0x2bca86,'ticketId':_0x2bca86['id']}));};exports[a569_0x6601f4(0x21e)]=verifyMessage;function a569_0x1159(_0x2b83d2,_0x37dd85){const _0x4b865b=a569_0x4b86();return a569_0x1159=function(_0x115934,_0x2e28c0){_0x115934=_0x115934-0x1f1;let _0x2ae3d8=_0x4b865b[_0x115934];return _0x2ae3d8;},a569_0x1159(_0x2b83d2,_0x37dd85);}const isValidMsg=_0xa0d4e5=>{const _0x592a2f=a569_0x6601f4;if(_0xa0d4e5[_0x592a2f(0x279)][_0x592a2f(0x293)]===_0x592a2f(0x330))return![];try{const _0x249902=getTypeMessage(_0xa0d4e5);if(!_0x249902)return;const _0x428263=_0x249902===_0x592a2f(0x252)||_0x249902==='extendedTextMessage'||_0x249902===_0x592a2f(0x2f7)||_0x249902===_0x592a2f(0x2af)||_0x249902==='imageMessage'||_0x249902==='documentMessage'||_0x249902===_0x592a2f(0x255)||_0x249902==='buttonsResponseMessage'||_0x249902===_0x592a2f(0x202)||_0x249902===_0x592a2f(0x309)||_0x249902===_0x592a2f(0x322)||_0x249902===_0x592a2f(0x2e1)||_0x249902==='contactMessage'||_0x249902===_0x592a2f(0x240)||_0x249902==='mediaMessage'||_0x249902===_0x592a2f(0x2a8)||_0x249902===_0x592a2f(0x28f)||_0x249902==='ephemeralMessage'||_0x249902==='protocolMessage'||_0x249902===_0x592a2f(0x2db)||_0x249902===_0x592a2f(0x2f9)||_0x249902===_0x592a2f(0x211)||_0x249902===_0x592a2f(0x214)||_0x249902===_0x592a2f(0x33f)||_0x249902===_0x592a2f(0x334);return!_0x428263&&(logger_1[_0x592a2f(0x26f)]['warn']('####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20'+_0x249902+'\x0a'+JSON[_0x592a2f(0x27f)](_0xa0d4e5?.['message'])),Sentry[_0x592a2f(0x30b)](_0x592a2f(0x24c),{'BodyMsg':_0xa0d4e5[_0x592a2f(0x2cf)],'msg':_0xa0d4e5,'msgType':_0x249902}),Sentry[_0x592a2f(0x29e)](new Error(_0x592a2f(0x2b3)))),!!_0x428263;}catch(_0x3b795c){Sentry[_0x592a2f(0x30b)]('Error\x20isValidMsg',{'msg':_0xa0d4e5}),Sentry[_0x592a2f(0x29e)](_0x3b795c);}};exports[a569_0x6601f4(0x316)]=isValidMsg;const sendDialogflowAwswer=async(_0x79382,_0x3f2216,_0x5d3b99,_0x34e2b2,_0xc0ff61)=>{const _0x572a68=a569_0x6601f4,_0x1c04fb=await(0x0,ShowQueueIntegrationService_1[_0x572a68(0x2b4)])(_0x3f2216[_0x572a68(0x284)],_0x3f2216['companyId']),_0x2dee1d=await(0x0,CreateSessionDialogflow_1[_0x572a68(0x28e)])(_0x1c04fb);if(_0x2dee1d===undefined)return;_0x79382[_0x572a68(0x27e)](_0x34e2b2[_0x572a68(0x293)]),await(0x0,baileys_1[_0x572a68(0x272)])(0x1f4);let _0x286df7=await(0x0,QueryDialogflow_1[_0x572a68(0x305)])(_0x2dee1d,_0x1c04fb[_0x572a68(0x304)],_0x34e2b2[_0x572a68(0x293)],(0x0,exports['getBodyMessage'])(_0x5d3b99),_0x1c04fb[_0x572a68(0x269)],_0xc0ff61);if(!_0x286df7){_0x79382[_0x572a68(0x347)](_0x572a68(0x230),_0x34e2b2[_0x572a68(0x293)]);const _0x1198ba=(0x0,Mustache_1[_0x572a68(0x2b4)])(_0x572a68(0x344)+_0x3f2216?.[_0x572a68(0x235)]?.[_0x572a68(0x24a)]+':*\x20NÃ£o\x20consegui\x20entender\x20sua\x20dÃºvida.');await(0x0,baileys_1[_0x572a68(0x272)])(0x3e8),await _0x79382['sendPresenceUpdate'](_0x572a68(0x1f7),_0x34e2b2['remoteJid']);const _0x358e83=await _0x79382['sendMessage'](_0x34e2b2[_0x572a68(0x2ed)]+_0x572a68(0x24f),{'text':_0x1198ba});await(0x0,exports[_0x572a68(0x21e)])(_0x358e83,_0x3f2216,_0x34e2b2);return;}_0x286df7[_0x572a68(0x275)]&&await _0x3f2216[_0x572a68(0x2b1)]({'contactId':_0x3f2216['contact']['id'][_0x572a68(0x339)](),'useIntegration':![]});const _0xc7796c=_0x286df7[_0x572a68(0x2ff)]['image']?.[_0x572a68(0x241)]??undefined,_0x4d932e=_0x286df7['parameters'][_0x572a68(0x1fe)]?.[_0x572a68(0x241)]??undefined,_0x358c91=_0x286df7[_0x572a68(0x312)][_0x572a68(0x339)](_0x572a68(0x2c1))??undefined;_0x79382[_0x572a68(0x347)](_0x572a68(0x230),_0x34e2b2[_0x572a68(0x293)]),await(0x0,baileys_1[_0x572a68(0x272)])(0x1f4);let _0x81a755;for(let _0xd99562 of _0x286df7[_0x572a68(0x1f6)]){_0x81a755=_0xd99562[_0x572a68(0x2ef)][_0x572a68(0x2ef)][0x0]?_0xd99562[_0x572a68(0x2ef)][_0x572a68(0x2ef)][0x0]:_0x81a755;}for(let _0x49808c of _0x286df7['responses']){_0x49808c[_0x572a68(0x2ef)]&&await sendDelayedMessages(_0x79382,_0x3f2216,_0x34e2b2,_0x5d3b99,_0x49808c[_0x572a68(0x2ef)][_0x572a68(0x2ef)][0x0],_0x81a755,_0xc7796c,_0x358c91,_0x4d932e);}};async function sendDelayedMessages(_0x476a26,_0x1ed29a,_0x1a5d51,_0x75f84c,_0x319795,_0x219b4b,_0x353a25,_0x57bd97,_0x15bf14){const _0x5ed3a3=a569_0x6601f4,_0xcfb862=await(0x0,ShowWhatsAppService_1[_0x5ed3a3(0x2b4)])(_0x476a26['id'],_0x1ed29a[_0x5ed3a3(0x236)]),_0x82df24=_0xcfb862[_0x5ed3a3(0x340)][_0x5ed3a3(0x24e)](/[_*]/g,''),_0x3a3b13=await(0x0,ShowQueueIntegrationService_1[_0x5ed3a3(0x2b4)])(_0x1ed29a[_0x5ed3a3(0x284)],_0x1ed29a[_0x5ed3a3(0x236)]),_0x338ca7=await _0x476a26['sendMessage'](_0x1a5d51['number']+'@c.us',{'text':_0x5ed3a3(0x344)+_0x1ed29a[_0x5ed3a3(0x235)]?.[_0x5ed3a3(0x24a)]+_0x5ed3a3(0x245)+_0x319795});await(0x0,exports[_0x5ed3a3(0x21e)])(_0x338ca7,_0x1ed29a,_0x1a5d51);if(_0x319795!=_0x219b4b)await(0x0,baileys_1[_0x5ed3a3(0x272)])(0x1f4),_0x476a26[_0x5ed3a3(0x347)](_0x5ed3a3(0x230),_0x1a5d51['remoteJid']);else _0x57bd97&&(_0x476a26[_0x5ed3a3(0x347)]('recording',_0x1a5d51[_0x5ed3a3(0x293)]),await(0x0,baileys_1[_0x5ed3a3(0x272)])(0x1f4),_0x82df24&&_0x319795[_0x5ed3a3(0x2c9)](_0x82df24)&&(await(0x0,baileys_1['delay'])(0x2710),setTimeout(async()=>{const _0x26943a=_0x5ed3a3;await _0x1ed29a[_0x26943a(0x2b1)]({'contactId':_0x1ed29a[_0x26943a(0x33d)]['id'][_0x26943a(0x339)](),'useIntegration':!![]}),await(0x0,UpdateTicketService_1[_0x26943a(0x2b4)])({'ticketId':_0x1ed29a['id'],'ticketData':{'status':'closed'},'companyId':_0x1ed29a[_0x26943a(0x236)]});},0xbb8)));}const verifyQueue=async(_0xd2df3d,_0x37af8a,_0x14668d,_0x13c4ab,_0x5cbd22)=>{const _0x46d118=a569_0x6601f4,{queues:_0x559dbd,greetingMessage:_0x45df19,maxUseBotQueues:_0x1663ff,timeUseBotQueues:_0x432592}=await(0x0,ShowWhatsAppService_1['default'])(_0xd2df3d['id'],_0x14668d['companyId']),_0x35327a=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x14668d['id'],'companyId':_0x14668d[_0x46d118(0x236)],'whatsappId':_0x14668d[_0x46d118(0x33c)]?.['id']});let _0x2186d7=![];_0x559dbd[_0x46d118(0x23f)]===0x1&&(_0x2186d7=_0x559dbd[0x0]?.[_0x46d118(0x291)][_0x46d118(0x23f)]>0x1);const _0x41bcae=_0x5cbd22[_0x46d118(0x33a)]===_0x46d118(0x278)||![];if(_0x559dbd['length']===0x1&&!_0x2186d7){const _0x13b9fb=_0x5cbd22['sendGreetingMessageOneQueues']===_0x46d118(0x278)||![];if(_0x45df19[_0x46d118(0x23f)]>0x1&&_0x13b9fb){const _0x36e9a2=(0x0,Mustache_1[_0x46d118(0x2b4)])(''+_0x45df19,_0x14668d);if(_0x14668d[_0x46d118(0x33c)][_0x46d118(0x285)]!==null){const _0x4ea4bc=path_1[_0x46d118(0x2b4)][_0x46d118(0x2b8)](_0x46d118(0x25a),_0x46d118(0x323)+_0x14668d['companyId'],_0x14668d[_0x46d118(0x33c)][_0x46d118(0x285)]),_0x507491=_0x14668d[_0x46d118(0x33c)][_0x46d118(0x285)],_0x355624=await(0x0,SendWhatsAppMedia_1[_0x46d118(0x227)])(_0x507491,_0x4ea4bc,String(_0x14668d[_0x46d118(0x236)]),_0x36e9a2),_0x1920ae=await _0xd2df3d[_0x46d118(0x317)](_0x14668d[_0x46d118(0x33d)][_0x46d118(0x2ed)]+'@'+(_0x14668d[_0x46d118(0x22b)]?_0x46d118(0x249):_0x46d118(0x232)),{..._0x355624});await verifyMediaMessage(_0x1920ae,_0x14668d,_0x13c4ab,_0x35327a);}else await _0xd2df3d[_0x46d118(0x317)](_0x13c4ab[_0x46d118(0x2ed)]+'@'+(_0x14668d[_0x46d118(0x22b)]?_0x46d118(0x249):_0x46d118(0x232)),{'text':_0x36e9a2});}await(0x0,UpdateTicketService_1[_0x46d118(0x2b4)])({'ticketData':{'queueId':_0x559dbd[0x0]['id']},'ticketId':_0x14668d['id'],'companyId':_0x14668d[_0x46d118(0x236)]});const _0x1bcfa2=await Ticket_1[_0x46d118(0x2b4)][_0x46d118(0x2e3)]({'where':{'userId':null,'status':_0x46d118(0x294),'companyId':_0x14668d[_0x46d118(0x236)],'queueId':_0x559dbd[0x0]['id'],'isGroup':![]}});if(_0x41bcae){const _0x54adb5=_0x1bcfa2['count']===0x0?0x1:_0x1bcfa2['count'],_0x48f8ca=_0x46d118(0x343)+_0x54adb5+'*',_0x3cb11f=(0x0,Mustache_1[_0x46d118(0x2b4)])(''+_0x48f8ca,_0x14668d),_0x12be91=(0x0,Debounce_1['debounce'])(async()=>{const _0x4536b0=_0x46d118;await _0xd2df3d[_0x4536b0(0x317)](_0x13c4ab[_0x4536b0(0x2ed)]+'@'+(_0x14668d[_0x4536b0(0x22b)]?'g.us':'s.whatsapp.net'),{'text':_0x3cb11f});},0xbb8,_0x14668d['id']);_0x12be91();}return;}if(_0x13c4ab[_0x46d118(0x20b)])return;let _0x1ef249='';if(_0x14668d[_0x46d118(0x2b6)]!=='lgpd')_0x1ef249=_0x37af8a?.[_0x46d118(0x2cf)]?.[_0x46d118(0x2cd)]?.[_0x46d118(0x2f2)]||_0x37af8a?.[_0x46d118(0x2cf)]?.[_0x46d118(0x2db)]?.[_0x46d118(0x2e5)]['selectedRowId']||(0x0,exports[_0x46d118(0x287)])(_0x37af8a);else{if(!(0x0,lodash_1['isNil'])(_0x14668d[_0x46d118(0x346)]))await _0x14668d[_0x46d118(0x2b1)]({'status':_0x46d118(0x294)});await _0x14668d[_0x46d118(0x204)]();}if(_0x1ef249=='Sair'){const _0x17fcc7={'isBot':![],'queueId':null,'userId':null,'status':_0x46d118(0x258),'sendFarewellMessage':![],'maxUseBotQueues':0x0};await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x17fcc7,'ticketId':_0x14668d['id'],'companyId':_0x14668d[_0x46d118(0x236)]});const _0x570c2a=_0x14668d[_0x46d118(0x33c)]?.[_0x46d118(0x27c)],_0x5c3dbe={'text':(0x0,Mustache_1[_0x46d118(0x2b4)])('â€Ž'+_0x570c2a,_0x14668d)};if(!(0x0,lodash_1[_0x46d118(0x1ff)])(_0x570c2a)){const _0x4e455f=await _0xd2df3d[_0x46d118(0x317)](_0x14668d?.['contact']?.[_0x46d118(0x2ed)]+'@'+(_0x14668d['isGroup']?_0x46d118(0x249):_0x46d118(0x232)),_0x5c3dbe);await(0x0,exports[_0x46d118(0x21e)])(_0x4e455f,_0x14668d,_0x14668d['contact']);}return;}const _0x40f97c=_0x2186d7&&_0x559dbd[_0x46d118(0x23f)]===0x1?_0x559dbd[+_0x1ef249]:_0x559dbd[+_0x1ef249-0x1],_0x20c764=_0x5cbd22?.['chatBotType']||_0x46d118(0x2ef);let _0x862cac;if(_0x40f97c)try{const _0x208275=await(0x0,ListUserQueueServices_1[_0x46d118(0x2b4)])(_0x40f97c['id']);_0x208275[_0x46d118(0x2bc)]>-0x1&&(_0x862cac=_0x208275[_0x46d118(0x2bc)]);}catch(_0x446bbc){console['error'](_0x446bbc);}const _0x15b76a=async()=>{const _0x5b934c=_0x46d118;if(_0x40f97c||_0x559dbd[_0x5b934c(0x23f)]===0x1&&_0x2186d7){const _0x233a48=await Queue_1['default'][_0x5b934c(0x2f0)](_0x40f97c['id']);let _0xb68244;_0x5cbd22?.[_0x5b934c(0x30a)]===_0x5b934c(0x2ea)&&(_0xb68244=await(0x0,VerifyCurrentSchedule_1['default'])(_0x14668d[_0x5b934c(0x236)],_0x233a48['id']));if(_0x5cbd22?.[_0x5b934c(0x30a)]==='queue'&&!(0x0,lodash_1[_0x5b934c(0x1ff)])(_0xb68244)&&(!_0xb68244||_0xb68244[_0x5b934c(0x30d)]===![])){const _0x327742=_0x233a48[_0x5b934c(0x301)];if(_0x327742!==''){const _0xa3c8a9=(0x0,Mustache_1[_0x5b934c(0x2b4)])(''+_0x327742,_0x14668d),_0x4ba027=(0x0,Debounce_1[_0x5b934c(0x1f2)])(async()=>{const _0x5e0fd5=_0x5b934c;await _0xd2df3d[_0x5e0fd5(0x317)](_0x14668d['contact'][_0x5e0fd5(0x2ed)]+'@'+(_0x14668d[_0x5e0fd5(0x22b)]?_0x5e0fd5(0x249):_0x5e0fd5(0x232)),{'text':_0xa3c8a9});},0x3e8,_0x14668d['id']);_0x4ba027(),await _0x14668d[_0x5b934c(0x2b1)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x14668d[_0x5b934c(0x2fb)]+0x1});return;}await _0x14668d[_0x5b934c(0x2b1)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x14668d[_0x5b934c(0x2fb)]+0x1});return;}await(0x0,UpdateTicketService_1[_0x5b934c(0x2b4)])({'ticketData':{'amountUsedBotQueues':0x0,'queueId':_0x40f97c['id']},'ticketId':_0x14668d['id'],'companyId':_0x14668d[_0x5b934c(0x236)]});if(_0x40f97c['chatbots'][_0x5b934c(0x23f)]>0x0){let _0x4679d2='';_0x40f97c[_0x5b934c(0x291)][_0x5b934c(0x2f5)]((_0x3b2721,_0x25f895)=>{const _0x552d35=_0x5b934c;_0x4679d2+='*'+(_0x25f895+0x1)+_0x552d35(0x2f8)+_0x3b2721[_0x552d35(0x24a)]+'\x0a';});const _0x4b3f1f=(0x0,Mustache_1[_0x5b934c(0x2b4)])('â€Ž'+_0x40f97c[_0x5b934c(0x288)]+'\x0a\x0a'+_0x4679d2+_0x5b934c(0x268),_0x14668d),_0x33822d=await _0xd2df3d['sendMessage'](_0x13c4ab[_0x5b934c(0x2ed)]+'@'+(_0x14668d[_0x5b934c(0x22b)]?'g.us':'s.whatsapp.net'),{'text':_0x4b3f1f});await(0x0,exports[_0x5b934c(0x21e)])(_0x33822d,_0x14668d,_0x13c4ab,_0x35327a),_0x5cbd22?.[_0x5b934c(0x20e)]===_0x5b934c(0x278)&&await(0x0,UpdateTicketService_1[_0x5b934c(0x2b4)])({'ticketData':{'userId':_0x862cac},'ticketId':_0x14668d['id'],'companyId':_0x14668d['companyId']});}if(!_0x40f97c[_0x5b934c(0x291)][_0x5b934c(0x23f)]&&_0x40f97c[_0x5b934c(0x288)][_0x5b934c(0x23f)]!==0x0){const _0x44454f=(0x0,Mustache_1['default'])('â€Ž'+_0x40f97c[_0x5b934c(0x288)],_0x14668d),_0x3691a7=await _0xd2df3d[_0x5b934c(0x317)](_0x13c4ab[_0x5b934c(0x2ed)]+'@'+(_0x14668d['isGroup']?_0x5b934c(0x249):'s.whatsapp.net'),{'text':_0x44454f});await(0x0,exports[_0x5b934c(0x21e)])(_0x3691a7,_0x14668d,_0x13c4ab,_0x35327a);}const _0x2ee7fa=await Ticket_1[_0x5b934c(0x2b4)][_0x5b934c(0x2e3)]({'where':{'userId':null,'status':_0x5b934c(0x294),'companyId':_0x14668d['companyId'],'queueId':_0x40f97c['id'],'isGroup':![]}});await(0x0,CreateLogTicketService_1[_0x5b934c(0x2b4)])({'ticketId':_0x14668d['id'],'type':_0x5b934c(0x2ea),'queueId':_0x40f97c['id']});if(_0x41bcae&&!_0x40f97c['chatbots'][_0x5b934c(0x23f)]){const _0x2098d0=_0x2ee7fa[_0x5b934c(0x345)]===0x0?0x1:_0x2ee7fa[_0x5b934c(0x345)],_0x1ddc7e=_0x5b934c(0x343)+_0x2098d0+'*',_0xcc6f50=(0x0,Mustache_1[_0x5b934c(0x2b4)])(''+_0x1ddc7e,_0x14668d),_0x252bf1=(0x0,Debounce_1['debounce'])(async()=>{const _0x15f66c=_0x5b934c;await _0xd2df3d[_0x15f66c(0x317)](_0x13c4ab[_0x15f66c(0x2ed)]+'@'+(_0x14668d['isGroup']?_0x15f66c(0x249):'s.whatsapp.net'),{'text':_0xcc6f50});},0xbb8,_0x14668d['id']);_0x252bf1();}}else{if(_0x1663ff&&_0x1663ff!==0x0&&_0x14668d[_0x5b934c(0x2fb)]>=_0x1663ff)return;const _0x153da5=await(0x0,FindOrCreateATicketTrakingService_1[_0x5b934c(0x2b4)])({'ticketId':_0x14668d['id'],'companyId':_0x14668d['companyId']});let _0x2d2691=new Date(),_0x1bdbc7=new Date();if(_0x153da5[_0x5b934c(0x244)]!==null){_0x2d2691[_0x5b934c(0x2f3)](_0x153da5[_0x5b934c(0x244)][_0x5b934c(0x1fd)]()+Number(_0x432592));if(_0x153da5[_0x5b934c(0x244)]!==null&&_0x1bdbc7<_0x2d2691&&_0x432592!=='0')return;}await _0x153da5[_0x5b934c(0x2b1)]({'chatbotAt':null});let _0x19d1b6='';_0x559dbd[_0x5b934c(0x2f5)]((_0x278424,_0x190249)=>{const _0x5c989d=_0x5b934c;_0x19d1b6+=_0x5c989d(0x314)+(_0x190249+0x1)+_0x5c989d(0x289)+_0x278424[_0x5c989d(0x24a)]+'\x0a';}),_0x19d1b6+=_0x5b934c(0x31f);const _0x188c9d=(0x0,Mustache_1[_0x5b934c(0x2b4)])('â€Ž'+_0x45df19+'\x0a\x0a'+_0x19d1b6,_0x14668d);await(0x0,CreateLogTicketService_1[_0x5b934c(0x2b4)])({'ticketId':_0x14668d['id'],'type':_0x5b934c(0x2e6)});if(_0x14668d[_0x5b934c(0x33c)][_0x5b934c(0x285)]!==null){const _0x15544b=path_1[_0x5b934c(0x2b4)]['resolve'](_0x5b934c(0x25a),_0x5b934c(0x323)+_0x14668d[_0x5b934c(0x236)],_0x14668d[_0x5b934c(0x33c)]['greetingMediaAttachment']),_0x48feaf=_0x14668d[_0x5b934c(0x33c)][_0x5b934c(0x285)],_0x394ee8=await(0x0,SendWhatsAppMedia_1[_0x5b934c(0x227)])(_0x48feaf,_0x15544b,String(_0x14668d[_0x5b934c(0x236)]),_0x188c9d);let _0x17ba74=await _0xd2df3d[_0x5b934c(0x317)](_0x14668d[_0x5b934c(0x33d)][_0x5b934c(0x2ed)]+'@'+(_0x14668d[_0x5b934c(0x22b)]?'g.us':'s.whatsapp.net'),{..._0x394ee8});await verifyMediaMessage(_0x17ba74,_0x14668d,_0x13c4ab,_0x153da5),await(0x0,UpdateTicketService_1[_0x5b934c(0x2b4)])({'ticketData':{'amountUsedBotQueues':_0x14668d[_0x5b934c(0x2fb)]+0x1},'ticketId':_0x14668d['id'],'companyId':_0x14668d['companyId']});return;}else{const _0x1c26ef=(0x0,Debounce_1[_0x5b934c(0x1f2)])(async()=>{const _0x57f0f9=_0x5b934c,_0x4c3d9b=await _0xd2df3d['sendMessage'](_0x13c4ab['number']+'@'+(_0x14668d[_0x57f0f9(0x22b)]?'g.us':_0x57f0f9(0x232)),{'text':_0x188c9d});(0x0,exports[_0x57f0f9(0x21e)])(_0x4c3d9b,_0x14668d,_0x13c4ab,_0x153da5);},0x3e8,_0x14668d['id']);await(0x0,UpdateTicketService_1[_0x5b934c(0x2b4)])({'ticketData':{'amountUsedBotQueues':_0x14668d[_0x5b934c(0x2fb)]+0x1},'ticketId':_0x14668d['id'],'companyId':_0x14668d[_0x5b934c(0x236)]}),_0x1c26ef();}}},_0x403446=async()=>{const _0x3351f4=_0x46d118;if(_0x40f97c){await(0x0,UpdateTicketService_1[_0x3351f4(0x2b4)])({'ticketData':{'queueId':_0x40f97c['id']},'ticketId':_0x14668d['id'],'companyId':_0x14668d['companyId']});if(_0x40f97c[_0x3351f4(0x291)][_0x3351f4(0x23f)]>0x0){const _0x5740e7=[];_0x40f97c['chatbots'][_0x3351f4(0x2f5)]((_0x2c1c00,_0x357fbc)=>{const _0x5c89ea=_0x3351f4;_0x5740e7['push']({'buttonId':''+(_0x357fbc+0x1),'buttonText':{'displayText':_0x2c1c00[_0x5c89ea(0x24a)]},'type':0x1});});const _0x99950={'text':(0x0,Mustache_1[_0x3351f4(0x2b4)])(''+_0x40f97c[_0x3351f4(0x288)],_0x14668d),'buttons':_0x5740e7,'headerType':0x4},_0x5e44b9=await _0xd2df3d[_0x3351f4(0x317)](_0x13c4ab[_0x3351f4(0x2ed)]+'@'+(_0x14668d[_0x3351f4(0x22b)]?_0x3351f4(0x249):_0x3351f4(0x232)),_0x99950);await(0x0,exports[_0x3351f4(0x21e)])(_0x5e44b9,_0x14668d,_0x13c4ab,_0x35327a);}if(!_0x40f97c[_0x3351f4(0x291)][_0x3351f4(0x23f)]){const _0x309e03=(0x0,Mustache_1[_0x3351f4(0x2b4)])(''+_0x40f97c[_0x3351f4(0x288)],_0x14668d),_0x5c3a74=await _0xd2df3d[_0x3351f4(0x317)](_0x13c4ab[_0x3351f4(0x2ed)]+'@'+(_0x14668d[_0x3351f4(0x22b)]?_0x3351f4(0x249):_0x3351f4(0x232)),{'text':_0x309e03});await(0x0,exports['verifyMessage'])(_0x5c3a74,_0x14668d,_0x13c4ab,_0x35327a);}}else{const _0x362b39=[];_0x559dbd[_0x3351f4(0x2f5)]((_0xbcee27,_0x25c285)=>{const _0x236316=_0x3351f4;_0x362b39[_0x236316(0x228)]({'buttonId':''+(_0x25c285+0x1),'buttonText':{'displayText':_0xbcee27[_0x236316(0x24a)]},'type':0x4});});const _0x32e6a1={'text':(0x0,Mustache_1['default'])(''+_0x45df19,_0x14668d),'footer':'','buttons':_0x362b39,'headerType':0x4},_0x145ce5=await _0xd2df3d['sendMessage'](_0x13c4ab['number']+'@'+(_0x14668d[_0x3351f4(0x22b)]?'g.us':_0x3351f4(0x232)),_0x32e6a1);await(0x0,exports[_0x3351f4(0x21e)])(_0x145ce5,_0x14668d,_0x13c4ab,_0x35327a),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x14668d[_0x3351f4(0x2fb)]+0x1},'ticketId':_0x14668d['id'],'companyId':_0x14668d[_0x3351f4(0x236)]});}},_0x5ed9ec=async()=>{const _0x1ffce0=_0x46d118;if(_0x40f97c){await(0x0,UpdateTicketService_1[_0x1ffce0(0x2b4)])({'ticketData':{'queueId':_0x40f97c['id']},'ticketId':_0x14668d['id'],'companyId':_0x14668d[_0x1ffce0(0x236)]});if(_0x40f97c[_0x1ffce0(0x291)][_0x1ffce0(0x23f)]>0x0){const _0x307457=[];_0x40f97c['chatbots'][_0x1ffce0(0x2f5)]((_0xb54fa5,_0x39549a)=>{const _0x307b4c=_0x1ffce0;_0x307457[_0x307b4c(0x228)]({'title':_0xb54fa5[_0x307b4c(0x24a)],'rowId':''+(_0x39549a+0x1)});});const _0x190b4a=[{'title':_0x1ffce0(0x307),'rows':_0x307457}],_0x4e0489={'text':(0x0,Mustache_1['default'])(''+_0x40f97c[_0x1ffce0(0x288)],_0x14668d),'buttonText':'Escolha\x20uma\x20opÃ§Ã£o','sections':_0x190b4a},_0x4c0c72=await _0xd2df3d[_0x1ffce0(0x317)](_0x13c4ab[_0x1ffce0(0x2ed)]+'@'+(_0x14668d[_0x1ffce0(0x22b)]?_0x1ffce0(0x249):_0x1ffce0(0x232)),_0x4e0489);await(0x0,exports['verifyMessage'])(_0x4c0c72,_0x14668d,_0x13c4ab,_0x35327a);}if(!_0x40f97c[_0x1ffce0(0x291)]['length']){const _0x17c30c=(0x0,Mustache_1[_0x1ffce0(0x2b4)])(''+_0x40f97c[_0x1ffce0(0x288)],_0x14668d),_0x1985b2=await _0xd2df3d[_0x1ffce0(0x317)](_0x13c4ab[_0x1ffce0(0x2ed)]+'@'+(_0x14668d['isGroup']?_0x1ffce0(0x249):_0x1ffce0(0x232)),{'text':_0x17c30c});await(0x0,exports[_0x1ffce0(0x21e)])(_0x1985b2,_0x14668d,_0x13c4ab,_0x35327a);}}else{const _0x11c805=[];_0x559dbd[_0x1ffce0(0x2f5)]((_0x5e223b,_0x35d327)=>{const _0x36a86d=_0x1ffce0;_0x11c805['push']({'title':_0x5e223b[_0x36a86d(0x24a)],'rowId':''+(_0x35d327+0x1)});});const _0x2dc4b4=[{'title':_0x1ffce0(0x307),'rows':_0x11c805}],_0x137b72={'text':(0x0,Mustache_1['default'])(''+_0x45df19,_0x14668d),'buttonText':_0x1ffce0(0x32e),'sections':_0x2dc4b4},_0x90d01e=await _0xd2df3d[_0x1ffce0(0x317)](_0x13c4ab[_0x1ffce0(0x2ed)]+'@'+(_0x14668d[_0x1ffce0(0x22b)]?_0x1ffce0(0x249):_0x1ffce0(0x232)),_0x137b72);await(0x0,exports[_0x1ffce0(0x21e)])(_0x90d01e,_0x14668d,_0x13c4ab,_0x35327a),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x14668d[_0x1ffce0(0x2fb)]+0x1},'ticketId':_0x14668d['id'],'companyId':_0x14668d[_0x1ffce0(0x236)]});}};if(_0x20c764==='text')return _0x15b76a();if(_0x20c764===_0x46d118(0x2da)&&_0x559dbd[_0x46d118(0x23f)]>0x3)return _0x15b76a();if(_0x20c764===_0x46d118(0x2da)&&_0x559dbd[_0x46d118(0x23f)]<=0x3)return _0x403446();if(_0x20c764===_0x46d118(0x271))return _0x5ed9ec();},verifyRating=_0x3dd08a=>{const _0x137653=a569_0x6601f4;if(_0x3dd08a&&_0x3dd08a[_0x137653(0x313)]===null&&_0x3dd08a[_0x137653(0x2bb)]!==null&&_0x3dd08a[_0x137653(0x2bc)]!==null&&_0x3dd08a[_0x137653(0x21a)]===null)return!![];return![];};exports[a569_0x6601f4(0x2c6)]=verifyRating;const handleRating=async(_0x26eab4,_0x316bbe,_0x1773c6)=>{const _0x5b7ec3=a569_0x6601f4,_0x2364c8=(0x0,socket_1['getIO'])(),{complationMessage:_0x18ff36}=await(0x0,ShowWhatsAppService_1['default'])(_0x316bbe[_0x5b7ec3(0x2ae)],_0x316bbe['companyId']);let _0x481201=_0x26eab4;_0x26eab4<0x0&&(_0x481201=0x0);_0x26eab4>0xa&&(_0x481201=0xa);await UserRating_1[_0x5b7ec3(0x2b4)][_0x5b7ec3(0x200)]({'ticketId':_0x1773c6['ticketId'],'companyId':_0x1773c6[_0x5b7ec3(0x236)],'userId':_0x1773c6[_0x5b7ec3(0x2bc)],'rate':_0x481201});if(!(0x0,lodash_1[_0x5b7ec3(0x1ff)])(_0x18ff36)&&_0x18ff36!==''&&!_0x316bbe[_0x5b7ec3(0x22b)]){const _0x68e75d=(0x0,Mustache_1[_0x5b7ec3(0x2b4)])('â€Ž'+_0x18ff36,_0x316bbe);if(_0x316bbe[_0x5b7ec3(0x308)]==='whatsapp'){const _0x1012c5=await(0x0,SendWhatsAppMessage_1[_0x5b7ec3(0x2b4)])({'body':_0x68e75d,'ticket':_0x316bbe});await(0x0,exports['verifyMessage'])(_0x1012c5,_0x316bbe,_0x316bbe[_0x5b7ec3(0x33d)],_0x1773c6);}[_0x5b7ec3(0x303),_0x5b7ec3(0x206)]['includes'](_0x316bbe[_0x5b7ec3(0x308)])&&await(0x0,sendFacebookMessage_1[_0x5b7ec3(0x2b4)])({'body':_0x68e75d,'ticket':_0x316bbe});}await _0x316bbe[_0x5b7ec3(0x2b1)]({'chatbot':null,'status':_0x5b7ec3(0x258),'amountUseBotQueuesNPS':0x0}),await(0x0,CreateLogTicketService_1[_0x5b7ec3(0x2b4)])({'userId':_0x316bbe['userId'],'queueId':_0x316bbe[_0x5b7ec3(0x238)],'ticketId':_0x316bbe['id'],'type':_0x5b7ec3(0x258)}),_0x2364c8['to'](_0x5b7ec3(0x2ee))[_0x5b7ec3(0x331)]('company-'+_0x316bbe['companyId']+_0x5b7ec3(0x2bf),{'action':_0x5b7ec3(0x300),'ticket':_0x316bbe,'ticketId':_0x316bbe['id']}),_0x2364c8['to'](_0x316bbe[_0x5b7ec3(0x2b6)])['to'](_0x316bbe['id'][_0x5b7ec3(0x339)]())['emit'](_0x5b7ec3(0x26d)+_0x316bbe['companyId']+_0x5b7ec3(0x2bf),{'action':_0x5b7ec3(0x2b1),'ticket':_0x316bbe,'ticketId':_0x316bbe['id']});};exports[a569_0x6601f4(0x29b)]=handleRating;const handleMessage=async(_0x1255f6,_0x4b1563,_0x145eda,_0x1ee2db=![])=>{const _0x7bfc2d=a569_0x6601f4;if(_0x1ee2db){(0x0,addLogs_1[_0x7bfc2d(0x2a2)])({'fileName':'processImportMessagesWppId'+_0x4b1563['id']+_0x7bfc2d(0x253),'text':_0x7bfc2d(0x2f6)+JSON[_0x7bfc2d(0x27f)](_0x1255f6,null,0x2)+_0x7bfc2d(0x203)});let _0x3a6af8=_0x1255f6[_0x7bfc2d(0x279)]['id'],_0x51b155=await Message_1[_0x7bfc2d(0x2b4)]['findOne']({'where':{'wid':_0x3a6af8}});if(_0x51b155){await new Promise(_0x685857=>setTimeout(_0x685857,0x96)),console[_0x7bfc2d(0x2ca)]('Esta\x20mensagem\x20jÃ¡\x20existe');return;}else await new Promise(_0x49ed07=>setTimeout(_0x49ed07,parseInt(process[_0x7bfc2d(0x32a)][_0x7bfc2d(0x2f1)])||0x14a));}else await new Promise(_0x5e3677=>setTimeout(_0x5e3677,i*0x28a)),i++;if(!isValidMsg(_0x1255f6))return;try{let _0x4b02ac,_0x5a2a4e,_0x5a2ef1=0x0,_0x4bb882=0x0,_0x562cd2=0x0,_0x40d2a8=(0x0,exports[_0x7bfc2d(0x287)])(_0x1255f6);const _0x2e6d49=getTypeMessage(_0x1255f6);if(_0x2e6d49==='protocolMessage')return;const _0x888b3=_0x1255f6[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2f7)]||_0x1255f6[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x239)]||_0x1255f6[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2af)]||_0x1255f6[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2e4)]||_0x1255f6[_0x7bfc2d(0x2cf)][_0x7bfc2d(0x255)]||_0x1255f6?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x22c)]?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x239)]||_0x1255f6?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x22c)]?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2f7)]||_0x1255f6?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x22c)]?.['message']?.[_0x7bfc2d(0x2af)]||_0x1255f6?.['message']?.['ephemeralMessage']?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2e4)]||_0x1255f6?.['message']?.[_0x7bfc2d(0x22c)]?.['message']?.[_0x7bfc2d(0x255)]||_0x1255f6[_0x7bfc2d(0x2cf)]?.['viewOnceMessage']?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x239)]||_0x1255f6[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x211)]?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2af)]||_0x1255f6['message']?.[_0x7bfc2d(0x22c)]?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x211)]?.['message']?.[_0x7bfc2d(0x239)]||_0x1255f6['message']?.[_0x7bfc2d(0x22c)]?.['message']?.[_0x7bfc2d(0x211)]?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2af)]||_0x1255f6[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x214)]?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2e4)],_0x27a4ed=/\u200d/['test'](_0x40d2a8);if(_0x1255f6[_0x7bfc2d(0x279)][_0x7bfc2d(0x2b0)]){if(/\u200e/['test'](_0x40d2a8))return;if(!_0x888b3&&_0x2e6d49!==_0x7bfc2d(0x252)&&_0x2e6d49!==_0x7bfc2d(0x325)&&_0x2e6d49!==_0x7bfc2d(0x2aa)&&_0x2e6d49!==_0x7bfc2d(0x28f)&&_0x2e6d49!==_0x7bfc2d(0x22c)&&_0x2e6d49!==_0x7bfc2d(0x205)&&_0x2e6d49!=='viewOnceMessage'&&_0x2e6d49!==_0x7bfc2d(0x334))return;_0x4b02ac=await getContactMessage(_0x1255f6,_0x4b1563);}else _0x4b02ac=await getContactMessage(_0x1255f6,_0x4b1563);const _0x350f12=_0x1255f6['key'][_0x7bfc2d(0x293)]?.['endsWith'](_0x7bfc2d(0x2ad)),_0x6241e6=await(0x0,ShowWhatsAppService_1[_0x7bfc2d(0x2b4)])(_0x4b1563['id'],_0x145eda);if(!_0x6241e6[_0x7bfc2d(0x2a4)]&&_0x350f12)return;if(_0x350f12){const _0x1f9318=await _0x4b1563[_0x7bfc2d(0x25e)](_0x1255f6['key'][_0x7bfc2d(0x293)]),_0x10d686={'id':_0x1f9318['id'],'name':_0x1f9318[_0x7bfc2d(0x320)]};_0x5a2a4e=await verifyContact(_0x10d686,_0x4b1563,_0x145eda);}const _0x4f2133=await verifyContact(_0x4b02ac,_0x4b1563,_0x145eda);let _0x8b650e=0x0,_0x35c571=null;if(_0x1255f6[_0x7bfc2d(0x279)][_0x7bfc2d(0x2b0)])await cache_1[_0x7bfc2d(0x2b4)][_0x7bfc2d(0x306)]('contacts:'+_0x4f2133['id']+':unreads','0');else{const _0x282235=await cache_1['default']['get'](_0x7bfc2d(0x2fe)+_0x4f2133['id']+_0x7bfc2d(0x28d));_0x8b650e=+_0x282235+0x1,await cache_1[_0x7bfc2d(0x2b4)]['set'](_0x7bfc2d(0x2fe)+_0x4f2133['id']+_0x7bfc2d(0x28d),''+_0x8b650e);}const _0x536b22=await CompaniesSettings_1[_0x7bfc2d(0x2b4)][_0x7bfc2d(0x2cc)]({'where':{'companyId':_0x145eda}}),_0x2f79d1=_0x536b22[_0x7bfc2d(0x216)]===_0x7bfc2d(0x278),{ticket:_0x3f56c3,isCreated:_0x3d250e}=await(0x0,FindOrCreateTicketService_1[_0x7bfc2d(0x2b4)])(_0x4f2133,_0x6241e6,_0x8b650e,_0x145eda,_0x5a2ef1,_0x562cd2,_0x5a2a4e,_0x7bfc2d(0x33c),_0x1ee2db,![],_0x536b22);_0x35c571=_0x3f56c3;if(_0x35c571['status']==='closed'||_0x8b650e===0x0&&_0x6241e6['complationMessage']&&(0x0,Mustache_1[_0x7bfc2d(0x2b4)])(_0x6241e6[_0x7bfc2d(0x27c)],_0x35c571)===_0x40d2a8)return;if(_0x2e6d49===_0x7bfc2d(0x334)){const _0x1b6d2f=_0x1255f6['message'][_0x7bfc2d(0x334)]['message'][_0x7bfc2d(0x205)][_0x7bfc2d(0x279)]['id'],_0x316965=_0x1255f6[_0x7bfc2d(0x2cf)][_0x7bfc2d(0x334)][_0x7bfc2d(0x2cf)]['protocolMessage']['editedMessage']['conversation'],_0x54768c=(0x0,socket_1['getIO'])();try{const _0x1f606c=await Message_1[_0x7bfc2d(0x2b4)]['findOne']({'where':{'wid':_0x1b6d2f,'companyId':_0x145eda,'ticketId':_0x35c571['id']}});if(!_0x1f606c)return;await _0x1f606c[_0x7bfc2d(0x2b1)]({'isEdited':!![],'body':_0x316965}),await _0x35c571['update']({'lastMessage':_0x316965}),_0x54768c['to'](_0x1f606c['ticketId'][_0x7bfc2d(0x339)]())[_0x7bfc2d(0x331)](_0x7bfc2d(0x26d)+_0x1f606c[_0x7bfc2d(0x236)]+'-appMessage',{'action':_0x7bfc2d(0x2b1),'message':_0x1f606c});}catch(_0x21e748){Sentry[_0x7bfc2d(0x29e)](_0x21e748),logger_1[_0x7bfc2d(0x26f)][_0x7bfc2d(0x2d0)](_0x7bfc2d(0x2d3)+_0x21e748);}return;}const _0x1d94a1=await(0x0,FindOrCreateATicketTrakingService_1[_0x7bfc2d(0x2b4)])({'ticketId':_0x35c571['id'],'companyId':_0x145eda,'whatsappId':_0x6241e6?.['id']});try{if(!_0x1255f6[_0x7bfc2d(0x279)][_0x7bfc2d(0x2b0)]){if(_0x35c571[_0x7bfc2d(0x2b6)]===_0x7bfc2d(0x2c0)&&_0x1d94a1!==null&&(0x0,exports[_0x7bfc2d(0x2c6)])(_0x1d94a1)){if(!isNaN(parseFloat(_0x40d2a8))){(0x0,exports['handleRating'])(parseFloat(_0x40d2a8),_0x35c571,_0x1d94a1),await _0x1d94a1[_0x7bfc2d(0x2b1)]({'ratingAt':(0x0,moment_1[_0x7bfc2d(0x2b4)])()['toDate'](),'finishedAt':(0x0,moment_1[_0x7bfc2d(0x2b4)])()[_0x7bfc2d(0x27d)](),'rated':!![]});return;}else{if(_0x35c571[_0x7bfc2d(0x273)]<_0x6241e6[_0x7bfc2d(0x20c)]){let _0x1ebf14='â€ŽOpÃ§Ã£o\x20invÃ¡lida,\x20tente\x20novamente.\x0a';const _0x44bd7a=await _0x4b1563[_0x7bfc2d(0x317)](_0x35c571[_0x7bfc2d(0x33d)][_0x7bfc2d(0x2ed)]+'@'+(_0x35c571[_0x7bfc2d(0x22b)]?_0x7bfc2d(0x249):_0x7bfc2d(0x232)),{'text':_0x1ebf14});(0x0,exports['verifyMessage'])(_0x44bd7a,_0x35c571,_0x4f2133,_0x1d94a1),await(0x0,baileys_1[_0x7bfc2d(0x272)])(0x3e8);let _0x4ba84a='â€Ž'+_0x6241e6['ratingMessage']+'\x0a';const _0x5197fa=await(0x0,SendWhatsAppMessage_1[_0x7bfc2d(0x2b4)])({'body':_0x4ba84a,'ticket':_0x35c571});await(0x0,exports['verifyMessage'])(_0x5197fa,_0x35c571,_0x35c571[_0x7bfc2d(0x33d)]),await _0x35c571['update']({'amountUseBotQueuesNPS':_0x35c571[_0x7bfc2d(0x273)]+0x1});}return;}}if(_0x2f79d1){if(_0x35c571[_0x7bfc2d(0x2b6)]==='lgpd'&&_0x536b22?.[_0x7bfc2d(0x216)]==='enabled'&&!_0x1ee2db){if((0x0,lodash_1[_0x7bfc2d(0x1ff)])(_0x35c571['lgpdAcceptedAt'])&&!(0x0,lodash_1[_0x7bfc2d(0x1ff)])(_0x35c571[_0x7bfc2d(0x26e)])){let _0x3dc4c2=null;_0x1255f6?.[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x252)]&&(_0x3dc4c2=~~+_0x1255f6[_0x7bfc2d(0x2cf)]?.['conversation']);if(!Number['isNaN'](_0x3dc4c2)&&Number['isInteger'](_0x3dc4c2)&&!(0x0,lodash_1['isNull'])(_0x3dc4c2)&&_0x3dc4c2>0x0){if(_0x3dc4c2===0x1)await _0x4f2133[_0x7bfc2d(0x2b1)]({'lgpdAcceptedAt':(0x0,moment_1[_0x7bfc2d(0x2b4)])()[_0x7bfc2d(0x27d)]()}),await _0x35c571['update']({'lgpdAcceptedAt':(0x0,moment_1[_0x7bfc2d(0x2b4)])()['toDate'](),'amountUsedBotQueues':0x0});else{if(_0x3dc4c2===0x2){if(_0x6241e6[_0x7bfc2d(0x27c)]!==''&&_0x6241e6[_0x7bfc2d(0x27c)]!==undefined){const _0x4c6d51=await _0x4b1563[_0x7bfc2d(0x317)](_0x35c571[_0x7bfc2d(0x33d)][_0x7bfc2d(0x2ed)]+'@'+(_0x35c571[_0x7bfc2d(0x22b)]?_0x7bfc2d(0x249):_0x7bfc2d(0x232)),{'text':'â€Ž'+_0x6241e6[_0x7bfc2d(0x27c)]});(0x0,exports[_0x7bfc2d(0x21e)])(_0x4c6d51,_0x35c571,_0x4f2133,_0x1d94a1);}await _0x35c571[_0x7bfc2d(0x2b1)]({'status':'closed','amountUsedBotQueues':0x0}),await _0x1d94a1[_0x7bfc2d(0x25b)];return;}else _0x35c571[_0x7bfc2d(0x2fb)]<_0x6241e6['maxUseBotQueues']&&await _0x35c571[_0x7bfc2d(0x2b1)]({'amountUsedBotQueues':_0x35c571[_0x7bfc2d(0x2fb)]+0x1,'lgpdSendMessageAt':null});}}else _0x35c571[_0x7bfc2d(0x2fb)]<_0x6241e6['maxUseBotQueues']&&await _0x35c571[_0x7bfc2d(0x2b1)]({'amountUsedBotQueues':_0x35c571[_0x7bfc2d(0x2fb)]+0x1,'lgpdSendMessageAt':null});}if((_0x4f2133[_0x7bfc2d(0x346)]===null||_0x536b22?.['lgpdConsent']===_0x7bfc2d(0x278))&&!_0x4f2133[_0x7bfc2d(0x22b)]&&(0x0,lodash_1['isNil'])(_0x35c571[_0x7bfc2d(0x26e)])&&_0x35c571[_0x7bfc2d(0x2fb)]<=_0x6241e6[_0x7bfc2d(0x2d4)]&&!(0x0,lodash_1['isNil'])(_0x536b22?.[_0x7bfc2d(0x27a)])){_0x888b3?await verifyMediaMessage(_0x1255f6,_0x35c571,_0x4f2133):await(0x0,exports[_0x7bfc2d(0x21e)])(_0x1255f6,_0x35c571,_0x4f2133,_0x1d94a1,_0x27a4ed);if(!(0x0,lodash_1[_0x7bfc2d(0x1ff)])(_0x536b22?.['lgpdMessage'])&&_0x536b22[_0x7bfc2d(0x27a)]!==''){const _0x78983c=(0x0,Mustache_1[_0x7bfc2d(0x2b4)])('â€Ž'+_0x536b22?.[_0x7bfc2d(0x27a)],_0x35c571),_0x3ecd03=await _0x4b1563['sendMessage'](_0x35c571[_0x7bfc2d(0x33d)]['number']+'@'+(_0x35c571[_0x7bfc2d(0x22b)]?_0x7bfc2d(0x249):'s.whatsapp.net'),{'text':_0x78983c});(0x0,exports['verifyMessage'])(_0x3ecd03,_0x35c571,_0x4f2133,_0x1d94a1);}await(0x0,baileys_1[_0x7bfc2d(0x272)])(0x3e8);if(!(0x0,lodash_1[_0x7bfc2d(0x1ff)])(_0x536b22?.[_0x7bfc2d(0x2ac)])&&_0x536b22?.[_0x7bfc2d(0x2ac)]!==''){const _0x497b1c=(0x0,Mustache_1['default'])('â€Ž'+_0x536b22?.[_0x7bfc2d(0x2ac)],_0x35c571),_0x4e827e=await _0x4b1563[_0x7bfc2d(0x317)](_0x35c571[_0x7bfc2d(0x33d)][_0x7bfc2d(0x2ed)]+'@'+(_0x35c571['isGroup']?_0x7bfc2d(0x249):_0x7bfc2d(0x232)),{'text':_0x497b1c});await(0x0,exports[_0x7bfc2d(0x21e)])(_0x4e827e,_0x35c571,_0x4f2133,_0x1d94a1);};await(0x0,baileys_1[_0x7bfc2d(0x272)])(0x3e8);const _0x32f657=(0x0,Mustache_1[_0x7bfc2d(0x2b4)])(_0x7bfc2d(0x310),_0x35c571),_0x51f1bd=await _0x4b1563['sendMessage'](_0x35c571['contact']['number']+'@'+(_0x35c571['isGroup']?_0x7bfc2d(0x249):'s.whatsapp.net'),{'text':_0x32f657});await(0x0,exports['verifyMessage'])(_0x51f1bd,_0x35c571,_0x4f2133,_0x1d94a1),await _0x35c571[_0x7bfc2d(0x2b1)]({'lgpdSendMessageAt':(0x0,moment_1['default'])()[_0x7bfc2d(0x27d)](),'amountUsedBotQueues':_0x35c571['amountUsedBotQueues']+0x1}),await _0x35c571['reload']();return;};if(!(0x0,lodash_1[_0x7bfc2d(0x1ff)])(_0x35c571['lgpdSendMessageAt'])&&(0x0,lodash_1[_0x7bfc2d(0x1ff)])(_0x35c571[_0x7bfc2d(0x346)]))return;}}}}catch(_0x535e8a){Sentry[_0x7bfc2d(0x29e)](_0x535e8a),console[_0x7bfc2d(0x2ca)](_0x535e8a);}const _0x52d869=_0x1255f6[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x325)]?.[_0x7bfc2d(0x1f8)]?.[_0x7bfc2d(0x254)]||_0x1255f6['message']?.['imageMessage']?.[_0x7bfc2d(0x1f8)]?.[_0x7bfc2d(0x254)]||_0x1255f6[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2f7)]?.['contextInfo']?.[_0x7bfc2d(0x254)]||_0x1255f6[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2af)]?.[_0x7bfc2d(0x1f8)]?.[_0x7bfc2d(0x254)]||_0x1255f6[_0x7bfc2d(0x2cf)]?.[_0x7bfc2d(0x2e4)]?.[_0x7bfc2d(0x1f8)]?.['isForwarded'];_0x888b3?await verifyMediaMessage(_0x1255f6,_0x35c571,_0x4f2133,_0x1d94a1,_0x52d869):await(0x0,exports['verifyMessage'])(_0x1255f6,_0x35c571,_0x4f2133,_0x1d94a1,_0x27a4ed,_0x52d869);try{await _0x35c571[_0x7bfc2d(0x2b1)]({'fromMe':_0x1255f6['key'][_0x7bfc2d(0x2b0)]});}catch(_0x21f60a){Sentry[_0x7bfc2d(0x29e)](_0x21f60a),console['log'](_0x21f60a);}let _0x678b87;_0x536b22[_0x7bfc2d(0x30a)]==='company'&&(_0x678b87=await(0x0,VerifyCurrentSchedule_1[_0x7bfc2d(0x2b4)])(_0x145eda));try{if(!_0x1255f6[_0x7bfc2d(0x279)][_0x7bfc2d(0x2b0)]&&_0x536b22[_0x7bfc2d(0x30a)]){if(_0x536b22['scheduleType']===_0x7bfc2d(0x323)&&!(0x0,lodash_1[_0x7bfc2d(0x1ff)])(_0x678b87)&&(!_0x678b87||_0x678b87[_0x7bfc2d(0x30d)]===![])){_0x1d94a1[_0x7bfc2d(0x244)]===null&&await _0x1d94a1[_0x7bfc2d(0x2b1)]({'chatbotAt':(0x0,moment_1[_0x7bfc2d(0x2b4)])()[_0x7bfc2d(0x27d)]()});if(_0x6241e6[_0x7bfc2d(0x2d4)]&&_0x6241e6['maxUseBotQueues']!==0x0&&_0x35c571[_0x7bfc2d(0x2fb)]>=_0x6241e6[_0x7bfc2d(0x2d4)])return;let _0x953c48=new Date(),_0x1a3e49=new Date();if(_0x1d94a1['chatbotAt']!==null){_0x953c48['setMinutes'](_0x1d94a1[_0x7bfc2d(0x244)][_0x7bfc2d(0x1fd)]()+Number(_0x6241e6['timeUseBotQueues']));if(_0x1d94a1[_0x7bfc2d(0x244)]!==null&&_0x1a3e49<_0x953c48&&_0x6241e6[_0x7bfc2d(0x2c3)]!=='0')return;}await _0x1d94a1['update']({'chatbotAt':null});if(_0x6241e6[_0x7bfc2d(0x301)]!==''){const _0x4e32b6=(0x0,Mustache_1['default'])(''+_0x6241e6['outOfHoursMessage'],_0x35c571),_0x1234d8=(0x0,Debounce_1[_0x7bfc2d(0x1f2)])(async()=>{const _0x7b7e3f=_0x7bfc2d;await _0x4b1563[_0x7b7e3f(0x317)](_0x35c571[_0x7b7e3f(0x33d)][_0x7b7e3f(0x2ed)]+'@'+(_0x35c571[_0x7b7e3f(0x22b)]?_0x7b7e3f(0x249):_0x7b7e3f(0x232)),{'text':_0x4e32b6});},0x3e8,_0x35c571['id']);_0x1234d8(),await _0x35c571[_0x7bfc2d(0x2b1)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x35c571[_0x7bfc2d(0x2fb)]+0x1});return;}await _0x35c571['update']({'isOutOfHour':!![],'amountUsedBotQueues':_0x35c571['amountUsedBotQueues']+0x1});return;}}}catch(_0x4a99d5){Sentry[_0x7bfc2d(0x29e)](_0x4a99d5),console[_0x7bfc2d(0x2ca)](_0x4a99d5);}!_0x35c571[_0x7bfc2d(0x30e)]&&!_0x35c571[_0x7bfc2d(0x2ea)]&&!_0x350f12&&!_0x1255f6[_0x7bfc2d(0x279)][_0x7bfc2d(0x2b0)]&&!_0x35c571['userId']&&_0x6241e6['queues'][_0x7bfc2d(0x23f)]>=0x1&&(await verifyQueue(_0x4b1563,_0x1255f6,_0x35c571,_0x4f2133,_0x536b22),_0x1d94a1[_0x7bfc2d(0x244)]===null&&await _0x1d94a1[_0x7bfc2d(0x2b1)]({'chatbotAt':(0x0,moment_1[_0x7bfc2d(0x2b4)])()['toDate']()}));if(!_0x1255f6[_0x7bfc2d(0x279)][_0x7bfc2d(0x2b0)]&&!_0x35c571['isGroup']&&_0x35c571[_0x7bfc2d(0x2ea)]&&_0x35c571[_0x7bfc2d(0x284)]&&_0x35c571[_0x7bfc2d(0x264)]){const _0x4f7302=await(0x0,ShowQueueIntegrationService_1[_0x7bfc2d(0x2b4)])(_0x35c571[_0x7bfc2d(0x284)],_0x145eda);if(_0x4f7302['type']===_0x7bfc2d(0x1fc)||_0x4f7302[_0x7bfc2d(0x2fc)]===_0x7bfc2d(0x26a)){if(_0x4f7302?.[_0x7bfc2d(0x23d)]){const _0x4d5b43={'method':_0x7bfc2d(0x332),'url':_0x4f7302?.[_0x7bfc2d(0x23d)],'headers':{'Content-Type':_0x7bfc2d(0x1f3)},'json':_0x1255f6};try{const _0x433101=await request(_0x4d5b43);console[_0x7bfc2d(0x2ca)](_0x433101[_0x7bfc2d(0x29d)]);}catch(_0x34ac47){throw new Error(_0x34ac47);}}}else{if(_0x4f7302['type']===_0x7bfc2d(0x247)){let _0x407ccb;if(_0x2e6d49===_0x7bfc2d(0x2f7)){let _0x529cff=_0x1255f6[_0x7bfc2d(0x22d)]+_0x7bfc2d(0x326);(0x0,fs_1[_0x7bfc2d(0x251)])((0x0,path_1[_0x7bfc2d(0x2e0)])(__dirname,'..','..','..','public','company'+_0x145eda,_0x529cff),_0x7bfc2d(0x2c1),(_0x25572e,_0x538dfc)=>{const _0x1aeea6=_0x7bfc2d;_0x407ccb=_0x538dfc,_0x25572e&&logger_1[_0x1aeea6(0x26f)][_0x1aeea6(0x2d0)](_0x25572e);});}else _0x407ccb=undefined;console[_0x7bfc2d(0x2ca)](_0x7bfc2d(0x20d));const _0x2e4c6c=(0x0,Debounce_1[_0x7bfc2d(0x1f2)])(async()=>{await sendDialogflowAwswer(_0x4b1563,_0x35c571,_0x1255f6,_0x4f2133,_0x407ccb);},0x1f4,_0x35c571['id']);_0x2e4c6c();}else{if(_0x4f7302[_0x7bfc2d(0x2fc)]==='typebot'){}}}}_0x35c571[_0x7bfc2d(0x238)]>0x0&&await _0x1d94a1['update']({'queueId':_0x35c571[_0x7bfc2d(0x238)]});if(getTypeMessage(_0x1255f6)==='audioMessage'&&!_0x1255f6['key'][_0x7bfc2d(0x2b0)]&&!_0x350f12&&!_0x4f2133?.[_0x7bfc2d(0x31e)]&&_0x536b22?.[_0x7bfc2d(0x281)]==='disabled'){const _0x63a267=await _0x4b1563[_0x7bfc2d(0x317)](_0x4f2133[_0x7bfc2d(0x2ed)]+_0x7bfc2d(0x24f),{'text':_0x7bfc2d(0x327)},{'quoted':{'key':_0x1255f6[_0x7bfc2d(0x279)],'message':{'extendedTextMessage':_0x1255f6['message']['extendedTextMessage']}}});await(0x0,exports[_0x7bfc2d(0x21e)])(_0x63a267,_0x35c571,_0x4f2133,_0x1d94a1);}try{if(!_0x1255f6['key']['fromMe']&&_0x536b22?.[_0x7bfc2d(0x30a)]&&_0x35c571[_0x7bfc2d(0x238)]!==null){const _0x384213=await Queue_1['default'][_0x7bfc2d(0x2f0)](_0x35c571[_0x7bfc2d(0x238)]);_0x536b22?.[_0x7bfc2d(0x30a)]===_0x7bfc2d(0x2ea)&&(_0x678b87=await(0x0,VerifyCurrentSchedule_1['default'])(_0x145eda,_0x384213['id']));if(_0x536b22?.[_0x7bfc2d(0x30a)]==='queue'&&!(0x0,lodash_1[_0x7bfc2d(0x1ff)])(_0x678b87)&&(!_0x678b87||_0x678b87[_0x7bfc2d(0x30d)]===![])){const _0x3bf961=_0x384213[_0x7bfc2d(0x301)];if(_0x3bf961!==''){const _0x4346e7=(0x0,Mustache_1[_0x7bfc2d(0x2b4)])(''+_0x3bf961,_0x35c571),_0x38be62=(0x0,Debounce_1[_0x7bfc2d(0x1f2)])(async()=>{const _0x161d2e=_0x7bfc2d;await _0x4b1563[_0x161d2e(0x317)](_0x35c571[_0x161d2e(0x33d)][_0x161d2e(0x2ed)]+'@'+(_0x35c571['isGroup']?'g.us':_0x161d2e(0x232)),{'text':_0x4346e7});},0x3e8,_0x35c571['id']);_0x38be62(),await _0x35c571[_0x7bfc2d(0x2b1)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x35c571[_0x7bfc2d(0x2fb)]+0x1});return;}await _0x35c571['update']({'isOutOfHour':!![],'amountUsedBotQueues':_0x35c571['amountUsedBotQueues']+0x1});return;}}}catch(_0xd4e274){Sentry[_0x7bfc2d(0x29e)](_0xd4e274),console[_0x7bfc2d(0x2ca)](_0xd4e274);}_0x35c571[_0x7bfc2d(0x2ea)]&&_0x35c571[_0x7bfc2d(0x238)]&&!_0x1255f6[_0x7bfc2d(0x279)][_0x7bfc2d(0x2b0)]&&((!_0x35c571[_0x7bfc2d(0x2a7)]||_0x35c571[_0x7bfc2d(0x2ea)]?.[_0x7bfc2d(0x291)]?.[_0x7bfc2d(0x23f)]>0x0)&&await(0x0,ChatBotListener_1[_0x7bfc2d(0x2e9)])(_0x35c571[_0x7bfc2d(0x238)],_0x4b1563,_0x35c571,_0x4f2133,_0x1255f6),await _0x35c571[_0x7bfc2d(0x2b1)]({'sendInactiveMessage':![]})),await _0x35c571[_0x7bfc2d(0x204)]();}catch(_0x312555){Sentry[_0x7bfc2d(0x29e)](_0x312555),console[_0x7bfc2d(0x2ca)](_0x312555),logger_1['logger']['error'](_0x7bfc2d(0x2d5)+_0x312555);}};exports[a569_0x6601f4(0x207)]=handleMessage;const handleMsgAck=async(_0x1f68bf,_0x413df4)=>{const _0xa2acdc=a569_0x6601f4;await new Promise(_0xea0446=>setTimeout(_0xea0446,0x1f4));const _0x8439d6=(0x0,socket_1[_0xa2acdc(0x259)])();try{const _0x518c33=await Message_1['default'][_0xa2acdc(0x2cc)]({'where':{'wid':_0x1f68bf[_0xa2acdc(0x279)]['id']},'include':[_0xa2acdc(0x33d),{'model':Message_1[_0xa2acdc(0x2b4)],'as':_0xa2acdc(0x23b),'include':[_0xa2acdc(0x33d)]}]});if(!_0x518c33)return;await _0x518c33[_0xa2acdc(0x2b1)]({'ack':_0x413df4}),_0x8439d6['to'](_0x518c33[_0xa2acdc(0x277)][_0xa2acdc(0x339)]())[_0xa2acdc(0x331)]('company-'+_0x518c33[_0xa2acdc(0x236)]+_0xa2acdc(0x335),{'action':_0xa2acdc(0x2b1),'message':_0x518c33});}catch(_0x24b66e){Sentry[_0xa2acdc(0x29e)](_0x24b66e),logger_1[_0xa2acdc(0x26f)][_0xa2acdc(0x2d0)]('Error\x20handling\x20message\x20ack.\x20Err:\x20'+_0x24b66e);}},verifyRecentCampaign=async(_0x18e7d6,_0x2f4af5)=>{const _0x50c6d5=a569_0x6601f4;if(!isValidMsg(_0x18e7d6))return;if(!_0x18e7d6[_0x50c6d5(0x279)]['fromMe']){const _0x3324b0=_0x18e7d6['key'][_0x50c6d5(0x293)]['replace'](/\D/g,''),_0x33c625=await Campaign_1[_0x50c6d5(0x2b4)]['findAll']({'where':{'companyId':_0x2f4af5,'status':_0x50c6d5(0x23e),'confirmation':!![]}});if(_0x33c625){const _0x56a43b=_0x33c625['map'](_0x530afd=>_0x530afd['id']),_0x2352ca=await CampaignShipping_1[_0x50c6d5(0x2b4)][_0x50c6d5(0x2cc)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x56a43b},'number':_0x3324b0,'confirmation':null}});_0x2352ca&&(await _0x2352ca['update']({'confirmedAt':(0x0,moment_1[_0x50c6d5(0x2b4)])(),'confirmation':!![]}),await queues_1[_0x50c6d5(0x21d)][_0x50c6d5(0x223)]('DispatchCampaign',{'campaignShippingId':_0x2352ca['id'],'campaignId':_0x2352ca[_0x50c6d5(0x2a0)]},{'delay':(0x0,queues_1[_0x50c6d5(0x31c)])((0x0,queues_1[_0x50c6d5(0x1fb)])(0x0,0xa))}));}}},verifyCampaignMessageAndCloseTicket=async(_0x41241,_0x3310a6,_0x3e0558)=>{const _0x2c28e4=a569_0x6601f4;if(!isValidMsg(_0x41241))return;let _0x52be9a;_0x52be9a=await getContactMessage(_0x41241,_0x3e0558);const _0x1c4c1d=await verifyContact(_0x52be9a,_0x3e0558,_0x3310a6),_0x541e4c=(0x0,socket_1['getIO'])(),_0x475713=await(0x0,exports[_0x2c28e4(0x287)])(_0x41241),_0x1ed9ff=/\u200c/[_0x2c28e4(0x212)](_0x475713);if(_0x41241[_0x2c28e4(0x279)]['fromMe']&&_0x1ed9ff){const _0x1ececf=await Message_1[_0x2c28e4(0x2b4)][_0x2c28e4(0x2cc)]({'where':{[sequelize_1['Op']['or']]:[{'wid':_0x41241['key']['id']},{'contactId':_0x1c4c1d['id']}],'companyId':_0x3310a6}});if(!(0x0,lodash_1[_0x2c28e4(0x2d2)])(_0x1ececf)||!(0x0,lodash_1[_0x2c28e4(0x1ff)])(_0x1ececf)||_0x1ececf!==null){const _0x3d2c9a=await Ticket_1[_0x2c28e4(0x2b4)][_0x2c28e4(0x2f0)](_0x1ececf[_0x2c28e4(0x277)]);await _0x3d2c9a[_0x2c28e4(0x2b1)]({'status':_0x2c28e4(0x258),'amountUsedBotQueues':0x0,'amountUseOutOfHours':0x0}),_0x541e4c['to']('open')['emit'](_0x2c28e4(0x26d)+_0x3d2c9a[_0x2c28e4(0x236)]+_0x2c28e4(0x2bf),{'action':_0x2c28e4(0x300),'ticket':_0x3d2c9a,'ticketId':_0x3d2c9a['id']}),_0x541e4c['to'](_0x3d2c9a[_0x2c28e4(0x2b6)])['to'](_0x3d2c9a['id']['toString']())[_0x2c28e4(0x331)](_0x2c28e4(0x26d)+_0x3d2c9a['companyId']+_0x2c28e4(0x2bf),{'action':_0x2c28e4(0x2b1),'ticket':_0x3d2c9a,'ticketId':_0x3d2c9a['id']});}}},filterMessages=_0x5422df=>{const _0x552507=a569_0x6601f4;if(_0x5422df['message']?.[_0x552507(0x205)])return![];if([baileys_1['WAMessageStubType'][_0x552507(0x302)],baileys_1['WAMessageStubType'][_0x552507(0x28b)],baileys_1[_0x552507(0x2e8)][_0x552507(0x33b)],baileys_1[_0x552507(0x2e8)][_0x552507(0x274)]][_0x552507(0x2c9)](_0x5422df[_0x552507(0x242)]))return![];return!![];},wbotMessageListener=(_0x527a75,_0x2b0d6c)=>{const _0x2f21f9=a569_0x6601f4;_0x527a75['ev']['on'](_0x2f21f9(0x295),async _0x274909=>{const _0x1052e5=_0x2f21f9,_0x14aa53=_0x274909[_0x1052e5(0x290)]['filter'](filterMessages)['map'](_0x34fab2=>_0x34fab2);if(!_0x14aa53)return;_0x14aa53[_0x1052e5(0x2f5)](async _0x13ef56=>{const _0x565b18=_0x1052e5,_0x3f2856=await Message_1[_0x565b18(0x2b4)][_0x565b18(0x345)]({'where':{'wid':_0x13ef56['key']['id'],'companyId':_0x2b0d6c}});if(!_0x3f2856){let _0x2edad0=![],_0x4a872c=await(0x0,exports[_0x565b18(0x287)])(_0x13ef56);const _0x3e26db=_0x13ef56?.['key']?.['fromMe'];if(_0x3e26db)_0x2edad0=/\u200c/[_0x565b18(0x212)](_0x4a872c);else{if(/\u200c/[_0x565b18(0x212)](_0x4a872c))_0x4a872c=_0x4a872c[_0x565b18(0x24e)](/\u200c/,'');logger_1[_0x565b18(0x26f)][_0x565b18(0x2bd)](_0x565b18(0x256)+_0x4a872c);}!_0x2edad0&&await handleMessage(_0x13ef56,_0x527a75,_0x2b0d6c),await verifyRecentCampaign(_0x13ef56,_0x2b0d6c),await verifyCampaignMessageAndCloseTicket(_0x13ef56,_0x2b0d6c,_0x527a75);}_0x13ef56[_0x565b18(0x279)]['remoteJid']?.[_0x565b18(0x22a)](_0x565b18(0x2ad))&&handleMsgAck(_0x13ef56,0x2);});}),_0x527a75['ev']['on']('messages.update',_0x3425fc=>{const _0x341198=_0x2f21f9;if(_0x3425fc[_0x341198(0x23f)]===0x0)return;_0x3425fc[_0x341198(0x2f5)](async _0x436848=>{const _0x51bd8b=_0x341198;_0x527a75['readMessages']([_0x436848[_0x51bd8b(0x279)]]);const _0x196dc7={..._0x3425fc};_0x196dc7['0']?.[_0x51bd8b(0x2b1)]['messageStubType']===0x1&&_0x196dc7['0']?.[_0x51bd8b(0x279)][_0x51bd8b(0x293)]!==_0x51bd8b(0x330)&&(0x0,MarkDeleteWhatsAppMessage_1[_0x51bd8b(0x2b4)])(_0x196dc7['0']?.[_0x51bd8b(0x279)]['remoteJid'],null,_0x196dc7['0']?.[_0x51bd8b(0x279)]['id'],_0x2b0d6c);let _0x1e4152;_0x436848[_0x51bd8b(0x2b1)]['status']===0x3&&_0x436848?.[_0x51bd8b(0x279)]?.['fromMe']?_0x1e4152=0x2:_0x1e4152=_0x436848['update'][_0x51bd8b(0x2b6)],handleMsgAck(_0x436848,_0x1e4152);});}),_0x527a75['ev']['on'](_0x2f21f9(0x229),_0x3ec41b=>{const _0xff212b=_0x2f21f9;if(_0x3ec41b[_0xff212b(0x23f)]===0x0)return;_0x3ec41b['forEach'](async _0xb070d7=>{const _0x37b223=_0xff212b,_0x397f38=_0xb070d7['id'][_0x37b223(0x24e)](/\D/g,''),_0x4322b9=_0xb070d7[_0x37b223(0x320)]||_0x397f38,_0x165fa2={'name':_0x4322b9,'number':_0x397f38,'isGroup':!![],'companyId':_0x2b0d6c},_0x12ff2e=await(0x0,CreateOrUpdateContactService_1[_0x37b223(0x2b4)])(_0x165fa2);});});};exports[a569_0x6601f4(0x283)]=wbotMessageListener;