'use strict';const a574_0x90d64b=a574_0x31ce;(function(_0xc36eb8,_0x279b80){const _0x74e304=a574_0x31ce,_0x4d2422=_0xc36eb8();while(!![]){try{const _0x3a9090=parseInt(_0x74e304(0x1eb))/0x1+-parseInt(_0x74e304(0x27a))/0x2+parseInt(_0x74e304(0x17a))/0x3+-parseInt(_0x74e304(0x236))/0x4+parseInt(_0x74e304(0x289))/0x5*(parseInt(_0x74e304(0x1d9))/0x6)+parseInt(_0x74e304(0x162))/0x7+-parseInt(_0x74e304(0x187))/0x8*(parseInt(_0x74e304(0x1ab))/0x9);if(_0x3a9090===_0x279b80)break;else _0x4d2422['push'](_0x4d2422['shift']());}catch(_0x11cb5b){_0x4d2422['push'](_0x4d2422['shift']());}}}(a574_0x30f9,0x271a1));var __createBinding=this&&this[a574_0x90d64b(0x182)]||(Object[a574_0x90d64b(0x245)]?function(_0xc00bef,_0x51168f,_0x2f8300,_0x81bc92){const _0x476814=a574_0x90d64b;if(_0x81bc92===undefined)_0x81bc92=_0x2f8300;var _0x1e9d97=Object[_0x476814(0x15e)](_0x51168f,_0x2f8300);(!_0x1e9d97||(_0x476814(0x154)in _0x1e9d97?!_0x51168f['__esModule']:_0x1e9d97['writable']||_0x1e9d97[_0x476814(0x249)]))&&(_0x1e9d97={'enumerable':!![],'get':function(){return _0x51168f[_0x2f8300];}}),Object[_0x476814(0x1bc)](_0xc00bef,_0x81bc92,_0x1e9d97);}:function(_0x4903c1,_0x2b55a5,_0x78fa45,_0x584a53){if(_0x584a53===undefined)_0x584a53=_0x78fa45;_0x4903c1[_0x584a53]=_0x2b55a5[_0x78fa45];}),__setModuleDefault=this&&this[a574_0x90d64b(0x197)]||(Object[a574_0x90d64b(0x245)]?function(_0x4547fe,_0x244b88){const _0x13541f=a574_0x90d64b;Object[_0x13541f(0x1bc)](_0x4547fe,_0x13541f(0x13e),{'enumerable':!![],'value':_0x244b88});}:function(_0x573ba2,_0x378d2c){_0x573ba2['default']=_0x378d2c;}),__importStar=this&&this[a574_0x90d64b(0x26f)]||function(_0x3c7fcf){const _0x328cf0=a574_0x90d64b;if(_0x3c7fcf&&_0x3c7fcf[_0x328cf0(0x186)])return _0x3c7fcf;var _0x2add0f={};if(_0x3c7fcf!=null){for(var _0x840515 in _0x3c7fcf)if(_0x840515!==_0x328cf0(0x13e)&&Object[_0x328cf0(0x1db)][_0x328cf0(0x21a)]['call'](_0x3c7fcf,_0x840515))__createBinding(_0x2add0f,_0x3c7fcf,_0x840515);}return __setModuleDefault(_0x2add0f,_0x3c7fcf),_0x2add0f;},__importDefault=this&&this[a574_0x90d64b(0x170)]||function(_0xc87276){const _0x350ee5=a574_0x90d64b;return _0xc87276&&_0xc87276[_0x350ee5(0x186)]?_0xc87276:{'default':_0xc87276};};Object[a574_0x90d64b(0x1bc)](exports,a574_0x90d64b(0x186),{'value':!![]}),exports[a574_0x90d64b(0x1a9)]=exports[a574_0x90d64b(0x164)]=exports[a574_0x90d64b(0x1de)]=exports[a574_0x90d64b(0x15a)]=exports[a574_0x90d64b(0x272)]=exports[a574_0x90d64b(0x234)]=exports[a574_0x90d64b(0x287)]=exports[a574_0x90d64b(0x1ed)]=exports['verifyMediaMessage']=exports['getQuotedMessageId']=exports['getQuotedMessage']=exports[a574_0x90d64b(0x1e5)]=void 0x0;const path_1=__importStar(require(a574_0x90d64b(0x268))),util_1=require(a574_0x90d64b(0x1b5)),fs_1=require('fs'),fs_2=__importDefault(require('fs')),Sentry=__importStar(require(a574_0x90d64b(0x1a3))),lodash_1=require(a574_0x90d64b(0x212)),baileys_1=require(a574_0x90d64b(0x282)),Contact_1=__importDefault(require(a574_0x90d64b(0x24d))),Ticket_1=__importDefault(require(a574_0x90d64b(0x278))),Message_1=__importDefault(require(a574_0x90d64b(0x23b))),socket_1=require(a574_0x90d64b(0x28b)),CreateMessageService_1=__importDefault(require(a574_0x90d64b(0x144))),logger_1=require('../../utils/logger'),CreateOrUpdateContactService_1=__importDefault(require(a574_0x90d64b(0x1d8))),FindOrCreateTicketService_1=__importDefault(require(a574_0x90d64b(0x17f))),ShowWhatsAppService_1=__importDefault(require(a574_0x90d64b(0x203))),Debounce_1=require(a574_0x90d64b(0x1ce)),UpdateTicketService_1=__importDefault(require(a574_0x90d64b(0x25b))),Mustache_1=__importDefault(require(a574_0x90d64b(0x1d4))),UserRating_1=__importDefault(require('../../models/UserRating')),SendWhatsAppMessage_1=__importDefault(require(a574_0x90d64b(0x1ca))),sendFacebookMessage_1=__importDefault(require(a574_0x90d64b(0x267))),moment_1=__importDefault(require(a574_0x90d64b(0x219))),Queue_1=__importDefault(require(a574_0x90d64b(0x16d))),FindOrCreateATicketTrakingService_1=__importDefault(require('../TicketServices/FindOrCreateATicketTrakingService')),VerifyCurrentSchedule_1=__importDefault(require(a574_0x90d64b(0x15d))),Campaign_1=__importDefault(require(a574_0x90d64b(0x23d))),CampaignShipping_1=__importDefault(require(a574_0x90d64b(0x206))),sequelize_1=require(a574_0x90d64b(0x280)),queues_1=require('../../queues'),User_1=__importDefault(require(a574_0x90d64b(0x22e))),ChatBotListener_1=require(a574_0x90d64b(0x1b2)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a574_0x90d64b(0x20f))),ListUserQueueServices_1=__importDefault(require(a574_0x90d64b(0x243))),cache_1=__importDefault(require(a574_0x90d64b(0x1e0))),addLogs_1=require('../../helpers/addLogs'),SendWhatsAppMedia_1=__importStar(require('./SendWhatsAppMedia')),ShowQueueIntegrationService_1=__importDefault(require(a574_0x90d64b(0x1b6))),CreateSessionDialogflow_1=require('../QueueIntegrationServices/CreateSessionDialogflow'),QueryDialogflow_1=require(a574_0x90d64b(0x1c2)),CompaniesSettings_1=__importDefault(require(a574_0x90d64b(0x1d1))),CreateLogTicketService_1=__importDefault(require(a574_0x90d64b(0x16a))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ShowService_1=__importDefault(require(a574_0x90d64b(0x1c5))),request=require('request');let i=0x0;setInterval(()=>{i=0x0;},0x1388);const writeFileAsync=(0x0,util_1[a574_0x90d64b(0x16f)])(fs_1[a574_0x90d64b(0x1c0)]);function removeFile(_0x22d409){const _0x1a07e1=a574_0x90d64b;fs_2[_0x1a07e1(0x13e)][_0x1a07e1(0x235)](_0x22d409,_0x102683=>{if(_0x102683)throw _0x102683;});}const getTimestampMessage=_0x4a0c74=>{return _0x4a0c74*0x1;},multVecardGet=function(_0x2d75b7){const _0x10fe29=a574_0x90d64b;let _0x5cb16e='\x20',_0x486182=_0x2d75b7[_0x10fe29(0x201)]('\x0a')[0x2]['replace'](_0x10fe29(0x218),'\x0a')[_0x10fe29(0x167)]('N:','')[_0x10fe29(0x167)](';','')['replace'](';','\x20')[_0x10fe29(0x167)](';;','\x20')[_0x10fe29(0x167)]('\x0a',''),_0x753cd7=_0x2d75b7[_0x10fe29(0x201)]('\x0a')[0x4][_0x10fe29(0x200)]('='),_0x1a4ae8=_0x2d75b7[_0x10fe29(0x201)]('\x0a')[0x4][_0x10fe29(0x200)](':'),_0x55ef6f=_0x2d75b7[_0x10fe29(0x201)]('\x0a')[0x4]['substring'](_0x753cd7+0x1,_0x1a4ae8)[_0x10fe29(0x167)](';',''),_0x580e37=_0x2d75b7[_0x10fe29(0x201)]('\x0a')[0x4][_0x10fe29(0x167)]('item1.TEL:','');if(_0x55ef6f!=_0x10fe29(0x1fe))_0x5cb16e=_0x5cb16e+_0x486182+_0x10fe29(0x264)+_0x55ef6f+''+'\x0a';else _0x5cb16e=_0x5cb16e+_0x486182+_0x10fe29(0x264)+_0x580e37+''+'\x0a';return _0x5cb16e;},contactsArrayMessageGet=_0x689a65=>{const _0x325f9a=a574_0x90d64b;let _0x58783b=_0x689a65[_0x325f9a(0x1fa)]?.['contactsArrayMessage']?.[_0x325f9a(0x18c)],_0x14b2c7=_0x58783b[_0x325f9a(0x237)](function(_0x16a38a,_0x176a8c){const _0x1ba431=_0x325f9a;return _0x16a38a[_0x1ba431(0x1fb)];}),_0x374339='';_0x14b2c7[_0x325f9a(0x13d)](function(_0x5ed903,_0x1bdd1b){_0x374339+=_0x5ed903+'\x0a\x0a'+'';});let _0x24c545=_0x374339[_0x325f9a(0x201)](_0x325f9a(0x274));_0x24c545['shift']();let _0x64c5cb='';for(let _0x1e358c of _0x24c545){_0x64c5cb=_0x64c5cb+multVecardGet(_0x1e358c);}return _0x64c5cb;},getTypeMessage=_0x2e6aa3=>{const _0xcc50d9=a574_0x90d64b,_0x5f220b=(0x0,baileys_1[_0xcc50d9(0x1dc)])(_0x2e6aa3[_0xcc50d9(0x1fa)]);if(_0x2e6aa3[_0xcc50d9(0x1fa)]?.['viewOnceMessageV2'])return _0xcc50d9(0x1ba);return _0x5f220b;};exports[a574_0x90d64b(0x1a9)]=getTypeMessage;const getBodyButton=_0x2837c6=>{const _0xabe7e9=a574_0x90d64b;if(_0x2837c6[_0xabe7e9(0x141)][_0xabe7e9(0x209)]&&_0x2837c6[_0xabe7e9(0x1fa)][_0xabe7e9(0x1d2)]?.['contentText']){let _0x4aa40b=''+_0x2837c6?.[_0xabe7e9(0x1fa)]?.[_0xabe7e9(0x1d2)]?.[_0xabe7e9(0x1f1)];for(const _0x89021c of _0x2837c6[_0xabe7e9(0x1fa)]?.[_0xabe7e9(0x1d2)]?.['buttons']){_0x4aa40b+='\x0a\x0a'+_0x89021c['buttonText']?.[_0xabe7e9(0x217)];}return _0x4aa40b;}if(_0x2837c6[_0xabe7e9(0x141)][_0xabe7e9(0x209)]&&_0x2837c6?.[_0xabe7e9(0x1fa)]?.['viewOnceMessage']?.[_0xabe7e9(0x1fa)]?.['listMessage']){let _0x912f77=''+_0x2837c6?.[_0xabe7e9(0x1fa)]?.[_0xabe7e9(0x20d)]?.[_0xabe7e9(0x1fa)]?.[_0xabe7e9(0x266)]?.[_0xabe7e9(0x277)];for(const _0x1799dc of _0x2837c6['message']?.[_0xabe7e9(0x20d)]?.[_0xabe7e9(0x1fa)]?.[_0xabe7e9(0x266)]?.[_0xabe7e9(0x269)]){for(const _0x46fcea of _0x1799dc['rows']){_0x912f77+='\x0a\x0a'+_0x46fcea['title'];}}return _0x912f77;}},getBodyList=_0x57d2ac=>{const _0x1140a1=a574_0x90d64b;if(_0x57d2ac[_0x1140a1(0x141)]['fromMe']&&_0x57d2ac[_0x1140a1(0x1fa)][_0x1140a1(0x266)]?.[_0x1140a1(0x277)]){let _0x353cd2=''+_0x57d2ac[_0x1140a1(0x1fa)][_0x1140a1(0x266)]?.[_0x1140a1(0x277)];for(const _0x13e75d of _0x57d2ac[_0x1140a1(0x1fa)][_0x1140a1(0x266)]?.[_0x1140a1(0x269)]){for(const _0x1ec5d7 of _0x13e75d[_0x1140a1(0x1f2)]){_0x353cd2+='\x0a\x0a'+_0x1ec5d7['title'];}}return _0x353cd2;}if(_0x57d2ac[_0x1140a1(0x141)][_0x1140a1(0x209)]&&_0x57d2ac?.[_0x1140a1(0x1fa)]?.[_0x1140a1(0x20d)]?.[_0x1140a1(0x1fa)]?.[_0x1140a1(0x266)]){let _0x281e51=''+_0x57d2ac?.['message']?.['viewOnceMessage']?.[_0x1140a1(0x1fa)]?.[_0x1140a1(0x266)]?.[_0x1140a1(0x277)];for(const _0x26aa8e of _0x57d2ac[_0x1140a1(0x1fa)]?.[_0x1140a1(0x20d)]?.['message']?.['listMessage']?.[_0x1140a1(0x269)]){for(const _0x12ae3d of _0x26aa8e['rows']){_0x281e51+='\x0a\x0a'+_0x12ae3d[_0x1140a1(0x1c9)];}}return _0x281e51;}},msgLocation=(_0x597f1b,_0x1d57ff,_0x5b441e)=>{const _0x5cb53a=a574_0x90d64b;if(_0x597f1b){var _0x1c7af0=Buffer[_0x5cb53a(0x26d)](_0x597f1b)['toString']('base64');let _0x23b207=_0x5cb53a(0x156)+_0x1c7af0+_0x5cb53a(0x210)+_0x1d57ff+'%2C'+_0x5b441e+'&z=17&hl=pt-BR|'+_0x1d57ff+',\x20'+_0x5b441e+'\x20';return _0x23b207;}},getBodyMessage=_0x396ef2=>{const _0xa19932=a574_0x90d64b;try{let _0x2eab42=getTypeMessage(_0x396ef2);if(_0x2eab42===undefined)console[_0xa19932(0x19f)](_0x396ef2);const _0xca9ec5={'conversation':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x1d5)],'imageMessage':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x191)]?.[_0xa19932(0x17b)],'videoMessage':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x160)]?.[_0xa19932(0x17b)],'extendedTextMessage':_0x396ef2?.[_0xa19932(0x1fa)]?.[_0xa19932(0x152)]?.['text'],'buttonsResponseMessage':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x1d0)]?.['selectedDisplayText'],'listResponseMessage':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x220)]?.[_0xa19932(0x1c9)]||_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x220)]?.['singleSelectReply']?.[_0xa19932(0x176)],'templateButtonReplyMessage':_0x396ef2[_0xa19932(0x1fa)]?.['templateButtonReplyMessage']?.['selectedId'],'messageContextInfo':_0x396ef2['message']?.['buttonsResponseMessage']?.[_0xa19932(0x1bb)]||_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x220)]?.['title'],'buttonsMessage':getBodyButton(_0x396ef2)||_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x220)]?.[_0xa19932(0x1c9)],'stickerMessage':_0xa19932(0x1cf),'contactMessage':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x1a7)]?.[_0xa19932(0x1fb)],'contactsArrayMessage':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x1dd)]?.[_0xa19932(0x18c)]&&contactsArrayMessageGet(_0x396ef2),'locationMessage':msgLocation(_0x396ef2['message']?.[_0xa19932(0x189)]?.[_0xa19932(0x216)],_0x396ef2['message']?.['locationMessage']?.['degreesLatitude'],_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x189)]?.[_0xa19932(0x19c)]),'liveLocationMessage':_0xa19932(0x14d)+_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x193)]?.['degreesLatitude']+_0xa19932(0x18e)+_0x396ef2['message']?.[_0xa19932(0x193)]?.[_0xa19932(0x19c)],'documentMessage':_0x396ef2['message']?.[_0xa19932(0x148)]?.['caption'],'audioMessage':_0xa19932(0x17e),'listMessage':getBodyList(_0x396ef2)||_0x396ef2['message']?.['listResponseMessage']?.[_0xa19932(0x1c9)],'viewOnceMessage':getBodyButton(_0x396ef2),'reactionMessage':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x153)]?.['text']||_0xa19932(0x174),'senderKeyDistributionMessage':_0x396ef2?.['message']?.[_0xa19932(0x173)]?.[_0xa19932(0x184)],'documentWithCaptionMessage':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x1b3)]?.[_0xa19932(0x1fa)]?.[_0xa19932(0x148)]?.[_0xa19932(0x17b)],'viewOnceMessageV2':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x1ba)]?.[_0xa19932(0x1fa)]?.[_0xa19932(0x191)]?.['caption'],'editedMessage':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x276)]?.[_0xa19932(0x1fa)]?.[_0xa19932(0x152)]?.[_0xa19932(0x24c)],'ephemeralMessage':_0x396ef2[_0xa19932(0x1fa)]?.[_0xa19932(0x223)]?.[_0xa19932(0x1fa)]?.[_0xa19932(0x152)]?.[_0xa19932(0x24c)]},_0x58c8f6=Object[_0xa19932(0x139)](_0xca9ec5)[_0xa19932(0x172)](_0x10e5d0=>_0x10e5d0===_0x2eab42);return!_0x58c8f6&&(logger_1[_0xa19932(0x1f0)][_0xa19932(0x207)](_0xa19932(0x1c1)+_0x2eab42+'\x0a'+JSON['stringify'](_0x396ef2)),Sentry[_0xa19932(0x161)](_0xa19932(0x233),{'BodyMsg':_0x396ef2[_0xa19932(0x1fa)],'msg':_0x396ef2,'type':_0x2eab42}),Sentry[_0xa19932(0x24b)](new Error(_0xa19932(0x16b)))),_0xca9ec5[_0x2eab42];}catch(_0x26c463){Sentry[_0xa19932(0x161)](_0xa19932(0x169),{'msg':_0x396ef2,'BodyMsg':_0x396ef2[_0xa19932(0x1fa)]}),Sentry['captureException'](_0x26c463),console[_0xa19932(0x19f)](_0x26c463);}};exports['getBodyMessage']=getBodyMessage;function a574_0x31ce(_0x14306f,_0x5a6c78){const _0x30f964=a574_0x30f9();return a574_0x31ce=function(_0x31ce02,_0x257f2d){_0x31ce02=_0x31ce02-0x137;let _0x8b8f0e=_0x30f964[_0x31ce02];return _0x8b8f0e;},a574_0x31ce(_0x14306f,_0x5a6c78);}const getQuotedMessage=_0x142970=>{const _0x3cb2c2=a574_0x90d64b,_0x4212e9=(0x0,baileys_1[_0x3cb2c2(0x1e4)])(_0x142970[_0x3cb2c2(0x1fa)])[Object[_0x3cb2c2(0x139)](_0x142970?.[_0x3cb2c2(0x1fa)])[_0x3cb2c2(0x27f)]()[_0x3cb2c2(0x19b)]()[_0x3cb2c2(0x1bd)]];if(!_0x4212e9?.[_0x3cb2c2(0x195)]?.[_0x3cb2c2(0x15b)])return;const _0x578f31=(0x0,baileys_1[_0x3cb2c2(0x1e4)])(_0x4212e9?.['contextInfo']?.['quotedMessage'][Object['keys'](_0x4212e9?.[_0x3cb2c2(0x195)]?.[_0x3cb2c2(0x15b)])[_0x3cb2c2(0x27f)]()['next']()[_0x3cb2c2(0x1bd)]]);return _0x578f31;};exports[a574_0x90d64b(0x1cd)]=getQuotedMessage;const getQuotedMessageId=_0x1c734b=>{const _0x5f102b=a574_0x90d64b,_0x1f5586=(0x0,baileys_1['extractMessageContent'])(_0x1c734b[_0x5f102b(0x1fa)])[Object[_0x5f102b(0x139)](_0x1c734b?.['message'])[_0x5f102b(0x27f)]()[_0x5f102b(0x19b)]()['value']];let _0x2fffcd=_0x1c734b?.[_0x5f102b(0x1fa)]?.[_0x5f102b(0x153)]?_0x1c734b?.[_0x5f102b(0x1fa)]?.[_0x5f102b(0x153)]?.['key']?.['id']:'';return _0x2fffcd?_0x2fffcd:_0x1f5586?.[_0x5f102b(0x195)]?.[_0x5f102b(0x24a)];};exports[a574_0x90d64b(0x1ac)]=getQuotedMessageId;const getMeSocket=_0x1c25d4=>{const _0x584c4f=a574_0x90d64b;return{'id':(0x0,baileys_1[_0x584c4f(0x21b)])(_0x1c25d4[_0x584c4f(0x19a)]['id']),'name':_0x1c25d4[_0x584c4f(0x19a)][_0x584c4f(0x14c)]};},getSenderMessage=(_0xfaeda1,_0xb5230c)=>{const _0x1e015f=a574_0x90d64b,_0x3459a7=getMeSocket(_0xb5230c);if(_0xfaeda1['key'][_0x1e015f(0x209)])return _0x3459a7['id'];const _0x156428=_0xfaeda1['participant']||_0xfaeda1[_0x1e015f(0x141)]['participant']||_0xfaeda1[_0x1e015f(0x141)][_0x1e015f(0x1e9)]||undefined;return _0x156428&&(0x0,baileys_1['jidNormalizedUser'])(_0x156428);},getContactMessage=async(_0x9c3881,_0x493a33)=>{const _0x4155f7=a574_0x90d64b,_0x34008f=_0x9c3881[_0x4155f7(0x141)]['remoteJid'][_0x4155f7(0x213)](_0x4155f7(0x1e2)),_0x53d2f0=_0x9c3881[_0x4155f7(0x141)]['remoteJid'][_0x4155f7(0x167)](/\D/g,'');return _0x34008f?{'id':getSenderMessage(_0x9c3881,_0x493a33),'name':_0x9c3881[_0x4155f7(0x194)]}:{'id':_0x9c3881[_0x4155f7(0x141)][_0x4155f7(0x1e9)],'name':_0x9c3881[_0x4155f7(0x141)][_0x4155f7(0x209)]?_0x53d2f0:_0x9c3881['pushName']};},downloadMedia=async(_0x213931,_0x134649=null)=>{const _0x1817f8=a574_0x90d64b;let _0x52afbe;try{_0x52afbe=await(0x0,baileys_1[_0x1817f8(0x284)])(_0x213931,_0x1817f8(0x1cb),{});}catch(_0x4d9411){_0x134649?console['log']('Falha\x20ao\x20fazer\x20o\x20download\x20de\x20uma\x20mensagem\x20importada,\x20provavelmente\x20a\x20mensagem\x20já\x20não\x20esta\x20mais\x20disponível'):console[_0x1817f8(0x1e6)]('Erro\x20ao\x20baixar\x20mídia:',_0x4d9411);}let _0x27e921=_0x213931[_0x1817f8(0x1fa)]?.[_0x1817f8(0x148)]?.[_0x1817f8(0x27c)]||'';const _0x31d64f=_0x213931[_0x1817f8(0x1fa)]?.[_0x1817f8(0x191)]||_0x213931[_0x1817f8(0x1fa)]?.[_0x1817f8(0x1ea)]||_0x213931['message']?.[_0x1817f8(0x160)]||_0x213931['message']?.[_0x1817f8(0x259)]||_0x213931[_0x1817f8(0x1fa)]?.[_0x1817f8(0x148)]||_0x213931[_0x1817f8(0x1fa)]?.['documentWithCaptionMessage']?.['message']?.[_0x1817f8(0x148)]||_0x213931[_0x1817f8(0x1fa)]?.['extendedTextMessage']?.['contextInfo']?.[_0x1817f8(0x15b)]?.[_0x1817f8(0x191)]||_0x213931[_0x1817f8(0x1fa)]?.['extendedTextMessage']?.[_0x1817f8(0x195)]?.[_0x1817f8(0x15b)]?.[_0x1817f8(0x160)];if(!_0x31d64f)console[_0x1817f8(0x19f)](_0x213931);if(!_0x27e921){const _0xf656a6=_0x31d64f[_0x1817f8(0x26a)]['split']('/')[0x1][_0x1817f8(0x201)](';')[0x0];_0x27e921=new Date()['getTime']()+'.'+_0xf656a6;}else _0x27e921=new Date()[_0x1817f8(0x21e)]()+'_'+_0x27e921;const _0x348e24={'data':_0x52afbe,'mimetype':_0x31d64f[_0x1817f8(0x26a)],'filename':_0x27e921};return _0x348e24;},verifyContact=async(_0x5803b3,_0x4a51e9,_0x42f6c8)=>{const _0x46b25a=a574_0x90d64b;let _0x377ee2;try{_0x377ee2=await _0x4a51e9[_0x46b25a(0x14e)](_0x5803b3['id'],_0x46b25a(0x251));}catch(_0x1e51b3){Sentry[_0x46b25a(0x24b)](_0x1e51b3),_0x377ee2=process[_0x46b25a(0x23e)]['FRONTEND_URL']+'/nopicture.png';}const _0x3cad91={'name':_0x5803b3[_0x46b25a(0x14c)]||_0x5803b3['id']['replace'](/\D/g,''),'number':_0x5803b3['id'][_0x46b25a(0x167)](/\D/g,''),'profilePicUrl':_0x377ee2,'isGroup':_0x5803b3['id'][_0x46b25a(0x213)]('g.us'),'companyId':_0x42f6c8,'remoteJid':_0x5803b3['id']};_0x3cad91[_0x46b25a(0x224)]&&(_0x3cad91['number']=_0x5803b3['id'][_0x46b25a(0x167)](_0x46b25a(0x26e),''));const _0x297373=(0x0,CreateOrUpdateContactService_1['default'])(_0x3cad91);return _0x297373;},verifyQuotedMessage=async _0x46697b=>{const _0x25027b=a574_0x90d64b;if(!_0x46697b)return null;const _0x46dbf6=(0x0,exports[_0x25027b(0x1ac)])(_0x46697b);if(!_0x46dbf6)return null;const _0x88f575=await Message_1['default'][_0x25027b(0x1f4)]({'where':{'wid':_0x46dbf6}});if(!_0x88f575)return null;return _0x88f575;},verifyMediaMessage=async(_0x4635a0,_0x4f5b20,_0x41debd,_0x45a855,_0x17dcbc)=>{const _0x2cabdd=a574_0x90d64b,_0x19a961=(0x0,socket_1[_0x2cabdd(0x150)])(),_0x374775=await verifyQuotedMessage(_0x4635a0),_0xb15420=_0x4f5b20['companyId'];try{const _0x120b73=await downloadMedia(_0x4635a0,_0x4f5b20?.['imported']);if(!_0x120b73&&_0x4f5b20[_0x2cabdd(0x190)]){const _0x7ddf9a=_0x2cabdd(0x227),_0x4f9882={'wid':_0x4635a0[_0x2cabdd(0x141)]['id'],'ticketId':_0x4f5b20['id'],'contactId':_0x4635a0[_0x2cabdd(0x141)][_0x2cabdd(0x209)]?undefined:_0x4f5b20[_0x2cabdd(0x142)],'body':_0x7ddf9a,'reactionMessage':_0x4635a0[_0x2cabdd(0x1fa)]?.[_0x2cabdd(0x153)],'fromMe':_0x4635a0['key'][_0x2cabdd(0x209)],'mediaType':getTypeMessage(_0x4635a0),'read':_0x4635a0[_0x2cabdd(0x141)][_0x2cabdd(0x209)],'quotedMsgId':_0x374775?.['id']||_0x4635a0[_0x2cabdd(0x1fa)]?.['reactionMessage']?.[_0x2cabdd(0x141)]?.['id'],'ack':_0x4635a0[_0x2cabdd(0x1a2)],'companyId':_0xb15420,'remoteJid':_0x4635a0[_0x2cabdd(0x141)][_0x2cabdd(0x1e9)],'participant':_0x4635a0[_0x2cabdd(0x141)]['participant'],'timestamp':getTimestampMessage(_0x4635a0[_0x2cabdd(0x19d)]),'createdAt':new Date(Math[_0x2cabdd(0x273)](getTimestampMessage(_0x4635a0[_0x2cabdd(0x19d)])*0x3e8))[_0x2cabdd(0x1f6)](),'dataJson':JSON['stringify'](_0x4635a0),'ticketImported':_0x4f5b20[_0x2cabdd(0x190)],'isForwarded':_0x17dcbc};return await _0x4f5b20[_0x2cabdd(0x244)]({'lastMessage':_0x7ddf9a}),logger_1['logger']['error'](Error(_0x2cabdd(0x1e1))),(0x0,CreateMessageService_1[_0x2cabdd(0x13e)])({'messageData':_0x4f9882,'companyId':_0xb15420});}if(!_0x120b73)throw new Error(_0x2cabdd(0x1e1));if(!_0x120b73[_0x2cabdd(0x252)]||_0x120b73[_0x2cabdd(0x26a)]==='audio/mp4'){const _0x149d5c=_0x120b73[_0x2cabdd(0x26a)]===_0x2cabdd(0x22c)?_0x2cabdd(0x258):_0x120b73[_0x2cabdd(0x26a)][_0x2cabdd(0x201)]('/')[0x1][_0x2cabdd(0x201)](';')[0x0];_0x120b73['filename']=new Date()[_0x2cabdd(0x21e)]()+'.'+_0x149d5c;}else{const _0x2971b0=_0x120b73['filename'][_0x2cabdd(0x201)]('.')[_0x2cabdd(0x18b)](),_0x29b266=_0x120b73['filename'][_0x2cabdd(0x201)]('.')['slice'](0x0,-0x1)[_0x2cabdd(0x25c)]('.')[_0x2cabdd(0x167)](/\s/g,'_')['normalize']('NFD')[_0x2cabdd(0x167)](/[\u0300-\u036f]/g,'');_0x120b73[_0x2cabdd(0x252)]=_0x29b266[_0x2cabdd(0x214)]()+'_'+new Date()[_0x2cabdd(0x21e)]()+'.'+_0x2971b0;}try{const _0x3ccce8=path_1[_0x2cabdd(0x13e)][_0x2cabdd(0x1c6)](__dirname,'..','..','..','public','company'+_0xb15420);!fs_2[_0x2cabdd(0x13e)][_0x2cabdd(0x14f)](_0x3ccce8)&&(fs_2[_0x2cabdd(0x13e)][_0x2cabdd(0x181)](_0x3ccce8,{'recursive':!![]}),fs_2['default'][_0x2cabdd(0x20b)](_0x3ccce8,0x1ff)),await writeFileAsync((0x0,path_1[_0x2cabdd(0x25c)])(_0x3ccce8,_0x120b73[_0x2cabdd(0x252)]),_0x120b73[_0x2cabdd(0x175)]['toString'](_0x2cabdd(0x265)),'base64');}catch(_0x537e65){Sentry[_0x2cabdd(0x161)](_0x2cabdd(0x281),{'companyId':_0xb15420,'ticket':_0x4f5b20,'contact':_0x41debd,'media':_0x120b73,'quotedMsg':_0x374775}),Sentry[_0x2cabdd(0x24b)](_0x537e65),logger_1[_0x2cabdd(0x1f0)][_0x2cabdd(0x1e6)](_0x537e65),console[_0x2cabdd(0x19f)](_0x4635a0);}const _0x5a2b25=(0x0,exports['getBodyMessage'])(_0x4635a0),_0x1d0ac4={'wid':_0x4635a0['key']['id'],'ticketId':_0x4f5b20['id'],'contactId':_0x4635a0['key'][_0x2cabdd(0x209)]?undefined:_0x41debd['id'],'body':_0x5a2b25||_0x120b73['filename'],'fromMe':_0x4635a0['key'][_0x2cabdd(0x209)],'read':_0x4635a0[_0x2cabdd(0x141)][_0x2cabdd(0x209)],'mediaUrl':_0x120b73[_0x2cabdd(0x252)],'mediaType':_0x120b73[_0x2cabdd(0x26a)][_0x2cabdd(0x201)]('/')[0x0],'quotedMsgId':_0x374775?.['id'],'ack':_0x4635a0[_0x2cabdd(0x1a2)],'remoteJid':_0x4635a0['key'][_0x2cabdd(0x1e9)],'participant':_0x4635a0[_0x2cabdd(0x141)][_0x2cabdd(0x256)],'dataJson':JSON[_0x2cabdd(0x1c3)](_0x4635a0),'ticketTrakingId':_0x45a855?.['id'],'createdAt':new Date(Math[_0x2cabdd(0x273)](getTimestampMessage(_0x4635a0[_0x2cabdd(0x19d)])*0x3e8))[_0x2cabdd(0x1f6)](),'ticketImported':_0x4f5b20[_0x2cabdd(0x190)],'isForwarded':_0x17dcbc};await _0x4f5b20[_0x2cabdd(0x244)]({'lastMessage':_0x5a2b25||_0x120b73[_0x2cabdd(0x252)]});const _0x415bdb=await(0x0,CreateMessageService_1[_0x2cabdd(0x13e)])({'messageData':_0x1d0ac4,'companyId':_0xb15420});return!_0x4635a0[_0x2cabdd(0x141)][_0x2cabdd(0x209)]&&_0x4f5b20[_0x2cabdd(0x1a2)]===_0x2cabdd(0x238)&&(await _0x4f5b20[_0x2cabdd(0x244)]({'status':_0x2cabdd(0x199)}),await _0x4f5b20[_0x2cabdd(0x20c)]({'include':[{'model':Queue_1[_0x2cabdd(0x13e)],'as':_0x2cabdd(0x1a6)},{'model':User_1['default'],'as':'user'},{'model':Contact_1[_0x2cabdd(0x13e)],'as':_0x2cabdd(0x27d)},{'model':Whatsapp_1['default'],'as':_0x2cabdd(0x168)}]}),_0x19a961['to'](_0x4f5b20[_0x2cabdd(0x1a2)])['to'](_0x4f5b20['id']['toString']())[_0x2cabdd(0x242)](_0x2cabdd(0x137)+_0xb15420+_0x2cabdd(0x196),{'action':'update','ticket':_0x4f5b20,'ticketId':_0x4f5b20['id']})),_0x415bdb;}catch(_0x2fc699){console[_0x2cabdd(0x19f)](_0x2fc699),logger_1[_0x2cabdd(0x1f0)][_0x2cabdd(0x207)]('Erro\x20ao\x20baixar\x20media');}};exports[a574_0x90d64b(0x25e)]=verifyMediaMessage;const verifyMessage=async(_0x973bf9,_0xd5df74,_0x2a0209,_0x53a8fb,_0x143f88,_0x4a8aff)=>{const _0x200769=a574_0x90d64b,_0xbc9d2d=(0x0,socket_1[_0x200769(0x150)])(),_0x439b13=await verifyQuotedMessage(_0x973bf9),_0xbba863=(0x0,exports[_0x200769(0x1e5)])(_0x973bf9),_0x541d63=_0xd5df74[_0x200769(0x1d7)],_0x1d3f13={'wid':_0x973bf9[_0x200769(0x141)]['id'],'ticketId':_0xd5df74['id'],'contactId':_0x973bf9[_0x200769(0x141)][_0x200769(0x209)]?undefined:_0x2a0209['id'],'body':_0xbba863,'fromMe':_0x973bf9[_0x200769(0x141)]['fromMe'],'mediaType':getTypeMessage(_0x973bf9),'read':_0x973bf9[_0x200769(0x141)][_0x200769(0x209)],'quotedMsgId':_0x439b13?.['id'],'ack':_0x973bf9[_0x200769(0x1a2)],'remoteJid':_0x973bf9[_0x200769(0x141)]['remoteJid'],'participant':_0x973bf9['key'][_0x200769(0x256)],'dataJson':JSON['stringify'](_0x973bf9),'ticketTrakingId':_0x53a8fb?.['id'],'isPrivate':![],'createdAt':new Date(Math[_0x200769(0x273)](getTimestampMessage(_0x973bf9[_0x200769(0x19d)])*0x3e8))[_0x200769(0x1f6)](),'ticketImported':_0xd5df74['imported'],'isForwarded':_0x4a8aff};await _0xd5df74[_0x200769(0x244)]({'lastMessage':_0xbba863}),await(0x0,CreateMessageService_1[_0x200769(0x13e)])({'messageData':_0x1d3f13,'companyId':_0x541d63}),!_0x973bf9[_0x200769(0x141)][_0x200769(0x209)]&&_0xd5df74[_0x200769(0x1a2)]===_0x200769(0x238)&&(await _0xd5df74['update']({'status':_0x200769(0x199)}),await _0xd5df74[_0x200769(0x20c)]({'include':[{'model':Queue_1['default'],'as':_0x200769(0x1a6)},{'model':User_1['default'],'as':_0x200769(0x19a)},{'model':Contact_1[_0x200769(0x13e)],'as':_0x200769(0x27d)},{'model':Whatsapp_1[_0x200769(0x13e)],'as':'whatsapp'}]}),!_0xd5df74[_0x200769(0x190)]&&_0xbc9d2d['to'](_0xd5df74[_0x200769(0x1a2)])['to'](_0xd5df74['id'][_0x200769(0x18a)]())['emit'](_0x200769(0x137)+_0x541d63+'-ticket',{'action':'update','ticket':_0xd5df74,'ticketId':_0xd5df74['id']}));};exports[a574_0x90d64b(0x1ed)]=verifyMessage;const isValidMsg=_0x315958=>{const _0x2a37dc=a574_0x90d64b;if(_0x315958[_0x2a37dc(0x141)][_0x2a37dc(0x1e9)]===_0x2a37dc(0x253))return![];try{const _0x3ff6be=getTypeMessage(_0x315958);if(!_0x3ff6be)return;const _0x3a4311=_0x3ff6be==='conversation'||_0x3ff6be===_0x2a37dc(0x152)||_0x3ff6be===_0x2a37dc(0x1ea)||_0x3ff6be===_0x2a37dc(0x160)||_0x3ff6be===_0x2a37dc(0x191)||_0x3ff6be===_0x2a37dc(0x148)||_0x3ff6be===_0x2a37dc(0x259)||_0x3ff6be===_0x2a37dc(0x1d0)||_0x3ff6be==='buttonsMessage'||_0x3ff6be==='messageContextInfo'||_0x3ff6be===_0x2a37dc(0x189)||_0x3ff6be===_0x2a37dc(0x193)||_0x3ff6be===_0x2a37dc(0x1a7)||_0x3ff6be==='voiceMessage'||_0x3ff6be===_0x2a37dc(0x1b7)||_0x3ff6be===_0x2a37dc(0x1dd)||_0x3ff6be==='reactionMessage'||_0x3ff6be===_0x2a37dc(0x223)||_0x3ff6be===_0x2a37dc(0x21d)||_0x3ff6be==='listResponseMessage'||_0x3ff6be===_0x2a37dc(0x266)||_0x3ff6be===_0x2a37dc(0x20d)||_0x3ff6be===_0x2a37dc(0x1b3)||_0x3ff6be==='viewOnceMessageV2'||_0x3ff6be===_0x2a37dc(0x276);return!_0x3a4311&&(logger_1[_0x2a37dc(0x1f0)][_0x2a37dc(0x207)]('####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20'+_0x3ff6be+'\x0a'+JSON['stringify'](_0x315958?.[_0x2a37dc(0x1fa)])),Sentry[_0x2a37dc(0x161)](_0x2a37dc(0x233),{'BodyMsg':_0x315958[_0x2a37dc(0x1fa)],'msg':_0x315958,'msgType':_0x3ff6be}),Sentry[_0x2a37dc(0x24b)](new Error(_0x2a37dc(0x178)))),!!_0x3a4311;}catch(_0xed76b7){Sentry[_0x2a37dc(0x161)]('Error\x20isValidMsg',{'msg':_0x315958}),Sentry[_0x2a37dc(0x24b)](_0xed76b7);}};exports[a574_0x90d64b(0x164)]=isValidMsg;const sendDialogflowAwswer=async(_0x369d5f,_0x3cfee7,_0x562451,_0x291021,_0x3170c1,_0x3f0c19,_0x45960e)=>{const _0x1da1d8=a574_0x90d64b,_0xf00a54=await(0x0,CreateSessionDialogflow_1['createDialogflowSessionWithModel'])(_0x45960e);if(_0xf00a54===undefined)return;_0x369d5f['presenceSubscribe'](_0x291021[_0x1da1d8(0x1e9)]),await(0x0,baileys_1[_0x1da1d8(0x240)])(0x1f4);let _0x379d21=await(0x0,QueryDialogflow_1[_0x1da1d8(0x1c4)])(_0xf00a54,_0x45960e['projectName'],_0x291021[_0x1da1d8(0x1e9)],(0x0,exports[_0x1da1d8(0x1e5)])(_0x562451),_0x45960e[_0x1da1d8(0x19e)],_0x3170c1);if(!_0x379d21){_0x369d5f[_0x1da1d8(0x1c7)]('composing',_0x291021['remoteJid']);const _0x1a525f=(0x0,Mustache_1['default'])(_0x1da1d8(0x23c)+_0x45960e?.[_0x1da1d8(0x14c)]+_0x1da1d8(0x1cc));await(0x0,baileys_1['delay'])(0x3e8),await _0x369d5f[_0x1da1d8(0x1c7)]('paused',_0x291021['remoteJid']);const _0x27d442=await _0x369d5f['sendMessage'](_0x291021[_0x1da1d8(0x279)]+_0x1da1d8(0x25f),{'text':_0x1a525f});await(0x0,exports[_0x1da1d8(0x1ed)])(_0x27d442,_0x3cfee7,_0x291021);return;}_0x379d21[_0x1da1d8(0x21f)]&&await _0x3cfee7[_0x1da1d8(0x244)]({'contactId':_0x3cfee7[_0x1da1d8(0x27d)]['id'][_0x1da1d8(0x18a)](),'useIntegration':![]});const _0x371057=_0x379d21[_0x1da1d8(0x25d)]['image']?.['stringValue']??undefined,_0x234520=_0x379d21[_0x1da1d8(0x25d)][_0x1da1d8(0x14a)]?.['stringValue']??undefined,_0x586c03=_0x379d21[_0x1da1d8(0x157)][_0x1da1d8(0x18a)]('base64')??undefined;_0x369d5f[_0x1da1d8(0x1c7)]('composing',_0x291021['remoteJid']),await(0x0,baileys_1[_0x1da1d8(0x240)])(0x1f4);let _0x2aa23a;for(let _0x454010 of _0x379d21[_0x1da1d8(0x255)]){_0x2aa23a=_0x454010[_0x1da1d8(0x24c)][_0x1da1d8(0x24c)][0x0]?_0x454010[_0x1da1d8(0x24c)][_0x1da1d8(0x24c)][0x0]:_0x2aa23a;}for(let _0xa7722c of _0x379d21[_0x1da1d8(0x255)]){_0xa7722c[_0x1da1d8(0x24c)]&&await sendDelayedMessages(_0x369d5f,_0x3cfee7,_0x291021,_0xa7722c[_0x1da1d8(0x24c)]['text'][0x0],_0x2aa23a,_0x586c03,_0x45960e);}};function a574_0x30f9(){const _0x3f9a2=[';;;','moment','hasOwnProperty','jidNormalizedUser','toDate','protocolMessage','getTime','endConversation','listResponseMessage','amountUsedBotQueues','closedAt','ephemeralMessage','isGroup','medias','findByPk','*System:*\x20\x0aFalha\x20no\x20download\x20da\x20mídia\x20verifique\x20no\x20dispositivo','Esta\x20mensagem\x20já\x20existe','parseToMilliseconds','>>>>>>>>>>>>>>>>>>>','‎Opção\x20inválida,\x20tente\x20novamente.\x0a','audio/mp4','public','../../models/User','setMinutes','Menu','count','lgpdSendMessageAt','Mensagem','handleRating','unlink','623808AgtWDD','map','closed',':*\x20','ticketId','../../models/Message','‎\x20*','../../models/Campaign','env','getMessageOptions','delay','set','emit','../UserQueueServices/ListUserQueueServices','update','create','nps','destroy','acceptAudioMessage','configurable','stanzaId','captureException','text','../../models/Contact','contacts:','REVOKE','lgpdAcceptedAt','image','filename','status@broadcast','test','responses','participant','isInteger','m4a','stickerMessage','userId','../TicketServices/UpdateTicketService','join','parameters','verifyMediaMessage','@c.us','Error\x20handling\x20message\x20ack.\x20Err:\x20','Escolha\x20uma\x20opção','application/json','lgpdConsent',':\x20📞','base64','listMessage','../FacebookServices/sendFacebookMessage','path','sections','mimetype','debug','urlN8N','from','@g.us','__importStar','composing','/nopicture.png','handleMessageIntegration','floor','BEGIN:','isNil','editedMessage','description','../../models/Ticket','number','210012cxyfjV','webhook','fileName','contact','entries','values','sequelize','Erro\x20media','@whiskeysockets/baileys','delete','downloadMediaMessage','groupMetadata','chatBotType','verifyRating','findAndCountAll','15qrvIWg','options','../../libs/socket','company-','filter','keys','-appMessage',':unreads','farewellMessage','forEach','default','amountUseBotQueuesNPS','maxUseBotQueuesNPS','key','contactId','add','../MessageServices/CreateMessageService','facebook','messages.upsert','type','documentMessage','getMinutes','react','WAMessageStubType','name','Latitude:\x20','profilePictureUrl','existsSync','getIO','enabled','extendedTextMessage','reactionMessage','get','s.whatsapp.net','data:image/png;base64,\x20','encodedAudio','info','inActivity','wbotMessageListener','quotedMessage','findAll','../CompanyService/VerifyCurrentSchedule','getOwnPropertyDescriptor','queueId','videoMessage','setExtra','2021726mcAbAs','\x0a*[\x20Sair\x20]*\x20-\x20Encerrar\x20atendimento','isValidMsg','lgpdLink','debounce','replace','whatsapp','Error\x20getTypeMessage','../TicketServices/CreateLogTicketService','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20getTypeMessage','messages.update','../../models/Queue','outOfHoursMessage','promisify','__importDefault','enableLGPD','find','senderKeyDistributionMessage','reaction','data','selectedRowId','isNull','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','groups.update','568611eXnfTd','caption','greetingMessage','TIMEOUT_TO_IMPORT_MESSAGE','Áudio','../TicketServices/FindOrCreateTicketService','isForwarded','mkdirSync','__createBinding','endsWith','axolotlSenderKeyDistributionMessage','button','__esModule','33128Ffhfuv','recording','locationMessage','toString','pop','contacts','*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posição\x20na\x20fila\x20de\x20atendimento\x20é:\x20*','\x20-\x20Longitude:\x20','‎Estou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20Não','imported','imageMessage','fileListId','liveLocationMessage','pushName','contextInfo','-ticket','__setModuleDefault','n8n','pending','user','next','degreesLongitude','messageTimestamp','language','log','ratingMessage','push','status','@sentry/node','allowGroup','body','queue','contactMessage','chatbotAt','getTypeMessage','acceptAudioMessageContact','603KwYpLF','getQuotedMessageId','timeUseBotQueues','ratingAt','*[\x20','E2E_DEVICE_CHANGED','greetingMediaAttachment','./ChatBotListener','documentWithCaptionMessage','randomValue','util','../QueueIntegrationServices/ShowQueueIntegrationService','mediaMessage','\x20]*\x20-\x20','lgpd','viewOnceMessageV2','selectedButtonId','defineProperty','value','complationMessage','fileList','writeFile','####\x20Nao\x20achou\x20o\x20type\x20152:\x20','../QueueIntegrationServices/QueryDialogflow','stringify','queryDialogFlow','../FileServices/ShowService','resolve','sendPresenceUpdate','queues','title','./SendWhatsAppMessage','buffer',':*\x20Não\x20consegui\x20entender\x20sua\x20dúvida.','getQuotedMessage','../../helpers/Debounce','sticker','buttonsResponseMessage','../../models/CompaniesSettings','buttonsMessage','readFile','../../helpers/Mustache','conversation','sendQueuePosition','companyId','../ContactServices/CreateOrUpdateContactService','185034PsVAfO','subject','prototype','getContentType','contactsArrayMessage','handleMessage','messages','../../libs/cache','ERR_WAPP_DOWNLOAD_MEDIA','g.us','chatbots','extractMessageContent','getBodyMessage','error','mediaType','7bit','remoteJid','audioMessage','127694zsBVIg','E2E_IDENTITY_CHANGED','verifyMessage','whatsappId','scheduleType','logger','contentText','rows','isNaN','findOne','length','toISOString','integrationId','chatBot','campaignId','message','vcard','lgpdMessage','settingsUserRandom','item1.TEL','company','indexOf','split','processImportMessagesWppId','../WhatsappService/ShowWhatsAppService','sendMessage','connection','../../models/CampaignShipping','warn','open','fromMe','disableBot','chmodSync','reload','viewOnceMessage','maxUseBotQueues','./MarkDeleteWhatsAppMessage','\x20|\x20https://maps.google.com/maps?q=','singleSelectReply','lodash','includes','trim','groupAsTicket','jpegThumbnail','displayText'];a574_0x30f9=function(){return _0x3f9a2;};return a574_0x30f9();}async function sendDelayedMessages(_0xf5f2a7,_0x14ecf0,_0x5e4131,_0x21bb48,_0x5653ae,_0x59f315,_0x10f5ce){const _0x36d889=a574_0x90d64b,_0x2bf245=_0x14ecf0[_0x36d889(0x1d7)],_0x163510=await(0x0,ShowWhatsAppService_1[_0x36d889(0x13e)])(_0xf5f2a7['id'],_0x2bf245),_0x8d8dda=_0x163510[_0x36d889(0x13c)][_0x36d889(0x167)](/[_*]/g,''),_0x16b7e8=await _0xf5f2a7[_0x36d889(0x204)](_0x5e4131[_0x36d889(0x279)]+_0x36d889(0x25f),{'text':_0x36d889(0x23c)+_0x10f5ce?.['name']+_0x36d889(0x239)+_0x21bb48});await(0x0,exports['verifyMessage'])(_0x16b7e8,_0x14ecf0,_0x5e4131);if(_0x21bb48!=_0x5653ae)await(0x0,baileys_1[_0x36d889(0x240)])(0x1f4),_0xf5f2a7[_0x36d889(0x1c7)](_0x36d889(0x270),_0x5e4131[_0x36d889(0x1e9)]);else _0x59f315&&(_0xf5f2a7['sendPresenceUpdate'](_0x36d889(0x188),_0x5e4131[_0x36d889(0x1e9)]),await(0x0,baileys_1[_0x36d889(0x240)])(0x1f4),_0x8d8dda&&_0x21bb48[_0x36d889(0x213)](_0x8d8dda)&&(await(0x0,baileys_1[_0x36d889(0x240)])(0x2710),setTimeout(async()=>{const _0x56f1e2=_0x36d889;await _0x14ecf0['update']({'contactId':_0x14ecf0[_0x56f1e2(0x27d)]['id'][_0x56f1e2(0x18a)](),'useIntegration':!![]}),await(0x0,UpdateTicketService_1['default'])({'ticketId':_0x14ecf0['id'],'ticketData':{'status':_0x56f1e2(0x238)},'companyId':_0x2bf245});},0xbb8)));}const verifyQueue=async(_0xc16d39,_0x25b375,_0x161a13,_0x143835,_0x15c7e4)=>{const _0x440d9c=a574_0x90d64b,_0x5aa399=_0x161a13['companyId'],{queues:_0x27f3f7,greetingMessage:_0x513423,maxUseBotQueues:_0x556503,timeUseBotQueues:_0x6cced1}=await(0x0,ShowWhatsAppService_1[_0x440d9c(0x13e)])(_0xc16d39['id'],_0x5aa399),_0x242598=await(0x0,FindOrCreateATicketTrakingService_1[_0x440d9c(0x13e)])({'ticketId':_0x161a13['id'],'companyId':_0x5aa399,'whatsappId':_0x161a13[_0x440d9c(0x168)]?.['id']});let _0x238295=![];_0x27f3f7['length']===0x1&&(_0x238295=_0x27f3f7[0x0]?.[_0x440d9c(0x1e3)][_0x440d9c(0x1f5)]>0x1);const _0xf9168e=_0x15c7e4[_0x440d9c(0x1d6)]==='enabled';if(_0x27f3f7[_0x440d9c(0x1f5)]===0x1&&!_0x238295){const _0x1f3515=_0x15c7e4['sendGreetingMessageOneQueues']===_0x440d9c(0x151)||![];if(!_0x25b375[_0x440d9c(0x141)][_0x440d9c(0x209)]&&!_0x161a13[_0x440d9c(0x224)]&&_0x27f3f7[0x0]['integrationId']){const _0x2b6b8b=await(0x0,ShowQueueIntegrationService_1[_0x440d9c(0x13e)])(_0x161a13[_0x440d9c(0x1f7)],_0x5aa399);await(0x0,exports[_0x440d9c(0x272)])(_0x25b375,_0xc16d39,_0x5aa399,_0x2b6b8b,_0x161a13),await _0x161a13[_0x440d9c(0x244)]({'useIntegration':!![],'integrationId':_0x2b6b8b['id']});}if(_0x513423[_0x440d9c(0x1f5)]>0x1&&_0x1f3515){const _0x1c3cdd=(0x0,Mustache_1[_0x440d9c(0x13e)])(''+_0x513423,_0x161a13);if(_0x161a13[_0x440d9c(0x168)][_0x440d9c(0x1b1)]!==null){const _0x4c07d1=path_1[_0x440d9c(0x13e)]['resolve'](_0x440d9c(0x22d),_0x440d9c(0x1ff)+_0x5aa399,_0x161a13[_0x440d9c(0x168)][_0x440d9c(0x1b1)]),_0x4b5277=_0x161a13[_0x440d9c(0x168)][_0x440d9c(0x1b1)],_0x23d631=await(0x0,SendWhatsAppMedia_1[_0x440d9c(0x23f)])(_0x4b5277,_0x4c07d1,String(_0x5aa399),_0x1c3cdd),_0x234310=await _0xc16d39[_0x440d9c(0x204)](_0x161a13['contact'][_0x440d9c(0x279)]+'@'+(_0x161a13['isGroup']?_0x440d9c(0x1e2):_0x440d9c(0x155)),{..._0x23d631});await(0x0,exports['verifyMediaMessage'])(_0x234310,_0x161a13,_0x143835,_0x242598);}else await _0xc16d39[_0x440d9c(0x204)](_0x143835[_0x440d9c(0x279)]+'@'+(_0x161a13[_0x440d9c(0x224)]?_0x440d9c(0x1e2):_0x440d9c(0x155)),{'text':_0x1c3cdd});}if(!(0x0,lodash_1[_0x440d9c(0x275)])(_0x27f3f7[0x0][_0x440d9c(0x192)]))try{const _0x3ed0f7=path_1[_0x440d9c(0x13e)]['resolve'](__dirname,'..','..','..',_0x440d9c(0x22d)),_0x4b0b49=await(0x0,ShowService_1[_0x440d9c(0x13e)])(_0x27f3f7[0x0]['fileListId'],_0x161a13[_0x440d9c(0x1d7)]),_0x19596b=path_1['default']['resolve'](_0x3ed0f7,'company'+_0x161a13['companyId'],'fileList',String(_0x4b0b49['id']));for(const [_0x3a2147,_0x57e194]of _0x4b0b49[_0x440d9c(0x28a)][_0x440d9c(0x27e)]()){const _0x18e8ce={'fieldname':_0x440d9c(0x225),'originalname':_0x57e194['path'],'encoding':_0x440d9c(0x1e8),'mimetype':_0x57e194['mediaType'],'filename':_0x57e194[_0x440d9c(0x268)],'path':path_1[_0x440d9c(0x13e)]['resolve'](_0x19596b,_0x57e194[_0x440d9c(0x268)])};await(0x0,SendWhatsAppMedia_1[_0x440d9c(0x13e)])({'media':_0x18e8ce,'ticket':_0x161a13,'body':_0x57e194[_0x440d9c(0x14c)],'isForwarded':![]});};}catch(_0x4a5d5a){logger_1['logger'][_0x440d9c(0x158)](_0x4a5d5a);}if(_0x27f3f7[0x0]['closeTicket']){await(0x0,UpdateTicketService_1[_0x440d9c(0x13e)])({'ticketData':{'status':_0x440d9c(0x238),'queueId':_0x27f3f7[0x0]['id'],'sendFarewellMessage':![]},'ticketId':_0x161a13['id'],'companyId':_0x5aa399});return;}else await(0x0,UpdateTicketService_1[_0x440d9c(0x13e)])({'ticketData':{'queueId':_0x27f3f7[0x0]['id']},'ticketId':_0x161a13['id'],'companyId':_0x5aa399});const _0x307b00=await Ticket_1[_0x440d9c(0x13e)]['findAndCountAll']({'where':{'userId':null,'status':_0x440d9c(0x199),'companyId':_0x5aa399,'queueId':_0x27f3f7[0x0]['id'],'isGroup':![]}});if(_0xf9168e){const _0x29c4d4=_0x307b00[_0x440d9c(0x231)]===0x0?0x1:_0x307b00[_0x440d9c(0x231)],_0x3775b5=_0x440d9c(0x18d)+_0x29c4d4+'*',_0x5df026=(0x0,Mustache_1['default'])(''+_0x3775b5,_0x161a13),_0x24a237=(0x0,Debounce_1[_0x440d9c(0x166)])(async()=>{const _0x575318=_0x440d9c;await _0xc16d39[_0x575318(0x204)](_0x143835['number']+'@'+(_0x161a13['isGroup']?'g.us':'s.whatsapp.net'),{'text':_0x5df026});},0xbb8,_0x161a13['id']);_0x24a237();}return;}if(_0x143835[_0x440d9c(0x20a)])return;let _0x48716b='';if(_0x161a13[_0x440d9c(0x1a2)]!==_0x440d9c(0x1b9))_0x48716b=_0x25b375?.[_0x440d9c(0x1fa)]?.[_0x440d9c(0x1d0)]?.[_0x440d9c(0x1bb)]||_0x25b375?.[_0x440d9c(0x1fa)]?.['listResponseMessage']?.[_0x440d9c(0x211)][_0x440d9c(0x176)]||(0x0,exports[_0x440d9c(0x1e5)])(_0x25b375);else{if(!(0x0,lodash_1[_0x440d9c(0x275)])(_0x161a13[_0x440d9c(0x250)]))await _0x161a13[_0x440d9c(0x244)]({'status':_0x440d9c(0x199)});await _0x161a13[_0x440d9c(0x20c)]();}if(_0x48716b=='Sair'){const _0x4a235e={'isBot':![],'queueId':null,'userId':null,'status':_0x440d9c(0x238),'sendFarewellMessage':![],'maxUseBotQueues':0x0};await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x4a235e,'ticketId':_0x161a13['id'],'companyId':_0x5aa399});const _0x3dfffa=_0x161a13[_0x440d9c(0x168)]?.[_0x440d9c(0x1be)],_0x29cbad={'text':(0x0,Mustache_1['default'])('‎'+_0x3dfffa,_0x161a13)};if(!(0x0,lodash_1[_0x440d9c(0x275)])(_0x3dfffa)){const _0x50ab96=await _0xc16d39['sendMessage'](_0x161a13?.[_0x440d9c(0x27d)]?.[_0x440d9c(0x279)]+'@'+(_0x161a13[_0x440d9c(0x224)]?'g.us':_0x440d9c(0x155)),_0x29cbad);await(0x0,exports[_0x440d9c(0x1ed)])(_0x50ab96,_0x161a13,_0x161a13[_0x440d9c(0x27d)]);}return;}const _0x4bce8d=_0x238295&&_0x27f3f7[_0x440d9c(0x1f5)]===0x1?_0x27f3f7[+_0x48716b]:_0x27f3f7[+_0x48716b-0x1];if(!_0x25b375[_0x440d9c(0x141)][_0x440d9c(0x209)]&&!_0x161a13[_0x440d9c(0x224)]&&_0x4bce8d?.[_0x440d9c(0x1f7)]){const _0x35803f=await(0x0,ShowQueueIntegrationService_1[_0x440d9c(0x13e)])(_0x4bce8d[_0x440d9c(0x1f7)],_0x5aa399);await(0x0,exports[_0x440d9c(0x272)])(_0x25b375,_0xc16d39,_0x5aa399,_0x35803f,_0x161a13),await _0x161a13[_0x440d9c(0x244)]({'useIntegration':!![],'integrationId':_0x35803f['id']});}const _0x542098=_0x15c7e4?.[_0x440d9c(0x286)]||'text';let _0x2c15b3;if(_0x4bce8d)try{const _0x3cbd83=await(0x0,ListUserQueueServices_1['default'])(_0x4bce8d['id']);_0x3cbd83['userId']>-0x1&&(_0x2c15b3=_0x3cbd83[_0x440d9c(0x25a)]);}catch(_0x3e98cf){console[_0x440d9c(0x1e6)](_0x3e98cf);}const _0x9cb604=async()=>{const _0x5a1830=_0x440d9c;if(_0x4bce8d||_0x27f3f7[_0x5a1830(0x1f5)]===0x1&&_0x238295){const _0xa41525=await Queue_1[_0x5a1830(0x13e)][_0x5a1830(0x226)](_0x4bce8d['id']);let _0x35e523;_0x15c7e4?.['scheduleType']==='queue'&&(_0x35e523=await(0x0,VerifyCurrentSchedule_1[_0x5a1830(0x13e)])(_0x5aa399,_0xa41525['id'],0x0));if(_0x15c7e4?.[_0x5a1830(0x1ef)]===_0x5a1830(0x1a6)&&!(0x0,lodash_1[_0x5a1830(0x275)])(_0x35e523)&&(!_0x35e523||_0x35e523[_0x5a1830(0x159)]===![])&&(!_0x161a13['isGroup']||_0x161a13[_0x5a1830(0x168)]?.[_0x5a1830(0x215)]===_0x5a1830(0x151))){const _0x4dda6f=_0xa41525[_0x5a1830(0x16e)];if(_0x4dda6f!==''){const _0x41eb57=(0x0,Mustache_1['default'])(''+_0x4dda6f,_0x161a13),_0x5852d1=(0x0,Debounce_1[_0x5a1830(0x166)])(async()=>{const _0x4471ed=_0x5a1830;await _0xc16d39[_0x4471ed(0x204)](_0x161a13[_0x4471ed(0x27d)][_0x4471ed(0x279)]+'@'+(_0x161a13[_0x4471ed(0x224)]?_0x4471ed(0x1e2):'s.whatsapp.net'),{'text':_0x41eb57});},0x3e8,_0x161a13['id']);_0x5852d1(),await _0x161a13[_0x5a1830(0x244)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x161a13[_0x5a1830(0x221)]+0x1});return;}await _0x161a13[_0x5a1830(0x244)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x161a13[_0x5a1830(0x221)]+0x1});return;}await(0x0,UpdateTicketService_1[_0x5a1830(0x13e)])({'ticketData':{'amountUsedBotQueues':0x0,'queueId':_0x4bce8d['id']},'ticketId':_0x161a13['id'],'companyId':_0x5aa399});if(_0x4bce8d['chatbots'][_0x5a1830(0x1f5)]>0x0&&!_0x161a13[_0x5a1830(0x224)]){let _0x2dbabd='';_0x4bce8d['chatbots'][_0x5a1830(0x13d)]((_0x59f70c,_0x94500c)=>{const _0x33f450=_0x5a1830;_0x2dbabd+=_0x33f450(0x1af)+(_0x94500c+0x1)+'\x20]*\x20-\x20'+_0x59f70c[_0x33f450(0x14c)]+'\x0a';});const _0x1a369e=(0x0,Mustache_1[_0x5a1830(0x13e)])('‎'+_0x4bce8d[_0x5a1830(0x17c)]+'\x0a\x0a'+_0x2dbabd+'\x0a*[\x20#\x20]*\x20Voltar\x20para\x20o\x20menu\x20principal\x0a*[\x20Sair\x20]*\x20Encerrar\x20atendimento',_0x161a13),_0x65d3dc=await _0xc16d39[_0x5a1830(0x204)](_0x143835['number']+'@'+(_0x161a13[_0x5a1830(0x224)]?_0x5a1830(0x1e2):'s.whatsapp.net'),{'text':_0x1a369e});await(0x0,exports[_0x5a1830(0x1ed)])(_0x65d3dc,_0x161a13,_0x143835,_0x242598),_0x15c7e4?.[_0x5a1830(0x1fd)]===_0x5a1830(0x151)&&await(0x0,UpdateTicketService_1[_0x5a1830(0x13e)])({'ticketData':{'userId':_0x2c15b3},'ticketId':_0x161a13['id'],'companyId':_0x5aa399});}if(!_0x4bce8d['chatbots'][_0x5a1830(0x1f5)]&&_0x4bce8d['greetingMessage'][_0x5a1830(0x1f5)]!==0x0){const _0x260343=(0x0,Mustache_1[_0x5a1830(0x13e)])('‎'+_0x4bce8d[_0x5a1830(0x17c)],_0x161a13),_0x376dc1=await _0xc16d39[_0x5a1830(0x204)](_0x143835[_0x5a1830(0x279)]+'@'+(_0x161a13[_0x5a1830(0x224)]?_0x5a1830(0x1e2):_0x5a1830(0x155)),{'text':_0x260343});await(0x0,exports[_0x5a1830(0x1ed)])(_0x376dc1,_0x161a13,_0x143835,_0x242598);}if(!(0x0,lodash_1['isNil'])(_0x4bce8d['fileListId']))try{const _0x22f432=path_1[_0x5a1830(0x13e)][_0x5a1830(0x1c6)](__dirname,'..','..','..','public'),_0x1ddfe6=await(0x0,ShowService_1['default'])(_0x4bce8d[_0x5a1830(0x192)],_0x161a13['companyId']),_0x4d715d=path_1[_0x5a1830(0x13e)][_0x5a1830(0x1c6)](_0x22f432,_0x5a1830(0x1ff)+_0x161a13[_0x5a1830(0x1d7)],_0x5a1830(0x1bf),String(_0x1ddfe6['id']));for(const [_0x4e5bc5,_0x5b6974]of _0x1ddfe6[_0x5a1830(0x28a)][_0x5a1830(0x27e)]()){const _0x12fe99={'fieldname':_0x5a1830(0x225),'originalname':_0x5b6974['path'],'encoding':_0x5a1830(0x1e8),'mimetype':_0x5b6974[_0x5a1830(0x1e7)],'filename':_0x5b6974[_0x5a1830(0x268)],'path':path_1[_0x5a1830(0x13e)][_0x5a1830(0x1c6)](_0x4d715d,_0x5b6974[_0x5a1830(0x268)])};await(0x0,SendWhatsAppMedia_1[_0x5a1830(0x13e)])({'media':_0x12fe99,'ticket':_0x161a13,'body':'‎'+_0x5b6974['name'],'isForwarded':![]});};}catch(_0x260e35){logger_1['logger'][_0x5a1830(0x158)](_0x260e35);}if(_0x4bce8d['closeTicket']){await(0x0,UpdateTicketService_1[_0x5a1830(0x13e)])({'ticketData':{'status':'closed','queueId':_0x4bce8d['id'],'sendFarewellMessage':![]},'ticketId':_0x161a13['id'],'companyId':_0x5aa399}),await(0x0,CreateLogTicketService_1[_0x5a1830(0x13e)])({'ticketId':_0x161a13['id'],'type':_0x5a1830(0x238),'queueId':_0x4bce8d['id']});return;}const _0x1857ae=await Ticket_1['default'][_0x5a1830(0x288)]({'where':{'userId':null,'status':_0x5a1830(0x199),'companyId':_0x5aa399,'queueId':_0x4bce8d['id'],'isGroup':![]}});await(0x0,CreateLogTicketService_1[_0x5a1830(0x13e)])({'ticketId':_0x161a13['id'],'type':_0x5a1830(0x1a6),'queueId':_0x4bce8d['id']});if(_0xf9168e&&!_0x4bce8d[_0x5a1830(0x1e3)][_0x5a1830(0x1f5)]){const _0xd83abb=_0x1857ae[_0x5a1830(0x231)]===0x0?0x1:_0x1857ae['count'],_0x20860a='*Assistente\x20Virtual:*\x0a{{ms}}\x20*{{name}}*,\x20sua\x20posição\x20na\x20fila\x20de\x20atendimento\x20é:\x20*'+_0xd83abb+'*',_0x659559=(0x0,Mustache_1[_0x5a1830(0x13e)])(''+_0x20860a,_0x161a13),_0x4bdc33=(0x0,Debounce_1[_0x5a1830(0x166)])(async()=>{const _0x3c7fa5=_0x5a1830;await _0xc16d39[_0x3c7fa5(0x204)](_0x143835[_0x3c7fa5(0x279)]+'@'+(_0x161a13[_0x3c7fa5(0x224)]?'g.us':_0x3c7fa5(0x155)),{'text':_0x659559});},0xbb8,_0x161a13['id']);_0x4bdc33();}}else{if(_0x161a13[_0x5a1830(0x224)])return;if(_0x556503&&_0x556503!==0x0&&_0x161a13['amountUsedBotQueues']>=_0x556503)return;const _0x26b5b0=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x161a13['id'],'companyId':_0x5aa399});let _0x6270db=new Date(),_0x1b9f72=new Date();if(_0x26b5b0[_0x5a1830(0x1a8)]!==null){_0x6270db['setMinutes'](_0x26b5b0[_0x5a1830(0x1a8)]['getMinutes']()+Number(_0x6cced1));if(_0x26b5b0['chatbotAt']!==null&&_0x1b9f72<_0x6270db&&_0x6cced1!=='0'&&_0x161a13[_0x5a1830(0x221)]!==0x0)return;}await _0x26b5b0[_0x5a1830(0x244)]({'chatbotAt':null});let _0x234b11='';_0x27f3f7[_0x5a1830(0x13d)]((_0x4b0d18,_0x2e98ae)=>{const _0x3caef3=_0x5a1830;_0x234b11+='*[\x20'+(_0x2e98ae+0x1)+_0x3caef3(0x1b8)+_0x4b0d18[_0x3caef3(0x14c)]+'\x0a';}),_0x234b11+=_0x5a1830(0x163);const _0x305080=(0x0,Mustache_1['default'])('‎'+_0x513423+'\x0a\x0a'+_0x234b11,_0x161a13);await(0x0,CreateLogTicketService_1[_0x5a1830(0x13e)])({'ticketId':_0x161a13['id'],'type':_0x5a1830(0x1f8)});if(_0x161a13[_0x5a1830(0x168)]['greetingMediaAttachment']!==null){const _0x4106ec=path_1['default'][_0x5a1830(0x1c6)](_0x5a1830(0x22d),_0x5a1830(0x1ff)+_0x5aa399,_0x161a13['whatsapp'][_0x5a1830(0x1b1)]),_0x1169e3=_0x161a13[_0x5a1830(0x168)][_0x5a1830(0x1b1)],_0x40c1f2=await(0x0,SendWhatsAppMedia_1[_0x5a1830(0x23f)])(_0x1169e3,_0x4106ec,String(_0x5aa399),_0x305080);let _0xab6ef6=await _0xc16d39[_0x5a1830(0x204)](_0x161a13['contact']['number']+'@'+(_0x161a13[_0x5a1830(0x224)]?_0x5a1830(0x1e2):_0x5a1830(0x155)),{..._0x40c1f2});await(0x0,exports[_0x5a1830(0x25e)])(_0xab6ef6,_0x161a13,_0x143835,_0x26b5b0),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x161a13[_0x5a1830(0x221)]+0x1},'ticketId':_0x161a13['id'],'companyId':_0x5aa399});return;}else{const _0x56df63=(0x0,Debounce_1[_0x5a1830(0x166)])(async()=>{const _0x4009fe=_0x5a1830,_0x341beb=await _0xc16d39[_0x4009fe(0x204)](_0x143835['number']+'@'+(_0x161a13[_0x4009fe(0x224)]?_0x4009fe(0x1e2):_0x4009fe(0x155)),{'text':_0x305080});(0x0,exports[_0x4009fe(0x1ed)])(_0x341beb,_0x161a13,_0x143835,_0x26b5b0);},0x3e8,_0x161a13['id']);await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x161a13[_0x5a1830(0x221)]+0x1},'ticketId':_0x161a13['id'],'companyId':_0x5aa399}),_0x56df63();}}},_0x5c22a6=async()=>{const _0xffc5f6=_0x440d9c;if(_0x4bce8d){await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x4bce8d['id']},'ticketId':_0x161a13['id'],'companyId':_0x5aa399});if(_0x4bce8d['chatbots'][_0xffc5f6(0x1f5)]>0x0){const _0x377341=[];_0x4bce8d['chatbots'][_0xffc5f6(0x13d)]((_0x2d734b,_0x3386a6)=>{const _0x5cf036=_0xffc5f6;_0x377341[_0x5cf036(0x1a1)]({'buttonId':''+(_0x3386a6+0x1),'buttonText':{'displayText':_0x2d734b[_0x5cf036(0x14c)]},'type':0x1});});const _0x1fe36c={'text':(0x0,Mustache_1['default'])(''+_0x4bce8d[_0xffc5f6(0x17c)],_0x161a13),'buttons':_0x377341,'headerType':0x4},_0xf49674=await _0xc16d39[_0xffc5f6(0x204)](_0x143835[_0xffc5f6(0x279)]+'@'+(_0x161a13['isGroup']?_0xffc5f6(0x1e2):_0xffc5f6(0x155)),_0x1fe36c);await(0x0,exports[_0xffc5f6(0x1ed)])(_0xf49674,_0x161a13,_0x143835,_0x242598);}if(!_0x4bce8d[_0xffc5f6(0x1e3)][_0xffc5f6(0x1f5)]){const _0x2eb078=(0x0,Mustache_1[_0xffc5f6(0x13e)])(''+_0x4bce8d['greetingMessage'],_0x161a13),_0x1ae660=await _0xc16d39[_0xffc5f6(0x204)](_0x143835[_0xffc5f6(0x279)]+'@'+(_0x161a13[_0xffc5f6(0x224)]?_0xffc5f6(0x1e2):_0xffc5f6(0x155)),{'text':_0x2eb078});await(0x0,exports[_0xffc5f6(0x1ed)])(_0x1ae660,_0x161a13,_0x143835,_0x242598);}}else{const _0xff9a96=[];_0x27f3f7[_0xffc5f6(0x13d)]((_0x1f6659,_0x2b07a5)=>{const _0x3e713f=_0xffc5f6;_0xff9a96[_0x3e713f(0x1a1)]({'buttonId':''+(_0x2b07a5+0x1),'buttonText':{'displayText':_0x1f6659['name']},'type':0x4});});const _0x37b88d={'text':(0x0,Mustache_1[_0xffc5f6(0x13e)])(''+_0x513423,_0x161a13),'footer':'','buttons':_0xff9a96,'headerType':0x4},_0x36d1bb=await _0xc16d39[_0xffc5f6(0x204)](_0x143835[_0xffc5f6(0x279)]+'@'+(_0x161a13[_0xffc5f6(0x224)]?_0xffc5f6(0x1e2):_0xffc5f6(0x155)),_0x37b88d);await(0x0,exports[_0xffc5f6(0x1ed)])(_0x36d1bb,_0x161a13,_0x143835,_0x242598),await(0x0,UpdateTicketService_1[_0xffc5f6(0x13e)])({'ticketData':{'amountUsedBotQueues':_0x161a13[_0xffc5f6(0x221)]+0x1},'ticketId':_0x161a13['id'],'companyId':_0x5aa399});}},_0x4eab9e=async()=>{const _0x415647=_0x440d9c;if(_0x4bce8d){await(0x0,UpdateTicketService_1[_0x415647(0x13e)])({'ticketData':{'queueId':_0x4bce8d['id']},'ticketId':_0x161a13['id'],'companyId':_0x5aa399});if(_0x4bce8d[_0x415647(0x1e3)][_0x415647(0x1f5)]>0x0){const _0xec9649=[];_0x4bce8d[_0x415647(0x1e3)][_0x415647(0x13d)]((_0x292cf7,_0x4f8a05)=>{const _0x3f8e56=_0x415647;_0xec9649[_0x3f8e56(0x1a1)]({'title':_0x292cf7[_0x3f8e56(0x14c)],'rowId':''+(_0x4f8a05+0x1)});});const _0x1dfe32=[{'title':_0x415647(0x230),'rows':_0xec9649}],_0x246f90={'text':(0x0,Mustache_1[_0x415647(0x13e)])(''+_0x4bce8d['greetingMessage'],_0x161a13),'buttonText':_0x415647(0x261),'sections':_0x1dfe32},_0x3ab50e=await _0xc16d39['sendMessage'](_0x143835[_0x415647(0x279)]+'@'+(_0x161a13[_0x415647(0x224)]?'g.us':'s.whatsapp.net'),_0x246f90);await(0x0,exports[_0x415647(0x1ed)])(_0x3ab50e,_0x161a13,_0x143835,_0x242598);}if(!_0x4bce8d['chatbots']['length']){const _0x58d5f1=(0x0,Mustache_1['default'])(''+_0x4bce8d[_0x415647(0x17c)],_0x161a13),_0x49ddf6=await _0xc16d39[_0x415647(0x204)](_0x143835['number']+'@'+(_0x161a13['isGroup']?_0x415647(0x1e2):'s.whatsapp.net'),{'text':_0x58d5f1});await(0x0,exports[_0x415647(0x1ed)])(_0x49ddf6,_0x161a13,_0x143835,_0x242598);}}else{const _0x5b5201=[];_0x27f3f7[_0x415647(0x13d)]((_0x4593ac,_0x2043c9)=>{const _0x151817=_0x415647;_0x5b5201[_0x151817(0x1a1)]({'title':_0x4593ac[_0x151817(0x14c)],'rowId':''+(_0x2043c9+0x1)});});const _0x516702=[{'title':'Menu','rows':_0x5b5201}],_0x401abb={'text':(0x0,Mustache_1['default'])(''+_0x513423,_0x161a13),'buttonText':'Escolha\x20uma\x20opção','sections':_0x516702},_0x42b534=await _0xc16d39['sendMessage'](_0x143835['number']+'@'+(_0x161a13[_0x415647(0x224)]?_0x415647(0x1e2):_0x415647(0x155)),_0x401abb);await(0x0,exports[_0x415647(0x1ed)])(_0x42b534,_0x161a13,_0x143835,_0x242598),await(0x0,UpdateTicketService_1[_0x415647(0x13e)])({'ticketData':{'amountUsedBotQueues':_0x161a13[_0x415647(0x221)]+0x1},'ticketId':_0x161a13['id'],'companyId':_0x5aa399});}};if(_0x542098==='text')return _0x9cb604();if(_0x542098===_0x440d9c(0x185)&&_0x27f3f7['length']>0x3)return _0x9cb604();if(_0x542098==='button'&&_0x27f3f7[_0x440d9c(0x1f5)]<=0x3)return _0x5c22a6();if(_0x542098==='list')return _0x4eab9e();},verifyRating=_0x55df86=>{const _0xc5a717=a574_0x90d64b;if(_0x55df86&&_0x55df86['finishedAt']===null&&_0x55df86[_0xc5a717(0x222)]!==null&&_0x55df86[_0xc5a717(0x25a)]!==null&&_0x55df86[_0xc5a717(0x1ae)]===null)return!![];return![];};exports[a574_0x90d64b(0x287)]=verifyRating;const handleRating=async(_0x4efb5b,_0x3c63a2,_0x249f97)=>{const _0x3d12ee=a574_0x90d64b,_0x47b939=(0x0,socket_1['getIO'])(),_0x4eeb6=_0x3c63a2[_0x3d12ee(0x1d7)],{complationMessage:_0x198413}=await(0x0,ShowWhatsAppService_1[_0x3d12ee(0x13e)])(_0x3c63a2[_0x3d12ee(0x1ee)],_0x4eeb6);let _0x4afc3b=_0x4efb5b;_0x4efb5b<0x0&&(_0x4afc3b=0x0);_0x4efb5b>0xa&&(_0x4afc3b=0xa);await UserRating_1[_0x3d12ee(0x13e)][_0x3d12ee(0x245)]({'ticketId':_0x249f97[_0x3d12ee(0x23a)],'companyId':_0x249f97[_0x3d12ee(0x1d7)],'userId':_0x249f97['userId'],'rate':_0x4afc3b});if(!(0x0,lodash_1[_0x3d12ee(0x275)])(_0x198413)&&_0x198413!==''&&!_0x3c63a2[_0x3d12ee(0x224)]){const _0x2a6481=(0x0,Mustache_1[_0x3d12ee(0x13e)])('‎'+_0x198413,_0x3c63a2);if(_0x3c63a2['channel']===_0x3d12ee(0x168)){const _0x3bb483=await(0x0,SendWhatsAppMessage_1[_0x3d12ee(0x13e)])({'body':_0x2a6481,'ticket':_0x3c63a2});await(0x0,exports[_0x3d12ee(0x1ed)])(_0x3bb483,_0x3c63a2,_0x3c63a2[_0x3d12ee(0x27d)],_0x249f97);}[_0x3d12ee(0x145),'instagram'][_0x3d12ee(0x213)](_0x3c63a2['channel'])&&await(0x0,sendFacebookMessage_1['default'])({'body':_0x2a6481,'ticket':_0x3c63a2});}await _0x3c63a2[_0x3d12ee(0x244)]({'chatbot':null,'status':_0x3d12ee(0x238),'amountUseBotQueuesNPS':0x0}),await(0x0,CreateLogTicketService_1[_0x3d12ee(0x13e)])({'userId':_0x3c63a2['userId'],'queueId':_0x3c63a2[_0x3d12ee(0x15f)],'ticketId':_0x3c63a2['id'],'type':_0x3d12ee(0x238)}),_0x47b939['to']('open')[_0x3d12ee(0x242)]('company-'+_0x4eeb6+_0x3d12ee(0x196),{'action':_0x3d12ee(0x283),'ticket':_0x3c63a2,'ticketId':_0x3c63a2['id']}),_0x47b939['to'](_0x3c63a2[_0x3d12ee(0x1a2)])['to'](_0x3c63a2['id'][_0x3d12ee(0x18a)]())[_0x3d12ee(0x242)](_0x3d12ee(0x137)+_0x4eeb6+_0x3d12ee(0x196),{'action':'update','ticket':_0x3c63a2,'ticketId':_0x3c63a2['id']});};exports['handleRating']=handleRating;const handleMessageIntegration=async(_0x570dd7,_0x4474d9,_0x5e8d9a,_0x2a10b1,_0x43e531)=>{const _0x3c7690=a574_0x90d64b,_0x4acd1f=getTypeMessage(_0x570dd7);if(_0x2a10b1[_0x3c7690(0x147)]===_0x3c7690(0x198)||_0x2a10b1['type']===_0x3c7690(0x27b)){if(_0x2a10b1?.['urlN8N']){const _0x1b81d3={'method':'POST','url':_0x2a10b1?.[_0x3c7690(0x26c)],'headers':{'Content-Type':_0x3c7690(0x262)},'json':_0x570dd7};try{request(_0x1b81d3,function(_0x1a0fb6,_0x3fb061){const _0x320a7c=_0x3c7690;if(_0x1a0fb6)throw new Error(_0x1a0fb6);else console['log'](_0x3fb061[_0x320a7c(0x1a5)]);});}catch(_0x4a8c36){throw new Error(_0x4a8c36);}}}else{if(_0x2a10b1[_0x3c7690(0x147)]==='dialogflow'){let _0x320039;if(_0x4acd1f==='audioMessage'){let _0xc3fc04=_0x570dd7[_0x3c7690(0x19d)]+'.ogg';(0x0,fs_1[_0x3c7690(0x1d3)])((0x0,path_1[_0x3c7690(0x25c)])(__dirname,'..','..','..',_0x3c7690(0x22d),'company'+_0x5e8d9a,_0xc3fc04),_0x3c7690(0x265),(_0x78ef52,_0x18cf17)=>{const _0x2adfd2=_0x3c7690;_0x320039=_0x18cf17,_0x78ef52&&logger_1[_0x2adfd2(0x1f0)]['error'](_0x78ef52);});}else _0x320039=undefined;const _0x405dad=(0x0,Debounce_1['debounce'])(async()=>{const _0x14a25a=_0x3c7690;await sendDialogflowAwswer(_0x4474d9,_0x43e531,_0x570dd7,_0x43e531[_0x14a25a(0x27d)],_0x320039,_0x5e8d9a,_0x2a10b1);},0x1f4,_0x43e531['id']);_0x405dad();}else{if(_0x2a10b1[_0x3c7690(0x147)]==='typebot'){}}}};exports['handleMessageIntegration']=handleMessageIntegration;const handleMessage=async(_0x41b9eb,_0x301e77,_0xce6d2c,_0x1b432c=![])=>{const _0x430a60=a574_0x90d64b;if(_0x1b432c){(0x0,addLogs_1['addLogs'])({'fileName':_0x430a60(0x202)+_0x301e77['id']+'.txt','text':'Importando\x20Mensagem:\x20'+JSON[_0x430a60(0x1c3)](_0x41b9eb,null,0x2)+_0x430a60(0x22a)});let _0x1b1827=_0x41b9eb['key']['id'],_0x330d16=await Message_1[_0x430a60(0x13e)][_0x430a60(0x1f4)]({'where':{'wid':_0x1b1827}});if(_0x330d16){await new Promise(_0x432140=>setTimeout(_0x432140,0x96)),console[_0x430a60(0x19f)](_0x430a60(0x228));return;}else await new Promise(_0xf66bfe=>setTimeout(_0xf66bfe,parseInt(process[_0x430a60(0x23e)][_0x430a60(0x17d)])||0x14a));}else await new Promise(_0x557565=>setTimeout(_0x557565,i*0x28a)),i++;if(!isValidMsg(_0x41b9eb))return;try{let _0x3c3bad,_0x3a9b87,_0x4c8edf=0x0,_0x3b49ee=0x0,_0x5d04ed=0x0,_0x1350e0=(0x0,exports[_0x430a60(0x1e5)])(_0x41b9eb);const _0x29a865=getTypeMessage(_0x41b9eb);if(_0x29a865==='protocolMessage')return;const _0x1464fb=_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x1ea)]||_0x41b9eb['message']?.[_0x430a60(0x191)]||_0x41b9eb['message']?.[_0x430a60(0x160)]||_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x148)]||_0x41b9eb[_0x430a60(0x1fa)]['stickerMessage']||_0x41b9eb?.['message']?.[_0x430a60(0x223)]?.[_0x430a60(0x1fa)]?.[_0x430a60(0x191)]||_0x41b9eb?.[_0x430a60(0x1fa)]?.[_0x430a60(0x223)]?.[_0x430a60(0x1fa)]?.[_0x430a60(0x1ea)]||_0x41b9eb?.[_0x430a60(0x1fa)]?.['ephemeralMessage']?.[_0x430a60(0x1fa)]?.[_0x430a60(0x160)]||_0x41b9eb?.[_0x430a60(0x1fa)]?.[_0x430a60(0x223)]?.['message']?.['documentMessage']||_0x41b9eb?.['message']?.[_0x430a60(0x223)]?.[_0x430a60(0x1fa)]?.[_0x430a60(0x259)]||_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x20d)]?.[_0x430a60(0x1fa)]?.[_0x430a60(0x191)]||_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x20d)]?.[_0x430a60(0x1fa)]?.['videoMessage']||_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x223)]?.['message']?.[_0x430a60(0x20d)]?.[_0x430a60(0x1fa)]?.[_0x430a60(0x191)]||_0x41b9eb['message']?.[_0x430a60(0x223)]?.[_0x430a60(0x1fa)]?.['viewOnceMessage']?.[_0x430a60(0x1fa)]?.['videoMessage']||_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x1b3)]?.[_0x430a60(0x1fa)]?.[_0x430a60(0x148)];if(_0x41b9eb['key'][_0x430a60(0x209)]){if(/\u200e/[_0x430a60(0x254)](_0x1350e0))return;if(!_0x1464fb&&_0x29a865!==_0x430a60(0x1d5)&&_0x29a865!==_0x430a60(0x152)&&_0x29a865!==_0x430a60(0x1a7)&&_0x29a865!==_0x430a60(0x153)&&_0x29a865!=='ephemeralMessage'&&_0x29a865!==_0x430a60(0x21d)&&_0x29a865!=='viewOnceMessage'&&_0x29a865!==_0x430a60(0x276))return;_0x3c3bad=await getContactMessage(_0x41b9eb,_0x301e77);}else _0x3c3bad=await getContactMessage(_0x41b9eb,_0x301e77);const _0x3fdcd1=_0x41b9eb['key'][_0x430a60(0x1e9)]?.[_0x430a60(0x183)](_0x430a60(0x26e)),_0x317121=await(0x0,ShowWhatsAppService_1[_0x430a60(0x13e)])(_0x301e77['id'],_0xce6d2c);if(!_0x317121[_0x430a60(0x1a4)]&&_0x3fdcd1)return;if(_0x3fdcd1){const _0x5c23a9=await _0x301e77[_0x430a60(0x285)](_0x41b9eb[_0x430a60(0x141)][_0x430a60(0x1e9)]),_0x455e0f={'id':_0x5c23a9['id'],'name':_0x5c23a9[_0x430a60(0x1da)]};_0x3a9b87=await verifyContact(_0x455e0f,_0x301e77,_0xce6d2c);}const _0x447618=await verifyContact(_0x3c3bad,_0x301e77,_0xce6d2c);let _0x198fe1=0x0,_0x4f6785=null;if(_0x41b9eb[_0x430a60(0x141)][_0x430a60(0x209)])await cache_1['default'][_0x430a60(0x241)](_0x430a60(0x24e)+_0x447618['id']+_0x430a60(0x13b),'0');else{const _0x26c90f=await cache_1[_0x430a60(0x13e)][_0x430a60(0x154)](_0x430a60(0x24e)+_0x447618['id']+_0x430a60(0x13b));_0x198fe1=+_0x26c90f+0x1,await cache_1[_0x430a60(0x13e)]['set'](_0x430a60(0x24e)+_0x447618['id']+_0x430a60(0x13b),''+_0x198fe1);}const _0x541c54=await CompaniesSettings_1[_0x430a60(0x13e)][_0x430a60(0x1f4)]({'where':{'companyId':_0xce6d2c}}),_0x1db32f=_0x541c54[_0x430a60(0x171)]===_0x430a60(0x151),{ticket:_0x2bba72,isCreated:_0x67fef3}=await(0x0,FindOrCreateTicketService_1[_0x430a60(0x13e)])(_0x447618,_0x317121,_0x198fe1,_0xce6d2c,_0x4c8edf,_0x5d04ed,_0x3a9b87,_0x430a60(0x168),_0x1b432c,![],_0x541c54);_0x4f6785=_0x2bba72;if(_0x4f6785[_0x430a60(0x1a2)]===_0x430a60(0x238)||_0x198fe1===0x0&&_0x317121[_0x430a60(0x1be)]&&(0x0,Mustache_1[_0x430a60(0x13e)])(_0x317121['complationMessage'],_0x4f6785)===_0x1350e0)return;if(!_0x41b9eb[_0x430a60(0x141)][_0x430a60(0x209)]&&_0x317121?.[_0x430a60(0x1f7)]>0x0){const _0x48c2a7=await(0x0,ShowQueueIntegrationService_1[_0x430a60(0x13e)])(_0x317121['integrationId'],_0xce6d2c);await(0x0,exports['handleMessageIntegration'])(_0x41b9eb,_0x301e77,_0xce6d2c,_0x48c2a7,_0x4f6785),await _0x4f6785[_0x430a60(0x244)]({'useIntegration':!![],'integrationId':_0x48c2a7['id']});}if(_0x29a865==='editedMessage'){const _0x36634c=_0x41b9eb['message']['editedMessage'][_0x430a60(0x1fa)][_0x430a60(0x21d)]['key']['id'],_0x5ad4d5=_0x41b9eb[_0x430a60(0x1fa)]['editedMessage'][_0x430a60(0x1fa)]['protocolMessage'][_0x430a60(0x276)][_0x430a60(0x1d5)],_0x5dfc07=(0x0,socket_1['getIO'])();try{const _0x14a5a2=await Message_1['default'][_0x430a60(0x1f4)]({'where':{'wid':_0x36634c,'companyId':_0xce6d2c,'ticketId':_0x4f6785['id']}});if(!_0x14a5a2)return;await _0x14a5a2['update']({'isEdited':!![],'body':_0x5ad4d5}),await _0x4f6785[_0x430a60(0x244)]({'lastMessage':_0x5ad4d5}),_0x5dfc07['to'](_0x14a5a2['ticketId'][_0x430a60(0x18a)]())[_0x430a60(0x242)](_0x430a60(0x137)+_0x14a5a2[_0x430a60(0x1d7)]+_0x430a60(0x13a),{'action':'update','message':_0x14a5a2});}catch(_0x1485eb){Sentry[_0x430a60(0x24b)](_0x1485eb),logger_1['logger'][_0x430a60(0x1e6)](_0x430a60(0x260)+_0x1485eb);}return;}const _0x2b9a82=await(0x0,FindOrCreateATicketTrakingService_1[_0x430a60(0x13e)])({'ticketId':_0x4f6785['id'],'companyId':_0xce6d2c,'whatsappId':_0x317121?.['id']});try{if(!_0x41b9eb[_0x430a60(0x141)][_0x430a60(0x209)]){if(_0x4f6785[_0x430a60(0x1a2)]===_0x430a60(0x246)&&_0x2b9a82!==null&&(0x0,exports[_0x430a60(0x287)])(_0x2b9a82)){if(!isNaN(parseFloat(_0x1350e0))){(0x0,exports[_0x430a60(0x234)])(parseFloat(_0x1350e0),_0x4f6785,_0x2b9a82),await _0x2b9a82['update']({'ratingAt':(0x0,moment_1[_0x430a60(0x13e)])()[_0x430a60(0x21c)](),'finishedAt':(0x0,moment_1[_0x430a60(0x13e)])()[_0x430a60(0x21c)](),'rated':!![]});return;}else{if(_0x4f6785[_0x430a60(0x13f)]<_0x317121[_0x430a60(0x140)]){let _0x1b600f=_0x430a60(0x22b);const _0x40d034=await _0x301e77[_0x430a60(0x204)](_0x4f6785[_0x430a60(0x27d)][_0x430a60(0x279)]+'@'+(_0x4f6785['isGroup']?_0x430a60(0x1e2):_0x430a60(0x155)),{'text':_0x1b600f});(0x0,exports[_0x430a60(0x1ed)])(_0x40d034,_0x4f6785,_0x447618,_0x2b9a82),await(0x0,baileys_1['delay'])(0x3e8);let _0x359b3a='‎'+_0x317121[_0x430a60(0x1a0)]+'\x0a';const _0x12b73e=await(0x0,SendWhatsAppMessage_1[_0x430a60(0x13e)])({'body':_0x359b3a,'ticket':_0x4f6785});await(0x0,exports['verifyMessage'])(_0x12b73e,_0x4f6785,_0x4f6785[_0x430a60(0x27d)]),await _0x4f6785[_0x430a60(0x244)]({'amountUseBotQueuesNPS':_0x4f6785[_0x430a60(0x13f)]+0x1});}return;}}if(_0x1db32f&&_0x4f6785[_0x430a60(0x1a2)]===_0x430a60(0x1b9)&&!_0x1b432c){if((0x0,lodash_1[_0x430a60(0x275)])(_0x4f6785[_0x430a60(0x250)])&&!(0x0,lodash_1[_0x430a60(0x275)])(_0x4f6785[_0x430a60(0x232)])){let _0x4872e8=null;_0x41b9eb?.[_0x430a60(0x1fa)]?.[_0x430a60(0x1d5)]&&(_0x4872e8=~~+_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x1d5)]);if(!Number[_0x430a60(0x1f3)](_0x4872e8)&&Number[_0x430a60(0x257)](_0x4872e8)&&!(0x0,lodash_1[_0x430a60(0x177)])(_0x4872e8)&&_0x4872e8>0x0){if(_0x4872e8===0x1)await _0x447618[_0x430a60(0x244)]({'lgpdAcceptedAt':(0x0,moment_1['default'])()[_0x430a60(0x21c)]()}),await _0x4f6785[_0x430a60(0x244)]({'lgpdAcceptedAt':(0x0,moment_1['default'])()[_0x430a60(0x21c)](),'amountUsedBotQueues':0x0});else{if(_0x4872e8===0x2){if(_0x317121[_0x430a60(0x1be)]!==''&&_0x317121[_0x430a60(0x1be)]!==undefined){const _0x1f41b4=await _0x301e77[_0x430a60(0x204)](_0x4f6785[_0x430a60(0x27d)][_0x430a60(0x279)]+'@'+(_0x4f6785['isGroup']?_0x430a60(0x1e2):_0x430a60(0x155)),{'text':'‎'+_0x317121[_0x430a60(0x1be)]});(0x0,exports[_0x430a60(0x1ed)])(_0x1f41b4,_0x4f6785,_0x447618,_0x2b9a82);}await _0x4f6785[_0x430a60(0x244)]({'status':_0x430a60(0x238),'amountUsedBotQueues':0x0}),await _0x2b9a82[_0x430a60(0x247)];return;}else _0x4f6785['amountUsedBotQueues']<_0x317121[_0x430a60(0x20e)]&&await _0x4f6785[_0x430a60(0x244)]({'amountUsedBotQueues':_0x4f6785[_0x430a60(0x221)]+0x1,'lgpdSendMessageAt':null});}}else _0x4f6785[_0x430a60(0x221)]<_0x317121[_0x430a60(0x20e)]&&await _0x4f6785[_0x430a60(0x244)]({'amountUsedBotQueues':_0x4f6785['amountUsedBotQueues']+0x1,'lgpdSendMessageAt':null});}if((_0x447618['lgpdAcceptedAt']===null||_0x541c54?.[_0x430a60(0x263)]===_0x430a60(0x151))&&!_0x447618[_0x430a60(0x224)]&&(0x0,lodash_1[_0x430a60(0x275)])(_0x4f6785['lgpdSendMessageAt'])&&_0x4f6785[_0x430a60(0x221)]<=_0x317121[_0x430a60(0x20e)]&&!(0x0,lodash_1[_0x430a60(0x275)])(_0x541c54?.[_0x430a60(0x1fc)])){_0x1464fb?await(0x0,exports[_0x430a60(0x25e)])(_0x41b9eb,_0x4f6785,_0x447618):await(0x0,exports[_0x430a60(0x1ed)])(_0x41b9eb,_0x4f6785,_0x447618,_0x2b9a82);if(!(0x0,lodash_1['isNil'])(_0x541c54?.[_0x430a60(0x1fc)])&&_0x541c54[_0x430a60(0x1fc)]!==''){const _0x7b87c5=(0x0,Mustache_1[_0x430a60(0x13e)])('‎'+_0x541c54?.[_0x430a60(0x1fc)],_0x4f6785),_0x3b040e=await _0x301e77[_0x430a60(0x204)](_0x4f6785[_0x430a60(0x27d)][_0x430a60(0x279)]+'@'+(_0x4f6785[_0x430a60(0x224)]?_0x430a60(0x1e2):'s.whatsapp.net'),{'text':_0x7b87c5});(0x0,exports[_0x430a60(0x1ed)])(_0x3b040e,_0x4f6785,_0x447618,_0x2b9a82);}await(0x0,baileys_1[_0x430a60(0x240)])(0x3e8);if(!(0x0,lodash_1[_0x430a60(0x275)])(_0x541c54?.[_0x430a60(0x165)])&&_0x541c54?.[_0x430a60(0x165)]!==''){const _0x42fb58=(0x0,Mustache_1[_0x430a60(0x13e)])('‎'+_0x541c54?.['lgpdLink'],_0x4f6785),_0x52d5e0=await _0x301e77[_0x430a60(0x204)](_0x4f6785[_0x430a60(0x27d)][_0x430a60(0x279)]+'@'+(_0x4f6785['isGroup']?_0x430a60(0x1e2):_0x430a60(0x155)),{'text':_0x42fb58});await(0x0,exports['verifyMessage'])(_0x52d5e0,_0x4f6785,_0x447618,_0x2b9a82);};await(0x0,baileys_1[_0x430a60(0x240)])(0x3e8);const _0x45d17f=(0x0,Mustache_1[_0x430a60(0x13e)])(_0x430a60(0x18f),_0x4f6785),_0x5ab3d3=await _0x301e77['sendMessage'](_0x4f6785[_0x430a60(0x27d)][_0x430a60(0x279)]+'@'+(_0x4f6785[_0x430a60(0x224)]?_0x430a60(0x1e2):_0x430a60(0x155)),{'text':_0x45d17f});await(0x0,exports[_0x430a60(0x1ed)])(_0x5ab3d3,_0x4f6785,_0x447618,_0x2b9a82),await _0x4f6785[_0x430a60(0x244)]({'lgpdSendMessageAt':(0x0,moment_1[_0x430a60(0x13e)])()[_0x430a60(0x21c)](),'amountUsedBotQueues':_0x4f6785[_0x430a60(0x221)]+0x1}),await _0x4f6785[_0x430a60(0x20c)]();return;};if(!(0x0,lodash_1[_0x430a60(0x275)])(_0x4f6785[_0x430a60(0x232)])&&(0x0,lodash_1[_0x430a60(0x275)])(_0x4f6785[_0x430a60(0x250)]))return;}}}catch(_0x15fcde){Sentry[_0x430a60(0x24b)](_0x15fcde),console['log'](_0x15fcde);}const _0x47a0b6=_0x41b9eb[_0x430a60(0x1fa)]?.['extendedTextMessage']?.[_0x430a60(0x195)]?.[_0x430a60(0x180)]||_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x191)]?.['contextInfo']?.[_0x430a60(0x180)]||_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x1ea)]?.[_0x430a60(0x195)]?.['isForwarded']||_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x160)]?.[_0x430a60(0x195)]?.[_0x430a60(0x180)]||_0x41b9eb[_0x430a60(0x1fa)]?.[_0x430a60(0x148)]?.['contextInfo']?.[_0x430a60(0x180)];_0x1464fb?await(0x0,exports[_0x430a60(0x25e)])(_0x41b9eb,_0x4f6785,_0x447618,_0x2b9a82,_0x47a0b6):await(0x0,exports[_0x430a60(0x1ed)])(_0x41b9eb,_0x4f6785,_0x447618,_0x2b9a82,![],_0x47a0b6);try{await _0x4f6785[_0x430a60(0x244)]({'fromMe':_0x41b9eb[_0x430a60(0x141)][_0x430a60(0x209)]});}catch(_0x5e443f){Sentry['captureException'](_0x5e443f),console[_0x430a60(0x19f)](_0x5e443f);}let _0x1b2f09;if(_0x541c54['scheduleType']===_0x430a60(0x1ff))_0x1b2f09=await(0x0,VerifyCurrentSchedule_1['default'])(_0xce6d2c,0x0,0x0);else _0x541c54[_0x430a60(0x1ef)]===_0x430a60(0x205)&&(_0x1b2f09=await(0x0,VerifyCurrentSchedule_1[_0x430a60(0x13e)])(_0xce6d2c,0x0,_0x317121['id']));try{if(!_0x41b9eb[_0x430a60(0x141)][_0x430a60(0x209)]&&_0x541c54['scheduleType']&&(!_0x4f6785[_0x430a60(0x224)]||_0x317121[_0x430a60(0x215)]===_0x430a60(0x151))){if((_0x541c54[_0x430a60(0x1ef)]===_0x430a60(0x1ff)||_0x541c54[_0x430a60(0x1ef)]===_0x430a60(0x205))&&!(0x0,lodash_1[_0x430a60(0x275)])(_0x1b2f09)&&(!_0x1b2f09||_0x1b2f09[_0x430a60(0x159)]===![])){_0x2b9a82[_0x430a60(0x1a8)]===null&&await _0x2b9a82[_0x430a60(0x244)]({'chatbotAt':(0x0,moment_1[_0x430a60(0x13e)])()[_0x430a60(0x21c)]()});if(_0x317121[_0x430a60(0x20e)]&&_0x317121['maxUseBotQueues']!==0x0&&_0x4f6785[_0x430a60(0x221)]>=_0x317121[_0x430a60(0x20e)])return;let _0x554494=new Date(),_0x480680=new Date();if(_0x2b9a82['chatbotAt']!==null){_0x554494[_0x430a60(0x22f)](_0x2b9a82[_0x430a60(0x1a8)][_0x430a60(0x149)]()+Number(_0x317121[_0x430a60(0x1ad)]));if(_0x2b9a82[_0x430a60(0x1a8)]!==null&&_0x480680<_0x554494&&_0x317121[_0x430a60(0x1ad)]!=='0'&&_0x4f6785[_0x430a60(0x221)]!==0x0)return;}await _0x2b9a82[_0x430a60(0x244)]({'chatbotAt':null});if(_0x317121[_0x430a60(0x16e)]!==''){const _0x275ed0=(0x0,Mustache_1[_0x430a60(0x13e)])(''+_0x317121[_0x430a60(0x16e)],_0x4f6785),_0x4c5b52=(0x0,Debounce_1[_0x430a60(0x166)])(async()=>{const _0x175c97=_0x430a60;await _0x301e77[_0x175c97(0x204)](_0x4f6785[_0x175c97(0x27d)][_0x175c97(0x279)]+'@'+(_0x4f6785['isGroup']?_0x175c97(0x1e2):_0x175c97(0x155)),{'text':_0x275ed0});},0x3e8,_0x4f6785['id']);_0x4c5b52(),await _0x4f6785['update']({'isOutOfHour':!![],'amountUsedBotQueues':_0x4f6785[_0x430a60(0x221)]+0x1});return;}await _0x4f6785['update']({'isOutOfHour':!![],'amountUsedBotQueues':_0x4f6785[_0x430a60(0x221)]+0x1});return;}}}catch(_0x3f9abc){Sentry[_0x430a60(0x24b)](_0x3f9abc),console[_0x430a60(0x19f)](_0x3f9abc);}if(!_0x41b9eb[_0x430a60(0x141)]['fromMe']&&(!_0x4f6785[_0x430a60(0x224)]||_0x317121[_0x430a60(0x215)]===_0x430a60(0x151))&&_0x4f6785[_0x430a60(0x1a6)]&&_0x4f6785['integrationId']&&_0x4f6785['useIntegration']){const _0x1f7659=await(0x0,ShowQueueIntegrationService_1[_0x430a60(0x13e)])(_0x4f6785[_0x430a60(0x1f7)],_0xce6d2c);await(0x0,exports[_0x430a60(0x272)])(_0x41b9eb,_0x301e77,_0xce6d2c,_0x1f7659,_0x4f6785);return;}!_0x4f6785[_0x430a60(0x190)]&&!_0x4f6785['queue']&&(!_0x4f6785[_0x430a60(0x224)]||_0x317121[_0x430a60(0x215)]===_0x430a60(0x151))&&!_0x41b9eb[_0x430a60(0x141)][_0x430a60(0x209)]&&!_0x4f6785['userId']&&_0x317121[_0x430a60(0x1c8)]['length']>=0x1&&(await verifyQueue(_0x301e77,_0x41b9eb,_0x4f6785,_0x447618,_0x541c54),_0x2b9a82['chatbotAt']===null&&await _0x2b9a82['update']({'chatbotAt':(0x0,moment_1[_0x430a60(0x13e)])()[_0x430a60(0x21c)]()}));_0x4f6785[_0x430a60(0x15f)]>0x0&&await _0x2b9a82[_0x430a60(0x244)]({'queueId':_0x4f6785['queueId']});if((getTypeMessage(_0x41b9eb)===_0x430a60(0x1ea)||getTypeMessage(_0x41b9eb)===_0x430a60(0x160))&&!_0x41b9eb[_0x430a60(0x141)][_0x430a60(0x209)]&&(!_0x4f6785[_0x430a60(0x224)]||_0x317121[_0x430a60(0x215)]===_0x430a60(0x151))&&(!_0x447618?.[_0x430a60(0x248)]||_0x541c54?.[_0x430a60(0x1aa)]==='disabled')){const _0x5c2c2b=await _0x301e77[_0x430a60(0x204)](_0x447618[_0x430a60(0x279)]+_0x430a60(0x25f),{'text':'‎*Assistente\x20Virtual*:\x0aInfelizmente\x20não\x20conseguimos\x20escutar\x20nem\x20enviar\x20áudios\x20por\x20este\x20canal\x20de\x20atendimento,\x20por\x20favor,\x20envie\x20uma\x20mensagem\x20de\x20*texto*.'},{'quoted':{'key':_0x41b9eb[_0x430a60(0x141)],'message':{'extendedTextMessage':_0x41b9eb[_0x430a60(0x1fa)][_0x430a60(0x152)]}}});await(0x0,exports[_0x430a60(0x1ed)])(_0x5c2c2b,_0x4f6785,_0x447618,_0x2b9a82);}try{if(!_0x41b9eb[_0x430a60(0x141)][_0x430a60(0x209)]&&_0x541c54?.['scheduleType']&&_0x4f6785[_0x430a60(0x15f)]!==null&&(!_0x4f6785['isGroup']||_0x317121[_0x430a60(0x215)]===_0x430a60(0x151))){const _0xf9a069=await Queue_1[_0x430a60(0x13e)][_0x430a60(0x226)](_0x4f6785[_0x430a60(0x15f)]);_0x541c54?.[_0x430a60(0x1ef)]===_0x430a60(0x1a6)&&(_0x1b2f09=await(0x0,VerifyCurrentSchedule_1[_0x430a60(0x13e)])(_0xce6d2c,_0xf9a069['id'],0x0));if(_0x541c54?.['scheduleType']===_0x430a60(0x1a6)&&!(0x0,lodash_1[_0x430a60(0x275)])(_0x1b2f09)&&(!_0x1b2f09||_0x1b2f09[_0x430a60(0x159)]===![])){const _0x1c4c04=_0xf9a069[_0x430a60(0x16e)];if(_0x1c4c04!==''){const _0x3e9283=(0x0,Mustache_1['default'])(''+_0x1c4c04,_0x4f6785),_0x1a3eb2=(0x0,Debounce_1[_0x430a60(0x166)])(async()=>{const _0x15c8fa=_0x430a60;await _0x301e77[_0x15c8fa(0x204)](_0x4f6785[_0x15c8fa(0x27d)][_0x15c8fa(0x279)]+'@'+(_0x4f6785[_0x15c8fa(0x224)]?_0x15c8fa(0x1e2):_0x15c8fa(0x155)),{'text':_0x3e9283});},0x3e8,_0x4f6785['id']);_0x1a3eb2(),await _0x4f6785['update']({'isOutOfHour':!![],'amountUsedBotQueues':_0x4f6785[_0x430a60(0x221)]+0x1});return;}await _0x4f6785[_0x430a60(0x244)]({'isOutOfHour':!![],'amountUsedBotQueues':_0x4f6785[_0x430a60(0x221)]+0x1});return;}}}catch(_0x233609){Sentry[_0x430a60(0x24b)](_0x233609),console[_0x430a60(0x19f)](_0x233609);}_0x4f6785['queue']&&_0x4f6785['queueId']&&!_0x41b9eb[_0x430a60(0x141)][_0x430a60(0x209)]&&((!_0x4f6785[_0x430a60(0x19a)]||_0x4f6785['queue']?.[_0x430a60(0x1e3)]?.[_0x430a60(0x1f5)]>0x0)&&await(0x0,ChatBotListener_1['sayChatbot'])(_0x4f6785[_0x430a60(0x15f)],_0x301e77,_0x4f6785,_0x447618,_0x41b9eb),await _0x4f6785[_0x430a60(0x244)]({'sendInactiveMessage':![]})),await _0x4f6785['reload']();}catch(_0x40ed4b){Sentry[_0x430a60(0x24b)](_0x40ed4b),console[_0x430a60(0x19f)](_0x40ed4b),logger_1[_0x430a60(0x1f0)]['error']('Error\x20handling\x20whatsapp\x20message:\x20Err:\x20'+_0x40ed4b);}};exports[a574_0x90d64b(0x1de)]=handleMessage;const handleMsgAck=async(_0x5ba720,_0xbd893b)=>{const _0x1e0c1a=a574_0x90d64b;await new Promise(_0x4097ff=>setTimeout(_0x4097ff,0x1f4));const _0xd8a431=(0x0,socket_1[_0x1e0c1a(0x150)])();try{const _0x38c789=await Message_1[_0x1e0c1a(0x13e)][_0x1e0c1a(0x1f4)]({'where':{'wid':_0x5ba720[_0x1e0c1a(0x141)]['id']},'include':[_0x1e0c1a(0x27d),{'model':Message_1[_0x1e0c1a(0x13e)],'as':'quotedMsg','include':[_0x1e0c1a(0x27d)]}]});if(!_0x38c789)return;await _0x38c789['update']({'ack':_0xbd893b}),_0xd8a431['to'](_0x38c789[_0x1e0c1a(0x23a)][_0x1e0c1a(0x18a)]())[_0x1e0c1a(0x242)](_0x1e0c1a(0x137)+_0x38c789['companyId']+_0x1e0c1a(0x13a),{'action':_0x1e0c1a(0x244),'message':_0x38c789});}catch(_0x4dd417){Sentry[_0x1e0c1a(0x24b)](_0x4dd417),logger_1[_0x1e0c1a(0x1f0)][_0x1e0c1a(0x1e6)](_0x1e0c1a(0x260)+_0x4dd417);}},verifyRecentCampaign=async(_0x157129,_0x1d5a7e)=>{const _0x135b9a=a574_0x90d64b;if(!isValidMsg(_0x157129))return;if(!_0x157129[_0x135b9a(0x141)][_0x135b9a(0x209)]){const _0x55e221=_0x157129['key'][_0x135b9a(0x1e9)][_0x135b9a(0x167)](/\D/g,''),_0x58a822=await Campaign_1[_0x135b9a(0x13e)][_0x135b9a(0x15c)]({'where':{'companyId':_0x1d5a7e,'status':'EM_ANDAMENTO','confirmation':!![]}});if(_0x58a822){const _0x395c0a=_0x58a822[_0x135b9a(0x237)](_0x509b1f=>_0x509b1f['id']),_0x2aaed7=await CampaignShipping_1['default']['findOne']({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x395c0a},'number':_0x55e221,'confirmation':null}});_0x2aaed7&&(await _0x2aaed7[_0x135b9a(0x244)]({'confirmedAt':(0x0,moment_1['default'])(),'confirmation':!![]}),await queues_1['campaignQueue'][_0x135b9a(0x143)]('DispatchCampaign',{'campaignShippingId':_0x2aaed7['id'],'campaignId':_0x2aaed7[_0x135b9a(0x1f9)]},{'delay':(0x0,queues_1[_0x135b9a(0x229)])((0x0,queues_1[_0x135b9a(0x1b4)])(0x0,0xa))}));}}},verifyCampaignMessageAndCloseTicket=async(_0x378110,_0x2d6664,_0x2d41c1)=>{const _0x1e940b=a574_0x90d64b;if(!isValidMsg(_0x378110))return;let _0x4f04b7;_0x4f04b7=await getContactMessage(_0x378110,_0x2d41c1);const _0xe696cd=await verifyContact(_0x4f04b7,_0x2d41c1,_0x2d6664),_0x3481ff=(0x0,socket_1[_0x1e940b(0x150)])(),_0x160cfc=await(0x0,exports[_0x1e940b(0x1e5)])(_0x378110),_0x3d596b=/\u200c/[_0x1e940b(0x254)](_0x160cfc);if(_0x378110[_0x1e940b(0x141)][_0x1e940b(0x209)]&&_0x3d596b){const _0x3d72a0=await Message_1[_0x1e940b(0x13e)][_0x1e940b(0x1f4)]({'where':{[sequelize_1['Op']['or']]:[{'wid':_0x378110[_0x1e940b(0x141)]['id']},{'contactId':_0xe696cd['id']}],'companyId':_0x2d6664}});if(!(0x0,lodash_1['isNull'])(_0x3d72a0)||!(0x0,lodash_1['isNil'])(_0x3d72a0)||_0x3d72a0!==null){const _0x1794e6=await Ticket_1[_0x1e940b(0x13e)][_0x1e940b(0x226)](_0x3d72a0[_0x1e940b(0x23a)]);await _0x1794e6[_0x1e940b(0x244)]({'status':_0x1e940b(0x238),'amountUsedBotQueues':0x0,'amountUseOutOfHours':0x0}),_0x3481ff['to'](_0x1e940b(0x208))[_0x1e940b(0x242)](_0x1e940b(0x137)+_0x2d6664+_0x1e940b(0x196),{'action':_0x1e940b(0x283),'ticket':_0x1794e6,'ticketId':_0x1794e6['id']}),_0x3481ff['to'](_0x1794e6[_0x1e940b(0x1a2)])['to'](_0x1794e6['id']['toString']())['emit'](_0x1e940b(0x137)+_0x2d6664+_0x1e940b(0x196),{'action':_0x1e940b(0x244),'ticket':_0x1794e6,'ticketId':_0x1794e6['id']});}}},filterMessages=_0x3931b2=>{const _0x3ba02e=a574_0x90d64b;if(_0x3931b2[_0x3ba02e(0x1fa)]?.[_0x3ba02e(0x21d)])return![];if([baileys_1[_0x3ba02e(0x14b)][_0x3ba02e(0x24f)],baileys_1['WAMessageStubType'][_0x3ba02e(0x1b0)],baileys_1[_0x3ba02e(0x14b)][_0x3ba02e(0x1ec)],baileys_1[_0x3ba02e(0x14b)]['CIPHERTEXT']][_0x3ba02e(0x213)](_0x3931b2['messageStubType']))return![];return!![];},wbotMessageListener=(_0x17b149,_0x347a54)=>{const _0x5627c7=a574_0x90d64b;_0x17b149['ev']['on'](_0x5627c7(0x146),async _0x47ccab=>{const _0x167e28=_0x5627c7,_0x4de072=_0x47ccab[_0x167e28(0x1df)][_0x167e28(0x138)](filterMessages)[_0x167e28(0x237)](_0x782066=>_0x782066);if(!_0x4de072)return;_0x4de072['forEach'](async _0x4f352b=>{const _0x43f68d=_0x167e28,_0x4b9b4f=await Message_1[_0x43f68d(0x13e)]['count']({'where':{'wid':_0x4f352b[_0x43f68d(0x141)]['id'],'companyId':_0x347a54}});if(!_0x4b9b4f){let _0x2f2574=![],_0xb1f1b1=await(0x0,exports[_0x43f68d(0x1e5)])(_0x4f352b);const _0x3c7577=_0x4f352b?.[_0x43f68d(0x141)]?.[_0x43f68d(0x209)];if(_0x3c7577)_0x2f2574=/\u200c/[_0x43f68d(0x254)](_0xb1f1b1);else{if(/\u200c/[_0x43f68d(0x254)](_0xb1f1b1))_0xb1f1b1=_0xb1f1b1[_0x43f68d(0x167)](/\u200c/,'');logger_1['logger'][_0x43f68d(0x26b)]('Validação\x20de\x20mensagem\x20de\x20campanha\x20enviada\x20por\x20terceiros:\x20'+_0xb1f1b1);}!_0x2f2574&&await handleMessage(_0x4f352b,_0x17b149,_0x347a54),await verifyRecentCampaign(_0x4f352b,_0x347a54),await verifyCampaignMessageAndCloseTicket(_0x4f352b,_0x347a54,_0x17b149);}_0x4f352b[_0x43f68d(0x141)][_0x43f68d(0x1e9)]?.[_0x43f68d(0x183)]('@g.us')&&handleMsgAck(_0x4f352b,0x2);});}),_0x17b149['ev']['on'](_0x5627c7(0x16c),_0x42c524=>{const _0x1d69b1=_0x5627c7;if(_0x42c524[_0x1d69b1(0x1f5)]===0x0)return;_0x42c524['forEach'](async _0x4878df=>{const _0x5c1313=_0x1d69b1;_0x17b149['readMessages']([_0x4878df[_0x5c1313(0x141)]]);const _0x3becdd={..._0x42c524};_0x3becdd['0']?.['update']['messageStubType']===0x1&&_0x3becdd['0']?.[_0x5c1313(0x141)][_0x5c1313(0x1e9)]!==_0x5c1313(0x253)&&(0x0,MarkDeleteWhatsAppMessage_1[_0x5c1313(0x13e)])(_0x3becdd['0']?.[_0x5c1313(0x141)][_0x5c1313(0x1e9)],null,_0x3becdd['0']?.[_0x5c1313(0x141)]['id'],_0x347a54);let _0x565fa0;_0x4878df[_0x5c1313(0x244)][_0x5c1313(0x1a2)]===0x3&&_0x4878df?.[_0x5c1313(0x141)]?.['fromMe']?_0x565fa0=0x2:_0x565fa0=_0x4878df[_0x5c1313(0x244)]['status'],handleMsgAck(_0x4878df,_0x565fa0);});}),_0x17b149['ev']['on'](_0x5627c7(0x179),_0x2b167b=>{const _0x4a0fc6=_0x5627c7;if(_0x2b167b[_0x4a0fc6(0x1f5)]===0x0)return;_0x2b167b[_0x4a0fc6(0x13d)](async _0x3c939e=>{const _0x3b529a=_0x4a0fc6,_0x352161=_0x3c939e['id'][_0x3b529a(0x167)](/\D/g,''),_0x1a5926=_0x3c939e['subject']||_0x352161;let _0x311454;try{_0x311454=await _0x17b149[_0x3b529a(0x14e)](_0x3c939e['id'],_0x3b529a(0x251));}catch(_0x15c39e){Sentry['captureException'](_0x15c39e),_0x311454=process[_0x3b529a(0x23e)]['FRONTEND_URL']+_0x3b529a(0x271);}const _0x1fa64b={'name':_0x1a5926,'number':_0x352161,'isGroup':!![],'companyId':_0x347a54,'remoteJid':_0x3c939e['id'],'profilePicUrl':_0x311454},_0x503925=await(0x0,CreateOrUpdateContactService_1[_0x3b529a(0x13e)])(_0x1fa64b);});});};exports[a574_0x90d64b(0x15a)]=wbotMessageListener;