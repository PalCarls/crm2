'use strict';const a628_0x1a8be7=a628_0x5927;(function(_0x367bb0,_0x7c8e0b){const _0x2a668b=a628_0x5927,_0x11a1be=_0x367bb0();while(!![]){try{const _0x565bda=-parseInt(_0x2a668b(0x146))/0x1*(parseInt(_0x2a668b(0x163))/0x2)+parseInt(_0x2a668b(0x135))/0x3+-parseInt(_0x2a668b(0x14e))/0x4+parseInt(_0x2a668b(0x142))/0x5+parseInt(_0x2a668b(0x13e))/0x6+-parseInt(_0x2a668b(0x160))/0x7*(-parseInt(_0x2a668b(0x139))/0x8)+-parseInt(_0x2a668b(0x148))/0x9*(parseInt(_0x2a668b(0x132))/0xa);if(_0x565bda===_0x7c8e0b)break;else _0x11a1be['push'](_0x11a1be['shift']());}catch(_0x3f8910){_0x11a1be['push'](_0x11a1be['shift']());}}}(a628_0x38f1,0x68d52));function a628_0x38f1(){const _0x19588d=['contactId','number','7vQmLTK','isNil','END:VCARD','51622okDCdr','conversation','../../models/Contact','hasOwnProperty','\x20-\x20','name','30PXjCwN','VERSION:3.0\x0a','captureException','1012590eITGbU','__esModule','replace','lodash','984976ugmdIO','s.whatsapp.net','sendMessage','../../helpers/Mustache','writable','1292646ktsGfg','create',';;;\x0a','parse','3327500yydpDm','log','BEGIN:VCARD\x0a','__setModuleDefault','11hepWxw','includes','459981afHIcD','companyId','update','delay','TEL;type=CELL;waid=','g.us','1899804MBQePG','__createBinding','ERR_SENDING_WAPP_MSG','defineProperty','split','findOne','get','__importStar','isGroup','getOwnPropertyDescriptor','call','dataJson','FN:','extendedTextMessage','remoteJid','default'];a628_0x38f1=function(){return _0x19588d;};return a628_0x38f1();}var __createBinding=this&&this[a628_0x1a8be7(0x14f)]||(Object['create']?function(_0x136eab,_0x964107,_0x159b0e,_0x3c15eb){const _0x59ac60=a628_0x1a8be7;if(_0x3c15eb===undefined)_0x3c15eb=_0x159b0e;var _0x1169d9=Object[_0x59ac60(0x157)](_0x964107,_0x159b0e);(!_0x1169d9||(_0x59ac60(0x154)in _0x1169d9?!_0x964107[_0x59ac60(0x136)]:_0x1169d9[_0x59ac60(0x13d)]||_0x1169d9['configurable']))&&(_0x1169d9={'enumerable':!![],'get':function(){return _0x964107[_0x159b0e];}}),Object[_0x59ac60(0x151)](_0x136eab,_0x3c15eb,_0x1169d9);}:function(_0x22f378,_0x4d129a,_0x2c363f,_0x264fa4){if(_0x264fa4===undefined)_0x264fa4=_0x2c363f;_0x22f378[_0x264fa4]=_0x4d129a[_0x2c363f];}),__setModuleDefault=this&&this[a628_0x1a8be7(0x145)]||(Object[a628_0x1a8be7(0x13f)]?function(_0x392a3c,_0x111a4d){const _0x502387=a628_0x1a8be7;Object[_0x502387(0x151)](_0x392a3c,_0x502387(0x15d),{'enumerable':!![],'value':_0x111a4d});}:function(_0x1fcbf9,_0x4dac41){const _0x23dd4c=a628_0x1a8be7;_0x1fcbf9[_0x23dd4c(0x15d)]=_0x4dac41;}),__importStar=this&&this[a628_0x1a8be7(0x155)]||function(_0x34d9bc){const _0x48b886=a628_0x1a8be7;if(_0x34d9bc&&_0x34d9bc['__esModule'])return _0x34d9bc;var _0x527021={};if(_0x34d9bc!=null){for(var _0x38d757 in _0x34d9bc)if(_0x38d757!==_0x48b886(0x15d)&&Object['prototype'][_0x48b886(0x166)][_0x48b886(0x158)](_0x34d9bc,_0x38d757))__createBinding(_0x527021,_0x34d9bc,_0x38d757);}return __setModuleDefault(_0x527021,_0x34d9bc),_0x527021;},__importDefault=this&&this['__importDefault']||function(_0xdf499f){return _0xdf499f&&_0xdf499f['__esModule']?_0xdf499f:{'default':_0xdf499f};};function a628_0x5927(_0x48cb78,_0x367652){const _0x38f141=a628_0x38f1();return a628_0x5927=function(_0x592715,_0x1d5ffc){_0x592715=_0x592715-0x131;let _0x22ea07=_0x38f141[_0x592715];return _0x22ea07;},a628_0x5927(_0x48cb78,_0x367652);}Object[a628_0x1a8be7(0x151)](exports,a628_0x1a8be7(0x136),{'value':!![]});const baileys_1=require('@whiskeysockets/baileys'),Sentry=__importStar(require('@sentry/node')),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),Message_1=__importDefault(require('../../models/Message')),Contact_1=__importDefault(require(a628_0x1a8be7(0x165))),lodash_1=require(a628_0x1a8be7(0x138)),Mustache_1=__importDefault(require(a628_0x1a8be7(0x13c))),SendWhatsAppMessage=async({body:_0x4da92f,ticket:_0x3de3e5,quotedMsg:_0x1d3e90,msdelay:_0x5bd23a,vCard:_0xbb06fe,isForwarded:isForwarded=![]})=>{const _0x2c51d3=a628_0x1a8be7;let _0x4a35c1={};const _0x3dd11=await(0x0,GetTicketWbot_1[_0x2c51d3(0x15d)])(_0x3de3e5),_0x5ecb0d=await Contact_1[_0x2c51d3(0x15d)]['findByPk'](_0x3de3e5[_0x2c51d3(0x15e)]);let _0x3cc3e1;_0x5ecb0d[_0x2c51d3(0x15c)]&&_0x5ecb0d[_0x2c51d3(0x15c)]!==''&&_0x5ecb0d[_0x2c51d3(0x15c)][_0x2c51d3(0x147)]('@')?_0x3cc3e1=_0x5ecb0d['remoteJid']:_0x3cc3e1=_0x5ecb0d[_0x2c51d3(0x15f)]+'@'+(_0x3de3e5[_0x2c51d3(0x156)]?_0x2c51d3(0x14d):_0x2c51d3(0x13a));if(_0x1d3e90){const _0xa4d2c7=await Message_1[_0x2c51d3(0x15d)][_0x2c51d3(0x153)]({'where':{'id':_0x1d3e90['id']}});if(_0xa4d2c7){const _0x17391e=JSON[_0x2c51d3(0x141)](_0xa4d2c7[_0x2c51d3(0x159)]);_0x17391e['message'][_0x2c51d3(0x15b)]!==undefined?_0x4a35c1={'quoted':{'key':_0x17391e['key'],'message':{'extendedTextMessage':_0x17391e['message'][_0x2c51d3(0x15b)]}}}:_0x4a35c1={'quoted':{'key':_0x17391e['key'],'message':{'conversation':_0x17391e['message'][_0x2c51d3(0x164)]}}};}}if(!(0x0,lodash_1[_0x2c51d3(0x161)])(_0xbb06fe)){const _0x20f5b8=_0xbb06fe['number'],_0xab2f28=_0xbb06fe[_0x2c51d3(0x131)][_0x2c51d3(0x152)]('\x20')[0x0],_0x115eb3=String(_0xbb06fe[_0x2c51d3(0x131)])[_0x2c51d3(0x137)](_0xbb06fe[_0x2c51d3(0x131)][_0x2c51d3(0x152)]('\x20')[0x0],''),_0x539d37=_0x2c51d3(0x144)+_0x2c51d3(0x133)+('N:'+_0x115eb3+';'+_0xab2f28+_0x2c51d3(0x140))+(_0x2c51d3(0x15a)+_0xbb06fe[_0x2c51d3(0x131)]+'\x0a')+(_0x2c51d3(0x14c)+_0x20f5b8+':+'+_0x20f5b8+'\x0a')+_0x2c51d3(0x162);try{await(0x0,baileys_1[_0x2c51d3(0x14b)])(_0x5bd23a);const _0x29115f=await _0x3dd11[_0x2c51d3(0x13b)](_0x3cc3e1,{'contacts':{'displayName':''+_0xbb06fe[_0x2c51d3(0x131)],'contacts':[{'vcard':_0x539d37}]}});return await _0x3de3e5[_0x2c51d3(0x14a)]({'lastMessage':(0x0,Mustache_1['default'])(_0x539d37,_0x3de3e5),'imported':null}),_0x29115f;}catch(_0x3d76bd){Sentry[_0x2c51d3(0x134)](_0x3d76bd),console[_0x2c51d3(0x143)](_0x3d76bd);throw new AppError_1[(_0x2c51d3(0x15d))](_0x2c51d3(0x150));}};try{await(0x0,baileys_1[_0x2c51d3(0x14b)])(_0x5bd23a);const _0x2465a1=await _0x3dd11[_0x2c51d3(0x13b)](_0x3cc3e1,{'text':(0x0,Mustache_1[_0x2c51d3(0x15d)])(_0x4da92f,_0x3de3e5),'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded?!![]:![]}},{..._0x4a35c1});return await _0x3de3e5[_0x2c51d3(0x14a)]({'lastMessage':(0x0,Mustache_1[_0x2c51d3(0x15d)])(_0x4da92f,_0x3de3e5),'imported':null}),_0x2465a1;}catch(_0x3c2734){console['log']('erro\x20ao\x20enviar\x20mensagem\x20na\x20company\x20'+_0x3de3e5[_0x2c51d3(0x149)]+_0x2c51d3(0x167),_0x3cc3e1),Sentry[_0x2c51d3(0x134)](_0x3c2734),console[_0x2c51d3(0x143)](_0x3c2734);throw new AppError_1['default'](_0x2c51d3(0x150));}};exports['default']=SendWhatsAppMessage;