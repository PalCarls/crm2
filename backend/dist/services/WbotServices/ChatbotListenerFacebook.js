'use strict';const a536_0x1e8a11=a536_0xfd96;(function(_0x1785a2,_0x419d60){const _0x4b13da=a536_0xfd96,_0x2db0ba=_0x1785a2();while(!![]){try{const _0x43b086=-parseInt(_0x4b13da(0x1ca))/0x1*(-parseInt(_0x4b13da(0x1c5))/0x2)+parseInt(_0x4b13da(0x1d0))/0x3*(-parseInt(_0x4b13da(0x1b2))/0x4)+-parseInt(_0x4b13da(0x1cf))/0x5*(-parseInt(_0x4b13da(0x1bf))/0x6)+parseInt(_0x4b13da(0x1bc))/0x7+-parseInt(_0x4b13da(0x1c1))/0x8*(-parseInt(_0x4b13da(0x1b4))/0x9)+-parseInt(_0x4b13da(0x1d8))/0xa*(parseInt(_0x4b13da(0x1bb))/0xb)+parseInt(_0x4b13da(0x1b7))/0xc*(-parseInt(_0x4b13da(0x1cb))/0xd);if(_0x43b086===_0x419d60)break;else _0x2db0ba['push'](_0x2db0ba['shift']());}catch(_0x401c90){_0x2db0ba['push'](_0x2db0ba['shift']());}}}(a536_0x243e,0x5aefd));var __importDefault=this&&this['__importDefault']||function(_0xb83fec){return _0xb83fec&&_0xb83fec['__esModule']?_0xb83fec:{'default':_0xb83fec};};Object['defineProperty'](exports,a536_0x1e8a11(0x1c8),{'value':!![]}),exports[a536_0x1e8a11(0x1b6)]=exports[a536_0x1e8a11(0x1cd)]=void 0x0;function a536_0xfd96(_0x48189f,_0x4c330f){const _0x243ea8=a536_0x243e();return a536_0xfd96=function(_0xfd96e8,_0x511316){_0xfd96e8=_0xfd96e8-0x1ae;let _0x5bd41e=_0x243ea8[_0xfd96e8];return _0x5bd41e;},a536_0xfd96(_0x48189f,_0x4c330f);}const ShowDialogChatBotsServices_1=__importDefault(require(a536_0x1e8a11(0x1d2))),ShowQueueService_1=__importDefault(require(a536_0x1e8a11(0x1c6))),ShowChatBotServices_1=__importDefault(require(a536_0x1e8a11(0x1c4))),DeleteDialogChatBotsServices_1=__importDefault(require(a536_0x1e8a11(0x1c2))),ShowChatBotByChatbotIdServices_1=__importDefault(require('../ChatBotServices/ShowChatBotByChatbotIdServices')),CreateDialogChatBotsServices_1=__importDefault(require(a536_0x1e8a11(0x1ae))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),Mustache_1=__importDefault(require('../../helpers/Mustache')),UpdateTicketService_1=__importDefault(require(a536_0x1e8a11(0x1d6))),User_1=__importDefault(require('../../models/User')),graphAPI_1=require(a536_0x1e8a11(0x1b3)),isNumeric=_0x2819ae=>/^-?\d+$/[a536_0x1e8a11(0x1d4)](_0x2819ae),deleteAndCreateDialogStage=async(_0x34e4e6,_0x4b52d7,_0x3f0ab6)=>{const _0x443156=a536_0x1e8a11;try{await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x34e4e6['id']);const _0x2074c7=await(0x0,ShowChatBotByChatbotIdServices_1['default'])(_0x4b52d7);return!_0x2074c7&&await _0x3f0ab6[_0x443156(0x1d3)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x443156(0x1bd)])({'awaiting':0x1,'contactId':_0x34e4e6['id'],'chatbotId':_0x4b52d7,'queueId':_0x2074c7[_0x443156(0x1c0)]});}catch(_0x533530){await _0x3f0ab6[_0x443156(0x1d3)]({'isBot':![]});}};function a536_0x243e(){const _0x5e382b=['1138071MgfEVX','404096bWyTal','default','name','2306694sjKPmw','queueId','8FHHfbV','../DialogChatBotsServices/DeleteDialogChatBotsServices','open','../ChatBotServices/ShowChatBotServices','701816PifzkQ','../QueueService/ShowQueueService','greetingMessage','__esModule','*\x20-\x20','1qcLxWp','13gtsoJQ','isAgent','deleteAndCreateDialogStage','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','5NohyDf','138bAyoYN','text','../DialogChatBotsServices/ShowDialogChatBotsServices','update','test','number','../TicketServices/UpdateTicketService','findOne','10kGvjDh','companyId','chatbotId','../DialogChatBotsServices/CreateDialogChatBotsServices','sendText','length','facebookUserToken','36988oOCGzP','../FacebookServices/graphAPI','5986395ypGYnH','whatsapp','sayChatbot','6683280iHHCyf','options','forEach','is_echo'];a536_0x243e=function(){return _0x5e382b;};return a536_0x243e();}exports['deleteAndCreateDialogStage']=deleteAndCreateDialogStage;const sendMessage=async(_0x206f59,_0x50ee13,_0x310a8f,_0x23e143)=>{const _0xac367c=a536_0x1e8a11,_0x388844=await(0x0,graphAPI_1[_0xac367c(0x1af)])(_0x50ee13[_0xac367c(0x1d5)],(0x0,Mustache_1[_0xac367c(0x1bd)])(_0x23e143,_0x310a8f),_0x310a8f[_0xac367c(0x1b5)]['facebookUserToken']);},sendDialog=async(_0x5e97b9,_0x22f117,_0x184cb7)=>{const _0x55d2b2=a536_0x1e8a11,_0x4ac78c=await(0x0,ShowChatBotServices_1[_0x55d2b2(0x1bd)])(_0x5e97b9['id']);if(_0x4ac78c[_0x55d2b2(0x1b8)]){let _0x40e91e='';_0x4ac78c['options'][_0x55d2b2(0x1b9)]((_0x565de5,_0x20867c)=>{const _0x4950e6=_0x55d2b2;_0x40e91e+='*'+(_0x20867c+0x1)+_0x4950e6(0x1c9)+_0x565de5[_0x4950e6(0x1be)]+'\x0a';});const _0x1293c5=_0x40e91e['length']>0x0?_0x40e91e+_0x55d2b2(0x1ce):_0x40e91e;if(_0x40e91e[_0x55d2b2(0x1b0)]>0x0){const _0x4fcda6='‎'+_0x5e97b9[_0x55d2b2(0x1c7)]+'\x0a\x0a'+_0x1293c5,_0x5d24ce=await(0x0,graphAPI_1[_0x55d2b2(0x1af)])(_0x22f117[_0x55d2b2(0x1d5)],(0x0,Mustache_1[_0x55d2b2(0x1bd)])(_0x4fcda6,_0x184cb7),_0x184cb7[_0x55d2b2(0x1b5)][_0x55d2b2(0x1b1)]);return _0x5d24ce;}const _0x3e2e43='‎'+_0x5e97b9[_0x55d2b2(0x1c7)],_0x3a97bd=await(0x0,graphAPI_1[_0x55d2b2(0x1af)])(_0x22f117[_0x55d2b2(0x1d5)],(0x0,Mustache_1[_0x55d2b2(0x1bd)])(_0x3e2e43,_0x184cb7),_0x184cb7[_0x55d2b2(0x1b5)][_0x55d2b2(0x1b1)]);return _0x3a97bd;}let _0x395186='';_0x4ac78c[_0x55d2b2(0x1b8)][_0x55d2b2(0x1b9)]((_0x4dde8d,_0x4ed541)=>{const _0x9bed8=_0x55d2b2;_0x395186+='*'+(_0x4ed541+0x1)+_0x9bed8(0x1c9)+_0x4dde8d[_0x9bed8(0x1be)]+'\x0a';});const _0x1e4812=_0x395186[_0x55d2b2(0x1b0)]>0x0?_0x395186+_0x55d2b2(0x1ce):_0x395186;if(_0x395186['length']>0x0){const _0xeb8d7b='‎'+_0x5e97b9[_0x55d2b2(0x1c7)]+'\x0a\x0a'+_0x1e4812,_0x20eee5=await(0x0,graphAPI_1[_0x55d2b2(0x1af)])(_0x22f117[_0x55d2b2(0x1d5)],(0x0,Mustache_1[_0x55d2b2(0x1bd)])(_0xeb8d7b,_0x184cb7),_0x184cb7['whatsapp'][_0x55d2b2(0x1b1)]);return _0x20eee5;}const _0x17a1b6='‎'+_0x5e97b9[_0x55d2b2(0x1c7)],_0x829189=await(0x0,graphAPI_1[_0x55d2b2(0x1af)])(_0x22f117[_0x55d2b2(0x1d5)],(0x0,Mustache_1[_0x55d2b2(0x1bd)])(_0x17a1b6,_0x184cb7),_0x184cb7[_0x55d2b2(0x1b5)][_0x55d2b2(0x1b1)]);return _0x829189;},backToMainMenu=async(_0x4456d1,_0x548272,_0x9e0c83)=>{const _0x47fd75=a536_0x1e8a11;await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null},'ticketId':_0x9e0c83['id'],'companyId':_0x9e0c83[_0x47fd75(0x1d9)]});const {queues:_0x59c645,greetingMessage:_0x1753ad}=await(0x0,ShowWhatsAppService_1[_0x47fd75(0x1bd)])(_0x4456d1['id'],_0x9e0c83[_0x47fd75(0x1d9)]);let _0x2711cb='';_0x59c645['forEach']((_0x35da16,_0x4887c5)=>{const _0x33b445=_0x47fd75;_0x2711cb+='*'+(_0x4887c5+0x1)+_0x33b445(0x1c9)+_0x35da16['name']+'\x0a';});const _0x30e6fd=(0x0,Mustache_1['default'])('‎'+_0x1753ad+'\x0a\x0a'+_0x2711cb,_0x9e0c83);await sendMessage(_0x4456d1,_0x548272,_0x9e0c83,_0x30e6fd);const _0x548e7d=await(0x0,DeleteDialogChatBotsServices_1[_0x47fd75(0x1bd)])(_0x548272['id']);return _0x548e7d;},sayChatbot=async(_0x2ecbb8,_0x4347e8,_0x5705fb,_0x2b4729,_0x487f9d)=>{const _0x293302=a536_0x1e8a11,_0xad6402=_0x487f9d[_0x293302(0x1d1)];if(!_0x2ecbb8&&_0xad6402&&_0x487f9d[_0x293302(0x1ba)])return;const _0x30bfa1=await(0x0,ShowDialogChatBotsServices_1[_0x293302(0x1bd)])(_0x2b4729['id']);if(_0xad6402==='#'){const _0x25dbd7=await backToMainMenu(_0x4347e8,_0x2b4729,_0x5705fb);return _0x25dbd7;}if(!_0x30bfa1){const _0x28acf8=await(0x0,ShowQueueService_1['default'])(_0x2ecbb8,_0x5705fb[_0x293302(0x1d9)]),_0x2d4531=_0x487f9d[_0x293302(0x1d1)],_0x9ed025=_0x28acf8['chatbots'][+_0x2d4531-0x1];if(!_0x9ed025?.[_0x293302(0x1c7)]){await(0x0,DeleteDialogChatBotsServices_1[_0x293302(0x1bd)])(_0x2b4729['id']);return;}if(_0x9ed025){if(_0x9ed025[_0x293302(0x1cc)]){const _0x13b88d=await User_1[_0x293302(0x1bd)][_0x293302(0x1d7)]({'where':{'name':_0x9ed025[_0x293302(0x1be)]}}),_0x17fb33={'ticketData':{'userId':_0x13b88d['id'],'status':_0x293302(0x1c3)},'ticketId':_0x5705fb['id'],'companyId':_0x5705fb[_0x293302(0x1d9)]};await(0x0,UpdateTicketService_1['default'])(_0x17fb33);}await(0x0,exports[_0x293302(0x1cd)])(_0x2b4729,_0x9ed025['id'],_0x5705fb);const _0x416649=await sendDialog(_0x9ed025,_0x2b4729,_0x5705fb);return _0x416649;}}if(_0x30bfa1){const _0x5a829d=isNumeric(_0xad6402)?_0xad6402:0x1,_0x413037=await(0x0,ShowChatBotServices_1[_0x293302(0x1bd)])(_0x30bfa1[_0x293302(0x1da)]),_0x24f41d=_0x413037[_0x293302(0x1b8)][+_0x5a829d-0x1]?_0x413037[_0x293302(0x1b8)][+_0x5a829d-0x1]:_0x413037[_0x293302(0x1b8)][0x0];if(!_0x24f41d[_0x293302(0x1c7)]){await(0x0,DeleteDialogChatBotsServices_1[_0x293302(0x1bd)])(_0x2b4729['id']);return;}if(_0x24f41d){if(_0x24f41d[_0x293302(0x1cc)]){const _0x19a491=await User_1['default'][_0x293302(0x1d7)]({'where':{'name':_0x24f41d[_0x293302(0x1be)]}}),_0x34060d={'ticketData':{'userId':_0x19a491['id'],'status':_0x293302(0x1c3)},'ticketId':_0x5705fb['id'],'companyId':_0x5705fb[_0x293302(0x1d9)]};await(0x0,UpdateTicketService_1[_0x293302(0x1bd)])(_0x34060d);}await(0x0,exports[_0x293302(0x1cd)])(_0x2b4729,_0x24f41d['id'],_0x5705fb);const _0x436c15=await sendDialog(_0x24f41d,_0x2b4729,_0x5705fb);return _0x436c15;}}};exports[a536_0x1e8a11(0x1b6)]=sayChatbot;