'use strict';const a536_0x25287f=a536_0x176b;(function(_0x3244cc,_0x34d573){const _0x233e83=a536_0x176b,_0x5de354=_0x3244cc();while(!![]){try{const _0xc2c096=-parseInt(_0x233e83(0x146))/0x1*(parseInt(_0x233e83(0x165))/0x2)+-parseInt(_0x233e83(0x15e))/0x3*(parseInt(_0x233e83(0x16b))/0x4)+parseInt(_0x233e83(0x151))/0x5+parseInt(_0x233e83(0x14c))/0x6*(-parseInt(_0x233e83(0x148))/0x7)+parseInt(_0x233e83(0x147))/0x8+parseInt(_0x233e83(0x14f))/0x9*(parseInt(_0x233e83(0x156))/0xa)+parseInt(_0x233e83(0x166))/0xb*(parseInt(_0x233e83(0x14e))/0xc);if(_0xc2c096===_0x34d573)break;else _0x5de354['push'](_0x5de354['shift']());}catch(_0x1233b3){_0x5de354['push'](_0x5de354['shift']());}}}(a536_0xb535,0x6eb3f));var __importDefault=this&&this[a536_0x25287f(0x169)]||function(_0x370fcb){return _0x370fcb&&_0x370fcb['__esModule']?_0x370fcb:{'default':_0x370fcb};};function a536_0x176b(_0x5b7eb8,_0x345a98){const _0xb53565=a536_0xb535();return a536_0x176b=function(_0x176b49,_0x566d8c){_0x176b49=_0x176b49-0x141;let _0x3e829f=_0xb53565[_0x176b49];return _0x3e829f;},a536_0x176b(_0x5b7eb8,_0x345a98);}function a536_0xb535(){const _0xe4d877=['19011wDFbFp','73552EjGxmR','2814259rAIMDm','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','*\x20-\x20','sayChatbot','6nVDDqo','deleteAndCreateDialogStage','1072992VLSMqb','141147QGwAiK','greetingMessage','1822770pwHgny','number','isAgent','../../models/User','sendText','400Djobtl','companyId','../WhatsappService/ShowWhatsAppService','name','whatsapp','../../helpers/Mustache','../DialogChatBotsServices/CreateDialogChatBotsServices','update','1011LVSDhF','forEach','chatbots','is_echo','open','default','queueId','34hTsdHI','33cTKXFF','options','facebookUserToken','__importDefault','length','1076HfJJMW','text','defineProperty','chatbotId','../TicketServices/UpdateTicketService','../FacebookServices/graphAPI','findOne'];a536_0xb535=function(){return _0xe4d877;};return a536_0xb535();}Object[a536_0x25287f(0x141)](exports,'__esModule',{'value':!![]}),exports[a536_0x25287f(0x14b)]=exports[a536_0x25287f(0x14d)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/ShowDialogChatBotsServices')),ShowQueueService_1=__importDefault(require('../QueueService/ShowQueueService')),ShowChatBotServices_1=__importDefault(require('../ChatBotServices/ShowChatBotServices')),DeleteDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/DeleteDialogChatBotsServices')),ShowChatBotByChatbotIdServices_1=__importDefault(require('../ChatBotServices/ShowChatBotByChatbotIdServices')),CreateDialogChatBotsServices_1=__importDefault(require(a536_0x25287f(0x15c))),ShowWhatsAppService_1=__importDefault(require(a536_0x25287f(0x158))),Mustache_1=__importDefault(require(a536_0x25287f(0x15b))),UpdateTicketService_1=__importDefault(require(a536_0x25287f(0x143))),User_1=__importDefault(require(a536_0x25287f(0x154))),graphAPI_1=require(a536_0x25287f(0x144)),isNumeric=_0x8c8b2e=>/^-?\d+$/['test'](_0x8c8b2e),deleteAndCreateDialogStage=async(_0x3c64b0,_0x4f7975,_0x194988)=>{const _0x43852d=a536_0x25287f;try{await(0x0,DeleteDialogChatBotsServices_1[_0x43852d(0x163)])(_0x3c64b0['id']);const _0x55fce6=await(0x0,ShowChatBotByChatbotIdServices_1['default'])(_0x4f7975);return!_0x55fce6&&await _0x194988[_0x43852d(0x15d)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x43852d(0x163)])({'awaiting':0x1,'contactId':_0x3c64b0['id'],'chatbotId':_0x4f7975,'queueId':_0x55fce6[_0x43852d(0x164)]});}catch(_0x24357e){await _0x194988[_0x43852d(0x15d)]({'isBot':![]});}};exports[a536_0x25287f(0x14d)]=deleteAndCreateDialogStage;const sendMessage=async(_0x4a8be6,_0xd090db,_0x457fed,_0x549c78)=>{const _0x15f939=a536_0x25287f,_0x87265c=await(0x0,graphAPI_1[_0x15f939(0x155)])(_0xd090db['number'],(0x0,Mustache_1[_0x15f939(0x163)])(_0x549c78,_0x457fed),_0x457fed[_0x15f939(0x15a)][_0x15f939(0x168)]);},sendDialog=async(_0x1c5136,_0x26b129,_0x2485d7)=>{const _0x5c8a32=a536_0x25287f,_0x5ce1e8=await(0x0,ShowChatBotServices_1[_0x5c8a32(0x163)])(_0x1c5136['id']);if(_0x5ce1e8[_0x5c8a32(0x167)]){let _0x40c240='';_0x5ce1e8[_0x5c8a32(0x167)]['forEach']((_0x41ba7e,_0x30c798)=>{const _0x2a33c2=_0x5c8a32;_0x40c240+='*'+(_0x30c798+0x1)+_0x2a33c2(0x14a)+_0x41ba7e[_0x2a33c2(0x159)]+'\x0a';});const _0x409eab=_0x40c240[_0x5c8a32(0x16a)]>0x0?_0x40c240+_0x5c8a32(0x149):_0x40c240;if(_0x40c240[_0x5c8a32(0x16a)]>0x0){const _0x4a8ac6='‎'+_0x1c5136['greetingMessage']+'\x0a\x0a'+_0x409eab,_0x4069c5=await(0x0,graphAPI_1[_0x5c8a32(0x155)])(_0x26b129[_0x5c8a32(0x152)],(0x0,Mustache_1[_0x5c8a32(0x163)])(_0x4a8ac6,_0x2485d7),_0x2485d7[_0x5c8a32(0x15a)][_0x5c8a32(0x168)]);return _0x4069c5;}const _0x38e6e0='‎'+_0x1c5136[_0x5c8a32(0x150)],_0x38ff4b=await(0x0,graphAPI_1[_0x5c8a32(0x155)])(_0x26b129[_0x5c8a32(0x152)],(0x0,Mustache_1['default'])(_0x38e6e0,_0x2485d7),_0x2485d7[_0x5c8a32(0x15a)][_0x5c8a32(0x168)]);return _0x38ff4b;}let _0x32f69f='';_0x5ce1e8['options'][_0x5c8a32(0x15f)]((_0xc86245,_0x5dbdd4)=>{const _0x332c6e=_0x5c8a32;_0x32f69f+='*'+(_0x5dbdd4+0x1)+_0x332c6e(0x14a)+_0xc86245[_0x332c6e(0x159)]+'\x0a';});const _0x4995d4=_0x32f69f[_0x5c8a32(0x16a)]>0x0?_0x32f69f+_0x5c8a32(0x149):_0x32f69f;if(_0x32f69f[_0x5c8a32(0x16a)]>0x0){const _0x240c5a='‎'+_0x1c5136[_0x5c8a32(0x150)]+'\x0a\x0a'+_0x4995d4,_0x3d5747=await(0x0,graphAPI_1[_0x5c8a32(0x155)])(_0x26b129[_0x5c8a32(0x152)],(0x0,Mustache_1[_0x5c8a32(0x163)])(_0x240c5a,_0x2485d7),_0x2485d7[_0x5c8a32(0x15a)][_0x5c8a32(0x168)]);return _0x3d5747;}const _0x519fd7='‎'+_0x1c5136[_0x5c8a32(0x150)],_0x3e1d4c=await(0x0,graphAPI_1[_0x5c8a32(0x155)])(_0x26b129[_0x5c8a32(0x152)],(0x0,Mustache_1[_0x5c8a32(0x163)])(_0x519fd7,_0x2485d7),_0x2485d7[_0x5c8a32(0x15a)][_0x5c8a32(0x168)]);return _0x3e1d4c;},backToMainMenu=async(_0x3b15ec,_0x1a8b78,_0x42f0f2)=>{const _0x1b30d5=a536_0x25287f;await(0x0,UpdateTicketService_1[_0x1b30d5(0x163)])({'ticketData':{'queueId':null},'ticketId':_0x42f0f2['id'],'companyId':_0x42f0f2[_0x1b30d5(0x157)]});const {queues:_0x44de74,greetingMessage:_0x3bad44}=await(0x0,ShowWhatsAppService_1[_0x1b30d5(0x163)])(_0x3b15ec['id'],_0x42f0f2[_0x1b30d5(0x157)]);let _0x495559='';_0x44de74[_0x1b30d5(0x15f)]((_0x24c29a,_0x49c5fe)=>{const _0x4ed79e=_0x1b30d5;_0x495559+='*'+(_0x49c5fe+0x1)+_0x4ed79e(0x14a)+_0x24c29a[_0x4ed79e(0x159)]+'\x0a';});const _0x23feea=(0x0,Mustache_1[_0x1b30d5(0x163)])('‎'+_0x3bad44+'\x0a\x0a'+_0x495559,_0x42f0f2);await sendMessage(_0x3b15ec,_0x1a8b78,_0x42f0f2,_0x23feea);const _0x5958d3=await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x1a8b78['id']);return _0x5958d3;},sayChatbot=async(_0x51bcc5,_0x2737b1,_0x2dcb3c,_0x323394,_0x2544a3)=>{const _0x364fbf=a536_0x25287f,_0x4a5448=_0x2544a3[_0x364fbf(0x16c)];if(!_0x51bcc5&&_0x4a5448&&_0x2544a3[_0x364fbf(0x161)])return;const _0x306c45=await(0x0,ShowDialogChatBotsServices_1[_0x364fbf(0x163)])(_0x323394['id']);if(_0x4a5448==='#'){const _0x3a594b=await backToMainMenu(_0x2737b1,_0x323394,_0x2dcb3c);return _0x3a594b;}if(!_0x306c45){const _0x32488c=await(0x0,ShowQueueService_1[_0x364fbf(0x163)])(_0x51bcc5,_0x2dcb3c[_0x364fbf(0x157)]),_0x2c2b4d=_0x2544a3['text'],_0x44e041=_0x32488c[_0x364fbf(0x160)][+_0x2c2b4d-0x1];if(!_0x44e041?.[_0x364fbf(0x150)]){await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x323394['id']);return;}if(_0x44e041){if(_0x44e041[_0x364fbf(0x153)]){const _0xade49b=await User_1['default'][_0x364fbf(0x145)]({'where':{'name':_0x44e041[_0x364fbf(0x159)]}}),_0x298711={'ticketData':{'userId':_0xade49b['id'],'status':_0x364fbf(0x162)},'ticketId':_0x2dcb3c['id'],'companyId':_0x2dcb3c[_0x364fbf(0x157)]};await(0x0,UpdateTicketService_1[_0x364fbf(0x163)])(_0x298711);}await(0x0,exports[_0x364fbf(0x14d)])(_0x323394,_0x44e041['id'],_0x2dcb3c);const _0x3a1fb6=await sendDialog(_0x44e041,_0x323394,_0x2dcb3c);return _0x3a1fb6;}}if(_0x306c45){const _0x16408c=isNumeric(_0x4a5448)?_0x4a5448:0x1,_0x4a569b=await(0x0,ShowChatBotServices_1[_0x364fbf(0x163)])(_0x306c45[_0x364fbf(0x142)]),_0x58be1a=_0x4a569b[_0x364fbf(0x167)][+_0x16408c-0x1]?_0x4a569b[_0x364fbf(0x167)][+_0x16408c-0x1]:_0x4a569b[_0x364fbf(0x167)][0x0];if(!_0x58be1a[_0x364fbf(0x150)]){await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x323394['id']);return;}if(_0x58be1a){if(_0x58be1a[_0x364fbf(0x153)]){const _0x458b3f=await User_1[_0x364fbf(0x163)]['findOne']({'where':{'name':_0x58be1a[_0x364fbf(0x159)]}}),_0x35acd6={'ticketData':{'userId':_0x458b3f['id'],'status':_0x364fbf(0x162)},'ticketId':_0x2dcb3c['id'],'companyId':_0x2dcb3c[_0x364fbf(0x157)]};await(0x0,UpdateTicketService_1[_0x364fbf(0x163)])(_0x35acd6);}await(0x0,exports[_0x364fbf(0x14d)])(_0x323394,_0x58be1a['id'],_0x2dcb3c);const _0x2ba6a8=await sendDialog(_0x58be1a,_0x323394,_0x2dcb3c);return _0x2ba6a8;}}};exports[a536_0x25287f(0x14b)]=sayChatbot;