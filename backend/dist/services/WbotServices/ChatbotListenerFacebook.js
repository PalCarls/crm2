'use strict';const a559_0x586026=a559_0x2780;(function(_0x422063,_0x1d5b40){const _0x3dd7fd=a559_0x2780,_0x3451af=_0x422063();while(!![]){try{const _0x4206e6=-parseInt(_0x3dd7fd(0x13b))/0x1+parseInt(_0x3dd7fd(0x147))/0x2*(-parseInt(_0x3dd7fd(0x12e))/0x3)+parseInt(_0x3dd7fd(0x134))/0x4+parseInt(_0x3dd7fd(0x129))/0x5*(-parseInt(_0x3dd7fd(0x125))/0x6)+parseInt(_0x3dd7fd(0x142))/0x7+-parseInt(_0x3dd7fd(0x13e))/0x8*(parseInt(_0x3dd7fd(0x136))/0x9)+-parseInt(_0x3dd7fd(0x13a))/0xa*(-parseInt(_0x3dd7fd(0x138))/0xb);if(_0x4206e6===_0x1d5b40)break;else _0x3451af['push'](_0x3451af['shift']());}catch(_0x3c788a){_0x3451af['push'](_0x3451af['shift']());}}}(a559_0x5949,0x92e46));function a559_0x5949(){const _0x3663b0=['956376zicyci','deleteAndCreateDialogStage','291879vdiyRw','../ChatBotServices/ShowChatBotByChatbotIdServices','11QOhJZG','../../helpers/Mustache','12238150rJyGBi','205358DRzKRG','*\x20-\x20','options','144LGhdzc','default','whatsapp','open','5275018pQDCpV','../DialogChatBotsServices/DeleteDialogChatBotsServices','../WhatsappService/ShowWhatsAppService','facebookUserToken','update','312406YqVGZA','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','findOne','name','chatbots','isAgent','../DialogChatBotsServices/ShowDialogChatBotsServices','../ChatBotServices/ShowChatBotServices','../FacebookServices/graphAPI','../QueueService/ShowQueueService','1218iRWxav','greetingMessage','is_echo','companyId','16490EUPRGa','__esModule','forEach','text','number','3HfGefH','../TicketServices/UpdateTicketService','length','sayChatbot','chatbotId','sendText'];a559_0x5949=function(){return _0x3663b0;};return a559_0x5949();}var __importDefault=this&&this['__importDefault']||function(_0x2fa632){const _0x112aae=a559_0x2780;return _0x2fa632&&_0x2fa632[_0x112aae(0x12a)]?_0x2fa632:{'default':_0x2fa632};};Object['defineProperty'](exports,a559_0x586026(0x12a),{'value':!![]}),exports['sayChatbot']=exports['deleteAndCreateDialogStage']=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require(a559_0x586026(0x14d))),ShowQueueService_1=__importDefault(require(a559_0x586026(0x150))),ShowChatBotServices_1=__importDefault(require(a559_0x586026(0x14e))),DeleteDialogChatBotsServices_1=__importDefault(require(a559_0x586026(0x143))),ShowChatBotByChatbotIdServices_1=__importDefault(require(a559_0x586026(0x137))),CreateDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/CreateDialogChatBotsServices')),ShowWhatsAppService_1=__importDefault(require(a559_0x586026(0x144))),Mustache_1=__importDefault(require(a559_0x586026(0x139))),UpdateTicketService_1=__importDefault(require(a559_0x586026(0x12f))),User_1=__importDefault(require('../../models/User')),graphAPI_1=require(a559_0x586026(0x14f)),isNumeric=_0x86ddd6=>/^-?\d+$/['test'](_0x86ddd6),deleteAndCreateDialogStage=async(_0x427d79,_0x488559,_0x326b20)=>{const _0x5c7a52=a559_0x586026;try{await(0x0,DeleteDialogChatBotsServices_1[_0x5c7a52(0x13f)])(_0x427d79['id']);const _0x28fe70=await(0x0,ShowChatBotByChatbotIdServices_1[_0x5c7a52(0x13f)])(_0x488559);return!_0x28fe70&&await _0x326b20['update']({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x5c7a52(0x13f)])({'awaiting':0x1,'contactId':_0x427d79['id'],'chatbotId':_0x488559,'queueId':_0x28fe70['queueId']});}catch(_0x383c51){await _0x326b20[_0x5c7a52(0x146)]({'isBot':![]});}};exports['deleteAndCreateDialogStage']=deleteAndCreateDialogStage;function a559_0x2780(_0x420ace,_0x33c64b){const _0x5949a6=a559_0x5949();return a559_0x2780=function(_0x2780ee,_0x5f1ecc){_0x2780ee=_0x2780ee-0x125;let _0x560ed3=_0x5949a6[_0x2780ee];return _0x560ed3;},a559_0x2780(_0x420ace,_0x33c64b);}const sendMessage=async(_0x5d5fb6,_0x1682c8,_0x5bdc5c,_0x3d9c1f)=>{const _0x425305=a559_0x586026,_0x54648b=await(0x0,graphAPI_1['sendText'])(_0x1682c8[_0x425305(0x12d)],(0x0,Mustache_1[_0x425305(0x13f)])(_0x3d9c1f,_0x5bdc5c),_0x5bdc5c[_0x425305(0x140)][_0x425305(0x145)]);},sendDialog=async(_0x18a7ab,_0xfef995,_0x34ce83)=>{const _0x1e2ed1=a559_0x586026,_0x28b33b=await(0x0,ShowChatBotServices_1[_0x1e2ed1(0x13f)])(_0x18a7ab['id']);if(_0x28b33b['options']){let _0xbefbdb='';_0x28b33b['options'][_0x1e2ed1(0x12b)]((_0x240c35,_0x4b45f3)=>{const _0x538baa=_0x1e2ed1;_0xbefbdb+='*'+(_0x4b45f3+0x1)+_0x538baa(0x13c)+_0x240c35[_0x538baa(0x14a)]+'\x0a';});const _0x22bcea=_0xbefbdb[_0x1e2ed1(0x130)]>0x0?_0xbefbdb+_0x1e2ed1(0x148):_0xbefbdb;if(_0xbefbdb['length']>0x0){const _0x495911='‎'+_0x18a7ab['greetingMessage']+'\x0a\x0a'+_0x22bcea,_0x1478d8=await(0x0,graphAPI_1['sendText'])(_0xfef995['number'],(0x0,Mustache_1[_0x1e2ed1(0x13f)])(_0x495911,_0x34ce83),_0x34ce83[_0x1e2ed1(0x140)][_0x1e2ed1(0x145)]);return _0x1478d8;}const _0x194e14='‎'+_0x18a7ab[_0x1e2ed1(0x126)],_0x14b4e2=await(0x0,graphAPI_1[_0x1e2ed1(0x133)])(_0xfef995[_0x1e2ed1(0x12d)],(0x0,Mustache_1[_0x1e2ed1(0x13f)])(_0x194e14,_0x34ce83),_0x34ce83[_0x1e2ed1(0x140)]['facebookUserToken']);return _0x14b4e2;}let _0x67e77b='';_0x28b33b[_0x1e2ed1(0x13d)][_0x1e2ed1(0x12b)]((_0x8037e0,_0x4cb93d)=>{const _0x1e556a=_0x1e2ed1;_0x67e77b+='*'+(_0x4cb93d+0x1)+_0x1e556a(0x13c)+_0x8037e0[_0x1e556a(0x14a)]+'\x0a';});const _0x1043c1=_0x67e77b[_0x1e2ed1(0x130)]>0x0?_0x67e77b+_0x1e2ed1(0x148):_0x67e77b;if(_0x67e77b[_0x1e2ed1(0x130)]>0x0){const _0x5cc2a1='‎'+_0x18a7ab[_0x1e2ed1(0x126)]+'\x0a\x0a'+_0x1043c1,_0x389784=await(0x0,graphAPI_1[_0x1e2ed1(0x133)])(_0xfef995[_0x1e2ed1(0x12d)],(0x0,Mustache_1[_0x1e2ed1(0x13f)])(_0x5cc2a1,_0x34ce83),_0x34ce83[_0x1e2ed1(0x140)][_0x1e2ed1(0x145)]);return _0x389784;}const _0x18ddc9='‎'+_0x18a7ab[_0x1e2ed1(0x126)],_0xa8c836=await(0x0,graphAPI_1[_0x1e2ed1(0x133)])(_0xfef995[_0x1e2ed1(0x12d)],(0x0,Mustache_1[_0x1e2ed1(0x13f)])(_0x18ddc9,_0x34ce83),_0x34ce83[_0x1e2ed1(0x140)][_0x1e2ed1(0x145)]);return _0xa8c836;},backToMainMenu=async(_0x3de324,_0x307957,_0x257d77)=>{const _0x4fad83=a559_0x586026;await(0x0,UpdateTicketService_1[_0x4fad83(0x13f)])({'ticketData':{'queueId':null},'ticketId':_0x257d77['id'],'companyId':_0x257d77[_0x4fad83(0x128)]});const {queues:_0x50d2a5,greetingMessage:_0x5a4307}=await(0x0,ShowWhatsAppService_1['default'])(_0x3de324['id'],_0x257d77[_0x4fad83(0x128)]);let _0x3e3f7c='';_0x50d2a5[_0x4fad83(0x12b)]((_0x2252f6,_0x227e2a)=>{const _0xabbf85=_0x4fad83;_0x3e3f7c+='*'+(_0x227e2a+0x1)+_0xabbf85(0x13c)+_0x2252f6[_0xabbf85(0x14a)]+'\x0a';});const _0x4e49ff=(0x0,Mustache_1[_0x4fad83(0x13f)])('‎'+_0x5a4307+'\x0a\x0a'+_0x3e3f7c,_0x257d77);await sendMessage(_0x3de324,_0x307957,_0x257d77,_0x4e49ff);const _0x5ba032=await(0x0,DeleteDialogChatBotsServices_1[_0x4fad83(0x13f)])(_0x307957['id']);return _0x5ba032;},sayChatbot=async(_0x495772,_0x524d76,_0xf97142,_0x2cf622,_0x5dfb3a)=>{const _0x401ff5=a559_0x586026,_0x27e13d=_0x5dfb3a[_0x401ff5(0x12c)];if(!_0x495772&&_0x27e13d&&_0x5dfb3a[_0x401ff5(0x127)])return;const _0x41e1a0=await(0x0,ShowDialogChatBotsServices_1[_0x401ff5(0x13f)])(_0x2cf622['id']);if(_0x27e13d==='#'){const _0x1b3b9b=await backToMainMenu(_0x524d76,_0x2cf622,_0xf97142);return _0x1b3b9b;}if(!_0x41e1a0){const _0x50a3d3=await(0x0,ShowQueueService_1[_0x401ff5(0x13f)])(_0x495772,_0xf97142[_0x401ff5(0x128)]),_0x5e0959=_0x5dfb3a[_0x401ff5(0x12c)],_0x458359=_0x50a3d3[_0x401ff5(0x14b)][+_0x5e0959-0x1];if(!_0x458359?.['greetingMessage']){await(0x0,DeleteDialogChatBotsServices_1[_0x401ff5(0x13f)])(_0x2cf622['id']);return;}if(_0x458359){if(_0x458359[_0x401ff5(0x14c)]){const _0x2b9e22=await User_1['default'][_0x401ff5(0x149)]({'where':{'name':_0x458359[_0x401ff5(0x14a)]}}),_0x4a9cc3={'ticketData':{'userId':_0x2b9e22['id'],'status':_0x401ff5(0x141)},'ticketId':_0xf97142['id'],'companyId':_0xf97142[_0x401ff5(0x128)]};await(0x0,UpdateTicketService_1[_0x401ff5(0x13f)])(_0x4a9cc3);}await(0x0,exports[_0x401ff5(0x135)])(_0x2cf622,_0x458359['id'],_0xf97142);const _0x53775f=await sendDialog(_0x458359,_0x2cf622,_0xf97142);return _0x53775f;}}if(_0x41e1a0){const _0x3f89c3=isNumeric(_0x27e13d)?_0x27e13d:0x1,_0x14f207=await(0x0,ShowChatBotServices_1[_0x401ff5(0x13f)])(_0x41e1a0[_0x401ff5(0x132)]),_0x490fa2=_0x14f207[_0x401ff5(0x13d)][+_0x3f89c3-0x1]?_0x14f207[_0x401ff5(0x13d)][+_0x3f89c3-0x1]:_0x14f207['options'][0x0];if(!_0x490fa2[_0x401ff5(0x126)]){await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x2cf622['id']);return;}if(_0x490fa2){if(_0x490fa2[_0x401ff5(0x14c)]){const _0xab1c47=await User_1[_0x401ff5(0x13f)][_0x401ff5(0x149)]({'where':{'name':_0x490fa2['name']}}),_0xdf9115={'ticketData':{'userId':_0xab1c47['id'],'status':_0x401ff5(0x141)},'ticketId':_0xf97142['id'],'companyId':_0xf97142[_0x401ff5(0x128)]};await(0x0,UpdateTicketService_1[_0x401ff5(0x13f)])(_0xdf9115);}await(0x0,exports[_0x401ff5(0x135)])(_0x2cf622,_0x490fa2['id'],_0xf97142);const _0xc28b23=await sendDialog(_0x490fa2,_0x2cf622,_0xf97142);return _0xc28b23;}}};exports[a559_0x586026(0x131)]=sayChatbot;