'use strict';const a620_0x1a05ef=a620_0x58df;(function(_0x5eb07d,_0x529c56){const _0x2ec143=a620_0x58df,_0xc4a319=_0x5eb07d();while(!![]){try{const _0x804816=parseInt(_0x2ec143(0x207))/0x1+-parseInt(_0x2ec143(0x1f3))/0x2*(-parseInt(_0x2ec143(0x200))/0x3)+-parseInt(_0x2ec143(0x1f7))/0x4*(-parseInt(_0x2ec143(0x1f9))/0x5)+parseInt(_0x2ec143(0x213))/0x6+-parseInt(_0x2ec143(0x20b))/0x7*(-parseInt(_0x2ec143(0x20c))/0x8)+-parseInt(_0x2ec143(0x203))/0x9*(-parseInt(_0x2ec143(0x1fe))/0xa)+-parseInt(_0x2ec143(0x209))/0xb;if(_0x804816===_0x529c56)break;else _0xc4a319['push'](_0xc4a319['shift']());}catch(_0x5cf4cd){_0xc4a319['push'](_0xc4a319['shift']());}}}(a620_0x111d,0x3dfa2));var __importDefault=this&&this[a620_0x1a05ef(0x1ee)]||function(_0x5242d7){return _0x5242d7&&_0x5242d7['__esModule']?_0x5242d7:{'default':_0x5242d7};};Object[a620_0x1a05ef(0x1f6)](exports,a620_0x1a05ef(0x1ea),{'value':!![]}),exports[a620_0x1a05ef(0x210)]=exports['deleteAndCreateDialogStage']=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/ShowDialogChatBotsServices')),ShowQueueService_1=__importDefault(require(a620_0x1a05ef(0x1ec))),ShowChatBotServices_1=__importDefault(require(a620_0x1a05ef(0x20e))),DeleteDialogChatBotsServices_1=__importDefault(require(a620_0x1a05ef(0x20a))),ShowChatBotByChatbotIdServices_1=__importDefault(require(a620_0x1a05ef(0x1fc))),CreateDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/CreateDialogChatBotsServices')),ShowWhatsAppService_1=__importDefault(require(a620_0x1a05ef(0x1ff))),Mustache_1=__importDefault(require(a620_0x1a05ef(0x1ed))),UpdateTicketService_1=__importDefault(require(a620_0x1a05ef(0x1f0))),User_1=__importDefault(require(a620_0x1a05ef(0x1f1))),graphAPI_1=require('../FacebookServices/graphAPI'),isNumeric=_0x5869ae=>/^-?\d+$/[a620_0x1a05ef(0x206)](_0x5869ae),deleteAndCreateDialogStage=async(_0xe2abaf,_0x495a25,_0x38a2a6)=>{const _0x385d32=a620_0x1a05ef;try{await(0x0,DeleteDialogChatBotsServices_1[_0x385d32(0x214)])(_0xe2abaf['id']);const _0x2231a6=await(0x0,ShowChatBotByChatbotIdServices_1[_0x385d32(0x214)])(_0x495a25);return!_0x2231a6&&await _0x38a2a6[_0x385d32(0x1eb)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x385d32(0x214)])({'awaiting':0x1,'contactId':_0xe2abaf['id'],'chatbotId':_0x495a25,'queueId':_0x2231a6[_0x385d32(0x204)]});}catch(_0x3624fc){await _0x38a2a6[_0x385d32(0x1eb)]({'isBot':![]});}};function a620_0x111d(){const _0xe3b1db=['sayChatbot','deleteAndCreateDialogStage','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','2923152ZuOlaH','default','forEach','companyId','text','options','__esModule','update','../QueueService/ShowQueueService','../../helpers/Mustache','__importDefault','name','../TicketServices/UpdateTicketService','../../models/User','findOne','8KBcxeQ','number','*\x20-\x20','defineProperty','40GNQhDk','chatbots','231100SZzHRF','isAgent','facebookUserToken','../ChatBotServices/ShowChatBotByChatbotIdServices','sendText','50jWnObx','../WhatsappService/ShowWhatsAppService','149787yBdMqq','chatbotId','greetingMessage','337140cFtbvR','queueId','open','test','459378hoNFgK','length','21309002GrDnRD','../DialogChatBotsServices/DeleteDialogChatBotsServices','14pFzdTC','1581016NHPauP','is_echo','../ChatBotServices/ShowChatBotServices','whatsapp'];a620_0x111d=function(){return _0xe3b1db;};return a620_0x111d();}exports[a620_0x1a05ef(0x211)]=deleteAndCreateDialogStage;const sendMessage=async(_0x8d89dc,_0x2bb094,_0x205de8,_0x437315)=>{const _0x4f7d8b=a620_0x1a05ef,_0x6e1ba8=await(0x0,graphAPI_1[_0x4f7d8b(0x1fd)])(_0x2bb094[_0x4f7d8b(0x1f4)],(0x0,Mustache_1[_0x4f7d8b(0x214)])(_0x437315,_0x205de8),_0x205de8[_0x4f7d8b(0x20f)]['facebookUserToken']);},sendDialog=async(_0x26143b,_0x5f09f8,_0xd671ad)=>{const _0x54729=a620_0x1a05ef,_0x70855b=await(0x0,ShowChatBotServices_1['default'])(_0x26143b['id']);if(_0x70855b[_0x54729(0x1e9)]){let _0x490d25='';_0x70855b[_0x54729(0x1e9)][_0x54729(0x215)]((_0x365bd8,_0x171bee)=>{const _0x57cccc=_0x54729;_0x490d25+='*'+(_0x171bee+0x1)+'*\x20-\x20'+_0x365bd8[_0x57cccc(0x1ef)]+'\x0a';});const _0x2a5e51=_0x490d25['length']>0x0?_0x490d25+_0x54729(0x212):_0x490d25;if(_0x490d25['length']>0x0){const _0x409a92='‎'+_0x26143b[_0x54729(0x202)]+'\x0a\x0a'+_0x2a5e51,_0x15ab32=await(0x0,graphAPI_1[_0x54729(0x1fd)])(_0x5f09f8['number'],(0x0,Mustache_1[_0x54729(0x214)])(_0x409a92,_0xd671ad),_0xd671ad[_0x54729(0x20f)][_0x54729(0x1fb)]);return _0x15ab32;}const _0x1d3e30='‎'+_0x26143b['greetingMessage'],_0x389e9a=await(0x0,graphAPI_1[_0x54729(0x1fd)])(_0x5f09f8['number'],(0x0,Mustache_1[_0x54729(0x214)])(_0x1d3e30,_0xd671ad),_0xd671ad['whatsapp'][_0x54729(0x1fb)]);return _0x389e9a;}let _0x31d1bd='';_0x70855b['options'][_0x54729(0x215)]((_0x428d66,_0x2592ce)=>{const _0x43641a=_0x54729;_0x31d1bd+='*'+(_0x2592ce+0x1)+_0x43641a(0x1f5)+_0x428d66[_0x43641a(0x1ef)]+'\x0a';});const _0x51c482=_0x31d1bd[_0x54729(0x208)]>0x0?_0x31d1bd+_0x54729(0x212):_0x31d1bd;if(_0x31d1bd[_0x54729(0x208)]>0x0){const _0x16c62a='‎'+_0x26143b[_0x54729(0x202)]+'\x0a\x0a'+_0x51c482,_0x30242e=await(0x0,graphAPI_1[_0x54729(0x1fd)])(_0x5f09f8[_0x54729(0x1f4)],(0x0,Mustache_1[_0x54729(0x214)])(_0x16c62a,_0xd671ad),_0xd671ad[_0x54729(0x20f)]['facebookUserToken']);return _0x30242e;}const _0x47d2e9='‎'+_0x26143b[_0x54729(0x202)],_0x1f6732=await(0x0,graphAPI_1[_0x54729(0x1fd)])(_0x5f09f8[_0x54729(0x1f4)],(0x0,Mustache_1[_0x54729(0x214)])(_0x47d2e9,_0xd671ad),_0xd671ad[_0x54729(0x20f)][_0x54729(0x1fb)]);return _0x1f6732;},backToMainMenu=async(_0x100b8f,_0x17d2c5,_0x217411)=>{const _0x172131=a620_0x1a05ef;await(0x0,UpdateTicketService_1[_0x172131(0x214)])({'ticketData':{'queueId':null},'ticketId':_0x217411['id'],'companyId':_0x217411[_0x172131(0x216)]});const {queues:_0x27a637,greetingMessage:_0x164a2e}=await(0x0,ShowWhatsAppService_1['default'])(_0x100b8f['id'],_0x217411['companyId']);let _0x50b7bb='';_0x27a637['forEach']((_0x3d83c9,_0x423ce1)=>{const _0x51d2ed=_0x172131;_0x50b7bb+='*'+(_0x423ce1+0x1)+_0x51d2ed(0x1f5)+_0x3d83c9['name']+'\x0a';});const _0x441c1c=(0x0,Mustache_1[_0x172131(0x214)])('‎'+_0x164a2e+'\x0a\x0a'+_0x50b7bb,_0x217411);await sendMessage(_0x100b8f,_0x17d2c5,_0x217411,_0x441c1c);const _0x5667f2=await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x17d2c5['id']);return _0x5667f2;},sayChatbot=async(_0x1e6062,_0x4de1fb,_0x100845,_0x560655,_0x443295)=>{const _0xb2f1fc=a620_0x1a05ef,_0x343cb2=_0x443295[_0xb2f1fc(0x217)];if(!_0x1e6062&&_0x343cb2&&_0x443295[_0xb2f1fc(0x20d)])return;const _0x3e4a02=await(0x0,ShowDialogChatBotsServices_1[_0xb2f1fc(0x214)])(_0x560655['id']);if(_0x343cb2==='#'){const _0xd323c9=await backToMainMenu(_0x4de1fb,_0x560655,_0x100845);return _0xd323c9;}if(!_0x3e4a02){const _0x2dc8d6=await(0x0,ShowQueueService_1['default'])(_0x1e6062,_0x100845[_0xb2f1fc(0x216)]),_0x27f0c7=_0x443295[_0xb2f1fc(0x217)],_0x793121=_0x2dc8d6[_0xb2f1fc(0x1f8)][+_0x27f0c7-0x1];if(!_0x793121?.[_0xb2f1fc(0x202)]){await(0x0,DeleteDialogChatBotsServices_1[_0xb2f1fc(0x214)])(_0x560655['id']);return;}if(_0x793121){if(_0x793121[_0xb2f1fc(0x1fa)]){const _0x478330=await User_1[_0xb2f1fc(0x214)][_0xb2f1fc(0x1f2)]({'where':{'name':_0x793121[_0xb2f1fc(0x1ef)]}}),_0x34e389={'ticketData':{'userId':_0x478330['id'],'status':_0xb2f1fc(0x205)},'ticketId':_0x100845['id'],'companyId':_0x100845[_0xb2f1fc(0x216)]};await(0x0,UpdateTicketService_1[_0xb2f1fc(0x214)])(_0x34e389);}await(0x0,exports[_0xb2f1fc(0x211)])(_0x560655,_0x793121['id'],_0x100845);const _0x5f1685=await sendDialog(_0x793121,_0x560655,_0x100845);return _0x5f1685;}}if(_0x3e4a02){const _0x3ea1f0=isNumeric(_0x343cb2)?_0x343cb2:0x1,_0x2780a5=await(0x0,ShowChatBotServices_1[_0xb2f1fc(0x214)])(_0x3e4a02[_0xb2f1fc(0x201)]),_0x4a7d27=_0x2780a5[_0xb2f1fc(0x1e9)][+_0x3ea1f0-0x1]?_0x2780a5[_0xb2f1fc(0x1e9)][+_0x3ea1f0-0x1]:_0x2780a5[_0xb2f1fc(0x1e9)][0x0];if(!_0x4a7d27['greetingMessage']){await(0x0,DeleteDialogChatBotsServices_1[_0xb2f1fc(0x214)])(_0x560655['id']);return;}if(_0x4a7d27){if(_0x4a7d27[_0xb2f1fc(0x1fa)]){const _0x398806=await User_1['default']['findOne']({'where':{'name':_0x4a7d27[_0xb2f1fc(0x1ef)]}}),_0x27f1ed={'ticketData':{'userId':_0x398806['id'],'status':_0xb2f1fc(0x205)},'ticketId':_0x100845['id'],'companyId':_0x100845['companyId']};await(0x0,UpdateTicketService_1[_0xb2f1fc(0x214)])(_0x27f1ed);}await(0x0,exports['deleteAndCreateDialogStage'])(_0x560655,_0x4a7d27['id'],_0x100845);const _0x58637b=await sendDialog(_0x4a7d27,_0x560655,_0x100845);return _0x58637b;}}};function a620_0x58df(_0xf40f9d,_0x22da8c){const _0x111d4b=a620_0x111d();return a620_0x58df=function(_0x58df2b,_0x50cd04){_0x58df2b=_0x58df2b-0x1e9;let _0x23cd2a=_0x111d4b[_0x58df2b];return _0x23cd2a;},a620_0x58df(_0xf40f9d,_0x22da8c);}exports[a620_0x1a05ef(0x210)]=sayChatbot;