'use strict';const a600_0x2a3db2=a600_0x3ec3;function a600_0x13b2(){const _0x342a28=['number','companyId','whatsapp','defineProperty','../DialogChatBotsServices/CreateDialogChatBotsServices','1107148opwres','default','../DialogChatBotsServices/ShowDialogChatBotsServices','__esModule','name','../QueueService/ShowQueueService','*\x20-\x20','length','3450NdVNVo','chatbots','sendText','../../models/User','740553YcLzlv','findOne','forEach','options','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','24ZWeaVL','67222675LlyZtO','update','../FacebookServices/graphAPI','facebookUserToken','4467CfGUAh','open','../ChatBotServices/ShowChatBotByChatbotIdServices','72JxqPkQ','43990ExHUuD','886644dGYixg','../TicketServices/UpdateTicketService','greetingMessage','../WhatsappService/ShowWhatsAppService','../ChatBotServices/ShowChatBotServices','28089yVRmvA','1194WylccY','deleteAndCreateDialogStage','text','../../helpers/Mustache','150jhrDvl','test','3WlflaY'];a600_0x13b2=function(){return _0x342a28;};return a600_0x13b2();}(function(_0x38a9b2,_0x59ecad){const _0x47a855=a600_0x3ec3,_0x35db63=_0x38a9b2();while(!![]){try{const _0x535bda=-parseInt(_0x47a855(0x168))/0x1*(parseInt(_0x47a855(0x14a))/0x2)+parseInt(_0x47a855(0x14c))/0x3*(-parseInt(_0x47a855(0x16d))/0x4)+parseInt(_0x47a855(0x16c))/0x5*(-parseInt(_0x47a855(0x173))/0x6)+parseInt(_0x47a855(0x152))/0x7*(-parseInt(_0x47a855(0x163))/0x8)+-parseInt(_0x47a855(0x172))/0x9*(parseInt(_0x47a855(0x15a))/0xa)+-parseInt(_0x47a855(0x15e))/0xb*(parseInt(_0x47a855(0x16b))/0xc)+parseInt(_0x47a855(0x164))/0xd;if(_0x535bda===_0x59ecad)break;else _0x35db63['push'](_0x35db63['shift']());}catch(_0x2ffee0){_0x35db63['push'](_0x35db63['shift']());}}}(a600_0x13b2,0xddc18));var __importDefault=this&&this['__importDefault']||function(_0x43e5c3){const _0x245cb2=a600_0x3ec3;return _0x43e5c3&&_0x43e5c3[_0x245cb2(0x155)]?_0x43e5c3:{'default':_0x43e5c3};};Object[a600_0x2a3db2(0x150)](exports,a600_0x2a3db2(0x155),{'value':!![]}),exports['sayChatbot']=exports[a600_0x2a3db2(0x174)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require(a600_0x2a3db2(0x154))),ShowQueueService_1=__importDefault(require(a600_0x2a3db2(0x157))),ShowChatBotServices_1=__importDefault(require(a600_0x2a3db2(0x171))),DeleteDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/DeleteDialogChatBotsServices')),ShowChatBotByChatbotIdServices_1=__importDefault(require(a600_0x2a3db2(0x16a))),CreateDialogChatBotsServices_1=__importDefault(require(a600_0x2a3db2(0x151))),ShowWhatsAppService_1=__importDefault(require(a600_0x2a3db2(0x170))),Mustache_1=__importDefault(require(a600_0x2a3db2(0x149))),UpdateTicketService_1=__importDefault(require(a600_0x2a3db2(0x16e))),User_1=__importDefault(require(a600_0x2a3db2(0x15d))),graphAPI_1=require(a600_0x2a3db2(0x166)),isNumeric=_0x3ce2d9=>/^-?\d+$/[a600_0x2a3db2(0x14b)](_0x3ce2d9),deleteAndCreateDialogStage=async(_0x4f83c0,_0x49bbb0,_0x160345)=>{const _0x42d397=a600_0x2a3db2;try{await(0x0,DeleteDialogChatBotsServices_1[_0x42d397(0x153)])(_0x4f83c0['id']);const _0x16d327=await(0x0,ShowChatBotByChatbotIdServices_1[_0x42d397(0x153)])(_0x49bbb0);return!_0x16d327&&await _0x160345[_0x42d397(0x165)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x42d397(0x153)])({'awaiting':0x1,'contactId':_0x4f83c0['id'],'chatbotId':_0x49bbb0,'queueId':_0x16d327['queueId']});}catch(_0x2c0c2c){await _0x160345['update']({'isBot':![]});}};exports[a600_0x2a3db2(0x174)]=deleteAndCreateDialogStage;function a600_0x3ec3(_0x9de0de,_0xe29c92){const _0x13b213=a600_0x13b2();return a600_0x3ec3=function(_0x3ec32d,_0x474b86){_0x3ec32d=_0x3ec32d-0x149;let _0x253d4f=_0x13b213[_0x3ec32d];return _0x253d4f;},a600_0x3ec3(_0x9de0de,_0xe29c92);}const sendMessage=async(_0x52e7bb,_0x2d2400,_0x2365c1,_0x207ea6)=>{const _0x1d8bfc=a600_0x2a3db2,_0x408623=await(0x0,graphAPI_1[_0x1d8bfc(0x15c)])(_0x2d2400[_0x1d8bfc(0x14d)],(0x0,Mustache_1[_0x1d8bfc(0x153)])(_0x207ea6,_0x2365c1),_0x2365c1[_0x1d8bfc(0x14f)][_0x1d8bfc(0x167)]);},sendDialog=async(_0x2f143a,_0x319a6f,_0x181c33)=>{const _0x1d2a7f=a600_0x2a3db2,_0x159c81=await(0x0,ShowChatBotServices_1[_0x1d2a7f(0x153)])(_0x2f143a['id']);if(_0x159c81[_0x1d2a7f(0x161)]){let _0x1df24b='';_0x159c81[_0x1d2a7f(0x161)][_0x1d2a7f(0x160)]((_0x35ba38,_0x23bcdb)=>{const _0x570b17=_0x1d2a7f;_0x1df24b+='*'+(_0x23bcdb+0x1)+_0x570b17(0x158)+_0x35ba38[_0x570b17(0x156)]+'\x0a';});const _0x1c83db=_0x1df24b[_0x1d2a7f(0x159)]>0x0?_0x1df24b+_0x1d2a7f(0x162):_0x1df24b;if(_0x1df24b[_0x1d2a7f(0x159)]>0x0){const _0x5845a7='‎'+_0x2f143a[_0x1d2a7f(0x16f)]+'\x0a\x0a'+_0x1c83db,_0x1f286c=await(0x0,graphAPI_1['sendText'])(_0x319a6f[_0x1d2a7f(0x14d)],(0x0,Mustache_1[_0x1d2a7f(0x153)])(_0x5845a7,_0x181c33),_0x181c33[_0x1d2a7f(0x14f)][_0x1d2a7f(0x167)]);return _0x1f286c;}const _0x54d0e4='‎'+_0x2f143a[_0x1d2a7f(0x16f)],_0x514f93=await(0x0,graphAPI_1[_0x1d2a7f(0x15c)])(_0x319a6f[_0x1d2a7f(0x14d)],(0x0,Mustache_1['default'])(_0x54d0e4,_0x181c33),_0x181c33[_0x1d2a7f(0x14f)][_0x1d2a7f(0x167)]);return _0x514f93;}let _0x4dce38='';_0x159c81[_0x1d2a7f(0x161)][_0x1d2a7f(0x160)]((_0x4090dc,_0x2c3627)=>{const _0x4afd74=_0x1d2a7f;_0x4dce38+='*'+(_0x2c3627+0x1)+_0x4afd74(0x158)+_0x4090dc[_0x4afd74(0x156)]+'\x0a';});const _0x53ace5=_0x4dce38[_0x1d2a7f(0x159)]>0x0?_0x4dce38+_0x1d2a7f(0x162):_0x4dce38;if(_0x4dce38[_0x1d2a7f(0x159)]>0x0){const _0x49a7eb='‎'+_0x2f143a[_0x1d2a7f(0x16f)]+'\x0a\x0a'+_0x53ace5,_0x4f2326=await(0x0,graphAPI_1[_0x1d2a7f(0x15c)])(_0x319a6f[_0x1d2a7f(0x14d)],(0x0,Mustache_1[_0x1d2a7f(0x153)])(_0x49a7eb,_0x181c33),_0x181c33[_0x1d2a7f(0x14f)][_0x1d2a7f(0x167)]);return _0x4f2326;}const _0x2ef8a5='‎'+_0x2f143a[_0x1d2a7f(0x16f)],_0x467099=await(0x0,graphAPI_1[_0x1d2a7f(0x15c)])(_0x319a6f['number'],(0x0,Mustache_1[_0x1d2a7f(0x153)])(_0x2ef8a5,_0x181c33),_0x181c33[_0x1d2a7f(0x14f)]['facebookUserToken']);return _0x467099;},backToMainMenu=async(_0x26ba05,_0x4ebc6d,_0x3437da)=>{const _0x35cab8=a600_0x2a3db2;await(0x0,UpdateTicketService_1[_0x35cab8(0x153)])({'ticketData':{'queueId':null},'ticketId':_0x3437da['id'],'companyId':_0x3437da['companyId']});const {queues:_0xb94a9c,greetingMessage:_0x1e81dd}=await(0x0,ShowWhatsAppService_1[_0x35cab8(0x153)])(_0x26ba05['id'],_0x3437da[_0x35cab8(0x14e)]);let _0x6fbbe8='';_0xb94a9c['forEach']((_0x339751,_0x1de4b3)=>{const _0x4a9c83=_0x35cab8;_0x6fbbe8+='*'+(_0x1de4b3+0x1)+'*\x20-\x20'+_0x339751[_0x4a9c83(0x156)]+'\x0a';});const _0x4ac594=(0x0,Mustache_1['default'])('‎'+_0x1e81dd+'\x0a\x0a'+_0x6fbbe8,_0x3437da);await sendMessage(_0x26ba05,_0x4ebc6d,_0x3437da,_0x4ac594);const _0x8c0d08=await(0x0,DeleteDialogChatBotsServices_1[_0x35cab8(0x153)])(_0x4ebc6d['id']);return _0x8c0d08;},sayChatbot=async(_0x2971b6,_0x24f3ef,_0x447488,_0x577f02,_0x24a677)=>{const _0xbea656=a600_0x2a3db2,_0x261bf1=_0x24a677[_0xbea656(0x175)];if(!_0x2971b6&&_0x261bf1&&_0x24a677['is_echo'])return;const _0x100ba0=await(0x0,ShowDialogChatBotsServices_1[_0xbea656(0x153)])(_0x577f02['id']);if(_0x261bf1==='#'){const _0x2cf5d0=await backToMainMenu(_0x24f3ef,_0x577f02,_0x447488);return _0x2cf5d0;}if(!_0x100ba0){const _0x4c42bd=await(0x0,ShowQueueService_1[_0xbea656(0x153)])(_0x2971b6,_0x447488[_0xbea656(0x14e)]),_0x24c5be=_0x24a677['text'],_0x17df5f=_0x4c42bd[_0xbea656(0x15b)][+_0x24c5be-0x1];if(!_0x17df5f?.[_0xbea656(0x16f)]){await(0x0,DeleteDialogChatBotsServices_1[_0xbea656(0x153)])(_0x577f02['id']);return;}if(_0x17df5f){if(_0x17df5f['isAgent']){const _0x42f764=await User_1['default']['findOne']({'where':{'name':_0x17df5f[_0xbea656(0x156)]}}),_0x235f2c={'ticketData':{'userId':_0x42f764['id'],'status':_0xbea656(0x169)},'ticketId':_0x447488['id'],'companyId':_0x447488[_0xbea656(0x14e)]};await(0x0,UpdateTicketService_1[_0xbea656(0x153)])(_0x235f2c);}await(0x0,exports[_0xbea656(0x174)])(_0x577f02,_0x17df5f['id'],_0x447488);const _0x2f3b3d=await sendDialog(_0x17df5f,_0x577f02,_0x447488);return _0x2f3b3d;}}if(_0x100ba0){const _0x2e4b58=isNumeric(_0x261bf1)?_0x261bf1:0x1,_0x5e44d1=await(0x0,ShowChatBotServices_1['default'])(_0x100ba0['chatbotId']),_0x2df458=_0x5e44d1[_0xbea656(0x161)][+_0x2e4b58-0x1]?_0x5e44d1['options'][+_0x2e4b58-0x1]:_0x5e44d1[_0xbea656(0x161)][0x0];if(!_0x2df458[_0xbea656(0x16f)]){await(0x0,DeleteDialogChatBotsServices_1[_0xbea656(0x153)])(_0x577f02['id']);return;}if(_0x2df458){if(_0x2df458['isAgent']){const _0x2d26eb=await User_1[_0xbea656(0x153)][_0xbea656(0x15f)]({'where':{'name':_0x2df458['name']}}),_0xc3ca9c={'ticketData':{'userId':_0x2d26eb['id'],'status':_0xbea656(0x169)},'ticketId':_0x447488['id'],'companyId':_0x447488['companyId']};await(0x0,UpdateTicketService_1['default'])(_0xc3ca9c);}await(0x0,exports[_0xbea656(0x174)])(_0x577f02,_0x2df458['id'],_0x447488);const _0x2ac019=await sendDialog(_0x2df458,_0x577f02,_0x447488);return _0x2ac019;}}};exports['sayChatbot']=sayChatbot;