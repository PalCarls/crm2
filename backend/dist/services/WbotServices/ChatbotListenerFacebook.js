'use strict';const a536_0x417147=a536_0x2cb4;(function(_0x628b7f,_0x17484c){const _0x32380e=a536_0x2cb4,_0x429437=_0x628b7f();while(!![]){try{const _0x42bc8a=-parseInt(_0x32380e(0x1df))/0x1+parseInt(_0x32380e(0x1d7))/0x2+parseInt(_0x32380e(0x1d6))/0x3+parseInt(_0x32380e(0x1ca))/0x4*(parseInt(_0x32380e(0x1dc))/0x5)+-parseInt(_0x32380e(0x1d0))/0x6+parseInt(_0x32380e(0x1de))/0x7+parseInt(_0x32380e(0x1d4))/0x8*(-parseInt(_0x32380e(0x1cd))/0x9);if(_0x42bc8a===_0x17484c)break;else _0x429437['push'](_0x429437['shift']());}catch(_0xfe67c5){_0x429437['push'](_0x429437['shift']());}}}(a536_0x15af,0xa1ac0));var __importDefault=this&&this[a536_0x417147(0x1c3)]||function(_0x56cdda){return _0x56cdda&&_0x56cdda['__esModule']?_0x56cdda:{'default':_0x56cdda};};Object[a536_0x417147(0x1cf)](exports,'__esModule',{'value':!![]}),exports[a536_0x417147(0x1c4)]=exports[a536_0x417147(0x1dd)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/ShowDialogChatBotsServices')),ShowQueueService_1=__importDefault(require('../QueueService/ShowQueueService')),ShowChatBotServices_1=__importDefault(require('../ChatBotServices/ShowChatBotServices')),DeleteDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/DeleteDialogChatBotsServices')),ShowChatBotByChatbotIdServices_1=__importDefault(require('../ChatBotServices/ShowChatBotByChatbotIdServices')),CreateDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/CreateDialogChatBotsServices')),ShowWhatsAppService_1=__importDefault(require(a536_0x417147(0x1cc))),Mustache_1=__importDefault(require(a536_0x417147(0x1d3))),UpdateTicketService_1=__importDefault(require(a536_0x417147(0x1c7))),User_1=__importDefault(require('../../models/User')),graphAPI_1=require(a536_0x417147(0x1e3)),isNumeric=_0x23b868=>/^-?\d+$/['test'](_0x23b868),deleteAndCreateDialogStage=async(_0x17ae77,_0x1fc93a,_0x432ab9)=>{const _0x33b012=a536_0x417147;try{await(0x0,DeleteDialogChatBotsServices_1[_0x33b012(0x1c1)])(_0x17ae77['id']);const _0x3ffb1a=await(0x0,ShowChatBotByChatbotIdServices_1[_0x33b012(0x1c1)])(_0x1fc93a);return!_0x3ffb1a&&await _0x432ab9['update']({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x33b012(0x1c1)])({'awaiting':0x1,'contactId':_0x17ae77['id'],'chatbotId':_0x1fc93a,'queueId':_0x3ffb1a[_0x33b012(0x1d9)]});}catch(_0x17591c){await _0x432ab9['update']({'isBot':![]});}};exports[a536_0x417147(0x1dd)]=deleteAndCreateDialogStage;function a536_0x15af(){const _0x1985c5=['isAgent','open','12992SMqbqn','companyId','../WhatsappService/ShowWhatsAppService','117BnniVP','chatbots','defineProperty','5100240mORYkV','findOne','chatbotId','../../helpers/Mustache','251368WSwSdH','greetingMessage','1506363WmUfmq','797436alDlVb','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','queueId','*\x20-\x20','whatsapp','1975JQnXel','deleteAndCreateDialogStage','2617125sGXiLS','636953YoSHwM','text','number','sendText','../FacebookServices/graphAPI','length','name','default','facebookUserToken','__importDefault','sayChatbot','options','forEach','../TicketServices/UpdateTicketService'];a536_0x15af=function(){return _0x1985c5;};return a536_0x15af();}const sendMessage=async(_0x174d6c,_0x50f59c,_0x35146e,_0x52575b)=>{const _0x25ef12=a536_0x417147,_0x554a41=await(0x0,graphAPI_1['sendText'])(_0x50f59c['number'],(0x0,Mustache_1[_0x25ef12(0x1c1)])(_0x52575b,_0x35146e),_0x35146e[_0x25ef12(0x1db)][_0x25ef12(0x1c2)]);},sendDialog=async(_0x511553,_0x1c9d4e,_0x2802b1)=>{const _0xa25636=a536_0x417147,_0x27aeda=await(0x0,ShowChatBotServices_1[_0xa25636(0x1c1)])(_0x511553['id']);if(_0x27aeda[_0xa25636(0x1c5)]){let _0x57df09='';_0x27aeda[_0xa25636(0x1c5)][_0xa25636(0x1c6)]((_0x1cb1b9,_0x1a81ec)=>{_0x57df09+='*'+(_0x1a81ec+0x1)+'*\x20-\x20'+_0x1cb1b9['name']+'\x0a';});const _0x240ac0=_0x57df09[_0xa25636(0x1e4)]>0x0?_0x57df09+_0xa25636(0x1d8):_0x57df09;if(_0x57df09[_0xa25636(0x1e4)]>0x0){const _0x4d8373='‎'+_0x511553[_0xa25636(0x1d5)]+'\x0a\x0a'+_0x240ac0,_0x1dd7d3=await(0x0,graphAPI_1[_0xa25636(0x1e2)])(_0x1c9d4e[_0xa25636(0x1e1)],(0x0,Mustache_1[_0xa25636(0x1c1)])(_0x4d8373,_0x2802b1),_0x2802b1['whatsapp'][_0xa25636(0x1c2)]);return _0x1dd7d3;}const _0x4a336c='‎'+_0x511553[_0xa25636(0x1d5)],_0x495a9a=await(0x0,graphAPI_1[_0xa25636(0x1e2)])(_0x1c9d4e[_0xa25636(0x1e1)],(0x0,Mustache_1[_0xa25636(0x1c1)])(_0x4a336c,_0x2802b1),_0x2802b1[_0xa25636(0x1db)][_0xa25636(0x1c2)]);return _0x495a9a;}let _0x3e07be='';_0x27aeda[_0xa25636(0x1c5)]['forEach']((_0x56fe41,_0x5f21ec)=>{const _0x5f490e=_0xa25636;_0x3e07be+='*'+(_0x5f21ec+0x1)+_0x5f490e(0x1da)+_0x56fe41[_0x5f490e(0x1e5)]+'\x0a';});const _0x3b624c=_0x3e07be[_0xa25636(0x1e4)]>0x0?_0x3e07be+_0xa25636(0x1d8):_0x3e07be;if(_0x3e07be[_0xa25636(0x1e4)]>0x0){const _0x529865='‎'+_0x511553['greetingMessage']+'\x0a\x0a'+_0x3b624c,_0x29a3fe=await(0x0,graphAPI_1[_0xa25636(0x1e2)])(_0x1c9d4e[_0xa25636(0x1e1)],(0x0,Mustache_1[_0xa25636(0x1c1)])(_0x529865,_0x2802b1),_0x2802b1['whatsapp'][_0xa25636(0x1c2)]);return _0x29a3fe;}const _0x27f3ab='‎'+_0x511553[_0xa25636(0x1d5)],_0x3322d4=await(0x0,graphAPI_1['sendText'])(_0x1c9d4e[_0xa25636(0x1e1)],(0x0,Mustache_1[_0xa25636(0x1c1)])(_0x27f3ab,_0x2802b1),_0x2802b1[_0xa25636(0x1db)][_0xa25636(0x1c2)]);return _0x3322d4;},backToMainMenu=async(_0x516d9b,_0x33b3ac,_0x260b61)=>{const _0x4bf317=a536_0x417147;await(0x0,UpdateTicketService_1[_0x4bf317(0x1c1)])({'ticketData':{'queueId':null},'ticketId':_0x260b61['id'],'companyId':_0x260b61['companyId']});const {queues:_0x5e4db2,greetingMessage:_0x45598a}=await(0x0,ShowWhatsAppService_1[_0x4bf317(0x1c1)])(_0x516d9b['id'],_0x260b61[_0x4bf317(0x1cb)]);let _0x56b538='';_0x5e4db2[_0x4bf317(0x1c6)]((_0x1cbc7f,_0x47d13c)=>{const _0x48b4bc=_0x4bf317;_0x56b538+='*'+(_0x47d13c+0x1)+_0x48b4bc(0x1da)+_0x1cbc7f[_0x48b4bc(0x1e5)]+'\x0a';});const _0x3f6f48=(0x0,Mustache_1['default'])('‎'+_0x45598a+'\x0a\x0a'+_0x56b538,_0x260b61);await sendMessage(_0x516d9b,_0x33b3ac,_0x260b61,_0x3f6f48);const _0x4334cd=await(0x0,DeleteDialogChatBotsServices_1[_0x4bf317(0x1c1)])(_0x33b3ac['id']);return _0x4334cd;},sayChatbot=async(_0x1eca20,_0x1bd843,_0x2a40fe,_0x150b7c,_0x190cd2)=>{const _0x201d94=a536_0x417147,_0xcafc55=_0x190cd2[_0x201d94(0x1e0)];if(!_0x1eca20&&_0xcafc55&&_0x190cd2['is_echo'])return;const _0x381817=await(0x0,ShowDialogChatBotsServices_1[_0x201d94(0x1c1)])(_0x150b7c['id']);if(_0xcafc55==='#'){const _0x597674=await backToMainMenu(_0x1bd843,_0x150b7c,_0x2a40fe);return _0x597674;}if(!_0x381817){const _0x22eae0=await(0x0,ShowQueueService_1[_0x201d94(0x1c1)])(_0x1eca20,_0x2a40fe['companyId']),_0x3a963a=_0x190cd2['text'],_0x5299b7=_0x22eae0[_0x201d94(0x1ce)][+_0x3a963a-0x1];if(!_0x5299b7?.[_0x201d94(0x1d5)]){await(0x0,DeleteDialogChatBotsServices_1[_0x201d94(0x1c1)])(_0x150b7c['id']);return;}if(_0x5299b7){if(_0x5299b7[_0x201d94(0x1c8)]){const _0x1c5f31=await User_1[_0x201d94(0x1c1)][_0x201d94(0x1d1)]({'where':{'name':_0x5299b7[_0x201d94(0x1e5)]}}),_0x34cc82={'ticketData':{'userId':_0x1c5f31['id'],'status':_0x201d94(0x1c9)},'ticketId':_0x2a40fe['id'],'companyId':_0x2a40fe[_0x201d94(0x1cb)]};await(0x0,UpdateTicketService_1[_0x201d94(0x1c1)])(_0x34cc82);}await(0x0,exports[_0x201d94(0x1dd)])(_0x150b7c,_0x5299b7['id'],_0x2a40fe);const _0x4c7f61=await sendDialog(_0x5299b7,_0x150b7c,_0x2a40fe);return _0x4c7f61;}}if(_0x381817){const _0x4176e5=isNumeric(_0xcafc55)?_0xcafc55:0x1,_0x582be4=await(0x0,ShowChatBotServices_1[_0x201d94(0x1c1)])(_0x381817[_0x201d94(0x1d2)]),_0x4469a0=_0x582be4['options'][+_0x4176e5-0x1]?_0x582be4['options'][+_0x4176e5-0x1]:_0x582be4[_0x201d94(0x1c5)][0x0];if(!_0x4469a0[_0x201d94(0x1d5)]){await(0x0,DeleteDialogChatBotsServices_1[_0x201d94(0x1c1)])(_0x150b7c['id']);return;}if(_0x4469a0){if(_0x4469a0[_0x201d94(0x1c8)]){const _0x54576d=await User_1[_0x201d94(0x1c1)]['findOne']({'where':{'name':_0x4469a0[_0x201d94(0x1e5)]}}),_0x9f5aee={'ticketData':{'userId':_0x54576d['id'],'status':_0x201d94(0x1c9)},'ticketId':_0x2a40fe['id'],'companyId':_0x2a40fe[_0x201d94(0x1cb)]};await(0x0,UpdateTicketService_1['default'])(_0x9f5aee);}await(0x0,exports[_0x201d94(0x1dd)])(_0x150b7c,_0x4469a0['id'],_0x2a40fe);const _0x561449=await sendDialog(_0x4469a0,_0x150b7c,_0x2a40fe);return _0x561449;}}};function a536_0x2cb4(_0x40db0d,_0x1c3bce){const _0x15af25=a536_0x15af();return a536_0x2cb4=function(_0x2cb410,_0x29db7b){_0x2cb410=_0x2cb410-0x1c1;let _0x55d8e8=_0x15af25[_0x2cb410];return _0x55d8e8;},a536_0x2cb4(_0x40db0d,_0x1c3bce);}exports[a536_0x417147(0x1c4)]=sayChatbot;