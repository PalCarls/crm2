'use strict';const a517_0x22d1bc=a517_0xa74c;(function(_0x19fc90,_0x8b0036){const _0x4f5f97=a517_0xa74c,_0x15b467=_0x19fc90();while(!![]){try{const _0x30c47c=parseInt(_0x4f5f97(0x1cb))/0x1*(-parseInt(_0x4f5f97(0x1c6))/0x2)+-parseInt(_0x4f5f97(0x1e4))/0x3*(-parseInt(_0x4f5f97(0x1d5))/0x4)+-parseInt(_0x4f5f97(0x1db))/0x5*(-parseInt(_0x4f5f97(0x1dd))/0x6)+-parseInt(_0x4f5f97(0x1ec))/0x7+-parseInt(_0x4f5f97(0x1c4))/0x8+-parseInt(_0x4f5f97(0x1e8))/0x9+parseInt(_0x4f5f97(0x1ea))/0xa;if(_0x30c47c===_0x8b0036)break;else _0x15b467['push'](_0x15b467['shift']());}catch(_0x11a0dc){_0x15b467['push'](_0x15b467['shift']());}}}(a517_0x3db5,0x3c083));var __importDefault=this&&this[a517_0x22d1bc(0x1d9)]||function(_0x53f5a5){return _0x53f5a5&&_0x53f5a5['__esModule']?_0x53f5a5:{'default':_0x53f5a5};};Object[a517_0x22d1bc(0x1e6)](exports,a517_0x22d1bc(0x1e2),{'value':!![]}),exports['sayChatbot']=exports[a517_0x22d1bc(0x1d2)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require(a517_0x22d1bc(0x1e7))),ShowQueueService_1=__importDefault(require('../QueueService/ShowQueueService')),ShowChatBotServices_1=__importDefault(require(a517_0x22d1bc(0x1ce))),DeleteDialogChatBotsServices_1=__importDefault(require(a517_0x22d1bc(0x1cd))),ShowChatBotByChatbotIdServices_1=__importDefault(require('../ChatBotServices/ShowChatBotByChatbotIdServices')),CreateDialogChatBotsServices_1=__importDefault(require(a517_0x22d1bc(0x1d0))),ShowWhatsAppService_1=__importDefault(require(a517_0x22d1bc(0x1c3))),Mustache_1=__importDefault(require('../../helpers/Mustache')),UpdateTicketService_1=__importDefault(require(a517_0x22d1bc(0x1d4))),User_1=__importDefault(require('../../models/User')),graphAPI_1=require(a517_0x22d1bc(0x1ed)),isNumeric=_0x45b840=>/^-?\d+$/[a517_0x22d1bc(0x1c8)](_0x45b840),deleteAndCreateDialogStage=async(_0x14a653,_0x4d64af,_0x4ce8d8)=>{const _0x289dbb=a517_0x22d1bc;try{await(0x0,DeleteDialogChatBotsServices_1[_0x289dbb(0x1e1)])(_0x14a653['id']);const _0x574992=await(0x0,ShowChatBotByChatbotIdServices_1[_0x289dbb(0x1e1)])(_0x4d64af);return!_0x574992&&await _0x4ce8d8[_0x289dbb(0x1cf)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x289dbb(0x1e1)])({'awaiting':0x1,'contactId':_0x14a653['id'],'chatbotId':_0x4d64af,'queueId':_0x574992[_0x289dbb(0x1e3)]});}catch(_0x274f33){await _0x4ce8d8[_0x289dbb(0x1cf)]({'isBot':![]});}};function a517_0xa74c(_0x4aa6fd,_0x52186d){const _0x3db505=a517_0x3db5();return a517_0xa74c=function(_0xa74c91,_0x16809b){_0xa74c91=_0xa74c91-0x1c3;let _0x14f9f1=_0x3db505[_0xa74c91];return _0x14f9f1;},a517_0xa74c(_0x4aa6fd,_0x52186d);}exports[a517_0x22d1bc(0x1d2)]=deleteAndCreateDialogStage;const sendMessage=async(_0x37639e,_0x1ea7a1,_0x25b660,_0x58da32)=>{const _0x14c822=a517_0x22d1bc,_0x533f94=await(0x0,graphAPI_1[_0x14c822(0x1c9)])(_0x1ea7a1[_0x14c822(0x1ca)],(0x0,Mustache_1['default'])(_0x58da32,_0x25b660),_0x25b660['whatsapp'][_0x14c822(0x1d8)]);},sendDialog=async(_0x243062,_0x3b7d2f,_0x49c896)=>{const _0x46140b=a517_0x22d1bc,_0x359936=await(0x0,ShowChatBotServices_1[_0x46140b(0x1e1)])(_0x243062['id']);if(_0x359936[_0x46140b(0x1da)]){let _0x357eff='';_0x359936['options'][_0x46140b(0x1e0)]((_0x227f13,_0x44e30f)=>{const _0x319661=_0x46140b;_0x357eff+='*'+(_0x44e30f+0x1)+_0x319661(0x1d3)+_0x227f13['name']+'\x0a';});const _0x282c94=_0x357eff[_0x46140b(0x1d6)]>0x0?_0x357eff+_0x46140b(0x1d7):_0x357eff;if(_0x357eff['length']>0x0){const _0x770324='‎'+_0x243062[_0x46140b(0x1d1)]+'\x0a\x0a'+_0x282c94,_0xc17d24=await(0x0,graphAPI_1[_0x46140b(0x1c9)])(_0x3b7d2f[_0x46140b(0x1ca)],(0x0,Mustache_1[_0x46140b(0x1e1)])(_0x770324,_0x49c896),_0x49c896[_0x46140b(0x1e5)]['facebookUserToken']);return _0xc17d24;}const _0x4a7ba4='‎'+_0x243062[_0x46140b(0x1d1)],_0x3b1099=await(0x0,graphAPI_1['sendText'])(_0x3b7d2f['number'],(0x0,Mustache_1[_0x46140b(0x1e1)])(_0x4a7ba4,_0x49c896),_0x49c896[_0x46140b(0x1e5)][_0x46140b(0x1d8)]);return _0x3b1099;}let _0x557321='';_0x359936[_0x46140b(0x1da)]['forEach']((_0x10ccfd,_0x36bf9c)=>{const _0x4e7816=_0x46140b;_0x557321+='*'+(_0x36bf9c+0x1)+_0x4e7816(0x1d3)+_0x10ccfd['name']+'\x0a';});const _0x2ffc45=_0x557321[_0x46140b(0x1d6)]>0x0?_0x557321+_0x46140b(0x1d7):_0x557321;if(_0x557321[_0x46140b(0x1d6)]>0x0){const _0x4bb794='‎'+_0x243062[_0x46140b(0x1d1)]+'\x0a\x0a'+_0x2ffc45,_0x2833d7=await(0x0,graphAPI_1[_0x46140b(0x1c9)])(_0x3b7d2f['number'],(0x0,Mustache_1['default'])(_0x4bb794,_0x49c896),_0x49c896[_0x46140b(0x1e5)]['facebookUserToken']);return _0x2833d7;}const _0x5b74c0='‎'+_0x243062[_0x46140b(0x1d1)],_0x4c1f61=await(0x0,graphAPI_1[_0x46140b(0x1c9)])(_0x3b7d2f['number'],(0x0,Mustache_1[_0x46140b(0x1e1)])(_0x5b74c0,_0x49c896),_0x49c896[_0x46140b(0x1e5)][_0x46140b(0x1d8)]);return _0x4c1f61;},backToMainMenu=async(_0x41f8a8,_0x1835e9,_0x523191)=>{const _0x4ce91c=a517_0x22d1bc;await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null},'ticketId':_0x523191['id'],'companyId':_0x523191[_0x4ce91c(0x1cc)]});const {queues:_0x446938,greetingMessage:_0x337736}=await(0x0,ShowWhatsAppService_1[_0x4ce91c(0x1e1)])(_0x41f8a8['id'],_0x523191[_0x4ce91c(0x1cc)]);let _0x5078f2='';_0x446938[_0x4ce91c(0x1e0)]((_0x271b0b,_0x111799)=>{const _0xcc225c=_0x4ce91c;_0x5078f2+='*'+(_0x111799+0x1)+_0xcc225c(0x1d3)+_0x271b0b[_0xcc225c(0x1c5)]+'\x0a';});const _0x56b474=(0x0,Mustache_1[_0x4ce91c(0x1e1)])('‎'+_0x337736+'\x0a\x0a'+_0x5078f2,_0x523191);await sendMessage(_0x41f8a8,_0x1835e9,_0x523191,_0x56b474);const _0x52e7c1=await(0x0,DeleteDialogChatBotsServices_1[_0x4ce91c(0x1e1)])(_0x1835e9['id']);return _0x52e7c1;},sayChatbot=async(_0xfb5556,_0x4db64c,_0x4d29c4,_0x1a2434,_0xd9a952)=>{const _0x8d78c4=a517_0x22d1bc,_0x16702e=_0xd9a952[_0x8d78c4(0x1dc)];if(!_0xfb5556&&_0x16702e&&_0xd9a952[_0x8d78c4(0x1e9)])return;const _0x17ff11=await(0x0,ShowDialogChatBotsServices_1['default'])(_0x1a2434['id']);if(_0x16702e==='#'){const _0x357068=await backToMainMenu(_0x4db64c,_0x1a2434,_0x4d29c4);return _0x357068;}if(!_0x17ff11){const _0x228cdf=await(0x0,ShowQueueService_1['default'])(_0xfb5556,_0x4d29c4[_0x8d78c4(0x1cc)]),_0xa5d8a4=_0xd9a952[_0x8d78c4(0x1dc)],_0x9da10d=_0x228cdf['chatbots'][+_0xa5d8a4-0x1];if(!_0x9da10d?.[_0x8d78c4(0x1d1)]){await(0x0,DeleteDialogChatBotsServices_1[_0x8d78c4(0x1e1)])(_0x1a2434['id']);return;}if(_0x9da10d){if(_0x9da10d[_0x8d78c4(0x1de)]){const _0x29148e=await User_1['default'][_0x8d78c4(0x1ee)]({'where':{'name':_0x9da10d[_0x8d78c4(0x1c5)]}}),_0x147fbb={'ticketData':{'userId':_0x29148e['id'],'status':_0x8d78c4(0x1eb)},'ticketId':_0x4d29c4['id'],'companyId':_0x4d29c4[_0x8d78c4(0x1cc)]};await(0x0,UpdateTicketService_1[_0x8d78c4(0x1e1)])(_0x147fbb);}await(0x0,exports[_0x8d78c4(0x1d2)])(_0x1a2434,_0x9da10d['id'],_0x4d29c4);const _0x2bd461=await sendDialog(_0x9da10d,_0x1a2434,_0x4d29c4);return _0x2bd461;}}if(_0x17ff11){const _0x49be3b=isNumeric(_0x16702e)?_0x16702e:0x1,_0x1df69b=await(0x0,ShowChatBotServices_1[_0x8d78c4(0x1e1)])(_0x17ff11[_0x8d78c4(0x1c7)]),_0x33044c=_0x1df69b['options'][+_0x49be3b-0x1]?_0x1df69b[_0x8d78c4(0x1da)][+_0x49be3b-0x1]:_0x1df69b[_0x8d78c4(0x1da)][0x0];if(!_0x33044c[_0x8d78c4(0x1d1)]){await(0x0,DeleteDialogChatBotsServices_1[_0x8d78c4(0x1e1)])(_0x1a2434['id']);return;}if(_0x33044c){if(_0x33044c[_0x8d78c4(0x1de)]){const _0x908836=await User_1[_0x8d78c4(0x1e1)][_0x8d78c4(0x1ee)]({'where':{'name':_0x33044c[_0x8d78c4(0x1c5)]}}),_0x3eb61e={'ticketData':{'userId':_0x908836['id'],'status':_0x8d78c4(0x1eb)},'ticketId':_0x4d29c4['id'],'companyId':_0x4d29c4[_0x8d78c4(0x1cc)]};await(0x0,UpdateTicketService_1[_0x8d78c4(0x1e1)])(_0x3eb61e);}await(0x0,exports['deleteAndCreateDialogStage'])(_0x1a2434,_0x33044c['id'],_0x4d29c4);const _0x3f4220=await sendDialog(_0x33044c,_0x1a2434,_0x4d29c4);return _0x3f4220;}}};exports[a517_0x22d1bc(0x1df)]=sayChatbot;function a517_0x3db5(){const _0x5632db=['2331621kPROWx','is_echo','7824220CFzDVW','open','3180583HWOIdT','../FacebookServices/graphAPI','findOne','../WhatsappService/ShowWhatsAppService','517896zVnUTY','name','90ESGKSG','chatbotId','test','sendText','number','4916bdikRE','companyId','../DialogChatBotsServices/DeleteDialogChatBotsServices','../ChatBotServices/ShowChatBotServices','update','../DialogChatBotsServices/CreateDialogChatBotsServices','greetingMessage','deleteAndCreateDialogStage','*\x20-\x20','../TicketServices/UpdateTicketService','8PsRmIn','length','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','facebookUserToken','__importDefault','options','74135AsECLG','text','48oYiwkB','isAgent','sayChatbot','forEach','default','__esModule','queueId','516372XJirtt','whatsapp','defineProperty','../DialogChatBotsServices/ShowDialogChatBotsServices'];a517_0x3db5=function(){return _0x5632db;};return a517_0x3db5();}