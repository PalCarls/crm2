'use strict';const a612_0x396338=a612_0x4d37;function a612_0x4d37(_0x30d653,_0x16675e){const _0x2a02e3=a612_0x2a02();return a612_0x4d37=function(_0x4d3789,_0x368bd7){_0x4d3789=_0x4d3789-0x1be;let _0x362799=_0x2a02e3[_0x4d3789];return _0x362799;},a612_0x4d37(_0x30d653,_0x16675e);}(function(_0xa8d4fb,_0x222a0c){const _0x1b4da2=a612_0x4d37,_0x4af335=_0xa8d4fb();while(!![]){try{const _0x4f6e04=parseInt(_0x1b4da2(0x1d0))/0x1+-parseInt(_0x1b4da2(0x1d9))/0x2*(-parseInt(_0x1b4da2(0x1dd))/0x3)+parseInt(_0x1b4da2(0x1d3))/0x4*(-parseInt(_0x1b4da2(0x1e8))/0x5)+-parseInt(_0x1b4da2(0x1c9))/0x6*(-parseInt(_0x1b4da2(0x1ca))/0x7)+-parseInt(_0x1b4da2(0x1dc))/0x8*(-parseInt(_0x1b4da2(0x1e3))/0x9)+-parseInt(_0x1b4da2(0x1c7))/0xa+parseInt(_0x1b4da2(0x1bf))/0xb*(-parseInt(_0x1b4da2(0x1c4))/0xc);if(_0x4f6e04===_0x222a0c)break;else _0x4af335['push'](_0x4af335['shift']());}catch(_0x16de80){_0x4af335['push'](_0x4af335['shift']());}}}(a612_0x2a02,0x35cc5));function a612_0x2a02(){const _0xd8cbb7=['greetingMessage','deleteAndCreateDialogStage','update','text','9351mrLGhL','../../models/User','open','../TicketServices/UpdateTicketService','options','419135LRDyAZ','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','../ChatBotServices/ShowChatBotByChatbotIdServices','../DialogChatBotsServices/CreateDialogChatBotsServices','7179766unwvpO','../../helpers/Mustache','isAgent','findOne','../FacebookServices/graphAPI','12NmfBEA','test','../DialogChatBotsServices/DeleteDialogChatBotsServices','1155680wncqDD','default','132mTIrKB','36337XosREU','length','companyId','name','sendText','__esModule','425482oohjAT','number','facebookUserToken','4bOEUZh','whatsapp','queueId','is_echo','../WhatsappService/ShowWhatsAppService','chatbotId','6038hMzykK','forEach','*\x20-\x20','1336Tohgcd','357CgwiMq','sayChatbot'];a612_0x2a02=function(){return _0xd8cbb7;};return a612_0x2a02();}var __importDefault=this&&this['__importDefault']||function(_0x16befb){const _0x4cf56c=a612_0x4d37;return _0x16befb&&_0x16befb[_0x4cf56c(0x1cf)]?_0x16befb:{'default':_0x16befb};};Object['defineProperty'](exports,a612_0x396338(0x1cf),{'value':!![]}),exports[a612_0x396338(0x1de)]=exports[a612_0x396338(0x1e0)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/ShowDialogChatBotsServices')),ShowQueueService_1=__importDefault(require('../QueueService/ShowQueueService')),ShowChatBotServices_1=__importDefault(require('../ChatBotServices/ShowChatBotServices')),DeleteDialogChatBotsServices_1=__importDefault(require(a612_0x396338(0x1c6))),ShowChatBotByChatbotIdServices_1=__importDefault(require(a612_0x396338(0x1ea))),CreateDialogChatBotsServices_1=__importDefault(require(a612_0x396338(0x1be))),ShowWhatsAppService_1=__importDefault(require(a612_0x396338(0x1d7))),Mustache_1=__importDefault(require(a612_0x396338(0x1c0))),UpdateTicketService_1=__importDefault(require(a612_0x396338(0x1e6))),User_1=__importDefault(require(a612_0x396338(0x1e4))),graphAPI_1=require(a612_0x396338(0x1c3)),isNumeric=_0x593dbd=>/^-?\d+$/[a612_0x396338(0x1c5)](_0x593dbd),deleteAndCreateDialogStage=async(_0x39b031,_0x2e9007,_0x1c1794)=>{const _0xe69e95=a612_0x396338;try{await(0x0,DeleteDialogChatBotsServices_1[_0xe69e95(0x1c8)])(_0x39b031['id']);const _0x5ee731=await(0x0,ShowChatBotByChatbotIdServices_1['default'])(_0x2e9007);return!_0x5ee731&&await _0x1c1794[_0xe69e95(0x1e1)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1['default'])({'awaiting':0x1,'contactId':_0x39b031['id'],'chatbotId':_0x2e9007,'queueId':_0x5ee731[_0xe69e95(0x1d5)]});}catch(_0x3084aa){await _0x1c1794['update']({'isBot':![]});}};exports[a612_0x396338(0x1e0)]=deleteAndCreateDialogStage;const sendMessage=async(_0xafbbf7,_0x104888,_0x457233,_0x560392)=>{const _0x21d1d7=a612_0x396338,_0x42e6df=await(0x0,graphAPI_1[_0x21d1d7(0x1ce)])(_0x104888[_0x21d1d7(0x1d1)],(0x0,Mustache_1['default'])(_0x560392,_0x457233),_0x457233[_0x21d1d7(0x1d4)][_0x21d1d7(0x1d2)]);},sendDialog=async(_0x38a8d8,_0x17bb1a,_0xbdabcc)=>{const _0x4cb7ed=a612_0x396338,_0x48e896=await(0x0,ShowChatBotServices_1[_0x4cb7ed(0x1c8)])(_0x38a8d8['id']);if(_0x48e896[_0x4cb7ed(0x1e7)]){let _0x2db151='';_0x48e896[_0x4cb7ed(0x1e7)]['forEach']((_0x240e90,_0x5782e8)=>{const _0x4a8c8d=_0x4cb7ed;_0x2db151+='*'+(_0x5782e8+0x1)+_0x4a8c8d(0x1db)+_0x240e90[_0x4a8c8d(0x1cd)]+'\x0a';});const _0x39c6fc=_0x2db151['length']>0x0?_0x2db151+_0x4cb7ed(0x1e9):_0x2db151;if(_0x2db151[_0x4cb7ed(0x1cb)]>0x0){const _0x41b313='‎'+_0x38a8d8[_0x4cb7ed(0x1df)]+'\x0a\x0a'+_0x39c6fc,_0x2f1ecc=await(0x0,graphAPI_1['sendText'])(_0x17bb1a['number'],(0x0,Mustache_1[_0x4cb7ed(0x1c8)])(_0x41b313,_0xbdabcc),_0xbdabcc[_0x4cb7ed(0x1d4)][_0x4cb7ed(0x1d2)]);return _0x2f1ecc;}const _0x37584a='‎'+_0x38a8d8[_0x4cb7ed(0x1df)],_0x306023=await(0x0,graphAPI_1[_0x4cb7ed(0x1ce)])(_0x17bb1a[_0x4cb7ed(0x1d1)],(0x0,Mustache_1[_0x4cb7ed(0x1c8)])(_0x37584a,_0xbdabcc),_0xbdabcc[_0x4cb7ed(0x1d4)][_0x4cb7ed(0x1d2)]);return _0x306023;}let _0x2a5a3c='';_0x48e896[_0x4cb7ed(0x1e7)]['forEach']((_0x16fdbd,_0x464527)=>{const _0x5c23e8=_0x4cb7ed;_0x2a5a3c+='*'+(_0x464527+0x1)+_0x5c23e8(0x1db)+_0x16fdbd['name']+'\x0a';});const _0x48421a=_0x2a5a3c[_0x4cb7ed(0x1cb)]>0x0?_0x2a5a3c+_0x4cb7ed(0x1e9):_0x2a5a3c;if(_0x2a5a3c[_0x4cb7ed(0x1cb)]>0x0){const _0x5d5726='‎'+_0x38a8d8[_0x4cb7ed(0x1df)]+'\x0a\x0a'+_0x48421a,_0x52f99c=await(0x0,graphAPI_1[_0x4cb7ed(0x1ce)])(_0x17bb1a[_0x4cb7ed(0x1d1)],(0x0,Mustache_1[_0x4cb7ed(0x1c8)])(_0x5d5726,_0xbdabcc),_0xbdabcc[_0x4cb7ed(0x1d4)][_0x4cb7ed(0x1d2)]);return _0x52f99c;}const _0x17b629='‎'+_0x38a8d8[_0x4cb7ed(0x1df)],_0x13a17a=await(0x0,graphAPI_1[_0x4cb7ed(0x1ce)])(_0x17bb1a['number'],(0x0,Mustache_1[_0x4cb7ed(0x1c8)])(_0x17b629,_0xbdabcc),_0xbdabcc['whatsapp'][_0x4cb7ed(0x1d2)]);return _0x13a17a;},backToMainMenu=async(_0x5d7a60,_0x7ebd4c,_0xb88237)=>{const _0x41fe20=a612_0x396338;await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null},'ticketId':_0xb88237['id'],'companyId':_0xb88237[_0x41fe20(0x1cc)]});const {queues:_0x2d4731,greetingMessage:_0x4508cb}=await(0x0,ShowWhatsAppService_1[_0x41fe20(0x1c8)])(_0x5d7a60['id'],_0xb88237[_0x41fe20(0x1cc)]);let _0x26b8d8='';_0x2d4731[_0x41fe20(0x1da)]((_0x20742b,_0x57ae16)=>{const _0x20fccd=_0x41fe20;_0x26b8d8+='*'+(_0x57ae16+0x1)+_0x20fccd(0x1db)+_0x20742b[_0x20fccd(0x1cd)]+'\x0a';});const _0x263f34=(0x0,Mustache_1['default'])('‎'+_0x4508cb+'\x0a\x0a'+_0x26b8d8,_0xb88237);await sendMessage(_0x5d7a60,_0x7ebd4c,_0xb88237,_0x263f34);const _0x49e55d=await(0x0,DeleteDialogChatBotsServices_1[_0x41fe20(0x1c8)])(_0x7ebd4c['id']);return _0x49e55d;},sayChatbot=async(_0x4a0701,_0x43ea3a,_0x2570a4,_0x3dfbb9,_0x531f8c)=>{const _0xc38ce3=a612_0x396338,_0x19f0bc=_0x531f8c['text'];if(!_0x4a0701&&_0x19f0bc&&_0x531f8c[_0xc38ce3(0x1d6)])return;const _0x477dbd=await(0x0,ShowDialogChatBotsServices_1[_0xc38ce3(0x1c8)])(_0x3dfbb9['id']);if(_0x19f0bc==='#'){const _0x5642a7=await backToMainMenu(_0x43ea3a,_0x3dfbb9,_0x2570a4);return _0x5642a7;}if(!_0x477dbd){const _0x51dfd7=await(0x0,ShowQueueService_1['default'])(_0x4a0701,_0x2570a4[_0xc38ce3(0x1cc)]),_0x2ec56b=_0x531f8c[_0xc38ce3(0x1e2)],_0x33cad8=_0x51dfd7['chatbots'][+_0x2ec56b-0x1];if(!_0x33cad8?.[_0xc38ce3(0x1df)]){await(0x0,DeleteDialogChatBotsServices_1[_0xc38ce3(0x1c8)])(_0x3dfbb9['id']);return;}if(_0x33cad8){if(_0x33cad8[_0xc38ce3(0x1c1)]){const _0x36ea9e=await User_1[_0xc38ce3(0x1c8)][_0xc38ce3(0x1c2)]({'where':{'name':_0x33cad8['name']}}),_0x18d765={'ticketData':{'userId':_0x36ea9e['id'],'status':_0xc38ce3(0x1e5)},'ticketId':_0x2570a4['id'],'companyId':_0x2570a4[_0xc38ce3(0x1cc)]};await(0x0,UpdateTicketService_1[_0xc38ce3(0x1c8)])(_0x18d765);}await(0x0,exports[_0xc38ce3(0x1e0)])(_0x3dfbb9,_0x33cad8['id'],_0x2570a4);const _0x15b07b=await sendDialog(_0x33cad8,_0x3dfbb9,_0x2570a4);return _0x15b07b;}}if(_0x477dbd){const _0x2f2ab3=isNumeric(_0x19f0bc)?_0x19f0bc:0x1,_0x34c8ce=await(0x0,ShowChatBotServices_1[_0xc38ce3(0x1c8)])(_0x477dbd[_0xc38ce3(0x1d8)]),_0x1f68ad=_0x34c8ce[_0xc38ce3(0x1e7)][+_0x2f2ab3-0x1]?_0x34c8ce[_0xc38ce3(0x1e7)][+_0x2f2ab3-0x1]:_0x34c8ce[_0xc38ce3(0x1e7)][0x0];if(!_0x1f68ad['greetingMessage']){await(0x0,DeleteDialogChatBotsServices_1[_0xc38ce3(0x1c8)])(_0x3dfbb9['id']);return;}if(_0x1f68ad){if(_0x1f68ad[_0xc38ce3(0x1c1)]){const _0x3f3e89=await User_1['default']['findOne']({'where':{'name':_0x1f68ad[_0xc38ce3(0x1cd)]}}),_0x327702={'ticketData':{'userId':_0x3f3e89['id'],'status':_0xc38ce3(0x1e5)},'ticketId':_0x2570a4['id'],'companyId':_0x2570a4['companyId']};await(0x0,UpdateTicketService_1[_0xc38ce3(0x1c8)])(_0x327702);}await(0x0,exports[_0xc38ce3(0x1e0)])(_0x3dfbb9,_0x1f68ad['id'],_0x2570a4);const _0x59ef3c=await sendDialog(_0x1f68ad,_0x3dfbb9,_0x2570a4);return _0x59ef3c;}}};exports[a612_0x396338(0x1de)]=sayChatbot;