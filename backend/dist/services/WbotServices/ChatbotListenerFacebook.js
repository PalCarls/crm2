'use strict';const a537_0x49e7e1=a537_0x57ce;(function(_0x38a858,_0x1f7df9){const _0x291735=a537_0x57ce,_0xd6835e=_0x38a858();while(!![]){try{const _0x259da1=-parseInt(_0x291735(0xe6))/0x1*(parseInt(_0x291735(0xec))/0x2)+parseInt(_0x291735(0xea))/0x3+-parseInt(_0x291735(0xe0))/0x4+parseInt(_0x291735(0xdb))/0x5*(-parseInt(_0x291735(0xf3))/0x6)+-parseInt(_0x291735(0xd7))/0x7*(parseInt(_0x291735(0xf7))/0x8)+parseInt(_0x291735(0xdf))/0x9*(-parseInt(_0x291735(0xde))/0xa)+parseInt(_0x291735(0xdc))/0xb;if(_0x259da1===_0x1f7df9)break;else _0xd6835e['push'](_0xd6835e['shift']());}catch(_0x25a1c3){_0xd6835e['push'](_0xd6835e['shift']());}}}(a537_0x4a57,0xdc62a));var __importDefault=this&&this[a537_0x49e7e1(0xd2)]||function(_0x217a9d){const _0xc2cef0=a537_0x49e7e1;return _0x217a9d&&_0x217a9d[_0xc2cef0(0xe7)]?_0x217a9d:{'default':_0x217a9d};};Object['defineProperty'](exports,a537_0x49e7e1(0xe7),{'value':!![]}),exports[a537_0x49e7e1(0xcd)]=exports[a537_0x49e7e1(0xf6)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require(a537_0x49e7e1(0xf0))),ShowQueueService_1=__importDefault(require(a537_0x49e7e1(0xe5))),ShowChatBotServices_1=__importDefault(require('../ChatBotServices/ShowChatBotServices')),DeleteDialogChatBotsServices_1=__importDefault(require(a537_0x49e7e1(0xe1))),ShowChatBotByChatbotIdServices_1=__importDefault(require(a537_0x49e7e1(0xf2))),CreateDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/CreateDialogChatBotsServices')),ShowWhatsAppService_1=__importDefault(require(a537_0x49e7e1(0xf8))),Mustache_1=__importDefault(require(a537_0x49e7e1(0xd0))),UpdateTicketService_1=__importDefault(require(a537_0x49e7e1(0xe4))),User_1=__importDefault(require(a537_0x49e7e1(0xf1))),graphAPI_1=require(a537_0x49e7e1(0xe2)),isNumeric=_0x7c58b8=>/^-?\d+$/['test'](_0x7c58b8),deleteAndCreateDialogStage=async(_0x444b7e,_0x4c7458,_0x246fac)=>{const _0x46f454=a537_0x49e7e1;try{await(0x0,DeleteDialogChatBotsServices_1[_0x46f454(0xd9)])(_0x444b7e['id']);const _0x270e23=await(0x0,ShowChatBotByChatbotIdServices_1['default'])(_0x4c7458);return!_0x270e23&&await _0x246fac[_0x46f454(0xeb)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x46f454(0xd9)])({'awaiting':0x1,'contactId':_0x444b7e['id'],'chatbotId':_0x4c7458,'queueId':_0x270e23[_0x46f454(0xe8)]});}catch(_0x477ec1){await _0x246fac[_0x46f454(0xeb)]({'isBot':![]});}};function a537_0x4a57(){const _0x2ae895=['27TfFiJu','5722492wHNfKQ','../DialogChatBotsServices/DeleteDialogChatBotsServices','../FacebookServices/graphAPI','text','../TicketServices/UpdateTicketService','../QueueService/ShowQueueService','6xDICGR','__esModule','queueId','isAgent','3862641UQUwEa','update','159254RUGFSb','length','open','greetingMessage','../DialogChatBotsServices/ShowDialogChatBotsServices','../../models/User','../ChatBotServices/ShowChatBotByChatbotIdServices','642YGlVdg','whatsapp','facebookUserToken','deleteAndCreateDialogStage','224ZpUXlj','../WhatsappService/ShowWhatsAppService','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','sayChatbot','findOne','number','../../helpers/Mustache','*\x20-\x20','__importDefault','sendText','chatbots','name','companyId','269899husjOI','forEach','default','options','60765uIursS','58849516QZPMBO','chatbotId','4821510DCsPgP'];a537_0x4a57=function(){return _0x2ae895;};return a537_0x4a57();}exports[a537_0x49e7e1(0xf6)]=deleteAndCreateDialogStage;function a537_0x57ce(_0x1eba82,_0x3cbb05){const _0x4a5722=a537_0x4a57();return a537_0x57ce=function(_0x57cece,_0x53ddf4){_0x57cece=_0x57cece-0xcd;let _0x4e105a=_0x4a5722[_0x57cece];return _0x4e105a;},a537_0x57ce(_0x1eba82,_0x3cbb05);}const sendMessage=async(_0xf517e7,_0x1750ca,_0x4fdf97,_0x13aaf1)=>{const _0x62b7c5=a537_0x49e7e1,_0x2fa3d1=await(0x0,graphAPI_1[_0x62b7c5(0xd3)])(_0x1750ca[_0x62b7c5(0xcf)],(0x0,Mustache_1[_0x62b7c5(0xd9)])(_0x13aaf1,_0x4fdf97),_0x4fdf97[_0x62b7c5(0xf4)][_0x62b7c5(0xf5)]);},sendDialog=async(_0x1aa599,_0x5e1695,_0x147def)=>{const _0x1dda64=a537_0x49e7e1,_0x47ec08=await(0x0,ShowChatBotServices_1[_0x1dda64(0xd9)])(_0x1aa599['id']);if(_0x47ec08[_0x1dda64(0xda)]){let _0x1fdc3d='';_0x47ec08[_0x1dda64(0xda)][_0x1dda64(0xd8)]((_0xed8b43,_0x4494c1)=>{const _0x4bec1a=_0x1dda64;_0x1fdc3d+='*'+(_0x4494c1+0x1)+_0x4bec1a(0xd1)+_0xed8b43[_0x4bec1a(0xd5)]+'\x0a';});const _0x20556f=_0x1fdc3d['length']>0x0?_0x1fdc3d+_0x1dda64(0xf9):_0x1fdc3d;if(_0x1fdc3d[_0x1dda64(0xed)]>0x0){const _0x3f330a='‎'+_0x1aa599[_0x1dda64(0xef)]+'\x0a\x0a'+_0x20556f,_0x4c9049=await(0x0,graphAPI_1['sendText'])(_0x5e1695[_0x1dda64(0xcf)],(0x0,Mustache_1['default'])(_0x3f330a,_0x147def),_0x147def[_0x1dda64(0xf4)]['facebookUserToken']);return _0x4c9049;}const _0xa9f0df='‎'+_0x1aa599[_0x1dda64(0xef)],_0x39b3d0=await(0x0,graphAPI_1[_0x1dda64(0xd3)])(_0x5e1695[_0x1dda64(0xcf)],(0x0,Mustache_1[_0x1dda64(0xd9)])(_0xa9f0df,_0x147def),_0x147def[_0x1dda64(0xf4)][_0x1dda64(0xf5)]);return _0x39b3d0;}let _0x4a43b1='';_0x47ec08[_0x1dda64(0xda)]['forEach']((_0x3efd01,_0xd6f7ac)=>{const _0xa017a9=_0x1dda64;_0x4a43b1+='*'+(_0xd6f7ac+0x1)+'*\x20-\x20'+_0x3efd01[_0xa017a9(0xd5)]+'\x0a';});const _0x5864f4=_0x4a43b1[_0x1dda64(0xed)]>0x0?_0x4a43b1+_0x1dda64(0xf9):_0x4a43b1;if(_0x4a43b1[_0x1dda64(0xed)]>0x0){const _0x1e1cfc='‎'+_0x1aa599[_0x1dda64(0xef)]+'\x0a\x0a'+_0x5864f4,_0x41f9e5=await(0x0,graphAPI_1[_0x1dda64(0xd3)])(_0x5e1695[_0x1dda64(0xcf)],(0x0,Mustache_1['default'])(_0x1e1cfc,_0x147def),_0x147def[_0x1dda64(0xf4)][_0x1dda64(0xf5)]);return _0x41f9e5;}const _0x3b7d1b='‎'+_0x1aa599[_0x1dda64(0xef)],_0x10ee94=await(0x0,graphAPI_1[_0x1dda64(0xd3)])(_0x5e1695['number'],(0x0,Mustache_1[_0x1dda64(0xd9)])(_0x3b7d1b,_0x147def),_0x147def[_0x1dda64(0xf4)][_0x1dda64(0xf5)]);return _0x10ee94;},backToMainMenu=async(_0xe2f725,_0x2333ae,_0x32c4af)=>{const _0x350a26=a537_0x49e7e1;await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null},'ticketId':_0x32c4af['id'],'companyId':_0x32c4af['companyId']});const {queues:_0x406b68,greetingMessage:_0x500e42}=await(0x0,ShowWhatsAppService_1[_0x350a26(0xd9)])(_0xe2f725['id'],_0x32c4af[_0x350a26(0xd6)]);let _0x2768d0='';_0x406b68['forEach']((_0x15b57a,_0x1598ba)=>{const _0x5a80f2=_0x350a26;_0x2768d0+='*'+(_0x1598ba+0x1)+_0x5a80f2(0xd1)+_0x15b57a[_0x5a80f2(0xd5)]+'\x0a';});const _0x5b9174=(0x0,Mustache_1[_0x350a26(0xd9)])('‎'+_0x500e42+'\x0a\x0a'+_0x2768d0,_0x32c4af);await sendMessage(_0xe2f725,_0x2333ae,_0x32c4af,_0x5b9174);const _0x398013=await(0x0,DeleteDialogChatBotsServices_1[_0x350a26(0xd9)])(_0x2333ae['id']);return _0x398013;},sayChatbot=async(_0x317628,_0x16c92e,_0xb4ba36,_0x156dde,_0xc5baf2)=>{const _0x2b6dad=a537_0x49e7e1,_0x599db1=_0xc5baf2[_0x2b6dad(0xe3)];if(!_0x317628&&_0x599db1&&_0xc5baf2['is_echo'])return;const _0x5e5009=await(0x0,ShowDialogChatBotsServices_1[_0x2b6dad(0xd9)])(_0x156dde['id']);if(_0x599db1==='#'){const _0x27abbd=await backToMainMenu(_0x16c92e,_0x156dde,_0xb4ba36);return _0x27abbd;}if(!_0x5e5009){const _0xc1161b=await(0x0,ShowQueueService_1[_0x2b6dad(0xd9)])(_0x317628,_0xb4ba36[_0x2b6dad(0xd6)]),_0xd773e4=_0xc5baf2[_0x2b6dad(0xe3)],_0x1bf038=_0xc1161b[_0x2b6dad(0xd4)][+_0xd773e4-0x1];if(!_0x1bf038?.[_0x2b6dad(0xef)]){await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x156dde['id']);return;}if(_0x1bf038){if(_0x1bf038['isAgent']){const _0x5be7ea=await User_1[_0x2b6dad(0xd9)][_0x2b6dad(0xce)]({'where':{'name':_0x1bf038[_0x2b6dad(0xd5)]}}),_0x2bdc05={'ticketData':{'userId':_0x5be7ea['id'],'status':_0x2b6dad(0xee)},'ticketId':_0xb4ba36['id'],'companyId':_0xb4ba36['companyId']};await(0x0,UpdateTicketService_1[_0x2b6dad(0xd9)])(_0x2bdc05);}await(0x0,exports[_0x2b6dad(0xf6)])(_0x156dde,_0x1bf038['id'],_0xb4ba36);const _0x310425=await sendDialog(_0x1bf038,_0x156dde,_0xb4ba36);return _0x310425;}}if(_0x5e5009){const _0x2cdd1c=isNumeric(_0x599db1)?_0x599db1:0x1,_0x366466=await(0x0,ShowChatBotServices_1[_0x2b6dad(0xd9)])(_0x5e5009[_0x2b6dad(0xdd)]),_0x3e31bb=_0x366466['options'][+_0x2cdd1c-0x1]?_0x366466[_0x2b6dad(0xda)][+_0x2cdd1c-0x1]:_0x366466[_0x2b6dad(0xda)][0x0];if(!_0x3e31bb[_0x2b6dad(0xef)]){await(0x0,DeleteDialogChatBotsServices_1[_0x2b6dad(0xd9)])(_0x156dde['id']);return;}if(_0x3e31bb){if(_0x3e31bb[_0x2b6dad(0xe9)]){const _0x3807c1=await User_1[_0x2b6dad(0xd9)]['findOne']({'where':{'name':_0x3e31bb['name']}}),_0x482d0b={'ticketData':{'userId':_0x3807c1['id'],'status':_0x2b6dad(0xee)},'ticketId':_0xb4ba36['id'],'companyId':_0xb4ba36[_0x2b6dad(0xd6)]};await(0x0,UpdateTicketService_1[_0x2b6dad(0xd9)])(_0x482d0b);}await(0x0,exports['deleteAndCreateDialogStage'])(_0x156dde,_0x3e31bb['id'],_0xb4ba36);const _0x5442ed=await sendDialog(_0x3e31bb,_0x156dde,_0xb4ba36);return _0x5442ed;}}};exports[a537_0x49e7e1(0xcd)]=sayChatbot;