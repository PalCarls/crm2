'use strict';const a612_0x1dcd51=a612_0x5d63;(function(_0x5edf09,_0x51655c){const _0x5f23ac=a612_0x5d63,_0x2077ee=_0x5edf09();while(!![]){try{const _0x157c94=-parseInt(_0x5f23ac(0x10f))/0x1*(parseInt(_0x5f23ac(0x102))/0x2)+-parseInt(_0x5f23ac(0x125))/0x3*(-parseInt(_0x5f23ac(0x111))/0x4)+parseInt(_0x5f23ac(0x11b))/0x5*(-parseInt(_0x5f23ac(0x115))/0x6)+-parseInt(_0x5f23ac(0x116))/0x7*(-parseInt(_0x5f23ac(0x12f))/0x8)+-parseInt(_0x5f23ac(0x10e))/0x9*(-parseInt(_0x5f23ac(0x124))/0xa)+parseInt(_0x5f23ac(0x11e))/0xb*(parseInt(_0x5f23ac(0x11f))/0xc)+-parseInt(_0x5f23ac(0x12e))/0xd*(parseInt(_0x5f23ac(0x113))/0xe);if(_0x157c94===_0x51655c)break;else _0x2077ee['push'](_0x2077ee['shift']());}catch(_0x58d821){_0x2077ee['push'](_0x2077ee['shift']());}}}(a612_0x3c91,0x60b9f));var __importDefault=this&&this[a612_0x1dcd51(0x123)]||function(_0x176d9d){const _0x5b6f57=a612_0x1dcd51;return _0x176d9d&&_0x176d9d[_0x5b6f57(0x103)]?_0x176d9d:{'default':_0x176d9d};};function a612_0x3c91(){const _0x464ce5=['29936DFDcpj','is_echo','../../helpers/Mustache','defineProperty','forEach','41506eepvOJ','__esModule','sayChatbot','options','number','../DialogChatBotsServices/CreateDialogChatBotsServices','companyId','../../models/User','../ChatBotServices/ShowChatBotByChatbotIdServices','chatbots','greetingMessage','queueId','1807263CqsHwj','21EZBMOm','findOne','11260VKreVZ','update','28JrwVVT','facebookUserToken','1582668EaVocL','371etCTVO','deleteAndCreateDialogStage','sendText','whatsapp','text','5nyjzTm','name','../ChatBotServices/ShowChatBotServices','1142581AcVFvE','84CLguNu','open','../TicketServices/UpdateTicketService','isAgent','__importDefault','20DTZrDe','555ONGBOU','chatbotId','../DialogChatBotsServices/ShowDialogChatBotsServices','*\x20-\x20','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','default','../WhatsappService/ShowWhatsAppService','length','test','4888195TBdjVc'];a612_0x3c91=function(){return _0x464ce5;};return a612_0x3c91();}Object[a612_0x1dcd51(0x132)](exports,a612_0x1dcd51(0x103),{'value':!![]}),exports[a612_0x1dcd51(0x104)]=exports[a612_0x1dcd51(0x117)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require(a612_0x1dcd51(0x127))),ShowQueueService_1=__importDefault(require('../QueueService/ShowQueueService')),ShowChatBotServices_1=__importDefault(require(a612_0x1dcd51(0x11d))),DeleteDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/DeleteDialogChatBotsServices')),ShowChatBotByChatbotIdServices_1=__importDefault(require(a612_0x1dcd51(0x10a))),CreateDialogChatBotsServices_1=__importDefault(require(a612_0x1dcd51(0x107))),ShowWhatsAppService_1=__importDefault(require(a612_0x1dcd51(0x12b))),Mustache_1=__importDefault(require(a612_0x1dcd51(0x131))),UpdateTicketService_1=__importDefault(require(a612_0x1dcd51(0x121))),User_1=__importDefault(require(a612_0x1dcd51(0x109))),graphAPI_1=require('../FacebookServices/graphAPI'),isNumeric=_0x14615d=>/^-?\d+$/[a612_0x1dcd51(0x12d)](_0x14615d),deleteAndCreateDialogStage=async(_0xdf9f1a,_0x4dd978,_0x186dd7)=>{const _0x13d478=a612_0x1dcd51;try{await(0x0,DeleteDialogChatBotsServices_1[_0x13d478(0x12a)])(_0xdf9f1a['id']);const _0x38529a=await(0x0,ShowChatBotByChatbotIdServices_1[_0x13d478(0x12a)])(_0x4dd978);return!_0x38529a&&await _0x186dd7[_0x13d478(0x112)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x13d478(0x12a)])({'awaiting':0x1,'contactId':_0xdf9f1a['id'],'chatbotId':_0x4dd978,'queueId':_0x38529a[_0x13d478(0x10d)]});}catch(_0x7ec8ff){await _0x186dd7['update']({'isBot':![]});}};exports['deleteAndCreateDialogStage']=deleteAndCreateDialogStage;function a612_0x5d63(_0x3acc45,_0x27e595){const _0x3c9167=a612_0x3c91();return a612_0x5d63=function(_0x5d63e2,_0xa06892){_0x5d63e2=_0x5d63e2-0x102;let _0x245ed9=_0x3c9167[_0x5d63e2];return _0x245ed9;},a612_0x5d63(_0x3acc45,_0x27e595);}const sendMessage=async(_0x40efa0,_0x7c8f5c,_0x429e9b,_0x272557)=>{const _0x2f9cec=a612_0x1dcd51,_0xcd3988=await(0x0,graphAPI_1[_0x2f9cec(0x118)])(_0x7c8f5c[_0x2f9cec(0x106)],(0x0,Mustache_1[_0x2f9cec(0x12a)])(_0x272557,_0x429e9b),_0x429e9b[_0x2f9cec(0x119)][_0x2f9cec(0x114)]);},sendDialog=async(_0x7aecc2,_0x421667,_0x3d00a9)=>{const _0x3034b7=a612_0x1dcd51,_0x23723d=await(0x0,ShowChatBotServices_1['default'])(_0x7aecc2['id']);if(_0x23723d['options']){let _0x354829='';_0x23723d[_0x3034b7(0x105)][_0x3034b7(0x133)]((_0x2a7577,_0x45935f)=>{const _0x2d3764=_0x3034b7;_0x354829+='*'+(_0x45935f+0x1)+'*\x20-\x20'+_0x2a7577[_0x2d3764(0x11c)]+'\x0a';});const _0x4d25dc=_0x354829[_0x3034b7(0x12c)]>0x0?_0x354829+_0x3034b7(0x129):_0x354829;if(_0x354829[_0x3034b7(0x12c)]>0x0){const _0x2ccfc4='‎'+_0x7aecc2[_0x3034b7(0x10c)]+'\x0a\x0a'+_0x4d25dc,_0x5fa7a6=await(0x0,graphAPI_1[_0x3034b7(0x118)])(_0x421667['number'],(0x0,Mustache_1['default'])(_0x2ccfc4,_0x3d00a9),_0x3d00a9[_0x3034b7(0x119)][_0x3034b7(0x114)]);return _0x5fa7a6;}const _0x54787b='‎'+_0x7aecc2[_0x3034b7(0x10c)],_0x141ca6=await(0x0,graphAPI_1[_0x3034b7(0x118)])(_0x421667[_0x3034b7(0x106)],(0x0,Mustache_1[_0x3034b7(0x12a)])(_0x54787b,_0x3d00a9),_0x3d00a9[_0x3034b7(0x119)]['facebookUserToken']);return _0x141ca6;}let _0x29e4cc='';_0x23723d['options'][_0x3034b7(0x133)]((_0x3fd607,_0x25bb40)=>{const _0x3c1368=_0x3034b7;_0x29e4cc+='*'+(_0x25bb40+0x1)+_0x3c1368(0x128)+_0x3fd607['name']+'\x0a';});const _0x26fdf0=_0x29e4cc['length']>0x0?_0x29e4cc+'\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal':_0x29e4cc;if(_0x29e4cc[_0x3034b7(0x12c)]>0x0){const _0x3ac68e='‎'+_0x7aecc2['greetingMessage']+'\x0a\x0a'+_0x26fdf0,_0x26f58f=await(0x0,graphAPI_1[_0x3034b7(0x118)])(_0x421667[_0x3034b7(0x106)],(0x0,Mustache_1[_0x3034b7(0x12a)])(_0x3ac68e,_0x3d00a9),_0x3d00a9[_0x3034b7(0x119)][_0x3034b7(0x114)]);return _0x26f58f;}const _0x3bcd81='‎'+_0x7aecc2[_0x3034b7(0x10c)],_0x10cc0c=await(0x0,graphAPI_1[_0x3034b7(0x118)])(_0x421667[_0x3034b7(0x106)],(0x0,Mustache_1['default'])(_0x3bcd81,_0x3d00a9),_0x3d00a9[_0x3034b7(0x119)][_0x3034b7(0x114)]);return _0x10cc0c;},backToMainMenu=async(_0x558d5a,_0x316504,_0x323a20)=>{const _0x20e776=a612_0x1dcd51;await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null},'ticketId':_0x323a20['id'],'companyId':_0x323a20[_0x20e776(0x108)]});const {queues:_0x1cb5aa,greetingMessage:_0x4beadd}=await(0x0,ShowWhatsAppService_1[_0x20e776(0x12a)])(_0x558d5a['id'],_0x323a20[_0x20e776(0x108)]);let _0x2e8e6e='';_0x1cb5aa[_0x20e776(0x133)]((_0x19ddba,_0x121839)=>{const _0x3da396=_0x20e776;_0x2e8e6e+='*'+(_0x121839+0x1)+_0x3da396(0x128)+_0x19ddba[_0x3da396(0x11c)]+'\x0a';});const _0x48f10d=(0x0,Mustache_1[_0x20e776(0x12a)])('‎'+_0x4beadd+'\x0a\x0a'+_0x2e8e6e,_0x323a20);await sendMessage(_0x558d5a,_0x316504,_0x323a20,_0x48f10d);const _0x543029=await(0x0,DeleteDialogChatBotsServices_1[_0x20e776(0x12a)])(_0x316504['id']);return _0x543029;},sayChatbot=async(_0x3e0f38,_0x2655ef,_0x155ac7,_0xd2a350,_0x301e8e)=>{const _0x5cd2ac=a612_0x1dcd51,_0xd62a82=_0x301e8e[_0x5cd2ac(0x11a)];if(!_0x3e0f38&&_0xd62a82&&_0x301e8e[_0x5cd2ac(0x130)])return;const _0x2c3ed7=await(0x0,ShowDialogChatBotsServices_1['default'])(_0xd2a350['id']);if(_0xd62a82==='#'){const _0x217f53=await backToMainMenu(_0x2655ef,_0xd2a350,_0x155ac7);return _0x217f53;}if(!_0x2c3ed7){const _0x2db942=await(0x0,ShowQueueService_1['default'])(_0x3e0f38,_0x155ac7[_0x5cd2ac(0x108)]),_0x36f069=_0x301e8e['text'],_0x5d2553=_0x2db942[_0x5cd2ac(0x10b)][+_0x36f069-0x1];if(!_0x5d2553?.[_0x5cd2ac(0x10c)]){await(0x0,DeleteDialogChatBotsServices_1['default'])(_0xd2a350['id']);return;}if(_0x5d2553){if(_0x5d2553[_0x5cd2ac(0x122)]){const _0x449f45=await User_1['default'][_0x5cd2ac(0x110)]({'where':{'name':_0x5d2553[_0x5cd2ac(0x11c)]}}),_0x94808a={'ticketData':{'userId':_0x449f45['id'],'status':'open'},'ticketId':_0x155ac7['id'],'companyId':_0x155ac7[_0x5cd2ac(0x108)]};await(0x0,UpdateTicketService_1['default'])(_0x94808a);}await(0x0,exports[_0x5cd2ac(0x117)])(_0xd2a350,_0x5d2553['id'],_0x155ac7);const _0x26c6b4=await sendDialog(_0x5d2553,_0xd2a350,_0x155ac7);return _0x26c6b4;}}if(_0x2c3ed7){const _0x26cb67=isNumeric(_0xd62a82)?_0xd62a82:0x1,_0xf6030e=await(0x0,ShowChatBotServices_1[_0x5cd2ac(0x12a)])(_0x2c3ed7[_0x5cd2ac(0x126)]),_0x3b7b6d=_0xf6030e[_0x5cd2ac(0x105)][+_0x26cb67-0x1]?_0xf6030e['options'][+_0x26cb67-0x1]:_0xf6030e[_0x5cd2ac(0x105)][0x0];if(!_0x3b7b6d[_0x5cd2ac(0x10c)]){await(0x0,DeleteDialogChatBotsServices_1[_0x5cd2ac(0x12a)])(_0xd2a350['id']);return;}if(_0x3b7b6d){if(_0x3b7b6d[_0x5cd2ac(0x122)]){const _0xea8d8f=await User_1[_0x5cd2ac(0x12a)]['findOne']({'where':{'name':_0x3b7b6d[_0x5cd2ac(0x11c)]}}),_0x4fc8b5={'ticketData':{'userId':_0xea8d8f['id'],'status':_0x5cd2ac(0x120)},'ticketId':_0x155ac7['id'],'companyId':_0x155ac7[_0x5cd2ac(0x108)]};await(0x0,UpdateTicketService_1[_0x5cd2ac(0x12a)])(_0x4fc8b5);}await(0x0,exports[_0x5cd2ac(0x117)])(_0xd2a350,_0x3b7b6d['id'],_0x155ac7);const _0x2c4315=await sendDialog(_0x3b7b6d,_0xd2a350,_0x155ac7);return _0x2c4315;}}};exports[a612_0x1dcd51(0x104)]=sayChatbot;