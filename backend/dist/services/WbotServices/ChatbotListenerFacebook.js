'use strict';const a600_0x14042f=a600_0x4534;(function(_0x19bb2a,_0x472c05){const _0x3e30c6=a600_0x4534,_0x5de9d3=_0x19bb2a();while(!![]){try{const _0x4eb145=parseInt(_0x3e30c6(0x1c5))/0x1*(-parseInt(_0x3e30c6(0x1be))/0x2)+-parseInt(_0x3e30c6(0x1bc))/0x3+parseInt(_0x3e30c6(0x1ce))/0x4*(-parseInt(_0x3e30c6(0x1cb))/0x5)+-parseInt(_0x3e30c6(0x1c2))/0x6+-parseInt(_0x3e30c6(0x1d2))/0x7*(parseInt(_0x3e30c6(0x1b0))/0x8)+-parseInt(_0x3e30c6(0x1b8))/0x9+-parseInt(_0x3e30c6(0x1bd))/0xa*(-parseInt(_0x3e30c6(0x1d7))/0xb);if(_0x4eb145===_0x472c05)break;else _0x5de9d3['push'](_0x5de9d3['shift']());}catch(_0x179f99){_0x5de9d3['push'](_0x5de9d3['shift']());}}}(a600_0x5e64,0x73161));function a600_0x5e64(){const _0x10f4a8=['../ChatBotServices/ShowChatBotServices','2344DBPEEJ','test','*\x20-\x20','../../models/User','../QueueService/ShowQueueService','forEach','isAgent','number','7820370aulWai','length','open','defineProperty','328647CvPWfY','210mLsHpC','110PRqGdf','greetingMessage','sendText','../DialogChatBotsServices/DeleteDialogChatBotsServices','1245900ZlNgAY','sayChatbot','findOne','7739ZaithE','facebookUserToken','name','is_echo','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','chatbotId','2555545eWOxiP','text','__importDefault','4rvaaNw','../TicketServices/UpdateTicketService','whatsapp','update','2051JHaMaT','__esModule','options','companyId','deleteAndCreateDialogStage','1403875RIyThL','default'];a600_0x5e64=function(){return _0x10f4a8;};return a600_0x5e64();}var __importDefault=this&&this[a600_0x14042f(0x1cd)]||function(_0x412517){const _0x33d1fe=a600_0x14042f;return _0x412517&&_0x412517[_0x33d1fe(0x1d3)]?_0x412517:{'default':_0x412517};};Object[a600_0x14042f(0x1bb)](exports,a600_0x14042f(0x1d3),{'value':!![]}),exports[a600_0x14042f(0x1c3)]=exports[a600_0x14042f(0x1d6)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/ShowDialogChatBotsServices')),ShowQueueService_1=__importDefault(require(a600_0x14042f(0x1b4))),ShowChatBotServices_1=__importDefault(require(a600_0x14042f(0x1d9))),DeleteDialogChatBotsServices_1=__importDefault(require(a600_0x14042f(0x1c1))),ShowChatBotByChatbotIdServices_1=__importDefault(require('../ChatBotServices/ShowChatBotByChatbotIdServices')),CreateDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/CreateDialogChatBotsServices')),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),Mustache_1=__importDefault(require('../../helpers/Mustache')),UpdateTicketService_1=__importDefault(require(a600_0x14042f(0x1cf))),User_1=__importDefault(require(a600_0x14042f(0x1b3))),graphAPI_1=require('../FacebookServices/graphAPI'),isNumeric=_0x53e452=>/^-?\d+$/[a600_0x14042f(0x1b1)](_0x53e452),deleteAndCreateDialogStage=async(_0x5ad6c7,_0x43583b,_0x176fe6)=>{const _0x756bc8=a600_0x14042f;try{await(0x0,DeleteDialogChatBotsServices_1[_0x756bc8(0x1d8)])(_0x5ad6c7['id']);const _0x55c941=await(0x0,ShowChatBotByChatbotIdServices_1[_0x756bc8(0x1d8)])(_0x43583b);return!_0x55c941&&await _0x176fe6[_0x756bc8(0x1d1)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x756bc8(0x1d8)])({'awaiting':0x1,'contactId':_0x5ad6c7['id'],'chatbotId':_0x43583b,'queueId':_0x55c941['queueId']});}catch(_0x5b9878){await _0x176fe6[_0x756bc8(0x1d1)]({'isBot':![]});}};exports[a600_0x14042f(0x1d6)]=deleteAndCreateDialogStage;const sendMessage=async(_0x4056b9,_0x8ac3c5,_0x425b57,_0xc6d7fe)=>{const _0xe541f7=a600_0x14042f,_0x349133=await(0x0,graphAPI_1[_0xe541f7(0x1c0)])(_0x8ac3c5[_0xe541f7(0x1b7)],(0x0,Mustache_1[_0xe541f7(0x1d8)])(_0xc6d7fe,_0x425b57),_0x425b57['whatsapp'][_0xe541f7(0x1c6)]);},sendDialog=async(_0x36c9d5,_0x3bcd93,_0x150e20)=>{const _0x4fbad8=a600_0x14042f,_0xd13646=await(0x0,ShowChatBotServices_1[_0x4fbad8(0x1d8)])(_0x36c9d5['id']);if(_0xd13646['options']){let _0x221d16='';_0xd13646['options'][_0x4fbad8(0x1b5)]((_0x4f592f,_0x4a5fa5)=>{const _0x48673d=_0x4fbad8;_0x221d16+='*'+(_0x4a5fa5+0x1)+_0x48673d(0x1b2)+_0x4f592f[_0x48673d(0x1c7)]+'\x0a';});const _0x5caa84=_0x221d16['length']>0x0?_0x221d16+_0x4fbad8(0x1c9):_0x221d16;if(_0x221d16[_0x4fbad8(0x1b9)]>0x0){const _0x475628='‎'+_0x36c9d5[_0x4fbad8(0x1bf)]+'\x0a\x0a'+_0x5caa84,_0x5e8e8e=await(0x0,graphAPI_1[_0x4fbad8(0x1c0)])(_0x3bcd93[_0x4fbad8(0x1b7)],(0x0,Mustache_1['default'])(_0x475628,_0x150e20),_0x150e20[_0x4fbad8(0x1d0)][_0x4fbad8(0x1c6)]);return _0x5e8e8e;}const _0x862c87='‎'+_0x36c9d5[_0x4fbad8(0x1bf)],_0x490dbe=await(0x0,graphAPI_1[_0x4fbad8(0x1c0)])(_0x3bcd93[_0x4fbad8(0x1b7)],(0x0,Mustache_1[_0x4fbad8(0x1d8)])(_0x862c87,_0x150e20),_0x150e20[_0x4fbad8(0x1d0)][_0x4fbad8(0x1c6)]);return _0x490dbe;}let _0x5ed9c8='';_0xd13646[_0x4fbad8(0x1d4)][_0x4fbad8(0x1b5)]((_0x4f0e90,_0x5963af)=>{const _0x1e1b09=_0x4fbad8;_0x5ed9c8+='*'+(_0x5963af+0x1)+_0x1e1b09(0x1b2)+_0x4f0e90[_0x1e1b09(0x1c7)]+'\x0a';});const _0x7d944d=_0x5ed9c8[_0x4fbad8(0x1b9)]>0x0?_0x5ed9c8+_0x4fbad8(0x1c9):_0x5ed9c8;if(_0x5ed9c8[_0x4fbad8(0x1b9)]>0x0){const _0x5a41f2='‎'+_0x36c9d5[_0x4fbad8(0x1bf)]+'\x0a\x0a'+_0x7d944d,_0x324080=await(0x0,graphAPI_1['sendText'])(_0x3bcd93[_0x4fbad8(0x1b7)],(0x0,Mustache_1[_0x4fbad8(0x1d8)])(_0x5a41f2,_0x150e20),_0x150e20[_0x4fbad8(0x1d0)]['facebookUserToken']);return _0x324080;}const _0xf030f2='‎'+_0x36c9d5['greetingMessage'],_0x441aa7=await(0x0,graphAPI_1[_0x4fbad8(0x1c0)])(_0x3bcd93[_0x4fbad8(0x1b7)],(0x0,Mustache_1['default'])(_0xf030f2,_0x150e20),_0x150e20['whatsapp'][_0x4fbad8(0x1c6)]);return _0x441aa7;},backToMainMenu=async(_0x517cd1,_0x56d616,_0xde088)=>{const _0x17e489=a600_0x14042f;await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null},'ticketId':_0xde088['id'],'companyId':_0xde088[_0x17e489(0x1d5)]});const {queues:_0x160d85,greetingMessage:_0x349d82}=await(0x0,ShowWhatsAppService_1[_0x17e489(0x1d8)])(_0x517cd1['id'],_0xde088[_0x17e489(0x1d5)]);let _0x3e0aef='';_0x160d85[_0x17e489(0x1b5)]((_0x5daa56,_0x189fb8)=>{const _0x508e4f=_0x17e489;_0x3e0aef+='*'+(_0x189fb8+0x1)+_0x508e4f(0x1b2)+_0x5daa56[_0x508e4f(0x1c7)]+'\x0a';});const _0x6cfc7c=(0x0,Mustache_1[_0x17e489(0x1d8)])('‎'+_0x349d82+'\x0a\x0a'+_0x3e0aef,_0xde088);await sendMessage(_0x517cd1,_0x56d616,_0xde088,_0x6cfc7c);const _0x13d208=await(0x0,DeleteDialogChatBotsServices_1[_0x17e489(0x1d8)])(_0x56d616['id']);return _0x13d208;},sayChatbot=async(_0x28fb6d,_0x1b8783,_0x504df6,_0x4f252d,_0x6c557b)=>{const _0x5ea64f=a600_0x14042f,_0x3aab23=_0x6c557b[_0x5ea64f(0x1cc)];if(!_0x28fb6d&&_0x3aab23&&_0x6c557b[_0x5ea64f(0x1c8)])return;const _0xbe3457=await(0x0,ShowDialogChatBotsServices_1[_0x5ea64f(0x1d8)])(_0x4f252d['id']);if(_0x3aab23==='#'){const _0x15523d=await backToMainMenu(_0x1b8783,_0x4f252d,_0x504df6);return _0x15523d;}if(!_0xbe3457){const _0x50ab6e=await(0x0,ShowQueueService_1[_0x5ea64f(0x1d8)])(_0x28fb6d,_0x504df6[_0x5ea64f(0x1d5)]),_0x3146cd=_0x6c557b[_0x5ea64f(0x1cc)],_0x1385e8=_0x50ab6e['chatbots'][+_0x3146cd-0x1];if(!_0x1385e8?.[_0x5ea64f(0x1bf)]){await(0x0,DeleteDialogChatBotsServices_1[_0x5ea64f(0x1d8)])(_0x4f252d['id']);return;}if(_0x1385e8){if(_0x1385e8[_0x5ea64f(0x1b6)]){const _0x17cff6=await User_1['default'][_0x5ea64f(0x1c4)]({'where':{'name':_0x1385e8['name']}}),_0x290e51={'ticketData':{'userId':_0x17cff6['id'],'status':_0x5ea64f(0x1ba)},'ticketId':_0x504df6['id'],'companyId':_0x504df6['companyId']};await(0x0,UpdateTicketService_1[_0x5ea64f(0x1d8)])(_0x290e51);}await(0x0,exports[_0x5ea64f(0x1d6)])(_0x4f252d,_0x1385e8['id'],_0x504df6);const _0x1fdbdd=await sendDialog(_0x1385e8,_0x4f252d,_0x504df6);return _0x1fdbdd;}}if(_0xbe3457){const _0x17f343=isNumeric(_0x3aab23)?_0x3aab23:0x1,_0x909d13=await(0x0,ShowChatBotServices_1['default'])(_0xbe3457[_0x5ea64f(0x1ca)]),_0x1d9709=_0x909d13['options'][+_0x17f343-0x1]?_0x909d13[_0x5ea64f(0x1d4)][+_0x17f343-0x1]:_0x909d13[_0x5ea64f(0x1d4)][0x0];if(!_0x1d9709['greetingMessage']){await(0x0,DeleteDialogChatBotsServices_1[_0x5ea64f(0x1d8)])(_0x4f252d['id']);return;}if(_0x1d9709){if(_0x1d9709[_0x5ea64f(0x1b6)]){const _0x1c17e1=await User_1['default'][_0x5ea64f(0x1c4)]({'where':{'name':_0x1d9709[_0x5ea64f(0x1c7)]}}),_0x41a9b9={'ticketData':{'userId':_0x1c17e1['id'],'status':'open'},'ticketId':_0x504df6['id'],'companyId':_0x504df6[_0x5ea64f(0x1d5)]};await(0x0,UpdateTicketService_1['default'])(_0x41a9b9);}await(0x0,exports[_0x5ea64f(0x1d6)])(_0x4f252d,_0x1d9709['id'],_0x504df6);const _0x26bcb8=await sendDialog(_0x1d9709,_0x4f252d,_0x504df6);return _0x26bcb8;}}};function a600_0x4534(_0x278eb8,_0x1df96e){const _0x5e64f2=a600_0x5e64();return a600_0x4534=function(_0x453468,_0x252329){_0x453468=_0x453468-0x1b0;let _0x4f721f=_0x5e64f2[_0x453468];return _0x4f721f;},a600_0x4534(_0x278eb8,_0x1df96e);}exports[a600_0x14042f(0x1c3)]=sayChatbot;