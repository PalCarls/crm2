'use strict';const a553_0x276109=a553_0x1865;(function(_0x31b9d2,_0x470ce8){const _0x226ca0=a553_0x1865,_0x3e15a4=_0x31b9d2();while(!![]){try{const _0xdbdf80=-parseInt(_0x226ca0(0x207))/0x1*(parseInt(_0x226ca0(0x200))/0x2)+-parseInt(_0x226ca0(0x1f5))/0x3+-parseInt(_0x226ca0(0x215))/0x4*(parseInt(_0x226ca0(0x211))/0x5)+-parseInt(_0x226ca0(0x1ff))/0x6+-parseInt(_0x226ca0(0x20d))/0x7*(-parseInt(_0x226ca0(0x216))/0x8)+parseInt(_0x226ca0(0x213))/0x9+parseInt(_0x226ca0(0x1f4))/0xa;if(_0xdbdf80===_0x470ce8)break;else _0x3e15a4['push'](_0x3e15a4['shift']());}catch(_0x4c94ca){_0x3e15a4['push'](_0x3e15a4['shift']());}}}(a553_0x49d5,0xd7a69));function a553_0x49d5(){const _0x411487=['whatsapp','is_echo','../FacebookServices/graphAPI','8587194nPNTAK','2LCjzeG','__esModule','../ChatBotServices/ShowChatBotByChatbotIdServices','../WhatsappService/ShowWhatsAppService','deleteAndCreateDialogStage','forEach','../DialogChatBotsServices/DeleteDialogChatBotsServices','1633661wkwGoW','default','greetingMessage','number','open','../QueueService/ShowQueueService','273RkXcFL','options','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','update','10CettIb','facebookUserToken','1200051sYMRnF','*\x20-\x20','3073604lhMEpf','285200hpJuua','test','length','sendText','../../helpers/Mustache','../DialogChatBotsServices/ShowDialogChatBotsServices','isAgent','../TicketServices/UpdateTicketService','defineProperty','chatbotId','name','chatbots','44449250QbEmXO','1450941HaSPvP','queueId','findOne','text','sayChatbot','companyId','../ChatBotServices/ShowChatBotServices'];a553_0x49d5=function(){return _0x411487;};return a553_0x49d5();}var __importDefault=this&&this['__importDefault']||function(_0x1af75b){const _0x1b1602=a553_0x1865;return _0x1af75b&&_0x1af75b[_0x1b1602(0x201)]?_0x1af75b:{'default':_0x1af75b};};Object[a553_0x276109(0x21e)](exports,'__esModule',{'value':!![]}),exports[a553_0x276109(0x1f9)]=exports[a553_0x276109(0x204)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require(a553_0x276109(0x21b))),ShowQueueService_1=__importDefault(require(a553_0x276109(0x20c))),ShowChatBotServices_1=__importDefault(require(a553_0x276109(0x1fb))),DeleteDialogChatBotsServices_1=__importDefault(require(a553_0x276109(0x206))),ShowChatBotByChatbotIdServices_1=__importDefault(require(a553_0x276109(0x202))),CreateDialogChatBotsServices_1=__importDefault(require('../DialogChatBotsServices/CreateDialogChatBotsServices')),ShowWhatsAppService_1=__importDefault(require(a553_0x276109(0x203))),Mustache_1=__importDefault(require(a553_0x276109(0x21a))),UpdateTicketService_1=__importDefault(require(a553_0x276109(0x21d))),User_1=__importDefault(require('../../models/User')),graphAPI_1=require(a553_0x276109(0x1fe)),isNumeric=_0x1caaad=>/^-?\d+$/[a553_0x276109(0x217)](_0x1caaad),deleteAndCreateDialogStage=async(_0x19983b,_0x13b4e9,_0x14fdff)=>{const _0x3043bd=a553_0x276109;try{await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x19983b['id']);const _0x470dec=await(0x0,ShowChatBotByChatbotIdServices_1[_0x3043bd(0x208)])(_0x13b4e9);return!_0x470dec&&await _0x14fdff[_0x3043bd(0x210)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x3043bd(0x208)])({'awaiting':0x1,'contactId':_0x19983b['id'],'chatbotId':_0x13b4e9,'queueId':_0x470dec[_0x3043bd(0x1f6)]});}catch(_0x50bb9e){await _0x14fdff[_0x3043bd(0x210)]({'isBot':![]});}};exports[a553_0x276109(0x204)]=deleteAndCreateDialogStage;const sendMessage=async(_0x40d788,_0x253431,_0x2de6c0,_0xcebcd4)=>{const _0x4d2ed1=a553_0x276109,_0x4676c5=await(0x0,graphAPI_1[_0x4d2ed1(0x219)])(_0x253431[_0x4d2ed1(0x20a)],(0x0,Mustache_1[_0x4d2ed1(0x208)])(_0xcebcd4,_0x2de6c0),_0x2de6c0[_0x4d2ed1(0x1fc)][_0x4d2ed1(0x212)]);},sendDialog=async(_0x7d0c6d,_0x4058e2,_0x13ef24)=>{const _0x13b89d=a553_0x276109,_0x2f73aa=await(0x0,ShowChatBotServices_1[_0x13b89d(0x208)])(_0x7d0c6d['id']);if(_0x2f73aa[_0x13b89d(0x20e)]){let _0x211c46='';_0x2f73aa[_0x13b89d(0x20e)][_0x13b89d(0x205)]((_0x1a0fb7,_0x212808)=>{const _0x3cf5ef=_0x13b89d;_0x211c46+='*'+(_0x212808+0x1)+_0x3cf5ef(0x214)+_0x1a0fb7[_0x3cf5ef(0x1f2)]+'\x0a';});const _0x5f4ab6=_0x211c46[_0x13b89d(0x218)]>0x0?_0x211c46+_0x13b89d(0x20f):_0x211c46;if(_0x211c46[_0x13b89d(0x218)]>0x0){const _0x1ce803='‎'+_0x7d0c6d[_0x13b89d(0x209)]+'\x0a\x0a'+_0x5f4ab6,_0x21ea19=await(0x0,graphAPI_1[_0x13b89d(0x219)])(_0x4058e2[_0x13b89d(0x20a)],(0x0,Mustache_1[_0x13b89d(0x208)])(_0x1ce803,_0x13ef24),_0x13ef24['whatsapp'][_0x13b89d(0x212)]);return _0x21ea19;}const _0x5d7b49='‎'+_0x7d0c6d['greetingMessage'],_0x1fc272=await(0x0,graphAPI_1['sendText'])(_0x4058e2[_0x13b89d(0x20a)],(0x0,Mustache_1[_0x13b89d(0x208)])(_0x5d7b49,_0x13ef24),_0x13ef24[_0x13b89d(0x1fc)][_0x13b89d(0x212)]);return _0x1fc272;}let _0x371509='';_0x2f73aa[_0x13b89d(0x20e)][_0x13b89d(0x205)]((_0x514f17,_0x2e60f8)=>{const _0x23f579=_0x13b89d;_0x371509+='*'+(_0x2e60f8+0x1)+'*\x20-\x20'+_0x514f17[_0x23f579(0x1f2)]+'\x0a';});const _0x1e4c3d=_0x371509['length']>0x0?_0x371509+'\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal':_0x371509;if(_0x371509['length']>0x0){const _0x2c1521='‎'+_0x7d0c6d[_0x13b89d(0x209)]+'\x0a\x0a'+_0x1e4c3d,_0x113f88=await(0x0,graphAPI_1[_0x13b89d(0x219)])(_0x4058e2[_0x13b89d(0x20a)],(0x0,Mustache_1[_0x13b89d(0x208)])(_0x2c1521,_0x13ef24),_0x13ef24['whatsapp'][_0x13b89d(0x212)]);return _0x113f88;}const _0x35697c='‎'+_0x7d0c6d[_0x13b89d(0x209)],_0x3f8d1d=await(0x0,graphAPI_1[_0x13b89d(0x219)])(_0x4058e2[_0x13b89d(0x20a)],(0x0,Mustache_1[_0x13b89d(0x208)])(_0x35697c,_0x13ef24),_0x13ef24[_0x13b89d(0x1fc)][_0x13b89d(0x212)]);return _0x3f8d1d;},backToMainMenu=async(_0x95d1b7,_0x3293c4,_0x386da6)=>{const _0x395d0b=a553_0x276109;await(0x0,UpdateTicketService_1[_0x395d0b(0x208)])({'ticketData':{'queueId':null},'ticketId':_0x386da6['id'],'companyId':_0x386da6['companyId']});const {queues:_0x5a4439,greetingMessage:_0x15f53f}=await(0x0,ShowWhatsAppService_1['default'])(_0x95d1b7['id'],_0x386da6[_0x395d0b(0x1fa)]);let _0xc1113d='';_0x5a4439['forEach']((_0x3a2a27,_0x54ed6e)=>{const _0x2708b3=_0x395d0b;_0xc1113d+='*'+(_0x54ed6e+0x1)+_0x2708b3(0x214)+_0x3a2a27[_0x2708b3(0x1f2)]+'\x0a';});const _0x59f549=(0x0,Mustache_1[_0x395d0b(0x208)])('‎'+_0x15f53f+'\x0a\x0a'+_0xc1113d,_0x386da6);await sendMessage(_0x95d1b7,_0x3293c4,_0x386da6,_0x59f549);const _0x4dcc5c=await(0x0,DeleteDialogChatBotsServices_1[_0x395d0b(0x208)])(_0x3293c4['id']);return _0x4dcc5c;},sayChatbot=async(_0x573a90,_0x2c25ea,_0x3f0a33,_0x4ac4ce,_0x3488a1)=>{const _0x2ab355=a553_0x276109,_0x46c946=_0x3488a1[_0x2ab355(0x1f8)];if(!_0x573a90&&_0x46c946&&_0x3488a1[_0x2ab355(0x1fd)])return;const _0x10bcf9=await(0x0,ShowDialogChatBotsServices_1[_0x2ab355(0x208)])(_0x4ac4ce['id']);if(_0x46c946==='#'){const _0x43923e=await backToMainMenu(_0x2c25ea,_0x4ac4ce,_0x3f0a33);return _0x43923e;}if(!_0x10bcf9){const _0x2b7688=await(0x0,ShowQueueService_1[_0x2ab355(0x208)])(_0x573a90,_0x3f0a33[_0x2ab355(0x1fa)]),_0x5bbd6f=_0x3488a1[_0x2ab355(0x1f8)],_0x54592f=_0x2b7688[_0x2ab355(0x1f3)][+_0x5bbd6f-0x1];if(!_0x54592f?.[_0x2ab355(0x209)]){await(0x0,DeleteDialogChatBotsServices_1[_0x2ab355(0x208)])(_0x4ac4ce['id']);return;}if(_0x54592f){if(_0x54592f['isAgent']){const _0xe23d4a=await User_1[_0x2ab355(0x208)]['findOne']({'where':{'name':_0x54592f[_0x2ab355(0x1f2)]}}),_0xf3cac={'ticketData':{'userId':_0xe23d4a['id'],'status':_0x2ab355(0x20b)},'ticketId':_0x3f0a33['id'],'companyId':_0x3f0a33[_0x2ab355(0x1fa)]};await(0x0,UpdateTicketService_1['default'])(_0xf3cac);}await(0x0,exports[_0x2ab355(0x204)])(_0x4ac4ce,_0x54592f['id'],_0x3f0a33);const _0x104491=await sendDialog(_0x54592f,_0x4ac4ce,_0x3f0a33);return _0x104491;}}if(_0x10bcf9){const _0x400063=isNumeric(_0x46c946)?_0x46c946:0x1,_0x143b8e=await(0x0,ShowChatBotServices_1['default'])(_0x10bcf9[_0x2ab355(0x21f)]),_0x1a1248=_0x143b8e['options'][+_0x400063-0x1]?_0x143b8e[_0x2ab355(0x20e)][+_0x400063-0x1]:_0x143b8e[_0x2ab355(0x20e)][0x0];if(!_0x1a1248[_0x2ab355(0x209)]){await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x4ac4ce['id']);return;}if(_0x1a1248){if(_0x1a1248[_0x2ab355(0x21c)]){const _0x57652a=await User_1[_0x2ab355(0x208)][_0x2ab355(0x1f7)]({'where':{'name':_0x1a1248[_0x2ab355(0x1f2)]}}),_0x2c8a3d={'ticketData':{'userId':_0x57652a['id'],'status':_0x2ab355(0x20b)},'ticketId':_0x3f0a33['id'],'companyId':_0x3f0a33['companyId']};await(0x0,UpdateTicketService_1['default'])(_0x2c8a3d);}await(0x0,exports['deleteAndCreateDialogStage'])(_0x4ac4ce,_0x1a1248['id'],_0x3f0a33);const _0x36b920=await sendDialog(_0x1a1248,_0x4ac4ce,_0x3f0a33);return _0x36b920;}}};function a553_0x1865(_0xc4fdd2,_0x363840){const _0x49d59f=a553_0x49d5();return a553_0x1865=function(_0x186590,_0x16ecaf){_0x186590=_0x186590-0x1f2;let _0x23e8cc=_0x49d59f[_0x186590];return _0x23e8cc;},a553_0x1865(_0xc4fdd2,_0x363840);}exports[a553_0x276109(0x1f9)]=sayChatbot;