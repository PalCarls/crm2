'use strict';const a612_0x3bbd77=a612_0x3050;function a612_0x3050(_0x281c7d,_0x1116bf){const _0x31e94d=a612_0x31e9();return a612_0x3050=function(_0x30508e,_0x285161){_0x30508e=_0x30508e-0x74;let _0xa5f491=_0x31e94d[_0x30508e];return _0xa5f491;},a612_0x3050(_0x281c7d,_0x1116bf);}(function(_0x61706c,_0x489e8e){const _0x229a70=a612_0x3050,_0x5720b2=_0x61706c();while(!![]){try{const _0x1937bf=-parseInt(_0x229a70(0x7c))/0x1+parseInt(_0x229a70(0x98))/0x2+parseInt(_0x229a70(0x99))/0x3+parseInt(_0x229a70(0x7e))/0x4*(-parseInt(_0x229a70(0x94))/0x5)+parseInt(_0x229a70(0x96))/0x6*(parseInt(_0x229a70(0x75))/0x7)+-parseInt(_0x229a70(0x77))/0x8*(-parseInt(_0x229a70(0x8b))/0x9)+-parseInt(_0x229a70(0x91))/0xa;if(_0x1937bf===_0x489e8e)break;else _0x5720b2['push'](_0x5720b2['shift']());}catch(_0x37cdcf){_0x5720b2['push'](_0x5720b2['shift']());}}}(a612_0x31e9,0x762e4));var __importDefault=this&&this[a612_0x3bbd77(0x90)]||function(_0x14a1b4){const _0x248e5d=a612_0x3bbd77;return _0x14a1b4&&_0x14a1b4[_0x248e5d(0x8d)]?_0x14a1b4:{'default':_0x14a1b4};};Object[a612_0x3bbd77(0x92)](exports,'__esModule',{'value':!![]}),exports[a612_0x3bbd77(0x76)]=exports[a612_0x3bbd77(0x97)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require(a612_0x3bbd77(0x86))),ShowQueueService_1=__importDefault(require(a612_0x3bbd77(0x83))),ShowChatBotServices_1=__importDefault(require(a612_0x3bbd77(0x95))),DeleteDialogChatBotsServices_1=__importDefault(require(a612_0x3bbd77(0x9a))),ShowChatBotByChatbotIdServices_1=__importDefault(require('../ChatBotServices/ShowChatBotByChatbotIdServices')),CreateDialogChatBotsServices_1=__importDefault(require(a612_0x3bbd77(0x85))),ShowWhatsAppService_1=__importDefault(require(a612_0x3bbd77(0x81))),Mustache_1=__importDefault(require('../../helpers/Mustache')),UpdateTicketService_1=__importDefault(require(a612_0x3bbd77(0x7d))),User_1=__importDefault(require('../../models/User')),graphAPI_1=require(a612_0x3bbd77(0x74)),isNumeric=_0x378d61=>/^-?\d+$/['test'](_0x378d61),deleteAndCreateDialogStage=async(_0x120b84,_0x21800a,_0x4b61b5)=>{const _0x3f989d=a612_0x3bbd77;try{await(0x0,DeleteDialogChatBotsServices_1[_0x3f989d(0x82)])(_0x120b84['id']);const _0x43f2ff=await(0x0,ShowChatBotByChatbotIdServices_1[_0x3f989d(0x82)])(_0x21800a);return!_0x43f2ff&&await _0x4b61b5[_0x3f989d(0x7b)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1['default'])({'awaiting':0x1,'contactId':_0x120b84['id'],'chatbotId':_0x21800a,'queueId':_0x43f2ff['queueId']});}catch(_0x4ffb72){await _0x4b61b5[_0x3f989d(0x7b)]({'isBot':![]});}};exports['deleteAndCreateDialogStage']=deleteAndCreateDialogStage;function a612_0x31e9(){const _0x28f137=['default','../QueueService/ShowQueueService','number','../DialogChatBotsServices/CreateDialogChatBotsServices','../DialogChatBotsServices/ShowDialogChatBotsServices','chatbots','options','sendText','text','9VfJLEc','greetingMessage','__esModule','name','isAgent','__importDefault','9308960GGKhln','defineProperty','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','65sJnCpV','../ChatBotServices/ShowChatBotServices','6606poWFks','deleteAndCreateDialogStage','1426108mwDzey','1575249DUdYuW','../DialogChatBotsServices/DeleteDialogChatBotsServices','open','companyId','findOne','../FacebookServices/graphAPI','4333AoEFxw','sayChatbot','1022944dRJGcm','length','*\x20-\x20','forEach','update','146594VzcSnX','../TicketServices/UpdateTicketService','149528MYyTzm','facebookUserToken','whatsapp','../WhatsappService/ShowWhatsAppService'];a612_0x31e9=function(){return _0x28f137;};return a612_0x31e9();}const sendMessage=async(_0xbbad0f,_0x22b389,_0x3b8b71,_0x1193c6)=>{const _0x5b2335=a612_0x3bbd77,_0x58fea4=await(0x0,graphAPI_1['sendText'])(_0x22b389[_0x5b2335(0x84)],(0x0,Mustache_1[_0x5b2335(0x82)])(_0x1193c6,_0x3b8b71),_0x3b8b71[_0x5b2335(0x80)][_0x5b2335(0x7f)]);},sendDialog=async(_0xa1c47d,_0x4d5d11,_0x59cc0a)=>{const _0x556e30=a612_0x3bbd77,_0x37ec28=await(0x0,ShowChatBotServices_1[_0x556e30(0x82)])(_0xa1c47d['id']);if(_0x37ec28[_0x556e30(0x88)]){let _0x3f7702='';_0x37ec28[_0x556e30(0x88)][_0x556e30(0x7a)]((_0x2622ac,_0x22a8f3)=>{const _0x28c02b=_0x556e30;_0x3f7702+='*'+(_0x22a8f3+0x1)+_0x28c02b(0x79)+_0x2622ac[_0x28c02b(0x8e)]+'\x0a';});const _0x2389dd=_0x3f7702['length']>0x0?_0x3f7702+_0x556e30(0x93):_0x3f7702;if(_0x3f7702[_0x556e30(0x78)]>0x0){const _0x28195b='‎'+_0xa1c47d[_0x556e30(0x8c)]+'\x0a\x0a'+_0x2389dd,_0x4fb0cb=await(0x0,graphAPI_1[_0x556e30(0x89)])(_0x4d5d11['number'],(0x0,Mustache_1['default'])(_0x28195b,_0x59cc0a),_0x59cc0a['whatsapp'][_0x556e30(0x7f)]);return _0x4fb0cb;}const _0x58f391='‎'+_0xa1c47d[_0x556e30(0x8c)],_0x596187=await(0x0,graphAPI_1[_0x556e30(0x89)])(_0x4d5d11['number'],(0x0,Mustache_1[_0x556e30(0x82)])(_0x58f391,_0x59cc0a),_0x59cc0a['whatsapp'][_0x556e30(0x7f)]);return _0x596187;}let _0x21a13b='';_0x37ec28[_0x556e30(0x88)]['forEach']((_0x32cc42,_0xbf2bcc)=>{const _0x5eb124=_0x556e30;_0x21a13b+='*'+(_0xbf2bcc+0x1)+_0x5eb124(0x79)+_0x32cc42[_0x5eb124(0x8e)]+'\x0a';});const _0x28d80e=_0x21a13b[_0x556e30(0x78)]>0x0?_0x21a13b+'\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal':_0x21a13b;if(_0x21a13b[_0x556e30(0x78)]>0x0){const _0xad852c='‎'+_0xa1c47d['greetingMessage']+'\x0a\x0a'+_0x28d80e,_0x2dd11b=await(0x0,graphAPI_1[_0x556e30(0x89)])(_0x4d5d11[_0x556e30(0x84)],(0x0,Mustache_1[_0x556e30(0x82)])(_0xad852c,_0x59cc0a),_0x59cc0a[_0x556e30(0x80)][_0x556e30(0x7f)]);return _0x2dd11b;}const _0xf1b13='‎'+_0xa1c47d[_0x556e30(0x8c)],_0x165e26=await(0x0,graphAPI_1[_0x556e30(0x89)])(_0x4d5d11[_0x556e30(0x84)],(0x0,Mustache_1[_0x556e30(0x82)])(_0xf1b13,_0x59cc0a),_0x59cc0a[_0x556e30(0x80)]['facebookUserToken']);return _0x165e26;},backToMainMenu=async(_0x132677,_0x5dac82,_0x14eef5)=>{const _0x359e7d=a612_0x3bbd77;await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null},'ticketId':_0x14eef5['id'],'companyId':_0x14eef5['companyId']});const {queues:_0x163397,greetingMessage:_0xe08ac2}=await(0x0,ShowWhatsAppService_1[_0x359e7d(0x82)])(_0x132677['id'],_0x14eef5[_0x359e7d(0x9c)]);let _0x5812a5='';_0x163397[_0x359e7d(0x7a)]((_0xef6bd1,_0x583d5b)=>{const _0x17dc0e=_0x359e7d;_0x5812a5+='*'+(_0x583d5b+0x1)+_0x17dc0e(0x79)+_0xef6bd1[_0x17dc0e(0x8e)]+'\x0a';});const _0x483cf1=(0x0,Mustache_1[_0x359e7d(0x82)])('‎'+_0xe08ac2+'\x0a\x0a'+_0x5812a5,_0x14eef5);await sendMessage(_0x132677,_0x5dac82,_0x14eef5,_0x483cf1);const _0x46defb=await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x5dac82['id']);return _0x46defb;},sayChatbot=async(_0x3f7c00,_0x543012,_0x494cd6,_0x5ab3b2,_0x2f12f4)=>{const _0x1ae5d3=a612_0x3bbd77,_0x3a648f=_0x2f12f4[_0x1ae5d3(0x8a)];if(!_0x3f7c00&&_0x3a648f&&_0x2f12f4['is_echo'])return;const _0xfbbd59=await(0x0,ShowDialogChatBotsServices_1[_0x1ae5d3(0x82)])(_0x5ab3b2['id']);if(_0x3a648f==='#'){const _0x40c59d=await backToMainMenu(_0x543012,_0x5ab3b2,_0x494cd6);return _0x40c59d;}if(!_0xfbbd59){const _0x6a775d=await(0x0,ShowQueueService_1[_0x1ae5d3(0x82)])(_0x3f7c00,_0x494cd6[_0x1ae5d3(0x9c)]),_0x3dd9ae=_0x2f12f4[_0x1ae5d3(0x8a)],_0x4d01c6=_0x6a775d[_0x1ae5d3(0x87)][+_0x3dd9ae-0x1];if(!_0x4d01c6?.['greetingMessage']){await(0x0,DeleteDialogChatBotsServices_1[_0x1ae5d3(0x82)])(_0x5ab3b2['id']);return;}if(_0x4d01c6){if(_0x4d01c6['isAgent']){const _0x3fe3f9=await User_1['default'][_0x1ae5d3(0x9d)]({'where':{'name':_0x4d01c6[_0x1ae5d3(0x8e)]}}),_0x27a5c3={'ticketData':{'userId':_0x3fe3f9['id'],'status':_0x1ae5d3(0x9b)},'ticketId':_0x494cd6['id'],'companyId':_0x494cd6[_0x1ae5d3(0x9c)]};await(0x0,UpdateTicketService_1[_0x1ae5d3(0x82)])(_0x27a5c3);}await(0x0,exports[_0x1ae5d3(0x97)])(_0x5ab3b2,_0x4d01c6['id'],_0x494cd6);const _0x2e1142=await sendDialog(_0x4d01c6,_0x5ab3b2,_0x494cd6);return _0x2e1142;}}if(_0xfbbd59){const _0x5bc86d=isNumeric(_0x3a648f)?_0x3a648f:0x1,_0x4692d8=await(0x0,ShowChatBotServices_1[_0x1ae5d3(0x82)])(_0xfbbd59['chatbotId']),_0x4287ea=_0x4692d8[_0x1ae5d3(0x88)][+_0x5bc86d-0x1]?_0x4692d8[_0x1ae5d3(0x88)][+_0x5bc86d-0x1]:_0x4692d8[_0x1ae5d3(0x88)][0x0];if(!_0x4287ea[_0x1ae5d3(0x8c)]){await(0x0,DeleteDialogChatBotsServices_1[_0x1ae5d3(0x82)])(_0x5ab3b2['id']);return;}if(_0x4287ea){if(_0x4287ea[_0x1ae5d3(0x8f)]){const _0x1ebc81=await User_1['default']['findOne']({'where':{'name':_0x4287ea[_0x1ae5d3(0x8e)]}}),_0x19b8cc={'ticketData':{'userId':_0x1ebc81['id'],'status':'open'},'ticketId':_0x494cd6['id'],'companyId':_0x494cd6[_0x1ae5d3(0x9c)]};await(0x0,UpdateTicketService_1[_0x1ae5d3(0x82)])(_0x19b8cc);}await(0x0,exports[_0x1ae5d3(0x97)])(_0x5ab3b2,_0x4287ea['id'],_0x494cd6);const _0x3e5889=await sendDialog(_0x4287ea,_0x5ab3b2,_0x494cd6);return _0x3e5889;}}};exports[a612_0x3bbd77(0x76)]=sayChatbot;