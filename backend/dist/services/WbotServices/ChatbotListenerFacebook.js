'use strict';const a500_0x1cc606=a500_0x476a;(function(_0x20267a,_0x36e490){const _0x387420=a500_0x476a,_0x4d6e7c=_0x20267a();while(!![]){try{const _0x237141=parseInt(_0x387420(0x100))/0x1+-parseInt(_0x387420(0xe8))/0x2+parseInt(_0x387420(0xfb))/0x3*(parseInt(_0x387420(0x102))/0x4)+-parseInt(_0x387420(0xeb))/0x5*(-parseInt(_0x387420(0xee))/0x6)+parseInt(_0x387420(0xff))/0x7*(-parseInt(_0x387420(0xde))/0x8)+-parseInt(_0x387420(0xdf))/0x9*(parseInt(_0x387420(0xf1))/0xa)+-parseInt(_0x387420(0xd7))/0xb;if(_0x237141===_0x36e490)break;else _0x4d6e7c['push'](_0x4d6e7c['shift']());}catch(_0x58e17e){_0x4d6e7c['push'](_0x4d6e7c['shift']());}}}(a500_0x5790,0x77969));var __importDefault=this&&this[a500_0x1cc606(0xf9)]||function(_0x20b500){const _0x11b1cb=a500_0x1cc606;return _0x20b500&&_0x20b500[_0x11b1cb(0xf3)]?_0x20b500:{'default':_0x20b500};};function a500_0x5790(){const _0x318769=['2787258rDAmgu','companyId','text','570nZiuTy','is_echo','__esModule','../DialogChatBotsServices/CreateDialogChatBotsServices','../QueueService/ShowQueueService','default','length','chatbots','__importDefault','*\x20-\x20','199899bYosiY','test','defineProperty','deleteAndCreateDialogStage','63343RKNOii','4139WneiDW','../ChatBotServices/ShowChatBotByChatbotIdServices','52MsILUv','number','140635bEILij','chatbotId','../WhatsappService/ShowWhatsAppService','../ChatBotServices/ShowChatBotServices','update','name','whatsapp','408vNCwKW','60327QUDpmN','sendText','../TicketServices/UpdateTicketService','facebookUserToken','greetingMessage','../DialogChatBotsServices/ShowDialogChatBotsServices','options','sayChatbot','../DialogChatBotsServices/DeleteDialogChatBotsServices','906532wisOmU','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','findOne','10hcLLYs','forEach','open'];a500_0x5790=function(){return _0x318769;};return a500_0x5790();}function a500_0x476a(_0x1eaffa,_0x48971c){const _0x579018=a500_0x5790();return a500_0x476a=function(_0x476a99,_0x46aa9e){_0x476a99=_0x476a99-0xd7;let _0xd8f915=_0x579018[_0x476a99];return _0xd8f915;},a500_0x476a(_0x1eaffa,_0x48971c);}Object[a500_0x1cc606(0xfd)](exports,'__esModule',{'value':!![]}),exports[a500_0x1cc606(0xe6)]=exports[a500_0x1cc606(0xfe)]=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require(a500_0x1cc606(0xe4))),ShowQueueService_1=__importDefault(require(a500_0x1cc606(0xf5))),ShowChatBotServices_1=__importDefault(require(a500_0x1cc606(0xda))),DeleteDialogChatBotsServices_1=__importDefault(require(a500_0x1cc606(0xe7))),ShowChatBotByChatbotIdServices_1=__importDefault(require(a500_0x1cc606(0x101))),CreateDialogChatBotsServices_1=__importDefault(require(a500_0x1cc606(0xf4))),ShowWhatsAppService_1=__importDefault(require(a500_0x1cc606(0xd9))),Mustache_1=__importDefault(require('../../helpers/Mustache')),UpdateTicketService_1=__importDefault(require(a500_0x1cc606(0xe1))),User_1=__importDefault(require('../../models/User')),graphAPI_1=require('../FacebookServices/graphAPI'),isNumeric=_0x422a20=>/^-?\d+$/[a500_0x1cc606(0xfc)](_0x422a20),deleteAndCreateDialogStage=async(_0x48e9a7,_0x3f9658,_0x1d7ccb)=>{const _0x8d0e85=a500_0x1cc606;try{await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x48e9a7['id']);const _0x55219b=await(0x0,ShowChatBotByChatbotIdServices_1[_0x8d0e85(0xf6)])(_0x3f9658);return!_0x55219b&&await _0x1d7ccb['update']({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1['default'])({'awaiting':0x1,'contactId':_0x48e9a7['id'],'chatbotId':_0x3f9658,'queueId':_0x55219b['queueId']});}catch(_0x1f86a3){await _0x1d7ccb[_0x8d0e85(0xdb)]({'isBot':![]});}};exports[a500_0x1cc606(0xfe)]=deleteAndCreateDialogStage;const sendMessage=async(_0x1a70e5,_0x4847ab,_0x273745,_0x2fbfad)=>{const _0x5eb971=a500_0x1cc606,_0x227ccc=await(0x0,graphAPI_1[_0x5eb971(0xe0)])(_0x4847ab['number'],(0x0,Mustache_1['default'])(_0x2fbfad,_0x273745),_0x273745[_0x5eb971(0xdd)][_0x5eb971(0xe2)]);},sendDialog=async(_0x382945,_0x4f7624,_0x772850)=>{const _0x5e5a4b=a500_0x1cc606,_0x45994a=await(0x0,ShowChatBotServices_1[_0x5e5a4b(0xf6)])(_0x382945['id']);if(_0x45994a[_0x5e5a4b(0xe5)]){let _0x2065c3='';_0x45994a[_0x5e5a4b(0xe5)][_0x5e5a4b(0xec)]((_0xdb5156,_0x25b146)=>{_0x2065c3+='*'+(_0x25b146+0x1)+'*\x20-\x20'+_0xdb5156['name']+'\x0a';});const _0x38239b=_0x2065c3[_0x5e5a4b(0xf7)]>0x0?_0x2065c3+'\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal':_0x2065c3;if(_0x2065c3[_0x5e5a4b(0xf7)]>0x0){const _0x36fd50='‎'+_0x382945['greetingMessage']+'\x0a\x0a'+_0x38239b,_0x3f0e4c=await(0x0,graphAPI_1[_0x5e5a4b(0xe0)])(_0x4f7624[_0x5e5a4b(0x103)],(0x0,Mustache_1[_0x5e5a4b(0xf6)])(_0x36fd50,_0x772850),_0x772850[_0x5e5a4b(0xdd)][_0x5e5a4b(0xe2)]);return _0x3f0e4c;}const _0x207b5f='‎'+_0x382945[_0x5e5a4b(0xe3)],_0x4866ad=await(0x0,graphAPI_1[_0x5e5a4b(0xe0)])(_0x4f7624[_0x5e5a4b(0x103)],(0x0,Mustache_1[_0x5e5a4b(0xf6)])(_0x207b5f,_0x772850),_0x772850[_0x5e5a4b(0xdd)][_0x5e5a4b(0xe2)]);return _0x4866ad;}let _0x1a5671='';_0x45994a[_0x5e5a4b(0xe5)][_0x5e5a4b(0xec)]((_0x5cbfe6,_0x50cd0a)=>{const _0x5aa4b9=_0x5e5a4b;_0x1a5671+='*'+(_0x50cd0a+0x1)+_0x5aa4b9(0xfa)+_0x5cbfe6[_0x5aa4b9(0xdc)]+'\x0a';});const _0x1de584=_0x1a5671[_0x5e5a4b(0xf7)]>0x0?_0x1a5671+_0x5e5a4b(0xe9):_0x1a5671;if(_0x1a5671[_0x5e5a4b(0xf7)]>0x0){const _0x2e4f41='‎'+_0x382945[_0x5e5a4b(0xe3)]+'\x0a\x0a'+_0x1de584,_0x427e88=await(0x0,graphAPI_1[_0x5e5a4b(0xe0)])(_0x4f7624[_0x5e5a4b(0x103)],(0x0,Mustache_1[_0x5e5a4b(0xf6)])(_0x2e4f41,_0x772850),_0x772850['whatsapp']['facebookUserToken']);return _0x427e88;}const _0x256beb='‎'+_0x382945['greetingMessage'],_0x3eb396=await(0x0,graphAPI_1[_0x5e5a4b(0xe0)])(_0x4f7624['number'],(0x0,Mustache_1[_0x5e5a4b(0xf6)])(_0x256beb,_0x772850),_0x772850[_0x5e5a4b(0xdd)][_0x5e5a4b(0xe2)]);return _0x3eb396;},backToMainMenu=async(_0x15fb00,_0x1efa56,_0x767b84)=>{const _0x48ee9c=a500_0x1cc606;await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null},'ticketId':_0x767b84['id'],'companyId':_0x767b84[_0x48ee9c(0xef)]});const {queues:_0x16c9ea,greetingMessage:_0x5e2df5}=await(0x0,ShowWhatsAppService_1[_0x48ee9c(0xf6)])(_0x15fb00['id'],_0x767b84[_0x48ee9c(0xef)]);let _0x11fa6f='';_0x16c9ea[_0x48ee9c(0xec)]((_0x42cb95,_0x4c93ce)=>{const _0x3a023a=_0x48ee9c;_0x11fa6f+='*'+(_0x4c93ce+0x1)+_0x3a023a(0xfa)+_0x42cb95[_0x3a023a(0xdc)]+'\x0a';});const _0x36844c=(0x0,Mustache_1[_0x48ee9c(0xf6)])('‎'+_0x5e2df5+'\x0a\x0a'+_0x11fa6f,_0x767b84);await sendMessage(_0x15fb00,_0x1efa56,_0x767b84,_0x36844c);const _0x5b7232=await(0x0,DeleteDialogChatBotsServices_1[_0x48ee9c(0xf6)])(_0x1efa56['id']);return _0x5b7232;},sayChatbot=async(_0x9090e9,_0x33dc1f,_0x2049e9,_0x1c1265,_0x2aeb16)=>{const _0x3f2e06=a500_0x1cc606,_0x22556a=_0x2aeb16[_0x3f2e06(0xf0)];if(!_0x9090e9&&_0x22556a&&_0x2aeb16[_0x3f2e06(0xf2)])return;const _0x5e17fd=await(0x0,ShowDialogChatBotsServices_1['default'])(_0x1c1265['id']);if(_0x22556a==='#'){const _0x1f5e68=await backToMainMenu(_0x33dc1f,_0x1c1265,_0x2049e9);return _0x1f5e68;}if(!_0x5e17fd){const _0x486b3b=await(0x0,ShowQueueService_1[_0x3f2e06(0xf6)])(_0x9090e9,_0x2049e9[_0x3f2e06(0xef)]),_0x59c9ba=_0x2aeb16[_0x3f2e06(0xf0)],_0x1dbd8f=_0x486b3b[_0x3f2e06(0xf8)][+_0x59c9ba-0x1];if(!_0x1dbd8f?.[_0x3f2e06(0xe3)]){await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x1c1265['id']);return;}if(_0x1dbd8f){if(_0x1dbd8f['isAgent']){const _0xe8b3c9=await User_1[_0x3f2e06(0xf6)][_0x3f2e06(0xea)]({'where':{'name':_0x1dbd8f[_0x3f2e06(0xdc)]}}),_0x17e9ec={'ticketData':{'userId':_0xe8b3c9['id'],'status':_0x3f2e06(0xed)},'ticketId':_0x2049e9['id'],'companyId':_0x2049e9['companyId']};await(0x0,UpdateTicketService_1[_0x3f2e06(0xf6)])(_0x17e9ec);}await(0x0,exports[_0x3f2e06(0xfe)])(_0x1c1265,_0x1dbd8f['id'],_0x2049e9);const _0x49c496=await sendDialog(_0x1dbd8f,_0x1c1265,_0x2049e9);return _0x49c496;}}if(_0x5e17fd){const _0x55f0a1=isNumeric(_0x22556a)?_0x22556a:0x1,_0x70e25a=await(0x0,ShowChatBotServices_1[_0x3f2e06(0xf6)])(_0x5e17fd[_0x3f2e06(0xd8)]),_0x356069=_0x70e25a[_0x3f2e06(0xe5)][+_0x55f0a1-0x1]?_0x70e25a[_0x3f2e06(0xe5)][+_0x55f0a1-0x1]:_0x70e25a[_0x3f2e06(0xe5)][0x0];if(!_0x356069[_0x3f2e06(0xe3)]){await(0x0,DeleteDialogChatBotsServices_1['default'])(_0x1c1265['id']);return;}if(_0x356069){if(_0x356069['isAgent']){const _0x45f174=await User_1[_0x3f2e06(0xf6)][_0x3f2e06(0xea)]({'where':{'name':_0x356069[_0x3f2e06(0xdc)]}}),_0x131c72={'ticketData':{'userId':_0x45f174['id'],'status':'open'},'ticketId':_0x2049e9['id'],'companyId':_0x2049e9['companyId']};await(0x0,UpdateTicketService_1[_0x3f2e06(0xf6)])(_0x131c72);}await(0x0,exports['deleteAndCreateDialogStage'])(_0x1c1265,_0x356069['id'],_0x2049e9);const _0x3661d0=await sendDialog(_0x356069,_0x1c1265,_0x2049e9);return _0x3661d0;}}};exports[a500_0x1cc606(0xe6)]=sayChatbot;