'use strict';function a553_0x3669(_0x5d53c4,_0x1a1398){const _0x18efd9=a553_0x18ef();return a553_0x3669=function(_0x3669e9,_0x183b58){_0x3669e9=_0x3669e9-0x1e1;let _0x43aa11=_0x18efd9[_0x3669e9];return _0x43aa11;},a553_0x3669(_0x5d53c4,_0x1a1398);}const a553_0x4341c3=a553_0x3669;(function(_0x373dd0,_0x1216fa){const _0x4408de=a553_0x3669,_0x56ff72=_0x373dd0();while(!![]){try{const _0x33ad8c=parseInt(_0x4408de(0x201))/0x1*(parseInt(_0x4408de(0x20f))/0x2)+parseInt(_0x4408de(0x1f1))/0x3+parseInt(_0x4408de(0x1e4))/0x4*(parseInt(_0x4408de(0x209))/0x5)+-parseInt(_0x4408de(0x205))/0x6*(-parseInt(_0x4408de(0x1e6))/0x7)+-parseInt(_0x4408de(0x208))/0x8*(parseInt(_0x4408de(0x1ec))/0x9)+parseInt(_0x4408de(0x1e3))/0xa*(parseInt(_0x4408de(0x1ea))/0xb)+-parseInt(_0x4408de(0x1eb))/0xc;if(_0x33ad8c===_0x1216fa)break;else _0x56ff72['push'](_0x56ff72['shift']());}catch(_0x4f983c){_0x56ff72['push'](_0x56ff72['shift']());}}}(a553_0x18ef,0x48a9e));var __importDefault=this&&this[a553_0x4341c3(0x1fe)]||function(_0x536312){const _0x618aa0=a553_0x4341c3;return _0x536312&&_0x536312[_0x618aa0(0x1e7)]?_0x536312:{'default':_0x536312};};function a553_0x18ef(){const _0x30dd19=['options','sayChatbot','text','greetingMessage','../FacebookServices/graphAPI','chatbots','../ChatBotServices/ShowChatBotServices','../QueueService/ShowQueueService','open','defineProperty','length','__importDefault','chatbotId','../DialogChatBotsServices/ShowDialogChatBotsServices','196521SdBgfn','whatsapp','\x0a*#*\x20Voltar\x20para\x20o\x20menu\x20principal','../TicketServices/UpdateTicketService','3027282RMZNDj','isAgent','companyId','78240fKlZeT','1594630rVvrRm','../DialogChatBotsServices/CreateDialogChatBotsServices','facebookUserToken','is_echo','name','*\x20-\x20','6JgVPNc','../../helpers/Mustache','sendText','10ppPKGX','4pcFCci','../ChatBotServices/ShowChatBotByChatbotIdServices','7CIfmkZ','__esModule','update','../DialogChatBotsServices/DeleteDialogChatBotsServices','311146xnzKym','19085220exRFUs','9xUUPZE','findOne','default','deleteAndCreateDialogStage','number','1369569xIpReX','queueId'];a553_0x18ef=function(){return _0x30dd19;};return a553_0x18ef();}Object[a553_0x4341c3(0x1fc)](exports,a553_0x4341c3(0x1e7),{'value':!![]}),exports[a553_0x4341c3(0x1f4)]=exports['deleteAndCreateDialogStage']=void 0x0;const ShowDialogChatBotsServices_1=__importDefault(require(a553_0x4341c3(0x200))),ShowQueueService_1=__importDefault(require(a553_0x4341c3(0x1fa))),ShowChatBotServices_1=__importDefault(require(a553_0x4341c3(0x1f9))),DeleteDialogChatBotsServices_1=__importDefault(require(a553_0x4341c3(0x1e9))),ShowChatBotByChatbotIdServices_1=__importDefault(require(a553_0x4341c3(0x1e5))),CreateDialogChatBotsServices_1=__importDefault(require(a553_0x4341c3(0x20a))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),Mustache_1=__importDefault(require(a553_0x4341c3(0x1e1))),UpdateTicketService_1=__importDefault(require(a553_0x4341c3(0x204))),User_1=__importDefault(require('../../models/User')),graphAPI_1=require(a553_0x4341c3(0x1f7)),isNumeric=_0x2886de=>/^-?\d+$/['test'](_0x2886de),deleteAndCreateDialogStage=async(_0x4cd0cd,_0x4751a4,_0x1890f6)=>{const _0x22c00f=a553_0x4341c3;try{await(0x0,DeleteDialogChatBotsServices_1[_0x22c00f(0x1ee)])(_0x4cd0cd['id']);const _0x1604a0=await(0x0,ShowChatBotByChatbotIdServices_1['default'])(_0x4751a4);return!_0x1604a0&&await _0x1890f6[_0x22c00f(0x1e8)]({'isBot':![]}),await(0x0,CreateDialogChatBotsServices_1[_0x22c00f(0x1ee)])({'awaiting':0x1,'contactId':_0x4cd0cd['id'],'chatbotId':_0x4751a4,'queueId':_0x1604a0[_0x22c00f(0x1f2)]});}catch(_0x400c91){await _0x1890f6['update']({'isBot':![]});}};exports[a553_0x4341c3(0x1ef)]=deleteAndCreateDialogStage;const sendMessage=async(_0x56f2e8,_0x26ea3c,_0x2d46a5,_0x5da96a)=>{const _0x22b57e=a553_0x4341c3,_0x2e1041=await(0x0,graphAPI_1[_0x22b57e(0x1e2)])(_0x26ea3c[_0x22b57e(0x1f0)],(0x0,Mustache_1[_0x22b57e(0x1ee)])(_0x5da96a,_0x2d46a5),_0x2d46a5['whatsapp'][_0x22b57e(0x20b)]);},sendDialog=async(_0x3c3863,_0x66f037,_0x1ff69e)=>{const _0x87bddd=a553_0x4341c3,_0x29a766=await(0x0,ShowChatBotServices_1[_0x87bddd(0x1ee)])(_0x3c3863['id']);if(_0x29a766[_0x87bddd(0x1f3)]){let _0x1f39b3='';_0x29a766[_0x87bddd(0x1f3)]['forEach']((_0x8946d1,_0x306bc7)=>{const _0x2571ae=_0x87bddd;_0x1f39b3+='*'+(_0x306bc7+0x1)+_0x2571ae(0x20e)+_0x8946d1['name']+'\x0a';});const _0x3ec747=_0x1f39b3[_0x87bddd(0x1fd)]>0x0?_0x1f39b3+_0x87bddd(0x203):_0x1f39b3;if(_0x1f39b3[_0x87bddd(0x1fd)]>0x0){const _0x3e885c='‎'+_0x3c3863[_0x87bddd(0x1f6)]+'\x0a\x0a'+_0x3ec747,_0x4e391e=await(0x0,graphAPI_1[_0x87bddd(0x1e2)])(_0x66f037[_0x87bddd(0x1f0)],(0x0,Mustache_1[_0x87bddd(0x1ee)])(_0x3e885c,_0x1ff69e),_0x1ff69e[_0x87bddd(0x202)][_0x87bddd(0x20b)]);return _0x4e391e;}const _0x5778e2='‎'+_0x3c3863[_0x87bddd(0x1f6)],_0x28dc5=await(0x0,graphAPI_1[_0x87bddd(0x1e2)])(_0x66f037['number'],(0x0,Mustache_1['default'])(_0x5778e2,_0x1ff69e),_0x1ff69e[_0x87bddd(0x202)][_0x87bddd(0x20b)]);return _0x28dc5;}let _0x156f68='';_0x29a766[_0x87bddd(0x1f3)]['forEach']((_0x5d13a9,_0x217130)=>{const _0x15eff4=_0x87bddd;_0x156f68+='*'+(_0x217130+0x1)+_0x15eff4(0x20e)+_0x5d13a9[_0x15eff4(0x20d)]+'\x0a';});const _0x4b0423=_0x156f68[_0x87bddd(0x1fd)]>0x0?_0x156f68+_0x87bddd(0x203):_0x156f68;if(_0x156f68[_0x87bddd(0x1fd)]>0x0){const _0x1a9a41='‎'+_0x3c3863['greetingMessage']+'\x0a\x0a'+_0x4b0423,_0x2ff523=await(0x0,graphAPI_1['sendText'])(_0x66f037[_0x87bddd(0x1f0)],(0x0,Mustache_1[_0x87bddd(0x1ee)])(_0x1a9a41,_0x1ff69e),_0x1ff69e['whatsapp'][_0x87bddd(0x20b)]);return _0x2ff523;}const _0x2cf65d='‎'+_0x3c3863[_0x87bddd(0x1f6)],_0xb4ac78=await(0x0,graphAPI_1[_0x87bddd(0x1e2)])(_0x66f037[_0x87bddd(0x1f0)],(0x0,Mustache_1[_0x87bddd(0x1ee)])(_0x2cf65d,_0x1ff69e),_0x1ff69e['whatsapp'][_0x87bddd(0x20b)]);return _0xb4ac78;},backToMainMenu=async(_0x2a7a7c,_0x210e11,_0x48b2dd)=>{const _0x9e2e0c=a553_0x4341c3;await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null},'ticketId':_0x48b2dd['id'],'companyId':_0x48b2dd[_0x9e2e0c(0x207)]});const {queues:_0x3e28ee,greetingMessage:_0x255dee}=await(0x0,ShowWhatsAppService_1[_0x9e2e0c(0x1ee)])(_0x2a7a7c['id'],_0x48b2dd[_0x9e2e0c(0x207)]);let _0x32f128='';_0x3e28ee['forEach']((_0x621da5,_0x1656fa)=>{const _0x64e4e9=_0x9e2e0c;_0x32f128+='*'+(_0x1656fa+0x1)+_0x64e4e9(0x20e)+_0x621da5['name']+'\x0a';});const _0x195a59=(0x0,Mustache_1[_0x9e2e0c(0x1ee)])('‎'+_0x255dee+'\x0a\x0a'+_0x32f128,_0x48b2dd);await sendMessage(_0x2a7a7c,_0x210e11,_0x48b2dd,_0x195a59);const _0xe797c1=await(0x0,DeleteDialogChatBotsServices_1[_0x9e2e0c(0x1ee)])(_0x210e11['id']);return _0xe797c1;},sayChatbot=async(_0x459e21,_0x54e9a9,_0x556815,_0x2545a6,_0x13bcf2)=>{const _0x43aae6=a553_0x4341c3,_0x529541=_0x13bcf2['text'];if(!_0x459e21&&_0x529541&&_0x13bcf2[_0x43aae6(0x20c)])return;const _0x229e19=await(0x0,ShowDialogChatBotsServices_1[_0x43aae6(0x1ee)])(_0x2545a6['id']);if(_0x529541==='#'){const _0x733b1c=await backToMainMenu(_0x54e9a9,_0x2545a6,_0x556815);return _0x733b1c;}if(!_0x229e19){const _0x157c04=await(0x0,ShowQueueService_1[_0x43aae6(0x1ee)])(_0x459e21,_0x556815[_0x43aae6(0x207)]),_0x44222d=_0x13bcf2[_0x43aae6(0x1f5)],_0x533c16=_0x157c04[_0x43aae6(0x1f8)][+_0x44222d-0x1];if(!_0x533c16?.[_0x43aae6(0x1f6)]){await(0x0,DeleteDialogChatBotsServices_1[_0x43aae6(0x1ee)])(_0x2545a6['id']);return;}if(_0x533c16){if(_0x533c16[_0x43aae6(0x206)]){const _0x42762a=await User_1[_0x43aae6(0x1ee)][_0x43aae6(0x1ed)]({'where':{'name':_0x533c16['name']}}),_0x22b654={'ticketData':{'userId':_0x42762a['id'],'status':_0x43aae6(0x1fb)},'ticketId':_0x556815['id'],'companyId':_0x556815[_0x43aae6(0x207)]};await(0x0,UpdateTicketService_1[_0x43aae6(0x1ee)])(_0x22b654);}await(0x0,exports['deleteAndCreateDialogStage'])(_0x2545a6,_0x533c16['id'],_0x556815);const _0xbaaa89=await sendDialog(_0x533c16,_0x2545a6,_0x556815);return _0xbaaa89;}}if(_0x229e19){const _0x1d6177=isNumeric(_0x529541)?_0x529541:0x1,_0x325a81=await(0x0,ShowChatBotServices_1[_0x43aae6(0x1ee)])(_0x229e19[_0x43aae6(0x1ff)]),_0x3165a8=_0x325a81['options'][+_0x1d6177-0x1]?_0x325a81[_0x43aae6(0x1f3)][+_0x1d6177-0x1]:_0x325a81['options'][0x0];if(!_0x3165a8['greetingMessage']){await(0x0,DeleteDialogChatBotsServices_1[_0x43aae6(0x1ee)])(_0x2545a6['id']);return;}if(_0x3165a8){if(_0x3165a8[_0x43aae6(0x206)]){const _0x5d4d14=await User_1[_0x43aae6(0x1ee)]['findOne']({'where':{'name':_0x3165a8[_0x43aae6(0x20d)]}}),_0xf59d7={'ticketData':{'userId':_0x5d4d14['id'],'status':'open'},'ticketId':_0x556815['id'],'companyId':_0x556815[_0x43aae6(0x207)]};await(0x0,UpdateTicketService_1[_0x43aae6(0x1ee)])(_0xf59d7);}await(0x0,exports['deleteAndCreateDialogStage'])(_0x2545a6,_0x3165a8['id'],_0x556815);const _0x400cd8=await sendDialog(_0x3165a8,_0x2545a6,_0x556815);return _0x400cd8;}}};exports['sayChatbot']=sayChatbot;