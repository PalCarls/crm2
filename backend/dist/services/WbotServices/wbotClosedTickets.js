<<<<<<< HEAD
'use strict';const a615_0x9e69d8=a615_0x52c9;(function(_0x7e72c0,_0x53bfa4){const _0x15e481=a615_0x52c9,_0x1707ab=_0x7e72c0();while(!![]){try{const _0x2c1aa0=parseInt(_0x15e481(0x1f7))/0x1+-parseInt(_0x15e481(0x205))/0x2+parseInt(_0x15e481(0x204))/0x3+parseInt(_0x15e481(0x210))/0x4*(parseInt(_0x15e481(0x215))/0x5)+-parseInt(_0x15e481(0x21f))/0x6*(parseInt(_0x15e481(0x208))/0x7)+parseInt(_0x15e481(0x211))/0x8*(parseInt(_0x15e481(0x201))/0x9)+-parseInt(_0x15e481(0x1fe))/0xa;if(_0x2c1aa0===_0x53bfa4)break;else _0x1707ab['push'](_0x1707ab['shift']());}catch(_0x101164){_0x1707ab['push'](_0x1707ab['shift']());}}}(a615_0x5b79,0x81018));function a615_0x52c9(_0x3af369,_0x508584){const _0x5b790d=a615_0x5b79();return a615_0x52c9=function(_0x52c9db,_0x2f7a89){_0x52c9db=_0x52c9db-0x1f4;let _0x57cc52=_0x5b790d[_0x52c9db];return _0x57cc52;},a615_0x52c9(_0x3af369,_0x508584);}var __importDefault=this&&this[a615_0x9e69d8(0x20d)]||function(_0x12b592){return _0x12b592&&_0x12b592['__esModule']?_0x12b592:{'default':_0x12b592};};function a615_0x5b79(){const _0x572034=['isGroup','1341jfXcbN','updatedAt','__esModule','1179114zJqLRk','6876hEHfrA','fromMe','company-','7HaEOJK','../TicketServices/ShowTicketService','status','delete','sequelize','__importDefault','update','toDate','8380kFSinr','50192ocesXK','../../models/TicketTraking','getIO','setMinutes','1165bgfbqg','autoClose','../../libs/socket','../TicketServices/CreateLogTicketService','whatsappId','contact','emit','nps','getMinutes','closed','4705266sWKerr','default','verifyMessage','ClosedAllOpenTickets','480002LUNxmm','userId','-ticket','open','forEach','defineProperty','findAndCountAll','9799440FtUzvj','DESC'];a615_0x5b79=function(){return _0x572034;};return a615_0x5b79();}Object[a615_0x9e69d8(0x1fc)](exports,a615_0x9e69d8(0x203),{'value':!![]}),exports['ClosedAllOpenTickets']=void 0x0;const sequelize_1=require(a615_0x9e69d8(0x20c)),Ticket_1=__importDefault(require('../../models/Ticket')),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),socket_1=require(a615_0x9e69d8(0x217)),Mustache_1=__importDefault(require('../../helpers/Mustache')),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),moment_1=__importDefault(require('moment')),ShowTicketService_1=__importDefault(require(a615_0x9e69d8(0x209))),wbotMessageListener_1=require('./wbotMessageListener'),TicketTraking_1=__importDefault(require(a615_0x9e69d8(0x212))),CreateLogTicketService_1=__importDefault(require(a615_0x9e69d8(0x218))),ClosedAllOpenTickets=async _0x5d33e7=>{const _0x288619=a615_0x9e69d8,_0x48f5db=async(_0x29f917,_0xef18bf,_0xc1bb55)=>{const _0xd13277=a615_0x52c9;if(_0xef18bf===_0xd13277(0x21c))await _0x29f917[_0xd13277(0x20e)]({'status':'closed','lastMessage':_0xc1bb55,'unreadMessages':0x0,'amountUseBotQueues':0x0});else _0xef18bf===_0xd13277(0x1fa)?await _0x29f917[_0xd13277(0x20e)]({'status':_0xd13277(0x21e),'lastMessage':_0xc1bb55,'unreadMessages':0x0,'amountUseBotQueues':0x0}):await _0x29f917['update']({'status':_0xd13277(0x21e),'unreadMessages':0x0});await(0x0,CreateLogTicketService_1[_0xd13277(0x1f4)])({'userId':_0x29f917[_0xd13277(0x1f8)]||null,'queueId':_0x29f917['queueId']||null,'ticketId':_0x29f917['id'],'type':_0xd13277(0x216)});},_0x44f9af=(0x0,socket_1[_0x288619(0x213)])();try{const {rows:_0x3931fb}=await Ticket_1[_0x288619(0x1f4)][_0x288619(0x1fd)]({'where':{'status':{[sequelize_1['Op']['in']]:['open',_0x288619(0x21c)]},'companyId':_0x5d33e7},'order':[[_0x288619(0x202),_0x288619(0x1ff)]]});_0x3931fb[_0x288619(0x1fb)](async _0x460ce2=>{const _0x11f699=_0x288619,_0x18540a=await(0x0,ShowTicketService_1['default'])(_0x460ce2['id'],_0x5d33e7),_0x18491f=await Whatsapp_1[_0x11f699(0x1f4)]['findByPk'](_0x18540a?.[_0x11f699(0x219)]),_0x4c9128=await TicketTraking_1[_0x11f699(0x1f4)]['findOne']({'where':{'ticketId':_0x460ce2['id'],'finishedAt':null}});if(!_0x18491f)return;let {timeInactiveMessage:_0x296c75,expiresInactiveMessage:_0x6c8b8a,inactiveMessage:_0x51619c,expiresTicket:_0xee6e2d,expiresTicketNPS:_0xdf1daa,whenExpiresTicket:_0x24fbfd,complationMessage:_0x3b77ea}=_0x18491f;if(_0xdf1daa&&_0xdf1daa!==''&&_0xdf1daa!=='0'&&Number(_0xdf1daa)>0x0){const _0x25badb=new Date();_0x25badb[_0x11f699(0x214)](_0x25badb['getMinutes']()-Number(_0xdf1daa));if(_0x460ce2[_0x11f699(0x20a)]===_0x11f699(0x21c)){const _0x331199=new Date(_0x18540a['updatedAt']);if(_0x331199<_0x25badb){_0x48f5db(_0x18540a,_0x18540a['status'],'');const _0x9ea891=(0x0,Mustache_1[_0x11f699(0x1f4)])('‎'+_0x3b77ea,_0x18540a);if(_0x3b77ea!==''&&_0x3b77ea!==undefined){const _0x48e693=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x9ea891,'ticket':_0x18540a});await(0x0,wbotMessageListener_1[_0x11f699(0x1f5)])(_0x48e693,_0x18540a,_0x18540a[_0x11f699(0x21a)]);}await _0x4c9128[_0x11f699(0x20e)]({'finishedAt':(0x0,moment_1[_0x11f699(0x1f4)])()['toDate'](),'closedAt':(0x0,moment_1['default'])()[_0x11f699(0x20f)](),'whatsappId':_0x460ce2[_0x11f699(0x219)],'userId':_0x460ce2[_0x11f699(0x1f8)]}),_0x44f9af['to'](_0x11f699(0x1fa))[_0x11f699(0x21b)](_0x11f699(0x207)+_0x5d33e7+_0x11f699(0x1f9),{'action':_0x11f699(0x20b),'ticketId':_0x18540a['id']});}}}if(_0xee6e2d&&_0xee6e2d!==''&&_0xee6e2d!=='0'&&Number(_0xee6e2d)>0x0){const _0x541535=(0x0,Mustache_1[_0x11f699(0x1f4)])('‎'+_0x6c8b8a,_0x18540a),_0x2d79e5=new Date();_0x2d79e5['setMinutes'](_0x2d79e5['getMinutes']()-Number(_0xee6e2d));_0x296c75&&_0x296c75!==''&&_0x296c75!==null&&_0x296c75!=='0'&&Number(_0x296c75)>0x0&&_0x2d79e5[_0x11f699(0x214)](_0x2d79e5[_0x11f699(0x21d)]()-Number(_0x296c75));if(_0x18540a[_0x11f699(0x20a)]==='open'&&!_0x18540a[_0x11f699(0x200)]){const _0x3a8799=new Date(_0x18540a[_0x11f699(0x202)]);if(_0x3a8799<_0x2d79e5&&(_0x24fbfd==='0'||_0x24fbfd==='1'&&_0x18540a[_0x11f699(0x206)])){_0x48f5db(_0x18540a,_0x18540a[_0x11f699(0x20a)],_0x541535);if(_0x6c8b8a!==''&&_0x6c8b8a!==undefined){const _0x2e9ed4=await(0x0,SendWhatsAppMessage_1[_0x11f699(0x1f4)])({'body':_0x541535,'ticket':_0x18540a});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x2e9ed4,_0x18540a,_0x18540a[_0x11f699(0x21a)]);}await _0x4c9128['update']({'finishedAt':(0x0,moment_1[_0x11f699(0x1f4)])()[_0x11f699(0x20f)](),'closedAt':(0x0,moment_1[_0x11f699(0x1f4)])()['toDate'](),'whatsappId':_0x460ce2['whatsappId'],'userId':_0x460ce2[_0x11f699(0x1f8)]}),_0x44f9af['to']('open')[_0x11f699(0x21b)]('company-'+_0x5d33e7+_0x11f699(0x1f9),{'action':_0x11f699(0x20b),'ticketId':_0x18540a['id']});}}}if(_0x296c75&&_0x296c75!==''&&_0x296c75!=='0'&&Number(_0x296c75)>0x0){const _0x457d28=(0x0,Mustache_1[_0x11f699(0x1f4)])('‎'+_0x51619c,_0x18540a),_0x1c54c2=new Date();_0x1c54c2['setMinutes'](_0x1c54c2[_0x11f699(0x21d)]()-Number(_0x296c75));if(_0x18540a['status']===_0x11f699(0x1fa)&&!_0x18540a['isGroup']){const _0x233ecd=new Date(_0x18540a[_0x11f699(0x202)]);if(_0x233ecd<_0x1c54c2&&!_0x18540a['sendInactiveMessage']&&(_0x24fbfd==='0'||_0x24fbfd==='1'&&_0x18540a[_0x11f699(0x206)])){const _0x45a74f=await(0x0,SendWhatsAppMessage_1[_0x11f699(0x1f4)])({'body':_0x457d28,'ticket':_0x18540a});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x45a74f,_0x18540a,_0x18540a[_0x11f699(0x21a)]),await _0x18540a['update']({'sendInactiveMessage':!![]}),_0x44f9af['to'](_0x11f699(0x1fa))[_0x11f699(0x21b)](_0x11f699(0x207)+_0x5d33e7+'-ticket',{'action':_0x11f699(0x20b),'ticket':_0x18540a,'ticketId':_0x18540a['id']});}}}});}catch(_0x125d7c){console['log']('e',_0x125d7c);}};exports[a615_0x9e69d8(0x1f6)]=ClosedAllOpenTickets;
=======
'use strict';function a614_0x14a1(_0x15fcb4,_0x25bb34){const _0x29bff8=a614_0x29bf();return a614_0x14a1=function(_0x14a19f,_0x4f344c){_0x14a19f=_0x14a19f-0x75;let _0x5ce2cf=_0x29bff8[_0x14a19f];return _0x5ce2cf;},a614_0x14a1(_0x15fcb4,_0x25bb34);}const a614_0x22281d=a614_0x14a1;(function(_0xbaadab,_0x382e1f){const _0x1d8240=a614_0x14a1,_0x2415dc=_0xbaadab();while(!![]){try{const _0x37fe09=-parseInt(_0x1d8240(0x86))/0x1+-parseInt(_0x1d8240(0x76))/0x2+-parseInt(_0x1d8240(0x7b))/0x3*(parseInt(_0x1d8240(0x7e))/0x4)+-parseInt(_0x1d8240(0x8b))/0x5+parseInt(_0x1d8240(0x92))/0x6+parseInt(_0x1d8240(0x90))/0x7+parseInt(_0x1d8240(0x9d))/0x8;if(_0x37fe09===_0x382e1f)break;else _0x2415dc['push'](_0x2415dc['shift']());}catch(_0x1e923b){_0x2415dc['push'](_0x2415dc['shift']());}}}(a614_0x29bf,0x923af));var __importDefault=this&&this[a614_0x22281d(0x7a)]||function(_0x8b2857){return _0x8b2857&&_0x8b2857['__esModule']?_0x8b2857:{'default':_0x8b2857};};Object[a614_0x22281d(0x81)](exports,a614_0x22281d(0x87),{'value':!![]}),exports[a614_0x22281d(0x89)]=void 0x0;function a614_0x29bf(){const _0x2939c8=['17708GMMZoI','status','autoClose','defineProperty','../TicketServices/CreateLogTicketService','company-','../../libs/socket','DESC','719665xGPrhz','__esModule','toDate','ClosedAllOpenTickets','../../models/Whatsapp','5215500RwtCXY','../TicketServices/ShowTicketService','contact','-ticket','whatsappId','4946165tjEsgz','getIO','4356738WsbuDh','./SendWhatsAppMessage','getMinutes','emit','findByPk','./wbotMessageListener','userId','open','setMinutes','../../models/Ticket','moment','11195536IaMOse','verifyMessage','closed','sequelize','updatedAt','sendInactiveMessage','findOne','isGroup','../../helpers/Mustache','338800KtoEkS','update','fromMe','delete','__importDefault','204ASvjkJ','nps','default'];a614_0x29bf=function(){return _0x2939c8;};return a614_0x29bf();}const sequelize_1=require(a614_0x22281d(0xa0)),Ticket_1=__importDefault(require(a614_0x22281d(0x9b))),Whatsapp_1=__importDefault(require(a614_0x22281d(0x8a))),socket_1=require(a614_0x22281d(0x84)),Mustache_1=__importDefault(require(a614_0x22281d(0x75))),SendWhatsAppMessage_1=__importDefault(require(a614_0x22281d(0x93))),moment_1=__importDefault(require(a614_0x22281d(0x9c))),ShowTicketService_1=__importDefault(require(a614_0x22281d(0x8c))),wbotMessageListener_1=require(a614_0x22281d(0x97)),TicketTraking_1=__importDefault(require('../../models/TicketTraking')),CreateLogTicketService_1=__importDefault(require(a614_0x22281d(0x82))),ClosedAllOpenTickets=async _0x28b25a=>{const _0x4119a3=a614_0x22281d,_0x1221ba=async(_0x354149,_0x203e53,_0x1da58d)=>{const _0x58e18a=a614_0x14a1;if(_0x203e53===_0x58e18a(0x7c))await _0x354149['update']({'status':_0x58e18a(0x9f),'lastMessage':_0x1da58d,'unreadMessages':0x0,'amountUseBotQueues':0x0});else _0x203e53===_0x58e18a(0x99)?await _0x354149['update']({'status':_0x58e18a(0x9f),'lastMessage':_0x1da58d,'unreadMessages':0x0,'amountUseBotQueues':0x0}):await _0x354149[_0x58e18a(0x77)]({'status':_0x58e18a(0x9f),'unreadMessages':0x0});await(0x0,CreateLogTicketService_1[_0x58e18a(0x7d)])({'userId':_0x354149[_0x58e18a(0x98)]||null,'queueId':_0x354149['queueId']||null,'ticketId':_0x354149['id'],'type':_0x58e18a(0x80)});},_0x40f841=(0x0,socket_1[_0x4119a3(0x91)])();try{const {rows:_0x2e8331}=await Ticket_1[_0x4119a3(0x7d)]['findAndCountAll']({'where':{'status':{[sequelize_1['Op']['in']]:['open',_0x4119a3(0x7c)]},'companyId':_0x28b25a},'order':[[_0x4119a3(0xa1),_0x4119a3(0x85)]]});_0x2e8331['forEach'](async _0x3c4ade=>{const _0x3d4f5c=_0x4119a3,_0xcfda35=await(0x0,ShowTicketService_1[_0x3d4f5c(0x7d)])(_0x3c4ade['id'],_0x28b25a),_0x19408e=await Whatsapp_1[_0x3d4f5c(0x7d)][_0x3d4f5c(0x96)](_0xcfda35?.[_0x3d4f5c(0x8f)]),_0x4d70bb=await TicketTraking_1[_0x3d4f5c(0x7d)][_0x3d4f5c(0xa3)]({'where':{'ticketId':_0x3c4ade['id'],'finishedAt':null}});if(!_0x19408e)return;let {timeInactiveMessage:_0x28232f,expiresInactiveMessage:_0x67d4b1,inactiveMessage:_0x89c7f9,expiresTicket:_0x2e9e9,expiresTicketNPS:_0x37c6f6,whenExpiresTicket:_0x4d252a,complationMessage:_0x265f4f}=_0x19408e;if(_0x37c6f6&&_0x37c6f6!==''&&_0x37c6f6!=='0'&&Number(_0x37c6f6)>0x0){const _0x129c2d=new Date();_0x129c2d[_0x3d4f5c(0x9a)](_0x129c2d[_0x3d4f5c(0x94)]()-Number(_0x37c6f6));if(_0x3c4ade[_0x3d4f5c(0x7f)]===_0x3d4f5c(0x7c)){const _0x566c38=new Date(_0xcfda35['updatedAt']);if(_0x566c38<_0x129c2d){_0x1221ba(_0xcfda35,_0xcfda35['status'],'');const _0x1e69eb=(0x0,Mustache_1['default'])('‎'+_0x265f4f,_0xcfda35);if(_0x265f4f!==''&&_0x265f4f!==undefined){const _0x660994=await(0x0,SendWhatsAppMessage_1[_0x3d4f5c(0x7d)])({'body':_0x1e69eb,'ticket':_0xcfda35});await(0x0,wbotMessageListener_1[_0x3d4f5c(0x9e)])(_0x660994,_0xcfda35,_0xcfda35[_0x3d4f5c(0x8d)]);}await _0x4d70bb[_0x3d4f5c(0x77)]({'finishedAt':(0x0,moment_1[_0x3d4f5c(0x7d)])()['toDate'](),'closedAt':(0x0,moment_1['default'])()[_0x3d4f5c(0x88)](),'whatsappId':_0x3c4ade[_0x3d4f5c(0x8f)],'userId':_0x3c4ade['userId']}),_0x40f841['to'](_0x3d4f5c(0x99))['emit'](_0x3d4f5c(0x83)+_0x28b25a+_0x3d4f5c(0x8e),{'action':_0x3d4f5c(0x79),'ticketId':_0xcfda35['id']});}}}if(_0x2e9e9&&_0x2e9e9!==''&&_0x2e9e9!=='0'&&Number(_0x2e9e9)>0x0){const _0x32063c=(0x0,Mustache_1[_0x3d4f5c(0x7d)])('‎'+_0x67d4b1,_0xcfda35),_0x1c40e1=new Date();_0x1c40e1[_0x3d4f5c(0x9a)](_0x1c40e1[_0x3d4f5c(0x94)]()-Number(_0x2e9e9));_0x28232f&&_0x28232f!==''&&_0x28232f!==null&&_0x28232f!=='0'&&Number(_0x28232f)>0x0&&_0x1c40e1['setMinutes'](_0x1c40e1[_0x3d4f5c(0x94)]()-Number(_0x28232f));if(_0xcfda35[_0x3d4f5c(0x7f)]===_0x3d4f5c(0x99)&&!_0xcfda35[_0x3d4f5c(0xa4)]){const _0x3a760d=new Date(_0xcfda35['updatedAt']);if(_0x3a760d<_0x1c40e1&&(_0x4d252a==='0'||_0x4d252a==='1'&&_0xcfda35[_0x3d4f5c(0x78)])){_0x1221ba(_0xcfda35,_0xcfda35[_0x3d4f5c(0x7f)],_0x32063c);if(_0x67d4b1!==''&&_0x67d4b1!==undefined){const _0x5cd51d=await(0x0,SendWhatsAppMessage_1[_0x3d4f5c(0x7d)])({'body':_0x32063c,'ticket':_0xcfda35});await(0x0,wbotMessageListener_1[_0x3d4f5c(0x9e)])(_0x5cd51d,_0xcfda35,_0xcfda35['contact']);}await _0x4d70bb['update']({'finishedAt':(0x0,moment_1[_0x3d4f5c(0x7d)])()[_0x3d4f5c(0x88)](),'closedAt':(0x0,moment_1[_0x3d4f5c(0x7d)])()['toDate'](),'whatsappId':_0x3c4ade[_0x3d4f5c(0x8f)],'userId':_0x3c4ade[_0x3d4f5c(0x98)]}),_0x40f841['to'](_0x3d4f5c(0x99))[_0x3d4f5c(0x95)](_0x3d4f5c(0x83)+_0x28b25a+_0x3d4f5c(0x8e),{'action':_0x3d4f5c(0x79),'ticketId':_0xcfda35['id']});}}}if(_0x28232f&&_0x28232f!==''&&_0x28232f!=='0'&&Number(_0x28232f)>0x0){const _0x3c5f27=(0x0,Mustache_1['default'])('‎'+_0x89c7f9,_0xcfda35),_0x377509=new Date();_0x377509[_0x3d4f5c(0x9a)](_0x377509['getMinutes']()-Number(_0x28232f));if(_0xcfda35['status']===_0x3d4f5c(0x99)&&!_0xcfda35[_0x3d4f5c(0xa4)]){const _0x37217e=new Date(_0xcfda35[_0x3d4f5c(0xa1)]);if(_0x37217e<_0x377509&&!_0xcfda35[_0x3d4f5c(0xa2)]&&(_0x4d252a==='0'||_0x4d252a==='1'&&_0xcfda35[_0x3d4f5c(0x78)])){const _0x557c91=await(0x0,SendWhatsAppMessage_1[_0x3d4f5c(0x7d)])({'body':_0x3c5f27,'ticket':_0xcfda35});await(0x0,wbotMessageListener_1[_0x3d4f5c(0x9e)])(_0x557c91,_0xcfda35,_0xcfda35[_0x3d4f5c(0x8d)]),await _0xcfda35['update']({'sendInactiveMessage':!![]}),_0x40f841['to'](_0x3d4f5c(0x99))[_0x3d4f5c(0x95)](_0x3d4f5c(0x83)+_0x28b25a+_0x3d4f5c(0x8e),{'action':_0x3d4f5c(0x79),'ticket':_0xcfda35,'ticketId':_0xcfda35['id']});}}}});}catch(_0x341ef3){console['log']('e',_0x341ef3);}};exports['ClosedAllOpenTickets']=ClosedAllOpenTickets;
>>>>>>> ab722bfbcf394d74dd0b99a984c0dcf6ffbcff7f
