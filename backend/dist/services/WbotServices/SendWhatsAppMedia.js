'use strict';const a607_0x5bcfd7=a607_0x8975;function a607_0x8975(_0x3eeb3d,_0x2db6c2){const _0x2d5897=a607_0x2d58();return a607_0x8975=function(_0x897523,_0x252b1c){_0x897523=_0x897523-0x1a0;let _0x5d4698=_0x2d5897[_0x897523];return _0x5d4698;},a607_0x8975(_0x3eeb3d,_0x2db6c2);}(function(_0xb0ea37,_0xa5e047){const _0x27ec98=a607_0x8975,_0x107641=_0xb0ea37();while(!![]){try{const _0x239c37=parseInt(_0x27ec98(0x1df))/0x1*(-parseInt(_0x27ec98(0x1bd))/0x2)+-parseInt(_0x27ec98(0x1a8))/0x3*(-parseInt(_0x27ec98(0x1c9))/0x4)+-parseInt(_0x27ec98(0x1a9))/0x5*(parseInt(_0x27ec98(0x1dd))/0x6)+parseInt(_0x27ec98(0x1f0))/0x7+-parseInt(_0x27ec98(0x1a6))/0x8*(parseInt(_0x27ec98(0x1ba))/0x9)+-parseInt(_0x27ec98(0x1cb))/0xa*(-parseInt(_0x27ec98(0x1c5))/0xb)+-parseInt(_0x27ec98(0x1cc))/0xc*(-parseInt(_0x27ec98(0x1be))/0xd);if(_0x239c37===_0xa5e047)break;else _0x107641['push'](_0x107641['shift']());}catch(_0x17d317){_0x107641['push'](_0x107641['shift']());}}}(a607_0x2d58,0x3250f));function a607_0x2d58(){const _0x2406b3=['getMessageOptions','substring','findByPk','ERR_SENDING_WAPP_MSG','replace','audio','lookup','Invalid\x20mimetype','g.us','51918cuZHmg','__importDefault','1UkyxUs','ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio','originalname','create','sendMessage','ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo','s.whatsapp.net','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','video','call','defineProperty','mime-types','prototype','readFileSync','configurable','audio/mp4','child_process','1331897hvVPdr','getWbot','ðŸ“‚\x20Documento','../../helpers/Mustache','exec','PVT','number','3115256qrCowr','toString','3CSiVEG','25tGsJuy','log','../MessageServices/CreateMessageService','@sentry/node','public','getTime','hasOwnProperty','../../models/Contact','.mp3','companyId','mimetype','../../errors/AppError','isGroup','__importStar','ðŸ“Ž\x20Outros\x20anexos','contactId','path','9ayCFhT','document','unlinkSync','251058PsBwhV','78QBAjSX','get','__createBinding','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','__esModule','whatsappId','/company','110WqVWPP','captureException','default','\x20-i\x20','316756GWvyVr','includes','146530ntuYQH','696612VZmCPa','../../libs/wbot','remoteJid','filename','\x20-y','@ffmpeg-installer/ffmpeg','application','split'];a607_0x2d58=function(){return _0x2406b3;};return a607_0x2d58();}var __createBinding=this&&this[a607_0x5bcfd7(0x1c0)]||(Object[a607_0x5bcfd7(0x1e2)]?function(_0x35bf34,_0x5a87ab,_0x10a32b,_0x550d93){const _0x390b43=a607_0x5bcfd7;if(_0x550d93===undefined)_0x550d93=_0x10a32b;var _0xae4c9f=Object['getOwnPropertyDescriptor'](_0x5a87ab,_0x10a32b);(!_0xae4c9f||(_0x390b43(0x1bf)in _0xae4c9f?!_0x5a87ab[_0x390b43(0x1c2)]:_0xae4c9f['writable']||_0xae4c9f[_0x390b43(0x1ed)]))&&(_0xae4c9f={'enumerable':!![],'get':function(){return _0x5a87ab[_0x10a32b];}}),Object[_0x390b43(0x1e9)](_0x35bf34,_0x550d93,_0xae4c9f);}:function(_0x1701b4,_0xb25a74,_0xb3ba02,_0x2fe847){if(_0x2fe847===undefined)_0x2fe847=_0xb3ba02;_0x1701b4[_0x2fe847]=_0xb25a74[_0xb3ba02];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a607_0x5bcfd7(0x1e2)]?function(_0x11b0d2,_0x3fd789){const _0x4bd083=a607_0x5bcfd7;Object[_0x4bd083(0x1e9)](_0x11b0d2,_0x4bd083(0x1c7),{'enumerable':!![],'value':_0x3fd789});}:function(_0x1e3142,_0x47190c){const _0x4b430e=a607_0x5bcfd7;_0x1e3142[_0x4b430e(0x1c7)]=_0x47190c;}),__importStar=this&&this[a607_0x5bcfd7(0x1b6)]||function(_0x4b1d43){const _0x3b3b70=a607_0x5bcfd7;if(_0x4b1d43&&_0x4b1d43['__esModule'])return _0x4b1d43;var _0x5f4896={};if(_0x4b1d43!=null){for(var _0x410a99 in _0x4b1d43)if(_0x410a99!==_0x3b3b70(0x1c7)&&Object[_0x3b3b70(0x1eb)][_0x3b3b70(0x1af)][_0x3b3b70(0x1e8)](_0x4b1d43,_0x410a99))__createBinding(_0x5f4896,_0x4b1d43,_0x410a99);}return __setModuleDefault(_0x5f4896,_0x4b1d43),_0x5f4896;},__importDefault=this&&this[a607_0x5bcfd7(0x1de)]||function(_0x264673){return _0x264673&&_0x264673['__esModule']?_0x264673:{'default':_0x264673};};Object[a607_0x5bcfd7(0x1e9)](exports,'__esModule',{'value':!![]}),exports[a607_0x5bcfd7(0x1d4)]=void 0x0;const Sentry=__importStar(require(a607_0x5bcfd7(0x1ac))),fs_1=__importStar(require('fs')),child_process_1=require(a607_0x5bcfd7(0x1ef)),path_1=__importDefault(require(a607_0x5bcfd7(0x1b9))),ffmpeg_1=__importDefault(require(a607_0x5bcfd7(0x1d1))),AppError_1=__importDefault(require(a607_0x5bcfd7(0x1b4))),mime_types_1=__importDefault(require(a607_0x5bcfd7(0x1ea))),Contact_1=__importDefault(require(a607_0x5bcfd7(0x1b0))),wbot_1=require(a607_0x5bcfd7(0x1cd)),CreateMessageService_1=__importDefault(require(a607_0x5bcfd7(0x1ab))),Mustache_1=__importDefault(require(a607_0x5bcfd7(0x1a2))),publicFolder=path_1[a607_0x5bcfd7(0x1c7)]['resolve'](__dirname,'..','..','..',a607_0x5bcfd7(0x1ad)),processAudio=async(_0x2f0b0c,_0x330065)=>{const _0x57ebe1=a607_0x5bcfd7,_0x5292e3=publicFolder+_0x57ebe1(0x1c4)+_0x330065+'/'+new Date()[_0x57ebe1(0x1ae)]()+_0x57ebe1(0x1b1);return new Promise((_0x19aade,_0x171a48)=>{const _0x411227=_0x57ebe1;(0x0,child_process_1['exec'])(ffmpeg_1[_0x411227(0x1c7)][_0x411227(0x1b9)]+_0x411227(0x1c8)+_0x2f0b0c+_0x411227(0x1e6)+_0x5292e3+_0x411227(0x1d0),(_0x5b6576,_0x43ebcf,_0xd6878f)=>{if(_0x5b6576)_0x171a48(_0x5b6576);_0x19aade(_0x5292e3);});});},processAudioFile=async(_0x283acd,_0x5ae42d)=>{const _0x56e590=a607_0x5bcfd7,_0x18aaa0=publicFolder+_0x56e590(0x1c4)+_0x5ae42d+'/'+new Date()[_0x56e590(0x1ae)]()+_0x56e590(0x1b1);return new Promise((_0x3d70c5,_0x555239)=>{const _0x4b219c=_0x56e590;(0x0,child_process_1[_0x4b219c(0x1a3)])(ffmpeg_1[_0x4b219c(0x1c7)][_0x4b219c(0x1b9)]+_0x4b219c(0x1c8)+_0x283acd+_0x4b219c(0x1c1)+_0x18aaa0,(_0x25bdca,_0x115933,_0x56b601)=>{if(_0x25bdca)_0x555239(_0x25bdca);_0x3d70c5(_0x18aaa0);});});},getMessageOptions=async(_0x4d5c89,_0x5a075f,_0x18ae50,_0x277299)=>{const _0x16a1c4=a607_0x5bcfd7,_0x106aa4=mime_types_1[_0x16a1c4(0x1c7)][_0x16a1c4(0x1da)](_0x5a075f),_0x556e13=_0x106aa4[_0x16a1c4(0x1d3)]('/')[0x0];try{if(!_0x106aa4)throw new Error(_0x16a1c4(0x1db));let _0x295634;if(_0x556e13===_0x16a1c4(0x1e7))_0x295634={'video':fs_1['default'][_0x16a1c4(0x1ec)](_0x5a075f),'caption':_0x277299?_0x277299:null,'fileName':_0x4d5c89};else{if(_0x556e13===_0x16a1c4(0x1d9)){const _0x3704a6=!![],_0x56ef5a=await processAudio(_0x5a075f,_0x18ae50);_0x3704a6?_0x295634={'audio':fs_1[_0x16a1c4(0x1c7)][_0x16a1c4(0x1ec)](_0x56ef5a),'mimetype':_0x16a1c4(0x1ee),'ptt':!![]}:_0x295634={'audio':fs_1[_0x16a1c4(0x1c7)]['readFileSync'](_0x56ef5a),'mimetype':_0x3704a6?_0x16a1c4(0x1ee):_0x106aa4,'ptt':!![]};}else{if(_0x556e13==='document')_0x295634={'document':fs_1[_0x16a1c4(0x1c7)][_0x16a1c4(0x1ec)](_0x5a075f),'caption':_0x277299?_0x277299:null,'fileName':_0x4d5c89,'mimetype':_0x106aa4};else _0x556e13===_0x16a1c4(0x1d2)?_0x295634={'document':fs_1[_0x16a1c4(0x1c7)][_0x16a1c4(0x1ec)](_0x5a075f),'caption':_0x277299?_0x277299:null,'fileName':_0x4d5c89,'mimetype':_0x106aa4}:_0x295634={'image':fs_1[_0x16a1c4(0x1c7)][_0x16a1c4(0x1ec)](_0x5a075f),'caption':_0x277299?_0x277299:_0x4d5c89};}}return _0x295634;}catch(_0xe37b79){return Sentry[_0x16a1c4(0x1c6)](_0xe37b79),console[_0x16a1c4(0x1aa)](_0xe37b79),null;}};exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x59bee7,ticket:_0x1e8aab,body:_0x36d887,isPrivate:_0x29fece,isForwarded:isForwarded=![]})=>{const _0x258740=a607_0x5bcfd7;try{const _0xa3211d=await(0x0,wbot_1[_0x258740(0x1a0)])(_0x1e8aab[_0x258740(0x1c3)]),_0x47f6da=_0x1e8aab[_0x258740(0x1b2)][_0x258740(0x1a7)](),_0x1a662b=_0x59bee7[_0x258740(0x1b9)],_0x41d6aa=_0x59bee7[_0x258740(0x1b3)][_0x258740(0x1d3)]('/')[0x0];let _0x2e4058,_0x42c81c='';const _0xb3d5ed=_0x1e8aab?(0x0,Mustache_1[_0x258740(0x1c7)])(_0x36d887,_0x1e8aab):_0x36d887;if(_0x41d6aa===_0x258740(0x1e7))_0x2e4058={'video':fs_1[_0x258740(0x1c7)][_0x258740(0x1ec)](_0x1a662b),'caption':_0xb3d5ed,'fileName':_0x59bee7[_0x258740(0x1e1)][_0x258740(0x1d8)]('/','-'),'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x42c81c=_0x258740(0x1e4);else{if(_0x41d6aa===_0x258740(0x1d9)){const _0x43149f=!![];if(_0x43149f){const _0x58ef48=await processAudio(_0x59bee7[_0x258740(0x1b9)],_0x47f6da);_0x2e4058={'audio':fs_1[_0x258740(0x1c7)]['readFileSync'](_0x58ef48),'mimetype':_0x43149f?_0x258740(0x1ee):_0x59bee7[_0x258740(0x1b3)],'ptt':!![],'caption':_0xb3d5ed,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x258740(0x1bc)])(_0x58ef48);}else{const _0x5d4cbc=await processAudio(_0x59bee7[_0x258740(0x1b9)],_0x47f6da);_0x2e4058={'audio':fs_1['default'][_0x258740(0x1ec)](_0x5d4cbc),'mimetype':_0x258740(0x1ee),'ptt':!![],'caption':_0xb3d5ed,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x258740(0x1bc)])(_0x5d4cbc);}_0x42c81c=_0x258740(0x1e0);}else{if(_0x41d6aa===_0x258740(0x1bb)||_0x41d6aa==='text')_0x2e4058={'document':fs_1[_0x258740(0x1c7)][_0x258740(0x1ec)](_0x1a662b),'caption':_0xb3d5ed,'fileName':_0x59bee7['originalname'][_0x258740(0x1d8)]('/','-'),'mimetype':_0x59bee7['mimetype'],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x42c81c=_0x258740(0x1a1);else _0x41d6aa===_0x258740(0x1d2)?(_0x2e4058={'document':fs_1['default'][_0x258740(0x1ec)](_0x1a662b),'caption':_0xb3d5ed,'fileName':_0x59bee7[_0x258740(0x1e1)][_0x258740(0x1d8)]('/','-'),'mimetype':_0x59bee7[_0x258740(0x1b3)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x42c81c=_0x258740(0x1b7)):(_0x2e4058={'image':fs_1[_0x258740(0x1c7)][_0x258740(0x1ec)](_0x1a662b),'caption':_0xb3d5ed,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x42c81c=_0x258740(0x1b7));}}if(_0x29fece){const _0x3a4faa={'wid':_0x258740(0x1a4)+_0x47f6da+_0x1e8aab['id']+_0x36d887[_0x258740(0x1d5)](0x0,0x6),'ticketId':_0x1e8aab['id'],'contactId':undefined,'body':_0xb3d5ed,'fromMe':!![],'mediaUrl':_0x59bee7[_0x258740(0x1cf)],'mediaType':_0x59bee7['mimetype'][_0x258740(0x1d3)]('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x29fece};await(0x0,CreateMessageService_1[_0x258740(0x1c7)])({'messageData':_0x3a4faa,'companyId':_0x1e8aab['companyId']});return;}const _0x2fd4fa=await Contact_1['default'][_0x258740(0x1d6)](_0x1e8aab[_0x258740(0x1b8)]);let _0x53b915;_0x2fd4fa[_0x258740(0x1ce)]&&_0x2fd4fa[_0x258740(0x1ce)]!==''&&_0x2fd4fa[_0x258740(0x1ce)][_0x258740(0x1ca)]('@')?_0x53b915=_0x2fd4fa[_0x258740(0x1ce)]:_0x53b915=_0x2fd4fa[_0x258740(0x1a5)]+'@'+(_0x1e8aab[_0x258740(0x1b5)]?_0x258740(0x1dc):_0x258740(0x1e5));const _0x1a22ec=await _0xa3211d[_0x258740(0x1e3)](_0x53b915,{..._0x2e4058});return await _0x1e8aab['update']({'lastMessage':_0x36d887!==_0x59bee7[_0x258740(0x1cf)]?_0x36d887:_0xb3d5ed,'imported':null}),_0x1a22ec;}catch(_0x5b46d9){Sentry[_0x258740(0x1c6)](_0x5b46d9),console[_0x258740(0x1aa)](_0x5b46d9);throw new AppError_1['default'](_0x258740(0x1d7));}};exports['default']=SendWhatsAppMedia;