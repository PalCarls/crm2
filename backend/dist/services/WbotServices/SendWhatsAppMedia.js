'use strict';const a607_0x56727b=a607_0x2983;(function(_0x7d9524,_0x57c5be){const _0x48ed5e=a607_0x2983,_0x4ff14e=_0x7d9524();while(!![]){try{const _0x539ce3=parseInt(_0x48ed5e(0x177))/0x1*(-parseInt(_0x48ed5e(0x188))/0x2)+parseInt(_0x48ed5e(0x17a))/0x3+parseInt(_0x48ed5e(0x17f))/0x4*(parseInt(_0x48ed5e(0x197))/0x5)+parseInt(_0x48ed5e(0x191))/0x6+parseInt(_0x48ed5e(0x189))/0x7*(parseInt(_0x48ed5e(0x17c))/0x8)+parseInt(_0x48ed5e(0x1a5))/0x9*(parseInt(_0x48ed5e(0x190))/0xa)+-parseInt(_0x48ed5e(0x19b))/0xb*(parseInt(_0x48ed5e(0x199))/0xc);if(_0x539ce3===_0x57c5be)break;else _0x4ff14e['push'](_0x4ff14e['shift']());}catch(_0x73096d){_0x4ff14e['push'](_0x4ff14e['shift']());}}}(a607_0x26c0,0x6248e));var __createBinding=this&&this[a607_0x56727b(0x18a)]||(Object[a607_0x56727b(0x1a6)]?function(_0x346a72,_0x2ce2a8,_0x364c67,_0x476496){const _0x35df83=a607_0x56727b;if(_0x476496===undefined)_0x476496=_0x364c67;var _0x2a823a=Object[_0x35df83(0x183)](_0x2ce2a8,_0x364c67);(!_0x2a823a||(_0x35df83(0x17d)in _0x2a823a?!_0x2ce2a8[_0x35df83(0x185)]:_0x2a823a[_0x35df83(0x19d)]||_0x2a823a['configurable']))&&(_0x2a823a={'enumerable':!![],'get':function(){return _0x2ce2a8[_0x364c67];}}),Object[_0x35df83(0x173)](_0x346a72,_0x476496,_0x2a823a);}:function(_0x46e147,_0x2e0448,_0x50a0e7,_0x3be42e){if(_0x3be42e===undefined)_0x3be42e=_0x50a0e7;_0x46e147[_0x3be42e]=_0x2e0448[_0x50a0e7];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a607_0x56727b(0x1a6)]?function(_0x1e8bdc,_0x4607dc){const _0x59e97=a607_0x56727b;Object[_0x59e97(0x173)](_0x1e8bdc,_0x59e97(0x172),{'enumerable':!![],'value':_0x4607dc});}:function(_0x35256e,_0x462e4c){const _0x5810b4=a607_0x56727b;_0x35256e[_0x5810b4(0x172)]=_0x462e4c;}),__importStar=this&&this['__importStar']||function(_0x570526){const _0x13000b=a607_0x56727b;if(_0x570526&&_0x570526[_0x13000b(0x185)])return _0x570526;var _0x15c1e9={};if(_0x570526!=null){for(var _0x3b18c8 in _0x570526)if(_0x3b18c8!==_0x13000b(0x172)&&Object['prototype'][_0x13000b(0x161)][_0x13000b(0x15e)](_0x570526,_0x3b18c8))__createBinding(_0x15c1e9,_0x570526,_0x3b18c8);}return __setModuleDefault(_0x15c1e9,_0x570526),_0x15c1e9;},__importDefault=this&&this[a607_0x56727b(0x178)]||function(_0x500585){return _0x500585&&_0x500585['__esModule']?_0x500585:{'default':_0x500585};};function a607_0x26c0(){const _0x5bb385=['log','writable','ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo','g.us','getWbot','companyId','ðŸ“‚\x20Documento','audio','.mp3','4621509dIABGK','create','video','substring','whatsappId','mimetype','call','document','../MessageServices/CreateMessageService','hasOwnProperty','filename','number','mime-types','originalname','path','\x20-y','split','child_process','application','getTime','\x20-i\x20','@ffmpeg-installer/ffmpeg','isGroup','includes','public','/company','default','defineProperty','ERR_SENDING_WAPP_MSG','exec','../../libs/wbot','46zcIcUf','__importDefault','unlinkSync','1626981dOGVJj','toString','176oNZOAv','get','audio/mp4','20aUPZmW','../../helpers/Mustache','readFileSync','contactId','getOwnPropertyDescriptor','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','__esModule','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','@sentry/node','12004QNyykd','160853tbiqZa','__createBinding','remoteJid','captureException','../../errors/AppError','resolve','PVT','10DsFoGV','1418724QLdlvP','getMessageOptions','findByPk','replace','sendMessage','text','129235pFiuvl','../../models/Contact','2364RUvgcn','ðŸ“Ž\x20Outros\x20anexos','69707FnFfwU'];a607_0x26c0=function(){return _0x5bb385;};return a607_0x26c0();}Object[a607_0x56727b(0x173)](exports,a607_0x56727b(0x185),{'value':!![]}),exports[a607_0x56727b(0x192)]=void 0x0;function a607_0x2983(_0x427287,_0x58a52a){const _0x26c046=a607_0x26c0();return a607_0x2983=function(_0x298335,_0x27e9f1){_0x298335=_0x298335-0x15e;let _0x22f859=_0x26c046[_0x298335];return _0x22f859;},a607_0x2983(_0x427287,_0x58a52a);}const Sentry=__importStar(require(a607_0x56727b(0x187))),fs_1=__importStar(require('fs')),child_process_1=require(a607_0x56727b(0x169)),path_1=__importDefault(require(a607_0x56727b(0x166))),ffmpeg_1=__importDefault(require(a607_0x56727b(0x16d))),AppError_1=__importDefault(require(a607_0x56727b(0x18d))),mime_types_1=__importDefault(require(a607_0x56727b(0x164))),Contact_1=__importDefault(require(a607_0x56727b(0x198))),wbot_1=require(a607_0x56727b(0x176)),CreateMessageService_1=__importDefault(require(a607_0x56727b(0x160))),Mustache_1=__importDefault(require(a607_0x56727b(0x180))),publicFolder=path_1[a607_0x56727b(0x172)][a607_0x56727b(0x18e)](__dirname,'..','..','..',a607_0x56727b(0x170)),processAudio=async(_0x5a5727,_0x17e0bf)=>{const _0x13a32c=a607_0x56727b,_0x19d912=publicFolder+_0x13a32c(0x171)+_0x17e0bf+'/'+new Date()[_0x13a32c(0x16b)]()+_0x13a32c(0x1a4);return new Promise((_0x350b4d,_0xe01f7b)=>{const _0x5bb020=_0x13a32c;(0x0,child_process_1[_0x5bb020(0x175)])(ffmpeg_1[_0x5bb020(0x172)][_0x5bb020(0x166)]+_0x5bb020(0x16c)+_0x5a5727+_0x5bb020(0x186)+_0x19d912+_0x5bb020(0x167),(_0x4aa2cf,_0x3ed51f,_0x383651)=>{if(_0x4aa2cf)_0xe01f7b(_0x4aa2cf);_0x350b4d(_0x19d912);});});},processAudioFile=async(_0x18c088,_0xcaa128)=>{const _0x334bc4=a607_0x56727b,_0x1e6739=publicFolder+'/company'+_0xcaa128+'/'+new Date()[_0x334bc4(0x16b)]()+'.mp3';return new Promise((_0x1c5a1b,_0x1bedee)=>{const _0x4f3cad=_0x334bc4;(0x0,child_process_1['exec'])(ffmpeg_1[_0x4f3cad(0x172)]['path']+_0x4f3cad(0x16c)+_0x18c088+_0x4f3cad(0x184)+_0x1e6739,(_0x55634,_0x2212f4,_0x431af4)=>{if(_0x55634)_0x1bedee(_0x55634);_0x1c5a1b(_0x1e6739);});});},getMessageOptions=async(_0x99b78d,_0x147c59,_0x5a2b86,_0x497376)=>{const _0xf300ae=a607_0x56727b,_0x46a4a3=mime_types_1[_0xf300ae(0x172)]['lookup'](_0x147c59),_0x2cb121=_0x46a4a3['split']('/')[0x0];try{if(!_0x46a4a3)throw new Error('Invalid\x20mimetype');let _0x76a51;if(_0x2cb121===_0xf300ae(0x1a7))_0x76a51={'video':fs_1[_0xf300ae(0x172)][_0xf300ae(0x181)](_0x147c59),'caption':_0x497376?_0x497376:null,'fileName':_0x99b78d};else{if(_0x2cb121===_0xf300ae(0x1a3)){const _0x5752c7=!![],_0x5c46c6=await processAudio(_0x147c59,_0x5a2b86);_0x5752c7?_0x76a51={'audio':fs_1[_0xf300ae(0x172)][_0xf300ae(0x181)](_0x5c46c6),'mimetype':_0xf300ae(0x17e),'ptt':!![]}:_0x76a51={'audio':fs_1[_0xf300ae(0x172)][_0xf300ae(0x181)](_0x5c46c6),'mimetype':_0x5752c7?_0xf300ae(0x17e):_0x46a4a3,'ptt':!![]};}else{if(_0x2cb121==='document')_0x76a51={'document':fs_1[_0xf300ae(0x172)][_0xf300ae(0x181)](_0x147c59),'caption':_0x497376?_0x497376:null,'fileName':_0x99b78d,'mimetype':_0x46a4a3};else _0x2cb121===_0xf300ae(0x16a)?_0x76a51={'document':fs_1[_0xf300ae(0x172)][_0xf300ae(0x181)](_0x147c59),'caption':_0x497376?_0x497376:null,'fileName':_0x99b78d,'mimetype':_0x46a4a3}:_0x76a51={'image':fs_1[_0xf300ae(0x172)][_0xf300ae(0x181)](_0x147c59),'caption':_0x497376?_0x497376:_0x99b78d};}}return _0x76a51;}catch(_0xaa6d71){return Sentry[_0xf300ae(0x18c)](_0xaa6d71),console[_0xf300ae(0x19c)](_0xaa6d71),null;}};exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x52ef18,ticket:_0x3c7967,body:_0x4f0000,isPrivate:_0x5976c2,isForwarded:isForwarded=![]})=>{const _0x27598e=a607_0x56727b;try{const _0x5db159=await(0x0,wbot_1[_0x27598e(0x1a0)])(_0x3c7967[_0x27598e(0x1a9)]),_0x5af2e1=_0x3c7967[_0x27598e(0x1a1)][_0x27598e(0x17b)](),_0x2176c1=_0x52ef18[_0x27598e(0x166)],_0x4b6b1a=_0x52ef18[_0x27598e(0x1aa)][_0x27598e(0x168)]('/')[0x0];let _0x433336,_0x17d631='';const _0xf5e798=_0x3c7967?(0x0,Mustache_1[_0x27598e(0x172)])(_0x4f0000,_0x3c7967):_0x4f0000;if(_0x4b6b1a===_0x27598e(0x1a7))_0x433336={'video':fs_1['default'][_0x27598e(0x181)](_0x2176c1),'caption':_0xf5e798,'fileName':_0x52ef18[_0x27598e(0x165)][_0x27598e(0x194)]('/','-'),'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x17d631=_0x27598e(0x19e);else{if(_0x4b6b1a===_0x27598e(0x1a3)){const _0x2d791f=!![];if(_0x2d791f){const _0x254353=await processAudio(_0x52ef18[_0x27598e(0x166)],_0x5af2e1);_0x433336={'audio':fs_1[_0x27598e(0x172)][_0x27598e(0x181)](_0x254353),'mimetype':_0x2d791f?_0x27598e(0x17e):_0x52ef18['mimetype'],'ptt':!![],'caption':_0xf5e798,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x27598e(0x179)])(_0x254353);}else{const _0x3326e3=await processAudio(_0x52ef18[_0x27598e(0x166)],_0x5af2e1);_0x433336={'audio':fs_1[_0x27598e(0x172)][_0x27598e(0x181)](_0x3326e3),'mimetype':'audio/mp4','ptt':!![],'caption':_0xf5e798,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x27598e(0x179)])(_0x3326e3);}_0x17d631='ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio';}else{if(_0x4b6b1a===_0x27598e(0x15f)||_0x4b6b1a===_0x27598e(0x196))_0x433336={'document':fs_1[_0x27598e(0x172)]['readFileSync'](_0x2176c1),'caption':_0xf5e798,'fileName':_0x52ef18[_0x27598e(0x165)]['replace']('/','-'),'mimetype':_0x52ef18[_0x27598e(0x1aa)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x17d631=_0x27598e(0x1a2);else _0x4b6b1a==='application'?(_0x433336={'document':fs_1['default'][_0x27598e(0x181)](_0x2176c1),'caption':_0xf5e798,'fileName':_0x52ef18[_0x27598e(0x165)]['replace']('/','-'),'mimetype':_0x52ef18[_0x27598e(0x1aa)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x17d631='ðŸ“Ž\x20Outros\x20anexos'):(_0x433336={'image':fs_1[_0x27598e(0x172)]['readFileSync'](_0x2176c1),'caption':_0xf5e798,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x17d631=_0x27598e(0x19a));}}if(_0x5976c2){const _0x956b5d={'wid':_0x27598e(0x18f)+_0x5af2e1+_0x3c7967['id']+_0x4f0000[_0x27598e(0x1a8)](0x0,0x6),'ticketId':_0x3c7967['id'],'contactId':undefined,'body':_0xf5e798,'fromMe':!![],'mediaUrl':_0x52ef18[_0x27598e(0x162)],'mediaType':_0x52ef18[_0x27598e(0x1aa)]['split']('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x5976c2};await(0x0,CreateMessageService_1[_0x27598e(0x172)])({'messageData':_0x956b5d,'companyId':_0x3c7967[_0x27598e(0x1a1)]});return;}const _0x3b0fe9=await Contact_1[_0x27598e(0x172)][_0x27598e(0x193)](_0x3c7967[_0x27598e(0x182)]);let _0xf613b8;_0x3b0fe9['remoteJid']&&_0x3b0fe9[_0x27598e(0x18b)]!==''&&_0x3b0fe9['remoteJid'][_0x27598e(0x16f)]('@')?_0xf613b8=_0x3b0fe9['remoteJid']:_0xf613b8=_0x3b0fe9[_0x27598e(0x163)]+'@'+(_0x3c7967[_0x27598e(0x16e)]?_0x27598e(0x19f):'s.whatsapp.net');const _0x140e70=await _0x5db159[_0x27598e(0x195)](_0xf613b8,{..._0x433336});return await _0x3c7967['update']({'lastMessage':_0x4f0000!==_0x52ef18[_0x27598e(0x162)]?_0x4f0000:_0xf5e798,'imported':null}),_0x140e70;}catch(_0x163b48){Sentry[_0x27598e(0x18c)](_0x163b48),console[_0x27598e(0x19c)](_0x163b48);throw new AppError_1[(_0x27598e(0x172))](_0x27598e(0x174));}};exports[a607_0x56727b(0x172)]=SendWhatsAppMedia;