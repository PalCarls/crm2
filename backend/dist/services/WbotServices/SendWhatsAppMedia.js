'use strict';function a544_0x3865(_0x3c4ae0,_0xec9cdf){const _0xd800b3=a544_0xd800();return a544_0x3865=function(_0x38651e,_0x599292){_0x38651e=_0x38651e-0x12a;let _0x483e5a=_0xd800b3[_0x38651e];return _0x483e5a;},a544_0x3865(_0x3c4ae0,_0xec9cdf);}const a544_0x446ae6=a544_0x3865;(function(_0x88b96b,_0x41a0da){const _0x1cf5c1=a544_0x3865,_0x48ecfd=_0x88b96b();while(!![]){try{const _0x4ce7d4=-parseInt(_0x1cf5c1(0x155))/0x1+-parseInt(_0x1cf5c1(0x16a))/0x2+parseInt(_0x1cf5c1(0x151))/0x3*(parseInt(_0x1cf5c1(0x156))/0x4)+-parseInt(_0x1cf5c1(0x140))/0x5+-parseInt(_0x1cf5c1(0x147))/0x6*(parseInt(_0x1cf5c1(0x14e))/0x7)+-parseInt(_0x1cf5c1(0x145))/0x8+-parseInt(_0x1cf5c1(0x12f))/0x9*(-parseInt(_0x1cf5c1(0x134))/0xa);if(_0x4ce7d4===_0x41a0da)break;else _0x48ecfd['push'](_0x48ecfd['shift']());}catch(_0x53dd60){_0x48ecfd['push'](_0x48ecfd['shift']());}}}(a544_0xd800,0x29ced));var __createBinding=this&&this[a544_0x446ae6(0x13a)]||(Object[a544_0x446ae6(0x146)]?function(_0x4559a7,_0x2aa146,_0x101735,_0x4447ec){const _0xfb26ee=a544_0x446ae6;if(_0x4447ec===undefined)_0x4447ec=_0x101735;var _0xea0f5e=Object[_0xfb26ee(0x12b)](_0x2aa146,_0x101735);(!_0xea0f5e||('get'in _0xea0f5e?!_0x2aa146[_0xfb26ee(0x144)]:_0xea0f5e[_0xfb26ee(0x149)]||_0xea0f5e[_0xfb26ee(0x165)]))&&(_0xea0f5e={'enumerable':!![],'get':function(){return _0x2aa146[_0x101735];}}),Object['defineProperty'](_0x4559a7,_0x4447ec,_0xea0f5e);}:function(_0x6f1a78,_0x531c3e,_0x12549e,_0x1663e9){if(_0x1663e9===undefined)_0x1663e9=_0x12549e;_0x6f1a78[_0x1663e9]=_0x531c3e[_0x12549e];}),__setModuleDefault=this&&this[a544_0x446ae6(0x160)]||(Object[a544_0x446ae6(0x146)]?function(_0x487e54,_0x292bf4){const _0x26aaae=a544_0x446ae6;Object[_0x26aaae(0x153)](_0x487e54,_0x26aaae(0x133),{'enumerable':!![],'value':_0x292bf4});}:function(_0x1a0bff,_0x5a55e3){const _0x1a62ec=a544_0x446ae6;_0x1a0bff[_0x1a62ec(0x133)]=_0x5a55e3;}),__importStar=this&&this['__importStar']||function(_0x4e4547){const _0xd9f6f6=a544_0x446ae6;if(_0x4e4547&&_0x4e4547[_0xd9f6f6(0x144)])return _0x4e4547;var _0x58f512={};if(_0x4e4547!=null){for(var _0x520b2c in _0x4e4547)if(_0x520b2c!==_0xd9f6f6(0x133)&&Object['prototype']['hasOwnProperty'][_0xd9f6f6(0x13f)](_0x4e4547,_0x520b2c))__createBinding(_0x58f512,_0x4e4547,_0x520b2c);}return __setModuleDefault(_0x58f512,_0x4e4547),_0x58f512;},__importDefault=this&&this[a544_0x446ae6(0x138)]||function(_0x30435c){const _0x8af1f6=a544_0x446ae6;return _0x30435c&&_0x30435c[_0x8af1f6(0x144)]?_0x30435c:{'default':_0x30435c};};Object[a544_0x446ae6(0x153)](exports,a544_0x446ae6(0x144),{'value':!![]}),exports[a544_0x446ae6(0x135)]=void 0x0;const Sentry=__importStar(require(a544_0x446ae6(0x13e))),fs_1=__importStar(require('fs')),child_process_1=require(a544_0x446ae6(0x12c)),path_1=__importDefault(require(a544_0x446ae6(0x130))),ffmpeg_1=__importDefault(require(a544_0x446ae6(0x131))),AppError_1=__importDefault(require('../../errors/AppError')),mime_types_1=__importDefault(require('mime-types')),Contact_1=__importDefault(require(a544_0x446ae6(0x139))),wbot_1=require(a544_0x446ae6(0x14b)),CreateMessageService_1=__importDefault(require(a544_0x446ae6(0x13b))),Mustache_1=__importDefault(require(a544_0x446ae6(0x154))),publicFolder=path_1[a544_0x446ae6(0x133)]['resolve'](__dirname,'..','..','..',a544_0x446ae6(0x167)),processAudio=async(_0x3a4335,_0x189d0c)=>{const _0x152557=a544_0x446ae6,_0x534766=publicFolder+_0x152557(0x143)+_0x189d0c+'/'+new Date()[_0x152557(0x169)]()+_0x152557(0x159);return new Promise((_0x16fc5c,_0x39a1cd)=>{const _0x190b86=_0x152557;(0x0,child_process_1[_0x190b86(0x152)])(ffmpeg_1['default'][_0x190b86(0x130)]+_0x190b86(0x142)+_0x3a4335+_0x190b86(0x14c)+_0x534766+'\x20-y',(_0x57881e,_0x216ec6,_0x4c3e6a)=>{if(_0x57881e)_0x39a1cd(_0x57881e);_0x16fc5c(_0x534766);});});},processAudioFile=async(_0x132ae1,_0x3b6939)=>{const _0xaf376e=a544_0x446ae6,_0x326401=publicFolder+_0xaf376e(0x143)+_0x3b6939+'/'+new Date()[_0xaf376e(0x169)]()+_0xaf376e(0x166);return new Promise((_0x45fca3,_0x38bbe0)=>{const _0x595a09=_0xaf376e;(0x0,child_process_1[_0x595a09(0x152)])(ffmpeg_1[_0x595a09(0x133)][_0x595a09(0x130)]+_0x595a09(0x142)+_0x132ae1+_0x595a09(0x15a)+_0x326401,(_0x525112,_0x4285dd,_0x1b3eb9)=>{if(_0x525112)_0x38bbe0(_0x525112);_0x45fca3(_0x326401);});});},getMessageOptions=async(_0x37ef58,_0x27cb54,_0x5ab553,_0x4969b5)=>{const _0x578ce8=a544_0x446ae6,_0xec84bf=mime_types_1[_0x578ce8(0x133)][_0x578ce8(0x150)](_0x27cb54),_0x123cb4=_0xec84bf[_0x578ce8(0x157)]('/')[0x0];try{if(!_0xec84bf)throw new Error('Invalid\x20mimetype');let _0x2453da;if(_0x123cb4===_0x578ce8(0x161))_0x2453da={'video':fs_1[_0x578ce8(0x133)]['readFileSync'](_0x27cb54),'caption':_0x4969b5?_0x4969b5:null,'fileName':_0x37ef58};else{if(_0x123cb4===_0x578ce8(0x162)){const _0x345509=!![],_0x855118=await processAudio(_0x27cb54,_0x5ab553);_0x345509?_0x2453da={'audio':fs_1[_0x578ce8(0x133)][_0x578ce8(0x132)](_0x855118),'mimetype':'audio/mp4','ptt':!![]}:_0x2453da={'audio':fs_1['default'][_0x578ce8(0x132)](_0x855118),'mimetype':_0x345509?'audio/mp4':_0xec84bf,'ptt':!![]};}else{if(_0x123cb4===_0x578ce8(0x15b))_0x2453da={'document':fs_1[_0x578ce8(0x133)][_0x578ce8(0x132)](_0x27cb54),'caption':_0x4969b5?_0x4969b5:null,'fileName':_0x37ef58,'mimetype':_0xec84bf};else _0x123cb4===_0x578ce8(0x137)?_0x2453da={'document':fs_1['default'][_0x578ce8(0x132)](_0x27cb54),'caption':_0x4969b5?_0x4969b5:null,'fileName':_0x37ef58,'mimetype':_0xec84bf}:_0x2453da={'image':fs_1[_0x578ce8(0x133)][_0x578ce8(0x132)](_0x27cb54),'caption':_0x4969b5?_0x4969b5:_0x37ef58};}}return _0x2453da;}catch(_0xa402c4){return Sentry[_0x578ce8(0x13d)](_0xa402c4),console[_0x578ce8(0x141)](_0xa402c4),null;}};exports[a544_0x446ae6(0x135)]=getMessageOptions;function a544_0xd800(){const _0x81a021=['application','__importDefault','../../models/Contact','__createBinding','../MessageServices/CreateMessageService','getWbot','captureException','@sentry/node','call','1036100YEZyIk','log','\x20-i\x20','/company','__esModule','2661184qhaRgL','create','6yDSdbc','originalname','writable','companyId','../../libs/wbot','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','unlinkSync','2224523FXWJAT','contactId','lookup','31473ijjWeo','exec','defineProperty','../../helpers/Mustache','208933XGxzYj','52pkLAxT','split','mimetype','.m4a','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','document','filename','ðŸ“‚\x20Documento','toString','text','__setModuleDefault','video','audio','audio/mp4','isGroup','configurable','.mp3','public','g.us','getTime','489626kVfHZD','substring','replace','ðŸ“Ž\x20Outros\x20anexos','ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio','getOwnPropertyDescriptor','child_process','remoteJid','whatsappId','12116385XuUMuW','path','@ffmpeg-installer/ffmpeg','readFileSync','default','10nchbuI','getMessageOptions','update'];a544_0xd800=function(){return _0x81a021;};return a544_0xd800();}const SendWhatsAppMedia=async({media:_0x452d4d,ticket:_0x12cf98,body:_0xff0b4f,isPrivate:_0x311ed8})=>{const _0x362255=a544_0x446ae6;try{const _0x356ff0=await(0x0,wbot_1[_0x362255(0x13c)])(_0x12cf98[_0x362255(0x12e)]),_0x455f2b=_0x12cf98[_0x362255(0x14a)][_0x362255(0x15e)](),_0x47d689=_0x452d4d[_0x362255(0x130)],_0x211ddc=_0x452d4d[_0x362255(0x158)]['split']('/')[0x0];let _0x56adec,_0x59826b='';if(_0x211ddc==='video')_0x56adec={'video':fs_1['default']['readFileSync'](_0x47d689),'caption':_0xff0b4f!==_0x452d4d[_0x362255(0x15c)]?_0xff0b4f:null,'fileName':_0x452d4d[_0x362255(0x148)][_0x362255(0x16c)]('/','-')},_0x59826b='ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo';else{if(_0x211ddc===_0x362255(0x162)){const _0x1d3325=!![];if(_0x1d3325){const _0x5c1b5a=await processAudio(_0x452d4d[_0x362255(0x130)],_0x455f2b);_0x56adec={'audio':fs_1[_0x362255(0x133)][_0x362255(0x132)](_0x5c1b5a),'mimetype':_0x1d3325?_0x362255(0x163):_0x452d4d['mimetype'],'ptt':!![]},(0x0,fs_1[_0x362255(0x14d)])(_0x5c1b5a);}else{const _0x5f0fe7=await processAudio(_0x452d4d['path'],_0x455f2b);_0x56adec={'audio':fs_1['default'][_0x362255(0x132)](_0x5f0fe7),'mimetype':_0x362255(0x163),'ptt':!![]},(0x0,fs_1[_0x362255(0x14d)])(_0x5f0fe7);}_0x59826b=_0x362255(0x12a);}else{if(_0x211ddc===_0x362255(0x15b)||_0x211ddc===_0x362255(0x15f))_0x56adec={'document':fs_1[_0x362255(0x133)][_0x362255(0x132)](_0x47d689),'caption':_0xff0b4f!==_0x452d4d[_0x362255(0x15c)]?_0xff0b4f:null,'fileName':_0x452d4d[_0x362255(0x148)]['replace']('/','-'),'mimetype':_0x452d4d[_0x362255(0x158)]},_0x59826b=_0x362255(0x15d);else _0x211ddc==='application'?(_0x56adec={'document':fs_1['default'][_0x362255(0x132)](_0x47d689),'caption':_0xff0b4f!==_0x452d4d[_0x362255(0x15c)]?_0xff0b4f:null,'fileName':_0x452d4d[_0x362255(0x148)][_0x362255(0x16c)]('/','-'),'mimetype':_0x452d4d[_0x362255(0x158)]},_0x59826b=_0x362255(0x16d)):(_0x56adec={'image':fs_1['default'][_0x362255(0x132)](_0x47d689),'caption':_0xff0b4f!==_0x452d4d[_0x362255(0x15c)]?_0xff0b4f:null},_0x59826b=_0x362255(0x16d));}}if(_0x311ed8){const _0x220233={'wid':'PVT'+_0x455f2b+_0x12cf98['id']+_0xff0b4f[_0x362255(0x16b)](0x0,0x6),'ticketId':_0x12cf98['id'],'contactId':undefined,'body':_0x59826b,'fromMe':!![],'mediaUrl':_0x452d4d[_0x362255(0x15c)],'mediaType':_0x452d4d['mimetype']['split']('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x311ed8};await(0x0,CreateMessageService_1['default'])({'messageData':_0x220233,'companyId':_0x12cf98[_0x362255(0x14a)]});return;}const _0x36ecde=await Contact_1['default']['findByPk'](_0x12cf98[_0x362255(0x14f)]);let _0x18539d;_0x36ecde[_0x362255(0x12d)]&&_0x36ecde['remoteJid']!==''&&_0x36ecde[_0x362255(0x12d)]['includes']('@')?_0x18539d=_0x36ecde['remoteJid']:_0x18539d=_0x36ecde['number']+'@'+(_0x12cf98[_0x362255(0x164)]?_0x362255(0x168):'s.whatsapp.net');console[_0x362255(0x141)](_0x56adec);const _0x3e83d5=await _0x356ff0['sendMessage'](_0x18539d,{..._0x56adec});return await _0x12cf98[_0x362255(0x136)]({'lastMessage':(0x0,Mustache_1[_0x362255(0x133)])(_0x59826b,_0x12cf98),'imported':null}),_0x3e83d5;}catch(_0x3866ea){Sentry[_0x362255(0x13d)](_0x3866ea),console[_0x362255(0x141)](_0x3866ea);throw new AppError_1['default']('ERR_SENDING_WAPP_MSG');}};exports[a544_0x446ae6(0x133)]=SendWhatsAppMedia;