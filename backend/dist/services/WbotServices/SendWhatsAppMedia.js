'use strict';function a508_0x2dd7(_0x29153d,_0x24ae48){const _0x197ad8=a508_0x197a();return a508_0x2dd7=function(_0x2dd789,_0x3613cd){_0x2dd789=_0x2dd789-0xbc;let _0x5d1e71=_0x197ad8[_0x2dd789];return _0x5d1e71;},a508_0x2dd7(_0x29153d,_0x24ae48);}const a508_0x2fee4e=a508_0x2dd7;(function(_0x17bdad,_0x206594){const _0x3ecf3a=a508_0x2dd7,_0xedc4dc=_0x17bdad();while(!![]){try{const _0x1181ef=-parseInt(_0x3ecf3a(0xc3))/0x1*(-parseInt(_0x3ecf3a(0xcb))/0x2)+-parseInt(_0x3ecf3a(0xe7))/0x3+-parseInt(_0x3ecf3a(0xbe))/0x4*(-parseInt(_0x3ecf3a(0xe3))/0x5)+-parseInt(_0x3ecf3a(0xd3))/0x6+parseInt(_0x3ecf3a(0xd5))/0x7*(-parseInt(_0x3ecf3a(0xe1))/0x8)+-parseInt(_0x3ecf3a(0xc7))/0x9*(-parseInt(_0x3ecf3a(0xef))/0xa)+parseInt(_0x3ecf3a(0xbd))/0xb*(-parseInt(_0x3ecf3a(0xdc))/0xc);if(_0x1181ef===_0x206594)break;else _0xedc4dc['push'](_0xedc4dc['shift']());}catch(_0xaa2c37){_0xedc4dc['push'](_0xedc4dc['shift']());}}}(a508_0x197a,0x68501));var __createBinding=this&&this[a508_0x2fee4e(0xd2)]||(Object['create']?function(_0x5bc350,_0x3ff55c,_0x35945e,_0x4d1d03){const _0x45064e=a508_0x2fee4e;if(_0x4d1d03===undefined)_0x4d1d03=_0x35945e;var _0x430e0f=Object[_0x45064e(0xc2)](_0x3ff55c,_0x35945e);(!_0x430e0f||('get'in _0x430e0f?!_0x3ff55c[_0x45064e(0xcc)]:_0x430e0f[_0x45064e(0xbc)]||_0x430e0f['configurable']))&&(_0x430e0f={'enumerable':!![],'get':function(){return _0x3ff55c[_0x35945e];}}),Object[_0x45064e(0xfb)](_0x5bc350,_0x4d1d03,_0x430e0f);}:function(_0x37e553,_0x2d357c,_0x5a52a7,_0x3dd6e8){if(_0x3dd6e8===undefined)_0x3dd6e8=_0x5a52a7;_0x37e553[_0x3dd6e8]=_0x2d357c[_0x5a52a7];}),__setModuleDefault=this&&this[a508_0x2fee4e(0xc1)]||(Object['create']?function(_0x41d2f0,_0x42335c){const _0x4349cb=a508_0x2fee4e;Object['defineProperty'](_0x41d2f0,_0x4349cb(0xd8),{'enumerable':!![],'value':_0x42335c});}:function(_0x5eb9af,_0x434b1e){const _0x2ded61=a508_0x2fee4e;_0x5eb9af[_0x2ded61(0xd8)]=_0x434b1e;}),__importStar=this&&this[a508_0x2fee4e(0xf0)]||function(_0x55a1d7){const _0xcdf5f5=a508_0x2fee4e;if(_0x55a1d7&&_0x55a1d7[_0xcdf5f5(0xcc)])return _0x55a1d7;var _0x40914d={};if(_0x55a1d7!=null){for(var _0x9aa4df in _0x55a1d7)if(_0x9aa4df!=='default'&&Object[_0xcdf5f5(0xda)]['hasOwnProperty'][_0xcdf5f5(0xf8)](_0x55a1d7,_0x9aa4df))__createBinding(_0x40914d,_0x55a1d7,_0x9aa4df);}return __setModuleDefault(_0x40914d,_0x55a1d7),_0x40914d;},__importDefault=this&&this[a508_0x2fee4e(0xd4)]||function(_0x234953){const _0x22799b=a508_0x2fee4e;return _0x234953&&_0x234953[_0x22799b(0xcc)]?_0x234953:{'default':_0x234953};};Object[a508_0x2fee4e(0xfb)](exports,a508_0x2fee4e(0xcc),{'value':!![]}),exports['getMessageOptions']=void 0x0;const Sentry=__importStar(require('@sentry/node')),fs_1=__importStar(require('fs')),child_process_1=require('child_process'),path_1=__importDefault(require(a508_0x2fee4e(0xf9))),ffmpeg_1=__importDefault(require(a508_0x2fee4e(0xdb))),AppError_1=__importDefault(require(a508_0x2fee4e(0xce))),mime_types_1=__importDefault(require('mime-types')),Contact_1=__importDefault(require(a508_0x2fee4e(0xf1))),wbot_1=require('../../libs/wbot'),CreateMessageService_1=__importDefault(require(a508_0x2fee4e(0xd9))),publicFolder=path_1[a508_0x2fee4e(0xd8)]['resolve'](__dirname,'..','..','..',a508_0x2fee4e(0xcf)),processAudio=async(_0x9f31e4,_0x47e94f)=>{const _0x5af775=a508_0x2fee4e,_0x16542d=publicFolder+'/company'+_0x47e94f+'/'+new Date()[_0x5af775(0xe0)]()+_0x5af775(0xf3);return new Promise((_0x508e28,_0x4b0ae8)=>{const _0x2a1cb0=_0x5af775;(0x0,child_process_1[_0x2a1cb0(0xf7)])(ffmpeg_1[_0x2a1cb0(0xd8)]['path']+_0x2a1cb0(0xe4)+_0x9f31e4+_0x2a1cb0(0xca)+_0x16542d+_0x2a1cb0(0xf5),(_0x4d98b4,_0x5c2f77,_0x541114)=>{if(_0x4d98b4)_0x4b0ae8(_0x4d98b4);_0x508e28(_0x16542d);});});},processAudioFile=async(_0x295654,_0x4b3b8f)=>{const _0x447d14=a508_0x2fee4e,_0x440902=publicFolder+_0x447d14(0xc9)+_0x4b3b8f+'/'+new Date()[_0x447d14(0xe0)]()+_0x447d14(0xcd);return new Promise((_0x1819e6,_0x23aa8a)=>{const _0x322db2=_0x447d14;(0x0,child_process_1[_0x322db2(0xf7)])(ffmpeg_1['default'][_0x322db2(0xf9)]+_0x322db2(0xe4)+_0x295654+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x440902,(_0x130d0d,_0x29db91,_0x390144)=>{if(_0x130d0d)_0x23aa8a(_0x130d0d);_0x1819e6(_0x440902);});});},getMessageOptions=async(_0x78365c,_0x479061,_0x11ab9a)=>{const _0x4f3f0c=a508_0x2fee4e,_0x24560e=mime_types_1[_0x4f3f0c(0xd8)][_0x4f3f0c(0xfc)](_0x479061),_0x2deadf=_0x24560e[_0x4f3f0c(0xd6)]('/')[0x0];try{if(!_0x24560e)throw new Error(_0x4f3f0c(0xc6));let _0x1cc44d;if(_0x2deadf===_0x4f3f0c(0xc4))_0x1cc44d={'video':fs_1[_0x4f3f0c(0xd8)]['readFileSync'](_0x479061),'fileName':_0x78365c};else{if(_0x2deadf===_0x4f3f0c(0xc0)){const _0x252ac2=!![],_0x5e858a=await processAudio(_0x479061,_0x11ab9a);_0x252ac2?_0x1cc44d={'audio':fs_1[_0x4f3f0c(0xd8)]['readFileSync'](_0x5e858a),'mimetype':'audio/mp4','ptt':!![]}:_0x1cc44d={'audio':fs_1[_0x4f3f0c(0xd8)][_0x4f3f0c(0xd0)](_0x5e858a),'mimetype':_0x252ac2?'audio/mp4':_0x24560e,'ptt':!![]};}else{if(_0x2deadf===_0x4f3f0c(0xe5))_0x1cc44d={'document':fs_1[_0x4f3f0c(0xd8)][_0x4f3f0c(0xd0)](_0x479061),'caption':_0x78365c,'fileName':_0x78365c,'mimetype':_0x24560e};else _0x2deadf===_0x4f3f0c(0xd7)?_0x1cc44d={'document':fs_1[_0x4f3f0c(0xd8)][_0x4f3f0c(0xd0)](_0x479061),'caption':_0x78365c,'fileName':_0x78365c,'mimetype':_0x24560e}:_0x1cc44d={'image':fs_1[_0x4f3f0c(0xd8)]['readFileSync'](_0x479061),'caption':_0x78365c};}}return _0x1cc44d;}catch(_0x1bc505){return Sentry[_0x4f3f0c(0xdf)](_0x1bc505),console['log'](_0x1bc505),null;}};exports[a508_0x2fee4e(0xde)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x14a1e3,ticket:_0x4da0f5,body:_0x5a9391,isPrivate:_0x5712ee})=>{const _0x1a300f=a508_0x2fee4e;try{const _0x3967e8=await(0x0,wbot_1[_0x1a300f(0xdd)])(_0x4da0f5[_0x1a300f(0xc5)]),_0x2f89a8=_0x4da0f5['companyId'][_0x1a300f(0xbf)](),_0x3d0261=_0x14a1e3[_0x1a300f(0xf9)],_0x1198da=_0x14a1e3[_0x1a300f(0xeb)][_0x1a300f(0xd6)]('/')[0x0];let _0x28945f;if(_0x1198da===_0x1a300f(0xc4))_0x28945f={'video':fs_1[_0x1a300f(0xd8)][_0x1a300f(0xd0)](_0x3d0261),'caption':_0x5a9391,'fileName':_0x14a1e3[_0x1a300f(0xec)][_0x1a300f(0xfd)]('/','-')};else{if(_0x1198da===_0x1a300f(0xc0)){const _0x1ceaf6=!![];if(_0x1ceaf6){const _0x451fde=await processAudio(_0x14a1e3[_0x1a300f(0xf9)],_0x2f89a8);_0x28945f={'audio':fs_1[_0x1a300f(0xd8)][_0x1a300f(0xd0)](_0x451fde),'mimetype':_0x1ceaf6?_0x1a300f(0xd1):_0x14a1e3[_0x1a300f(0xeb)],'ptt':!![]},(0x0,fs_1[_0x1a300f(0xe9)])(_0x451fde);}else{const _0x4b3278=await processAudio(_0x14a1e3['path'],_0x2f89a8);_0x28945f={'audio':fs_1[_0x1a300f(0xd8)]['readFileSync'](_0x4b3278),'mimetype':_0x1a300f(0xd1),'ptt':!![]},(0x0,fs_1['unlinkSync'])(_0x4b3278);}}else{if(_0x1198da==='document'||_0x1198da===_0x1a300f(0xfa))_0x28945f={'document':fs_1[_0x1a300f(0xd8)]['readFileSync'](_0x3d0261),'caption':_0x5a9391,'fileName':_0x14a1e3['originalname'][_0x1a300f(0xfd)]('/','-'),'mimetype':_0x14a1e3[_0x1a300f(0xeb)]};else _0x1198da===_0x1a300f(0xd7)?_0x28945f={'document':fs_1['default'][_0x1a300f(0xd0)](_0x3d0261),'caption':_0x5a9391,'fileName':_0x14a1e3[_0x1a300f(0xec)]['replace']('/','-'),'mimetype':_0x14a1e3['mimetype']}:_0x28945f={'image':fs_1[_0x1a300f(0xd8)]['readFileSync'](_0x3d0261),'caption':_0x5a9391};}}if(_0x5712ee){const _0x5552c3={'wid':_0x1a300f(0xe6)+_0x2f89a8+_0x4da0f5['id']+_0x5a9391['substring'](0x0,0x6),'ticketId':_0x4da0f5['id'],'contactId':undefined,'body':_0x5a9391,'fromMe':!![],'mediaUrl':_0x14a1e3[_0x1a300f(0xe2)],'mediaType':_0x14a1e3[_0x1a300f(0xeb)]['split']('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x5712ee};await(0x0,CreateMessageService_1[_0x1a300f(0xd8)])({'messageData':_0x5552c3,'companyId':_0x4da0f5[_0x1a300f(0xf4)]});return;}const _0x566be8=await Contact_1['default']['findByPk'](_0x4da0f5['contactId']);let _0x433b8c;_0x566be8['remoteJid']&&_0x566be8['remoteJid']!==''&&_0x566be8[_0x1a300f(0xe8)][_0x1a300f(0xc8)]('@')?_0x433b8c=_0x566be8[_0x1a300f(0xe8)]:_0x433b8c=_0x566be8['number']+'@'+(_0x4da0f5['isGroup']?_0x1a300f(0xf2):_0x1a300f(0xf6));const _0x17faff=await _0x3967e8[_0x1a300f(0xee)](_0x433b8c,{..._0x28945f});return _0x17faff;}catch(_0x475d81){Sentry[_0x1a300f(0xdf)](_0x475d81),console[_0x1a300f(0xea)](_0x475d81);throw new AppError_1[(_0x1a300f(0xd8))](_0x1a300f(0xed));}};function a508_0x197a(){const _0x1eecbf=['sendMessage','20epudha','__importStar','../../models/Contact','g.us','.m4a','companyId','\x20-y','s.whatsapp.net','exec','call','path','text','defineProperty','lookup','replace','writable','2530781ZYSYLc','470908SKioZs','toString','audio','__setModuleDefault','getOwnPropertyDescriptor','28201fxXfki','video','whatsappId','Invalid\x20mimetype','2825721xJQRCm','includes','/company','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','40kemknO','__esModule','.mp3','../../errors/AppError','public','readFileSync','audio/mp4','__createBinding','2662920oxacWm','__importDefault','3990ieKxNO','split','application','default','../MessageServices/CreateMessageService','prototype','@ffmpeg-installer/ffmpeg','12QKadnI','getWbot','getMessageOptions','captureException','getTime','2152INpVqL','filename','5ddcFkh','\x20-i\x20','document','PVT','165597zUOgjV','remoteJid','unlinkSync','log','mimetype','originalname','ERR_SENDING_WAPP_MSG'];a508_0x197a=function(){return _0x1eecbf;};return a508_0x197a();}exports['default']=SendWhatsAppMedia;