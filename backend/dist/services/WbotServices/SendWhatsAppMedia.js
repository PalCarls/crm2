'use strict';function a619_0xd921(_0x51e309,_0x2bc44d){const _0x33c8a7=a619_0x33c8();return a619_0xd921=function(_0xd9215c,_0x1d4876){_0xd9215c=_0xd9215c-0xfd;let _0x37caa8=_0x33c8a7[_0xd9215c];return _0x37caa8;},a619_0xd921(_0x51e309,_0x2bc44d);}const a619_0xe76003=a619_0xd921;(function(_0x2ebaca,_0x48da69){const _0xe7cf43=a619_0xd921,_0x26333c=_0x2ebaca();while(!![]){try{const _0x5d32eb=-parseInt(_0xe7cf43(0x13f))/0x1*(-parseInt(_0xe7cf43(0x10f))/0x2)+parseInt(_0xe7cf43(0x133))/0x3*(-parseInt(_0xe7cf43(0x129))/0x4)+parseInt(_0xe7cf43(0x122))/0x5+-parseInt(_0xe7cf43(0x112))/0x6*(parseInt(_0xe7cf43(0x103))/0x7)+parseInt(_0xe7cf43(0xfd))/0x8*(-parseInt(_0xe7cf43(0x102))/0x9)+parseInt(_0xe7cf43(0x134))/0xa+parseInt(_0xe7cf43(0x116))/0xb;if(_0x5d32eb===_0x48da69)break;else _0x26333c['push'](_0x26333c['shift']());}catch(_0x11bd89){_0x26333c['push'](_0x26333c['shift']());}}}(a619_0x33c8,0xd4c3d));var __createBinding=this&&this[a619_0xe76003(0x145)]||(Object[a619_0xe76003(0x142)]?function(_0x225683,_0x88d26d,_0x3334d3,_0x5c5794){const _0x3ea015=a619_0xe76003;if(_0x5c5794===undefined)_0x5c5794=_0x3334d3;var _0x25d7bb=Object[_0x3ea015(0x107)](_0x88d26d,_0x3334d3);(!_0x25d7bb||(_0x3ea015(0x139)in _0x25d7bb?!_0x88d26d[_0x3ea015(0x10d)]:_0x25d7bb[_0x3ea015(0x10b)]||_0x25d7bb['configurable']))&&(_0x25d7bb={'enumerable':!![],'get':function(){return _0x88d26d[_0x3334d3];}}),Object[_0x3ea015(0x118)](_0x225683,_0x5c5794,_0x25d7bb);}:function(_0x479270,_0xcbb69c,_0x44a0c5,_0x2dfe01){if(_0x2dfe01===undefined)_0x2dfe01=_0x44a0c5;_0x479270[_0x2dfe01]=_0xcbb69c[_0x44a0c5];}),__setModuleDefault=this&&this[a619_0xe76003(0x115)]||(Object[a619_0xe76003(0x142)]?function(_0x1b39fc,_0x5b8707){const _0xb780e7=a619_0xe76003;Object[_0xb780e7(0x118)](_0x1b39fc,_0xb780e7(0x11c),{'enumerable':!![],'value':_0x5b8707});}:function(_0x579a49,_0x22b407){const _0xec1559=a619_0xe76003;_0x579a49[_0xec1559(0x11c)]=_0x22b407;}),__importStar=this&&this[a619_0xe76003(0x138)]||function(_0x3c5d6d){const _0x2dd331=a619_0xe76003;if(_0x3c5d6d&&_0x3c5d6d[_0x2dd331(0x10d)])return _0x3c5d6d;var _0x3ace22={};if(_0x3c5d6d!=null){for(var _0x3c6700 in _0x3c5d6d)if(_0x3c6700!==_0x2dd331(0x11c)&&Object['prototype'][_0x2dd331(0x104)]['call'](_0x3c5d6d,_0x3c6700))__createBinding(_0x3ace22,_0x3c5d6d,_0x3c6700);}return __setModuleDefault(_0x3ace22,_0x3c5d6d),_0x3ace22;},__importDefault=this&&this[a619_0xe76003(0x101)]||function(_0x36ad5c){const _0x577c93=a619_0xe76003;return _0x36ad5c&&_0x36ad5c[_0x577c93(0x10d)]?_0x36ad5c:{'default':_0x36ad5c};};Object[a619_0xe76003(0x118)](exports,a619_0xe76003(0x10d),{'value':!![]}),exports['getMessageOptions']=void 0x0;const Sentry=__importStar(require(a619_0xe76003(0x119))),fs_1=__importStar(require('fs')),child_process_1=require(a619_0xe76003(0x144)),path_1=__importDefault(require('path')),ffmpeg_1=__importDefault(require('@ffmpeg-installer/ffmpeg')),AppError_1=__importDefault(require(a619_0xe76003(0x110))),mime_types_1=__importDefault(require(a619_0xe76003(0x10e))),Contact_1=__importDefault(require(a619_0xe76003(0xff))),wbot_1=require(a619_0xe76003(0x136)),CreateMessageService_1=__importDefault(require(a619_0xe76003(0x106))),Mustache_1=__importDefault(require(a619_0xe76003(0x105))),publicFolder=path_1[a619_0xe76003(0x11c)]['resolve'](__dirname,'..','..','..',a619_0xe76003(0x121)),processAudio=async(_0x2551ae,_0x43d2a4)=>{const _0x461e76=a619_0xe76003,_0x46ef8d=publicFolder+'/company'+_0x43d2a4+'/'+new Date()[_0x461e76(0x13a)]()+_0x461e76(0x141);return new Promise((_0x499d88,_0x13244c)=>{const _0x52d344=_0x461e76;(0x0,child_process_1[_0x52d344(0x117)])(ffmpeg_1[_0x52d344(0x11c)][_0x52d344(0x12a)]+_0x52d344(0x131)+_0x2551ae+_0x52d344(0x125)+_0x46ef8d+_0x52d344(0x127),(_0x551ea1,_0x347c39,_0x536eb0)=>{if(_0x551ea1)_0x13244c(_0x551ea1);_0x499d88(_0x46ef8d);});});},processAudioFile=async(_0x40b912,_0x502ade)=>{const _0x2d3743=a619_0xe76003,_0x5781e4=publicFolder+_0x2d3743(0x137)+_0x502ade+'/'+new Date()['getTime']()+_0x2d3743(0x141);return new Promise((_0x48b490,_0x5446c8)=>{const _0x2d0e06=_0x2d3743;(0x0,child_process_1['exec'])(ffmpeg_1[_0x2d0e06(0x11c)][_0x2d0e06(0x12a)]+_0x2d0e06(0x131)+_0x40b912+_0x2d0e06(0x11d)+_0x5781e4,(_0x5a5312,_0x5acf09,_0x285e33)=>{if(_0x5a5312)_0x5446c8(_0x5a5312);_0x48b490(_0x5781e4);});});},getMessageOptions=async(_0x40c6b7,_0x4c1ab0,_0x50748a,_0x19900b)=>{const _0xddb6db=a619_0xe76003,_0xe66530=mime_types_1['default'][_0xddb6db(0x10c)](_0x4c1ab0),_0x53ad18=_0xe66530[_0xddb6db(0x13c)]('/')[0x0];try{if(!_0xe66530)throw new Error(_0xddb6db(0x11f));let _0x36c259;if(_0x53ad18===_0xddb6db(0x120))_0x36c259={'video':fs_1['default'][_0xddb6db(0x130)](_0x4c1ab0),'caption':_0x19900b?_0x19900b:null,'fileName':_0x40c6b7};else{if(_0x53ad18==='audio'){const _0x5bffc4=!![],_0x502c0d=await processAudio(_0x4c1ab0,_0x50748a);_0x5bffc4?_0x36c259={'audio':fs_1[_0xddb6db(0x11c)][_0xddb6db(0x130)](_0x502c0d),'mimetype':_0xddb6db(0x132),'ptt':!![]}:_0x36c259={'audio':fs_1['default'][_0xddb6db(0x130)](_0x502c0d),'mimetype':_0x5bffc4?_0xddb6db(0x132):_0xe66530,'ptt':!![]};}else{if(_0x53ad18==='document')_0x36c259={'document':fs_1['default'][_0xddb6db(0x130)](_0x4c1ab0),'caption':_0x19900b?_0x19900b:null,'fileName':_0x40c6b7,'mimetype':_0xe66530};else _0x53ad18===_0xddb6db(0x11b)?_0x36c259={'document':fs_1['default'][_0xddb6db(0x130)](_0x4c1ab0),'caption':_0x19900b?_0x19900b:null,'fileName':_0x40c6b7,'mimetype':_0xe66530}:_0x36c259={'image':fs_1[_0xddb6db(0x11c)][_0xddb6db(0x130)](_0x4c1ab0),'caption':_0x19900b?_0x19900b:_0x40c6b7};}}return _0x36c259;}catch(_0x8abc28){return Sentry['captureException'](_0x8abc28),console[_0xddb6db(0x11a)](_0x8abc28),null;}};exports[a619_0xe76003(0x114)]=getMessageOptions;function a619_0x33c8(){const _0x17e2fa=['3690880kgNovh','replace','ðŸ“Ž\x20Outros\x20anexos','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','g.us','\x20-y','s.whatsapp.net','4OhnpTI','path','whatsappId','sendMessage','toString','unlinkSync','PVT','readFileSync','\x20-i\x20','audio/mp4','4907046NwfhRa','1373050Kpmemb','ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio','../../libs/wbot','/company','__importStar','get','getTime','originalname','split','remoteJid','companyId','1dvRDEn','findByPk','.mp3','create','update','child_process','__createBinding','ðŸ“‚\x20Documento','1086296MgMNYc','document','../../models/Contact','number','__importDefault','81ilkVzq','13531wQjupV','hasOwnProperty','../../helpers/Mustache','../MessageServices/CreateMessageService','getOwnPropertyDescriptor','mimetype','isGroup','captureException','writable','lookup','__esModule','mime-types','2004034TQYDDG','../../errors/AppError','text','3798CTmubn','contactId','getMessageOptions','__setModuleDefault','33828751tqMaNr','exec','defineProperty','@sentry/node','log','application','default','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','audio','Invalid\x20mimetype','video','public'];a619_0x33c8=function(){return _0x17e2fa;};return a619_0x33c8();}const SendWhatsAppMedia=async({media:_0x28f12d,ticket:_0x3736e4,body:_0xac3c7c,isPrivate:_0x24e937,isForwarded:isForwarded=![]})=>{const _0x40771a=a619_0xe76003;try{const _0x21e440=await(0x0,wbot_1['getWbot'])(_0x3736e4[_0x40771a(0x12b)]),_0x8a0de1=_0x3736e4[_0x40771a(0x13e)][_0x40771a(0x12d)](),_0x440574=_0x28f12d[_0x40771a(0x12a)],_0x440dde=_0x28f12d[_0x40771a(0x108)][_0x40771a(0x13c)]('/')[0x0];let _0x15ed7d,_0x308b26='';const _0x25b522=_0x3736e4?(0x0,Mustache_1[_0x40771a(0x11c)])(_0xac3c7c,_0x3736e4):_0xac3c7c;if(_0x440dde===_0x40771a(0x120))_0x15ed7d={'video':fs_1[_0x40771a(0x11c)][_0x40771a(0x130)](_0x440574),'caption':_0x25b522,'fileName':_0x28f12d[_0x40771a(0x13b)][_0x40771a(0x123)]('/','-'),'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x308b26='ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo';else{if(_0x440dde===_0x40771a(0x11e)){const _0x495d38=!![];if(_0x495d38){const _0x569879=await processAudio(_0x28f12d['path'],_0x8a0de1);_0x15ed7d={'audio':fs_1[_0x40771a(0x11c)][_0x40771a(0x130)](_0x569879),'mimetype':_0x495d38?_0x40771a(0x132):_0x28f12d[_0x40771a(0x108)],'ptt':!![],'caption':_0x25b522,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x40771a(0x12e)])(_0x569879);}else{const _0x242d98=await processAudio(_0x28f12d[_0x40771a(0x12a)],_0x8a0de1);_0x15ed7d={'audio':fs_1[_0x40771a(0x11c)][_0x40771a(0x130)](_0x242d98),'mimetype':_0x40771a(0x132),'ptt':!![],'caption':_0x25b522,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x40771a(0x12e)])(_0x242d98);}_0x308b26=_0x40771a(0x135);}else{if(_0x440dde===_0x40771a(0xfe)||_0x440dde===_0x40771a(0x111))_0x15ed7d={'document':fs_1[_0x40771a(0x11c)]['readFileSync'](_0x440574),'caption':_0x25b522,'fileName':_0x28f12d[_0x40771a(0x13b)]['replace']('/','-'),'mimetype':_0x28f12d['mimetype'],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x308b26=_0x40771a(0x146);else _0x440dde==='application'?(_0x15ed7d={'document':fs_1[_0x40771a(0x11c)][_0x40771a(0x130)](_0x440574),'caption':_0x25b522,'fileName':_0x28f12d[_0x40771a(0x13b)][_0x40771a(0x123)]('/','-'),'mimetype':_0x28f12d[_0x40771a(0x108)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x308b26=_0x40771a(0x124)):(_0x15ed7d={'image':fs_1['default'][_0x40771a(0x130)](_0x440574),'caption':_0x25b522,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x308b26=_0x40771a(0x124));}}if(_0x24e937){const _0x3998ba={'wid':_0x40771a(0x12f)+_0x8a0de1+_0x3736e4['id']+_0xac3c7c['substring'](0x0,0x6),'ticketId':_0x3736e4['id'],'contactId':undefined,'body':_0x25b522,'fromMe':!![],'mediaUrl':_0x28f12d['filename'],'mediaType':_0x28f12d[_0x40771a(0x108)]['split']('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x24e937};await(0x0,CreateMessageService_1[_0x40771a(0x11c)])({'messageData':_0x3998ba,'companyId':_0x3736e4[_0x40771a(0x13e)]});return;}const _0x4c9d5b=await Contact_1[_0x40771a(0x11c)][_0x40771a(0x140)](_0x3736e4[_0x40771a(0x113)]);let _0x7f319e;_0x4c9d5b['remoteJid']&&_0x4c9d5b[_0x40771a(0x13d)]!==''&&_0x4c9d5b[_0x40771a(0x13d)]['includes']('@')?_0x7f319e=_0x4c9d5b[_0x40771a(0x13d)]:_0x7f319e=_0x4c9d5b[_0x40771a(0x100)]+'@'+(_0x3736e4[_0x40771a(0x109)]?_0x40771a(0x126):_0x40771a(0x128));const _0x2a4398=await _0x21e440[_0x40771a(0x12c)](_0x7f319e,{..._0x15ed7d});return await _0x3736e4[_0x40771a(0x143)]({'lastMessage':_0xac3c7c!==_0x28f12d['filename']?_0xac3c7c:_0x25b522,'imported':null}),_0x2a4398;}catch(_0x5eb169){Sentry[_0x40771a(0x10a)](_0x5eb169),console['log'](_0x5eb169);throw new AppError_1['default']('ERR_SENDING_WAPP_MSG');}};exports[a619_0xe76003(0x11c)]=SendWhatsAppMedia;