'use strict';const a619_0x301f8d=a619_0xf7e7;(function(_0x26f5f0,_0xf2a7ea){const _0x17a324=a619_0xf7e7,_0x37ae1c=_0x26f5f0();while(!![]){try{const _0x434406=-parseInt(_0x17a324(0x18b))/0x1*(parseInt(_0x17a324(0x19d))/0x2)+parseInt(_0x17a324(0x183))/0x3*(parseInt(_0x17a324(0x1a1))/0x4)+parseInt(_0x17a324(0x1af))/0x5*(parseInt(_0x17a324(0x1c1))/0x6)+-parseInt(_0x17a324(0x19b))/0x7+parseInt(_0x17a324(0x19c))/0x8*(parseInt(_0x17a324(0x1b7))/0x9)+-parseInt(_0x17a324(0x1ae))/0xa+-parseInt(_0x17a324(0x192))/0xb;if(_0x434406===_0xf2a7ea)break;else _0x37ae1c['push'](_0x37ae1c['shift']());}catch(_0x4ad4ed){_0x37ae1c['push'](_0x37ae1c['shift']());}}}(a619_0x1a3f,0xf33f8));var __createBinding=this&&this[a619_0x301f8d(0x1b8)]||(Object['create']?function(_0x559265,_0x3bd844,_0xb02393,_0x2dde5a){const _0x5d2cf9=a619_0x301f8d;if(_0x2dde5a===undefined)_0x2dde5a=_0xb02393;var _0x43941b=Object[_0x5d2cf9(0x1be)](_0x3bd844,_0xb02393);(!_0x43941b||(_0x5d2cf9(0x1ab)in _0x43941b?!_0x3bd844[_0x5d2cf9(0x17c)]:_0x43941b[_0x5d2cf9(0x181)]||_0x43941b['configurable']))&&(_0x43941b={'enumerable':!![],'get':function(){return _0x3bd844[_0xb02393];}}),Object[_0x5d2cf9(0x1b5)](_0x559265,_0x2dde5a,_0x43941b);}:function(_0x348d6c,_0xa1615f,_0x5d4419,_0x56c729){if(_0x56c729===undefined)_0x56c729=_0x5d4419;_0x348d6c[_0x56c729]=_0xa1615f[_0x5d4419];}),__setModuleDefault=this&&this[a619_0x301f8d(0x180)]||(Object['create']?function(_0x4a6995,_0x48c6bd){const _0x252b3e=a619_0x301f8d;Object[_0x252b3e(0x1b5)](_0x4a6995,_0x252b3e(0x193),{'enumerable':!![],'value':_0x48c6bd});}:function(_0x446d33,_0x324264){const _0x32495b=a619_0x301f8d;_0x446d33[_0x32495b(0x193)]=_0x324264;}),__importStar=this&&this[a619_0x301f8d(0x1b4)]||function(_0xde59c9){const _0x5dce31=a619_0x301f8d;if(_0xde59c9&&_0xde59c9[_0x5dce31(0x17c)])return _0xde59c9;var _0x5e2c14={};if(_0xde59c9!=null){for(var _0x4f42db in _0xde59c9)if(_0x4f42db!==_0x5dce31(0x193)&&Object[_0x5dce31(0x1b1)]['hasOwnProperty'][_0x5dce31(0x1a6)](_0xde59c9,_0x4f42db))__createBinding(_0x5e2c14,_0xde59c9,_0x4f42db);}return __setModuleDefault(_0x5e2c14,_0xde59c9),_0x5e2c14;},__importDefault=this&&this[a619_0x301f8d(0x1c2)]||function(_0x15980d){return _0x15980d&&_0x15980d['__esModule']?_0x15980d:{'default':_0x15980d};};function a619_0xf7e7(_0x1bb83b,_0x4bff9f){const _0x1a3f1d=a619_0x1a3f();return a619_0xf7e7=function(_0xf7e7b5,_0x5cda70){_0xf7e7b5=_0xf7e7b5-0x17c;let _0x1c12a8=_0x1a3f1d[_0xf7e7b5];return _0x1c12a8;},a619_0xf7e7(_0x1bb83b,_0x4bff9f);}Object[a619_0x301f8d(0x1b5)](exports,a619_0x301f8d(0x17c),{'value':!![]}),exports[a619_0x301f8d(0x18e)]=void 0x0;const Sentry=__importStar(require(a619_0x301f8d(0x190))),fs_1=__importStar(require('fs')),child_process_1=require('child_process'),path_1=__importDefault(require(a619_0x301f8d(0x1b2))),ffmpeg_1=__importDefault(require(a619_0x301f8d(0x182))),AppError_1=__importDefault(require(a619_0x301f8d(0x1a3))),mime_types_1=__importDefault(require(a619_0x301f8d(0x19a))),Contact_1=__importDefault(require('../../models/Contact')),wbot_1=require('../../libs/wbot'),CreateMessageService_1=__importDefault(require(a619_0x301f8d(0x19e))),Mustache_1=__importDefault(require(a619_0x301f8d(0x1bf))),publicFolder=path_1[a619_0x301f8d(0x193)][a619_0x301f8d(0x1aa)](__dirname,'..','..','..',a619_0x301f8d(0x1ac)),processAudio=async(_0x20246d,_0x5d3d46)=>{const _0x63da86=a619_0x301f8d,_0x49070d=publicFolder+_0x63da86(0x1bd)+_0x5d3d46+'/'+new Date()[_0x63da86(0x1a7)]()+'.mp3';return new Promise((_0x525471,_0x205780)=>{const _0x283ce7=_0x63da86;(0x0,child_process_1[_0x283ce7(0x18f)])(ffmpeg_1['default'][_0x283ce7(0x1b2)]+_0x283ce7(0x187)+_0x20246d+_0x283ce7(0x194)+_0x49070d+_0x283ce7(0x1a4),(_0x17dc0c,_0x150bdc,_0x51cb62)=>{if(_0x17dc0c)_0x205780(_0x17dc0c);_0x525471(_0x49070d);});});},processAudioFile=async(_0x49ae8a,_0x37a6f0)=>{const _0x7756d1=a619_0x301f8d,_0x364969=publicFolder+_0x7756d1(0x1bd)+_0x37a6f0+'/'+new Date()[_0x7756d1(0x1a7)]()+'.mp3';return new Promise((_0x2801cc,_0x28ae48)=>{const _0x53c301=_0x7756d1;(0x0,child_process_1[_0x53c301(0x18f)])(ffmpeg_1[_0x53c301(0x193)]['path']+_0x53c301(0x187)+_0x49ae8a+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x364969,(_0x478990,_0x533a5b,_0x3c33bf)=>{if(_0x478990)_0x28ae48(_0x478990);_0x2801cc(_0x364969);});});},getMessageOptions=async(_0x1a8d54,_0x2f227c,_0xb9dc5b,_0x45cfa7)=>{const _0x24835a=a619_0x301f8d,_0x937e40=mime_types_1[_0x24835a(0x193)][_0x24835a(0x1a8)](_0x2f227c),_0x43552a=_0x937e40['split']('/')[0x0];try{if(!_0x937e40)throw new Error(_0x24835a(0x18c));let _0x4b3c9c;if(_0x43552a==='video')_0x4b3c9c={'video':fs_1[_0x24835a(0x193)][_0x24835a(0x18d)](_0x2f227c),'caption':_0x45cfa7?_0x45cfa7:null,'fileName':_0x1a8d54};else{if(_0x43552a===_0x24835a(0x1a5)){const _0x17660d=!![],_0xeab553=await processAudio(_0x2f227c,_0xb9dc5b);_0x17660d?_0x4b3c9c={'audio':fs_1[_0x24835a(0x193)][_0x24835a(0x18d)](_0xeab553),'mimetype':_0x24835a(0x197),'ptt':!![]}:_0x4b3c9c={'audio':fs_1[_0x24835a(0x193)]['readFileSync'](_0xeab553),'mimetype':_0x17660d?_0x24835a(0x197):_0x937e40,'ptt':!![]};}else{if(_0x43552a===_0x24835a(0x195))_0x4b3c9c={'document':fs_1[_0x24835a(0x193)][_0x24835a(0x18d)](_0x2f227c),'caption':_0x45cfa7?_0x45cfa7:null,'fileName':_0x1a8d54,'mimetype':_0x937e40};else _0x43552a===_0x24835a(0x1b3)?_0x4b3c9c={'document':fs_1[_0x24835a(0x193)][_0x24835a(0x18d)](_0x2f227c),'caption':_0x45cfa7?_0x45cfa7:null,'fileName':_0x1a8d54,'mimetype':_0x937e40}:_0x4b3c9c={'image':fs_1[_0x24835a(0x193)][_0x24835a(0x18d)](_0x2f227c),'caption':_0x45cfa7?_0x45cfa7:_0x1a8d54};}}return _0x4b3c9c;}catch(_0x2e40ce){return Sentry[_0x24835a(0x19f)](_0x2e40ce),console[_0x24835a(0x196)](_0x2e40ce),null;}};exports[a619_0x301f8d(0x18e)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x5a5fc3,ticket:_0x1f9684,body:_0x19cbcf,isPrivate:_0x452878,isForwarded:isForwarded=![]})=>{const _0x14c27a=a619_0x301f8d;try{const _0xa835e2=await(0x0,wbot_1[_0x14c27a(0x199)])(_0x1f9684[_0x14c27a(0x1c0)]),_0x2e97ae=_0x1f9684['companyId']['toString'](),_0x5d33f2=_0x5a5fc3['path'],_0x2f0bd8=_0x5a5fc3[_0x14c27a(0x1bb)][_0x14c27a(0x185)]('/')[0x0];let _0x2e94a4,_0x133cfd='';const _0x4f31e2=_0x1f9684?(0x0,Mustache_1['default'])(_0x19cbcf,_0x1f9684):_0x19cbcf;if(_0x2f0bd8===_0x14c27a(0x198))_0x2e94a4={'video':fs_1[_0x14c27a(0x193)][_0x14c27a(0x18d)](_0x5d33f2),'caption':_0x4f31e2,'fileName':_0x5a5fc3[_0x14c27a(0x17f)]['replace']('/','-'),'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x133cfd=_0x14c27a(0x17d);else{if(_0x2f0bd8===_0x14c27a(0x1a5)){const _0x31ccc3=!![];if(_0x31ccc3){const _0x57da26=await processAudio(_0x5a5fc3[_0x14c27a(0x1b2)],_0x2e97ae);_0x2e94a4={'audio':fs_1['default']['readFileSync'](_0x57da26),'mimetype':_0x31ccc3?_0x14c27a(0x197):_0x5a5fc3[_0x14c27a(0x1bb)],'ptt':!![],'caption':_0x4f31e2,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1['unlinkSync'])(_0x57da26);}else{const _0x527990=await processAudio(_0x5a5fc3[_0x14c27a(0x1b2)],_0x2e97ae);_0x2e94a4={'audio':fs_1[_0x14c27a(0x193)][_0x14c27a(0x18d)](_0x527990),'mimetype':_0x14c27a(0x197),'ptt':!![],'caption':_0x4f31e2,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1['unlinkSync'])(_0x527990);}_0x133cfd='ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio';}else{if(_0x2f0bd8==='document'||_0x2f0bd8===_0x14c27a(0x191))_0x2e94a4={'document':fs_1[_0x14c27a(0x193)][_0x14c27a(0x18d)](_0x5d33f2),'caption':_0x4f31e2,'fileName':_0x5a5fc3[_0x14c27a(0x17f)][_0x14c27a(0x1a2)]('/','-'),'mimetype':_0x5a5fc3[_0x14c27a(0x1bb)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x133cfd=_0x14c27a(0x1a9);else _0x2f0bd8===_0x14c27a(0x1b3)?(_0x2e94a4={'document':fs_1[_0x14c27a(0x193)][_0x14c27a(0x18d)](_0x5d33f2),'caption':_0x4f31e2,'fileName':_0x5a5fc3[_0x14c27a(0x17f)]['replace']('/','-'),'mimetype':_0x5a5fc3[_0x14c27a(0x1bb)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x133cfd=_0x14c27a(0x17e)):(_0x2e94a4={'image':fs_1[_0x14c27a(0x193)][_0x14c27a(0x18d)](_0x5d33f2),'caption':_0x4f31e2,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x133cfd=_0x14c27a(0x17e));}}if(_0x452878){const _0x42ed80={'wid':_0x14c27a(0x186)+_0x2e97ae+_0x1f9684['id']+_0x19cbcf['substring'](0x0,0x6),'ticketId':_0x1f9684['id'],'contactId':undefined,'body':_0x4f31e2,'fromMe':!![],'mediaUrl':_0x5a5fc3['filename'],'mediaType':_0x5a5fc3[_0x14c27a(0x1bb)][_0x14c27a(0x185)]('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x452878};await(0x0,CreateMessageService_1[_0x14c27a(0x193)])({'messageData':_0x42ed80,'companyId':_0x1f9684[_0x14c27a(0x1b9)]});return;}const _0x50799c=await Contact_1[_0x14c27a(0x193)][_0x14c27a(0x1ba)](_0x1f9684['contactId']);let _0x2c230f;_0x50799c['remoteJid']&&_0x50799c[_0x14c27a(0x184)]!==''&&_0x50799c['remoteJid'][_0x14c27a(0x189)]('@')?_0x2c230f=_0x50799c[_0x14c27a(0x184)]:_0x2c230f=_0x50799c[_0x14c27a(0x1a0)]+'@'+(_0x1f9684[_0x14c27a(0x1b6)]?_0x14c27a(0x1bc):'s.whatsapp.net');const _0x176dcd=await _0xa835e2[_0x14c27a(0x188)](_0x2c230f,{..._0x2e94a4});return await _0x1f9684[_0x14c27a(0x18a)]({'lastMessage':_0x19cbcf!==_0x5a5fc3[_0x14c27a(0x1b0)]?_0x19cbcf:_0x4f31e2,'imported':null}),_0x176dcd;}catch(_0x5ea281){Sentry[_0x14c27a(0x19f)](_0x5ea281),console['log'](_0x5ea281);throw new AppError_1['default'](_0x14c27a(0x1ad));}};exports[a619_0x301f8d(0x193)]=SendWhatsAppMedia;function a619_0x1a3f(){const _0x5b9497=['prototype','path','application','__importStar','defineProperty','isGroup','16305507CJGrjk','__createBinding','companyId','findByPk','mimetype','g.us','/company','getOwnPropertyDescriptor','../../helpers/Mustache','whatsappId','2733096eigwTh','__importDefault','__esModule','ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo','ðŸ“Ž\x20Outros\x20anexos','originalname','__setModuleDefault','writable','@ffmpeg-installer/ffmpeg','33ScVZWe','remoteJid','split','PVT','\x20-i\x20','sendMessage','includes','update','305oilOwm','Invalid\x20mimetype','readFileSync','getMessageOptions','exec','@sentry/node','text','1629408zakydg','default','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','document','log','audio/mp4','video','getWbot','mime-types','10490207jhKGLT','8drxXdA','4594cQlQcI','../MessageServices/CreateMessageService','captureException','number','366568ubjWbo','replace','../../errors/AppError','\x20-y','audio','call','getTime','lookup','ðŸ“‚\x20Documento','resolve','get','public','ERR_SENDING_WAPP_MSG','8426750TyYAHq','15tgReuv','filename'];a619_0x1a3f=function(){return _0x5b9497;};return a619_0x1a3f();}