'use strict';const a561_0x27a716=a561_0x46fa;(function(_0x258fb1,_0x640e27){const _0x4a4313=a561_0x46fa,_0x44e53c=_0x258fb1();while(!![]){try{const _0x3c4c1d=-parseInt(_0x4a4313(0x1db))/0x1+-parseInt(_0x4a4313(0x1f6))/0x2*(-parseInt(_0x4a4313(0x1e7))/0x3)+-parseInt(_0x4a4313(0x1ef))/0x4+-parseInt(_0x4a4313(0x1f8))/0x5+parseInt(_0x4a4313(0x1cc))/0x6*(-parseInt(_0x4a4313(0x1e9))/0x7)+-parseInt(_0x4a4313(0x1ce))/0x8*(-parseInt(_0x4a4313(0x1fc))/0x9)+parseInt(_0x4a4313(0x20d))/0xa*(parseInt(_0x4a4313(0x214))/0xb);if(_0x3c4c1d===_0x640e27)break;else _0x44e53c['push'](_0x44e53c['shift']());}catch(_0x478cd4){_0x44e53c['push'](_0x44e53c['shift']());}}}(a561_0x1fea,0x82720));var __createBinding=this&&this[a561_0x27a716(0x207)]||(Object['create']?function(_0x44f4fb,_0x29679b,_0x49c4e9,_0x10d2e2){const _0x2ac9ca=a561_0x27a716;if(_0x10d2e2===undefined)_0x10d2e2=_0x49c4e9;var _0x2ad7af=Object['getOwnPropertyDescriptor'](_0x29679b,_0x49c4e9);(!_0x2ad7af||(_0x2ac9ca(0x213)in _0x2ad7af?!_0x29679b[_0x2ac9ca(0x1e4)]:_0x2ad7af[_0x2ac9ca(0x1cd)]||_0x2ad7af[_0x2ac9ca(0x1d6)]))&&(_0x2ad7af={'enumerable':!![],'get':function(){return _0x29679b[_0x49c4e9];}}),Object['defineProperty'](_0x44f4fb,_0x10d2e2,_0x2ad7af);}:function(_0x180fa8,_0x54e501,_0x30c75c,_0x30c257){if(_0x30c257===undefined)_0x30c257=_0x30c75c;_0x180fa8[_0x30c257]=_0x54e501[_0x30c75c];}),__setModuleDefault=this&&this[a561_0x27a716(0x200)]||(Object[a561_0x27a716(0x205)]?function(_0x2770ea,_0x4f94ef){const _0xb32604=a561_0x27a716;Object[_0xb32604(0x20f)](_0x2770ea,_0xb32604(0x1d4),{'enumerable':!![],'value':_0x4f94ef});}:function(_0x4962aa,_0x2b9516){const _0x35c07e=a561_0x27a716;_0x4962aa[_0x35c07e(0x1d4)]=_0x2b9516;}),__importStar=this&&this[a561_0x27a716(0x1f5)]||function(_0x1e56db){const _0x2ab088=a561_0x27a716;if(_0x1e56db&&_0x1e56db[_0x2ab088(0x1e4)])return _0x1e56db;var _0x1b6f69={};if(_0x1e56db!=null){for(var _0x8248d6 in _0x1e56db)if(_0x8248d6!==_0x2ab088(0x1d4)&&Object[_0x2ab088(0x20c)][_0x2ab088(0x209)]['call'](_0x1e56db,_0x8248d6))__createBinding(_0x1b6f69,_0x1e56db,_0x8248d6);}return __setModuleDefault(_0x1b6f69,_0x1e56db),_0x1b6f69;},__importDefault=this&&this[a561_0x27a716(0x1d0)]||function(_0x2b1536){return _0x2b1536&&_0x2b1536['__esModule']?_0x2b1536:{'default':_0x2b1536};};Object[a561_0x27a716(0x20f)](exports,a561_0x27a716(0x1e4),{'value':!![]}),exports[a561_0x27a716(0x1f3)]=void 0x0;function a561_0x1fea(){const _0x5378f2=['315sAWIEZ','remoteJid','document','audio','__setModuleDefault','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','g.us','getTime','ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio','create','video','__createBinding','replace','hasOwnProperty','path','../../helpers/Mustache','prototype','10DEjhUZ','originalname','defineProperty','isGroup','unlinkSync','readFileSync','get','18687295nXVwsT','47028PjdHRy','writable','126328EFnzGX','/company','__importDefault','captureException','.mp3','public','default','companyId','configurable','../../libs/wbot','resolve','child_process','log','1000265fOTJwt','sendMessage','ðŸ“‚\x20Documento','whatsappId','number','PVT','findByPk','mimetype','update','__esModule','audio/mp4','application','36JMgnet','ðŸ“Ž\x20Outros\x20anexos','483VPJWMm','split','\x20-y','filename','../MessageServices/CreateMessageService','\x20-i\x20','316672QaLGzy','exec','.m4a','../../errors/AppError','getMessageOptions','ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo','__importStar','66638DuALEp','@ffmpeg-installer/ffmpeg','2483995uAboGY','text','includes','lookup'];a561_0x1fea=function(){return _0x5378f2;};return a561_0x1fea();}const Sentry=__importStar(require('@sentry/node')),fs_1=__importStar(require('fs')),child_process_1=require(a561_0x27a716(0x1d9)),path_1=__importDefault(require(a561_0x27a716(0x20a))),ffmpeg_1=__importDefault(require(a561_0x27a716(0x1f7))),AppError_1=__importDefault(require(a561_0x27a716(0x1f2))),mime_types_1=__importDefault(require('mime-types')),Contact_1=__importDefault(require('../../models/Contact')),wbot_1=require(a561_0x27a716(0x1d7)),CreateMessageService_1=__importDefault(require(a561_0x27a716(0x1ed))),Mustache_1=__importDefault(require(a561_0x27a716(0x20b))),publicFolder=path_1[a561_0x27a716(0x1d4)][a561_0x27a716(0x1d8)](__dirname,'..','..','..',a561_0x27a716(0x1d3)),processAudio=async(_0x3b9883,_0x392881)=>{const _0x392e35=a561_0x27a716,_0x1d0955=publicFolder+_0x392e35(0x1cf)+_0x392881+'/'+new Date()[_0x392e35(0x203)]()+_0x392e35(0x1f1);return new Promise((_0x57da85,_0x409ef2)=>{const _0x2b343f=_0x392e35;(0x0,child_process_1[_0x2b343f(0x1f0)])(ffmpeg_1[_0x2b343f(0x1d4)][_0x2b343f(0x20a)]+_0x2b343f(0x1ee)+_0x3b9883+_0x2b343f(0x201)+_0x1d0955+_0x2b343f(0x1eb),(_0x1866f3,_0x19e785,_0x571595)=>{if(_0x1866f3)_0x409ef2(_0x1866f3);_0x57da85(_0x1d0955);});});},processAudioFile=async(_0x12abae,_0x2e454d)=>{const _0x1a7f5f=a561_0x27a716,_0x279bd2=publicFolder+_0x1a7f5f(0x1cf)+_0x2e454d+'/'+new Date()[_0x1a7f5f(0x203)]()+_0x1a7f5f(0x1d2);return new Promise((_0x4e9ead,_0x1ef89c)=>{const _0x1b496f=_0x1a7f5f;(0x0,child_process_1[_0x1b496f(0x1f0)])(ffmpeg_1['default'][_0x1b496f(0x20a)]+_0x1b496f(0x1ee)+_0x12abae+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x279bd2,(_0x31bbf3,_0x1d3e03,_0x44c713)=>{if(_0x31bbf3)_0x1ef89c(_0x31bbf3);_0x4e9ead(_0x279bd2);});});},getMessageOptions=async(_0x585324,_0x868ac2,_0x4e0db7,_0xf595cd)=>{const _0x4616c6=a561_0x27a716,_0x401073=mime_types_1[_0x4616c6(0x1d4)][_0x4616c6(0x1fb)](_0x868ac2),_0x1e9061=_0x401073[_0x4616c6(0x1ea)]('/')[0x0];try{if(!_0x401073)throw new Error('Invalid\x20mimetype');let _0x2c1df3;if(_0x1e9061===_0x4616c6(0x206))_0x2c1df3={'video':fs_1[_0x4616c6(0x1d4)][_0x4616c6(0x212)](_0x868ac2),'caption':_0xf595cd?_0xf595cd:null,'fileName':_0x585324};else{if(_0x1e9061===_0x4616c6(0x1ff)){const _0x300825=!![],_0x27870e=await processAudio(_0x868ac2,_0x4e0db7);_0x300825?_0x2c1df3={'audio':fs_1[_0x4616c6(0x1d4)][_0x4616c6(0x212)](_0x27870e),'mimetype':_0x4616c6(0x1e5),'ptt':!![]}:_0x2c1df3={'audio':fs_1[_0x4616c6(0x1d4)]['readFileSync'](_0x27870e),'mimetype':_0x300825?_0x4616c6(0x1e5):_0x401073,'ptt':!![]};}else{if(_0x1e9061===_0x4616c6(0x1fe))_0x2c1df3={'document':fs_1[_0x4616c6(0x1d4)][_0x4616c6(0x212)](_0x868ac2),'caption':_0xf595cd?_0xf595cd:null,'fileName':_0x585324,'mimetype':_0x401073};else _0x1e9061===_0x4616c6(0x1e6)?_0x2c1df3={'document':fs_1[_0x4616c6(0x1d4)]['readFileSync'](_0x868ac2),'caption':_0xf595cd?_0xf595cd:null,'fileName':_0x585324,'mimetype':_0x401073}:_0x2c1df3={'image':fs_1[_0x4616c6(0x1d4)][_0x4616c6(0x212)](_0x868ac2),'caption':_0xf595cd?_0xf595cd:_0x585324};}}return _0x2c1df3;}catch(_0x48baee){return Sentry['captureException'](_0x48baee),console[_0x4616c6(0x1da)](_0x48baee),null;}};function a561_0x46fa(_0x210345,_0x24d6b5){const _0x1feaa6=a561_0x1fea();return a561_0x46fa=function(_0x46fa43,_0x17770c){_0x46fa43=_0x46fa43-0x1cc;let _0x53b548=_0x1feaa6[_0x46fa43];return _0x53b548;},a561_0x46fa(_0x210345,_0x24d6b5);}exports[a561_0x27a716(0x1f3)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x2cb01b,ticket:_0x5c405d,body:_0x49678d,isPrivate:_0x1e444d,isForwarded:isForwarded=![]})=>{const _0x5bd969=a561_0x27a716;try{const _0x25e360=await(0x0,wbot_1['getWbot'])(_0x5c405d[_0x5bd969(0x1de)]),_0x28d119=_0x5c405d[_0x5bd969(0x1d5)]['toString'](),_0x277fab=_0x2cb01b['path'],_0x346a9a=_0x2cb01b[_0x5bd969(0x1e2)][_0x5bd969(0x1ea)]('/')[0x0];let _0x1c4c0c,_0x5939e3='';const _0x50bb8d=(0x0,Mustache_1[_0x5bd969(0x1d4)])(_0x49678d,_0x5c405d);if(_0x346a9a===_0x5bd969(0x206))_0x1c4c0c={'video':fs_1[_0x5bd969(0x1d4)][_0x5bd969(0x212)](_0x277fab),'caption':_0x50bb8d,'fileName':_0x2cb01b[_0x5bd969(0x20e)][_0x5bd969(0x208)]('/','-'),'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x5939e3=_0x5bd969(0x1f4);else{if(_0x346a9a===_0x5bd969(0x1ff)){const _0x4fd547=!![];if(_0x4fd547){const _0x4e644e=await processAudio(_0x2cb01b['path'],_0x28d119);_0x1c4c0c={'audio':fs_1[_0x5bd969(0x1d4)]['readFileSync'](_0x4e644e),'mimetype':_0x4fd547?_0x5bd969(0x1e5):_0x2cb01b[_0x5bd969(0x1e2)],'ptt':!![],'caption':_0x50bb8d,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x5bd969(0x211)])(_0x4e644e);}else{const _0x5e263a=await processAudio(_0x2cb01b[_0x5bd969(0x20a)],_0x28d119);_0x1c4c0c={'audio':fs_1[_0x5bd969(0x1d4)][_0x5bd969(0x212)](_0x5e263a),'mimetype':'audio/mp4','ptt':!![],'caption':_0x50bb8d,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x5bd969(0x211)])(_0x5e263a);}_0x5939e3=_0x5bd969(0x204);}else{if(_0x346a9a===_0x5bd969(0x1fe)||_0x346a9a===_0x5bd969(0x1f9))_0x1c4c0c={'document':fs_1[_0x5bd969(0x1d4)][_0x5bd969(0x212)](_0x277fab),'caption':_0x50bb8d,'fileName':_0x2cb01b['originalname'][_0x5bd969(0x208)]('/','-'),'mimetype':_0x2cb01b[_0x5bd969(0x1e2)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x5939e3=_0x5bd969(0x1dd);else _0x346a9a===_0x5bd969(0x1e6)?(_0x1c4c0c={'document':fs_1['default']['readFileSync'](_0x277fab),'caption':_0x50bb8d,'fileName':_0x2cb01b[_0x5bd969(0x20e)][_0x5bd969(0x208)]('/','-'),'mimetype':_0x2cb01b[_0x5bd969(0x1e2)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x5939e3=_0x5bd969(0x1e8)):(_0x1c4c0c={'image':fs_1[_0x5bd969(0x1d4)]['readFileSync'](_0x277fab),'caption':_0x50bb8d,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x5939e3='ðŸ“Ž\x20Outros\x20anexos');}}if(_0x1e444d){const _0x9c77cd={'wid':_0x5bd969(0x1e0)+_0x28d119+_0x5c405d['id']+_0x49678d['substring'](0x0,0x6),'ticketId':_0x5c405d['id'],'contactId':undefined,'body':_0x5939e3,'fromMe':!![],'mediaUrl':_0x2cb01b['filename'],'mediaType':_0x2cb01b['mimetype'][_0x5bd969(0x1ea)]('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x1e444d};await(0x0,CreateMessageService_1[_0x5bd969(0x1d4)])({'messageData':_0x9c77cd,'companyId':_0x5c405d[_0x5bd969(0x1d5)]});return;}const _0x817bc9=await Contact_1['default'][_0x5bd969(0x1e1)](_0x5c405d['contactId']);let _0x420e1a;_0x817bc9[_0x5bd969(0x1fd)]&&_0x817bc9[_0x5bd969(0x1fd)]!==''&&_0x817bc9[_0x5bd969(0x1fd)][_0x5bd969(0x1fa)]('@')?_0x420e1a=_0x817bc9[_0x5bd969(0x1fd)]:_0x420e1a=_0x817bc9[_0x5bd969(0x1df)]+'@'+(_0x5c405d[_0x5bd969(0x210)]?_0x5bd969(0x202):'s.whatsapp.net');const _0x137dba=await _0x25e360[_0x5bd969(0x1dc)](_0x420e1a,{..._0x1c4c0c});return await _0x5c405d[_0x5bd969(0x1e3)]({'lastMessage':(0x0,Mustache_1[_0x5bd969(0x1d4)])(_0x49678d!==_0x2cb01b[_0x5bd969(0x1ec)]?(0x0,Mustache_1[_0x5bd969(0x1d4)])(_0x49678d,_0x5c405d):_0x5939e3,_0x5c405d),'imported':null}),_0x137dba;}catch(_0x230f8d){Sentry[_0x5bd969(0x1d1)](_0x230f8d),console[_0x5bd969(0x1da)](_0x230f8d);throw new AppError_1[(_0x5bd969(0x1d4))]('ERR_SENDING_WAPP_MSG');}};exports[a561_0x27a716(0x1d4)]=SendWhatsAppMedia;