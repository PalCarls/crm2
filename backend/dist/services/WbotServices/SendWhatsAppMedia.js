'use strict';const a566_0x101912=a566_0x2579;(function(_0x33f5e0,_0x8c71f2){const _0x208564=a566_0x2579,_0x38d181=_0x33f5e0();while(!![]){try{const _0x412fd7=-parseInt(_0x208564(0x1c9))/0x1+parseInt(_0x208564(0x1ec))/0x2*(parseInt(_0x208564(0x1c3))/0x3)+-parseInt(_0x208564(0x1e5))/0x4+parseInt(_0x208564(0x1f8))/0x5+parseInt(_0x208564(0x1dc))/0x6*(-parseInt(_0x208564(0x1bc))/0x7)+parseInt(_0x208564(0x1ed))/0x8+parseInt(_0x208564(0x1b5))/0x9;if(_0x412fd7===_0x8c71f2)break;else _0x38d181['push'](_0x38d181['shift']());}catch(_0x55a59b){_0x38d181['push'](_0x38d181['shift']());}}}(a566_0x48b2,0xb2159));var __createBinding=this&&this[a566_0x101912(0x1de)]||(Object[a566_0x101912(0x1c6)]?function(_0x2613ac,_0x48e29a,_0xae9623,_0x7851eb){const _0x5451e6=a566_0x101912;if(_0x7851eb===undefined)_0x7851eb=_0xae9623;var _0x2e4e25=Object['getOwnPropertyDescriptor'](_0x48e29a,_0xae9623);(!_0x2e4e25||(_0x5451e6(0x1f1)in _0x2e4e25?!_0x48e29a['__esModule']:_0x2e4e25['writable']||_0x2e4e25[_0x5451e6(0x1c7)]))&&(_0x2e4e25={'enumerable':!![],'get':function(){return _0x48e29a[_0xae9623];}}),Object['defineProperty'](_0x2613ac,_0x7851eb,_0x2e4e25);}:function(_0x1e17ae,_0x1b43ad,_0x31c852,_0x1a6825){if(_0x1a6825===undefined)_0x1a6825=_0x31c852;_0x1e17ae[_0x1a6825]=_0x1b43ad[_0x31c852];}),__setModuleDefault=this&&this[a566_0x101912(0x1f4)]||(Object[a566_0x101912(0x1c6)]?function(_0x233ad2,_0x51c663){const _0xf881c7=a566_0x101912;Object[_0xf881c7(0x1be)](_0x233ad2,'default',{'enumerable':!![],'value':_0x51c663});}:function(_0x4fdf70,_0x5804e4){const _0x3e6e27=a566_0x101912;_0x4fdf70[_0x3e6e27(0x1da)]=_0x5804e4;}),__importStar=this&&this[a566_0x101912(0x1bd)]||function(_0x31341e){const _0x56b95d=a566_0x101912;if(_0x31341e&&_0x31341e[_0x56b95d(0x1d5)])return _0x31341e;var _0x2ecf08={};if(_0x31341e!=null){for(var _0x170c30 in _0x31341e)if(_0x170c30!=='default'&&Object[_0x56b95d(0x1f7)][_0x56b95d(0x1d1)][_0x56b95d(0x1e3)](_0x31341e,_0x170c30))__createBinding(_0x2ecf08,_0x31341e,_0x170c30);}return __setModuleDefault(_0x2ecf08,_0x31341e),_0x2ecf08;},__importDefault=this&&this[a566_0x101912(0x1db)]||function(_0x5b7632){const _0xed8b6c=a566_0x101912;return _0x5b7632&&_0x5b7632[_0xed8b6c(0x1d5)]?_0x5b7632:{'default':_0x5b7632};};Object[a566_0x101912(0x1be)](exports,a566_0x101912(0x1d5),{'value':!![]}),exports[a566_0x101912(0x1ef)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),fs_1=__importStar(require('fs')),child_process_1=require(a566_0x101912(0x1e8)),path_1=__importDefault(require(a566_0x101912(0x1bf))),ffmpeg_1=__importDefault(require(a566_0x101912(0x1c0))),AppError_1=__importDefault(require(a566_0x101912(0x1b8))),mime_types_1=__importDefault(require(a566_0x101912(0x1b4))),Contact_1=__importDefault(require(a566_0x101912(0x1d4))),wbot_1=require(a566_0x101912(0x1f6)),CreateMessageService_1=__importDefault(require(a566_0x101912(0x1ca))),Mustache_1=__importDefault(require(a566_0x101912(0x1dd))),publicFolder=path_1[a566_0x101912(0x1da)][a566_0x101912(0x1f5)](__dirname,'..','..','..',a566_0x101912(0x1c8)),processAudio=async(_0x2939da,_0x1cdbb7)=>{const _0x2bed1e=a566_0x101912,_0x32d4d2=publicFolder+'/company'+_0x1cdbb7+'/'+new Date()['getTime']()+_0x2bed1e(0x1cf);return new Promise((_0x9bc15d,_0x3780a0)=>{const _0x5ca6eb=_0x2bed1e;(0x0,child_process_1['exec'])(ffmpeg_1['default'][_0x5ca6eb(0x1bf)]+'\x20-i\x20'+_0x2939da+_0x5ca6eb(0x1c5)+_0x32d4d2+_0x5ca6eb(0x1f2),(_0x31c0e1,_0x38b4f0,_0x9c8133)=>{if(_0x31c0e1)_0x3780a0(_0x31c0e1);_0x9bc15d(_0x32d4d2);});});},processAudioFile=async(_0x335a37,_0x52dec6)=>{const _0x4acf7f=a566_0x101912,_0x4919b2=publicFolder+_0x4acf7f(0x1e9)+_0x52dec6+'/'+new Date()[_0x4acf7f(0x1e6)]()+'.mp3';return new Promise((_0x17741e,_0xdf9091)=>{const _0x12e72d=_0x4acf7f;(0x0,child_process_1[_0x12e72d(0x1cb)])(ffmpeg_1['default']['path']+_0x12e72d(0x1e1)+_0x335a37+_0x12e72d(0x1eb)+_0x4919b2,(_0x4dfcef,_0x256737,_0x491955)=>{if(_0x4dfcef)_0xdf9091(_0x4dfcef);_0x17741e(_0x4919b2);});});},getMessageOptions=async(_0x375db7,_0x45c0ec,_0x31e8db,_0x193670)=>{const _0x334848=a566_0x101912,_0xd4fc40=mime_types_1[_0x334848(0x1da)]['lookup'](_0x45c0ec),_0xe563b8=_0xd4fc40['split']('/')[0x0];try{if(!_0xd4fc40)throw new Error(_0x334848(0x1f3));let _0x14b1f1;if(_0xe563b8===_0x334848(0x1df))_0x14b1f1={'video':fs_1[_0x334848(0x1da)][_0x334848(0x1cd)](_0x45c0ec),'caption':_0x193670?_0x193670:null,'fileName':_0x375db7};else{if(_0xe563b8==='audio'){const _0x2aa47d=!![],_0x29a251=await processAudio(_0x45c0ec,_0x31e8db);_0x2aa47d?_0x14b1f1={'audio':fs_1['default']['readFileSync'](_0x29a251),'mimetype':_0x334848(0x1ee),'ptt':!![]}:_0x14b1f1={'audio':fs_1[_0x334848(0x1da)][_0x334848(0x1cd)](_0x29a251),'mimetype':_0x2aa47d?'audio/mp4':_0xd4fc40,'ptt':!![]};}else{if(_0xe563b8===_0x334848(0x1c1))_0x14b1f1={'document':fs_1[_0x334848(0x1da)]['readFileSync'](_0x45c0ec),'caption':_0x193670?_0x193670:null,'fileName':_0x375db7,'mimetype':_0xd4fc40};else _0xe563b8==='application'?_0x14b1f1={'document':fs_1['default'][_0x334848(0x1cd)](_0x45c0ec),'caption':_0x193670?_0x193670:null,'fileName':_0x375db7,'mimetype':_0xd4fc40}:_0x14b1f1={'image':fs_1[_0x334848(0x1da)]['readFileSync'](_0x45c0ec),'caption':_0x193670?_0x193670:_0x375db7};}}return _0x14b1f1;}catch(_0x2e58b8){return Sentry[_0x334848(0x1d7)](_0x2e58b8),console['log'](_0x2e58b8),null;}};function a566_0x2579(_0x4a0e21,_0x5b42f5){const _0x48b29e=a566_0x48b2();return a566_0x2579=function(_0x2579ac,_0x55af98){_0x2579ac=_0x2579ac-0x1b4;let _0x3c138b=_0x48b29e[_0x2579ac];return _0x3c138b;},a566_0x2579(_0x4a0e21,_0x5b42f5);}exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x5f027c,ticket:_0x5823db,body:_0x194bb3,isPrivate:_0x14b416,isForwarded:isForwarded=![]})=>{const _0x462602=a566_0x101912;try{const _0x388828=await(0x0,wbot_1['getWbot'])(_0x5823db[_0x462602(0x1f9)]),_0x180e99=_0x5823db[_0x462602(0x1fb)][_0x462602(0x1d9)](),_0x394cf4=_0x5f027c['path'],_0x2633d4=_0x5f027c[_0x462602(0x1b9)][_0x462602(0x1e4)]('/')[0x0];let _0x264e56,_0x22e13d='';const _0x55832c=(0x0,Mustache_1[_0x462602(0x1da)])(_0x194bb3,_0x5823db);if(_0x2633d4==='video')_0x264e56={'video':fs_1['default'][_0x462602(0x1cd)](_0x394cf4),'caption':_0x55832c,'fileName':_0x5f027c['originalname'][_0x462602(0x1b6)]('/','-'),'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x22e13d=_0x462602(0x1b7);else{if(_0x2633d4===_0x462602(0x1d8)){const _0x1a1ee4=!![];if(_0x1a1ee4){const _0x38cd1a=await processAudio(_0x5f027c['path'],_0x180e99);_0x264e56={'audio':fs_1[_0x462602(0x1da)][_0x462602(0x1cd)](_0x38cd1a),'mimetype':_0x1a1ee4?'audio/mp4':_0x5f027c[_0x462602(0x1b9)],'ptt':!![],'caption':_0x55832c,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x462602(0x1ba)])(_0x38cd1a);}else{const _0x16d421=await processAudio(_0x5f027c[_0x462602(0x1bf)],_0x180e99);_0x264e56={'audio':fs_1['default'][_0x462602(0x1cd)](_0x16d421),'mimetype':'audio/mp4','ptt':!![],'caption':_0x55832c,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x462602(0x1ba)])(_0x16d421);}_0x22e13d='ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio';}else{if(_0x2633d4==='document'||_0x2633d4==='text')_0x264e56={'document':fs_1[_0x462602(0x1da)]['readFileSync'](_0x394cf4),'caption':_0x55832c,'fileName':_0x5f027c['originalname'][_0x462602(0x1b6)]('/','-'),'mimetype':_0x5f027c['mimetype'],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x22e13d=_0x462602(0x1cc);else _0x2633d4==='application'?(_0x264e56={'document':fs_1[_0x462602(0x1da)][_0x462602(0x1cd)](_0x394cf4),'caption':_0x55832c,'fileName':_0x5f027c[_0x462602(0x1fa)][_0x462602(0x1b6)]('/','-'),'mimetype':_0x5f027c[_0x462602(0x1b9)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x22e13d='ðŸ“Ž\x20Outros\x20anexos'):(_0x264e56={'image':fs_1[_0x462602(0x1da)][_0x462602(0x1cd)](_0x394cf4),'caption':_0x55832c,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x22e13d=_0x462602(0x1e7));}}if(_0x14b416){const _0x3dad9e={'wid':_0x462602(0x1f0)+_0x180e99+_0x5823db['id']+_0x194bb3[_0x462602(0x1c2)](0x0,0x6),'ticketId':_0x5823db['id'],'contactId':undefined,'body':_0x55832c,'fromMe':!![],'mediaUrl':_0x5f027c[_0x462602(0x1d6)],'mediaType':_0x5f027c[_0x462602(0x1b9)][_0x462602(0x1e4)]('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x14b416};await(0x0,CreateMessageService_1[_0x462602(0x1da)])({'messageData':_0x3dad9e,'companyId':_0x5823db[_0x462602(0x1fb)]});return;}const _0x2e4b3d=await Contact_1['default'][_0x462602(0x1ce)](_0x5823db[_0x462602(0x1e2)]);let _0x11cae0;_0x2e4b3d['remoteJid']&&_0x2e4b3d[_0x462602(0x1bb)]!==''&&_0x2e4b3d[_0x462602(0x1bb)][_0x462602(0x1d0)]('@')?_0x11cae0=_0x2e4b3d['remoteJid']:_0x11cae0=_0x2e4b3d['number']+'@'+(_0x5823db[_0x462602(0x1e0)]?'g.us':_0x462602(0x1c4));const _0xb58bea=await _0x388828[_0x462602(0x1d3)](_0x11cae0,{..._0x264e56});return await _0x5823db['update']({'lastMessage':(0x0,Mustache_1[_0x462602(0x1da)])(_0x194bb3!==_0x5f027c[_0x462602(0x1d6)]?(0x0,Mustache_1[_0x462602(0x1da)])(_0x194bb3,_0x5823db):_0x55832c,_0x5823db),'imported':null}),_0xb58bea;}catch(_0x2be9d4){Sentry[_0x462602(0x1d7)](_0x2be9d4),console[_0x462602(0x1ea)](_0x2be9d4);throw new AppError_1[(_0x462602(0x1da))](_0x462602(0x1d2));}};exports[a566_0x101912(0x1da)]=SendWhatsAppMedia;function a566_0x48b2(){const _0x5ebbd5=['__esModule','filename','captureException','audio','toString','default','__importDefault','78ZvTOri','../../helpers/Mustache','__createBinding','video','isGroup','\x20-i\x20','contactId','call','split','2995656zujeCq','getTime','ðŸ“Ž\x20Outros\x20anexos','child_process','/company','log','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','2HvEWwy','5459704CEaOtm','audio/mp4','getMessageOptions','PVT','get','\x20-y','Invalid\x20mimetype','__setModuleDefault','resolve','../../libs/wbot','prototype','5073940dHprfX','whatsappId','originalname','companyId','mime-types','4855401wPUycd','replace','ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo','../../errors/AppError','mimetype','unlinkSync','remoteJid','74046anKNJw','__importStar','defineProperty','path','@ffmpeg-installer/ffmpeg','document','substring','185511ARTeav','s.whatsapp.net','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','create','configurable','public','682716iXMcDp','../MessageServices/CreateMessageService','exec','ðŸ“‚\x20Documento','readFileSync','findByPk','.m4a','includes','hasOwnProperty','ERR_SENDING_WAPP_MSG','sendMessage','../../models/Contact'];a566_0x48b2=function(){return _0x5ebbd5;};return a566_0x48b2();}