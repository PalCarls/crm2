'use strict';const a627_0x90c674=a627_0x5270;function a627_0x5270(_0x5c5d92,_0x53f14d){const _0x49af3f=a627_0x49af();return a627_0x5270=function(_0x5270b7,_0x9d899a){_0x5270b7=_0x5270b7-0x146;let _0x227897=_0x49af3f[_0x5270b7];return _0x227897;},a627_0x5270(_0x5c5d92,_0x53f14d);}(function(_0x355b18,_0x4a736f){const _0x48aec4=a627_0x5270,_0x4296e2=_0x355b18();while(!![]){try{const _0x45b54e=-parseInt(_0x48aec4(0x167))/0x1*(-parseInt(_0x48aec4(0x18c))/0x2)+parseInt(_0x48aec4(0x152))/0x3+parseInt(_0x48aec4(0x159))/0x4+-parseInt(_0x48aec4(0x153))/0x5*(-parseInt(_0x48aec4(0x158))/0x6)+parseInt(_0x48aec4(0x17a))/0x7*(parseInt(_0x48aec4(0x18f))/0x8)+-parseInt(_0x48aec4(0x183))/0x9+-parseInt(_0x48aec4(0x176))/0xa;if(_0x45b54e===_0x4a736f)break;else _0x4296e2['push'](_0x4296e2['shift']());}catch(_0x54b8dd){_0x4296e2['push'](_0x4296e2['shift']());}}}(a627_0x49af,0x36185));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x43dcf3,_0x17d537,_0x44fe3b,_0x10c1ba){const _0x4e89b7=a627_0x5270;if(_0x10c1ba===undefined)_0x10c1ba=_0x44fe3b;var _0x3ca48d=Object[_0x4e89b7(0x15d)](_0x17d537,_0x44fe3b);(!_0x3ca48d||(_0x4e89b7(0x156)in _0x3ca48d?!_0x17d537[_0x4e89b7(0x17b)]:_0x3ca48d[_0x4e89b7(0x18a)]||_0x3ca48d[_0x4e89b7(0x14c)]))&&(_0x3ca48d={'enumerable':!![],'get':function(){return _0x17d537[_0x44fe3b];}}),Object[_0x4e89b7(0x14e)](_0x43dcf3,_0x10c1ba,_0x3ca48d);}:function(_0xf600e6,_0x4e2bf9,_0x22bf1e,_0x389ebf){if(_0x389ebf===undefined)_0x389ebf=_0x22bf1e;_0xf600e6[_0x389ebf]=_0x4e2bf9[_0x22bf1e];}),__setModuleDefault=this&&this[a627_0x90c674(0x188)]||(Object[a627_0x90c674(0x149)]?function(_0x495315,_0x199d48){const _0x19992c=a627_0x90c674;Object['defineProperty'](_0x495315,_0x19992c(0x186),{'enumerable':!![],'value':_0x199d48});}:function(_0x2a460b,_0x39c966){const _0x57cbe4=a627_0x90c674;_0x2a460b[_0x57cbe4(0x186)]=_0x39c966;}),__importStar=this&&this[a627_0x90c674(0x157)]||function(_0x180602){const _0x40001d=a627_0x90c674;if(_0x180602&&_0x180602['__esModule'])return _0x180602;var _0xdd535c={};if(_0x180602!=null){for(var _0xcd9616 in _0x180602)if(_0xcd9616!==_0x40001d(0x186)&&Object['prototype'][_0x40001d(0x17c)][_0x40001d(0x15e)](_0x180602,_0xcd9616))__createBinding(_0xdd535c,_0x180602,_0xcd9616);}return __setModuleDefault(_0xdd535c,_0x180602),_0xdd535c;},__importDefault=this&&this[a627_0x90c674(0x18e)]||function(_0x4c8ef6){const _0x5e1bb5=a627_0x90c674;return _0x4c8ef6&&_0x4c8ef6[_0x5e1bb5(0x17b)]?_0x4c8ef6:{'default':_0x4c8ef6};};Object[a627_0x90c674(0x14e)](exports,a627_0x90c674(0x17b),{'value':!![]}),exports[a627_0x90c674(0x14d)]=void 0x0;function a627_0x49af(){const _0x4040a7=['../../models/Contact','create','../../helpers/Mustache','.mp3','configurable','getMessageOptions','defineProperty','ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo','../MessageServices/CreateMessageService','../../libs/wbot','1234890cuSydP','415ZlWryX','PVT','path','get','__importStar','3954RFtdWp','979884omiZEG','findByPk','remoteJid','application','getOwnPropertyDescriptor','call','contactId','g.us','ðŸ“Ž\x20Outros\x20anexos','document','toString','mime-types','lookup','captureException','1LqefTO','Invalid\x20mimetype','text','update','audio','substring','readFileSync','../../errors/AppError','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','replace','exec','\x20-y','s.whatsapp.net','companyId','/company','8597220rZXqrv','getTime','number','log','14847PIXUqv','__esModule','hasOwnProperty','audio/mp4','sendMessage','unlinkSync','public','@ffmpeg-installer/ffmpeg','mimetype','2068398ZEyfVE','resolve','child_process','default','filename','__setModuleDefault','split','writable','\x20-i\x20','847552UNDkgd','originalname','__importDefault','664vNRjmH','getWbot','@sentry/node','video'];a627_0x49af=function(){return _0x4040a7;};return a627_0x49af();}const Sentry=__importStar(require(a627_0x90c674(0x146))),fs_1=__importStar(require('fs')),child_process_1=require(a627_0x90c674(0x185)),path_1=__importDefault(require(a627_0x90c674(0x155))),ffmpeg_1=__importDefault(require(a627_0x90c674(0x181))),AppError_1=__importDefault(require(a627_0x90c674(0x16e))),mime_types_1=__importDefault(require(a627_0x90c674(0x164))),Contact_1=__importDefault(require(a627_0x90c674(0x148))),wbot_1=require(a627_0x90c674(0x151)),CreateMessageService_1=__importDefault(require(a627_0x90c674(0x150))),Mustache_1=__importDefault(require(a627_0x90c674(0x14a))),publicFolder=path_1['default'][a627_0x90c674(0x184)](__dirname,'..','..','..',a627_0x90c674(0x180)),processAudio=async(_0x27fa75,_0x402acf)=>{const _0x59b5f4=a627_0x90c674,_0x12f1b6=publicFolder+_0x59b5f4(0x175)+_0x402acf+'/'+new Date()[_0x59b5f4(0x177)]()+_0x59b5f4(0x14b);return new Promise((_0x5d19d4,_0x208102)=>{const _0x26f286=_0x59b5f4;(0x0,child_process_1[_0x26f286(0x171)])(ffmpeg_1[_0x26f286(0x186)]['path']+_0x26f286(0x18b)+_0x27fa75+_0x26f286(0x16f)+_0x12f1b6+_0x26f286(0x172),(_0x21d585,_0x13efbe,_0x271206)=>{if(_0x21d585)_0x208102(_0x21d585);_0x5d19d4(_0x12f1b6);});});},processAudioFile=async(_0x4fdff6,_0x308458)=>{const _0x2a7eb1=a627_0x90c674,_0x18b86c=publicFolder+_0x2a7eb1(0x175)+_0x308458+'/'+new Date()[_0x2a7eb1(0x177)]()+_0x2a7eb1(0x14b);return new Promise((_0x2d49bc,_0x49fdac)=>{const _0x13bbe7=_0x2a7eb1;(0x0,child_process_1['exec'])(ffmpeg_1[_0x13bbe7(0x186)][_0x13bbe7(0x155)]+'\x20-i\x20'+_0x4fdff6+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x18b86c,(_0x8048b8,_0x4db552,_0x13b5c8)=>{if(_0x8048b8)_0x49fdac(_0x8048b8);_0x2d49bc(_0x18b86c);});});},getMessageOptions=async(_0x2b9fc6,_0x2b3649,_0x1e630b,_0x309567)=>{const _0x7d67dc=a627_0x90c674,_0x49201d=mime_types_1[_0x7d67dc(0x186)][_0x7d67dc(0x165)](_0x2b3649),_0x3b5fee=_0x49201d[_0x7d67dc(0x189)]('/')[0x0];try{if(!_0x49201d)throw new Error(_0x7d67dc(0x168));let _0xc9dd60;if(_0x3b5fee===_0x7d67dc(0x147))_0xc9dd60={'video':fs_1[_0x7d67dc(0x186)][_0x7d67dc(0x16d)](_0x2b3649),'caption':_0x309567?_0x309567:null,'fileName':_0x2b9fc6};else{if(_0x3b5fee===_0x7d67dc(0x16b)){const _0x6edf5d=!![],_0x2c20d4=await processAudio(_0x2b3649,_0x1e630b);_0x6edf5d?_0xc9dd60={'audio':fs_1['default']['readFileSync'](_0x2c20d4),'mimetype':_0x7d67dc(0x17d),'ptt':!![]}:_0xc9dd60={'audio':fs_1['default'][_0x7d67dc(0x16d)](_0x2c20d4),'mimetype':_0x6edf5d?_0x7d67dc(0x17d):_0x49201d,'ptt':!![]};}else{if(_0x3b5fee===_0x7d67dc(0x162))_0xc9dd60={'document':fs_1[_0x7d67dc(0x186)][_0x7d67dc(0x16d)](_0x2b3649),'caption':_0x309567?_0x309567:null,'fileName':_0x2b9fc6,'mimetype':_0x49201d};else _0x3b5fee==='application'?_0xc9dd60={'document':fs_1['default']['readFileSync'](_0x2b3649),'caption':_0x309567?_0x309567:null,'fileName':_0x2b9fc6,'mimetype':_0x49201d}:_0xc9dd60={'image':fs_1[_0x7d67dc(0x186)][_0x7d67dc(0x16d)](_0x2b3649),'caption':_0x309567?_0x309567:null};}}return _0xc9dd60;}catch(_0x284a4d){return Sentry['captureException'](_0x284a4d),console[_0x7d67dc(0x179)](_0x284a4d),null;}};exports[a627_0x90c674(0x14d)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x593e7c,ticket:_0x518cdd,body:_0x60b91f,isPrivate:_0x451ecd,isForwarded:isForwarded=![]})=>{const _0x576b63=a627_0x90c674;try{const _0x1f8625=await(0x0,wbot_1[_0x576b63(0x190)])(_0x518cdd['whatsappId']),_0x2cabe9=_0x518cdd['companyId'][_0x576b63(0x163)](),_0x26d1cf=_0x593e7c['path'],_0x5dc831=_0x593e7c['mimetype'][_0x576b63(0x189)]('/')[0x0];let _0x5a24c8,_0x596c85='';const _0x39b9b4=_0x518cdd?(0x0,Mustache_1[_0x576b63(0x186)])(_0x60b91f,_0x518cdd):_0x60b91f;if(_0x5dc831===_0x576b63(0x147))_0x5a24c8={'video':fs_1['default'][_0x576b63(0x16d)](_0x26d1cf),'caption':_0x39b9b4,'fileName':_0x593e7c[_0x576b63(0x18d)][_0x576b63(0x170)]('/','-'),'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x596c85=_0x576b63(0x14f);else{if(_0x5dc831===_0x576b63(0x16b)){const _0x4f8ee8=!![];if(_0x4f8ee8){const _0x440712=await processAudio(_0x593e7c[_0x576b63(0x155)],_0x2cabe9);_0x5a24c8={'audio':fs_1[_0x576b63(0x186)][_0x576b63(0x16d)](_0x440712),'mimetype':_0x4f8ee8?_0x576b63(0x17d):_0x593e7c[_0x576b63(0x182)],'ptt':!![],'caption':_0x39b9b4,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1['unlinkSync'])(_0x440712);}else{const _0x17d6cf=await processAudio(_0x593e7c[_0x576b63(0x155)],_0x2cabe9);_0x5a24c8={'audio':fs_1[_0x576b63(0x186)][_0x576b63(0x16d)](_0x17d6cf),'mimetype':_0x576b63(0x17d),'ptt':!![],'caption':_0x39b9b4,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x576b63(0x17f)])(_0x17d6cf);}_0x596c85='ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio';}else{if(_0x5dc831===_0x576b63(0x162)||_0x5dc831===_0x576b63(0x169))_0x5a24c8={'document':fs_1[_0x576b63(0x186)][_0x576b63(0x16d)](_0x26d1cf),'caption':_0x39b9b4,'fileName':_0x593e7c[_0x576b63(0x18d)][_0x576b63(0x170)]('/','-'),'mimetype':_0x593e7c[_0x576b63(0x182)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x596c85='ðŸ“‚\x20Documento';else _0x5dc831===_0x576b63(0x15c)?(_0x5a24c8={'document':fs_1[_0x576b63(0x186)]['readFileSync'](_0x26d1cf),'caption':_0x39b9b4,'fileName':_0x593e7c[_0x576b63(0x18d)][_0x576b63(0x170)]('/','-'),'mimetype':_0x593e7c[_0x576b63(0x182)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x596c85=_0x576b63(0x161)):(_0x5a24c8={'image':fs_1[_0x576b63(0x186)][_0x576b63(0x16d)](_0x26d1cf),'caption':_0x39b9b4,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x596c85=_0x576b63(0x161));}}if(_0x451ecd){const _0x420681={'wid':_0x576b63(0x154)+_0x2cabe9+_0x518cdd['id']+_0x60b91f[_0x576b63(0x16c)](0x0,0x6),'ticketId':_0x518cdd['id'],'contactId':undefined,'body':_0x39b9b4,'fromMe':!![],'mediaUrl':_0x593e7c[_0x576b63(0x187)],'mediaType':_0x593e7c['mimetype']['split']('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x451ecd};await(0x0,CreateMessageService_1[_0x576b63(0x186)])({'messageData':_0x420681,'companyId':_0x518cdd[_0x576b63(0x174)]});return;}const _0x3b7a6b=await Contact_1['default'][_0x576b63(0x15a)](_0x518cdd[_0x576b63(0x15f)]);let _0x436da4;_0x3b7a6b[_0x576b63(0x15b)]&&_0x3b7a6b[_0x576b63(0x15b)]!==''&&_0x3b7a6b[_0x576b63(0x15b)]['includes']('@')?_0x436da4=_0x3b7a6b[_0x576b63(0x15b)]:_0x436da4=_0x3b7a6b[_0x576b63(0x178)]+'@'+(_0x518cdd['isGroup']?_0x576b63(0x160):_0x576b63(0x173));const _0x2861af=await _0x1f8625[_0x576b63(0x17e)](_0x436da4,{..._0x5a24c8});return await _0x518cdd[_0x576b63(0x16a)]({'lastMessage':_0x60b91f!==_0x593e7c[_0x576b63(0x187)]?_0x60b91f:_0x39b9b4,'imported':null}),_0x2861af;}catch(_0x24b7bf){Sentry[_0x576b63(0x166)](_0x24b7bf),console['log'](_0x24b7bf);throw new AppError_1['default']('ERR_SENDING_WAPP_MSG');}};exports['default']=SendWhatsAppMedia;