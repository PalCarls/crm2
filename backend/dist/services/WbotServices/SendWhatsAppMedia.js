'use strict';const a525_0x5e8a79=a525_0x462c;(function(_0x673947,_0x1dcc8f){const _0x1d4374=a525_0x462c,_0x133aa1=_0x673947();while(!![]){try{const _0x5df6f3=parseInt(_0x1d4374(0x178))/0x1*(parseInt(_0x1d4374(0x167))/0x2)+-parseInt(_0x1d4374(0x16f))/0x3*(-parseInt(_0x1d4374(0x185))/0x4)+-parseInt(_0x1d4374(0x19d))/0x5+parseInt(_0x1d4374(0x192))/0x6+parseInt(_0x1d4374(0x158))/0x7*(parseInt(_0x1d4374(0x191))/0x8)+-parseInt(_0x1d4374(0x18f))/0x9+-parseInt(_0x1d4374(0x198))/0xa;if(_0x5df6f3===_0x1dcc8f)break;else _0x133aa1['push'](_0x133aa1['shift']());}catch(_0x327ee0){_0x133aa1['push'](_0x133aa1['shift']());}}}(a525_0x4e87,0xb6735));var __createBinding=this&&this[a525_0x5e8a79(0x15f)]||(Object[a525_0x5e8a79(0x18c)]?function(_0x540a22,_0x3bbe41,_0x10b702,_0x429f35){const _0x4b327f=a525_0x5e8a79;if(_0x429f35===undefined)_0x429f35=_0x10b702;var _0x1cee89=Object[_0x4b327f(0x15c)](_0x3bbe41,_0x10b702);(!_0x1cee89||('get'in _0x1cee89?!_0x3bbe41['__esModule']:_0x1cee89['writable']||_0x1cee89[_0x4b327f(0x18d)]))&&(_0x1cee89={'enumerable':!![],'get':function(){return _0x3bbe41[_0x10b702];}}),Object['defineProperty'](_0x540a22,_0x429f35,_0x1cee89);}:function(_0x2880fc,_0x40c88e,_0x4ee905,_0x4234d1){if(_0x4234d1===undefined)_0x4234d1=_0x4ee905;_0x2880fc[_0x4234d1]=_0x40c88e[_0x4ee905];}),__setModuleDefault=this&&this[a525_0x5e8a79(0x162)]||(Object[a525_0x5e8a79(0x18c)]?function(_0x44ef00,_0x35e94d){const _0x4f1413=a525_0x5e8a79;Object[_0x4f1413(0x179)](_0x44ef00,_0x4f1413(0x16b),{'enumerable':!![],'value':_0x35e94d});}:function(_0x38f410,_0x55d3f1){const _0x589854=a525_0x5e8a79;_0x38f410[_0x589854(0x16b)]=_0x55d3f1;}),__importStar=this&&this[a525_0x5e8a79(0x17d)]||function(_0xd90a7d){const _0x576445=a525_0x5e8a79;if(_0xd90a7d&&_0xd90a7d['__esModule'])return _0xd90a7d;var _0x378209={};if(_0xd90a7d!=null){for(var _0x3762ad in _0xd90a7d)if(_0x3762ad!==_0x576445(0x16b)&&Object[_0x576445(0x17a)][_0x576445(0x159)][_0x576445(0x161)](_0xd90a7d,_0x3762ad))__createBinding(_0x378209,_0xd90a7d,_0x3762ad);}return __setModuleDefault(_0x378209,_0xd90a7d),_0x378209;},__importDefault=this&&this[a525_0x5e8a79(0x165)]||function(_0xc4ca44){const _0x5293bc=a525_0x5e8a79;return _0xc4ca44&&_0xc4ca44[_0x5293bc(0x184)]?_0xc4ca44:{'default':_0xc4ca44};};function a525_0x4e87(){const _0x410928=['__esModule','4CabEdu','exec','\x20-y','substring','getTime','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','../../libs/wbot','create','configurable','update','11215827UMJnoy','includes','3056bVKEur','116898mZOfpA','captureException','child_process','findByPk','ðŸ“Ž\x20Outros\x20anexos','toString','7918290kUadwe','@sentry/node','video','g.us','s.whatsapp.net','2861500dZrNPy','getWbot','audio','log','number','replace','12033kqSjNh','hasOwnProperty','application','.mp3','getOwnPropertyDescriptor','@ffmpeg-installer/ffmpeg','mimetype','__createBinding','mime-types','call','__setModuleDefault','../../errors/AppError','/company','__importDefault','isGroup','3498ndoNgc','ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo','resolve','sendMessage','default','../MessageServices/CreateMessageService','../../helpers/Mustache','split','4093533taBGrN','../../models/Contact','readFileSync','Invalid\x20mimetype','getMessageOptions','remoteJid','originalname','unlinkSync','audio/mp4','753yQkwdR','defineProperty','prototype','ðŸ“‚\x20Documento','companyId','__importStar','lookup','whatsappId','\x20-i\x20','contactId','public','path'];a525_0x4e87=function(){return _0x410928;};return a525_0x4e87();}Object[a525_0x5e8a79(0x179)](exports,'__esModule',{'value':!![]}),exports[a525_0x5e8a79(0x173)]=void 0x0;const Sentry=__importStar(require(a525_0x5e8a79(0x199))),fs_1=__importStar(require('fs')),child_process_1=require(a525_0x5e8a79(0x194)),path_1=__importDefault(require('path')),ffmpeg_1=__importDefault(require(a525_0x5e8a79(0x15d))),AppError_1=__importDefault(require(a525_0x5e8a79(0x163))),mime_types_1=__importDefault(require(a525_0x5e8a79(0x160))),Contact_1=__importDefault(require(a525_0x5e8a79(0x170))),wbot_1=require(a525_0x5e8a79(0x18b)),CreateMessageService_1=__importDefault(require(a525_0x5e8a79(0x16c))),Mustache_1=__importDefault(require(a525_0x5e8a79(0x16d))),publicFolder=path_1['default'][a525_0x5e8a79(0x169)](__dirname,'..','..','..',a525_0x5e8a79(0x182)),processAudio=async(_0x59a0ba,_0x2fb435)=>{const _0x3d0941=a525_0x5e8a79,_0x250e83=publicFolder+'/company'+_0x2fb435+'/'+new Date()[_0x3d0941(0x189)]()+'.m4a';return new Promise((_0x2e45bb,_0x4735cd)=>{const _0x4b7269=_0x3d0941;(0x0,child_process_1['exec'])(ffmpeg_1[_0x4b7269(0x16b)][_0x4b7269(0x183)]+_0x4b7269(0x180)+_0x59a0ba+_0x4b7269(0x18a)+_0x250e83+_0x4b7269(0x187),(_0x330cef,_0x3a7b72,_0x52badf)=>{if(_0x330cef)_0x4735cd(_0x330cef);_0x2e45bb(_0x250e83);});});},processAudioFile=async(_0x5d7a21,_0x47f4a2)=>{const _0x571367=a525_0x5e8a79,_0x8e94fb=publicFolder+_0x571367(0x164)+_0x47f4a2+'/'+new Date()['getTime']()+_0x571367(0x15b);return new Promise((_0x161421,_0x1e4ebf)=>{const _0x30a342=_0x571367;(0x0,child_process_1[_0x30a342(0x186)])(ffmpeg_1[_0x30a342(0x16b)][_0x30a342(0x183)]+'\x20-i\x20'+_0x5d7a21+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x8e94fb,(_0x564d1b,_0x468e74,_0x1674b0)=>{if(_0x564d1b)_0x1e4ebf(_0x564d1b);_0x161421(_0x8e94fb);});});},getMessageOptions=async(_0x18a387,_0x513e39,_0xfcd8d1)=>{const _0x202458=a525_0x5e8a79,_0x968596=mime_types_1['default'][_0x202458(0x17e)](_0x513e39),_0x181c28=_0x968596[_0x202458(0x16e)]('/')[0x0];try{if(!_0x968596)throw new Error(_0x202458(0x172));let _0x13b507;if(_0x181c28===_0x202458(0x19a))_0x13b507={'video':fs_1[_0x202458(0x16b)][_0x202458(0x171)](_0x513e39),'fileName':_0x18a387};else{if(_0x181c28==='audio'){const _0x438f7d=!![],_0xec89cc=await processAudio(_0x513e39,_0xfcd8d1);_0x438f7d?_0x13b507={'audio':fs_1[_0x202458(0x16b)]['readFileSync'](_0xec89cc),'mimetype':'audio/mp4','ptt':!![]}:_0x13b507={'audio':fs_1[_0x202458(0x16b)]['readFileSync'](_0xec89cc),'mimetype':_0x438f7d?'audio/mp4':_0x968596,'ptt':!![]};}else{if(_0x181c28==='document')_0x13b507={'document':fs_1[_0x202458(0x16b)][_0x202458(0x171)](_0x513e39),'caption':_0x18a387,'fileName':_0x18a387,'mimetype':_0x968596};else _0x181c28===_0x202458(0x15a)?_0x13b507={'document':fs_1[_0x202458(0x16b)][_0x202458(0x171)](_0x513e39),'caption':_0x18a387,'fileName':_0x18a387,'mimetype':_0x968596}:_0x13b507={'image':fs_1[_0x202458(0x16b)][_0x202458(0x171)](_0x513e39),'caption':_0x18a387};}}return _0x13b507;}catch(_0x524533){return Sentry[_0x202458(0x193)](_0x524533),console[_0x202458(0x155)](_0x524533),null;}};exports[a525_0x5e8a79(0x173)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x2dc16f,ticket:_0x43ace6,body:_0x46bcd5,isPrivate:_0x276a65})=>{const _0x28753b=a525_0x5e8a79;try{const _0x3c1559=await(0x0,wbot_1[_0x28753b(0x153)])(_0x43ace6[_0x28753b(0x17f)]),_0x126d81=_0x43ace6[_0x28753b(0x17c)][_0x28753b(0x197)](),_0x526b64=_0x2dc16f[_0x28753b(0x183)],_0x42efa1=_0x2dc16f['mimetype'][_0x28753b(0x16e)]('/')[0x0];let _0x447f34,_0xe21cdb='';if(_0x42efa1===_0x28753b(0x19a))_0x447f34={'video':fs_1[_0x28753b(0x16b)][_0x28753b(0x171)](_0x526b64),'caption':_0x46bcd5,'fileName':_0x2dc16f[_0x28753b(0x175)][_0x28753b(0x157)]('/','-')},_0xe21cdb=_0x28753b(0x168);else{if(_0x42efa1===_0x28753b(0x154)){const _0x9f62f=!![];if(_0x9f62f){const _0x50b923=await processAudio(_0x2dc16f[_0x28753b(0x183)],_0x126d81);_0x447f34={'audio':fs_1[_0x28753b(0x16b)][_0x28753b(0x171)](_0x50b923),'mimetype':_0x9f62f?_0x28753b(0x177):_0x2dc16f[_0x28753b(0x15e)],'ptt':!![]},(0x0,fs_1[_0x28753b(0x176)])(_0x50b923);}else{const _0x3e6ae2=await processAudio(_0x2dc16f[_0x28753b(0x183)],_0x126d81);_0x447f34={'audio':fs_1[_0x28753b(0x16b)][_0x28753b(0x171)](_0x3e6ae2),'mimetype':_0x28753b(0x177),'ptt':!![]},(0x0,fs_1[_0x28753b(0x176)])(_0x3e6ae2);}_0xe21cdb='ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio';}else{if(_0x42efa1==='document'||_0x42efa1==='text')_0x447f34={'document':fs_1['default']['readFileSync'](_0x526b64),'caption':null,'fileName':_0x2dc16f[_0x28753b(0x175)][_0x28753b(0x157)]('/','-'),'mimetype':_0x2dc16f[_0x28753b(0x15e)]},_0xe21cdb=_0x28753b(0x17b);else _0x42efa1==='application'?(_0x447f34={'document':fs_1['default'][_0x28753b(0x171)](_0x526b64),'caption':null,'fileName':_0x2dc16f[_0x28753b(0x175)]['replace']('/','-'),'mimetype':_0x2dc16f[_0x28753b(0x15e)]},_0xe21cdb=_0x28753b(0x196)):(_0x447f34={'image':fs_1['default']['readFileSync'](_0x526b64),'caption':null},_0xe21cdb=_0x28753b(0x196));}}if(_0x276a65){const _0x2f1738={'wid':'PVT'+_0x126d81+_0x43ace6['id']+_0x46bcd5[_0x28753b(0x188)](0x0,0x6),'ticketId':_0x43ace6['id'],'contactId':undefined,'body':_0xe21cdb,'fromMe':!![],'mediaUrl':_0x2dc16f['filename'],'mediaType':_0x2dc16f[_0x28753b(0x15e)]['split']('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x276a65};await(0x0,CreateMessageService_1[_0x28753b(0x16b)])({'messageData':_0x2f1738,'companyId':_0x43ace6[_0x28753b(0x17c)]});return;}const _0x28102e=await Contact_1['default'][_0x28753b(0x195)](_0x43ace6[_0x28753b(0x181)]);let _0x10ea4d;_0x28102e[_0x28753b(0x174)]&&_0x28102e[_0x28753b(0x174)]!==''&&_0x28102e[_0x28753b(0x174)][_0x28753b(0x190)]('@')?_0x10ea4d=_0x28102e[_0x28753b(0x174)]:_0x10ea4d=_0x28102e[_0x28753b(0x156)]+'@'+(_0x43ace6[_0x28753b(0x166)]?_0x28753b(0x19b):_0x28753b(0x19c));const _0x2d5183=await _0x3c1559[_0x28753b(0x16a)](_0x10ea4d,{..._0x447f34});return await _0x43ace6[_0x28753b(0x18e)]({'lastMessage':(0x0,Mustache_1[_0x28753b(0x16b)])(_0xe21cdb,_0x43ace6),'imported':null}),_0x2d5183;}catch(_0x9100a2){Sentry['captureException'](_0x9100a2),console[_0x28753b(0x155)](_0x9100a2);throw new AppError_1['default']('ERR_SENDING_WAPP_MSG');}};function a525_0x462c(_0x2bf18d,_0xdeb0ea){const _0x4e87e4=a525_0x4e87();return a525_0x462c=function(_0x462c48,_0x564788){_0x462c48=_0x462c48-0x153;let _0x4d8a55=_0x4e87e4[_0x462c48];return _0x4d8a55;},a525_0x462c(_0x2bf18d,_0xdeb0ea);}exports[a525_0x5e8a79(0x16b)]=SendWhatsAppMedia;