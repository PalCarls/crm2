'use strict';const a544_0x33eabe=a544_0x2b4a;(function(_0x14e794,_0x49a818){const _0x11d7c4=a544_0x2b4a,_0x268fc9=_0x14e794();while(!![]){try{const _0x30a408=parseInt(_0x11d7c4(0x192))/0x1+parseInt(_0x11d7c4(0x177))/0x2+parseInt(_0x11d7c4(0x18d))/0x3*(-parseInt(_0x11d7c4(0x1b0))/0x4)+-parseInt(_0x11d7c4(0x16c))/0x5+-parseInt(_0x11d7c4(0x16a))/0x6*(-parseInt(_0x11d7c4(0x180))/0x7)+-parseInt(_0x11d7c4(0x181))/0x8*(-parseInt(_0x11d7c4(0x195))/0x9)+-parseInt(_0x11d7c4(0x1a5))/0xa*(parseInt(_0x11d7c4(0x172))/0xb);if(_0x30a408===_0x49a818)break;else _0x268fc9['push'](_0x268fc9['shift']());}catch(_0x5b3baf){_0x268fc9['push'](_0x268fc9['shift']());}}}(a544_0xabb7,0xb8381));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x922e0c,_0x27b1b7,_0x481820,_0x186fba){const _0x50d4b7=a544_0x2b4a;if(_0x186fba===undefined)_0x186fba=_0x481820;var _0x575d97=Object[_0x50d4b7(0x178)](_0x27b1b7,_0x481820);(!_0x575d97||(_0x50d4b7(0x17b)in _0x575d97?!_0x27b1b7[_0x50d4b7(0x184)]:_0x575d97[_0x50d4b7(0x1a6)]||_0x575d97[_0x50d4b7(0x19b)]))&&(_0x575d97={'enumerable':!![],'get':function(){return _0x27b1b7[_0x481820];}}),Object[_0x50d4b7(0x199)](_0x922e0c,_0x186fba,_0x575d97);}:function(_0x5ecacf,_0x50a210,_0x12c492,_0x54c029){if(_0x54c029===undefined)_0x54c029=_0x12c492;_0x5ecacf[_0x54c029]=_0x50a210[_0x12c492];}),__setModuleDefault=this&&this[a544_0x33eabe(0x185)]||(Object[a544_0x33eabe(0x1a3)]?function(_0x2ccf56,_0x40a860){const _0x415414=a544_0x33eabe;Object[_0x415414(0x199)](_0x2ccf56,'default',{'enumerable':!![],'value':_0x40a860});}:function(_0x4abea3,_0x55ffa0){const _0x23f83a=a544_0x33eabe;_0x4abea3[_0x23f83a(0x196)]=_0x55ffa0;}),__importStar=this&&this[a544_0x33eabe(0x19f)]||function(_0x646a2b){const _0x2a5983=a544_0x33eabe;if(_0x646a2b&&_0x646a2b[_0x2a5983(0x184)])return _0x646a2b;var _0x442e8b={};if(_0x646a2b!=null){for(var _0x15d11b in _0x646a2b)if(_0x15d11b!==_0x2a5983(0x196)&&Object[_0x2a5983(0x187)][_0x2a5983(0x17c)][_0x2a5983(0x19e)](_0x646a2b,_0x15d11b))__createBinding(_0x442e8b,_0x646a2b,_0x15d11b);}return __setModuleDefault(_0x442e8b,_0x646a2b),_0x442e8b;},__importDefault=this&&this[a544_0x33eabe(0x18b)]||function(_0x41329a){const _0x9fda5e=a544_0x33eabe;return _0x41329a&&_0x41329a[_0x9fda5e(0x184)]?_0x41329a:{'default':_0x41329a};};Object[a544_0x33eabe(0x199)](exports,a544_0x33eabe(0x184),{'value':!![]}),exports[a544_0x33eabe(0x17f)]=void 0x0;const Sentry=__importStar(require(a544_0x33eabe(0x193))),fs_1=__importStar(require('fs')),child_process_1=require(a544_0x33eabe(0x1a8)),path_1=__importDefault(require(a544_0x33eabe(0x1a4))),ffmpeg_1=__importDefault(require(a544_0x33eabe(0x18e))),AppError_1=__importDefault(require(a544_0x33eabe(0x16f))),mime_types_1=__importDefault(require(a544_0x33eabe(0x1b2))),Contact_1=__importDefault(require(a544_0x33eabe(0x1ae))),wbot_1=require(a544_0x33eabe(0x173)),CreateMessageService_1=__importDefault(require(a544_0x33eabe(0x1ac))),Mustache_1=__importDefault(require(a544_0x33eabe(0x18f))),publicFolder=path_1[a544_0x33eabe(0x196)][a544_0x33eabe(0x19a)](__dirname,'..','..','..',a544_0x33eabe(0x1a1)),processAudio=async(_0x4fd9a6,_0x1484c9)=>{const _0x4292c3=a544_0x33eabe,_0x21a9da=publicFolder+_0x4292c3(0x16e)+_0x1484c9+'/'+new Date()[_0x4292c3(0x198)]()+'.m4a';return new Promise((_0x541306,_0x5d21a9)=>{const _0x5f3beb=_0x4292c3;(0x0,child_process_1['exec'])(ffmpeg_1[_0x5f3beb(0x196)][_0x5f3beb(0x1a4)]+_0x5f3beb(0x1ab)+_0x4fd9a6+_0x5f3beb(0x17a)+_0x21a9da+'\x20-y',(_0xd301d3,_0x321ead,_0x156161)=>{if(_0xd301d3)_0x5d21a9(_0xd301d3);_0x541306(_0x21a9da);});});},processAudioFile=async(_0x34dc0b,_0x1b22bc)=>{const _0x426421=a544_0x33eabe,_0x236663=publicFolder+_0x426421(0x16e)+_0x1b22bc+'/'+new Date()['getTime']()+_0x426421(0x189);return new Promise((_0x422ad0,_0x5c648f)=>{const _0x5edd3f=_0x426421;(0x0,child_process_1[_0x5edd3f(0x186)])(ffmpeg_1[_0x5edd3f(0x196)]['path']+'\x20-i\x20'+_0x34dc0b+_0x5edd3f(0x1ad)+_0x236663,(_0xfad264,_0x3ecae2,_0x369c5d)=>{if(_0xfad264)_0x5c648f(_0xfad264);_0x422ad0(_0x236663);});});},getMessageOptions=async(_0x4b2f17,_0x372df6,_0x4ef52b,_0x285916)=>{const _0x4d7077=a544_0x33eabe,_0x5766e2=mime_types_1[_0x4d7077(0x196)]['lookup'](_0x372df6),_0x5f5501=_0x5766e2[_0x4d7077(0x188)]('/')[0x0];try{if(!_0x5766e2)throw new Error(_0x4d7077(0x1b3));let _0x25c00c;if(_0x5f5501===_0x4d7077(0x1a2))_0x25c00c={'video':fs_1[_0x4d7077(0x196)]['readFileSync'](_0x372df6),'caption':_0x285916?_0x285916:null,'fileName':_0x4b2f17};else{if(_0x5f5501==='audio'){const _0x3ecba9=!![],_0x7c02b4=await processAudio(_0x372df6,_0x4ef52b);_0x3ecba9?_0x25c00c={'audio':fs_1['default'][_0x4d7077(0x18c)](_0x7c02b4),'mimetype':'audio/mp4','ptt':!![]}:_0x25c00c={'audio':fs_1['default'][_0x4d7077(0x18c)](_0x7c02b4),'mimetype':_0x3ecba9?_0x4d7077(0x17d):_0x5766e2,'ptt':!![]};}else{if(_0x5f5501==='document')_0x25c00c={'document':fs_1[_0x4d7077(0x196)]['readFileSync'](_0x372df6),'caption':_0x285916?_0x285916:null,'fileName':_0x4b2f17,'mimetype':_0x5766e2};else _0x5f5501===_0x4d7077(0x1a0)?_0x25c00c={'document':fs_1[_0x4d7077(0x196)]['readFileSync'](_0x372df6),'caption':_0x285916?_0x285916:null,'fileName':_0x4b2f17,'mimetype':_0x5766e2}:_0x25c00c={'image':fs_1[_0x4d7077(0x196)][_0x4d7077(0x18c)](_0x372df6),'caption':_0x285916?_0x285916:_0x4b2f17};}}return _0x25c00c;}catch(_0x3c1f5d){return Sentry['captureException'](_0x3c1f5d),console['log'](_0x3c1f5d),null;}};function a544_0x2b4a(_0x5d6533,_0xeb898d){const _0xabb762=a544_0xabb7();return a544_0x2b4a=function(_0x2b4af0,_0x3e827a){_0x2b4af0=_0x2b4af0-0x16a;let _0xf1383=_0xabb762[_0x2b4af0];return _0xf1383;},a544_0x2b4a(_0x5d6533,_0xeb898d);}exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x123f50,ticket:_0x306c5e,body:_0x50d006,isPrivate:_0x9833})=>{const _0x382d8a=a544_0x33eabe;try{const _0x34b49c=await(0x0,wbot_1[_0x382d8a(0x19d)])(_0x306c5e['whatsappId']),_0x2e446d=_0x306c5e[_0x382d8a(0x16b)][_0x382d8a(0x183)](),_0x12c422=_0x123f50['path'],_0x66ff68=_0x123f50['mimetype'][_0x382d8a(0x188)]('/')[0x0];let _0x9dabd,_0xd503ac='';const _0x37535a=(0x0,Mustache_1[_0x382d8a(0x196)])(_0x50d006,_0x306c5e);if(_0x66ff68===_0x382d8a(0x1a2))_0x9dabd={'video':fs_1[_0x382d8a(0x196)]['readFileSync'](_0x12c422),'caption':_0x37535a,'fileName':_0x123f50['originalname']['replace']('/','-')},_0xd503ac='ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo';else{if(_0x66ff68===_0x382d8a(0x19c)){const _0x2a0205=!![];if(_0x2a0205){const _0x33eda4=await processAudio(_0x123f50['path'],_0x2e446d);_0x9dabd={'audio':fs_1[_0x382d8a(0x196)]['readFileSync'](_0x33eda4),'mimetype':_0x2a0205?_0x382d8a(0x17d):_0x123f50[_0x382d8a(0x1af)],'ptt':!![]},(0x0,fs_1['unlinkSync'])(_0x33eda4);}else{const _0xfa94c6=await processAudio(_0x123f50['path'],_0x2e446d);_0x9dabd={'audio':fs_1[_0x382d8a(0x196)][_0x382d8a(0x18c)](_0xfa94c6),'mimetype':'audio/mp4','ptt':!![]},(0x0,fs_1['unlinkSync'])(_0xfa94c6);}_0xd503ac='ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio';}else{if(_0x66ff68===_0x382d8a(0x179)||_0x66ff68===_0x382d8a(0x1aa))_0x9dabd={'document':fs_1[_0x382d8a(0x196)][_0x382d8a(0x18c)](_0x12c422),'caption':_0x37535a,'fileName':_0x123f50[_0x382d8a(0x171)][_0x382d8a(0x170)]('/','-'),'mimetype':_0x123f50[_0x382d8a(0x1af)]},_0xd503ac=_0x382d8a(0x1a7);else _0x66ff68===_0x382d8a(0x1a0)?(_0x9dabd={'document':fs_1[_0x382d8a(0x196)]['readFileSync'](_0x12c422),'caption':_0x37535a,'fileName':_0x123f50[_0x382d8a(0x171)]['replace']('/','-'),'mimetype':_0x123f50['mimetype']},_0xd503ac=_0x382d8a(0x175)):(_0x9dabd={'image':fs_1['default'][_0x382d8a(0x18c)](_0x12c422),'caption':_0x37535a},_0xd503ac='ðŸ“Ž\x20Outros\x20anexos');}}if(_0x9833){const _0x40a110={'wid':'PVT'+_0x2e446d+_0x306c5e['id']+_0x50d006[_0x382d8a(0x174)](0x0,0x6),'ticketId':_0x306c5e['id'],'contactId':undefined,'body':_0xd503ac,'fromMe':!![],'mediaUrl':_0x123f50['filename'],'mediaType':_0x123f50[_0x382d8a(0x1af)][_0x382d8a(0x188)]('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x9833};await(0x0,CreateMessageService_1[_0x382d8a(0x196)])({'messageData':_0x40a110,'companyId':_0x306c5e[_0x382d8a(0x16b)]});return;}const _0x250b88=await Contact_1[_0x382d8a(0x196)][_0x382d8a(0x16d)](_0x306c5e['contactId']);let _0x4ca969;_0x250b88[_0x382d8a(0x1b1)]&&_0x250b88[_0x382d8a(0x1b1)]!==''&&_0x250b88[_0x382d8a(0x1b1)][_0x382d8a(0x176)]('@')?_0x4ca969=_0x250b88[_0x382d8a(0x1b1)]:_0x4ca969=_0x250b88[_0x382d8a(0x190)]+'@'+(_0x306c5e['isGroup']?_0x382d8a(0x191):_0x382d8a(0x17e));const _0x54a000=await _0x34b49c[_0x382d8a(0x18a)](_0x4ca969,{..._0x9dabd});return await _0x306c5e[_0x382d8a(0x182)]({'lastMessage':(0x0,Mustache_1['default'])(_0x50d006!==_0x123f50['filename']?(0x0,Mustache_1[_0x382d8a(0x196)])(_0x50d006,_0x306c5e):_0xd503ac,_0x306c5e),'imported':null}),_0x54a000;}catch(_0x5eea88){Sentry[_0x382d8a(0x197)](_0x5eea88),console[_0x382d8a(0x194)](_0x5eea88);throw new AppError_1[(_0x382d8a(0x196))](_0x382d8a(0x1a9));}};function a544_0xabb7(){const _0x3a0867=['ðŸ“‚\x20Documento','child_process','ERR_SENDING_WAPP_MSG','text','\x20-i\x20','../MessageServices/CreateMessageService','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','../../models/Contact','mimetype','4yojFdn','remoteJid','mime-types','Invalid\x20mimetype','6pVgfeY','companyId','5306205xopECL','findByPk','/company','../../errors/AppError','replace','originalname','11zuAPKy','../../libs/wbot','substring','ðŸ“Ž\x20Outros\x20anexos','includes','1576366PQIbMH','getOwnPropertyDescriptor','document','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','get','hasOwnProperty','audio/mp4','s.whatsapp.net','getMessageOptions','4268047zFLVeY','40YqArjx','update','toString','__esModule','__setModuleDefault','exec','prototype','split','.mp3','sendMessage','__importDefault','readFileSync','2638743xngxDG','@ffmpeg-installer/ffmpeg','../../helpers/Mustache','number','g.us','1352396gCHgXI','@sentry/node','log','1433466dwcJsG','default','captureException','getTime','defineProperty','resolve','configurable','audio','getWbot','call','__importStar','application','public','video','create','path','8512870EcAHiQ','writable'];a544_0xabb7=function(){return _0x3a0867;};return a544_0xabb7();}exports[a544_0x33eabe(0x196)]=SendWhatsAppMedia;