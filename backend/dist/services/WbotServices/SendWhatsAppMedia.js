'use strict';const a561_0x11c531=a561_0x43db;(function(_0x36c07b,_0x43774a){const _0x56548d=a561_0x43db,_0x572ad4=_0x36c07b();while(!![]){try{const _0x1293a8=parseInt(_0x56548d(0x16e))/0x1+parseInt(_0x56548d(0x152))/0x2+parseInt(_0x56548d(0x177))/0x3+parseInt(_0x56548d(0x167))/0x4+parseInt(_0x56548d(0x14d))/0x5+parseInt(_0x56548d(0x15f))/0x6+-parseInt(_0x56548d(0x170))/0x7;if(_0x1293a8===_0x43774a)break;else _0x572ad4['push'](_0x572ad4['shift']());}catch(_0xa5d0b8){_0x572ad4['push'](_0x572ad4['shift']());}}}(a561_0x3352,0x23afd));var __createBinding=this&&this[a561_0x11c531(0x17f)]||(Object[a561_0x11c531(0x189)]?function(_0x45b9b5,_0x96a66b,_0x3a944f,_0x24ef1b){const _0x8496b3=a561_0x11c531;if(_0x24ef1b===undefined)_0x24ef1b=_0x3a944f;var _0x5784e2=Object['getOwnPropertyDescriptor'](_0x96a66b,_0x3a944f);(!_0x5784e2||(_0x8496b3(0x188)in _0x5784e2?!_0x96a66b[_0x8496b3(0x14e)]:_0x5784e2[_0x8496b3(0x165)]||_0x5784e2[_0x8496b3(0x15d)]))&&(_0x5784e2={'enumerable':!![],'get':function(){return _0x96a66b[_0x3a944f];}}),Object[_0x8496b3(0x14b)](_0x45b9b5,_0x24ef1b,_0x5784e2);}:function(_0x1f0018,_0x2323e8,_0x17dcbc,_0x29ce7d){if(_0x29ce7d===undefined)_0x29ce7d=_0x17dcbc;_0x1f0018[_0x29ce7d]=_0x2323e8[_0x17dcbc];}),__setModuleDefault=this&&this[a561_0x11c531(0x15c)]||(Object['create']?function(_0x211b36,_0x3be2a0){const _0x47f0a7=a561_0x11c531;Object[_0x47f0a7(0x14b)](_0x211b36,_0x47f0a7(0x150),{'enumerable':!![],'value':_0x3be2a0});}:function(_0x2c9062,_0x3b97af){_0x2c9062['default']=_0x3b97af;}),__importStar=this&&this[a561_0x11c531(0x160)]||function(_0x31e7bc){const _0x93b457=a561_0x11c531;if(_0x31e7bc&&_0x31e7bc['__esModule'])return _0x31e7bc;var _0x278ae6={};if(_0x31e7bc!=null){for(var _0x37f9fe in _0x31e7bc)if(_0x37f9fe!==_0x93b457(0x150)&&Object[_0x93b457(0x16d)][_0x93b457(0x18c)][_0x93b457(0x154)](_0x31e7bc,_0x37f9fe))__createBinding(_0x278ae6,_0x31e7bc,_0x37f9fe);}return __setModuleDefault(_0x278ae6,_0x31e7bc),_0x278ae6;},__importDefault=this&&this[a561_0x11c531(0x157)]||function(_0x30c9f5){const _0x2e212c=a561_0x11c531;return _0x30c9f5&&_0x30c9f5[_0x2e212c(0x14e)]?_0x30c9f5:{'default':_0x30c9f5};};function a561_0x3352(){const _0x343921=['number','document','originalname','__createBinding','ðŸ“Ž\x20Outros\x20anexos','update','mimetype','sendMessage','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','getTime','findByPk','.m4a','get','create','\x20-i\x20','remoteJid','hasOwnProperty','mime-types','@sentry/node','defineProperty','split','1249665GArwaP','__esModule','../../helpers/Mustache','default','/company','165836uRarVq','getMessageOptions','call','resolve','readFileSync','__importDefault','exec','../../models/Contact','unlinkSync','text','__setModuleDefault','configurable','contactId','613656QIKrNx','__importStar','PVT','audio/mp4','filename','isGroup','writable','log','463224eEPKvl','ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio','ðŸ“‚\x20Documento','includes','path','@ffmpeg-installer/ffmpeg','prototype','82408vFpBeN','public','4324075DSVNnu','application','\x20-y','companyId','whatsappId','../MessageServices/CreateMessageService','getWbot','391671QBSrWL','s.whatsapp.net','replace','captureException','toString'];a561_0x3352=function(){return _0x343921;};return a561_0x3352();}function a561_0x43db(_0x596420,_0x177b9f){const _0x33524c=a561_0x3352();return a561_0x43db=function(_0x43dbaa,_0x184eb3){_0x43dbaa=_0x43dbaa-0x14b;let _0x47a61c=_0x33524c[_0x43dbaa];return _0x47a61c;},a561_0x43db(_0x596420,_0x177b9f);}Object[a561_0x11c531(0x14b)](exports,'__esModule',{'value':!![]}),exports[a561_0x11c531(0x153)]=void 0x0;const Sentry=__importStar(require(a561_0x11c531(0x18e))),fs_1=__importStar(require('fs')),child_process_1=require('child_process'),path_1=__importDefault(require(a561_0x11c531(0x16b))),ffmpeg_1=__importDefault(require(a561_0x11c531(0x16c))),AppError_1=__importDefault(require('../../errors/AppError')),mime_types_1=__importDefault(require(a561_0x11c531(0x18d))),Contact_1=__importDefault(require(a561_0x11c531(0x159))),wbot_1=require('../../libs/wbot'),CreateMessageService_1=__importDefault(require(a561_0x11c531(0x175))),Mustache_1=__importDefault(require(a561_0x11c531(0x14f))),publicFolder=path_1[a561_0x11c531(0x150)][a561_0x11c531(0x155)](__dirname,'..','..','..',a561_0x11c531(0x16f)),processAudio=async(_0x13762a,_0x3486fe)=>{const _0x11d41a=a561_0x11c531,_0x4f950c=publicFolder+_0x11d41a(0x151)+_0x3486fe+'/'+new Date()['getTime']()+_0x11d41a(0x187);return new Promise((_0x1a98a8,_0xbe0abe)=>{const _0x555b68=_0x11d41a;(0x0,child_process_1['exec'])(ffmpeg_1['default'][_0x555b68(0x16b)]+_0x555b68(0x18a)+_0x13762a+'\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20'+_0x4f950c+_0x555b68(0x172),(_0x19feb1,_0x24c586,_0xe4b0ef)=>{if(_0x19feb1)_0xbe0abe(_0x19feb1);_0x1a98a8(_0x4f950c);});});},processAudioFile=async(_0x322735,_0x506541)=>{const _0x563b67=a561_0x11c531,_0x434628=publicFolder+_0x563b67(0x151)+_0x506541+'/'+new Date()[_0x563b67(0x185)]()+'.mp3';return new Promise((_0x24a181,_0x1c9103)=>{const _0x1e7b3c=_0x563b67;(0x0,child_process_1[_0x1e7b3c(0x158)])(ffmpeg_1[_0x1e7b3c(0x150)][_0x1e7b3c(0x16b)]+'\x20-i\x20'+_0x322735+_0x1e7b3c(0x184)+_0x434628,(_0x517a69,_0x16297f,_0x1b2750)=>{if(_0x517a69)_0x1c9103(_0x517a69);_0x24a181(_0x434628);});});},getMessageOptions=async(_0x127668,_0x106eab,_0xe8131a,_0x1eaae9)=>{const _0x321198=a561_0x11c531,_0x31cc88=mime_types_1[_0x321198(0x150)]['lookup'](_0x106eab),_0x10e48b=_0x31cc88[_0x321198(0x14c)]('/')[0x0];try{if(!_0x31cc88)throw new Error('Invalid\x20mimetype');let _0x59fc8f;if(_0x10e48b==='video')_0x59fc8f={'video':fs_1[_0x321198(0x150)][_0x321198(0x156)](_0x106eab),'caption':_0x1eaae9?_0x1eaae9:null,'fileName':_0x127668};else{if(_0x10e48b==='audio'){const _0xe7d869=!![],_0x39db75=await processAudio(_0x106eab,_0xe8131a);_0xe7d869?_0x59fc8f={'audio':fs_1[_0x321198(0x150)][_0x321198(0x156)](_0x39db75),'mimetype':'audio/mp4','ptt':!![]}:_0x59fc8f={'audio':fs_1[_0x321198(0x150)][_0x321198(0x156)](_0x39db75),'mimetype':_0xe7d869?'audio/mp4':_0x31cc88,'ptt':!![]};}else{if(_0x10e48b===_0x321198(0x17d))_0x59fc8f={'document':fs_1[_0x321198(0x150)][_0x321198(0x156)](_0x106eab),'caption':_0x1eaae9?_0x1eaae9:null,'fileName':_0x127668,'mimetype':_0x31cc88};else _0x10e48b===_0x321198(0x171)?_0x59fc8f={'document':fs_1[_0x321198(0x150)]['readFileSync'](_0x106eab),'caption':_0x1eaae9?_0x1eaae9:null,'fileName':_0x127668,'mimetype':_0x31cc88}:_0x59fc8f={'image':fs_1['default']['readFileSync'](_0x106eab),'caption':_0x1eaae9?_0x1eaae9:_0x127668};}}return _0x59fc8f;}catch(_0x58a6e5){return Sentry[_0x321198(0x17a)](_0x58a6e5),console[_0x321198(0x166)](_0x58a6e5),null;}};exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x28082b,ticket:_0x3ca665,body:_0x1edbbf,isPrivate:_0x261126,isForwarded:isForwarded=![]})=>{const _0x550d10=a561_0x11c531;try{const _0x412fb1=await(0x0,wbot_1[_0x550d10(0x176)])(_0x3ca665[_0x550d10(0x174)]),_0x98c21c=_0x3ca665[_0x550d10(0x173)][_0x550d10(0x17b)](),_0x135c55=_0x28082b[_0x550d10(0x16b)],_0x34a50e=_0x28082b[_0x550d10(0x182)][_0x550d10(0x14c)]('/')[0x0];let _0x5b9000,_0x37ff04='';const _0x3d6685=(0x0,Mustache_1[_0x550d10(0x150)])(_0x1edbbf,_0x3ca665);if(_0x34a50e==='video')_0x5b9000={'video':fs_1['default']['readFileSync'](_0x135c55),'caption':_0x3d6685,'fileName':_0x28082b[_0x550d10(0x17e)][_0x550d10(0x179)]('/','-'),'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x37ff04='ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo';else{if(_0x34a50e==='audio'){const _0x253558=!![];if(_0x253558){const _0x241eb9=await processAudio(_0x28082b[_0x550d10(0x16b)],_0x98c21c);_0x5b9000={'audio':fs_1[_0x550d10(0x150)][_0x550d10(0x156)](_0x241eb9),'mimetype':_0x253558?'audio/mp4':_0x28082b[_0x550d10(0x182)],'ptt':!![],'caption':_0x3d6685,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x550d10(0x15a)])(_0x241eb9);}else{const _0x134a17=await processAudio(_0x28082b[_0x550d10(0x16b)],_0x98c21c);_0x5b9000={'audio':fs_1[_0x550d10(0x150)]['readFileSync'](_0x134a17),'mimetype':_0x550d10(0x162),'ptt':!![],'caption':_0x3d6685,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1['unlinkSync'])(_0x134a17);}_0x37ff04=_0x550d10(0x168);}else{if(_0x34a50e===_0x550d10(0x17d)||_0x34a50e===_0x550d10(0x15b))_0x5b9000={'document':fs_1[_0x550d10(0x150)][_0x550d10(0x156)](_0x135c55),'caption':_0x3d6685,'fileName':_0x28082b[_0x550d10(0x17e)][_0x550d10(0x179)]('/','-'),'mimetype':_0x28082b[_0x550d10(0x182)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x37ff04=_0x550d10(0x169);else _0x34a50e===_0x550d10(0x171)?(_0x5b9000={'document':fs_1[_0x550d10(0x150)]['readFileSync'](_0x135c55),'caption':_0x3d6685,'fileName':_0x28082b[_0x550d10(0x17e)][_0x550d10(0x179)]('/','-'),'mimetype':_0x28082b[_0x550d10(0x182)],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x37ff04=_0x550d10(0x180)):(_0x5b9000={'image':fs_1[_0x550d10(0x150)][_0x550d10(0x156)](_0x135c55),'caption':_0x3d6685,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x37ff04='ðŸ“Ž\x20Outros\x20anexos');}}if(_0x261126){const _0xc994dd={'wid':_0x550d10(0x161)+_0x98c21c+_0x3ca665['id']+_0x1edbbf['substring'](0x0,0x6),'ticketId':_0x3ca665['id'],'contactId':undefined,'body':_0x37ff04,'fromMe':!![],'mediaUrl':_0x28082b[_0x550d10(0x163)],'mediaType':_0x28082b[_0x550d10(0x182)][_0x550d10(0x14c)]('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x261126};await(0x0,CreateMessageService_1['default'])({'messageData':_0xc994dd,'companyId':_0x3ca665[_0x550d10(0x173)]});return;}const _0x11f88c=await Contact_1[_0x550d10(0x150)][_0x550d10(0x186)](_0x3ca665[_0x550d10(0x15e)]);let _0x3fcf0e;_0x11f88c[_0x550d10(0x18b)]&&_0x11f88c[_0x550d10(0x18b)]!==''&&_0x11f88c[_0x550d10(0x18b)][_0x550d10(0x16a)]('@')?_0x3fcf0e=_0x11f88c[_0x550d10(0x18b)]:_0x3fcf0e=_0x11f88c[_0x550d10(0x17c)]+'@'+(_0x3ca665[_0x550d10(0x164)]?'g.us':_0x550d10(0x178));const _0x152ec0=await _0x412fb1[_0x550d10(0x183)](_0x3fcf0e,{..._0x5b9000});return await _0x3ca665[_0x550d10(0x181)]({'lastMessage':(0x0,Mustache_1['default'])(_0x1edbbf!==_0x28082b['filename']?(0x0,Mustache_1[_0x550d10(0x150)])(_0x1edbbf,_0x3ca665):_0x37ff04,_0x3ca665),'imported':null}),_0x152ec0;}catch(_0x31522a){Sentry[_0x550d10(0x17a)](_0x31522a),console[_0x550d10(0x166)](_0x31522a);throw new AppError_1['default']('ERR_SENDING_WAPP_MSG');}};exports[a561_0x11c531(0x150)]=SendWhatsAppMedia;