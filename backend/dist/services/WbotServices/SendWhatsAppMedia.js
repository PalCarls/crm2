'use strict';const a619_0x540f84=a619_0x593d;(function(_0x3ec157,_0x158881){const _0x30b3d7=a619_0x593d,_0x51f470=_0x3ec157();while(!![]){try{const _0x3586ac=-parseInt(_0x30b3d7(0x1b9))/0x1*(parseInt(_0x30b3d7(0x190))/0x2)+-parseInt(_0x30b3d7(0x1a8))/0x3+-parseInt(_0x30b3d7(0x193))/0x4+-parseInt(_0x30b3d7(0x1bb))/0x5+parseInt(_0x30b3d7(0x1bd))/0x6*(parseInt(_0x30b3d7(0x194))/0x7)+-parseInt(_0x30b3d7(0x1c8))/0x8*(-parseInt(_0x30b3d7(0x192))/0x9)+parseInt(_0x30b3d7(0x1ba))/0xa;if(_0x3586ac===_0x158881)break;else _0x51f470['push'](_0x51f470['shift']());}catch(_0x1933f0){_0x51f470['push'](_0x51f470['shift']());}}}(a619_0x1975,0x33974));var __createBinding=this&&this[a619_0x540f84(0x1cb)]||(Object[a619_0x540f84(0x1aa)]?function(_0x164ee7,_0x30a3e6,_0x8153f8,_0x291b38){const _0x3985c0=a619_0x540f84;if(_0x291b38===undefined)_0x291b38=_0x8153f8;var _0x416a71=Object[_0x3985c0(0x1c5)](_0x30a3e6,_0x8153f8);(!_0x416a71||(_0x3985c0(0x1ca)in _0x416a71?!_0x30a3e6['__esModule']:_0x416a71['writable']||_0x416a71[_0x3985c0(0x1b1)]))&&(_0x416a71={'enumerable':!![],'get':function(){return _0x30a3e6[_0x8153f8];}}),Object[_0x3985c0(0x19a)](_0x164ee7,_0x291b38,_0x416a71);}:function(_0x317b8c,_0x473f82,_0x1d3b41,_0x3952be){if(_0x3952be===undefined)_0x3952be=_0x1d3b41;_0x317b8c[_0x3952be]=_0x473f82[_0x1d3b41];}),__setModuleDefault=this&&this[a619_0x540f84(0x1a2)]||(Object[a619_0x540f84(0x1aa)]?function(_0x5901a0,_0x3ed798){const _0x263133=a619_0x540f84;Object[_0x263133(0x19a)](_0x5901a0,_0x263133(0x1a4),{'enumerable':!![],'value':_0x3ed798});}:function(_0x59e6be,_0x1d0528){const _0x27a891=a619_0x540f84;_0x59e6be[_0x27a891(0x1a4)]=_0x1d0528;}),__importStar=this&&this[a619_0x540f84(0x18d)]||function(_0xbfb210){const _0x4a4a2e=a619_0x540f84;if(_0xbfb210&&_0xbfb210[_0x4a4a2e(0x1b0)])return _0xbfb210;var _0x4a0c52={};if(_0xbfb210!=null){for(var _0x273e8c in _0xbfb210)if(_0x273e8c!==_0x4a4a2e(0x1a4)&&Object['prototype']['hasOwnProperty']['call'](_0xbfb210,_0x273e8c))__createBinding(_0x4a0c52,_0xbfb210,_0x273e8c);}return __setModuleDefault(_0x4a0c52,_0xbfb210),_0x4a0c52;},__importDefault=this&&this[a619_0x540f84(0x1cd)]||function(_0x4f42ec){const _0x5cce56=a619_0x540f84;return _0x4f42ec&&_0x4f42ec[_0x5cce56(0x1b0)]?_0x4f42ec:{'default':_0x4f42ec};};Object[a619_0x540f84(0x19a)](exports,'__esModule',{'value':!![]}),exports[a619_0x540f84(0x1ad)]=void 0x0;function a619_0x1975(){const _0x5caf36=['sendMessage','Invalid\x20mimetype','4054zumsAC','ðŸ“‚\x20Documento','1691937QBsFLg','1538200ocBrFd','7CwkoTi','split','document','path','.mp3','resolve','defineProperty','audio','@sentry/node','replace','originalname','lookup','g.us','whatsappId','__setModuleDefault','unlinkSync','default','\x20-i\x20','log','ðŸ“Ž\x20Outros\x20anexos','600768OZLTcT','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','create','ERR_SENDING_WAPP_MSG','exec','getMessageOptions','text','../../helpers/Mustache','__esModule','configurable','findByPk','readFileSync','captureException','toString','filename','includes','audio/mp4','113kAifNT','9425240JpqfuZ','829375HgGOyZ','../../libs/wbot','363186jRmzLc','video','companyId','application','getTime','../../errors/AppError','isGroup','remoteJid','getOwnPropertyDescriptor','/company','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','8VjDfJC','mimetype','get','__createBinding','\x20-y','__importDefault','child_process','@ffmpeg-installer/ffmpeg','__importStar'];a619_0x1975=function(){return _0x5caf36;};return a619_0x1975();}function a619_0x593d(_0x386d83,_0x46e2ec){const _0x1975d4=a619_0x1975();return a619_0x593d=function(_0x593df4,_0x12166e){_0x593df4=_0x593df4-0x18c;let _0x2cbfac=_0x1975d4[_0x593df4];return _0x2cbfac;},a619_0x593d(_0x386d83,_0x46e2ec);}const Sentry=__importStar(require(a619_0x540f84(0x19c))),fs_1=__importStar(require('fs')),child_process_1=require(a619_0x540f84(0x1ce)),path_1=__importDefault(require(a619_0x540f84(0x197))),ffmpeg_1=__importDefault(require(a619_0x540f84(0x18c))),AppError_1=__importDefault(require(a619_0x540f84(0x1c2))),mime_types_1=__importDefault(require('mime-types')),Contact_1=__importDefault(require('../../models/Contact')),wbot_1=require(a619_0x540f84(0x1bc)),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),Mustache_1=__importDefault(require(a619_0x540f84(0x1af))),publicFolder=path_1[a619_0x540f84(0x1a4)][a619_0x540f84(0x199)](__dirname,'..','..','..','public'),processAudio=async(_0x45196f,_0x1ee458)=>{const _0x20ea77=a619_0x540f84,_0x37a02a=publicFolder+'/company'+_0x1ee458+'/'+new Date()['getTime']()+_0x20ea77(0x198);return new Promise((_0x2c1536,_0x30581f)=>{const _0xdc65f=_0x20ea77;(0x0,child_process_1['exec'])(ffmpeg_1[_0xdc65f(0x1a4)]['path']+_0xdc65f(0x1a5)+_0x45196f+_0xdc65f(0x1a9)+_0x37a02a+_0xdc65f(0x1cc),(_0x40f84f,_0x1d0806,_0x32898c)=>{if(_0x40f84f)_0x30581f(_0x40f84f);_0x2c1536(_0x37a02a);});});},processAudioFile=async(_0x4f0827,_0x49b18c)=>{const _0x201d09=a619_0x540f84,_0x58af59=publicFolder+_0x201d09(0x1c6)+_0x49b18c+'/'+new Date()[_0x201d09(0x1c1)]()+'.mp3';return new Promise((_0x46713a,_0x42df7b)=>{const _0xfdf490=_0x201d09;(0x0,child_process_1[_0xfdf490(0x1ac)])(ffmpeg_1[_0xfdf490(0x1a4)][_0xfdf490(0x197)]+_0xfdf490(0x1a5)+_0x4f0827+_0xfdf490(0x1c7)+_0x58af59,(_0x1c5f5d,_0x391cb8,_0x4c4a2d)=>{if(_0x1c5f5d)_0x42df7b(_0x1c5f5d);_0x46713a(_0x58af59);});});},getMessageOptions=async(_0x545291,_0x64792e,_0xf612a9,_0x12f3d9)=>{const _0x5c0c10=a619_0x540f84,_0x3dac5f=mime_types_1[_0x5c0c10(0x1a4)][_0x5c0c10(0x19f)](_0x64792e),_0x1b6167=_0x3dac5f[_0x5c0c10(0x195)]('/')[0x0];try{if(!_0x3dac5f)throw new Error(_0x5c0c10(0x18f));let _0x22499f;if(_0x1b6167===_0x5c0c10(0x1be))_0x22499f={'video':fs_1[_0x5c0c10(0x1a4)][_0x5c0c10(0x1b3)](_0x64792e),'caption':_0x12f3d9?_0x12f3d9:null,'fileName':_0x545291};else{if(_0x1b6167===_0x5c0c10(0x19b)){const _0x3bc1fe=!![],_0x385ea5=await processAudio(_0x64792e,_0xf612a9);_0x3bc1fe?_0x22499f={'audio':fs_1[_0x5c0c10(0x1a4)][_0x5c0c10(0x1b3)](_0x385ea5),'mimetype':_0x5c0c10(0x1b8),'ptt':!![]}:_0x22499f={'audio':fs_1[_0x5c0c10(0x1a4)][_0x5c0c10(0x1b3)](_0x385ea5),'mimetype':_0x3bc1fe?_0x5c0c10(0x1b8):_0x3dac5f,'ptt':!![]};}else{if(_0x1b6167===_0x5c0c10(0x196))_0x22499f={'document':fs_1[_0x5c0c10(0x1a4)][_0x5c0c10(0x1b3)](_0x64792e),'caption':_0x12f3d9?_0x12f3d9:null,'fileName':_0x545291,'mimetype':_0x3dac5f};else _0x1b6167===_0x5c0c10(0x1c0)?_0x22499f={'document':fs_1[_0x5c0c10(0x1a4)][_0x5c0c10(0x1b3)](_0x64792e),'caption':_0x12f3d9?_0x12f3d9:null,'fileName':_0x545291,'mimetype':_0x3dac5f}:_0x22499f={'image':fs_1['default'][_0x5c0c10(0x1b3)](_0x64792e),'caption':_0x12f3d9?_0x12f3d9:_0x545291};}}return _0x22499f;}catch(_0x312c7f){return Sentry[_0x5c0c10(0x1b4)](_0x312c7f),console[_0x5c0c10(0x1a6)](_0x312c7f),null;}};exports[a619_0x540f84(0x1ad)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x27ac52,ticket:_0x2b3194,body:_0x36ac20,isPrivate:_0x227a31,isForwarded:isForwarded=![]})=>{const _0x2942f0=a619_0x540f84;try{const _0x4b58ec=await(0x0,wbot_1['getWbot'])(_0x2b3194[_0x2942f0(0x1a1)]),_0x21f7f0=_0x2b3194[_0x2942f0(0x1bf)][_0x2942f0(0x1b5)](),_0x38c49d=_0x27ac52['path'],_0x4b9e6d=_0x27ac52['mimetype'][_0x2942f0(0x195)]('/')[0x0];let _0x49c234,_0x11da2a='';const _0x39d5ba=_0x2b3194?(0x0,Mustache_1['default'])(_0x36ac20,_0x2b3194):_0x36ac20;if(_0x4b9e6d===_0x2942f0(0x1be))_0x49c234={'video':fs_1[_0x2942f0(0x1a4)][_0x2942f0(0x1b3)](_0x38c49d),'caption':_0x39d5ba,'fileName':_0x27ac52[_0x2942f0(0x19e)][_0x2942f0(0x19d)]('/','-'),'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x11da2a='ðŸŽ¥\x20Arquivo\x20de\x20vÃ­deo';else{if(_0x4b9e6d==='audio'){const _0x474e5a=!![];if(_0x474e5a){const _0x122067=await processAudio(_0x27ac52[_0x2942f0(0x197)],_0x21f7f0);_0x49c234={'audio':fs_1[_0x2942f0(0x1a4)][_0x2942f0(0x1b3)](_0x122067),'mimetype':_0x474e5a?_0x2942f0(0x1b8):_0x27ac52[_0x2942f0(0x1c9)],'ptt':!![],'caption':_0x39d5ba,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x2942f0(0x1a3)])(_0x122067);}else{const _0x56d504=await processAudio(_0x27ac52[_0x2942f0(0x197)],_0x21f7f0);_0x49c234={'audio':fs_1['default'][_0x2942f0(0x1b3)](_0x56d504),'mimetype':_0x2942f0(0x1b8),'ptt':!![],'caption':_0x39d5ba,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},(0x0,fs_1[_0x2942f0(0x1a3)])(_0x56d504);}_0x11da2a='ðŸŽµ\x20Arquivo\x20de\x20Ã¡udio';}else{if(_0x4b9e6d===_0x2942f0(0x196)||_0x4b9e6d===_0x2942f0(0x1ae))_0x49c234={'document':fs_1[_0x2942f0(0x1a4)][_0x2942f0(0x1b3)](_0x38c49d),'caption':_0x39d5ba,'fileName':_0x27ac52['originalname'][_0x2942f0(0x19d)]('/','-'),'mimetype':_0x27ac52['mimetype'],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x11da2a=_0x2942f0(0x191);else _0x4b9e6d==='application'?(_0x49c234={'document':fs_1[_0x2942f0(0x1a4)]['readFileSync'](_0x38c49d),'caption':_0x39d5ba,'fileName':_0x27ac52[_0x2942f0(0x19e)][_0x2942f0(0x19d)]('/','-'),'mimetype':_0x27ac52['mimetype'],'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x11da2a=_0x2942f0(0x1a7)):(_0x49c234={'image':fs_1[_0x2942f0(0x1a4)][_0x2942f0(0x1b3)](_0x38c49d),'caption':_0x39d5ba,'contextInfo':{'forwardingScore':isForwarded?0x2:0x0,'isForwarded':isForwarded}},_0x11da2a=_0x2942f0(0x1a7));}}if(_0x227a31){const _0x4cf9f7={'wid':'PVT'+_0x21f7f0+_0x2b3194['id']+_0x36ac20['substring'](0x0,0x6),'ticketId':_0x2b3194['id'],'contactId':undefined,'body':_0x39d5ba,'fromMe':!![],'mediaUrl':_0x27ac52[_0x2942f0(0x1b6)],'mediaType':_0x27ac52[_0x2942f0(0x1c9)][_0x2942f0(0x195)]('/')[0x0],'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':null,'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':_0x227a31};await(0x0,CreateMessageService_1[_0x2942f0(0x1a4)])({'messageData':_0x4cf9f7,'companyId':_0x2b3194[_0x2942f0(0x1bf)]});return;}const _0x13468f=await Contact_1['default'][_0x2942f0(0x1b2)](_0x2b3194['contactId']);let _0x5073b6;_0x13468f[_0x2942f0(0x1c4)]&&_0x13468f['remoteJid']!==''&&_0x13468f[_0x2942f0(0x1c4)][_0x2942f0(0x1b7)]('@')?_0x5073b6=_0x13468f['remoteJid']:_0x5073b6=_0x13468f['number']+'@'+(_0x2b3194[_0x2942f0(0x1c3)]?_0x2942f0(0x1a0):'s.whatsapp.net');const _0x3db090=await _0x4b58ec[_0x2942f0(0x18e)](_0x5073b6,{..._0x49c234});return await _0x2b3194['update']({'lastMessage':_0x36ac20!==_0x27ac52[_0x2942f0(0x1b6)]?_0x36ac20:_0x39d5ba,'imported':null}),_0x3db090;}catch(_0x24b321){Sentry['captureException'](_0x24b321),console[_0x2942f0(0x1a6)](_0x24b321);throw new AppError_1[(_0x2942f0(0x1a4))](_0x2942f0(0x1ab));}};exports['default']=SendWhatsAppMedia;