'use strict';const a387_0x462394=a387_0x6fa7;(function(_0x407a51,_0x4fe0a9){const _0x4f2399=a387_0x6fa7,_0x18e8b8=_0x407a51();while(!![]){try{const _0x2290fa=-parseInt(_0x4f2399(0x104))/0x1*(parseInt(_0x4f2399(0x100))/0x2)+-parseInt(_0x4f2399(0xfd))/0x3*(parseInt(_0x4f2399(0x103))/0x4)+-parseInt(_0x4f2399(0xfb))/0x5+parseInt(_0x4f2399(0xf6))/0x6+-parseInt(_0x4f2399(0xf4))/0x7+-parseInt(_0x4f2399(0xfa))/0x8+parseInt(_0x4f2399(0x106))/0x9;if(_0x2290fa===_0x4fe0a9)break;else _0x18e8b8['push'](_0x18e8b8['shift']());}catch(_0x9dbcf3){_0x18e8b8['push'](_0x18e8b8['shift']());}}}(a387_0x5b88,0xacd8b));function a387_0x5b88(){const _0x4012e0=['1JDkyVz','name','37862748TuWwss','sender','chat','findAll','default','../../models/ChatUser','../../models/ChatMessage','553672QZSbOK','__importDefault','5825856vwSnYC','defineProperty','../../models/Chat','userId','9205416QStOqO','5586295bYmMCU','findByPk','8769uoAwYh','reload','update','1767170KnfZwY','__esModule','create','1696VDhlfu'];a387_0x5b88=function(){return _0x4012e0;};return a387_0x5b88();}var __importDefault=this&&this[a387_0x462394(0xf5)]||function(_0x9bf27b){const _0x403672=a387_0x462394;return _0x9bf27b&&_0x9bf27b[_0x403672(0x101)]?_0x9bf27b:{'default':_0x9bf27b};};Object[a387_0x462394(0xf7)](exports,a387_0x462394(0x101),{'value':!![]});const Chat_1=__importDefault(require(a387_0x462394(0xf8))),ChatMessage_1=__importDefault(require(a387_0x462394(0xf3))),ChatUser_1=__importDefault(require(a387_0x462394(0xf2))),User_1=__importDefault(require('../../models/User'));function a387_0x6fa7(_0x4c7853,_0x64a108){const _0x5b8810=a387_0x5b88();return a387_0x6fa7=function(_0x6fa7a3,_0x3d0369){_0x6fa7a3=_0x6fa7a3-0xf2;let _0x5adec1=_0x5b8810[_0x6fa7a3];return _0x5adec1;},a387_0x6fa7(_0x4c7853,_0x64a108);}async function CreateMessageService({senderId:_0x13b137,chatId:_0x3e16f5,message:_0x41443d}){const _0x376bb1=a387_0x462394,_0x11c8fa=await ChatMessage_1[_0x376bb1(0x10a)][_0x376bb1(0x102)]({'senderId':_0x13b137,'chatId':_0x3e16f5,'message':_0x41443d});await _0x11c8fa[_0x376bb1(0xfe)]({'include':[{'model':User_1['default'],'as':_0x376bb1(0x107),'attributes':['id',_0x376bb1(0x105)]},{'model':Chat_1['default'],'as':'chat','include':[{'model':ChatUser_1['default'],'as':'users'}]}]});const _0x1f498b=await User_1['default'][_0x376bb1(0xfc)](_0x13b137);await _0x11c8fa[_0x376bb1(0x108)][_0x376bb1(0xff)]({'lastMessage':_0x1f498b['name']+':\x20'+_0x41443d});const _0x1756ce=await ChatUser_1[_0x376bb1(0x10a)][_0x376bb1(0x109)]({'where':{'chatId':_0x3e16f5}});for(let _0x57c85d of _0x1756ce){_0x57c85d[_0x376bb1(0xf9)]===_0x13b137?await _0x57c85d[_0x376bb1(0xff)]({'unreads':0x0}):await _0x57c85d[_0x376bb1(0xff)]({'unreads':_0x57c85d['unreads']+0x1});}return _0x11c8fa;}exports[a387_0x462394(0x10a)]=CreateMessageService;