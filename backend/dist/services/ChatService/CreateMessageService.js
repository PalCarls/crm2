'use strict';const a387_0x1d5fd9=a387_0x566d;function a387_0x679c(){const _0x378f98=['create','name','7000110aIdWax','11LcokvB','update','20RoOyuw','__esModule','../../models/ChatMessage','reload','44316PfcnJl','3GVoCse','44032284waxNki','chat','users','../../models/Chat','default','findByPk','5WMmXbj','595tTqfEF','45992RZGeyj','sender','findAll','3463356mwrIsk','883384iScszE','unreads','2070280enUIwX'];a387_0x679c=function(){return _0x378f98;};return a387_0x679c();}(function(_0x6c85e1,_0x252c07){const _0x53b08d=a387_0x566d,_0x410fe9=_0x6c85e1();while(!![]){try{const _0x1b4710=-parseInt(_0x53b08d(0x19b))/0x1+parseInt(_0x53b08d(0x1a7))/0x2*(-parseInt(_0x53b08d(0x1a8))/0x3)+-parseInt(_0x53b08d(0x19d))/0x4+-parseInt(_0x53b08d(0x195))/0x5*(-parseInt(_0x53b08d(0x19a))/0x6)+-parseInt(_0x53b08d(0x196))/0x7*(parseInt(_0x53b08d(0x197))/0x8)+-parseInt(_0x53b08d(0x1a0))/0x9*(parseInt(_0x53b08d(0x1a3))/0xa)+-parseInt(_0x53b08d(0x1a1))/0xb*(-parseInt(_0x53b08d(0x1a9))/0xc);if(_0x1b4710===_0x252c07)break;else _0x410fe9['push'](_0x410fe9['shift']());}catch(_0x2b7184){_0x410fe9['push'](_0x410fe9['shift']());}}}(a387_0x679c,0xbe3da));function a387_0x566d(_0x1b61b0,_0x425691){const _0x679c8d=a387_0x679c();return a387_0x566d=function(_0x566df5,_0x31a431){_0x566df5=_0x566df5-0x191;let _0x53a183=_0x679c8d[_0x566df5];return _0x53a183;},a387_0x566d(_0x1b61b0,_0x425691);}var __importDefault=this&&this['__importDefault']||function(_0x334563){return _0x334563&&_0x334563['__esModule']?_0x334563:{'default':_0x334563};};Object['defineProperty'](exports,a387_0x1d5fd9(0x1a4),{'value':!![]});const Chat_1=__importDefault(require(a387_0x1d5fd9(0x192))),ChatMessage_1=__importDefault(require(a387_0x1d5fd9(0x1a5))),ChatUser_1=__importDefault(require('../../models/ChatUser')),User_1=__importDefault(require('../../models/User'));async function CreateMessageService({senderId:_0x525044,chatId:_0x176a2a,message:_0xe3077e}){const _0x58601d=a387_0x1d5fd9,_0x53faac=await ChatMessage_1[_0x58601d(0x193)][_0x58601d(0x19e)]({'senderId':_0x525044,'chatId':_0x176a2a,'message':_0xe3077e});await _0x53faac[_0x58601d(0x1a6)]({'include':[{'model':User_1['default'],'as':_0x58601d(0x198),'attributes':['id',_0x58601d(0x19f)]},{'model':Chat_1[_0x58601d(0x193)],'as':_0x58601d(0x1aa),'include':[{'model':ChatUser_1[_0x58601d(0x193)],'as':_0x58601d(0x191)}]}]});const _0x5054ee=await User_1[_0x58601d(0x193)][_0x58601d(0x194)](_0x525044);await _0x53faac[_0x58601d(0x1aa)][_0x58601d(0x1a2)]({'lastMessage':_0x5054ee['name']+':\x20'+_0xe3077e});const _0x2ac13e=await ChatUser_1[_0x58601d(0x193)][_0x58601d(0x199)]({'where':{'chatId':_0x176a2a}});for(let _0xdc9b52 of _0x2ac13e){_0xdc9b52['userId']===_0x525044?await _0xdc9b52['update']({'unreads':0x0}):await _0xdc9b52['update']({'unreads':_0xdc9b52[_0x58601d(0x19c)]+0x1});}return _0x53faac;}exports['default']=CreateMessageService;