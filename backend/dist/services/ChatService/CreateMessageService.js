'use strict';const a359_0x2184ee=a359_0x52e9;(function(_0x2971d6,_0x32c807){const _0x2a8264=a359_0x52e9,_0x59bbbc=_0x2971d6();while(!![]){try{const _0x49e1f3=parseInt(_0x2a8264(0x137))/0x1+-parseInt(_0x2a8264(0x134))/0x2+-parseInt(_0x2a8264(0x138))/0x3+parseInt(_0x2a8264(0x130))/0x4+parseInt(_0x2a8264(0x131))/0x5+parseInt(_0x2a8264(0x132))/0x6+-parseInt(_0x2a8264(0x12d))/0x7*(parseInt(_0x2a8264(0x13a))/0x8);if(_0x49e1f3===_0x32c807)break;else _0x59bbbc['push'](_0x59bbbc['shift']());}catch(_0x479726){_0x59bbbc['push'](_0x59bbbc['shift']());}}}(a359_0x35dd,0x5dda7));function a359_0x52e9(_0x166155,_0x592bd2){const _0x35ddf8=a359_0x35dd();return a359_0x52e9=function(_0x52e997,_0x22f9e5){_0x52e997=_0x52e997-0x127;let _0x319a61=_0x35ddf8[_0x52e997];return _0x319a61;},a359_0x52e9(_0x166155,_0x592bd2);}var __importDefault=this&&this[a359_0x2184ee(0x128)]||function(_0x43eaa6){return _0x43eaa6&&_0x43eaa6['__esModule']?_0x43eaa6:{'default':_0x43eaa6};};Object[a359_0x2184ee(0x12f)](exports,'__esModule',{'value':!![]});const Chat_1=__importDefault(require(a359_0x2184ee(0x133))),ChatMessage_1=__importDefault(require('../../models/ChatMessage')),ChatUser_1=__importDefault(require(a359_0x2184ee(0x12e))),User_1=__importDefault(require(a359_0x2184ee(0x135)));function a359_0x35dd(){const _0x50f5ba=['defineProperty','1907852UtcuiF','2060815RCGYXW','1200486WxfBLh','../../models/Chat','930868nIpShI','../../models/User','default','185973vPMRwx','1117167ADZERK','chat','1592jsnuAe','sender','findByPk','__importDefault','unreads','update','name','create','1862VwaDeE','../../models/ChatUser'];a359_0x35dd=function(){return _0x50f5ba;};return a359_0x35dd();}async function CreateMessageService({senderId:_0x1cde86,chatId:_0xf00b86,message:_0x499bf9}){const _0x8d1f0c=a359_0x2184ee,_0x4fdc92=await ChatMessage_1[_0x8d1f0c(0x136)][_0x8d1f0c(0x12c)]({'senderId':_0x1cde86,'chatId':_0xf00b86,'message':_0x499bf9});await _0x4fdc92['reload']({'include':[{'model':User_1[_0x8d1f0c(0x136)],'as':_0x8d1f0c(0x13b),'attributes':['id',_0x8d1f0c(0x12b)]},{'model':Chat_1[_0x8d1f0c(0x136)],'as':_0x8d1f0c(0x139),'include':[{'model':ChatUser_1[_0x8d1f0c(0x136)],'as':'users'}]}]});const _0x1d82bd=await User_1[_0x8d1f0c(0x136)][_0x8d1f0c(0x127)](_0x1cde86);await _0x4fdc92['chat'][_0x8d1f0c(0x12a)]({'lastMessage':_0x1d82bd[_0x8d1f0c(0x12b)]+':\x20'+_0x499bf9});const _0x352d23=await ChatUser_1[_0x8d1f0c(0x136)]['findAll']({'where':{'chatId':_0xf00b86}});for(let _0x3f6e62 of _0x352d23){_0x3f6e62['userId']===_0x1cde86?await _0x3f6e62[_0x8d1f0c(0x12a)]({'unreads':0x0}):await _0x3f6e62[_0x8d1f0c(0x12a)]({'unreads':_0x3f6e62[_0x8d1f0c(0x129)]+0x1});}return _0x4fdc92;}exports[a359_0x2184ee(0x136)]=CreateMessageService;