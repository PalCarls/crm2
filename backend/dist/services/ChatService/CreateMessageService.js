'use strict';function a344_0x5ccd(){const _0x205934=['create','unreads','sender','../../models/ChatMessage','users','default','findByPk','7873190xwdShe','defineProperty','5FwZACs','chat','../../models/ChatUser','../../models/User','111056HXFNqT','update','11VTEfaF','findAll','13748nlGBuD','reload','48ybUXxc','182ZRGjFl','userId','1524846mTOTfN','744273IYnGgo','229298jdBHwd','../../models/Chat','__esModule','name','312270DfpgOh'];a344_0x5ccd=function(){return _0x205934;};return a344_0x5ccd();}const a344_0x576b38=a344_0x1370;(function(_0x6d45f4,_0x43c282){const _0x495fff=a344_0x1370,_0x19e332=_0x6d45f4();while(!![]){try{const _0x3a486a=-parseInt(_0x495fff(0x120))/0x1+parseInt(_0x495fff(0x11c))/0x2+parseInt(_0x495fff(0x134))/0x3*(parseInt(_0x495fff(0x132))/0x4)+parseInt(_0x495fff(0x12a))/0x5*(parseInt(_0x495fff(0x11a))/0x6)+parseInt(_0x495fff(0x135))/0x7*(-parseInt(_0x495fff(0x12e))/0x8)+-parseInt(_0x495fff(0x11b))/0x9+-parseInt(_0x495fff(0x128))/0xa*(-parseInt(_0x495fff(0x130))/0xb);if(_0x3a486a===_0x43c282)break;else _0x19e332['push'](_0x19e332['shift']());}catch(_0x4725aa){_0x19e332['push'](_0x19e332['shift']());}}}(a344_0x5ccd,0x6f222));function a344_0x1370(_0x4bc45d,_0x27ca02){const _0x5ccd30=a344_0x5ccd();return a344_0x1370=function(_0x13701f,_0x2cbbfb){_0x13701f=_0x13701f-0x11a;let _0x4e2c6b=_0x5ccd30[_0x13701f];return _0x4e2c6b;},a344_0x1370(_0x4bc45d,_0x27ca02);}var __importDefault=this&&this['__importDefault']||function(_0x4ef3fb){const _0x5a9133=a344_0x1370;return _0x4ef3fb&&_0x4ef3fb[_0x5a9133(0x11e)]?_0x4ef3fb:{'default':_0x4ef3fb};};Object[a344_0x576b38(0x129)](exports,'__esModule',{'value':!![]});const Chat_1=__importDefault(require(a344_0x576b38(0x11d))),ChatMessage_1=__importDefault(require(a344_0x576b38(0x124))),ChatUser_1=__importDefault(require(a344_0x576b38(0x12c))),User_1=__importDefault(require(a344_0x576b38(0x12d)));async function CreateMessageService({senderId:_0x3b63b7,chatId:_0x4035b2,message:_0x3b8f8c}){const _0x109f78=a344_0x576b38,_0x4db6e8=await ChatMessage_1[_0x109f78(0x126)][_0x109f78(0x121)]({'senderId':_0x3b63b7,'chatId':_0x4035b2,'message':_0x3b8f8c});await _0x4db6e8[_0x109f78(0x133)]({'include':[{'model':User_1[_0x109f78(0x126)],'as':_0x109f78(0x123),'attributes':['id',_0x109f78(0x11f)]},{'model':Chat_1[_0x109f78(0x126)],'as':_0x109f78(0x12b),'include':[{'model':ChatUser_1[_0x109f78(0x126)],'as':_0x109f78(0x125)}]}]});const _0x518517=await User_1['default'][_0x109f78(0x127)](_0x3b63b7);await _0x4db6e8[_0x109f78(0x12b)][_0x109f78(0x12f)]({'lastMessage':_0x518517[_0x109f78(0x11f)]+':\x20'+_0x3b8f8c});const _0x2c3b63=await ChatUser_1[_0x109f78(0x126)][_0x109f78(0x131)]({'where':{'chatId':_0x4035b2}});for(let _0x5afc25 of _0x2c3b63){_0x5afc25[_0x109f78(0x136)]===_0x3b63b7?await _0x5afc25[_0x109f78(0x12f)]({'unreads':0x0}):await _0x5afc25['update']({'unreads':_0x5afc25[_0x109f78(0x122)]+0x1});}return _0x4db6e8;}exports[a344_0x576b38(0x126)]=CreateMessageService;