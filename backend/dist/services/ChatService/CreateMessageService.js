'use strict';const a409_0x5a2c00=a409_0x5796;(function(_0x29d08d,_0x539036){const _0x1b49c6=a409_0x5796,_0x3d0a5b=_0x29d08d();while(!![]){try{const _0x4656b8=-parseInt(_0x1b49c6(0x1ff))/0x1+parseInt(_0x1b49c6(0x1f9))/0x2+-parseInt(_0x1b49c6(0x1f7))/0x3+parseInt(_0x1b49c6(0x209))/0x4+-parseInt(_0x1b49c6(0x1fe))/0x5+parseInt(_0x1b49c6(0x202))/0x6*(-parseInt(_0x1b49c6(0x1fb))/0x7)+parseInt(_0x1b49c6(0x1f6))/0x8*(parseInt(_0x1b49c6(0x1f8))/0x9);if(_0x4656b8===_0x539036)break;else _0x3d0a5b['push'](_0x3d0a5b['shift']());}catch(_0x2ef1df){_0x3d0a5b['push'](_0x3d0a5b['shift']());}}}(a409_0x6c44,0xa378d));function a409_0x6c44(){const _0x461861=['findByPk','reload','chat','name','../../models/ChatMessage','3769500RFueIj','defineProperty','__esModule','../../models/Chat','104oOYLwA','2771805jQzlfh','1610181nzSgvE','1453908mFsUFw','../../models/User','76027nBvvoo','unreads','__importDefault','4315650GDAwqE','767369qOcEIa','sender','update','426afhSjM','default'];a409_0x6c44=function(){return _0x461861;};return a409_0x6c44();}var __importDefault=this&&this[a409_0x5a2c00(0x1fd)]||function(_0x1f7921){const _0x4b2233=a409_0x5a2c00;return _0x1f7921&&_0x1f7921[_0x4b2233(0x1f4)]?_0x1f7921:{'default':_0x1f7921};};Object[a409_0x5a2c00(0x20a)](exports,a409_0x5a2c00(0x1f4),{'value':!![]});const Chat_1=__importDefault(require(a409_0x5a2c00(0x1f5))),ChatMessage_1=__importDefault(require(a409_0x5a2c00(0x208))),ChatUser_1=__importDefault(require('../../models/ChatUser')),User_1=__importDefault(require(a409_0x5a2c00(0x1fa)));function a409_0x5796(_0x19e4a7,_0x350a32){const _0x6c4492=a409_0x6c44();return a409_0x5796=function(_0x57968a,_0x4bea80){_0x57968a=_0x57968a-0x1f4;let _0x11f169=_0x6c4492[_0x57968a];return _0x11f169;},a409_0x5796(_0x19e4a7,_0x350a32);}async function CreateMessageService({senderId:_0x43b434,chatId:_0x39a471,message:_0x3c4d79}){const _0x5f2b35=a409_0x5a2c00,_0x3976d0=await ChatMessage_1[_0x5f2b35(0x203)]['create']({'senderId':_0x43b434,'chatId':_0x39a471,'message':_0x3c4d79});await _0x3976d0[_0x5f2b35(0x205)]({'include':[{'model':User_1[_0x5f2b35(0x203)],'as':_0x5f2b35(0x200),'attributes':['id',_0x5f2b35(0x207)]},{'model':Chat_1['default'],'as':_0x5f2b35(0x206),'include':[{'model':ChatUser_1['default'],'as':'users'}]}]});const _0xbcc2fd=await User_1[_0x5f2b35(0x203)][_0x5f2b35(0x204)](_0x43b434);await _0x3976d0[_0x5f2b35(0x206)]['update']({'lastMessage':_0xbcc2fd[_0x5f2b35(0x207)]+':\x20'+_0x3c4d79});const _0xf420=await ChatUser_1[_0x5f2b35(0x203)]['findAll']({'where':{'chatId':_0x39a471}});for(let _0x3d3487 of _0xf420){_0x3d3487['userId']===_0x43b434?await _0x3d3487[_0x5f2b35(0x201)]({'unreads':0x0}):await _0x3d3487[_0x5f2b35(0x201)]({'unreads':_0x3d3487[_0x5f2b35(0x1fc)]+0x1});}return _0x3976d0;}exports[a409_0x5a2c00(0x203)]=CreateMessageService;