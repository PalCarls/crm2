'use strict';const a425_0xa54897=a425_0x2f74;(function(_0x107b9d,_0x3c7bd4){const _0x4674a9=a425_0x2f74,_0x21c775=_0x107b9d();while(!![]){try{const _0x2e03bf=-parseInt(_0x4674a9(0x1f1))/0x1+-parseInt(_0x4674a9(0x1ec))/0x2*(parseInt(_0x4674a9(0x1e9))/0x3)+-parseInt(_0x4674a9(0x1ea))/0x4+-parseInt(_0x4674a9(0x1f0))/0x5+-parseInt(_0x4674a9(0x1f2))/0x6+-parseInt(_0x4674a9(0x1e1))/0x7*(parseInt(_0x4674a9(0x1ed))/0x8)+parseInt(_0x4674a9(0x1e6))/0x9;if(_0x2e03bf===_0x3c7bd4)break;else _0x21c775['push'](_0x21c775['shift']());}catch(_0x290d68){_0x21c775['push'](_0x21c775['shift']());}}}(a425_0x3da8,0x594a3));var __importDefault=this&&this[a425_0xa54897(0x1e4)]||function(_0x1d2f0c){const _0x5001df=a425_0xa54897;return _0x1d2f0c&&_0x1d2f0c[_0x5001df(0x1ef)]?_0x1d2f0c:{'default':_0x1d2f0c};};function a425_0x2f74(_0x23696a,_0x4fee73){const _0x3da80e=a425_0x3da8();return a425_0x2f74=function(_0x2f74e9,_0x137a8f){_0x2f74e9=_0x2f74e9-0x1db;let _0xe55eea=_0x3da80e[_0x2f74e9];return _0xe55eea;},a425_0x2f74(_0x23696a,_0x4fee73);}Object['defineProperty'](exports,'__esModule',{'value':!![]});const Chat_1=__importDefault(require(a425_0xa54897(0x1db))),ChatMessage_1=__importDefault(require(a425_0xa54897(0x1e0))),ChatUser_1=__importDefault(require(a425_0xa54897(0x1df))),User_1=__importDefault(require(a425_0xa54897(0x1de)));function a425_0x3da8(){const _0x562c3b=['15294663sxQibN','reload','findByPk','3qZGgZd','1180408KhBkir','users','69382doEJtZ','359368ZyDDhs','default','__esModule','515690mLyCNb','344307bVfSvi','2799576vRgGDC','../../models/Chat','chat','name','../../models/User','../../models/ChatUser','../../models/ChatMessage','14oMqMkz','unreads','update','__importDefault','findAll'];a425_0x3da8=function(){return _0x562c3b;};return a425_0x3da8();}async function CreateMessageService({senderId:_0x497956,chatId:_0xdf54e3,message:_0x5de0da}){const _0x3542b4=a425_0xa54897,_0x50ec1e=await ChatMessage_1['default']['create']({'senderId':_0x497956,'chatId':_0xdf54e3,'message':_0x5de0da});await _0x50ec1e[_0x3542b4(0x1e7)]({'include':[{'model':User_1['default'],'as':'sender','attributes':['id',_0x3542b4(0x1dd)]},{'model':Chat_1['default'],'as':_0x3542b4(0x1dc),'include':[{'model':ChatUser_1[_0x3542b4(0x1ee)],'as':_0x3542b4(0x1eb)}]}]});const _0x4569e8=await User_1[_0x3542b4(0x1ee)][_0x3542b4(0x1e8)](_0x497956);await _0x50ec1e[_0x3542b4(0x1dc)]['update']({'lastMessage':_0x4569e8[_0x3542b4(0x1dd)]+':\x20'+_0x5de0da});const _0x5e7082=await ChatUser_1[_0x3542b4(0x1ee)][_0x3542b4(0x1e5)]({'where':{'chatId':_0xdf54e3}});for(let _0x13d141 of _0x5e7082){_0x13d141['userId']===_0x497956?await _0x13d141[_0x3542b4(0x1e3)]({'unreads':0x0}):await _0x13d141[_0x3542b4(0x1e3)]({'unreads':_0x13d141[_0x3542b4(0x1e2)]+0x1});}return _0x50ec1e;}exports[a425_0xa54897(0x1ee)]=CreateMessageService;