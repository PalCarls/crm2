'use strict';const a392_0x13ff54=a392_0x29dc;function a392_0x3650(){const _0x9101b=['1833692eGkUwO','name','update','46XcXWNc','2286290lOJFuK','default','5772680ZQKAhU','userId','create','defineProperty','../../models/ChatUser','132xItUpJ','users','chat','reload','__esModule','__importDefault','24958qnLvxJ','1601436UYXSpV','746829zDkCAu','60jhAeMr','unreads','191408wWvKXW'];a392_0x3650=function(){return _0x9101b;};return a392_0x3650();}(function(_0x44a532,_0x259463){const _0x27e738=a392_0x29dc,_0x383f8b=_0x44a532();while(!![]){try{const _0x96d85e=-parseInt(_0x27e738(0x148))/0x1*(parseInt(_0x27e738(0x151))/0x2)+parseInt(_0x27e738(0x149))/0x3+-parseInt(_0x27e738(0x14e))/0x4+parseInt(_0x27e738(0x13b))/0x5+-parseInt(_0x27e738(0x142))/0x6*(parseInt(_0x27e738(0x14d))/0x7)+parseInt(_0x27e738(0x13d))/0x8+parseInt(_0x27e738(0x14a))/0x9*(parseInt(_0x27e738(0x14b))/0xa);if(_0x96d85e===_0x259463)break;else _0x383f8b['push'](_0x383f8b['shift']());}catch(_0x4741e8){_0x383f8b['push'](_0x383f8b['shift']());}}}(a392_0x3650,0x8cc04));var __importDefault=this&&this[a392_0x13ff54(0x147)]||function(_0x56440f){const _0x50d71c=a392_0x13ff54;return _0x56440f&&_0x56440f[_0x50d71c(0x146)]?_0x56440f:{'default':_0x56440f};};Object[a392_0x13ff54(0x140)](exports,a392_0x13ff54(0x146),{'value':!![]});function a392_0x29dc(_0x5c8e33,_0xd9e2e0){const _0x36500d=a392_0x3650();return a392_0x29dc=function(_0x29dc52,_0x15921e){_0x29dc52=_0x29dc52-0x13b;let _0x323f47=_0x36500d[_0x29dc52];return _0x323f47;},a392_0x29dc(_0x5c8e33,_0xd9e2e0);}const Chat_1=__importDefault(require('../../models/Chat')),ChatMessage_1=__importDefault(require('../../models/ChatMessage')),ChatUser_1=__importDefault(require(a392_0x13ff54(0x141))),User_1=__importDefault(require('../../models/User'));async function CreateMessageService({senderId:_0x3ce129,chatId:_0x37217b,message:_0x46173b}){const _0x3153bc=a392_0x13ff54,_0x386f63=await ChatMessage_1[_0x3153bc(0x13c)][_0x3153bc(0x13f)]({'senderId':_0x3ce129,'chatId':_0x37217b,'message':_0x46173b});await _0x386f63[_0x3153bc(0x145)]({'include':[{'model':User_1[_0x3153bc(0x13c)],'as':'sender','attributes':['id',_0x3153bc(0x14f)]},{'model':Chat_1[_0x3153bc(0x13c)],'as':_0x3153bc(0x144),'include':[{'model':ChatUser_1['default'],'as':_0x3153bc(0x143)}]}]});const _0x2b8f10=await User_1[_0x3153bc(0x13c)]['findByPk'](_0x3ce129);await _0x386f63['chat'][_0x3153bc(0x150)]({'lastMessage':_0x2b8f10['name']+':\x20'+_0x46173b});const _0x3960b4=await ChatUser_1[_0x3153bc(0x13c)]['findAll']({'where':{'chatId':_0x37217b}});for(let _0x5dd039 of _0x3960b4){_0x5dd039[_0x3153bc(0x13e)]===_0x3ce129?await _0x5dd039[_0x3153bc(0x150)]({'unreads':0x0}):await _0x5dd039[_0x3153bc(0x150)]({'unreads':_0x5dd039[_0x3153bc(0x14c)]+0x1});}return _0x386f63;}exports['default']=CreateMessageService;