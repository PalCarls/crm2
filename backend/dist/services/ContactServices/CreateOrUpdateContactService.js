'use strict';const a459_0x53bf6c=a459_0x2ae3;function a459_0x2ae3(_0x4683c6,_0x194e31){const _0x2e87c7=a459_0x2e87();return a459_0x2ae3=function(_0x2ae378,_0x1348d8){_0x2ae378=_0x2ae378-0xaf;let _0x3b6c7e=_0x2e87c7[_0x2ae378];return _0x3b6c7e;},a459_0x2ae3(_0x4683c6,_0x194e31);}(function(_0x2e385e,_0x4ce76b){const _0x379646=a459_0x2ae3,_0x4b7f8b=_0x2e385e();while(!![]){try{const _0x515aad=-parseInt(_0x379646(0xc6))/0x1*(parseInt(_0x379646(0xbc))/0x2)+parseInt(_0x379646(0xe1))/0x3+-parseInt(_0x379646(0xd8))/0x4*(parseInt(_0x379646(0xd6))/0x5)+parseInt(_0x379646(0xc7))/0x6+-parseInt(_0x379646(0xde))/0x7*(parseInt(_0x379646(0xdc))/0x8)+-parseInt(_0x379646(0xb4))/0x9+parseInt(_0x379646(0xd7))/0xa;if(_0x515aad===_0x4ce76b)break;else _0x4b7f8b['push'](_0x4b7f8b['shift']());}catch(_0x365d6e){_0x4b7f8b['push'](_0x4b7f8b['shift']());}}}(a459_0x2e87,0xbf3c8));var __createBinding=this&&this[a459_0x53bf6c(0xc8)]||(Object[a459_0x53bf6c(0xcb)]?function(_0x36688b,_0x304ac8,_0x23264b,_0x2887ab){const _0x157102=a459_0x53bf6c;if(_0x2887ab===undefined)_0x2887ab=_0x23264b;var _0x244db1=Object[_0x157102(0xe6)](_0x304ac8,_0x23264b);(!_0x244db1||('get'in _0x244db1?!_0x304ac8[_0x157102(0xc3)]:_0x244db1[_0x157102(0xe0)]||_0x244db1[_0x157102(0xce)]))&&(_0x244db1={'enumerable':!![],'get':function(){return _0x304ac8[_0x23264b];}}),Object[_0x157102(0xbe)](_0x36688b,_0x2887ab,_0x244db1);}:function(_0x1e98c4,_0x34cf51,_0x4579c1,_0x194465){if(_0x194465===undefined)_0x194465=_0x4579c1;_0x1e98c4[_0x194465]=_0x34cf51[_0x4579c1];}),__setModuleDefault=this&&this[a459_0x53bf6c(0xd3)]||(Object[a459_0x53bf6c(0xcb)]?function(_0x38020d,_0x442864){const _0x21bd9c=a459_0x53bf6c;Object[_0x21bd9c(0xbe)](_0x38020d,'default',{'enumerable':!![],'value':_0x442864});}:function(_0xbcf72a,_0x265ae5){const _0x1b45bf=a459_0x53bf6c;_0xbcf72a[_0x1b45bf(0xdb)]=_0x265ae5;}),__importStar=this&&this[a459_0x53bf6c(0xb6)]||function(_0x5b1c4e){const _0x54d7c9=a459_0x53bf6c;if(_0x5b1c4e&&_0x5b1c4e['__esModule'])return _0x5b1c4e;var _0x439151={};if(_0x5b1c4e!=null){for(var _0x3efa87 in _0x5b1c4e)if(_0x3efa87!==_0x54d7c9(0xdb)&&Object[_0x54d7c9(0xc2)]['hasOwnProperty'][_0x54d7c9(0xd1)](_0x5b1c4e,_0x3efa87))__createBinding(_0x439151,_0x5b1c4e,_0x3efa87);}return __setModuleDefault(_0x439151,_0x5b1c4e),_0x439151;},__importDefault=this&&this[a459_0x53bf6c(0xba)]||function(_0x45b82c){const _0x1aeac9=a459_0x53bf6c;return _0x45b82c&&_0x45b82c[_0x1aeac9(0xc3)]?_0x45b82c:{'default':_0x45b82c};};Object[a459_0x53bf6c(0xbe)](exports,a459_0x53bf6c(0xc3),{'value':!![]});function a459_0x2e87(){const _0x33057f=['reload','writable','2558712MyhlNa','resolve','logger','lodash','save','getOwnPropertyDescriptor','nopicture','../../libs/socket','emit','data','whatsapp','5471856cRrUmE','remoteJid','__importStar','-contact','company-','includes','__importDefault','arraybuffer','2108eKLcaq','existsSync','defineProperty','getIO','../../models/CompaniesSettings','contacts','prototype','__esModule','join','urlPicture','167lOkEHq','9081012MootKT','__createBinding','name','profilePicUrl','create','update','getTime','configurable','company','get','call','public','__setModuleDefault','isNil','mkdirSync','5qfiJOC','2603640ihxGMX','1064572XfklbN','axios','nopicture.png','default','204728bFYcVU','replace','217FhCPxu'];a459_0x2e87=function(){return _0x33057f;};return a459_0x2e87();}const socket_1=require(a459_0x53bf6c(0xb0)),CompaniesSettings_1=__importDefault(require(a459_0x53bf6c(0xc0))),Contact_1=__importDefault(require('../../models/Contact')),fs_1=__importDefault(require('fs')),path_1=__importStar(require('path')),logger_1=require('../../utils/logger'),lodash_1=require(a459_0x53bf6c(0xe4)),axios=require(a459_0x53bf6c(0xd9)),CreateOrUpdateContactService=async({name:_0x2410d5,number:_0x3460dc,profilePicUrl:_0x43db3b,isGroup:_0x9fb888,email:email='',channel:channel=a459_0x53bf6c(0xb3),companyId:_0x2f9000,extraInfo:extraInfo=[],remoteJid:remoteJid=''})=>{const _0x183372=a459_0x53bf6c;try{let _0x3e5181=![];const _0x12bb73=path_1[_0x183372(0xdb)][_0x183372(0xe2)](__dirname,'..','..','..',_0x183372(0xd2)),_0xc6e8c8=_0x9fb888?_0x3460dc:_0x3460dc[_0x183372(0xdd)](/[^0-9]/g,''),_0x4ff9f2=(0x0,socket_1[_0x183372(0xbf)])();let _0x5478e5;_0x5478e5=await Contact_1[_0x183372(0xdb)]['findOne']({'where':{'number':_0xc6e8c8,'companyId':_0x2f9000}});const _0x3e370d=_0x5478e5?.['profilePicUrl']!==_0x43db3b&&_0x43db3b!==''||![];if(_0x5478e5)_0x5478e5[_0x183372(0xb5)]=remoteJid,_0x5478e5[_0x183372(0xca)]=_0x43db3b||null,(_0x9fb888||_0x5478e5[_0x183372(0xc9)]===_0xc6e8c8)&&(_0x5478e5[_0x183372(0xc9)]=_0x2410d5),await _0x5478e5[_0x183372(0xe5)](),await _0x5478e5[_0x183372(0xdf)]();else{const _0x5ca270=await CompaniesSettings_1[_0x183372(0xdb)]['findOne']({'where':{'companyId':_0x2f9000}}),{acceptAudioMessageContact:_0x3950c1}=_0x5ca270;_0x5478e5=await Contact_1[_0x183372(0xdb)][_0x183372(0xcb)]({'name':_0x2410d5,'number':_0xc6e8c8,'email':email,'isGroup':_0x9fb888,'extraInfo':extraInfo,'companyId':_0x2f9000,'channel':channel,'acceptAudioMessage':_0x3950c1==='enabled'?!![]:![],'remoteJid':remoteJid,'urlPicture':_0x43db3b}),_0x3e5181=!![];}if(_0x3e370d&&channel===_0x183372(0xb3)){const _0x3c1acc=path_1[_0x183372(0xdb)]['resolve'](_0x12bb73,_0x183372(0xcf)+_0x2f9000,_0x183372(0xc1));!fs_1['default']['existsSync'](_0x3c1acc)&&(fs_1['default'][_0x183372(0xd5)](_0x3c1acc,{'recursive':!![]}),fs_1[_0x183372(0xdb)]['chmodSync'](_0x3c1acc,0x1ff));let _0x528e6f;if(!(0x0,lodash_1[_0x183372(0xd4)])(_0x43db3b)&&_0x43db3b[_0x183372(0xb9)](_0x183372(0xaf)))_0x528e6f=_0x183372(0xda);else{if(!(0x0,lodash_1[_0x183372(0xd4)])(_0x5478e5[_0x183372(0xc5)])){const _0x390416=path_1[_0x183372(0xdb)]['resolve'](_0x5478e5['urlPicture']);fs_1[_0x183372(0xdb)][_0x183372(0xbd)](_0x390416)&&fs_1[_0x183372(0xdb)]['unlinkSync'](_0x390416);}const _0x5c4d21=await axios[_0x183372(0xd0)](_0x43db3b,{'responseType':_0x183372(0xbb)});_0x528e6f=''+_0x5478e5['id']+new Date()[_0x183372(0xcd)]()+'.jpeg',fs_1['default']['writeFileSync']((0x0,path_1[_0x183372(0xc4)])(_0x3c1acc,_0x528e6f),_0x5c4d21[_0x183372(0xb2)]);}await _0x5478e5[_0x183372(0xcc)]({'urlPicture':_0x528e6f,'pictureUpdated':!![]}),await _0x5478e5[_0x183372(0xdf)]();}return _0x3e5181?_0x4ff9f2[_0x183372(0xb1)]('company-'+_0x2f9000+_0x183372(0xb7),{'action':_0x183372(0xcb),'contact':_0x5478e5}):_0x4ff9f2[_0x183372(0xb1)](_0x183372(0xb8)+_0x2f9000+_0x183372(0xb7),{'action':_0x183372(0xcc),'contact':_0x5478e5}),_0x5478e5;}catch(_0x35c7b4){logger_1[_0x183372(0xe3)]['error']('Error\x20to\x20find\x20or\x20create\x20a\x20contact:',_0x35c7b4);throw _0x35c7b4;}};exports[a459_0x53bf6c(0xdb)]=CreateOrUpdateContactService;