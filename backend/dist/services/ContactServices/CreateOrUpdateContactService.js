'use strict';const a459_0x46baaa=a459_0x3e96;(function(_0x40cdac,_0x4b5720){const _0x5a1fba=a459_0x3e96,_0x575686=_0x40cdac();while(!![]){try{const _0x429de5=-parseInt(_0x5a1fba(0x11f))/0x1*(parseInt(_0x5a1fba(0x135))/0x2)+-parseInt(_0x5a1fba(0x106))/0x3+parseInt(_0x5a1fba(0x136))/0x4+parseInt(_0x5a1fba(0x12b))/0x5+-parseInt(_0x5a1fba(0x110))/0x6+-parseInt(_0x5a1fba(0x129))/0x7+parseInt(_0x5a1fba(0x11c))/0x8*(parseInt(_0x5a1fba(0x10e))/0x9);if(_0x429de5===_0x4b5720)break;else _0x575686['push'](_0x575686['shift']());}catch(_0x96591c){_0x575686['push'](_0x575686['shift']());}}}(a459_0xd6ca,0x1a3b8));function a459_0x3e96(_0x55fb8d,_0x4faaef){const _0xd6cafa=a459_0xd6ca();return a459_0x3e96=function(_0x3e96e3,_0x5ccef2){_0x3e96e3=_0x3e96e3-0x103;let _0x456c82=_0xd6cafa[_0x3e96e3];return _0x456c82;},a459_0x3e96(_0x55fb8d,_0x4faaef);}var __createBinding=this&&this[a459_0x46baaa(0x127)]||(Object[a459_0x46baaa(0x112)]?function(_0x3ca840,_0x76653a,_0x58ff37,_0x3b9e1c){const _0x19d3bf=a459_0x46baaa;if(_0x3b9e1c===undefined)_0x3b9e1c=_0x58ff37;var _0x4a7f4b=Object[_0x19d3bf(0x138)](_0x76653a,_0x58ff37);(!_0x4a7f4b||(_0x19d3bf(0x12a)in _0x4a7f4b?!_0x76653a[_0x19d3bf(0x104)]:_0x4a7f4b['writable']||_0x4a7f4b['configurable']))&&(_0x4a7f4b={'enumerable':!![],'get':function(){return _0x76653a[_0x58ff37];}}),Object[_0x19d3bf(0x123)](_0x3ca840,_0x3b9e1c,_0x4a7f4b);}:function(_0x2baf9c,_0x396e12,_0x1dad79,_0x129ce1){if(_0x129ce1===undefined)_0x129ce1=_0x1dad79;_0x2baf9c[_0x129ce1]=_0x396e12[_0x1dad79];}),__setModuleDefault=this&&this[a459_0x46baaa(0x132)]||(Object[a459_0x46baaa(0x112)]?function(_0x5f2ffa,_0x3eda46){const _0x2f1d1e=a459_0x46baaa;Object['defineProperty'](_0x5f2ffa,_0x2f1d1e(0x125),{'enumerable':!![],'value':_0x3eda46});}:function(_0x586947,_0x2d1800){const _0x4bb011=a459_0x46baaa;_0x586947[_0x4bb011(0x125)]=_0x2d1800;}),__importStar=this&&this['__importStar']||function(_0x35c8a5){const _0x30f48d=a459_0x46baaa;if(_0x35c8a5&&_0x35c8a5[_0x30f48d(0x104)])return _0x35c8a5;var _0x2c4a4e={};if(_0x35c8a5!=null){for(var _0x4fe727 in _0x35c8a5)if(_0x4fe727!==_0x30f48d(0x125)&&Object[_0x30f48d(0x131)][_0x30f48d(0x11d)][_0x30f48d(0x139)](_0x35c8a5,_0x4fe727))__createBinding(_0x2c4a4e,_0x35c8a5,_0x4fe727);}return __setModuleDefault(_0x2c4a4e,_0x35c8a5),_0x2c4a4e;},__importDefault=this&&this[a459_0x46baaa(0x105)]||function(_0x5ce7df){return _0x5ce7df&&_0x5ce7df['__esModule']?_0x5ce7df:{'default':_0x5ce7df};};Object[a459_0x46baaa(0x123)](exports,'__esModule',{'value':!![]});const socket_1=require(a459_0x46baaa(0x10c)),CompaniesSettings_1=__importDefault(require('../../models/CompaniesSettings')),Contact_1=__importDefault(require(a459_0x46baaa(0x10d))),fs_1=__importDefault(require('fs')),path_1=__importStar(require(a459_0x46baaa(0x133))),logger_1=require('../../utils/logger'),lodash_1=require('lodash'),axios=require(a459_0x46baaa(0x126)),CreateOrUpdateContactService=async({name:_0x290d44,number:_0x30b028,profilePicUrl:_0x1d1a2f,isGroup:_0x17c3ec,email:email='',channel:channel=a459_0x46baaa(0x12c),companyId:_0x2286d2,extraInfo:extraInfo=[],remoteJid:remoteJid=''})=>{const _0x2e1543=a459_0x46baaa;try{let _0x4242d4=![];const _0x967e59=path_1[_0x2e1543(0x125)][_0x2e1543(0x10b)](__dirname,'..','..','..',_0x2e1543(0x111)),_0x157c88=_0x17c3ec?_0x30b028:_0x30b028[_0x2e1543(0x134)](/[^0-9]/g,''),_0x29dd5d=(0x0,socket_1[_0x2e1543(0x10f)])();let _0x292351;_0x292351=await Contact_1['default']['findOne']({'where':{'number':_0x157c88,'companyId':_0x2286d2}});(0x0,lodash_1[_0x2e1543(0x113)])(_0x1d1a2f)&&(_0x1d1a2f=_0x292351['profilePicUrl']);const _0x497fe7=_0x292351?.['profilePicUrl']!==_0x1d1a2f&&!(0x0,lodash_1[_0x2e1543(0x113)])(_0x1d1a2f)||![];if(_0x292351)_0x292351[_0x2e1543(0x107)]=remoteJid,_0x292351[_0x2e1543(0x114)]=_0x1d1a2f||null,(_0x17c3ec||_0x292351[_0x2e1543(0x124)]===_0x157c88)&&(_0x292351[_0x2e1543(0x124)]=_0x290d44),await _0x292351[_0x2e1543(0x128)](),await _0x292351[_0x2e1543(0x12e)]();else{const _0x5c27e2=await CompaniesSettings_1[_0x2e1543(0x125)][_0x2e1543(0x130)]({'where':{'companyId':_0x2286d2}}),{acceptAudioMessageContact:_0x2ced73}=_0x5c27e2;_0x292351=await Contact_1['default'][_0x2e1543(0x112)]({'name':_0x290d44,'number':_0x157c88,'email':email,'isGroup':_0x17c3ec,'extraInfo':extraInfo,'companyId':_0x2286d2,'channel':channel,'acceptAudioMessage':_0x2ced73===_0x2e1543(0x12d)?!![]:![],'remoteJid':remoteJid,'urlPicture':_0x1d1a2f}),_0x4242d4=!![];}if(_0x497fe7){const _0x5a09a3=path_1[_0x2e1543(0x125)][_0x2e1543(0x10b)](_0x967e59,_0x2e1543(0x103)+_0x2286d2,_0x2e1543(0x11a));!fs_1[_0x2e1543(0x125)][_0x2e1543(0x119)](_0x5a09a3)&&(fs_1['default'][_0x2e1543(0x108)](_0x5a09a3,{'recursive':!![]}),fs_1[_0x2e1543(0x125)][_0x2e1543(0x137)](_0x5a09a3,0x1ff));let _0x29912c;if(!(0x0,lodash_1[_0x2e1543(0x113)])(_0x1d1a2f)&&_0x1d1a2f['includes']('nopicture'))_0x29912c='nopicture.png';else{if(!(0x0,lodash_1[_0x2e1543(0x113)])(_0x292351[_0x2e1543(0x118)])){const _0x3f779f=path_1['default']['resolve'](_0x292351[_0x2e1543(0x118)]);fs_1[_0x2e1543(0x125)][_0x2e1543(0x119)](_0x3f779f)&&fs_1[_0x2e1543(0x125)][_0x2e1543(0x11e)](_0x3f779f);}const _0x4fc698=await axios[_0x2e1543(0x12a)](_0x1d1a2f,{'responseType':_0x2e1543(0x122)});_0x29912c=''+_0x292351['id']+new Date()[_0x2e1543(0x120)]()+'.jpeg',fs_1[_0x2e1543(0x125)][_0x2e1543(0x10a)]((0x0,path_1[_0x2e1543(0x115)])(_0x5a09a3,_0x29912c),_0x4fc698['data']);}await _0x292351[_0x2e1543(0x11b)]({'urlPicture':_0x29912c,'pictureUpdated':!![]}),await _0x292351[_0x2e1543(0x12e)]();}return _0x4242d4?_0x29dd5d[_0x2e1543(0x109)](_0x2e1543(0x116)+_0x2286d2+'-contact',{'action':_0x2e1543(0x112),'contact':_0x292351}):_0x29dd5d[_0x2e1543(0x109)]('company-'+_0x2286d2+'-contact',{'action':_0x2e1543(0x11b),'contact':_0x292351}),_0x292351;}catch(_0x3109f3){logger_1[_0x2e1543(0x12f)][_0x2e1543(0x121)](_0x2e1543(0x117),_0x3109f3);throw _0x3109f3;}};function a459_0xd6ca(){const _0x5b84ec=['replace','1262bXTQEW','712540rHqomm','chmodSync','getOwnPropertyDescriptor','call','company','__esModule','__importDefault','565257IVgrTI','remoteJid','mkdirSync','emit','writeFileSync','resolve','../../libs/socket','../../models/Contact','9jZRIRl','getIO','495000mpwTYU','public','create','isNil','profilePicUrl','join','company-','Error\x20to\x20find\x20or\x20create\x20a\x20contact:','urlPicture','existsSync','contacts','update','2753304yIBmHz','hasOwnProperty','unlinkSync','229uxwOJu','getTime','error','arraybuffer','defineProperty','name','default','axios','__createBinding','save','98917cvPqMg','get','73495CtCyHc','whatsapp','enabled','reload','logger','findOne','prototype','__setModuleDefault','path'];a459_0xd6ca=function(){return _0x5b84ec;};return a459_0xd6ca();}exports[a459_0x46baaa(0x125)]=CreateOrUpdateContactService;