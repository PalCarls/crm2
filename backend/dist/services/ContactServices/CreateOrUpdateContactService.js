'use strict';const a459_0x2f2214=a459_0x54ba;(function(_0x740891,_0x3bca69){const _0x25e57a=a459_0x54ba,_0x584154=_0x740891();while(!![]){try{const _0x67a55d=-parseInt(_0x25e57a(0x105))/0x1*(parseInt(_0x25e57a(0x107))/0x2)+parseInt(_0x25e57a(0x106))/0x3+-parseInt(_0x25e57a(0xe9))/0x4+-parseInt(_0x25e57a(0xff))/0x5+-parseInt(_0x25e57a(0x119))/0x6*(-parseInt(_0x25e57a(0x10e))/0x7)+-parseInt(_0x25e57a(0xf6))/0x8+parseInt(_0x25e57a(0x11d))/0x9;if(_0x67a55d===_0x3bca69)break;else _0x584154['push'](_0x584154['shift']());}catch(_0x4155c1){_0x584154['push'](_0x584154['shift']());}}}(a459_0xd535,0xbf35b));var __createBinding=this&&this[a459_0x2f2214(0x104)]||(Object['create']?function(_0x22fdd8,_0x2ed477,_0x3180fb,_0x3c60da){const _0x2da7a1=a459_0x2f2214;if(_0x3c60da===undefined)_0x3c60da=_0x3180fb;var _0x1016f2=Object[_0x2da7a1(0xf9)](_0x2ed477,_0x3180fb);(!_0x1016f2||(_0x2da7a1(0x11c)in _0x1016f2?!_0x2ed477[_0x2da7a1(0x101)]:_0x1016f2[_0x2da7a1(0xee)]||_0x1016f2[_0x2da7a1(0x108)]))&&(_0x1016f2={'enumerable':!![],'get':function(){return _0x2ed477[_0x3180fb];}}),Object['defineProperty'](_0x22fdd8,_0x3c60da,_0x1016f2);}:function(_0x27ee5d,_0x504ba9,_0x42c7b1,_0x4d4bc9){if(_0x4d4bc9===undefined)_0x4d4bc9=_0x42c7b1;_0x27ee5d[_0x4d4bc9]=_0x504ba9[_0x42c7b1];}),__setModuleDefault=this&&this[a459_0x2f2214(0xf0)]||(Object[a459_0x2f2214(0x117)]?function(_0x545229,_0xaacc59){const _0x3c1e69=a459_0x2f2214;Object[_0x3c1e69(0xe7)](_0x545229,'default',{'enumerable':!![],'value':_0xaacc59});}:function(_0x540f54,_0x246f7b){const _0x3bf047=a459_0x2f2214;_0x540f54[_0x3bf047(0x102)]=_0x246f7b;}),__importStar=this&&this[a459_0x2f2214(0x115)]||function(_0x130295){const _0x2107bf=a459_0x2f2214;if(_0x130295&&_0x130295[_0x2107bf(0x101)])return _0x130295;var _0x21e2bb={};if(_0x130295!=null){for(var _0x52d04b in _0x130295)if(_0x52d04b!==_0x2107bf(0x102)&&Object['prototype'][_0x2107bf(0x109)][_0x2107bf(0x10d)](_0x130295,_0x52d04b))__createBinding(_0x21e2bb,_0x130295,_0x52d04b);}return __setModuleDefault(_0x21e2bb,_0x130295),_0x21e2bb;},__importDefault=this&&this[a459_0x2f2214(0x100)]||function(_0xf54c56){const _0x458f8a=a459_0x2f2214;return _0xf54c56&&_0xf54c56[_0x458f8a(0x101)]?_0xf54c56:{'default':_0xf54c56};};Object[a459_0x2f2214(0xe7)](exports,'__esModule',{'value':!![]});const socket_1=require(a459_0x2f2214(0xf7)),CompaniesSettings_1=__importDefault(require(a459_0x2f2214(0xf1))),Contact_1=__importDefault(require('../../models/Contact')),fs_1=__importDefault(require('fs')),path_1=__importStar(require('path')),logger_1=require(a459_0x2f2214(0xf5)),lodash_1=require(a459_0x2f2214(0x110)),axios=require('axios'),CreateOrUpdateContactService=async({name:_0x210780,number:_0x4dce23,profilePicUrl:_0x81ed73,isGroup:_0x2d7dd4,email:email='',channel:channel='whatsapp',companyId:_0x1e13ee,extraInfo:extraInfo=[],remoteJid:remoteJid=''})=>{const _0x23cc5b=a459_0x2f2214;try{let _0x5a1640=![];const _0x1fc8ec=path_1['default']['resolve'](__dirname,'..','..','..','public'),_0x4e8a47=_0x2d7dd4?_0x4dce23:_0x4dce23[_0x23cc5b(0x114)](/[^0-9]/g,''),_0x188a85=(0x0,socket_1[_0x23cc5b(0xf4)])();let _0x19db5b;_0x19db5b=await Contact_1['default']['findOne']({'where':{'number':_0x4e8a47,'companyId':_0x1e13ee}});const _0xb76ebc=_0x19db5b?.[_0x23cc5b(0x11b)]!==_0x81ed73&&_0x81ed73!==''||![];if(_0x19db5b)_0x19db5b[_0x23cc5b(0xf3)]=remoteJid,_0x19db5b[_0x23cc5b(0x11b)]=_0x81ed73||null,(_0x2d7dd4||_0x19db5b[_0x23cc5b(0xec)]===_0x4e8a47)&&(_0x19db5b[_0x23cc5b(0xec)]=_0x210780),await _0x19db5b[_0x23cc5b(0x116)](),await _0x19db5b[_0x23cc5b(0xf2)]();else{const _0x6b1eef=await CompaniesSettings_1[_0x23cc5b(0x102)][_0x23cc5b(0x10a)]({'where':{'companyId':_0x1e13ee}}),{acceptAudioMessageContact:_0x330917}=_0x6b1eef;_0x19db5b=await Contact_1[_0x23cc5b(0x102)][_0x23cc5b(0x117)]({'name':_0x210780,'number':_0x4e8a47,'email':email,'isGroup':_0x2d7dd4,'extraInfo':extraInfo,'companyId':_0x1e13ee,'channel':channel,'acceptAudioMessage':_0x330917==='enabled'?!![]:![],'remoteJid':remoteJid,'urlPicture':_0x81ed73}),_0x5a1640=!![];}if(_0xb76ebc&&channel===_0x23cc5b(0x118)){const _0x31d7e1=path_1[_0x23cc5b(0x102)][_0x23cc5b(0x112)](_0x1fc8ec,_0x23cc5b(0x10c)+_0x1e13ee,_0x23cc5b(0xfd));!fs_1[_0x23cc5b(0x102)]['existsSync'](_0x31d7e1)&&(fs_1[_0x23cc5b(0x102)][_0x23cc5b(0xfe)](_0x31d7e1,{'recursive':!![]}),fs_1[_0x23cc5b(0x102)][_0x23cc5b(0xfc)](_0x31d7e1,0x1ff));let _0x31bb99;if(!(0x0,lodash_1['isNil'])(_0x81ed73)&&_0x81ed73[_0x23cc5b(0x10b)]('nopicture'))_0x31bb99=_0x23cc5b(0xed);else{if(!(0x0,lodash_1['isNil'])(_0x19db5b[_0x23cc5b(0x10f)])){const _0x31c6e2=path_1[_0x23cc5b(0x102)][_0x23cc5b(0x112)](_0x19db5b['urlPicture']);fs_1[_0x23cc5b(0x102)][_0x23cc5b(0xfb)](_0x31c6e2)&&fs_1['default'][_0x23cc5b(0xf8)](_0x31c6e2);}const _0xbb8d7c=await axios[_0x23cc5b(0x11c)](_0x81ed73,{'responseType':_0x23cc5b(0xea)});_0x31bb99=''+_0x19db5b['id']+new Date()[_0x23cc5b(0x111)]()+_0x23cc5b(0xe8),fs_1[_0x23cc5b(0x102)]['writeFileSync']((0x0,path_1[_0x23cc5b(0x11a)])(_0x31d7e1,_0x31bb99),_0xbb8d7c['data']);}await _0x19db5b['update']({'urlPicture':_0x31bb99,'pictureUpdated':!![]}),await _0x19db5b[_0x23cc5b(0xf2)]();}return _0x5a1640?_0x188a85[_0x23cc5b(0x103)](_0x23cc5b(0x113)+_0x1e13ee+_0x23cc5b(0xfa),{'action':_0x23cc5b(0x117),'contact':_0x19db5b}):_0x188a85[_0x23cc5b(0x103)](_0x23cc5b(0x113)+_0x1e13ee+_0x23cc5b(0xfa),{'action':_0x23cc5b(0xeb),'contact':_0x19db5b}),_0x19db5b;}catch(_0x14dc9e){logger_1['logger'][_0x23cc5b(0xef)]('Error\x20to\x20find\x20or\x20create\x20a\x20contact:',_0x14dc9e);throw _0x14dc9e;}};exports[a459_0x2f2214(0x102)]=CreateOrUpdateContactService;function a459_0x54ba(_0x2edca4,_0x5907bb){const _0xd53518=a459_0xd535();return a459_0x54ba=function(_0x54baab,_0x101022){_0x54baab=_0x54baab-0xe7;let _0x4d5b45=_0xd53518[_0x54baab];return _0x4d5b45;},a459_0x54ba(_0x2edca4,_0x5907bb);}function a459_0xd535(){const _0x37b1b1=['arraybuffer','update','name','nopicture.png','writable','error','__setModuleDefault','../../models/CompaniesSettings','reload','remoteJid','getIO','../../utils/logger','11370784pZdAgE','../../libs/socket','unlinkSync','getOwnPropertyDescriptor','-contact','existsSync','chmodSync','contacts','mkdirSync','7512360mHAhla','__importDefault','__esModule','default','emit','__createBinding','1199QiQBOi','488820hhyvHq','860dQLsJr','configurable','hasOwnProperty','findOne','includes','company','call','1215466uKzimo','urlPicture','lodash','getTime','resolve','company-','replace','__importStar','save','create','whatsapp','36Dflcuw','join','profilePicUrl','get','40294728aJsTaJ','defineProperty','.jpeg','5837500ZQkeUX'];a459_0xd535=function(){return _0x37b1b1;};return a459_0xd535();}