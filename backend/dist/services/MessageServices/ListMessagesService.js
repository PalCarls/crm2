'use strict';const a477_0x35495e=a477_0x1043;function a477_0x4684(){const _0x33df4c=['58215LgHrrm','contactId','defineProperty','default','push','2657674BtjsdQ','findAll','DESC','whatsappId','map','__esModule','1746770KdljXr','182RYXQep','quotedMsg','../../models/Message','__importDefault','../../models/Ticket','reverse','profile','8197398rRcRFO','contact','2057120lUhvvm','28677020UrTmqs','142218oeZEZZ','../TicketServices/ShowTicketService','1UFvKYU','308ViDSOO','admin','allTicket','queue','enable'];a477_0x4684=function(){return _0x33df4c;};return a477_0x4684();}(function(_0x5376bb,_0x31eb9c){const _0x593be7=a477_0x1043,_0x29a09d=_0x5376bb();while(!![]){try{const _0x24e967=-parseInt(_0x593be7(0x15a))/0x1*(-parseInt(_0x593be7(0x146))/0x2)+parseInt(_0x593be7(0x141))/0x3*(parseInt(_0x593be7(0x15b))/0x4)+parseInt(_0x593be7(0x14c))/0x5+-parseInt(_0x593be7(0x158))/0x6*(parseInt(_0x593be7(0x14d))/0x7)+parseInt(_0x593be7(0x156))/0x8+parseInt(_0x593be7(0x154))/0x9+-parseInt(_0x593be7(0x157))/0xa;if(_0x24e967===_0x31eb9c)break;else _0x29a09d['push'](_0x29a09d['shift']());}catch(_0xed896a){_0x29a09d['push'](_0x29a09d['shift']());}}}(a477_0x4684,0xd1126));function a477_0x1043(_0x302fdf,_0x4a5d07){const _0x4684cf=a477_0x4684();return a477_0x1043=function(_0x10433d,_0x53e9a6){_0x10433d=_0x10433d-0x13e;let _0x4810ba=_0x4684cf[_0x10433d];return _0x4810ba;},a477_0x1043(_0x302fdf,_0x4a5d07);}var __importDefault=this&&this[a477_0x35495e(0x150)]||function(_0x334e62){return _0x334e62&&_0x334e62['__esModule']?_0x334e62:{'default':_0x334e62};};Object[a477_0x35495e(0x143)](exports,a477_0x35495e(0x14b),{'value':!![]});const AppError_1=__importDefault(require('../../errors/AppError')),Message_1=__importDefault(require(a477_0x35495e(0x14f))),Ticket_1=__importDefault(require(a477_0x35495e(0x151))),ShowTicketService_1=__importDefault(require(a477_0x35495e(0x159))),sequelize_1=require('sequelize'),lodash_1=require('lodash'),ListMessagesService=async({pageNumber:pageNumber='1',ticketId:_0x474cfe,companyId:_0x9c1681,queues:queues=[],user:_0x137e2b})=>{const _0x5d63dd=a477_0x35495e,_0x330351=await(0x0,ShowTicketService_1[_0x5d63dd(0x144)])(_0x474cfe,_0x9c1681),_0x263536=[],_0x1ae1a4=await Ticket_1[_0x5d63dd(0x144)][_0x5d63dd(0x147)]({'where':{'contactId':_0x330351[_0x5d63dd(0x142)],'whatsappId':_0x330351[_0x5d63dd(0x149)],'isGroup':_0x330351['isGroup'],'queueId':_0x137e2b[_0x5d63dd(0x153)]===_0x5d63dd(0x15c)||_0x137e2b[_0x5d63dd(0x13e)]===_0x5d63dd(0x140)?{[sequelize_1['Op']['or']]:{[sequelize_1['Op']['in']]:queues,[sequelize_1['Op']['eq']]:null}}:{[sequelize_1['Op']['in']]:queues}},'attributes':['id']});_0x1ae1a4&&_0x263536[_0x5d63dd(0x145)](_0x1ae1a4[_0x5d63dd(0x14a)](_0x2550b7=>_0x2550b7['id']));const _0x3f07ab=(0x0,lodash_1['intersection'])(..._0x263536);if(!_0x330351)throw new AppError_1['default']('ERR_NO_TICKET_FOUND',0x194);const _0x2c0c57=0x14,_0xc63951=_0x2c0c57*(+pageNumber-0x1),{count:_0x966c36,rows:_0x24696e}=await Message_1[_0x5d63dd(0x144)]['findAndCountAll']({'where':{'ticketId':_0x3f07ab},'limit':_0x2c0c57,'include':[_0x5d63dd(0x155),{'model':Message_1[_0x5d63dd(0x144)],'as':_0x5d63dd(0x14e),'include':['contact']},{'model':Ticket_1['default'],'required':!![],'include':[_0x5d63dd(0x13f)]}],'offset':_0xc63951,'order':[['createdAt',_0x5d63dd(0x148)]]}),_0x5d6c27=_0x966c36>_0xc63951+_0x24696e['length'];return{'messages':_0x24696e[_0x5d63dd(0x152)](),'ticket':_0x330351,'count':_0x966c36,'hasMore':_0x5d6c27};};exports[a477_0x35495e(0x144)]=ListMessagesService;