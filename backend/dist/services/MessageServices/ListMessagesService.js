'use strict';function a494_0x54dd(){const _0x274b37=['11921021oXgnzf','55910yZpYxC','lodash','5608404QhRbcQ','findAndCountAll','defineProperty','default','../../models/Ticket','isGroup','720rvJapb','contact','8iRxPyd','companyId','push','../TicketServices/ShowTicketService','admin','DESC','findAll','length','createdAt','50jxfmzs','profile','contactId','map','__importDefault','intersection','66981UNQdLn','__esModule','allTicket','../UserServices/isQueueIdHistoryBlocked','31083ErCxRM','lte','41804856BlBIqY','ERR_NO_TICKET_FOUND','../../models/Message','sequelize','../../errors/AppError','queue','11MxNMEq','17144250KZrQCF','188IMYMUK','whatsappId'];a494_0x54dd=function(){return _0x274b37;};return a494_0x54dd();}const a494_0x53e063=a494_0x5760;(function(_0x738b37,_0x25d372){const _0x3c1947=a494_0x5760,_0x8edf0a=_0x738b37();while(!![]){try{const _0x15a918=-parseInt(_0x3c1947(0x189))/0x1*(parseInt(_0x3c1947(0x17f))/0x2)+parseInt(_0x3c1947(0x185))/0x3*(-parseInt(_0x3c1947(0x193))/0x4)+-parseInt(_0x3c1947(0x196))/0x5*(parseInt(_0x3c1947(0x174))/0x6)+parseInt(_0x3c1947(0x195))/0x7+parseInt(_0x3c1947(0x176))/0x8*(parseInt(_0x3c1947(0x198))/0x9)+-parseInt(_0x3c1947(0x192))/0xa*(parseInt(_0x3c1947(0x191))/0xb)+parseInt(_0x3c1947(0x18b))/0xc;if(_0x15a918===_0x25d372)break;else _0x8edf0a['push'](_0x8edf0a['shift']());}catch(_0x55490a){_0x8edf0a['push'](_0x8edf0a['shift']());}}}(a494_0x54dd,0xe25d4));function a494_0x5760(_0x386f33,_0x39560e){const _0x54dda8=a494_0x54dd();return a494_0x5760=function(_0x57606f,_0x5aa4b4){_0x57606f=_0x57606f-0x170;let _0x2e63c9=_0x54dda8[_0x57606f];return _0x2e63c9;},a494_0x5760(_0x386f33,_0x39560e);}var __importDefault=this&&this[a494_0x53e063(0x183)]||function(_0x3ab2b4){return _0x3ab2b4&&_0x3ab2b4['__esModule']?_0x3ab2b4:{'default':_0x3ab2b4};};Object[a494_0x53e063(0x170)](exports,a494_0x53e063(0x186),{'value':!![]});const AppError_1=__importDefault(require(a494_0x53e063(0x18f))),Message_1=__importDefault(require(a494_0x53e063(0x18d))),Ticket_1=__importDefault(require(a494_0x53e063(0x172))),ShowTicketService_1=__importDefault(require(a494_0x53e063(0x179))),sequelize_1=require(a494_0x53e063(0x18e)),lodash_1=require(a494_0x53e063(0x197)),isQueueIdHistoryBlocked_1=__importDefault(require(a494_0x53e063(0x188))),ListMessagesService=async({pageNumber:pageNumber='1',ticketId:_0xad1e5c,companyId:_0x390874,queues:queues=[],user:_0x3dd19b})=>{const _0x17eebf=a494_0x53e063,_0x5ebda0=await(0x0,ShowTicketService_1[_0x17eebf(0x171)])(_0xad1e5c,_0x390874),_0x3403f7=[],_0x76e17e=await(0x0,isQueueIdHistoryBlocked_1[_0x17eebf(0x171)])({'userRequest':_0x3dd19b['id']});let _0x2df407=[];!_0x76e17e?_0x2df407=await Ticket_1[_0x17eebf(0x171)][_0x17eebf(0x17c)]({'where':{'id':{[sequelize_1['Op'][_0x17eebf(0x18a)]]:_0x5ebda0['id']},'companyId':_0x5ebda0[_0x17eebf(0x177)],'contactId':_0x5ebda0[_0x17eebf(0x181)],'whatsappId':_0x5ebda0[_0x17eebf(0x194)],'isGroup':_0x5ebda0[_0x17eebf(0x173)],'queueId':_0x3dd19b[_0x17eebf(0x180)]===_0x17eebf(0x17a)||_0x3dd19b[_0x17eebf(0x187)]==='enable'?{[sequelize_1['Op']['or']]:[queues,null]}:{[sequelize_1['Op']['in']]:queues}},'attributes':['id']}):_0x2df407=await Ticket_1[_0x17eebf(0x171)][_0x17eebf(0x17c)]({'where':{'id':{[sequelize_1['Op'][_0x17eebf(0x18a)]]:_0x5ebda0['id']},'companyId':_0x5ebda0[_0x17eebf(0x177)],'contactId':_0x5ebda0[_0x17eebf(0x181)],'whatsappId':_0x5ebda0[_0x17eebf(0x194)],'isGroup':_0x5ebda0['isGroup']},'attributes':['id']});_0x2df407&&_0x3403f7[_0x17eebf(0x178)](_0x2df407[_0x17eebf(0x182)](_0x104940=>_0x104940['id']));const _0x3e5b33=(0x0,lodash_1[_0x17eebf(0x184)])(..._0x3403f7);if(!_0x3e5b33)throw new AppError_1[(_0x17eebf(0x171))](_0x17eebf(0x18c),0x194);const _0x5dd13d=0x14,_0x4f8cd2=_0x5dd13d*(+pageNumber-0x1),{count:_0x356b71,rows:_0x49319e}=await Message_1[_0x17eebf(0x171)][_0x17eebf(0x199)]({'where':{'ticketId':_0x3e5b33,'companyId':_0x390874},'limit':_0x5dd13d,'include':[_0x17eebf(0x175),{'model':Message_1[_0x17eebf(0x171)],'as':'quotedMsg','include':[_0x17eebf(0x175)]},{'model':Ticket_1[_0x17eebf(0x171)],'required':!![],'include':[_0x17eebf(0x190)]}],'distinct':!![],'offset':_0x4f8cd2,'order':[[_0x17eebf(0x17e),_0x17eebf(0x17b)]]}),_0x33c13f=_0x356b71>_0x4f8cd2+_0x49319e[_0x17eebf(0x17d)];return{'messages':_0x49319e['reverse'](),'ticket':_0x5ebda0,'count':_0x356b71,'hasMore':_0x33c13f};};exports['default']=ListMessagesService;