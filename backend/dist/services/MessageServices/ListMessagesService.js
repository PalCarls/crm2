'use strict';function a504_0x3e77(_0x202a2d,_0x10a321){const _0x1be72f=a504_0x1be7();return a504_0x3e77=function(_0x3e77e5,_0x34c575){_0x3e77e5=_0x3e77e5-0x188;let _0x3d81fa=_0x1be72f[_0x3e77e5];return _0x3d81fa;},a504_0x3e77(_0x202a2d,_0x10a321);}const a504_0x23f164=a504_0x3e77;(function(_0x87510b,_0xaac199){const _0x3d6ab4=a504_0x3e77,_0x19f7a2=_0x87510b();while(!![]){try{const _0x46417c=-parseInt(_0x3d6ab4(0x18c))/0x1*(parseInt(_0x3d6ab4(0x1a3))/0x2)+-parseInt(_0x3d6ab4(0x19a))/0x3*(parseInt(_0x3d6ab4(0x194))/0x4)+-parseInt(_0x3d6ab4(0x1aa))/0x5+-parseInt(_0x3d6ab4(0x1a8))/0x6+parseInt(_0x3d6ab4(0x18d))/0x7+parseInt(_0x3d6ab4(0x1a6))/0x8*(parseInt(_0x3d6ab4(0x18a))/0x9)+-parseInt(_0x3d6ab4(0x197))/0xa*(-parseInt(_0x3d6ab4(0x18f))/0xb);if(_0x46417c===_0xaac199)break;else _0x19f7a2['push'](_0x19f7a2['shift']());}catch(_0x4c429a){_0x19f7a2['push'](_0x19f7a2['shift']());}}}(a504_0x1be7,0xc61e8));function a504_0x1be7(){const _0x5aced3=['__esModule','757710xSFcUo','whatsappId','5fJPoPD','1610161XsToVP','../UserServices/isQueueIdHistoryBlocked','19385267srqJYj','queue','lodash','length','sequelize','746740wTVirD','companyId','../../models/Message','20jzRJfi','../../errors/AppError','lte','15OtLOgS','__importDefault','findAndCountAll','quotedMsg','contact','contactId','../TicketServices/ShowTicketService','intersection','admin','471836NQoZzT','profile','../../models/Ticket','72MwakYw','defineProperty','8163132IJQrbw','map','1136470ldfxRf','default','isGroup','enable','findAll','createdAt','DESC'];a504_0x1be7=function(){return _0x5aced3;};return a504_0x1be7();}var __importDefault=this&&this[a504_0x23f164(0x19b)]||function(_0x289d9b){const _0x8eac9=a504_0x23f164;return _0x289d9b&&_0x289d9b[_0x8eac9(0x189)]?_0x289d9b:{'default':_0x289d9b};};Object[a504_0x23f164(0x1a7)](exports,a504_0x23f164(0x189),{'value':!![]});const AppError_1=__importDefault(require(a504_0x23f164(0x198))),Message_1=__importDefault(require(a504_0x23f164(0x196))),Ticket_1=__importDefault(require(a504_0x23f164(0x1a5))),ShowTicketService_1=__importDefault(require(a504_0x23f164(0x1a0))),sequelize_1=require(a504_0x23f164(0x193)),lodash_1=require(a504_0x23f164(0x191)),isQueueIdHistoryBlocked_1=__importDefault(require(a504_0x23f164(0x18e))),ListMessagesService=async({pageNumber:pageNumber='1',ticketId:_0x5866dc,companyId:_0x40f31f,queues:queues=[],user:_0x1c6831})=>{const _0x2f1ee3=a504_0x23f164,_0x3add31=await(0x0,ShowTicketService_1[_0x2f1ee3(0x1ab)])(_0x5866dc,_0x40f31f),_0x5474b1=[],_0x571917=await(0x0,isQueueIdHistoryBlocked_1[_0x2f1ee3(0x1ab)])({'userRequest':_0x1c6831['id']});let _0x36d55e=[];!_0x571917?_0x36d55e=await Ticket_1[_0x2f1ee3(0x1ab)][_0x2f1ee3(0x1ae)]({'where':{'id':{[sequelize_1['Op'][_0x2f1ee3(0x199)]]:_0x3add31['id']},'companyId':_0x3add31[_0x2f1ee3(0x195)],'contactId':_0x3add31[_0x2f1ee3(0x19f)],'whatsappId':_0x3add31[_0x2f1ee3(0x18b)],'isGroup':_0x3add31[_0x2f1ee3(0x1ac)],'queueId':_0x1c6831[_0x2f1ee3(0x1a4)]===_0x2f1ee3(0x1a2)||_0x1c6831['allTicket']===_0x2f1ee3(0x1ad)?{[sequelize_1['Op']['or']]:[queues,null]}:{[sequelize_1['Op']['in']]:queues}},'attributes':['id']}):_0x36d55e=await Ticket_1[_0x2f1ee3(0x1ab)][_0x2f1ee3(0x1ae)]({'where':{'id':{[sequelize_1['Op'][_0x2f1ee3(0x199)]]:_0x3add31['id']},'companyId':_0x3add31[_0x2f1ee3(0x195)],'contactId':_0x3add31[_0x2f1ee3(0x19f)],'whatsappId':_0x3add31['whatsappId'],'isGroup':_0x3add31[_0x2f1ee3(0x1ac)]},'attributes':['id']});_0x36d55e&&_0x5474b1['push'](_0x36d55e[_0x2f1ee3(0x1a9)](_0x2a48da=>_0x2a48da['id']));const _0x5e628d=(0x0,lodash_1[_0x2f1ee3(0x1a1)])(..._0x5474b1);if(!_0x5e628d)throw new AppError_1[(_0x2f1ee3(0x1ab))]('ERR_NO_TICKET_FOUND',0x194);const _0x2f6547=0x14,_0x255259=_0x2f6547*(+pageNumber-0x1),{count:_0x359b01,rows:_0x52cc98}=await Message_1['default'][_0x2f1ee3(0x19c)]({'where':{'ticketId':_0x5e628d,'companyId':_0x40f31f},'limit':_0x2f6547,'include':['contact',{'model':Message_1[_0x2f1ee3(0x1ab)],'as':_0x2f1ee3(0x19d),'include':[_0x2f1ee3(0x19e)]},{'model':Ticket_1[_0x2f1ee3(0x1ab)],'required':!![],'include':[_0x2f1ee3(0x190)]}],'distinct':!![],'offset':_0x255259,'order':[[_0x2f1ee3(0x1af),_0x2f1ee3(0x188)]]}),_0x2d1709=_0x359b01>_0x255259+_0x52cc98[_0x2f1ee3(0x192)];return{'messages':_0x52cc98['reverse'](),'ticket':_0x3add31,'count':_0x359b01,'hasMore':_0x2d1709};};exports[a504_0x23f164(0x1ab)]=ListMessagesService;