'use strict';function a494_0x3bbe(){const _0x411469=['DESC','../../errors/AppError','250075PyqGKn','../../models/Ticket','../../models/Message','findAndCountAll','allTicket','queue','defineProperty','1470692NfPHuy','../UserServices/isQueueIdHistoryBlocked','sequelize','isGroup','default','findAll','297738SCsgpN','contactId','ERR_NO_TICKET_FOUND','__importDefault','../TicketServices/ShowTicketService','106435QlUDdX','profile','13342RTmzle','222gQgaxo','7712648YvkwlH','length','contact','companyId','quotedMsg','map','__esModule','reverse','lte','lodash','653394qsSpbH','createdAt','intersection'];a494_0x3bbe=function(){return _0x411469;};return a494_0x3bbe();}const a494_0xa01202=a494_0x25a4;(function(_0x461b3e,_0xe5bffa){const _0x23318c=a494_0x25a4,_0x21b3df=_0x461b3e();while(!![]){try{const _0x48d0e5=-parseInt(_0x23318c(0x96))/0x1+parseInt(_0x23318c(0x7e))/0x2+-parseInt(_0x23318c(0x91))/0x3+-parseInt(_0x23318c(0x78))/0x4+-parseInt(_0x23318c(0x83))/0x5+-parseInt(_0x23318c(0x86))/0x6*(parseInt(_0x23318c(0x85))/0x7)+parseInt(_0x23318c(0x87))/0x8;if(_0x48d0e5===_0xe5bffa)break;else _0x21b3df['push'](_0x21b3df['shift']());}catch(_0x17a1e4){_0x21b3df['push'](_0x21b3df['shift']());}}}(a494_0x3bbe,0x2d4fb));var __importDefault=this&&this[a494_0xa01202(0x81)]||function(_0x94d8fa){const _0x2fd986=a494_0xa01202;return _0x94d8fa&&_0x94d8fa[_0x2fd986(0x8d)]?_0x94d8fa:{'default':_0x94d8fa};};Object[a494_0xa01202(0x77)](exports,a494_0xa01202(0x8d),{'value':!![]});function a494_0x25a4(_0x2d492f,_0x256eb7){const _0x3bbe09=a494_0x3bbe();return a494_0x25a4=function(_0x25a446,_0x336d74){_0x25a446=_0x25a446-0x76;let _0x54191e=_0x3bbe09[_0x25a446];return _0x54191e;},a494_0x25a4(_0x2d492f,_0x256eb7);}const AppError_1=__importDefault(require(a494_0xa01202(0x95))),Message_1=__importDefault(require(a494_0xa01202(0x98))),Ticket_1=__importDefault(require(a494_0xa01202(0x97))),ShowTicketService_1=__importDefault(require(a494_0xa01202(0x82))),sequelize_1=require(a494_0xa01202(0x7a)),lodash_1=require(a494_0xa01202(0x90)),isQueueIdHistoryBlocked_1=__importDefault(require(a494_0xa01202(0x79))),ListMessagesService=async({pageNumber:pageNumber='1',ticketId:_0x5bd35b,companyId:_0x1d35a9,queues:queues=[],user:_0x279c2d})=>{const _0x31c9ed=a494_0xa01202,_0x303da5=await(0x0,ShowTicketService_1['default'])(_0x5bd35b,_0x1d35a9),_0x3fba2c=[],_0x384224=await(0x0,isQueueIdHistoryBlocked_1[_0x31c9ed(0x7c)])({'userRequest':_0x279c2d['id']});let _0x68f446=[];!_0x384224?_0x68f446=await Ticket_1[_0x31c9ed(0x7c)][_0x31c9ed(0x7d)]({'where':{'id':{[sequelize_1['Op'][_0x31c9ed(0x8f)]]:_0x303da5['id']},'companyId':_0x303da5[_0x31c9ed(0x8a)],'contactId':_0x303da5['contactId'],'whatsappId':_0x303da5['whatsappId'],'isGroup':_0x303da5[_0x31c9ed(0x7b)],'queueId':_0x279c2d[_0x31c9ed(0x84)]==='admin'||_0x279c2d[_0x31c9ed(0x9a)]==='enable'?{[sequelize_1['Op']['or']]:[queues,null]}:{[sequelize_1['Op']['in']]:queues}},'attributes':['id']}):_0x68f446=await Ticket_1[_0x31c9ed(0x7c)][_0x31c9ed(0x7d)]({'where':{'id':{[sequelize_1['Op'][_0x31c9ed(0x8f)]]:_0x303da5['id']},'companyId':_0x303da5[_0x31c9ed(0x8a)],'contactId':_0x303da5[_0x31c9ed(0x7f)],'whatsappId':_0x303da5['whatsappId'],'isGroup':_0x303da5['isGroup']},'attributes':['id']});_0x68f446&&_0x3fba2c['push'](_0x68f446[_0x31c9ed(0x8c)](_0x3b4efc=>_0x3b4efc['id']));const _0x544034=(0x0,lodash_1[_0x31c9ed(0x93)])(..._0x3fba2c);if(!_0x544034)throw new AppError_1[(_0x31c9ed(0x7c))](_0x31c9ed(0x80),0x194);const _0x4d0ed5=0x14,_0x554d22=_0x4d0ed5*(+pageNumber-0x1),{count:_0x5c12ff,rows:_0x35d625}=await Message_1[_0x31c9ed(0x7c)][_0x31c9ed(0x99)]({'where':{'ticketId':_0x544034,'companyId':_0x1d35a9},'limit':_0x4d0ed5,'include':[_0x31c9ed(0x89),{'model':Message_1[_0x31c9ed(0x7c)],'as':_0x31c9ed(0x8b),'include':[_0x31c9ed(0x89)]},{'model':Ticket_1[_0x31c9ed(0x7c)],'required':!![],'include':[_0x31c9ed(0x76)]}],'distinct':!![],'offset':_0x554d22,'order':[[_0x31c9ed(0x92),_0x31c9ed(0x94)]]}),_0x4b2fdf=_0x5c12ff>_0x554d22+_0x35d625[_0x31c9ed(0x88)];return{'messages':_0x35d625[_0x31c9ed(0x8e)](),'ticket':_0x303da5,'count':_0x5c12ff,'hasMore':_0x4b2fdf};};exports[a494_0xa01202(0x7c)]=ListMessagesService;