'use strict';const a511_0x45d07c=a511_0x52d7;(function(_0x17bf48,_0x2f4561){const _0x5dfea1=a511_0x52d7,_0x5cada5=_0x17bf48();while(!![]){try{const _0x10b39=parseInt(_0x5dfea1(0x12f))/0x1+parseInt(_0x5dfea1(0x136))/0x2+parseInt(_0x5dfea1(0x11d))/0x3*(parseInt(_0x5dfea1(0x122))/0x4)+parseInt(_0x5dfea1(0x130))/0x5*(-parseInt(_0x5dfea1(0x125))/0x6)+-parseInt(_0x5dfea1(0x11a))/0x7+parseInt(_0x5dfea1(0x133))/0x8*(parseInt(_0x5dfea1(0x12b))/0x9)+parseInt(_0x5dfea1(0x126))/0xa*(-parseInt(_0x5dfea1(0x11f))/0xb);if(_0x10b39===_0x2f4561)break;else _0x5cada5['push'](_0x5cada5['shift']());}catch(_0x4d3208){_0x5cada5['push'](_0x5cada5['shift']());}}}(a511_0x513b,0xbb221));var __importDefault=this&&this['__importDefault']||function(_0x45a84f){const _0x299a9b=a511_0x52d7;return _0x45a84f&&_0x45a84f[_0x299a9b(0x123)]?_0x45a84f:{'default':_0x45a84f};};function a511_0x513b(){const _0x4cdc8f=['3337816SVKIQL','defineProperty','queue','1985708GKCvnh','push','findAll','quotedMsg','enable','sequelize','../UserServices/isQueueIdHistoryBlocked','createdAt','allTicket','../TicketServices/ShowTicketService','profile','9231082ZkQCMt','contactId','ERR_NO_TICKET_FOUND','8907UFHGdL','length','10285cvzNtS','reverse','findAndCountAll','1884ndCkri','__esModule','../../models/Ticket','6rgPmza','19870rBVfFn','../../models/Message','lodash','lte','map','9OnKPMQ','default','intersection','whatsappId','1227455QenUrS','464335NIQQpe','companyId','isGroup'];a511_0x513b=function(){return _0x4cdc8f;};return a511_0x513b();}Object[a511_0x45d07c(0x134)](exports,'__esModule',{'value':!![]});const AppError_1=__importDefault(require('../../errors/AppError')),Message_1=__importDefault(require(a511_0x45d07c(0x127))),Ticket_1=__importDefault(require(a511_0x45d07c(0x124))),ShowTicketService_1=__importDefault(require(a511_0x45d07c(0x118))),sequelize_1=require(a511_0x45d07c(0x13b)),lodash_1=require(a511_0x45d07c(0x128)),isQueueIdHistoryBlocked_1=__importDefault(require(a511_0x45d07c(0x13c))),ListMessagesService=async({pageNumber:pageNumber='1',ticketId:_0x2eb91f,companyId:_0x3e870d,queues:queues=[],user:_0x473fa6})=>{const _0x845c41=a511_0x45d07c,_0x36e15f=await(0x0,ShowTicketService_1[_0x845c41(0x12c)])(_0x2eb91f,_0x3e870d),_0x563318=[],_0xed8847=await(0x0,isQueueIdHistoryBlocked_1[_0x845c41(0x12c)])({'userRequest':_0x473fa6['id']});let _0x1084f5=[];!_0xed8847?_0x1084f5=await Ticket_1['default'][_0x845c41(0x138)]({'where':{'id':{[sequelize_1['Op'][_0x845c41(0x129)]]:_0x36e15f['id']},'companyId':_0x36e15f[_0x845c41(0x131)],'contactId':_0x36e15f[_0x845c41(0x11b)],'whatsappId':_0x36e15f['whatsappId'],'isGroup':_0x36e15f['isGroup'],'queueId':_0x473fa6[_0x845c41(0x119)]==='admin'||_0x473fa6[_0x845c41(0x13e)]===_0x845c41(0x13a)?{[sequelize_1['Op']['or']]:[queues,null]}:{[sequelize_1['Op']['in']]:queues}},'attributes':['id']}):_0x1084f5=await Ticket_1[_0x845c41(0x12c)][_0x845c41(0x138)]({'where':{'id':{[sequelize_1['Op'][_0x845c41(0x129)]]:_0x36e15f['id']},'companyId':_0x36e15f[_0x845c41(0x131)],'contactId':_0x36e15f[_0x845c41(0x11b)],'whatsappId':_0x36e15f[_0x845c41(0x12e)],'isGroup':_0x36e15f[_0x845c41(0x132)]},'attributes':['id']});_0x1084f5&&_0x563318[_0x845c41(0x137)](_0x1084f5[_0x845c41(0x12a)](_0x21e880=>_0x21e880['id']));const _0x12bdf9=(0x0,lodash_1[_0x845c41(0x12d)])(..._0x563318);if(!_0x12bdf9)throw new AppError_1[(_0x845c41(0x12c))](_0x845c41(0x11c),0x194);const _0x3fdbaa=0x14,_0x23d74d=_0x3fdbaa*(+pageNumber-0x1),{count:_0xdd1bf1,rows:_0x3e9fd9}=await Message_1['default'][_0x845c41(0x121)]({'where':{'ticketId':_0x12bdf9,'companyId':_0x3e870d},'limit':_0x3fdbaa,'include':['contact',{'model':Message_1['default'],'as':_0x845c41(0x139),'include':['contact']},{'model':Ticket_1['default'],'required':!![],'include':[_0x845c41(0x135)]}],'distinct':!![],'offset':_0x23d74d,'order':[[_0x845c41(0x13d),'DESC']]}),_0x43df74=_0xdd1bf1>_0x23d74d+_0x3e9fd9[_0x845c41(0x11e)];return{'messages':_0x3e9fd9[_0x845c41(0x120)](),'ticket':_0x36e15f,'count':_0xdd1bf1,'hasMore':_0x43df74};};function a511_0x52d7(_0x53efeb,_0x221eda){const _0x513b69=a511_0x513b();return a511_0x52d7=function(_0x52d765,_0x2e84f8){_0x52d765=_0x52d765-0x118;let _0x5c4026=_0x513b69[_0x52d765];return _0x5c4026;},a511_0x52d7(_0x53efeb,_0x221eda);}exports[a511_0x45d07c(0x12c)]=ListMessagesService;