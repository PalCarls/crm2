'use strict';const a504_0x91d248=a504_0x1b3e;function a504_0x1b3e(_0xad41c2,_0x5c07a8){const _0x335426=a504_0x3354();return a504_0x1b3e=function(_0x1b3e80,_0x2d14a4){_0x1b3e80=_0x1b3e80-0x83;let _0x307347=_0x335426[_0x1b3e80];return _0x307347;},a504_0x1b3e(_0xad41c2,_0x5c07a8);}(function(_0x1698aa,_0x5f2eef){const _0x64fcd6=a504_0x1b3e,_0x1cce4c=_0x1698aa();while(!![]){try{const _0x3e42bd=parseInt(_0x64fcd6(0xa5))/0x1+-parseInt(_0x64fcd6(0xa4))/0x2+parseInt(_0x64fcd6(0x9b))/0x3*(parseInt(_0x64fcd6(0x8b))/0x4)+parseInt(_0x64fcd6(0x96))/0x5+-parseInt(_0x64fcd6(0x98))/0x6*(parseInt(_0x64fcd6(0xa6))/0x7)+-parseInt(_0x64fcd6(0x90))/0x8*(-parseInt(_0x64fcd6(0x9c))/0x9)+-parseInt(_0x64fcd6(0x99))/0xa*(parseInt(_0x64fcd6(0x8c))/0xb);if(_0x3e42bd===_0x5f2eef)break;else _0x1cce4c['push'](_0x1cce4c['shift']());}catch(_0x2c9b5b){_0x1cce4c['push'](_0x1cce4c['shift']());}}}(a504_0x3354,0x93ea7));function a504_0x3354(){const _0x468cab=['isGroup','../UserServices/isQueueIdHistoryBlocked','contactId','companyId','findAndCountAll','../../models/Ticket','push','length','createdAt','17616zjQGVA','5347837YqRMHs','default','map','lte','72urZEpN','enable','queue','admin','ERR_NO_TICKET_FOUND','lodash','4874860ZHOelg','__importDefault','96246lqvaxH','10tRlQwE','sequelize','120VpEEqC','497691iicLgZ','findAll','reverse','allTicket','../TicketServices/ShowTicketService','../../errors/AppError','contact','defineProperty','1908810rMDLWt','574063QXDQuK','77LwYOLS','../../models/Message','whatsappId','__esModule','intersection'];a504_0x3354=function(){return _0x468cab;};return a504_0x3354();}var __importDefault=this&&this[a504_0x91d248(0x97)]||function(_0x27a1e6){const _0x3b8506=a504_0x91d248;return _0x27a1e6&&_0x27a1e6[_0x3b8506(0xa9)]?_0x27a1e6:{'default':_0x27a1e6};};Object[a504_0x91d248(0xa3)](exports,'__esModule',{'value':!![]});const AppError_1=__importDefault(require(a504_0x91d248(0xa1))),Message_1=__importDefault(require(a504_0x91d248(0xa7))),Ticket_1=__importDefault(require(a504_0x91d248(0x87))),ShowTicketService_1=__importDefault(require(a504_0x91d248(0xa0))),sequelize_1=require(a504_0x91d248(0x9a)),lodash_1=require(a504_0x91d248(0x95)),isQueueIdHistoryBlocked_1=__importDefault(require(a504_0x91d248(0x83))),ListMessagesService=async({pageNumber:pageNumber='1',ticketId:_0x4ef0c8,companyId:_0x2355a4,queues:queues=[],user:_0x17b6ae})=>{const _0x25d94b=a504_0x91d248,_0x5a505a=await(0x0,ShowTicketService_1[_0x25d94b(0x8d)])(_0x4ef0c8,_0x2355a4),_0x59b664=[],_0x5eb9f5=await(0x0,isQueueIdHistoryBlocked_1[_0x25d94b(0x8d)])({'userRequest':_0x17b6ae['id']});let _0x5c918c=[];!_0x5eb9f5?_0x5c918c=await Ticket_1[_0x25d94b(0x8d)][_0x25d94b(0x9d)]({'where':{'id':{[sequelize_1['Op'][_0x25d94b(0x8f)]]:_0x5a505a['id']},'companyId':_0x5a505a[_0x25d94b(0x85)],'contactId':_0x5a505a[_0x25d94b(0x84)],'whatsappId':_0x5a505a[_0x25d94b(0xa8)],'isGroup':_0x5a505a[_0x25d94b(0xab)],'queueId':_0x17b6ae['profile']===_0x25d94b(0x93)||_0x17b6ae[_0x25d94b(0x9f)]===_0x25d94b(0x91)?{[sequelize_1['Op']['or']]:[queues,null]}:{[sequelize_1['Op']['in']]:queues}},'attributes':['id']}):_0x5c918c=await Ticket_1['default']['findAll']({'where':{'id':{[sequelize_1['Op'][_0x25d94b(0x8f)]]:_0x5a505a['id']},'companyId':_0x5a505a[_0x25d94b(0x85)],'contactId':_0x5a505a[_0x25d94b(0x84)],'whatsappId':_0x5a505a['whatsappId'],'isGroup':_0x5a505a[_0x25d94b(0xab)]},'attributes':['id']});_0x5c918c&&_0x59b664[_0x25d94b(0x88)](_0x5c918c[_0x25d94b(0x8e)](_0x458c74=>_0x458c74['id']));const _0x1f3d5e=(0x0,lodash_1[_0x25d94b(0xaa)])(..._0x59b664);if(!_0x1f3d5e)throw new AppError_1[(_0x25d94b(0x8d))](_0x25d94b(0x94),0x194);const _0x5ed987=0x14,_0x43d2d3=_0x5ed987*(+pageNumber-0x1),{count:_0x35aa45,rows:_0x1a40c4}=await Message_1[_0x25d94b(0x8d)][_0x25d94b(0x86)]({'where':{'ticketId':_0x1f3d5e,'companyId':_0x2355a4},'limit':_0x5ed987,'include':[_0x25d94b(0xa2),{'model':Message_1['default'],'as':'quotedMsg','include':[_0x25d94b(0xa2)]},{'model':Ticket_1['default'],'required':!![],'include':[_0x25d94b(0x92)]}],'distinct':!![],'offset':_0x43d2d3,'order':[[_0x25d94b(0x8a),'DESC']]}),_0x2b5b98=_0x35aa45>_0x43d2d3+_0x1a40c4[_0x25d94b(0x89)];return{'messages':_0x1a40c4[_0x25d94b(0x9e)](),'ticket':_0x5a505a,'count':_0x35aa45,'hasMore':_0x2b5b98};};exports[a504_0x91d248(0x8d)]=ListMessagesService;