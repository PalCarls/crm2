'use strict';function a502_0x2369(_0x140347,_0x40a833){const _0x43bc17=a502_0x43bc();return a502_0x2369=function(_0x23699d,_0x3fa2f4){_0x23699d=_0x23699d-0x1a6;let _0x51767d=_0x43bc17[_0x23699d];return _0x51767d;},a502_0x2369(_0x140347,_0x40a833);}const a502_0x15f282=a502_0x2369;(function(_0x53d6f2,_0x2c205b){const _0x4e4aec=a502_0x2369,_0x543244=_0x53d6f2();while(!![]){try{const _0x1294fd=-parseInt(_0x4e4aec(0x1ab))/0x1*(parseInt(_0x4e4aec(0x1bf))/0x2)+-parseInt(_0x4e4aec(0x1c4))/0x3*(-parseInt(_0x4e4aec(0x1b6))/0x4)+parseInt(_0x4e4aec(0x1c3))/0x5*(-parseInt(_0x4e4aec(0x1bb))/0x6)+-parseInt(_0x4e4aec(0x1c0))/0x7+-parseInt(_0x4e4aec(0x1b0))/0x8+parseInt(_0x4e4aec(0x1ba))/0x9*(parseInt(_0x4e4aec(0x1c8))/0xa)+parseInt(_0x4e4aec(0x1be))/0xb;if(_0x1294fd===_0x2c205b)break;else _0x543244['push'](_0x543244['shift']());}catch(_0x5e0098){_0x543244['push'](_0x543244['shift']());}}}(a502_0x43bc,0x6e040));var __importDefault=this&&this[a502_0x15f282(0x1a9)]||function(_0x5ccb3d){const _0x155727=a502_0x15f282;return _0x5ccb3d&&_0x5ccb3d[_0x155727(0x1ae)]?_0x5ccb3d:{'default':_0x5ccb3d};};function a502_0x43bc(){const _0x123e58=['findOne','1zcVIUu','company-','notification','__esModule','ticket','4061504gOadjO','ERR_CREATING_MESSAGE','name','../../models/Message','extraInfo','default','1804lceDMF','tags','-appMessage','wid','13707ENYspg','12pFPCXr','create','emit','4461919JAbRnk','761062vCeFmY','630756FtXPmJ','color','queueId','1261475aMpzep','5169fiUcdp','update','../../models/Whatsapp','ticketId','4930XnyKHu','contact','../../models/Contact','PVT','toString','getIO','ticketImported','defineProperty','../../models/Ticket','__importDefault'];a502_0x43bc=function(){return _0x123e58;};return a502_0x43bc();}Object[a502_0x15f282(0x1a7)](exports,a502_0x15f282(0x1ae),{'value':!![]});const socket_1=require('../../libs/socket'),Contact_1=__importDefault(require(a502_0x15f282(0x1ca))),Message_1=__importDefault(require(a502_0x15f282(0x1b3))),Queue_1=__importDefault(require('../../models/Queue')),Ticket_1=__importDefault(require(a502_0x15f282(0x1a8))),User_1=__importDefault(require('../../models/User')),Whatsapp_1=__importDefault(require(a502_0x15f282(0x1c6))),CreateMessageService=async({messageData:_0xc730fe,companyId:_0x3581c8})=>{const _0x392dda=a502_0x15f282;await Message_1[_0x392dda(0x1b5)]['upsert']({..._0xc730fe,'companyId':_0x3581c8});const _0x2ba2a3=await Message_1[_0x392dda(0x1b5)][_0x392dda(0x1aa)]({'where':{'wid':_0xc730fe[_0x392dda(0x1b9)],'companyId':_0x3581c8},'include':[_0x392dda(0x1c9),{'model':Ticket_1[_0x392dda(0x1b5)],'as':'ticket','include':[{'model':Contact_1[_0x392dda(0x1b5)],'attributes':['id',_0x392dda(0x1b2),'companyId','urlPicture'],'include':[_0x392dda(0x1b4),_0x392dda(0x1b7)]},{'model':Queue_1[_0x392dda(0x1b5)],'attributes':['id',_0x392dda(0x1b2),_0x392dda(0x1c1)]},{'model':Whatsapp_1[_0x392dda(0x1b5)],'attributes':['id',_0x392dda(0x1b2)]},{'model':User_1[_0x392dda(0x1b5)],'attributes':['id',_0x392dda(0x1b2)]}]},{'model':Message_1[_0x392dda(0x1b5)],'as':'quotedMsg','include':[_0x392dda(0x1c9)]}]});_0x2ba2a3[_0x392dda(0x1af)][_0x392dda(0x1c2)]!==null&&_0x2ba2a3['queueId']===null&&await _0x2ba2a3['update']({'queueId':_0x2ba2a3[_0x392dda(0x1af)][_0x392dda(0x1c2)]});_0x2ba2a3['isPrivate']&&await _0x2ba2a3[_0x392dda(0x1c5)]({'wid':_0x392dda(0x1cb)+_0x2ba2a3['id']});if(!_0x2ba2a3)throw new Error(_0x392dda(0x1b1));const _0xe4d3d1=(0x0,socket_1[_0x392dda(0x1cd)])();return!_0xc730fe?.[_0x392dda(0x1a6)]&&_0xe4d3d1['to'](_0x2ba2a3[_0x392dda(0x1c7)][_0x392dda(0x1cc)]())['to'](_0x2ba2a3[_0x392dda(0x1af)]['status'])['to'](_0x392dda(0x1ad))[_0x392dda(0x1bd)](_0x392dda(0x1ac)+_0x3581c8+_0x392dda(0x1b8),{'action':_0x392dda(0x1bc),'message':_0x2ba2a3,'ticket':_0x2ba2a3['ticket'],'contact':_0x2ba2a3[_0x392dda(0x1af)][_0x392dda(0x1c9)]}),_0x2ba2a3;};exports['default']=CreateMessageService;