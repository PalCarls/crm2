'use strict';function a509_0x3719(){const _0x28b266=['color','default','ERR_CREATING_MESSAGE','name','ticketImported','-appMessage','create','16SBsaHZ','127298wmtXSG','6741VyqPIh','findOne','queueId','975660heRZtn','13119KzCFfk','6LBmMqi','company-','quotedMsg','tags','ticketId','PVT','../../models/User','wid','ticket','notification','toString','companyId','status','../../models/Queue','629558mPomGF','../../models/Whatsapp','contact','getIO','96tDivus','834786PnBkgu','__esModule','71555arwWTg'];a509_0x3719=function(){return _0x28b266;};return a509_0x3719();}const a509_0x4d5547=a509_0x1095;function a509_0x1095(_0x5678db,_0x230024){const _0x37192e=a509_0x3719();return a509_0x1095=function(_0x10958b,_0x514292){_0x10958b=_0x10958b-0xa1;let _0x58fe43=_0x37192e[_0x10958b];return _0x58fe43;},a509_0x1095(_0x5678db,_0x230024);}(function(_0x2e2cdf,_0x144fbb){const _0x41853a=a509_0x1095,_0x3c0a51=_0x2e2cdf();while(!![]){try{const _0x53ccc0=-parseInt(_0x41853a(0xab))/0x1+parseInt(_0x41853a(0xbf))/0x2+parseInt(_0x41853a(0xb0))/0x3*(-parseInt(_0x41853a(0xaa))/0x4)+-parseInt(_0x41853a(0xa2))/0x5*(-parseInt(_0x41853a(0xb1))/0x6)+-parseInt(_0x41853a(0xac))/0x7*(parseInt(_0x41853a(0xc3))/0x8)+parseInt(_0x41853a(0xc4))/0x9+parseInt(_0x41853a(0xaf))/0xa;if(_0x53ccc0===_0x144fbb)break;else _0x3c0a51['push'](_0x3c0a51['shift']());}catch(_0x35733e){_0x3c0a51['push'](_0x3c0a51['shift']());}}}(a509_0x3719,0x58a38));var __importDefault=this&&this['__importDefault']||function(_0x5a973f){const _0x394c4c=a509_0x1095;return _0x5a973f&&_0x5a973f[_0x394c4c(0xa1)]?_0x5a973f:{'default':_0x5a973f};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const socket_1=require('../../libs/socket'),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require(a509_0x4d5547(0xbe))),Ticket_1=__importDefault(require('../../models/Ticket')),User_1=__importDefault(require(a509_0x4d5547(0xb7))),Whatsapp_1=__importDefault(require(a509_0x4d5547(0xc0))),CreateMessageService=async({messageData:_0x3ca51b,companyId:_0x288b77})=>{const _0x22b692=a509_0x4d5547;await Message_1[_0x22b692(0xa4)]['upsert']({..._0x3ca51b,'companyId':_0x288b77});const _0x38fa9e=await Message_1[_0x22b692(0xa4)][_0x22b692(0xad)]({'where':{'wid':_0x3ca51b[_0x22b692(0xb8)],'companyId':_0x288b77},'include':[_0x22b692(0xc1),{'model':Ticket_1['default'],'as':_0x22b692(0xb9),'include':[{'model':Contact_1[_0x22b692(0xa4)],'attributes':['id',_0x22b692(0xa6),_0x22b692(0xbc),'urlPicture'],'include':['extraInfo',_0x22b692(0xb4)]},{'model':Queue_1['default'],'attributes':['id',_0x22b692(0xa6),_0x22b692(0xa3)]},{'model':Whatsapp_1[_0x22b692(0xa4)],'attributes':['id',_0x22b692(0xa6)]},{'model':User_1['default'],'attributes':['id','name']}]},{'model':Message_1[_0x22b692(0xa4)],'as':_0x22b692(0xb3),'include':[_0x22b692(0xc1)]}]});_0x38fa9e[_0x22b692(0xb9)]['queueId']!==null&&_0x38fa9e['queueId']===null&&await _0x38fa9e['update']({'queueId':_0x38fa9e['ticket'][_0x22b692(0xae)]});_0x38fa9e['isPrivate']&&await _0x38fa9e['update']({'wid':_0x22b692(0xb6)+_0x38fa9e['id']});if(!_0x38fa9e)throw new Error(_0x22b692(0xa5));const _0x5ac3df=(0x0,socket_1[_0x22b692(0xc2)])();return!_0x3ca51b?.[_0x22b692(0xa7)]&&_0x5ac3df['to'](_0x38fa9e[_0x22b692(0xb5)][_0x22b692(0xbb)]())['to'](_0x38fa9e[_0x22b692(0xb9)][_0x22b692(0xbd)])['to'](_0x22b692(0xba))['emit'](_0x22b692(0xb2)+_0x288b77+_0x22b692(0xa8),{'action':_0x22b692(0xa9),'message':_0x38fa9e,'ticket':_0x38fa9e[_0x22b692(0xb9)],'contact':_0x38fa9e['ticket'][_0x22b692(0xc1)]}),_0x38fa9e;};exports[a509_0x4d5547(0xa4)]=CreateMessageService;