'use strict';const a502_0x494b8f=a502_0x45ab;(function(_0x4b4750,_0x54c4a3){const _0x1de5c3=a502_0x45ab,_0x5272aa=_0x4b4750();while(!![]){try{const _0x239fac=-parseInt(_0x1de5c3(0x188))/0x1+parseInt(_0x1de5c3(0x187))/0x2+parseInt(_0x1de5c3(0x198))/0x3*(parseInt(_0x1de5c3(0x1a1))/0x4)+parseInt(_0x1de5c3(0x19e))/0x5*(parseInt(_0x1de5c3(0x1a6))/0x6)+parseInt(_0x1de5c3(0x1a3))/0x7*(parseInt(_0x1de5c3(0x19a))/0x8)+parseInt(_0x1de5c3(0x194))/0x9+-parseInt(_0x1de5c3(0x1a4))/0xa*(parseInt(_0x1de5c3(0x191))/0xb);if(_0x239fac===_0x54c4a3)break;else _0x5272aa['push'](_0x5272aa['shift']());}catch(_0x5101f5){_0x5272aa['push'](_0x5272aa['shift']());}}}(a502_0x4544,0xc485a));function a502_0x4544(){const _0x23aa57=['7RisvXy','1526900hrEJAi','../../models/Whatsapp','18RDCrFz','company-','__esModule','__importDefault','contact','findOne','defineProperty','notification','1613854pSWOYz','1547503jyPxFI','wid','queueId','getIO','create','ticket','update','companyId','ticketImported','88eCRFMP','status','emit','6168654sDXqEE','upsert','name','../../models/Contact','6iLtjJT','urlPicture','6578928oIwOkB','../../models/User','color','PVT','64700nSxMFy','default','toString','2440916XflSyc','tags'];a502_0x4544=function(){return _0x23aa57;};return a502_0x4544();}var __importDefault=this&&this[a502_0x494b8f(0x1a9)]||function(_0x503312){const _0x11b820=a502_0x494b8f;return _0x503312&&_0x503312[_0x11b820(0x1a8)]?_0x503312:{'default':_0x503312};};function a502_0x45ab(_0x9e7f2,_0x567c55){const _0x454402=a502_0x4544();return a502_0x45ab=function(_0x45ab45,_0x3c8c46){_0x45ab45=_0x45ab45-0x183;let _0x2dc238=_0x454402[_0x45ab45];return _0x2dc238;},a502_0x45ab(_0x9e7f2,_0x567c55);}Object[a502_0x494b8f(0x185)](exports,a502_0x494b8f(0x1a8),{'value':!![]});const socket_1=require('../../libs/socket'),Contact_1=__importDefault(require(a502_0x494b8f(0x197))),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require('../../models/Queue')),Ticket_1=__importDefault(require('../../models/Ticket')),User_1=__importDefault(require(a502_0x494b8f(0x19b))),Whatsapp_1=__importDefault(require(a502_0x494b8f(0x1a5))),CreateMessageService=async({messageData:_0x336d67,companyId:_0x2b9bfc})=>{const _0x25b85e=a502_0x494b8f;await Message_1['default'][_0x25b85e(0x195)]({..._0x336d67,'companyId':_0x2b9bfc});const _0x598ebd=await Message_1[_0x25b85e(0x19f)][_0x25b85e(0x184)]({'where':{'wid':_0x336d67[_0x25b85e(0x189)],'companyId':_0x2b9bfc},'include':['contact',{'model':Ticket_1[_0x25b85e(0x19f)],'as':_0x25b85e(0x18d),'include':[{'model':Contact_1[_0x25b85e(0x19f)],'attributes':['id',_0x25b85e(0x196),_0x25b85e(0x18f),_0x25b85e(0x199)],'include':['extraInfo',_0x25b85e(0x1a2)]},{'model':Queue_1[_0x25b85e(0x19f)],'attributes':['id',_0x25b85e(0x196),_0x25b85e(0x19c)]},{'model':Whatsapp_1['default'],'attributes':['id',_0x25b85e(0x196)]},{'model':User_1['default'],'attributes':['id','name']}]},{'model':Message_1[_0x25b85e(0x19f)],'as':'quotedMsg','include':[_0x25b85e(0x183)]}]});_0x598ebd[_0x25b85e(0x18d)][_0x25b85e(0x18a)]!==null&&_0x598ebd[_0x25b85e(0x18a)]===null&&await _0x598ebd['update']({'queueId':_0x598ebd[_0x25b85e(0x18d)][_0x25b85e(0x18a)]});_0x598ebd['isPrivate']&&await _0x598ebd[_0x25b85e(0x18e)]({'wid':_0x25b85e(0x19d)+_0x598ebd['id']});if(!_0x598ebd)throw new Error('ERR_CREATING_MESSAGE');const _0x1642dc=(0x0,socket_1[_0x25b85e(0x18b)])();return!_0x336d67?.[_0x25b85e(0x190)]&&_0x1642dc['to'](_0x598ebd['ticketId'][_0x25b85e(0x1a0)]())['to'](_0x598ebd[_0x25b85e(0x18d)][_0x25b85e(0x192)])['to'](_0x25b85e(0x186))[_0x25b85e(0x193)](_0x25b85e(0x1a7)+_0x2b9bfc+'-appMessage',{'action':_0x25b85e(0x18c),'message':_0x598ebd,'ticket':_0x598ebd[_0x25b85e(0x18d)],'contact':_0x598ebd[_0x25b85e(0x18d)][_0x25b85e(0x183)]}),_0x598ebd;};exports[a502_0x494b8f(0x19f)]=CreateMessageService;