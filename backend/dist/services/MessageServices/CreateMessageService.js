'use strict';function a455_0x41e2(){const _0x2a3aa9=['10iYviib','wid','PVT','-appMessage','1300607JYasWJ','1580900lEhmqh','889587qFBsGq','notification','status','1351624GpEzhz','queueId','ticket','toString','../../models/Message','queue','3NwlMyB','findOne','__esModule','emit','1270738hNqpDS','9659280lnjBpT','update','default','contact','2920232AuIJfC','isPrivate','../../libs/socket','getIO','quotedMsg','../../models/Ticket'];a455_0x41e2=function(){return _0x2a3aa9;};return a455_0x41e2();}const a455_0x1c8d40=a455_0xf0c8;(function(_0x5dd777,_0x1fe9d1){const _0x573ab9=a455_0xf0c8,_0x26c480=_0x5dd777();while(!![]){try{const _0x5acb16=parseInt(_0x573ab9(0x75))/0x1+parseInt(_0x573ab9(0x83))/0x2*(-parseInt(_0x573ab9(0x7f))/0x3)+parseInt(_0x573ab9(0x6a))/0x4*(parseInt(_0x573ab9(0x70))/0x5)+-parseInt(_0x573ab9(0x84))/0x6+-parseInt(_0x573ab9(0x74))/0x7+parseInt(_0x573ab9(0x79))/0x8+parseInt(_0x573ab9(0x76))/0x9;if(_0x5acb16===_0x1fe9d1)break;else _0x26c480['push'](_0x26c480['shift']());}catch(_0x4d7142){_0x26c480['push'](_0x26c480['shift']());}}}(a455_0x41e2,0xd64c2));function a455_0xf0c8(_0x1f0032,_0x2b1a64){const _0x41e26a=a455_0x41e2();return a455_0xf0c8=function(_0xf0c87b,_0x350ceb){_0xf0c87b=_0xf0c87b-0x67;let _0x40ae6e=_0x41e26a[_0xf0c87b];return _0x40ae6e;},a455_0xf0c8(_0x1f0032,_0x2b1a64);}var __importDefault=this&&this['__importDefault']||function(_0x522052){const _0x599721=a455_0xf0c8;return _0x522052&&_0x522052[_0x599721(0x81)]?_0x522052:{'default':_0x522052};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const socket_1=require(a455_0x1c8d40(0x6c)),Message_1=__importDefault(require(a455_0x1c8d40(0x7d))),Ticket_1=__importDefault(require(a455_0x1c8d40(0x6f))),CreateMessageService=async({messageData:_0x5b6548,companyId:_0x91f672})=>{const _0x18c033=a455_0x1c8d40;await Message_1[_0x18c033(0x68)]['upsert']({..._0x5b6548,'companyId':_0x91f672});const _0x366543=await Message_1[_0x18c033(0x68)][_0x18c033(0x80)]({'where':{'wid':_0x5b6548[_0x18c033(0x71)],'companyId':_0x91f672},'include':[_0x18c033(0x69),{'model':Ticket_1['default'],'as':_0x18c033(0x7b),'include':[_0x18c033(0x69),_0x18c033(0x7e)]},{'model':Message_1[_0x18c033(0x68)],'as':_0x18c033(0x6e),'include':[_0x18c033(0x69)]}]});_0x366543[_0x18c033(0x7b)][_0x18c033(0x7a)]!==null&&_0x366543[_0x18c033(0x7a)]===null&&await _0x366543[_0x18c033(0x67)]({'queueId':_0x366543[_0x18c033(0x7b)]['queueId']});_0x366543[_0x18c033(0x6b)]&&await _0x366543['update']({'wid':_0x18c033(0x72)+_0x366543['id']});if(!_0x366543)throw new Error('ERR_CREATING_MESSAGE');const _0x551fb9=(0x0,socket_1[_0x18c033(0x6d)])();return!_0x5b6548?.['ticketImported']&&_0x551fb9['to'](_0x366543['ticketId'][_0x18c033(0x7c)]())['to'](_0x366543[_0x18c033(0x7b)][_0x18c033(0x78)])['to'](_0x18c033(0x77))[_0x18c033(0x82)]('company-'+_0x91f672+_0x18c033(0x73),{'action':'create','message':_0x366543,'ticket':_0x366543[_0x18c033(0x7b)],'contact':_0x366543[_0x18c033(0x7b)][_0x18c033(0x69)]}),_0x366543;};exports[a455_0x1c8d40(0x68)]=CreateMessageService;