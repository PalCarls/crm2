'use strict';const a483_0x46e739=a483_0x1ecc;(function(_0x191901,_0x1409ae){const _0x3dbc54=a483_0x1ecc,_0x1a969f=_0x191901();while(!![]){try{const _0x347967=parseInt(_0x3dbc54(0x216))/0x1+parseInt(_0x3dbc54(0x1f8))/0x2+-parseInt(_0x3dbc54(0x1f5))/0x3+parseInt(_0x3dbc54(0x205))/0x4*(parseInt(_0x3dbc54(0x20c))/0x5)+-parseInt(_0x3dbc54(0x202))/0x6+-parseInt(_0x3dbc54(0x21e))/0x7*(-parseInt(_0x3dbc54(0x1f6))/0x8)+parseInt(_0x3dbc54(0x1ff))/0x9;if(_0x347967===_0x1409ae)break;else _0x1a969f['push'](_0x1a969f['shift']());}catch(_0x7b6e00){_0x1a969f['push'](_0x1a969f['shift']());}}}(a483_0x275a,0x9f5ea));var __createBinding=this&&this[a483_0x46e739(0x1fa)]||(Object[a483_0x46e739(0x212)]?function(_0x5a6bb3,_0x10339c,_0x5517e7,_0x4d0aab){const _0x1bf79e=a483_0x46e739;if(_0x4d0aab===undefined)_0x4d0aab=_0x5517e7;var _0x1bfe1a=Object[_0x1bf79e(0x21c)](_0x10339c,_0x5517e7);(!_0x1bfe1a||('get'in _0x1bfe1a?!_0x10339c['__esModule']:_0x1bfe1a[_0x1bf79e(0x21d)]||_0x1bfe1a[_0x1bf79e(0x217)]))&&(_0x1bfe1a={'enumerable':!![],'get':function(){return _0x10339c[_0x5517e7];}}),Object[_0x1bf79e(0x201)](_0x5a6bb3,_0x4d0aab,_0x1bfe1a);}:function(_0x17f71c,_0x400c8b,_0x5236cb,_0x20e8ba){if(_0x20e8ba===undefined)_0x20e8ba=_0x5236cb;_0x17f71c[_0x20e8ba]=_0x400c8b[_0x5236cb];}),__setModuleDefault=this&&this[a483_0x46e739(0x224)]||(Object[a483_0x46e739(0x212)]?function(_0x41261a,_0x2d5ab3){const _0x28a6f3=a483_0x46e739;Object[_0x28a6f3(0x201)](_0x41261a,'default',{'enumerable':!![],'value':_0x2d5ab3});}:function(_0xeaf8b7,_0xca22d1){const _0x5a1624=a483_0x46e739;_0xeaf8b7[_0x5a1624(0x211)]=_0xca22d1;}),__importStar=this&&this['__importStar']||function(_0x750d4b){const _0x322e9c=a483_0x46e739;if(_0x750d4b&&_0x750d4b[_0x322e9c(0x20d)])return _0x750d4b;var _0x5537b9={};if(_0x750d4b!=null){for(var _0x13258c in _0x750d4b)if(_0x13258c!=='default'&&Object[_0x322e9c(0x215)]['hasOwnProperty']['call'](_0x750d4b,_0x13258c))__createBinding(_0x5537b9,_0x750d4b,_0x13258c);}return __setModuleDefault(_0x5537b9,_0x750d4b),_0x5537b9;},__importDefault=this&&this['__importDefault']||function(_0x531b60){const _0x4dd8ce=a483_0x46e739;return _0x531b60&&_0x531b60[_0x4dd8ce(0x20d)]?_0x531b60:{'default':_0x531b60};};Object[a483_0x46e739(0x201)](exports,a483_0x46e739(0x20d),{'value':!![]});function a483_0x275a(){const _0x4a20a9=['getOwnPropertyDescriptor','writable','14vzYpZy','ERR_QUEUE_COLOR_ALREADY_EXISTS','string','reload','upsert','message','__setModuleDefault','min','1988346naHsHl','2685552PUSnHK','name','2496912tJONly','object','__createBinding','test','Check-color-exists','findOne','./ShowQueueService','936639MbXioZ','destroy','defineProperty','5489622TULLdd','../../errors/AppError','asc','419036IVqopY','Não\x20é\x20permitido\x20alterar\x20registros\x20de\x20outra\x20empresa','sequelize','findIndex','map','../../models/Chatbot','required','5YNTqyV','__esModule','all','Check-color','schedules','default','create','ERR_QUEUE_INVALID_COLOR','update','prototype','101823ZTUTzA','configurable','ERR_QUEUE_INVALID_NAME','Check-unique-name','color','chatbots'];a483_0x275a=function(){return _0x4a20a9;};return a483_0x275a();}const sequelize_1=require(a483_0x46e739(0x207)),Yup=__importStar(require('yup')),AppError_1=__importDefault(require(a483_0x46e739(0x203))),Chatbot_1=__importDefault(require(a483_0x46e739(0x20a))),Queue_1=__importDefault(require('../../models/Queue')),ShowQueueService_1=__importDefault(require(a483_0x46e739(0x1fe))),UpdateQueueService=async(_0x19c6ae,_0x3f2969,_0x458dce)=>{const _0x4304d2=a483_0x46e739,{color:_0x103c5d,name:_0x579880,chatbots:_0x5306e9,ativarRoteador:_0x4f5f83,tempoRoteador:_0x12693c}=_0x3f2969,_0x3044ff=Yup[_0x4304d2(0x1f9)]()['shape']({'name':Yup[_0x4304d2(0x220)]()[_0x4304d2(0x1f4)](0x2,_0x4304d2(0x218))['test'](_0x4304d2(0x219),'ERR_QUEUE_NAME_ALREADY_EXISTS',async _0x35f5c2=>{const _0x348b5d=_0x4304d2;if(_0x35f5c2){const _0x3387cf=await Queue_1[_0x348b5d(0x211)][_0x348b5d(0x1fd)]({'where':{'name':_0x35f5c2,'id':{[sequelize_1['Op']['ne']]:_0x19c6ae},'companyId':_0x458dce}});return!_0x3387cf;}return!![];}),'color':Yup[_0x4304d2(0x220)]()[_0x4304d2(0x20b)](_0x4304d2(0x213))[_0x4304d2(0x1fb)](_0x4304d2(0x20f),_0x4304d2(0x213),async _0x1f6f01=>{if(_0x1f6f01){const _0xe8f221=/^#[0-9a-f]{3,6}$/i;return _0xe8f221['test'](_0x1f6f01);}return!![];})[_0x4304d2(0x1fb)](_0x4304d2(0x1fc),_0x4304d2(0x21f),async _0x2efd87=>{if(_0x2efd87){const _0x45d7b1=await Queue_1['default']['findOne']({'where':{'color':_0x2efd87,'id':{[sequelize_1['Op']['ne']]:_0x19c6ae},'companyId':_0x458dce}});return!_0x45d7b1;}return!![];})});try{await _0x3044ff['validate']({'color':_0x103c5d,'name':_0x579880});}catch(_0x4e108e){throw new AppError_1[(_0x4304d2(0x211))](_0x4e108e[_0x4304d2(0x223)]);}const _0xd2c77a=await(0x0,ShowQueueService_1[_0x4304d2(0x211)])(_0x19c6ae,_0x458dce);if(_0xd2c77a['companyId']!==_0x458dce)throw new AppError_1[(_0x4304d2(0x211))](_0x4304d2(0x206));return _0x5306e9&&(await Promise['all'](_0x5306e9[_0x4304d2(0x209)](async _0x1e62da=>{const _0x524116=_0x4304d2;await Chatbot_1[_0x524116(0x211)][_0x524116(0x222)]({..._0x1e62da,'queueId':_0xd2c77a['id']});})),await Promise[_0x4304d2(0x20e)](_0xd2c77a[_0x4304d2(0x21b)][_0x4304d2(0x209)](async _0x189455=>{const _0x115bfe=_0x4304d2,_0x38d3d8=_0x5306e9[_0x115bfe(0x208)](_0x5593ff=>_0x5593ff['id']===_0x189455['id']);_0x38d3d8===-0x1&&await Chatbot_1[_0x115bfe(0x211)][_0x115bfe(0x200)]({'where':{'id':_0x189455['id']}});}))),await _0xd2c77a[_0x4304d2(0x214)](_0x3f2969),await _0xd2c77a[_0x4304d2(0x221)]({'attributes':['id',_0x4304d2(0x21a),_0x4304d2(0x1f7),'greetingMessage',_0x4304d2(0x210)],'include':[{'model':Chatbot_1[_0x4304d2(0x211)],'as':_0x4304d2(0x21b),'order':[[{'model':Chatbot_1[_0x4304d2(0x211)],'as':_0x4304d2(0x21b)},'id',_0x4304d2(0x204)],['id','ASC']]}],'order':[[{'model':Chatbot_1[_0x4304d2(0x211)],'as':_0x4304d2(0x21b)},'id',_0x4304d2(0x204)],['id','ASC']]}),_0xd2c77a;};function a483_0x1ecc(_0x55462b,_0xb0bba1){const _0x275ad9=a483_0x275a();return a483_0x1ecc=function(_0x1eccd1,_0x178061){_0x1eccd1=_0x1eccd1-0x1f4;let _0x31fc8b=_0x275ad9[_0x1eccd1];return _0x31fc8b;},a483_0x1ecc(_0x55462b,_0xb0bba1);}exports[a483_0x46e739(0x211)]=UpdateQueueService;