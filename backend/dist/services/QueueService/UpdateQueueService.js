'use strict';function a542_0x2e83(){const _0x428404=['message','__importDefault','../../models/User','asc','Check-unique-name','ERR_QUEUE_INVALID_NAME','companyId','ERR_QUEUE_INVALID_COLOR','176676HfoXpk','40sdSwYd','ERR_QUEUE_COLOR_ALREADY_EXISTS','yup','293664ddtGNc','object','reload','user','map','Check-color','destroy','1029600OdNHms','../../models/Chatbot','876672uSmuNs','1217808QSyVOR','3ywuhmI','chatbots','__esModule','upsert','default','150946deUTDy','2lJnQjk','Check-color-exists','test','min','string','defineProperty','findIndex','findOne','all','../../models/Queue','1204075qQGOLq','shape','ASC','get','update','getOwnPropertyDescriptor','configurable','Não\x20é\x20permitido\x20alterar\x20registros\x20de\x20outra\x20empresa','required','hasOwnProperty','create','prototype'];a542_0x2e83=function(){return _0x428404;};return a542_0x2e83();}const a542_0x30d78a=a542_0x18be;(function(_0x21c57b,_0x654078){const _0x51a30f=a542_0x18be,_0x19d42d=_0x21c57b();while(!![]){try{const _0x12e01c=parseInt(_0x51a30f(0xf8))/0x1*(parseInt(_0x51a30f(0xf9))/0x2)+-parseInt(_0x51a30f(0xf3))/0x3*(parseInt(_0x51a30f(0xe4))/0x4)+parseInt(_0x51a30f(0xd0))/0x5+-parseInt(_0x51a30f(0xf2))/0x6+parseInt(_0x51a30f(0xe8))/0x7*(-parseInt(_0x51a30f(0xe5))/0x8)+parseInt(_0x51a30f(0xf1))/0x9+parseInt(_0x51a30f(0xef))/0xa;if(_0x12e01c===_0x654078)break;else _0x19d42d['push'](_0x19d42d['shift']());}catch(_0x18581e){_0x19d42d['push'](_0x19d42d['shift']());}}}(a542_0x2e83,0x21040));var __createBinding=this&&this['__createBinding']||(Object[a542_0x30d78a(0xda)]?function(_0x323af3,_0x38452b,_0x5b55dd,_0x517c0e){const _0xfc3725=a542_0x30d78a;if(_0x517c0e===undefined)_0x517c0e=_0x5b55dd;var _0x323645=Object[_0xfc3725(0xd5)](_0x38452b,_0x5b55dd);(!_0x323645||(_0xfc3725(0xd3)in _0x323645?!_0x38452b[_0xfc3725(0xf5)]:_0x323645['writable']||_0x323645[_0xfc3725(0xd6)]))&&(_0x323645={'enumerable':!![],'get':function(){return _0x38452b[_0x5b55dd];}}),Object[_0xfc3725(0xfe)](_0x323af3,_0x517c0e,_0x323645);}:function(_0x15527a,_0x4dddd8,_0x31bf0d,_0xf94310){if(_0xf94310===undefined)_0xf94310=_0x31bf0d;_0x15527a[_0xf94310]=_0x4dddd8[_0x31bf0d];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a542_0x30d78a(0xda)]?function(_0x2cdabe,_0x9f72e8){const _0x47529e=a542_0x30d78a;Object['defineProperty'](_0x2cdabe,_0x47529e(0xf7),{'enumerable':!![],'value':_0x9f72e8});}:function(_0x3a550a,_0x417c25){const _0x58e352=a542_0x30d78a;_0x3a550a[_0x58e352(0xf7)]=_0x417c25;}),__importStar=this&&this['__importStar']||function(_0x262e09){const _0x1197ab=a542_0x30d78a;if(_0x262e09&&_0x262e09[_0x1197ab(0xf5)])return _0x262e09;var _0x27fcac={};if(_0x262e09!=null){for(var _0x382381 in _0x262e09)if(_0x382381!==_0x1197ab(0xf7)&&Object[_0x1197ab(0xdb)][_0x1197ab(0xd9)]['call'](_0x262e09,_0x382381))__createBinding(_0x27fcac,_0x262e09,_0x382381);}return __setModuleDefault(_0x27fcac,_0x262e09),_0x27fcac;},__importDefault=this&&this[a542_0x30d78a(0xdd)]||function(_0x17eb28){return _0x17eb28&&_0x17eb28['__esModule']?_0x17eb28:{'default':_0x17eb28};};Object['defineProperty'](exports,a542_0x30d78a(0xf5),{'value':!![]});const sequelize_1=require('sequelize'),Yup=__importStar(require(a542_0x30d78a(0xe7))),AppError_1=__importDefault(require('../../errors/AppError')),Chatbot_1=__importDefault(require(a542_0x30d78a(0xf0))),Queue_1=__importDefault(require(a542_0x30d78a(0xcf))),ShowQueueService_1=__importDefault(require('./ShowQueueService')),User_1=__importDefault(require(a542_0x30d78a(0xde))),UpdateQueueService=async(_0x4bb15d,_0x3c1bff,_0x154761)=>{const _0xa2fc20=a542_0x30d78a,{color:_0x4912e4,name:_0x56d69b,chatbots:_0x25abcf}=_0x3c1bff,_0x31abc6=Yup[_0xa2fc20(0xe9)]()[_0xa2fc20(0xd1)]({'name':Yup[_0xa2fc20(0xfd)]()[_0xa2fc20(0xfc)](0x2,_0xa2fc20(0xe1))['test'](_0xa2fc20(0xe0),'ERR_QUEUE_NAME_ALREADY_EXISTS',async _0x45ba35=>{const _0x1a0bb0=_0xa2fc20;if(_0x45ba35){const _0x2c1cd3=await Queue_1['default'][_0x1a0bb0(0x100)]({'where':{'name':_0x45ba35,'id':{[sequelize_1['Op']['ne']]:_0x4bb15d},'companyId':_0x154761}});return!_0x2c1cd3;}return!![];}),'color':Yup[_0xa2fc20(0xfd)]()[_0xa2fc20(0xd8)](_0xa2fc20(0xe3))['test'](_0xa2fc20(0xed),'ERR_QUEUE_INVALID_COLOR',async _0x374381=>{const _0x41369f=_0xa2fc20;if(_0x374381){const _0x545bce=/^#[0-9a-f]{3,6}$/i;return _0x545bce[_0x41369f(0xfb)](_0x374381);}return!![];})[_0xa2fc20(0xfb)](_0xa2fc20(0xfa),_0xa2fc20(0xe6),async _0x10f156=>{const _0x1d155d=_0xa2fc20;if(_0x10f156){const _0xb363cb=await Queue_1[_0x1d155d(0xf7)][_0x1d155d(0x100)]({'where':{'color':_0x10f156,'id':{[sequelize_1['Op']['ne']]:_0x4bb15d},'companyId':_0x154761}});return!_0xb363cb;}return!![];})});try{await _0x31abc6['validate']({'color':_0x4912e4,'name':_0x56d69b});}catch(_0x281e5c){throw new AppError_1['default'](_0x281e5c[_0xa2fc20(0xdc)]);}const _0x118bd9=await(0x0,ShowQueueService_1[_0xa2fc20(0xf7)])(_0x4bb15d,_0x154761);if(_0x118bd9[_0xa2fc20(0xe2)]!==_0x154761)throw new AppError_1[(_0xa2fc20(0xf7))](_0xa2fc20(0xd7));return _0x25abcf&&(await Promise[_0xa2fc20(0x101)](_0x25abcf['map'](async _0x168744=>{const _0x44092a=_0xa2fc20;await Chatbot_1[_0x44092a(0xf7)][_0x44092a(0xf6)]({..._0x168744,'queueId':_0x118bd9['id']});})),await Promise[_0xa2fc20(0x101)](_0x118bd9[_0xa2fc20(0xf4)][_0xa2fc20(0xec)](async _0x384801=>{const _0x49e446=_0xa2fc20,_0x186d71=_0x25abcf[_0x49e446(0xff)](_0x471d64=>_0x471d64['id']===_0x384801['id']);_0x186d71===-0x1&&await Chatbot_1[_0x49e446(0xf7)][_0x49e446(0xee)]({'where':{'id':_0x384801['id']}});}))),await _0x118bd9[_0xa2fc20(0xd4)](_0x3c1bff),await _0x118bd9[_0xa2fc20(0xea)]({'include':[{'model':Chatbot_1[_0xa2fc20(0xf7)],'as':_0xa2fc20(0xf4),'include':[{'model':User_1[_0xa2fc20(0xf7)],'as':_0xa2fc20(0xeb)}],'order':[[{'model':Chatbot_1[_0xa2fc20(0xf7)],'as':'chatbots'},'id','asc'],['id',_0xa2fc20(0xd2)]]}],'order':[[{'model':Chatbot_1[_0xa2fc20(0xf7)],'as':_0xa2fc20(0xf4)},'id',_0xa2fc20(0xdf)],['id',_0xa2fc20(0xd2)]]}),_0x118bd9;};function a542_0x18be(_0x8dd846,_0xd07c24){const _0x2e83e2=a542_0x2e83();return a542_0x18be=function(_0x18be9e,_0x4c6e49){_0x18be9e=_0x18be9e-0xcf;let _0x1be28b=_0x2e83e2[_0x18be9e];return _0x1be28b;},a542_0x18be(_0x8dd846,_0xd07c24);}exports['default']=UpdateQueueService;