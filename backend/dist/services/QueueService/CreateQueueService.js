'use strict';const a479_0x2e6e5f=a479_0x4aa9;function a479_0x4aa9(_0x37bb4f,_0x662f08){const _0x5bcde5=a479_0x5bcd();return a479_0x4aa9=function(_0x4aa9c5,_0x3bf01e){_0x4aa9c5=_0x4aa9c5-0x1c4;let _0x46fcdf=_0x5bcde5[_0x4aa9c5];return _0x46fcdf;},a479_0x4aa9(_0x37bb4f,_0x662f08);}function a479_0x5bcd(){const _0x3ab970=['21DRgAXg','findOne','258935DMxjTJ','__setModuleDefault','72108kXBzJa','ERR_QUEUE_INVALID_NAME','queues','Check-color','shape','ERR_QUEUE_NAME_ALREADY_EXISTS','__importStar','call','9wlPvFb','string','Número\x20máximo\x20de\x20filas\x20já\x20alcançado:\x20','validate','prototype','chatbots','getOwnPropertyDescriptor','__importDefault','test','count','4464570ufbrMO','object','1105350ePmWnf','../../models/Plan','ERR_QUEUE_COLOR_ALREADY_EXISTS','message','asc','configurable','ERR_QUEUE_INVALID_COLOR','required','../../models/Chatbot','240776Ryjwwa','default','defineProperty','50737odOaZG','__esModule','../../models/Queue','hasOwnProperty','create','882264dYbiur','21OSsDAX'];a479_0x5bcd=function(){return _0x3ab970;};return a479_0x5bcd();}(function(_0x58e26e,_0xdbe9bc){const _0x59f615=a479_0x4aa9,_0x5257bf=_0x58e26e();while(!![]){try{const _0x55dfbd=-parseInt(_0x59f615(0x1d3))/0x1+-parseInt(_0x59f615(0x1c7))/0x2+parseInt(_0x59f615(0x1d9))/0x3*(parseInt(_0x59f615(0x1d0))/0x4)+-parseInt(_0x59f615(0x1dc))/0x5+parseInt(_0x59f615(0x1de))/0x6*(-parseInt(_0x59f615(0x1da))/0x7)+parseInt(_0x59f615(0x1d8))/0x8+parseInt(_0x59f615(0x1e6))/0x9*(parseInt(_0x59f615(0x1c5))/0xa);if(_0x55dfbd===_0xdbe9bc)break;else _0x5257bf['push'](_0x5257bf['shift']());}catch(_0x29837c){_0x5257bf['push'](_0x5257bf['shift']());}}}(a479_0x5bcd,0x4607d));var __createBinding=this&&this['__createBinding']||(Object[a479_0x2e6e5f(0x1d7)]?function(_0x32b3a5,_0x28fe39,_0x3e7f74,_0x30672e){const _0x36ba7d=a479_0x2e6e5f;if(_0x30672e===undefined)_0x30672e=_0x3e7f74;var _0x48a11a=Object[_0x36ba7d(0x1ec)](_0x28fe39,_0x3e7f74);(!_0x48a11a||('get'in _0x48a11a?!_0x28fe39[_0x36ba7d(0x1d4)]:_0x48a11a['writable']||_0x48a11a[_0x36ba7d(0x1cc)]))&&(_0x48a11a={'enumerable':!![],'get':function(){return _0x28fe39[_0x3e7f74];}}),Object[_0x36ba7d(0x1d2)](_0x32b3a5,_0x30672e,_0x48a11a);}:function(_0x3f11a8,_0x326d49,_0x179c1c,_0x1a38ab){if(_0x1a38ab===undefined)_0x1a38ab=_0x179c1c;_0x3f11a8[_0x1a38ab]=_0x326d49[_0x179c1c];}),__setModuleDefault=this&&this[a479_0x2e6e5f(0x1dd)]||(Object[a479_0x2e6e5f(0x1d7)]?function(_0x4f5237,_0x3c9540){Object['defineProperty'](_0x4f5237,'default',{'enumerable':!![],'value':_0x3c9540});}:function(_0x173e8c,_0x38f505){const _0x246d0c=a479_0x2e6e5f;_0x173e8c[_0x246d0c(0x1d1)]=_0x38f505;}),__importStar=this&&this[a479_0x2e6e5f(0x1e4)]||function(_0x1a5a04){const _0x118d03=a479_0x2e6e5f;if(_0x1a5a04&&_0x1a5a04[_0x118d03(0x1d4)])return _0x1a5a04;var _0x19f510={};if(_0x1a5a04!=null){for(var _0x688a88 in _0x1a5a04)if(_0x688a88!==_0x118d03(0x1d1)&&Object[_0x118d03(0x1ea)][_0x118d03(0x1d6)][_0x118d03(0x1e5)](_0x1a5a04,_0x688a88))__createBinding(_0x19f510,_0x1a5a04,_0x688a88);}return __setModuleDefault(_0x19f510,_0x1a5a04),_0x19f510;},__importDefault=this&&this[a479_0x2e6e5f(0x1ed)]||function(_0x471ec1){const _0x3f049b=a479_0x2e6e5f;return _0x471ec1&&_0x471ec1[_0x3f049b(0x1d4)]?_0x471ec1:{'default':_0x471ec1};};Object[a479_0x2e6e5f(0x1d2)](exports,a479_0x2e6e5f(0x1d4),{'value':!![]});const Yup=__importStar(require('yup')),AppError_1=__importDefault(require('../../errors/AppError')),Queue_1=__importDefault(require(a479_0x2e6e5f(0x1d5))),Company_1=__importDefault(require('../../models/Company')),Plan_1=__importDefault(require(a479_0x2e6e5f(0x1c8))),Chatbot_1=__importDefault(require(a479_0x2e6e5f(0x1cf))),CreateQueueService=async _0x3daa83=>{const _0x102683=a479_0x2e6e5f,{color:_0x5e2043,name:_0x3691bb,companyId:_0x597af6,ativarRoteador:_0x3f831e,tempoRoteador:_0x122fec}=_0x3daa83,_0x5113da=await Company_1['default'][_0x102683(0x1db)]({'where':{'id':_0x597af6},'include':[{'model':Plan_1[_0x102683(0x1d1)],'as':'plan'}]});if(_0x5113da!==null){const _0x531555=await Queue_1[_0x102683(0x1d1)][_0x102683(0x1c4)]({'where':{'companyId':_0x597af6}});if(_0x531555>=_0x5113da['plan'][_0x102683(0x1e0)])throw new AppError_1[(_0x102683(0x1d1))](_0x102683(0x1e8)+_0x531555);}const _0x1de975=Yup[_0x102683(0x1c6)]()[_0x102683(0x1e2)]({'name':Yup[_0x102683(0x1e7)]()['min'](0x2,_0x102683(0x1df))[_0x102683(0x1ce)]('ERR_QUEUE_INVALID_NAME')['test']('Check-unique-name',_0x102683(0x1e3),async _0x20bddc=>{const _0x3a7b16=_0x102683;if(_0x20bddc){const _0xc71ff3=await Queue_1['default'][_0x3a7b16(0x1db)]({'where':{'name':_0x20bddc,'companyId':_0x597af6}});return!_0xc71ff3;}return![];}),'color':Yup[_0x102683(0x1e7)]()['required'](_0x102683(0x1cd))['test'](_0x102683(0x1e1),'ERR_QUEUE_INVALID_COLOR',async _0x455a15=>{const _0x3b0be5=_0x102683;if(_0x455a15){const _0x1f7e86=/^#[0-9a-f]{3,6}$/i;return _0x1f7e86[_0x3b0be5(0x1ee)](_0x455a15);}return![];})[_0x102683(0x1ee)]('Check-color-exists',_0x102683(0x1c9),async _0x2872fe=>{const _0x2e8953=_0x102683;if(_0x2872fe){const _0x42ac8b=await Queue_1['default'][_0x2e8953(0x1db)]({'where':{'color':_0x2872fe,'companyId':_0x597af6}});return!_0x42ac8b;}return![];})});try{await _0x1de975[_0x102683(0x1e9)]({'color':_0x5e2043,'name':_0x3691bb});}catch(_0x4de1f9){throw new AppError_1[(_0x102683(0x1d1))](_0x4de1f9[_0x102683(0x1ca)]);}const _0xaecd2a=await Queue_1[_0x102683(0x1d1)][_0x102683(0x1d7)](_0x3daa83,{'include':[{'model':Chatbot_1[_0x102683(0x1d1)],'as':_0x102683(0x1eb),'order':[[{'model':Chatbot_1[_0x102683(0x1d1)],'as':_0x102683(0x1eb)},'id',_0x102683(0x1cb)]]}]});return _0xaecd2a;};exports[a479_0x2e6e5f(0x1d1)]=CreateQueueService;