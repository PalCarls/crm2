'use strict';function a478_0x3a82(){const _0x2ed0=['yup','__setModuleDefault','../../models/Queue','ERR_QUEUE_COLOR_ALREADY_EXISTS','get','defineProperty','asc','../../models/Chatbot','../../errors/AppError','10486640ziKikD','object','getOwnPropertyDescriptor','9489858IdjgjZ','required','Número\x20máximo\x20de\x20filas\x20já\x20alcançado:\x20','8682495EnSjWf','ERR_QUEUE_INVALID_NAME','chatbots','9569448RrRaIG','shape','1810226LCYKqH','min','prototype','7Mtsisi','../../models/Plan','create','test','__esModule','string','writable','queues','4skgyKl','5105115WbEHIg','Check-color','message','ERR_QUEUE_INVALID_COLOR','../../models/Company','default','findOne','call','__importDefault','263821PWSubb','validate','plan'];a478_0x3a82=function(){return _0x2ed0;};return a478_0x3a82();}const a478_0x460b56=a478_0x29f6;(function(_0x54dbc6,_0x3c8478){const _0x147267=a478_0x29f6,_0x59e0c0=_0x54dbc6();while(!![]){try{const _0x1896a4=parseInt(_0x147267(0x12b))/0x1+-parseInt(_0x147267(0x116))/0x2+parseInt(_0x147267(0x122))/0x3+-parseInt(_0x147267(0x121))/0x4*(-parseInt(_0x147267(0x111))/0x5)+parseInt(_0x147267(0x13a))/0x6*(-parseInt(_0x147267(0x119))/0x7)+-parseInt(_0x147267(0x137))/0x8+parseInt(_0x147267(0x114))/0x9;if(_0x1896a4===_0x3c8478)break;else _0x59e0c0['push'](_0x59e0c0['shift']());}catch(_0x51a721){_0x59e0c0['push'](_0x59e0c0['shift']());}}}(a478_0x3a82,0xec41f));function a478_0x29f6(_0x15e542,_0x133527){const _0x3a8210=a478_0x3a82();return a478_0x29f6=function(_0x29f634,_0x4c4486){_0x29f634=_0x29f634-0x110;let _0x16145c=_0x3a8210[_0x29f634];return _0x16145c;},a478_0x29f6(_0x15e542,_0x133527);}var __createBinding=this&&this['__createBinding']||(Object[a478_0x460b56(0x11b)]?function(_0x244581,_0x463c71,_0x1fcefb,_0x358c09){const _0x30c649=a478_0x460b56;if(_0x358c09===undefined)_0x358c09=_0x1fcefb;var _0x1753b9=Object[_0x30c649(0x139)](_0x463c71,_0x1fcefb);(!_0x1753b9||(_0x30c649(0x132)in _0x1753b9?!_0x463c71['__esModule']:_0x1753b9[_0x30c649(0x11f)]||_0x1753b9['configurable']))&&(_0x1753b9={'enumerable':!![],'get':function(){return _0x463c71[_0x1fcefb];}}),Object[_0x30c649(0x133)](_0x244581,_0x358c09,_0x1753b9);}:function(_0x130616,_0x6d75a7,_0x2fa098,_0x496555){if(_0x496555===undefined)_0x496555=_0x2fa098;_0x130616[_0x496555]=_0x6d75a7[_0x2fa098];}),__setModuleDefault=this&&this[a478_0x460b56(0x12f)]||(Object['create']?function(_0x1a4735,_0xf51cc9){const _0x2f7960=a478_0x460b56;Object[_0x2f7960(0x133)](_0x1a4735,_0x2f7960(0x127),{'enumerable':!![],'value':_0xf51cc9});}:function(_0x4de46c,_0x1654d9){_0x4de46c['default']=_0x1654d9;}),__importStar=this&&this['__importStar']||function(_0x41139c){const _0x5a378a=a478_0x460b56;if(_0x41139c&&_0x41139c['__esModule'])return _0x41139c;var _0xe4b3ec={};if(_0x41139c!=null){for(var _0x54931a in _0x41139c)if(_0x54931a!==_0x5a378a(0x127)&&Object[_0x5a378a(0x118)]['hasOwnProperty'][_0x5a378a(0x129)](_0x41139c,_0x54931a))__createBinding(_0xe4b3ec,_0x41139c,_0x54931a);}return __setModuleDefault(_0xe4b3ec,_0x41139c),_0xe4b3ec;},__importDefault=this&&this[a478_0x460b56(0x12a)]||function(_0xf9139b){const _0x501242=a478_0x460b56;return _0xf9139b&&_0xf9139b[_0x501242(0x11d)]?_0xf9139b:{'default':_0xf9139b};};Object['defineProperty'](exports,a478_0x460b56(0x11d),{'value':!![]});const Yup=__importStar(require(a478_0x460b56(0x12e))),AppError_1=__importDefault(require(a478_0x460b56(0x136))),Queue_1=__importDefault(require(a478_0x460b56(0x130))),Company_1=__importDefault(require(a478_0x460b56(0x126))),Plan_1=__importDefault(require(a478_0x460b56(0x11a))),Chatbot_1=__importDefault(require(a478_0x460b56(0x135))),CreateQueueService=async _0x56dfb6=>{const _0x13d1a2=a478_0x460b56,{color:_0xa032c3,name:_0x203765,companyId:_0x3084ee,ativarRoteador:_0x50dcbb,tempoRoteador:_0x177c90}=_0x56dfb6,_0x2302bc=await Company_1[_0x13d1a2(0x127)]['findOne']({'where':{'id':_0x3084ee},'include':[{'model':Plan_1[_0x13d1a2(0x127)],'as':'plan'}]});if(_0x2302bc!==null){const _0x197ff2=await Queue_1[_0x13d1a2(0x127)]['count']({'where':{'companyId':_0x3084ee}});if(_0x197ff2>=_0x2302bc[_0x13d1a2(0x12d)][_0x13d1a2(0x120)])throw new AppError_1['default'](_0x13d1a2(0x110)+_0x197ff2);}const _0x4b2c13=Yup[_0x13d1a2(0x138)]()[_0x13d1a2(0x115)]({'name':Yup[_0x13d1a2(0x11e)]()[_0x13d1a2(0x117)](0x2,_0x13d1a2(0x112))[_0x13d1a2(0x13b)](_0x13d1a2(0x112))[_0x13d1a2(0x11c)]('Check-unique-name','ERR_QUEUE_NAME_ALREADY_EXISTS',async _0x28639b=>{const _0x42962c=_0x13d1a2;if(_0x28639b){const _0x5d2f01=await Queue_1[_0x42962c(0x127)]['findOne']({'where':{'name':_0x28639b,'companyId':_0x3084ee}});return!_0x5d2f01;}return![];}),'color':Yup[_0x13d1a2(0x11e)]()[_0x13d1a2(0x13b)](_0x13d1a2(0x125))[_0x13d1a2(0x11c)](_0x13d1a2(0x123),'ERR_QUEUE_INVALID_COLOR',async _0x1728be=>{const _0x5e9aa4=_0x13d1a2;if(_0x1728be){const _0x38ec9d=/^#[0-9a-f]{3,6}$/i;return _0x38ec9d[_0x5e9aa4(0x11c)](_0x1728be);}return![];})['test']('Check-color-exists',_0x13d1a2(0x131),async _0x3818b3=>{const _0x194073=_0x13d1a2;if(_0x3818b3){const _0x400550=await Queue_1[_0x194073(0x127)][_0x194073(0x128)]({'where':{'color':_0x3818b3,'companyId':_0x3084ee}});return!_0x400550;}return![];})});try{await _0x4b2c13[_0x13d1a2(0x12c)]({'color':_0xa032c3,'name':_0x203765});}catch(_0x50cfac){throw new AppError_1['default'](_0x50cfac[_0x13d1a2(0x124)]);}const _0x24c323=await Queue_1[_0x13d1a2(0x127)]['create'](_0x56dfb6,{'include':[{'model':Chatbot_1['default'],'as':_0x13d1a2(0x113),'order':[[{'model':Chatbot_1['default'],'as':_0x13d1a2(0x113)},'id',_0x13d1a2(0x134)]]}]});return _0x24c323;};exports['default']=CreateQueueService;