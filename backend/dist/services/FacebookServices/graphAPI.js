'use strict';const a480_0x3b223c=a480_0x3556;(function(_0xc99e8a,_0x5a262f){const _0x574d96=a480_0x3556,_0x2774b6=_0xc99e8a();while(!![]){try{const _0x1e3792=-parseInt(_0x574d96(0x12c))/0x1+parseInt(_0x574d96(0x135))/0x2*(parseInt(_0x574d96(0x15b))/0x3)+-parseInt(_0x574d96(0x12e))/0x4+parseInt(_0x574d96(0x15d))/0x5+-parseInt(_0x574d96(0x15c))/0x6+-parseInt(_0x574d96(0x12b))/0x7*(-parseInt(_0x574d96(0x136))/0x8)+parseInt(_0x574d96(0x145))/0x9;if(_0x1e3792===_0x5a262f)break;else _0x2774b6['push'](_0x2774b6['shift']());}catch(_0x3fde47){_0x2774b6['push'](_0x2774b6['shift']());}}}(a480_0x1689,0xb1973));var __importDefault=this&&this[a480_0x3b223c(0x12f)]||function(_0x8315ca){return _0x8315ca&&_0x8315ca['__esModule']?_0x8315ca:{'default':_0x8315ca};};Object[a480_0x3b223c(0x149)](exports,'__esModule',{'value':!![]}),exports[a480_0x3b223c(0x159)]=exports[a480_0x3b223c(0x156)]=exports['getSubscribedApps']=exports[a480_0x3b223c(0x14f)]=exports['subscribeApp']=exports[a480_0x3b223c(0x14a)]=exports['getPageProfile']=exports[a480_0x3b223c(0x122)]=exports[a480_0x3b223c(0x123)]=exports[a480_0x3b223c(0x126)]=exports[a480_0x3b223c(0x141)]=exports[a480_0x3b223c(0x127)]=exports[a480_0x3b223c(0x151)]=exports['getAccessToken']=void 0x0;function a480_0x3556(_0x3db298,_0x3588ea){const _0x1689bc=a480_0x1689();return a480_0x3556=function(_0x35569f,_0x48aada){_0x35569f=_0x35569f-0x122;let _0x4016db=_0x1689bc[_0x35569f];return _0x4016db;},a480_0x3556(_0x3db298,_0x3588ea);}const axios_1=__importDefault(require(a480_0x3b223c(0x155))),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),logger_1=require(a480_0x3b223c(0x12d)),formData=new form_data_1[(a480_0x3b223c(0x125))](),apiBase=_0x3acf92=>axios_1[a480_0x3b223c(0x125)][a480_0x3b223c(0x138)]({'baseURL':a480_0x3b223c(0x13a),'params':{'access_token':_0x3acf92}}),getAccessToken=async()=>{const _0x4b5ddb=a480_0x3b223c,{data:_0x314995}=await axios_1['default'][_0x4b5ddb(0x153)]('https://graph.facebook.com/v13.0/oauth/access_token',{'params':{'client_id':process[_0x4b5ddb(0x148)][_0x4b5ddb(0x158)],'client_secret':process[_0x4b5ddb(0x148)]['FACEBOOK_APP_SECRET'],'grant_type':_0x4b5ddb(0x129)}});return _0x314995[_0x4b5ddb(0x143)];};exports['getAccessToken']=getAccessToken;const markSeen=async(_0x5df2fd,_0x5a7ee7)=>{const _0x3868f6=a480_0x3b223c;await apiBase(_0x5a7ee7)[_0x3868f6(0x152)](_0x5df2fd+'/messages',{'recipient':{'id':_0x5df2fd},'sender_action':_0x3868f6(0x137)});};exports[a480_0x3b223c(0x151)]=markSeen;const sendText=async(_0x17a72b,_0x5d4989,_0xb2696e)=>{const _0x2ba60b=a480_0x3b223c;try{const {data:_0x1902bf}=await apiBase(_0xb2696e)[_0x2ba60b(0x152)](_0x2ba60b(0x13f),{'recipient':{'id':_0x17a72b},'message':{'text':''+_0x5d4989}});return _0x1902bf;}catch(_0x5e507f){console[_0x2ba60b(0x130)](_0x5e507f);}};exports['sendText']=sendText;const sendAttachmentFromUrl=async(_0x407459,_0x30af4f,_0xc0c103,_0x593deb)=>{const _0x51980e=a480_0x3b223c;try{const {data:_0x3a78ea}=await apiBase(_0x593deb)[_0x51980e(0x152)](_0x51980e(0x13f),{'recipient':{'id':_0x407459},'message':{'attachment':{'type':_0xc0c103,'payload':{'url':_0x30af4f}}}});return _0x3a78ea;}catch(_0x1be951){console[_0x51980e(0x130)](_0x1be951);}};exports[a480_0x3b223c(0x141)]=sendAttachmentFromUrl;const sendAttachment=async(_0x5e4586,_0x3effa4,_0x3b9c73,_0x213453)=>{const _0x235e1d=a480_0x3b223c;formData[_0x235e1d(0x13b)](_0x235e1d(0x14b),JSON[_0x235e1d(0x15a)]({'id':_0x5e4586})),formData['append'](_0x235e1d(0x150),JSON[_0x235e1d(0x15a)]({'attachment':{'type':_0x3b9c73,'payload':{'is_reusable':!![]}}}));const _0x317dc9=(0x0,fs_1['createReadStream'])(_0x3effa4[_0x235e1d(0x132)]);formData['append'](_0x235e1d(0x13c),_0x317dc9);try{await apiBase(_0x213453)[_0x235e1d(0x152)](_0x235e1d(0x13f),formData,{'headers':{...formData[_0x235e1d(0x157)]()}});}catch(_0x2e333c){throw new Error(_0x2e333c);}};exports[a480_0x3b223c(0x126)]=sendAttachment;const genText=_0x2ab3cd=>{const _0x3bf1cc={'text':_0x2ab3cd};return _0x3bf1cc;};exports[a480_0x3b223c(0x123)]=genText;const getProfile=async(_0x2e1e97,_0x4d0ce0)=>{const _0x3e0d8b=a480_0x3b223c;try{const {data:_0xd4918c}=await apiBase(_0x4d0ce0)[_0x3e0d8b(0x153)](_0x2e1e97);return _0xd4918c;}catch(_0x53e528){console[_0x3e0d8b(0x130)](_0x53e528);throw new Error(_0x3e0d8b(0x147));}};exports[a480_0x3b223c(0x122)]=getProfile;const getPageProfile=async(_0x55b65b,_0x4d4d2c)=>{const _0x204d4b=a480_0x3b223c;try{const {data:_0x208f7a}=await apiBase(_0x4d4d2c)[_0x204d4b(0x153)](_0x55b65b+'/accounts?fields=name,access_token,instagram_business_account{id,username,profile_picture_url,name}');return _0x208f7a;}catch(_0x356497){console[_0x204d4b(0x130)](_0x356497);throw new Error('ERR_FETCHING_FB_PAGES');}};exports[a480_0x3b223c(0x14d)]=getPageProfile;const profilePsid=async(_0x1c73d7,_0x3450a9)=>{const _0x913464=a480_0x3b223c;try{const {data:_0x57e055}=await axios_1[_0x913464(0x125)][_0x913464(0x153)](_0x913464(0x13a)+_0x1c73d7+_0x913464(0x14e)+_0x3450a9);return _0x57e055;}catch(_0x5025f9){console[_0x913464(0x130)](_0x5025f9),await(0x0,exports[_0x913464(0x122)])(_0x1c73d7,_0x3450a9);}};exports['profilePsid']=profilePsid;const subscribeApp=async(_0x124468,_0x30b90f)=>{const _0x2468ba=a480_0x3b223c;try{const {data:_0x11c576}=await axios_1[_0x2468ba(0x125)]['post']('https://graph.facebook.com/v13.0/'+_0x124468+_0x2468ba(0x144)+_0x30b90f,{'subscribed_fields':[_0x2468ba(0x139),_0x2468ba(0x140),_0x2468ba(0x134),_0x2468ba(0x131),_0x2468ba(0x154)]});return _0x11c576;}catch(_0x4196e3){console[_0x2468ba(0x130)](_0x4196e3);throw new Error('ERR_SUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS');}};exports['subscribeApp']=subscribeApp;const unsubscribeApp=async(_0x4c774f,_0xc03a2f)=>{const _0x1c6caa=a480_0x3b223c;try{const {data:_0x1b7bd2}=await axios_1['default']['delete'](_0x1c6caa(0x13a)+_0x4c774f+_0x1c6caa(0x144)+_0xc03a2f);return _0x1b7bd2;}catch(_0x3f2ddf){throw new Error(_0x1c6caa(0x128));}};exports[a480_0x3b223c(0x14f)]=unsubscribeApp;const getSubscribedApps=async(_0x11468f,_0x3aac45)=>{const _0x396a53=a480_0x3b223c;try{const {data:_0x51294f}=await apiBase(_0x3aac45)[_0x396a53(0x153)](_0x11468f+_0x396a53(0x146));return _0x51294f;}catch(_0x939e1a){throw new Error(_0x396a53(0x13d));}};exports['getSubscribedApps']=getSubscribedApps;const getAccessTokenFromPage=async _0x516a67=>{const _0x384a90=a480_0x3b223c;try{if(!_0x516a67)throw new Error(_0x384a90(0x13e));const _0x43f935=await axios_1[_0x384a90(0x125)][_0x384a90(0x153)](_0x384a90(0x142),{'params':{'client_id':process[_0x384a90(0x148)][_0x384a90(0x158)],'client_secret':process[_0x384a90(0x148)][_0x384a90(0x12a)],'grant_type':_0x384a90(0x14c),'fb_exchange_token':_0x516a67}});return _0x43f935[_0x384a90(0x133)][_0x384a90(0x143)];}catch(_0x285434){console[_0x384a90(0x130)](_0x285434);throw new Error(_0x384a90(0x13e));}};function a480_0x1689(){const _0x3aa768=['1663374TCjURq','678120mgtSdG','logger','getProfile','genText','/permissions','default','sendAttachment','sendText','ERR_UNSUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','client_credentials','FACEBOOK_APP_SECRET','5873uoWOof','1303023bxDzbz','../../utils/logger','5073880RLeUyd','__importDefault','log','message_reads','path','data','message_deliveries','12hpMRti','9520PxfVRk','mark_seen','create','messages','https://graph.facebook.com/v13.0/','append','filedata','ERR_GETTING_SUBSCRIBED_APPS','ERR_FETCHING_FB_USER_TOKEN','me/messages','messaging_postbacks','sendAttachmentFromUrl','https://graph.facebook.com/v13.0/oauth/access_token','access_token','/subscribed_apps?access_token=','13334625gnubvo','/subscribed_apps','ERR_FETCHING_FB_USER_PROFILE_2','env','defineProperty','profilePsid','recipient','fb_exchange_token','getPageProfile','?access_token=','unsubscribeApp','message','markSeen','post','get','message_echoes','axios','getAccessTokenFromPage','getHeaders','FACEBOOK_APP_ID','removeApplcation','stringify','480237pYMIux'];a480_0x1689=function(){return _0x3aa768;};return a480_0x1689();}exports['getAccessTokenFromPage']=getAccessTokenFromPage;const removeApplcation=async(_0x5dce2d,_0x573ffb)=>{const _0x5aee41=a480_0x3b223c;try{await axios_1['default']['delete'](_0x5aee41(0x13a)+_0x5dce2d+_0x5aee41(0x124),{'params':{'access_token':_0x573ffb}});}catch(_0x1eb8a0){logger_1[_0x5aee41(0x15e)]['error']('ERR_REMOVING_APP_FROM_PAGE');}};exports[a480_0x3b223c(0x159)]=removeApplcation;