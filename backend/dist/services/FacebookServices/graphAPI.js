'use strict';const a399_0x4c455f=a399_0x35b6;(function(_0x1f31ec,_0x555a83){const _0x420b5c=a399_0x35b6,_0x215026=_0x1f31ec();while(!![]){try{const _0x15142d=parseInt(_0x420b5c(0x177))/0x1*(-parseInt(_0x420b5c(0x178))/0x2)+parseInt(_0x420b5c(0x168))/0x3+parseInt(_0x420b5c(0x172))/0x4*(parseInt(_0x420b5c(0x165))/0x5)+parseInt(_0x420b5c(0x146))/0x6+parseInt(_0x420b5c(0x163))/0x7*(parseInt(_0x420b5c(0x170))/0x8)+parseInt(_0x420b5c(0x17b))/0x9*(-parseInt(_0x420b5c(0x183))/0xa)+-parseInt(_0x420b5c(0x171))/0xb;if(_0x15142d===_0x555a83)break;else _0x215026['push'](_0x215026['shift']());}catch(_0x3d62d5){_0x215026['push'](_0x215026['shift']());}}}(a399_0x512b,0x865f7));var __importDefault=this&&this[a399_0x4c455f(0x157)]||function(_0x39cbbc){const _0x33c3d1=a399_0x4c455f;return _0x39cbbc&&_0x39cbbc[_0x33c3d1(0x16b)]?_0x39cbbc:{'default':_0x39cbbc};};Object['defineProperty'](exports,a399_0x4c455f(0x16b),{'value':!![]}),exports[a399_0x4c455f(0x181)]=exports[a399_0x4c455f(0x14c)]=exports[a399_0x4c455f(0x185)]=exports[a399_0x4c455f(0x153)]=exports['subscribeApp']=exports['profilePsid']=exports[a399_0x4c455f(0x155)]=exports[a399_0x4c455f(0x15a)]=exports[a399_0x4c455f(0x15b)]=exports[a399_0x4c455f(0x169)]=exports[a399_0x4c455f(0x14d)]=exports[a399_0x4c455f(0x15d)]=exports[a399_0x4c455f(0x16d)]=exports[a399_0x4c455f(0x176)]=void 0x0;const axios_1=__importDefault(require(a399_0x4c455f(0x164))),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),logger_1=require(a399_0x4c455f(0x160)),formData=new form_data_1['default'](),apiBase=_0x4ce59b=>axios_1['default'][a399_0x4c455f(0x162)]({'baseURL':a399_0x4c455f(0x161),'params':{'access_token':_0x4ce59b}}),getAccessToken=async()=>{const _0x54efed=a399_0x4c455f,{data:_0x5ee50e}=await axios_1['default'][_0x54efed(0x14b)](_0x54efed(0x14e),{'params':{'client_id':process['env'][_0x54efed(0x187)],'client_secret':process['env']['FACEBOOK_APP_SECRET'],'grant_type':_0x54efed(0x166)}});return _0x5ee50e[_0x54efed(0x174)];};exports[a399_0x4c455f(0x176)]=getAccessToken;const markSeen=async(_0x47c3bf,_0x3b9965)=>{const _0x12ab27=a399_0x4c455f;await apiBase(_0x3b9965)[_0x12ab27(0x16f)](_0x47c3bf+_0x12ab27(0x17e),{'recipient':{'id':_0x47c3bf},'sender_action':_0x12ab27(0x17c)});};exports[a399_0x4c455f(0x16d)]=markSeen;const sendText=async(_0x113fb0,_0xefdbc0,_0x2dafc0)=>{const _0x1cc860=a399_0x4c455f;try{const {data:_0x366c2e}=await apiBase(_0x2dafc0)[_0x1cc860(0x16f)]('me/messages',{'recipient':{'id':_0x113fb0},'message':{'text':''+_0xefdbc0}});return _0x366c2e;}catch(_0x12bd69){console[_0x1cc860(0x167)](_0x12bd69);}};exports[a399_0x4c455f(0x15d)]=sendText;const sendAttachmentFromUrl=async(_0x22ae42,_0x5878b3,_0x134460,_0x60ff09)=>{const _0x17e178=a399_0x4c455f;try{const {data:_0x1eb30d}=await apiBase(_0x60ff09)[_0x17e178(0x16f)](_0x17e178(0x16e),{'recipient':{'id':_0x22ae42},'message':{'attachment':{'type':_0x134460,'payload':{'url':_0x5878b3}}}});return _0x1eb30d;}catch(_0xa50b74){console[_0x17e178(0x167)](_0xa50b74);}};exports[a399_0x4c455f(0x14d)]=sendAttachmentFromUrl;const sendAttachment=async(_0x2eb0ea,_0x6bc98e,_0x49cd82,_0x43eaa6)=>{const _0x2b4ac0=a399_0x4c455f;formData['append'](_0x2b4ac0(0x151),JSON[_0x2b4ac0(0x152)]({'id':_0x2eb0ea})),formData[_0x2b4ac0(0x184)](_0x2b4ac0(0x173),JSON[_0x2b4ac0(0x152)]({'attachment':{'type':_0x49cd82,'payload':{'is_reusable':!![]}}}));const _0x1ec781=(0x0,fs_1[_0x2b4ac0(0x17d)])(_0x6bc98e[_0x2b4ac0(0x150)]);formData[_0x2b4ac0(0x184)](_0x2b4ac0(0x14f),_0x1ec781);try{await apiBase(_0x43eaa6)[_0x2b4ac0(0x16f)]('me/messages',formData,{'headers':{...formData[_0x2b4ac0(0x147)]()}});}catch(_0x55b298){throw new Error(_0x55b298);}};exports[a399_0x4c455f(0x169)]=sendAttachment;const genText=_0x3871ef=>{const _0x13c0b7={'text':_0x3871ef};return _0x13c0b7;};exports[a399_0x4c455f(0x15b)]=genText;function a399_0x35b6(_0x3e9b34,_0x584de3){const _0x512b0e=a399_0x512b();return a399_0x35b6=function(_0x35b6a9,_0x3cb3ca){_0x35b6a9=_0x35b6a9-0x146;let _0x199d0b=_0x512b0e[_0x35b6a9];return _0x199d0b;},a399_0x35b6(_0x3e9b34,_0x584de3);}const getProfile=async(_0x3a84c2,_0x448f4e)=>{const _0x39f4a8=a399_0x4c455f;try{const {data:_0xc67b30}=await apiBase(_0x448f4e)['get'](_0x3a84c2);return _0xc67b30;}catch(_0x731694){console[_0x39f4a8(0x167)](_0x731694);throw new Error(_0x39f4a8(0x175));}};exports[a399_0x4c455f(0x15a)]=getProfile;function a399_0x512b(){const _0x24027d=['437458xSPjWd','axios','15RHbjRC','client_credentials','log','2428380szBgfj','sendAttachment','messaging_postbacks','__esModule','ERR_GETTING_SUBSCRIBED_APPS','markSeen','me/messages','post','88GlIxTi','12318383jEdoPa','1153908IdPBgV','message','access_token','ERR_FETCHING_FB_USER_PROFILE_2','getAccessToken','6215JhayQS','166uphInY','env','delete','6361893vkGurm','mark_seen','createReadStream','/messages','?access_token=','messages','removeApplcation','/permissions','10HhpYJa','append','getSubscribedApps','/subscribed_apps?access_token=','FACEBOOK_APP_ID','3183846qVMSaR','getHeaders','default','/subscribed_apps','message_reads','get','getAccessTokenFromPage','sendAttachmentFromUrl','https://graph.facebook.com/v13.0/oauth/access_token','filedata','path','recipient','stringify','unsubscribeApp','profilePsid','getPageProfile','fb_exchange_token','__importDefault','subscribeApp','/accounts?fields=name,access_token,instagram_business_account{id,username,profile_picture_url,name}','getProfile','genText','FACEBOOK_APP_SECRET','sendText','logger','ERR_UNSUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','../../utils/logger','https://graph.facebook.com/v13.0/','create'];a399_0x512b=function(){return _0x24027d;};return a399_0x512b();}const getPageProfile=async(_0x1a6784,_0x2820fb)=>{const _0x1b2e49=a399_0x4c455f;try{const {data:_0x420f3f}=await apiBase(_0x2820fb)[_0x1b2e49(0x14b)](_0x1a6784+_0x1b2e49(0x159));return _0x420f3f;}catch(_0x3fb481){console[_0x1b2e49(0x167)](_0x3fb481);throw new Error('ERR_FETCHING_FB_PAGES');}};exports[a399_0x4c455f(0x155)]=getPageProfile;const profilePsid=async(_0x4abe48,_0x5ef35b)=>{const _0x4a9099=a399_0x4c455f;try{const {data:_0xc02404}=await axios_1[_0x4a9099(0x148)][_0x4a9099(0x14b)](_0x4a9099(0x161)+_0x4abe48+_0x4a9099(0x17f)+_0x5ef35b);return _0xc02404;}catch(_0x3624af){console['log'](_0x3624af),await(0x0,exports[_0x4a9099(0x15a)])(_0x4abe48,_0x5ef35b);}};exports[a399_0x4c455f(0x154)]=profilePsid;const subscribeApp=async(_0x26cc4b,_0x4dc11f)=>{const _0xb9dc89=a399_0x4c455f;try{const {data:_0x3cab14}=await axios_1[_0xb9dc89(0x148)]['post'](_0xb9dc89(0x161)+_0x26cc4b+_0xb9dc89(0x186)+_0x4dc11f,{'subscribed_fields':[_0xb9dc89(0x180),_0xb9dc89(0x16a),'message_deliveries',_0xb9dc89(0x14a),'message_echoes']});return _0x3cab14;}catch(_0x579069){console[_0xb9dc89(0x167)](_0x579069);throw new Error('ERR_SUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS');}};exports[a399_0x4c455f(0x158)]=subscribeApp;const unsubscribeApp=async(_0x52a43e,_0x4aa2e0)=>{const _0x23f8ec=a399_0x4c455f;try{const {data:_0x36a999}=await axios_1[_0x23f8ec(0x148)][_0x23f8ec(0x17a)](_0x23f8ec(0x161)+_0x52a43e+'/subscribed_apps?access_token='+_0x4aa2e0);return _0x36a999;}catch(_0x52224b){throw new Error(_0x23f8ec(0x15f));}};exports['unsubscribeApp']=unsubscribeApp;const getSubscribedApps=async(_0x5305a7,_0x31eca6)=>{const _0xe23c04=a399_0x4c455f;try{const {data:_0x8ea564}=await apiBase(_0x31eca6)['get'](_0x5305a7+_0xe23c04(0x149));return _0x8ea564;}catch(_0x277c11){throw new Error(_0xe23c04(0x16c));}};exports[a399_0x4c455f(0x185)]=getSubscribedApps;const getAccessTokenFromPage=async _0x3cadf7=>{const _0x247169=a399_0x4c455f;try{if(!_0x3cadf7)throw new Error('ERR_FETCHING_FB_USER_TOKEN');const _0x8e33cd=await axios_1[_0x247169(0x148)][_0x247169(0x14b)]('https://graph.facebook.com/v13.0/oauth/access_token',{'params':{'client_id':process[_0x247169(0x179)][_0x247169(0x187)],'client_secret':process[_0x247169(0x179)][_0x247169(0x15c)],'grant_type':_0x247169(0x156),'fb_exchange_token':_0x3cadf7}});return _0x8e33cd['data'][_0x247169(0x174)];}catch(_0x2c0dba){console[_0x247169(0x167)](_0x2c0dba);throw new Error('ERR_FETCHING_FB_USER_TOKEN');}};exports[a399_0x4c455f(0x14c)]=getAccessTokenFromPage;const removeApplcation=async(_0x1254b7,_0x36db80)=>{const _0x501a12=a399_0x4c455f;try{await axios_1[_0x501a12(0x148)][_0x501a12(0x17a)](_0x501a12(0x161)+_0x1254b7+_0x501a12(0x182),{'params':{'access_token':_0x36db80}});}catch(_0x1aa30e){logger_1[_0x501a12(0x15e)]['error']('ERR_REMOVING_APP_FROM_PAGE');}};exports['removeApplcation']=removeApplcation;