'use strict';const a416_0x1d2fc8=a416_0xe898;(function(_0x2dff20,_0x31757e){const _0x289bba=a416_0xe898,_0x59ddfa=_0x2dff20();while(!![]){try{const _0x2e60f2=-parseInt(_0x289bba(0x183))/0x1*(parseInt(_0x289bba(0x1a3))/0x2)+parseInt(_0x289bba(0x193))/0x3*(-parseInt(_0x289bba(0x18a))/0x4)+-parseInt(_0x289bba(0x179))/0x5*(parseInt(_0x289bba(0x180))/0x6)+-parseInt(_0x289bba(0x16d))/0x7+-parseInt(_0x289bba(0x198))/0x8*(-parseInt(_0x289bba(0x166))/0x9)+-parseInt(_0x289bba(0x19e))/0xa+parseInt(_0x289bba(0x194))/0xb*(parseInt(_0x289bba(0x19a))/0xc);if(_0x2e60f2===_0x31757e)break;else _0x59ddfa['push'](_0x59ddfa['shift']());}catch(_0x9b72de){_0x59ddfa['push'](_0x59ddfa['shift']());}}}(a416_0x5e18,0x90940));var __importDefault=this&&this['__importDefault']||function(_0x3aad4a){const _0x19e12a=a416_0xe898;return _0x3aad4a&&_0x3aad4a[_0x19e12a(0x19f)]?_0x3aad4a:{'default':_0x3aad4a};};Object[a416_0x1d2fc8(0x171)](exports,a416_0x1d2fc8(0x19f),{'value':!![]}),exports[a416_0x1d2fc8(0x1a2)]=exports[a416_0x1d2fc8(0x176)]=exports['getSubscribedApps']=exports[a416_0x1d2fc8(0x17d)]=exports[a416_0x1d2fc8(0x19b)]=exports['profilePsid']=exports[a416_0x1d2fc8(0x174)]=exports[a416_0x1d2fc8(0x175)]=exports[a416_0x1d2fc8(0x185)]=exports[a416_0x1d2fc8(0x17e)]=exports[a416_0x1d2fc8(0x199)]=exports[a416_0x1d2fc8(0x182)]=exports[a416_0x1d2fc8(0x186)]=exports['getAccessToken']=void 0x0;const axios_1=__importDefault(require(a416_0x1d2fc8(0x17b))),form_data_1=__importDefault(require('form-data')),fs_1=require('fs'),logger_1=require(a416_0x1d2fc8(0x1a4)),formData=new form_data_1['default'](),apiBase=_0x416a68=>axios_1[a416_0x1d2fc8(0x16e)][a416_0x1d2fc8(0x181)]({'baseURL':a416_0x1d2fc8(0x178),'params':{'access_token':_0x416a68}}),getAccessToken=async()=>{const _0x360b9e=a416_0x1d2fc8,{data:_0x3fc979}=await axios_1[_0x360b9e(0x16e)]['get']('https://graph.facebook.com/v13.0/oauth/access_token',{'params':{'client_id':process[_0x360b9e(0x177)][_0x360b9e(0x16c)],'client_secret':process[_0x360b9e(0x177)]['FACEBOOK_APP_SECRET'],'grant_type':_0x360b9e(0x189)}});return _0x3fc979[_0x360b9e(0x19d)];};function a416_0x5e18(){const _0x3ef862=['sendText','9020IQLAPg','FACEBOOK_APP_SECRET','genText','markSeen','message','createReadStream','client_credentials','4CRdbWn','mark_seen','append','messaging_postbacks','/accounts?fields=name,access_token,instagram_business_account{id,username,profile_picture_url,name}','error','ERR_UNSUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','post','get','1545744FAqoeH','1637471kNIFyN','/subscribed_apps?access_token=','messages','ERR_REMOVING_APP_FROM_PAGE','9296YcFAdU','sendAttachmentFromUrl','204HLJWUf','subscribeApp','/messages','access_token','1255830TqzMeB','__esModule','profilePsid','fb_exchange_token','removeApplcation','170gXMQEk','../../utils/logger','/permissions','ERR_SUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','/subscribed_apps','getHeaders','log','ERR_FETCHING_FB_USER_PROFILE_2','stringify','9135XFYXxa','?access_token=','logger','delete','path','message_deliveries','FACEBOOK_APP_ID','4321107dEjQAM','default','recipient','ERR_FETCHING_FB_PAGES','defineProperty','message_reads','me/messages','getPageProfile','getProfile','getAccessTokenFromPage','env','https://graph.facebook.com/v13.0/','780745QutbkX','filedata','axios','https://graph.facebook.com/v13.0/oauth/access_token','unsubscribeApp','sendAttachment','ERR_FETCHING_FB_USER_TOKEN','42osXSDi','create'];a416_0x5e18=function(){return _0x3ef862;};return a416_0x5e18();}exports['getAccessToken']=getAccessToken;const markSeen=async(_0x6ab07a,_0x11ae7e)=>{const _0x3f7e3c=a416_0x1d2fc8;await apiBase(_0x11ae7e)[_0x3f7e3c(0x191)](_0x6ab07a+_0x3f7e3c(0x19c),{'recipient':{'id':_0x6ab07a},'sender_action':_0x3f7e3c(0x18b)});};function a416_0xe898(_0x5b1ade,_0x39f4c2){const _0x5e18f3=a416_0x5e18();return a416_0xe898=function(_0xe898fe,_0x49bc55){_0xe898fe=_0xe898fe-0x164;let _0x301613=_0x5e18f3[_0xe898fe];return _0x301613;},a416_0xe898(_0x5b1ade,_0x39f4c2);}exports[a416_0x1d2fc8(0x186)]=markSeen;const sendText=async(_0x2bbef6,_0x21e5e2,_0x27427f)=>{const _0x937d7d=a416_0x1d2fc8;try{const {data:_0x4aeb4a}=await apiBase(_0x27427f)['post'](_0x937d7d(0x173),{'recipient':{'id':_0x2bbef6},'message':{'text':''+_0x21e5e2}});return _0x4aeb4a;}catch(_0x125cf3){console[_0x937d7d(0x1a9)](_0x125cf3);}};exports[a416_0x1d2fc8(0x182)]=sendText;const sendAttachmentFromUrl=async(_0x105f44,_0x50ab9e,_0x52e400,_0x4826c7)=>{const _0x3f5a44=a416_0x1d2fc8;try{const {data:_0x76244e}=await apiBase(_0x4826c7)[_0x3f5a44(0x191)](_0x3f5a44(0x173),{'recipient':{'id':_0x105f44},'message':{'attachment':{'type':_0x52e400,'payload':{'url':_0x50ab9e}}}});return _0x76244e;}catch(_0x24fd13){console[_0x3f5a44(0x1a9)](_0x24fd13);}};exports[a416_0x1d2fc8(0x199)]=sendAttachmentFromUrl;const sendAttachment=async(_0xa2dbf9,_0x3f47be,_0x5b9243,_0x18aa94)=>{const _0x383f26=a416_0x1d2fc8;formData[_0x383f26(0x18c)](_0x383f26(0x16f),JSON[_0x383f26(0x165)]({'id':_0xa2dbf9})),formData[_0x383f26(0x18c)](_0x383f26(0x187),JSON['stringify']({'attachment':{'type':_0x5b9243,'payload':{'is_reusable':!![]}}}));const _0x1b24f6=(0x0,fs_1[_0x383f26(0x188)])(_0x3f47be[_0x383f26(0x16a)]);formData[_0x383f26(0x18c)](_0x383f26(0x17a),_0x1b24f6);try{await apiBase(_0x18aa94)['post']('me/messages',formData,{'headers':{...formData[_0x383f26(0x1a8)]()}});}catch(_0x5680e8){throw new Error(_0x5680e8);}};exports['sendAttachment']=sendAttachment;const genText=_0x191e2e=>{const _0x30525b={'text':_0x191e2e};return _0x30525b;};exports[a416_0x1d2fc8(0x185)]=genText;const getProfile=async(_0x3f7d42,_0x555cfc)=>{const _0x3a702f=a416_0x1d2fc8;try{const {data:_0x437412}=await apiBase(_0x555cfc)['get'](_0x3f7d42);return _0x437412;}catch(_0x36ef93){console[_0x3a702f(0x1a9)](_0x36ef93);throw new Error(_0x3a702f(0x164));}};exports['getProfile']=getProfile;const getPageProfile=async(_0x178e00,_0x41559b)=>{const _0x281fb1=a416_0x1d2fc8;try{const {data:_0x388606}=await apiBase(_0x41559b)['get'](_0x178e00+_0x281fb1(0x18e));return _0x388606;}catch(_0x11068d){console[_0x281fb1(0x1a9)](_0x11068d);throw new Error(_0x281fb1(0x170));}};exports[a416_0x1d2fc8(0x174)]=getPageProfile;const profilePsid=async(_0x1c3cb7,_0x53683e)=>{const _0x4eefe8=a416_0x1d2fc8;try{const {data:_0x1c115a}=await axios_1['default'][_0x4eefe8(0x192)](_0x4eefe8(0x178)+_0x1c3cb7+_0x4eefe8(0x167)+_0x53683e);return _0x1c115a;}catch(_0x31ab85){console['log'](_0x31ab85),await(0x0,exports[_0x4eefe8(0x175)])(_0x1c3cb7,_0x53683e);}};exports[a416_0x1d2fc8(0x1a0)]=profilePsid;const subscribeApp=async(_0x115c91,_0x465be2)=>{const _0x1488d3=a416_0x1d2fc8;try{const {data:_0x258d30}=await axios_1[_0x1488d3(0x16e)]['post'](_0x1488d3(0x178)+_0x115c91+_0x1488d3(0x195)+_0x465be2,{'subscribed_fields':[_0x1488d3(0x196),_0x1488d3(0x18d),_0x1488d3(0x16b),_0x1488d3(0x172),'message_echoes']});return _0x258d30;}catch(_0x1aa409){console[_0x1488d3(0x1a9)](_0x1aa409);throw new Error(_0x1488d3(0x1a6));}};exports[a416_0x1d2fc8(0x19b)]=subscribeApp;const unsubscribeApp=async(_0x3216a4,_0x50ba40)=>{const _0x3790fc=a416_0x1d2fc8;try{const {data:_0x3c5e32}=await axios_1[_0x3790fc(0x16e)]['delete'](_0x3790fc(0x178)+_0x3216a4+_0x3790fc(0x195)+_0x50ba40);return _0x3c5e32;}catch(_0x39c066){throw new Error(_0x3790fc(0x190));}};exports['unsubscribeApp']=unsubscribeApp;const getSubscribedApps=async(_0x30af07,_0x1d0443)=>{const _0x4b844b=a416_0x1d2fc8;try{const {data:_0x2e765a}=await apiBase(_0x1d0443)[_0x4b844b(0x192)](_0x30af07+_0x4b844b(0x1a7));return _0x2e765a;}catch(_0x2e25e4){throw new Error('ERR_GETTING_SUBSCRIBED_APPS');}};exports['getSubscribedApps']=getSubscribedApps;const getAccessTokenFromPage=async _0x376218=>{const _0x1e5da9=a416_0x1d2fc8;try{if(!_0x376218)throw new Error(_0x1e5da9(0x17f));const _0x2d9fb7=await axios_1[_0x1e5da9(0x16e)]['get'](_0x1e5da9(0x17c),{'params':{'client_id':process['env']['FACEBOOK_APP_ID'],'client_secret':process[_0x1e5da9(0x177)][_0x1e5da9(0x184)],'grant_type':_0x1e5da9(0x1a1),'fb_exchange_token':_0x376218}});return _0x2d9fb7['data']['access_token'];}catch(_0x30ca8d){console[_0x1e5da9(0x1a9)](_0x30ca8d);throw new Error(_0x1e5da9(0x17f));}};exports[a416_0x1d2fc8(0x176)]=getAccessTokenFromPage;const removeApplcation=async(_0x4a1c2c,_0x42cb57)=>{const _0x13ed3e=a416_0x1d2fc8;try{await axios_1['default'][_0x13ed3e(0x169)]('https://graph.facebook.com/v13.0/'+_0x4a1c2c+_0x13ed3e(0x1a5),{'params':{'access_token':_0x42cb57}});}catch(_0x383011){logger_1[_0x13ed3e(0x168)][_0x13ed3e(0x18f)](_0x13ed3e(0x197));}};exports['removeApplcation']=removeApplcation;