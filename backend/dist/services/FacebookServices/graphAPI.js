'use strict';const a432_0x13c4ab=a432_0x25db;(function(_0x5e99f9,_0x222014){const _0x150284=a432_0x25db,_0x4badde=_0x5e99f9();while(!![]){try{const _0x4531f9=-parseInt(_0x150284(0x1ac))/0x1+-parseInt(_0x150284(0x1d9))/0x2+-parseInt(_0x150284(0x19f))/0x3*(-parseInt(_0x150284(0x1cc))/0x4)+-parseInt(_0x150284(0x1a9))/0x5+-parseInt(_0x150284(0x1d0))/0x6*(parseInt(_0x150284(0x1ae))/0x7)+parseInt(_0x150284(0x1d5))/0x8+-parseInt(_0x150284(0x19d))/0x9*(-parseInt(_0x150284(0x1d6))/0xa);if(_0x4531f9===_0x222014)break;else _0x4badde['push'](_0x4badde['shift']());}catch(_0x36b392){_0x4badde['push'](_0x4badde['shift']());}}}(a432_0x49d9,0x86dbb));var __importDefault=this&&this[a432_0x13c4ab(0x1cf)]||function(_0x1877d9){return _0x1877d9&&_0x1877d9['__esModule']?_0x1877d9:{'default':_0x1877d9};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a432_0x13c4ab(0x1a6)]=exports[a432_0x13c4ab(0x1dc)]=exports['getSubscribedApps']=exports[a432_0x13c4ab(0x1a5)]=exports[a432_0x13c4ab(0x1d4)]=exports[a432_0x13c4ab(0x1a3)]=exports[a432_0x13c4ab(0x1b7)]=exports[a432_0x13c4ab(0x1a8)]=exports[a432_0x13c4ab(0x1b0)]=exports['sendAttachment']=exports[a432_0x13c4ab(0x1c0)]=exports[a432_0x13c4ab(0x1bd)]=exports['markSeen']=exports[a432_0x13c4ab(0x1c2)]=void 0x0;const axios_1=__importDefault(require(a432_0x13c4ab(0x1bc))),form_data_1=__importDefault(require(a432_0x13c4ab(0x1ab))),fs_1=require('fs'),logger_1=require('../../utils/logger'),formData=new form_data_1[(a432_0x13c4ab(0x1c6))](),apiBase=_0x55a0aa=>axios_1[a432_0x13c4ab(0x1c6)]['create']({'baseURL':a432_0x13c4ab(0x1a1),'params':{'access_token':_0x55a0aa}}),getAccessToken=async()=>{const _0x331bab=a432_0x13c4ab,{data:_0x23adff}=await axios_1['default']['get'](_0x331bab(0x1cb),{'params':{'client_id':process[_0x331bab(0x1af)][_0x331bab(0x1c7)],'client_secret':process[_0x331bab(0x1af)][_0x331bab(0x1a4)],'grant_type':_0x331bab(0x1d7)}});return _0x23adff[_0x331bab(0x1d1)];};exports['getAccessToken']=getAccessToken;const markSeen=async(_0x1c0f3d,_0x222623)=>{const _0x240883=a432_0x13c4ab;await apiBase(_0x222623)[_0x240883(0x1b3)](_0x1c0f3d+_0x240883(0x19c),{'recipient':{'id':_0x1c0f3d},'sender_action':_0x240883(0x1bb)});};exports['markSeen']=markSeen;const sendText=async(_0x23ea7c,_0x1a3408,_0x51f90b)=>{const _0x492dd9=a432_0x13c4ab;try{const {data:_0x4f0558}=await apiBase(_0x51f90b)['post'](_0x492dd9(0x1cd),{'recipient':{'id':_0x23ea7c},'message':{'text':''+_0x1a3408}});return _0x4f0558;}catch(_0x262768){console['log'](_0x262768);}};exports['sendText']=sendText;const sendAttachmentFromUrl=async(_0x854c5,_0x21a15f,_0x11a2d7,_0x8e85fd)=>{const _0x33a8e1=a432_0x13c4ab;try{const {data:_0x4c4e76}=await apiBase(_0x8e85fd)[_0x33a8e1(0x1b3)]('me/messages',{'recipient':{'id':_0x854c5},'message':{'attachment':{'type':_0x11a2d7,'payload':{'url':_0x21a15f}}}});return _0x4c4e76;}catch(_0x3d410c){console[_0x33a8e1(0x1d3)](_0x3d410c);}};exports[a432_0x13c4ab(0x1c0)]=sendAttachmentFromUrl;const sendAttachment=async(_0x5d71a7,_0x1541b6,_0x8a006c,_0x451fbc)=>{const _0x69c6a3=a432_0x13c4ab;formData['append'](_0x69c6a3(0x1a7),JSON[_0x69c6a3(0x1b9)]({'id':_0x5d71a7})),formData[_0x69c6a3(0x1be)](_0x69c6a3(0x1c4),JSON['stringify']({'attachment':{'type':_0x8a006c,'payload':{'is_reusable':!![]}}}));const _0x118893=(0x0,fs_1[_0x69c6a3(0x1ca)])(_0x1541b6[_0x69c6a3(0x1ce)]);formData['append'](_0x69c6a3(0x1b2),_0x118893);try{await apiBase(_0x451fbc)['post'](_0x69c6a3(0x1cd),formData,{'headers':{...formData[_0x69c6a3(0x1b1)]()}});}catch(_0x110ed5){throw new Error(_0x110ed5);}};exports[a432_0x13c4ab(0x1c3)]=sendAttachment;const genText=_0x5164dc=>{const _0x110bb5={'text':_0x5164dc};return _0x110bb5;};function a432_0x49d9(){const _0x57e113=['access_token','/accounts?fields=name,access_token,instagram_business_account{id,username,profile_picture_url,name}','log','subscribeApp','1436240Byacwt','10gJaUeR','client_credentials','fb_exchange_token','908982HnhCQP','getSubscribedApps','delete','getAccessTokenFromPage','error','ERR_GETTING_SUBSCRIBED_APPS','/messages','25332687ZHzcwS','ERR_FETCHING_FB_USER_PROFILE_2','5433HZXXjE','/subscribed_apps?access_token=','https://graph.facebook.com/v13.0/','message_echoes','profilePsid','FACEBOOK_APP_SECRET','unsubscribeApp','removeApplcation','recipient','getProfile','3751415YwnRhC','message_reads','form-data','682682ltrocb','ERR_REMOVING_APP_FROM_PAGE','6699Uxltga','env','genText','getHeaders','filedata','post','/subscribed_apps','ERR_FETCHING_FB_PAGES','data','getPageProfile','messages','stringify','ERR_SUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','mark_seen','axios','sendText','append','ERR_FETCHING_FB_USER_TOKEN','sendAttachmentFromUrl','messaging_postbacks','getAccessToken','sendAttachment','message','logger','default','FACEBOOK_APP_ID','get','?access_token=','createReadStream','https://graph.facebook.com/v13.0/oauth/access_token','236vKcEcq','me/messages','path','__importDefault','4146OehSPL'];a432_0x49d9=function(){return _0x57e113;};return a432_0x49d9();}exports[a432_0x13c4ab(0x1b0)]=genText;const getProfile=async(_0x4c72eb,_0x27c3ac)=>{const _0x133db9=a432_0x13c4ab;try{const {data:_0x17a79e}=await apiBase(_0x27c3ac)[_0x133db9(0x1c8)](_0x4c72eb);return _0x17a79e;}catch(_0x446b68){console[_0x133db9(0x1d3)](_0x446b68);throw new Error(_0x133db9(0x19e));}};exports[a432_0x13c4ab(0x1a8)]=getProfile;const getPageProfile=async(_0x5bf590,_0x48b608)=>{const _0x460455=a432_0x13c4ab;try{const {data:_0x3ef4c0}=await apiBase(_0x48b608)[_0x460455(0x1c8)](_0x5bf590+_0x460455(0x1d2));return _0x3ef4c0;}catch(_0x5e4c13){console[_0x460455(0x1d3)](_0x5e4c13);throw new Error(_0x460455(0x1b5));}};exports[a432_0x13c4ab(0x1b7)]=getPageProfile;const profilePsid=async(_0x1ae1b4,_0x495943)=>{const _0x111145=a432_0x13c4ab;try{const {data:_0x35f67f}=await axios_1[_0x111145(0x1c6)]['get']('https://graph.facebook.com/v13.0/'+_0x1ae1b4+_0x111145(0x1c9)+_0x495943);return _0x35f67f;}catch(_0x563fd3){console[_0x111145(0x1d3)](_0x563fd3),await(0x0,exports[_0x111145(0x1a8)])(_0x1ae1b4,_0x495943);}};exports[a432_0x13c4ab(0x1a3)]=profilePsid;const subscribeApp=async(_0x27b754,_0x4ce6da)=>{const _0x22d3d7=a432_0x13c4ab;try{const {data:_0x455c8e}=await axios_1[_0x22d3d7(0x1c6)][_0x22d3d7(0x1b3)](_0x22d3d7(0x1a1)+_0x27b754+_0x22d3d7(0x1a0)+_0x4ce6da,{'subscribed_fields':[_0x22d3d7(0x1b8),_0x22d3d7(0x1c1),'message_deliveries',_0x22d3d7(0x1aa),_0x22d3d7(0x1a2)]});return _0x455c8e;}catch(_0x10393b){console[_0x22d3d7(0x1d3)](_0x10393b);throw new Error(_0x22d3d7(0x1ba));}};exports[a432_0x13c4ab(0x1d4)]=subscribeApp;const unsubscribeApp=async(_0x35f200,_0x270e82)=>{const _0x50099c=a432_0x13c4ab;try{const {data:_0x2a1cd3}=await axios_1['default']['delete'](_0x50099c(0x1a1)+_0x35f200+'/subscribed_apps?access_token='+_0x270e82);return _0x2a1cd3;}catch(_0x57360f){throw new Error('ERR_UNSUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS');}};exports['unsubscribeApp']=unsubscribeApp;const getSubscribedApps=async(_0x248848,_0x2f21f6)=>{const _0x3ca94e=a432_0x13c4ab;try{const {data:_0x787fee}=await apiBase(_0x2f21f6)[_0x3ca94e(0x1c8)](_0x248848+_0x3ca94e(0x1b4));return _0x787fee;}catch(_0x334c16){throw new Error(_0x3ca94e(0x19b));}};exports[a432_0x13c4ab(0x1da)]=getSubscribedApps;const getAccessTokenFromPage=async _0x2a7084=>{const _0x234f76=a432_0x13c4ab;try{if(!_0x2a7084)throw new Error(_0x234f76(0x1bf));const _0x30a92a=await axios_1[_0x234f76(0x1c6)][_0x234f76(0x1c8)](_0x234f76(0x1cb),{'params':{'client_id':process[_0x234f76(0x1af)][_0x234f76(0x1c7)],'client_secret':process[_0x234f76(0x1af)][_0x234f76(0x1a4)],'grant_type':_0x234f76(0x1d8),'fb_exchange_token':_0x2a7084}});return _0x30a92a[_0x234f76(0x1b6)][_0x234f76(0x1d1)];}catch(_0x59234b){console[_0x234f76(0x1d3)](_0x59234b);throw new Error('ERR_FETCHING_FB_USER_TOKEN');}};exports[a432_0x13c4ab(0x1dc)]=getAccessTokenFromPage;const removeApplcation=async(_0x43e337,_0x24513d)=>{const _0x3d557a=a432_0x13c4ab;try{await axios_1['default'][_0x3d557a(0x1db)](_0x3d557a(0x1a1)+_0x43e337+'/permissions',{'params':{'access_token':_0x24513d}});}catch(_0x462a6e){logger_1[_0x3d557a(0x1c5)][_0x3d557a(0x1dd)](_0x3d557a(0x1ad));}};function a432_0x25db(_0x2ad57c,_0x53829d){const _0x49d9a5=a432_0x49d9();return a432_0x25db=function(_0x25db8f,_0x24eac6){_0x25db8f=_0x25db8f-0x19b;let _0x582e75=_0x49d9a5[_0x25db8f];return _0x582e75;},a432_0x25db(_0x2ad57c,_0x53829d);}exports[a432_0x13c4ab(0x1a6)]=removeApplcation;