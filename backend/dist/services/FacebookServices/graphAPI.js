'use strict';const a480_0x492e52=a480_0x3a55;(function(_0x293bda,_0x1e4571){const _0x32b291=a480_0x3a55,_0x3220ee=_0x293bda();while(!![]){try{const _0x27ae6f=parseInt(_0x32b291(0x102))/0x1+-parseInt(_0x32b291(0x10b))/0x2+-parseInt(_0x32b291(0xfa))/0x3+-parseInt(_0x32b291(0xf4))/0x4*(parseInt(_0x32b291(0xde))/0x5)+-parseInt(_0x32b291(0xcf))/0x6*(parseInt(_0x32b291(0xfe))/0x7)+parseInt(_0x32b291(0xf1))/0x8*(parseInt(_0x32b291(0xd6))/0x9)+-parseInt(_0x32b291(0xcd))/0xa*(-parseInt(_0x32b291(0xd7))/0xb);if(_0x27ae6f===_0x1e4571)break;else _0x3220ee['push'](_0x3220ee['shift']());}catch(_0x5d3772){_0x3220ee['push'](_0x3220ee['shift']());}}}(a480_0x269e,0x856a8));var __importDefault=this&&this[a480_0x492e52(0xd8)]||function(_0x3fd533){const _0x5c6b1b=a480_0x492e52;return _0x3fd533&&_0x3fd533[_0x5c6b1b(0xfb)]?_0x3fd533:{'default':_0x3fd533};};Object[a480_0x492e52(0x10e)](exports,a480_0x492e52(0xfb),{'value':!![]}),exports[a480_0x492e52(0xe5)]=exports[a480_0x492e52(0xe0)]=exports[a480_0x492e52(0xe7)]=exports['unsubscribeApp']=exports[a480_0x492e52(0xdc)]=exports[a480_0x492e52(0x101)]=exports['getPageProfile']=exports[a480_0x492e52(0xed)]=exports['genText']=exports['sendAttachment']=exports[a480_0x492e52(0xd1)]=exports[a480_0x492e52(0xf5)]=exports[a480_0x492e52(0xe9)]=exports[a480_0x492e52(0xf7)]=void 0x0;const axios_1=__importDefault(require(a480_0x492e52(0xd3))),form_data_1=__importDefault(require(a480_0x492e52(0x100))),fs_1=require('fs'),logger_1=require('../../utils/logger'),formData=new form_data_1[(a480_0x492e52(0xe1))](),apiBase=_0x3a5779=>axios_1[a480_0x492e52(0xe1)][a480_0x492e52(0xe8)]({'baseURL':'https://graph.facebook.com/v13.0/','params':{'access_token':_0x3a5779}}),getAccessToken=async()=>{const _0x1a6b50=a480_0x492e52,{data:_0x36a350}=await axios_1[_0x1a6b50(0xe1)][_0x1a6b50(0xf8)](_0x1a6b50(0xf9),{'params':{'client_id':process['env'][_0x1a6b50(0x10c)],'client_secret':process['env'][_0x1a6b50(0xdd)],'grant_type':_0x1a6b50(0xf3)}});return _0x36a350[_0x1a6b50(0xec)];};exports[a480_0x492e52(0xf7)]=getAccessToken;const markSeen=async(_0x1e88b8,_0x483aa0)=>{const _0x234888=a480_0x492e52;await apiBase(_0x483aa0)[_0x234888(0x108)](_0x1e88b8+'/messages',{'recipient':{'id':_0x1e88b8},'sender_action':'mark_seen'});};exports[a480_0x492e52(0xe9)]=markSeen;const sendText=async(_0x4c7f68,_0x21c722,_0x594082)=>{const _0x4c08fd=a480_0x492e52;try{const {data:_0x57453c}=await apiBase(_0x594082)[_0x4c08fd(0x108)](_0x4c08fd(0xce),{'recipient':{'id':_0x4c7f68},'message':{'text':''+_0x21c722}});return _0x57453c;}catch(_0x3e302a){console[_0x4c08fd(0x103)](_0x3e302a);}};exports[a480_0x492e52(0xf5)]=sendText;const sendAttachmentFromUrl=async(_0x21833b,_0x366dec,_0x503396,_0x4fb6be)=>{const _0x4a5f07=a480_0x492e52;try{const {data:_0x4bba87}=await apiBase(_0x4fb6be)[_0x4a5f07(0x108)]('me/messages',{'recipient':{'id':_0x21833b},'message':{'attachment':{'type':_0x503396,'payload':{'url':_0x366dec}}}});return _0x4bba87;}catch(_0x1578df){console[_0x4a5f07(0x103)](_0x1578df);}};exports[a480_0x492e52(0xd1)]=sendAttachmentFromUrl;const sendAttachment=async(_0x492303,_0x159ec0,_0x2a75f1,_0x56f3ac)=>{const _0x513680=a480_0x492e52;formData[_0x513680(0xd4)](_0x513680(0x10d),JSON[_0x513680(0xf0)]({'id':_0x492303})),formData['append'](_0x513680(0xef),JSON[_0x513680(0xf0)]({'attachment':{'type':_0x2a75f1,'payload':{'is_reusable':!![]}}}));const _0x57f625=(0x0,fs_1['createReadStream'])(_0x159ec0['path']);formData[_0x513680(0xd4)](_0x513680(0x109),_0x57f625);try{await apiBase(_0x56f3ac)[_0x513680(0x108)](_0x513680(0xce),formData,{'headers':{...formData[_0x513680(0x10a)]()}});}catch(_0x4f7d3d){throw new Error(_0x4f7d3d);}};exports[a480_0x492e52(0xff)]=sendAttachment;const genText=_0x146eaf=>{const _0x483a7f={'text':_0x146eaf};return _0x483a7f;};exports[a480_0x492e52(0x106)]=genText;function a480_0x3a55(_0x145ada,_0xe10e57){const _0x269e11=a480_0x269e();return a480_0x3a55=function(_0x3a5526,_0x39d2b2){_0x3a5526=_0x3a5526-0xcd;let _0x4f5797=_0x269e11[_0x3a5526];return _0x4f5797;},a480_0x3a55(_0x145ada,_0xe10e57);}const getProfile=async(_0x3ab4c6,_0x3b0c2f)=>{const _0xc14acc=a480_0x492e52;try{const {data:_0x1fc3be}=await apiBase(_0x3b0c2f)[_0xc14acc(0xf8)](_0x3ab4c6);return _0x1fc3be;}catch(_0x2f484f){console[_0xc14acc(0x103)](_0x2f484f);throw new Error('ERR_FETCHING_FB_USER_PROFILE_2');}};exports[a480_0x492e52(0xed)]=getProfile;const getPageProfile=async(_0x107724,_0x194d4e)=>{const _0x4ac213=a480_0x492e52;try{const {data:_0x43e8c1}=await apiBase(_0x194d4e)[_0x4ac213(0xf8)](_0x107724+_0x4ac213(0xd0));return _0x43e8c1;}catch(_0x4c67f9){console[_0x4ac213(0x103)](_0x4c67f9);throw new Error(_0x4ac213(0xea));}};exports[a480_0x492e52(0xf2)]=getPageProfile;const profilePsid=async(_0x35dda6,_0x342d27)=>{const _0x35ac20=a480_0x492e52;try{const {data:_0x2bd926}=await axios_1[_0x35ac20(0xe1)][_0x35ac20(0xf8)](_0x35ac20(0xe6)+_0x35dda6+_0x35ac20(0x105)+_0x342d27);return _0x2bd926;}catch(_0x28bae8){console[_0x35ac20(0x103)](_0x28bae8),await(0x0,exports[_0x35ac20(0xed)])(_0x35dda6,_0x342d27);}};exports[a480_0x492e52(0x101)]=profilePsid;const subscribeApp=async(_0x3e716e,_0x4df7bb)=>{const _0x523606=a480_0x492e52;try{const {data:_0x150216}=await axios_1[_0x523606(0xe1)][_0x523606(0x108)](_0x523606(0xe6)+_0x3e716e+_0x523606(0xdf)+_0x4df7bb,{'subscribed_fields':[_0x523606(0xd5),'messaging_postbacks',_0x523606(0xfd),'message_reads',_0x523606(0xe3)]});return _0x150216;}catch(_0xa3aba7){console[_0x523606(0x103)](_0xa3aba7);throw new Error(_0x523606(0xe2));}};exports['subscribeApp']=subscribeApp;const unsubscribeApp=async(_0x25d421,_0x141178)=>{const _0x219797=a480_0x492e52;try{const {data:_0x30eb07}=await axios_1[_0x219797(0xe1)][_0x219797(0xe4)](_0x219797(0xe6)+_0x25d421+'/subscribed_apps?access_token='+_0x141178);return _0x30eb07;}catch(_0xa5e834){throw new Error(_0x219797(0xeb));}};exports[a480_0x492e52(0xf6)]=unsubscribeApp;const getSubscribedApps=async(_0x57c149,_0x4ef16c)=>{const _0x2104c0=a480_0x492e52;try{const {data:_0x1e87a5}=await apiBase(_0x4ef16c)[_0x2104c0(0xf8)](_0x57c149+'/subscribed_apps');return _0x1e87a5;}catch(_0x18c8c3){throw new Error(_0x2104c0(0xd2));}};exports[a480_0x492e52(0xe7)]=getSubscribedApps;const getAccessTokenFromPage=async _0x2d48c7=>{const _0x13950d=a480_0x492e52;try{if(!_0x2d48c7)throw new Error(_0x13950d(0xfc));const _0x38a87b=await axios_1['default'][_0x13950d(0xf8)](_0x13950d(0xf9),{'params':{'client_id':process[_0x13950d(0xda)][_0x13950d(0x10c)],'client_secret':process['env'][_0x13950d(0xdd)],'grant_type':'fb_exchange_token','fb_exchange_token':_0x2d48c7}});return _0x38a87b[_0x13950d(0xdb)][_0x13950d(0xec)];}catch(_0x34367f){console[_0x13950d(0x103)](_0x34367f);throw new Error(_0x13950d(0xfc));}};exports[a480_0x492e52(0xe0)]=getAccessTokenFromPage;function a480_0x269e(){const _0x46090f=['recipient','defineProperty','1530NfVpAL','me/messages','46338UNKROk','/accounts?fields=name,access_token,instagram_business_account{id,username,profile_picture_url,name}','sendAttachmentFromUrl','ERR_GETTING_SUBSCRIBED_APPS','axios','append','messages','9cxVKlj','53724urTptJ','__importDefault','error','env','data','subscribeApp','FACEBOOK_APP_SECRET','6565iPrMfs','/subscribed_apps?access_token=','getAccessTokenFromPage','default','ERR_SUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','message_echoes','delete','removeApplcation','https://graph.facebook.com/v13.0/','getSubscribedApps','create','markSeen','ERR_FETCHING_FB_PAGES','ERR_UNSUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','access_token','getProfile','/permissions','message','stringify','540184VzzNRu','getPageProfile','client_credentials','680BhBVDt','sendText','unsubscribeApp','getAccessToken','get','https://graph.facebook.com/v13.0/oauth/access_token','545241kqndhE','__esModule','ERR_FETCHING_FB_USER_TOKEN','message_deliveries','7SWMbUy','sendAttachment','form-data','profilePsid','408266ashPwD','log','ERR_REMOVING_APP_FROM_PAGE','?access_token=','genText','logger','post','filedata','getHeaders','527778osVMpJ','FACEBOOK_APP_ID'];a480_0x269e=function(){return _0x46090f;};return a480_0x269e();}const removeApplcation=async(_0x36a131,_0x4424f1)=>{const _0x513d8d=a480_0x492e52;try{await axios_1[_0x513d8d(0xe1)][_0x513d8d(0xe4)](_0x513d8d(0xe6)+_0x36a131+_0x513d8d(0xee),{'params':{'access_token':_0x4424f1}});}catch(_0x5cadc9){logger_1[_0x513d8d(0x107)][_0x513d8d(0xd9)](_0x513d8d(0x104));}};exports[a480_0x492e52(0xe5)]=removeApplcation;