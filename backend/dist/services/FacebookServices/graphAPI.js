'use strict';const a470_0x41299d=a470_0x2385;function a470_0x2385(_0x4fd505,_0x316dbc){const _0x52ccd8=a470_0x52cc();return a470_0x2385=function(_0x238538,_0x5ac8d2){_0x238538=_0x238538-0x1de;let _0x4a9497=_0x52ccd8[_0x238538];return _0x4a9497;},a470_0x2385(_0x4fd505,_0x316dbc);}(function(_0xe3d8d1,_0x1205c5){const _0x590e7e=a470_0x2385,_0x5136d7=_0xe3d8d1();while(!![]){try{const _0x51be86=-parseInt(_0x590e7e(0x217))/0x1+parseInt(_0x590e7e(0x219))/0x2+-parseInt(_0x590e7e(0x1e6))/0x3*(parseInt(_0x590e7e(0x1de))/0x4)+parseInt(_0x590e7e(0x210))/0x5+-parseInt(_0x590e7e(0x21e))/0x6*(parseInt(_0x590e7e(0x1f4))/0x7)+-parseInt(_0x590e7e(0x216))/0x8*(parseInt(_0x590e7e(0x1ef))/0x9)+-parseInt(_0x590e7e(0x20a))/0xa*(-parseInt(_0x590e7e(0x1f9))/0xb);if(_0x51be86===_0x1205c5)break;else _0x5136d7['push'](_0x5136d7['shift']());}catch(_0x22f4ac){_0x5136d7['push'](_0x5136d7['shift']());}}}(a470_0x52cc,0x56013));var __importDefault=this&&this[a470_0x41299d(0x21c)]||function(_0x477362){const _0xdfa825=a470_0x41299d;return _0x477362&&_0x477362[_0xdfa825(0x222)]?_0x477362:{'default':_0x477362};};Object[a470_0x41299d(0x215)](exports,'__esModule',{'value':!![]}),exports['removeApplcation']=exports[a470_0x41299d(0x1f0)]=exports[a470_0x41299d(0x21d)]=exports[a470_0x41299d(0x1e1)]=exports[a470_0x41299d(0x20b)]=exports['profilePsid']=exports['getPageProfile']=exports['getProfile']=exports['genText']=exports[a470_0x41299d(0x1ed)]=exports['sendAttachmentFromUrl']=exports[a470_0x41299d(0x21a)]=exports[a470_0x41299d(0x1ec)]=exports[a470_0x41299d(0x1f2)]=void 0x0;const axios_1=__importDefault(require(a470_0x41299d(0x1e8))),form_data_1=__importDefault(require(a470_0x41299d(0x214))),fs_1=require('fs'),logger_1=require('../../utils/logger'),formData=new form_data_1[(a470_0x41299d(0x1ff))](),apiBase=_0x299a89=>axios_1[a470_0x41299d(0x1ff)][a470_0x41299d(0x208)]({'baseURL':a470_0x41299d(0x1ee),'params':{'access_token':_0x299a89}}),getAccessToken=async()=>{const _0x3fbfc8=a470_0x41299d,{data:_0x2ed0e3}=await axios_1[_0x3fbfc8(0x1ff)]['get'](_0x3fbfc8(0x1e4),{'params':{'client_id':process['env'][_0x3fbfc8(0x20c)],'client_secret':process[_0x3fbfc8(0x1f1)][_0x3fbfc8(0x206)],'grant_type':_0x3fbfc8(0x204)}});return _0x2ed0e3[_0x3fbfc8(0x1fc)];};exports['getAccessToken']=getAccessToken;const markSeen=async(_0x1e5e95,_0x416f8b)=>{const _0xc47b2f=a470_0x41299d;await apiBase(_0x416f8b)[_0xc47b2f(0x1f3)](_0x1e5e95+'/messages',{'recipient':{'id':_0x1e5e95},'sender_action':_0xc47b2f(0x1f8)});};exports[a470_0x41299d(0x1ec)]=markSeen;const sendText=async(_0x2d758b,_0x5d6a92,_0x590d60)=>{const _0x2fe868=a470_0x41299d;try{const {data:_0xd5dc82}=await apiBase(_0x590d60)[_0x2fe868(0x1f3)](_0x2fe868(0x1e7),{'recipient':{'id':_0x2d758b},'message':{'text':''+_0x5d6a92}});return _0xd5dc82;}catch(_0x34ba87){console['log'](_0x34ba87);}};exports[a470_0x41299d(0x21a)]=sendText;const sendAttachmentFromUrl=async(_0xc93d74,_0x208437,_0x2f5fb3,_0x1c8ff6)=>{const _0x53faed=a470_0x41299d;try{const {data:_0x2d63df}=await apiBase(_0x1c8ff6)[_0x53faed(0x1f3)]('me/messages',{'recipient':{'id':_0xc93d74},'message':{'attachment':{'type':_0x2f5fb3,'payload':{'url':_0x208437}}}});return _0x2d63df;}catch(_0x49ceb2){console[_0x53faed(0x220)](_0x49ceb2);}};exports[a470_0x41299d(0x1e3)]=sendAttachmentFromUrl;const sendAttachment=async(_0x2d84cb,_0x4e59b3,_0x1eabce,_0x4146c8)=>{const _0x4567b0=a470_0x41299d;formData[_0x4567b0(0x218)](_0x4567b0(0x1fe),JSON[_0x4567b0(0x1eb)]({'id':_0x2d84cb})),formData[_0x4567b0(0x218)](_0x4567b0(0x202),JSON[_0x4567b0(0x1eb)]({'attachment':{'type':_0x1eabce,'payload':{'is_reusable':!![]}}}));const _0x21b606=(0x0,fs_1[_0x4567b0(0x1f5)])(_0x4e59b3[_0x4567b0(0x1fa)]);formData['append']('filedata',_0x21b606);try{await apiBase(_0x4146c8)[_0x4567b0(0x1f3)](_0x4567b0(0x1e7),formData,{'headers':{...formData[_0x4567b0(0x201)]()}});}catch(_0x1172b5){throw new Error(_0x1172b5);}};exports[a470_0x41299d(0x1ed)]=sendAttachment;const genText=_0x1a6848=>{const _0x21c36d={'text':_0x1a6848};return _0x21c36d;};exports[a470_0x41299d(0x21b)]=genText;const getProfile=async(_0x37e082,_0x263ee2)=>{const _0x1a165f=a470_0x41299d;try{const {data:_0x23ffad}=await apiBase(_0x263ee2)[_0x1a165f(0x1e5)](_0x37e082);return _0x23ffad;}catch(_0x16749e){console[_0x1a165f(0x220)](_0x16749e);throw new Error(_0x1a165f(0x1df));}};exports[a470_0x41299d(0x209)]=getProfile;const getPageProfile=async(_0x2f1da6,_0x24f7b9)=>{const _0x2cf604=a470_0x41299d;try{const {data:_0x299e4c}=await apiBase(_0x24f7b9)['get'](_0x2f1da6+_0x2cf604(0x205));return _0x299e4c;}catch(_0x4fbe50){console[_0x2cf604(0x220)](_0x4fbe50);throw new Error(_0x2cf604(0x211));}};exports[a470_0x41299d(0x213)]=getPageProfile;const profilePsid=async(_0x492c74,_0x368edc)=>{const _0x4ab4f5=a470_0x41299d;try{const {data:_0xb491bd}=await axios_1[_0x4ab4f5(0x1ff)][_0x4ab4f5(0x1e5)]('https://graph.facebook.com/v13.0/'+_0x492c74+_0x4ab4f5(0x21f)+_0x368edc);return _0xb491bd;}catch(_0x320d53){console[_0x4ab4f5(0x220)](_0x320d53),await(0x0,exports[_0x4ab4f5(0x209)])(_0x492c74,_0x368edc);}};function a470_0x52cc(){const _0x15cf34=['585440EorMLE','46204UFvtMQ','append','268934lebkaF','sendText','genText','__importDefault','getSubscribedApps','6srcTsy','?access_token=','log','/subscribed_apps?access_token=','__esModule','72hyZNVY','ERR_FETCHING_FB_USER_PROFILE_2','removeApplcation','unsubscribeApp','ERR_UNSUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','sendAttachmentFromUrl','https://graph.facebook.com/v13.0/oauth/access_token','get','27801bOpeQC','me/messages','axios','message_echoes','messaging_postbacks','stringify','markSeen','sendAttachment','https://graph.facebook.com/v13.0/','63VRvMMz','getAccessTokenFromPage','env','getAccessToken','post','2549197ssCyQO','createReadStream','profilePsid','fb_exchange_token','mark_seen','429YVKWvZ','path','message_deliveries','access_token','messages','recipient','default','ERR_FETCHING_FB_USER_TOKEN','getHeaders','message','logger','client_credentials','/accounts?fields=name,access_token,instagram_business_account{id,username,profile_picture_url,name}','FACEBOOK_APP_SECRET','/subscribed_apps','create','getProfile','175790SStuBX','subscribeApp','FACEBOOK_APP_ID','data','ERR_GETTING_SUBSCRIBED_APPS','delete','3108340Sxjpud','ERR_FETCHING_FB_PAGES','ERR_SUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','getPageProfile','form-data','defineProperty'];a470_0x52cc=function(){return _0x15cf34;};return a470_0x52cc();}exports[a470_0x41299d(0x1f6)]=profilePsid;const subscribeApp=async(_0xf2d182,_0x3ac9c5)=>{const _0x4ee6a4=a470_0x41299d;try{const {data:_0x3a58d7}=await axios_1[_0x4ee6a4(0x1ff)][_0x4ee6a4(0x1f3)](_0x4ee6a4(0x1ee)+_0xf2d182+_0x4ee6a4(0x221)+_0x3ac9c5,{'subscribed_fields':[_0x4ee6a4(0x1fd),_0x4ee6a4(0x1ea),_0x4ee6a4(0x1fb),'message_reads',_0x4ee6a4(0x1e9)]});return _0x3a58d7;}catch(_0x482edc){console['log'](_0x482edc);throw new Error(_0x4ee6a4(0x212));}};exports[a470_0x41299d(0x20b)]=subscribeApp;const unsubscribeApp=async(_0x4e7531,_0x2f32df)=>{const _0xc3456=a470_0x41299d;try{const {data:_0x22b337}=await axios_1[_0xc3456(0x1ff)][_0xc3456(0x20f)](_0xc3456(0x1ee)+_0x4e7531+_0xc3456(0x221)+_0x2f32df);return _0x22b337;}catch(_0x180dc3){throw new Error(_0xc3456(0x1e2));}};exports['unsubscribeApp']=unsubscribeApp;const getSubscribedApps=async(_0x1e252a,_0x47658c)=>{const _0x522a20=a470_0x41299d;try{const {data:_0x579a12}=await apiBase(_0x47658c)[_0x522a20(0x1e5)](_0x1e252a+_0x522a20(0x207));return _0x579a12;}catch(_0x44d1c2){throw new Error(_0x522a20(0x20e));}};exports[a470_0x41299d(0x21d)]=getSubscribedApps;const getAccessTokenFromPage=async _0x4e1240=>{const _0x28d47c=a470_0x41299d;try{if(!_0x4e1240)throw new Error(_0x28d47c(0x200));const _0x4b6ad3=await axios_1['default'][_0x28d47c(0x1e5)](_0x28d47c(0x1e4),{'params':{'client_id':process['env']['FACEBOOK_APP_ID'],'client_secret':process['env'][_0x28d47c(0x206)],'grant_type':_0x28d47c(0x1f7),'fb_exchange_token':_0x4e1240}});return _0x4b6ad3[_0x28d47c(0x20d)][_0x28d47c(0x1fc)];}catch(_0x2258c4){console['log'](_0x2258c4);throw new Error(_0x28d47c(0x200));}};exports['getAccessTokenFromPage']=getAccessTokenFromPage;const removeApplcation=async(_0x31d90b,_0x3c8c45)=>{const _0x4f84cc=a470_0x41299d;try{await axios_1['default'][_0x4f84cc(0x20f)](_0x4f84cc(0x1ee)+_0x31d90b+'/permissions',{'params':{'access_token':_0x3c8c45}});}catch(_0x5616d5){logger_1[_0x4f84cc(0x203)]['error']('ERR_REMOVING_APP_FROM_PAGE');}};exports[a470_0x41299d(0x1e0)]=removeApplcation;