'use strict';const a453_0x38ab4f=a453_0x54b8;(function(_0x4bd2b1,_0x38c6e2){const _0x523030=a453_0x54b8,_0x3614b4=_0x4bd2b1();while(!![]){try{const _0x482ff6=parseInt(_0x523030(0x19d))/0x1+-parseInt(_0x523030(0x1cf))/0x2*(parseInt(_0x523030(0x199))/0x3)+parseInt(_0x523030(0x1cc))/0x4*(parseInt(_0x523030(0x1b3))/0x5)+parseInt(_0x523030(0x1b5))/0x6*(parseInt(_0x523030(0x1a2))/0x7)+-parseInt(_0x523030(0x1d2))/0x8*(parseInt(_0x523030(0x1d8))/0x9)+parseInt(_0x523030(0x1bd))/0xa+-parseInt(_0x523030(0x19f))/0xb;if(_0x482ff6===_0x38c6e2)break;else _0x3614b4['push'](_0x3614b4['shift']());}catch(_0x3dda9d){_0x3614b4['push'](_0x3614b4['shift']());}}}(a453_0xe74f,0x3e2df));var __importDefault=this&&this[a453_0x38ab4f(0x1ca)]||function(_0x47ea00){return _0x47ea00&&_0x47ea00['__esModule']?_0x47ea00:{'default':_0x47ea00};};Object[a453_0x38ab4f(0x1a4)](exports,a453_0x38ab4f(0x1d7),{'value':!![]}),exports[a453_0x38ab4f(0x1af)]=exports[a453_0x38ab4f(0x1bc)]=exports[a453_0x38ab4f(0x1d0)]=exports[a453_0x38ab4f(0x1bf)]=exports[a453_0x38ab4f(0x19b)]=exports[a453_0x38ab4f(0x1da)]=exports['getPageProfile']=exports['getProfile']=exports['genText']=exports[a453_0x38ab4f(0x1c6)]=exports['sendAttachmentFromUrl']=exports['sendText']=exports[a453_0x38ab4f(0x1d6)]=exports[a453_0x38ab4f(0x1cb)]=void 0x0;const axios_1=__importDefault(require(a453_0x38ab4f(0x1a8))),form_data_1=__importDefault(require(a453_0x38ab4f(0x1ad))),fs_1=require('fs'),logger_1=require(a453_0x38ab4f(0x1c3)),formData=new form_data_1[(a453_0x38ab4f(0x1cd))](),apiBase=_0x21855a=>axios_1[a453_0x38ab4f(0x1cd)]['create']({'baseURL':a453_0x38ab4f(0x19a),'params':{'access_token':_0x21855a}}),getAccessToken=async()=>{const _0x246aa8=a453_0x38ab4f,{data:_0x10bf90}=await axios_1['default'][_0x246aa8(0x1ae)](_0x246aa8(0x1d5),{'params':{'client_id':process[_0x246aa8(0x1c8)][_0x246aa8(0x1bb)],'client_secret':process[_0x246aa8(0x1c8)]['FACEBOOK_APP_SECRET'],'grant_type':_0x246aa8(0x1d3)}});return _0x10bf90[_0x246aa8(0x19c)];};function a453_0x54b8(_0x5865ea,_0x33b790){const _0xe74fdf=a453_0xe74f();return a453_0x54b8=function(_0x54b885,_0x219189){_0x54b885=_0x54b885-0x199;let _0x33f414=_0xe74fdf[_0x54b885];return _0x33f414;},a453_0x54b8(_0x5865ea,_0x33b790);}exports[a453_0x38ab4f(0x1cb)]=getAccessToken;const markSeen=async(_0x3b9248,_0xcedb39)=>{const _0x3daf7d=a453_0x38ab4f;await apiBase(_0xcedb39)[_0x3daf7d(0x1a5)](_0x3b9248+_0x3daf7d(0x1b7),{'recipient':{'id':_0x3b9248},'sender_action':'mark_seen'});};exports[a453_0x38ab4f(0x1d6)]=markSeen;const sendText=async(_0x3df180,_0x1dda1a,_0x3a7bc2)=>{const _0x148599=a453_0x38ab4f;try{const {data:_0x28fe8f}=await apiBase(_0x3a7bc2)[_0x148599(0x1a5)](_0x148599(0x1aa),{'recipient':{'id':_0x3df180},'message':{'text':''+_0x1dda1a}});return _0x28fe8f;}catch(_0x22cc32){console[_0x148599(0x1c0)](_0x22cc32);}};exports[a453_0x38ab4f(0x1be)]=sendText;const sendAttachmentFromUrl=async(_0x390164,_0x2574bc,_0x1f8af5,_0x5a9e4c)=>{try{const {data:_0x2e99c0}=await apiBase(_0x5a9e4c)['post']('me/messages',{'recipient':{'id':_0x390164},'message':{'attachment':{'type':_0x1f8af5,'payload':{'url':_0x2574bc}}}});return _0x2e99c0;}catch(_0x4eb3d2){console['log'](_0x4eb3d2);}};exports[a453_0x38ab4f(0x1a3)]=sendAttachmentFromUrl;const sendAttachment=async(_0x5f0e78,_0x301dba,_0x70e753,_0x1c0859)=>{const _0x5e1653=a453_0x38ab4f;formData[_0x5e1653(0x1b4)](_0x5e1653(0x1d4),JSON[_0x5e1653(0x1b2)]({'id':_0x5f0e78})),formData['append'](_0x5e1653(0x1c7),JSON[_0x5e1653(0x1b2)]({'attachment':{'type':_0x70e753,'payload':{'is_reusable':!![]}}}));const _0x220ea6=(0x0,fs_1['createReadStream'])(_0x301dba[_0x5e1653(0x1a0)]);formData['append'](_0x5e1653(0x1b8),_0x220ea6);try{await apiBase(_0x1c0859)[_0x5e1653(0x1a5)]('me/messages',formData,{'headers':{...formData[_0x5e1653(0x1a7)]()}});}catch(_0x5d13b8){throw new Error(_0x5d13b8);}};exports[a453_0x38ab4f(0x1c6)]=sendAttachment;const genText=_0x32b23f=>{const _0x491650={'text':_0x32b23f};return _0x491650;};exports[a453_0x38ab4f(0x19e)]=genText;const getProfile=async(_0x21a910,_0xa7fe3c)=>{const _0x2f7e27=a453_0x38ab4f;try{const {data:_0x357544}=await apiBase(_0xa7fe3c)[_0x2f7e27(0x1ae)](_0x21a910);return _0x357544;}catch(_0x351cbc){console['log'](_0x351cbc);throw new Error('ERR_FETCHING_FB_USER_PROFILE_2');}};exports[a453_0x38ab4f(0x1a1)]=getProfile;const getPageProfile=async(_0x9cb423,_0x3abd7f)=>{const _0x517f6a=a453_0x38ab4f;try{const {data:_0x232d52}=await apiBase(_0x3abd7f)[_0x517f6a(0x1ae)](_0x9cb423+'/accounts?fields=name,access_token,instagram_business_account{id,username,profile_picture_url,name}');return _0x232d52;}catch(_0x184780){console['log'](_0x184780);throw new Error(_0x517f6a(0x1ba));}};exports[a453_0x38ab4f(0x1b1)]=getPageProfile;const profilePsid=async(_0x51745c,_0x109212)=>{const _0x556e37=a453_0x38ab4f;try{const {data:_0x2266ae}=await axios_1[_0x556e37(0x1cd)]['get']('https://graph.facebook.com/v13.0/'+_0x51745c+_0x556e37(0x1b0)+_0x109212);return _0x2266ae;}catch(_0x3d33df){console['log'](_0x3d33df),await(0x0,exports[_0x556e37(0x1a1)])(_0x51745c,_0x109212);}};function a453_0xe74f(){const _0x44150a=['2395870VTFDJv','append','6RPragj','message_deliveries','/messages','filedata','data','ERR_FETCHING_FB_PAGES','FACEBOOK_APP_ID','getAccessTokenFromPage','2442070wdWxgO','sendText','unsubscribeApp','log','messages','ERR_FETCHING_FB_USER_TOKEN','../../utils/logger','/permissions','messaging_postbacks','sendAttachment','message','env','error','__importDefault','getAccessToken','4ZyCOqh','default','fb_exchange_token','1614VrbnAz','getSubscribedApps','delete','8wbEgNG','client_credentials','recipient','https://graph.facebook.com/v13.0/oauth/access_token','markSeen','__esModule','3056076cnPufV','ERR_REMOVING_APP_FROM_PAGE','profilePsid','603wPwUMS','https://graph.facebook.com/v13.0/','subscribeApp','access_token','115055kPbQUa','genText','1078209GepCrz','path','getProfile','112287MXQYfN','sendAttachmentFromUrl','defineProperty','post','message_echoes','getHeaders','axios','/subscribed_apps?access_token=','me/messages','message_reads','ERR_GETTING_SUBSCRIBED_APPS','form-data','get','removeApplcation','?access_token=','getPageProfile','stringify'];a453_0xe74f=function(){return _0x44150a;};return a453_0xe74f();}exports[a453_0x38ab4f(0x1da)]=profilePsid;const subscribeApp=async(_0x136421,_0x1be737)=>{const _0xc25aae=a453_0x38ab4f;try{const {data:_0x472a67}=await axios_1['default'][_0xc25aae(0x1a5)](_0xc25aae(0x19a)+_0x136421+_0xc25aae(0x1a9)+_0x1be737,{'subscribed_fields':[_0xc25aae(0x1c1),_0xc25aae(0x1c5),_0xc25aae(0x1b6),_0xc25aae(0x1ab),_0xc25aae(0x1a6)]});return _0x472a67;}catch(_0x2372a6){console[_0xc25aae(0x1c0)](_0x2372a6);throw new Error('ERR_SUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS');}};exports[a453_0x38ab4f(0x19b)]=subscribeApp;const unsubscribeApp=async(_0x2440bb,_0x535263)=>{const _0x44e7d9=a453_0x38ab4f;try{const {data:_0x5b6dbb}=await axios_1[_0x44e7d9(0x1cd)][_0x44e7d9(0x1d1)](_0x44e7d9(0x19a)+_0x2440bb+_0x44e7d9(0x1a9)+_0x535263);return _0x5b6dbb;}catch(_0x20853d){throw new Error('ERR_UNSUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS');}};exports['unsubscribeApp']=unsubscribeApp;const getSubscribedApps=async(_0xe22c5e,_0x403bae)=>{const _0x5e102d=a453_0x38ab4f;try{const {data:_0x4cae34}=await apiBase(_0x403bae)[_0x5e102d(0x1ae)](_0xe22c5e+'/subscribed_apps');return _0x4cae34;}catch(_0x8c493d){throw new Error(_0x5e102d(0x1ac));}};exports[a453_0x38ab4f(0x1d0)]=getSubscribedApps;const getAccessTokenFromPage=async _0x204d4a=>{const _0x1a3057=a453_0x38ab4f;try{if(!_0x204d4a)throw new Error('ERR_FETCHING_FB_USER_TOKEN');const _0x115d9e=await axios_1[_0x1a3057(0x1cd)][_0x1a3057(0x1ae)](_0x1a3057(0x1d5),{'params':{'client_id':process[_0x1a3057(0x1c8)][_0x1a3057(0x1bb)],'client_secret':process[_0x1a3057(0x1c8)]['FACEBOOK_APP_SECRET'],'grant_type':_0x1a3057(0x1ce),'fb_exchange_token':_0x204d4a}});return _0x115d9e[_0x1a3057(0x1b9)][_0x1a3057(0x19c)];}catch(_0x5a7aba){console[_0x1a3057(0x1c0)](_0x5a7aba);throw new Error(_0x1a3057(0x1c2));}};exports['getAccessTokenFromPage']=getAccessTokenFromPage;const removeApplcation=async(_0x1f7fef,_0x3b0009)=>{const _0x58fc71=a453_0x38ab4f;try{await axios_1['default']['delete'](_0x58fc71(0x19a)+_0x1f7fef+_0x58fc71(0x1c4),{'params':{'access_token':_0x3b0009}});}catch(_0x330c5f){logger_1['logger'][_0x58fc71(0x1c9)](_0x58fc71(0x1d9));}};exports[a453_0x38ab4f(0x1af)]=removeApplcation;