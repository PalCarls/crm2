'use strict';const a447_0x271322=a447_0x4b6c;(function(_0x2a8795,_0x2ffced){const _0x15fe7b=a447_0x4b6c,_0x29c832=_0x2a8795();while(!![]){try{const _0x1e6a8b=parseInt(_0x15fe7b(0x10d))/0x1*(parseInt(_0x15fe7b(0x127))/0x2)+-parseInt(_0x15fe7b(0x105))/0x3+-parseInt(_0x15fe7b(0x10f))/0x4*(-parseInt(_0x15fe7b(0xec))/0x5)+-parseInt(_0x15fe7b(0x10b))/0x6+-parseInt(_0x15fe7b(0x125))/0x7+parseInt(_0x15fe7b(0x100))/0x8+parseInt(_0x15fe7b(0xf9))/0x9;if(_0x1e6a8b===_0x2ffced)break;else _0x29c832['push'](_0x29c832['shift']());}catch(_0x200b6d){_0x29c832['push'](_0x29c832['shift']());}}}(a447_0x4e88,0x8fcee));var __importDefault=this&&this['__importDefault']||function(_0x4c035f){const _0x53cd7f=a447_0x4b6c;return _0x4c035f&&_0x4c035f[_0x53cd7f(0x122)]?_0x4c035f:{'default':_0x4c035f};};Object['defineProperty'](exports,a447_0x271322(0x122),{'value':!![]}),exports['removeApplcation']=exports[a447_0x271322(0xf5)]=exports[a447_0x271322(0x102)]=exports[a447_0x271322(0x11e)]=exports[a447_0x271322(0x119)]=exports['profilePsid']=exports[a447_0x271322(0x11d)]=exports[a447_0x271322(0x11a)]=exports[a447_0x271322(0x116)]=exports['sendAttachment']=exports[a447_0x271322(0x10e)]=exports[a447_0x271322(0xfc)]=exports[a447_0x271322(0x124)]=exports['getAccessToken']=void 0x0;const axios_1=__importDefault(require('axios')),form_data_1=__importDefault(require(a447_0x271322(0x123))),fs_1=require('fs'),logger_1=require('../../utils/logger'),formData=new form_data_1[(a447_0x271322(0xeb))](),apiBase=_0x2dcdf5=>axios_1[a447_0x271322(0xeb)][a447_0x271322(0x101)]({'baseURL':'https://graph.facebook.com/v13.0/','params':{'access_token':_0x2dcdf5}}),getAccessToken=async()=>{const _0x336e0c=a447_0x271322,{data:_0x424657}=await axios_1[_0x336e0c(0xeb)][_0x336e0c(0xfa)](_0x336e0c(0x106),{'params':{'client_id':process['env'][_0x336e0c(0xfd)],'client_secret':process['env'][_0x336e0c(0x11b)],'grant_type':_0x336e0c(0xf8)}});return _0x424657[_0x336e0c(0xff)];};exports['getAccessToken']=getAccessToken;const markSeen=async(_0x30e09a,_0x22a652)=>{const _0x4d5880=a447_0x271322;await apiBase(_0x22a652)[_0x4d5880(0xf1)](_0x30e09a+'/messages',{'recipient':{'id':_0x30e09a},'sender_action':_0x4d5880(0x114)});};exports[a447_0x271322(0x124)]=markSeen;const sendText=async(_0x58ff72,_0x32a505,_0x109114)=>{const _0xd74d5e=a447_0x271322;try{const {data:_0x27276e}=await apiBase(_0x109114)[_0xd74d5e(0xf1)](_0xd74d5e(0xee),{'recipient':{'id':_0x58ff72},'message':{'text':''+_0x32a505}});return _0x27276e;}catch(_0x428968){console[_0xd74d5e(0x118)](_0x428968);}};exports['sendText']=sendText;const sendAttachmentFromUrl=async(_0x4ad48a,_0x463e31,_0x45283b,_0xa64bcf)=>{const _0x4d05ea=a447_0x271322;try{const {data:_0x296dc6}=await apiBase(_0xa64bcf)[_0x4d05ea(0xf1)](_0x4d05ea(0xee),{'recipient':{'id':_0x4ad48a},'message':{'attachment':{'type':_0x45283b,'payload':{'url':_0x463e31}}}});return _0x296dc6;}catch(_0x356211){console[_0x4d05ea(0x118)](_0x356211);}};exports[a447_0x271322(0x10e)]=sendAttachmentFromUrl;const sendAttachment=async(_0x133d3b,_0x127b76,_0x41af0f,_0x12a3ba)=>{const _0x55332b=a447_0x271322;formData[_0x55332b(0x10c)](_0x55332b(0x107),JSON[_0x55332b(0x103)]({'id':_0x133d3b})),formData[_0x55332b(0x10c)](_0x55332b(0xe9),JSON[_0x55332b(0x103)]({'attachment':{'type':_0x41af0f,'payload':{'is_reusable':!![]}}}));const _0xdf38c7=(0x0,fs_1[_0x55332b(0x104)])(_0x127b76[_0x55332b(0x113)]);formData[_0x55332b(0x10c)](_0x55332b(0xf2),_0xdf38c7);try{await apiBase(_0x12a3ba)[_0x55332b(0xf1)](_0x55332b(0xee),formData,{'headers':{...formData[_0x55332b(0x112)]()}});}catch(_0x4158af){throw new Error(_0x4158af);}};exports[a447_0x271322(0x111)]=sendAttachment;function a447_0x4b6c(_0x2f2356,_0x473a4d){const _0x4e88ab=a447_0x4e88();return a447_0x4b6c=function(_0x4b6cc7,_0x5b7e96){_0x4b6cc7=_0x4b6cc7-0xe9;let _0x19a56e=_0x4e88ab[_0x4b6cc7];return _0x19a56e;},a447_0x4b6c(_0x2f2356,_0x473a4d);}const genText=_0x34f162=>{const _0x1e3a02={'text':_0x34f162};return _0x1e3a02;};function a447_0x4e88(){const _0x48cd0b=['fb_exchange_token','client_credentials','11168613dCfFof','get','/accounts?fields=name,access_token,instagram_business_account{id,username,profile_picture_url,name}','sendText','FACEBOOK_APP_ID','data','access_token','3185808WBurWI','create','getSubscribedApps','stringify','createReadStream','3426714GzBLlw','https://graph.facebook.com/v13.0/oauth/access_token','recipient','env','/subscribed_apps?access_token=','message_deliveries','4813284ymKwZu','append','5ILaUke','sendAttachmentFromUrl','4cWzuww','message_reads','sendAttachment','getHeaders','path','mark_seen','/permissions','genText','ERR_SUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','log','subscribeApp','getProfile','FACEBOOK_APP_SECRET','messaging_postbacks','getPageProfile','unsubscribeApp','/subscribed_apps','error','logger','__esModule','form-data','markSeen','419958VWRAVv','?access_token=','371834GZBzbt','https://graph.facebook.com/v13.0/','message','ERR_UNSUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','default','123580trvLGu','delete','me/messages','ERR_GETTING_SUBSCRIBED_APPS','ERR_REMOVING_APP_FROM_PAGE','post','filedata','ERR_FETCHING_FB_USER_PROFILE_2','removeApplcation','getAccessTokenFromPage','ERR_FETCHING_FB_USER_TOKEN'];a447_0x4e88=function(){return _0x48cd0b;};return a447_0x4e88();}exports[a447_0x271322(0x116)]=genText;const getProfile=async(_0x17d2dd,_0x3159de)=>{const _0x51fe72=a447_0x271322;try{const {data:_0x1a07bc}=await apiBase(_0x3159de)[_0x51fe72(0xfa)](_0x17d2dd);return _0x1a07bc;}catch(_0xcc6172){console[_0x51fe72(0x118)](_0xcc6172);throw new Error(_0x51fe72(0xf3));}};exports[a447_0x271322(0x11a)]=getProfile;const getPageProfile=async(_0x4620ba,_0x4824ce)=>{const _0x441be8=a447_0x271322;try{const {data:_0x494ee4}=await apiBase(_0x4824ce)[_0x441be8(0xfa)](_0x4620ba+_0x441be8(0xfb));return _0x494ee4;}catch(_0x33bc69){console[_0x441be8(0x118)](_0x33bc69);throw new Error('ERR_FETCHING_FB_PAGES');}};exports[a447_0x271322(0x11d)]=getPageProfile;const profilePsid=async(_0x576e02,_0x52ec90)=>{const _0x4af265=a447_0x271322;try{const {data:_0x5aa053}=await axios_1['default'][_0x4af265(0xfa)](_0x4af265(0x128)+_0x576e02+_0x4af265(0x126)+_0x52ec90);return _0x5aa053;}catch(_0x2c5a8f){console['log'](_0x2c5a8f),await(0x0,exports[_0x4af265(0x11a)])(_0x576e02,_0x52ec90);}};exports['profilePsid']=profilePsid;const subscribeApp=async(_0x5d278f,_0x29b908)=>{const _0x5bf2e9=a447_0x271322;try{const {data:_0x3b3aa8}=await axios_1[_0x5bf2e9(0xeb)][_0x5bf2e9(0xf1)](_0x5bf2e9(0x128)+_0x5d278f+'/subscribed_apps?access_token='+_0x29b908,{'subscribed_fields':['messages',_0x5bf2e9(0x11c),_0x5bf2e9(0x10a),_0x5bf2e9(0x110),'message_echoes']});return _0x3b3aa8;}catch(_0x56b401){console[_0x5bf2e9(0x118)](_0x56b401);throw new Error(_0x5bf2e9(0x117));}};exports['subscribeApp']=subscribeApp;const unsubscribeApp=async(_0x1fb310,_0x37dcec)=>{const _0x45ead4=a447_0x271322;try{const {data:_0x134b58}=await axios_1[_0x45ead4(0xeb)][_0x45ead4(0xed)](_0x45ead4(0x128)+_0x1fb310+_0x45ead4(0x109)+_0x37dcec);return _0x134b58;}catch(_0x254aba){throw new Error(_0x45ead4(0xea));}};exports['unsubscribeApp']=unsubscribeApp;const getSubscribedApps=async(_0x18bc21,_0xb09af)=>{const _0x33e581=a447_0x271322;try{const {data:_0x55e3c0}=await apiBase(_0xb09af)[_0x33e581(0xfa)](_0x18bc21+_0x33e581(0x11f));return _0x55e3c0;}catch(_0x35751f){throw new Error(_0x33e581(0xef));}};exports[a447_0x271322(0x102)]=getSubscribedApps;const getAccessTokenFromPage=async _0x41d3c7=>{const _0x321d52=a447_0x271322;try{if(!_0x41d3c7)throw new Error('ERR_FETCHING_FB_USER_TOKEN');const _0x1276e9=await axios_1[_0x321d52(0xeb)]['get'](_0x321d52(0x106),{'params':{'client_id':process[_0x321d52(0x108)][_0x321d52(0xfd)],'client_secret':process[_0x321d52(0x108)][_0x321d52(0x11b)],'grant_type':_0x321d52(0xf7),'fb_exchange_token':_0x41d3c7}});return _0x1276e9[_0x321d52(0xfe)]['access_token'];}catch(_0x45fd38){console[_0x321d52(0x118)](_0x45fd38);throw new Error(_0x321d52(0xf6));}};exports[a447_0x271322(0xf5)]=getAccessTokenFromPage;const removeApplcation=async(_0x556b19,_0x460765)=>{const _0x19fcad=a447_0x271322;try{await axios_1[_0x19fcad(0xeb)][_0x19fcad(0xed)](_0x19fcad(0x128)+_0x556b19+_0x19fcad(0x115),{'params':{'access_token':_0x460765}});}catch(_0x3d5734){logger_1[_0x19fcad(0x121)][_0x19fcad(0x120)](_0x19fcad(0xf0));}};exports[a447_0x271322(0xf4)]=removeApplcation;