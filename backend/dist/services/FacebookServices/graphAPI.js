'use strict';const a480_0x5523ae=a480_0x1bb4;(function(_0x34b65c,_0x5d27e1){const _0x4f2a89=a480_0x1bb4,_0x764f60=_0x34b65c();while(!![]){try{const _0x521f01=-parseInt(_0x4f2a89(0x186))/0x1+-parseInt(_0x4f2a89(0x175))/0x2*(parseInt(_0x4f2a89(0x18d))/0x3)+-parseInt(_0x4f2a89(0x1ab))/0x4+-parseInt(_0x4f2a89(0x1aa))/0x5*(-parseInt(_0x4f2a89(0x1a6))/0x6)+parseInt(_0x4f2a89(0x19d))/0x7+parseInt(_0x4f2a89(0x1a7))/0x8+-parseInt(_0x4f2a89(0x1a8))/0x9*(-parseInt(_0x4f2a89(0x1af))/0xa);if(_0x521f01===_0x5d27e1)break;else _0x764f60['push'](_0x764f60['shift']());}catch(_0x4236b7){_0x764f60['push'](_0x764f60['shift']());}}}(a480_0x5b92,0x391fd));var __importDefault=this&&this[a480_0x5523ae(0x177)]||function(_0x83a31e){const _0x48ec2f=a480_0x5523ae;return _0x83a31e&&_0x83a31e[_0x48ec2f(0x181)]?_0x83a31e:{'default':_0x83a31e};};Object['defineProperty'](exports,a480_0x5523ae(0x181),{'value':!![]}),exports[a480_0x5523ae(0x196)]=exports[a480_0x5523ae(0x19e)]=exports[a480_0x5523ae(0x1a2)]=exports[a480_0x5523ae(0x188)]=exports[a480_0x5523ae(0x192)]=exports[a480_0x5523ae(0x18f)]=exports[a480_0x5523ae(0x1a4)]=exports['getProfile']=exports[a480_0x5523ae(0x17d)]=exports[a480_0x5523ae(0x1b0)]=exports[a480_0x5523ae(0x18c)]=exports[a480_0x5523ae(0x1b3)]=exports[a480_0x5523ae(0x17e)]=exports[a480_0x5523ae(0x179)]=void 0x0;const axios_1=__importDefault(require(a480_0x5523ae(0x171))),form_data_1=__importDefault(require(a480_0x5523ae(0x18e))),fs_1=require('fs'),logger_1=require('../../utils/logger'),formData=new form_data_1[(a480_0x5523ae(0x18b))](),apiBase=_0x4be701=>axios_1[a480_0x5523ae(0x18b)][a480_0x5523ae(0x199)]({'baseURL':'https://graph.facebook.com/v13.0/','params':{'access_token':_0x4be701}}),getAccessToken=async()=>{const _0x2aa66a=a480_0x5523ae,{data:_0x15643f}=await axios_1['default'][_0x2aa66a(0x190)](_0x2aa66a(0x174),{'params':{'client_id':process[_0x2aa66a(0x1a0)][_0x2aa66a(0x17b)],'client_secret':process[_0x2aa66a(0x1a0)][_0x2aa66a(0x178)],'grant_type':'client_credentials'}});return _0x15643f[_0x2aa66a(0x19b)];};exports['getAccessToken']=getAccessToken;const markSeen=async(_0xe3b44,_0x28c089)=>{const _0x2cfb56=a480_0x5523ae;await apiBase(_0x28c089)[_0x2cfb56(0x193)](_0xe3b44+_0x2cfb56(0x182),{'recipient':{'id':_0xe3b44},'sender_action':_0x2cfb56(0x191)});};exports[a480_0x5523ae(0x17e)]=markSeen;const sendText=async(_0x1e5b92,_0x4ae6f2,_0xe64e60)=>{const _0x5951bf=a480_0x5523ae;try{const {data:_0x1ef71b}=await apiBase(_0xe64e60)['post'](_0x5951bf(0x187),{'recipient':{'id':_0x1e5b92},'message':{'text':''+_0x4ae6f2}});return _0x1ef71b;}catch(_0x2a6430){console[_0x5951bf(0x189)](_0x2a6430);}};exports[a480_0x5523ae(0x1b3)]=sendText;const sendAttachmentFromUrl=async(_0x233ff6,_0x44b45b,_0x225b23,_0x22a60d)=>{const _0x14203b=a480_0x5523ae;try{const {data:_0x2c9d09}=await apiBase(_0x22a60d)[_0x14203b(0x193)](_0x14203b(0x187),{'recipient':{'id':_0x233ff6},'message':{'attachment':{'type':_0x225b23,'payload':{'url':_0x44b45b}}}});return _0x2c9d09;}catch(_0x2afe80){console['log'](_0x2afe80);}};exports[a480_0x5523ae(0x18c)]=sendAttachmentFromUrl;const sendAttachment=async(_0x39dc3a,_0x4da6be,_0x1d302f,_0x58c1d5)=>{const _0x4e959e=a480_0x5523ae;formData[_0x4e959e(0x1b1)](_0x4e959e(0x17f),JSON['stringify']({'id':_0x39dc3a})),formData[_0x4e959e(0x1b1)](_0x4e959e(0x17c),JSON[_0x4e959e(0x198)]({'attachment':{'type':_0x1d302f,'payload':{'is_reusable':!![]}}}));const _0x499065=(0x0,fs_1['createReadStream'])(_0x4da6be['path']);formData[_0x4e959e(0x1b1)](_0x4e959e(0x195),_0x499065);try{await apiBase(_0x58c1d5)[_0x4e959e(0x193)](_0x4e959e(0x187),formData,{'headers':{...formData[_0x4e959e(0x1ad)]()}});}catch(_0x5ab7ae){throw new Error(_0x5ab7ae);}};exports[a480_0x5523ae(0x1b0)]=sendAttachment;const genText=_0x763aa4=>{const _0xb164bb={'text':_0x763aa4};return _0xb164bb;};exports[a480_0x5523ae(0x17d)]=genText;const getProfile=async(_0x44dee5,_0x110b2e)=>{const _0x5038d7=a480_0x5523ae;try{const {data:_0x5ba47d}=await apiBase(_0x110b2e)[_0x5038d7(0x190)](_0x44dee5);return _0x5ba47d;}catch(_0x34ecff){console[_0x5038d7(0x189)](_0x34ecff);throw new Error(_0x5038d7(0x17a));}};exports[a480_0x5523ae(0x1b2)]=getProfile;const getPageProfile=async(_0x3446d0,_0x5734b2)=>{const _0x3a40f3=a480_0x5523ae;try{const {data:_0x2a6146}=await apiBase(_0x5734b2)[_0x3a40f3(0x190)](_0x3446d0+_0x3a40f3(0x1a5));return _0x2a6146;}catch(_0x14b46f){console['log'](_0x14b46f);throw new Error(_0x3a40f3(0x184));}};exports[a480_0x5523ae(0x1a4)]=getPageProfile;const profilePsid=async(_0x19d07f,_0x2415a5)=>{const _0x589101=a480_0x5523ae;try{const {data:_0x5bcfb8}=await axios_1[_0x589101(0x18b)][_0x589101(0x190)](_0x589101(0x180)+_0x19d07f+_0x589101(0x1ae)+_0x2415a5);return _0x5bcfb8;}catch(_0xb5c85e){console[_0x589101(0x189)](_0xb5c85e),await(0x0,exports[_0x589101(0x1b2)])(_0x19d07f,_0x2415a5);}};function a480_0x1bb4(_0x370384,_0x262851){const _0x5b927f=a480_0x5b92();return a480_0x1bb4=function(_0x1bb4ff,_0x4eb81d){_0x1bb4ff=_0x1bb4ff-0x171;let _0x42a8c3=_0x5b927f[_0x1bb4ff];return _0x42a8c3;},a480_0x1bb4(_0x370384,_0x262851);}exports[a480_0x5523ae(0x18f)]=profilePsid;const subscribeApp=async(_0x5266db,_0x3ad3e5)=>{const _0x44070=a480_0x5523ae;try{const {data:_0x36e776}=await axios_1[_0x44070(0x18b)]['post']('https://graph.facebook.com/v13.0/'+_0x5266db+_0x44070(0x185)+_0x3ad3e5,{'subscribed_fields':['messages',_0x44070(0x1a3),_0x44070(0x19f),'message_reads',_0x44070(0x1a9)]});return _0x36e776;}catch(_0x3879c7){console['log'](_0x3879c7);throw new Error(_0x44070(0x183));}};exports[a480_0x5523ae(0x192)]=subscribeApp;const unsubscribeApp=async(_0x44a89c,_0x148083)=>{const _0x167359=a480_0x5523ae;try{const {data:_0x48efbe}=await axios_1['default'][_0x167359(0x1ac)]('https://graph.facebook.com/v13.0/'+_0x44a89c+'/subscribed_apps?access_token='+_0x148083);return _0x48efbe;}catch(_0x3aba0b){throw new Error(_0x167359(0x1a1));}};exports[a480_0x5523ae(0x188)]=unsubscribeApp;const getSubscribedApps=async(_0x2ddb28,_0x27b002)=>{const _0x5dacd6=a480_0x5523ae;try{const {data:_0x4f0576}=await apiBase(_0x27b002)[_0x5dacd6(0x190)](_0x2ddb28+_0x5dacd6(0x172));return _0x4f0576;}catch(_0x5d3ce2){throw new Error(_0x5dacd6(0x19a));}};exports[a480_0x5523ae(0x1a2)]=getSubscribedApps;function a480_0x5b92(){const _0x3b1bf9=['__esModule','/messages','ERR_SUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','ERR_FETCHING_FB_PAGES','/subscribed_apps?access_token=','48435NMRXTb','me/messages','unsubscribeApp','log','ERR_FETCHING_FB_USER_TOKEN','default','sendAttachmentFromUrl','3QeUIjm','form-data','profilePsid','get','mark_seen','subscribeApp','post','error','filedata','removeApplcation','/permissions','stringify','create','ERR_GETTING_SUBSCRIBED_APPS','access_token','ERR_REMOVING_APP_FROM_PAGE','1852641xWxoEx','getAccessTokenFromPage','message_deliveries','env','ERR_UNSUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','getSubscribedApps','messaging_postbacks','getPageProfile','/accounts?fields=name,access_token,instagram_business_account{id,username,profile_picture_url,name}','50658jzXanH','1068088AozhUm','3247443EWcdVP','message_echoes','5Lfbarz','1574176dwxKVq','delete','getHeaders','?access_token=','10qibZRx','sendAttachment','append','getProfile','sendText','axios','/subscribed_apps','logger','https://graph.facebook.com/v13.0/oauth/access_token','182968iTJEXq','data','__importDefault','FACEBOOK_APP_SECRET','getAccessToken','ERR_FETCHING_FB_USER_PROFILE_2','FACEBOOK_APP_ID','message','genText','markSeen','recipient','https://graph.facebook.com/v13.0/'];a480_0x5b92=function(){return _0x3b1bf9;};return a480_0x5b92();}const getAccessTokenFromPage=async _0x3b4a02=>{const _0x68ab5e=a480_0x5523ae;try{if(!_0x3b4a02)throw new Error(_0x68ab5e(0x18a));const _0x43bf65=await axios_1[_0x68ab5e(0x18b)][_0x68ab5e(0x190)](_0x68ab5e(0x174),{'params':{'client_id':process[_0x68ab5e(0x1a0)][_0x68ab5e(0x17b)],'client_secret':process[_0x68ab5e(0x1a0)]['FACEBOOK_APP_SECRET'],'grant_type':'fb_exchange_token','fb_exchange_token':_0x3b4a02}});return _0x43bf65[_0x68ab5e(0x176)][_0x68ab5e(0x19b)];}catch(_0x72fb8f){console[_0x68ab5e(0x189)](_0x72fb8f);throw new Error('ERR_FETCHING_FB_USER_TOKEN');}};exports[a480_0x5523ae(0x19e)]=getAccessTokenFromPage;const removeApplcation=async(_0x313644,_0x4a2ff9)=>{const _0x1177dc=a480_0x5523ae;try{await axios_1['default']['delete'](_0x1177dc(0x180)+_0x313644+_0x1177dc(0x197),{'params':{'access_token':_0x4a2ff9}});}catch(_0x18b94){logger_1[_0x1177dc(0x173)][_0x1177dc(0x194)](_0x1177dc(0x19c));}};exports[a480_0x5523ae(0x196)]=removeApplcation;