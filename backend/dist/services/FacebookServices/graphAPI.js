'use strict';const a470_0x41e4e5=a470_0x1740;(function(_0x4267b3,_0x97a224){const _0x3b993b=a470_0x1740,_0x3de5c8=_0x4267b3();while(!![]){try{const _0x4f4e9e=parseInt(_0x3b993b(0x10f))/0x1*(parseInt(_0x3b993b(0xf6))/0x2)+parseInt(_0x3b993b(0xf8))/0x3*(parseInt(_0x3b993b(0x10b))/0x4)+parseInt(_0x3b993b(0xfe))/0x5+parseInt(_0x3b993b(0x106))/0x6*(-parseInt(_0x3b993b(0xed))/0x7)+-parseInt(_0x3b993b(0x128))/0x8*(parseInt(_0x3b993b(0xf5))/0x9)+parseInt(_0x3b993b(0x111))/0xa+-parseInt(_0x3b993b(0xfa))/0xb;if(_0x4f4e9e===_0x97a224)break;else _0x3de5c8['push'](_0x3de5c8['shift']());}catch(_0x5838d8){_0x3de5c8['push'](_0x3de5c8['shift']());}}}(a470_0xbffb,0x94e31));function a470_0xbffb(){const _0x55255d=['logger','sendAttachmentFromUrl','axios','message','recipient','create','6WKyVzy','/subscribed_apps?access_token=','filedata','path','FACEBOOK_APP_ID','7108sftzeL','data','default','createReadStream','1udATvH','https://graph.facebook.com/v13.0/oauth/access_token','7695570mFRUsc','sendText','/permissions','https://graph.facebook.com/v13.0/','append','/accounts?fields=name,access_token,instagram_business_account{id,username,profile_picture_url,name}','sendAttachment','unsubscribeApp','ERR_SUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','mark_seen','FACEBOOK_APP_SECRET','getProfile','ERR_FETCHING_FB_PAGES','getSubscribedApps','markSeen','__importDefault','getAccessToken','log','/messages','removeApplcation','ERR_UNSUBSCRIBING_PAGE_TO_MESSAGE_WEBHOOKS','fb_exchange_token','post','40OwzEZU','getAccessTokenFromPage','ERR_FETCHING_FB_USER_PROFILE_2','profilePsid','/subscribed_apps','access_token','env','messages','message_echoes','client_credentials','6185879CZaDHY','me/messages','ERR_FETCHING_FB_USER_TOKEN','ERR_GETTING_SUBSCRIBED_APPS','genText','form-data','defineProperty','__esModule','88713bDIjeG','6952YsdUCg','message_deliveries','879XSTjAZ','stringify','5274390WCpTmR','delete','messaging_postbacks','get','3643095bZYlFL','subscribeApp'];a470_0xbffb=function(){return _0x55255d;};return a470_0xbffb();}var __importDefault=this&&this[a470_0x41e4e5(0x120)]||function(_0x5ac04d){const _0x509458=a470_0x41e4e5;return _0x5ac04d&&_0x5ac04d[_0x509458(0xf4)]?_0x5ac04d:{'default':_0x5ac04d};};Object[a470_0x41e4e5(0xf3)](exports,a470_0x41e4e5(0xf4),{'value':!![]}),exports[a470_0x41e4e5(0x124)]=exports[a470_0x41e4e5(0xe4)]=exports['getSubscribedApps']=exports[a470_0x41e4e5(0x118)]=exports[a470_0x41e4e5(0xff)]=exports[a470_0x41e4e5(0xe6)]=exports['getPageProfile']=exports[a470_0x41e4e5(0x11c)]=exports[a470_0x41e4e5(0xf1)]=exports['sendAttachment']=exports[a470_0x41e4e5(0x101)]=exports[a470_0x41e4e5(0x112)]=exports[a470_0x41e4e5(0x11f)]=exports[a470_0x41e4e5(0x121)]=void 0x0;const axios_1=__importDefault(require(a470_0x41e4e5(0x102))),form_data_1=__importDefault(require(a470_0x41e4e5(0xf2))),fs_1=require('fs'),logger_1=require('../../utils/logger'),formData=new form_data_1[(a470_0x41e4e5(0x10d))](),apiBase=_0x1c0cef=>axios_1['default'][a470_0x41e4e5(0x105)]({'baseURL':a470_0x41e4e5(0x114),'params':{'access_token':_0x1c0cef}}),getAccessToken=async()=>{const _0x35577a=a470_0x41e4e5,{data:_0xf349f2}=await axios_1['default'][_0x35577a(0xfd)](_0x35577a(0x110),{'params':{'client_id':process[_0x35577a(0xe9)][_0x35577a(0x10a)],'client_secret':process['env'][_0x35577a(0x11b)],'grant_type':_0x35577a(0xec)}});return _0xf349f2[_0x35577a(0xe8)];};exports['getAccessToken']=getAccessToken;const markSeen=async(_0xb805c1,_0x49d059)=>{const _0x4cfec1=a470_0x41e4e5;await apiBase(_0x49d059)['post'](_0xb805c1+_0x4cfec1(0x123),{'recipient':{'id':_0xb805c1},'sender_action':_0x4cfec1(0x11a)});};exports[a470_0x41e4e5(0x11f)]=markSeen;const sendText=async(_0xcfca77,_0x3eca99,_0x4fd014)=>{const _0x8b7af7=a470_0x41e4e5;try{const {data:_0x2c6814}=await apiBase(_0x4fd014)[_0x8b7af7(0x127)](_0x8b7af7(0xee),{'recipient':{'id':_0xcfca77},'message':{'text':''+_0x3eca99}});return _0x2c6814;}catch(_0x263ce8){console[_0x8b7af7(0x122)](_0x263ce8);}};exports[a470_0x41e4e5(0x112)]=sendText;const sendAttachmentFromUrl=async(_0x12f267,_0x25b2c0,_0x5de80c,_0x1e73fb)=>{const _0x483c5d=a470_0x41e4e5;try{const {data:_0x31f9f9}=await apiBase(_0x1e73fb)[_0x483c5d(0x127)](_0x483c5d(0xee),{'recipient':{'id':_0x12f267},'message':{'attachment':{'type':_0x5de80c,'payload':{'url':_0x25b2c0}}}});return _0x31f9f9;}catch(_0x4a621b){console[_0x483c5d(0x122)](_0x4a621b);}};exports['sendAttachmentFromUrl']=sendAttachmentFromUrl;const sendAttachment=async(_0x282ada,_0x54ad46,_0x5b349b,_0x211dce)=>{const _0x243997=a470_0x41e4e5;formData[_0x243997(0x115)](_0x243997(0x104),JSON[_0x243997(0xf9)]({'id':_0x282ada})),formData['append'](_0x243997(0x103),JSON[_0x243997(0xf9)]({'attachment':{'type':_0x5b349b,'payload':{'is_reusable':!![]}}}));const _0x1a8ddd=(0x0,fs_1[_0x243997(0x10e)])(_0x54ad46[_0x243997(0x109)]);formData[_0x243997(0x115)](_0x243997(0x108),_0x1a8ddd);try{await apiBase(_0x211dce)['post'](_0x243997(0xee),formData,{'headers':{...formData['getHeaders']()}});}catch(_0x3555ae){throw new Error(_0x3555ae);}};exports[a470_0x41e4e5(0x117)]=sendAttachment;const genText=_0x4a7040=>{const _0x3adb9f={'text':_0x4a7040};return _0x3adb9f;};exports['genText']=genText;const getProfile=async(_0x4557d4,_0x2d843a)=>{const _0x4a2b7b=a470_0x41e4e5;try{const {data:_0x1bc3cf}=await apiBase(_0x2d843a)[_0x4a2b7b(0xfd)](_0x4557d4);return _0x1bc3cf;}catch(_0x5171ec){console[_0x4a2b7b(0x122)](_0x5171ec);throw new Error(_0x4a2b7b(0xe5));}};exports[a470_0x41e4e5(0x11c)]=getProfile;const getPageProfile=async(_0x490918,_0x1fff32)=>{const _0x54b870=a470_0x41e4e5;try{const {data:_0x10fc96}=await apiBase(_0x1fff32)[_0x54b870(0xfd)](_0x490918+_0x54b870(0x116));return _0x10fc96;}catch(_0x23ac50){console[_0x54b870(0x122)](_0x23ac50);throw new Error(_0x54b870(0x11d));}};exports['getPageProfile']=getPageProfile;const profilePsid=async(_0x1670c2,_0x592135)=>{const _0x342f32=a470_0x41e4e5;try{const {data:_0x1b25d0}=await axios_1[_0x342f32(0x10d)][_0x342f32(0xfd)]('https://graph.facebook.com/v13.0/'+_0x1670c2+'?access_token='+_0x592135);return _0x1b25d0;}catch(_0x37707f){console[_0x342f32(0x122)](_0x37707f),await(0x0,exports['getProfile'])(_0x1670c2,_0x592135);}};exports[a470_0x41e4e5(0xe6)]=profilePsid;const subscribeApp=async(_0x39f500,_0x5a5990)=>{const _0x3e64c9=a470_0x41e4e5;try{const {data:_0x501bc0}=await axios_1['default'][_0x3e64c9(0x127)](_0x3e64c9(0x114)+_0x39f500+_0x3e64c9(0x107)+_0x5a5990,{'subscribed_fields':[_0x3e64c9(0xea),_0x3e64c9(0xfc),_0x3e64c9(0xf7),'message_reads',_0x3e64c9(0xeb)]});return _0x501bc0;}catch(_0x35a3a9){console['log'](_0x35a3a9);throw new Error(_0x3e64c9(0x119));}};exports[a470_0x41e4e5(0xff)]=subscribeApp;const unsubscribeApp=async(_0x2315ce,_0x1143da)=>{const _0x168154=a470_0x41e4e5;try{const {data:_0x2f1096}=await axios_1['default'][_0x168154(0xfb)](_0x168154(0x114)+_0x2315ce+'/subscribed_apps?access_token='+_0x1143da);return _0x2f1096;}catch(_0x3f0ec0){throw new Error(_0x168154(0x125));}};exports[a470_0x41e4e5(0x118)]=unsubscribeApp;const getSubscribedApps=async(_0x421782,_0x406867)=>{const _0x16f9d=a470_0x41e4e5;try{const {data:_0x38fb98}=await apiBase(_0x406867)['get'](_0x421782+_0x16f9d(0xe7));return _0x38fb98;}catch(_0x2318a4){throw new Error(_0x16f9d(0xf0));}};exports[a470_0x41e4e5(0x11e)]=getSubscribedApps;const getAccessTokenFromPage=async _0x2a3d62=>{const _0x187490=a470_0x41e4e5;try{if(!_0x2a3d62)throw new Error(_0x187490(0xef));const _0x377af4=await axios_1['default'][_0x187490(0xfd)]('https://graph.facebook.com/v13.0/oauth/access_token',{'params':{'client_id':process[_0x187490(0xe9)][_0x187490(0x10a)],'client_secret':process['env'][_0x187490(0x11b)],'grant_type':_0x187490(0x126),'fb_exchange_token':_0x2a3d62}});return _0x377af4[_0x187490(0x10c)]['access_token'];}catch(_0x2a685e){console['log'](_0x2a685e);throw new Error(_0x187490(0xef));}};function a470_0x1740(_0x97e941,_0x48eb16){const _0xbffbb7=a470_0xbffb();return a470_0x1740=function(_0x17405c,_0x42fdff){_0x17405c=_0x17405c-0xe4;let _0x138802=_0xbffbb7[_0x17405c];return _0x138802;},a470_0x1740(_0x97e941,_0x48eb16);}exports[a470_0x41e4e5(0xe4)]=getAccessTokenFromPage;const removeApplcation=async(_0xb51624,_0x57b1c6)=>{const _0x14b6fc=a470_0x41e4e5;try{await axios_1[_0x14b6fc(0x10d)]['delete'](_0x14b6fc(0x114)+_0xb51624+_0x14b6fc(0x113),{'params':{'access_token':_0x57b1c6}});}catch(_0x2640b2){logger_1[_0x14b6fc(0x100)]['error']('ERR_REMOVING_APP_FROM_PAGE');}};exports[a470_0x41e4e5(0x124)]=removeApplcation;