<<<<<<< HEAD
'use strict';const a469_0x5f37cb=a469_0x3e1d;(function(_0x142747,_0x2e04ad){const _0x26274e=a469_0x3e1d,_0x5a44f2=_0x142747();while(!![]){try{const _0x9f8bcd=-parseInt(_0x26274e(0x128))/0x1*(parseInt(_0x26274e(0xfa))/0x2)+parseInt(_0x26274e(0x103))/0x3+parseInt(_0x26274e(0x115))/0x4*(parseInt(_0x26274e(0x105))/0x5)+parseInt(_0x26274e(0x140))/0x6+-parseInt(_0x26274e(0x134))/0x7+-parseInt(_0x26274e(0xf2))/0x8*(parseInt(_0x26274e(0x125))/0x9)+-parseInt(_0x26274e(0x136))/0xa*(-parseInt(_0x26274e(0x145))/0xb);if(_0x9f8bcd===_0x2e04ad)break;else _0x5a44f2['push'](_0x5a44f2['shift']());}catch(_0xa1499b){_0x5a44f2['push'](_0x5a44f2['shift']());}}}(a469_0x4da2,0x1cad4));function a469_0x3e1d(_0x3d384d,_0x7f95ff){const _0x4da2dc=a469_0x4da2();return a469_0x3e1d=function(_0x3e1d8d,_0x1ef757){_0x3e1d8d=_0x3e1d8d-0xe9;let _0x10eae1=_0x4da2dc[_0x3e1d8d];return _0x10eae1;},a469_0x3e1d(_0x3d384d,_0x7f95ff);}var __importDefault=this&&this[a469_0x5f37cb(0x107)]||function(_0x16fc10){const _0x5cae3b=a469_0x5f37cb;return _0x16fc10&&_0x16fc10[_0x5cae3b(0xef)]?_0x16fc10:{'default':_0x16fc10};};Object[a469_0x5f37cb(0x133)](exports,a469_0x5f37cb(0xef),{'value':!![]}),exports[a469_0x5f37cb(0x153)]=exports['verifyMessageMedia']=exports['verifyMessageFace']=void 0x0;function a469_0x4da2(){const _0xfe53=['url','maxUseBotQueuesNPS','message_id','lgpdConsent','attachments','../../models/CompaniesSettings','sendText','defineProperty','1554357DrZznj','userId','2904710IHgelx','mkdirSync','isNil','color','message','companyId','maxUseBotQueues','file-type','ratingMessage','queueId','1090476drVpVf','ASC','text','../../models/Chatbot','facebookUserToken','11qMkdtX','../WbotServices/wbotMessageListener','‎Estou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20Não','payload','axios',']\x20-\x20','../WhatsappService/ShowWhatsAppService','\x0a[#]\x20Voltar\x20para\x20o\x20menu\x20principal','amountUsedBotQueues','length','greetingMessage','toDate','status','../../models/Message','handleMessage','name','mid','verifyMessageMedia','verifyRating','facebookPageUserId','lgpdMessage','__esModule','pending','../ContactServices/CreateOrUpdateContactService','56RDvBLI','isNaN','existsSync','lgpd','queue','type','../../helpers/Mustache','handleRating','77986QyYdOS','enabled','first_name','findOne','lodash','enableLGPD','closed','head','forEach','264393uaaiXK','reload','59655SgEnba','test','__importDefault','user','number','../TicketServices/FindOrCreateATicketTrakingService','lgpdLink','nps','stringify','recipient','lgpdAcceptedAt','arraybuffer','../../models/Queue','profilePsid','reply_to','chatbots','12fhiRNZ','../MessageServices/CreateMessageService','getTime','amountUseBotQueuesNPS','is_echo','farewellMessage','complationMessage','isGroup','lgpdSendMessageAt','isInteger','‎Opção\x20inválida,\x20tente\x20novamente.\x0a','public/company','queues','moment','update','sender','279819hBLzIW','../TicketServices/UpdateTicketService','default','1VazPdu','verifyMessageFace','ext','log'];a469_0x4da2=function(){return _0xfe53;};return a469_0x4da2();}const fs_1=require('fs'),fs_2=__importDefault(require('fs')),axios_1=__importDefault(require(a469_0x5f37cb(0x149))),moment_1=__importDefault(require(a469_0x5f37cb(0x122))),path_1=require('path'),CreateOrUpdateContactService_1=__importDefault(require(a469_0x5f37cb(0xf1))),CreateMessageService_1=__importDefault(require(a469_0x5f37cb(0x116))),FindOrCreateTicketService_1=__importDefault(require('../TicketServices/FindOrCreateTicketService')),graphAPI_1=require('./graphAPI'),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),UpdateTicketService_1=__importDefault(require(a469_0x5f37cb(0x126))),ShowWhatsAppService_1=__importDefault(require(a469_0x5f37cb(0x14b))),Mustache_1=__importDefault(require(a469_0x5f37cb(0xf8))),Queue_1=__importDefault(require(a469_0x5f37cb(0x111))),Chatbot_1=__importDefault(require(a469_0x5f37cb(0x143))),Message_1=__importDefault(require(a469_0x5f37cb(0x152))),ChatbotListenerFacebook_1=require('../WbotServices/ChatbotListenerFacebook'),lodash_1=require(a469_0x5f37cb(0xfe)),FindOrCreateATicketTrakingService_1=__importDefault(require(a469_0x5f37cb(0x10a))),wbotMessageListener_1=require(a469_0x5f37cb(0x146)),CompaniesSettings_1=__importDefault(require(a469_0x5f37cb(0x131))),sendFacebookMessage_1=__importDefault(require('./sendFacebookMessage')),verifyContact=async(_0x48f11b,_0x3a8299,_0x1976ce)=>{const _0x4e5bf7=a469_0x5f37cb;if(!_0x48f11b)return null;const _0x45b2e0={'name':_0x48f11b?.[_0x4e5bf7(0xe9)]||_0x48f11b?.[_0x4e5bf7(0xfc)]+'\x20'+_0x48f11b?.['last_name'],'number':_0x48f11b['id'],'profilePicUrl':'','isGroup':![],'companyId':_0x1976ce,'channel':_0x3a8299},_0x3edd3f=(0x0,CreateOrUpdateContactService_1[_0x4e5bf7(0x127)])(_0x45b2e0);return _0x3edd3f;},verifyMessageFace=async(_0x30f4aa,_0x41e71e,_0x4ebe0b,_0x2ab5d1)=>{const _0xa00d1a=a469_0x5f37cb,_0x389ff5=await verifyQuotedMessage(_0x30f4aa),_0x32a62e={'wid':_0x30f4aa[_0xa00d1a(0xea)]||_0x30f4aa[_0xa00d1a(0x12e)],'ticketId':_0x4ebe0b['id'],'contactId':_0x30f4aa['is_echo']?undefined:_0x2ab5d1['id'],'body':_0x30f4aa[_0xa00d1a(0x142)]||_0x41e71e,'fromMe':_0x30f4aa['is_echo']?!![]:![],'read':_0x30f4aa?.['is_echo'],'quotedMsgId':_0x389ff5?.['id'],'ack':0x3,'dataJson':JSON[_0xa00d1a(0x10d)](_0x30f4aa)};await(0x0,CreateMessageService_1[_0xa00d1a(0x127)])({'messageData':_0x32a62e,'companyId':_0x4ebe0b[_0xa00d1a(0x13b)]}),await _0x4ebe0b['update']({'lastMessage':_0x30f4aa['text']});};exports[a469_0x5f37cb(0x129)]=verifyMessageFace;const verifyMessageMedia=async(_0x22ec91,_0xab57ca,_0x103540)=>{const _0x5b20d7=a469_0x5f37cb,{data:_0x563414}=await axios_1[_0x5b20d7(0x127)]['get'](_0x22ec91['attachments'][0x0][_0x5b20d7(0x148)][_0x5b20d7(0x12c)],{'responseType':_0x5b20d7(0x110)}),{fileTypeFromBuffer:_0x3c0c68}=await eval('const _0xe32099 = _0x5b20d7;import(_0xe32099(317));'),_0x26024f=await _0x3c0c68(_0x563414),_0x5980b8=new Date()[_0x5b20d7(0x117)]()+'.'+_0x26024f[_0x5b20d7(0x12a)],_0x5706c3=_0x5b20d7(0x120)+_0xab57ca[_0x5b20d7(0x13b)];!fs_2[_0x5b20d7(0x127)][_0x5b20d7(0xf4)](_0x5706c3)&&(fs_2['default'][_0x5b20d7(0x137)](_0x5706c3),fs_2['default']['chmodSync'](_0x5706c3,0x1ff));(0x0,fs_1['writeFileSync'])((0x0,path_1['join'])(__dirname,'..','..','..',_0x5706c3,_0x5980b8),_0x563414,'base64');const _0xcd34ef={'wid':_0x22ec91[_0x5b20d7(0xea)],'ticketId':_0xab57ca['id'],'contactId':_0x22ec91[_0x5b20d7(0x119)]?undefined:_0x103540['id'],'body':_0x22ec91[_0x5b20d7(0x142)]||_0x5980b8,'fromMe':_0x22ec91[_0x5b20d7(0x119)]?!![]:![],'mediaType':_0x22ec91[_0x5b20d7(0x130)][0x0][_0x5b20d7(0xf7)],'mediaUrl':_0x5980b8,'read':_0x22ec91['is_echo'],'quotedMsgId':null,'ack':0x3,'dataJson':JSON[_0x5b20d7(0x10d)](_0x22ec91)};await(0x0,CreateMessageService_1[_0x5b20d7(0x127)])({'messageData':_0xcd34ef,'companyId':_0xab57ca[_0x5b20d7(0x13b)]}),await _0xab57ca[_0x5b20d7(0x123)]({'lastMessage':_0x22ec91[_0x5b20d7(0x142)]});};exports[a469_0x5f37cb(0xeb)]=verifyMessageMedia;const verifyQuotedMessage=async _0x9699=>{const _0x3f0a0c=a469_0x5f37cb;if(!_0x9699)return null;const _0x517cdb=_0x9699?.[_0x3f0a0c(0x113)]?.[_0x3f0a0c(0xea)];if(!_0x517cdb)return null;const _0x43c923=await Message_1[_0x3f0a0c(0x127)][_0x3f0a0c(0xfd)]({'where':{'id':_0x517cdb}});if(!_0x43c923)return null;return _0x43c923;},handleMessage=async(_0x1ff13f,_0x362031,_0x539869,_0x4ba578)=>{const _0x1cd068=a469_0x5f37cb;try{if(_0x362031[_0x1cd068(0x13a)]){let _0x20085b,_0x114a30=null;const _0x2d1f5e=_0x362031[_0x1cd068(0x124)]['id'],_0x4159ba=_0x362031[_0x1cd068(0x10e)]['id'],{message:_0x4cb34c}=_0x362031,_0x5672aa=_0x4cb34c[_0x1cd068(0x119)];let _0x1e35f8=_0x4cb34c[_0x1cd068(0x142)];if(_0x5672aa){if(/\u200e/[_0x1cd068(0x106)](_0x4cb34c[_0x1cd068(0x142)]))return;_0x20085b=await(0x0,graphAPI_1[_0x1cd068(0x112)])(_0x4159ba,_0x1ff13f['facebookUserToken']);}else _0x20085b=await(0x0,graphAPI_1[_0x1cd068(0x112)])(_0x2d1f5e,_0x1ff13f['facebookUserToken']);const _0x27904f=await verifyContact(_0x20085b,_0x539869,_0x4ba578),_0x2fca49=_0x5672aa?0x0:0x1,_0xd272ba=await Whatsapp_1['default'][_0x1cd068(0xfd)]({'where':{'facebookPageUserId':_0x1ff13f[_0x1cd068(0xed)]},'include':[{'model':Queue_1[_0x1cd068(0x127)],'as':_0x1cd068(0x121),'attributes':['id',_0x1cd068(0xe9),_0x1cd068(0x139),_0x1cd068(0x14f)],'include':[{'model':Chatbot_1[_0x1cd068(0x127)],'as':_0x1cd068(0x114),'attributes':['id',_0x1cd068(0xe9),'greetingMessage']}]}],'order':[[_0x1cd068(0x121),'id',_0x1cd068(0x141)],['queues',_0x1cd068(0x114),'id',_0x1cd068(0x141)]]}),_0x27c744=await CompaniesSettings_1[_0x1cd068(0x127)][_0x1cd068(0xfd)]({'where':{'companyId':_0x4ba578}}),{ticket:_0x49fd56}=await(0x0,FindOrCreateTicketService_1[_0x1cd068(0x127)])(_0x27904f,_0xd272ba,_0x2fca49,_0x4ba578,0x0,0x0,null,_0x539869,null,![],_0x27c744);_0x114a30=_0x49fd56;const _0x5c5f60=await(0x0,FindOrCreateATicketTrakingService_1[_0x1cd068(0x127)])({'ticketId':_0x114a30['id'],'companyId':_0x4ba578,'whatsappId':_0xd272ba?.['id']});if(_0xd272ba[_0x1cd068(0x11a)]&&(0x0,Mustache_1['default'])(_0xd272ba['farewellMessage'],_0x114a30)===_0x4cb34c[_0x1cd068(0x142)])return;await _0x114a30[_0x1cd068(0x123)]({'lastMessage':_0x4cb34c['text']});try{if(!_0x5672aa){if(_0x114a30['status']===_0x1cd068(0x10c)&&_0x5c5f60!==null&&(0x0,wbotMessageListener_1[_0x1cd068(0xec)])(_0x5c5f60)){if(!isNaN(parseFloat(_0x1e35f8))){(0x0,wbotMessageListener_1[_0x1cd068(0xf9)])(parseFloat(_0x1e35f8),_0x114a30,_0x5c5f60),await _0x5c5f60[_0x1cd068(0x123)]({'ratingAt':(0x0,moment_1[_0x1cd068(0x127)])()[_0x1cd068(0x150)](),'finishedAt':(0x0,moment_1[_0x1cd068(0x127)])()[_0x1cd068(0x150)](),'rated':!![]});return;}else{if(_0x114a30[_0x1cd068(0x118)]<_0xd272ba[_0x1cd068(0x12d)]){let _0x47d053=_0x1cd068(0x11f);const _0x252bff=await(0x0,graphAPI_1['sendText'])(_0x27904f[_0x1cd068(0x109)],_0x47d053,_0xd272ba[_0x1cd068(0x144)]);await(0x0,exports[_0x1cd068(0x129)])(_0x252bff,_0x47d053,_0x114a30,_0x27904f);let _0x202a91='‎'+_0xd272ba[_0x1cd068(0x13e)]+'\x0a';const _0x45aa0c=await(0x0,graphAPI_1[_0x1cd068(0x132)])(_0x27904f[_0x1cd068(0x109)],_0x202a91,_0xd272ba[_0x1cd068(0x144)]);await(0x0,exports[_0x1cd068(0x129)])(_0x252bff,_0x202a91,_0x114a30,_0x27904f),await _0x114a30['update']({'amountUseBotQueuesNPS':_0x114a30[_0x1cd068(0x118)]+0x1});}return;}}const _0x354cdd=_0x27c744[_0x1cd068(0xff)]===_0x1cd068(0xfb);if(_0x354cdd&&_0x114a30['status']===_0x1cd068(0xf5)){if((0x0,lodash_1[_0x1cd068(0x138)])(_0x114a30[_0x1cd068(0x10f)])&&!(0x0,lodash_1[_0x1cd068(0x138)])(_0x114a30[_0x1cd068(0x11d)])){let _0x3f5a72=null;!isNaN(parseFloat(_0x1e35f8))&&(_0x3f5a72=parseFloat(_0x1e35f8));if(!Number[_0x1cd068(0xf3)](_0x3f5a72)&&Number[_0x1cd068(0x11e)](_0x3f5a72)&&!(0x0,lodash_1['isNull'])(_0x3f5a72)&&_0x3f5a72>0x0){if(_0x3f5a72===0x1)await _0x27904f['update']({'lgpdAcceptedAt':(0x0,moment_1[_0x1cd068(0x127)])()[_0x1cd068(0x150)]()}),await _0x114a30[_0x1cd068(0x123)]({'lgpdAcceptedAt':(0x0,moment_1[_0x1cd068(0x127)])()['toDate'](),'amountUsedBotQueues':0x0});else{if(_0x3f5a72===0x2){if(_0xd272ba['complationMessage']!==''&&_0xd272ba[_0x1cd068(0x11b)]!==undefined){const _0x1a647c=await(0x0,graphAPI_1['sendText'])(_0x27904f[_0x1cd068(0x109)],'‎'+_0xd272ba[_0x1cd068(0x11b)],_0xd272ba['facebookUserToken']);(0x0,exports[_0x1cd068(0x129)])(_0x1a647c,'‎'+_0xd272ba[_0x1cd068(0x11b)],_0x114a30,_0x27904f);}await _0x114a30[_0x1cd068(0x123)]({'status':_0x1cd068(0x100),'amountUsedBotQueues':0x0}),await _0x5c5f60['destroy'];return;}else _0x114a30[_0x1cd068(0x14d)]<_0xd272ba[_0x1cd068(0x13c)]&&await _0x114a30[_0x1cd068(0x123)]({'amountUsedBotQueues':_0x114a30[_0x1cd068(0x14d)]+0x1,'lgpdSendMessageAt':null});}}else _0x114a30[_0x1cd068(0x14d)]<_0xd272ba[_0x1cd068(0x13c)]&&await _0x114a30[_0x1cd068(0x123)]({'amountUsedBotQueues':_0x114a30[_0x1cd068(0x14d)]+0x1,'lgpdSendMessageAt':null});}if((_0x27904f[_0x1cd068(0x10f)]===null||_0x27c744?.[_0x1cd068(0x12f)]===_0x1cd068(0xfb))&&!_0x27904f[_0x1cd068(0x11c)]&&(0x0,lodash_1[_0x1cd068(0x138)])(_0x114a30[_0x1cd068(0x11d)])&&_0x114a30[_0x1cd068(0x14d)]<=_0xd272ba[_0x1cd068(0x13c)]&&!(0x0,lodash_1[_0x1cd068(0x138)])(_0x27c744?.[_0x1cd068(0xee)])){_0x4cb34c['attachments']?await(0x0,exports[_0x1cd068(0xeb)])(_0x4cb34c,_0x114a30,_0x27904f):await(0x0,exports[_0x1cd068(0x129)])(_0x4cb34c,_0x4cb34c['text'],_0x114a30,_0x27904f);if(!(0x0,lodash_1[_0x1cd068(0x138)])(_0x27c744?.['lgpdMessage'])&&_0x27c744[_0x1cd068(0xee)]!==''){const _0x5e895c=(0x0,Mustache_1['default'])('‎'+_0x27c744[_0x1cd068(0xee)],_0x114a30),_0x7cf630=await(0x0,graphAPI_1[_0x1cd068(0x132)])(_0x27904f['number'],_0x5e895c,_0xd272ba[_0x1cd068(0x144)]);(0x0,exports['verifyMessageFace'])(_0x7cf630,_0x5e895c,_0x114a30,_0x27904f);}if(!(0x0,lodash_1['isNil'])(_0x27c744?.[_0x1cd068(0x10b)])&&_0x27c744?.[_0x1cd068(0x10b)]!==''){const _0x3b13a1=(0x0,Mustache_1['default'])('‎'+_0x27c744['lgpdLink'],_0x114a30),_0x3d9b66=await(0x0,graphAPI_1[_0x1cd068(0x132)])(_0x27904f[_0x1cd068(0x109)],_0x3b13a1,_0xd272ba[_0x1cd068(0x144)]);(0x0,exports[_0x1cd068(0x129)])(_0x3d9b66,_0x3b13a1,_0x114a30,_0x27904f);};const _0x410491=(0x0,Mustache_1['default'])(_0x1cd068(0x147),_0x114a30),_0x3b169f=await(0x0,graphAPI_1[_0x1cd068(0x132)])(_0x27904f[_0x1cd068(0x109)],_0x410491,_0xd272ba[_0x1cd068(0x144)]);(0x0,exports['verifyMessageFace'])(_0x3b169f,_0x410491,_0x114a30,_0x27904f),await _0x114a30['update']({'lgpdSendMessageAt':(0x0,moment_1[_0x1cd068(0x127)])()[_0x1cd068(0x150)](),'amountUsedBotQueues':_0x114a30[_0x1cd068(0x14d)]+0x1}),await _0x114a30['reload']();return;};if(!(0x0,lodash_1[_0x1cd068(0x138)])(_0x114a30['lgpdSendMessageAt'])&&(0x0,lodash_1[_0x1cd068(0x138)])(_0x114a30['lgpdAcceptedAt']))return;}}}catch(_0x370f06){throw new Error(_0x370f06);console[_0x1cd068(0x12b)](_0x370f06);}_0x4cb34c[_0x1cd068(0x130)]?await(0x0,exports[_0x1cd068(0xeb)])(_0x4cb34c,_0x114a30,_0x27904f):await(0x0,exports[_0x1cd068(0x129)])(_0x4cb34c,_0x4cb34c[_0x1cd068(0x142)],_0x114a30,_0x27904f),!_0x114a30[_0x1cd068(0xf6)]&&!_0x5672aa&&!_0x114a30[_0x1cd068(0x135)]&&_0xd272ba[_0x1cd068(0x121)]['length']>=0x1&&await verifyQueue(_0xd272ba,_0x4cb34c,_0x114a30,_0x27904f),_0x114a30[_0x1cd068(0xf6)]&&_0x114a30[_0x1cd068(0x13f)]&&(!_0x114a30[_0x1cd068(0x108)]&&await(0x0,ChatbotListenerFacebook_1['sayChatbot'])(_0x114a30[_0x1cd068(0x13f)],_0xd272ba,_0x114a30,_0x27904f,_0x4cb34c));}return;}catch(_0x580e9a){throw new Error(_0x580e9a);}};exports[a469_0x5f37cb(0x153)]=handleMessage;const verifyQueue=async(_0x53a644,_0x1d0623,_0x50f9af,_0xefc5a4)=>{const _0x50d61d=a469_0x5f37cb,{queues:_0x21a842,greetingMessage:_0x2e3049}=await(0x0,ShowWhatsAppService_1[_0x50d61d(0x127)])(_0x53a644['id'],_0x50f9af[_0x50d61d(0x13b)]);if(_0x21a842['length']===0x1){const _0x3ca3f8=(0x0,lodash_1[_0x50d61d(0x101)])(_0x21a842);let _0x1d9021=![];_0x3ca3f8?.[_0x50d61d(0x114)]&&(_0x1d9021=_0x3ca3f8?.[_0x50d61d(0x114)]?.['length']>0x0);await(0x0,UpdateTicketService_1[_0x50d61d(0x127)])({'ticketData':{'queueId':_0x21a842[0x0]['id'],'isBot':_0x1d9021},'ticketId':_0x50f9af['id'],'companyId':_0x50f9af['companyId']});return;}let _0xb39fdd='';if(_0x50f9af[_0x50d61d(0x151)]!==_0x50d61d(0xf5))_0xb39fdd=_0x1d0623[_0x50d61d(0x142)];else{if(!(0x0,lodash_1['isNil'])(_0x50f9af[_0x50d61d(0x10f)]))await _0x50f9af[_0x50d61d(0x123)]({'status':_0x50d61d(0xf0)});await _0x50f9af[_0x50d61d(0x104)]();}const _0x14f6bc=_0x21a842[+_0xb39fdd-0x1];if(_0x14f6bc){await(0x0,UpdateTicketService_1[_0x50d61d(0x127)])({'ticketData':{'queueId':_0x14f6bc['id']},'ticketId':_0x50f9af['id'],'companyId':_0x50f9af[_0x50d61d(0x13b)]});if(_0x14f6bc[_0x50d61d(0x114)][_0x50d61d(0x14e)]>0x0){let _0x11921c='';_0x14f6bc['chatbots'][_0x50d61d(0x102)]((_0x2efbfd,_0x4e7e16)=>{const _0x308616=_0x50d61d;_0x11921c+='['+(_0x4e7e16+0x1)+_0x308616(0x14a)+_0x2efbfd['name']+'\x0a';});const _0x379938=(0x0,Mustache_1[_0x50d61d(0x127)])(_0x14f6bc[_0x50d61d(0x14f)]+'\x0a\x0a'+_0x11921c+_0x50d61d(0x14c),_0x50f9af),_0x3ea782=await(0x0,sendFacebookMessage_1[_0x50d61d(0x127)])({'ticket':_0x50f9af,'body':_0x379938});}if(!_0x14f6bc[_0x50d61d(0x114)]['length']){const _0x31f2f9=(0x0,Mustache_1[_0x50d61d(0x127)])(''+_0x14f6bc[_0x50d61d(0x14f)],_0x50f9af),_0x367971=await(0x0,sendFacebookMessage_1['default'])({'ticket':_0x50f9af,'body':_0x31f2f9});}}else{let _0x201c38='';_0x21a842['forEach']((_0x6dd5da,_0x2ca721)=>{const _0xdf6184=_0x50d61d;_0x201c38+='['+(_0x2ca721+0x1)+_0xdf6184(0x14a)+_0x6dd5da[_0xdf6184(0xe9)]+'\x0a';});const _0x4010d3=(0x0,Mustache_1[_0x50d61d(0x127)])(_0x2e3049+'\x0a\x0a'+_0x201c38,_0x50f9af),_0x37c495=await(0x0,sendFacebookMessage_1[_0x50d61d(0x127)])({'ticket':_0x50f9af,'body':_0x4010d3});}};
=======
'use strict';const a469_0x2d390f=a469_0x28d0;function a469_0x52ab(){const _0x49747a=['reload','moment','isGroup','chatbots','../../models/Queue','sender','verifyMessageFace','../ContactServices/CreateOrUpdateContactService','lgpdConsent','nps','amountUsedBotQueues','greetingMessage','message_id','19495NyNjAt','../../helpers/Mustache','farewellMessage','name','17559RbRVOI','verifyRating','172198YCpbXv','\x0a[#]\x20Voltar\x20para\x20o\x20menu\x20principal','sendText','./graphAPI','__importDefault','enabled','handleRating','lgpdLink','handleMessage','198928HYDsLf','../WhatsappService/ShowWhatsAppService','facebookPageUserId','lgpd','payload','isNull','84MELMKC','amountUseBotQueuesNPS','mkdirSync','reply_to','85324Cuhddx','ratingMessage','last_name','verifyMessageMedia','default','companyId','isInteger','arraybuffer','3987630xmzbsB','file-type','queue','existsSync','../../models/CompaniesSettings','complationMessage','isNaN','toDate','isNil','196llstvT','__esModule','public/company','sayChatbot','‎Opção\x20inválida,\x20tente\x20novamente.\x0a','findOne','150XTWzAK','queueId','update','first_name','profilePsid','color','getTime','lgpdMessage','number','lgpdSendMessageAt','base64','ASC','../MessageServices/CreateMessageService','get','40tqUJiJ','2148UjlVHd','../TicketServices/UpdateTicketService','lodash','../TicketServices/FindOrCreateATicketTrakingService','mid','../WbotServices/wbotMessageListener','../TicketServices/FindOrCreateTicketService','forEach','head','queues','length','../../models/Message','join','url','282213EFkWek','maxUseBotQueues','text','status','user','is_echo','attachments','lgpdAcceptedAt','11ZkVjfz','‎Estou\x20ciente\x20sobre\x20o\x20tratamento\x20dos\x20meus\x20dados\x20pessoais.\x20\x0a\x0a*[1]*\x20Sim\x0a*[2]*\x20Não','userId','facebookUserToken'];a469_0x52ab=function(){return _0x49747a;};return a469_0x52ab();}(function(_0x13d3db,_0x2a869b){const _0xb9d98b=a469_0x28d0,_0x557daa=_0x13d3db();while(!![]){try{const _0x48ceb0=-parseInt(_0xb9d98b(0xe3))/0x1+-parseInt(_0xb9d98b(0xfe))/0x2*(parseInt(_0xb9d98b(0xd8))/0x3)+parseInt(_0xb9d98b(0xed))/0x4*(-parseInt(_0xb9d98b(0x104))/0x5)+-parseInt(_0xb9d98b(0xe9))/0x6*(parseInt(_0xb9d98b(0xd4))/0x7)+parseInt(_0xb9d98b(0x112))/0x8*(-parseInt(_0xb9d98b(0xbb))/0x9)+-parseInt(_0xb9d98b(0xf5))/0xa*(parseInt(_0xb9d98b(0xc3))/0xb)+parseInt(_0xb9d98b(0x113))/0xc*(parseInt(_0xb9d98b(0xda))/0xd);if(_0x48ceb0===_0x2a869b)break;else _0x557daa['push'](_0x557daa['shift']());}catch(_0x5714e8){_0x557daa['push'](_0x557daa['shift']());}}}(a469_0x52ab,0x58e0c));var __importDefault=this&&this[a469_0x2d390f(0xde)]||function(_0x505782){const _0x5fe1e5=a469_0x2d390f;return _0x505782&&_0x505782[_0x5fe1e5(0xff)]?_0x505782:{'default':_0x505782};};Object['defineProperty'](exports,a469_0x2d390f(0xff),{'value':!![]}),exports[a469_0x2d390f(0xe2)]=exports[a469_0x2d390f(0xf0)]=exports[a469_0x2d390f(0xcd)]=void 0x0;const fs_1=require('fs'),fs_2=__importDefault(require('fs')),axios_1=__importDefault(require('axios')),moment_1=__importDefault(require(a469_0x2d390f(0xc8))),path_1=require('path'),CreateOrUpdateContactService_1=__importDefault(require(a469_0x2d390f(0xce))),CreateMessageService_1=__importDefault(require(a469_0x2d390f(0x110))),FindOrCreateTicketService_1=__importDefault(require(a469_0x2d390f(0xb3))),graphAPI_1=require(a469_0x2d390f(0xdd)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),UpdateTicketService_1=__importDefault(require(a469_0x2d390f(0x114))),ShowWhatsAppService_1=__importDefault(require(a469_0x2d390f(0xe4))),Mustache_1=__importDefault(require(a469_0x2d390f(0xd5))),Queue_1=__importDefault(require(a469_0x2d390f(0xcb))),Chatbot_1=__importDefault(require('../../models/Chatbot')),Message_1=__importDefault(require(a469_0x2d390f(0xb8))),ChatbotListenerFacebook_1=require('../WbotServices/ChatbotListenerFacebook'),lodash_1=require(a469_0x2d390f(0x115)),FindOrCreateATicketTrakingService_1=__importDefault(require(a469_0x2d390f(0xb0))),wbotMessageListener_1=require(a469_0x2d390f(0xb2)),CompaniesSettings_1=__importDefault(require(a469_0x2d390f(0xf9))),sendFacebookMessage_1=__importDefault(require('./sendFacebookMessage')),verifyContact=async(_0x431556,_0x268446,_0x5b993d)=>{const _0x4c6241=a469_0x2d390f;if(!_0x431556)return null;const _0x52a35b={'name':_0x431556?.[_0x4c6241(0xd7)]||_0x431556?.[_0x4c6241(0x107)]+'\x20'+_0x431556?.[_0x4c6241(0xef)],'number':_0x431556['id'],'profilePicUrl':'','isGroup':![],'companyId':_0x5b993d,'channel':_0x268446},_0x582978=(0x0,CreateOrUpdateContactService_1[_0x4c6241(0xf1)])(_0x52a35b);return _0x582978;},verifyMessageFace=async(_0x229a48,_0xd5f00f,_0x1bd357,_0x2e680)=>{const _0x14513f=a469_0x2d390f,_0x459b8f=await verifyQuotedMessage(_0x229a48),_0xdac2f4={'wid':_0x229a48[_0x14513f(0xb1)]||_0x229a48[_0x14513f(0xd3)],'ticketId':_0x1bd357['id'],'contactId':_0x229a48[_0x14513f(0xc0)]?undefined:_0x2e680['id'],'body':_0x229a48[_0x14513f(0xbd)]||_0xd5f00f,'fromMe':_0x229a48[_0x14513f(0xc0)]?!![]:![],'read':_0x229a48?.['is_echo'],'quotedMsgId':_0x459b8f?.['id'],'ack':0x3,'dataJson':JSON['stringify'](_0x229a48)};await(0x0,CreateMessageService_1[_0x14513f(0xf1)])({'messageData':_0xdac2f4,'companyId':_0x1bd357['companyId']}),await _0x1bd357[_0x14513f(0x106)]({'lastMessage':_0x229a48[_0x14513f(0xbd)]});};exports[a469_0x2d390f(0xcd)]=verifyMessageFace;const verifyMessageMedia=async(_0x739128,_0x2693e0,_0x4bbde2)=>{const _0x432254=a469_0x2d390f,{data:_0xdd8b88}=await axios_1[_0x432254(0xf1)][_0x432254(0x111)](_0x739128[_0x432254(0xc1)][0x0][_0x432254(0xe7)][_0x432254(0xba)],{'responseType':_0x432254(0xf4)}),{fileTypeFromBuffer:_0x33e7b1}=await eval('const _0x392987 = _0x432254;import(_0x392987(246));'),_0x14d2f3=await _0x33e7b1(_0xdd8b88),_0x415c04=new Date()[_0x432254(0x10a)]()+'.'+_0x14d2f3['ext'],_0x51271c=_0x432254(0x100)+_0x2693e0[_0x432254(0xf2)];!fs_2[_0x432254(0xf1)][_0x432254(0xf8)](_0x51271c)&&(fs_2[_0x432254(0xf1)][_0x432254(0xeb)](_0x51271c),fs_2[_0x432254(0xf1)]['chmodSync'](_0x51271c,0x1ff));(0x0,fs_1['writeFileSync'])((0x0,path_1[_0x432254(0xb9)])(__dirname,'..','..','..',_0x51271c,_0x415c04),_0xdd8b88,_0x432254(0x10e));const _0x3b06eb={'wid':_0x739128['mid'],'ticketId':_0x2693e0['id'],'contactId':_0x739128[_0x432254(0xc0)]?undefined:_0x4bbde2['id'],'body':_0x739128[_0x432254(0xbd)]||_0x415c04,'fromMe':_0x739128[_0x432254(0xc0)]?!![]:![],'mediaType':_0x739128['attachments'][0x0]['type'],'mediaUrl':_0x415c04,'read':_0x739128[_0x432254(0xc0)],'quotedMsgId':null,'ack':0x3,'dataJson':JSON['stringify'](_0x739128)};await(0x0,CreateMessageService_1[_0x432254(0xf1)])({'messageData':_0x3b06eb,'companyId':_0x2693e0[_0x432254(0xf2)]}),await _0x2693e0[_0x432254(0x106)]({'lastMessage':_0x739128[_0x432254(0xbd)]});};exports[a469_0x2d390f(0xf0)]=verifyMessageMedia;const verifyQuotedMessage=async _0x269cd5=>{const _0x578b15=a469_0x2d390f;if(!_0x269cd5)return null;const _0x3e4062=_0x269cd5?.[_0x578b15(0xec)]?.[_0x578b15(0xb1)];if(!_0x3e4062)return null;const _0x15cd58=await Message_1[_0x578b15(0xf1)][_0x578b15(0x103)]({'where':{'id':_0x3e4062}});if(!_0x15cd58)return null;return _0x15cd58;},handleMessage=async(_0x5a73b6,_0x224357,_0x14f8f0,_0x254f52)=>{const _0x5c5287=a469_0x2d390f;try{if(_0x224357['message']){let _0x2172b9,_0x1b20dd=null;const _0x1943cf=_0x224357[_0x5c5287(0xcc)]['id'],_0x15e620=_0x224357['recipient']['id'],{message:_0x358393}=_0x224357,_0x1a9138=_0x358393['is_echo'];let _0x4e581f=_0x358393['text'];if(_0x1a9138){if(/\u200e/['test'](_0x358393['text']))return;_0x2172b9=await(0x0,graphAPI_1[_0x5c5287(0x108)])(_0x15e620,_0x5a73b6[_0x5c5287(0xc6)]);}else _0x2172b9=await(0x0,graphAPI_1[_0x5c5287(0x108)])(_0x1943cf,_0x5a73b6[_0x5c5287(0xc6)]);const _0xce2bcf=await verifyContact(_0x2172b9,_0x14f8f0,_0x254f52),_0x5cc43b=_0x1a9138?0x0:0x1,_0x1ae28d=await Whatsapp_1[_0x5c5287(0xf1)]['findOne']({'where':{'facebookPageUserId':_0x5a73b6[_0x5c5287(0xe5)]},'include':[{'model':Queue_1['default'],'as':'queues','attributes':['id',_0x5c5287(0xd7),_0x5c5287(0x109),_0x5c5287(0xd2)],'include':[{'model':Chatbot_1[_0x5c5287(0xf1)],'as':_0x5c5287(0xca),'attributes':['id',_0x5c5287(0xd7),_0x5c5287(0xd2)]}]}],'order':[[_0x5c5287(0xb6),'id',_0x5c5287(0x10f)],['queues',_0x5c5287(0xca),'id',_0x5c5287(0x10f)]]}),_0x1058d9=await CompaniesSettings_1['default'][_0x5c5287(0x103)]({'where':{'companyId':_0x254f52}}),{ticket:_0x3cc422}=await(0x0,FindOrCreateTicketService_1[_0x5c5287(0xf1)])(_0xce2bcf,_0x1ae28d,_0x5cc43b,_0x254f52,0x0,0x0,null,_0x14f8f0,null,![],_0x1058d9);_0x1b20dd=_0x3cc422;const _0x27ebe0=await(0x0,FindOrCreateATicketTrakingService_1[_0x5c5287(0xf1)])({'ticketId':_0x1b20dd['id'],'companyId':_0x254f52,'whatsappId':_0x1ae28d?.['id']});if(_0x1ae28d['farewellMessage']&&(0x0,Mustache_1['default'])(_0x1ae28d[_0x5c5287(0xd6)],_0x1b20dd)===_0x358393[_0x5c5287(0xbd)])return;await _0x1b20dd[_0x5c5287(0x106)]({'lastMessage':_0x358393['text']});try{if(!_0x1a9138){if(_0x1b20dd[_0x5c5287(0xbe)]===_0x5c5287(0xd0)&&_0x27ebe0!==null&&(0x0,wbotMessageListener_1[_0x5c5287(0xd9)])(_0x27ebe0)){if(!isNaN(parseFloat(_0x4e581f))){(0x0,wbotMessageListener_1[_0x5c5287(0xe0)])(parseFloat(_0x4e581f),_0x1b20dd,_0x27ebe0),await _0x27ebe0['update']({'ratingAt':(0x0,moment_1['default'])()[_0x5c5287(0xfc)](),'finishedAt':(0x0,moment_1[_0x5c5287(0xf1)])()[_0x5c5287(0xfc)](),'rated':!![]});return;}else{if(_0x1b20dd[_0x5c5287(0xea)]<_0x1ae28d['maxUseBotQueuesNPS']){let _0x432f2b=_0x5c5287(0x102);const _0x520b17=await(0x0,graphAPI_1[_0x5c5287(0xdc)])(_0xce2bcf[_0x5c5287(0x10c)],_0x432f2b,_0x1ae28d[_0x5c5287(0xc6)]);await(0x0,exports[_0x5c5287(0xcd)])(_0x520b17,_0x432f2b,_0x1b20dd,_0xce2bcf);let _0x4b0dcb='‎'+_0x1ae28d[_0x5c5287(0xee)]+'\x0a';const _0x2b6146=await(0x0,graphAPI_1[_0x5c5287(0xdc)])(_0xce2bcf['number'],_0x4b0dcb,_0x1ae28d[_0x5c5287(0xc6)]);await(0x0,exports[_0x5c5287(0xcd)])(_0x520b17,_0x4b0dcb,_0x1b20dd,_0xce2bcf),await _0x1b20dd[_0x5c5287(0x106)]({'amountUseBotQueuesNPS':_0x1b20dd[_0x5c5287(0xea)]+0x1});}return;}}const _0x26d15b=_0x1058d9['enableLGPD']===_0x5c5287(0xdf);if(_0x26d15b&&_0x1b20dd[_0x5c5287(0xbe)]===_0x5c5287(0xe6)){if((0x0,lodash_1[_0x5c5287(0xfd)])(_0x1b20dd['lgpdAcceptedAt'])&&!(0x0,lodash_1[_0x5c5287(0xfd)])(_0x1b20dd['lgpdSendMessageAt'])){let _0x3a50ac=null;!isNaN(parseFloat(_0x4e581f))&&(_0x3a50ac=parseFloat(_0x4e581f));if(!Number[_0x5c5287(0xfb)](_0x3a50ac)&&Number[_0x5c5287(0xf3)](_0x3a50ac)&&!(0x0,lodash_1[_0x5c5287(0xe8)])(_0x3a50ac)&&_0x3a50ac>0x0){if(_0x3a50ac===0x1)await _0xce2bcf['update']({'lgpdAcceptedAt':(0x0,moment_1['default'])()[_0x5c5287(0xfc)]()}),await _0x1b20dd[_0x5c5287(0x106)]({'lgpdAcceptedAt':(0x0,moment_1[_0x5c5287(0xf1)])()[_0x5c5287(0xfc)](),'amountUsedBotQueues':0x0});else{if(_0x3a50ac===0x2){if(_0x1ae28d[_0x5c5287(0xfa)]!==''&&_0x1ae28d[_0x5c5287(0xfa)]!==undefined){const _0x1edcde=await(0x0,graphAPI_1[_0x5c5287(0xdc)])(_0xce2bcf['number'],'‎'+_0x1ae28d[_0x5c5287(0xfa)],_0x1ae28d[_0x5c5287(0xc6)]);(0x0,exports['verifyMessageFace'])(_0x1edcde,'‎'+_0x1ae28d['complationMessage'],_0x1b20dd,_0xce2bcf);}await _0x1b20dd[_0x5c5287(0x106)]({'status':'closed','amountUsedBotQueues':0x0}),await _0x27ebe0['destroy'];return;}else _0x1b20dd[_0x5c5287(0xd1)]<_0x1ae28d[_0x5c5287(0xbc)]&&await _0x1b20dd[_0x5c5287(0x106)]({'amountUsedBotQueues':_0x1b20dd['amountUsedBotQueues']+0x1,'lgpdSendMessageAt':null});}}else _0x1b20dd[_0x5c5287(0xd1)]<_0x1ae28d[_0x5c5287(0xbc)]&&await _0x1b20dd[_0x5c5287(0x106)]({'amountUsedBotQueues':_0x1b20dd[_0x5c5287(0xd1)]+0x1,'lgpdSendMessageAt':null});}if((_0xce2bcf['lgpdAcceptedAt']===null||_0x1058d9?.[_0x5c5287(0xcf)]===_0x5c5287(0xdf))&&!_0xce2bcf[_0x5c5287(0xc9)]&&(0x0,lodash_1[_0x5c5287(0xfd)])(_0x1b20dd[_0x5c5287(0x10d)])&&_0x1b20dd[_0x5c5287(0xd1)]<=_0x1ae28d[_0x5c5287(0xbc)]&&!(0x0,lodash_1[_0x5c5287(0xfd)])(_0x1058d9?.[_0x5c5287(0x10b)])){_0x358393[_0x5c5287(0xc1)]?await(0x0,exports[_0x5c5287(0xf0)])(_0x358393,_0x1b20dd,_0xce2bcf):await(0x0,exports[_0x5c5287(0xcd)])(_0x358393,_0x358393['text'],_0x1b20dd,_0xce2bcf);if(!(0x0,lodash_1[_0x5c5287(0xfd)])(_0x1058d9?.[_0x5c5287(0x10b)])&&_0x1058d9['lgpdMessage']!==''){const _0x26cd35=(0x0,Mustache_1[_0x5c5287(0xf1)])('‎'+_0x1058d9[_0x5c5287(0x10b)],_0x1b20dd),_0x2e0e8e=await(0x0,graphAPI_1[_0x5c5287(0xdc)])(_0xce2bcf[_0x5c5287(0x10c)],_0x26cd35,_0x1ae28d[_0x5c5287(0xc6)]);(0x0,exports[_0x5c5287(0xcd)])(_0x2e0e8e,_0x26cd35,_0x1b20dd,_0xce2bcf);}if(!(0x0,lodash_1['isNil'])(_0x1058d9?.[_0x5c5287(0xe1)])&&_0x1058d9?.[_0x5c5287(0xe1)]!==''){const _0x14cfa1=(0x0,Mustache_1[_0x5c5287(0xf1)])('‎'+_0x1058d9['lgpdLink'],_0x1b20dd),_0x347914=await(0x0,graphAPI_1[_0x5c5287(0xdc)])(_0xce2bcf['number'],_0x14cfa1,_0x1ae28d[_0x5c5287(0xc6)]);(0x0,exports[_0x5c5287(0xcd)])(_0x347914,_0x14cfa1,_0x1b20dd,_0xce2bcf);};const _0x34a693=(0x0,Mustache_1[_0x5c5287(0xf1)])(_0x5c5287(0xc4),_0x1b20dd),_0x23ce2a=await(0x0,graphAPI_1[_0x5c5287(0xdc)])(_0xce2bcf[_0x5c5287(0x10c)],_0x34a693,_0x1ae28d[_0x5c5287(0xc6)]);(0x0,exports[_0x5c5287(0xcd)])(_0x23ce2a,_0x34a693,_0x1b20dd,_0xce2bcf),await _0x1b20dd[_0x5c5287(0x106)]({'lgpdSendMessageAt':(0x0,moment_1[_0x5c5287(0xf1)])()[_0x5c5287(0xfc)](),'amountUsedBotQueues':_0x1b20dd[_0x5c5287(0xd1)]+0x1}),await _0x1b20dd[_0x5c5287(0xc7)]();return;};if(!(0x0,lodash_1[_0x5c5287(0xfd)])(_0x1b20dd[_0x5c5287(0x10d)])&&(0x0,lodash_1[_0x5c5287(0xfd)])(_0x1b20dd[_0x5c5287(0xc2)]))return;}}}catch(_0x3fe126){throw new Error(_0x3fe126);console['log'](_0x3fe126);}_0x358393[_0x5c5287(0xc1)]?await(0x0,exports[_0x5c5287(0xf0)])(_0x358393,_0x1b20dd,_0xce2bcf):await(0x0,exports['verifyMessageFace'])(_0x358393,_0x358393[_0x5c5287(0xbd)],_0x1b20dd,_0xce2bcf),!_0x1b20dd[_0x5c5287(0xf7)]&&!_0x1a9138&&!_0x1b20dd[_0x5c5287(0xc5)]&&_0x1ae28d['queues'][_0x5c5287(0xb7)]>=0x1&&await verifyQueue(_0x1ae28d,_0x358393,_0x1b20dd,_0xce2bcf),_0x1b20dd['queue']&&_0x1b20dd[_0x5c5287(0x105)]&&(!_0x1b20dd[_0x5c5287(0xbf)]&&await(0x0,ChatbotListenerFacebook_1[_0x5c5287(0x101)])(_0x1b20dd[_0x5c5287(0x105)],_0x1ae28d,_0x1b20dd,_0xce2bcf,_0x358393));}return;}catch(_0x4bbc0b){throw new Error(_0x4bbc0b);}};exports[a469_0x2d390f(0xe2)]=handleMessage;function a469_0x28d0(_0x41db0f,_0x5b6fc7){const _0x52abb5=a469_0x52ab();return a469_0x28d0=function(_0x28d010,_0x14f037){_0x28d010=_0x28d010-0xb0;let _0x28b78c=_0x52abb5[_0x28d010];return _0x28b78c;},a469_0x28d0(_0x41db0f,_0x5b6fc7);}const verifyQueue=async(_0x4eae8d,_0x3e25d0,_0x57094e,_0x161070)=>{const _0x37b70b=a469_0x2d390f,{queues:_0x2cdadf,greetingMessage:_0x177e1f}=await(0x0,ShowWhatsAppService_1['default'])(_0x4eae8d['id'],_0x57094e[_0x37b70b(0xf2)]);if(_0x2cdadf[_0x37b70b(0xb7)]===0x1){const _0x1f69b5=(0x0,lodash_1[_0x37b70b(0xb5)])(_0x2cdadf);let _0x4c40f2=![];_0x1f69b5?.[_0x37b70b(0xca)]&&(_0x4c40f2=_0x1f69b5?.[_0x37b70b(0xca)]?.[_0x37b70b(0xb7)]>0x0);await(0x0,UpdateTicketService_1[_0x37b70b(0xf1)])({'ticketData':{'queueId':_0x2cdadf[0x0]['id'],'isBot':_0x4c40f2},'ticketId':_0x57094e['id'],'companyId':_0x57094e[_0x37b70b(0xf2)]});return;}let _0x8326aa='';if(_0x57094e[_0x37b70b(0xbe)]!=='lgpd')_0x8326aa=_0x3e25d0[_0x37b70b(0xbd)];else{if(!(0x0,lodash_1[_0x37b70b(0xfd)])(_0x57094e[_0x37b70b(0xc2)]))await _0x57094e[_0x37b70b(0x106)]({'status':'pending'});await _0x57094e['reload']();}const _0x3c201f=_0x2cdadf[+_0x8326aa-0x1];if(_0x3c201f){await(0x0,UpdateTicketService_1[_0x37b70b(0xf1)])({'ticketData':{'queueId':_0x3c201f['id']},'ticketId':_0x57094e['id'],'companyId':_0x57094e[_0x37b70b(0xf2)]});if(_0x3c201f[_0x37b70b(0xca)][_0x37b70b(0xb7)]>0x0){let _0x26bcd1='';_0x3c201f[_0x37b70b(0xca)][_0x37b70b(0xb4)]((_0x5eafec,_0x230673)=>{_0x26bcd1+='['+(_0x230673+0x1)+']\x20-\x20'+_0x5eafec['name']+'\x0a';});const _0xc989d3=(0x0,Mustache_1['default'])(_0x3c201f['greetingMessage']+'\x0a\x0a'+_0x26bcd1+_0x37b70b(0xdb),_0x57094e),_0x1400d2=await(0x0,sendFacebookMessage_1['default'])({'ticket':_0x57094e,'body':_0xc989d3});}if(!_0x3c201f[_0x37b70b(0xca)][_0x37b70b(0xb7)]){const _0x172b2e=(0x0,Mustache_1[_0x37b70b(0xf1)])(''+_0x3c201f[_0x37b70b(0xd2)],_0x57094e),_0x4c924e=await(0x0,sendFacebookMessage_1[_0x37b70b(0xf1)])({'ticket':_0x57094e,'body':_0x172b2e});}}else{let _0x34b95d='';_0x2cdadf[_0x37b70b(0xb4)]((_0x53ef3b,_0x1a95d7)=>{_0x34b95d+='['+(_0x1a95d7+0x1)+']\x20-\x20'+_0x53ef3b['name']+'\x0a';});const _0x4e4626=(0x0,Mustache_1['default'])(_0x177e1f+'\x0a\x0a'+_0x34b95d,_0x57094e),_0x46c9f4=await(0x0,sendFacebookMessage_1[_0x37b70b(0xf1)])({'ticket':_0x57094e,'body':_0x4e4626});}};
>>>>>>> ab722bfbcf394d74dd0b99a984c0dcf6ffbcff7f
