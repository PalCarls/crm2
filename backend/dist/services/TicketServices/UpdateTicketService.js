'use strict';function a549_0x1014(_0x4c0653,_0x40c41b){const _0x3b3bee=a549_0x3b3b();return a549_0x1014=function(_0x10147d,_0x158911){_0x10147d=_0x10147d-0x170;let _0x3d46b4=_0x3b3bee[_0x10147d];return _0x3d46b4;},a549_0x1014(_0x4c0653,_0x40c41b);}const a549_0x4c377f=a549_0x1014;(function(_0x1df146,_0x143c5b){const _0x2a9a02=a549_0x1014,_0x26c883=_0x1df146();while(!![]){try{const _0x2b0f26=-parseInt(_0x2a9a02(0x197))/0x1*(parseInt(_0x2a9a02(0x1ce))/0x2)+-parseInt(_0x2a9a02(0x17b))/0x3+parseInt(_0x2a9a02(0x193))/0x4*(parseInt(_0x2a9a02(0x199))/0x5)+parseInt(_0x2a9a02(0x1ae))/0x6*(parseInt(_0x2a9a02(0x1a2))/0x7)+-parseInt(_0x2a9a02(0x1d6))/0x8+-parseInt(_0x2a9a02(0x1c3))/0x9+parseInt(_0x2a9a02(0x1d4))/0xa*(parseInt(_0x2a9a02(0x1c9))/0xb);if(_0x2b0f26===_0x143c5b)break;else _0x26c883['push'](_0x26c883['shift']());}catch(_0x12911e){_0x26c883['push'](_0x26c883['shift']());}}}(a549_0x3b3b,0x75792));var __createBinding=this&&this[a549_0x4c377f(0x192)]||(Object['create']?function(_0x472ff7,_0x2e0afb,_0xb7e98c,_0x4c15b5){const _0x2db7e4=a549_0x4c377f;if(_0x4c15b5===undefined)_0x4c15b5=_0xb7e98c;var _0xc171a3=Object[_0x2db7e4(0x17d)](_0x2e0afb,_0xb7e98c);(!_0xc171a3||(_0x2db7e4(0x182)in _0xc171a3?!_0x2e0afb[_0x2db7e4(0x1ba)]:_0xc171a3[_0x2db7e4(0x1b7)]||_0xc171a3[_0x2db7e4(0x173)]))&&(_0xc171a3={'enumerable':!![],'get':function(){return _0x2e0afb[_0xb7e98c];}}),Object[_0x2db7e4(0x174)](_0x472ff7,_0x4c15b5,_0xc171a3);}:function(_0x2c525a,_0x1d97f9,_0x2f21fc,_0x192423){if(_0x192423===undefined)_0x192423=_0x2f21fc;_0x2c525a[_0x192423]=_0x1d97f9[_0x2f21fc];}),__setModuleDefault=this&&this[a549_0x4c377f(0x1cd)]||(Object[a549_0x4c377f(0x194)]?function(_0x3c6c15,_0x2e0ba5){const _0x2acd5d=a549_0x4c377f;Object[_0x2acd5d(0x174)](_0x3c6c15,_0x2acd5d(0x196),{'enumerable':!![],'value':_0x2e0ba5});}:function(_0x5e49ac,_0x332f68){const _0x411e75=a549_0x4c377f;_0x5e49ac[_0x411e75(0x196)]=_0x332f68;}),__importStar=this&&this[a549_0x4c377f(0x1a6)]||function(_0x413877){const _0x439487=a549_0x4c377f;if(_0x413877&&_0x413877[_0x439487(0x1ba)])return _0x413877;var _0x3bedac={};if(_0x413877!=null){for(var _0x423f17 in _0x413877)if(_0x423f17!==_0x439487(0x196)&&Object[_0x439487(0x1b0)][_0x439487(0x18f)][_0x439487(0x1c2)](_0x413877,_0x423f17))__createBinding(_0x3bedac,_0x413877,_0x423f17);}return __setModuleDefault(_0x3bedac,_0x413877),_0x3bedac;},__importDefault=this&&this['__importDefault']||function(_0x5e2927){return _0x5e2927&&_0x5e2927['__esModule']?_0x5e2927:{'default':_0x5e2927};};function a549_0x3b3b(){const _0x1b5482=['channel','./FindOrCreateATicketTrakingService','g.us','toString','name','../WbotServices/wbotMessageListener','nps','102wgnArC','emit','prototype','findAll','s.whatsapp.net','farewellMessage','number','sendMsgTransfTicket','tagId','writable','../../models/Queue','isGroup','__esModule','findByPk','closed','queueOptionId','destroy','../../helpers/GetTicketWbot','isNil','../UserServices/ShowUserService','call','5772789KMmkrO','userId','contact','../../helpers/SetTicketMessagesAsRead','findOne','enabled','909744rXYZQR','./ShowTicketService','delete','../../models/User','__setModuleDefault','2UPEpFh','queueId','save','../WbotServices/SendWhatsAppMessage','color','queuedAt','120HqTCqR','status','5257792nGBDql','\x20contact','companyId','getIO','@sentry/node','reload','lastMessage','../../models/Tag','configurable','defineProperty','verifyMessage','sendFarewellWaitingTicket','company-','lodash','log','../WhatsappService/ShowWhatsAppService','63240ybsZCt','-ticket','getOwnPropertyDescriptor','Checking\x20if\x20','ratingAt','userRating','map','get','captureException','toDate','group','*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!','\x22*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!','open','update','finishedAt','sequelize','../../models/TicketTag','facebook','\x20is\x20a\x20valid\x20','hasOwnProperty','*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20departamento\x20*','includes','__createBinding','596ciMSuH','create','sendMessage','default','303763hiHTKM','whatsappId','30045SIANOs','user','../../libs/socket','whatsapp','moment','receivedTransfer','notification','verifyMessageFace','‎*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20departamento\x20*','89299DTOBam','transfered','instagram','pending','__importStar'];a549_0x3b3b=function(){return _0x1b5482;};return a549_0x3b3b();}Object['defineProperty'](exports,a549_0x4c377f(0x1ba),{'value':!![]});const moment_1=__importDefault(require(a549_0x4c377f(0x19d))),Sentry=__importStar(require(a549_0x4c377f(0x1da))),sequelize_1=require(a549_0x4c377f(0x18b)),SetTicketMessagesAsRead_1=__importDefault(require(a549_0x4c377f(0x1c6))),socket_1=require(a549_0x4c377f(0x19b)),Ticket_1=__importDefault(require('../../models/Ticket')),Queue_1=__importDefault(require(a549_0x4c377f(0x1b8))),ShowTicketService_1=__importDefault(require(a549_0x4c377f(0x1ca))),ShowWhatsAppService_1=__importDefault(require(a549_0x4c377f(0x17a))),SendWhatsAppMessage_1=__importDefault(require(a549_0x4c377f(0x1d1))),FindOrCreateATicketTrakingService_1=__importDefault(require(a549_0x4c377f(0x1a8))),GetTicketWbot_1=__importDefault(require(a549_0x4c377f(0x1bf))),wbotMessageListener_1=require(a549_0x4c377f(0x1ac)),lodash_1=require(a549_0x4c377f(0x178)),sendFacebookMessage_1=__importDefault(require('../FacebookServices/sendFacebookMessage')),facebookMessageListener_1=require('../FacebookServices/facebookMessageListener'),ShowUserService_1=__importDefault(require(a549_0x4c377f(0x1c1))),User_1=__importDefault(require(a549_0x4c377f(0x1cc))),CompaniesSettings_1=__importDefault(require('../../models/CompaniesSettings')),CreateLogTicketService_1=__importDefault(require('./CreateLogTicketService')),TicketTag_1=__importDefault(require(a549_0x4c377f(0x18c))),Tag_1=__importDefault(require(a549_0x4c377f(0x172))),UpdateTicketService=async({ticketData:_0x44e5d8,ticketId:_0x1962ca,companyId:_0x28426e})=>{const _0x35bb53=a549_0x4c377f;try{const {status:_0x4f53b9}=_0x44e5d8;let {queueId:_0x27e0f3,userId:_0x284085,sendFarewellMessage:_0x5ea2b0,amountUsedBotQueues:_0xde819b,lastMessage:_0xcb7533,integrationId:_0xde4f00,useIntegration:_0x4cfaae}=_0x44e5d8,_0x1975f7=_0x44e5d8['isBot']||![],_0x4b792c=_0x44e5d8[_0x35bb53(0x1bd)]||null;const _0x567406=(0x0,socket_1[_0x35bb53(0x1d9)])(),_0x47d896=await CompaniesSettings_1[_0x35bb53(0x196)][_0x35bb53(0x1c7)]({'where':{'companyId':_0x28426e}}),_0x4a65b6=await(0x0,ShowTicketService_1[_0x35bb53(0x196)])(_0x1962ca,_0x28426e);_0x4a65b6[_0x35bb53(0x1a7)]===_0x35bb53(0x19c)&&await(0x0,SetTicketMessagesAsRead_1[_0x35bb53(0x196)])(_0x4a65b6);const _0x1b231c=_0x4a65b6?.[_0x35bb53(0x1d5)],_0x289585=_0x4a65b6[_0x35bb53(0x19a)]?.['id'],_0x5dd78d=_0x4a65b6?.[_0x35bb53(0x1cf)];if(_0x1b231c===_0x35bb53(0x1bc)){const _0x11fcfa=await Ticket_1[_0x35bb53(0x196)][_0x35bb53(0x1c7)]({'where':{'contactId':_0x4a65b6['contactId'],'status':{[sequelize_1['Op']['or']]:[_0x35bb53(0x188),_0x35bb53(0x1a5),_0x35bb53(0x185)]},'whatsappId':_0x4a65b6['whatsappId']},'include':[{'model':Queue_1['default'],'as':'queue','attributes':['id',_0x35bb53(0x1ab),_0x35bb53(0x1d2)]},{'model':User_1[_0x35bb53(0x196)],'as':_0x35bb53(0x19a),'attributes':['id',_0x35bb53(0x1ab)]}]});if(_0x11fcfa){if(_0x11fcfa['id']!==_0x4a65b6['id'])return{'ticket':_0x11fcfa,'oldStatus':_0x1b231c,'oldUserId':_0x289585};}_0x1975f7=![];}const _0x570612=await(0x0,FindOrCreateATicketTrakingService_1[_0x35bb53(0x196)])({'ticketId':_0x1962ca,'companyId':_0x28426e,'whatsappId':_0x4a65b6[_0x35bb53(0x198)]}),{complationMessage:_0xf1bd6e,ratingMessage:_0x52c53f,groupAsTicket:_0x526216}=await(0x0,ShowWhatsAppService_1[_0x35bb53(0x196)])(_0x4a65b6[_0x35bb53(0x198)],_0x28426e);if(_0x4f53b9!==undefined&&[_0x35bb53(0x1bc)]['indexOf'](_0x4f53b9)>-0x1){if(_0x47d896[_0x35bb53(0x180)]===_0x35bb53(0x1c8)&&(_0x5ea2b0||_0x5ea2b0===undefined)&&(!(0x0,lodash_1[_0x35bb53(0x1c0)])(_0x52c53f)&&_0x52c53f!=='')&&!_0x4a65b6[_0x35bb53(0x1b9)]){if(_0x570612[_0x35bb53(0x17f)]==null){const _0x1c0e21=_0x52c53f||'';let _0xe23e15='‎'+_0x1c0e21+'\x0a';if(_0x4a65b6[_0x35bb53(0x1a7)]==='whatsapp'){const _0x2eb7d9=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0xe23e15,'ticket':_0x4a65b6,'isForwarded':![],'isPrivate':![]});await(0x0,wbotMessageListener_1[_0x35bb53(0x175)])(_0x2eb7d9,_0x4a65b6,_0x4a65b6[_0x35bb53(0x1c5)]);}if([_0x35bb53(0x18d),'instagram'][_0x35bb53(0x191)](_0x4a65b6['channel'])){console[_0x35bb53(0x179)](_0x35bb53(0x17e)+_0x4a65b6['contact'][_0x35bb53(0x1b4)]+_0x35bb53(0x18e)+_0x4a65b6[_0x35bb53(0x1a7)]+'\x20contact');const _0x528ea2=await(0x0,sendFacebookMessage_1['default'])({'body':_0xe23e15,'ticket':_0x4a65b6});await(0x0,facebookMessageListener_1[_0x35bb53(0x1a0)])(_0x528ea2,_0xe23e15,_0x4a65b6,_0x4a65b6[_0x35bb53(0x1c5)]);}await _0x570612[_0x35bb53(0x189)]({'userId':_0x4a65b6[_0x35bb53(0x1c4)],'closedAt':(0x0,moment_1['default'])()[_0x35bb53(0x184)]()}),await(0x0,CreateLogTicketService_1[_0x35bb53(0x196)])({'userId':_0x4a65b6['userId'],'queueId':_0x4a65b6[_0x35bb53(0x1cf)],'ticketId':_0x1962ca,'type':_0x35bb53(0x1ad)});try{const _0x3d95cf=await TicketTag_1[_0x35bb53(0x196)][_0x35bb53(0x1b1)]({'where':{'ticketId':_0x1962ca}}),_0x4391de=_0x3d95cf['map'](_0x149cd3=>_0x149cd3[_0x35bb53(0x1b6)]),_0x15e1e7=await Tag_1['default']['findAll']({'where':{'id':_0x4391de,'kanban':0x1}}),_0x4d9c01=_0x15e1e7[_0x35bb53(0x181)](_0x37712c=>_0x37712c['id']);if(_0x4d9c01)await TicketTag_1['default'][_0x35bb53(0x1be)]({'where':{'ticketId':_0x1962ca,'tagId':_0x4d9c01}});}catch(_0x47ea77){Sentry[_0x35bb53(0x183)](_0x47ea77);}return await _0x4a65b6[_0x35bb53(0x189)]({'status':_0x35bb53(0x1ad),'amountUseBotQueuesNPS':0x1}),_0x567406['to']('open')['to'](_0x1962ca[_0x35bb53(0x1aa)]())['emit'](_0x35bb53(0x177)+_0x4a65b6[_0x35bb53(0x1d8)]+_0x35bb53(0x17c),{'action':_0x35bb53(0x1cb),'ticketId':_0x4a65b6['id']}),{'ticket':_0x4a65b6,'oldStatus':_0x1b231c,'oldUserId':_0x289585};}}if(!(0x0,lodash_1[_0x35bb53(0x1c0)])(_0xf1bd6e)&&_0xf1bd6e!==''&&(_0x5ea2b0||_0x5ea2b0===undefined)){const _0x38f613=_0x4a65b6[_0x35bb53(0x1c4)]||_0x284085,_0x4e8368=await User_1['default'][_0x35bb53(0x1bb)](_0x38f613);let _0x204d08;if(_0x4a65b6[_0x35bb53(0x1d5)]!==_0x35bb53(0x1a5)||_0x4a65b6['status']==='pending'&&_0x47d896[_0x35bb53(0x176)]==='enabled'){_0x4e8368['farewellMessage']?_0x204d08='‎'+_0x4e8368[_0x35bb53(0x1b3)]:_0x204d08='‎'+_0xf1bd6e;if(_0x4a65b6[_0x35bb53(0x1a7)]===_0x35bb53(0x19c)&&(!_0x4a65b6[_0x35bb53(0x1b9)]||_0x526216===_0x35bb53(0x1c8))){const _0x2246f6=await(0x0,SendWhatsAppMessage_1[_0x35bb53(0x196)])({'body':_0x204d08,'ticket':_0x4a65b6,'isForwarded':![],'isPrivate':![]});await(0x0,wbotMessageListener_1[_0x35bb53(0x175)])(_0x2246f6,_0x4a65b6,_0x4a65b6['contact']);}if([_0x35bb53(0x18d),_0x35bb53(0x1a4)][_0x35bb53(0x191)](_0x4a65b6['channel'])&&(!_0x4a65b6[_0x35bb53(0x1b9)]||_0x526216===_0x35bb53(0x1c8))){console['log'](_0x35bb53(0x17e)+_0x4a65b6['contact'][_0x35bb53(0x1b4)]+_0x35bb53(0x18e)+_0x4a65b6['channel']+_0x35bb53(0x1d7));const _0x13f711=await(0x0,sendFacebookMessage_1[_0x35bb53(0x196)])({'body':_0x204d08,'ticket':_0x4a65b6});console['log'](_0x13f711);}}}_0x570612[_0x35bb53(0x18a)]=(0x0,moment_1[_0x35bb53(0x196)])()[_0x35bb53(0x184)](),_0x570612['closedAt']=(0x0,moment_1[_0x35bb53(0x196)])()['toDate'](),_0x570612[_0x35bb53(0x198)]=_0x4a65b6[_0x35bb53(0x198)],_0x570612['userId']=_0x4a65b6['userId'],await(0x0,CreateLogTicketService_1[_0x35bb53(0x196)])({'userId':_0x284085,'queueId':_0x4a65b6[_0x35bb53(0x1cf)],'ticketId':_0x1962ca,'type':_0x35bb53(0x1bc)});try{const _0x73dbb5=await TicketTag_1[_0x35bb53(0x196)]['findAll']({'where':{'ticketId':_0x1962ca}}),_0x546872=_0x73dbb5[_0x35bb53(0x181)](_0x495f4b=>_0x495f4b[_0x35bb53(0x1b6)]),_0x3ca1f1=await Tag_1[_0x35bb53(0x196)]['findAll']({'where':{'id':_0x546872,'kanban':0x1}}),_0x531aac=_0x3ca1f1[_0x35bb53(0x181)](_0x23de31=>_0x23de31['id']);if(_0x531aac)await TicketTag_1[_0x35bb53(0x196)]['destroy']({'where':{'ticketId':_0x1962ca,'tagId':_0x531aac}});}catch(_0x589c3c){Sentry[_0x35bb53(0x183)](_0x589c3c);}return await _0x4a65b6[_0x35bb53(0x189)]({'status':_0x35bb53(0x1bc)}),_0x567406['to'](_0x1b231c)['to'](_0x1962ca[_0x35bb53(0x1aa)]())['emit'](_0x35bb53(0x177)+_0x4a65b6[_0x35bb53(0x1d8)]+_0x35bb53(0x17c),{'action':'delete','ticketId':_0x4a65b6['id']}),{'ticket':_0x4a65b6,'oldStatus':_0x1b231c,'oldUserId':_0x289585};}!(0x0,lodash_1[_0x35bb53(0x1c0)])(_0x27e0f3)&&(_0x570612[_0x35bb53(0x1d3)]=(0x0,moment_1['default'])()[_0x35bb53(0x184)]());if(_0x47d896[_0x35bb53(0x1b5)]===_0x35bb53(0x1c8)){if(_0x5dd78d!==_0x27e0f3&&_0x289585===_0x284085&&!(0x0,lodash_1['isNil'])(_0x5dd78d)&&!(0x0,lodash_1['isNil'])(_0x27e0f3)){const _0x20e86c=await Queue_1[_0x35bb53(0x196)]['findByPk'](_0x27e0f3),_0x468439=await(0x0,GetTicketWbot_1[_0x35bb53(0x196)])(_0x4a65b6),_0xaa612b=_0x35bb53(0x1a1)+_0x20e86c?.['name']+_0x35bb53(0x187),_0x3ccfa7=await _0x468439[_0x35bb53(0x195)](_0x4a65b6[_0x35bb53(0x1c5)]['number']+'@'+(_0x4a65b6['isGroup']?_0x35bb53(0x1a9):_0x35bb53(0x1b2)),{'text':_0xaa612b});await(0x0,wbotMessageListener_1[_0x35bb53(0x175)])(_0x3ccfa7,_0x4a65b6,_0x4a65b6[_0x35bb53(0x1c5)],_0x570612);}else{if(_0x289585!==_0x284085&&_0x5dd78d===_0x27e0f3&&!(0x0,lodash_1['isNil'])(_0x289585)&&!(0x0,lodash_1['isNil'])(_0x284085)&&(!_0x4a65b6[_0x35bb53(0x1b9)]||_0x526216===_0x35bb53(0x1c8))){const _0x32f8ac=await(0x0,GetTicketWbot_1['default'])(_0x4a65b6),_0x5489ef=await(0x0,ShowUserService_1['default'])(_0x44e5d8['userId']),_0x3e3c44='‎*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20atendente\x20*'+_0x5489ef['name']+'*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!',_0x52e642=await _0x32f8ac[_0x35bb53(0x195)](_0x4a65b6[_0x35bb53(0x1c5)]['number']+'@'+(_0x4a65b6['isGroup']?_0x35bb53(0x1a9):_0x35bb53(0x1b2)),{'text':_0x3e3c44});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x52e642,_0x4a65b6,_0x4a65b6['contact'],_0x570612);}else{if(_0x289585!==_0x284085&&_0x5dd78d===_0x27e0f3&&!(0x0,lodash_1[_0x35bb53(0x1c0)])(_0x289585)&&!(0x0,lodash_1[_0x35bb53(0x1c0)])(_0x284085)&&(!_0x4a65b6[_0x35bb53(0x1b9)]||_0x526216==='enabled')){const _0x2b393a=await(0x0,GetTicketWbot_1[_0x35bb53(0x196)])(_0x4a65b6),_0x11e45f=await Queue_1['default']['findByPk'](_0x27e0f3),_0x38a520=await(0x0,ShowUserService_1[_0x35bb53(0x196)])(_0x44e5d8['userId']),_0x123cd5=_0x35bb53(0x1a1)+_0x11e45f?.[_0x35bb53(0x1ab)]+'*\x20e\x20será\x20atendido\x20por\x20*'+_0x38a520['name']+_0x35bb53(0x186),_0x200719=await _0x2b393a['sendMessage'](_0x4a65b6[_0x35bb53(0x1c5)]['number']+'@'+(_0x4a65b6[_0x35bb53(0x1b9)]?_0x35bb53(0x1a9):_0x35bb53(0x1b2)),{'text':_0x123cd5});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x200719,_0x4a65b6,_0x4a65b6['contact']);}else{if(_0x289585!==undefined&&(0x0,lodash_1['isNil'])(_0x284085)&&_0x5dd78d!==_0x27e0f3&&!(0x0,lodash_1['isNil'])(_0x27e0f3)){const _0x432355=await Queue_1['default'][_0x35bb53(0x1bb)](_0x27e0f3),_0x3100bb=await(0x0,GetTicketWbot_1[_0x35bb53(0x196)])(_0x4a65b6),_0x535ed5=_0x35bb53(0x190)+_0x432355?.['name']+'*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!',_0x5ad5da=await _0x3100bb[_0x35bb53(0x195)](_0x4a65b6['contact'][_0x35bb53(0x1b4)]+'@'+(_0x4a65b6[_0x35bb53(0x1b9)]?_0x35bb53(0x1a9):_0x35bb53(0x1b2)),{'text':_0x535ed5});await(0x0,wbotMessageListener_1[_0x35bb53(0x175)])(_0x5ad5da,_0x4a65b6,_0x4a65b6[_0x35bb53(0x1c5)]);}}}}}if(_0x289585!==_0x284085&&_0x5dd78d===_0x27e0f3&&!(0x0,lodash_1['isNil'])(_0x289585)&&!(0x0,lodash_1[_0x35bb53(0x1c0)])(_0x284085))await(0x0,CreateLogTicketService_1[_0x35bb53(0x196)])({'userId':_0x289585,'queueId':_0x5dd78d,'ticketId':_0x1962ca,'type':_0x35bb53(0x1a3)});else{if(_0x289585!==_0x284085&&_0x5dd78d===_0x27e0f3&&!(0x0,lodash_1['isNil'])(_0x289585)&&!(0x0,lodash_1[_0x35bb53(0x1c0)])(_0x284085))await(0x0,CreateLogTicketService_1['default'])({'userId':_0x289585,'queueId':_0x5dd78d,'ticketId':_0x1962ca,'type':_0x35bb53(0x1a3)}),await(0x0,CreateLogTicketService_1[_0x35bb53(0x196)])({'userId':_0x284085,'queueId':_0x5dd78d,'ticketId':_0x1962ca,'type':_0x35bb53(0x19e)});else{if(_0x289585!==_0x284085&&_0x5dd78d!==_0x27e0f3&&!(0x0,lodash_1[_0x35bb53(0x1c0)])(_0x289585)&&!(0x0,lodash_1[_0x35bb53(0x1c0)])(_0x284085))await(0x0,CreateLogTicketService_1[_0x35bb53(0x196)])({'userId':_0x289585,'queueId':_0x5dd78d,'ticketId':_0x1962ca,'type':_0x35bb53(0x1a3)}),await(0x0,CreateLogTicketService_1[_0x35bb53(0x196)])({'userId':_0x284085,'queueId':_0x27e0f3,'ticketId':_0x1962ca,'type':'receivedTransfer'});else _0x289585!==undefined&&(0x0,lodash_1[_0x35bb53(0x1c0)])(_0x284085)&&_0x5dd78d!==_0x27e0f3&&!(0x0,lodash_1[_0x35bb53(0x1c0)])(_0x27e0f3)&&await(0x0,CreateLogTicketService_1[_0x35bb53(0x196)])({'userId':_0x289585,'queueId':_0x5dd78d,'ticketId':_0x1962ca,'type':_0x35bb53(0x1a3)});}}return await _0x4a65b6[_0x35bb53(0x189)]({'status':_0x4f53b9,'queueId':_0x27e0f3,'userId':_0x284085,'isBot':_0x1975f7,'queueOptionId':_0x4b792c,'amountUsedBotQueues':_0x4f53b9==='closed'?0x0:_0xde819b?_0xde819b:_0x4a65b6['amountUsedBotQueues'],'lastMessage':_0xcb7533?_0xcb7533:_0x4a65b6[_0x35bb53(0x171)],'useIntegration':_0x4cfaae,'integrationId':_0xde4f00}),_0x570612['queuedAt']=(0x0,moment_1[_0x35bb53(0x196)])()[_0x35bb53(0x184)](),_0x570612[_0x35bb53(0x1cf)]=_0x27e0f3,await _0x4a65b6[_0x35bb53(0x170)](),_0x4f53b9!==undefined&&[_0x35bb53(0x1a5)]['indexOf'](_0x4f53b9)>-0x1&&!(0x0,lodash_1['isNil'])(_0x289585)&&(await(0x0,CreateLogTicketService_1[_0x35bb53(0x196)])({'userId':_0x289585,'ticketId':_0x1962ca,'type':_0x35bb53(0x1a5)}),_0x570612['update']({'whatsappId':_0x4a65b6[_0x35bb53(0x198)],'startedAt':null,'userId':null})),_0x4f53b9!==undefined&&_0x4f53b9!==_0x1b231c&&[_0x35bb53(0x188)]['indexOf'](_0x4f53b9)>-0x1&&(_0x570612['update']({'startedAt':(0x0,moment_1[_0x35bb53(0x196)])()[_0x35bb53(0x184)](),'ratingAt':null,'rated':![],'whatsappId':_0x4a65b6[_0x35bb53(0x198)],'userId':_0x4a65b6['userId'],'queueId':_0x4a65b6[_0x35bb53(0x1cf)]}),await(0x0,CreateLogTicketService_1[_0x35bb53(0x196)])({'userId':_0x284085,'queueId':_0x4a65b6[_0x35bb53(0x1cf)],'ticketId':_0x1962ca,'type':_0x35bb53(0x188)})),(_0x4a65b6[_0x35bb53(0x1d5)]!==_0x1b231c||_0x4a65b6[_0x35bb53(0x19a)]?.['id']!==_0x289585)&&(_0x570612[_0x35bb53(0x189)]({'userId':_0x4a65b6[_0x35bb53(0x1c4)]}),_0x567406['to'](_0x1b231c)[_0x35bb53(0x1af)](_0x35bb53(0x177)+_0x28426e+_0x35bb53(0x17c),{'action':_0x35bb53(0x1cb),'ticketId':_0x4a65b6['id']})),await _0x570612[_0x35bb53(0x1d0)](),_0x567406['to'](_0x4a65b6[_0x35bb53(0x1d5)])['to'](_0x35bb53(0x19f))['to'](_0x1962ca[_0x35bb53(0x1aa)]())[_0x35bb53(0x1af)](_0x35bb53(0x177)+_0x28426e+_0x35bb53(0x17c),{'action':_0x35bb53(0x189),'ticket':_0x4a65b6,'ticketId':_0x1962ca}),{'ticket':_0x4a65b6,'oldStatus':_0x1b231c,'oldUserId':_0x289585};}catch(_0x2c5c90){Sentry['captureException'](_0x2c5c90);}};exports[a549_0x4c377f(0x196)]=UpdateTicketService;