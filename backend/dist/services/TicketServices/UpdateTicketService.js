'use strict';const a600_0x394f7f=a600_0x35ba;function a600_0x280d(){const _0x33ce96=['farewellMessage','getIO','whatsappId','isNil','g.us','get','closedAt','userRating','948186Klilqd','destroy','default','../FacebookServices/sendFacebookMessage','create','captureException','transfered','closeTicketOnTransfer','../WbotServices/SendWhatsAppMessage','2280BQtGHz','save','isGroup','sendMessage','../UserServices/ShowUserService','extendedTextMessage','../../helpers/GetTicketWbot','lastMessage','../../models/User','queuedAt','notification','indexOf','../../models/CompaniesSettings','__createBinding','./CreateLogTicketService','sendMsgTransfTicket','includes','open','map','userId','user','facebook','updatedAt','toDate','call','33YcjwpX','112547VfyYqZ','-ticket','hasOwnProperty','emit','update','prototype','__setModuleDefault','status','\x20is\x20a\x20valid\x20','contact','verifyMessage','queueId','*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!','365fNMcbY','remoteJid','instagram','company-','./FindOrCreateTicketService','toString','name','whatsapp','Checking\x20if\x20','3509680CWAOKX','sendFarewellWaitingTicket','delete','@sentry/node','closed','__importDefault','*\x20e\x20será\x20atendido\x20por\x20*','../../libs/socket','../../models/Ticket','replace','../../models/Tag','../../models/TicketTag','amountUsedBotQueues','7RtUKVN','reload','../../models/Queue','../../helpers/SetTicketMessagesAsRead','findAll','\x20contact','__esModule','‎*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20atendente\x20*','log','3237eOftMu','458628NCwKzd','\x22*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!','findByPk','isBot','pending','../WhatsappService/ShowWhatsAppService','companyId','sequelize','enabled','moment','‎*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20departamento\x20*','ratingAt','2492090nnZThH','s.whatsapp.net','defineProperty','PVT','getOwnPropertyDescriptor','configurable','findOne','receivedTransfer','number','../FacebookServices/facebookMessageListener','channel','queueOptionId','./FindOrCreateATicketTrakingService','320upNisu'];a600_0x280d=function(){return _0x33ce96;};return a600_0x280d();}function a600_0x35ba(_0x3ea5e9,_0xb7b4e5){const _0x280d0b=a600_0x280d();return a600_0x35ba=function(_0x35bacb,_0x564799){_0x35bacb=_0x35bacb-0xdb;let _0x7c9b56=_0x280d0b[_0x35bacb];return _0x7c9b56;},a600_0x35ba(_0x3ea5e9,_0xb7b4e5);}(function(_0x1aeec9,_0x2b3494){const _0x39c428=a600_0x35ba,_0x25c5b0=_0x1aeec9();while(!![]){try{const _0x8dcdb4=parseInt(_0x39c428(0x10b))/0x1+-parseInt(_0x39c428(0x138))/0x2+parseInt(_0x39c428(0x137))/0x3*(-parseInt(_0x39c428(0xdf))/0x4)+parseInt(_0x39c428(0x118))/0x5*(parseInt(_0x39c428(0xf1))/0x6)+-parseInt(_0x39c428(0x12e))/0x7*(parseInt(_0x39c428(0x121))/0x8)+parseInt(_0x39c428(0xe8))/0x9+parseInt(_0x39c428(0x144))/0xa*(parseInt(_0x39c428(0x10a))/0xb);if(_0x8dcdb4===_0x2b3494)break;else _0x25c5b0['push'](_0x25c5b0['shift']());}catch(_0xce3d08){_0x25c5b0['push'](_0x25c5b0['shift']());}}}(a600_0x280d,0x3a54c));var __createBinding=this&&this[a600_0x394f7f(0xfe)]||(Object[a600_0x394f7f(0xec)]?function(_0x4a7a70,_0x2d6c4a,_0x29fffc,_0x410e14){const _0x5adb4e=a600_0x394f7f;if(_0x410e14===undefined)_0x410e14=_0x29fffc;var _0x5b5dfe=Object[_0x5adb4e(0x148)](_0x2d6c4a,_0x29fffc);(!_0x5b5dfe||(_0x5adb4e(0xe5)in _0x5b5dfe?!_0x2d6c4a[_0x5adb4e(0x134)]:_0x5b5dfe['writable']||_0x5b5dfe[_0x5adb4e(0x149)]))&&(_0x5b5dfe={'enumerable':!![],'get':function(){return _0x2d6c4a[_0x29fffc];}}),Object['defineProperty'](_0x4a7a70,_0x410e14,_0x5b5dfe);}:function(_0x48befb,_0x4a6b8f,_0x5edf4b,_0xbb3c67){if(_0xbb3c67===undefined)_0xbb3c67=_0x5edf4b;_0x48befb[_0xbb3c67]=_0x4a6b8f[_0x5edf4b];}),__setModuleDefault=this&&this[a600_0x394f7f(0x111)]||(Object[a600_0x394f7f(0xec)]?function(_0x5261d9,_0x1d34ca){const _0x3ba045=a600_0x394f7f;Object[_0x3ba045(0x146)](_0x5261d9,'default',{'enumerable':!![],'value':_0x1d34ca});}:function(_0x4c6ab0,_0x483a0e){const _0xa04e6f=a600_0x394f7f;_0x4c6ab0[_0xa04e6f(0xea)]=_0x483a0e;}),__importStar=this&&this['__importStar']||function(_0x3f7de6){const _0x4da64e=a600_0x394f7f;if(_0x3f7de6&&_0x3f7de6[_0x4da64e(0x134)])return _0x3f7de6;var _0x38cf03={};if(_0x3f7de6!=null){for(var _0x124749 in _0x3f7de6)if(_0x124749!==_0x4da64e(0xea)&&Object[_0x4da64e(0x110)][_0x4da64e(0x10d)][_0x4da64e(0x109)](_0x3f7de6,_0x124749))__createBinding(_0x38cf03,_0x3f7de6,_0x124749);}return __setModuleDefault(_0x38cf03,_0x3f7de6),_0x38cf03;},__importDefault=this&&this[a600_0x394f7f(0x126)]||function(_0x5ef719){const _0x5176a9=a600_0x394f7f;return _0x5ef719&&_0x5ef719[_0x5176a9(0x134)]?_0x5ef719:{'default':_0x5ef719};};Object[a600_0x394f7f(0x146)](exports,'__esModule',{'value':!![]});const moment_1=__importDefault(require(a600_0x394f7f(0x141))),Sentry=__importStar(require(a600_0x394f7f(0x124))),sequelize_1=require(a600_0x394f7f(0x13f)),SetTicketMessagesAsRead_1=__importDefault(require(a600_0x394f7f(0x131))),socket_1=require(a600_0x394f7f(0x128)),Ticket_1=__importDefault(require(a600_0x394f7f(0x129))),Queue_1=__importDefault(require(a600_0x394f7f(0x130))),ShowTicketService_1=__importDefault(require('./ShowTicketService')),ShowWhatsAppService_1=__importDefault(require(a600_0x394f7f(0x13d))),SendWhatsAppMessage_1=__importDefault(require(a600_0x394f7f(0xf0))),FindOrCreateATicketTrakingService_1=__importDefault(require(a600_0x394f7f(0xde))),GetTicketWbot_1=__importDefault(require(a600_0x394f7f(0xf7))),wbotMessageListener_1=require('../WbotServices/wbotMessageListener'),lodash_1=require('lodash'),sendFacebookMessage_1=__importDefault(require(a600_0x394f7f(0xeb))),facebookMessageListener_1=require(a600_0x394f7f(0xdb)),ShowUserService_1=__importDefault(require(a600_0x394f7f(0xf5))),User_1=__importDefault(require(a600_0x394f7f(0xf9))),CompaniesSettings_1=__importDefault(require(a600_0x394f7f(0xfd))),CreateLogTicketService_1=__importDefault(require(a600_0x394f7f(0xff))),TicketTag_1=__importDefault(require(a600_0x394f7f(0x12c))),Tag_1=__importDefault(require(a600_0x394f7f(0x12b))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),FindOrCreateTicketService_1=__importDefault(require(a600_0x394f7f(0x11c))),UpdateTicketService=async({ticketData:_0x54ad9e,ticketId:_0x366a72,companyId:_0x299f48})=>{const _0x208deb=a600_0x394f7f;try{const {status:_0x12a8b2}=_0x54ad9e;let {queueId:_0x366b0f,userId:_0x5d35f2,sendFarewellMessage:_0x8b554f,amountUsedBotQueues:_0x56945b,lastMessage:_0x4141c2,integrationId:_0xc3d419,useIntegration:_0x343f7f,unreadMessages:_0x32ce94,msgTransfer:_0xf77d0c,isTransfered:isTransfered=![]}=_0x54ad9e,_0x295eda=_0x54ad9e[_0x208deb(0x13b)]||![],_0x3c2a18=_0x54ad9e[_0x208deb(0xdd)]||null;const _0x4090b6=(0x0,socket_1[_0x208deb(0xe1)])(),_0x36a03b=await CompaniesSettings_1[_0x208deb(0xea)][_0x208deb(0x14a)]({'where':{'companyId':_0x299f48}});let _0x513636=await(0x0,ShowTicketService_1['default'])(_0x366a72,_0x299f48);_0x513636['channel']===_0x208deb(0x11f)&&await(0x0,SetTicketMessagesAsRead_1['default'])(_0x513636);const _0x4caa91=_0x513636?.['status'],_0xdbbe39=_0x513636[_0x208deb(0x105)]?.['id'],_0x5a5815=_0x513636?.[_0x208deb(0x116)];if(_0x4caa91===_0x208deb(0x125)){let _0x489c61=await Ticket_1[_0x208deb(0xea)][_0x208deb(0x14a)]({'where':{'contactId':_0x513636['contactId'],'status':{[sequelize_1['Op']['or']]:[_0x208deb(0x102),_0x208deb(0x13c),'group']},'whatsappId':_0x513636[_0x208deb(0xe2)]}});if(_0x489c61){if(_0x489c61['id']!==_0x513636['id'])return _0x489c61=await(0x0,ShowTicketService_1[_0x208deb(0xea)])(_0x489c61['id'],_0x299f48),{'ticket':_0x489c61,'oldStatus':_0x4caa91,'oldUserId':_0xdbbe39};}_0x295eda=![];}const _0x1de51b=await(0x0,FindOrCreateATicketTrakingService_1[_0x208deb(0xea)])({'ticketId':_0x366a72,'companyId':_0x299f48,'whatsappId':_0x513636['whatsappId']}),{complationMessage:_0x2d656e,ratingMessage:_0x4db7e9,groupAsTicket:_0x374b17}=await(0x0,ShowWhatsAppService_1[_0x208deb(0xea)])(_0x513636['whatsappId'],_0x299f48);if(_0x12a8b2!==undefined&&['closed'][_0x208deb(0xfc)](_0x12a8b2)>-0x1){const _0x48e976=_0x513636[_0x208deb(0x104)]||_0x5d35f2,_0x19dc16=await User_1['default'][_0x208deb(0x13a)](_0x48e976);if(_0x36a03b[_0x208deb(0xe7)]===_0x208deb(0x140)&&(_0x8b554f||_0x8b554f===undefined)&&(!(0x0,lodash_1[_0x208deb(0xe3)])(_0x4db7e9)&&_0x4db7e9!=='')&&!_0x513636[_0x208deb(0xf3)]){if(_0x1de51b[_0x208deb(0x143)]==null){const _0x174b0c=_0x4db7e9||'';let _0x4ef695='‎'+_0x174b0c+'\x0a';if(_0x513636[_0x208deb(0xdc)]===_0x208deb(0x11f)){const _0x203772=await(0x0,SendWhatsAppMessage_1[_0x208deb(0xea)])({'body':_0x4ef695,'ticket':_0x513636,'isForwarded':![]});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x203772,_0x513636,_0x513636[_0x208deb(0x114)]);}if([_0x208deb(0x106),_0x208deb(0x11a)]['includes'](_0x513636[_0x208deb(0xdc)])){console[_0x208deb(0x136)](_0x208deb(0x120)+_0x513636[_0x208deb(0x114)][_0x208deb(0x14c)]+'\x20is\x20a\x20valid\x20'+_0x513636['channel']+_0x208deb(0x133));const _0x342a3b=await(0x0,sendFacebookMessage_1[_0x208deb(0xea)])({'body':_0x4ef695,'ticket':_0x513636});await(0x0,facebookMessageListener_1['verifyMessageFace'])(_0x342a3b,_0x4ef695,_0x513636,_0x513636['contact']);}await _0x1de51b[_0x208deb(0x10f)]({'userId':_0x513636['userId'],'closedAt':(0x0,moment_1['default'])()[_0x208deb(0x108)]()}),await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0x513636[_0x208deb(0x104)],'queueId':_0x513636[_0x208deb(0x116)],'ticketId':_0x366a72,'type':'nps'});try{const _0x151c98=await TicketTag_1[_0x208deb(0xea)][_0x208deb(0x132)]({'where':{'ticketId':_0x366a72}}),_0x3df30c=_0x151c98[_0x208deb(0x103)](_0x2feabf=>_0x2feabf['tagId']),_0x26f9de=await Tag_1[_0x208deb(0xea)][_0x208deb(0x132)]({'where':{'id':_0x3df30c,'kanban':0x1}}),_0x56e925=_0x26f9de[_0x208deb(0x103)](_0x4a3b53=>_0x4a3b53['id']);if(_0x56e925)await TicketTag_1['default'][_0x208deb(0xe9)]({'where':{'ticketId':_0x366a72,'tagId':_0x56e925}});}catch(_0x4157d5){Sentry[_0x208deb(0xed)](_0x4157d5);}return await _0x513636['update']({'status':'nps','amountUseBotQueuesNPS':0x1}),_0x4090b6['to'](_0x208deb(0x102))['to'](_0x366a72[_0x208deb(0x11d)]())[_0x208deb(0x10e)]('company-'+_0x513636[_0x208deb(0x13e)]+_0x208deb(0x10c),{'action':_0x208deb(0x123),'ticketId':_0x513636['id']}),{'ticket':_0x513636,'oldStatus':_0x4caa91,'oldUserId':_0xdbbe39};}}if((!(0x0,lodash_1[_0x208deb(0xe3)])(_0x19dc16?.[_0x208deb(0xe0)])&&_0x19dc16?.['farewellMessage']!==''||!(0x0,lodash_1[_0x208deb(0xe3)])(_0x2d656e)&&_0x2d656e!=='')&&(_0x8b554f||_0x8b554f===undefined)){let _0x179d4a;if(_0x513636['status']!=='pending'||_0x513636['status']==='pending'&&_0x36a03b[_0x208deb(0x122)]===_0x208deb(0x140)){!(0x0,lodash_1[_0x208deb(0xe3)])(_0x19dc16)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x19dc16?.[_0x208deb(0xe0)])&&_0x19dc16?.['farewellMessage']!==''?_0x179d4a='‎\x20'+_0x19dc16[_0x208deb(0xe0)]:_0x179d4a='‎\x20'+_0x2d656e;if(_0x513636[_0x208deb(0xdc)]===_0x208deb(0x11f)&&(!_0x513636[_0x208deb(0xf3)]||_0x374b17===_0x208deb(0x140))){const _0x32ff1f=await(0x0,SendWhatsAppMessage_1[_0x208deb(0xea)])({'body':_0x179d4a,'ticket':_0x513636,'isForwarded':![]});await(0x0,wbotMessageListener_1[_0x208deb(0x115)])(_0x32ff1f,_0x513636,_0x513636['contact']);}if([_0x208deb(0x106),_0x208deb(0x11a)][_0x208deb(0x101)](_0x513636[_0x208deb(0xdc)])&&(!_0x513636[_0x208deb(0xf3)]||_0x374b17==='enabled')){console['log'](_0x208deb(0x120)+_0x513636[_0x208deb(0x114)][_0x208deb(0x14c)]+_0x208deb(0x113)+_0x513636['channel']+_0x208deb(0x133));const _0x2e2398=await(0x0,sendFacebookMessage_1[_0x208deb(0xea)])({'body':_0x179d4a,'ticket':_0x513636});}}}return _0x1de51b['finishedAt']=(0x0,moment_1[_0x208deb(0xea)])()[_0x208deb(0x108)](),_0x1de51b[_0x208deb(0xe6)]=(0x0,moment_1['default'])()['toDate'](),_0x1de51b[_0x208deb(0xe2)]=_0x513636['whatsappId'],_0x1de51b['userId']=_0x513636['userId'],await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0x5d35f2,'queueId':_0x513636['queueId'],'ticketId':_0x366a72,'type':_0x208deb(0x125)}),await _0x1de51b[_0x208deb(0xf2)](),await _0x513636[_0x208deb(0x10f)]({'status':_0x208deb(0x125)}),_0x4090b6['to'](_0x4caa91)['to'](_0x366a72['toString']())[_0x208deb(0x10e)](_0x208deb(0x11b)+_0x513636[_0x208deb(0x13e)]+_0x208deb(0x10c),{'action':'delete','ticketId':_0x513636['id']}),{'ticket':_0x513636,'oldStatus':_0x4caa91,'oldUserId':_0xdbbe39};}!(0x0,lodash_1[_0x208deb(0xe3)])(_0x366b0f)&&(_0x1de51b[_0x208deb(0xfa)]=(0x0,moment_1[_0x208deb(0xea)])()[_0x208deb(0x108)]());if(isTransfered){if(_0x36a03b[_0x208deb(0xef)]){let _0x3c555e=_0x513636;if(_0x5a5815!==_0x366b0f){await _0x513636[_0x208deb(0x10f)]({'status':_0x208deb(0x125)}),await _0x513636[_0x208deb(0x12f)](),_0x4090b6['to'](_0x4caa91)['to'](_0x366a72[_0x208deb(0x11d)]())[_0x208deb(0x10e)]('company-'+_0x513636[_0x208deb(0x13e)]+'-ticket',{'action':_0x208deb(0x123),'ticketId':_0x513636['id']});const {ticket:_0x2b6564}=await(0x0,FindOrCreateTicketService_1[_0x208deb(0xea)])(_0x513636[_0x208deb(0x114)],_0x513636[_0x208deb(0x11f)],0x1,_0x513636[_0x208deb(0x13e)],_0x366b0f,_0x5d35f2,null,_0x208deb(0x11f),![],![],_0x36a03b,isTransfered);_0x3c555e=_0x2b6564;}if(!(0x0,lodash_1[_0x208deb(0xe3)])(_0xf77d0c)){const _0x3424de={'wid':_0x208deb(0x147)+_0x3c555e[_0x208deb(0x107)]['toString']()[_0x208deb(0x12a)]('\x20',''),'ticketId':_0x3c555e['id'],'contactId':undefined,'body':_0xf77d0c,'fromMe':!![],'mediaType':_0x208deb(0xf6),'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':_0x3c555e['contact']?.[_0x208deb(0x119)],'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':!![]};await(0x0,CreateMessageService_1[_0x208deb(0xea)])({'messageData':_0x3424de,'companyId':_0x513636[_0x208deb(0x13e)]});}await _0x3c555e[_0x208deb(0x10f)]({'queueId':_0x366b0f,'userId':_0x5d35f2,'status':_0x12a8b2}),await _0x3c555e['reload']();if(_0x36a03b[_0x208deb(0x100)]===_0x208deb(0x140)){if(_0x5a5815!==_0x366b0f&&_0xdbbe39===_0x5d35f2&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5a5815)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x366b0f)){const _0x228885=await Queue_1[_0x208deb(0xea)][_0x208deb(0x13a)](_0x366b0f),_0x59d756=await(0x0,GetTicketWbot_1[_0x208deb(0xea)])(_0x513636),_0x3a2646='‎*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20departamento\x20*'+_0x228885?.[_0x208deb(0x11e)]+_0x208deb(0x139),_0x36d839=await _0x59d756[_0x208deb(0xf4)](_0x513636[_0x208deb(0x114)][_0x208deb(0x14c)]+'@'+(_0x513636[_0x208deb(0xf3)]?'g.us':_0x208deb(0x145)),{'text':_0x3a2646});await(0x0,wbotMessageListener_1[_0x208deb(0x115)])(_0x36d839,_0x513636,_0x513636[_0x208deb(0x114)],_0x1de51b);}else{if(_0xdbbe39!==_0x5d35f2&&_0x5a5815===_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0xdbbe39)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2)&&(!_0x513636['isGroup']||_0x374b17===_0x208deb(0x140))){const _0x41a900=await(0x0,GetTicketWbot_1[_0x208deb(0xea)])(_0x513636),_0xa22bf8=await(0x0,ShowUserService_1[_0x208deb(0xea)])(_0x54ad9e['userId'],_0x299f48),_0x1922ee=_0x208deb(0x135)+_0xa22bf8[_0x208deb(0x11e)]+_0x208deb(0x117),_0x562da0=await _0x41a900['sendMessage'](_0x513636['contact'][_0x208deb(0x14c)]+'@'+(_0x513636[_0x208deb(0xf3)]?_0x208deb(0xe4):_0x208deb(0x145)),{'text':_0x1922ee});await(0x0,wbotMessageListener_1[_0x208deb(0x115)])(_0x562da0,_0x513636,_0x513636['contact'],_0x1de51b);}else{if(_0xdbbe39!==_0x5d35f2&&_0x5a5815!==_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0xdbbe39)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2)&&(!_0x513636[_0x208deb(0xf3)]||_0x374b17==='enabled')){const _0x211a68=await(0x0,GetTicketWbot_1[_0x208deb(0xea)])(_0x513636),_0x3cd1e3=await Queue_1[_0x208deb(0xea)][_0x208deb(0x13a)](_0x366b0f),_0xb77634=await(0x0,ShowUserService_1['default'])(_0x54ad9e[_0x208deb(0x104)],_0x299f48),_0x333cde=_0x208deb(0x142)+_0x3cd1e3?.['name']+'*\x20e\x20será\x20atendido\x20por\x20*'+_0xb77634[_0x208deb(0x11e)]+_0x208deb(0x117),_0x2bea44=await _0x211a68[_0x208deb(0xf4)](_0x513636['contact'][_0x208deb(0x14c)]+'@'+(_0x513636[_0x208deb(0xf3)]?'g.us':_0x208deb(0x145)),{'text':_0x333cde});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x2bea44,_0x513636,_0x513636[_0x208deb(0x114)]);}else{if(_0xdbbe39!==undefined&&(0x0,lodash_1['isNil'])(_0x5d35f2)&&_0x5a5815!==_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x366b0f)){const _0x518b08=await Queue_1['default'][_0x208deb(0x13a)](_0x366b0f),_0x144ef2=await(0x0,GetTicketWbot_1[_0x208deb(0xea)])(_0x513636),_0xbce4f5=_0x208deb(0x142)+_0x518b08?.[_0x208deb(0x11e)]+_0x208deb(0x117),_0x3d66f9=await _0x144ef2['sendMessage'](_0x513636['contact'][_0x208deb(0x14c)]+'@'+(_0x513636[_0x208deb(0xf3)]?_0x208deb(0xe4):_0x208deb(0x145)),{'text':_0xbce4f5});await(0x0,wbotMessageListener_1[_0x208deb(0x115)])(_0x3d66f9,_0x513636,_0x513636[_0x208deb(0x114)]);}}}}}if(_0xdbbe39!==_0x5d35f2&&_0x5a5815===_0x366b0f&&!(0x0,lodash_1['isNil'])(_0xdbbe39)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2))await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0xdbbe39,'queueId':_0x5a5815,'ticketId':_0x366a72,'type':_0x208deb(0xee)});else{if(_0xdbbe39!==_0x5d35f2&&_0x5a5815===_0x366b0f&&!(0x0,lodash_1['isNil'])(_0xdbbe39)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2))await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0xdbbe39,'queueId':_0x5a5815,'ticketId':_0x366a72,'type':_0x208deb(0xee)}),await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0x5d35f2,'queueId':_0x5a5815,'ticketId':_0x3c555e['id'],'type':_0x208deb(0x14b)});else{if(_0xdbbe39!==_0x5d35f2&&_0x5a5815!==_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0xdbbe39)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2))await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0xdbbe39,'queueId':_0x5a5815,'ticketId':_0x366a72,'type':_0x208deb(0xee)}),await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0x5d35f2,'queueId':_0x366b0f,'ticketId':_0x3c555e['id'],'type':_0x208deb(0x14b)});else _0xdbbe39!==undefined&&(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2)&&_0x5a5815!==_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x366b0f)&&await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0xdbbe39,'queueId':_0x5a5815,'ticketId':_0x366a72,'type':'transfered'});}}return(_0x3c555e['status']!==_0x4caa91||_0x3c555e[_0x208deb(0x105)]?.['id']!==_0xdbbe39)&&(await _0x1de51b[_0x208deb(0x10f)]({'userId':_0x3c555e['userId']}),_0x4090b6['to'](_0x4caa91)['emit'](_0x208deb(0x11b)+_0x299f48+'-ticket',{'action':_0x208deb(0x123),'ticketId':_0x3c555e['id']})),_0x4090b6['to'](_0x3c555e[_0x208deb(0x112)])['to']('notification')['to'](_0x3c555e['id'][_0x208deb(0x11d)]())[_0x208deb(0x10e)](_0x208deb(0x11b)+_0x299f48+_0x208deb(0x10c),{'action':_0x208deb(0x10f),'ticket':_0x3c555e}),{'ticket':_0x3c555e,'oldStatus':_0x4caa91,'oldUserId':_0xdbbe39};}else{if(_0x36a03b[_0x208deb(0x100)]==='enabled'){if(_0x5a5815!==_0x366b0f&&_0xdbbe39===_0x5d35f2&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5a5815)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x366b0f)){const _0x377cba=await Queue_1[_0x208deb(0xea)][_0x208deb(0x13a)](_0x366b0f),_0x2e29b5=await(0x0,GetTicketWbot_1[_0x208deb(0xea)])(_0x513636),_0x16c78a=_0x208deb(0x142)+_0x377cba?.['name']+_0x208deb(0x139),_0xc2e3af=await _0x2e29b5[_0x208deb(0xf4)](_0x513636[_0x208deb(0x114)][_0x208deb(0x14c)]+'@'+(_0x513636[_0x208deb(0xf3)]?_0x208deb(0xe4):'s.whatsapp.net'),{'text':_0x16c78a});await(0x0,wbotMessageListener_1[_0x208deb(0x115)])(_0xc2e3af,_0x513636,_0x513636['contact'],_0x1de51b);}else{if(_0xdbbe39!==_0x5d35f2&&_0x5a5815===_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0xdbbe39)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2)&&(!_0x513636[_0x208deb(0xf3)]||_0x374b17===_0x208deb(0x140))){const _0x3eaa5f=await(0x0,GetTicketWbot_1[_0x208deb(0xea)])(_0x513636),_0x48eca8=await(0x0,ShowUserService_1[_0x208deb(0xea)])(_0x54ad9e['userId'],_0x299f48),_0x54a628=_0x208deb(0x135)+_0x48eca8[_0x208deb(0x11e)]+_0x208deb(0x117),_0x552528=await _0x3eaa5f[_0x208deb(0xf4)](_0x513636[_0x208deb(0x114)]['number']+'@'+(_0x513636[_0x208deb(0xf3)]?_0x208deb(0xe4):_0x208deb(0x145)),{'text':_0x54a628});await(0x0,wbotMessageListener_1[_0x208deb(0x115)])(_0x552528,_0x513636,_0x513636[_0x208deb(0x114)],_0x1de51b);}else{if(_0xdbbe39!==_0x5d35f2&&_0x5a5815!==_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0xdbbe39)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2)&&(!_0x513636['isGroup']||_0x374b17==='enabled')){const _0x1b0665=await(0x0,GetTicketWbot_1[_0x208deb(0xea)])(_0x513636),_0x3d9450=await Queue_1[_0x208deb(0xea)][_0x208deb(0x13a)](_0x366b0f),_0x258bb6=await(0x0,ShowUserService_1[_0x208deb(0xea)])(_0x54ad9e['userId'],_0x299f48),_0x3c5d4e=_0x208deb(0x142)+_0x3d9450?.[_0x208deb(0x11e)]+_0x208deb(0x127)+_0x258bb6['name']+_0x208deb(0x117),_0x4ae5f6=await _0x1b0665[_0x208deb(0xf4)](_0x513636[_0x208deb(0x114)][_0x208deb(0x14c)]+'@'+(_0x513636['isGroup']?_0x208deb(0xe4):'s.whatsapp.net'),{'text':_0x3c5d4e});await(0x0,wbotMessageListener_1[_0x208deb(0x115)])(_0x4ae5f6,_0x513636,_0x513636['contact']);}else{if(_0xdbbe39!==undefined&&(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2)&&_0x5a5815!==_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x366b0f)){const _0x7d183d=await Queue_1[_0x208deb(0xea)][_0x208deb(0x13a)](_0x366b0f),_0x2004b8=await(0x0,GetTicketWbot_1[_0x208deb(0xea)])(_0x513636),_0x2710dc=_0x208deb(0x142)+_0x7d183d?.[_0x208deb(0x11e)]+_0x208deb(0x117),_0x34812e=await _0x2004b8['sendMessage'](_0x513636['contact'][_0x208deb(0x14c)]+'@'+(_0x513636[_0x208deb(0xf3)]?'g.us':_0x208deb(0x145)),{'text':_0x2710dc});await(0x0,wbotMessageListener_1[_0x208deb(0x115)])(_0x34812e,_0x513636,_0x513636[_0x208deb(0x114)]);}}}}}if(!(0x0,lodash_1[_0x208deb(0xe3)])(_0xf77d0c)){const _0x131d71={'wid':_0x208deb(0x147)+_0x513636[_0x208deb(0x107)]['toString']()[_0x208deb(0x12a)]('\x20',''),'ticketId':_0x513636['id'],'contactId':undefined,'body':_0xf77d0c,'fromMe':!![],'mediaType':_0x208deb(0xf6),'read':!![],'quotedMsgId':null,'ack':0x2,'remoteJid':_0x513636[_0x208deb(0x114)]?.[_0x208deb(0x119)],'participant':null,'dataJson':null,'ticketTrakingId':null,'isPrivate':!![]};await(0x0,CreateMessageService_1[_0x208deb(0xea)])({'messageData':_0x131d71,'companyId':_0x513636[_0x208deb(0x13e)]});}if(_0xdbbe39!==_0x5d35f2&&_0x5a5815===_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0xdbbe39)&&!(0x0,lodash_1['isNil'])(_0x5d35f2))await(0x0,CreateLogTicketService_1['default'])({'userId':_0xdbbe39,'queueId':_0x5a5815,'ticketId':_0x366a72,'type':_0x208deb(0xee)});else{if(_0xdbbe39!==_0x5d35f2&&_0x5a5815===_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0xdbbe39)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2))await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0xdbbe39,'queueId':_0x5a5815,'ticketId':_0x366a72,'type':_0x208deb(0xee)}),await(0x0,CreateLogTicketService_1['default'])({'userId':_0x5d35f2,'queueId':_0x5a5815,'ticketId':_0x513636['id'],'type':_0x208deb(0x14b)});else{if(_0xdbbe39!==_0x5d35f2&&_0x5a5815!==_0x366b0f&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0xdbbe39)&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2))await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0xdbbe39,'queueId':_0x5a5815,'ticketId':_0x366a72,'type':_0x208deb(0xee)}),await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0x5d35f2,'queueId':_0x366b0f,'ticketId':_0x513636['id'],'type':_0x208deb(0x14b)});else _0xdbbe39!==undefined&&(0x0,lodash_1[_0x208deb(0xe3)])(_0x5d35f2)&&_0x5a5815!==_0x366b0f&&!(0x0,lodash_1['isNil'])(_0x366b0f)&&await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0xdbbe39,'queueId':_0x5a5815,'ticketId':_0x366a72,'type':_0x208deb(0xee)});}}}}return await _0x513636[_0x208deb(0x10f)]({'status':_0x12a8b2,'queueId':_0x366b0f,'userId':_0x5d35f2,'isBot':_0x295eda,'queueOptionId':_0x3c2a18,'amountUsedBotQueues':_0x12a8b2===_0x208deb(0x125)?0x0:_0x56945b?_0x56945b:_0x513636[_0x208deb(0x12d)],'lastMessage':_0x4141c2?_0x4141c2:_0x513636[_0x208deb(0xf8)],'useIntegration':_0x343f7f,'integrationId':_0xc3d419,'unreadMessages':_0x32ce94}),_0x1de51b[_0x208deb(0xfa)]=(0x0,moment_1['default'])()[_0x208deb(0x108)](),_0x1de51b[_0x208deb(0x116)]=_0x366b0f,_0x513636=await(0x0,ShowTicketService_1[_0x208deb(0xea)])(_0x513636['id'],_0x299f48),_0x12a8b2!==undefined&&['pending'][_0x208deb(0xfc)](_0x12a8b2)>-0x1&&!(0x0,lodash_1[_0x208deb(0xe3)])(_0xdbbe39)&&(await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0xdbbe39,'ticketId':_0x366a72,'type':_0x208deb(0x13c)}),await _0x1de51b[_0x208deb(0x10f)]({'whatsappId':_0x513636[_0x208deb(0xe2)],'startedAt':null,'userId':null})),_0x12a8b2!==undefined&&_0x12a8b2!==_0x4caa91&&['open'][_0x208deb(0xfc)](_0x12a8b2)>-0x1&&(await _0x1de51b['update']({'startedAt':(0x0,moment_1[_0x208deb(0xea)])()[_0x208deb(0x108)](),'ratingAt':null,'rated':![],'whatsappId':_0x513636['whatsappId'],'userId':_0x513636['userId'],'queueId':_0x513636[_0x208deb(0x116)]}),await(0x0,CreateLogTicketService_1[_0x208deb(0xea)])({'userId':_0x5d35f2,'queueId':_0x513636[_0x208deb(0x116)],'ticketId':_0x366a72,'type':_0x4caa91===_0x208deb(0x13c)?'open':'reopen'})),await _0x1de51b[_0x208deb(0xf2)](),(_0x513636[_0x208deb(0x112)]!==_0x4caa91||_0x513636[_0x208deb(0x105)]?.['id']!==_0xdbbe39)&&(await _0x1de51b['update']({'userId':_0x513636[_0x208deb(0x104)]}),_0x4090b6['to'](_0x4caa91)[_0x208deb(0x10e)](_0x208deb(0x11b)+_0x299f48+_0x208deb(0x10c),{'action':'delete','ticketId':_0x513636['id']})),_0x4090b6['to'](_0x513636['status'])['to'](_0x208deb(0xfb))['to'](_0x366a72['toString']())[_0x208deb(0x10e)]('company-'+_0x299f48+_0x208deb(0x10c),{'action':_0x208deb(0x10f),'ticket':_0x513636}),{'ticket':_0x513636,'oldStatus':_0x4caa91,'oldUserId':_0xdbbe39};}catch(_0xfe22ad){Sentry[_0x208deb(0xed)](_0xfe22ad);}};exports[a600_0x394f7f(0xea)]=UpdateTicketService;