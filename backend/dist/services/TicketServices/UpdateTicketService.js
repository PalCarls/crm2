'use strict';const a589_0x239ab4=a589_0x4c6f;(function(_0x2cbb90,_0x620653){const _0x97b49=a589_0x4c6f,_0x2c9f0c=_0x2cbb90();while(!![]){try{const _0x3684dc=-parseInt(_0x97b49(0x246))/0x1*(-parseInt(_0x97b49(0x217))/0x2)+parseInt(_0x97b49(0x242))/0x3+-parseInt(_0x97b49(0x20f))/0x4+parseInt(_0x97b49(0x209))/0x5*(parseInt(_0x97b49(0x1fe))/0x6)+-parseInt(_0x97b49(0x244))/0x7*(-parseInt(_0x97b49(0x225))/0x8)+-parseInt(_0x97b49(0x1f7))/0x9+parseInt(_0x97b49(0x1f1))/0xa*(-parseInt(_0x97b49(0x20a))/0xb);if(_0x3684dc===_0x620653)break;else _0x2c9f0c['push'](_0x2c9f0c['shift']());}catch(_0x4a14ad){_0x2c9f0c['push'](_0x2c9f0c['shift']());}}}(a589_0x3051,0xd56cf));var __createBinding=this&&this[a589_0x239ab4(0x21b)]||(Object[a589_0x239ab4(0x228)]?function(_0x4feeea,_0x28b783,_0x4f79b4,_0x1c785a){const _0x228e25=a589_0x239ab4;if(_0x1c785a===undefined)_0x1c785a=_0x4f79b4;var _0x3373bb=Object['getOwnPropertyDescriptor'](_0x28b783,_0x4f79b4);(!_0x3373bb||('get'in _0x3373bb?!_0x28b783[_0x228e25(0x229)]:_0x3373bb[_0x228e25(0x240)]||_0x3373bb[_0x228e25(0x23e)]))&&(_0x3373bb={'enumerable':!![],'get':function(){return _0x28b783[_0x4f79b4];}}),Object['defineProperty'](_0x4feeea,_0x1c785a,_0x3373bb);}:function(_0x233f67,_0x3e32db,_0x484731,_0x5288cf){if(_0x5288cf===undefined)_0x5288cf=_0x484731;_0x233f67[_0x5288cf]=_0x3e32db[_0x484731];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a589_0x239ab4(0x228)]?function(_0x492344,_0x42c304){const _0x785542=a589_0x239ab4;Object[_0x785542(0x1ef)](_0x492344,_0x785542(0x226),{'enumerable':!![],'value':_0x42c304});}:function(_0x165401,_0x26aefb){_0x165401['default']=_0x26aefb;}),__importStar=this&&this[a589_0x239ab4(0x22e)]||function(_0xcb9690){const _0x2cf25c=a589_0x239ab4;if(_0xcb9690&&_0xcb9690[_0x2cf25c(0x229)])return _0xcb9690;var _0x2d4dbf={};if(_0xcb9690!=null){for(var _0x227595 in _0xcb9690)if(_0x227595!=='default'&&Object[_0x2cf25c(0x204)][_0x2cf25c(0x21e)][_0x2cf25c(0x218)](_0xcb9690,_0x227595))__createBinding(_0x2d4dbf,_0xcb9690,_0x227595);}return __setModuleDefault(_0x2d4dbf,_0xcb9690),_0x2d4dbf;},__importDefault=this&&this[a589_0x239ab4(0x1ed)]||function(_0x533a0c){const _0x4838a3=a589_0x239ab4;return _0x533a0c&&_0x533a0c[_0x4838a3(0x229)]?_0x533a0c:{'default':_0x533a0c};};Object[a589_0x239ab4(0x1ef)](exports,a589_0x239ab4(0x229),{'value':!![]});function a589_0x4c6f(_0x5ba8a1,_0x226170){const _0x3051a7=a589_0x3051();return a589_0x4c6f=function(_0x4c6fe4,_0x5571c7){_0x4c6fe4=_0x4c6fe4-0x1e1;let _0x15b78f=_0x3051a7[_0x4c6fe4];return _0x15b78f;},a589_0x4c6f(_0x5ba8a1,_0x226170);}const moment_1=__importDefault(require('moment')),Sentry=__importStar(require(a589_0x239ab4(0x230))),sequelize_1=require(a589_0x239ab4(0x222)),SetTicketMessagesAsRead_1=__importDefault(require('../../helpers/SetTicketMessagesAsRead')),socket_1=require('../../libs/socket'),Ticket_1=__importDefault(require(a589_0x239ab4(0x1ee))),Queue_1=__importDefault(require(a589_0x239ab4(0x22d))),ShowTicketService_1=__importDefault(require(a589_0x239ab4(0x234))),ShowWhatsAppService_1=__importDefault(require(a589_0x239ab4(0x22f))),SendWhatsAppMessage_1=__importDefault(require(a589_0x239ab4(0x245))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),wbotMessageListener_1=require('../WbotServices/wbotMessageListener'),lodash_1=require(a589_0x239ab4(0x214)),sendFacebookMessage_1=__importDefault(require('../FacebookServices/sendFacebookMessage')),facebookMessageListener_1=require(a589_0x239ab4(0x206)),ShowUserService_1=__importDefault(require(a589_0x239ab4(0x1f9))),User_1=__importDefault(require(a589_0x239ab4(0x227))),CompaniesSettings_1=__importDefault(require('../../models/CompaniesSettings')),CreateLogTicketService_1=__importDefault(require(a589_0x239ab4(0x1fb))),TicketTag_1=__importDefault(require(a589_0x239ab4(0x22a))),Tag_1=__importDefault(require(a589_0x239ab4(0x216))),UpdateTicketService=async({ticketData:_0x505d74,ticketId:_0x551172,companyId:_0x5794a5})=>{const _0x21328e=a589_0x239ab4;try{const {status:_0x5e0634}=_0x505d74;let {queueId:_0x3eb060,userId:_0x3d3aa1,sendFarewellMessage:_0x5c2a9e,amountUsedBotQueues:_0x2fe0e3,lastMessage:_0xc0130f,integrationId:_0x301ce4,useIntegration:_0x310c23,unreadMessages:_0x194011}=_0x505d74,_0x4a4c55=_0x505d74[_0x21328e(0x22b)]||![],_0x2051da=_0x505d74[_0x21328e(0x20d)]||null;const _0x3ff8f9=(0x0,socket_1[_0x21328e(0x203)])(),_0x32a371=await CompaniesSettings_1[_0x21328e(0x226)][_0x21328e(0x210)]({'where':{'companyId':_0x5794a5}}),_0x30ac13=await(0x0,ShowTicketService_1[_0x21328e(0x226)])(_0x551172,_0x5794a5);_0x30ac13['channel']===_0x21328e(0x202)&&await(0x0,SetTicketMessagesAsRead_1[_0x21328e(0x226)])(_0x30ac13);const _0xd37402=_0x30ac13?.[_0x21328e(0x21f)],_0x577fab=_0x30ac13['user']?.['id'],_0x466954=_0x30ac13?.[_0x21328e(0x21d)];if(_0xd37402==='closed'){const _0x2aae07=await Ticket_1['default']['findOne']({'where':{'contactId':_0x30ac13['contactId'],'status':{[sequelize_1['Op']['or']]:[_0x21328e(0x211),_0x21328e(0x23c),'group']},'whatsappId':_0x30ac13['whatsappId']},'include':[{'model':Queue_1['default'],'as':'queue','attributes':['id',_0x21328e(0x233),_0x21328e(0x223)]},{'model':User_1['default'],'as':'user','attributes':['id',_0x21328e(0x233)]}]});if(_0x2aae07){if(_0x2aae07['id']!==_0x30ac13['id'])return{'ticket':_0x2aae07,'oldStatus':_0xd37402,'oldUserId':_0x577fab};}_0x4a4c55=![];}const _0x27cf3f=await(0x0,FindOrCreateATicketTrakingService_1[_0x21328e(0x226)])({'ticketId':_0x551172,'companyId':_0x5794a5,'whatsappId':_0x30ac13[_0x21328e(0x23b)]}),{complationMessage:_0x27102e,ratingMessage:_0x476217,groupAsTicket:_0x59152c}=await(0x0,ShowWhatsAppService_1[_0x21328e(0x226)])(_0x30ac13[_0x21328e(0x23b)],_0x5794a5);if(_0x5e0634!==undefined&&[_0x21328e(0x1fa)][_0x21328e(0x20c)](_0x5e0634)>-0x1){const _0x3e7af8=_0x30ac13['userId']||_0x3d3aa1,_0x376802=await User_1[_0x21328e(0x226)][_0x21328e(0x22c)](_0x3e7af8);if(_0x32a371[_0x21328e(0x1e5)]===_0x21328e(0x220)&&(_0x5c2a9e||_0x5c2a9e===undefined)&&(!(0x0,lodash_1[_0x21328e(0x213)])(_0x476217)&&_0x476217!=='')&&!_0x30ac13['isGroup']){if(_0x27cf3f['ratingAt']==null){const _0x4eef26=_0x476217||'';let _0xe7f30c='‎'+_0x4eef26+'\x0a';if(_0x30ac13[_0x21328e(0x1f4)]==='whatsapp'){const _0x404fbe=await(0x0,SendWhatsAppMessage_1[_0x21328e(0x226)])({'body':_0xe7f30c,'ticket':_0x30ac13,'isForwarded':![],'isPrivate':![]});await(0x0,wbotMessageListener_1[_0x21328e(0x239)])(_0x404fbe,_0x30ac13,_0x30ac13[_0x21328e(0x231)]);}if([_0x21328e(0x232),'instagram']['includes'](_0x30ac13['channel'])){console['log']('Checking\x20if\x20'+_0x30ac13[_0x21328e(0x231)][_0x21328e(0x215)]+_0x21328e(0x1f8)+_0x30ac13[_0x21328e(0x1f4)]+'\x20contact');const _0x29d870=await(0x0,sendFacebookMessage_1[_0x21328e(0x226)])({'body':_0xe7f30c,'ticket':_0x30ac13});await(0x0,facebookMessageListener_1[_0x21328e(0x1fd)])(_0x29d870,_0xe7f30c,_0x30ac13,_0x30ac13[_0x21328e(0x231)]);}await _0x27cf3f[_0x21328e(0x1e1)]({'userId':_0x30ac13[_0x21328e(0x224)],'closedAt':(0x0,moment_1[_0x21328e(0x226)])()[_0x21328e(0x1f5)]()}),await(0x0,CreateLogTicketService_1[_0x21328e(0x226)])({'userId':_0x30ac13[_0x21328e(0x224)],'queueId':_0x30ac13[_0x21328e(0x21d)],'ticketId':_0x551172,'type':'nps'});try{const _0x8ffd25=await TicketTag_1['default']['findAll']({'where':{'ticketId':_0x551172}}),_0x16de61=_0x8ffd25[_0x21328e(0x235)](_0x18c9ab=>_0x18c9ab[_0x21328e(0x243)]),_0x4b4ecd=await Tag_1[_0x21328e(0x226)]['findAll']({'where':{'id':_0x16de61,'kanban':0x1}}),_0x500224=_0x4b4ecd[_0x21328e(0x235)](_0x2ef7ad=>_0x2ef7ad['id']);if(_0x500224)await TicketTag_1[_0x21328e(0x226)]['destroy']({'where':{'ticketId':_0x551172,'tagId':_0x500224}});}catch(_0x44bbae){Sentry[_0x21328e(0x1fc)](_0x44bbae);}return await _0x30ac13[_0x21328e(0x1e1)]({'status':_0x21328e(0x1e7),'amountUseBotQueuesNPS':0x1}),_0x3ff8f9['to'](_0x21328e(0x211))['to'](_0x551172[_0x21328e(0x1f3)]())[_0x21328e(0x1e4)](_0x21328e(0x1eb)+_0x30ac13[_0x21328e(0x1e3)]+'-ticket',{'action':_0x21328e(0x221),'ticketId':_0x30ac13['id']}),{'ticket':_0x30ac13,'oldStatus':_0xd37402,'oldUserId':_0x577fab};}}if(!(0x0,lodash_1[_0x21328e(0x213)])(_0x376802?.[_0x21328e(0x1f6)])&&_0x376802?.[_0x21328e(0x1f6)]!==''||!(0x0,lodash_1[_0x21328e(0x213)])(_0x27102e)&&_0x27102e!==''&&(_0x5c2a9e||_0x5c2a9e===undefined)){let _0x92bf31;if(_0x30ac13['status']!==_0x21328e(0x23c)||_0x30ac13['status']==='pending'&&_0x32a371[_0x21328e(0x1f2)]==='enabled'){!(0x0,lodash_1[_0x21328e(0x213)])(_0x376802)&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x376802?.['farewellMessage'])&&_0x376802?.['farewellMessage']!==''?_0x92bf31='‎\x20'+_0x376802[_0x21328e(0x1f6)]:_0x92bf31='‎\x20'+_0x27102e;if(_0x30ac13[_0x21328e(0x1f4)]==='whatsapp'&&(!_0x30ac13['isGroup']||_0x59152c===_0x21328e(0x220))){const _0x3662fa=await(0x0,SendWhatsAppMessage_1[_0x21328e(0x226)])({'body':_0x92bf31,'ticket':_0x30ac13,'isForwarded':![],'isPrivate':![]});await(0x0,wbotMessageListener_1[_0x21328e(0x239)])(_0x3662fa,_0x30ac13,_0x30ac13['contact']);}if(['facebook',_0x21328e(0x1ff)]['includes'](_0x30ac13[_0x21328e(0x1f4)])&&(!_0x30ac13['isGroup']||_0x59152c===_0x21328e(0x220))){console[_0x21328e(0x1e6)](_0x21328e(0x237)+_0x30ac13[_0x21328e(0x231)]['number']+_0x21328e(0x1f8)+_0x30ac13[_0x21328e(0x1f4)]+_0x21328e(0x241));const _0xa66550=await(0x0,sendFacebookMessage_1['default'])({'body':_0x92bf31,'ticket':_0x30ac13});}}}return _0x27cf3f[_0x21328e(0x23a)]=(0x0,moment_1[_0x21328e(0x226)])()[_0x21328e(0x1f5)](),_0x27cf3f[_0x21328e(0x205)]=(0x0,moment_1[_0x21328e(0x226)])()['toDate'](),_0x27cf3f[_0x21328e(0x23b)]=_0x30ac13['whatsappId'],_0x27cf3f[_0x21328e(0x224)]=_0x30ac13[_0x21328e(0x224)],await(0x0,CreateLogTicketService_1[_0x21328e(0x226)])({'userId':_0x3d3aa1,'queueId':_0x30ac13[_0x21328e(0x21d)],'ticketId':_0x551172,'type':_0x21328e(0x1fa)}),await _0x27cf3f[_0x21328e(0x20e)](),await _0x30ac13[_0x21328e(0x1e1)]({'status':_0x21328e(0x1fa)}),_0x3ff8f9['to'](_0xd37402)['to'](_0x551172['toString']())[_0x21328e(0x1e4)](_0x21328e(0x1eb)+_0x30ac13['companyId']+_0x21328e(0x1ea),{'action':_0x21328e(0x221),'ticketId':_0x30ac13['id']}),{'ticket':_0x30ac13,'oldStatus':_0xd37402,'oldUserId':_0x577fab};}!(0x0,lodash_1[_0x21328e(0x213)])(_0x3eb060)&&(_0x27cf3f[_0x21328e(0x1e8)]=(0x0,moment_1[_0x21328e(0x226)])()[_0x21328e(0x1f5)]());if(_0x32a371[_0x21328e(0x219)]==='enabled'){if(_0x466954!==_0x3eb060&&_0x577fab===_0x3d3aa1&&!(0x0,lodash_1['isNil'])(_0x466954)&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x3eb060)){const _0x2a107d=await Queue_1[_0x21328e(0x226)][_0x21328e(0x22c)](_0x3eb060),_0x4db93c=await(0x0,GetTicketWbot_1[_0x21328e(0x226)])(_0x30ac13),_0x34e8c9=_0x21328e(0x1e9)+_0x2a107d?.[_0x21328e(0x233)]+_0x21328e(0x23f),_0x32c468=await _0x4db93c[_0x21328e(0x1ec)](_0x30ac13[_0x21328e(0x231)]['number']+'@'+(_0x30ac13[_0x21328e(0x208)]?_0x21328e(0x200):_0x21328e(0x20b)),{'text':_0x34e8c9});await(0x0,wbotMessageListener_1[_0x21328e(0x239)])(_0x32c468,_0x30ac13,_0x30ac13['contact'],_0x27cf3f);}else{if(_0x577fab!==_0x3d3aa1&&_0x466954===_0x3eb060&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x577fab)&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x3d3aa1)&&(!_0x30ac13[_0x21328e(0x208)]||_0x59152c===_0x21328e(0x220))){const _0x1149a9=await(0x0,GetTicketWbot_1['default'])(_0x30ac13),_0x293dbb=await(0x0,ShowUserService_1['default'])(_0x505d74[_0x21328e(0x224)],_0x5794a5),_0x54d6=_0x21328e(0x236)+_0x293dbb[_0x21328e(0x233)]+_0x21328e(0x21a),_0x4b7d61=await _0x1149a9['sendMessage'](_0x30ac13['contact'][_0x21328e(0x215)]+'@'+(_0x30ac13['isGroup']?'g.us':_0x21328e(0x20b)),{'text':_0x54d6});await(0x0,wbotMessageListener_1[_0x21328e(0x239)])(_0x4b7d61,_0x30ac13,_0x30ac13[_0x21328e(0x231)],_0x27cf3f);}else{if(_0x577fab!==_0x3d3aa1&&_0x466954!==_0x3eb060&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x577fab)&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x3d3aa1)&&(!_0x30ac13[_0x21328e(0x208)]||_0x59152c==='enabled')){const _0x47cc7a=await(0x0,GetTicketWbot_1['default'])(_0x30ac13),_0x537ccc=await Queue_1[_0x21328e(0x226)][_0x21328e(0x22c)](_0x3eb060),_0x415f95=await(0x0,ShowUserService_1[_0x21328e(0x226)])(_0x505d74[_0x21328e(0x224)],_0x5794a5),_0x52fc34='‎*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20departamento\x20*'+_0x537ccc?.['name']+_0x21328e(0x207)+_0x415f95[_0x21328e(0x233)]+_0x21328e(0x21a),_0x5ea272=await _0x47cc7a['sendMessage'](_0x30ac13[_0x21328e(0x231)][_0x21328e(0x215)]+'@'+(_0x30ac13[_0x21328e(0x208)]?'g.us':_0x21328e(0x20b)),{'text':_0x52fc34});await(0x0,wbotMessageListener_1[_0x21328e(0x239)])(_0x5ea272,_0x30ac13,_0x30ac13['contact']);}else{if(_0x577fab!==undefined&&(0x0,lodash_1[_0x21328e(0x213)])(_0x3d3aa1)&&_0x466954!==_0x3eb060&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x3eb060)){const _0x12cb0a=await Queue_1[_0x21328e(0x226)]['findByPk'](_0x3eb060),_0x27cd05=await(0x0,GetTicketWbot_1[_0x21328e(0x226)])(_0x30ac13),_0x4f1289=_0x21328e(0x1e9)+_0x12cb0a?.[_0x21328e(0x233)]+_0x21328e(0x21a),_0x35bb06=await _0x27cd05[_0x21328e(0x1ec)](_0x30ac13[_0x21328e(0x231)][_0x21328e(0x215)]+'@'+(_0x30ac13[_0x21328e(0x208)]?_0x21328e(0x200):_0x21328e(0x20b)),{'text':_0x4f1289});await(0x0,wbotMessageListener_1[_0x21328e(0x239)])(_0x35bb06,_0x30ac13,_0x30ac13[_0x21328e(0x231)]);}}}}}if(_0x577fab!==_0x3d3aa1&&_0x466954===_0x3eb060&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x577fab)&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x3d3aa1))await(0x0,CreateLogTicketService_1['default'])({'userId':_0x577fab,'queueId':_0x466954,'ticketId':_0x551172,'type':_0x21328e(0x1f0)});else{if(_0x577fab!==_0x3d3aa1&&_0x466954===_0x3eb060&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x577fab)&&!(0x0,lodash_1['isNil'])(_0x3d3aa1))await(0x0,CreateLogTicketService_1['default'])({'userId':_0x577fab,'queueId':_0x466954,'ticketId':_0x551172,'type':'transfered'}),await(0x0,CreateLogTicketService_1[_0x21328e(0x226)])({'userId':_0x3d3aa1,'queueId':_0x466954,'ticketId':_0x551172,'type':'receivedTransfer'});else{if(_0x577fab!==_0x3d3aa1&&_0x466954!==_0x3eb060&&!(0x0,lodash_1['isNil'])(_0x577fab)&&!(0x0,lodash_1[_0x21328e(0x213)])(_0x3d3aa1))await(0x0,CreateLogTicketService_1[_0x21328e(0x226)])({'userId':_0x577fab,'queueId':_0x466954,'ticketId':_0x551172,'type':_0x21328e(0x1f0)}),await(0x0,CreateLogTicketService_1['default'])({'userId':_0x3d3aa1,'queueId':_0x3eb060,'ticketId':_0x551172,'type':_0x21328e(0x23d)});else _0x577fab!==undefined&&(0x0,lodash_1[_0x21328e(0x213)])(_0x3d3aa1)&&_0x466954!==_0x3eb060&&!(0x0,lodash_1['isNil'])(_0x3eb060)&&await(0x0,CreateLogTicketService_1['default'])({'userId':_0x577fab,'queueId':_0x466954,'ticketId':_0x551172,'type':_0x21328e(0x1f0)});}}return await _0x30ac13[_0x21328e(0x1e1)]({'status':_0x5e0634,'queueId':_0x3eb060,'userId':_0x3d3aa1,'isBot':_0x4a4c55,'queueOptionId':_0x2051da,'amountUsedBotQueues':_0x5e0634===_0x21328e(0x1fa)?0x0:_0x2fe0e3?_0x2fe0e3:_0x30ac13[_0x21328e(0x1e2)],'lastMessage':_0xc0130f?_0xc0130f:_0x30ac13[_0x21328e(0x238)],'useIntegration':_0x310c23,'integrationId':_0x301ce4,'unreadMessages':_0x194011}),_0x27cf3f[_0x21328e(0x1e8)]=(0x0,moment_1[_0x21328e(0x226)])()[_0x21328e(0x1f5)](),_0x27cf3f[_0x21328e(0x21d)]=_0x3eb060,await _0x30ac13['reload'](),_0x5e0634!==undefined&&[_0x21328e(0x23c)][_0x21328e(0x20c)](_0x5e0634)>-0x1&&!(0x0,lodash_1['isNil'])(_0x577fab)&&(await(0x0,CreateLogTicketService_1[_0x21328e(0x226)])({'userId':_0x577fab,'ticketId':_0x551172,'type':_0x21328e(0x23c)}),_0x27cf3f[_0x21328e(0x1e1)]({'whatsappId':_0x30ac13[_0x21328e(0x23b)],'startedAt':null,'userId':null})),_0x5e0634!==undefined&&_0x5e0634!==_0xd37402&&['open'][_0x21328e(0x20c)](_0x5e0634)>-0x1&&(_0x27cf3f[_0x21328e(0x1e1)]({'startedAt':(0x0,moment_1[_0x21328e(0x226)])()[_0x21328e(0x1f5)](),'ratingAt':null,'rated':![],'whatsappId':_0x30ac13['whatsappId'],'userId':_0x30ac13[_0x21328e(0x224)],'queueId':_0x30ac13[_0x21328e(0x21d)]}),await(0x0,CreateLogTicketService_1[_0x21328e(0x226)])({'userId':_0x3d3aa1,'queueId':_0x30ac13[_0x21328e(0x21d)],'ticketId':_0x551172,'type':_0xd37402==='pending'?_0x21328e(0x211):_0x21328e(0x201)})),await _0x27cf3f[_0x21328e(0x20e)](),(_0x30ac13['status']!==_0xd37402||_0x30ac13[_0x21328e(0x212)]?.['id']!==_0x577fab)&&(_0x27cf3f[_0x21328e(0x1e1)]({'userId':_0x30ac13[_0x21328e(0x224)]}),_0x3ff8f9['to'](_0xd37402)[_0x21328e(0x1e4)](_0x21328e(0x1eb)+_0x5794a5+_0x21328e(0x1ea),{'action':_0x21328e(0x221),'ticketId':_0x30ac13['id']})),_0x3ff8f9['to'](_0x30ac13[_0x21328e(0x21f)])['to'](_0x21328e(0x21c))['to'](_0x551172[_0x21328e(0x1f3)]())[_0x21328e(0x1e4)](_0x21328e(0x1eb)+_0x5794a5+_0x21328e(0x1ea),{'action':'update','ticket':_0x30ac13}),{'ticket':_0x30ac13,'oldStatus':_0xd37402,'oldUserId':_0x577fab};}catch(_0x476bfc){Sentry[_0x21328e(0x1fc)](_0x476bfc);}};exports[a589_0x239ab4(0x226)]=UpdateTicketService;function a589_0x3051(){const _0x5c581b=['s.whatsapp.net','indexOf','queueOptionId','save','2667652KzItiK','findOne','open','user','isNil','lodash','number','../../models/Tag','6408WQvnJx','call','sendMsgTransfTicket','*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!','__createBinding','notification','queueId','hasOwnProperty','status','enabled','delete','sequelize','color','userId','840qIBUKY','default','../../models/User','create','__esModule','../../models/TicketTag','isBot','findByPk','../../models/Queue','__importStar','../WhatsappService/ShowWhatsAppService','@sentry/node','contact','facebook','name','./ShowTicketService','map','‎*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20atendente\x20*','Checking\x20if\x20','lastMessage','verifyMessage','finishedAt','whatsappId','pending','receivedTransfer','configurable','\x22*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!','writable','\x20contact','1845486iMIjee','tagId','31619iARIMU','../WbotServices/SendWhatsAppMessage','344YdAQAJ','update','amountUsedBotQueues','companyId','emit','userRating','log','nps','queuedAt','‎*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20departamento\x20*','-ticket','company-','sendMessage','__importDefault','../../models/Ticket','defineProperty','transfered','9724930HfzCrL','sendFarewellWaitingTicket','toString','channel','toDate','farewellMessage','3358143KjBRKB','\x20is\x20a\x20valid\x20','../UserServices/ShowUserService','closed','./CreateLogTicketService','captureException','verifyMessageFace','379146IUUhmp','instagram','g.us','reopen','whatsapp','getIO','prototype','closedAt','../FacebookServices/facebookMessageListener','*\x20e\x20será\x20atendido\x20por\x20*','isGroup','55bkCJRk','11yYmXJk'];a589_0x3051=function(){return _0x5c581b;};return a589_0x3051();}