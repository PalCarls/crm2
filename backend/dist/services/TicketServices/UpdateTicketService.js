'use strict';const a589_0x251a4f=a589_0x3a1c;(function(_0x3d1443,_0x43bbba){const _0x52359e=a589_0x3a1c,_0x5ef67c=_0x3d1443();while(!![]){try{const _0x4a0863=parseInt(_0x52359e(0x147))/0x1*(-parseInt(_0x52359e(0x125))/0x2)+parseInt(_0x52359e(0x10b))/0x3+parseInt(_0x52359e(0x126))/0x4+parseInt(_0x52359e(0x15d))/0x5*(parseInt(_0x52359e(0x118))/0x6)+-parseInt(_0x52359e(0x120))/0x7+parseInt(_0x52359e(0x15b))/0x8+-parseInt(_0x52359e(0x15f))/0x9;if(_0x4a0863===_0x43bbba)break;else _0x5ef67c['push'](_0x5ef67c['shift']());}catch(_0x1fb439){_0x5ef67c['push'](_0x5ef67c['shift']());}}}(a589_0x1d67,0xc98fa));function a589_0x1d67(){const _0x1e1f6c=['ratingAt','pending','4383KKpIqs','status','lastMessage','group','call','get','destroy','delete','finishedAt','toDate','closedAt','queueOptionId','number','map','\x20is\x20a\x20valid\x20','../../models/Tag','\x20contact','log','../FacebookServices/sendFacebookMessage','writable','5022944PSjlwb','userId','1196360qGGWWi','*\x20e\x20será\x20atendido\x20por\x20*','6105078aOCMWV','configurable','sequelize','indexOf','reopen','queue','toString','./FindOrCreateATicketTrakingService','whatsapp','../../models/CompaniesSettings','‎*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20departamento\x20*','create','__setModuleDefault','-ticket','name','nps','findOne','default','getIO','../../models/Ticket','closed','tagId','findAll','includes','../WbotServices/SendWhatsAppMessage','763134aimTda','emit','channel','findByPk','g.us','reload','transfered','enabled','‎*Mensagem\x20Automática*:\x0aVocê\x20foi\x20transferido(a)\x20para\x20o\x20atendente\x20*','../../models/TicketTag','../UserServices/ShowUserService','../../models/User','verifyMessage','36pEfjio','__importDefault','hasOwnProperty','isNil','update','../../models/Queue','facebook','user','3377752ffRTdw','s.whatsapp.net','contact','color','defineProperty','258WxOkyN','936004fQcdAI','save','__importStar','company-','receivedTransfer','sendMsgTransfTicket','moment','\x22*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!','companyId','prototype','getOwnPropertyDescriptor','verifyMessageFace','queueId','__esModule','instagram','queuedAt','sendMessage','isGroup','*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!','whatsappId','contactId','captureException','../FacebookServices/facebookMessageListener','notification','farewellMessage','Checking\x20if\x20','./ShowTicketService','../WbotServices/wbotMessageListener','@sentry/node','amountUsedBotQueues','open'];a589_0x1d67=function(){return _0x1e1f6c;};return a589_0x1d67();}var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x200363,_0x292211,_0x165fa7,_0xc67f6d){const _0x489210=a589_0x3a1c;if(_0xc67f6d===undefined)_0xc67f6d=_0x165fa7;var _0x503084=Object[_0x489210(0x130)](_0x292211,_0x165fa7);(!_0x503084||(_0x489210(0x14c)in _0x503084?!_0x292211[_0x489210(0x133)]:_0x503084[_0x489210(0x15a)]||_0x503084[_0x489210(0x160)]))&&(_0x503084={'enumerable':!![],'get':function(){return _0x292211[_0x165fa7];}}),Object[_0x489210(0x124)](_0x200363,_0xc67f6d,_0x503084);}:function(_0x4ad140,_0x2ee0ca,_0x5428ea,_0xaaf34f){if(_0xaaf34f===undefined)_0xaaf34f=_0x5428ea;_0x4ad140[_0xaaf34f]=_0x2ee0ca[_0x5428ea];}),__setModuleDefault=this&&this[a589_0x251a4f(0xfe)]||(Object[a589_0x251a4f(0x16a)]?function(_0x17e047,_0x505e60){const _0x24fee5=a589_0x251a4f;Object[_0x24fee5(0x124)](_0x17e047,_0x24fee5(0x103),{'enumerable':!![],'value':_0x505e60});}:function(_0x2c063d,_0x10eef0){_0x2c063d['default']=_0x10eef0;}),__importStar=this&&this[a589_0x251a4f(0x128)]||function(_0x50c2c1){const _0xcd63cd=a589_0x251a4f;if(_0x50c2c1&&_0x50c2c1['__esModule'])return _0x50c2c1;var _0x4d938c={};if(_0x50c2c1!=null){for(var _0x44da88 in _0x50c2c1)if(_0x44da88!==_0xcd63cd(0x103)&&Object[_0xcd63cd(0x12f)][_0xcd63cd(0x11a)][_0xcd63cd(0x14b)](_0x50c2c1,_0x44da88))__createBinding(_0x4d938c,_0x50c2c1,_0x44da88);}return __setModuleDefault(_0x4d938c,_0x50c2c1),_0x4d938c;},__importDefault=this&&this[a589_0x251a4f(0x119)]||function(_0x177e21){return _0x177e21&&_0x177e21['__esModule']?_0x177e21:{'default':_0x177e21};};function a589_0x3a1c(_0x4480c6,_0xdc29d6){const _0x1d674e=a589_0x1d67();return a589_0x3a1c=function(_0x3a1c58,_0x5cd6b6){_0x3a1c58=_0x3a1c58-0xfe;let _0x16b915=_0x1d674e[_0x3a1c58];return _0x16b915;},a589_0x3a1c(_0x4480c6,_0xdc29d6);}Object[a589_0x251a4f(0x124)](exports,a589_0x251a4f(0x133),{'value':!![]});const moment_1=__importDefault(require(a589_0x251a4f(0x12c))),Sentry=__importStar(require(a589_0x251a4f(0x142))),sequelize_1=require(a589_0x251a4f(0x161)),SetTicketMessagesAsRead_1=__importDefault(require('../../helpers/SetTicketMessagesAsRead')),socket_1=require('../../libs/socket'),Ticket_1=__importDefault(require(a589_0x251a4f(0x105))),Queue_1=__importDefault(require(a589_0x251a4f(0x11d))),ShowTicketService_1=__importDefault(require(a589_0x251a4f(0x140))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),SendWhatsAppMessage_1=__importDefault(require(a589_0x251a4f(0x10a))),FindOrCreateATicketTrakingService_1=__importDefault(require(a589_0x251a4f(0x166))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),wbotMessageListener_1=require(a589_0x251a4f(0x141)),lodash_1=require('lodash'),sendFacebookMessage_1=__importDefault(require(a589_0x251a4f(0x159))),facebookMessageListener_1=require(a589_0x251a4f(0x13c)),ShowUserService_1=__importDefault(require(a589_0x251a4f(0x115))),User_1=__importDefault(require(a589_0x251a4f(0x116))),CompaniesSettings_1=__importDefault(require(a589_0x251a4f(0x168))),CreateLogTicketService_1=__importDefault(require('./CreateLogTicketService')),TicketTag_1=__importDefault(require(a589_0x251a4f(0x114))),Tag_1=__importDefault(require(a589_0x251a4f(0x156))),UpdateTicketService=async({ticketData:_0x1f3b2b,ticketId:_0x380e10,companyId:_0x2d105b})=>{const _0x595428=a589_0x251a4f;try{const {status:_0x345003}=_0x1f3b2b;let {queueId:_0x9f567b,userId:_0x1f291d,sendFarewellMessage:_0xe69298,amountUsedBotQueues:_0xff2eec,lastMessage:_0x4bfa4b,integrationId:_0x2076fc,useIntegration:_0x64f20c,unreadMessages:_0x5490c2}=_0x1f3b2b,_0x26520b=_0x1f3b2b['isBot']||![],_0x3ffc17=_0x1f3b2b[_0x595428(0x152)]||null;const _0x4adeb9=(0x0,socket_1[_0x595428(0x104)])(),_0x3902a8=await CompaniesSettings_1[_0x595428(0x103)][_0x595428(0x102)]({'where':{'companyId':_0x2d105b}}),_0x3959ca=await(0x0,ShowTicketService_1['default'])(_0x380e10,_0x2d105b);_0x3959ca[_0x595428(0x10d)]==='whatsapp'&&await(0x0,SetTicketMessagesAsRead_1['default'])(_0x3959ca);const _0x9aafce=_0x3959ca?.[_0x595428(0x148)],_0x253d0c=_0x3959ca['user']?.['id'],_0x431011=_0x3959ca?.[_0x595428(0x132)];if(_0x9aafce===_0x595428(0x106)){const _0x572df0=await Ticket_1[_0x595428(0x103)]['findOne']({'where':{'contactId':_0x3959ca[_0x595428(0x13a)],'status':{[sequelize_1['Op']['or']]:[_0x595428(0x144),_0x595428(0x146),_0x595428(0x14a)]},'whatsappId':_0x3959ca[_0x595428(0x139)]},'include':[{'model':Queue_1[_0x595428(0x103)],'as':_0x595428(0x164),'attributes':['id',_0x595428(0x100),_0x595428(0x123)]},{'model':User_1[_0x595428(0x103)],'as':_0x595428(0x11f),'attributes':['id',_0x595428(0x100)]}]});if(_0x572df0){if(_0x572df0['id']!==_0x3959ca['id'])return{'ticket':_0x572df0,'oldStatus':_0x9aafce,'oldUserId':_0x253d0c};}_0x26520b=![];}const _0x390207=await(0x0,FindOrCreateATicketTrakingService_1[_0x595428(0x103)])({'ticketId':_0x380e10,'companyId':_0x2d105b,'whatsappId':_0x3959ca[_0x595428(0x139)]}),{complationMessage:_0x18ee60,ratingMessage:_0x2837f5,groupAsTicket:_0xd85fac}=await(0x0,ShowWhatsAppService_1['default'])(_0x3959ca[_0x595428(0x139)],_0x2d105b);if(_0x345003!==undefined&&[_0x595428(0x106)][_0x595428(0x162)](_0x345003)>-0x1){const _0x312726=_0x3959ca[_0x595428(0x15c)]||_0x1f291d,_0x2a8839=await User_1[_0x595428(0x103)][_0x595428(0x10e)](_0x312726);if(_0x3902a8['userRating']==='enabled'&&(_0xe69298||_0xe69298===undefined)&&(!(0x0,lodash_1['isNil'])(_0x2837f5)&&_0x2837f5!=='')&&!_0x3959ca[_0x595428(0x137)]){if(_0x390207[_0x595428(0x145)]==null){const _0x367eaf=_0x2837f5||'';let _0x305277='‎'+_0x367eaf+'\x0a';if(_0x3959ca[_0x595428(0x10d)]==='whatsapp'){const _0xd945b6=await(0x0,SendWhatsAppMessage_1[_0x595428(0x103)])({'body':_0x305277,'ticket':_0x3959ca,'isForwarded':![],'isPrivate':![]});await(0x0,wbotMessageListener_1['verifyMessage'])(_0xd945b6,_0x3959ca,_0x3959ca[_0x595428(0x122)]);}if([_0x595428(0x11e),_0x595428(0x134)][_0x595428(0x109)](_0x3959ca['channel'])){console['log'](_0x595428(0x13f)+_0x3959ca[_0x595428(0x122)][_0x595428(0x153)]+_0x595428(0x155)+_0x3959ca[_0x595428(0x10d)]+_0x595428(0x157));const _0x3a63e8=await(0x0,sendFacebookMessage_1[_0x595428(0x103)])({'body':_0x305277,'ticket':_0x3959ca});await(0x0,facebookMessageListener_1[_0x595428(0x131)])(_0x3a63e8,_0x305277,_0x3959ca,_0x3959ca[_0x595428(0x122)]);}await _0x390207[_0x595428(0x11c)]({'userId':_0x3959ca[_0x595428(0x15c)],'closedAt':(0x0,moment_1[_0x595428(0x103)])()['toDate']()}),await(0x0,CreateLogTicketService_1['default'])({'userId':_0x3959ca[_0x595428(0x15c)],'queueId':_0x3959ca['queueId'],'ticketId':_0x380e10,'type':_0x595428(0x101)});try{const _0x565b2f=await TicketTag_1['default'][_0x595428(0x108)]({'where':{'ticketId':_0x380e10}}),_0xa7ba8d=_0x565b2f[_0x595428(0x154)](_0xae0636=>_0xae0636[_0x595428(0x107)]),_0x27b0a3=await Tag_1[_0x595428(0x103)][_0x595428(0x108)]({'where':{'id':_0xa7ba8d,'kanban':0x1}}),_0x5ace24=_0x27b0a3[_0x595428(0x154)](_0x3ebf7b=>_0x3ebf7b['id']);if(_0x5ace24)await TicketTag_1[_0x595428(0x103)][_0x595428(0x14d)]({'where':{'ticketId':_0x380e10,'tagId':_0x5ace24}});}catch(_0x51f3b7){Sentry[_0x595428(0x13b)](_0x51f3b7);}return await _0x3959ca[_0x595428(0x11c)]({'status':_0x595428(0x101),'amountUseBotQueuesNPS':0x1}),_0x4adeb9['to'](_0x595428(0x144))['to'](_0x380e10[_0x595428(0x165)]())['emit'](_0x595428(0x129)+_0x3959ca[_0x595428(0x12e)]+_0x595428(0xff),{'action':'delete','ticketId':_0x3959ca['id']}),{'ticket':_0x3959ca,'oldStatus':_0x9aafce,'oldUserId':_0x253d0c};}}if(!(0x0,lodash_1[_0x595428(0x11b)])(_0x2a8839?.[_0x595428(0x13e)])&&_0x2a8839?.[_0x595428(0x13e)]!==''||!(0x0,lodash_1[_0x595428(0x11b)])(_0x18ee60)&&_0x18ee60!==''&&(_0xe69298||_0xe69298===undefined)){let _0x14142f;if(_0x3959ca[_0x595428(0x148)]!==_0x595428(0x146)||_0x3959ca[_0x595428(0x148)]===_0x595428(0x146)&&_0x3902a8['sendFarewellWaitingTicket']==='enabled'){!(0x0,lodash_1[_0x595428(0x11b)])(_0x2a8839)&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x2a8839?.['farewellMessage'])&&_0x2a8839?.[_0x595428(0x13e)]!==''?_0x14142f='‎\x20'+_0x2a8839[_0x595428(0x13e)]:_0x14142f='‎\x20'+_0x18ee60;if(_0x3959ca['channel']===_0x595428(0x167)&&(!_0x3959ca[_0x595428(0x137)]||_0xd85fac===_0x595428(0x112))){const _0x570e5a=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x14142f,'ticket':_0x3959ca,'isForwarded':![],'isPrivate':![]});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x570e5a,_0x3959ca,_0x3959ca[_0x595428(0x122)]);}if(['facebook',_0x595428(0x134)][_0x595428(0x109)](_0x3959ca[_0x595428(0x10d)])&&(!_0x3959ca[_0x595428(0x137)]||_0xd85fac===_0x595428(0x112))){console[_0x595428(0x158)](_0x595428(0x13f)+_0x3959ca['contact'][_0x595428(0x153)]+_0x595428(0x155)+_0x3959ca['channel']+'\x20contact');const _0x388783=await(0x0,sendFacebookMessage_1[_0x595428(0x103)])({'body':_0x14142f,'ticket':_0x3959ca});}}}return _0x390207[_0x595428(0x14f)]=(0x0,moment_1['default'])()['toDate'](),_0x390207[_0x595428(0x151)]=(0x0,moment_1[_0x595428(0x103)])()['toDate'](),_0x390207['whatsappId']=_0x3959ca[_0x595428(0x139)],_0x390207[_0x595428(0x15c)]=_0x3959ca['userId'],await(0x0,CreateLogTicketService_1[_0x595428(0x103)])({'userId':_0x1f291d,'queueId':_0x3959ca[_0x595428(0x132)],'ticketId':_0x380e10,'type':_0x595428(0x106)}),await _0x390207[_0x595428(0x127)](),await _0x3959ca['update']({'status':_0x595428(0x106)}),_0x4adeb9['to'](_0x9aafce)['to'](_0x380e10['toString']())[_0x595428(0x10c)]('company-'+_0x3959ca['companyId']+_0x595428(0xff),{'action':'delete','ticketId':_0x3959ca['id']}),{'ticket':_0x3959ca,'oldStatus':_0x9aafce,'oldUserId':_0x253d0c};}!(0x0,lodash_1[_0x595428(0x11b)])(_0x9f567b)&&(_0x390207[_0x595428(0x135)]=(0x0,moment_1[_0x595428(0x103)])()['toDate']());if(_0x3902a8[_0x595428(0x12b)]===_0x595428(0x112)){if(_0x431011!==_0x9f567b&&_0x253d0c===_0x1f291d&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x431011)&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x9f567b)){const _0x336493=await Queue_1[_0x595428(0x103)][_0x595428(0x10e)](_0x9f567b),_0x3ceb75=await(0x0,GetTicketWbot_1[_0x595428(0x103)])(_0x3959ca),_0x3cddc2=_0x595428(0x169)+_0x336493?.[_0x595428(0x100)]+_0x595428(0x12d),_0x33224b=await _0x3ceb75[_0x595428(0x136)](_0x3959ca[_0x595428(0x122)][_0x595428(0x153)]+'@'+(_0x3959ca[_0x595428(0x137)]?_0x595428(0x10f):'s.whatsapp.net'),{'text':_0x3cddc2});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x33224b,_0x3959ca,_0x3959ca[_0x595428(0x122)],_0x390207);}else{if(_0x253d0c!==_0x1f291d&&_0x431011===_0x9f567b&&!(0x0,lodash_1['isNil'])(_0x253d0c)&&!(0x0,lodash_1['isNil'])(_0x1f291d)&&(!_0x3959ca[_0x595428(0x137)]||_0xd85fac===_0x595428(0x112))){const _0x4531c8=await(0x0,GetTicketWbot_1[_0x595428(0x103)])(_0x3959ca),_0xd2f60e=await(0x0,ShowUserService_1[_0x595428(0x103)])(_0x1f3b2b['userId'],_0x2d105b),_0x46aa4a=_0x595428(0x113)+_0xd2f60e['name']+_0x595428(0x138),_0x4a9858=await _0x4531c8[_0x595428(0x136)](_0x3959ca[_0x595428(0x122)][_0x595428(0x153)]+'@'+(_0x3959ca['isGroup']?_0x595428(0x10f):'s.whatsapp.net'),{'text':_0x46aa4a});await(0x0,wbotMessageListener_1[_0x595428(0x117)])(_0x4a9858,_0x3959ca,_0x3959ca[_0x595428(0x122)],_0x390207);}else{if(_0x253d0c!==_0x1f291d&&_0x431011!==_0x9f567b&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x253d0c)&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x1f291d)&&(!_0x3959ca[_0x595428(0x137)]||_0xd85fac==='enabled')){const _0x280de0=await(0x0,GetTicketWbot_1['default'])(_0x3959ca),_0x1334a5=await Queue_1[_0x595428(0x103)]['findByPk'](_0x9f567b),_0x55395b=await(0x0,ShowUserService_1[_0x595428(0x103)])(_0x1f3b2b['userId'],_0x2d105b),_0x1b557e=_0x595428(0x169)+_0x1334a5?.[_0x595428(0x100)]+_0x595428(0x15e)+_0x55395b[_0x595428(0x100)]+'*\x0aAguarde\x20um\x20momento,\x20iremos\x20atende-lo(a)!',_0x317006=await _0x280de0[_0x595428(0x136)](_0x3959ca[_0x595428(0x122)][_0x595428(0x153)]+'@'+(_0x3959ca[_0x595428(0x137)]?'g.us':_0x595428(0x121)),{'text':_0x1b557e});await(0x0,wbotMessageListener_1[_0x595428(0x117)])(_0x317006,_0x3959ca,_0x3959ca[_0x595428(0x122)]);}else{if(_0x253d0c!==undefined&&(0x0,lodash_1[_0x595428(0x11b)])(_0x1f291d)&&_0x431011!==_0x9f567b&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x9f567b)){const _0x13adec=await Queue_1[_0x595428(0x103)]['findByPk'](_0x9f567b),_0x52a95a=await(0x0,GetTicketWbot_1['default'])(_0x3959ca),_0x2a407d=_0x595428(0x169)+_0x13adec?.['name']+_0x595428(0x138),_0x10f048=await _0x52a95a[_0x595428(0x136)](_0x3959ca[_0x595428(0x122)][_0x595428(0x153)]+'@'+(_0x3959ca['isGroup']?'g.us':_0x595428(0x121)),{'text':_0x2a407d});await(0x0,wbotMessageListener_1[_0x595428(0x117)])(_0x10f048,_0x3959ca,_0x3959ca[_0x595428(0x122)]);}}}}}if(_0x253d0c!==_0x1f291d&&_0x431011===_0x9f567b&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x253d0c)&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x1f291d))await(0x0,CreateLogTicketService_1[_0x595428(0x103)])({'userId':_0x253d0c,'queueId':_0x431011,'ticketId':_0x380e10,'type':_0x595428(0x111)});else{if(_0x253d0c!==_0x1f291d&&_0x431011===_0x9f567b&&!(0x0,lodash_1['isNil'])(_0x253d0c)&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x1f291d))await(0x0,CreateLogTicketService_1[_0x595428(0x103)])({'userId':_0x253d0c,'queueId':_0x431011,'ticketId':_0x380e10,'type':_0x595428(0x111)}),await(0x0,CreateLogTicketService_1[_0x595428(0x103)])({'userId':_0x1f291d,'queueId':_0x431011,'ticketId':_0x380e10,'type':_0x595428(0x12a)});else{if(_0x253d0c!==_0x1f291d&&_0x431011!==_0x9f567b&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x253d0c)&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x1f291d))await(0x0,CreateLogTicketService_1[_0x595428(0x103)])({'userId':_0x253d0c,'queueId':_0x431011,'ticketId':_0x380e10,'type':'transfered'}),await(0x0,CreateLogTicketService_1[_0x595428(0x103)])({'userId':_0x1f291d,'queueId':_0x9f567b,'ticketId':_0x380e10,'type':_0x595428(0x12a)});else _0x253d0c!==undefined&&(0x0,lodash_1['isNil'])(_0x1f291d)&&_0x431011!==_0x9f567b&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x9f567b)&&await(0x0,CreateLogTicketService_1[_0x595428(0x103)])({'userId':_0x253d0c,'queueId':_0x431011,'ticketId':_0x380e10,'type':'transfered'});}}return await _0x3959ca[_0x595428(0x11c)]({'status':_0x345003,'queueId':_0x9f567b,'userId':_0x1f291d,'isBot':_0x26520b,'queueOptionId':_0x3ffc17,'amountUsedBotQueues':_0x345003===_0x595428(0x106)?0x0:_0xff2eec?_0xff2eec:_0x3959ca[_0x595428(0x143)],'lastMessage':_0x4bfa4b?_0x4bfa4b:_0x3959ca[_0x595428(0x149)],'useIntegration':_0x64f20c,'integrationId':_0x2076fc,'unreadMessages':_0x5490c2}),_0x390207[_0x595428(0x135)]=(0x0,moment_1[_0x595428(0x103)])()[_0x595428(0x150)](),_0x390207[_0x595428(0x132)]=_0x9f567b,await _0x3959ca[_0x595428(0x110)](),_0x345003!==undefined&&[_0x595428(0x146)]['indexOf'](_0x345003)>-0x1&&!(0x0,lodash_1[_0x595428(0x11b)])(_0x253d0c)&&(await(0x0,CreateLogTicketService_1[_0x595428(0x103)])({'userId':_0x253d0c,'ticketId':_0x380e10,'type':_0x595428(0x146)}),_0x390207[_0x595428(0x11c)]({'whatsappId':_0x3959ca[_0x595428(0x139)],'startedAt':null,'userId':null})),_0x345003!==undefined&&_0x345003!==_0x9aafce&&['open']['indexOf'](_0x345003)>-0x1&&(_0x390207[_0x595428(0x11c)]({'startedAt':(0x0,moment_1[_0x595428(0x103)])()['toDate'](),'ratingAt':null,'rated':![],'whatsappId':_0x3959ca[_0x595428(0x139)],'userId':_0x3959ca[_0x595428(0x15c)],'queueId':_0x3959ca[_0x595428(0x132)]}),await(0x0,CreateLogTicketService_1[_0x595428(0x103)])({'userId':_0x1f291d,'queueId':_0x3959ca['queueId'],'ticketId':_0x380e10,'type':_0x9aafce===_0x595428(0x146)?_0x595428(0x144):_0x595428(0x163)})),await _0x390207[_0x595428(0x127)](),(_0x3959ca['status']!==_0x9aafce||_0x3959ca[_0x595428(0x11f)]?.['id']!==_0x253d0c)&&(_0x390207[_0x595428(0x11c)]({'userId':_0x3959ca[_0x595428(0x15c)]}),_0x4adeb9['to'](_0x9aafce)[_0x595428(0x10c)](_0x595428(0x129)+_0x2d105b+'-ticket',{'action':_0x595428(0x14e),'ticketId':_0x3959ca['id']})),_0x4adeb9['to'](_0x3959ca[_0x595428(0x148)])['to'](_0x595428(0x13d))['to'](_0x380e10[_0x595428(0x165)]())[_0x595428(0x10c)](_0x595428(0x129)+_0x2d105b+_0x595428(0xff),{'action':_0x595428(0x11c),'ticket':_0x3959ca}),{'ticket':_0x3959ca,'oldStatus':_0x9aafce,'oldUserId':_0x253d0c};}catch(_0x5def4c){Sentry['captureException'](_0x5def4c);}};exports[a589_0x251a4f(0x103)]=UpdateTicketService;