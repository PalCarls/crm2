'use strict';const a521_0x208a1e=a521_0x535e;(function(_0x7dcabd,_0x45314c){const _0x5ad7f5=a521_0x535e,_0x4cd073=_0x7dcabd();while(!![]){try{const _0x805fd8=-parseInt(_0x5ad7f5(0xb1))/0x1*(-parseInt(_0x5ad7f5(0xb6))/0x2)+-parseInt(_0x5ad7f5(0x99))/0x3*(-parseInt(_0x5ad7f5(0x9a))/0x4)+-parseInt(_0x5ad7f5(0x82))/0x5*(parseInt(_0x5ad7f5(0xbf))/0x6)+-parseInt(_0x5ad7f5(0xab))/0x7+parseInt(_0x5ad7f5(0xac))/0x8*(parseInt(_0x5ad7f5(0xb7))/0x9)+-parseInt(_0x5ad7f5(0x85))/0xa+parseInt(_0x5ad7f5(0x94))/0xb*(parseInt(_0x5ad7f5(0xaf))/0xc);if(_0x805fd8===_0x45314c)break;else _0x4cd073['push'](_0x4cd073['shift']());}catch(_0x5e7646){_0x4cd073['push'](_0x4cd073['shift']());}}}(a521_0x4d2f,0xcaa07));function a521_0x535e(_0x258cc2,_0x9b4662){const _0x4d2f78=a521_0x4d2f();return a521_0x535e=function(_0x535e40,_0x1ba020){_0x535e40=_0x535e40-0x80;let _0x2e8143=_0x4d2f78[_0x535e40];return _0x2e8143;},a521_0x535e(_0x258cc2,_0x9b4662);}var __importDefault=this&&this[a521_0x208a1e(0xa0)]||function(_0x4799db){const _0x2a3432=a521_0x208a1e;return _0x4799db&&_0x4799db[_0x2a3432(0xaa)]?_0x4799db:{'default':_0x4799db};};Object[a521_0x208a1e(0x9d)](exports,a521_0x208a1e(0xaa),{'value':!![]});const sequelize_1=require('sequelize'),Ticket_1=__importDefault(require(a521_0x208a1e(0xa6))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a521_0x208a1e(0x83))),Queue_1=__importDefault(require(a521_0x208a1e(0xba))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require(a521_0x208a1e(0xbb))),Tag_1=__importDefault(require('../../models/Tag')),lodash_1=require(a521_0x208a1e(0x8e)),Whatsapp_1=__importDefault(require(a521_0x208a1e(0x90))),ContactTag_1=__importDefault(require(a521_0x208a1e(0x80))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0xae2fe,tags:_0x5b7c06,users:_0x2a67bb,status:_0x53ebc7,date:_0x5e75b5,dateStart:_0x305579,dateEnd:_0x2f6fd4,updatedAt:_0x58c55d,showAll:_0x1ec217,userId:_0x1a0806,withUnreadMessages:_0x64b484,whatsappIds:_0x5594c1,statusFilters:_0x365be7,companyId:_0x576eaa})=>{const _0x47dabb=a521_0x208a1e;let _0x1e2e23={'status':_0x47dabb(0xad)},_0x203563;_0x203563=[{'model':Contact_1['default'],'as':'contact','include':[_0x47dabb(0x9b),_0x47dabb(0x91),_0x47dabb(0x86)]},{'model':Queue_1['default'],'as':_0x47dabb(0xb4),'attributes':['id',_0x47dabb(0x8d),_0x47dabb(0xa4)]},{'model':User_1[_0x47dabb(0x8c)],'as':'user','attributes':['id',_0x47dabb(0x8d)]},{'model':Tag_1[_0x47dabb(0x8c)],'as':_0x47dabb(0x86),'attributes':['id','name','color']},{'model':Whatsapp_1['default'],'as':_0x47dabb(0x93),'attributes':[_0x47dabb(0x8d),_0x47dabb(0x88)]}];const _0x501836=await(0x0,ShowUserService_1[_0x47dabb(0x8c)])(_0x1a0806);_0x53ebc7===_0x47dabb(0x96)&&(_0x1e2e23={..._0x1e2e23,'userId':_0x1a0806,'queueId':{[sequelize_1['Op']['in']]:_0xae2fe}});_0x53ebc7===_0x47dabb(0xb3)&&(_0x501836['allowGroup']||_0x1ec217==='true')&&(_0x1e2e23={..._0x1e2e23,'queueId':{[sequelize_1['Op']['or']]:[_0xae2fe,null]}});if(_0x501836[_0x47dabb(0xa3)]===_0x47dabb(0x87)&&_0x53ebc7==='pending'&&_0x501836[_0x47dabb(0xbc)]==='enable'){const _0x86d505=[],_0x3ee658=await Ticket_1[_0x47dabb(0x8c)][_0x47dabb(0xa7)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x501836['id'],null]},'queueId':{[sequelize_1['Op']['or']]:[_0xae2fe,null]},'status':_0x47dabb(0xad)}});_0x3ee658&&_0x86d505[_0x47dabb(0xb2)](_0x3ee658[_0x47dabb(0x92)](_0x5e79a3=>_0x5e79a3['id']));const _0x1b0d6d=(0x0,lodash_1[_0x47dabb(0xa2)])(..._0x86d505);_0x1e2e23={..._0x1e2e23,'id':{[sequelize_1['Op']['in']]:_0x1b0d6d}};}if(_0x501836[_0x47dabb(0xa3)]===_0x47dabb(0x87)&&_0x53ebc7===_0x47dabb(0xad)&&_0x501836[_0x47dabb(0xbc)]===_0x47dabb(0xa9)){const _0x178023=[],_0x5671d9=await Ticket_1[_0x47dabb(0x8c)][_0x47dabb(0xa7)]({'where':{[sequelize_1['Op']['or']]:[{'userId':{[sequelize_1['Op']['or']]:[_0x501836['id'],null]}},{'status':{[sequelize_1['Op']['or']]:[_0x47dabb(0xad),_0x47dabb(0x8a)]}}],'queueId':{[sequelize_1['Op']['in']]:_0xae2fe},'status':'pending'}});_0x5671d9&&_0x178023['push'](_0x5671d9['map'](_0x78bc05=>_0x78bc05['id']));const _0x4e2897=(0x0,lodash_1[_0x47dabb(0xa2)])(..._0x178023);_0x1e2e23={..._0x1e2e23,'id':{[sequelize_1['Op']['in']]:_0x4e2897}};}_0x1ec217===_0x47dabb(0x84)&&_0x501836[_0x47dabb(0xa3)]===_0x47dabb(0xb5)&&(_0x1e2e23={'queueId':{[sequelize_1['Op']['or']]:[_0xae2fe,null]}});_0x53ebc7&&_0x53ebc7!==_0x47dabb(0x9f)&&(_0x1e2e23={..._0x1e2e23,'status':_0x53ebc7});if(_0x53ebc7==='closed'){const _0x2852db=[],_0x3561bb=await Ticket_1['default']['findAll']({'where':{'queueId':_0x1ec217===_0x47dabb(0x84)||_0x501836[_0x47dabb(0xbc)]===_0x47dabb(0x89)?{[sequelize_1['Op']['or']]:[_0xae2fe,null]}:_0xae2fe,'status':_0x47dabb(0x8a)},'group':['companyId',_0x47dabb(0x9c),_0x47dabb(0xbd)],'attributes':['companyId',_0x47dabb(0x9c),_0x47dabb(0xbd),[sequelize_1[_0x47dabb(0x81)]['fn'](_0x47dabb(0x8b),sequelize_1['Sequelize'][_0x47dabb(0x97)]('id')),'id']]});_0x3561bb&&_0x2852db[_0x47dabb(0xb2)](_0x3561bb['map'](_0x5240a4=>_0x5240a4['id']));const _0x50daf2=(0x0,lodash_1[_0x47dabb(0xa2)])(..._0x2852db);_0x1e2e23={..._0x1e2e23,'id':{[sequelize_1['Op']['in']]:_0x50daf2}};}if(_0x53ebc7===_0x47dabb(0x9f)){_0x1e2e23={'companyId':_0x576eaa};_0x501836[_0x47dabb(0xa3)]===_0x47dabb(0x87)&&(_0x1e2e23={..._0x1e2e23,'queueId':{[sequelize_1['Op']['in']]:_0xae2fe}});_0x64b484===_0x47dabb(0x84)&&(_0x1e2e23={..._0x1e2e23,[sequelize_1['Op']['or']]:[{'userId':_0x1a0806},{'status':_0x47dabb(0xad)}],'queueId':{[sequelize_1['Op']['or']]:[_0xae2fe,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}});if(searchParam){const _0x2c4274=searchParam[_0x47dabb(0x9e)]()[_0x47dabb(0xb8)]();_0x203563=[..._0x203563,{'model':Message_1[_0x47dabb(0x8c)],'as':_0x47dabb(0x95),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x47dabb(0xb0)])((0x0,sequelize_1['fn'])(_0x47dabb(0x8f),(0x0,sequelize_1[_0x47dabb(0x97)])(_0x47dabb(0xb9))),'LIKE','%'+_0x2c4274+'%')},'required':![],'duplicating':![]}],_0x1e2e23={..._0x1e2e23,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x47dabb(0xb0)])((0x0,sequelize_1['fn'])(_0x47dabb(0x8f),(0x0,sequelize_1[_0x47dabb(0x97)])('contact.name')),_0x47dabb(0x98),'%'+_0x2c4274+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x47dabb(0xa5)]]:'%'+_0x2c4274+'%'}},{'$message.body$':(0x0,sequelize_1[_0x47dabb(0xb0)])((0x0,sequelize_1['fn'])(_0x47dabb(0x8f),(0x0,sequelize_1['col'])('body')),_0x47dabb(0x98),'%'+_0x2c4274+'%')}]};}if(Array['isArray'](_0x5b7c06)&&_0x5b7c06[_0x47dabb(0xa1)]>0x0){const _0x5a005a=[],_0x323d8f=await ContactTag_1[_0x47dabb(0x8c)][_0x47dabb(0xa7)]({'where':{'tagId':{[sequelize_1['Op']['in']]:_0x5b7c06}}});_0x323d8f&&_0x5a005a['push'](_0x323d8f[_0x47dabb(0x92)](_0x1b072d=>_0x1b072d[_0x47dabb(0x9c)]));const _0x2ff9e1=(0x0,lodash_1[_0x47dabb(0xa2)])(..._0x5a005a);_0x1e2e23={..._0x1e2e23,'contactId':{[sequelize_1['Op']['in']]:_0x2ff9e1}};}Array[_0x47dabb(0xae)](_0x2a67bb)&&_0x2a67bb['length']>0x0&&(_0x1e2e23={..._0x1e2e23,'userId':{[sequelize_1['Op']['in']]:_0x2a67bb}}),Array[_0x47dabb(0xae)](_0x5594c1)&&_0x5594c1[_0x47dabb(0xa1)]>0x0&&(_0x1e2e23={..._0x1e2e23,'whatsappId':{[sequelize_1['Op']['in']]:_0x5594c1}}),Array[_0x47dabb(0xae)](_0x365be7)&&_0x365be7[_0x47dabb(0xa1)]>0x0&&(_0x1e2e23={..._0x1e2e23,'status':{[sequelize_1['Op']['in']]:_0x365be7}});}const _0x430572=0x28,_0x42eef7=_0x430572*(+pageNumber-0x1);_0x1e2e23={..._0x1e2e23,'companyId':_0x576eaa};const {count:_0x10fdff,rows:_0x533fd6}=await Ticket_1[_0x47dabb(0x8c)]['findAndCountAll']({'where':_0x1e2e23,'include':_0x203563,'distinct':!![],'limit':_0x430572,'offset':_0x42eef7,'order':[[_0x47dabb(0xbe),_0x47dabb(0xa8)]],'subQuery':![]}),_0x3547cc=_0x10fdff>_0x42eef7+_0x533fd6[_0x47dabb(0xa1)];return{'tickets':_0x533fd6,'count':_0x10fdff,'hasMore':_0x3547cc};};function a521_0x4d2f(){const _0x4449d4=['admin','943546USoFsU','9VHtVdF','trim','body','../../models/Queue','../UserServices/ShowUserService','allTicket','whatsappId','updatedAt','861834aAoXNC','../../models/ContactTag','Sequelize','20CyMvhr','../../models/Message','true','11462630ssMKNj','tags','user','expiresTicket','enable','closed','max','default','name','lodash','LOWER','../../models/Whatsapp','contactTags','map','whatsapp','1595748xgfiXH','messages','open','col','LIKE','99HyiCbL','188260axLZKS','extraInfo','contactId','defineProperty','toLocaleLowerCase','search','__importDefault','length','intersection','profile','color','like','../../models/Ticket','findAll','DESC','disable','__esModule','928529JMSLOm','2946968AmRjAP','pending','isArray','24UtBRxV','where','1VxmPGv','push','group','queue'];a521_0x4d2f=function(){return _0x4449d4;};return a521_0x4d2f();}exports[a521_0x208a1e(0x8c)]=ListTicketsService;