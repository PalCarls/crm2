'use strict';const a521_0x33086f=a521_0x72c5;function a521_0x72c5(_0x48ec8f,_0x52e94b){const _0x4f2f48=a521_0x4f2f();return a521_0x72c5=function(_0x72c594,_0x54d0e){_0x72c594=_0x72c594-0x1ee;let _0x212235=_0x4f2f48[_0x72c594];return _0x212235;},a521_0x72c5(_0x48ec8f,_0x52e94b);}(function(_0x5e9dc5,_0x5a1556){const _0x2f6249=a521_0x72c5,_0x3966d9=_0x5e9dc5();while(!![]){try{const _0x1d6f83=parseInt(_0x2f6249(0x1fe))/0x1*(-parseInt(_0x2f6249(0x1f3))/0x2)+-parseInt(_0x2f6249(0x207))/0x3+parseInt(_0x2f6249(0x1f8))/0x4*(parseInt(_0x2f6249(0x20a))/0x5)+parseInt(_0x2f6249(0x210))/0x6+parseInt(_0x2f6249(0x20b))/0x7+-parseInt(_0x2f6249(0x1fd))/0x8+-parseInt(_0x2f6249(0x211))/0x9*(-parseInt(_0x2f6249(0x1f5))/0xa);if(_0x1d6f83===_0x5a1556)break;else _0x3966d9['push'](_0x3966d9['shift']());}catch(_0x44b90b){_0x3966d9['push'](_0x3966d9['shift']());}}}(a521_0x4f2f,0xd5cc6));var __importDefault=this&&this[a521_0x33086f(0x21d)]||function(_0x4ec357){const _0x3b5f17=a521_0x33086f;return _0x4ec357&&_0x4ec357[_0x3b5f17(0x21b)]?_0x4ec357:{'default':_0x4ec357};};function a521_0x4f2f(){const _0x32ad61=['profile','7353704WCkCNi','634hsZCIo','like','companyId','name','body','true','../../models/ContactTag','../../models/Queue','whatsappId','1461417FiZOKj','queue','findAll','15ECvUVt','574679WKOjlN','default','../../models/Contact','../../models/User','contact.name','3036432zeoBYC','9269892PbRYMf','admin','contactId','enable','LIKE','extraInfo','intersection','DESC','../../models/Whatsapp','group','__esModule','col','__importDefault','LOWER','expiresTicket','defineProperty','../UserServices/ShowUserService','max','contact','color','search','../../models/Tag','length','user','where','sequelize','isArray','contactTags','pending','push','../../models/Message','1438grmZCG','allowGroup','10ieXWwS','closed','map','1493012wGnmbE','tags','allTicket','whatsapp'];a521_0x4f2f=function(){return _0x32ad61;};return a521_0x4f2f();}Object[a521_0x33086f(0x220)](exports,a521_0x33086f(0x21b),{'value':!![]});const sequelize_1=require(a521_0x33086f(0x22a)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a521_0x33086f(0x20d))),Message_1=__importDefault(require(a521_0x33086f(0x1f2))),Queue_1=__importDefault(require(a521_0x33086f(0x205))),User_1=__importDefault(require(a521_0x33086f(0x20e))),ShowUserService_1=__importDefault(require(a521_0x33086f(0x221))),Tag_1=__importDefault(require(a521_0x33086f(0x226))),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require(a521_0x33086f(0x219))),ContactTag_1=__importDefault(require(a521_0x33086f(0x204))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x54de0f,tags:_0x4c3121,users:_0x4616b3,status:_0x161ab9,date:_0x29b4d7,dateStart:_0x36a93a,dateEnd:_0x533208,updatedAt:_0x1c871e,showAll:_0x73dd9c,userId:_0xb47354,withUnreadMessages:_0x3e53d6,whatsappIds:_0x34dc22,statusFilters:_0xf6e21f,companyId:_0x4b176f})=>{const _0x2a64f1=a521_0x33086f;let _0x1cd11e={'status':_0x2a64f1(0x1f0)},_0xe236dd;_0xe236dd=[{'model':Contact_1[_0x2a64f1(0x20c)],'as':_0x2a64f1(0x223),'include':[_0x2a64f1(0x216),_0x2a64f1(0x1ef),_0x2a64f1(0x1f9)]},{'model':Queue_1['default'],'as':_0x2a64f1(0x208),'attributes':['id',_0x2a64f1(0x201),'color']},{'model':User_1[_0x2a64f1(0x20c)],'as':_0x2a64f1(0x228),'attributes':['id',_0x2a64f1(0x201)]},{'model':Tag_1[_0x2a64f1(0x20c)],'as':'tags','attributes':['id',_0x2a64f1(0x201),_0x2a64f1(0x224)]},{'model':Whatsapp_1[_0x2a64f1(0x20c)],'as':_0x2a64f1(0x1fb),'attributes':['name',_0x2a64f1(0x21f)]}];const _0x12d752=await(0x0,ShowUserService_1[_0x2a64f1(0x20c)])(_0xb47354);_0x161ab9==='open'&&(_0x1cd11e={..._0x1cd11e,'userId':_0xb47354,'queueId':{[sequelize_1['Op']['in']]:_0x54de0f}});_0x161ab9===_0x2a64f1(0x21a)&&(_0x12d752[_0x2a64f1(0x1f4)]||_0x73dd9c===_0x2a64f1(0x203))&&(_0x1cd11e={..._0x1cd11e,'queueId':{[sequelize_1['Op']['or']]:[_0x54de0f,null]}});if(_0x12d752[_0x2a64f1(0x1fc)]===_0x2a64f1(0x228)&&_0x161ab9===_0x2a64f1(0x1f0)&&_0x12d752[_0x2a64f1(0x1fa)]===_0x2a64f1(0x214)){const _0x1a0dc7=[],_0x38719b=await Ticket_1[_0x2a64f1(0x20c)]['findAll']({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x12d752['id'],null]},'queueId':{[sequelize_1['Op']['or']]:[_0x54de0f,null]},'status':_0x2a64f1(0x1f0)}});_0x38719b&&_0x1a0dc7[_0x2a64f1(0x1f1)](_0x38719b[_0x2a64f1(0x1f7)](_0x47b962=>_0x47b962['id']));const _0x390344=(0x0,lodash_1['intersection'])(..._0x1a0dc7);_0x1cd11e={..._0x1cd11e,'id':{[sequelize_1['Op']['in']]:_0x390344}};}if(_0x12d752[_0x2a64f1(0x1fc)]===_0x2a64f1(0x228)&&_0x161ab9==='pending'&&_0x12d752[_0x2a64f1(0x1fa)]==='disable'){const _0x192e87=[],_0x26404e=await Ticket_1['default'][_0x2a64f1(0x209)]({'where':{[sequelize_1['Op']['or']]:[{'userId':{[sequelize_1['Op']['or']]:[_0x12d752['id'],null]}},{'status':{[sequelize_1['Op']['or']]:['pending',_0x2a64f1(0x1f6)]}}],'queueId':{[sequelize_1['Op']['in']]:_0x54de0f},'status':_0x2a64f1(0x1f0)}});_0x26404e&&_0x192e87[_0x2a64f1(0x1f1)](_0x26404e[_0x2a64f1(0x1f7)](_0x407aba=>_0x407aba['id']));const _0x255aed=(0x0,lodash_1[_0x2a64f1(0x217)])(..._0x192e87);_0x1cd11e={..._0x1cd11e,'id':{[sequelize_1['Op']['in']]:_0x255aed}};}_0x73dd9c===_0x2a64f1(0x203)&&_0x12d752[_0x2a64f1(0x1fc)]===_0x2a64f1(0x212)&&(_0x1cd11e={'queueId':{[sequelize_1['Op']['or']]:[_0x54de0f,null]}});_0x161ab9&&_0x161ab9!==_0x2a64f1(0x225)&&(_0x1cd11e={..._0x1cd11e,'status':_0x161ab9});if(_0x161ab9===_0x2a64f1(0x1f6)){const _0x584690=[],_0x30653e=await Ticket_1[_0x2a64f1(0x20c)][_0x2a64f1(0x209)]({'where':{'queueId':_0x73dd9c===_0x2a64f1(0x203)||_0x12d752[_0x2a64f1(0x1fa)]===_0x2a64f1(0x214)?{[sequelize_1['Op']['or']]:[_0x54de0f,null]}:_0x54de0f,'status':_0x2a64f1(0x1f6)},'group':[_0x2a64f1(0x200),'contactId','whatsappId'],'attributes':['companyId','contactId',_0x2a64f1(0x206),[sequelize_1['Sequelize']['fn'](_0x2a64f1(0x222),sequelize_1['Sequelize']['col']('id')),'id']]});_0x30653e&&_0x584690[_0x2a64f1(0x1f1)](_0x30653e[_0x2a64f1(0x1f7)](_0x36aee=>_0x36aee['id']));const _0x17ff66=(0x0,lodash_1[_0x2a64f1(0x217)])(..._0x584690);_0x1cd11e={..._0x1cd11e,'id':{[sequelize_1['Op']['in']]:_0x17ff66}};}if(_0x161ab9===_0x2a64f1(0x225)){_0x1cd11e={'companyId':_0x4b176f};_0x12d752[_0x2a64f1(0x1fc)]==='user'&&(_0x1cd11e={..._0x1cd11e,'queueId':{[sequelize_1['Op']['in']]:_0x54de0f}});_0x3e53d6==='true'&&(_0x1cd11e={..._0x1cd11e,[sequelize_1['Op']['or']]:[{'userId':_0xb47354},{'status':_0x2a64f1(0x1f0)}],'queueId':{[sequelize_1['Op']['or']]:[_0x54de0f,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}});if(searchParam){const _0x87b0d3=searchParam['toLocaleLowerCase']()['trim']();_0xe236dd=[..._0xe236dd,{'model':Message_1[_0x2a64f1(0x20c)],'as':'messages','attributes':['id',_0x2a64f1(0x202)],'where':{'body':(0x0,sequelize_1[_0x2a64f1(0x229)])((0x0,sequelize_1['fn'])(_0x2a64f1(0x21e),(0x0,sequelize_1[_0x2a64f1(0x21c)])(_0x2a64f1(0x202))),_0x2a64f1(0x215),'%'+_0x87b0d3+'%')},'required':![],'duplicating':![]}],_0x1cd11e={..._0x1cd11e,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x2a64f1(0x229)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['col'])(_0x2a64f1(0x20f))),_0x2a64f1(0x215),'%'+_0x87b0d3+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x2a64f1(0x1ff)]]:'%'+_0x87b0d3+'%'}},{'$message.body$':(0x0,sequelize_1[_0x2a64f1(0x229)])((0x0,sequelize_1['fn'])(_0x2a64f1(0x21e),(0x0,sequelize_1[_0x2a64f1(0x21c)])('body')),_0x2a64f1(0x215),'%'+_0x87b0d3+'%')}]};}if(Array['isArray'](_0x4c3121)&&_0x4c3121[_0x2a64f1(0x227)]>0x0){const _0x5c8593=[],_0x239c85=await ContactTag_1[_0x2a64f1(0x20c)][_0x2a64f1(0x209)]({'where':{'tagId':{[sequelize_1['Op']['in']]:_0x4c3121}}});_0x239c85&&_0x5c8593[_0x2a64f1(0x1f1)](_0x239c85[_0x2a64f1(0x1f7)](_0x33cd72=>_0x33cd72[_0x2a64f1(0x213)]));const _0x291516=(0x0,lodash_1[_0x2a64f1(0x217)])(..._0x5c8593);_0x1cd11e={..._0x1cd11e,'contactId':{[sequelize_1['Op']['in']]:_0x291516}};}Array[_0x2a64f1(0x1ee)](_0x4616b3)&&_0x4616b3[_0x2a64f1(0x227)]>0x0&&(_0x1cd11e={..._0x1cd11e,'userId':{[sequelize_1['Op']['in']]:_0x4616b3}}),Array['isArray'](_0x34dc22)&&_0x34dc22[_0x2a64f1(0x227)]>0x0&&(_0x1cd11e={..._0x1cd11e,'whatsappId':{[sequelize_1['Op']['in']]:_0x34dc22}}),Array[_0x2a64f1(0x1ee)](_0xf6e21f)&&_0xf6e21f[_0x2a64f1(0x227)]>0x0&&(_0x1cd11e={..._0x1cd11e,'status':{[sequelize_1['Op']['in']]:_0xf6e21f}});}const _0xc901e=0x28,_0x21ba37=_0xc901e*(+pageNumber-0x1);_0x1cd11e={..._0x1cd11e,'companyId':_0x4b176f};const {count:_0xd61d54,rows:_0x15205d}=await Ticket_1[_0x2a64f1(0x20c)]['findAndCountAll']({'where':_0x1cd11e,'include':_0xe236dd,'distinct':!![],'limit':_0xc901e,'offset':_0x21ba37,'order':[['updatedAt',_0x2a64f1(0x218)]],'subQuery':![]}),_0x553b96=_0xd61d54>_0x21ba37+_0x15205d[_0x2a64f1(0x227)];return{'tickets':_0x15205d,'count':_0xd61d54,'hasMore':_0x553b96};};exports[a521_0x33086f(0x20c)]=ListTicketsService;