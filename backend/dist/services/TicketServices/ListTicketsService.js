'use strict';function a522_0x42e7(_0x2d3487,_0x409f80){const _0x28c96a=a522_0x28c9();return a522_0x42e7=function(_0x42e794,_0x5500a8){_0x42e794=_0x42e794-0x175;let _0xdd4ac6=_0x28c96a[_0x42e794];return _0xdd4ac6;},a522_0x42e7(_0x2d3487,_0x409f80);}const a522_0x5aa4ad=a522_0x42e7;(function(_0x5a3a11,_0x1a455b){const _0x4a8c5f=a522_0x42e7,_0x14aa28=_0x5a3a11();while(!![]){try{const _0x17d859=-parseInt(_0x4a8c5f(0x196))/0x1+parseInt(_0x4a8c5f(0x19d))/0x2+-parseInt(_0x4a8c5f(0x17a))/0x3+parseInt(_0x4a8c5f(0x18b))/0x4+parseInt(_0x4a8c5f(0x186))/0x5+parseInt(_0x4a8c5f(0x17c))/0x6+-parseInt(_0x4a8c5f(0x189))/0x7*(parseInt(_0x4a8c5f(0x1a0))/0x8);if(_0x17d859===_0x1a455b)break;else _0x14aa28['push'](_0x14aa28['shift']());}catch(_0x2fb24b){_0x14aa28['push'](_0x14aa28['shift']());}}}(a522_0x28c9,0xc446e));var __importDefault=this&&this[a522_0x5aa4ad(0x1a9)]||function(_0x1900ac){const _0x7aa851=a522_0x5aa4ad;return _0x1900ac&&_0x1900ac[_0x7aa851(0x175)]?_0x1900ac:{'default':_0x1900ac};};Object['defineProperty'](exports,a522_0x5aa4ad(0x175),{'value':!![]});const sequelize_1=require('sequelize'),Ticket_1=__importDefault(require(a522_0x5aa4ad(0x18d))),Contact_1=__importDefault(require(a522_0x5aa4ad(0x1a2))),Message_1=__importDefault(require(a522_0x5aa4ad(0x182))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a522_0x5aa4ad(0x17e))),ShowUserService_1=__importDefault(require(a522_0x5aa4ad(0x1b2))),Tag_1=__importDefault(require('../../models/Tag')),lodash_1=require(a522_0x5aa4ad(0x1b1)),Whatsapp_1=__importDefault(require(a522_0x5aa4ad(0x18e))),ContactTag_1=__importDefault(require(a522_0x5aa4ad(0x17d))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0xbd5c87,tags:_0x15d88c,users:_0x28f310,status:_0x301c7f,date:_0xcb7b61,dateStart:_0x98eea4,dateEnd:_0x1900c1,updatedAt:_0x2e550f,showAll:_0xf3a6e0,userId:_0x5f4431,withUnreadMessages:_0x59abaa,whatsappIds:_0x14da18,statusFilters:_0x157be1,companyId:_0x2c3c91})=>{const _0x4ee700=a522_0x5aa4ad;let _0x5e7293={'status':_0x4ee700(0x176)},_0x1533cd;_0x1533cd=[{'model':Contact_1[_0x4ee700(0x180)],'as':_0x4ee700(0x1af),'include':[_0x4ee700(0x1a5),_0x4ee700(0x198),_0x4ee700(0x193)]},{'model':Queue_1['default'],'as':_0x4ee700(0x18c),'attributes':['id',_0x4ee700(0x185),_0x4ee700(0x183)]},{'model':User_1[_0x4ee700(0x180)],'as':_0x4ee700(0x1ad),'attributes':['id',_0x4ee700(0x185)]},{'model':Tag_1['default'],'as':_0x4ee700(0x193),'attributes':['id',_0x4ee700(0x185),_0x4ee700(0x183)]},{'model':Whatsapp_1[_0x4ee700(0x180)],'as':_0x4ee700(0x184),'attributes':['name','expiresTicket']}];const _0x4d4e13=await(0x0,ShowUserService_1[_0x4ee700(0x180)])(_0x5f4431);_0x301c7f===_0x4ee700(0x19c)&&(_0x5e7293={..._0x5e7293,'userId':_0x5f4431,'queueId':{[sequelize_1['Op']['in']]:_0xbd5c87}});_0x301c7f===_0x4ee700(0x19b)&&(_0x4d4e13[_0x4ee700(0x188)]||_0xf3a6e0==='true')&&(_0x5e7293={..._0x5e7293,'queueId':{[sequelize_1['Op']['or']]:[_0xbd5c87,null]}});if(_0x4d4e13[_0x4ee700(0x181)]==='user'&&_0x301c7f===_0x4ee700(0x176)&&_0x4d4e13['allTicket']===_0x4ee700(0x199)){const _0x2e67a7=[],_0x4514fd=await Ticket_1[_0x4ee700(0x180)]['findAll']({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x4d4e13['id'],null]},'queueId':{[sequelize_1['Op']['or']]:[_0xbd5c87,null]},'status':_0x4ee700(0x176)}});_0x4514fd&&_0x2e67a7[_0x4ee700(0x17f)](_0x4514fd[_0x4ee700(0x191)](_0x4f5018=>_0x4f5018['id']));const _0x3ab874=(0x0,lodash_1[_0x4ee700(0x19e)])(..._0x2e67a7);_0x5e7293={..._0x5e7293,'id':{[sequelize_1['Op']['in']]:_0x3ab874}};}if(_0x4d4e13[_0x4ee700(0x181)]===_0x4ee700(0x1ad)&&_0x301c7f==='pending'&&_0x4d4e13[_0x4ee700(0x1a8)]===_0x4ee700(0x192)){const _0x539802=[],_0x447890=await Ticket_1[_0x4ee700(0x180)][_0x4ee700(0x187)]({'where':{[sequelize_1['Op']['or']]:[{'userId':{[sequelize_1['Op']['or']]:[_0x4d4e13['id'],null]}},{'status':{[sequelize_1['Op']['or']]:[_0x4ee700(0x176),_0x4ee700(0x178)]}}],'queueId':{[sequelize_1['Op']['in']]:_0xbd5c87},'status':_0x4ee700(0x176)}});_0x447890&&_0x539802[_0x4ee700(0x17f)](_0x447890[_0x4ee700(0x191)](_0x87a2b=>_0x87a2b['id']));const _0xa41b43=(0x0,lodash_1[_0x4ee700(0x19e)])(..._0x539802);_0x5e7293={..._0x5e7293,'id':{[sequelize_1['Op']['in']]:_0xa41b43}};}_0xf3a6e0==='true'&&_0x4d4e13['profile']===_0x4ee700(0x195)&&(_0x5e7293={'queueId':{[sequelize_1['Op']['or']]:[_0xbd5c87,null]}});_0x301c7f&&_0x301c7f!=='search'&&(_0x5e7293={..._0x5e7293,'status':_0x301c7f});if(_0x301c7f===_0x4ee700(0x178)){const _0x137dce=[],_0x202629=await Ticket_1[_0x4ee700(0x180)][_0x4ee700(0x187)]({'where':{'queueId':_0xf3a6e0===_0x4ee700(0x1a7)||_0x4d4e13[_0x4ee700(0x1a8)]===_0x4ee700(0x199)?{[sequelize_1['Op']['or']]:[_0xbd5c87,null]}:_0xbd5c87,'status':_0x4ee700(0x178)},'group':['companyId',_0x4ee700(0x17b),_0x4ee700(0x1a1)],'attributes':[_0x4ee700(0x194),_0x4ee700(0x17b),_0x4ee700(0x1a1),[sequelize_1[_0x4ee700(0x1b0)]['fn']('max',sequelize_1['Sequelize']['col']('id')),'id']]});_0x202629&&_0x137dce['push'](_0x202629['map'](_0x53cb29=>_0x53cb29['id']));const _0x443a3f=(0x0,lodash_1[_0x4ee700(0x19e)])(..._0x137dce);_0x5e7293={..._0x5e7293,'id':{[sequelize_1['Op']['in']]:_0x443a3f}};}if(_0x301c7f===_0x4ee700(0x19a)){_0x5e7293={'companyId':_0x2c3c91};_0x4d4e13[_0x4ee700(0x181)]===_0x4ee700(0x1ad)&&(_0x5e7293={..._0x5e7293,'queueId':{[sequelize_1['Op']['in']]:_0xbd5c87}});_0x59abaa===_0x4ee700(0x1a7)&&(_0x5e7293={..._0x5e7293,[sequelize_1['Op']['or']]:[{'userId':_0x5f4431},{'status':_0x4ee700(0x176)}],'queueId':{[sequelize_1['Op']['or']]:[_0xbd5c87,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}});if(searchParam){const _0x113c1d=searchParam[_0x4ee700(0x18f)]()[_0x4ee700(0x1a4)]();_0x1533cd=[..._0x1533cd,{'model':Message_1['default'],'as':_0x4ee700(0x177),'attributes':['id',_0x4ee700(0x1ae)],'where':{'body':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x4ee700(0x179),(0x0,sequelize_1['col'])(_0x4ee700(0x1ae))),_0x4ee700(0x1a3),'%'+_0x113c1d+'%')},'required':![],'duplicating':![]}],_0x5e7293={..._0x5e7293,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x4ee700(0x1ab)])((0x0,sequelize_1['fn'])(_0x4ee700(0x179),(0x0,sequelize_1[_0x4ee700(0x197)])('contact.name')),_0x4ee700(0x1a3),'%'+_0x113c1d+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x4ee700(0x19f)]]:'%'+_0x113c1d+'%'}},{'$message.body$':(0x0,sequelize_1[_0x4ee700(0x1ab)])((0x0,sequelize_1['fn'])(_0x4ee700(0x179),(0x0,sequelize_1[_0x4ee700(0x197)])('body')),_0x4ee700(0x1a3),'%'+_0x113c1d+'%')}]};}if(Array['isArray'](_0x15d88c)&&_0x15d88c[_0x4ee700(0x1a6)]>0x0){const _0x46e445=[],_0x440cb6=await ContactTag_1[_0x4ee700(0x180)]['findAll']({'where':{'tagId':{[sequelize_1['Op']['in']]:_0x15d88c}}});_0x440cb6&&_0x46e445[_0x4ee700(0x17f)](_0x440cb6[_0x4ee700(0x191)](_0x9bda7a=>_0x9bda7a[_0x4ee700(0x17b)]));const _0x577844=(0x0,lodash_1[_0x4ee700(0x19e)])(..._0x46e445);_0x5e7293={..._0x5e7293,'contactId':{[sequelize_1['Op']['in']]:_0x577844}};}Array[_0x4ee700(0x190)](_0x28f310)&&_0x28f310[_0x4ee700(0x1a6)]>0x0&&(_0x5e7293={..._0x5e7293,'userId':{[sequelize_1['Op']['in']]:_0x28f310}}),Array[_0x4ee700(0x190)](_0x14da18)&&_0x14da18[_0x4ee700(0x1a6)]>0x0&&(_0x5e7293={..._0x5e7293,'whatsappId':{[sequelize_1['Op']['in']]:_0x14da18}}),Array[_0x4ee700(0x190)](_0x157be1)&&_0x157be1[_0x4ee700(0x1a6)]>0x0&&(_0x5e7293={..._0x5e7293,'status':{[sequelize_1['Op']['in']]:_0x157be1}});}const _0x33e6d9=0x28,_0x528e82=_0x33e6d9*(+pageNumber-0x1);_0x5e7293={..._0x5e7293,'companyId':_0x2c3c91};const {count:_0x4d2eb8,rows:_0x45d420}=await Ticket_1[_0x4ee700(0x180)][_0x4ee700(0x18a)]({'where':_0x5e7293,'include':_0x1533cd,'distinct':!![],'limit':_0x33e6d9,'offset':_0x528e82,'order':[[_0x4ee700(0x1ac),_0x4ee700(0x1aa)]],'subQuery':![]}),_0x583c3c=_0x4d2eb8>_0x528e82+_0x45d420[_0x4ee700(0x1a6)];return{'tickets':_0x45d420,'count':_0x4d2eb8,'hasMore':_0x583c3c};};exports[a522_0x5aa4ad(0x180)]=ListTicketsService;function a522_0x28c9(){const _0x3677be=['enable','search','group','open','863140doDQWq','intersection','like','1912oSkrvH','whatsappId','../../models/Contact','LIKE','trim','extraInfo','length','true','allTicket','__importDefault','DESC','where','updatedAt','user','body','contact','Sequelize','lodash','../UserServices/ShowUserService','__esModule','pending','messages','closed','LOWER','12351PKcRnR','contactId','4316298tZMhny','../../models/ContactTag','../../models/User','push','default','profile','../../models/Message','color','whatsapp','name','4326620rAcvDk','findAll','allowGroup','43729QrRqlR','findAndCountAll','5366416lkqpzP','queue','../../models/Ticket','../../models/Whatsapp','toLocaleLowerCase','isArray','map','disable','tags','companyId','admin','1056781rQwOQA','col','contactTags'];a522_0x28c9=function(){return _0x3677be;};return a522_0x28c9();}