'use strict';function a537_0x4975(_0x6a0792,_0x111830){const _0x54bbb1=a537_0x54bb();return a537_0x4975=function(_0x49754a,_0x5f24a0){_0x49754a=_0x49754a-0xdb;let _0x26e0a5=_0x54bbb1[_0x49754a];return _0x26e0a5;},a537_0x4975(_0x6a0792,_0x111830);}const a537_0x5bc79d=a537_0x4975;(function(_0x3d3d29,_0x627640){const _0x41d35c=a537_0x4975,_0x48ce0f=_0x3d3d29();while(!![]){try{const _0x5e08f2=parseInt(_0x41d35c(0xf4))/0x1*(-parseInt(_0x41d35c(0xf1))/0x2)+parseInt(_0x41d35c(0xf9))/0x3+parseInt(_0x41d35c(0x10f))/0x4*(parseInt(_0x41d35c(0x102))/0x5)+parseInt(_0x41d35c(0xe5))/0x6+parseInt(_0x41d35c(0x112))/0x7*(-parseInt(_0x41d35c(0xea))/0x8)+-parseInt(_0x41d35c(0xf6))/0x9+-parseInt(_0x41d35c(0x121))/0xa*(-parseInt(_0x41d35c(0x11c))/0xb);if(_0x5e08f2===_0x627640)break;else _0x48ce0f['push'](_0x48ce0f['shift']());}catch(_0xfa1414){_0x48ce0f['push'](_0x48ce0f['shift']());}}}(a537_0x54bb,0x495ea));var __importDefault=this&&this[a537_0x5bc79d(0x111)]||function(_0x4d86e9){return _0x4d86e9&&_0x4d86e9['__esModule']?_0x4d86e9:{'default':_0x4d86e9};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const sequelize_1=require(a537_0x5bc79d(0xe6)),Ticket_1=__importDefault(require(a537_0x5bc79d(0x100))),Contact_1=__importDefault(require(a537_0x5bc79d(0x116))),Message_1=__importDefault(require(a537_0x5bc79d(0xfc))),Queue_1=__importDefault(require(a537_0x5bc79d(0x108))),User_1=__importDefault(require(a537_0x5bc79d(0xdb))),ShowUserService_1=__importDefault(require(a537_0x5bc79d(0xfb))),Tag_1=__importDefault(require(a537_0x5bc79d(0x11e))),lodash_1=require(a537_0x5bc79d(0xeb)),Whatsapp_1=__importDefault(require(a537_0x5bc79d(0x10d))),ContactTag_1=__importDefault(require(a537_0x5bc79d(0x10e))),remove_accents_1=__importDefault(require(a537_0x5bc79d(0x109))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x48428c,tags:_0x3bef81,users:_0x210a94,status:_0x4df16e,date:_0x2389f0,dateStart:_0x4ae6e5,dateEnd:_0x1baff1,updatedAt:_0x231c20,showAll:_0x3e2fa3,userId:_0xf4f428,withUnreadMessages:_0x2a1606,whatsappIds:_0x2f182e,statusFilters:_0x302c20,companyId:_0x5ae27e})=>{const _0x2011ab=a537_0x5bc79d;let _0x31cf89={'status':_0x2011ab(0x104)},_0x2d5c0e;_0x2d5c0e=[{'model':Contact_1[_0x2011ab(0x11b)],'as':'contact','attributes':['id',_0x2011ab(0xe9),_0x2011ab(0xe2),_0x2011ab(0x10c),_0x2011ab(0x107),_0x2011ab(0x103),'active',_0x2011ab(0x106),_0x2011ab(0x11f)],'include':[_0x2011ab(0xdf),'contactTags',_0x2011ab(0xe3)]},{'model':Queue_1['default'],'as':_0x2011ab(0xec),'attributes':['id',_0x2011ab(0xe9),_0x2011ab(0xfa)]},{'model':User_1[_0x2011ab(0x11b)],'as':_0x2011ab(0xf0),'attributes':['id',_0x2011ab(0xe9)]},{'model':Tag_1[_0x2011ab(0x11b)],'as':_0x2011ab(0xe3),'attributes':['id',_0x2011ab(0xe9),_0x2011ab(0xfa)]},{'model':Whatsapp_1[_0x2011ab(0x11b)],'as':'whatsapp','attributes':['id',_0x2011ab(0xe9),_0x2011ab(0x117)]}];const _0x37cc56=await(0x0,ShowUserService_1[_0x2011ab(0x11b)])(_0xf4f428);_0x4df16e===_0x2011ab(0x10a)&&(_0x31cf89={..._0x31cf89,'userId':_0xf4f428,'queueId':{[sequelize_1['Op']['in']]:_0x48428c}});_0x4df16e==='group'&&(_0x37cc56[_0x2011ab(0x10b)]||_0x3e2fa3===_0x2011ab(0xfd))&&(_0x31cf89={..._0x31cf89,'queueId':{[sequelize_1['Op']['or']]:[_0x48428c,null]}});if(_0x37cc56['profile']===_0x2011ab(0xf0)&&_0x4df16e===_0x2011ab(0x104)&&_0x37cc56[_0x2011ab(0xf7)]===_0x2011ab(0xf3)){const _0x3fc2bb=[],_0x17cfcc=await Ticket_1[_0x2011ab(0x11b)][_0x2011ab(0xef)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x37cc56['id'],null]},'queueId':{[sequelize_1['Op']['or']]:[_0x48428c,null]},'status':_0x2011ab(0x104)}});_0x17cfcc&&_0x3fc2bb[_0x2011ab(0x115)](_0x17cfcc[_0x2011ab(0x11d)](_0x581e35=>_0x581e35['id']));const _0x1ad4f8=(0x0,lodash_1['intersection'])(..._0x3fc2bb);_0x31cf89={..._0x31cf89,'id':{[sequelize_1['Op']['in']]:_0x1ad4f8}};}if(_0x37cc56['profile']===_0x2011ab(0xf0)&&_0x4df16e===_0x2011ab(0x104)&&_0x37cc56[_0x2011ab(0xf7)]===_0x2011ab(0x114)){const _0x590c4e=[],_0x5de2dd=await Ticket_1[_0x2011ab(0x11b)][_0x2011ab(0xef)]({'where':{[sequelize_1['Op']['or']]:[{'userId':{[sequelize_1['Op']['or']]:[_0x37cc56['id'],null]}},{'status':{[sequelize_1['Op']['or']]:[_0x2011ab(0x104),_0x2011ab(0x118)]}}],'queueId':{[sequelize_1['Op']['in']]:_0x48428c},'status':_0x2011ab(0x104)}});_0x5de2dd&&_0x590c4e[_0x2011ab(0x115)](_0x5de2dd[_0x2011ab(0x11d)](_0x4f2c22=>_0x4f2c22['id']));const _0xbc8343=(0x0,lodash_1[_0x2011ab(0xe1)])(..._0x590c4e);_0x31cf89={..._0x31cf89,'id':{[sequelize_1['Op']['in']]:_0xbc8343}};}_0x3e2fa3===_0x2011ab(0xfd)&&_0x37cc56['profile']===_0x2011ab(0xf2)&&(_0x31cf89={'queueId':{[sequelize_1['Op']['or']]:[_0x48428c,null]}});_0x4df16e&&_0x4df16e!==_0x2011ab(0xe0)&&(_0x31cf89={..._0x31cf89,'status':_0x4df16e});if(_0x4df16e===_0x2011ab(0x118)){const _0xddbdc8=[],_0x49b749=await Ticket_1[_0x2011ab(0x11b)][_0x2011ab(0xef)]({'where':{'queueId':_0x3e2fa3===_0x2011ab(0xfd)||_0x37cc56[_0x2011ab(0xf7)]===_0x2011ab(0xf3)?{[sequelize_1['Op']['or']]:[_0x48428c,null]}:_0x48428c,'status':'closed'},'group':[_0x2011ab(0x11f),_0x2011ab(0xe8),_0x2011ab(0xee)],'attributes':[_0x2011ab(0x11f),_0x2011ab(0xe8),_0x2011ab(0xee),[(0x0,sequelize_1['fn'])(_0x2011ab(0xf5),(0x0,sequelize_1[_0x2011ab(0xde)])('id')),'id']]});_0x49b749&&_0xddbdc8['push'](_0x49b749[_0x2011ab(0x11d)](_0x5ed3e6=>_0x5ed3e6['id']));const _0x1e9a13=(0x0,lodash_1[_0x2011ab(0xe1)])(..._0xddbdc8);_0x31cf89={..._0x31cf89,'id':{[sequelize_1['Op']['in']]:_0x1e9a13}};}if(_0x4df16e===_0x2011ab(0xe0)){_0x31cf89={'companyId':_0x5ae27e};_0x37cc56[_0x2011ab(0xfe)]===_0x2011ab(0xf0)&&(_0x31cf89={..._0x31cf89,'queueId':{[sequelize_1['Op']['in']]:_0x48428c}});_0x2a1606===_0x2011ab(0xfd)&&(_0x31cf89={..._0x31cf89,[sequelize_1['Op']['or']]:[{'userId':_0xf4f428},{'status':_0x2011ab(0x104)}],'queueId':{[sequelize_1['Op']['or']]:[_0x48428c,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}});if(searchParam){const _0xf0b311=(0x0,remove_accents_1['default'])(searchParam['toLocaleLowerCase']()[_0x2011ab(0xed)]());_0x2d5c0e=[..._0x2d5c0e,{'model':Message_1['default'],'as':_0x2011ab(0xe7),'attributes':['id',_0x2011ab(0x113)],'where':{'body':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x2011ab(0x101),(0x0,sequelize_1['fn'])(_0x2011ab(0x11a),(0x0,sequelize_1['col'])('body'))),_0x2011ab(0xdd),'%'+_0xf0b311+'%')},'required':![],'duplicating':![]}],_0x31cf89={..._0x31cf89,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['fn'])('unaccent',(0x0,sequelize_1[_0x2011ab(0xde)])(_0x2011ab(0x120)))),_0x2011ab(0xdd),'%'+_0xf0b311+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x2011ab(0xdc)]]:'%'+_0xf0b311+'%'}},{'$message.body$':(0x0,sequelize_1[_0x2011ab(0x105)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['fn'])('unaccent',(0x0,sequelize_1[_0x2011ab(0xde)])(_0x2011ab(0x113)))),_0x2011ab(0xdd),'%'+_0xf0b311+'%')}]};}if(Array['isArray'](_0x3bef81)&&_0x3bef81[_0x2011ab(0xff)]>0x0){const _0x182226=[],_0x1e236b=await ContactTag_1[_0x2011ab(0x11b)][_0x2011ab(0xef)]({'where':{'tagId':{[sequelize_1['Op']['in']]:_0x3bef81}}});_0x1e236b&&_0x182226[_0x2011ab(0x115)](_0x1e236b[_0x2011ab(0x11d)](_0x2664df=>_0x2664df['contactId']));const _0x361d98=(0x0,lodash_1[_0x2011ab(0xe1)])(..._0x182226);_0x31cf89={..._0x31cf89,'contactId':{[sequelize_1['Op']['in']]:_0x361d98}};}Array[_0x2011ab(0xf8)](_0x210a94)&&_0x210a94[_0x2011ab(0xff)]>0x0&&(_0x31cf89={..._0x31cf89,'userId':{[sequelize_1['Op']['in']]:_0x210a94}}),Array[_0x2011ab(0xf8)](_0x2f182e)&&_0x2f182e[_0x2011ab(0xff)]>0x0&&(_0x31cf89={..._0x31cf89,'whatsappId':{[sequelize_1['Op']['in']]:_0x2f182e}}),Array['isArray'](_0x302c20)&&_0x302c20[_0x2011ab(0xff)]>0x0&&(_0x31cf89={..._0x31cf89,'status':{[sequelize_1['Op']['in']]:_0x302c20}});}const _0x5cb4a5=0x28,_0x4046d8=_0x5cb4a5*(+pageNumber-0x1);_0x31cf89={..._0x31cf89,'companyId':_0x5ae27e};const {count:_0x373bae,rows:_0x8db583}=await Ticket_1[_0x2011ab(0x11b)][_0x2011ab(0x110)]({'where':_0x31cf89,'include':_0x2d5c0e,'distinct':!![],'limit':_0x5cb4a5,'offset':_0x4046d8,'order':[[_0x2011ab(0x119),_0x2011ab(0xe4)]],'subQuery':![]}),_0x5a1f86=_0x373bae>_0x4046d8+_0x8db583[_0x2011ab(0xff)];return{'tickets':_0x8db583,'count':_0x373bae,'hasMore':_0x5a1f86};};exports[a537_0x5bc79d(0x11b)]=ListTicketsService;function a537_0x54bb(){const _0x273ce6=['like','LIKE','col','extraInfo','search','intersection','number','tags','DESC','2945352mgPogC','sequelize','messages','contactId','name','8RtVldf','lodash','queue','trim','whatsappId','findAll','user','122862vYJjTS','admin','enable','5cUYBCo','max','977202GygkUe','allTicket','isArray','891066rtIuYu','color','../UserServices/ShowUserService','../../models/Message','true','profile','length','../../models/Ticket','LOWER','1915pRHSMF','acceptAudioMessage','pending','where','urlPicture','profilePicUrl','../../models/Queue','remove-accents','open','allowGroup','email','../../models/Whatsapp','../../models/ContactTag','1832GXSsHc','findAndCountAll','__importDefault','2460297QUdUJG','body','disable','push','../../models/Contact','expiresTicket','closed','updatedAt','unaccent','default','22hQRuYP','map','../../models/Tag','companyId','contact.name','521990MsWXnt','../../models/User'];a537_0x54bb=function(){return _0x273ce6;};return a537_0x54bb();}