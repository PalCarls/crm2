'use strict';const a594_0x1f7a64=a594_0x4694;(function(_0x56ca1f,_0x16af83){const _0x408f4a=a594_0x4694,_0x2a2041=_0x56ca1f();while(!![]){try{const _0x425257=-parseInt(_0x408f4a(0x1e7))/0x1*(parseInt(_0x408f4a(0x218))/0x2)+-parseInt(_0x408f4a(0x217))/0x3+-parseInt(_0x408f4a(0x1f3))/0x4*(parseInt(_0x408f4a(0x1f0))/0x5)+parseInt(_0x408f4a(0x1f8))/0x6*(parseInt(_0x408f4a(0x207))/0x7)+parseInt(_0x408f4a(0x22b))/0x8+-parseInt(_0x408f4a(0x21e))/0x9+parseInt(_0x408f4a(0x1f7))/0xa;if(_0x425257===_0x16af83)break;else _0x2a2041['push'](_0x2a2041['shift']());}catch(_0x51251a){_0x2a2041['push'](_0x2a2041['shift']());}}}(a594_0x20a0,0x326c1));function a594_0x4694(_0x5297d5,_0x28ba2c){const _0x20a09c=a594_0x20a0();return a594_0x4694=function(_0x4694e7,_0x25c203){_0x4694e7=_0x4694e7-0x1e7;let _0x6df09e=_0x20a09c[_0x4694e7];return _0x6df09e;},a594_0x4694(_0x5297d5,_0x28ba2c);}var __importDefault=this&&this[a594_0x1f7a64(0x229)]||function(_0x150063){const _0x85aa35=a594_0x1f7a64;return _0x150063&&_0x150063[_0x85aa35(0x20f)]?_0x150063:{'default':_0x150063};};Object[a594_0x1f7a64(0x1ee)](exports,a594_0x1f7a64(0x20f),{'value':!![]});const sequelize_1=require(a594_0x1f7a64(0x230)),Ticket_1=__importDefault(require(a594_0x1f7a64(0x1f2))),Contact_1=__importDefault(require(a594_0x1f7a64(0x20b))),Message_1=__importDefault(require(a594_0x1f7a64(0x219))),Queue_1=__importDefault(require(a594_0x1f7a64(0x225))),User_1=__importDefault(require(a594_0x1f7a64(0x228))),ShowUserService_1=__importDefault(require(a594_0x1f7a64(0x1e9))),Tag_1=__importDefault(require('../../models/Tag')),lodash_1=require(a594_0x1f7a64(0x210)),Whatsapp_1=__importDefault(require(a594_0x1f7a64(0x22a))),ContactTag_1=__importDefault(require(a594_0x1f7a64(0x205))),remove_accents_1=__importDefault(require(a594_0x1f7a64(0x1fd))),isQueueIdHistoryBlocked_1=__importDefault(require(a594_0x1f7a64(0x221))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x2ae334,tags:_0x22ef39,users:_0x221c6d,status:_0x1f52d3,date:_0x5dc78b,dateStart:_0x1a2ca6,dateEnd:_0x1cf527,updatedAt:_0x20382a,showAll:_0x14f3d6,userId:_0x255a48,withUnreadMessages:_0x18f327,whatsappIds:_0x4c6b23,statusFilters:_0x2d72ca,companyId:_0x55f2ff})=>{const _0x346b1f=a594_0x1f7a64,_0x5a5ed2=await(0x0,isQueueIdHistoryBlocked_1[_0x346b1f(0x232)])({'userRequest':_0x255a48});let _0xfa6a99;!_0x5a5ed2?_0xfa6a99={[sequelize_1['Op']['or']]:[{'userId':_0x255a48},{'status':_0x346b1f(0x216)}],'queueId':{[sequelize_1['Op']['or']]:[_0x2ae334,null]},'companyId':_0x55f2ff}:_0xfa6a99={[sequelize_1['Op']['or']]:[{'userId':_0x255a48},{'status':_0x346b1f(0x216)}],'companyId':_0x55f2ff};let _0x37a824;_0x37a824=[{'model':Contact_1[_0x346b1f(0x232)],'as':_0x346b1f(0x213),'attributes':['id',_0x346b1f(0x222),'number',_0x346b1f(0x209),_0x346b1f(0x1ea),_0x346b1f(0x1f5),_0x346b1f(0x21c),_0x346b1f(0x1f4),_0x346b1f(0x227)],'include':[_0x346b1f(0x226),_0x346b1f(0x1ed)]},{'model':Queue_1['default'],'as':_0x346b1f(0x200),'attributes':['id',_0x346b1f(0x222),_0x346b1f(0x223)]},{'model':User_1['default'],'as':_0x346b1f(0x1ec),'attributes':['id','name']},{'model':Tag_1[_0x346b1f(0x232)],'as':_0x346b1f(0x20d),'attributes':['id',_0x346b1f(0x222),_0x346b1f(0x223)]},{'model':Whatsapp_1[_0x346b1f(0x232)],'as':'whatsapp','attributes':['id','name','expiresTicket',_0x346b1f(0x20e)]}];const _0x5b505c=await(0x0,ShowUserService_1[_0x346b1f(0x232)])(_0x255a48,_0x55f2ff),_0x5d299a=_0x5b505c[_0x346b1f(0x22e)]['map'](_0x2278c8=>_0x2278c8['id']);_0x1f52d3===_0x346b1f(0x20c)&&(_0xfa6a99={..._0xfa6a99,'userId':_0x255a48,'queueId':{[sequelize_1['Op']['in']]:_0x2ae334}});_0x1f52d3===_0x346b1f(0x22c)&&(_0x5b505c['allowGroup']||_0x14f3d6===_0x346b1f(0x1fa))&&(_0xfa6a99={..._0xfa6a99,'queueId':{[sequelize_1['Op']['or']]:[_0x2ae334,null]}});if(_0x5b505c[_0x346b1f(0x212)]===_0x346b1f(0x1ec)&&_0x1f52d3==='pending'&&_0x5b505c[_0x346b1f(0x1e8)]===_0x346b1f(0x214)){const _0x33eef7=[];let _0x2f743f=[];!_0x5a5ed2?_0x2f743f=await Ticket_1['default'][_0x346b1f(0x220)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x5b505c['id'],null]},'queueId':{[sequelize_1['Op']['or']]:[_0x2ae334,null]},'status':_0x346b1f(0x216),'companyId':_0x55f2ff}}):_0x2f743f=await Ticket_1['default'][_0x346b1f(0x220)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x5b505c['id'],null]},'status':'pending','companyId':_0x55f2ff}});_0x2f743f&&_0x33eef7['push'](_0x2f743f[_0x346b1f(0x22f)](_0x26f25c=>_0x26f25c['id']));const _0x258aa9=(0x0,lodash_1[_0x346b1f(0x224)])(..._0x33eef7);_0xfa6a99={..._0xfa6a99,'id':_0x258aa9};}if(_0x5b505c[_0x346b1f(0x212)]==='user'&&_0x1f52d3===_0x346b1f(0x216)&&_0x5b505c[_0x346b1f(0x1e8)]==='disable'){const _0x1efb01=[];let _0xc9e50f=[];!_0x5a5ed2?_0xc9e50f=await Ticket_1[_0x346b1f(0x232)]['findAll']({'where':{'companyId':_0x55f2ff,'userId':{[sequelize_1['Op']['or']]:[_0x5b505c['id'],null]},'status':_0x346b1f(0x216),'queueId':{[sequelize_1['Op']['in']]:_0x2ae334}}}):_0xc9e50f=await Ticket_1[_0x346b1f(0x232)][_0x346b1f(0x220)]({'where':{'companyId':_0x55f2ff,[sequelize_1['Op']['or']]:[{'userId':{[sequelize_1['Op']['or']]:[_0x5b505c['id'],null]}},{'status':_0x346b1f(0x216)}],'status':_0x346b1f(0x216)}});_0xc9e50f&&_0x1efb01[_0x346b1f(0x1fb)](_0xc9e50f[_0x346b1f(0x22f)](_0x21572f=>_0x21572f['id']));const _0x465904=(0x0,lodash_1['intersection'])(..._0x1efb01);_0xfa6a99={..._0xfa6a99,'id':_0x465904};}_0x14f3d6===_0x346b1f(0x1fa)&&(_0x5b505c[_0x346b1f(0x212)]===_0x346b1f(0x208)||_0x5b505c[_0x346b1f(0x234)]===_0x346b1f(0x206))&&(_0x5b505c['allHistoric']===_0x346b1f(0x206)?_0xfa6a99={}:_0xfa6a99={'queueId':{[sequelize_1['Op']['or']]:[_0x2ae334,null]}});_0x1f52d3&&_0x1f52d3!==_0x346b1f(0x202)&&(_0xfa6a99={..._0xfa6a99,'status':_0x1f52d3});if(_0x1f52d3==='closed'){let _0x331e52;if(!_0x5a5ed2){let _0x4f64b7={'companyId':_0x55f2ff,'status':_0x346b1f(0x21d)};_0x14f3d6==='false'&&_0x5b505c['profile']==='admin'?_0x4f64b7={..._0x4f64b7,'queueId':_0x2ae334,'userId':_0x255a48}:_0x4f64b7={..._0x4f64b7,'queueId':_0x14f3d6==='true'||_0x5b505c[_0x346b1f(0x1e8)]==='enable'?{[sequelize_1['Op']['or']]:[_0x2ae334,null]}:_0x2ae334},_0x331e52=await Ticket_1[_0x346b1f(0x232)][_0x346b1f(0x220)]({'attributes':[_0x346b1f(0x227),_0x346b1f(0x1ef),_0x346b1f(0x231),[(0x0,sequelize_1['literal'])('MAX(\x22id\x22)'),'id']],'where':_0x4f64b7,'group':[_0x346b1f(0x227),_0x346b1f(0x1ef),_0x346b1f(0x231)]});}else{let _0x459c62={'companyId':_0x55f2ff,'status':_0x346b1f(0x21d)};_0x14f3d6===_0x346b1f(0x233)&&(_0x5b505c[_0x346b1f(0x212)]==='admin'||_0x5b505c['allUserChat']===_0x346b1f(0x206))&&(_0x459c62={..._0x459c62,'queueId':_0x2ae334,'userId':_0x255a48}),_0x331e52=await Ticket_1[_0x346b1f(0x232)][_0x346b1f(0x220)]({'attributes':[_0x346b1f(0x227),'contactId','whatsappId',[(0x0,sequelize_1[_0x346b1f(0x1f6)])('MAX(\x22id\x22)'),'id']],'where':_0x459c62,'group':[_0x346b1f(0x227),_0x346b1f(0x1ef),_0x346b1f(0x231)]});}const _0x1f7516=_0x331e52[_0x346b1f(0x22f)](_0x5367fc=>_0x5367fc['id']);_0xfa6a99={'id':_0x1f7516};};if(_0x1f52d3===_0x346b1f(0x202)){_0xfa6a99={'companyId':_0x55f2ff};let _0x4d27ed;if(!_0x5a5ed2&&_0x5b505c['profile']===_0x346b1f(0x1ec))_0x4d27ed=await Ticket_1[_0x346b1f(0x232)]['findAll']({'attributes':[_0x346b1f(0x227),_0x346b1f(0x1ef),_0x346b1f(0x231),[(0x0,sequelize_1['literal'])(_0x346b1f(0x211)),'id']],'where':{[sequelize_1['Op']['or']]:[{'userId':_0x255a48},{'status':['pending',_0x346b1f(0x21d)]}],'queueId':_0x14f3d6===_0x346b1f(0x1fa)||_0x5b505c[_0x346b1f(0x1e8)]===_0x346b1f(0x214)?{[sequelize_1['Op']['or']]:[_0x2ae334,null]}:_0x2ae334,'companyId':_0x55f2ff},'group':[_0x346b1f(0x227),_0x346b1f(0x1ef),'whatsappId']});else{let _0x28a3a2={'companyId':_0x55f2ff,[sequelize_1['Op']['or']]:[{'userId':_0x255a48},{'status':[_0x346b1f(0x216),'closed']}]};if(_0x14f3d6===_0x346b1f(0x233)&&_0x5b505c[_0x346b1f(0x212)]===_0x346b1f(0x208))_0x28a3a2={..._0x28a3a2,'queueId':_0x2ae334};else _0x14f3d6===_0x346b1f(0x1fa)&&_0x5b505c[_0x346b1f(0x212)]==='admin'&&(_0x28a3a2={'companyId':_0x55f2ff,'queueId':_0x2ae334});_0x4d27ed=await Ticket_1[_0x346b1f(0x232)][_0x346b1f(0x220)]({'attributes':['companyId',_0x346b1f(0x1ef),_0x346b1f(0x231),[(0x0,sequelize_1[_0x346b1f(0x1f6)])(_0x346b1f(0x211)),'id']],'where':_0x28a3a2,'group':[_0x346b1f(0x227),'contactId',_0x346b1f(0x231)]});}const _0x1d4841=_0x4d27ed[_0x346b1f(0x22f)](_0x29d9d5=>_0x29d9d5['id']);_0xfa6a99={..._0xfa6a99,'id':{[sequelize_1['Op']['in']]:_0x1d4841}};if(searchParam){const _0x48ce8a=(0x0,remove_accents_1[_0x346b1f(0x232)])(searchParam[_0x346b1f(0x21b)]()[_0x346b1f(0x203)]());_0x37a824=[..._0x37a824,{'model':Message_1[_0x346b1f(0x232)],'as':_0x346b1f(0x1eb),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x346b1f(0x20a)])((0x0,sequelize_1['fn'])(_0x346b1f(0x1f9),(0x0,sequelize_1['fn'])(_0x346b1f(0x1ff),(0x0,sequelize_1[_0x346b1f(0x22d)])(_0x346b1f(0x201)))),_0x346b1f(0x1fe),'%'+_0x48ce8a+'%')},'required':![],'duplicating':![]}],_0xfa6a99={..._0xfa6a99,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x346b1f(0x20a)])((0x0,sequelize_1['fn'])(_0x346b1f(0x1f9),(0x0,sequelize_1['fn'])(_0x346b1f(0x1ff),(0x0,sequelize_1['col'])(_0x346b1f(0x21f)))),_0x346b1f(0x1fe),'%'+_0x48ce8a+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x346b1f(0x1f1)]]:'%'+_0x48ce8a+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x346b1f(0x1f9),(0x0,sequelize_1['fn'])(_0x346b1f(0x1ff),(0x0,sequelize_1[_0x346b1f(0x22d)])('body'))),_0x346b1f(0x1fe),'%'+_0x48ce8a+'%')}]};}if(Array['isArray'](_0x22ef39)&&_0x22ef39[_0x346b1f(0x215)]>0x0){const _0x95f6a3=[],_0x4d7604=await ContactTag_1[_0x346b1f(0x232)][_0x346b1f(0x220)]({'where':{'tagId':{[sequelize_1['Op']['in']]:_0x22ef39}}});_0x4d7604&&_0x95f6a3['push'](_0x4d7604['map'](_0x3bec58=>_0x3bec58['contactId']));const _0x201c3f=(0x0,lodash_1[_0x346b1f(0x224)])(..._0x95f6a3);_0xfa6a99={..._0xfa6a99,'contactId':{[sequelize_1['Op']['in']]:_0x201c3f}};}Array['isArray'](_0x221c6d)&&_0x221c6d[_0x346b1f(0x215)]>0x0&&(_0xfa6a99={..._0xfa6a99,'userId':{[sequelize_1['Op']['in']]:_0x221c6d}}),Array['isArray'](_0x4c6b23)&&_0x4c6b23[_0x346b1f(0x215)]>0x0&&(_0xfa6a99={..._0xfa6a99,'whatsappId':{[sequelize_1['Op']['in']]:_0x4c6b23}}),Array[_0x346b1f(0x21a)](_0x2d72ca)&&_0x2d72ca[_0x346b1f(0x215)]>0x0&&(_0xfa6a99={..._0xfa6a99,'status':{[sequelize_1['Op']['in']]:_0x2d72ca}});}_0x18f327===_0x346b1f(0x1fa)&&(_0xfa6a99={[sequelize_1['Op']['or']]:[{'userId':_0x255a48,'status':{[sequelize_1['Op'][_0x346b1f(0x204)]]:[_0x346b1f(0x21d),'lgpd','nps']},'queueId':{[sequelize_1['Op']['in']]:_0x5d299a},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0},'companyId':_0x55f2ff},{'status':{[sequelize_1['Op']['in']]:[_0x346b1f(0x216),_0x346b1f(0x22c)]},'queueId':{[sequelize_1['Op']['or']]:[_0x5d299a,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0},'companyId':_0x55f2ff}]},_0x1f52d3===_0x346b1f(0x22c)&&(_0x5b505c['allowGroup']||_0x14f3d6===_0x346b1f(0x1fa))&&(_0xfa6a99={..._0xfa6a99,'queueId':{[sequelize_1['Op']['or']]:[_0x5d299a,null]}}));_0xfa6a99={..._0xfa6a99,'companyId':_0x55f2ff};const _0x43a0c7=0x28,_0x499d7b=_0x43a0c7*(+pageNumber-0x1),{count:_0x87aa4c,rows:_0x3028a3}=await Ticket_1[_0x346b1f(0x232)]['findAndCountAll']({'where':_0xfa6a99,'include':_0x37a824,'distinct':!![],'limit':_0x43a0c7,'offset':_0x499d7b,'order':[[_0x346b1f(0x1fc),'DESC']],'subQuery':![]}),_0x3567ef=_0x87aa4c>_0x499d7b+_0x3028a3['length'];return{'tickets':_0x3028a3,'count':_0x87aa4c,'hasMore':_0x3567ef};};exports['default']=ListTicketsService;function a594_0x20a0(){const _0x2253dd=['../../models/Contact','open','tags','groupAsTicket','__esModule','lodash','MAX(\x22id\x22)','profile','contact','enable','length','pending','586986oqlsjH','2etFdRg','../../models/Message','isArray','toLocaleLowerCase','active','closed','1174905nYkSEL','contact.name','findAll','../UserServices/isQueueIdHistoryBlocked','name','color','intersection','../../models/Queue','extraInfo','companyId','../../models/User','__importDefault','../../models/Whatsapp','314384cjHumJ','group','col','queues','map','sequelize','whatsappId','default','false','allUserChat','332871iMlBOQ','allTicket','../UserServices/ShowUserService','profilePicUrl','messages','user','contactTags','defineProperty','contactId','240145AomQjY','like','../../models/Ticket','28oGlqCg','urlPicture','acceptAudioMessage','literal','8680680eCKfXy','54DxMYvS','LOWER','true','push','updatedAt','remove-accents','LIKE','unaccent','queue','body','search','trim','notIn','../../models/ContactTag','enabled','229012yUyvoq','admin','email','where'];a594_0x20a0=function(){return _0x2253dd;};return a594_0x20a0();}