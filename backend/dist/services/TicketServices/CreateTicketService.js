'use strict';const a516_0x7ed68a=a516_0x576a;(function(_0x1e4f7e,_0x11d659){const _0x309635=a516_0x576a,_0x20f6c3=_0x1e4f7e();while(!![]){try{const _0x390d24=-parseInt(_0x309635(0xd6))/0x1*(-parseInt(_0x309635(0xe1))/0x2)+parseInt(_0x309635(0xc9))/0x3*(-parseInt(_0x309635(0xc4))/0x4)+parseInt(_0x309635(0xd4))/0x5*(parseInt(_0x309635(0xcd))/0x6)+parseInt(_0x309635(0xdb))/0x7*(parseInt(_0x309635(0xda))/0x8)+-parseInt(_0x309635(0xd8))/0x9*(-parseInt(_0x309635(0xd2))/0xa)+parseInt(_0x309635(0xde))/0xb+-parseInt(_0x309635(0xdd))/0xc*(parseInt(_0x309635(0xce))/0xd);if(_0x390d24===_0x11d659)break;else _0x20f6c3['push'](_0x20f6c3['shift']());}catch(_0x24c152){_0x20f6c3['push'](_0x20f6c3['shift']());}}}(a516_0x569a,0x4775f));function a516_0x569a(){const _0x262d36=['open','64286pdiuZe','-ticket','__esModule','1752188fnGSUK','toString','../WhatsappService/ShowWhatsAppService','../../helpers/GetDefaultWhatsApp','../../errors/AppError','3bRqXyf','company-','contact','log','1272uPzNZc','183235COBexd','findOrCreate','defineProperty','../../libs/socket','1733890ytVaiH','getIO','9705EPmUwB','status','1NMTYzK','queue','9FfdjiF','../../models/Ticket','1448eamBAD','1470dTvKJN','notification','348WkCjAb','5329181hlCbem','default'];a516_0x569a=function(){return _0x262d36;};return a516_0x569a();}var __importDefault=this&&this['__importDefault']||function(_0xd2fa6b){const _0x35b6f1=a516_0x576a;return _0xd2fa6b&&_0xd2fa6b[_0x35b6f1(0xc3)]?_0xd2fa6b:{'default':_0xd2fa6b};};function a516_0x576a(_0x1840e2,_0x24170b){const _0x569ad6=a516_0x569a();return a516_0x576a=function(_0x576ad0,_0xf387a6){_0x576ad0=_0x576ad0-0xc3;let _0xf987e8=_0x569ad6[_0x576ad0];return _0xf987e8;},a516_0x576a(_0x1840e2,_0x24170b);}Object[a516_0x7ed68a(0xd0)](exports,a516_0x7ed68a(0xc3),{'value':!![]});const AppError_1=__importDefault(require(a516_0x7ed68a(0xc8))),GetDefaultWhatsApp_1=__importDefault(require(a516_0x7ed68a(0xc7))),GetDefaultWhatsAppByUser_1=__importDefault(require('../../helpers/GetDefaultWhatsAppByUser')),Ticket_1=__importDefault(require(a516_0x7ed68a(0xd9))),ShowContactService_1=__importDefault(require('../ContactServices/ShowContactService')),socket_1=require(a516_0x7ed68a(0xd1)),ShowWhatsAppService_1=__importDefault(require(a516_0x7ed68a(0xc6))),CheckContactOpenTickets_1=__importDefault(require('../../helpers/CheckContactOpenTickets')),CreateTicketService=async({contactId:_0x2a7e63,status:_0x939242,userId:_0x58b2d1,queueId:_0x512cf9,companyId:_0x1cc144,whatsappId:_0x262405})=>{const _0x46852f=a516_0x7ed68a,_0x58093a=(0x0,socket_1[_0x46852f(0xd3)])();console[_0x46852f(0xcc)](_0x2a7e63,_0x939242,_0x58b2d1,_0x512cf9,_0x1cc144,_0x262405);let _0x1de7b9;_0x262405!==undefined&&_0x262405!==null&&_0x262405!==''&&(_0x1de7b9=await(0x0,ShowWhatsAppService_1['default'])(_0x262405,_0x1cc144));let _0x50fab2=await(0x0,GetDefaultWhatsAppByUser_1['default'])(_0x58b2d1);_0x1de7b9&&(_0x50fab2=_0x1de7b9);if(!_0x50fab2)_0x50fab2=await(0x0,GetDefaultWhatsApp_1[_0x46852f(0xdf)])(_0x1cc144);await(0x0,CheckContactOpenTickets_1[_0x46852f(0xdf)])(_0x2a7e63,_0x50fab2['id']);const {isGroup:_0x34f994}=await(0x0,ShowContactService_1['default'])(_0x2a7e63,_0x1cc144),[{id:_0x3589aa}]=await Ticket_1[_0x46852f(0xdf)][_0x46852f(0xcf)]({'where':{'contactId':_0x2a7e63,'companyId':_0x1cc144,'whatsappId':_0x50fab2['id']},'defaults':{'contactId':_0x2a7e63,'companyId':_0x1cc144,'status':_0x939242,'whatsappId':_0x50fab2['id'],'isGroup':_0x34f994,'userId':_0x58b2d1,'isBot':!![]}});await Ticket_1[_0x46852f(0xdf)]['update']({'companyId':_0x1cc144,'queueId':_0x512cf9,'userId':_0x58b2d1,'status':_0x34f994?'group':_0x46852f(0xe0),'isBot':!![]},{'where':{'id':_0x3589aa}});const _0x1b3d48=await Ticket_1[_0x46852f(0xdf)]['findByPk'](_0x3589aa,{'include':[_0x46852f(0xcb),_0x46852f(0xd7)]});if(!_0x1b3d48)throw new AppError_1[(_0x46852f(0xdf))]('ERR_CREATING_TICKET');return _0x58093a['to'](_0x1b3d48[_0x46852f(0xd5)])['to'](_0x46852f(0xdc))['to'](_0x3589aa[_0x46852f(0xc5)]())['emit'](_0x46852f(0xca)+_0x1cc144+_0x46852f(0xe2),{'action':'update','ticket':_0x1b3d48}),_0x1b3d48;};exports[a516_0x7ed68a(0xdf)]=CreateTicketService;