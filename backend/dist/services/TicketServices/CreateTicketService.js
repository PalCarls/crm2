'use strict';function a532_0x3891(_0x502fc3,_0x265e96){const _0x2cd0b1=a532_0x2cd0();return a532_0x3891=function(_0x389188,_0x3e9aa5){_0x389188=_0x389188-0x94;let _0x4024b3=_0x2cd0b1[_0x389188];return _0x4024b3;},a532_0x3891(_0x502fc3,_0x265e96);}const a532_0x31ea07=a532_0x3891;function a532_0x2cd0(){const _0x5c9ad7=['562667sfRqht','__importDefault','__esModule','./CreateLogTicketService','../../models/Ticket','getIO','defineProperty','../../helpers/GetDefaultWhatsApp','2249331DqrMVq','create','notification','group','207755MTYHyS','default','72zlnupr','8488374csrFQT','-ticket','update','1201723VrGDpO','findOrCreate','../../helpers/GetDefaultWhatsAppByUser','../../helpers/CheckContactOpenTickets','findByPk','status','../ContactServices/ShowContactService','42564180hlRUVi','148DbQucZ','../../libs/socket','../WhatsappService/ShowWhatsAppService','contact','queue','toString','ERR_CREATING_TICKET','2QEUtRz','6225750bdBouH'];a532_0x2cd0=function(){return _0x5c9ad7;};return a532_0x2cd0();}(function(_0x264e81,_0x567c32){const _0x3cc938=a532_0x3891,_0x10da11=_0x264e81();while(!![]){try{const _0xe35802=-parseInt(_0x3cc938(0x97))/0x1+-parseInt(_0x3cc938(0xa6))/0x2*(-parseInt(_0x3cc938(0xb0))/0x3)+-parseInt(_0x3cc938(0x9f))/0x4*(parseInt(_0x3cc938(0xb4))/0x5)+-parseInt(_0x3cc938(0x94))/0x6+-parseInt(_0x3cc938(0xa8))/0x7*(parseInt(_0x3cc938(0xb6))/0x8)+parseInt(_0x3cc938(0xa7))/0x9+parseInt(_0x3cc938(0x9e))/0xa;if(_0xe35802===_0x567c32)break;else _0x10da11['push'](_0x10da11['shift']());}catch(_0x47b619){_0x10da11['push'](_0x10da11['shift']());}}}(a532_0x2cd0,0xc85c5));var __importDefault=this&&this[a532_0x31ea07(0xa9)]||function(_0x8a3eba){const _0x5ec7f0=a532_0x31ea07;return _0x8a3eba&&_0x8a3eba[_0x5ec7f0(0xaa)]?_0x8a3eba:{'default':_0x8a3eba};};Object[a532_0x31ea07(0xae)](exports,'__esModule',{'value':!![]});const AppError_1=__importDefault(require('../../errors/AppError')),GetDefaultWhatsApp_1=__importDefault(require(a532_0x31ea07(0xaf))),GetDefaultWhatsAppByUser_1=__importDefault(require(a532_0x31ea07(0x99))),Ticket_1=__importDefault(require(a532_0x31ea07(0xac))),ShowContactService_1=__importDefault(require(a532_0x31ea07(0x9d))),socket_1=require(a532_0x31ea07(0xa0)),ShowWhatsAppService_1=__importDefault(require(a532_0x31ea07(0xa1))),CheckContactOpenTickets_1=__importDefault(require(a532_0x31ea07(0x9a))),CreateLogTicketService_1=__importDefault(require(a532_0x31ea07(0xab))),CreateTicketService=async({contactId:_0x5870c4,status:_0x42ddb2,userId:_0x49d43d,queueId:_0x276826,companyId:_0x9b4d25,whatsappId:_0x18973c})=>{const _0x2cc3bc=a532_0x31ea07,_0x1e7bdc=(0x0,socket_1[_0x2cc3bc(0xad)])();console['log'](_0x5870c4,_0x42ddb2,_0x49d43d,_0x276826,_0x9b4d25,_0x18973c);let _0x2d4210;_0x18973c!==undefined&&_0x18973c!==null&&_0x18973c!==''&&(_0x2d4210=await(0x0,ShowWhatsAppService_1[_0x2cc3bc(0xb5)])(_0x18973c,_0x9b4d25));let _0x48ee93=await(0x0,GetDefaultWhatsAppByUser_1['default'])(_0x49d43d);_0x2d4210&&(_0x48ee93=_0x2d4210);if(!_0x48ee93)_0x48ee93=await(0x0,GetDefaultWhatsApp_1[_0x2cc3bc(0xb5)])(_0x9b4d25);await(0x0,CheckContactOpenTickets_1['default'])(_0x5870c4,_0x48ee93['id']);const {isGroup:_0x5e9127}=await(0x0,ShowContactService_1['default'])(_0x5870c4,_0x9b4d25),[{id:_0x304cec}]=await Ticket_1['default'][_0x2cc3bc(0x98)]({'where':{'contactId':_0x5870c4,'companyId':_0x9b4d25,'whatsappId':_0x48ee93['id']},'defaults':{'contactId':_0x5870c4,'companyId':_0x9b4d25,'status':_0x42ddb2,'whatsappId':_0x48ee93['id'],'isGroup':_0x5e9127,'userId':_0x49d43d,'isBot':!![]}});await Ticket_1['default']['update']({'companyId':_0x9b4d25,'queueId':_0x276826,'userId':_0x49d43d,'status':_0x5e9127?_0x2cc3bc(0xb3):'open','isBot':!![]},{'where':{'id':_0x304cec}});const _0x40a3d8=await Ticket_1[_0x2cc3bc(0xb5)][_0x2cc3bc(0x9b)](_0x304cec,{'include':[_0x2cc3bc(0xa2),_0x2cc3bc(0xa3)]});if(!_0x40a3d8)throw new AppError_1[(_0x2cc3bc(0xb5))](_0x2cc3bc(0xa5));return _0x1e7bdc['to'](_0x40a3d8[_0x2cc3bc(0x9c)])['to'](_0x2cc3bc(0xb2))['to'](_0x304cec[_0x2cc3bc(0xa4)]())['emit']('company-'+_0x9b4d25+_0x2cc3bc(0x95),{'action':_0x2cc3bc(0x96),'ticket':_0x40a3d8}),await(0x0,CreateLogTicketService_1[_0x2cc3bc(0xb5)])({'userId':_0x49d43d,'queueId':_0x276826,'ticketId':_0x40a3d8['id'],'type':_0x2cc3bc(0xb1)}),_0x40a3d8;};exports[a532_0x31ea07(0xb5)]=CreateTicketService;