'use strict';const a517_0x12cf56=a517_0xc3c4;(function(_0x38dc59,_0x5a073b){const _0x1be3b2=a517_0xc3c4,_0x2cc26f=_0x38dc59();while(!![]){try{const _0x598926=-parseInt(_0x1be3b2(0x99))/0x1+-parseInt(_0x1be3b2(0x9a))/0x2*(-parseInt(_0x1be3b2(0xa3))/0x3)+-parseInt(_0x1be3b2(0x8e))/0x4*(parseInt(_0x1be3b2(0x96))/0x5)+parseInt(_0x1be3b2(0x94))/0x6+parseInt(_0x1be3b2(0x9c))/0x7+parseInt(_0x1be3b2(0x8a))/0x8*(parseInt(_0x1be3b2(0x8d))/0x9)+parseInt(_0x1be3b2(0xa1))/0xa*(-parseInt(_0x1be3b2(0x8b))/0xb);if(_0x598926===_0x5a073b)break;else _0x2cc26f['push'](_0x2cc26f['shift']());}catch(_0x532e60){_0x2cc26f['push'](_0x2cc26f['shift']());}}}(a517_0x5c40,0x43ed6));function a517_0x5c40(){const _0x3f136f=['6177534TDwpDb','log','18lrPWHH','20424NtFdAv','open','../../libs/socket','../../errors/AppError','../WhatsappService/ShowWhatsAppService','emit','2045142KSzbTj','toString','355vMEJnY','queue','../../helpers/GetDefaultWhatsAppByUser','46707mmsIuA','8mxcPrS','__importDefault','1129156BiOBVU','default','../ContactServices/ShowContactService','__esModule','findOrCreate','10cAUrzf','findByPk','322773zRDfer','../../models/Ticket','company-','notification','contact','status','../../helpers/CheckContactOpenTickets','group','1266112oVCMDd'];a517_0x5c40=function(){return _0x3f136f;};return a517_0x5c40();}var __importDefault=this&&this[a517_0x12cf56(0x9b)]||function(_0x171552){const _0x2b1957=a517_0x12cf56;return _0x171552&&_0x171552[_0x2b1957(0x9f)]?_0x171552:{'default':_0x171552};};function a517_0xc3c4(_0xe59ec8,_0x250904){const _0x5c40b6=a517_0x5c40();return a517_0xc3c4=function(_0xc3c4d0,_0x55ef9f){_0xc3c4d0=_0xc3c4d0-0x83;let _0x570157=_0x5c40b6[_0xc3c4d0];return _0x570157;},a517_0xc3c4(_0xe59ec8,_0x250904);}Object['defineProperty'](exports,a517_0x12cf56(0x9f),{'value':!![]});const AppError_1=__importDefault(require(a517_0x12cf56(0x91))),GetDefaultWhatsApp_1=__importDefault(require('../../helpers/GetDefaultWhatsApp')),GetDefaultWhatsAppByUser_1=__importDefault(require(a517_0x12cf56(0x98))),Ticket_1=__importDefault(require(a517_0x12cf56(0x83))),ShowContactService_1=__importDefault(require(a517_0x12cf56(0x9e))),socket_1=require(a517_0x12cf56(0x90)),ShowWhatsAppService_1=__importDefault(require(a517_0x12cf56(0x92))),CheckContactOpenTickets_1=__importDefault(require(a517_0x12cf56(0x88))),CreateTicketService=async({contactId:_0x8f62e6,status:_0x15a2ce,userId:_0x2bc3ca,queueId:_0x5c0485,companyId:_0x137653,whatsappId:_0x408756})=>{const _0x58647c=a517_0x12cf56,_0x37f61a=(0x0,socket_1['getIO'])();console[_0x58647c(0x8c)](_0x8f62e6,_0x15a2ce,_0x2bc3ca,_0x5c0485,_0x137653,_0x408756);let _0x30d280;_0x408756!==undefined&&_0x408756!==null&&_0x408756!==''&&(_0x30d280=await(0x0,ShowWhatsAppService_1[_0x58647c(0x9d)])(_0x408756,_0x137653));let _0x3191ca=await(0x0,GetDefaultWhatsAppByUser_1[_0x58647c(0x9d)])(_0x2bc3ca);_0x30d280&&(_0x3191ca=_0x30d280);if(!_0x3191ca)_0x3191ca=await(0x0,GetDefaultWhatsApp_1[_0x58647c(0x9d)])(_0x137653);await(0x0,CheckContactOpenTickets_1[_0x58647c(0x9d)])(_0x8f62e6,_0x3191ca['id']);const {isGroup:_0x1bbd2d}=await(0x0,ShowContactService_1[_0x58647c(0x9d)])(_0x8f62e6,_0x137653),[{id:_0x2590e2}]=await Ticket_1[_0x58647c(0x9d)][_0x58647c(0xa0)]({'where':{'contactId':_0x8f62e6,'companyId':_0x137653,'whatsappId':_0x3191ca['id']},'defaults':{'contactId':_0x8f62e6,'companyId':_0x137653,'status':_0x15a2ce,'whatsappId':_0x3191ca['id'],'isGroup':_0x1bbd2d,'userId':_0x2bc3ca,'isBot':!![]}});await Ticket_1[_0x58647c(0x9d)]['update']({'companyId':_0x137653,'queueId':_0x5c0485,'userId':_0x2bc3ca,'status':_0x1bbd2d?_0x58647c(0x89):_0x58647c(0x8f),'isBot':!![]},{'where':{'id':_0x2590e2}});const _0x448b4f=await Ticket_1[_0x58647c(0x9d)][_0x58647c(0xa2)](_0x2590e2,{'include':[_0x58647c(0x86),_0x58647c(0x97)]});if(!_0x448b4f)throw new AppError_1[(_0x58647c(0x9d))]('ERR_CREATING_TICKET');return _0x37f61a['to'](_0x448b4f[_0x58647c(0x87)])['to'](_0x58647c(0x85))['to'](_0x2590e2[_0x58647c(0x95)]())[_0x58647c(0x93)](_0x58647c(0x84)+_0x137653+'-ticket',{'action':'update','ticket':_0x448b4f}),_0x448b4f;};exports[a517_0x12cf56(0x9d)]=CreateTicketService;