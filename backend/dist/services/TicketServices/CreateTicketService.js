'use strict';const a532_0x1bc684=a532_0x54cc;(function(_0x3dbcd7,_0x5bcfec){const _0x893258=a532_0x54cc,_0x564964=_0x3dbcd7();while(!![]){try{const _0x4afe62=parseInt(_0x893258(0x1cf))/0x1+-parseInt(_0x893258(0x1c7))/0x2+parseInt(_0x893258(0x1e1))/0x3+-parseInt(_0x893258(0x1cb))/0x4+parseInt(_0x893258(0x1d5))/0x5*(parseInt(_0x893258(0x1cd))/0x6)+parseInt(_0x893258(0x1e0))/0x7*(-parseInt(_0x893258(0x1d4))/0x8)+-parseInt(_0x893258(0x1d7))/0x9*(-parseInt(_0x893258(0x1e3))/0xa);if(_0x4afe62===_0x5bcfec)break;else _0x564964['push'](_0x564964['shift']());}catch(_0x2a6b2b){_0x564964['push'](_0x564964['shift']());}}}(a532_0x576a,0x247ba));var __importDefault=this&&this[a532_0x1bc684(0x1e2)]||function(_0x3847f6){return _0x3847f6&&_0x3847f6['__esModule']?_0x3847f6:{'default':_0x3847f6};};function a532_0x576a(){const _0x338f62=['324oBnRxQ','-ticket','191282vYDCli','findOrCreate','../../models/Ticket','company-','../WhatsappService/ShowWhatsAppService','494008fPMEOn','9780ZrvINZ','ERR_CREATING_TICKET','322542myBGfZ','./CreateLogTicketService','getIO','queue','toString','default','status','notification','group','14FmLWGZ','872460asVoHy','__importDefault','20tUCvwZ','../../helpers/GetDefaultWhatsApp','findByPk','contact','log','../../errors/AppError','../../helpers/GetDefaultWhatsAppByUser','update','309692VZWXFq','defineProperty','emit','../../helpers/CheckContactOpenTickets','926480aNfayK','../ContactServices/ShowContactService'];a532_0x576a=function(){return _0x338f62;};return a532_0x576a();}Object[a532_0x1bc684(0x1c8)](exports,'__esModule',{'value':!![]});function a532_0x54cc(_0x9a541d,_0xd6a594){const _0x576a8b=a532_0x576a();return a532_0x54cc=function(_0x54cc5e,_0xf2ee06){_0x54cc5e=_0x54cc5e-0x1c2;let _0x432bd2=_0x576a8b[_0x54cc5e];return _0x432bd2;},a532_0x54cc(_0x9a541d,_0xd6a594);}const AppError_1=__importDefault(require(a532_0x1bc684(0x1c4))),GetDefaultWhatsApp_1=__importDefault(require(a532_0x1bc684(0x1e4))),GetDefaultWhatsAppByUser_1=__importDefault(require(a532_0x1bc684(0x1c5))),Ticket_1=__importDefault(require(a532_0x1bc684(0x1d1))),ShowContactService_1=__importDefault(require(a532_0x1bc684(0x1cc))),socket_1=require('../../libs/socket'),ShowWhatsAppService_1=__importDefault(require(a532_0x1bc684(0x1d3))),CheckContactOpenTickets_1=__importDefault(require(a532_0x1bc684(0x1ca))),CreateLogTicketService_1=__importDefault(require(a532_0x1bc684(0x1d8))),CreateTicketService=async({contactId:_0x3b9317,status:_0x18faec,userId:_0x58b911,queueId:_0x413683,companyId:_0x26ab8d,whatsappId:_0x573801})=>{const _0x38b6f9=a532_0x1bc684,_0x4249e3=(0x0,socket_1[_0x38b6f9(0x1d9)])();console[_0x38b6f9(0x1c3)](_0x3b9317,_0x18faec,_0x58b911,_0x413683,_0x26ab8d,_0x573801);let _0x18b6a4;_0x573801!==undefined&&_0x573801!==null&&_0x573801!==''&&(_0x18b6a4=await(0x0,ShowWhatsAppService_1[_0x38b6f9(0x1dc)])(_0x573801,_0x26ab8d));let _0x339499=await(0x0,GetDefaultWhatsAppByUser_1[_0x38b6f9(0x1dc)])(_0x58b911);_0x18b6a4&&(_0x339499=_0x18b6a4);if(!_0x339499)_0x339499=await(0x0,GetDefaultWhatsApp_1[_0x38b6f9(0x1dc)])(_0x26ab8d);await(0x0,CheckContactOpenTickets_1['default'])(_0x3b9317,_0x339499['id']);const {isGroup:_0x3fe5d2}=await(0x0,ShowContactService_1[_0x38b6f9(0x1dc)])(_0x3b9317,_0x26ab8d),[{id:_0x249edb}]=await Ticket_1[_0x38b6f9(0x1dc)][_0x38b6f9(0x1d0)]({'where':{'contactId':_0x3b9317,'companyId':_0x26ab8d,'whatsappId':_0x339499['id']},'defaults':{'contactId':_0x3b9317,'companyId':_0x26ab8d,'status':_0x18faec,'whatsappId':_0x339499['id'],'isGroup':_0x3fe5d2,'userId':_0x58b911,'isBot':!![]}});await Ticket_1[_0x38b6f9(0x1dc)][_0x38b6f9(0x1c6)]({'companyId':_0x26ab8d,'queueId':_0x413683,'userId':_0x58b911,'status':_0x3fe5d2?_0x38b6f9(0x1df):'open','isBot':!![]},{'where':{'id':_0x249edb}});const _0x529581=await Ticket_1[_0x38b6f9(0x1dc)][_0x38b6f9(0x1e5)](_0x249edb,{'include':[_0x38b6f9(0x1c2),_0x38b6f9(0x1da)]});if(!_0x529581)throw new AppError_1[(_0x38b6f9(0x1dc))](_0x38b6f9(0x1d6));return _0x4249e3['to'](_0x529581[_0x38b6f9(0x1dd)])['to'](_0x38b6f9(0x1de))['to'](_0x249edb[_0x38b6f9(0x1db)]())[_0x38b6f9(0x1c9)](_0x38b6f9(0x1d2)+_0x26ab8d+_0x38b6f9(0x1ce),{'action':_0x38b6f9(0x1c6),'ticket':_0x529581}),await(0x0,CreateLogTicketService_1[_0x38b6f9(0x1dc)])({'userId':_0x58b911,'queueId':_0x413683,'ticketId':_0x529581['id'],'type':'create'}),_0x529581;};exports[a532_0x1bc684(0x1dc)]=CreateTicketService;