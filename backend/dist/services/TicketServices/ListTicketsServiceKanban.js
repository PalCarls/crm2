'use strict';const a522_0x1fe5d5=a522_0x294d;(function(_0x382937,_0x868a58){const _0x30ebfb=a522_0x294d,_0x23f568=_0x382937();while(!![]){try{const _0x14383b=-parseInt(_0x30ebfb(0xd6))/0x1*(parseInt(_0x30ebfb(0xcf))/0x2)+parseInt(_0x30ebfb(0xc5))/0x3*(parseInt(_0x30ebfb(0xd8))/0x4)+parseInt(_0x30ebfb(0xce))/0x5+-parseInt(_0x30ebfb(0xc0))/0x6*(parseInt(_0x30ebfb(0xb4))/0x7)+-parseInt(_0x30ebfb(0xc9))/0x8+-parseInt(_0x30ebfb(0xb7))/0x9*(-parseInt(_0x30ebfb(0xbd))/0xa)+-parseInt(_0x30ebfb(0xdb))/0xb*(-parseInt(_0x30ebfb(0xc6))/0xc);if(_0x14383b===_0x868a58)break;else _0x23f568['push'](_0x23f568['shift']());}catch(_0x25109d){_0x23f568['push'](_0x23f568['shift']());}}}(a522_0x138d,0x9fbfa));var __importDefault=this&&this[a522_0x1fe5d5(0xd2)]||function(_0x174a47){return _0x174a47&&_0x174a47['__esModule']?_0x174a47:{'default':_0x174a47};};Object[a522_0x1fe5d5(0xd1)](exports,a522_0x1fe5d5(0xd7),{'value':!![]});function a522_0x294d(_0x71cd49,_0x10c2c5){const _0x138d0c=a522_0x138d();return a522_0x294d=function(_0x294db1,_0x1184d3){_0x294db1=_0x294db1-0xad;let _0x58adb1=_0x138d0c[_0x294db1];return _0x58adb1;},a522_0x294d(_0x71cd49,_0x10c2c5);}const sequelize_1=require('sequelize'),date_fns_1=require('date-fns'),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a522_0x1fe5d5(0xae))),Message_1=__importDefault(require(a522_0x1fe5d5(0xc3))),Queue_1=__importDefault(require(a522_0x1fe5d5(0xdf))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require(a522_0x1fe5d5(0xde))),Tag_1=__importDefault(require(a522_0x1fe5d5(0xd5))),TicketTag_1=__importDefault(require(a522_0x1fe5d5(0xcc))),lodash_1=require(a522_0x1fe5d5(0xad)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x281eed,tags:_0x561577,users:_0x34076f,status:_0x15deda,date:_0x93477a,updatedAt:_0x252d40,showAll:_0x18d9f0,userId:_0x18cc6a,withUnreadMessages:_0x58cbe1,companyId:_0x31ab40})=>{const _0xba262a=a522_0x1fe5d5;let _0x4abd94={[sequelize_1['Op']['or']]:[{'userId':_0x18cc6a},{'status':_0xba262a(0xe2)}],'queueId':{[sequelize_1['Op']['or']]:[_0x281eed,null]}},_0xa7cf29;_0xa7cf29=[{'model':Contact_1[_0xba262a(0xb8)],'as':'contact','attributes':['id','name','number',_0xba262a(0xb5)]},{'model':Queue_1['default'],'as':_0xba262a(0xb9),'attributes':['id',_0xba262a(0xda),'color']},{'model':User_1[_0xba262a(0xb8)],'as':_0xba262a(0xbf),'attributes':['id',_0xba262a(0xda)]},{'model':Tag_1['default'],'as':_0xba262a(0xdc),'attributes':['id',_0xba262a(0xda),_0xba262a(0xbe)]},{'model':Whatsapp_1[_0xba262a(0xb8)],'as':'whatsapp','attributes':[_0xba262a(0xda)]}];_0x18d9f0===_0xba262a(0xd4)&&(_0x4abd94={'queueId':{[sequelize_1['Op']['or']]:[_0x281eed,null]}});_0x4abd94={..._0x4abd94,'status':{[sequelize_1['Op']['or']]:[_0xba262a(0xe2),_0xba262a(0xd3)]}};if(searchParam){const _0x5da288=searchParam['toLocaleLowerCase']()[_0xba262a(0xb3)]();_0xa7cf29=[..._0xa7cf29,{'model':Message_1[_0xba262a(0xb8)],'as':'messages','attributes':['id',_0xba262a(0xd0)],'where':{'body':(0x0,sequelize_1[_0xba262a(0xb0)])((0x0,sequelize_1['fn'])(_0xba262a(0xc8),(0x0,sequelize_1['col'])(_0xba262a(0xd0))),_0xba262a(0xdd),'%'+_0x5da288+'%')},'required':![],'duplicating':![]}],_0x4abd94={..._0x4abd94,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0xba262a(0xb0)])((0x0,sequelize_1['fn'])(_0xba262a(0xc8),(0x0,sequelize_1['col'])(_0xba262a(0xaf))),_0xba262a(0xdd),'%'+_0x5da288+'%')},{'$contact.number$':{[sequelize_1['Op'][_0xba262a(0xc1)]]:'%'+_0x5da288+'%'}},{'$message.body$':(0x0,sequelize_1[_0xba262a(0xb0)])((0x0,sequelize_1['fn'])(_0xba262a(0xc8),(0x0,sequelize_1[_0xba262a(0xb1)])(_0xba262a(0xd0))),_0xba262a(0xdd),'%'+_0x5da288+'%')}]};}_0x93477a&&(_0x4abd94={'createdAt':{[sequelize_1['Op'][_0xba262a(0xca)]]:[+(0x0,date_fns_1[_0xba262a(0xe1)])((0x0,date_fns_1[_0xba262a(0xc2)])(_0x93477a)),+(0x0,date_fns_1[_0xba262a(0xd9)])((0x0,date_fns_1[_0xba262a(0xc2)])(_0x93477a))]}});_0x252d40&&(_0x4abd94={'updatedAt':{[sequelize_1['Op'][_0xba262a(0xca)]]:[+(0x0,date_fns_1[_0xba262a(0xe1)])((0x0,date_fns_1[_0xba262a(0xc2)])(_0x252d40)),+(0x0,date_fns_1[_0xba262a(0xd9)])((0x0,date_fns_1[_0xba262a(0xc2)])(_0x252d40))]}});if(_0x58cbe1===_0xba262a(0xd4)){const _0x518dd6=await(0x0,ShowUserService_1[_0xba262a(0xb8)])(_0x18cc6a),_0x396298=_0x518dd6[_0xba262a(0xb2)][_0xba262a(0xbb)](_0x54255a=>_0x54255a['id']);_0x4abd94={[sequelize_1['Op']['or']]:[{'userId':_0x18cc6a},{'status':_0xba262a(0xe2)}],'queueId':{[sequelize_1['Op']['or']]:[_0x396298,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0xba262a(0xba)](_0x561577)&&_0x561577['length']>0x0){const _0x975409=[];for(let _0x4e0bd6 of _0x561577){const _0x69958f=await TicketTag_1[_0xba262a(0xb8)]['findAll']({'where':{'tagId':_0x4e0bd6}});_0x69958f&&_0x975409[_0xba262a(0xe0)](_0x69958f['map'](_0x4e04f3=>_0x4e04f3[_0xba262a(0xcd)]));}const _0xd155f0=(0x0,lodash_1['intersection'])(..._0x975409);_0x4abd94={..._0x4abd94,'id':{[sequelize_1['Op']['in']]:_0xd155f0}};}if(Array[_0xba262a(0xba)](_0x34076f)&&_0x34076f[_0xba262a(0xc7)]>0x0){const _0x422823=[];for(let _0x569870 of _0x34076f){const _0x498058=await Ticket_1['default'][_0xba262a(0xc4)]({'where':{'userId':_0x569870}});_0x498058&&_0x422823[_0xba262a(0xe0)](_0x498058[_0xba262a(0xbb)](_0x472e98=>_0x472e98['id']));}const _0x3c90c0=(0x0,lodash_1[_0xba262a(0xbc)])(..._0x422823);_0x4abd94={..._0x4abd94,'id':{[sequelize_1['Op']['in']]:_0x3c90c0}};}const _0x39feab=0x28,_0xbf3c72=_0x39feab*(+pageNumber-0x1);_0x4abd94={..._0x4abd94,'companyId':_0x31ab40};const {count:_0x261da1,rows:_0x2317d1}=await Ticket_1[_0xba262a(0xb8)][_0xba262a(0xcb)]({'where':_0x4abd94,'include':_0xa7cf29,'distinct':!![],'limit':_0x39feab,'offset':_0xbf3c72,'order':[[_0xba262a(0xb6),'DESC']],'subQuery':![]}),_0x5ffa4d=_0x261da1>_0xbf3c72+_0x2317d1[_0xba262a(0xc7)];return{'tickets':_0x2317d1,'count':_0x261da1,'hasMore':_0x5ffa4d};};exports[a522_0x1fe5d5(0xb8)]=ListTicketsServiceKanban;function a522_0x138d(){const _0x43e56d=['../../models/Message','findAll','9KjMjJA','135948NNVccz','length','LOWER','6889928gFRYtD','between','findAndCountAll','../../models/TicketTag','ticketId','1684675bRXjwr','52mvroBo','body','defineProperty','__importDefault','open','true','../../models/Tag','37068pAVfRd','__esModule','174164IXBLhD','endOfDay','name','1408cPODjy','tags','LIKE','../UserServices/ShowUserService','../../models/Queue','push','startOfDay','pending','lodash','../../models/Contact','contact.name','where','col','queues','trim','7VaOPYu','email','updatedAt','711rwToah','default','queue','isArray','map','intersection','156580oIxJLQ','color','user','4051878klUUye','like','parseISO'];a522_0x138d=function(){return _0x43e56d;};return a522_0x138d();}