'use strict';const a595_0x761b9b=a595_0x552f;(function(_0x54f6a8,_0x53854f){const _0x5d5b41=a595_0x552f,_0x522d89=_0x54f6a8();while(!![]){try{const _0x104ecc=-parseInt(_0x5d5b41(0xcf))/0x1*(-parseInt(_0x5d5b41(0xe3))/0x2)+parseInt(_0x5d5b41(0xf6))/0x3+parseInt(_0x5d5b41(0xd9))/0x4+parseInt(_0x5d5b41(0xd2))/0x5*(parseInt(_0x5d5b41(0xf1))/0x6)+-parseInt(_0x5d5b41(0xd8))/0x7+-parseInt(_0x5d5b41(0xdc))/0x8+parseInt(_0x5d5b41(0xcc))/0x9*(-parseInt(_0x5d5b41(0xfe))/0xa);if(_0x104ecc===_0x53854f)break;else _0x522d89['push'](_0x522d89['shift']());}catch(_0x3a9e40){_0x522d89['push'](_0x522d89['shift']());}}}(a595_0x1ed6,0x186f8));var __importDefault=this&&this[a595_0x761b9b(0xcb)]||function(_0x25250f){return _0x25250f&&_0x25250f['__esModule']?_0x25250f:{'default':_0x25250f};};Object[a595_0x761b9b(0xf3)](exports,a595_0x761b9b(0xd1),{'value':!![]});const sequelize_1=require(a595_0x761b9b(0xc9)),date_fns_1=require(a595_0x761b9b(0xca)),Ticket_1=__importDefault(require(a595_0x761b9b(0xef))),Contact_1=__importDefault(require(a595_0x761b9b(0xd3))),Message_1=__importDefault(require(a595_0x761b9b(0xfb))),Queue_1=__importDefault(require(a595_0x761b9b(0xeb))),User_1=__importDefault(require(a595_0x761b9b(0xe2))),ShowUserService_1=__importDefault(require(a595_0x761b9b(0xe7))),Tag_1=__importDefault(require(a595_0x761b9b(0xd4))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require(a595_0x761b9b(0xff)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x5b58de,tags:_0x3e0818,users:_0x36a3ee,status:_0x418141,date:_0x23916b,updatedAt:_0x29967d,showAll:_0x3186c6,userId:_0x8a00ba,withUnreadMessages:_0x2ade4f,companyId:_0x36a981})=>{const _0x246a3f=a595_0x761b9b;let _0x2cbaf0={[sequelize_1['Op']['or']]:[{'userId':_0x8a00ba},{'status':_0x246a3f(0xdb)}],'queueId':{[sequelize_1['Op']['or']]:[_0x5b58de,null]}},_0x3b0e81;_0x3b0e81=[{'model':Contact_1[_0x246a3f(0xed)],'as':_0x246a3f(0xe1),'attributes':['id','name','number',_0x246a3f(0xe8),'companyId','urlPicture']},{'model':Queue_1[_0x246a3f(0xed)],'as':_0x246a3f(0xf0),'attributes':['id',_0x246a3f(0xf7),_0x246a3f(0xea)]},{'model':User_1[_0x246a3f(0xed)],'as':_0x246a3f(0xdd),'attributes':['id',_0x246a3f(0xf7)]},{'model':Tag_1[_0x246a3f(0xed)],'as':_0x246a3f(0xee),'attributes':['id',_0x246a3f(0xf7),_0x246a3f(0xea)]},{'model':Whatsapp_1[_0x246a3f(0xed)],'as':_0x246a3f(0xfc),'attributes':['name']}];_0x3186c6===_0x246a3f(0xfa)&&(_0x2cbaf0={'queueId':{[sequelize_1['Op']['or']]:[_0x5b58de,null]}});_0x2cbaf0={..._0x2cbaf0,'status':{[sequelize_1['Op']['or']]:[_0x246a3f(0xdb),'open']}};if(searchParam){const _0x5b329a=searchParam[_0x246a3f(0xf5)]()[_0x246a3f(0xe9)]();_0x3b0e81=[..._0x3b0e81,{'model':Message_1[_0x246a3f(0xed)],'as':_0x246a3f(0xe4),'attributes':['id',_0x246a3f(0xf2)],'where':{'body':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x246a3f(0xe5),(0x0,sequelize_1[_0x246a3f(0xda)])(_0x246a3f(0xf2))),_0x246a3f(0xe0),'%'+_0x5b329a+'%')},'required':![],'duplicating':![]}],_0x2cbaf0={..._0x2cbaf0,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x246a3f(0xda)])(_0x246a3f(0xf4))),_0x246a3f(0xe0),'%'+_0x5b329a+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x246a3f(0xcd)]]:'%'+_0x5b329a+'%'}},{'$message.body$':(0x0,sequelize_1[_0x246a3f(0xd0)])((0x0,sequelize_1['fn'])(_0x246a3f(0xe5),(0x0,sequelize_1[_0x246a3f(0xda)])(_0x246a3f(0xf2))),_0x246a3f(0xe0),'%'+_0x5b329a+'%')}]};}_0x23916b&&(_0x2cbaf0={'createdAt':{[sequelize_1['Op'][_0x246a3f(0xdf)]]:[+(0x0,date_fns_1[_0x246a3f(0xde)])((0x0,date_fns_1['parseISO'])(_0x23916b)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x246a3f(0x100)])(_0x23916b))]}});_0x29967d&&(_0x2cbaf0={'updatedAt':{[sequelize_1['Op'][_0x246a3f(0xdf)]]:[+(0x0,date_fns_1[_0x246a3f(0xde)])((0x0,date_fns_1['parseISO'])(_0x29967d)),+(0x0,date_fns_1[_0x246a3f(0xd7)])((0x0,date_fns_1[_0x246a3f(0x100)])(_0x29967d))]}});if(_0x2ade4f===_0x246a3f(0xfa)){const _0xf23766=await(0x0,ShowUserService_1[_0x246a3f(0xed)])(_0x8a00ba,_0x36a981),_0x59a85c=_0xf23766[_0x246a3f(0xec)][_0x246a3f(0xf8)](_0x3fe7f1=>_0x3fe7f1['id']);_0x2cbaf0={[sequelize_1['Op']['or']]:[{'userId':_0x8a00ba},{'status':_0x246a3f(0xdb)}],'queueId':{[sequelize_1['Op']['or']]:[_0x59a85c,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array['isArray'](_0x3e0818)&&_0x3e0818[_0x246a3f(0xfd)]>0x0){const _0x4ce870=[];for(let _0x2765a3 of _0x3e0818){const _0x3cf1fd=await TicketTag_1[_0x246a3f(0xed)][_0x246a3f(0xce)]({'where':{'tagId':_0x2765a3}});_0x3cf1fd&&_0x4ce870[_0x246a3f(0xe6)](_0x3cf1fd['map'](_0x419422=>_0x419422[_0x246a3f(0xf9)]));}const _0x14e0fa=(0x0,lodash_1['intersection'])(..._0x4ce870);_0x2cbaf0={..._0x2cbaf0,'id':{[sequelize_1['Op']['in']]:_0x14e0fa}};}if(Array[_0x246a3f(0xd5)](_0x36a3ee)&&_0x36a3ee[_0x246a3f(0xfd)]>0x0){const _0x3c676c=[];for(let _0x1f307c of _0x36a3ee){const _0x85a057=await Ticket_1[_0x246a3f(0xed)]['findAll']({'where':{'userId':_0x1f307c}});_0x85a057&&_0x3c676c[_0x246a3f(0xe6)](_0x85a057[_0x246a3f(0xf8)](_0x3b1600=>_0x3b1600['id']));}const _0x1e1e6d=(0x0,lodash_1['intersection'])(..._0x3c676c);_0x2cbaf0={..._0x2cbaf0,'id':{[sequelize_1['Op']['in']]:_0x1e1e6d}};}const _0x11d6e3=0x28,_0x190aef=_0x11d6e3*(+pageNumber-0x1);_0x2cbaf0={..._0x2cbaf0,'companyId':_0x36a981};const {count:_0x1eb638,rows:_0x247314}=await Ticket_1[_0x246a3f(0xed)][_0x246a3f(0xd6)]({'where':_0x2cbaf0,'include':_0x3b0e81,'distinct':!![],'limit':_0x11d6e3,'offset':_0x190aef,'order':[[_0x246a3f(0x101),'DESC']],'subQuery':![]}),_0x3cb7d8=_0x1eb638>_0x190aef+_0x247314['length'];return{'tickets':_0x247314,'count':_0x1eb638,'hasMore':_0x3cb7d8};};function a595_0x1ed6(){const _0x483d58=['messages','LOWER','push','../UserServices/ShowUserService','email','trim','color','../../models/Queue','queues','default','tags','../../models/Ticket','queue','282dcRVsK','body','defineProperty','contact.name','toLocaleLowerCase','355110KYPcGt','name','map','ticketId','true','../../models/Message','whatsapp','length','80fwiwxJ','lodash','parseISO','updatedAt','sequelize','date-fns','__importDefault','41229iWktQn','like','findAll','138038ZrFVdZ','where','__esModule','5345KYJYdo','../../models/Contact','../../models/Tag','isArray','findAndCountAll','endOfDay','955150OyCPQl','618784PmsMmT','col','pending','1505288NPmKgt','user','startOfDay','between','LIKE','contact','../../models/User','2hUZeHK'];a595_0x1ed6=function(){return _0x483d58;};return a595_0x1ed6();}function a595_0x552f(_0x450d1c,_0x49d98f){const _0x1ed613=a595_0x1ed6();return a595_0x552f=function(_0x552fe6,_0x2a685f){_0x552fe6=_0x552fe6-0xc9;let _0xfd7b6e=_0x1ed613[_0x552fe6];return _0xfd7b6e;},a595_0x552f(_0x450d1c,_0x49d98f);}exports[a595_0x761b9b(0xed)]=ListTicketsServiceKanban;