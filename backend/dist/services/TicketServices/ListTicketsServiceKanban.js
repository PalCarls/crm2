'use strict';function a595_0x342d(_0x1fb84c,_0x3b98f2){const _0x458825=a595_0x4588();return a595_0x342d=function(_0x342ddd,_0xc124ee){_0x342ddd=_0x342ddd-0xf2;let _0x2d6fd7=_0x458825[_0x342ddd];return _0x2d6fd7;},a595_0x342d(_0x1fb84c,_0x3b98f2);}function a595_0x4588(){const _0x4e7c89=['573246hVOgWr','2645816dluOEu','contact.name','intersection','../../models/Tag','lodash','577580aMWLZv','parseISO','ticketId','name','date-fns','like','__esModule','col','where','body','../../models/Queue','../../models/Contact','6yCpvLn','tags','between','map','endOfDay','../UserServices/ShowUserService','../../models/User','../../models/Ticket','email','sequelize','2262330yqwJDl','pending','104009DPSfOt','urlPicture','toLocaleLowerCase','81xtjgwt','push','default','length','../../models/Whatsapp','DESC','LIKE','LOWER','contact','42965VnVGJA','defineProperty','findAll','isArray','updatedAt','1281948JJyXtq','startOfDay','12nsGuEe','color'];a595_0x4588=function(){return _0x4e7c89;};return a595_0x4588();}const a595_0x22eb77=a595_0x342d;(function(_0x2627ab,_0x4ae399){const _0x110ce9=a595_0x342d,_0x41c4f2=_0x2627ab();while(!![]){try{const _0x434895=parseInt(_0x110ce9(0x101))/0x1*(parseInt(_0x110ce9(0xf5))/0x2)+parseInt(_0x110ce9(0x112))/0x3+parseInt(_0x110ce9(0x114))/0x4*(-parseInt(_0x110ce9(0x10d))/0x5)+parseInt(_0x110ce9(0x116))/0x6+parseInt(_0x110ce9(0xff))/0x7+-parseInt(_0x110ce9(0x117))/0x8+-parseInt(_0x110ce9(0x104))/0x9*(parseInt(_0x110ce9(0x11c))/0xa);if(_0x434895===_0x4ae399)break;else _0x41c4f2['push'](_0x41c4f2['shift']());}catch(_0x5e564f){_0x41c4f2['push'](_0x41c4f2['shift']());}}}(a595_0x4588,0x44c92));var __importDefault=this&&this['__importDefault']||function(_0x2fac45){const _0x57d9b6=a595_0x342d;return _0x2fac45&&_0x2fac45[_0x57d9b6(0x122)]?_0x2fac45:{'default':_0x2fac45};};Object[a595_0x22eb77(0x10e)](exports,a595_0x22eb77(0x122),{'value':!![]});const sequelize_1=require(a595_0x22eb77(0xfe)),date_fns_1=require(a595_0x22eb77(0x120)),Ticket_1=__importDefault(require(a595_0x22eb77(0xfc))),Contact_1=__importDefault(require(a595_0x22eb77(0xf4))),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require(a595_0x22eb77(0xf3))),User_1=__importDefault(require(a595_0x22eb77(0xfb))),ShowUserService_1=__importDefault(require(a595_0x22eb77(0xfa))),Tag_1=__importDefault(require(a595_0x22eb77(0x11a))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require(a595_0x22eb77(0x11b)),Whatsapp_1=__importDefault(require(a595_0x22eb77(0x108))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x3eddbe,tags:_0x1c472e,users:_0x916d93,status:_0x596a78,date:_0x463199,updatedAt:_0x5bbdbb,showAll:_0x1dce92,userId:_0xd228f9,withUnreadMessages:_0x583e25,companyId:_0x1be196})=>{const _0x35cfa6=a595_0x22eb77;let _0x1c9d4e={[sequelize_1['Op']['or']]:[{'userId':_0xd228f9},{'status':_0x35cfa6(0x100)}],'queueId':{[sequelize_1['Op']['or']]:[_0x3eddbe,null]}},_0x54934f;_0x54934f=[{'model':Contact_1[_0x35cfa6(0x106)],'as':_0x35cfa6(0x10c),'attributes':['id',_0x35cfa6(0x11f),'number',_0x35cfa6(0xfd),'companyId',_0x35cfa6(0x102)]},{'model':Queue_1[_0x35cfa6(0x106)],'as':'queue','attributes':['id',_0x35cfa6(0x11f),_0x35cfa6(0x115)]},{'model':User_1[_0x35cfa6(0x106)],'as':'user','attributes':['id',_0x35cfa6(0x11f)]},{'model':Tag_1['default'],'as':_0x35cfa6(0xf6),'attributes':['id',_0x35cfa6(0x11f),_0x35cfa6(0x115)]},{'model':Whatsapp_1[_0x35cfa6(0x106)],'as':'whatsapp','attributes':[_0x35cfa6(0x11f)]}];_0x1dce92==='true'&&(_0x1c9d4e={'queueId':{[sequelize_1['Op']['or']]:[_0x3eddbe,null]}});_0x1c9d4e={..._0x1c9d4e,'status':{[sequelize_1['Op']['or']]:[_0x35cfa6(0x100),'open']}};if(searchParam){const _0x572130=searchParam[_0x35cfa6(0x103)]()['trim']();_0x54934f=[..._0x54934f,{'model':Message_1[_0x35cfa6(0x106)],'as':'messages','attributes':['id',_0x35cfa6(0xf2)],'where':{'body':(0x0,sequelize_1[_0x35cfa6(0x124)])((0x0,sequelize_1['fn'])(_0x35cfa6(0x10b),(0x0,sequelize_1[_0x35cfa6(0x123)])('body')),_0x35cfa6(0x10a),'%'+_0x572130+'%')},'required':![],'duplicating':![]}],_0x1c9d4e={..._0x1c9d4e,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x35cfa6(0x124)])((0x0,sequelize_1['fn'])(_0x35cfa6(0x10b),(0x0,sequelize_1[_0x35cfa6(0x123)])(_0x35cfa6(0x118))),'LIKE','%'+_0x572130+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x35cfa6(0x121)]]:'%'+_0x572130+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x35cfa6(0x10b),(0x0,sequelize_1[_0x35cfa6(0x123)])(_0x35cfa6(0xf2))),_0x35cfa6(0x10a),'%'+_0x572130+'%')}]};}_0x463199&&(_0x1c9d4e={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x35cfa6(0x113)])((0x0,date_fns_1[_0x35cfa6(0x11d)])(_0x463199)),+(0x0,date_fns_1[_0x35cfa6(0xf9)])((0x0,date_fns_1[_0x35cfa6(0x11d)])(_0x463199))]}});_0x5bbdbb&&(_0x1c9d4e={'updatedAt':{[sequelize_1['Op'][_0x35cfa6(0xf7)]]:[+(0x0,date_fns_1[_0x35cfa6(0x113)])((0x0,date_fns_1[_0x35cfa6(0x11d)])(_0x5bbdbb)),+(0x0,date_fns_1[_0x35cfa6(0xf9)])((0x0,date_fns_1[_0x35cfa6(0x11d)])(_0x5bbdbb))]}});if(_0x583e25==='true'){const _0x276d33=await(0x0,ShowUserService_1['default'])(_0xd228f9,_0x1be196),_0x585aae=_0x276d33['queues'][_0x35cfa6(0xf8)](_0x4c4110=>_0x4c4110['id']);_0x1c9d4e={[sequelize_1['Op']['or']]:[{'userId':_0xd228f9},{'status':_0x35cfa6(0x100)}],'queueId':{[sequelize_1['Op']['or']]:[_0x585aae,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x35cfa6(0x110)](_0x1c472e)&&_0x1c472e[_0x35cfa6(0x107)]>0x0){const _0x8b7f5c=[];for(let _0x3dadf0 of _0x1c472e){const _0x5158a8=await TicketTag_1['default']['findAll']({'where':{'tagId':_0x3dadf0}});_0x5158a8&&_0x8b7f5c[_0x35cfa6(0x105)](_0x5158a8[_0x35cfa6(0xf8)](_0x5b3b1a=>_0x5b3b1a[_0x35cfa6(0x11e)]));}const _0x302ea2=(0x0,lodash_1[_0x35cfa6(0x119)])(..._0x8b7f5c);_0x1c9d4e={..._0x1c9d4e,'id':{[sequelize_1['Op']['in']]:_0x302ea2}};}if(Array[_0x35cfa6(0x110)](_0x916d93)&&_0x916d93['length']>0x0){const _0x466c81=[];for(let _0x3d7764 of _0x916d93){const _0x2de8be=await Ticket_1[_0x35cfa6(0x106)][_0x35cfa6(0x10f)]({'where':{'userId':_0x3d7764}});_0x2de8be&&_0x466c81['push'](_0x2de8be[_0x35cfa6(0xf8)](_0x5c774a=>_0x5c774a['id']));}const _0x3c4326=(0x0,lodash_1['intersection'])(..._0x466c81);_0x1c9d4e={..._0x1c9d4e,'id':{[sequelize_1['Op']['in']]:_0x3c4326}};}const _0x5dcdf2=0x28,_0x4ec29c=_0x5dcdf2*(+pageNumber-0x1);_0x1c9d4e={..._0x1c9d4e,'companyId':_0x1be196};const {count:_0x3acc0d,rows:_0x3204da}=await Ticket_1[_0x35cfa6(0x106)]['findAndCountAll']({'where':_0x1c9d4e,'include':_0x54934f,'distinct':!![],'limit':_0x5dcdf2,'offset':_0x4ec29c,'order':[[_0x35cfa6(0x111),_0x35cfa6(0x109)]],'subQuery':![]}),_0x1d5e78=_0x3acc0d>_0x4ec29c+_0x3204da[_0x35cfa6(0x107)];return{'tickets':_0x3204da,'count':_0x3acc0d,'hasMore':_0x1d5e78};};exports[a595_0x22eb77(0x106)]=ListTicketsServiceKanban;