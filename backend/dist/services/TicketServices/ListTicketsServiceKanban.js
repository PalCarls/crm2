'use strict';const a584_0x570dbe=a584_0x4ce0;(function(_0x3e644a,_0x2816cd){const _0x4ea001=a584_0x4ce0,_0x58cfb2=_0x3e644a();while(!![]){try{const _0x31a63e=-parseInt(_0x4ea001(0xbe))/0x1+parseInt(_0x4ea001(0x96))/0x2*(parseInt(_0x4ea001(0xc2))/0x3)+-parseInt(_0x4ea001(0xab))/0x4*(-parseInt(_0x4ea001(0xbc))/0x5)+-parseInt(_0x4ea001(0xb4))/0x6*(parseInt(_0x4ea001(0xc1))/0x7)+parseInt(_0x4ea001(0xc3))/0x8+-parseInt(_0x4ea001(0xbf))/0x9*(-parseInt(_0x4ea001(0xa9))/0xa)+-parseInt(_0x4ea001(0xc7))/0xb*(-parseInt(_0x4ea001(0xa8))/0xc);if(_0x31a63e===_0x2816cd)break;else _0x58cfb2['push'](_0x58cfb2['shift']());}catch(_0x1dc356){_0x58cfb2['push'](_0x58cfb2['shift']());}}}(a584_0xe3ec,0x2de20));function a584_0xe3ec(){const _0x71cf1a=['true','__esModule','push','contact.name','toLocaleLowerCase','4368OweVBN','306980NNUdNT','color','4gkdkST','email','open','trim','updatedAt','map','messages','LOWER','isArray','5658vTNtvt','../../models/User','queue','default','sequelize','companyId','pending','intersection','50705TjYPPn','length','293394YnDXOj','81dZBTna','queues','1659tMOedC','21njCYhS','1048776HvTDYz','between','where','LIKE','7502QgMUeX','findAll','../../models/Message','number','11158RTEhby','parseISO','endOfDay','../../models/Ticket','../UserServices/ShowUserService','body','defineProperty','../../models/Tag','startOfDay','tags','col','whatsapp','name'];a584_0xe3ec=function(){return _0x71cf1a;};return a584_0xe3ec();}function a584_0x4ce0(_0x46471a,_0x45668d){const _0xe3ec51=a584_0xe3ec();return a584_0x4ce0=function(_0x4ce0f6,_0x4965da){_0x4ce0f6=_0x4ce0f6-0x95;let _0x5cbc19=_0xe3ec51[_0x4ce0f6];return _0x5cbc19;},a584_0x4ce0(_0x46471a,_0x45668d);}var __importDefault=this&&this['__importDefault']||function(_0x218467){const _0x40c52c=a584_0x4ce0;return _0x218467&&_0x218467[_0x40c52c(0xa4)]?_0x218467:{'default':_0x218467};};Object[a584_0x570dbe(0x9c)](exports,a584_0x570dbe(0xa4),{'value':!![]});const sequelize_1=require(a584_0x570dbe(0xb8)),date_fns_1=require('date-fns'),Ticket_1=__importDefault(require(a584_0x570dbe(0x99))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a584_0x570dbe(0xc9))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a584_0x570dbe(0xb5))),ShowUserService_1=__importDefault(require(a584_0x570dbe(0x9a))),Tag_1=__importDefault(require(a584_0x570dbe(0x9d))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x10c2c8,tags:_0x22d435,users:_0x53e18f,status:_0xee8a74,date:_0x13f40f,updatedAt:_0x2774d6,showAll:_0xb1d7cd,userId:_0x3fc847,withUnreadMessages:_0x3f5e13,companyId:_0x19d985})=>{const _0x504a15=a584_0x570dbe;let _0x51fb55={[sequelize_1['Op']['or']]:[{'userId':_0x3fc847},{'status':_0x504a15(0xba)}],'queueId':{[sequelize_1['Op']['or']]:[_0x10c2c8,null]}},_0x11d081;_0x11d081=[{'model':Contact_1[_0x504a15(0xb7)],'as':'contact','attributes':['id','name',_0x504a15(0x95),_0x504a15(0xac),_0x504a15(0xb9),'urlPicture']},{'model':Queue_1[_0x504a15(0xb7)],'as':_0x504a15(0xb6),'attributes':['id',_0x504a15(0xa2),_0x504a15(0xaa)]},{'model':User_1['default'],'as':'user','attributes':['id',_0x504a15(0xa2)]},{'model':Tag_1[_0x504a15(0xb7)],'as':_0x504a15(0x9f),'attributes':['id',_0x504a15(0xa2),_0x504a15(0xaa)]},{'model':Whatsapp_1[_0x504a15(0xb7)],'as':_0x504a15(0xa1),'attributes':['name']}];_0xb1d7cd==='true'&&(_0x51fb55={'queueId':{[sequelize_1['Op']['or']]:[_0x10c2c8,null]}});_0x51fb55={..._0x51fb55,'status':{[sequelize_1['Op']['or']]:[_0x504a15(0xba),_0x504a15(0xad)]}};if(searchParam){const _0x1d854b=searchParam[_0x504a15(0xa7)]()[_0x504a15(0xae)]();_0x11d081=[..._0x11d081,{'model':Message_1[_0x504a15(0xb7)],'as':_0x504a15(0xb1),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x504a15(0xc5)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x504a15(0xa0)])(_0x504a15(0x9b))),'LIKE','%'+_0x1d854b+'%')},'required':![],'duplicating':![]}],_0x51fb55={..._0x51fb55,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x504a15(0xc5)])((0x0,sequelize_1['fn'])(_0x504a15(0xb2),(0x0,sequelize_1[_0x504a15(0xa0)])(_0x504a15(0xa6))),_0x504a15(0xc6),'%'+_0x1d854b+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x1d854b+'%'}},{'$message.body$':(0x0,sequelize_1[_0x504a15(0xc5)])((0x0,sequelize_1['fn'])(_0x504a15(0xb2),(0x0,sequelize_1['col'])(_0x504a15(0x9b))),_0x504a15(0xc6),'%'+_0x1d854b+'%')}]};}_0x13f40f&&(_0x51fb55={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x504a15(0x9e)])((0x0,date_fns_1[_0x504a15(0x97)])(_0x13f40f)),+(0x0,date_fns_1[_0x504a15(0x98)])((0x0,date_fns_1[_0x504a15(0x97)])(_0x13f40f))]}});_0x2774d6&&(_0x51fb55={'updatedAt':{[sequelize_1['Op'][_0x504a15(0xc4)]]:[+(0x0,date_fns_1[_0x504a15(0x9e)])((0x0,date_fns_1[_0x504a15(0x97)])(_0x2774d6)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1['parseISO'])(_0x2774d6))]}});if(_0x3f5e13===_0x504a15(0xa3)){const _0x269ec1=await(0x0,ShowUserService_1[_0x504a15(0xb7)])(_0x3fc847,_0x19d985),_0x55ff9=_0x269ec1[_0x504a15(0xc0)][_0x504a15(0xb0)](_0x36de80=>_0x36de80['id']);_0x51fb55={[sequelize_1['Op']['or']]:[{'userId':_0x3fc847},{'status':_0x504a15(0xba)}],'queueId':{[sequelize_1['Op']['or']]:[_0x55ff9,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array['isArray'](_0x22d435)&&_0x22d435[_0x504a15(0xbd)]>0x0){const _0x2c002d=[];for(let _0x464d1f of _0x22d435){const _0x2a46d2=await TicketTag_1[_0x504a15(0xb7)][_0x504a15(0xc8)]({'where':{'tagId':_0x464d1f}});_0x2a46d2&&_0x2c002d['push'](_0x2a46d2['map'](_0x3bb5e3=>_0x3bb5e3['ticketId']));}const _0x26c4e9=(0x0,lodash_1[_0x504a15(0xbb)])(..._0x2c002d);_0x51fb55={..._0x51fb55,'id':{[sequelize_1['Op']['in']]:_0x26c4e9}};}if(Array[_0x504a15(0xb3)](_0x53e18f)&&_0x53e18f[_0x504a15(0xbd)]>0x0){const _0x540cde=[];for(let _0x576529 of _0x53e18f){const _0x586253=await Ticket_1['default']['findAll']({'where':{'userId':_0x576529}});_0x586253&&_0x540cde[_0x504a15(0xa5)](_0x586253[_0x504a15(0xb0)](_0x2a9132=>_0x2a9132['id']));}const _0x3f6e47=(0x0,lodash_1[_0x504a15(0xbb)])(..._0x540cde);_0x51fb55={..._0x51fb55,'id':{[sequelize_1['Op']['in']]:_0x3f6e47}};}const _0x3b6e4d=0x28,_0x3d64ad=_0x3b6e4d*(+pageNumber-0x1);_0x51fb55={..._0x51fb55,'companyId':_0x19d985};const {count:_0x21c93f,rows:_0x985303}=await Ticket_1[_0x504a15(0xb7)]['findAndCountAll']({'where':_0x51fb55,'include':_0x11d081,'distinct':!![],'limit':_0x3b6e4d,'offset':_0x3d64ad,'order':[[_0x504a15(0xaf),'DESC']],'subQuery':![]}),_0x3f8fb9=_0x21c93f>_0x3d64ad+_0x985303[_0x504a15(0xbd)];return{'tickets':_0x985303,'count':_0x21c93f,'hasMore':_0x3f8fb9};};exports['default']=ListTicketsServiceKanban;