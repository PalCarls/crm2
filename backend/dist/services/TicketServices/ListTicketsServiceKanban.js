'use strict';const a538_0xbcfbc6=a538_0xb5ca;(function(_0x59de4f,_0x1f563a){const _0x1d4a11=a538_0xb5ca,_0x3313b2=_0x59de4f();while(!![]){try{const _0x12676d=-parseInt(_0x1d4a11(0xe8))/0x1*(-parseInt(_0x1d4a11(0xf6))/0x2)+-parseInt(_0x1d4a11(0xe0))/0x3*(parseInt(_0x1d4a11(0x100))/0x4)+parseInt(_0x1d4a11(0xf7))/0x5+-parseInt(_0x1d4a11(0xec))/0x6*(-parseInt(_0x1d4a11(0x114))/0x7)+parseInt(_0x1d4a11(0x10f))/0x8+parseInt(_0x1d4a11(0x102))/0x9+parseInt(_0x1d4a11(0xfa))/0xa*(-parseInt(_0x1d4a11(0xee))/0xb);if(_0x12676d===_0x1f563a)break;else _0x3313b2['push'](_0x3313b2['shift']());}catch(_0x5c7817){_0x3313b2['push'](_0x3313b2['shift']());}}}(a538_0x4eae,0xcb45b));var __importDefault=this&&this[a538_0xbcfbc6(0xe7)]||function(_0x4dda2f){return _0x4dda2f&&_0x4dda2f['__esModule']?_0x4dda2f:{'default':_0x4dda2f};};function a538_0x4eae(){const _0x1054ff=['__importDefault','93601xBDiRl','isArray','../../models/User','open','62058ctbXTb','../../models/Whatsapp','6208026WFaqoh','../../models/Contact','LIKE','defineProperty','lodash','messages','findAll','intersection','14VTVWFG','2513670RByCtt','between','updatedAt','20sjBACz','col','findAndCountAll','queues','parseISO','where','30216ZAldun','__esModule','9223317SlsbXv','email','push','../../models/Message','LOWER','contact','endOfDay','../UserServices/ShowUserService','map','date-fns','ticketId','color','DESC','6506928tEwEMi','toLocaleLowerCase','number','pending','../../models/Tag','133KeTBzE','../../models/TicketTag','tags','body','default','true','489KhcCyQ','contact.name','length','user','../../models/Queue','startOfDay','name'];a538_0x4eae=function(){return _0x1054ff;};return a538_0x4eae();}function a538_0xb5ca(_0x220e5d,_0x338c0e){const _0x4eae8e=a538_0x4eae();return a538_0xb5ca=function(_0xb5ca51,_0x1a0fe6){_0xb5ca51=_0xb5ca51-0xdd;let _0x56c0d0=_0x4eae8e[_0xb5ca51];return _0x56c0d0;},a538_0xb5ca(_0x220e5d,_0x338c0e);}Object[a538_0xbcfbc6(0xf1)](exports,a538_0xbcfbc6(0x101),{'value':!![]});const sequelize_1=require('sequelize'),date_fns_1=require(a538_0xbcfbc6(0x10b)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a538_0xbcfbc6(0xef))),Message_1=__importDefault(require(a538_0xbcfbc6(0x105))),Queue_1=__importDefault(require(a538_0xbcfbc6(0xe4))),User_1=__importDefault(require(a538_0xbcfbc6(0xea))),ShowUserService_1=__importDefault(require(a538_0xbcfbc6(0x109))),Tag_1=__importDefault(require(a538_0xbcfbc6(0x113))),TicketTag_1=__importDefault(require(a538_0xbcfbc6(0x115))),lodash_1=require(a538_0xbcfbc6(0xf2)),Whatsapp_1=__importDefault(require(a538_0xbcfbc6(0xed))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x25a058,tags:_0x3d6df1,users:_0x50bc95,status:_0x2f3367,date:_0x414759,updatedAt:_0x500dcc,showAll:_0x25042f,userId:_0x4d71bc,withUnreadMessages:_0x2952c3,companyId:_0x35997d})=>{const _0x17c23b=a538_0xbcfbc6;let _0x3b8f96={[sequelize_1['Op']['or']]:[{'userId':_0x4d71bc},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x25a058,null]}},_0x10c048;_0x10c048=[{'model':Contact_1['default'],'as':_0x17c23b(0x107),'attributes':['id',_0x17c23b(0xe6),_0x17c23b(0x111),_0x17c23b(0x103)]},{'model':Queue_1[_0x17c23b(0xde)],'as':'queue','attributes':['id',_0x17c23b(0xe6),_0x17c23b(0x10d)]},{'model':User_1[_0x17c23b(0xde)],'as':_0x17c23b(0xe3),'attributes':['id',_0x17c23b(0xe6)]},{'model':Tag_1['default'],'as':_0x17c23b(0x116),'attributes':['id',_0x17c23b(0xe6),_0x17c23b(0x10d)]},{'model':Whatsapp_1['default'],'as':'whatsapp','attributes':[_0x17c23b(0xe6)]}];_0x25042f===_0x17c23b(0xdf)&&(_0x3b8f96={'queueId':{[sequelize_1['Op']['or']]:[_0x25a058,null]}});_0x3b8f96={..._0x3b8f96,'status':{[sequelize_1['Op']['or']]:[_0x17c23b(0x112),_0x17c23b(0xeb)]}};if(searchParam){const _0xc73ea2=searchParam[_0x17c23b(0x110)]()['trim']();_0x10c048=[..._0x10c048,{'model':Message_1[_0x17c23b(0xde)],'as':_0x17c23b(0xf3),'attributes':['id',_0x17c23b(0xdd)],'where':{'body':(0x0,sequelize_1[_0x17c23b(0xff)])((0x0,sequelize_1['fn'])(_0x17c23b(0x106),(0x0,sequelize_1[_0x17c23b(0xfb)])(_0x17c23b(0xdd))),'LIKE','%'+_0xc73ea2+'%')},'required':![],'duplicating':![]}],_0x3b8f96={..._0x3b8f96,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x17c23b(0x106),(0x0,sequelize_1[_0x17c23b(0xfb)])(_0x17c23b(0xe1))),'LIKE','%'+_0xc73ea2+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0xc73ea2+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x17c23b(0x106),(0x0,sequelize_1[_0x17c23b(0xfb)])(_0x17c23b(0xdd))),_0x17c23b(0xf0),'%'+_0xc73ea2+'%')}]};}_0x414759&&(_0x3b8f96={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x17c23b(0xe5)])((0x0,date_fns_1[_0x17c23b(0xfe)])(_0x414759)),+(0x0,date_fns_1[_0x17c23b(0x108)])((0x0,date_fns_1['parseISO'])(_0x414759))]}});_0x500dcc&&(_0x3b8f96={'updatedAt':{[sequelize_1['Op'][_0x17c23b(0xf8)]]:[+(0x0,date_fns_1[_0x17c23b(0xe5)])((0x0,date_fns_1[_0x17c23b(0xfe)])(_0x500dcc)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1['parseISO'])(_0x500dcc))]}});if(_0x2952c3===_0x17c23b(0xdf)){const _0x235fa2=await(0x0,ShowUserService_1[_0x17c23b(0xde)])(_0x4d71bc),_0x357018=_0x235fa2[_0x17c23b(0xfd)][_0x17c23b(0x10a)](_0x4bb8d4=>_0x4bb8d4['id']);_0x3b8f96={[sequelize_1['Op']['or']]:[{'userId':_0x4d71bc},{'status':_0x17c23b(0x112)}],'queueId':{[sequelize_1['Op']['or']]:[_0x357018,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x17c23b(0xe9)](_0x3d6df1)&&_0x3d6df1[_0x17c23b(0xe2)]>0x0){const _0x54e429=[];for(let _0x38e0b3 of _0x3d6df1){const _0x16b39a=await TicketTag_1['default'][_0x17c23b(0xf4)]({'where':{'tagId':_0x38e0b3}});_0x16b39a&&_0x54e429['push'](_0x16b39a[_0x17c23b(0x10a)](_0x24a5bf=>_0x24a5bf[_0x17c23b(0x10c)]));}const _0x464d1c=(0x0,lodash_1[_0x17c23b(0xf5)])(..._0x54e429);_0x3b8f96={..._0x3b8f96,'id':{[sequelize_1['Op']['in']]:_0x464d1c}};}if(Array[_0x17c23b(0xe9)](_0x50bc95)&&_0x50bc95[_0x17c23b(0xe2)]>0x0){const _0x171298=[];for(let _0x3954d8 of _0x50bc95){const _0x308cbf=await Ticket_1[_0x17c23b(0xde)][_0x17c23b(0xf4)]({'where':{'userId':_0x3954d8}});_0x308cbf&&_0x171298[_0x17c23b(0x104)](_0x308cbf[_0x17c23b(0x10a)](_0x5983ee=>_0x5983ee['id']));}const _0x59b55d=(0x0,lodash_1['intersection'])(..._0x171298);_0x3b8f96={..._0x3b8f96,'id':{[sequelize_1['Op']['in']]:_0x59b55d}};}const _0x4bc5d9=0x28,_0x3e71c8=_0x4bc5d9*(+pageNumber-0x1);_0x3b8f96={..._0x3b8f96,'companyId':_0x35997d};const {count:_0x7abefa,rows:_0x532ca0}=await Ticket_1[_0x17c23b(0xde)][_0x17c23b(0xfc)]({'where':_0x3b8f96,'include':_0x10c048,'distinct':!![],'limit':_0x4bc5d9,'offset':_0x3e71c8,'order':[[_0x17c23b(0xf9),_0x17c23b(0x10e)]],'subQuery':![]}),_0x4ec56d=_0x7abefa>_0x3e71c8+_0x532ca0[_0x17c23b(0xe2)];return{'tickets':_0x532ca0,'count':_0x7abefa,'hasMore':_0x4ec56d};};exports[a538_0xbcfbc6(0xde)]=ListTicketsServiceKanban;