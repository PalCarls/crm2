'use strict';const a523_0x28225e=a523_0x2280;(function(_0x54bb92,_0x719b4d){const _0x2d0f10=a523_0x2280,_0x865847=_0x54bb92();while(!![]){try{const _0x29ab5d=-parseInt(_0x2d0f10(0x13b))/0x1*(parseInt(_0x2d0f10(0x128))/0x2)+-parseInt(_0x2d0f10(0x150))/0x3+-parseInt(_0x2d0f10(0x13e))/0x4+parseInt(_0x2d0f10(0x14d))/0x5+-parseInt(_0x2d0f10(0x134))/0x6*(-parseInt(_0x2d0f10(0x123))/0x7)+parseInt(_0x2d0f10(0x130))/0x8+parseInt(_0x2d0f10(0x142))/0x9;if(_0x29ab5d===_0x719b4d)break;else _0x865847['push'](_0x865847['shift']());}catch(_0x588401){_0x865847['push'](_0x865847['shift']());}}}(a523_0x2f44,0x5b8f5));function a523_0x2280(_0x4b2efe,_0x478158){const _0x2f4430=a523_0x2f44();return a523_0x2280=function(_0x22802a,_0xead43c){_0x22802a=_0x22802a-0x11c;let _0x1fb396=_0x2f4430[_0x22802a];return _0x1fb396;},a523_0x2280(_0x4b2efe,_0x478158);}var __importDefault=this&&this[a523_0x28225e(0x137)]||function(_0x35ab91){const _0x35f22c=a523_0x28225e;return _0x35ab91&&_0x35ab91[_0x35f22c(0x133)]?_0x35ab91:{'default':_0x35ab91};};Object['defineProperty'](exports,'__esModule',{'value':!![]});function a523_0x2f44(){const _0x23ff74=['isArray','3664950nYDXXD','messages','between','398808AVcBGr','toLocaleLowerCase','true','queue','user','date-fns','DESC','color','default','14oVuNSf','queues','push','contact.name','contact','14sDjoDN','findAndCountAll','../../models/Whatsapp','../../models/Ticket','endOfDay','like','../../models/TicketTag','parseISO','1309120cEsjke','body','ticketId','__esModule','1752942QzkjOR','col','../../models/User','__importDefault','LIKE','length','../../models/Tag','72689rsbYSb','number','sequelize','2899088WUXcPZ','startOfDay','intersection','lodash','2345544npERzR','../../models/Contact','../../models/Message','findAll','LOWER','updatedAt','map','name','where','trim'];a523_0x2f44=function(){return _0x23ff74;};return a523_0x2f44();}const sequelize_1=require(a523_0x28225e(0x13d)),date_fns_1=require(a523_0x28225e(0x11f)),Ticket_1=__importDefault(require(a523_0x28225e(0x12b))),Contact_1=__importDefault(require(a523_0x28225e(0x143))),Message_1=__importDefault(require(a523_0x28225e(0x144))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a523_0x28225e(0x136))),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require(a523_0x28225e(0x13a))),TicketTag_1=__importDefault(require(a523_0x28225e(0x12e))),lodash_1=require(a523_0x28225e(0x141)),Whatsapp_1=__importDefault(require(a523_0x28225e(0x12a))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x43f84d,tags:_0x5d0357,users:_0x292110,status:_0x167c4e,date:_0x5a45c4,updatedAt:_0x1718f7,showAll:_0x4044fc,userId:_0x292626,withUnreadMessages:_0x24c63a,companyId:_0xab26e8})=>{const _0xc3477=a523_0x28225e;let _0x527a1c={[sequelize_1['Op']['or']]:[{'userId':_0x292626},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x43f84d,null]}},_0x3808a4;_0x3808a4=[{'model':Contact_1[_0xc3477(0x122)],'as':_0xc3477(0x127),'attributes':['id','name',_0xc3477(0x13c),'email']},{'model':Queue_1[_0xc3477(0x122)],'as':_0xc3477(0x11d),'attributes':['id',_0xc3477(0x149),_0xc3477(0x121)]},{'model':User_1[_0xc3477(0x122)],'as':_0xc3477(0x11e),'attributes':['id','name']},{'model':Tag_1[_0xc3477(0x122)],'as':'tags','attributes':['id',_0xc3477(0x149),'color']},{'model':Whatsapp_1[_0xc3477(0x122)],'as':'whatsapp','attributes':[_0xc3477(0x149)]}];_0x4044fc===_0xc3477(0x11c)&&(_0x527a1c={'queueId':{[sequelize_1['Op']['or']]:[_0x43f84d,null]}});_0x527a1c={..._0x527a1c,'status':{[sequelize_1['Op']['or']]:['pending','open']}};if(searchParam){const _0x345ee3=searchParam[_0xc3477(0x151)]()[_0xc3477(0x14b)]();_0x3808a4=[..._0x3808a4,{'model':Message_1[_0xc3477(0x122)],'as':_0xc3477(0x14e),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0xc3477(0x14a)])((0x0,sequelize_1['fn'])(_0xc3477(0x146),(0x0,sequelize_1[_0xc3477(0x135)])(_0xc3477(0x131))),_0xc3477(0x138),'%'+_0x345ee3+'%')},'required':![],'duplicating':![]}],_0x527a1c={..._0x527a1c,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0xc3477(0x14a)])((0x0,sequelize_1['fn'])(_0xc3477(0x146),(0x0,sequelize_1[_0xc3477(0x135)])(_0xc3477(0x126))),_0xc3477(0x138),'%'+_0x345ee3+'%')},{'$contact.number$':{[sequelize_1['Op'][_0xc3477(0x12d)]]:'%'+_0x345ee3+'%'}},{'$message.body$':(0x0,sequelize_1[_0xc3477(0x14a)])((0x0,sequelize_1['fn'])(_0xc3477(0x146),(0x0,sequelize_1[_0xc3477(0x135)])(_0xc3477(0x131))),_0xc3477(0x138),'%'+_0x345ee3+'%')}]};}_0x5a45c4&&(_0x527a1c={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0xc3477(0x13f)])((0x0,date_fns_1['parseISO'])(_0x5a45c4)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0xc3477(0x12f)])(_0x5a45c4))]}});_0x1718f7&&(_0x527a1c={'updatedAt':{[sequelize_1['Op'][_0xc3477(0x14f)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0xc3477(0x12f)])(_0x1718f7)),+(0x0,date_fns_1[_0xc3477(0x12c)])((0x0,date_fns_1[_0xc3477(0x12f)])(_0x1718f7))]}});if(_0x24c63a===_0xc3477(0x11c)){const _0x44c4f0=await(0x0,ShowUserService_1[_0xc3477(0x122)])(_0x292626),_0x5b5b58=_0x44c4f0[_0xc3477(0x124)][_0xc3477(0x148)](_0x4ebbd8=>_0x4ebbd8['id']);_0x527a1c={[sequelize_1['Op']['or']]:[{'userId':_0x292626},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x5b5b58,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0xc3477(0x14c)](_0x5d0357)&&_0x5d0357[_0xc3477(0x139)]>0x0){const _0x13a778=[];for(let _0x331931 of _0x5d0357){const _0x5aedba=await TicketTag_1['default'][_0xc3477(0x145)]({'where':{'tagId':_0x331931}});_0x5aedba&&_0x13a778[_0xc3477(0x125)](_0x5aedba[_0xc3477(0x148)](_0x3da44d=>_0x3da44d[_0xc3477(0x132)]));}const _0x469601=(0x0,lodash_1[_0xc3477(0x140)])(..._0x13a778);_0x527a1c={..._0x527a1c,'id':{[sequelize_1['Op']['in']]:_0x469601}};}if(Array[_0xc3477(0x14c)](_0x292110)&&_0x292110['length']>0x0){const _0x27f579=[];for(let _0x2cc033 of _0x292110){const _0x113bf6=await Ticket_1['default'][_0xc3477(0x145)]({'where':{'userId':_0x2cc033}});_0x113bf6&&_0x27f579[_0xc3477(0x125)](_0x113bf6['map'](_0x3b7569=>_0x3b7569['id']));}const _0x3a1e77=(0x0,lodash_1[_0xc3477(0x140)])(..._0x27f579);_0x527a1c={..._0x527a1c,'id':{[sequelize_1['Op']['in']]:_0x3a1e77}};}const _0x5d513e=0x28,_0x59c682=_0x5d513e*(+pageNumber-0x1);_0x527a1c={..._0x527a1c,'companyId':_0xab26e8};const {count:_0x1697c1,rows:_0x3ff560}=await Ticket_1[_0xc3477(0x122)][_0xc3477(0x129)]({'where':_0x527a1c,'include':_0x3808a4,'distinct':!![],'limit':_0x5d513e,'offset':_0x59c682,'order':[[_0xc3477(0x147),_0xc3477(0x120)]],'subQuery':![]}),_0x5980c3=_0x1697c1>_0x59c682+_0x3ff560[_0xc3477(0x139)];return{'tickets':_0x3ff560,'count':_0x1697c1,'hasMore':_0x5980c3};};exports[a523_0x28225e(0x122)]=ListTicketsServiceKanban;