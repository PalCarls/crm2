'use strict';const a522_0x51d5e8=a522_0x50bd;(function(_0x16bdae,_0xf2f512){const _0x3fb83e=a522_0x50bd,_0x1728f4=_0x16bdae();while(!![]){try{const _0x2e2c08=-parseInt(_0x3fb83e(0x1f8))/0x1*(parseInt(_0x3fb83e(0x1fd))/0x2)+parseInt(_0x3fb83e(0x229))/0x3+-parseInt(_0x3fb83e(0x202))/0x4*(parseInt(_0x3fb83e(0x201))/0x5)+parseInt(_0x3fb83e(0x211))/0x6+parseInt(_0x3fb83e(0x205))/0x7+-parseInt(_0x3fb83e(0x225))/0x8*(-parseInt(_0x3fb83e(0x1f9))/0x9)+parseInt(_0x3fb83e(0x20b))/0xa*(parseInt(_0x3fb83e(0x200))/0xb);if(_0x2e2c08===_0xf2f512)break;else _0x1728f4['push'](_0x1728f4['shift']());}catch(_0xf65291){_0x1728f4['push'](_0x1728f4['shift']());}}}(a522_0x5777,0x88b3b));var __importDefault=this&&this[a522_0x51d5e8(0x21c)]||function(_0x116f8d){const _0x332fd4=a522_0x51d5e8;return _0x116f8d&&_0x116f8d[_0x332fd4(0x20a)]?_0x116f8d:{'default':_0x116f8d};};Object[a522_0x51d5e8(0x226)](exports,a522_0x51d5e8(0x20a),{'value':!![]});const sequelize_1=require(a522_0x51d5e8(0x227)),date_fns_1=require(a522_0x51d5e8(0x219)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a522_0x51d5e8(0x1f5))),Message_1=__importDefault(require(a522_0x51d5e8(0x1f0))),Queue_1=__importDefault(require(a522_0x51d5e8(0x215))),User_1=__importDefault(require(a522_0x51d5e8(0x1f3))),ShowUserService_1=__importDefault(require(a522_0x51d5e8(0x1fe))),Tag_1=__importDefault(require(a522_0x51d5e8(0x21b))),TicketTag_1=__importDefault(require(a522_0x51d5e8(0x213))),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x367fe9,tags:_0x54d7a5,users:_0x5aff84,status:_0x4ebaa3,date:_0xd029a8,updatedAt:_0x1c1d1e,showAll:_0x393202,userId:_0x3b617f,withUnreadMessages:_0x7cc14d,companyId:_0x1f8540})=>{const _0x4fd48a=a522_0x51d5e8;let _0x440954={[sequelize_1['Op']['or']]:[{'userId':_0x3b617f},{'status':_0x4fd48a(0x21d)}],'queueId':{[sequelize_1['Op']['or']]:[_0x367fe9,null]}},_0x344eaf;_0x344eaf=[{'model':Contact_1['default'],'as':_0x4fd48a(0x217),'attributes':['id',_0x4fd48a(0x223),_0x4fd48a(0x228),_0x4fd48a(0x21e)]},{'model':Queue_1[_0x4fd48a(0x1fc)],'as':_0x4fd48a(0x21f),'attributes':['id',_0x4fd48a(0x223),_0x4fd48a(0x221)]},{'model':User_1[_0x4fd48a(0x1fc)],'as':'user','attributes':['id',_0x4fd48a(0x223)]},{'model':Tag_1[_0x4fd48a(0x1fc)],'as':_0x4fd48a(0x218),'attributes':['id',_0x4fd48a(0x223),_0x4fd48a(0x221)]},{'model':Whatsapp_1[_0x4fd48a(0x1fc)],'as':_0x4fd48a(0x1f1),'attributes':['name']}];_0x393202===_0x4fd48a(0x203)&&(_0x440954={'queueId':{[sequelize_1['Op']['or']]:[_0x367fe9,null]}});_0x440954={..._0x440954,'status':{[sequelize_1['Op']['or']]:[_0x4fd48a(0x21d),'open']}};if(searchParam){const _0x499d5f=searchParam[_0x4fd48a(0x220)]()[_0x4fd48a(0x1f2)]();_0x344eaf=[..._0x344eaf,{'model':Message_1[_0x4fd48a(0x1fc)],'as':'messages','attributes':['id',_0x4fd48a(0x222)],'where':{'body':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x4fd48a(0x208)])(_0x4fd48a(0x222))),_0x4fd48a(0x20d),'%'+_0x499d5f+'%')},'required':![],'duplicating':![]}],_0x440954={..._0x440954,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x4fd48a(0x1ff)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x4fd48a(0x208)])(_0x4fd48a(0x1f7))),_0x4fd48a(0x20d),'%'+_0x499d5f+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x4fd48a(0x212)]]:'%'+_0x499d5f+'%'}},{'$message.body$':(0x0,sequelize_1[_0x4fd48a(0x1ff)])((0x0,sequelize_1['fn'])(_0x4fd48a(0x1f4),(0x0,sequelize_1[_0x4fd48a(0x208)])('body')),'LIKE','%'+_0x499d5f+'%')}]};}_0xd029a8&&(_0x440954={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x4fd48a(0x204)])((0x0,date_fns_1[_0x4fd48a(0x21a)])(_0xd029a8)),+(0x0,date_fns_1[_0x4fd48a(0x1fa)])((0x0,date_fns_1[_0x4fd48a(0x21a)])(_0xd029a8))]}});_0x1c1d1e&&(_0x440954={'updatedAt':{[sequelize_1['Op'][_0x4fd48a(0x216)]]:[+(0x0,date_fns_1[_0x4fd48a(0x204)])((0x0,date_fns_1[_0x4fd48a(0x21a)])(_0x1c1d1e)),+(0x0,date_fns_1[_0x4fd48a(0x1fa)])((0x0,date_fns_1[_0x4fd48a(0x21a)])(_0x1c1d1e))]}});if(_0x7cc14d===_0x4fd48a(0x203)){const _0x544e77=await(0x0,ShowUserService_1['default'])(_0x3b617f),_0x3bc4b5=_0x544e77[_0x4fd48a(0x207)]['map'](_0x314ff1=>_0x314ff1['id']);_0x440954={[sequelize_1['Op']['or']]:[{'userId':_0x3b617f},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x3bc4b5,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array['isArray'](_0x54d7a5)&&_0x54d7a5[_0x4fd48a(0x209)]>0x0){const _0xe0eaf5=[];for(let _0x3d711d of _0x54d7a5){const _0x5d99cc=await TicketTag_1[_0x4fd48a(0x1fc)][_0x4fd48a(0x224)]({'where':{'tagId':_0x3d711d}});_0x5d99cc&&_0xe0eaf5[_0x4fd48a(0x206)](_0x5d99cc[_0x4fd48a(0x210)](_0x537baa=>_0x537baa[_0x4fd48a(0x214)]));}const _0x1613da=(0x0,lodash_1[_0x4fd48a(0x1f6)])(..._0xe0eaf5);_0x440954={..._0x440954,'id':{[sequelize_1['Op']['in']]:_0x1613da}};}if(Array[_0x4fd48a(0x20f)](_0x5aff84)&&_0x5aff84[_0x4fd48a(0x209)]>0x0){const _0x34d054=[];for(let _0xc4e711 of _0x5aff84){const _0x35905a=await Ticket_1[_0x4fd48a(0x1fc)][_0x4fd48a(0x224)]({'where':{'userId':_0xc4e711}});_0x35905a&&_0x34d054[_0x4fd48a(0x206)](_0x35905a[_0x4fd48a(0x210)](_0x55492d=>_0x55492d['id']));}const _0x5a9a1c=(0x0,lodash_1['intersection'])(..._0x34d054);_0x440954={..._0x440954,'id':{[sequelize_1['Op']['in']]:_0x5a9a1c}};}const _0x11f602=0x28,_0x2c295e=_0x11f602*(+pageNumber-0x1);_0x440954={..._0x440954,'companyId':_0x1f8540};const {count:_0x267692,rows:_0x490fbb}=await Ticket_1[_0x4fd48a(0x1fc)][_0x4fd48a(0x1fb)]({'where':_0x440954,'include':_0x344eaf,'distinct':!![],'limit':_0x11f602,'offset':_0x2c295e,'order':[[_0x4fd48a(0x20c),_0x4fd48a(0x20e)]],'subQuery':![]}),_0x1cacd8=_0x267692>_0x2c295e+_0x490fbb['length'];return{'tickets':_0x490fbb,'count':_0x267692,'hasMore':_0x1cacd8};};function a522_0x5777(){const _0x32dce6=['findAndCountAll','default','262IBZqMK','../UserServices/ShowUserService','where','11rDlDPW','355190RsuJlX','44xRzLXu','true','startOfDay','1203608pcOrjG','push','queues','col','length','__esModule','7282450RpcQiT','updatedAt','LIKE','DESC','isArray','map','509940CClQqh','like','../../models/TicketTag','ticketId','../../models/Queue','between','contact','tags','date-fns','parseISO','../../models/Tag','__importDefault','pending','email','queue','toLocaleLowerCase','color','body','name','findAll','622576kgGtgU','defineProperty','sequelize','number','202395YmdJDB','../../models/Message','whatsapp','trim','../../models/User','LOWER','../../models/Contact','intersection','contact.name','6113NXNwzH','126JrnnHs','endOfDay'];a522_0x5777=function(){return _0x32dce6;};return a522_0x5777();}function a522_0x50bd(_0x3f5727,_0x3313a7){const _0x57770d=a522_0x5777();return a522_0x50bd=function(_0x50bd99,_0x13475e){_0x50bd99=_0x50bd99-0x1f0;let _0x3b73d6=_0x57770d[_0x50bd99];return _0x3b73d6;},a522_0x50bd(_0x3f5727,_0x3313a7);}exports[a522_0x51d5e8(0x1fc)]=ListTicketsServiceKanban;