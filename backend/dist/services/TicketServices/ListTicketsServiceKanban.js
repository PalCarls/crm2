'use strict';const a595_0x286ade=a595_0x3269;(function(_0x2ed9b0,_0x4c3c2e){const _0xeafb63=a595_0x3269,_0x583a70=_0x2ed9b0();while(!![]){try{const _0x22b56a=-parseInt(_0xeafb63(0x198))/0x1+-parseInt(_0xeafb63(0x19d))/0x2+-parseInt(_0xeafb63(0x1ad))/0x3*(-parseInt(_0xeafb63(0x1bc))/0x4)+parseInt(_0xeafb63(0x1b4))/0x5*(parseInt(_0xeafb63(0x1b2))/0x6)+parseInt(_0xeafb63(0x19f))/0x7*(-parseInt(_0xeafb63(0x1c0))/0x8)+parseInt(_0xeafb63(0x1a4))/0x9+parseInt(_0xeafb63(0x197))/0xa*(parseInt(_0xeafb63(0x1ae))/0xb);if(_0x22b56a===_0x4c3c2e)break;else _0x583a70['push'](_0x583a70['shift']());}catch(_0x87cff1){_0x583a70['push'](_0x583a70['shift']());}}}(a595_0x222c,0xa4a4c));function a595_0x3269(_0x20204e,_0x127241){const _0x222c54=a595_0x222c();return a595_0x3269=function(_0x3269b7,_0x4b9e64){_0x3269b7=_0x3269b7-0x197;let _0x26277f=_0x222c54[_0x3269b7];return _0x26277f;},a595_0x3269(_0x20204e,_0x127241);}var __importDefault=this&&this['__importDefault']||function(_0x31b169){const _0xa67506=a595_0x3269;return _0x31b169&&_0x31b169[_0xa67506(0x1ab)]?_0x31b169:{'default':_0x31b169};};function a595_0x222c(){const _0x34020a=['14dxwLfF','queue','lodash','updatedAt','messages','9244755UyqLjL','user','LIKE','between','trim','sequelize','col','__esModule','../UserServices/ShowUserService','387381pufuKo','451SpnuDr','body','true','endOfDay','1058562EKXtPK','default','5AYfbpy','LOWER','number','ticketId','queues','intersection','color','DESC','4xtkOdx','where','tags','like','312824qjDHUW','companyId','contact.name','../../models/Ticket','length','urlPicture','defineProperty','../../models/Contact','../../models/User','findAll','parseISO','startOfDay','isArray','open','push','whatsapp','map','name','pending','372730VwrXdh','1298354gUpMjO','date-fns','../../models/Message','../../models/TicketTag','../../models/Tag','1620004HrLhhE','../../models/Whatsapp'];a595_0x222c=function(){return _0x34020a;};return a595_0x222c();}Object[a595_0x286ade(0x1c6)](exports,a595_0x286ade(0x1ab),{'value':!![]});const sequelize_1=require(a595_0x286ade(0x1a9)),date_fns_1=require(a595_0x286ade(0x199)),Ticket_1=__importDefault(require(a595_0x286ade(0x1c3))),Contact_1=__importDefault(require(a595_0x286ade(0x1c7))),Message_1=__importDefault(require(a595_0x286ade(0x19a))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a595_0x286ade(0x1c8))),ShowUserService_1=__importDefault(require(a595_0x286ade(0x1ac))),Tag_1=__importDefault(require(a595_0x286ade(0x19c))),TicketTag_1=__importDefault(require(a595_0x286ade(0x19b))),lodash_1=require(a595_0x286ade(0x1a1)),Whatsapp_1=__importDefault(require(a595_0x286ade(0x19e))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x56b64f,tags:_0x2d6dc6,users:_0x5d9c6e,status:_0x1f38bc,date:_0x4a6f36,updatedAt:_0x41c2bc,showAll:_0x4dcd04,userId:_0x19161a,withUnreadMessages:_0x338898,companyId:_0x50faae})=>{const _0x2afa78=a595_0x286ade;let _0x257d31={[sequelize_1['Op']['or']]:[{'userId':_0x19161a},{'status':_0x2afa78(0x1d2)}],'queueId':{[sequelize_1['Op']['or']]:[_0x56b64f,null]}},_0x53bbe7;_0x53bbe7=[{'model':Contact_1['default'],'as':'contact','attributes':['id',_0x2afa78(0x1d1),_0x2afa78(0x1b6),'email',_0x2afa78(0x1c1),_0x2afa78(0x1c5)]},{'model':Queue_1[_0x2afa78(0x1b3)],'as':_0x2afa78(0x1a0),'attributes':['id',_0x2afa78(0x1d1),_0x2afa78(0x1ba)]},{'model':User_1[_0x2afa78(0x1b3)],'as':_0x2afa78(0x1a5),'attributes':['id',_0x2afa78(0x1d1)]},{'model':Tag_1[_0x2afa78(0x1b3)],'as':_0x2afa78(0x1be),'attributes':['id',_0x2afa78(0x1d1),_0x2afa78(0x1ba)]},{'model':Whatsapp_1['default'],'as':_0x2afa78(0x1cf),'attributes':[_0x2afa78(0x1d1)]}];_0x4dcd04===_0x2afa78(0x1b0)&&(_0x257d31={'queueId':{[sequelize_1['Op']['or']]:[_0x56b64f,null]}});_0x257d31={..._0x257d31,'status':{[sequelize_1['Op']['or']]:[_0x2afa78(0x1d2),_0x2afa78(0x1cd)]}};if(searchParam){const _0x6c32a=searchParam['toLocaleLowerCase']()[_0x2afa78(0x1a8)]();_0x53bbe7=[..._0x53bbe7,{'model':Message_1['default'],'as':_0x2afa78(0x1a3),'attributes':['id',_0x2afa78(0x1af)],'where':{'body':(0x0,sequelize_1[_0x2afa78(0x1bd)])((0x0,sequelize_1['fn'])(_0x2afa78(0x1b5),(0x0,sequelize_1['col'])(_0x2afa78(0x1af))),'LIKE','%'+_0x6c32a+'%')},'required':![],'duplicating':![]}],_0x257d31={..._0x257d31,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x2afa78(0x1bd)])((0x0,sequelize_1['fn'])(_0x2afa78(0x1b5),(0x0,sequelize_1[_0x2afa78(0x1aa)])(_0x2afa78(0x1c2))),_0x2afa78(0x1a6),'%'+_0x6c32a+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x2afa78(0x1bf)]]:'%'+_0x6c32a+'%'}},{'$message.body$':(0x0,sequelize_1[_0x2afa78(0x1bd)])((0x0,sequelize_1['fn'])(_0x2afa78(0x1b5),(0x0,sequelize_1['col'])(_0x2afa78(0x1af))),_0x2afa78(0x1a6),'%'+_0x6c32a+'%')}]};}_0x4a6f36&&(_0x257d31={'createdAt':{[sequelize_1['Op'][_0x2afa78(0x1a7)]]:[+(0x0,date_fns_1[_0x2afa78(0x1cb)])((0x0,date_fns_1[_0x2afa78(0x1ca)])(_0x4a6f36)),+(0x0,date_fns_1[_0x2afa78(0x1b1)])((0x0,date_fns_1[_0x2afa78(0x1ca)])(_0x4a6f36))]}});_0x41c2bc&&(_0x257d31={'updatedAt':{[sequelize_1['Op'][_0x2afa78(0x1a7)]]:[+(0x0,date_fns_1[_0x2afa78(0x1cb)])((0x0,date_fns_1[_0x2afa78(0x1ca)])(_0x41c2bc)),+(0x0,date_fns_1[_0x2afa78(0x1b1)])((0x0,date_fns_1[_0x2afa78(0x1ca)])(_0x41c2bc))]}});if(_0x338898===_0x2afa78(0x1b0)){const _0x2a7613=await(0x0,ShowUserService_1[_0x2afa78(0x1b3)])(_0x19161a,_0x50faae),_0x251470=_0x2a7613[_0x2afa78(0x1b8)][_0x2afa78(0x1d0)](_0x3e6532=>_0x3e6532['id']);_0x257d31={[sequelize_1['Op']['or']]:[{'userId':_0x19161a},{'status':_0x2afa78(0x1d2)}],'queueId':{[sequelize_1['Op']['or']]:[_0x251470,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x2afa78(0x1cc)](_0x2d6dc6)&&_0x2d6dc6['length']>0x0){const _0xf548c5=[];for(let _0x58b5d5 of _0x2d6dc6){const _0x4baa58=await TicketTag_1[_0x2afa78(0x1b3)][_0x2afa78(0x1c9)]({'where':{'tagId':_0x58b5d5}});_0x4baa58&&_0xf548c5[_0x2afa78(0x1ce)](_0x4baa58['map'](_0x104faa=>_0x104faa[_0x2afa78(0x1b7)]));}const _0x5b029a=(0x0,lodash_1[_0x2afa78(0x1b9)])(..._0xf548c5);_0x257d31={..._0x257d31,'id':{[sequelize_1['Op']['in']]:_0x5b029a}};}if(Array['isArray'](_0x5d9c6e)&&_0x5d9c6e[_0x2afa78(0x1c4)]>0x0){const _0x3f8d1f=[];for(let _0x42f6a4 of _0x5d9c6e){const _0x526998=await Ticket_1['default']['findAll']({'where':{'userId':_0x42f6a4}});_0x526998&&_0x3f8d1f[_0x2afa78(0x1ce)](_0x526998[_0x2afa78(0x1d0)](_0x3190e9=>_0x3190e9['id']));}const _0x57ec30=(0x0,lodash_1['intersection'])(..._0x3f8d1f);_0x257d31={..._0x257d31,'id':{[sequelize_1['Op']['in']]:_0x57ec30}};}const _0x17954b=0x28,_0x13ea71=_0x17954b*(+pageNumber-0x1);_0x257d31={..._0x257d31,'companyId':_0x50faae};const {count:_0x200837,rows:_0x481360}=await Ticket_1[_0x2afa78(0x1b3)]['findAndCountAll']({'where':_0x257d31,'include':_0x53bbe7,'distinct':!![],'limit':_0x17954b,'offset':_0x13ea71,'order':[[_0x2afa78(0x1a2),_0x2afa78(0x1bb)]],'subQuery':![]}),_0x5c46cf=_0x200837>_0x13ea71+_0x481360['length'];return{'tickets':_0x481360,'count':_0x200837,'hasMore':_0x5c46cf};};exports[a595_0x286ade(0x1b3)]=ListTicketsServiceKanban;