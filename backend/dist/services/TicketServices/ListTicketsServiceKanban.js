'use strict';const a522_0x29c94f=a522_0x5d29;(function(_0x15e8c1,_0x778275){const _0x1bc222=a522_0x5d29,_0x429a03=_0x15e8c1();while(!![]){try{const _0x1412fd=-parseInt(_0x1bc222(0x1b4))/0x1*(-parseInt(_0x1bc222(0x19c))/0x2)+-parseInt(_0x1bc222(0x195))/0x3+-parseInt(_0x1bc222(0x1a0))/0x4*(-parseInt(_0x1bc222(0x1ac))/0x5)+-parseInt(_0x1bc222(0x1aa))/0x6+parseInt(_0x1bc222(0x190))/0x7+-parseInt(_0x1bc222(0x1b9))/0x8*(-parseInt(_0x1bc222(0x1b3))/0x9)+-parseInt(_0x1bc222(0x1a8))/0xa;if(_0x1412fd===_0x778275)break;else _0x429a03['push'](_0x429a03['shift']());}catch(_0xe13df7){_0x429a03['push'](_0x429a03['shift']());}}}(a522_0x5175,0x23694));function a522_0x5175(){const _0x3d8f87=['where','42172DttOUy','updatedAt','contact.name','push','../../models/TicketTag','open','DESC','__esModule','376630eVKYIL','col','1723254HQYHnU','map','95pJIJXJ','intersection','findAll','like','date-fns','../UserServices/ShowUserService','color','68121DdULNB','26804mSVadx','true','LIKE','contact','../../models/User','24NFQVFw','isArray','defineProperty','parseISO','toLocaleLowerCase','between','sequelize','number','messages','1843009BqAAKZ','../../models/Contact','endOfDay','length','whatsapp','370833lIroOa','LOWER','name','startOfDay','__importDefault','default','body','8xNDIuK','../../models/Message','pending'];a522_0x5175=function(){return _0x3d8f87;};return a522_0x5175();}function a522_0x5d29(_0x58d3bc,_0x5cc80e){const _0x5175cb=a522_0x5175();return a522_0x5d29=function(_0x5d2968,_0x451a01){_0x5d2968=_0x5d2968-0x190;let _0xbbb10e=_0x5175cb[_0x5d2968];return _0xbbb10e;},a522_0x5d29(_0x58d3bc,_0x5cc80e);}var __importDefault=this&&this[a522_0x29c94f(0x199)]||function(_0x594778){const _0x95ada6=a522_0x29c94f;return _0x594778&&_0x594778[_0x95ada6(0x1a7)]?_0x594778:{'default':_0x594778};};Object[a522_0x29c94f(0x1bb)](exports,a522_0x29c94f(0x1a7),{'value':!![]});const sequelize_1=require(a522_0x29c94f(0x1bf)),date_fns_1=require(a522_0x29c94f(0x1b0)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a522_0x29c94f(0x191))),Message_1=__importDefault(require(a522_0x29c94f(0x19d))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a522_0x29c94f(0x1b8))),ShowUserService_1=__importDefault(require(a522_0x29c94f(0x1b1))),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a522_0x29c94f(0x1a4))),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x1fcd78,tags:_0x3793fc,users:_0x295561,status:_0x3415ee,date:_0x41c4f8,updatedAt:_0x3ad5de,showAll:_0x5643a1,userId:_0x58e3a1,withUnreadMessages:_0xf7c41f,companyId:_0xf97d62})=>{const _0x242616=a522_0x29c94f;let _0x5cb486={[sequelize_1['Op']['or']]:[{'userId':_0x58e3a1},{'status':_0x242616(0x19e)}],'queueId':{[sequelize_1['Op']['or']]:[_0x1fcd78,null]}},_0x21a4df;_0x21a4df=[{'model':Contact_1[_0x242616(0x19a)],'as':_0x242616(0x1b7),'attributes':['id',_0x242616(0x197),_0x242616(0x1c0),'email']},{'model':Queue_1[_0x242616(0x19a)],'as':'queue','attributes':['id','name',_0x242616(0x1b2)]},{'model':User_1[_0x242616(0x19a)],'as':'user','attributes':['id',_0x242616(0x197)]},{'model':Tag_1['default'],'as':'tags','attributes':['id',_0x242616(0x197),_0x242616(0x1b2)]},{'model':Whatsapp_1[_0x242616(0x19a)],'as':_0x242616(0x194),'attributes':[_0x242616(0x197)]}];_0x5643a1==='true'&&(_0x5cb486={'queueId':{[sequelize_1['Op']['or']]:[_0x1fcd78,null]}});_0x5cb486={..._0x5cb486,'status':{[sequelize_1['Op']['or']]:[_0x242616(0x19e),_0x242616(0x1a5)]}};if(searchParam){const _0x34ab11=searchParam[_0x242616(0x1bd)]()['trim']();_0x21a4df=[..._0x21a4df,{'model':Message_1[_0x242616(0x19a)],'as':_0x242616(0x1c1),'attributes':['id',_0x242616(0x19b)],'where':{'body':(0x0,sequelize_1[_0x242616(0x19f)])((0x0,sequelize_1['fn'])(_0x242616(0x196),(0x0,sequelize_1[_0x242616(0x1a9)])(_0x242616(0x19b))),_0x242616(0x1b6),'%'+_0x34ab11+'%')},'required':![],'duplicating':![]}],_0x5cb486={..._0x5cb486,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x242616(0x19f)])((0x0,sequelize_1['fn'])(_0x242616(0x196),(0x0,sequelize_1[_0x242616(0x1a9)])(_0x242616(0x1a2))),_0x242616(0x1b6),'%'+_0x34ab11+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x242616(0x1af)]]:'%'+_0x34ab11+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x242616(0x196),(0x0,sequelize_1[_0x242616(0x1a9)])(_0x242616(0x19b))),_0x242616(0x1b6),'%'+_0x34ab11+'%')}]};}_0x41c4f8&&(_0x5cb486={'createdAt':{[sequelize_1['Op'][_0x242616(0x1be)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1['parseISO'])(_0x41c4f8)),+(0x0,date_fns_1[_0x242616(0x192)])((0x0,date_fns_1[_0x242616(0x1bc)])(_0x41c4f8))]}});_0x3ad5de&&(_0x5cb486={'updatedAt':{[sequelize_1['Op'][_0x242616(0x1be)]]:[+(0x0,date_fns_1[_0x242616(0x198)])((0x0,date_fns_1[_0x242616(0x1bc)])(_0x3ad5de)),+(0x0,date_fns_1[_0x242616(0x192)])((0x0,date_fns_1[_0x242616(0x1bc)])(_0x3ad5de))]}});if(_0xf7c41f===_0x242616(0x1b5)){const _0xb19715=await(0x0,ShowUserService_1['default'])(_0x58e3a1),_0x1a626a=_0xb19715['queues'][_0x242616(0x1ab)](_0x4195d6=>_0x4195d6['id']);_0x5cb486={[sequelize_1['Op']['or']]:[{'userId':_0x58e3a1},{'status':_0x242616(0x19e)}],'queueId':{[sequelize_1['Op']['or']]:[_0x1a626a,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x242616(0x1ba)](_0x3793fc)&&_0x3793fc[_0x242616(0x193)]>0x0){const _0x4bbcb3=[];for(let _0x116776 of _0x3793fc){const _0x5b83de=await TicketTag_1[_0x242616(0x19a)][_0x242616(0x1ae)]({'where':{'tagId':_0x116776}});_0x5b83de&&_0x4bbcb3['push'](_0x5b83de[_0x242616(0x1ab)](_0x1220ec=>_0x1220ec['ticketId']));}const _0x40e265=(0x0,lodash_1[_0x242616(0x1ad)])(..._0x4bbcb3);_0x5cb486={..._0x5cb486,'id':{[sequelize_1['Op']['in']]:_0x40e265}};}if(Array['isArray'](_0x295561)&&_0x295561[_0x242616(0x193)]>0x0){const _0x3756d4=[];for(let _0x2f2253 of _0x295561){const _0x31b542=await Ticket_1[_0x242616(0x19a)][_0x242616(0x1ae)]({'where':{'userId':_0x2f2253}});_0x31b542&&_0x3756d4[_0x242616(0x1a3)](_0x31b542[_0x242616(0x1ab)](_0x291537=>_0x291537['id']));}const _0x1564bc=(0x0,lodash_1[_0x242616(0x1ad)])(..._0x3756d4);_0x5cb486={..._0x5cb486,'id':{[sequelize_1['Op']['in']]:_0x1564bc}};}const _0x2fe890=0x28,_0x32accb=_0x2fe890*(+pageNumber-0x1);_0x5cb486={..._0x5cb486,'companyId':_0xf97d62};const {count:_0x5c6702,rows:_0x142f38}=await Ticket_1[_0x242616(0x19a)]['findAndCountAll']({'where':_0x5cb486,'include':_0x21a4df,'distinct':!![],'limit':_0x2fe890,'offset':_0x32accb,'order':[[_0x242616(0x1a1),_0x242616(0x1a6)]],'subQuery':![]}),_0x1b3179=_0x5c6702>_0x32accb+_0x142f38[_0x242616(0x193)];return{'tickets':_0x142f38,'count':_0x5c6702,'hasMore':_0x1b3179};};exports[a522_0x29c94f(0x19a)]=ListTicketsServiceKanban;