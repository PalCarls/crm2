'use strict';function a593_0x12b7(_0x3b758a,_0x57d662){const _0x29a82b=a593_0x29a8();return a593_0x12b7=function(_0x12b79c,_0x5d2412){_0x12b79c=_0x12b79c-0x86;let _0x52c375=_0x29a82b[_0x12b79c];return _0x52c375;},a593_0x12b7(_0x3b758a,_0x57d662);}const a593_0x1ef530=a593_0x12b7;(function(_0x3a529c,_0x84abef){const _0x1c04b7=a593_0x12b7,_0x358df7=_0x3a529c();while(!![]){try{const _0x152d9c=-parseInt(_0x1c04b7(0x87))/0x1+parseInt(_0x1c04b7(0x93))/0x2+-parseInt(_0x1c04b7(0x91))/0x3+-parseInt(_0x1c04b7(0x86))/0x4+parseInt(_0x1c04b7(0x8e))/0x5+-parseInt(_0x1c04b7(0x98))/0x6+-parseInt(_0x1c04b7(0x90))/0x7*(-parseInt(_0x1c04b7(0x9a))/0x8);if(_0x152d9c===_0x84abef)break;else _0x358df7['push'](_0x358df7['shift']());}catch(_0x467ec3){_0x358df7['push'](_0x358df7['shift']());}}}(a593_0x29a8,0x2e313));function a593_0x29a8(){const _0x50c64f=['pending','updatedAt','closed','876408uhkEAl','87980BPHQmC','open','sequelize','timeCreateNewTicket','defineProperty','default','DESC','1063745amFhlZ','create','21931SsiqlM','457428yUDTLk','./FindOrCreateATicketTrakingService','104972GhdAmH','findOne','../../models/Ticket','./ShowTicketService','userId','499746olEUAW','date-fns','1192NzCRpq','value','update','__esModule','whatsappId'];a593_0x29a8=function(){return _0x50c64f;};return a593_0x29a8();}var __importDefault=this&&this['__importDefault']||function(_0x4f494b){const _0x4bd758=a593_0x12b7;return _0x4f494b&&_0x4f494b[_0x4bd758(0x9d)]?_0x4f494b:{'default':_0x4f494b};};Object[a593_0x1ef530(0x8b)](exports,a593_0x1ef530(0x9d),{'value':!![]});const date_fns_1=require(a593_0x1ef530(0x99)),sequelize_1=require(a593_0x1ef530(0x89)),Ticket_1=__importDefault(require(a593_0x1ef530(0x95))),ShowTicketService_1=__importDefault(require(a593_0x1ef530(0x96))),FindOrCreateATicketTrakingService_1=__importDefault(require(a593_0x1ef530(0x92))),Setting_1=__importDefault(require('../../models/Setting')),FindOrCreateTicketServiceMeta=async(_0x261a73,_0x4a7bf3,_0x4a779a,_0x3d15d0,_0x2c8bbe)=>{const _0x3db3f9=a593_0x1ef530;let _0x1fb052=await Ticket_1[_0x3db3f9(0x8c)][_0x3db3f9(0x94)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x3db3f9(0x88),'pending',_0x3db3f9(0xa1)]},'contactId':_0x261a73['id'],'companyId':_0x3d15d0,'channel':_0x2c8bbe},'order':[['id',_0x3db3f9(0x8d)]]});_0x1fb052&&await _0x1fb052[_0x3db3f9(0x9c)]({'unreadMessages':_0x4a779a});if(!_0x1fb052){_0x1fb052=await Ticket_1[_0x3db3f9(0x8c)][_0x3db3f9(0x94)]({'where':{'contactId':_0x261a73['id'],'channel':_0x2c8bbe},'order':[['updatedAt',_0x3db3f9(0x8d)]]});_0x1fb052&&(await _0x1fb052[_0x3db3f9(0x9c)]({'status':'pending','userId':null,'unreadMessages':_0x4a779a,'companyId':_0x3d15d0,'channel':_0x2c8bbe}),await(0x0,FindOrCreateATicketTrakingService_1[_0x3db3f9(0x8c)])({'ticketId':_0x1fb052['id'],'companyId':_0x3d15d0,'whatsappId':_0x1fb052[_0x3db3f9(0x9e)],'userId':_0x1fb052[_0x3db3f9(0x97)]}));const _0x22337d=await Setting_1['default'][_0x3db3f9(0x94)]({'where':{'key':_0x3db3f9(0x8a)}}),_0x445730=_0x22337d?parseInt(_0x22337d[_0x3db3f9(0x9b)],0xa):0x1c20;}return!_0x1fb052&&(_0x1fb052=await Ticket_1[_0x3db3f9(0x8c)]['findOne']({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1['subHours'])(new Date(),0x2),+new Date()]},'contactId':_0x261a73['id']},'order':[[_0x3db3f9(0xa0),'DESC']]}),_0x1fb052&&(await _0x1fb052[_0x3db3f9(0x9c)]({'status':_0x3db3f9(0x9f),'userId':null,'unreadMessages':_0x4a779a,'companyId':_0x3d15d0,'channel':_0x2c8bbe}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x1fb052['id'],'companyId':_0x3d15d0,'whatsappId':_0x1fb052[_0x3db3f9(0x9e)],'userId':_0x1fb052[_0x3db3f9(0x97)]}))),!_0x1fb052?(_0x1fb052=await Ticket_1['default'][_0x3db3f9(0x8f)]({'contactId':_0x261a73['id'],'status':_0x3db3f9(0x9f),'isGroup':![],'unreadMessages':_0x4a779a,'whatsappId':_0x4a7bf3,'companyId':_0x3d15d0,'channel':_0x2c8bbe,'isActiveDemand':![]}),await(0x0,FindOrCreateATicketTrakingService_1[_0x3db3f9(0x8c)])({'ticketId':_0x1fb052['id'],'companyId':_0x3d15d0,'whatsappId':_0x4a7bf3,'userId':_0x1fb052[_0x3db3f9(0x97)]})):await _0x1fb052[_0x3db3f9(0x9c)]({'whatsappId':_0x4a7bf3}),_0x1fb052=await(0x0,ShowTicketService_1['default'])(_0x1fb052['id'],_0x3d15d0),_0x1fb052;};exports[a593_0x1ef530(0x8c)]=FindOrCreateTicketServiceMeta;