'use strict';const a582_0x3ceaea=a582_0x1b6e;(function(_0x306c40,_0x1fdbc2){const _0x29014c=a582_0x1b6e,_0x3bcce4=_0x306c40();while(!![]){try{const _0xa705f2=-parseInt(_0x29014c(0x1c3))/0x1*(-parseInt(_0x29014c(0x1bb))/0x2)+-parseInt(_0x29014c(0x1b5))/0x3*(-parseInt(_0x29014c(0x1c0))/0x4)+-parseInt(_0x29014c(0x1c4))/0x5*(-parseInt(_0x29014c(0x1ba))/0x6)+parseInt(_0x29014c(0x1bc))/0x7+-parseInt(_0x29014c(0x1cb))/0x8*(-parseInt(_0x29014c(0x1cf))/0x9)+parseInt(_0x29014c(0x1c8))/0xa+-parseInt(_0x29014c(0x1d0))/0xb;if(_0xa705f2===_0x1fdbc2)break;else _0x3bcce4['push'](_0x3bcce4['shift']());}catch(_0x5ae60c){_0x3bcce4['push'](_0x3bcce4['shift']());}}}(a582_0x5dba,0x9bb3c));var __importDefault=this&&this[a582_0x3ceaea(0x1c6)]||function(_0xf2bd76){return _0xf2bd76&&_0xf2bd76['__esModule']?_0xf2bd76:{'default':_0xf2bd76};};Object[a582_0x3ceaea(0x1c1)](exports,a582_0x3ceaea(0x1be),{'value':!![]});const date_fns_1=require('date-fns'),sequelize_1=require('sequelize'),Ticket_1=__importDefault(require(a582_0x3ceaea(0x1b8))),ShowTicketService_1=__importDefault(require(a582_0x3ceaea(0x1b6))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),Setting_1=__importDefault(require(a582_0x3ceaea(0x1b4))),FindOrCreateTicketServiceMeta=async(_0x31db7c,_0x470526,_0x39d258,_0x3b5751,_0x3a82c0)=>{const _0x284b5e=a582_0x3ceaea;let _0x4e1da5=await Ticket_1['default'][_0x284b5e(0x1cc)]({'where':{'status':{[sequelize_1['Op']['or']]:['open',_0x284b5e(0x1ce),_0x284b5e(0x1b9)]},'contactId':_0x31db7c['id'],'companyId':_0x3b5751,'channel':_0x3a82c0},'order':[['id','DESC']]});_0x4e1da5&&await _0x4e1da5[_0x284b5e(0x1b3)]({'unreadMessages':_0x39d258});if(!_0x4e1da5){_0x4e1da5=await Ticket_1['default'][_0x284b5e(0x1cc)]({'where':{'contactId':_0x31db7c['id'],'channel':_0x3a82c0},'order':[[_0x284b5e(0x1c9),_0x284b5e(0x1ca)]]});_0x4e1da5&&(await _0x4e1da5[_0x284b5e(0x1b3)]({'status':'pending','userId':null,'unreadMessages':_0x39d258,'companyId':_0x3b5751,'channel':_0x3a82c0}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x4e1da5['id'],'companyId':_0x3b5751,'whatsappId':_0x4e1da5[_0x284b5e(0x1c7)],'userId':_0x4e1da5['userId']}));const _0x569935=await Setting_1[_0x284b5e(0x1c5)][_0x284b5e(0x1cc)]({'where':{'key':'timeCreateNewTicket'}}),_0x47911c=_0x569935?parseInt(_0x569935[_0x284b5e(0x1bd)],0xa):0x1c20;}return!_0x4e1da5&&(_0x4e1da5=await Ticket_1[_0x284b5e(0x1c5)]['findOne']({'where':{'updatedAt':{[sequelize_1['Op'][_0x284b5e(0x1b7)]]:[+(0x0,date_fns_1[_0x284b5e(0x1bf)])(new Date(),0x2),+new Date()]},'contactId':_0x31db7c['id']},'order':[[_0x284b5e(0x1c9),_0x284b5e(0x1ca)]]}),_0x4e1da5&&(await _0x4e1da5[_0x284b5e(0x1b3)]({'status':_0x284b5e(0x1ce),'userId':null,'unreadMessages':_0x39d258,'companyId':_0x3b5751,'channel':_0x3a82c0}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x4e1da5['id'],'companyId':_0x3b5751,'whatsappId':_0x4e1da5[_0x284b5e(0x1c7)],'userId':_0x4e1da5[_0x284b5e(0x1c2)]}))),!_0x4e1da5?(_0x4e1da5=await Ticket_1[_0x284b5e(0x1c5)][_0x284b5e(0x1cd)]({'contactId':_0x31db7c['id'],'status':'pending','isGroup':![],'unreadMessages':_0x39d258,'whatsappId':_0x470526,'companyId':_0x3b5751,'channel':_0x3a82c0}),await(0x0,FindOrCreateATicketTrakingService_1[_0x284b5e(0x1c5)])({'ticketId':_0x4e1da5['id'],'companyId':_0x3b5751,'whatsappId':_0x470526,'userId':_0x4e1da5[_0x284b5e(0x1c2)]})):await _0x4e1da5[_0x284b5e(0x1b3)]({'whatsappId':_0x470526}),_0x4e1da5=await(0x0,ShowTicketService_1[_0x284b5e(0x1c5)])(_0x4e1da5['id'],_0x3b5751),_0x4e1da5;};exports['default']=FindOrCreateTicketServiceMeta;function a582_0x1b6e(_0x414534,_0x210bf9){const _0x5dba34=a582_0x5dba();return a582_0x1b6e=function(_0x1b6e69,_0x5e287e){_0x1b6e69=_0x1b6e69-0x1b3;let _0x5d11bc=_0x5dba34[_0x1b6e69];return _0x5d11bc;},a582_0x1b6e(_0x414534,_0x210bf9);}function a582_0x5dba(){const _0x4a656c=['whatsappId','10651550XgvEVO','updatedAt','DESC','1826976JBHFZp','findOne','create','pending','36aEFxMI','31623735KDTjnS','update','../../models/Setting','3estdbs','./ShowTicketService','between','../../models/Ticket','closed','6vsSesP','27644zNRBqe','4273738pWXVPV','value','__esModule','subHours','1910548daUVSZ','defineProperty','userId','9IdGuvf','1607145piWzSf','default','__importDefault'];a582_0x5dba=function(){return _0x4a656c;};return a582_0x5dba();}