'use strict';const a536_0x1c2e2c=a536_0x2e00;function a536_0x27e2(){const _0x80b510=['whatsappId','10tIPUAM','userId','closed','open','36dtpdpl','value','6abydqA','DESC','174quyrMo','between','subHours','925629SOPsOn','updatedAt','45998suaNMj','14904021crUumZ','date-fns','pending','../../models/Setting','9938460zqzwUm','default','timeCreateNewTicket','__importDefault','9311841QiNZgX','update','__esModule','./ShowTicketService','9111512sBBfph','findOne','125075EbIBNf'];a536_0x27e2=function(){return _0x80b510;};return a536_0x27e2();}(function(_0x578852,_0x51eca8){const _0x4f9b8d=a536_0x2e00,_0x5bbf9a=_0x578852();while(!![]){try{const _0x47cfb1=-parseInt(_0x4f9b8d(0x203))/0x1+parseInt(_0x4f9b8d(0x205))/0x2*(parseInt(_0x4f9b8d(0x200))/0x3)+parseInt(_0x4f9b8d(0x1fc))/0x4*(parseInt(_0x4f9b8d(0x1f6))/0x5)+parseInt(_0x4f9b8d(0x1fe))/0x6*(parseInt(_0x4f9b8d(0x20a))/0x7)+parseInt(_0x4f9b8d(0x1f4))/0x8+-parseInt(_0x4f9b8d(0x1f0))/0x9+parseInt(_0x4f9b8d(0x1f8))/0xa*(-parseInt(_0x4f9b8d(0x206))/0xb);if(_0x47cfb1===_0x51eca8)break;else _0x5bbf9a['push'](_0x5bbf9a['shift']());}catch(_0x21d3aa){_0x5bbf9a['push'](_0x5bbf9a['shift']());}}}(a536_0x27e2,0xc3f2f));var __importDefault=this&&this[a536_0x1c2e2c(0x1ef)]||function(_0x23a866){const _0xf64f2=a536_0x1c2e2c;return _0x23a866&&_0x23a866[_0xf64f2(0x1f2)]?_0x23a866:{'default':_0x23a866};};function a536_0x2e00(_0x29a504,_0x546cda){const _0x27e2b4=a536_0x27e2();return a536_0x2e00=function(_0x2e00e3,_0x4fbf13){_0x2e00e3=_0x2e00e3-0x1ee;let _0x57c5ab=_0x27e2b4[_0x2e00e3];return _0x57c5ab;},a536_0x2e00(_0x29a504,_0x546cda);}Object['defineProperty'](exports,'__esModule',{'value':!![]});const date_fns_1=require(a536_0x1c2e2c(0x207)),sequelize_1=require('sequelize'),Ticket_1=__importDefault(require('../../models/Ticket')),ShowTicketService_1=__importDefault(require(a536_0x1c2e2c(0x1f3))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),Setting_1=__importDefault(require(a536_0x1c2e2c(0x209))),FindOrCreateTicketServiceMeta=async(_0x386b8a,_0x5d6811,_0x2c4b01,_0x4593ba,_0x363db9)=>{const _0x4857ef=a536_0x1c2e2c;let _0x34a059=await Ticket_1[_0x4857ef(0x20b)][_0x4857ef(0x1f5)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x4857ef(0x1fb),_0x4857ef(0x208),_0x4857ef(0x1fa)]},'contactId':_0x386b8a['id'],'companyId':_0x4593ba,'channel':_0x363db9},'order':[['id','DESC']]});_0x34a059&&await _0x34a059[_0x4857ef(0x1f1)]({'unreadMessages':_0x2c4b01});if(!_0x34a059){_0x34a059=await Ticket_1['default']['findOne']({'where':{'contactId':_0x386b8a['id'],'channel':_0x363db9},'order':[[_0x4857ef(0x204),_0x4857ef(0x1ff)]]});_0x34a059&&(await _0x34a059[_0x4857ef(0x1f1)]({'status':_0x4857ef(0x208),'userId':null,'unreadMessages':_0x2c4b01,'companyId':_0x4593ba,'channel':_0x363db9}),await(0x0,FindOrCreateATicketTrakingService_1[_0x4857ef(0x20b)])({'ticketId':_0x34a059['id'],'companyId':_0x4593ba,'whatsappId':_0x34a059[_0x4857ef(0x1f7)],'userId':_0x34a059['userId']}));const _0x3b13e8=await Setting_1[_0x4857ef(0x20b)]['findOne']({'where':{'key':_0x4857ef(0x1ee)}}),_0x2b2bde=_0x3b13e8?parseInt(_0x3b13e8[_0x4857ef(0x1fd)],0xa):0x1c20;}return!_0x34a059&&(_0x34a059=await Ticket_1[_0x4857ef(0x20b)][_0x4857ef(0x1f5)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x4857ef(0x201)]]:[+(0x0,date_fns_1[_0x4857ef(0x202)])(new Date(),0x2),+new Date()]},'contactId':_0x386b8a['id']},'order':[[_0x4857ef(0x204),_0x4857ef(0x1ff)]]}),_0x34a059&&(await _0x34a059[_0x4857ef(0x1f1)]({'status':_0x4857ef(0x208),'userId':null,'unreadMessages':_0x2c4b01,'companyId':_0x4593ba,'channel':_0x363db9}),await(0x0,FindOrCreateATicketTrakingService_1[_0x4857ef(0x20b)])({'ticketId':_0x34a059['id'],'companyId':_0x4593ba,'whatsappId':_0x34a059[_0x4857ef(0x1f7)],'userId':_0x34a059[_0x4857ef(0x1f9)]}))),!_0x34a059?(_0x34a059=await Ticket_1[_0x4857ef(0x20b)]['create']({'contactId':_0x386b8a['id'],'status':_0x4857ef(0x208),'isGroup':![],'unreadMessages':_0x2c4b01,'whatsappId':_0x5d6811,'companyId':_0x4593ba,'channel':_0x363db9}),await(0x0,FindOrCreateATicketTrakingService_1[_0x4857ef(0x20b)])({'ticketId':_0x34a059['id'],'companyId':_0x4593ba,'whatsappId':_0x5d6811,'userId':_0x34a059['userId']})):await _0x34a059[_0x4857ef(0x1f1)]({'whatsappId':_0x5d6811}),_0x34a059=await(0x0,ShowTicketService_1['default'])(_0x34a059['id'],_0x4593ba),_0x34a059;};exports[a536_0x1c2e2c(0x20b)]=FindOrCreateTicketServiceMeta;