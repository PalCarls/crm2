'use strict';const a520_0x5cb88a=a520_0xb631;function a520_0x340e(){const _0x333293=['../../models/Setting','findOne','closed','479537TEjxvo','date-fns','sequelize','639kthyTM','1862946yBdHBP','8936mZjIqF','default','updatedAt','create','30YjWCmu','__esModule','between','72970DCCmDk','121712jXTlBz','1477NepjYC','userId','2481pKMAzG','whatsappId','DESC','subHours','./ShowTicketService','12rnDUpT','pending','5973121PqNxrG','update','open','290oNFjiB','timeCreateNewTicket','value'];a520_0x340e=function(){return _0x333293;};return a520_0x340e();}(function(_0x4cf834,_0x4df061){const _0x410680=a520_0xb631,_0x2da05f=_0x4cf834();while(!![]){try{const _0x24c949=parseInt(_0x410680(0xd9))/0x1+parseInt(_0x410680(0xd3))/0x2*(parseInt(_0x410680(0xc9))/0x3)+parseInt(_0x410680(0xc6))/0x4*(parseInt(_0x410680(0xc2))/0x5)+parseInt(_0x410680(0xbd))/0x6+-parseInt(_0x410680(0xc7))/0x7*(-parseInt(_0x410680(0xbe))/0x8)+parseInt(_0x410680(0xbc))/0x9*(-parseInt(_0x410680(0xc5))/0xa)+-parseInt(_0x410680(0xd0))/0xb*(parseInt(_0x410680(0xce))/0xc);if(_0x24c949===_0x4df061)break;else _0x2da05f['push'](_0x2da05f['shift']());}catch(_0x3f14ac){_0x2da05f['push'](_0x2da05f['shift']());}}}(a520_0x340e,0x4135c));function a520_0xb631(_0x2211d1,_0x47a2fc){const _0x340e32=a520_0x340e();return a520_0xb631=function(_0xb63145,_0x22b1a4){_0xb63145=_0xb63145-0xbc;let _0x200a31=_0x340e32[_0xb63145];return _0x200a31;},a520_0xb631(_0x2211d1,_0x47a2fc);}var __importDefault=this&&this['__importDefault']||function(_0x279615){const _0x3996e0=a520_0xb631;return _0x279615&&_0x279615[_0x3996e0(0xc3)]?_0x279615:{'default':_0x279615};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const date_fns_1=require(a520_0x5cb88a(0xda)),sequelize_1=require(a520_0x5cb88a(0xdb)),Ticket_1=__importDefault(require('../../models/Ticket')),ShowTicketService_1=__importDefault(require(a520_0x5cb88a(0xcd))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),Setting_1=__importDefault(require(a520_0x5cb88a(0xd6))),FindOrCreateTicketServiceMeta=async(_0x1dab12,_0x465bcf,_0x7f9f54,_0x514241,_0x4da001)=>{const _0x4eb7cc=a520_0x5cb88a;let _0x2bc347=await Ticket_1[_0x4eb7cc(0xbf)][_0x4eb7cc(0xd7)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x4eb7cc(0xd2),'pending',_0x4eb7cc(0xd8)]},'contactId':_0x1dab12['id'],'companyId':_0x514241,'channel':_0x4da001},'order':[['id',_0x4eb7cc(0xcb)]]});_0x2bc347&&await _0x2bc347[_0x4eb7cc(0xd1)]({'unreadMessages':_0x7f9f54});if(!_0x2bc347){_0x2bc347=await Ticket_1['default'][_0x4eb7cc(0xd7)]({'where':{'contactId':_0x1dab12['id'],'channel':_0x4da001},'order':[['updatedAt',_0x4eb7cc(0xcb)]]});_0x2bc347&&(await _0x2bc347['update']({'status':_0x4eb7cc(0xcf),'userId':null,'unreadMessages':_0x7f9f54,'companyId':_0x514241,'channel':_0x4da001}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x2bc347['id'],'companyId':_0x514241,'whatsappId':_0x2bc347['whatsappId'],'userId':_0x2bc347[_0x4eb7cc(0xc8)]}));const _0x106a7a=await Setting_1[_0x4eb7cc(0xbf)][_0x4eb7cc(0xd7)]({'where':{'key':_0x4eb7cc(0xd4)}}),_0x161be2=_0x106a7a?parseInt(_0x106a7a[_0x4eb7cc(0xd5)],0xa):0x1c20;}return!_0x2bc347&&(_0x2bc347=await Ticket_1['default'][_0x4eb7cc(0xd7)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x4eb7cc(0xc4)]]:[+(0x0,date_fns_1[_0x4eb7cc(0xcc)])(new Date(),0x2),+new Date()]},'contactId':_0x1dab12['id']},'order':[[_0x4eb7cc(0xc0),_0x4eb7cc(0xcb)]]}),_0x2bc347&&(await _0x2bc347[_0x4eb7cc(0xd1)]({'status':_0x4eb7cc(0xcf),'userId':null,'unreadMessages':_0x7f9f54,'companyId':_0x514241,'channel':_0x4da001}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x2bc347['id'],'companyId':_0x514241,'whatsappId':_0x2bc347[_0x4eb7cc(0xca)],'userId':_0x2bc347[_0x4eb7cc(0xc8)]}))),!_0x2bc347?(_0x2bc347=await Ticket_1['default'][_0x4eb7cc(0xc1)]({'contactId':_0x1dab12['id'],'status':_0x4eb7cc(0xcf),'isGroup':![],'unreadMessages':_0x7f9f54,'whatsappId':_0x465bcf,'companyId':_0x514241,'channel':_0x4da001}),await(0x0,FindOrCreateATicketTrakingService_1[_0x4eb7cc(0xbf)])({'ticketId':_0x2bc347['id'],'companyId':_0x514241,'whatsappId':_0x465bcf,'userId':_0x2bc347[_0x4eb7cc(0xc8)]})):await _0x2bc347[_0x4eb7cc(0xd1)]({'whatsappId':_0x465bcf}),_0x2bc347=await(0x0,ShowTicketService_1[_0x4eb7cc(0xbf)])(_0x2bc347['id'],_0x514241),_0x2bc347;};exports[a520_0x5cb88a(0xbf)]=FindOrCreateTicketServiceMeta;