'use strict';const a593_0x2a57d1=a593_0x468e;(function(_0x5afb8c,_0x170a98){const _0x2c55ec=a593_0x468e,_0x3546da=_0x5afb8c();while(!![]){try{const _0x5442a7=parseInt(_0x2c55ec(0x86))/0x1+-parseInt(_0x2c55ec(0x85))/0x2+-parseInt(_0x2c55ec(0x9a))/0x3+parseInt(_0x2c55ec(0x9e))/0x4+-parseInt(_0x2c55ec(0x9d))/0x5+parseInt(_0x2c55ec(0x96))/0x6*(-parseInt(_0x2c55ec(0x99))/0x7)+parseInt(_0x2c55ec(0x94))/0x8;if(_0x5442a7===_0x170a98)break;else _0x3546da['push'](_0x3546da['shift']());}catch(_0x34aef2){_0x3546da['push'](_0x3546da['shift']());}}}(a593_0x266a,0xdbd2a));function a593_0x266a(){const _0x4a53d8=['pending','userId','362082IACjqZ','5064369ajLwsE','value','./FindOrCreateATicketTrakingService','6135130tZyFez','2674516Zmjrea','__importDefault','1747156vXFvfZ','1386912kQiluq','create','whatsappId','updatedAt','findOne','DESC','__esModule','closed','default','../../models/Ticket','subHours','sequelize','date-fns','timeCreateNewTicket','29344800vSHrMY','update','120daRlwm'];a593_0x266a=function(){return _0x4a53d8;};return a593_0x266a();}var __importDefault=this&&this[a593_0x2a57d1(0x84)]||function(_0x37afba){const _0xaeb17e=a593_0x2a57d1;return _0x37afba&&_0x37afba[_0xaeb17e(0x8c)]?_0x37afba:{'default':_0x37afba};};Object['defineProperty'](exports,a593_0x2a57d1(0x8c),{'value':!![]});const date_fns_1=require(a593_0x2a57d1(0x92)),sequelize_1=require(a593_0x2a57d1(0x91)),Ticket_1=__importDefault(require(a593_0x2a57d1(0x8f))),ShowTicketService_1=__importDefault(require('./ShowTicketService')),FindOrCreateATicketTrakingService_1=__importDefault(require(a593_0x2a57d1(0x9c))),Setting_1=__importDefault(require('../../models/Setting')),FindOrCreateTicketServiceMeta=async(_0x8acd72,_0x257111,_0x4e2ce2,_0x385c88,_0x5ad64b)=>{const _0x5260b4=a593_0x2a57d1;let _0x3c45ad=await Ticket_1[_0x5260b4(0x8e)][_0x5260b4(0x8a)]({'where':{'status':{[sequelize_1['Op']['or']]:['open','pending',_0x5260b4(0x8d)]},'contactId':_0x8acd72['id'],'companyId':_0x385c88,'channel':_0x5ad64b},'order':[['id',_0x5260b4(0x8b)]]});_0x3c45ad&&await _0x3c45ad[_0x5260b4(0x95)]({'unreadMessages':_0x4e2ce2});if(!_0x3c45ad){_0x3c45ad=await Ticket_1['default'][_0x5260b4(0x8a)]({'where':{'contactId':_0x8acd72['id'],'channel':_0x5ad64b},'order':[[_0x5260b4(0x89),'DESC']]});_0x3c45ad&&(await _0x3c45ad['update']({'status':'pending','userId':null,'unreadMessages':_0x4e2ce2,'companyId':_0x385c88,'channel':_0x5ad64b}),await(0x0,FindOrCreateATicketTrakingService_1[_0x5260b4(0x8e)])({'ticketId':_0x3c45ad['id'],'companyId':_0x385c88,'whatsappId':_0x3c45ad['whatsappId'],'userId':_0x3c45ad['userId']}));const _0x175fb2=await Setting_1[_0x5260b4(0x8e)][_0x5260b4(0x8a)]({'where':{'key':_0x5260b4(0x93)}}),_0x2c5cbe=_0x175fb2?parseInt(_0x175fb2[_0x5260b4(0x9b)],0xa):0x1c20;}return!_0x3c45ad&&(_0x3c45ad=await Ticket_1['default'][_0x5260b4(0x8a)]({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x5260b4(0x90)])(new Date(),0x2),+new Date()]},'contactId':_0x8acd72['id']},'order':[[_0x5260b4(0x89),_0x5260b4(0x8b)]]}),_0x3c45ad&&(await _0x3c45ad[_0x5260b4(0x95)]({'status':_0x5260b4(0x97),'userId':null,'unreadMessages':_0x4e2ce2,'companyId':_0x385c88,'channel':_0x5ad64b}),await(0x0,FindOrCreateATicketTrakingService_1[_0x5260b4(0x8e)])({'ticketId':_0x3c45ad['id'],'companyId':_0x385c88,'whatsappId':_0x3c45ad[_0x5260b4(0x88)],'userId':_0x3c45ad['userId']}))),!_0x3c45ad?(_0x3c45ad=await Ticket_1[_0x5260b4(0x8e)][_0x5260b4(0x87)]({'contactId':_0x8acd72['id'],'status':'pending','isGroup':![],'unreadMessages':_0x4e2ce2,'whatsappId':_0x257111,'companyId':_0x385c88,'channel':_0x5ad64b,'isActiveDemand':![]}),await(0x0,FindOrCreateATicketTrakingService_1[_0x5260b4(0x8e)])({'ticketId':_0x3c45ad['id'],'companyId':_0x385c88,'whatsappId':_0x257111,'userId':_0x3c45ad[_0x5260b4(0x98)]})):await _0x3c45ad[_0x5260b4(0x95)]({'whatsappId':_0x257111}),_0x3c45ad=await(0x0,ShowTicketService_1[_0x5260b4(0x8e)])(_0x3c45ad['id'],_0x385c88),_0x3c45ad;};function a593_0x468e(_0x3b0b3d,_0x1797c8){const _0x266a0d=a593_0x266a();return a593_0x468e=function(_0x468e7f,_0x4a73e1){_0x468e7f=_0x468e7f-0x84;let _0x139d43=_0x266a0d[_0x468e7f];return _0x139d43;},a593_0x468e(_0x3b0b3d,_0x1797c8);}exports['default']=FindOrCreateTicketServiceMeta;