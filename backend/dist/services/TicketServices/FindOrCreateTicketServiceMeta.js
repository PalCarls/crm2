'use strict';const a593_0x8c2e1=a593_0x18f5;(function(_0x1b164e,_0x2e2f6c){const _0x3e6162=a593_0x18f5,_0x202209=_0x1b164e();while(!![]){try{const _0x54bc85=-parseInt(_0x3e6162(0xce))/0x1+parseInt(_0x3e6162(0xcb))/0x2*(-parseInt(_0x3e6162(0xcc))/0x3)+parseInt(_0x3e6162(0xbc))/0x4+-parseInt(_0x3e6162(0xcd))/0x5*(-parseInt(_0x3e6162(0xca))/0x6)+parseInt(_0x3e6162(0xba))/0x7+-parseInt(_0x3e6162(0xbb))/0x8+parseInt(_0x3e6162(0xc5))/0x9*(parseInt(_0x3e6162(0xb7))/0xa);if(_0x54bc85===_0x2e2f6c)break;else _0x202209['push'](_0x202209['shift']());}catch(_0x241765){_0x202209['push'](_0x202209['shift']());}}}(a593_0x2347,0x88afd));function a593_0x18f5(_0x4cf48b,_0x5cc808){const _0x23476a=a593_0x2347();return a593_0x18f5=function(_0x18f5ae,_0x126989){_0x18f5ae=_0x18f5ae-0xb5;let _0x212160=_0x23476a[_0x18f5ae];return _0x212160;},a593_0x18f5(_0x4cf48b,_0x5cc808);}function a593_0x2347(){const _0x26018e=['DESC','./ShowTicketService','./FindOrCreateATicketTrakingService','sequelize','49630FFBxRK','update','../../models/Setting','6831930xtxGem','7015240pgncEt','1484700YQysvv','default','create','subHours','closed','defineProperty','../../models/Ticket','timeCreateNewTicket','whatsappId','333uNBKUJ','findOne','__esModule','userId','open','48EkrBGz','33274MhjVMw','33KZyrVb','350230QcurXl','471383EWeyrt','__importDefault','updatedAt','between','pending'];a593_0x2347=function(){return _0x26018e;};return a593_0x2347();}var __importDefault=this&&this[a593_0x8c2e1(0xcf)]||function(_0x3fdd63){const _0x58ef15=a593_0x8c2e1;return _0x3fdd63&&_0x3fdd63[_0x58ef15(0xc7)]?_0x3fdd63:{'default':_0x3fdd63};};Object[a593_0x8c2e1(0xc1)](exports,a593_0x8c2e1(0xc7),{'value':!![]});const date_fns_1=require('date-fns'),sequelize_1=require(a593_0x8c2e1(0xb6)),Ticket_1=__importDefault(require(a593_0x8c2e1(0xc2))),ShowTicketService_1=__importDefault(require(a593_0x8c2e1(0xd4))),FindOrCreateATicketTrakingService_1=__importDefault(require(a593_0x8c2e1(0xb5))),Setting_1=__importDefault(require(a593_0x8c2e1(0xb9))),FindOrCreateTicketServiceMeta=async(_0x4f7b0f,_0x5e163c,_0x5a8410,_0x37430a,_0x111db2)=>{const _0x1d7408=a593_0x8c2e1;let _0x3f1be1=await Ticket_1['default'][_0x1d7408(0xc6)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x1d7408(0xc9),_0x1d7408(0xd2),_0x1d7408(0xc0)]},'contactId':_0x4f7b0f['id'],'companyId':_0x37430a,'channel':_0x111db2},'order':[['id',_0x1d7408(0xd3)]]});_0x3f1be1&&await _0x3f1be1[_0x1d7408(0xb8)]({'unreadMessages':_0x5a8410});if(!_0x3f1be1){_0x3f1be1=await Ticket_1['default'][_0x1d7408(0xc6)]({'where':{'contactId':_0x4f7b0f['id'],'channel':_0x111db2},'order':[[_0x1d7408(0xd0),_0x1d7408(0xd3)]]});_0x3f1be1&&(await _0x3f1be1['update']({'status':_0x1d7408(0xd2),'userId':null,'unreadMessages':_0x5a8410,'companyId':_0x37430a,'channel':_0x111db2}),await(0x0,FindOrCreateATicketTrakingService_1[_0x1d7408(0xbd)])({'ticketId':_0x3f1be1['id'],'companyId':_0x37430a,'whatsappId':_0x3f1be1[_0x1d7408(0xc4)],'userId':_0x3f1be1['userId']}));const _0x2ab8c5=await Setting_1['default'][_0x1d7408(0xc6)]({'where':{'key':_0x1d7408(0xc3)}}),_0x5630b4=_0x2ab8c5?parseInt(_0x2ab8c5['value'],0xa):0x1c20;}return!_0x3f1be1&&(_0x3f1be1=await Ticket_1[_0x1d7408(0xbd)][_0x1d7408(0xc6)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x1d7408(0xd1)]]:[+(0x0,date_fns_1[_0x1d7408(0xbf)])(new Date(),0x2),+new Date()]},'contactId':_0x4f7b0f['id']},'order':[[_0x1d7408(0xd0),_0x1d7408(0xd3)]]}),_0x3f1be1&&(await _0x3f1be1[_0x1d7408(0xb8)]({'status':_0x1d7408(0xd2),'userId':null,'unreadMessages':_0x5a8410,'companyId':_0x37430a,'channel':_0x111db2}),await(0x0,FindOrCreateATicketTrakingService_1[_0x1d7408(0xbd)])({'ticketId':_0x3f1be1['id'],'companyId':_0x37430a,'whatsappId':_0x3f1be1['whatsappId'],'userId':_0x3f1be1[_0x1d7408(0xc8)]}))),!_0x3f1be1?(_0x3f1be1=await Ticket_1[_0x1d7408(0xbd)][_0x1d7408(0xbe)]({'contactId':_0x4f7b0f['id'],'status':_0x1d7408(0xd2),'isGroup':![],'unreadMessages':_0x5a8410,'whatsappId':_0x5e163c,'companyId':_0x37430a,'channel':_0x111db2,'isActiveDemand':![]}),await(0x0,FindOrCreateATicketTrakingService_1[_0x1d7408(0xbd)])({'ticketId':_0x3f1be1['id'],'companyId':_0x37430a,'whatsappId':_0x5e163c,'userId':_0x3f1be1[_0x1d7408(0xc8)]})):await _0x3f1be1[_0x1d7408(0xb8)]({'whatsappId':_0x5e163c}),_0x3f1be1=await(0x0,ShowTicketService_1[_0x1d7408(0xbd)])(_0x3f1be1['id'],_0x37430a),_0x3f1be1;};exports[a593_0x8c2e1(0xbd)]=FindOrCreateTicketServiceMeta;