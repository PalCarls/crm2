'use strict';const a521_0x4e783f=a521_0xbe1a;function a521_0xd260(){const _0x5c57bc=['subHours','sequelize','whatsappId','pending','11Eqwoke','../../models/Setting','defineProperty','771480ycScJD','date-fns','524ryBJFL','6349896WcAzPm','../../models/Ticket','findOne','update','78005YPdNFY','7617RaYETK','default','DESC','5320580hmdMae','closed','between','2212UDOaJX','updatedAt','userId','381523tdaPFV','timeCreateNewTicket','./ShowTicketService','224kFnttP','open','__importDefault','6978jjkHUd','__esModule'];a521_0xd260=function(){return _0x5c57bc;};return a521_0xd260();}(function(_0x566c9e,_0x421c0b){const _0x20434f=a521_0xbe1a,_0x1ab960=_0x566c9e();while(!![]){try{const _0x54ae08=parseInt(_0x20434f(0xa9))/0x1+parseInt(_0x20434f(0xba))/0x2*(-parseInt(_0x20434f(0xc0))/0x3)+parseInt(_0x20434f(0xac))/0x4*(parseInt(_0x20434f(0xbf))/0x5)+-parseInt(_0x20434f(0xaf))/0x6*(parseInt(_0x20434f(0xc6))/0x7)+parseInt(_0x20434f(0xbb))/0x8+parseInt(_0x20434f(0xb8))/0x9+-parseInt(_0x20434f(0xc3))/0xa*(parseInt(_0x20434f(0xb5))/0xb);if(_0x54ae08===_0x421c0b)break;else _0x1ab960['push'](_0x1ab960['shift']());}catch(_0x534a06){_0x1ab960['push'](_0x1ab960['shift']());}}}(a521_0xd260,0x8b1fc));function a521_0xbe1a(_0x4d6983,_0x237b91){const _0xd2608e=a521_0xd260();return a521_0xbe1a=function(_0xbe1a73,_0x4dc316){_0xbe1a73=_0xbe1a73-0xa8;let _0x1f4536=_0xd2608e[_0xbe1a73];return _0x1f4536;},a521_0xbe1a(_0x4d6983,_0x237b91);}var __importDefault=this&&this[a521_0x4e783f(0xae)]||function(_0x2613dd){const _0x5d1362=a521_0x4e783f;return _0x2613dd&&_0x2613dd[_0x5d1362(0xb0)]?_0x2613dd:{'default':_0x2613dd};};Object[a521_0x4e783f(0xb7)](exports,a521_0x4e783f(0xb0),{'value':!![]});const date_fns_1=require(a521_0x4e783f(0xb9)),sequelize_1=require(a521_0x4e783f(0xb2)),Ticket_1=__importDefault(require(a521_0x4e783f(0xbc))),ShowTicketService_1=__importDefault(require(a521_0x4e783f(0xab))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),Setting_1=__importDefault(require(a521_0x4e783f(0xb6))),FindOrCreateTicketServiceMeta=async(_0x160811,_0x341c3a,_0x1bc1cc,_0xa0127b,_0x4947fd)=>{const _0x365c99=a521_0x4e783f;let _0x290f66=await Ticket_1[_0x365c99(0xc1)][_0x365c99(0xbd)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x365c99(0xad),'pending',_0x365c99(0xc4)]},'contactId':_0x160811['id'],'companyId':_0xa0127b,'channel':_0x4947fd},'order':[['id','DESC']]});_0x290f66&&await _0x290f66[_0x365c99(0xbe)]({'unreadMessages':_0x1bc1cc});if(!_0x290f66){_0x290f66=await Ticket_1[_0x365c99(0xc1)][_0x365c99(0xbd)]({'where':{'contactId':_0x160811['id'],'channel':_0x4947fd},'order':[['updatedAt',_0x365c99(0xc2)]]});_0x290f66&&(await _0x290f66['update']({'status':_0x365c99(0xb4),'userId':null,'unreadMessages':_0x1bc1cc,'companyId':_0xa0127b,'channel':_0x4947fd}),await(0x0,FindOrCreateATicketTrakingService_1[_0x365c99(0xc1)])({'ticketId':_0x290f66['id'],'companyId':_0xa0127b,'whatsappId':_0x290f66[_0x365c99(0xb3)],'userId':_0x290f66[_0x365c99(0xa8)]}));const _0x290cb4=await Setting_1[_0x365c99(0xc1)]['findOne']({'where':{'key':_0x365c99(0xaa)}}),_0x2a0703=_0x290cb4?parseInt(_0x290cb4['value'],0xa):0x1c20;}return!_0x290f66&&(_0x290f66=await Ticket_1[_0x365c99(0xc1)]['findOne']({'where':{'updatedAt':{[sequelize_1['Op'][_0x365c99(0xc5)]]:[+(0x0,date_fns_1[_0x365c99(0xb1)])(new Date(),0x2),+new Date()]},'contactId':_0x160811['id']},'order':[[_0x365c99(0xc7),'DESC']]}),_0x290f66&&(await _0x290f66['update']({'status':'pending','userId':null,'unreadMessages':_0x1bc1cc,'companyId':_0xa0127b,'channel':_0x4947fd}),await(0x0,FindOrCreateATicketTrakingService_1[_0x365c99(0xc1)])({'ticketId':_0x290f66['id'],'companyId':_0xa0127b,'whatsappId':_0x290f66[_0x365c99(0xb3)],'userId':_0x290f66[_0x365c99(0xa8)]}))),!_0x290f66?(_0x290f66=await Ticket_1['default']['create']({'contactId':_0x160811['id'],'status':'pending','isGroup':![],'unreadMessages':_0x1bc1cc,'whatsappId':_0x341c3a,'companyId':_0xa0127b,'channel':_0x4947fd}),await(0x0,FindOrCreateATicketTrakingService_1[_0x365c99(0xc1)])({'ticketId':_0x290f66['id'],'companyId':_0xa0127b,'whatsappId':_0x341c3a,'userId':_0x290f66[_0x365c99(0xa8)]})):await _0x290f66[_0x365c99(0xbe)]({'whatsappId':_0x341c3a}),_0x290f66=await(0x0,ShowTicketService_1[_0x365c99(0xc1)])(_0x290f66['id'],_0xa0127b),_0x290f66;};exports[a521_0x4e783f(0xc1)]=FindOrCreateTicketServiceMeta;