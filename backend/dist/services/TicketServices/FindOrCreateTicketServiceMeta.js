'use strict';const a502_0x2407a4=a502_0x5df8;(function(_0xdfd163,_0x5681a1){const _0x44e2ea=a502_0x5df8,_0x78600e=_0xdfd163();while(!![]){try{const _0x325b66=parseInt(_0x44e2ea(0x17d))/0x1*(-parseInt(_0x44e2ea(0x17c))/0x2)+-parseInt(_0x44e2ea(0x171))/0x3*(parseInt(_0x44e2ea(0x183))/0x4)+parseInt(_0x44e2ea(0x180))/0x5+parseInt(_0x44e2ea(0x170))/0x6+-parseInt(_0x44e2ea(0x176))/0x7*(-parseInt(_0x44e2ea(0x172))/0x8)+-parseInt(_0x44e2ea(0x16f))/0x9+parseInt(_0x44e2ea(0x167))/0xa;if(_0x325b66===_0x5681a1)break;else _0x78600e['push'](_0x78600e['shift']());}catch(_0x20f7a5){_0x78600e['push'](_0x78600e['shift']());}}}(a502_0xff12,0x5e982));function a502_0x5df8(_0x2737bb,_0x1b159e){const _0xff1247=a502_0xff12();return a502_0x5df8=function(_0x5df8e8,_0x5837ee){_0x5df8e8=_0x5df8e8-0x166;let _0x28fce0=_0xff1247[_0x5df8e8];return _0x28fce0;},a502_0x5df8(_0x2737bb,_0x1b159e);}function a502_0xff12(){const _0x3323b9=['1904050nLDnLk','create','./ShowTicketService','userId','__importDefault','closed','findOne','timeCreateNewTicket','3107826OZLuol','990342LQNkYN','3PRmlZJ','2296eThtwh','whatsappId','__esModule','pending','13951WfxuBA','between','open','value','DESC','default','178238wuDwHX','7lAdgXD','updatedAt','update','3289695SICLkO','../../models/Setting','defineProperty','915148uAQUJT','date-fns','subHours'];a502_0xff12=function(){return _0x3323b9;};return a502_0xff12();}var __importDefault=this&&this[a502_0x2407a4(0x16b)]||function(_0x55a48e){const _0x1a8ca4=a502_0x2407a4;return _0x55a48e&&_0x55a48e[_0x1a8ca4(0x174)]?_0x55a48e:{'default':_0x55a48e};};Object[a502_0x2407a4(0x182)](exports,a502_0x2407a4(0x174),{'value':!![]});const date_fns_1=require(a502_0x2407a4(0x184)),sequelize_1=require('sequelize'),Ticket_1=__importDefault(require('../../models/Ticket')),ShowTicketService_1=__importDefault(require(a502_0x2407a4(0x169))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),Setting_1=__importDefault(require(a502_0x2407a4(0x181))),FindOrCreateTicketServiceMeta=async(_0x2ce1c1,_0xd6a61c,_0x3d15ed,_0x3cb9e9,_0x42a18d)=>{const _0x501371=a502_0x2407a4;let _0x5bc97a=await Ticket_1[_0x501371(0x17b)][_0x501371(0x16d)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x501371(0x178),'pending',_0x501371(0x16c)]},'contactId':_0x2ce1c1['id'],'companyId':_0x3cb9e9,'channel':_0x42a18d},'order':[['id','DESC']]});_0x5bc97a&&await _0x5bc97a[_0x501371(0x17f)]({'unreadMessages':_0x3d15ed});if(!_0x5bc97a){_0x5bc97a=await Ticket_1[_0x501371(0x17b)][_0x501371(0x16d)]({'where':{'contactId':_0x2ce1c1['id'],'channel':_0x42a18d},'order':[[_0x501371(0x17e),_0x501371(0x17a)]]});_0x5bc97a&&(await _0x5bc97a[_0x501371(0x17f)]({'status':_0x501371(0x175),'userId':null,'unreadMessages':_0x3d15ed,'companyId':_0x3cb9e9,'channel':_0x42a18d}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x5bc97a['id'],'companyId':_0x3cb9e9,'whatsappId':_0x5bc97a[_0x501371(0x173)],'userId':_0x5bc97a[_0x501371(0x16a)]}));const _0x54149e=await Setting_1[_0x501371(0x17b)][_0x501371(0x16d)]({'where':{'key':_0x501371(0x16e)}}),_0x7e4d09=_0x54149e?parseInt(_0x54149e[_0x501371(0x179)],0xa):0x1c20;}return!_0x5bc97a&&(_0x5bc97a=await Ticket_1[_0x501371(0x17b)][_0x501371(0x16d)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x501371(0x177)]]:[+(0x0,date_fns_1[_0x501371(0x166)])(new Date(),0x2),+new Date()]},'contactId':_0x2ce1c1['id']},'order':[[_0x501371(0x17e),_0x501371(0x17a)]]}),_0x5bc97a&&(await _0x5bc97a['update']({'status':'pending','userId':null,'unreadMessages':_0x3d15ed,'companyId':_0x3cb9e9,'channel':_0x42a18d}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x5bc97a['id'],'companyId':_0x3cb9e9,'whatsappId':_0x5bc97a['whatsappId'],'userId':_0x5bc97a[_0x501371(0x16a)]}))),!_0x5bc97a?(_0x5bc97a=await Ticket_1[_0x501371(0x17b)][_0x501371(0x168)]({'contactId':_0x2ce1c1['id'],'status':_0x501371(0x175),'isGroup':![],'unreadMessages':_0x3d15ed,'whatsappId':_0xd6a61c,'companyId':_0x3cb9e9,'channel':_0x42a18d}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x5bc97a['id'],'companyId':_0x3cb9e9,'whatsappId':_0xd6a61c,'userId':_0x5bc97a[_0x501371(0x16a)]})):await _0x5bc97a[_0x501371(0x17f)]({'whatsappId':_0xd6a61c}),_0x5bc97a=await(0x0,ShowTicketService_1[_0x501371(0x17b)])(_0x5bc97a['id'],_0x3cb9e9),_0x5bc97a;};exports[a502_0x2407a4(0x17b)]=FindOrCreateTicketServiceMeta;