'use strict';function a600_0x1a91(_0x432258,_0x1706e2){const _0x3f0779=a600_0x3f07();return a600_0x1a91=function(_0x1a9126,_0x3f366a){_0x1a9126=_0x1a9126-0x19c;let _0x3f0c77=_0x3f0779[_0x1a9126];return _0x3f0c77;},a600_0x1a91(_0x432258,_0x1706e2);}const a600_0x322d2f=a600_0x1a91;(function(_0x132c50,_0x1af722){const _0x43a58b=a600_0x1a91,_0x81628a=_0x132c50();while(!![]){try{const _0x26cdd5=-parseInt(_0x43a58b(0x1b6))/0x1*(-parseInt(_0x43a58b(0x1b3))/0x2)+parseInt(_0x43a58b(0x1b4))/0x3*(parseInt(_0x43a58b(0x1a1))/0x4)+parseInt(_0x43a58b(0x1af))/0x5+-parseInt(_0x43a58b(0x1a9))/0x6*(-parseInt(_0x43a58b(0x1aa))/0x7)+parseInt(_0x43a58b(0x1b9))/0x8*(-parseInt(_0x43a58b(0x1ad))/0x9)+parseInt(_0x43a58b(0x19f))/0xa+-parseInt(_0x43a58b(0x19e))/0xb;if(_0x26cdd5===_0x1af722)break;else _0x81628a['push'](_0x81628a['shift']());}catch(_0x31ba98){_0x81628a['push'](_0x81628a['shift']());}}}(a600_0x3f07,0xe442f));function a600_0x3f07(){const _0x341310=['whatsappId','156sBUsmg','3OMoEmz','updatedAt','23573zgzPlE','create','__esModule','987560VTtSpj','../../models/Ticket','./ShowTicketService','57916397QJAaJy','15005230AeXkWt','DESC','1723652gVSXUc','./FindOrCreateATicketTrakingService','update','defineProperty','timeCreateNewTicket','../../models/Setting','findOne','default','4284930zIPlyv','14LUYOdr','userId','sequelize','63yOIDnf','subHours','9328805jkWmBa','pending','date-fns'];a600_0x3f07=function(){return _0x341310;};return a600_0x3f07();}var __importDefault=this&&this['__importDefault']||function(_0x1bb136){const _0x591efd=a600_0x1a91;return _0x1bb136&&_0x1bb136[_0x591efd(0x1b8)]?_0x1bb136:{'default':_0x1bb136};};Object[a600_0x322d2f(0x1a4)](exports,a600_0x322d2f(0x1b8),{'value':!![]});const date_fns_1=require(a600_0x322d2f(0x1b1)),sequelize_1=require(a600_0x322d2f(0x1ac)),Ticket_1=__importDefault(require(a600_0x322d2f(0x19c))),ShowTicketService_1=__importDefault(require(a600_0x322d2f(0x19d))),FindOrCreateATicketTrakingService_1=__importDefault(require(a600_0x322d2f(0x1a2))),Setting_1=__importDefault(require(a600_0x322d2f(0x1a6))),FindOrCreateTicketServiceMeta=async(_0x133504,_0x3990f4,_0x51881a,_0x36f620,_0xf20b23)=>{const _0x5bd299=a600_0x322d2f;let _0x43cbd2=await Ticket_1['default'][_0x5bd299(0x1a7)]({'where':{'status':{[sequelize_1['Op']['or']]:['open','pending','closed']},'contactId':_0x133504['id'],'companyId':_0x36f620,'channel':_0xf20b23},'order':[['id',_0x5bd299(0x1a0)]]});_0x43cbd2&&await _0x43cbd2[_0x5bd299(0x1a3)]({'unreadMessages':_0x51881a});if(!_0x43cbd2){_0x43cbd2=await Ticket_1[_0x5bd299(0x1a8)]['findOne']({'where':{'contactId':_0x133504['id'],'channel':_0xf20b23},'order':[[_0x5bd299(0x1b5),'DESC']]});_0x43cbd2&&(await _0x43cbd2[_0x5bd299(0x1a3)]({'status':_0x5bd299(0x1b0),'userId':null,'unreadMessages':_0x51881a,'companyId':_0x36f620,'channel':_0xf20b23}),await(0x0,FindOrCreateATicketTrakingService_1[_0x5bd299(0x1a8)])({'ticketId':_0x43cbd2['id'],'companyId':_0x36f620,'whatsappId':_0x43cbd2[_0x5bd299(0x1b2)],'userId':_0x43cbd2[_0x5bd299(0x1ab)]}));const _0x2752a3=await Setting_1[_0x5bd299(0x1a8)][_0x5bd299(0x1a7)]({'where':{'key':_0x5bd299(0x1a5)}}),_0x239c50=_0x2752a3?parseInt(_0x2752a3['value'],0xa):0x1c20;}return!_0x43cbd2&&(_0x43cbd2=await Ticket_1[_0x5bd299(0x1a8)]['findOne']({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x5bd299(0x1ae)])(new Date(),0x2),+new Date()]},'contactId':_0x133504['id']},'order':[[_0x5bd299(0x1b5),'DESC']]}),_0x43cbd2&&(await _0x43cbd2[_0x5bd299(0x1a3)]({'status':'pending','userId':null,'unreadMessages':_0x51881a,'companyId':_0x36f620,'channel':_0xf20b23}),await(0x0,FindOrCreateATicketTrakingService_1[_0x5bd299(0x1a8)])({'ticketId':_0x43cbd2['id'],'companyId':_0x36f620,'whatsappId':_0x43cbd2[_0x5bd299(0x1b2)],'userId':_0x43cbd2[_0x5bd299(0x1ab)]}))),!_0x43cbd2?(_0x43cbd2=await Ticket_1[_0x5bd299(0x1a8)][_0x5bd299(0x1b7)]({'contactId':_0x133504['id'],'status':'pending','isGroup':![],'unreadMessages':_0x51881a,'whatsappId':_0x3990f4,'companyId':_0x36f620,'channel':_0xf20b23,'isActiveDemand':![]}),await(0x0,FindOrCreateATicketTrakingService_1[_0x5bd299(0x1a8)])({'ticketId':_0x43cbd2['id'],'companyId':_0x36f620,'whatsappId':_0x3990f4,'userId':_0x43cbd2[_0x5bd299(0x1ab)]})):await _0x43cbd2[_0x5bd299(0x1a3)]({'whatsappId':_0x3990f4}),_0x43cbd2=await(0x0,ShowTicketService_1['default'])(_0x43cbd2['id'],_0x36f620),_0x43cbd2;};exports['default']=FindOrCreateTicketServiceMeta;