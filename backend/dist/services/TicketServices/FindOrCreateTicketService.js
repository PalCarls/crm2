'use strict';const a519_0x24a0a1=a519_0x33c6;(function(_0x16bb26,_0x3a25ef){const _0x5ecee8=a519_0x33c6,_0x590d07=_0x16bb26();while(!![]){try{const _0x15a6c1=-parseInt(_0x5ecee8(0x15b))/0x1*(parseInt(_0x5ecee8(0x15d))/0x2)+parseInt(_0x5ecee8(0x166))/0x3*(-parseInt(_0x5ecee8(0x152))/0x4)+parseInt(_0x5ecee8(0x156))/0x5*(parseInt(_0x5ecee8(0x159))/0x6)+parseInt(_0x5ecee8(0x151))/0x7*(-parseInt(_0x5ecee8(0x150))/0x8)+parseInt(_0x5ecee8(0x146))/0x9*(parseInt(_0x5ecee8(0x157))/0xa)+parseInt(_0x5ecee8(0x145))/0xb*(parseInt(_0x5ecee8(0x143))/0xc)+-parseInt(_0x5ecee8(0x14b))/0xd*(-parseInt(_0x5ecee8(0x141))/0xe);if(_0x15a6c1===_0x3a25ef)break;else _0x590d07['push'](_0x590d07['shift']());}catch(_0x20ab8d){_0x590d07['push'](_0x590d07['shift']());}}}(a519_0x4863,0x34ef1));function a519_0x33c6(_0x57c39a,_0x10273d){const _0x4863f9=a519_0x4863();return a519_0x33c6=function(_0x33c6a8,_0x125ff2){_0x33c6a8=_0x33c6a8-0x140;let _0xbebfaf=_0x4863f9[_0x33c6a8];return _0xbebfaf;},a519_0x33c6(_0x57c39a,_0x10273d);}var __importDefault=this&&this['__importDefault']||function(_0x1d34a6){const _0x57a96c=a519_0x33c6;return _0x1d34a6&&_0x1d34a6[_0x57a96c(0x149)]?_0x1d34a6:{'default':_0x1d34a6};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const sequelize_1=require(a519_0x24a0a1(0x167)),date_fns_1=require(a519_0x24a0a1(0x168)),Ticket_1=__importDefault(require(a519_0x24a0a1(0x14c))),ShowTicketService_1=__importDefault(require('./ShowTicketService')),FindOrCreateATicketTrakingService_1=__importDefault(require(a519_0x24a0a1(0x158))),lodash_1=require(a519_0x24a0a1(0x162)),socket_1=require(a519_0x24a0a1(0x163)),logger_1=require(a519_0x24a0a1(0x164)),FindOrCreateTicketService=async(_0x2462c3,_0x1d3a8c,_0x32145d,_0x425fd8,_0x40956f,_0x1fdceb,_0x235ed9,_0x36cb04,_0x4ba62d,_0x58b415,_0x195442)=>{const _0x3fda47=a519_0x24a0a1;try{let _0x2bb395=![];const _0x41fda9=_0x195442['find'](_0x39ffe4=>_0x39ffe4[_0x3fda47(0x165)]==='enableLGPD'),_0x52d27f=_0x195442[_0x3fda47(0x147)](_0x53811c=>_0x53811c[_0x3fda47(0x165)]==='lgpdMessage');let _0x33d352=![];_0x41fda9&&_0x52d27f&&(_0x33d352=_0x41fda9?.[_0x3fda47(0x16d)]===_0x3fda47(0x160)&&_0x52d27f?.[_0x3fda47(0x16d)]!=='');console[_0x3fda47(0x16e)](_0x33d352);const _0x7a3a8b=(0x0,socket_1[_0x3fda47(0x15f)])();let _0x1a552f=await Ticket_1[_0x3fda47(0x161)][_0x3fda47(0x154)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x3fda47(0x142),'pending','group',_0x3fda47(0x140),_0x3fda47(0x15c)]},'contactId':_0x235ed9?_0x235ed9['id']:_0x2462c3['id'],'companyId':_0x425fd8,'whatsappId':_0x1d3a8c['id']},'order':[['id',_0x3fda47(0x14a)]]});if(_0x1a552f){await _0x1a552f[_0x3fda47(0x14d)]({'unreadMessages':_0x32145d}),_0x1a552f=await(0x0,ShowTicketService_1['default'])(_0x1a552f['id'],_0x425fd8),_0x2bb395=!![];return{'ticket':_0x1a552f,'isCreated':_0x2bb395};;}const _0x407aad=_0x1d3a8c[_0x3fda47(0x15a)];!_0x1a552f&&(_0x407aad!==0x0&&(_0x1a552f=await Ticket_1[_0x3fda47(0x161)][_0x3fda47(0x154)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x3fda47(0x14e)]]:[+(0x0,date_fns_1[_0x3fda47(0x14f)])(new Date(),{'minutes':_0x407aad}),+new Date()]},'contactId':_0x2462c3['id'],'companyId':_0x425fd8,'whatsappId':_0x1d3a8c['id']},'order':[['updatedAt',_0x3fda47(0x14a)]]})),_0x1a552f&&_0x1a552f[_0x3fda47(0x16b)]!==_0x3fda47(0x140)&&await _0x1a552f[_0x3fda47(0x14d)]({'status':_0x3fda47(0x153),'userId':null,'unreadMessages':_0x32145d,'companyId':_0x425fd8}));!_0x1a552f&&(_0x1a552f=await Ticket_1[_0x3fda47(0x161)]['create']({'contactId':_0x235ed9?_0x235ed9['id']:_0x2462c3['id'],'status':!_0x4ba62d&&!(0x0,lodash_1[_0x3fda47(0x148)])(_0x41fda9['value'])&&_0x33d352&&!_0x235ed9?_0x3fda47(0x15c):_0x1d3a8c[_0x3fda47(0x155)]===_0x3fda47(0x160)||!_0x235ed9?'pending':'group','isGroup':!!_0x235ed9,'unreadMessages':_0x32145d,'whatsappId':_0x1d3a8c['id'],'companyId':_0x425fd8,'isBot':!![],'channel':_0x36cb04,'imported':_0x4ba62d?new Date():null}),await(0x0,FindOrCreateATicketTrakingService_1[_0x3fda47(0x161)])({'ticketId':_0x1a552f['id'],'companyId':_0x425fd8,'whatsappId':_0x1d3a8c['id'],'userId':_0x1a552f[_0x3fda47(0x16c)]}),_0x2bb395=!![]);_0x40956f!=0x0&&_0x40956f!=undefined&&await _0x1a552f[_0x3fda47(0x14d)]({'queueId':_0x40956f});_0x1fdceb!=0x0&&_0x1fdceb!=undefined&&await _0x1a552f['update']({'userId':_0x1fdceb});_0x1a552f=await(0x0,ShowTicketService_1[_0x3fda47(0x161)])(_0x1a552f['id'],_0x425fd8);!_0x58b415&&_0x7a3a8b['to'](_0x1a552f[_0x3fda47(0x16b)])['to']('notification')['to'](_0x1a552f['id']['toString']())[_0x3fda47(0x144)](_0x3fda47(0x16a)+_0x425fd8+_0x3fda47(0x169),{'action':_0x3fda47(0x14d),'ticket':_0x1a552f});;return{'ticket':_0x1a552f,'isCreated':_0x2bb395};}catch(_0x487497){logger_1['logger']['error'](_0x3fda47(0x15e),_0x487497);}};exports['default']=FindOrCreateTicketService;function a519_0x4863(){const _0x2ac2c6=['find','isNil','__esModule','DESC','118027Kvxkeg','../../models/Ticket','update','between','add','1248328lknHCK','7rxBhBx','8Rkinie','closed','findOne','groupAsTicket','5iPmvFY','194590xNwfKF','./FindOrCreateATicketTrakingService','1257006KlDSRN','timeCreateNewTicket','10863FhMiJr','lgpd','44torKvT','Error\x20to\x20find\x20or\x20create\x20a\x20ticket:','getIO','enabled','default','lodash','../../libs/socket','../../utils/logger','key','191787FIyRBB','sequelize','date-fns','-ticket','company-','status','userId','value','log','nps','434APjXWz','open','2628nMZxTo','emit','11517aCnzFU','9ZllLms'];a519_0x4863=function(){return _0x2ac2c6;};return a519_0x4863();}