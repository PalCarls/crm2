<<<<<<< HEAD
'use strict';const a582_0x12c1ae=a582_0x598e;(function(_0x19ec74,_0x5c59b4){const _0x4b631f=a582_0x598e,_0x27b283=_0x19ec74();while(!![]){try{const _0x3bb8e4=-parseInt(_0x4b631f(0x17a))/0x1+parseInt(_0x4b631f(0x170))/0x2*(-parseInt(_0x4b631f(0x17d))/0x3)+parseInt(_0x4b631f(0x174))/0x4+-parseInt(_0x4b631f(0x18a))/0x5*(-parseInt(_0x4b631f(0x188))/0x6)+-parseInt(_0x4b631f(0x172))/0x7+-parseInt(_0x4b631f(0x16a))/0x8+-parseInt(_0x4b631f(0x18f))/0x9*(-parseInt(_0x4b631f(0x177))/0xa);if(_0x3bb8e4===_0x5c59b4)break;else _0x27b283['push'](_0x27b283['shift']());}catch(_0x482ad7){_0x27b283['push'](_0x27b283['shift']());}}}(a582_0x946a,0x8ba2f));function a582_0x946a(){const _0x3cdddc=['enabled','4313624sETMwD','create','open','1520imXycu','./ShowTicketService','pending','439147sYaHjw','__esModule','enableLGPD','288ldbnUi','updatedAt','isNil','\x20-\x20','user','-ticket','nps','./CreateLogTicketService','timeCreateNewTicket','../../libs/socket','./UpdateTicketService','66jVPBxv','defineProperty','32595FiCIBA','group','userId','lgpdConsent','Fila:\x20','34389gatiMq','../../errors/AppError','lgpdAcceptedAt','lodash','between','groupAsTicket','emit','toString','lgpd','sub','update','DESC','default','name','../../models/Ticket','notification','date-fns','1649056YHzKNz','Ticket\x20em\x20outro\x20atendimento.\x20','findOne','disabled','status','./FindOrCreateATicketTrakingService','204VHPVUn','__importDefault','3527195TKFaYF'];a582_0x946a=function(){return _0x3cdddc;};return a582_0x946a();}function a582_0x598e(_0x2e7350,_0x1010b7){const _0x946ac7=a582_0x946a();return a582_0x598e=function(_0x598e53,_0x3806a6){_0x598e53=_0x598e53-0x16a;let _0x1bccc6=_0x946ac7[_0x598e53];return _0x1bccc6;},a582_0x598e(_0x2e7350,_0x1010b7);}var __importDefault=this&&this[a582_0x12c1ae(0x171)]||function(_0x1b3171){const _0x4df969=a582_0x12c1ae;return _0x1b3171&&_0x1b3171[_0x4df969(0x17b)]?_0x1b3171:{'default':_0x1b3171};};Object[a582_0x12c1ae(0x189)](exports,a582_0x12c1ae(0x17b),{'value':!![]});const sequelize_1=require('sequelize'),date_fns_1=require(a582_0x12c1ae(0x19f)),Ticket_1=__importDefault(require(a582_0x12c1ae(0x19d))),ShowTicketService_1=__importDefault(require(a582_0x12c1ae(0x178))),FindOrCreateATicketTrakingService_1=__importDefault(require(a582_0x12c1ae(0x16f))),lodash_1=require(a582_0x12c1ae(0x192)),socket_1=require(a582_0x12c1ae(0x186)),CreateLogTicketService_1=__importDefault(require(a582_0x12c1ae(0x184))),AppError_1=__importDefault(require(a582_0x12c1ae(0x190))),UpdateTicketService_1=__importDefault(require(a582_0x12c1ae(0x187))),FindOrCreateTicketService=async(_0x35677f,_0x55dc49,_0x1afd2b,_0x34e55b,_0x2f41f5,_0x4ade7b,_0x10c69d,_0x2126e2,_0x1658d2,_0x1aab19,_0x91da13)=>{const _0x209427=a582_0x12c1ae;let _0x23bc2e=![],_0x571ddc=![];_0x91da13[_0x209427(0x17c)]&&(_0x571ddc=_0x91da13[_0x209427(0x17c)]==='enabled'&&_0x91da13['lgpdMessage']!==''&&(_0x91da13[_0x209427(0x18d)]===_0x209427(0x173)||_0x91da13[_0x209427(0x18d)]===_0x209427(0x16d)&&(0x0,lodash_1[_0x209427(0x17f)])(_0x35677f[_0x209427(0x191)])));const _0x377b0f=(0x0,socket_1['getIO'])();let _0x34f8e7=await Ticket_1[_0x209427(0x19b)][_0x209427(0x16c)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x209427(0x176),_0x209427(0x179),_0x209427(0x18b),_0x209427(0x183),_0x209427(0x197)]},'contactId':_0x10c69d?_0x10c69d['id']:_0x35677f['id'],'companyId':_0x34e55b,'whatsappId':_0x55dc49['id']},'order':[['id',_0x209427(0x19a)]]});if(_0x34f8e7){await(0x0,UpdateTicketService_1['default'])({'ticketId':_0x34f8e7['id'],'ticketData':{'unreadMessages':_0x1afd2b,'isBot':![]},'companyId':_0x34e55b}),_0x34f8e7=await(0x0,ShowTicketService_1['default'])(_0x34f8e7['id'],_0x34e55b);if(Number(_0x34f8e7?.[_0x209427(0x18c)])!==Number(_0x4ade7b)&&_0x4ade7b!==0x0&&_0x4ade7b!==''&&_0x4ade7b!=='0'||_0x2f41f5!==0x0&&Number(_0x34f8e7?.['queueId'])!==Number(_0x2f41f5)&&_0x2f41f5!==''&&_0x2f41f5!=='0')throw new AppError_1['default'](_0x209427(0x16b)+('Atendente:\x20'+_0x34f8e7[_0x209427(0x181)]['name'])+_0x209427(0x180)+(_0x209427(0x18e)+_0x34f8e7['queue'][_0x209427(0x19c)]));return _0x23bc2e=!![],{'ticket':_0x34f8e7,'isCreated':_0x23bc2e};}const _0x190e86=_0x55dc49[_0x209427(0x185)];!_0x34f8e7&&_0x190e86!==0x0&&(_0x190e86!==0x0&&_0x190e86!=='0'&&(_0x34f8e7=await Ticket_1[_0x209427(0x19b)]['findOne']({'where':{'updatedAt':{[sequelize_1['Op'][_0x209427(0x193)]]:[+(0x0,date_fns_1[_0x209427(0x198)])(new Date(),{'minutes':Number(_0x190e86)}),+new Date()]},'contactId':_0x35677f['id'],'companyId':_0x34e55b,'whatsappId':_0x55dc49['id']},'order':[[_0x209427(0x17e),_0x209427(0x19a)]]})),_0x34f8e7&&_0x34f8e7[_0x209427(0x16e)]!==_0x209427(0x183)&&await _0x34f8e7[_0x209427(0x199)]({'status':'pending','unreadMessages':_0x1afd2b,'companyId':_0x34e55b}));!_0x34f8e7&&(_0x34f8e7=await Ticket_1[_0x209427(0x19b)]['create']({'contactId':_0x10c69d?_0x10c69d['id']:_0x35677f['id'],'status':!_0x1658d2&&!(0x0,lodash_1[_0x209427(0x17f)])(_0x91da13[_0x209427(0x17c)])&&_0x571ddc&&!_0x10c69d?'lgpd':_0x55dc49[_0x209427(0x194)]===_0x209427(0x173)||!_0x10c69d?_0x209427(0x179):_0x209427(0x18b),'isGroup':!!_0x10c69d,'unreadMessages':_0x1afd2b,'whatsappId':_0x55dc49['id'],'companyId':_0x34e55b,'isBot':_0x10c69d?![]:!![],'channel':_0x2126e2,'imported':_0x1658d2?new Date():null}),await(0x0,FindOrCreateATicketTrakingService_1[_0x209427(0x19b)])({'ticketId':_0x34f8e7['id'],'companyId':_0x34e55b,'whatsappId':_0x55dc49['id'],'userId':_0x34f8e7['userId']}),_0x23bc2e=!![]);_0x2f41f5!=0x0&&_0x2f41f5!=undefined&&await _0x34f8e7[_0x209427(0x199)]({'queueId':_0x2f41f5});_0x4ade7b!=0x0&&_0x4ade7b!=undefined&&await _0x34f8e7[_0x209427(0x199)]({'userId':_0x4ade7b});_0x34f8e7=await(0x0,ShowTicketService_1['default'])(_0x34f8e7['id'],_0x34e55b),await(0x0,CreateLogTicketService_1[_0x209427(0x19b)])({'ticketId':_0x34f8e7['id'],'type':_0x571ddc?_0x209427(0x197):_0x209427(0x175)});!_0x1aab19&&_0x377b0f['to'](_0x34f8e7[_0x209427(0x16e)])['to'](_0x209427(0x19e))['to'](_0x34f8e7['id'][_0x209427(0x196)]())[_0x209427(0x195)]('company-'+_0x34e55b+_0x209427(0x182),{'action':_0x209427(0x199),'ticket':_0x34f8e7});;return{'ticket':_0x34f8e7,'isCreated':_0x23bc2e};};exports[a582_0x12c1ae(0x19b)]=FindOrCreateTicketService;
=======
'use strict';const a581_0x4665a1=a581_0x1e3f;(function(_0x1b42f7,_0x429545){const _0x5c36ab=a581_0x1e3f,_0x168b2a=_0x1b42f7();while(!![]){try{const _0xbd31d1=-parseInt(_0x5c36ab(0x116))/0x1*(-parseInt(_0x5c36ab(0x100))/0x2)+parseInt(_0x5c36ab(0x12f))/0x3*(-parseInt(_0x5c36ab(0xff))/0x4)+parseInt(_0x5c36ab(0x10c))/0x5*(-parseInt(_0x5c36ab(0x12e))/0x6)+-parseInt(_0x5c36ab(0x115))/0x7+-parseInt(_0x5c36ab(0x12c))/0x8*(-parseInt(_0x5c36ab(0x12a))/0x9)+parseInt(_0x5c36ab(0x11e))/0xa+parseInt(_0x5c36ab(0x129))/0xb;if(_0xbd31d1===_0x429545)break;else _0x168b2a['push'](_0x168b2a['shift']());}catch(_0x7fe146){_0x168b2a['push'](_0x168b2a['shift']());}}}(a581_0x1d5b,0xcd3e1));function a581_0x1d5b(){const _0x47bb3e=['defineProperty','34079386bWZjNW','27GdojiG','../../errors/AppError','1399448tUzexO','__esModule','1414710AJlUfP','19368gGUTYe','open','Ticket\x20em\x20outro\x20atendimento.\x20','updatedAt','enabled','./CreateLogTicketService','sub','queue','-ticket','default','444fmBJXa','621470xkaRBG','isNil','sequelize','Fila:\x20','disabled','user','enableLGPD','emit','pending','group','DESC','queueId','35hkokal','./ShowTicketService','create','notification','name','update','nps','__importDefault','lgpdAcceptedAt','9784579mnaeJB','1aseYUY','date-fns','lgpd','./UpdateTicketService','lgpdConsent','timeCreateNewTicket','getIO','userId','6719270wuauoc','\x20-\x20','groupAsTicket','company-','toString','lodash','../../libs/socket','findOne','status','./FindOrCreateATicketTrakingService'];a581_0x1d5b=function(){return _0x47bb3e;};return a581_0x1d5b();}var __importDefault=this&&this[a581_0x4665a1(0x113)]||function(_0x56b057){const _0x57a455=a581_0x4665a1;return _0x56b057&&_0x56b057[_0x57a455(0x12d)]?_0x56b057:{'default':_0x56b057};};Object[a581_0x4665a1(0x128)](exports,a581_0x4665a1(0x12d),{'value':!![]});const sequelize_1=require(a581_0x4665a1(0x102)),date_fns_1=require(a581_0x4665a1(0x117)),Ticket_1=__importDefault(require('../../models/Ticket')),ShowTicketService_1=__importDefault(require(a581_0x4665a1(0x10d))),FindOrCreateATicketTrakingService_1=__importDefault(require(a581_0x4665a1(0x127))),lodash_1=require(a581_0x4665a1(0x123)),socket_1=require(a581_0x4665a1(0x124)),CreateLogTicketService_1=__importDefault(require(a581_0x4665a1(0xfa))),AppError_1=__importDefault(require(a581_0x4665a1(0x12b))),UpdateTicketService_1=__importDefault(require(a581_0x4665a1(0x119))),FindOrCreateTicketService=async(_0x2305f1,_0x406c38,_0xdb521b,_0x585895,_0x2d7753,_0x5d92ea,_0x43282a,_0x31e1bf,_0x3b5d98,_0x53f2cd,_0x22b22a)=>{const _0x306170=a581_0x4665a1;let _0x2ca4be=![],_0x21d7f7=![];_0x22b22a[_0x306170(0x106)]&&(_0x21d7f7=_0x22b22a[_0x306170(0x106)]==='enabled'&&_0x22b22a['lgpdMessage']!==''&&(_0x22b22a[_0x306170(0x11a)]===_0x306170(0xf9)||_0x22b22a[_0x306170(0x11a)]===_0x306170(0x104)&&(0x0,lodash_1[_0x306170(0x101)])(_0x2305f1[_0x306170(0x114)])));const _0x2a324e=(0x0,socket_1[_0x306170(0x11c)])();let _0x446e33=await Ticket_1['default']['findOne']({'where':{'status':{[sequelize_1['Op']['or']]:[_0x306170(0xf6),'pending',_0x306170(0x109),'nps',_0x306170(0x118)]},'contactId':_0x43282a?_0x43282a['id']:_0x2305f1['id'],'companyId':_0x585895,'whatsappId':_0x406c38['id']},'order':[['id',_0x306170(0x10a)]]});if(_0x446e33){await(0x0,UpdateTicketService_1[_0x306170(0xfe)])({'ticketId':_0x446e33['id'],'ticketData':{'unreadMessages':_0xdb521b,'isBot':![]},'companyId':_0x585895}),_0x446e33=await(0x0,ShowTicketService_1[_0x306170(0xfe)])(_0x446e33['id'],_0x585895);if(Number(_0x446e33?.[_0x306170(0x11d)])!==Number(_0x5d92ea)&&_0x5d92ea!==0x0&&_0x5d92ea!==''&&_0x5d92ea!=='0'||_0x2d7753!==0x0&&Number(_0x446e33?.[_0x306170(0x10b)])!==Number(_0x2d7753)&&_0x2d7753!==''&&_0x2d7753!=='0')throw new AppError_1['default'](_0x306170(0xf7)+('Atendente:\x20'+_0x446e33[_0x306170(0x105)][_0x306170(0x110)])+_0x306170(0x11f)+(_0x306170(0x103)+_0x446e33[_0x306170(0xfc)][_0x306170(0x110)]));return _0x2ca4be=!![],{'ticket':_0x446e33,'isCreated':_0x2ca4be};}const _0x515269=_0x406c38[_0x306170(0x11b)];!_0x446e33&&_0x515269!==0x0&&(_0x515269!==0x0&&_0x515269!=='0'&&(_0x446e33=await Ticket_1['default'][_0x306170(0x125)]({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x306170(0xfb)])(new Date(),{'minutes':Number(_0x515269)}),+new Date()]},'contactId':_0x2305f1['id'],'companyId':_0x585895,'whatsappId':_0x406c38['id']},'order':[[_0x306170(0xf8),_0x306170(0x10a)]]})),_0x446e33&&_0x446e33[_0x306170(0x126)]!==_0x306170(0x112)&&await _0x446e33[_0x306170(0x111)]({'status':'pending','unreadMessages':_0xdb521b,'companyId':_0x585895}));!_0x446e33&&(_0x446e33=await Ticket_1[_0x306170(0xfe)][_0x306170(0x10e)]({'contactId':_0x43282a?_0x43282a['id']:_0x2305f1['id'],'status':!_0x3b5d98&&!(0x0,lodash_1[_0x306170(0x101)])(_0x22b22a[_0x306170(0x106)])&&_0x21d7f7&&!_0x43282a?_0x306170(0x118):_0x406c38[_0x306170(0x120)]===_0x306170(0xf9)||!_0x43282a?_0x306170(0x108):'group','isGroup':!!_0x43282a,'unreadMessages':_0xdb521b,'whatsappId':_0x406c38['id'],'companyId':_0x585895,'isBot':_0x43282a?![]:!![],'channel':_0x31e1bf,'imported':_0x3b5d98?new Date():null}),await(0x0,FindOrCreateATicketTrakingService_1[_0x306170(0xfe)])({'ticketId':_0x446e33['id'],'companyId':_0x585895,'whatsappId':_0x406c38['id'],'userId':_0x446e33[_0x306170(0x11d)]}),_0x2ca4be=!![]);_0x2d7753!=0x0&&_0x2d7753!=undefined&&await _0x446e33[_0x306170(0x111)]({'queueId':_0x2d7753});_0x5d92ea!=0x0&&_0x5d92ea!=undefined&&await _0x446e33[_0x306170(0x111)]({'userId':_0x5d92ea});_0x446e33=await(0x0,ShowTicketService_1[_0x306170(0xfe)])(_0x446e33['id'],_0x585895),await(0x0,CreateLogTicketService_1[_0x306170(0xfe)])({'ticketId':_0x446e33['id'],'type':_0x21d7f7?_0x306170(0x118):_0x306170(0x10e)});!_0x53f2cd&&_0x2a324e['to'](_0x446e33['status'])['to'](_0x306170(0x10f))['to'](_0x446e33['id'][_0x306170(0x122)]())[_0x306170(0x107)](_0x306170(0x121)+_0x585895+_0x306170(0xfd),{'action':'update','ticket':_0x446e33});;return{'ticket':_0x446e33,'isCreated':_0x2ca4be};};function a581_0x1e3f(_0xc6edf0,_0x35ef1b){const _0x1d5b02=a581_0x1d5b();return a581_0x1e3f=function(_0x1e3f74,_0x406fd6){_0x1e3f74=_0x1e3f74-0xf6;let _0x1527f1=_0x1d5b02[_0x1e3f74];return _0x1527f1;},a581_0x1e3f(_0xc6edf0,_0x35ef1b);}exports[a581_0x4665a1(0xfe)]=FindOrCreateTicketService;
>>>>>>> ab722bfbcf394d74dd0b99a984c0dcf6ffbcff7f
