'use strict';function a519_0x5ece(_0x119dad,_0x1c32f8){const _0x1ad5cf=a519_0x1ad5();return a519_0x5ece=function(_0x5ece43,_0x317192){_0x5ece43=_0x5ece43-0xba;let _0x5e8586=_0x1ad5cf[_0x5ece43];return _0x5e8586;},a519_0x5ece(_0x119dad,_0x1c32f8);}const a519_0x1a5080=a519_0x5ece;(function(_0x3dd43c,_0x4bd9ae){const _0x38413e=a519_0x5ece,_0x4c73a2=_0x3dd43c();while(!![]){try{const _0x4d6389=parseInt(_0x38413e(0xd3))/0x1+parseInt(_0x38413e(0xe7))/0x2*(parseInt(_0x38413e(0xe6))/0x3)+-parseInt(_0x38413e(0xc8))/0x4*(-parseInt(_0x38413e(0xc3))/0x5)+parseInt(_0x38413e(0xbf))/0x6+parseInt(_0x38413e(0xbb))/0x7*(parseInt(_0x38413e(0xcf))/0x8)+-parseInt(_0x38413e(0xe9))/0x9+-parseInt(_0x38413e(0xbe))/0xa;if(_0x4d6389===_0x4bd9ae)break;else _0x4c73a2['push'](_0x4c73a2['shift']());}catch(_0x561c87){_0x4c73a2['push'](_0x4c73a2['shift']());}}}(a519_0x1ad5,0x50ab1));var __importDefault=this&&this[a519_0x1a5080(0xd1)]||function(_0x1d9411){const _0x472087=a519_0x1a5080;return _0x1d9411&&_0x1d9411[_0x472087(0xea)]?_0x1d9411:{'default':_0x1d9411};};Object[a519_0x1a5080(0xcb)](exports,a519_0x1a5080(0xea),{'value':!![]});const sequelize_1=require(a519_0x1a5080(0xcd)),date_fns_1=require(a519_0x1a5080(0xd7)),Ticket_1=__importDefault(require('../../models/Ticket')),ShowTicketService_1=__importDefault(require(a519_0x1a5080(0xdf))),FindOrCreateATicketTrakingService_1=__importDefault(require(a519_0x1a5080(0xd4))),lodash_1=require(a519_0x1a5080(0xdb)),socket_1=require(a519_0x1a5080(0xc9)),logger_1=require(a519_0x1a5080(0xc0)),FindOrCreateTicketService=async(_0xcc6d59,_0x495ea0,_0x540e04,_0x2715cb,_0x26ad55,_0x46f6da,_0x1eb34d,_0x5e4377,_0x31c72e,_0x55c464,_0x45b8be)=>{const _0x107a0b=a519_0x1a5080;try{let _0x50c315=![];const _0x5de6c6=_0x45b8be[_0x107a0b(0xd0)](_0x19117d=>_0x19117d[_0x107a0b(0xd9)]===_0x107a0b(0xc4)),_0x520490=_0x45b8be['find'](_0x2a853c=>_0x2a853c['key']===_0x107a0b(0xdd));let _0x1ae2a2=![];_0x5de6c6&&_0x520490&&(_0x1ae2a2=_0x5de6c6?.['value']==='enabled'&&_0x520490?.[_0x107a0b(0xd2)]!=='');console[_0x107a0b(0xe4)](_0x1ae2a2);const _0x389947=(0x0,socket_1[_0x107a0b(0xe5)])();let _0x32b853=await Ticket_1[_0x107a0b(0xe8)][_0x107a0b(0xe0)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x107a0b(0xec),'pending',_0x107a0b(0xbc),_0x107a0b(0xcc),'lgpd']},'contactId':_0x1eb34d?_0x1eb34d['id']:_0xcc6d59['id'],'companyId':_0x2715cb,'whatsappId':_0x495ea0['id']},'order':[['id',_0x107a0b(0xca)]]});if(_0x32b853){await _0x32b853['update']({'unreadMessages':_0x540e04}),_0x32b853=await(0x0,ShowTicketService_1[_0x107a0b(0xe8)])(_0x32b853['id'],_0x2715cb),_0x50c315=!![];return{'ticket':_0x32b853,'isCreated':_0x50c315};;}const _0x5f5505=_0x495ea0[_0x107a0b(0xeb)];!_0x32b853&&(_0x5f5505!==0x0&&(_0x32b853=await Ticket_1[_0x107a0b(0xe8)][_0x107a0b(0xe0)]({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1['add'])(new Date(),{'minutes':_0x5f5505}),+new Date()]},'contactId':_0xcc6d59['id'],'companyId':_0x2715cb,'whatsappId':_0x495ea0['id']},'order':[[_0x107a0b(0xe1),_0x107a0b(0xca)]]})),_0x32b853&&_0x32b853[_0x107a0b(0xda)]!==_0x107a0b(0xcc)&&await _0x32b853['update']({'status':_0x107a0b(0xd5),'userId':null,'unreadMessages':_0x540e04,'companyId':_0x2715cb}));!_0x32b853&&(_0x32b853=await Ticket_1[_0x107a0b(0xe8)][_0x107a0b(0xc5)]({'contactId':_0x1eb34d?_0x1eb34d['id']:_0xcc6d59['id'],'status':!_0x31c72e&&!(0x0,lodash_1[_0x107a0b(0xc6)])(_0x5de6c6['value'])&&_0x1ae2a2&&!_0x1eb34d?_0x107a0b(0xc2):_0x495ea0[_0x107a0b(0xd6)]===_0x107a0b(0xde)||!_0x1eb34d?_0x107a0b(0xc7):_0x107a0b(0xbc),'isGroup':!!_0x1eb34d,'unreadMessages':_0x540e04,'whatsappId':_0x495ea0['id'],'companyId':_0x2715cb,'isBot':!![],'channel':_0x5e4377,'imported':_0x31c72e?new Date():null}),await(0x0,FindOrCreateATicketTrakingService_1[_0x107a0b(0xe8)])({'ticketId':_0x32b853['id'],'companyId':_0x2715cb,'whatsappId':_0x495ea0['id'],'userId':_0x32b853['userId']}),_0x50c315=!![]);_0x26ad55!=0x0&&_0x26ad55!=undefined&&await _0x32b853[_0x107a0b(0xba)]({'queueId':_0x26ad55});_0x46f6da!=0x0&&_0x46f6da!=undefined&&await _0x32b853['update']({'userId':_0x46f6da});_0x32b853=await(0x0,ShowTicketService_1[_0x107a0b(0xe8)])(_0x32b853['id'],_0x2715cb);!_0x55c464&&_0x389947['to'](_0x32b853['status'])['to'](_0x107a0b(0xbd))['to'](_0x32b853['id']['toString']())[_0x107a0b(0xdc)](_0x107a0b(0xc1)+_0x2715cb+_0x107a0b(0xd8),{'action':_0x107a0b(0xba),'ticket':_0x32b853});;return{'ticket':_0x32b853,'isCreated':_0x50c315};}catch(_0x3e7d1f){logger_1[_0x107a0b(0xce)][_0x107a0b(0xe2)](_0x107a0b(0xe3),_0x3e7d1f);}};exports[a519_0x1a5080(0xe8)]=FindOrCreateTicketService;function a519_0x1ad5(){const _0xab97d8=['../../libs/socket','DESC','defineProperty','nps','sequelize','logger','11656FdPZea','find','__importDefault','value','79007pSduGc','./FindOrCreateATicketTrakingService','closed','groupAsTicket','date-fns','-ticket','key','status','lodash','emit','lgpdMessage','enabled','./ShowTicketService','findOne','updatedAt','error','Error\x20to\x20find\x20or\x20create\x20a\x20ticket:','log','getIO','34497WrOwfr','74IkiTjB','default','92106thFFgg','__esModule','timeCreateNewTicket','open','update','91vXMibd','group','notification','12550740QZUdUP','3929622euQJoK','../../utils/logger','company-','lgpd','5NzcoEI','enableLGPD','create','isNil','pending','1669508pZWMTf'];a519_0x1ad5=function(){return _0xab97d8;};return a519_0x1ad5();}