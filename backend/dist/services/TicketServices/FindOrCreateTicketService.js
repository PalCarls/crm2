'use strict';const a484_0x5bd444=a484_0x5590;function a484_0x42c7(){const _0xfdaca3=['50589012fZDCNY','13hYwJLa','6WwUKZg','9819gFXEEf','-ticket','__importDefault','isNil','../SettingServices/ListSettingsServiceOne','pending','defineProperty','getIO','30GqWbLx','1170234bMlUJz','date-fns','12355196DNaabc','timeCreateNewTicket','updatedAt','toString','nps','add','findOne','enableLGPD','emit','open','../WhatsappService/ShowWhatsAppService','1588893MfowBo','115QzxwXT','enabled','groupAsTicket','__esModule','value','DESC','between','lgpd','whatsappId','./ShowTicketService','../../models/Ticket','userId','96dvKiTU','558pJssMl','../../libs/socket','notification','default','./FindOrCreateATicketTrakingService','status','289676QtCOdF','4138618oirUuU','update','company-','group','sequelize'];a484_0x42c7=function(){return _0xfdaca3;};return a484_0x42c7();}(function(_0x39eb04,_0x56975b){const _0x381dad=a484_0x5590,_0x3ea2f8=_0x39eb04();while(!![]){try{const _0x500b74=-parseInt(_0x381dad(0x9e))/0x1+parseInt(_0x381dad(0x79))/0x2*(parseInt(_0x381dad(0x88))/0x3)+parseInt(_0x381dad(0x7f))/0x4*(-parseInt(_0x381dad(0x9f))/0x5)+parseInt(_0x381dad(0x87))/0x6*(parseInt(_0x381dad(0x93))/0x7)+parseInt(_0x381dad(0x78))/0x8*(-parseInt(_0x381dad(0x91))/0x9)+-parseInt(_0x381dad(0x90))/0xa*(parseInt(_0x381dad(0x80))/0xb)+parseInt(_0x381dad(0x85))/0xc*(parseInt(_0x381dad(0x86))/0xd);if(_0x500b74===_0x56975b)break;else _0x3ea2f8['push'](_0x3ea2f8['shift']());}catch(_0x4b7eb8){_0x3ea2f8['push'](_0x3ea2f8['shift']());}}}(a484_0x42c7,0xe8076));var __importDefault=this&&this[a484_0x5bd444(0x8a)]||function(_0x94742d){const _0xc90a5e=a484_0x5bd444;return _0x94742d&&_0x94742d[_0xc90a5e(0x6f)]?_0x94742d:{'default':_0x94742d};};function a484_0x5590(_0x208871,_0x11732e){const _0x42c78e=a484_0x42c7();return a484_0x5590=function(_0x559084,_0x3e7018){_0x559084=_0x559084-0x6e;let _0x2d9f40=_0x42c78e[_0x559084];return _0x2d9f40;},a484_0x5590(_0x208871,_0x11732e);}Object[a484_0x5bd444(0x8e)](exports,a484_0x5bd444(0x6f),{'value':!![]});const sequelize_1=require(a484_0x5bd444(0x84)),date_fns_1=require(a484_0x5bd444(0x92)),Ticket_1=__importDefault(require(a484_0x5bd444(0x76))),ShowTicketService_1=__importDefault(require(a484_0x5bd444(0x75))),FindOrCreateATicketTrakingService_1=__importDefault(require(a484_0x5bd444(0x7d))),ListSettingsServiceOne_1=__importDefault(require(a484_0x5bd444(0x8c))),lodash_1=require('lodash'),socket_1=require(a484_0x5bd444(0x7a)),ShowWhatsAppService_1=__importDefault(require(a484_0x5bd444(0x9d))),FindOrCreateTicketService=async(_0x1051d6,_0x3ff6b8,_0xd70b2e,_0x1a3431,_0x19ce3d,_0x3043af,_0x1bc4c1,_0xa5fd38)=>{const _0x32db57=a484_0x5bd444;let _0x4bc30b=![];const _0x439cab=(0x0,socket_1[_0x32db57(0x8f)])(),_0x574026=await(0x0,ShowWhatsAppService_1['default'])(_0x3ff6b8,_0x1a3431),_0x2703bb=await(0x0,ListSettingsServiceOne_1[_0x32db57(0x7c)])({'companyId':_0x1a3431,'key':_0x32db57(0x9a)});let _0x2e9e8f=await Ticket_1[_0x32db57(0x7c)][_0x32db57(0x99)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x32db57(0x9c),_0x32db57(0x8d),_0x32db57(0x83),_0x32db57(0x97),'lgpd']},'contactId':_0x1bc4c1?_0x1bc4c1['id']:_0x1051d6['id'],'companyId':_0x1a3431,'whatsappId':_0x3ff6b8},'order':[['id',_0x32db57(0x71)]]});if(_0x2e9e8f){await _0x2e9e8f[_0x32db57(0x81)]({'unreadMessages':_0xd70b2e}),_0x2e9e8f=await(0x0,ShowTicketService_1[_0x32db57(0x7c)])(_0x2e9e8f['id'],_0x1a3431),_0x4bc30b=!![];return{'ticket':_0x2e9e8f,'isCreated':_0x4bc30b};;}const _0x384521=await(0x0,ListSettingsServiceOne_1[_0x32db57(0x7c)])({'companyId':_0x1a3431,'key':_0x32db57(0x94)});let _0x1eaf69=Number(_0x384521?.['value']);if(_0x1eaf69)_0x1eaf69=_0x1eaf69;return!_0x2e9e8f&&!_0x1bc4c1&&(_0x1eaf69!==0x0&&(_0x2e9e8f=await Ticket_1[_0x32db57(0x7c)][_0x32db57(0x99)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x32db57(0x72)]]:[+(0x0,date_fns_1[_0x32db57(0x98)])(new Date(),{'seconds':_0x1eaf69}),+new Date()]},'contactId':_0x1051d6['id'],'companyId':_0x1a3431,'whatsappId':_0x3ff6b8},'order':[[_0x32db57(0x95),_0x32db57(0x71)]]})),_0x2e9e8f&&_0x2e9e8f[_0x32db57(0x7e)]!==_0x32db57(0x97)&&(await _0x2e9e8f['update']({'status':'closed','userId':null,'unreadMessages':_0xd70b2e,'companyId':_0x1a3431}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x2e9e8f['id'],'companyId':_0x1a3431,'whatsappId':_0x2e9e8f[_0x32db57(0x74)],'userId':_0x2e9e8f[_0x32db57(0x77)]}))),!_0x2e9e8f&&(_0x2e9e8f=await Ticket_1[_0x32db57(0x7c)]['create']({'contactId':_0x1bc4c1?_0x1bc4c1['id']:_0x1051d6['id'],'status':!(0x0,lodash_1[_0x32db57(0x8b)])(_0x2703bb['value'])&&_0x2703bb[_0x32db57(0x70)]==='enabled'&&!_0x1bc4c1?_0x32db57(0x73):_0x574026[_0x32db57(0x6e)]===_0x32db57(0xa0)||!_0x1bc4c1?'pending':'group','isGroup':!!_0x1bc4c1,'unreadMessages':_0xd70b2e,'whatsappId':_0x3ff6b8,'companyId':_0x1a3431,'isBot':!![],'channel':_0xa5fd38}),await(0x0,FindOrCreateATicketTrakingService_1[_0x32db57(0x7c)])({'ticketId':_0x2e9e8f['id'],'companyId':_0x1a3431,'whatsappId':_0x3ff6b8,'userId':_0x2e9e8f[_0x32db57(0x77)]}),_0x4bc30b=!![]),_0x19ce3d!=0x0&&_0x19ce3d!=undefined&&await _0x2e9e8f[_0x32db57(0x81)]({'queueId':_0x19ce3d}),_0x3043af!=0x0&&_0x3043af!=undefined&&await _0x2e9e8f[_0x32db57(0x81)]({'userId':_0x3043af}),_0x2e9e8f=await(0x0,ShowTicketService_1[_0x32db57(0x7c)])(_0x2e9e8f['id'],_0x1a3431),_0x439cab['to'](_0x2e9e8f[_0x32db57(0x7e)])['to'](_0x32db57(0x7b))['to'](_0x2e9e8f['id'][_0x32db57(0x96)]())[_0x32db57(0x9b)](_0x32db57(0x82)+_0x1a3431+_0x32db57(0x89),{'action':_0x32db57(0x81),'ticket':_0x2e9e8f}),{'ticket':_0x2e9e8f,'isCreated':_0x4bc30b};};exports[a484_0x5bd444(0x7c)]=FindOrCreateTicketService;