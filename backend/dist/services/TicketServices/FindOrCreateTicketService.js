'use strict';const a535_0x4bb877=a535_0x3ea6;(function(_0x93f910,_0x15cfdb){const _0x213e71=a535_0x3ea6,_0x2a53ab=_0x93f910();while(!![]){try{const _0x50ae67=parseInt(_0x213e71(0x18d))/0x1*(parseInt(_0x213e71(0x17b))/0x2)+-parseInt(_0x213e71(0x163))/0x3+parseInt(_0x213e71(0x182))/0x4+parseInt(_0x213e71(0x18b))/0x5+-parseInt(_0x213e71(0x15f))/0x6*(-parseInt(_0x213e71(0x165))/0x7)+parseInt(_0x213e71(0x17d))/0x8+-parseInt(_0x213e71(0x180))/0x9;if(_0x50ae67===_0x15cfdb)break;else _0x2a53ab['push'](_0x2a53ab['shift']());}catch(_0x5bf24c){_0x2a53ab['push'](_0x2a53ab['shift']());}}}(a535_0x5336,0x82066));function a535_0x5336(){const _0x231bae=['sequelize','../../utils/logger','create','__importDefault','DESC','../../libs/socket','updatedAt','pending','2SXGRJp','notification','3654056xEVIde','status','getIO','3276432pakaSs','logger','703248CJDMng','lgpdConsent','closed','lgpd','disabled','isNil','timeCreateNewTicket','error','sub','812665iGSKSM','default','833639hRdHIC','groupAsTicket','company-','./ShowTicketService','222tEmetL','enabled','lgpdAcceptedAt','emit','2795622xwLdIx','date-fns','37793VDOajw','findOne','./CreateLogTicketService','Error\x20to\x20find\x20or\x20create\x20a\x20ticket:','__esModule','toString','lodash','nps','./FindOrCreateATicketTrakingService','update','open','group','delete','lgpdMessage'];a535_0x5336=function(){return _0x231bae;};return a535_0x5336();}var __importDefault=this&&this[a535_0x4bb877(0x176)]||function(_0x5a44a3){const _0x469afa=a535_0x4bb877;return _0x5a44a3&&_0x5a44a3[_0x469afa(0x169)]?_0x5a44a3:{'default':_0x5a44a3};};function a535_0x3ea6(_0x4a288a,_0xea441){const _0x533670=a535_0x5336();return a535_0x3ea6=function(_0x3ea633,_0x5be378){_0x3ea633=_0x3ea633-0x15e;let _0x2a96f0=_0x533670[_0x3ea633];return _0x2a96f0;},a535_0x3ea6(_0x4a288a,_0xea441);}Object['defineProperty'](exports,a535_0x4bb877(0x169),{'value':!![]});const sequelize_1=require(a535_0x4bb877(0x173)),date_fns_1=require(a535_0x4bb877(0x164)),Ticket_1=__importDefault(require('../../models/Ticket')),ShowTicketService_1=__importDefault(require(a535_0x4bb877(0x15e))),FindOrCreateATicketTrakingService_1=__importDefault(require(a535_0x4bb877(0x16d))),lodash_1=require(a535_0x4bb877(0x16b)),socket_1=require(a535_0x4bb877(0x178)),logger_1=require(a535_0x4bb877(0x174)),CreateLogTicketService_1=__importDefault(require(a535_0x4bb877(0x167))),FindOrCreateTicketService=async(_0x406e0d,_0x50baad,_0x1a1a56,_0xd9358a,_0x11397c,_0x156c49,_0x30ed77,_0x2941b7,_0x5f5a95,_0x47b59e,_0x42b14f)=>{const _0x21375=a535_0x4bb877;try{let _0x540578=![],_0x5cd31f=![];_0x42b14f['enableLGPD']&&(_0x5cd31f=_0x42b14f['enableLGPD']===_0x21375(0x160)&&_0x42b14f[_0x21375(0x172)]!==''&&(_0x42b14f['lgpdConsent']===_0x21375(0x160)||_0x42b14f[_0x21375(0x183)]===_0x21375(0x186)&&(0x0,lodash_1[_0x21375(0x187)])(_0x406e0d[_0x21375(0x161)])));const _0x380d09=(0x0,socket_1[_0x21375(0x17f)])();let _0x135c64=await Ticket_1[_0x21375(0x18c)][_0x21375(0x166)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x21375(0x16f),_0x21375(0x17a),_0x21375(0x170),_0x21375(0x16c),_0x21375(0x185)]},'contactId':_0x30ed77?_0x30ed77['id']:_0x406e0d['id'],'companyId':_0xd9358a,'whatsappId':_0x50baad['id']},'order':[['id',_0x21375(0x177)]]});if(_0x135c64){await _0x135c64['update']({'unreadMessages':_0x1a1a56}),_0x135c64=await(0x0,ShowTicketService_1[_0x21375(0x18c)])(_0x135c64['id'],_0xd9358a),_0x540578=!![];return{'ticket':_0x135c64,'isCreated':_0x540578};;}const _0x53c8c7=_0x50baad[_0x21375(0x188)];if(!_0x135c64){_0x53c8c7!==0x0&&(_0x135c64=await Ticket_1['default'][_0x21375(0x166)]({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x21375(0x18a)])(new Date(),{'minutes':Number(_0x53c8c7)}),+new Date()]},'contactId':_0x406e0d['id'],'companyId':_0xd9358a,'whatsappId':_0x50baad['id']},'order':[[_0x21375(0x179),_0x21375(0x177)]]}));if(_0x135c64&&_0x135c64[_0x21375(0x17e)]!==_0x21375(0x16c))return await _0x135c64[_0x21375(0x16e)]({'status':'closed','unreadMessages':_0x1a1a56,'companyId':_0xd9358a}),_0x135c64=await(0x0,ShowTicketService_1[_0x21375(0x18c)])(_0x135c64['id'],_0xd9358a),_0x380d09['to'](_0x21375(0x184))[_0x21375(0x162)](_0x21375(0x18f)+_0xd9358a+'-ticket',{'action':_0x21375(0x171),'ticketId':_0x135c64['id']}),{'ticket':_0x135c64,'isCreated':_0x540578};}!_0x135c64&&(_0x135c64=await Ticket_1['default'][_0x21375(0x175)]({'contactId':_0x30ed77?_0x30ed77['id']:_0x406e0d['id'],'status':!_0x5f5a95&&!(0x0,lodash_1[_0x21375(0x187)])(_0x42b14f['enableLGPD'])&&_0x5cd31f&&!_0x30ed77?_0x21375(0x185):_0x50baad[_0x21375(0x18e)]===_0x21375(0x160)||!_0x30ed77?_0x21375(0x17a):_0x21375(0x170),'isGroup':!!_0x30ed77,'unreadMessages':_0x1a1a56,'whatsappId':_0x50baad['id'],'companyId':_0xd9358a,'isBot':!![],'channel':_0x2941b7,'imported':_0x5f5a95?new Date():null}),await(0x0,FindOrCreateATicketTrakingService_1[_0x21375(0x18c)])({'ticketId':_0x135c64['id'],'companyId':_0xd9358a,'whatsappId':_0x50baad['id'],'userId':_0x135c64['userId']}),_0x540578=!![]);_0x11397c!=0x0&&_0x11397c!=undefined&&await _0x135c64[_0x21375(0x16e)]({'queueId':_0x11397c});_0x156c49!=0x0&&_0x156c49!=undefined&&await _0x135c64[_0x21375(0x16e)]({'userId':_0x156c49});_0x135c64=await(0x0,ShowTicketService_1[_0x21375(0x18c)])(_0x135c64['id'],_0xd9358a),await(0x0,CreateLogTicketService_1['default'])({'ticketId':_0x135c64['id'],'type':_0x5cd31f?_0x21375(0x185):_0x21375(0x175)});!_0x47b59e&&_0x380d09['to'](_0x135c64['status'])['to'](_0x21375(0x17c))['to'](_0x135c64['id'][_0x21375(0x16a)]())[_0x21375(0x162)](_0x21375(0x18f)+_0xd9358a+'-ticket',{'action':_0x21375(0x16e),'ticket':_0x135c64});;return{'ticket':_0x135c64,'isCreated':_0x540578};}catch(_0x2b969b){logger_1[_0x21375(0x181)][_0x21375(0x189)](_0x21375(0x168),_0x2b969b);}};exports[a535_0x4bb877(0x18c)]=FindOrCreateTicketService;