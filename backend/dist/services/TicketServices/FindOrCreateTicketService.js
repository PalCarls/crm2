'use strict';const a501_0x13de48=a501_0x1382;function a501_0x1382(_0x371e88,_0x58910f){const _0xae2aa9=a501_0xae2a();return a501_0x1382=function(_0x13824f,_0x3d12fe){_0x13824f=_0x13824f-0x10d;let _0x188b5b=_0xae2aa9[_0x13824f];return _0x188b5b;},a501_0x1382(_0x371e88,_0x58910f);}function a501_0xae2a(){const _0x11d32f=['3Jgnmyr','683496LZwVsH','add','lgpdMessage','426CFPPAO','key','logger','DESC','default','between','sequelize','groupAsTicket','update','197771CDHarB','closed','findOne','Error\x20to\x20find\x20or\x20create\x20a\x20ticket:','date-fns','defineProperty','getIO','./ShowTicketService','1146336nkvZyO','../../utils/logger','2799189rKxuYZ','lgpd','24QXKhkA','log','notification','emit','../../libs/socket','find','isNil','open','timeCreateNewTicket','error','../../models/Ticket','12516nhDwWG','group','lodash','status','pending','__esModule','userId','-ticket','./FindOrCreateATicketTrakingService','9830nUkuji','562737bZYccD','nps','__importDefault','12903FJjvXJ','enableLGPD','create','10NhBUyl','value'];a501_0xae2a=function(){return _0x11d32f;};return a501_0xae2a();}(function(_0x474e0e,_0x5f54f6){const _0x41fbc2=a501_0x1382,_0x3d3651=_0x474e0e();while(!![]){try{const _0x53dcef=-parseInt(_0x41fbc2(0x118))/0x1+-parseInt(_0x41fbc2(0x142))/0x2*(parseInt(_0x41fbc2(0x141))/0x3)+-parseInt(_0x41fbc2(0x120))/0x4+-parseInt(_0x41fbc2(0x138))/0x5*(parseInt(_0x41fbc2(0x10f))/0x6)+parseInt(_0x41fbc2(0x139))/0x7*(parseInt(_0x41fbc2(0x124))/0x8)+-parseInt(_0x41fbc2(0x122))/0x9*(parseInt(_0x41fbc2(0x13f))/0xa)+parseInt(_0x41fbc2(0x13c))/0xb*(parseInt(_0x41fbc2(0x12f))/0xc);if(_0x53dcef===_0x5f54f6)break;else _0x3d3651['push'](_0x3d3651['shift']());}catch(_0x3a531a){_0x3d3651['push'](_0x3d3651['shift']());}}}(a501_0xae2a,0x2ddfe));var __importDefault=this&&this[a501_0x13de48(0x13b)]||function(_0xc57c95){const _0x8979e2=a501_0x13de48;return _0xc57c95&&_0xc57c95[_0x8979e2(0x134)]?_0xc57c95:{'default':_0xc57c95};};Object[a501_0x13de48(0x11d)](exports,a501_0x13de48(0x134),{'value':!![]});const sequelize_1=require(a501_0x13de48(0x115)),date_fns_1=require(a501_0x13de48(0x11c)),Ticket_1=__importDefault(require(a501_0x13de48(0x12e))),ShowTicketService_1=__importDefault(require(a501_0x13de48(0x11f))),FindOrCreateATicketTrakingService_1=__importDefault(require(a501_0x13de48(0x137))),lodash_1=require(a501_0x13de48(0x131)),socket_1=require(a501_0x13de48(0x128)),logger_1=require(a501_0x13de48(0x121)),FindOrCreateTicketService=async(_0x280885,_0x457c43,_0x5bfac9,_0x44c869,_0x5f17c9,_0x3faac2,_0x1fa1f6,_0x38828d,_0xce0f68,_0x20b569,_0x5c4d97)=>{const _0x55d08b=a501_0x13de48;try{let _0x37a8dd=![];const _0x4db409=_0x5c4d97[_0x55d08b(0x129)](_0x262c10=>_0x262c10[_0x55d08b(0x110)]===_0x55d08b(0x13d)),_0x20f4a5=_0x5c4d97[_0x55d08b(0x129)](_0xbc9bc7=>_0xbc9bc7['key']===_0x55d08b(0x10e)),_0x46eeaf=_0x5c4d97[_0x55d08b(0x129)](_0x515489=>_0x515489[_0x55d08b(0x110)]==='lgpdLink'),_0x5544c8=_0x4db409[_0x55d08b(0x140)]==='enabled'&&_0x20f4a5['value']!=='';console[_0x55d08b(0x125)](_0x5544c8);const _0x5adce9=(0x0,socket_1[_0x55d08b(0x11e)])();let _0x1a0b57=await Ticket_1[_0x55d08b(0x113)][_0x55d08b(0x11a)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x55d08b(0x12b),_0x55d08b(0x133),_0x55d08b(0x130),'nps','lgpd']},'contactId':_0x1fa1f6?_0x1fa1f6['id']:_0x280885['id'],'companyId':_0x44c869,'whatsappId':_0x457c43['id']},'order':[['id',_0x55d08b(0x112)]]});if(_0x1a0b57){await _0x1a0b57['update']({'unreadMessages':_0x5bfac9}),_0x1a0b57=await(0x0,ShowTicketService_1['default'])(_0x1a0b57['id'],_0x44c869),_0x37a8dd=!![];return{'ticket':_0x1a0b57,'isCreated':_0x37a8dd};;}const _0x352673=_0x457c43[_0x55d08b(0x12c)];!_0x1a0b57&&(_0x352673!==0x0&&(_0x1a0b57=await Ticket_1['default'][_0x55d08b(0x11a)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x55d08b(0x114)]]:[+(0x0,date_fns_1[_0x55d08b(0x10d)])(new Date(),{'minutes':_0x352673}),+new Date()]},'contactId':_0x280885['id'],'companyId':_0x44c869,'whatsappId':_0x457c43['id']},'order':[['updatedAt',_0x55d08b(0x112)]]})),_0x1a0b57&&_0x1a0b57['status']!==_0x55d08b(0x13a)&&await _0x1a0b57[_0x55d08b(0x117)]({'status':_0x55d08b(0x119),'userId':null,'unreadMessages':_0x5bfac9,'companyId':_0x44c869}));!_0x1a0b57&&(_0x1a0b57=await Ticket_1['default'][_0x55d08b(0x13e)]({'contactId':_0x1fa1f6?_0x1fa1f6['id']:_0x280885['id'],'status':!_0xce0f68&&!(0x0,lodash_1[_0x55d08b(0x12a)])(_0x4db409[_0x55d08b(0x140)])&&_0x5544c8&&!_0x1fa1f6?_0x55d08b(0x123):_0x457c43[_0x55d08b(0x116)]==='enabled'||!_0x1fa1f6?_0x55d08b(0x133):_0x55d08b(0x130),'isGroup':!!_0x1fa1f6,'unreadMessages':_0x5bfac9,'whatsappId':_0x457c43['id'],'companyId':_0x44c869,'isBot':!![],'channel':_0x38828d,'imported':_0xce0f68?new Date():null}),await(0x0,FindOrCreateATicketTrakingService_1[_0x55d08b(0x113)])({'ticketId':_0x1a0b57['id'],'companyId':_0x44c869,'whatsappId':_0x457c43['id'],'userId':_0x1a0b57[_0x55d08b(0x135)]}),_0x37a8dd=!![]);_0x5f17c9!=0x0&&_0x5f17c9!=undefined&&await _0x1a0b57[_0x55d08b(0x117)]({'queueId':_0x5f17c9});_0x3faac2!=0x0&&_0x3faac2!=undefined&&await _0x1a0b57[_0x55d08b(0x117)]({'userId':_0x3faac2});_0x1a0b57=await(0x0,ShowTicketService_1['default'])(_0x1a0b57['id'],_0x44c869);!_0x20b569&&_0x5adce9['to'](_0x1a0b57[_0x55d08b(0x132)])['to'](_0x55d08b(0x126))['to'](_0x1a0b57['id']['toString']())[_0x55d08b(0x127)]('company-'+_0x44c869+_0x55d08b(0x136),{'action':_0x55d08b(0x117),'ticket':_0x1a0b57});;return{'ticket':_0x1a0b57,'isCreated':_0x37a8dd};}catch(_0x455783){logger_1[_0x55d08b(0x111)][_0x55d08b(0x12d)](_0x55d08b(0x11b),_0x455783);}};exports[a501_0x13de48(0x113)]=FindOrCreateTicketService;