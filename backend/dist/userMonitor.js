'use strict';const a640_0x514638=a640_0x2639;(function(_0x2e429d,_0x39aa96){const _0x19fc1a=a640_0x2639,_0x3e1ca5=_0x2e429d();while(!![]){try{const _0x23c7b7=parseInt(_0x19fc1a(0x13e))/0x1+-parseInt(_0x19fc1a(0x129))/0x2+parseInt(_0x19fc1a(0x13a))/0x3+-parseInt(_0x19fc1a(0x12b))/0x4+-parseInt(_0x19fc1a(0x128))/0x5*(parseInt(_0x19fc1a(0x135))/0x6)+parseInt(_0x19fc1a(0x11c))/0x7+-parseInt(_0x19fc1a(0x123))/0x8*(parseInt(_0x19fc1a(0x137))/0x9);if(_0x23c7b7===_0x39aa96)break;else _0x3e1ca5['push'](_0x3e1ca5['shift']());}catch(_0x5029ee){_0x3e1ca5['push'](_0x3e1ca5['shift']());}}}(a640_0x42c0,0x7ddc2));var __createBinding=this&&this[a640_0x514638(0x12c)]||(Object[a640_0x514638(0x141)]?function(_0x23114a,_0x298fac,_0x4f4a6e,_0x1c1606){const _0x539628=a640_0x514638;if(_0x1c1606===undefined)_0x1c1606=_0x4f4a6e;var _0x2bb7ab=Object[_0x539628(0x13f)](_0x298fac,_0x4f4a6e);(!_0x2bb7ab||('get'in _0x2bb7ab?!_0x298fac[_0x539628(0x12f)]:_0x2bb7ab['writable']||_0x2bb7ab[_0x539628(0x140)]))&&(_0x2bb7ab={'enumerable':!![],'get':function(){return _0x298fac[_0x4f4a6e];}}),Object['defineProperty'](_0x23114a,_0x1c1606,_0x2bb7ab);}:function(_0x5e1149,_0x4a40f8,_0xae70a,_0x477dcd){if(_0x477dcd===undefined)_0x477dcd=_0xae70a;_0x5e1149[_0x477dcd]=_0x4a40f8[_0xae70a];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x4d41f9,_0x525c24){const _0x31aa3b=a640_0x514638;Object[_0x31aa3b(0x11a)](_0x4d41f9,_0x31aa3b(0x143),{'enumerable':!![],'value':_0x525c24});}:function(_0x1756da,_0x534c3f){const _0x19c5e0=a640_0x514638;_0x1756da[_0x19c5e0(0x143)]=_0x534c3f;}),__importStar=this&&this[a640_0x514638(0x11b)]||function(_0x14d207){const _0x3178a0=a640_0x514638;if(_0x14d207&&_0x14d207[_0x3178a0(0x12f)])return _0x14d207;var _0x539747={};if(_0x14d207!=null){for(var _0x1a0fee in _0x14d207)if(_0x1a0fee!=='default'&&Object['prototype']['hasOwnProperty'][_0x3178a0(0x136)](_0x14d207,_0x1a0fee))__createBinding(_0x539747,_0x14d207,_0x1a0fee);}return __setModuleDefault(_0x539747,_0x14d207),_0x539747;},__importDefault=this&&this[a640_0x514638(0x122)]||function(_0x294b41){return _0x294b41&&_0x294b41['__esModule']?_0x294b41:{'default':_0x294b41};};Object[a640_0x514638(0x11a)](exports,a640_0x514638(0x12f),{'value':!![]}),exports['initUserMonitorQueues']=exports[a640_0x514638(0x12e)]=void 0x0;function a640_0x2639(_0x153ac3,_0x30f773){const _0x42c088=a640_0x42c0();return a640_0x2639=function(_0x2639e1,_0xb27ec3){_0x2639e1=_0x2639e1-0x118;let _0x412642=_0x42c088[_0x2639e1];return _0x412642;},a640_0x2639(_0x153ac3,_0x30f773);}const bull_1=__importDefault(require('bull')),Sentry=__importStar(require(a640_0x514638(0x13b))),sequelize_1=require(a640_0x514638(0x120)),lodash_1=require(a640_0x514638(0x121)),logger_1=require('./utils/logger'),database_1=__importDefault(require(a640_0x514638(0x144))),User_1=__importDefault(require('./models/User')),connection=process['env'][a640_0x514638(0x127)]||'';exports[a640_0x514638(0x12e)]=new bull_1['default']('UserMonitor',connection);async function handleLoginStatus(_0x4b8905){const _0x17f9f2=a640_0x514638,_0x3c4a10=await database_1['default'][_0x17f9f2(0x124)](_0x17f9f2(0x133),{'type':sequelize_1[_0x17f9f2(0x11d)][_0x17f9f2(0x139)]});for(let _0x3bec98 of _0x3c4a10){try{const _0x5edaf1=await User_1['default'][_0x17f9f2(0x119)](_0x3bec98['id']);await _0x5edaf1['update']({'online':![]}),logger_1['logger']['info'](_0x17f9f2(0x118)+_0x3bec98['id']);}catch(_0x1d8afa){Sentry[_0x17f9f2(0x126)](_0x1d8afa);}}}async function handleUserConnection(_0x1019ed){const _0x451c9=a640_0x514638;try{const {id:_0x37500f}=_0x1019ed[_0x451c9(0x11f)];if(!(0x0,lodash_1['isNil'])(_0x37500f)&&_0x37500f!==_0x451c9(0x12d)){const _0x52421c=await User_1[_0x451c9(0x143)]['findByPk'](_0x37500f);_0x52421c&&(_0x52421c[_0x451c9(0x138)]=!![],await _0x52421c[_0x451c9(0x13c)]());}}catch(_0x1e20f2){Sentry[_0x451c9(0x126)](_0x1e20f2);}}exports[a640_0x514638(0x12e)][a640_0x514638(0x125)](a640_0x514638(0x132),handleUserConnection),exports[a640_0x514638(0x12e)][a640_0x514638(0x125)]('VerifyLoginStatus',handleLoginStatus);async function initUserMonitorQueues(){const _0x36b62b=a640_0x514638,_0x420d81=await exports['userMonitor']['getRepeatableJobs']();for(let _0x1cefac of _0x420d81){await exports['userMonitor'][_0x36b62b(0x130)](_0x1cefac['key']);}exports[_0x36b62b(0x12e)]['add'](_0x36b62b(0x134),{},{'repeat':{'cron':_0x36b62b(0x13d),'key':_0x36b62b(0x11e)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1['logger'][_0x36b62b(0x131)](_0x36b62b(0x12a));}function a640_0x42c0(){const _0x2bdc73=['1764944netorP','__createBinding','null','userMonitor','__esModule','removeRepeatableByKey','info','UserConnection','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','VerifyLoginStatus','438lWiGfv','call','180kxSmfi','online','SELECT','1593336ndKyqX','@sentry/node','save','*\x20*\x20*\x20*\x20*','483296bNbchw','getOwnPropertyDescriptor','configurable','create','initUserMonitorQueues','default','./database','Usuário\x20passado\x20para\x20offline:\x20','findByPk','defineProperty','__importStar','5778276iTFsuF','QueryTypes','verify-login-status','data','sequelize','lodash','__importDefault','54616NoiOLm','query','process','captureException','REDIS_URI','45495QivbUB','164702vkgKBm','Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado'];a640_0x42c0=function(){return _0x2bdc73;};return a640_0x42c0();}exports[a640_0x514638(0x142)]=initUserMonitorQueues;