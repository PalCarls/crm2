'use strict';function a562_0x2853(){const _0x437917=['sequelize','hasOwnProperty','info','query','1481264Sasrgk','__importDefault','403284OHJYRz','removeRepeatableByKey','__esModule','default','VerifyLoginStatus','configurable','bull','getOwnPropertyDescriptor','./models/User','14846UkPeIb','key','UserConnection','90nixMdg','218349zpxFpp','prototype','20ueEpKq','process','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','57QZFgDf','__setModuleDefault','save','./database','30fIeUBE','update','4594272pKJfJt','UserMonitor','captureException','data','./utils/logger','env','verify-login-status','2008xLcfPy','get','online','add','Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado','lodash','null','__importStar','create','findByPk','getRepeatableJobs','11hmWtMN','*\x20*\x20*\x20*\x20*','__createBinding','call','userMonitor','logger','@sentry/node','299173FketOv','initUserMonitorQueues','QueryTypes'];a562_0x2853=function(){return _0x437917;};return a562_0x2853();}const a562_0x4a36bd=a562_0xac7c;(function(_0x18cd49,_0x37cb6b){const _0x27f610=a562_0xac7c,_0x2ec0de=_0x18cd49();while(!![]){try{const _0x10fb53=parseInt(_0x27f610(0x1f6))/0x1+parseInt(_0x27f610(0x1d2))/0x2*(parseInt(_0x27f610(0x1ff))/0x3)+-parseInt(_0x27f610(0x1ed))/0x4*(-parseInt(_0x27f610(0x1fc))/0x5)+parseInt(_0x27f610(0x1c9))/0x6*(parseInt(_0x27f610(0x1e4))/0x7)+parseInt(_0x27f610(0x1eb))/0x8+-parseInt(_0x27f610(0x1fa))/0x9*(parseInt(_0x27f610(0x1f9))/0xa)+parseInt(_0x27f610(0x1dd))/0xb*(-parseInt(_0x27f610(0x1cb))/0xc);if(_0x10fb53===_0x37cb6b)break;else _0x2ec0de['push'](_0x2ec0de['shift']());}catch(_0x10c6de){_0x2ec0de['push'](_0x2ec0de['shift']());}}}(a562_0x2853,0x39566));var __createBinding=this&&this[a562_0x4a36bd(0x1df)]||(Object['create']?function(_0x241fc5,_0x3ee295,_0x2df5d6,_0x4bc52d){const _0x4ec5ee=a562_0x4a36bd;if(_0x4bc52d===undefined)_0x4bc52d=_0x2df5d6;var _0x54e6ba=Object[_0x4ec5ee(0x1f4)](_0x3ee295,_0x2df5d6);(!_0x54e6ba||(_0x4ec5ee(0x1d3)in _0x54e6ba?!_0x3ee295[_0x4ec5ee(0x1ef)]:_0x54e6ba['writable']||_0x54e6ba[_0x4ec5ee(0x1f2)]))&&(_0x54e6ba={'enumerable':!![],'get':function(){return _0x3ee295[_0x2df5d6];}}),Object['defineProperty'](_0x241fc5,_0x4bc52d,_0x54e6ba);}:function(_0x3b90c1,_0xa1a34c,_0x716bf9,_0x13b217){if(_0x13b217===undefined)_0x13b217=_0x716bf9;_0x3b90c1[_0x13b217]=_0xa1a34c[_0x716bf9];}),__setModuleDefault=this&&this[a562_0x4a36bd(0x1c6)]||(Object[a562_0x4a36bd(0x1da)]?function(_0x401516,_0x40ebc0){const _0x2b79fb=a562_0x4a36bd;Object['defineProperty'](_0x401516,_0x2b79fb(0x1f0),{'enumerable':!![],'value':_0x40ebc0});}:function(_0x281209,_0x3b635c){const _0x3c417b=a562_0x4a36bd;_0x281209[_0x3c417b(0x1f0)]=_0x3b635c;}),__importStar=this&&this[a562_0x4a36bd(0x1d9)]||function(_0x15d754){const _0x2f7597=a562_0x4a36bd;if(_0x15d754&&_0x15d754[_0x2f7597(0x1ef)])return _0x15d754;var _0x4d5a65={};if(_0x15d754!=null){for(var _0x43d7a5 in _0x15d754)if(_0x43d7a5!==_0x2f7597(0x1f0)&&Object[_0x2f7597(0x1fb)][_0x2f7597(0x1e8)][_0x2f7597(0x1e0)](_0x15d754,_0x43d7a5))__createBinding(_0x4d5a65,_0x15d754,_0x43d7a5);}return __setModuleDefault(_0x4d5a65,_0x15d754),_0x4d5a65;},__importDefault=this&&this[a562_0x4a36bd(0x1ec)]||function(_0x4e0743){const _0x2ea792=a562_0x4a36bd;return _0x4e0743&&_0x4e0743[_0x2ea792(0x1ef)]?_0x4e0743:{'default':_0x4e0743};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a562_0x4a36bd(0x1e5)]=exports[a562_0x4a36bd(0x1e1)]=void 0x0;const bull_1=__importDefault(require(a562_0x4a36bd(0x1f3))),Sentry=__importStar(require(a562_0x4a36bd(0x1e3))),sequelize_1=require(a562_0x4a36bd(0x1e7)),lodash_1=require(a562_0x4a36bd(0x1d7)),logger_1=require(a562_0x4a36bd(0x1cf)),database_1=__importDefault(require(a562_0x4a36bd(0x1c8))),User_1=__importDefault(require(a562_0x4a36bd(0x1f5))),connection=process[a562_0x4a36bd(0x1d0)]['REDIS_URI']||'';exports[a562_0x4a36bd(0x1e1)]=new bull_1[(a562_0x4a36bd(0x1f0))](a562_0x4a36bd(0x1cc),connection);async function handleLoginStatus(_0x538b17){const _0x1e54c8=a562_0x4a36bd,_0x1eca01=await database_1[_0x1e54c8(0x1f0)][_0x1e54c8(0x1ea)](_0x1e54c8(0x1fe),{'type':sequelize_1[_0x1e54c8(0x1e6)]['SELECT']});for(let _0x4de953 of _0x1eca01){try{const _0x5c6e69=await User_1[_0x1e54c8(0x1f0)][_0x1e54c8(0x1db)](_0x4de953['id']);await _0x5c6e69[_0x1e54c8(0x1ca)]({'online':![]}),logger_1[_0x1e54c8(0x1e2)][_0x1e54c8(0x1e9)]('Usuário\x20passado\x20para\x20offline:\x20'+_0x4de953['id']);}catch(_0x247db5){Sentry['captureException'](_0x247db5);}}}function a562_0xac7c(_0x13bf3a,_0x30efcd){const _0x2853ce=a562_0x2853();return a562_0xac7c=function(_0xac7cec,_0x18d7a1){_0xac7cec=_0xac7cec-0x1c6;let _0x3785af=_0x2853ce[_0xac7cec];return _0x3785af;},a562_0xac7c(_0x13bf3a,_0x30efcd);}async function handleUserConnection(_0x29475d){const _0x17b233=a562_0x4a36bd;try{const {id:_0x227944}=_0x29475d[_0x17b233(0x1ce)];if(!(0x0,lodash_1['isNil'])(_0x227944)&&_0x227944!==_0x17b233(0x1d8)){const _0x4758d1=await User_1[_0x17b233(0x1f0)][_0x17b233(0x1db)](_0x227944);_0x4758d1&&(_0x4758d1[_0x17b233(0x1d4)]=!![],await _0x4758d1[_0x17b233(0x1c7)]());}}catch(_0x5a85b8){Sentry[_0x17b233(0x1cd)](_0x5a85b8);}}exports['userMonitor'][a562_0x4a36bd(0x1fd)](a562_0x4a36bd(0x1f8),handleUserConnection),exports[a562_0x4a36bd(0x1e1)][a562_0x4a36bd(0x1fd)](a562_0x4a36bd(0x1f1),handleLoginStatus);async function initUserMonitorQueues(){const _0x438f89=a562_0x4a36bd,_0x7ff11c=await exports['userMonitor'][_0x438f89(0x1dc)]();for(let _0x31fff3 of _0x7ff11c){await exports[_0x438f89(0x1e1)][_0x438f89(0x1ee)](_0x31fff3[_0x438f89(0x1f7)]);}exports[_0x438f89(0x1e1)][_0x438f89(0x1d5)](_0x438f89(0x1f1),{},{'repeat':{'cron':_0x438f89(0x1de),'key':_0x438f89(0x1d1)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x438f89(0x1e2)]['info'](_0x438f89(0x1d6));}exports[a562_0x4a36bd(0x1e5)]=initUserMonitorQueues;