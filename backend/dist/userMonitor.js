'use strict';const a579_0x19e54a=a579_0x36f5;(function(_0x19243a,_0x1c2cc8){const _0x5be13f=a579_0x36f5,_0x27b363=_0x19243a();while(!![]){try{const _0x3a73f7=-parseInt(_0x5be13f(0x109))/0x1*(-parseInt(_0x5be13f(0xf2))/0x2)+parseInt(_0x5be13f(0xfe))/0x3*(-parseInt(_0x5be13f(0x114))/0x4)+parseInt(_0x5be13f(0x115))/0x5*(parseInt(_0x5be13f(0xed))/0x6)+-parseInt(_0x5be13f(0xf0))/0x7*(-parseInt(_0x5be13f(0x101))/0x8)+-parseInt(_0x5be13f(0xea))/0x9+parseInt(_0x5be13f(0xf8))/0xa*(-parseInt(_0x5be13f(0xf4))/0xb)+-parseInt(_0x5be13f(0xe6))/0xc;if(_0x3a73f7===_0x1c2cc8)break;else _0x27b363['push'](_0x27b363['shift']());}catch(_0x37e805){_0x27b363['push'](_0x27b363['shift']());}}}(a579_0x1e0f,0xa69c7));function a579_0x1e0f(){const _0x32426b=['Usuário\x20passado\x20para\x20offline:\x20','data','__esModule','call','process','get','__createBinding','configurable','187760vlocQd','7910hThRrq','userMonitor','add','./models/User','update','captureException','10791420izFxWm','env','key','QueryTypes','217512xFDVfo','./database','*\x20*\x20*\x20*\x20*','3672kPKcpM','writable','getOwnPropertyDescriptor','2862461dNOyPn','default','1625816giuqdw','findByPk','656557lYGHfL','UserConnection','logger','lodash','90mrBuOu','info','__setModuleDefault','isNil','__importStar','sequelize','3ikAxYz','initUserMonitorQueues','defineProperty','8JXZwms','hasOwnProperty','online','prototype','create','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','REDIS_URI','null','1rGMZVL','VerifyLoginStatus','@sentry/node'];a579_0x1e0f=function(){return _0x32426b;};return a579_0x1e0f();}var __createBinding=this&&this[a579_0x19e54a(0x112)]||(Object[a579_0x19e54a(0x105)]?function(_0xb99642,_0x2f43ea,_0x48498a,_0x1bdd63){const _0x1c3d1f=a579_0x19e54a;if(_0x1bdd63===undefined)_0x1bdd63=_0x48498a;var _0x14d5c7=Object[_0x1c3d1f(0xef)](_0x2f43ea,_0x48498a);(!_0x14d5c7||(_0x1c3d1f(0x111)in _0x14d5c7?!_0x2f43ea[_0x1c3d1f(0x10e)]:_0x14d5c7[_0x1c3d1f(0xee)]||_0x14d5c7[_0x1c3d1f(0x113)]))&&(_0x14d5c7={'enumerable':!![],'get':function(){return _0x2f43ea[_0x48498a];}}),Object[_0x1c3d1f(0x100)](_0xb99642,_0x1bdd63,_0x14d5c7);}:function(_0x560cd9,_0x501298,_0x94931,_0x3a0d9a){if(_0x3a0d9a===undefined)_0x3a0d9a=_0x94931;_0x560cd9[_0x3a0d9a]=_0x501298[_0x94931];}),__setModuleDefault=this&&this[a579_0x19e54a(0xfa)]||(Object['create']?function(_0x39a940,_0xfea9e4){const _0x4ea0a0=a579_0x19e54a;Object[_0x4ea0a0(0x100)](_0x39a940,_0x4ea0a0(0xf1),{'enumerable':!![],'value':_0xfea9e4});}:function(_0x5c1c4a,_0x38312b){_0x5c1c4a['default']=_0x38312b;}),__importStar=this&&this[a579_0x19e54a(0xfc)]||function(_0x44ecc2){const _0x47486a=a579_0x19e54a;if(_0x44ecc2&&_0x44ecc2[_0x47486a(0x10e)])return _0x44ecc2;var _0x4926d2={};if(_0x44ecc2!=null){for(var _0x2d5296 in _0x44ecc2)if(_0x2d5296!==_0x47486a(0xf1)&&Object[_0x47486a(0x104)][_0x47486a(0x102)][_0x47486a(0x10f)](_0x44ecc2,_0x2d5296))__createBinding(_0x4926d2,_0x44ecc2,_0x2d5296);}return __setModuleDefault(_0x4926d2,_0x44ecc2),_0x4926d2;},__importDefault=this&&this['__importDefault']||function(_0x3e10d1){const _0xcca736=a579_0x19e54a;return _0x3e10d1&&_0x3e10d1[_0xcca736(0x10e)]?_0x3e10d1:{'default':_0x3e10d1};};function a579_0x36f5(_0x47aed8,_0x3cfdb9){const _0x1e0ff8=a579_0x1e0f();return a579_0x36f5=function(_0x36f513,_0x15c2fe){_0x36f513=_0x36f513-0xe3;let _0x48d45b=_0x1e0ff8[_0x36f513];return _0x48d45b;},a579_0x36f5(_0x47aed8,_0x3cfdb9);}Object[a579_0x19e54a(0x100)](exports,a579_0x19e54a(0x10e),{'value':!![]}),exports[a579_0x19e54a(0xff)]=exports['userMonitor']=void 0x0;const bull_1=__importDefault(require('bull')),Sentry=__importStar(require(a579_0x19e54a(0x10b))),sequelize_1=require(a579_0x19e54a(0xfd)),lodash_1=require(a579_0x19e54a(0xf7)),logger_1=require('./utils/logger'),database_1=__importDefault(require(a579_0x19e54a(0xeb))),User_1=__importDefault(require(a579_0x19e54a(0xe3))),connection=process[a579_0x19e54a(0xe7)][a579_0x19e54a(0x107)]||'';exports['userMonitor']=new bull_1[(a579_0x19e54a(0xf1))]('UserMonitor',connection);async function handleLoginStatus(_0x4d789a){const _0x49371f=a579_0x19e54a,_0x30a1a1=await database_1[_0x49371f(0xf1)]['query'](_0x49371f(0x106),{'type':sequelize_1[_0x49371f(0xe9)]['SELECT']});for(let _0x31f7b8 of _0x30a1a1){try{const _0x2a8728=await User_1['default'][_0x49371f(0xf3)](_0x31f7b8['id']);await _0x2a8728[_0x49371f(0xe4)]({'online':![]}),logger_1[_0x49371f(0xf6)]['info'](_0x49371f(0x10c)+_0x31f7b8['id']);}catch(_0x259370){Sentry[_0x49371f(0xe5)](_0x259370);}}}async function handleUserConnection(_0x500505){const _0x37e281=a579_0x19e54a;try{const {id:_0x5d8525}=_0x500505[_0x37e281(0x10d)];if(!(0x0,lodash_1[_0x37e281(0xfb)])(_0x5d8525)&&_0x5d8525!==_0x37e281(0x108)){const _0x7286ad=await User_1[_0x37e281(0xf1)][_0x37e281(0xf3)](_0x5d8525);_0x7286ad&&(_0x7286ad[_0x37e281(0x103)]=!![],await _0x7286ad['save']());}}catch(_0x5a878f){Sentry[_0x37e281(0xe5)](_0x5a878f);}}exports[a579_0x19e54a(0x116)][a579_0x19e54a(0x110)](a579_0x19e54a(0xf5),handleUserConnection),exports[a579_0x19e54a(0x116)][a579_0x19e54a(0x110)](a579_0x19e54a(0x10a),handleLoginStatus);async function initUserMonitorQueues(){const _0x4d4720=a579_0x19e54a,_0x297669=await exports['userMonitor']['getRepeatableJobs']();for(let _0x4eba84 of _0x297669){await exports[_0x4d4720(0x116)]['removeRepeatableByKey'](_0x4eba84[_0x4d4720(0xe8)]);}exports[_0x4d4720(0x116)][_0x4d4720(0x117)](_0x4d4720(0x10a),{},{'repeat':{'cron':_0x4d4720(0xec),'key':'verify-login-status'},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x4d4720(0xf6)][_0x4d4720(0xf9)]('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado');}exports[a579_0x19e54a(0xff)]=initUserMonitorQueues;