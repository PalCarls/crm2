'use strict';const a542_0x1572ba=a542_0x10c0;(function(_0x402dcb,_0x4371a7){const _0x2d5a06=a542_0x10c0,_0x12dfb9=_0x402dcb();while(!![]){try{const _0x5c5e2a=parseInt(_0x2d5a06(0x1d0))/0x1+-parseInt(_0x2d5a06(0x1c2))/0x2+parseInt(_0x2d5a06(0x1c8))/0x3+parseInt(_0x2d5a06(0x1c9))/0x4+parseInt(_0x2d5a06(0x1d6))/0x5+-parseInt(_0x2d5a06(0x1c3))/0x6+parseInt(_0x2d5a06(0x1cd))/0x7;if(_0x5c5e2a===_0x4371a7)break;else _0x12dfb9['push'](_0x12dfb9['shift']());}catch(_0x4f2935){_0x12dfb9['push'](_0x12dfb9['shift']());}}}(a542_0x43d0,0xb81b3));function a542_0x10c0(_0x19b193,_0x451984){const _0x43d04c=a542_0x43d0();return a542_0x10c0=function(_0x10c09a,_0x3a1eb0){_0x10c09a=_0x10c09a-0x1b2;let _0x1681f1=_0x43d04c[_0x10c09a];return _0x1681f1;},a542_0x10c0(_0x19b193,_0x451984);}var __createBinding=this&&this[a542_0x1572ba(0x1b5)]||(Object[a542_0x1572ba(0x1da)]?function(_0x2d6956,_0x257d39,_0x5f0fc2,_0x520706){const _0x139f7f=a542_0x1572ba;if(_0x520706===undefined)_0x520706=_0x5f0fc2;var _0x1bea9f=Object['getOwnPropertyDescriptor'](_0x257d39,_0x5f0fc2);(!_0x1bea9f||(_0x139f7f(0x1d8)in _0x1bea9f?!_0x257d39[_0x139f7f(0x1bf)]:_0x1bea9f['writable']||_0x1bea9f[_0x139f7f(0x1b3)]))&&(_0x1bea9f={'enumerable':!![],'get':function(){return _0x257d39[_0x5f0fc2];}}),Object[_0x139f7f(0x1c0)](_0x2d6956,_0x520706,_0x1bea9f);}:function(_0x30a289,_0x56d60f,_0xecd4f2,_0x5db402){if(_0x5db402===undefined)_0x5db402=_0xecd4f2;_0x30a289[_0x5db402]=_0x56d60f[_0xecd4f2];}),__setModuleDefault=this&&this[a542_0x1572ba(0x1b4)]||(Object['create']?function(_0x49f1e3,_0x2f150b){const _0x273b1f=a542_0x1572ba;Object[_0x273b1f(0x1c0)](_0x49f1e3,'default',{'enumerable':!![],'value':_0x2f150b});}:function(_0x257b5e,_0x9c30f9){const _0x1ca669=a542_0x1572ba;_0x257b5e[_0x1ca669(0x1bd)]=_0x9c30f9;}),__importStar=this&&this[a542_0x1572ba(0x1d1)]||function(_0x3d29f2){const _0x19f96f=a542_0x1572ba;if(_0x3d29f2&&_0x3d29f2[_0x19f96f(0x1bf)])return _0x3d29f2;var _0x51d2c6={};if(_0x3d29f2!=null){for(var _0x648c8d in _0x3d29f2)if(_0x648c8d!==_0x19f96f(0x1bd)&&Object[_0x19f96f(0x1ba)][_0x19f96f(0x1d5)][_0x19f96f(0x1b2)](_0x3d29f2,_0x648c8d))__createBinding(_0x51d2c6,_0x3d29f2,_0x648c8d);}return __setModuleDefault(_0x51d2c6,_0x3d29f2),_0x51d2c6;},__importDefault=this&&this[a542_0x1572ba(0x1c1)]||function(_0x594c1e){return _0x594c1e&&_0x594c1e['__esModule']?_0x594c1e:{'default':_0x594c1e};};function a542_0x43d0(){const _0x247482=['prototype','./utils/logger','./database','default','null','__esModule','defineProperty','__importDefault','1798364YzpnJj','8273916yTkpEZ','data','process','QueryTypes','UserConnection','392163nQicLQ','3423524mALaph','userMonitor','VerifyLoginStatus','env','12296326XBpltN','add','bull','100080WoAeVZ','__importStar','removeRepeatableByKey','Usuário\x20passado\x20para\x20offline:\x20','info','hasOwnProperty','944835CaqCBh','save','get','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','create','key','findByPk','initUserMonitorQueues','*\x20*\x20*\x20*\x20*','UserMonitor','captureException','isNil','online','call','configurable','__setModuleDefault','__createBinding','verify-login-status','sequelize','@sentry/node','SELECT'];a542_0x43d0=function(){return _0x247482;};return a542_0x43d0();}Object[a542_0x1572ba(0x1c0)](exports,a542_0x1572ba(0x1bf),{'value':!![]}),exports[a542_0x1572ba(0x1dd)]=exports['userMonitor']=void 0x0;const bull_1=__importDefault(require(a542_0x1572ba(0x1cf))),Sentry=__importStar(require(a542_0x1572ba(0x1b8))),sequelize_1=require(a542_0x1572ba(0x1b7)),lodash_1=require('lodash'),logger_1=require(a542_0x1572ba(0x1bb)),database_1=__importDefault(require(a542_0x1572ba(0x1bc))),User_1=__importDefault(require('./models/User')),connection=process[a542_0x1572ba(0x1cc)]['REDIS_URI']||'';exports[a542_0x1572ba(0x1ca)]=new bull_1[(a542_0x1572ba(0x1bd))](a542_0x1572ba(0x1df),connection);async function handleLoginStatus(_0x325bae){const _0xbd242=a542_0x1572ba,_0x2bad97=await database_1['default']['query'](_0xbd242(0x1d9),{'type':sequelize_1[_0xbd242(0x1c6)][_0xbd242(0x1b9)]});for(let _0x1fdc1f of _0x2bad97){try{const _0x255ef6=await User_1[_0xbd242(0x1bd)][_0xbd242(0x1dc)](_0x1fdc1f['id']);await _0x255ef6['update']({'online':![]}),logger_1['logger'][_0xbd242(0x1d4)](_0xbd242(0x1d3)+_0x1fdc1f['id']);}catch(_0x4af0f0){Sentry[_0xbd242(0x1e0)](_0x4af0f0);}}}async function handleUserConnection(_0x533d54){const _0x558d=a542_0x1572ba;try{const {id:_0x5ac012}=_0x533d54[_0x558d(0x1c4)];if(!(0x0,lodash_1[_0x558d(0x1e1)])(_0x5ac012)&&_0x5ac012!==_0x558d(0x1be)){const _0x209250=await User_1[_0x558d(0x1bd)][_0x558d(0x1dc)](_0x5ac012);_0x209250&&(_0x209250[_0x558d(0x1e2)]=!![],await _0x209250[_0x558d(0x1d7)]());}}catch(_0x3db3f4){Sentry[_0x558d(0x1e0)](_0x3db3f4);}}exports[a542_0x1572ba(0x1ca)][a542_0x1572ba(0x1c5)](a542_0x1572ba(0x1c7),handleUserConnection),exports[a542_0x1572ba(0x1ca)][a542_0x1572ba(0x1c5)](a542_0x1572ba(0x1cb),handleLoginStatus);async function initUserMonitorQueues(){const _0x4024ca=a542_0x1572ba,_0x36dfe2=await exports[_0x4024ca(0x1ca)]['getRepeatableJobs']();for(let _0x484e5c of _0x36dfe2){await exports['userMonitor'][_0x4024ca(0x1d2)](_0x484e5c[_0x4024ca(0x1db)]);}exports[_0x4024ca(0x1ca)][_0x4024ca(0x1ce)](_0x4024ca(0x1cb),{},{'repeat':{'cron':_0x4024ca(0x1de),'key':_0x4024ca(0x1b6)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1['logger'][_0x4024ca(0x1d4)]('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado');}exports['initUserMonitorQueues']=initUserMonitorQueues;