'use strict';const a563_0x33cd92=a563_0x4160;(function(_0x84fc74,_0x4a34f4){const _0x144df0=a563_0x4160,_0x1d6576=_0x84fc74();while(!![]){try{const _0x243c7b=-parseInt(_0x144df0(0xe0))/0x1+-parseInt(_0x144df0(0xdd))/0x2+parseInt(_0x144df0(0xcd))/0x3*(-parseInt(_0x144df0(0xea))/0x4)+-parseInt(_0x144df0(0xe9))/0x5+-parseInt(_0x144df0(0xca))/0x6+-parseInt(_0x144df0(0xef))/0x7*(parseInt(_0x144df0(0xd2))/0x8)+parseInt(_0x144df0(0xe4))/0x9*(parseInt(_0x144df0(0xf3))/0xa);if(_0x243c7b===_0x4a34f4)break;else _0x1d6576['push'](_0x1d6576['shift']());}catch(_0x1a226c){_0x1d6576['push'](_0x1d6576['shift']());}}}(a563_0x33e1,0x37150));function a563_0x33e1(){const _0x4e82d4=['258264ZkWCSQ','configurable','lodash','264345WemZxg','getOwnPropertyDescriptor','get','info','findByPk','96aaOanF','verify-login-status','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','./models/User','initUserMonitorQueues','add','logger','bull','default','query','./utils/logger','285820xnCReA','SELECT','__importDefault','168618wJFhge','call','key','captureException','458829YrnXgC','sequelize','getRepeatableJobs','create','Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado','1858690KJiZLP','4DzQhqS','env','hasOwnProperty','prototype','__createBinding','255738ykBIOB','Usuário\x20passado\x20para\x20offline:\x20','__setModuleDefault','QueryTypes','290ajsVYw','__importStar','userMonitor','VerifyLoginStatus','defineProperty','UserMonitor','null','process','update','REDIS_URI','online','__esModule'];a563_0x33e1=function(){return _0x4e82d4;};return a563_0x33e1();}var __createBinding=this&&this[a563_0x33cd92(0xee)]||(Object['create']?function(_0x1577ed,_0x1e0135,_0x1d0d4e,_0x345345){const _0x4b888f=a563_0x33cd92;if(_0x345345===undefined)_0x345345=_0x1d0d4e;var _0x21a637=Object[_0x4b888f(0xce)](_0x1e0135,_0x1d0d4e);(!_0x21a637||(_0x4b888f(0xcf)in _0x21a637?!_0x1e0135[_0x4b888f(0xc9)]:_0x21a637['writable']||_0x21a637[_0x4b888f(0xcb)]))&&(_0x21a637={'enumerable':!![],'get':function(){return _0x1e0135[_0x1d0d4e];}}),Object['defineProperty'](_0x1577ed,_0x345345,_0x21a637);}:function(_0x1ae06e,_0x3b1e11,_0x4d8afb,_0x3bc28b){if(_0x3bc28b===undefined)_0x3bc28b=_0x4d8afb;_0x1ae06e[_0x3bc28b]=_0x3b1e11[_0x4d8afb];}),__setModuleDefault=this&&this[a563_0x33cd92(0xf1)]||(Object[a563_0x33cd92(0xe7)]?function(_0x5a546b,_0x2c8190){const _0x26fce0=a563_0x33cd92;Object[_0x26fce0(0xf7)](_0x5a546b,_0x26fce0(0xda),{'enumerable':!![],'value':_0x2c8190});}:function(_0x33085d,_0x3dfaf7){const _0x5c63c7=a563_0x33cd92;_0x33085d[_0x5c63c7(0xda)]=_0x3dfaf7;}),__importStar=this&&this[a563_0x33cd92(0xf4)]||function(_0x56a35e){const _0x4b6578=a563_0x33cd92;if(_0x56a35e&&_0x56a35e[_0x4b6578(0xc9)])return _0x56a35e;var _0xeb6563={};if(_0x56a35e!=null){for(var _0x185348 in _0x56a35e)if(_0x185348!=='default'&&Object[_0x4b6578(0xed)][_0x4b6578(0xec)][_0x4b6578(0xe1)](_0x56a35e,_0x185348))__createBinding(_0xeb6563,_0x56a35e,_0x185348);}return __setModuleDefault(_0xeb6563,_0x56a35e),_0xeb6563;},__importDefault=this&&this[a563_0x33cd92(0xdf)]||function(_0x3f7a16){const _0x52d32c=a563_0x33cd92;return _0x3f7a16&&_0x3f7a16[_0x52d32c(0xc9)]?_0x3f7a16:{'default':_0x3f7a16};};Object[a563_0x33cd92(0xf7)](exports,a563_0x33cd92(0xc9),{'value':!![]}),exports[a563_0x33cd92(0xd6)]=exports[a563_0x33cd92(0xf5)]=void 0x0;const bull_1=__importDefault(require(a563_0x33cd92(0xd9))),Sentry=__importStar(require('@sentry/node')),sequelize_1=require(a563_0x33cd92(0xe5)),lodash_1=require(a563_0x33cd92(0xcc)),logger_1=require(a563_0x33cd92(0xdc)),database_1=__importDefault(require('./database')),User_1=__importDefault(require(a563_0x33cd92(0xd5))),connection=process[a563_0x33cd92(0xeb)][a563_0x33cd92(0xfc)]||'';exports[a563_0x33cd92(0xf5)]=new bull_1[(a563_0x33cd92(0xda))](a563_0x33cd92(0xf8),connection);async function handleLoginStatus(_0x11b719){const _0x29f013=a563_0x33cd92,_0x42b50c=await database_1[_0x29f013(0xda)][_0x29f013(0xdb)](_0x29f013(0xd4),{'type':sequelize_1[_0x29f013(0xf2)][_0x29f013(0xde)]});for(let _0x25a32f of _0x42b50c){try{const _0xeea2e0=await User_1[_0x29f013(0xda)][_0x29f013(0xd1)](_0x25a32f['id']);await _0xeea2e0[_0x29f013(0xfb)]({'online':![]}),logger_1[_0x29f013(0xd8)]['info'](_0x29f013(0xf0)+_0x25a32f['id']);}catch(_0x438a96){Sentry[_0x29f013(0xe3)](_0x438a96);}}}function a563_0x4160(_0x10b4a2,_0x45652a){const _0x33e1fd=a563_0x33e1();return a563_0x4160=function(_0x4160c5,_0x607fc3){_0x4160c5=_0x4160c5-0xc9;let _0x38f73d=_0x33e1fd[_0x4160c5];return _0x38f73d;},a563_0x4160(_0x10b4a2,_0x45652a);}async function handleUserConnection(_0x32c948){const _0x3d38f9=a563_0x33cd92;try{const {id:_0x2da190}=_0x32c948['data'];if(!(0x0,lodash_1['isNil'])(_0x2da190)&&_0x2da190!==_0x3d38f9(0xf9)){const _0x547b1d=await User_1[_0x3d38f9(0xda)][_0x3d38f9(0xd1)](_0x2da190);_0x547b1d&&(_0x547b1d[_0x3d38f9(0xfd)]=!![],await _0x547b1d['save']());}}catch(_0x156a0a){Sentry[_0x3d38f9(0xe3)](_0x156a0a);}}exports['userMonitor'][a563_0x33cd92(0xfa)]('UserConnection',handleUserConnection),exports[a563_0x33cd92(0xf5)][a563_0x33cd92(0xfa)](a563_0x33cd92(0xf6),handleLoginStatus);async function initUserMonitorQueues(){const _0x1df5d6=a563_0x33cd92,_0x28d604=await exports[_0x1df5d6(0xf5)][_0x1df5d6(0xe6)]();for(let _0x38b689 of _0x28d604){await exports[_0x1df5d6(0xf5)]['removeRepeatableByKey'](_0x38b689[_0x1df5d6(0xe2)]);}exports[_0x1df5d6(0xf5)][_0x1df5d6(0xd7)](_0x1df5d6(0xf6),{},{'repeat':{'cron':'*\x20*\x20*\x20*\x20*','key':_0x1df5d6(0xd3)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x1df5d6(0xd8)][_0x1df5d6(0xd0)](_0x1df5d6(0xe8));}exports[a563_0x33cd92(0xd6)]=initUserMonitorQueues;