'use strict';const a562_0x2c3823=a562_0x2e70;(function(_0xdd1049,_0x23e876){const _0x401e53=a562_0x2e70,_0x302011=_0xdd1049();while(!![]){try{const _0x5964e9=parseInt(_0x401e53(0x184))/0x1*(parseInt(_0x401e53(0x173))/0x2)+-parseInt(_0x401e53(0x179))/0x3+-parseInt(_0x401e53(0x171))/0x4+-parseInt(_0x401e53(0x169))/0x5*(-parseInt(_0x401e53(0x16a))/0x6)+-parseInt(_0x401e53(0x164))/0x7+-parseInt(_0x401e53(0x175))/0x8+parseInt(_0x401e53(0x183))/0x9;if(_0x5964e9===_0x23e876)break;else _0x302011['push'](_0x302011['shift']());}catch(_0xc2a1cc){_0x302011['push'](_0x302011['shift']());}}}(a562_0x2738,0xc4df3));var __createBinding=this&&this[a562_0x2c3823(0x15f)]||(Object[a562_0x2c3823(0x185)]?function(_0x174a65,_0x40087c,_0x4e7566,_0x44d691){const _0x32a2be=a562_0x2c3823;if(_0x44d691===undefined)_0x44d691=_0x4e7566;var _0x2d21d7=Object[_0x32a2be(0x160)](_0x40087c,_0x4e7566);(!_0x2d21d7||(_0x32a2be(0x15c)in _0x2d21d7?!_0x40087c[_0x32a2be(0x15b)]:_0x2d21d7[_0x32a2be(0x17d)]||_0x2d21d7[_0x32a2be(0x163)]))&&(_0x2d21d7={'enumerable':!![],'get':function(){return _0x40087c[_0x4e7566];}}),Object[_0x32a2be(0x17f)](_0x174a65,_0x44d691,_0x2d21d7);}:function(_0x5aa4a3,_0x5e676b,_0x5e98b8,_0x4270d8){if(_0x4270d8===undefined)_0x4270d8=_0x5e98b8;_0x5aa4a3[_0x4270d8]=_0x5e676b[_0x5e98b8];}),__setModuleDefault=this&&this[a562_0x2c3823(0x159)]||(Object[a562_0x2c3823(0x185)]?function(_0x3141d6,_0x3ea818){const _0x3736bc=a562_0x2c3823;Object[_0x3736bc(0x17f)](_0x3141d6,_0x3736bc(0x165),{'enumerable':!![],'value':_0x3ea818});}:function(_0x1b8049,_0x3e6149){const _0x4a1dea=a562_0x2c3823;_0x1b8049[_0x4a1dea(0x165)]=_0x3e6149;}),__importStar=this&&this[a562_0x2c3823(0x167)]||function(_0x2ad1ed){const _0x48ecc7=a562_0x2c3823;if(_0x2ad1ed&&_0x2ad1ed[_0x48ecc7(0x15b)])return _0x2ad1ed;var _0x5363af={};if(_0x2ad1ed!=null){for(var _0xca94d7 in _0x2ad1ed)if(_0xca94d7!==_0x48ecc7(0x165)&&Object[_0x48ecc7(0x17e)][_0x48ecc7(0x15e)][_0x48ecc7(0x15a)](_0x2ad1ed,_0xca94d7))__createBinding(_0x5363af,_0x2ad1ed,_0xca94d7);}return __setModuleDefault(_0x5363af,_0x2ad1ed),_0x5363af;},__importDefault=this&&this['__importDefault']||function(_0x494488){const _0x11f427=a562_0x2c3823;return _0x494488&&_0x494488[_0x11f427(0x15b)]?_0x494488:{'default':_0x494488};};Object[a562_0x2c3823(0x17f)](exports,'__esModule',{'value':!![]}),exports[a562_0x2c3823(0x16d)]=exports['userMonitor']=void 0x0;const bull_1=__importDefault(require('bull')),Sentry=__importStar(require(a562_0x2c3823(0x182))),sequelize_1=require(a562_0x2c3823(0x174)),lodash_1=require(a562_0x2c3823(0x172)),logger_1=require(a562_0x2c3823(0x16f)),database_1=__importDefault(require('./database')),User_1=__importDefault(require('./models/User')),connection=process['env']['REDIS_URI']||'';function a562_0x2738(){const _0x158932=['data','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','key','2781693uoTFKh','add','*\x20*\x20*\x20*\x20*','update','writable','prototype','defineProperty','info','UserConnection','@sentry/node','14136273TcAwqt','68671btuDpA','create','QueryTypes','findByPk','isNil','online','__setModuleDefault','call','__esModule','get','null','hasOwnProperty','__createBinding','getOwnPropertyDescriptor','save','UserMonitor','configurable','972020beBbOV','default','captureException','__importStar','process','5890wXJDag','6702owAFRe','VerifyLoginStatus','userMonitor','initUserMonitorQueues','logger','./utils/logger','query','4902404hfORQw','lodash','14FTghzP','sequelize','2153128heXPMP'];a562_0x2738=function(){return _0x158932;};return a562_0x2738();}exports[a562_0x2c3823(0x16c)]=new bull_1[(a562_0x2c3823(0x165))](a562_0x2c3823(0x162),connection);async function handleLoginStatus(_0x51ae69){const _0x5c60f9=a562_0x2c3823,_0x39b2aa=await database_1[_0x5c60f9(0x165)][_0x5c60f9(0x170)](_0x5c60f9(0x177),{'type':sequelize_1[_0x5c60f9(0x186)]['SELECT']});for(let _0x3f3485 of _0x39b2aa){try{const _0x170fe2=await User_1[_0x5c60f9(0x165)][_0x5c60f9(0x156)](_0x3f3485['id']);await _0x170fe2[_0x5c60f9(0x17c)]({'online':![]}),logger_1[_0x5c60f9(0x16e)][_0x5c60f9(0x180)]('Usuário\x20passado\x20para\x20offline:\x20'+_0x3f3485['id']);}catch(_0x4c874a){Sentry[_0x5c60f9(0x166)](_0x4c874a);}}}async function handleUserConnection(_0x5b441c){const _0x1d447d=a562_0x2c3823;try{const {id:_0x5485b2}=_0x5b441c[_0x1d447d(0x176)];if(!(0x0,lodash_1[_0x1d447d(0x157)])(_0x5485b2)&&_0x5485b2!==_0x1d447d(0x15d)){const _0x21bfc9=await User_1['default'][_0x1d447d(0x156)](_0x5485b2);_0x21bfc9&&(_0x21bfc9[_0x1d447d(0x158)]=!![],await _0x21bfc9[_0x1d447d(0x161)]());}}catch(_0x44fd5c){Sentry[_0x1d447d(0x166)](_0x44fd5c);}}exports[a562_0x2c3823(0x16c)][a562_0x2c3823(0x168)](a562_0x2c3823(0x181),handleUserConnection),exports['userMonitor'][a562_0x2c3823(0x168)](a562_0x2c3823(0x16b),handleLoginStatus);function a562_0x2e70(_0x505815,_0x36a334){const _0x273805=a562_0x2738();return a562_0x2e70=function(_0x2e705d,_0x3e8a7d){_0x2e705d=_0x2e705d-0x156;let _0x145b2c=_0x273805[_0x2e705d];return _0x145b2c;},a562_0x2e70(_0x505815,_0x36a334);}async function initUserMonitorQueues(){const _0x4b9df9=a562_0x2c3823,_0x208f14=await exports['userMonitor']['getRepeatableJobs']();for(let _0x2d17d2 of _0x208f14){await exports[_0x4b9df9(0x16c)]['removeRepeatableByKey'](_0x2d17d2[_0x4b9df9(0x178)]);}exports[_0x4b9df9(0x16c)][_0x4b9df9(0x17a)](_0x4b9df9(0x16b),{},{'repeat':{'cron':_0x4b9df9(0x17b),'key':'verify-login-status'},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x4b9df9(0x16e)]['info']('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado');}exports[a562_0x2c3823(0x16d)]=initUserMonitorQueues;