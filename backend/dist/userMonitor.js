'use strict';const a562_0x22762d=a562_0x42e0;(function(_0x2c42a5,_0x17503a){const _0x5f1685=a562_0x42e0,_0x483663=_0x2c42a5();while(!![]){try{const _0x5e08cc=parseInt(_0x5f1685(0x15d))/0x1*(-parseInt(_0x5f1685(0x180))/0x2)+-parseInt(_0x5f1685(0x176))/0x3+parseInt(_0x5f1685(0x170))/0x4+parseInt(_0x5f1685(0x15b))/0x5+parseInt(_0x5f1685(0x167))/0x6+-parseInt(_0x5f1685(0x154))/0x7*(-parseInt(_0x5f1685(0x153))/0x8)+-parseInt(_0x5f1685(0x169))/0x9;if(_0x5e08cc===_0x17503a)break;else _0x483663['push'](_0x483663['shift']());}catch(_0x1960cc){_0x483663['push'](_0x483663['shift']());}}}(a562_0x3ecb,0xa787f));function a562_0x3ecb(){const _0x5e6edc=['1326216ENVTiW','default','Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado','./database','info','./models/User','2808225apPJSg','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','process','data','add','logger','defineProperty','key','__importStar','*\x20*\x20*\x20*\x20*','3508AWciAa','save','hasOwnProperty','SELECT','8OPkrgr','3546844LnHpfq','removeRepeatableByKey','initUserMonitorQueues','create','Usuário\x20passado\x20para\x20offline:\x20','bull','__createBinding','5209190YsocVg','captureException','255TTGxzh','__setModuleDefault','get','__esModule','./utils/logger','userMonitor','lodash','VerifyLoginStatus','UserConnection','query','7240518tXCCnC','call','9155565xEpxQQ','verify-login-status','online','configurable','REDIS_URI','UserMonitor','sequelize'];a562_0x3ecb=function(){return _0x5e6edc;};return a562_0x3ecb();}function a562_0x42e0(_0x53151b,_0x1b2cec){const _0x3ecb92=a562_0x3ecb();return a562_0x42e0=function(_0x42e0e4,_0x26903e){_0x42e0e4=_0x42e0e4-0x151;let _0xa5a5f=_0x3ecb92[_0x42e0e4];return _0xa5a5f;},a562_0x42e0(_0x53151b,_0x1b2cec);}var __createBinding=this&&this[a562_0x22762d(0x15a)]||(Object[a562_0x22762d(0x157)]?function(_0x5a21a7,_0x1d3909,_0x5a8f69,_0x2c52c4){const _0x328741=a562_0x22762d;if(_0x2c52c4===undefined)_0x2c52c4=_0x5a8f69;var _0x35ca87=Object['getOwnPropertyDescriptor'](_0x1d3909,_0x5a8f69);(!_0x35ca87||(_0x328741(0x15f)in _0x35ca87?!_0x1d3909[_0x328741(0x160)]:_0x35ca87['writable']||_0x35ca87[_0x328741(0x16c)]))&&(_0x35ca87={'enumerable':!![],'get':function(){return _0x1d3909[_0x5a8f69];}}),Object[_0x328741(0x17c)](_0x5a21a7,_0x2c52c4,_0x35ca87);}:function(_0x2a705,_0x1d6a76,_0x501a9d,_0x5a8a4d){if(_0x5a8a4d===undefined)_0x5a8a4d=_0x501a9d;_0x2a705[_0x5a8a4d]=_0x1d6a76[_0x501a9d];}),__setModuleDefault=this&&this[a562_0x22762d(0x15e)]||(Object[a562_0x22762d(0x157)]?function(_0x4cf981,_0x2a7e1d){const _0x273931=a562_0x22762d;Object[_0x273931(0x17c)](_0x4cf981,_0x273931(0x171),{'enumerable':!![],'value':_0x2a7e1d});}:function(_0x51f3f1,_0x422a6b){const _0x3523b0=a562_0x22762d;_0x51f3f1[_0x3523b0(0x171)]=_0x422a6b;}),__importStar=this&&this[a562_0x22762d(0x17e)]||function(_0x21475b){const _0x546735=a562_0x22762d;if(_0x21475b&&_0x21475b['__esModule'])return _0x21475b;var _0x392cbe={};if(_0x21475b!=null){for(var _0x1c41a0 in _0x21475b)if(_0x1c41a0!==_0x546735(0x171)&&Object['prototype'][_0x546735(0x151)][_0x546735(0x168)](_0x21475b,_0x1c41a0))__createBinding(_0x392cbe,_0x21475b,_0x1c41a0);}return __setModuleDefault(_0x392cbe,_0x21475b),_0x392cbe;},__importDefault=this&&this['__importDefault']||function(_0x5c4f04){return _0x5c4f04&&_0x5c4f04['__esModule']?_0x5c4f04:{'default':_0x5c4f04};};Object[a562_0x22762d(0x17c)](exports,a562_0x22762d(0x160),{'value':!![]}),exports[a562_0x22762d(0x156)]=exports[a562_0x22762d(0x162)]=void 0x0;const bull_1=__importDefault(require(a562_0x22762d(0x159))),Sentry=__importStar(require('@sentry/node')),sequelize_1=require(a562_0x22762d(0x16f)),lodash_1=require(a562_0x22762d(0x163)),logger_1=require(a562_0x22762d(0x161)),database_1=__importDefault(require(a562_0x22762d(0x173))),User_1=__importDefault(require(a562_0x22762d(0x175))),connection=process['env'][a562_0x22762d(0x16d)]||'';exports['userMonitor']=new bull_1[(a562_0x22762d(0x171))](a562_0x22762d(0x16e),connection);async function handleLoginStatus(_0x12b10a){const _0x22a786=a562_0x22762d,_0x3ffc3b=await database_1[_0x22a786(0x171)][_0x22a786(0x166)](_0x22a786(0x177),{'type':sequelize_1['QueryTypes'][_0x22a786(0x152)]});for(let _0x5f228e of _0x3ffc3b){try{const _0x3ec7dc=await User_1[_0x22a786(0x171)]['findByPk'](_0x5f228e['id']);await _0x3ec7dc['update']({'online':![]}),logger_1[_0x22a786(0x17b)][_0x22a786(0x174)](_0x22a786(0x158)+_0x5f228e['id']);}catch(_0xf0ce4a){Sentry[_0x22a786(0x15c)](_0xf0ce4a);}}}async function handleUserConnection(_0x2a84da){const _0x14c7af=a562_0x22762d;try{const {id:_0x15a828}=_0x2a84da[_0x14c7af(0x179)];if(!(0x0,lodash_1['isNil'])(_0x15a828)&&_0x15a828!=='null'){const _0x68a3ba=await User_1[_0x14c7af(0x171)]['findByPk'](_0x15a828);_0x68a3ba&&(_0x68a3ba[_0x14c7af(0x16b)]=!![],await _0x68a3ba[_0x14c7af(0x181)]());}}catch(_0x5324ba){Sentry[_0x14c7af(0x15c)](_0x5324ba);}}exports[a562_0x22762d(0x162)][a562_0x22762d(0x178)](a562_0x22762d(0x165),handleUserConnection),exports['userMonitor']['process'](a562_0x22762d(0x164),handleLoginStatus);async function initUserMonitorQueues(){const _0x764082=a562_0x22762d,_0x193e69=await exports['userMonitor']['getRepeatableJobs']();for(let _0x99a413 of _0x193e69){await exports[_0x764082(0x162)][_0x764082(0x155)](_0x99a413[_0x764082(0x17d)]);}exports[_0x764082(0x162)][_0x764082(0x17a)]('VerifyLoginStatus',{},{'repeat':{'cron':_0x764082(0x17f),'key':_0x764082(0x16a)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x764082(0x17b)][_0x764082(0x174)](_0x764082(0x172));}exports[a562_0x22762d(0x156)]=initUserMonitorQueues;