'use strict';const a520_0x590811=a520_0x1bf5;(function(_0xbe9809,_0x5bed67){const _0x805417=a520_0x1bf5,_0x555f2a=_0xbe9809();while(!![]){try{const _0x474939=parseInt(_0x805417(0x185))/0x1*(-parseInt(_0x805417(0x18a))/0x2)+-parseInt(_0x805417(0x18f))/0x3*(parseInt(_0x805417(0x18b))/0x4)+-parseInt(_0x805417(0x188))/0x5+parseInt(_0x805417(0x189))/0x6*(-parseInt(_0x805417(0x17f))/0x7)+parseInt(_0x805417(0x180))/0x8*(-parseInt(_0x805417(0x177))/0x9)+parseInt(_0x805417(0x171))/0xa+parseInt(_0x805417(0x182))/0xb*(parseInt(_0x805417(0x174))/0xc);if(_0x474939===_0x5bed67)break;else _0x555f2a['push'](_0x555f2a['shift']());}catch(_0x4e1e22){_0x555f2a['push'](_0x555f2a['shift']());}}}(a520_0x3b02,0xa4a84));var __importDefault=this&&this[a520_0x590811(0x17c)]||function(_0x1c9f39){const _0x4707f3=a520_0x590811;return _0x1c9f39&&_0x1c9f39[_0x4707f3(0x176)]?_0x1c9f39:{'default':_0x1c9f39};};function a520_0x3b02(){const _0x42d022=['__esModule','3547251edFRsw','../../models/Setting','updatedAt','sequelize','whatsappId','__importDefault','timeCreateNewTicket','userId','133WBUiDa','8wnJvfx','defineProperty','55858NfgYjL','date-fns','value','1kaJCyB','./FindOrCreateATicketTrakingService','update','2332070nLTEpy','203832NJTbGf','1357074SvZqCV','48VTgCpu','DESC','closed','pending','126069pGekfY','subHours','default','9918440tCjOwB','../../models/Ticket','open','5604TFCjSd','findOne'];a520_0x3b02=function(){return _0x42d022;};return a520_0x3b02();}function a520_0x1bf5(_0x71f74a,_0x5e84e7){const _0x3b02fa=a520_0x3b02();return a520_0x1bf5=function(_0x1bf5ba,_0x2a8343){_0x1bf5ba=_0x1bf5ba-0x16f;let _0xf2e7d1=_0x3b02fa[_0x1bf5ba];return _0xf2e7d1;},a520_0x1bf5(_0x71f74a,_0x5e84e7);}Object[a520_0x590811(0x181)](exports,a520_0x590811(0x176),{'value':!![]});const date_fns_1=require(a520_0x590811(0x183)),sequelize_1=require(a520_0x590811(0x17a)),Ticket_1=__importDefault(require(a520_0x590811(0x172))),ShowTicketService_1=__importDefault(require('./ShowTicketService')),FindOrCreateATicketTrakingService_1=__importDefault(require(a520_0x590811(0x186))),Setting_1=__importDefault(require(a520_0x590811(0x178))),FindOrCreateTicketServiceMeta=async(_0x599537,_0x4e8c3f,_0x184ab4,_0x5de486,_0x2e6373)=>{const _0x4fd0e2=a520_0x590811;let _0x1d91aa=await Ticket_1['default']['findOne']({'where':{'status':{[sequelize_1['Op']['or']]:[_0x4fd0e2(0x173),_0x4fd0e2(0x18e),_0x4fd0e2(0x18d)]},'contactId':_0x599537['id'],'companyId':_0x5de486,'channel':_0x2e6373},'order':[['id',_0x4fd0e2(0x18c)]]});_0x1d91aa&&await _0x1d91aa['update']({'unreadMessages':_0x184ab4});if(!_0x1d91aa){_0x1d91aa=await Ticket_1[_0x4fd0e2(0x170)][_0x4fd0e2(0x175)]({'where':{'contactId':_0x599537['id'],'channel':_0x2e6373},'order':[[_0x4fd0e2(0x179),_0x4fd0e2(0x18c)]]});_0x1d91aa&&(await _0x1d91aa[_0x4fd0e2(0x187)]({'status':'pending','userId':null,'unreadMessages':_0x184ab4,'companyId':_0x5de486,'channel':_0x2e6373}),await(0x0,FindOrCreateATicketTrakingService_1[_0x4fd0e2(0x170)])({'ticketId':_0x1d91aa['id'],'companyId':_0x5de486,'whatsappId':_0x1d91aa['whatsappId'],'userId':_0x1d91aa[_0x4fd0e2(0x17e)]}));const _0x6ed858=await Setting_1[_0x4fd0e2(0x170)][_0x4fd0e2(0x175)]({'where':{'key':_0x4fd0e2(0x17d)}}),_0x3d72c9=_0x6ed858?parseInt(_0x6ed858[_0x4fd0e2(0x184)],0xa):0x1c20;}return!_0x1d91aa&&(_0x1d91aa=await Ticket_1[_0x4fd0e2(0x170)][_0x4fd0e2(0x175)]({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x4fd0e2(0x16f)])(new Date(),0x2),+new Date()]},'contactId':_0x599537['id']},'order':[[_0x4fd0e2(0x179),'DESC']]}),_0x1d91aa&&(await _0x1d91aa[_0x4fd0e2(0x187)]({'status':_0x4fd0e2(0x18e),'userId':null,'unreadMessages':_0x184ab4,'companyId':_0x5de486,'channel':_0x2e6373}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x1d91aa['id'],'companyId':_0x5de486,'whatsappId':_0x1d91aa[_0x4fd0e2(0x17b)],'userId':_0x1d91aa[_0x4fd0e2(0x17e)]}))),!_0x1d91aa?(_0x1d91aa=await Ticket_1[_0x4fd0e2(0x170)]['create']({'contactId':_0x599537['id'],'status':_0x4fd0e2(0x18e),'isGroup':![],'unreadMessages':_0x184ab4,'whatsappId':_0x4e8c3f,'companyId':_0x5de486,'channel':_0x2e6373}),await(0x0,FindOrCreateATicketTrakingService_1[_0x4fd0e2(0x170)])({'ticketId':_0x1d91aa['id'],'companyId':_0x5de486,'whatsappId':_0x4e8c3f,'userId':_0x1d91aa['userId']})):await _0x1d91aa[_0x4fd0e2(0x187)]({'whatsappId':_0x4e8c3f}),_0x1d91aa=await(0x0,ShowTicketService_1['default'])(_0x1d91aa['id'],_0x5de486),_0x1d91aa;};exports['default']=FindOrCreateTicketServiceMeta;